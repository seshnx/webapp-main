const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-mIyI6DiM.js","assets/vendor-D33SxI2g.css"])))=>i.map(i=>d[i]);
import{r as u,j as t,c6 as je,U as ke,cd as qe,cn as Xe,a1 as _t,a6 as Be,c8 as de,y as sr,W as ar,h as Oe,R as Ps,df as Ms,dg as Yr,X as D,dh as dt,di as Jr,n as Yt,d6 as zt,dj as $s,dk as Jt,dl as Fs,dm as Rs,f as Xr,dn as As,dp as Ls,dq as Is,dr as Bs,F as Qe,O as Ue,G as De,ds as Kr,dt as Zr,T as oe,du as Us,dv as qs,dw as Qr,a0 as Dr,dx as Os,dy as Ws,dz as Se,cc as lr,cp as es,ce as H,dA as Hs,cm as Gs,dB as Xt,dC as Vs,dD as Ys,P as ge,M as ts,aa as We,dE as rs,cL as ss,L as be,am as nr,al as Ce,i as Me,c0 as Js,c1 as Fr,ao as Xs,ag as as,dF as Ks,dG as Ke,cM as ls,g as et,_ as Rr,ac as Kt,cB as Zt,bP as Qt,aq as Et,J as Ar,dH as Zs,S as ot,c7 as Qs,a as Dt,d5 as Ct,dI as Lr,cr as Ds,dJ as ea,cb as ta,cf as ra,cg as sa,dK as aa,af as Pt,cx as la,dL as na,dM as ia,ch as xe,ci as Ir,cj as Br,a9 as Ur,dN as da,aj as ir,dO as ns,Y as ct,ct as oa,k as er,N as ca,K as is,db as dr,Q as xa,a8 as ga,v as ma,dP as ua,bN as ha,bM as ba}from"./vendor-mIyI6DiM.js";import{b as pa,j as or}from"./chat-P1NCmzAv.js";import{E as ds}from"./EquipmentAutocomplete-BdotCIX_.js";import{_ as qr,a as ya,A as fa}from"./edu-V9buPGJB.js";import{q as os,T as ja,U as ka,V as va}from"./index-BCKV8ync.js";import{EQUIP_CATEGORIES as Tt,AMENITIES_DATA as Na,CLIENT_TYPES as Ze,STAFF_ROLES as St,DISTRIBUTION_STORES as nt,RELEASE_TYPES as wa,DDEX_GENRES as Sa}from"./config-VNvva2Pv.js";import Ca from"./LabelDashboard-BmMBcdOH.js";import{g as _a,a as za}from"./useMarketplace-VvJPAWav.js";import"./vendor-framer-_HoVf1_M.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};r.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new r.Error().stack;s&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[s]="96a72178-2c31-4cb2-8efd-537f5b3bb06d",r._sentryDebugIdIdentifier="sentry-dbid-96a72178-2c31-4cb2-8efd-537f5b3bb06d")})()}catch{}function Or({userData:r,stats:s,onNavigate:d}){var x;const[l,i]=u.useState(new Date),c=(r==null?void 0:r.studioName)||(r==null?void 0:r.profileName)||"My Studio",C=(r==null?void 0:r.rooms)||[],w=(r==null?void 0:r.amenities)||[],N=C.reduce((n,k)=>n+(k.capacity||0),0),g=C.length>0?Math.round(C.reduce((n,k)=>n+(k.rate||0),0)/C.length):0,p=[{label:"Active Rooms",value:C.length,icon:t.jsx(je,{size:20}),color:"blue",onClick:()=>d("rooms")},{label:"Total Capacity",value:`${N} ppl`,icon:t.jsx(ke,{size:20}),color:"green"},{label:"Avg. Rate",value:`$${g}/hr`,icon:t.jsx(qe,{size:20}),color:"purple"},{label:"Amenities",value:w.length,icon:t.jsx(Xe,{size:20}),color:"amber"}],S=(s==null?void 0:s.pendingBookings)||0;return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-8 text-white relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),t.jsxs("div",{className:"relative z-10",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm",children:t.jsx(je,{size:24})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:c}),t.jsxs("p",{className:"text-blue-100 text-sm flex items-center gap-1",children:[t.jsx(_t,{size:14}),r!=null&&r.city&&(r!=null&&r.state)?`${r.city}, ${r.state}`:"Location not set"]})]})]}),(r==null?void 0:r.studioDescription)&&t.jsx("p",{className:"text-blue-100 text-sm mt-4 max-w-2xl line-clamp-2",children:r.studioDescription})]})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:p.map((n,k)=>t.jsxs("button",{onClick:n.onClick,className:`bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm text-left transition-all ${n.onClick?"hover:shadow-md hover:border-brand-blue cursor-pointer":""}`,children:[t.jsx("div",{className:`w-10 h-10 rounded-lg bg-${n.color}-100 dark:bg-${n.color}-900/20 flex items-center justify-center text-${n.color}-600 dark:text-${n.color}-400 mb-3`,children:n.icon}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:n.value}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase font-medium tracking-wide",children:n.label})]},k))}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Be,{size:18,className:"text-amber-500"}),"Pending Actions"]})}),t.jsxs("div",{className:"p-4 space-y-3",children:[S>0?t.jsxs("button",{onClick:()=>d("bookings"),className:"w-full flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30 transition",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(de,{className:"text-amber-600",size:18}),t.jsxs("span",{className:"text-sm font-medium dark:text-amber-300",children:[S," Pending Booking",S>1?"s":""]})]}),t.jsx("span",{className:"text-xs text-amber-600 font-bold",children:"Review →"})]}):t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[t.jsx(sr,{className:"text-green-600",size:18}),t.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"All caught up!"})]}),!(r!=null&&r.studioDescription)&&t.jsxs("button",{onClick:()=>d("settings"),className:"w-full flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition",children:[t.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Add studio description"}),t.jsx("span",{className:"text-xs text-blue-600 font-bold",children:"Setup →"})]}),C.length===0&&t.jsxs("button",{onClick:()=>d("rooms"),className:"w-full flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition",children:[t.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Add your first room"}),t.jsx("span",{className:"text-xs text-purple-600 font-bold",children:"Add →"})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(je,{size:18,className:"text-brand-blue"}),"Rooms"]}),t.jsx("button",{onClick:()=>d("rooms"),className:"text-xs text-brand-blue font-bold hover:underline",children:"Manage →"})]}),t.jsx("div",{className:"p-4",children:C.length===0?t.jsxs("div",{className:"text-center py-6 text-gray-500",children:[t.jsx(je,{size:32,className:"mx-auto mb-2 opacity-30"}),t.jsx("p",{className:"text-sm",children:"No rooms configured yet"})]}):t.jsxs("div",{className:"space-y-2",children:[C.slice(0,4).map((n,k)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white text-sm",children:n.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:[n.capacity," people • ",n.equipment?n.equipment.split(",").length:0," gear items"]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"font-bold text-green-600 dark:text-green-400",children:["$",n.rate,"/hr"]})})]},k)),C.length>4&&t.jsxs("p",{className:"text-xs text-center text-gray-400 pt-2",children:["+",C.length-4," more rooms"]})]})})]})]}),w.length>0&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-3 flex items-center gap-2",children:[t.jsx(Xe,{size:18,className:"text-amber-500"}),"Studio Amenities"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((n,k)=>t.jsx("span",{className:"px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:n},k))})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(de,{size:18,className:"text-brand-blue"}),"Booking Calendar"]}),t.jsx("button",{onClick:()=>d("bookings"),className:"text-xs text-brand-blue font-bold hover:underline",children:"View All →"})]}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("button",{onClick:()=>i(new Date(l.getFullYear(),l.getMonth()-1,1)),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:t.jsx(ar,{size:18,className:"text-gray-500"})}),t.jsx("span",{className:"font-bold dark:text-white",children:l.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),t.jsx("button",{onClick:()=>i(new Date(l.getFullYear(),l.getMonth()+1,1)),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:t.jsx(Oe,{size:18,className:"text-gray-500"})})]}),t.jsx(Ea,{currentDate:l,bookings:(s==null?void 0:s.recentBookings)||[],onNavigate:d}),((x=s==null?void 0:s.recentBookings)==null?void 0:x.length)>0&&t.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Upcoming Sessions"}),t.jsx("div",{className:"space-y-2",children:s.recentBookings.slice(0,3).map((n,k)=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium dark:text-white",children:n.clientName||"Client"}),t.jsx("span",{className:"text-gray-500 ml-2",children:new Date(n.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),t.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${n.status==="confirmed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:n.status||"pending"})]},k))})]})]})]})]})}function Ea({currentDate:r,bookings:s,onNavigate:d}){const l=r.getFullYear(),i=r.getMonth(),c=new Date,C=new Date(l,i,1).getDay(),w=new Date(l,i+1,0).getDate(),N=[];for(let x=0;x<C;x++)N.push(null);for(let x=1;x<=w;x++)N.push(x);const g=x=>x?s.filter(n=>{const k=new Date(n.date);return k.getDate()===x&&k.getMonth()===i&&k.getFullYear()===l}):[],p=x=>x===c.getDate()&&i===c.getMonth()&&l===c.getFullYear(),S=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t.jsxs("div",{children:[t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:S.map(x=>t.jsx("div",{className:"text-center text-xs font-bold text-gray-400 py-1",children:x},x))}),t.jsx("div",{className:"grid grid-cols-7 gap-1",children:N.map((x,n)=>{const k=g(x),j=k.length>0,y=k.some(F=>F.status==="confirmed"),v=k.some(F=>F.status==="pending");return t.jsxs("button",{onClick:()=>x&&j&&d("bookings"),disabled:!x,className:`aspect-square flex flex-col items-center justify-center rounded-lg text-sm relative transition ${x?p(x)?"bg-brand-blue text-white font-bold":j?"bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 cursor-pointer":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700":""}`,children:[x,j&&!p(x)&&t.jsxs("div",{className:"flex gap-0.5 mt-0.5",children:[y&&t.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),v&&t.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"})]})]},n)})}),t.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-gray-500",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Confirmed"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"Pending"]})]})]})}function cs({imageUrl:r,onClose:s,title:d="360° View"}){const l=u.useRef(null),i=u.useRef(null),[c,C]=Ps.useState(!1);u.useEffect(()=>{if(!(!r||!i.current))return Promise.all([qr(()=>import("./vendor-mIyI6DiM.js").then(N=>N.dW),__vite__mapDeps([0,1])),qr(()=>import("./vendor-mIyI6DiM.js").then(N=>N.dX),__vite__mapDeps([0,1]))]).then(([N])=>{const p=(N.default||N).viewer(i.current,{type:"equirectangular",panorama:r,autoLoad:!0,autoRotate:0,compass:!0,showControls:!0,keyboardZoom:!0,mouseZoom:!0,hfov:100,minHfov:50,maxHfov:120});l.current=p}).catch(N=>{console.error("Failed to load pannellum:",N)}),()=>{if(l.current)try{l.current.destroy()}catch(N){console.error("Error destroying viewer:",N)}}},[r]);const w=()=>{i.current&&(c?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():i.current.requestFullscreen?i.current.requestFullscreen():i.current.webkitRequestFullscreen?i.current.webkitRequestFullscreen():i.current.mozRequestFullScreen?i.current.mozRequestFullScreen():i.current.msRequestFullscreen&&i.current.msRequestFullscreen(),C(!c))};return u.useEffect(()=>{const N=()=>{C(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",N),document.addEventListener("webkitfullscreenchange",N),document.addEventListener("mozfullscreenchange",N),document.addEventListener("MSFullscreenChange",N),()=>{document.removeEventListener("fullscreenchange",N),document.removeEventListener("webkitfullscreenchange",N),document.removeEventListener("mozfullscreenchange",N),document.removeEventListener("MSFullscreenChange",N)}},[]),r?t.jsxs("div",{className:"relative w-full rounded-lg overflow-hidden border dark:border-gray-700 bg-black",children:[t.jsxs("div",{className:"absolute top-0 left-0 right-0 z-10 bg-gradient-to-b from-black/70 to-transparent p-3 flex justify-between items-center",children:[t.jsx("h3",{className:"text-white font-semibold text-sm",children:d}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:w,className:"p-2 bg-black/50 hover:bg-black/70 rounded-lg text-white transition",title:c?"Exit Fullscreen":"Fullscreen",children:c?t.jsx(Ms,{size:18}):t.jsx(Yr,{size:18})}),s&&t.jsx("button",{onClick:s,className:"p-2 bg-black/50 hover:bg-black/70 rounded-lg text-white transition",title:"Close",children:t.jsx(D,{size:18})})]})]}),t.jsx("div",{ref:i,className:"w-full h-96",style:{minHeight:"400px"}})]}):t.jsx("div",{className:"w-full h-64 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center",children:t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No 360° image available"})})}function Ta({activeTool:r,setActiveTool:s,onUndo:d,onRedo:l,canUndo:i,canRedo:c,onZoomIn:C,onZoomOut:w,onFitToView:N,onExportSVG:g,onExportPNG:p,onExportPDF:S,showGrid:x,toggleGrid:n,measurementUnit:k,setMeasurementUnit:j,scale:y,setScale:v,onBackgroundImageUpload:F,onAddRoomTemplate:$}){const z=[{id:"select",icon:Jr,label:"Select",group:"basic"},{id:"wall",icon:Yt,label:"Wall",group:"basic"},{id:"room",icon:Yt,label:"Room",group:"basic"},{id:"structure",icon:zt,label:"Area",group:"basic"},{id:"door",icon:$s,label:"Door",group:"elements"},{id:"window",icon:Jt,label:"Window",group:"elements"},{id:"furniture",icon:zt,label:"Furniture",group:"elements"},{id:"measure",icon:Fs,label:"Measure",group:"tools"},{id:"text",icon:Rs,label:"Text",group:"tools"},{id:"circle",icon:Xr,label:"Circle",group:"shapes"},{id:"polygon",icon:As,label:"Polygon",group:"shapes"}];return t.jsxs("div",{className:"flex flex-col gap-2 p-2 bg-white dark:bg-[#2c2e36] border-r dark:border-gray-700",children:[t.jsxs("div",{className:"flex gap-1 pb-2 border-b dark:border-gray-700",children:[t.jsx("button",{onClick:d,disabled:!i,className:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",title:"Undo (Ctrl+Z)",children:t.jsx(dt,{size:18,className:"rotate-180"})}),t.jsx("button",{onClick:l,disabled:!c,className:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",title:"Redo (Ctrl+Shift+Z)",children:t.jsx(dt,{size:18})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Basic"}),z.filter(b=>b.group==="basic").map(b=>{const R=b.icon;return t.jsxs("button",{onClick:()=>s(b.id),className:`w-full p-2 rounded flex items-center gap-2 text-sm transition ${r===b.id?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:b.label,children:[t.jsx(R,{size:16}),t.jsx("span",{className:"text-xs",children:b.label})]},b.id)}),t.jsxs("div",{className:"pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Templates"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("button",{onClick:()=>{$&&$({name:"Control Room",width:200,height:150,color:"#3B82F6"})},className:"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:"Control Room"}),t.jsx("button",{onClick:()=>{$&&$({name:"Live Room",width:300,height:250,color:"#10B981"})},className:"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:"Live Room"}),t.jsx("button",{onClick:()=>{$&&$({name:"Isolation Booth",width:120,height:120,color:"#F59E0B"})},className:"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:"Isolation Booth"})]})]})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Elements"}),z.filter(b=>b.group==="elements").map(b=>{const R=b.icon;return t.jsxs("button",{onClick:()=>s(b.id),className:`w-full p-2 rounded flex items-center gap-2 text-sm transition ${r===b.id?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:b.label,children:[t.jsx(R,{size:16}),t.jsx("span",{className:"text-xs",children:b.label})]},b.id)})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Tools"}),z.filter(b=>b.group==="tools").map(b=>{const R=b.icon;return t.jsxs("button",{onClick:()=>s(b.id),className:`w-full p-2 rounded flex items-center gap-2 text-sm transition ${r===b.id?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:b.label,children:[t.jsx(R,{size:16}),t.jsx("span",{className:"text-xs",children:b.label})]},b.id)})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Shapes"}),z.filter(b=>b.group==="shapes").map(b=>{const R=b.icon;return t.jsxs("button",{onClick:()=>s(b.id),className:`w-full p-2 rounded flex items-center gap-2 text-sm transition ${r===b.id?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:b.label,children:[t.jsx(R,{size:16}),t.jsx("span",{className:"text-xs",children:b.label})]},b.id)})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"View"}),t.jsx("button",{onClick:C,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",title:"Zoom In",children:t.jsx(Ls,{size:16})}),t.jsx("button",{onClick:w,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",title:"Zoom Out",children:t.jsx(Is,{size:16})}),t.jsx("button",{onClick:N,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",title:"Fit to View",children:t.jsx(Yr,{size:16})}),t.jsxs("button",{onClick:n,className:`w-full p-2 rounded flex items-center gap-2 text-sm ${x?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:"Toggle Grid",children:[t.jsx(Bs,{size:16}),t.jsx("span",{className:"text-xs",children:"Grid"})]})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Export"}),t.jsxs("button",{onClick:g,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2",title:"Export SVG",children:[t.jsx(Qe,{size:16}),t.jsx("span",{className:"text-xs",children:"SVG"})]}),t.jsxs("button",{onClick:p,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2",title:"Export PNG",children:[t.jsx(Ue,{size:16}),t.jsx("span",{className:"text-xs",children:"PNG"})]}),t.jsxs("button",{onClick:S,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2",title:"Export PDF",children:[t.jsx(Qe,{size:16}),t.jsx("span",{className:"text-xs",children:"PDF"})]})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Background"}),t.jsxs("label",{className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2 cursor-pointer",children:[t.jsx(Ue,{size:16}),t.jsx("span",{className:"text-xs",children:"Import Image"}),t.jsx("input",{type:"file",accept:"image/*",onChange:b=>{var E;((E=b.target.files)==null?void 0:E[0])&&F&&F(b)},className:"hidden"})]})]}),t.jsxs("div",{className:"pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1 mb-2",children:"Scale"}),t.jsxs("select",{value:y,onChange:b=>v(Number(b.target.value)),className:"w-full p-1.5 text-xs rounded border dark:border-gray-600 dark:bg-[#1f2128] dark:text-white",children:[t.jsx("option",{value:10,children:"1px = 1ft"}),t.jsx("option",{value:20,children:"1px = 0.5ft"}),t.jsx("option",{value:5,children:"1px = 2ft"})]}),t.jsxs("select",{value:k,onChange:b=>j(b.target.value),className:"w-full p-1.5 text-xs rounded border dark:border-gray-600 dark:bg-[#1f2128] dark:text-white mt-2",children:[t.jsx("option",{value:"ft",children:"Feet"}),t.jsx("option",{value:"m",children:"Meters"})]})]})]})}const tr=(r,s,d,l)=>Math.sqrt(Math.pow(d-r,2)+Math.pow(l-s,2)),rr=(r,s,d=1)=>{const l=r*s/(d*d);return{sqft:l,sqm:l*.092903,display:`${l.toFixed(1)} sq ft (${(l*.092903).toFixed(1)} m²)`}},Pa=(r,s,d=1)=>{const l=2*(r+s)/d;return{feet:l,meters:l*.3048,display:`${l.toFixed(1)} ft (${(l*.3048).toFixed(1)} m)`}},Ma=(r,s,d)=>({x:Math.round(r/d)*d,y:Math.round(s/d)*d}),$a=(r,s,d,l=10)=>{let i={x:r,y:s},c=l;return d.forEach(C=>{var x,n,k,j;const w=((x=C.layout)==null?void 0:x.x)||C.x||0,N=((n=C.layout)==null?void 0:n.y)||C.y||0,g=((k=C.layout)==null?void 0:k.width)||C.width||0,p=((j=C.layout)==null?void 0:j.height)||C.height||0;[{x:w,y:N},{x:w+g,y:N},{x:w+g,y:N+p},{x:w,y:N+p},{x:w+g/2,y:N},{x:w+g,y:N+p/2},{x:w+g/2,y:N+p},{x:w,y:N+p/2}].forEach(y=>{const v=tr(r,s,y.x,y.y);v<c&&(c=v,i=y)})}),i},it=(r,s=1,d="ft")=>{const l=r/s;return d==="ft"?`${l.toFixed(1)} ft`:d==="m"?`${(l*.3048).toFixed(2)} m`:`${l.toFixed(1)}`},Fa=(r,s,d)=>{const i=new XMLSerializer().serializeToString(r),c=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),C=URL.createObjectURL(c);return{svgString:i,url:C,blob:c}},Ra=async(r,s,d,l=2)=>{const i=document.createElement("canvas");i.width=s*l,i.height=d*l;const c=i.getContext("2d"),C=new XMLSerializer().serializeToString(r),w=new Image,N=new Blob([C],{type:"image/svg+xml;charset=utf-8"}),g=URL.createObjectURL(N);return new Promise((p,S)=>{w.onload=()=>{c.fillStyle="white",c.fillRect(0,0,i.width,i.height),c.drawImage(w,0,0,i.width,i.height),i.toBlob(x=>{URL.revokeObjectURL(g),p(x)},"image/png")},w.onerror=S,w.src=g})},Pe=(r="item")=>`${r}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;function Aa({selectedItem:r,onClose:s,onUpdate:d,scale:l=10,unit:i="ft"}){if(!r)return null;const c=r.layout&&r.name,C=r.layout&&r.label,w=r.x1!==void 0,N=r.type==="door",g=r.type==="window",p=r.type==="furniture",S=r.layout||{},x=S.width&&S.height?rr(S.width,S.height,l):null,n=S.width&&S.height?Pa(S.width,S.height,l):null,k=j=>{d({...r,...j})};return t.jsxs("div",{className:"w-64 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 p-4 overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"font-bold text-sm dark:text-white",children:"Properties"}),t.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:t.jsx(D,{size:16})})]}),c&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Name"}),t.jsx("input",{type:"text",value:r.name||"",onChange:j=>k({name:j.target.value}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Position"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(S.x||0),onChange:j=>k({layout:{...S,x:Number(j.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:"X"}),t.jsx("input",{type:"number",value:Math.round(S.y||0),onChange:j=>k({layout:{...S,y:Number(j.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:"Y"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Size"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("input",{type:"number",value:Math.round(S.width||0),onChange:j=>k({layout:{...S,width:Number(j.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:"Width"}),t.jsx("span",{className:"text-xs text-gray-500",children:it(S.width||0,l,i)})]}),t.jsxs("div",{children:[t.jsx("input",{type:"number",value:Math.round(S.height||0),onChange:j=>k({layout:{...S,height:Number(j.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:"Height"}),t.jsx("span",{className:"text-xs text-gray-500",children:it(S.height||0,l,i)})]})]})]}),x&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Area"}),t.jsx("div",{className:"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm",children:x.display})]}),n&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Perimeter"}),t.jsx("div",{className:"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm",children:n.display})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Color"}),t.jsx("input",{type:"color",value:S.color||"#3B82F6",onChange:j=>k({layout:{...S,color:j.target.value}}),className:"w-full h-10 border rounded cursor-pointer"})]}),r.rotation!==void 0&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Rotation"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"number",value:r.rotation||0,onChange:j=>k({rotation:Number(j.target.value)}),className:"flex-1 p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",min:"0",max:"360"}),t.jsx("button",{onClick:()=>k({rotation:((r.rotation||0)+90)%360}),className:"p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-700",title:"Rotate 90°",children:t.jsx(dt,{size:16})})]})]})]}),C&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Label"}),t.jsx("input",{type:"text",value:r.label||"",onChange:j=>k({label:j.target.value}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Position"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(S.x||0),onChange:j=>k({layout:{...S,x:Number(j.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(S.y||0),onChange:j=>k({layout:{...S,y:Number(j.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Size"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(S.width||0),onChange:j=>k({layout:{...S,width:Number(j.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(S.height||0),onChange:j=>k({layout:{...S,height:Number(j.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]})]}),w&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Start Point"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(r.x1||0),onChange:j=>k({x1:Number(j.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(r.y1||0),onChange:j=>k({y1:Number(j.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"End Point"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(r.x2||0),onChange:j=>k({x2:Number(j.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(r.y2||0),onChange:j=>k({y2:Number(j.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Length"}),t.jsx("div",{className:"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm",children:it(Math.sqrt(Math.pow((r.x2||0)-(r.x1||0),2)+Math.pow((r.y2||0)-(r.y1||0),2)),l,i)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Thickness"}),t.jsx("input",{type:"number",value:r.strokeWidth||5,onChange:j=>k({strokeWidth:Number(j.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",min:"1",max:"20"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Color"}),t.jsx("input",{type:"color",value:r.stroke||"#52525B",onChange:j=>k({stroke:j.target.value}),className:"w-full h-10 border rounded cursor-pointer"})]})]}),(N||g||p)&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Type"}),t.jsx("input",{type:"text",value:r.subType||"",onChange:j=>k({subType:j.target.value}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:N?"Single, Double, Sliding...":g?"Standard, Bay...":"Chair, Table..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Position"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(r.x||0),onChange:j=>k({x:Number(j.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(r.y||0),onChange:j=>k({y:Number(j.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]}),r.rotation!==void 0&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Rotation"}),t.jsx("input",{type:"number",value:r.rotation||0,onChange:j=>k({rotation:Number(j.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",min:"0",max:"360"})]})]})]})}function La({x:r,y:s,onClose:d,onAction:l,canCopy:i,canPaste:c,canCut:C,canDelete:w,canRotate:N,canFlip:g,isLocked:p}){if(!r||!s)return null;const S=[{id:"copy",label:"Copy",icon:De,disabled:!i,shortcut:"Ctrl+C"},{id:"paste",label:"Paste",icon:Kr,disabled:!c,shortcut:"Ctrl+V"},{id:"cut",label:"Cut",icon:Zr,disabled:!C,shortcut:"Ctrl+X"},{id:"separator1"},{id:"delete",label:"Delete",icon:oe,disabled:!w,shortcut:"Del"},{id:"separator2"},{id:"rotate",label:"Rotate 90°",icon:dt,disabled:!N},{id:"flipH",label:"Flip Horizontal",icon:Us,disabled:!g},{id:"flipV",label:"Flip Vertical",icon:qs,disabled:!g},{id:"separator3"},{id:"lock",label:p?"Unlock":"Lock",icon:p?Qr:Dr},{id:"separator4"},{id:"bringToFront",label:"Bring to Front",icon:Os},{id:"sendToBack",label:"Send to Back",icon:Ws}];return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-50",onClick:d}),t.jsx("div",{className:"fixed z-50 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-lg shadow-lg py-1 min-w-[180px]",style:{left:`${r}px`,top:`${s}px`},children:S.map((x,n)=>{if(x.id.startsWith("separator"))return t.jsx("div",{className:"border-t dark:border-gray-700 my-1"},n);const k=x.icon;return t.jsxs("button",{onClick:()=>{l(x.id),d()},disabled:x.disabled,className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 dark:text-white",children:[t.jsx(k,{size:16}),t.jsx("span",{className:"flex-1",children:x.label}),x.shortcut&&t.jsx("span",{className:"text-xs text-gray-500",children:x.shortcut})]},x.id)})})]})}function Ia({layers:r,onLayerToggle:s,onLayerLock:d}){const l=[{key:"structures",label:"Structures",icon:Se},{key:"rooms",label:"Rooms",icon:Se},{key:"walls",label:"Walls",icon:Se},{key:"doors",label:"Doors",icon:Se},{key:"windows",label:"Windows",icon:Se},{key:"furniture",label:"Furniture",icon:Se},{key:"text",label:"Text Labels",icon:Se},{key:"measurements",label:"Measurements",icon:Se}];return t.jsxs("div",{className:"w-48 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 p-3",children:[t.jsxs("h3",{className:"font-bold text-sm dark:text-white mb-3 flex items-center gap-2",children:[t.jsx(Se,{size:16}),"Layers"]}),t.jsx("div",{className:"space-y-1",children:l.map(i=>{const c=r[i.key]||{visible:!0,locked:!1};return i.icon,t.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[t.jsx("button",{onClick:()=>s(i.key),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:c.visible?t.jsx(lr,{size:16}):t.jsx(es,{size:16})}),t.jsx("span",{className:"text-xs dark:text-white",children:i.label})]}),t.jsx("button",{onClick:()=>d(i.key),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:c.locked?t.jsx(Dr,{size:14}):t.jsx(Qr,{size:14})})]},i.key)})})]})}function Ba({door:r,isSelected:s,onClick:d,onMouseDown:l}){const{x:i,y:c,width:C=30,height:w=60,rotation:N=0,subType:g="single",direction:p="left"}=r,S=i+C/2,x=c+w/2,n=C;return t.jsxs("g",{onClick:d,onMouseDown:l,cursor:"pointer",style:{filter:s?"drop-shadow(0 0 3px #3D84ED)":"none"},children:[t.jsx("rect",{x:i,y:c,width:C,height:w,fill:"none",stroke:s?"#3D84ED":"#8B5CF6",strokeWidth:s?3:2,rx:2}),t.jsx("rect",{x:i+2,y:c+2,width:C-4,height:w-4,fill:"#F3F4F6",stroke:"#8B5CF6",strokeWidth:1}),t.jsx("path",{d:`M ${S} ${x} A ${n} ${n} 0 0 1 ${p==="left"?i:i+C} ${c}`,fill:"none",stroke:"#8B5CF6",strokeWidth:1,strokeDasharray:"3,3",opacity:"0.5"}),t.jsx("circle",{cx:p==="left"?i+C-8:i+8,cy:c+w/2,r:3,fill:"#8B5CF6"}),s&&t.jsx("rect",{x:i-4,y:c-4,width:C+8,height:w+8,fill:"none",stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"})]})}function Ua({window:r,isSelected:s,onClick:d,onMouseDown:l}){const{x:i,y:c,width:C=40,height:w=60,rotation:N=0,subType:g="standard"}=r;return t.jsxs("g",{onClick:d,onMouseDown:l,cursor:"pointer",style:{filter:s?"drop-shadow(0 0 3px #3D84ED)":"none"},children:[t.jsx("rect",{x:i,y:c,width:C,height:w,fill:"#E0F2FE",stroke:s?"#3D84ED":"#0EA5E9",strokeWidth:s?3:2,rx:2,opacity:"0.7"}),t.jsx("line",{x1:i+C/2,y1:c,x2:i+C/2,y2:c+w,stroke:"#0EA5E9",strokeWidth:1}),t.jsx("line",{x1:i,y1:c+w/2,x2:i+C,y2:c+w/2,stroke:"#0EA5E9",strokeWidth:1}),s&&t.jsx("rect",{x:i-4,y:c-4,width:C+8,height:w+8,fill:"none",stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"})]})}function qa({furniture:r,isSelected:s,onClick:d,onMouseDown:l}){const{x:i,y:c,width:C=40,height:w=40,rotation:N=0,subType:g="box"}=r,S={box:zt,sofa:Jt,chair:Yt,table:Xr,bed:Jt}[g]||zt,x=i+C/2,n=c+w/2;return t.jsxs("g",{onClick:d,onMouseDown:l,cursor:"pointer",transform:`translate(${x}, ${n}) rotate(${N}) translate(${-x}, ${-n})`,style:{filter:s?"drop-shadow(0 0 3px #3D84ED)":"none"},children:[t.jsx("rect",{x:i,y:c,width:C,height:w,fill:"#FEF3C7",stroke:s?"#3D84ED":"#F59E0B",strokeWidth:s?3:2,rx:4}),t.jsx("foreignObject",{x:i+C/2-12,y:c+w/2-12,width:24,height:24,children:t.jsx("div",{className:"flex items-center justify-center w-full h-full",children:t.jsx(S,{size:20,className:"text-amber-600"})})}),s&&t.jsx("rect",{x:i-4,y:c-4,width:C+8,height:w+8,fill:"none",stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"})]})}function Oa(r,s=50){const[d,l]=u.useState(r),i=u.useRef([r]),c=u.useRef(0),C=u.useCallback(x=>{c.current<i.current.length-1&&(i.current=i.current.slice(0,c.current+1)),i.current.push(x),i.current.length>s?i.current.shift():c.current++,l(x)},[s]),w=u.useCallback(()=>{c.current>0&&(c.current--,l(i.current[c.current]))},[]),N=u.useCallback(()=>{c.current<i.current.length-1&&(c.current++,l(i.current[c.current]))},[]),g=c.current>0,p=c.current<i.current.length-1,S=u.useCallback(()=>{i.current=[d],c.current=0},[d]);return{state:d,setState:C,undo:w,redo:N,canUndo:g,canRedo:p,clearHistory:S}}const Gt=10,Wa=(r,s,d,l,i,c)=>{const C=r-d,w=s-l,N=i-d,g=c-l,p=C*N+w*g,S=N*N+g*g;let x=-1;S!==0&&(x=p/S);let n,k;x<0?(n=d,k=l):x>1?(n=i,k=c):(n=d+x*N,k=l+x*g);const j=r-n,y=s-k;return Math.sqrt(j*j+y*y)};function Ha({rooms:r,walls:s,structures:d,onRoomClick:l,onLayoutChange:i,onWallsChange:c,onStructuresChange:C}){var jr,kr,vr,Nr,wr,Sr,Cr,_r,zr,Er,Tr;const w=u.useRef(null),N=u.useRef(null),[g,p]=u.useState(!1),[S,x]=u.useState(!1),[n,k]=u.useState({x:0,y:0}),[j,y]=u.useState(!1),[v,F]=u.useState({x:0,y:0}),[$,z]=u.useState(null),[b,R]=u.useState(null),[E,o]=u.useState(null),[M,h]=u.useState(null),[P,B]=u.useState(null),[q,L]=u.useState(null),[Y,_]=u.useState(new Set),[W,T]=u.useState(null),[J,G]=u.useState(null),[Q,me]=u.useState(null),[_e,re]=u.useState(!1),[ee,ze]=u.useState(s||[]),[te,$e]=u.useState(d||[]),[se,Fe]=u.useState([]),[le,xt]=u.useState([]),[ce,gt]=u.useState([]),[tt,Mt]=u.useState([]),[rt,$t]=u.useState([]),[mt,I]=u.useState(null),[V,X]=u.useState(null),[ae,He]=u.useState([]),[ie,st]=u.useState({structures:{visible:!0,locked:!1},rooms:{visible:!0,locked:!1},walls:{visible:!0,locked:!1},doors:{visible:!0,locked:!1},windows:{visible:!0,locked:!1},furniture:{visible:!0,locked:!1},text:{visible:!0,locked:!1},measurements:{visible:!0,locked:!1}}),[zl,El]=u.useState([{name:"Control Room",width:200,height:150,color:"#3B82F6"},{name:"Live Room",width:300,height:250,color:"#10B981"},{name:"Isolation Booth",width:120,height:120,color:"#F59E0B"},{name:"Lounge",width:250,height:200,color:"#8B5CF6"}]),[K,cr]=u.useState("select"),[ve,Ft]=u.useState(null),[ue,Rt]=u.useState(null),[ne,At]=u.useState(null),[Ge,Lt]=u.useState(1),[ut,Tl]=u.useState({x:0,y:0,width:800,height:600}),[It,xs]=u.useState(!0),[Ve,Pl]=u.useState(Gt),[Re,gs]=u.useState(10),[at,ms]=u.useState("ft"),[us,Ml]=u.useState(!0),pe={walls:ee,structures:te,doors:se,windows:le,furniture:ce,textLabels:tt},{setState:Ne,undo:Bt,redo:Ut,canUndo:hs,canRedo:bs}=Oa(pe),qt=800,Ot=600;u.useEffect(()=>{ze(s||[])},[s]),u.useEffect(()=>{$e(d||[])},[d]);const Ae=(a,f=!0)=>{if(!w.current)return{x:0,y:0};const A=w.current.getBoundingClientRect();let m=a.clientX,U=a.clientY;a.touches&&a.touches.length>0&&(m=a.touches[0].clientX,U=a.touches[0].clientY);let O=(m-A.left)/(f?Ge:1)-v.x,lt=(U-A.top)/(f?Ge:1)-v.y;const fe=Ma(O,lt,Ve);if(us&&K==="select"){const Nt=[...r,...te,...ee.map(he=>({x:he.x1,y:he.y1,width:he.x2-he.x1,height:he.y2-he.y1}))];return $a(fe.x,fe.y,Nt,10)}return fe},ht=(a,f=!0)=>{ze(a),c(a),f&&Ne({...pe,walls:a})},bt=(a,f=!0)=>{$e(a),C(a),f&&Ne({...pe,structures:a})},pt=(a,f=!0)=>{Fe(a),f&&Ne({...pe,doors:a})},yt=(a,f=!0)=>{xt(a),f&&Ne({...pe,windows:a})},ft=(a,f=!0)=>{gt(a),f&&Ne({...pe,furniture:a})},Ye=u.useCallback(()=>{if(b){const a=te.filter(f=>f.id!==b);bt(a),R(null),re(!1)}else if(E){const a=ee.filter(f=>f.id!==E);ht(a),o(null),re(!1)}else if(M){const a=se.filter(f=>f.id!==M);pt(a),h(null),re(!1)}else if(P){const a=le.filter(f=>f.id!==P);yt(a),B(null),re(!1)}else if(q){const a=ce.filter(f=>f.id!==q);ft(a),L(null),re(!1)}else $&&(z(null),re(!1))},[b,E,M,P,q,$,te,ee,se,le,ce]),Je=u.useCallback(()=>{if(b){const a=te.find(f=>f.id===b);a&&X({type:"structure",data:a})}else if(E){const a=ee.find(f=>f.id===E);a&&X({type:"wall",data:a})}},[b,E,te,ee]),jt=u.useCallback(()=>{if(!V)return;const a=20;if(V.type==="structure"){const f={...V.data,id:`struct_${Date.now()}`,layout:{...V.data.layout,x:V.data.layout.x+a,y:V.data.layout.y+a}};bt([...te,f]),R(f.id)}else if(V.type==="wall"){const f={...V.data,id:`wall_${Date.now()}`,x1:V.data.x1+a,y1:V.data.y1+a,x2:V.data.x2+a,y2:V.data.y2+a};ht([...ee,f]),o(f.id)}},[V,te,ee]),kt=u.useCallback(()=>{Je(),Ye()},[Je,Ye]);u.useEffect(()=>{const a=f=>{if((f.ctrlKey||f.metaKey)&&f.key==="z"&&!f.shiftKey){f.preventDefault(),Bt();return}if((f.ctrlKey||f.metaKey)&&(f.key==="y"||f.key==="z"&&f.shiftKey)){f.preventDefault(),Ut();return}(f.key==="Delete"||f.key==="Backspace")&&Ye(),(f.ctrlKey||f.metaKey)&&f.key==="c"&&(f.preventDefault(),Je()),(f.ctrlKey||f.metaKey)&&f.key==="v"&&(f.preventDefault(),jt()),(f.ctrlKey||f.metaKey)&&f.key==="x"&&(f.preventDefault(),kt()),(f.ctrlKey||f.metaKey)&&f.key==="="&&(f.preventDefault(),ur()),(f.ctrlKey||f.metaKey)&&f.key==="-"&&(f.preventDefault(),hr()),(f.ctrlKey||f.metaKey)&&f.key==="0"&&(f.preventDefault(),br())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[Ye,Je,jt,kt,Bt,Ut]);const xr=u.useCallback((a,f)=>{if(K!=="select")return;a.preventDefault(),a.stopPropagation();const{x:A,y:m}=Ae(a);z(f.id),R(null),o(null),p(!0),x(!1),k({x:A-f.layout.x,y:m-f.layout.y})},[K]),Ee=u.useCallback((a,f,A)=>{a.preventDefault(),a.stopPropagation(),z(f.id),R(null),o(null),h(null),B(null),L(null),p(!1),x(A)},[]),ps=u.useCallback(a=>{K==="select"&&(a.button===1||a.ctrlKey||a.metaKey||a.space)&&(a.preventDefault(),y({startX:a.clientX,startY:a.clientY}))},[K]),vt=u.useCallback(()=>{y(!1)},[]),ys=()=>{const a={id:`struct_${Date.now()}`,label:"Lobby / Area",layout:{x:100,y:100,width:150,height:100,color:"#94a3b8"}};bt([...te,a]),cr("select")},gr=u.useCallback((a,f)=>{if(K!=="select")return;a.preventDefault(),a.stopPropagation();const{x:A,y:m}=Ae(a);R(f.id),z(null),o(null),p(!0),x(!1),k({x:A-f.layout.x,y:m-f.layout.y})},[K]),Te=u.useCallback((a,f,A)=>{a.preventDefault(),a.stopPropagation(),R(f.id),z(null),o(null),p(!1),x(A)},[]),mr=u.useCallback((a,f,A)=>{K==="select"&&(a.preventDefault(),a.stopPropagation(),T({id:f,point:A}),z(null),R(null),o(f))},[K]),fs=(a,f)=>{K==="select"&&(a.stopPropagation(),o(f),z(null),R(null))},Le=u.useCallback(a=>{if(!w.current)return;const{x:f,y:A}=Ae(a);if(K==="wall"&&ve){const m={id:"preview",x1:ve.x,y1:ve.y,x2:f,y2:A};ze(U=>[...U.filter(O=>O.id!=="preview"),m]);return}if(W){ze(m=>m.map(U=>U.id!==W.id?U:W.point==="start"?{...U,x1:f,y1:A}:{...U,x2:f,y2:A}));return}if(g){const m={x:f-n.x,y:A-n.y};if($){const U=r.find(O=>O.id===$);U&&i($,{...U.layout,...m})}else b?$e(U=>U.map(O=>O.id===b?{...O,layout:{...O.layout,...m}}:O)):M?Fe(U=>U.map(O=>O.id===M?{...O,x:m.x,y:m.y}:O)):P?xt(U=>U.map(O=>O.id===P?{...O,x:m.x,y:m.y}:O)):q&&gt(U=>U.map(O=>O.id===q?{...O,x:m.x,y:m.y}:O))}if(S){if($){const m=r.find(U=>U.id===$);if(m){let U={...m.layout};const O=Gt;S==="br"?(U.width=Math.max(O,f-m.layout.x),U.height=Math.max(O,A-m.layout.y)):S==="bl"?(U.width=Math.max(O,m.layout.x+m.layout.width-f),U.height=Math.max(O,A-m.layout.y),U.x=Math.min(f,m.layout.x+m.layout.width-O)):S==="tr"?(U.width=Math.max(O,f-m.layout.x),U.height=Math.max(O,m.layout.y+m.layout.height-A),U.y=Math.min(A,m.layout.y+m.layout.height-O)):S==="tl"?(U.width=Math.max(O,m.layout.x+m.layout.width-f),U.height=Math.max(O,m.layout.y+m.layout.height-A),U.x=Math.min(f,m.layout.x+m.layout.width-O),U.y=Math.min(A,m.layout.y+m.layout.height-O)):S==="t"?(U.height=Math.max(O,m.layout.y+m.layout.height-A),U.y=Math.min(A,m.layout.y+m.layout.height-O)):S==="r"?U.width=Math.max(O,f-m.layout.x):S==="b"?U.height=Math.max(O,A-m.layout.y):S==="l"&&(U.width=Math.max(O,m.layout.x+m.layout.width-f),U.x=Math.min(f,m.layout.x+m.layout.width-O)),i($,U)}}else if(b){const m=te.find(U=>U.id===b);if(m){let U={...m.layout};const O=Gt;S==="br"?(U.width=Math.max(O,f-m.layout.x),U.height=Math.max(O,A-m.layout.y)):S==="bl"?(U.width=Math.max(O,m.layout.x+m.layout.width-f),U.height=Math.max(O,A-m.layout.y),U.x=Math.min(f,m.layout.x+m.layout.width-O)):S==="tr"?(U.width=Math.max(O,f-m.layout.x),U.height=Math.max(O,m.layout.y+m.layout.height-A),U.y=Math.min(A,m.layout.y+m.layout.height-O)):S==="tl"?(U.width=Math.max(O,m.layout.x+m.layout.width-f),U.height=Math.max(O,m.layout.y+m.layout.height-A),U.x=Math.min(f,m.layout.x+m.layout.width-O),U.y=Math.min(A,m.layout.y+m.layout.height-O)):S==="t"?(U.height=Math.max(O,m.layout.y+m.layout.height-A),U.y=Math.min(A,m.layout.y+m.layout.height-O)):S==="r"?U.width=Math.max(O,f-m.layout.x):S==="b"?U.height=Math.max(O,A-m.layout.y):S==="l"&&(U.width=Math.max(O,m.layout.x+m.layout.width-f),U.x=Math.min(f,m.layout.x+m.layout.width-O)),$e(lt=>lt.map(fe=>fe.id===b?{...fe,layout:U}:fe))}}}if(K==="measure"&&ue){const m=tr(ue.x,ue.y,f,A);At({x1:ue.x,y1:ue.y,x2:f,y2:A,distance:it(m,Re,at)})}if(j&&(a.buttons===1||a.touches)){const m=a.movementX||(a.touches?a.touches[0].clientX-(j.startX||0):0),U=a.movementY||(a.touches?a.touches[0].clientY-(j.startY||0):0);F(O=>({x:O.x+m/Ge,y:O.y+U/Ge})),a.touches&&y({...j,startX:a.touches[0].clientX,startY:a.touches[0].clientY})}},[$,b,g,S,W,n,r,i,K,ve]),Ie=u.useCallback(()=>{(g||S)&&(b?(C(te),Ne({...pe,structures:te})):M?pt(se):P?yt(le):q&&ft(ce)),W&&(c(ee),Ne({...pe,walls:ee})),p(!1),x(!1),T(null)},[g,S,W,b,M,P,q,te,ee,se,le,ce,C,c,pe,Ne]),js=u.useCallback(a=>{if(g||S||j)return;const{x:f,y:A}=Ae(a);if(K==="wall"){if(a.stopPropagation(),!ve)Ft({x:f,y:A});else{const m={id:Pe("wall"),x1:ve.x,y1:ve.y,x2:f,y2:A,stroke:"#52525B",strokeWidth:5};ht([...ee.filter(U=>U.id!=="preview"),m]),Ft(null)}return}if(K==="measure"){if(a.stopPropagation(),!ue)Rt({x:f,y:A});else{const m=tr(ue.x,ue.y,f,A),U={id:Pe("measure"),x1:ue.x,y1:ue.y,x2:f,y2:A,distance:it(m,Re,at)};$t(O=>[...O,U]),Rt(null),At(null)}return}if(K==="door"){a.stopPropagation();const m={id:Pe("door"),type:"door",x:f-15,y:A-30,width:30,height:60,subType:"single",direction:"left"};pt([...se,m]),h(m.id);return}if(K==="window"){a.stopPropagation();const m={id:Pe("window"),type:"window",x:f-20,y:A-30,width:40,height:60,subType:"standard"};yt([...le,m]),B(m.id);return}if(K==="furniture"){a.stopPropagation();const m={id:Pe("furniture"),type:"furniture",x:f-20,y:A-20,width:40,height:40,subType:"box",rotation:0};ft([...ce,m]),L(m.id);return}if(K==="text"){a.stopPropagation();const m={id:Pe("text"),type:"text",x:f,y:A,text:"Label",fontSize:14,color:"#000000"};Mt(U=>[...U,m]);return}if(K==="circle"){a.stopPropagation();const m={id:Pe("circle"),type:"circle",cx:f,cy:A,r:30,fill:"#3B82F6",stroke:"#1E40AF",strokeWidth:2};He(U=>[...U,m]);return}if(K==="polygon"){a.stopPropagation(),H.info("Polygon tool: Click points, double-click to finish");return}K==="select"&&!a.ctrlKey&&!a.metaKey&&(z(null),R(null),o(null),h(null),B(null),L(null),_(new Set),re(!1))},[K,ve,ue,g,S,j,ee,se,le,ce,Re,at]),ur=()=>{Lt(a=>Math.min(a*1.2,5))},hr=()=>{Lt(a=>Math.max(a/1.2,.1))},br=()=>{Lt(1),F({x:0,y:0})},ks=()=>{if(!w.current)return;const{blob:a}=Fa(w.current),f=URL.createObjectURL(a),A=document.createElement("a");A.href=f,A.download="floorplan.svg",A.click(),URL.revokeObjectURL(f),H.success("Floor plan exported as SVG")},vs=async()=>{if(w.current)try{const a=await Ra(w.current,qt,Ot,2),f=URL.createObjectURL(a),A=document.createElement("a");A.href=f,A.download="floorplan.png",A.click(),URL.revokeObjectURL(f),H.success("Floor plan exported as PNG")}catch(a){console.error("Export failed:",a),H.error("Failed to export PNG")}},Ns=async()=>{H.error("PDF export coming soon")},ws=a=>{var m;const f=(m=a.target.files)==null?void 0:m[0];if(!f)return;const A=new FileReader;A.onload=U=>{I(U.target.result),H.success("Background image loaded")},A.readAsDataURL(f)},Wt=a=>{cr(a),Ft(null),Rt(null),At(null),a==="structure"?ys():a==="room"?pr():a==="door"||a==="window"||a==="furniture"||ze(f=>f.filter(A=>A.id!=="preview"))},pr=(a=null)=>{const f=a||{name:`Room ${r.length+1}`,width:150,height:120,color:"#3B82F6"},A={id:Pe("room"),name:f.name,layout:{x:100,y:100,width:f.width,height:f.height,color:f.color}};[...r],i(A.id,A.layout),Ne({...pe})};u.useEffect(()=>(document.addEventListener("mousemove",Le),document.addEventListener("mouseup",Ie),document.addEventListener("touchmove",Le),document.addEventListener("touchend",Ie),()=>{document.removeEventListener("mousemove",Le),document.removeEventListener("mouseup",Ie),document.removeEventListener("touchmove",Le),document.removeEventListener("touchend",Ie)}),[Le,Ie]);const Ss=({wall:a})=>{const f=a.id==="preview",A=E===a.id;return t.jsxs("g",{onClick:m=>fs(m,a.id),cursor:"pointer",children:[t.jsx("line",{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,stroke:"transparent",strokeWidth:"15"}),t.jsx("line",{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,stroke:f?"#ef4444":A?"#3D84ED":a.stroke,strokeWidth:a.strokeWidth,strokeLinecap:"round",opacity:f?.7:1}),!f&&t.jsxs(t.Fragment,{children:[t.jsx("circle",{cx:a.x1,cy:a.y1,r:6,fill:"white",stroke:"#52525B",strokeWidth:"2",className:"cursor-move hover:fill-brand-blue",onMouseDown:m=>mr(m,a.id,"start")}),t.jsx("circle",{cx:a.x2,cy:a.y2,r:6,fill:"white",stroke:"#52525B",strokeWidth:"2",className:"cursor-move hover:fill-brand-blue",onMouseDown:m=>mr(m,a.id,"end")})]})]})},yr=({data:a,isStructure:f=!1,onClick:A})=>{const{layout:m,name:U,rate:O,label:lt}=a,fe=f?b===a.id:$===a.id,Nt=m.width&&m.height?rr(m.width,m.height,Re):null,he=(Z,Ts)=>ee.some(wt=>Wa(Z,Ts,wt.x1,wt.y1,wt.x2,wt.y2)<12),Ht=he(m.x,m.y),Pr=he(m.x+m.width,m.y),Mr=he(m.x+m.width,m.y+m.height),$r=he(m.x,m.y+m.height),we=8,Es=[`M ${m.x+(Ht?0:we)} ${m.y}`,`L ${m.x+m.width-(Pr?0:we)} ${m.y}`,`Q ${m.x+m.width} ${m.y} ${m.x+m.width} ${m.y+(Pr?0:we)}`,`L ${m.x+m.width} ${m.y+m.height-(Mr?0:we)}`,`Q ${m.x+m.width} ${m.y+m.height} ${m.x+m.width-(Mr?0:we)} ${m.y+m.height}`,`L ${m.x+($r?0:we)} ${m.y+m.height}`,`Q ${m.x} ${m.y+m.height} ${m.x} ${m.y+m.height-($r?0:we)}`,`L ${m.x} ${m.y+(Ht?0:we)}`,`Q ${m.x} ${m.y} ${m.x+(Ht?0:we)} ${m.y}`,"Z"].join(" ");return t.jsxs("g",{onClick:Z=>{Z.stopPropagation(),A(a,Z)},cursor:"pointer",style:{filter:fe?`drop-shadow(0 0 5px ${m.color})`:"none"},pointerEvents:K!=="select"?"none":"auto",children:[t.jsx("path",{d:Es,fill:m.color,opacity:f?"0.5":"0.8",stroke:m.color,strokeWidth:"4",strokeDasharray:f?"5,5":"0",onMouseDown:Z=>f?gr(Z,a):xr(Z,a),onTouchStart:Z=>f?gr(Z,a):xr(Z,a),style:{cursor:S?"default":"grab"}}),t.jsxs("text",{x:m.x+m.width/2,y:m.y+m.height/2,fill:"white",textAnchor:"middle",dominantBaseline:"middle",style:{pointerEvents:"none",userSelect:"none"},children:[t.jsx("tspan",{x:m.x+m.width/2,dy:"-0.5em",fontWeight:"bold",fontSize:"14",children:f?lt||"Area":U}),!f&&O&&t.jsxs("tspan",{x:m.x+m.width/2,dy:"1.2em",fontSize:"12",children:["$",O,"/hr"]}),Nt&&t.jsxs("tspan",{x:m.x+m.width/2,dy:"1.2em",fontSize:"10",opacity:"0.8",children:[Nt.sqft.toFixed(0)," sq ft"]})]}),!f&&a.panorama360Url&&t.jsxs("g",{transform:`translate(${m.x+m.width-20}, ${m.y+5})`,children:[t.jsx("circle",{cx:"0",cy:"0",r:"8",fill:"#10B981",opacity:"0.9"}),t.jsx("text",{x:"0",y:"3",fontSize:"8",fill:"white",textAnchor:"middle",style:{pointerEvents:"none"},children:"360"})]}),fe&&t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:m.x-5,y:m.y-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"nwse-resize",onMouseDown:Z=>f?Te(Z,a,"tl"):Ee(Z,a,"tl")}),t.jsx("rect",{x:m.x+m.width-5,y:m.y-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"nesw-resize",onMouseDown:Z=>f?Te(Z,a,"tr"):Ee(Z,a,"tr")}),t.jsx("rect",{x:m.x+m.width-5,y:m.y+m.height-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"nwse-resize",onMouseDown:Z=>f?Te(Z,a,"br"):Ee(Z,a,"br")}),t.jsx("rect",{x:m.x-5,y:m.y+m.height-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"nesw-resize",onMouseDown:Z=>f?Te(Z,a,"bl"):Ee(Z,a,"bl")}),t.jsx("rect",{x:m.x+m.width/2-5,y:m.y-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"ns-resize",onMouseDown:Z=>f?Te(Z,a,"t"):Ee(Z,a,"t")}),t.jsx("rect",{x:m.x+m.width-5,y:m.y+m.height/2-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"ew-resize",onMouseDown:Z=>f?Te(Z,a,"r"):Ee(Z,a,"r")}),t.jsx("rect",{x:m.x+m.width/2-5,y:m.y+m.height-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"ns-resize",onMouseDown:Z=>f?Te(Z,a,"b"):Ee(Z,a,"b")}),t.jsx("rect",{x:m.x-5,y:m.y+m.height/2-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"ew-resize",onMouseDown:Z=>f?Te(Z,a,"l"):Ee(Z,a,"l")})]})]})},ye=()=>$?r.find(a=>a.id===$):b?te.find(a=>a.id===b):E?ee.find(a=>a.id===E):M?se.find(a=>a.id===M):P?le.find(a=>a.id===P):q?ce.find(a=>a.id===q):null,fr=a=>{const f=ye();if(f)if($){const A={...f,...a};i($,A.layout||f.layout)}else b?bt(te.map(A=>A.id===b?{...A,...a}:A)):E?ht(ee.map(A=>A.id===E?{...A,...a}:A)):M?pt(se.map(A=>A.id===M?{...A,...a}:A)):P?yt(le.map(A=>A.id===P?{...A,...a}:A)):q&&ft(ce.map(A=>A.id===q?{...A,...a}:A))},Cs=a=>{st(f=>{var A;return{...f,[a]:{...f[a],visible:!((A=f[a])!=null&&A.visible)}}})},_s=a=>{st(f=>{var A;return{...f,[a]:{...f[a],locked:!((A=f[a])!=null&&A.locked)}}})},zs=a=>{const f=ye();if(f)switch(a){case"copy":Je();break;case"paste":jt();break;case"cut":kt();break;case"delete":Ye();break;case"rotate":if(f.layout||f.x!==void 0){const A=f.rotation||0;fr({rotation:(A+90)%360})}break}};return t.jsxs("div",{className:"flex h-[650px]",children:[t.jsx(Ta,{activeTool:K,setActiveTool:Wt,onUndo:Bt,onRedo:Ut,canUndo:hs,canRedo:bs,onZoomIn:ur,onZoomOut:hr,onFitToView:br,onExportSVG:ks,onExportPNG:vs,onExportPDF:Ns,showGrid:It,toggleGrid:()=>xs(!It),measurementUnit:at,setMeasurementUnit:ms,scale:Re,setScale:gs,onBackgroundImageUpload:ws,onAddRoomTemplate:a=>pr(a)}),t.jsxs("div",{className:"flex flex-col flex-1",children:[t.jsxs("div",{className:"p-3 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36] rounded-t-xl",children:[t.jsxs("div",{className:"flex gap-4 text-sm text-gray-500 font-medium",children:[t.jsxs("button",{onClick:Je,disabled:!b&&!E&&!M&&!P&&!q,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[t.jsx(De,{size:14})," Copy"]}),t.jsxs("button",{onClick:jt,disabled:!V,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[t.jsx(Kr,{size:14})," Paste"]}),t.jsxs("button",{onClick:kt,disabled:!b&&!E&&!M&&!P&&!q,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[t.jsx(Zr,{size:14})," Cut"]}),t.jsxs("button",{onClick:Ye,disabled:!b&&!E&&!M&&!P&&!q,className:"hover:text-red-500 disabled:opacity-50 flex items-center gap-1",children:[t.jsx(oe,{size:14})," Delete"]})]}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsxs("span",{className:"text-xs text-gray-500",children:["Zoom: ",(Ge*100).toFixed(0),"%"]}),t.jsxs("button",{className:`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${K==="structure"?"bg-purple-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200"}`,onClick:()=>Wt("structure"),children:[t.jsx(Hs,{size:16})," Add Area"]}),t.jsxs("button",{className:`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${K==="wall"?"bg-red-500 text-white shadow-lg":"bg-brand-blue text-white hover:bg-blue-600"}`,onClick:()=>Wt(K==="wall"?"select":"wall"),children:[t.jsx(Gs,{size:16})," ",K==="wall"?ve?"Finish":"Wall":"Add Wall"]})]})]}),t.jsx("div",{ref:N,className:"flex-1 overflow-hidden bg-gray-50 dark:bg-[#1f2128] rounded-b-xl border-x border-b dark:border-gray-700 relative",style:{cursor:K==="wall"||K==="measure"?"crosshair":j?"grabbing":"default"},tabIndex:0,onMouseDown:ps,onMouseUp:vt,onMouseLeave:vt,onContextMenu:a=>{a.preventDefault(),ye()&&me({x:a.clientX,y:a.clientY})},children:t.jsxs("svg",{ref:w,width:qt,height:Ot,className:"w-full h-full shadow-inner focus:outline-none",viewBox:`${ut.x} ${ut.y} ${ut.width} ${ut.height}`,style:{transform:`scale(${Ge})`,transformOrigin:"top left"},onMouseMove:Le,onMouseUp:a=>{Ie(),vt()},onTouchMove:Le,onTouchEnd:a=>{Ie(),vt()},onClick:js,children:[mt&&t.jsx("image",{href:mt,x:0,y:0,width:qt,height:Ot,opacity:"0.3"}),It&&t.jsxs(t.Fragment,{children:[t.jsx("pattern",{id:"smallGrid",width:Ve,height:Ve,patternUnits:"userSpaceOnUse",children:t.jsx("path",{d:`M ${Ve} 0 L 0 0 0 ${Ve}`,fill:"none",stroke:"#e5e7eb",strokeWidth:"0.5"})}),t.jsx("rect",{width:"100%",height:"100%",fill:"url(#smallGrid)"})]}),((jr=ie.structures)==null?void 0:jr.visible)!==!1&&te.map(a=>t.jsx(yr,{data:a,isStructure:!0,onClick:f=>{R(f.id),re(!0),z(null),o(null),h(null),B(null),L(null)}},a.id)),((kr=ie.rooms)==null?void 0:kr.visible)!==!1&&r.map(a=>t.jsx(yr,{data:a,onClick:f=>{f.panorama360Url&&(e!=null&&e.ctrlKey||e!=null&&e.metaKey)?G(f):(z(f.id),re(!0),R(null),o(null),h(null),B(null),L(null),l(r.findIndex(A=>A.id===f.id)))}},a.id)),((vr=ie.walls)==null?void 0:vr.visible)!==!1&&ee.map(a=>t.jsx(Ss,{wall:a},a.id)),((Nr=ie.doors)==null?void 0:Nr.visible)!==!1&&se.map(a=>t.jsx(Ba,{door:a,isSelected:M===a.id,onClick:()=>{h(a.id),re(!0),z(null),R(null),o(null),B(null),L(null)},onMouseDown:f=>{if(K==="select"){f.preventDefault(),h(a.id),p(!0);const{x:A,y:m}=Ae(f);k({x:A-a.x,y:m-a.y})}}},a.id)),((wr=ie.windows)==null?void 0:wr.visible)!==!1&&le.map(a=>t.jsx(Ua,{window:a,isSelected:P===a.id,onClick:()=>{B(a.id),re(!0),z(null),R(null),o(null),h(null),L(null)},onMouseDown:f=>{if(K==="select"){f.preventDefault(),B(a.id),p(!0);const{x:A,y:m}=Ae(f);k({x:A-a.x,y:m-a.y})}}},a.id)),((Sr=ie.furniture)==null?void 0:Sr.visible)!==!1&&ce.map(a=>t.jsx(qa,{furniture:a,isSelected:q===a.id,onClick:()=>{L(a.id),re(!0),z(null),R(null),o(null),h(null),B(null)},onMouseDown:f=>{if(K==="select"){f.preventDefault(),L(a.id),p(!0);const{x:A,y:m}=Ae(f);k({x:A-a.x,y:m-a.y})}}},a.id)),((Cr=ie.text)==null?void 0:Cr.visible)!==!1&&tt.map(a=>t.jsxs("g",{children:[t.jsx("text",{x:a.x,y:a.y,fontSize:a.fontSize||14,fill:a.color||"#000",fontWeight:a.bold?"bold":"normal",className:"cursor-pointer",onClick:()=>{},children:a.text}),a.selected&&t.jsx("rect",{x:a.x-5,y:a.y-a.fontSize-5,width:a.text.length*(a.fontSize*.6)+10,height:a.fontSize+10,fill:"none",stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"})]},a.id)),((_r=ie.shapes)==null?void 0:_r.visible)!==!1&&ae.map(a=>a.type==="circle"?t.jsx("circle",{cx:a.cx,cy:a.cy,r:a.r,fill:a.fill,stroke:a.stroke,strokeWidth:a.strokeWidth,className:"cursor-pointer",onClick:()=>{}},a.id):a.type==="polygon"?t.jsx("polygon",{points:a.points.map(f=>`${f.x},${f.y}`).join(" "),fill:a.fill,stroke:a.stroke,strokeWidth:a.strokeWidth,className:"cursor-pointer"},a.id):null),((zr=ie.measurements)==null?void 0:zr.visible)!==!1&&rt.map(a=>t.jsxs("g",{children:[t.jsx("line",{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"}),t.jsx("circle",{cx:a.x1,cy:a.y1,r:4,fill:"#3D84ED"}),t.jsx("circle",{cx:a.x2,cy:a.y2,r:4,fill:"#3D84ED"}),t.jsx("text",{x:(a.x1+a.x2)/2,y:(a.y1+a.y2)/2-5,fontSize:"12",fill:"#3D84ED",textAnchor:"middle",className:"pointer-events-none",children:a.distance})]},a.id)),ne&&t.jsxs("g",{children:[t.jsx("line",{x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"}),t.jsx("circle",{cx:ne.x1,cy:ne.y1,r:4,fill:"#3D84ED"}),t.jsx("circle",{cx:ne.x2,cy:ne.y2,r:4,fill:"#3D84ED"}),t.jsx("text",{x:(ne.x1+ne.x2)/2,y:(ne.y1+ne.y2)/2-5,fontSize:"12",fill:"#3D84ED",textAnchor:"middle",className:"pointer-events-none",children:ne.distance})]}),t.jsxs("g",{className:"pointer-events-none",children:[t.jsxs("text",{x:"10",y:"20",fontSize:"10",fill:"#9CA3AF",children:["Grid: ",Ve,"px | ",ee.length," Walls | ",r.length," Rooms"]}),t.jsx("text",{x:"10",y:"35",fontSize:"10",fill:"#9CA3AF",children:"Ctrl+Click room with 360° icon to view | Space+Drag to pan"}),$&&(()=>{const a=r.find(f=>f.id===$);if(a&&a.layout){const f=rr(a.layout.width,a.layout.height,Re);return t.jsxs("text",{x:"10",y:"50",fontSize:"10",fill:"#9CA3AF",children:["Area: ",f.display]})}return null})()]})]})}),J&&t.jsx("div",{className:"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:t.jsx("div",{className:"w-full max-w-4xl",children:t.jsx(cs,{imageUrl:J.panorama360Url,title:J.name||"Room View",onClose:()=>G(null)})})}),Q&&t.jsx(La,{x:Q.x,y:Q.y,onClose:()=>me(null),onAction:zs,canCopy:!!ye(),canPaste:!!V,canCut:!!ye(),canDelete:!!ye(),canRotate:!!((Er=ye())!=null&&Er.layout),canFlip:!!((Tr=ye())!=null&&Tr.layout),isLocked:!1}),_e&&ye()&&t.jsx(Aa,{selectedItem:ye(),onClose:()=>re(!1),onUpdate:fr,scale:Re,unit:at}),t.jsx(Ia,{layers:ie,onLayerToggle:Cs,onLayerLock:_s})]})]})}function Ga({user:r,userData:s,onUpdate:d}){const{t:l}=pa(),[i,c]=u.useState((s==null?void 0:s.rooms)||[]),[C,w]=u.useState((s==null?void 0:s.floorplanWalls)||[]),[N,g]=u.useState((s==null?void 0:s.floorplanStructures)||[]),[p,S]=u.useState(null),[x,n]=u.useState(!1),[k,j]=u.useState(!1),[y,v]=u.useState(null),[F,$]=u.useState("list"),z={name:"",description:"",rate:50,capacity:4,equipment:[],amenities:[],minBookingHours:1,active:!0,color:"#3B82F6",panorama360Url:null},b=async(T,J=C,G=N)=>{j(!0);const Q=H.loading("Saving rooms..."),me=(s==null?void 0:s.id)||(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const _e=await fetch(`/api/studio-ops/profiles/${me}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rooms:T,floorplanWalls:J,floorplanStructures:G})}),re=await _e.json();if(!_e.ok)throw new Error(re.error||"Failed to save");c(T),w(J),g(G),H.success("Rooms saved!",{id:Q}),d&&d({rooms:T,floorplanWalls:J,floorplanStructures:G})}catch(_e){console.error("Save failed:",_e),H.error("Failed to save",{id:Q})}finally{j(!1)}},R=(T,J)=>{const G=i.map(Q=>Q.id===T?{...Q,layout:J}:Q);c(G)},E=async T=>{w(T);const J=(s==null?void 0:s.id)||(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const G=await fetch(`/api/studio-ops/profiles/${J}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({floorplanWalls:T})});if(!G.ok){const Q=await G.json();throw new Error(Q.error||"Failed to save walls")}}catch(G){console.error("Error saving walls:",G)}},o=async T=>{g(T);const J=(s==null?void 0:s.id)||(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const G=await fetch(`/api/studio-ops/profiles/${J}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({floorplanStructures:T})});if(!G.ok){const Q=await G.json();throw new Error(Q.error||"Failed to save structures")}}catch(G){console.error("Error saving structures:",G)}},M=T=>{T>=0&&T<i.length&&P(T)},h=()=>{S({...z,name:`Room ${i.length+1}`}),n(!0)},P=T=>{S({...i[T]}),n(!1),v(T)},B=async()=>{if(!p.name.trim()){H.error("Room name is required");return}let T;x?T=[...i,p]:T=i.map((J,G)=>G===y?p:J),await b(T),S(null),n(!1),v(null)},q=async T=>{if(!confirm(`Delete "${i[T].name}"? This cannot be undone.`))return;const J=i.filter((G,Q)=>Q!==T);await b(J)},L=async T=>{const J={...i[T],name:`${i[T].name} (Copy)`},G=[...i,J];await b(G)},Y=()=>{S(null),n(!1),v(null)},_=["Isolation Booth","Live Room","Control Room","Lounge Area","Private Bathroom","Natural Light","Blackout Curtains","Video Feed","Climate Control","Sound Lock"],W=i.map((T,J)=>({...T,id:T.id||`room_${J}`,layout:T.layout||{x:50+J%3*200,y:50+Math.floor(J/3)*150,width:180,height:120,color:T.color||"#3B82F6"}}));return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Xt,{className:"text-brand-blue",size:24}),"Room Management"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Configure your studio rooms, rates, and equipment"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:[t.jsxs("button",{onClick:()=>$("list"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${F==="list"?"bg-white dark:bg-gray-700 shadow text-brand-blue":"text-gray-600 dark:text-gray-400"}`,children:[t.jsx(Vs,{size:16})," List"]}),t.jsxs("button",{onClick:()=>$("floorplan"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${F==="floorplan"?"bg-white dark:bg-gray-700 shadow text-brand-blue":"text-gray-600 dark:text-gray-400"}`,children:[t.jsx(Ys,{size:16})," Floorplan"]})]}),t.jsxs("button",{onClick:h,disabled:x||p,className:"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[t.jsx(ge,{size:18})," Add Room"]})]})]}),x&&p&&t.jsx(Wr,{room:p,setRoom:S,onSave:B,onCancel:Y,saving:k,isNew:!0,roomAmenities:_,user:r}),F==="floorplan"&&!x&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsx(Ha,{rooms:W,walls:C,structures:N,onRoomClick:M,onLayoutChange:R,onWallsChange:E,onStructuresChange:o}),t.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-[#23262f] border-t dark:border-gray-700 text-xs text-gray-500",children:[t.jsx("strong",{children:"Tips:"})," Click a room to edit • Drag to reposition • Use corner handles to resize • Add walls to define boundaries"]})]}),F==="list"&&t.jsx("div",{className:"space-y-4",children:i.length===0&&!x?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center",children:[t.jsx(Xt,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),t.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Rooms Yet"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-sm mx-auto",children:"Add your first room to start accepting bookings"}),t.jsx("button",{onClick:h,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition",children:"Add Your First Room"})]}):i.map((T,J)=>t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm",children:[t.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-[#23262f] transition",onClick:()=>v(y===J?null:J),children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:T.color||"#3B82F6"},children:T.name.charAt(0)}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"font-bold dark:text-white",children:T.name}),T.active===!1&&t.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-0.5 rounded",children:"Inactive"})]}),t.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mt-1",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(qe,{size:14}),"$",T.rate,"/hr"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(ke,{size:14}),T.capacity," people"]}),T.equipment&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(ts,{size:14}),Array.isArray(T.equipment)?T.equipment.reduce((G,Q)=>G+(Q.quantity||1),0):T.equipment.split(",").length," items"]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:G=>{G.stopPropagation(),L(J)},className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Duplicate",children:t.jsx(De,{size:16})}),t.jsx("button",{onClick:G=>{G.stopPropagation(),P(J)},className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit",children:t.jsx(We,{size:16})}),t.jsx("button",{onClick:G=>{G.stopPropagation(),q(J)},className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete",children:t.jsx(oe,{size:16})}),y===J?t.jsx(rs,{size:20}):t.jsx(ss,{size:20})]})]}),y===J&&p&&t.jsx("div",{className:"border-t dark:border-gray-700",children:t.jsx(Wr,{room:p,setRoom:S,onSave:B,onCancel:Y,saving:k,isNew:!1,roomAmenities:_,user:r})}),y===J&&!p&&t.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#1f2128]",children:[T.description&&t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:T.description}),T.equipment&&t.jsx("div",{className:"flex flex-wrap gap-2",children:Array.isArray(T.equipment)?T.equipment.map((G,Q)=>t.jsxs("span",{className:"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded",children:[G.brand&&`${G.brand} `,G.name||G.model,G.quantity&&G.quantity>1&&` (×${G.quantity})`]},Q)):T.equipment.split(",").map((G,Q)=>t.jsx("span",{className:"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded",children:G.trim()},Q))})]})]},J))})]})}function Wr({room:r,setRoom:s,onSave:d,onCancel:l,saving:i,isNew:c,roomAmenities:C,user:w}){const{uploadImage:N,uploading:g}=ya(),[p,S]=u.useState(!1),x=u.useRef(null),n=y=>{const v=r.amenities||[];v.includes(y)?s({...r,amenities:v.filter(F=>F!==y)}):s({...r,amenities:[...v,y]})},k=async y=>{var R;const v=(R=y.target.files)==null?void 0:R[0];if(!v)return;if(!["image/jpeg","image/jpg","image/png"].includes(v.type)){H.error("Please upload a JPEG or PNG image");return}if(v.size>20*1024*1024){H.error("Image size must be less than 20MB");return}const z=`studio-rooms/${(w==null?void 0:w.id)||(w==null?void 0:w.uid)||"temp"}/360-images`,b=H.loading("Uploading 360° image...");try{const E=await N(v,z);E?(s({...r,panorama360Url:E}),H.success("360° image uploaded successfully!",{id:b})):H.error("Upload failed",{id:b})}catch(E){console.error("360 image upload error:",E),H.error("Failed to upload image",{id:b})}},j=()=>{s({...r,panorama360Url:null})};return t.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-[#1f2128] space-y-5",children:[c&&t.jsx("h3",{className:"font-bold dark:text-white text-lg mb-4",children:"Add New Room"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Room Name *"}),t.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:r.name,onChange:y=>s({...r,name:y.target.value}),placeholder:"e.g. Studio A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Room Color"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"color",className:"w-12 h-12 rounded-lg border dark:border-gray-600 cursor-pointer",value:r.color||"#3B82F6",onChange:y=>s({...r,color:y.target.value})}),t.jsx("input",{className:"flex-1 p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:r.color||"#3B82F6",onChange:y=>s({...r,color:y.target.value}),placeholder:"#3B82F6"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Description"}),t.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",rows:2,value:r.description||"",onChange:y=>s({...r,description:y.target.value}),placeholder:"Describe this room, its vibe, and what makes it special..."})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hourly Rate ($)"}),t.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:r.rate,onChange:y=>s({...r,rate:parseInt(y.target.value)||0}),min:0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Capacity"}),t.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:r.capacity,onChange:y=>s({...r,capacity:parseInt(y.target.value)||1}),min:1})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Hours"}),t.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:r.minBookingHours||1,onChange:y=>s({...r,minBookingHours:parseInt(y.target.value)||1}),min:1})]}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl cursor-pointer w-full",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 text-brand-blue",checked:r.active!==!1,onChange:y=>s({...r,active:y.target.checked})}),t.jsx("span",{className:"text-sm font-medium dark:text-white",children:"Active"})]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Equipment"}),t.jsx(Va,{equipment:Array.isArray(r.equipment)?r.equipment:r.equipment?r.equipment.split(",").map(y=>({name:y.trim(),brand:"",model:"",quantity:1})):[],onChange:y=>s({...r,equipment:y})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Room Features"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(y=>t.jsx("button",{type:"button",onClick:()=>n(y),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all border ${(r.amenities||[]).includes(y)?"bg-brand-blue text-white border-brand-blue":"bg-white dark:bg-[#2c2e36] text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-brand-blue"}`,children:y},y))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"360° Panorama Image"}),t.jsx("div",{className:"space-y-3",children:r.panorama360Url?t.jsxs("div",{className:"relative",children:[t.jsx(cs,{imageUrl:r.panorama360Url,title:r.name||"Room View"}),t.jsx("button",{type:"button",onClick:j,className:"absolute top-3 right-3 p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg shadow-lg transition z-20",title:"Remove 360° image",children:t.jsx(D,{size:18})})]}):t.jsxs("div",{className:"border-2 border-dashed dark:border-gray-600 rounded-xl p-8 text-center bg-white dark:bg-[#2c2e36]",children:[t.jsx(Ue,{size:48,className:"mx-auto mb-3 text-gray-400"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Upload a 360° equirectangular panorama image"}),t.jsx("input",{ref:x,type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:k,className:"hidden"}),t.jsx("button",{type:"button",onClick:()=>{var y;return(y=x.current)==null?void 0:y.click()},disabled:g,className:"px-4 py-2 bg-brand-blue text-white rounded-lg font-medium hover:bg-blue-600 transition flex items-center gap-2 mx-auto disabled:opacity-50",children:g?t.jsxs(t.Fragment,{children:[t.jsx(be,{className:"animate-spin",size:18}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(nr,{size:18}),"Upload 360° Image"]})}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:"Supports JPEG/PNG • Max 20MB • Equirectangular format recommended"})]})})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[t.jsx("button",{onClick:l,className:"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl font-medium transition",children:"Cancel"}),t.jsxs("button",{onClick:d,disabled:i,className:"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[i?t.jsx(be,{className:"animate-spin",size:18}):t.jsx(Ce,{size:18}),c?"Add Room":"Save Changes"]})]})]})}function Va({equipment:r,onChange:s}){const[d,l]=u.useState(null),[i,c]=u.useState(1),C=g=>{if(!g||!g.name)return;const p={name:g.name,brand:g.brand||"",model:g.model||g.name,quantity:i||1};s([...r||[],p]),l(null),c(1)},w=g=>{const p=r.filter((S,x)=>x!==g);s(p)},N=(g,p)=>{const S=r.map((x,n)=>n===g?{...x,quantity:Math.max(1,parseInt(p)||1)}:x);s(S)};return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(ds,{onSelect:g=>{l(g),c(1)},placeholder:"Search and add equipment..."})}),d&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",min:"1",value:i,onChange:g=>c(parseInt(g.target.value)||1),className:"w-20 p-2 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white text-sm",placeholder:"Qty"}),t.jsxs("button",{type:"button",onClick:()=>C(d),className:"px-4 py-2 bg-brand-blue text-white rounded-xl font-medium hover:bg-blue-600 transition flex items-center gap-1",children:[t.jsx(ge,{size:16})," Add"]})]})]}),r&&r.length>0&&t.jsx("div",{className:"space-y-2",children:r.map((g,p)=>t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg border dark:border-gray-700",children:[t.jsx("div",{className:"flex-1 min-w-0",children:t.jsxs("div",{className:"font-medium text-sm dark:text-white",children:[g.brand&&t.jsxs("span",{className:"text-gray-500",children:[g.brand," "]}),g.name||g.model]})}),t.jsx("input",{type:"number",min:"1",value:g.quantity||1,onChange:S=>N(p,S.target.value),className:"w-16 p-1.5 border rounded-lg dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white text-sm text-center"}),t.jsx("button",{type:"button",onClick:()=>w(p),className:"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:t.jsx(D,{size:16})})]},p))})]})}function Ya({user:r,userData:s,onUpdate:d}){const[l,i]=u.useState((s==null?void 0:s.studioPhotos)||[]),[c,C]=u.useState(0),[w,N]=u.useState(null),[g,p]=u.useState(null),{uploadMedia:S,uploading:x}=or(),n=(r==null?void 0:r.id)||(r==null?void 0:r.uid),k=u.useCallback(async E=>{try{const o=await fetch(`/api/studio-ops/profiles/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({studioPhotos:E})}),M=await o.json();if(!o.ok)throw new Error(M.error||"Failed to save");return i(E),d&&d({studioPhotos:E}),!0}catch(o){return console.error("Save failed:",o),H.error("Failed to save photos"),!1}},[n,d]),j=u.useCallback(async E=>{if(!E||E.length===0)return;const o=12;if(l.length>=o){H.error(`Maximum ${o} photos allowed`);return}const M=H.loading("Uploading photos..."),h=[];for(const P of Array.from(E).slice(0,o-l.length)){if(!P.type.startsWith("image/")){H.error(`${P.name} is not an image`);continue}if(P.size>5*1024*1024){H.error(`${P.name} is too large (max 5MB)`);continue}try{const B=Date.now(),q=await S(P,`studio/gallery/${n}`);q!=null&&q.url&&h.push({id:B.toString(),url:q.url,path:q.storageRef||`studio/gallery/${n}/${B}_${P.name}`,filename:P.name,caption:"",isCover:l.length===0&&h.length===0,uploadedAt:new Date().toISOString()})}catch(B){console.error("Upload error:",B),H.error(`Failed to upload ${P.name}`)}}h.length>0?await k([...l,...h])&&H.success(`${h.length} photo(s) uploaded!`,{id:M}):H.dismiss(M),C(0)},[l,n,k,S]),y=async E=>{const o=l[E];if(!confirm("Delete this photo?"))return;const M=H.loading("Deleting...");try{let h=l.filter((P,B)=>B!==E);o.isCover&&h.length>0&&(h=h.map((P,B)=>({...P,isCover:B===0}))),await k(h),H.success("Photo deleted",{id:M})}catch(h){console.error("Delete error:",h),H.error("Failed to delete photo",{id:M})}},v=async E=>{const o=l.map((M,h)=>({...M,isCover:h===E}));await k(o),H.success("Cover photo updated")},F=E=>{p(E)},$=(E,o)=>{if(E.preventDefault(),g===null||g===o)return;const M=[...l],[h]=M.splice(g,1);M.splice(o,0,h),i(M),p(o)},z=async()=>{g!==null&&(await k(l),p(null))},b=E=>{var M;E.preventDefault();const o=(M=E.dataTransfer)==null?void 0:M.files;o&&j(o)},R=l.find(E=>E.isCover)||l[0];return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Ue,{className:"text-brand-blue",size:24}),"Photo Gallery"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Showcase your studio with up to 12 photos"})]}),t.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[l.length,"/12 photos"]})]}),R&&t.jsxs("div",{className:"relative rounded-xl overflow-hidden aspect-video bg-gray-100 dark:bg-gray-800 group",children:[t.jsx("img",{src:R.url,alt:"Cover",className:"w-full h-full object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("div",{className:"absolute bottom-4 left-4 text-white",children:t.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[t.jsx(Xe,{size:16,className:"fill-yellow-400 text-yellow-400"}),"Cover Photo"]})})})]}),t.jsx("div",{className:`border-2 border-dashed rounded-xl p-8 text-center transition-all ${x?"border-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-brand-blue hover:bg-blue-50/50 dark:hover:bg-blue-900/10"}`,onDrop:b,onDragOver:E=>E.preventDefault(),children:x?t.jsxs("div",{className:"space-y-3",children:[t.jsx(be,{className:"mx-auto animate-spin text-brand-blue",size:40}),t.jsx("div",{className:"w-full max-w-xs mx-auto bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"bg-brand-blue h-2 rounded-full transition-all duration-300",style:{width:`${c}%`}})}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Uploading... ",Math.round(c),"%"]})]}):t.jsxs(t.Fragment,{children:[t.jsx(nr,{className:"mx-auto text-gray-400 mb-3",size:40}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Drag & drop images here, or"}),t.jsxs("label",{className:"cursor-pointer",children:[t.jsx("span",{className:"text-brand-blue font-bold hover:underline",children:"browse files"}),t.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:E=>j(E.target.files),disabled:x})]}),t.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"JPG, PNG or WebP. Max 5MB per file."})]})}),l.length>0&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[l.map((E,o)=>t.jsxs("div",{draggable:!0,onDragStart:()=>F(o),onDragOver:M=>$(M,o),onDragEnd:z,className:`relative aspect-square rounded-xl overflow-hidden group bg-gray-100 dark:bg-gray-800 cursor-move ${g===o?"opacity-50 ring-2 ring-brand-blue":""}`,children:[t.jsx("img",{src:E.url,alt:E.caption||`Studio photo ${o+1}`,className:"w-full h-full object-cover"}),E.isCover&&t.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-lg flex items-center gap-1",children:[t.jsx(Xe,{size:12,className:"fill-white"})," Cover"]}),t.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[t.jsx("button",{onClick:()=>N(E),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition",title:"View",children:t.jsx(lr,{size:18})}),!E.isCover&&t.jsx("button",{onClick:()=>v(o),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition",title:"Set as cover",children:t.jsx(Xe,{size:18})}),t.jsx("button",{onClick:()=>y(o),className:"p-2 bg-red-500/80 hover:bg-red-500 rounded-lg text-white transition",title:"Delete",children:t.jsx(oe,{size:18})})]}),t.jsx("div",{className:"absolute top-2 right-2 p-1 bg-black/40 rounded text-white opacity-0 group-hover:opacity-100 transition",children:t.jsx(Jr,{size:14})})]},E.id)),l.length<12&&t.jsxs("label",{className:"aspect-square rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700 hover:border-brand-blue transition cursor-pointer flex flex-col items-center justify-center text-gray-400 hover:text-brand-blue",children:[t.jsx(ge,{size:32}),t.jsx("span",{className:"text-xs mt-1",children:"Add Photo"}),t.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:E=>j(E.target.files),disabled:x})]})]}),l.length===0&&!x&&t.jsxs("div",{className:"text-center py-8 text-gray-400",children:[t.jsx(Ue,{size:48,className:"mx-auto mb-3 opacity-30"}),t.jsx("p",{children:"No photos uploaded yet"}),t.jsx("p",{className:"text-sm",children:"Add photos to attract more clients"})]}),w&&t.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>N(null),children:[t.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition",onClick:()=>N(null),children:t.jsx(D,{size:32})}),t.jsx("img",{src:w.url,alt:w.caption||"Studio photo",className:"max-w-full max-h-[90vh] object-contain rounded-lg",onClick:E=>E.stopPropagation()}),w.caption&&t.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black/70 text-white px-6 py-3 rounded-xl",children:w.caption})]})]})}const Vt=[{id:"sunday",label:"Sunday",short:"Sun"},{id:"monday",label:"Monday",short:"Mon"},{id:"tuesday",label:"Tuesday",short:"Tue"},{id:"wednesday",label:"Wednesday",short:"Wed"},{id:"thursday",label:"Thursday",short:"Thu"},{id:"friday",label:"Friday",short:"Fri"},{id:"saturday",label:"Saturday",short:"Sat"}],Ja={sunday:{closed:!0,open:"10:00",close:"18:00"},monday:{closed:!1,open:"09:00",close:"22:00"},tuesday:{closed:!1,open:"09:00",close:"22:00"},wednesday:{closed:!1,open:"09:00",close:"22:00"},thursday:{closed:!1,open:"09:00",close:"22:00"},friday:{closed:!1,open:"09:00",close:"23:00"},saturday:{closed:!1,open:"10:00",close:"23:00"}};function Xa({user:r,userData:s,onUpdate:d}){const[l,i]=u.useState((s==null?void 0:s.operatingHours)||Ja),[c,C]=u.useState((s==null?void 0:s.blackoutDates)||[]),[w,N]=u.useState(!1),[g,p]=u.useState({start:"",end:"",reason:""}),[S,x]=u.useState(!1),n=async()=>{N(!0);const b=H.loading("Saving availability..."),R=(s==null?void 0:s.id)||(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const E=await fetch(`/api/studio-ops/profiles/${R}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({operatingHours:l,blackoutDates:c})}),o=await E.json();if(!E.ok)throw new Error(o.error||"Failed to save");H.success("Availability saved!",{id:b}),d&&d({operatingHours:l,blackoutDates:c})}catch(E){console.error("Save failed:",E),H.error("Failed to save",{id:b})}finally{N(!1)}},k=(b,R,E)=>{i(o=>({...o,[b]:{...o[b],[R]:E}}))},j=b=>{i(R=>{var E;return{...R,[b]:{...R[b],closed:!((E=R[b])!=null&&E.closed)}}})},y=b=>{const R=l[b],E=["monday","tuesday","wednesday","thursday","friday"];i(o=>{const M={...o};return E.forEach(h=>{M[h]={...R}}),M}),H.success("Copied to all weekdays")},v=()=>{if(!g.start){H.error("Start date is required");return}const b={id:Date.now().toString(),start:g.start,end:g.end||g.start,reason:g.reason||"Blocked"};C([...c,b]),p({start:"",end:"",reason:""}),x(!1)},F=b=>{C(c.filter(R=>R.id!==b))},$=b=>{if(!b)return"";const[R,E]=b.split(":"),o=parseInt(R),M=o>=12?"PM":"AM";return`${o===0?12:o>12?o-12:o}:${E} ${M}`},z=Vt.reduce((b,R)=>{const E=l[R.id];if(E!=null&&E.closed)return b;const[o,M]=((E==null?void 0:E.open)||"09:00").split(":").map(Number),[h,P]=((E==null?void 0:E.close)||"17:00").split(":").map(Number),B=o*60+M,q=h*60+P;return b+Math.max(0,(q-B)/60)},0);return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Me,{className:"text-brand-blue",size:24}),"Availability & Hours"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Set your operating hours and manage blackout dates"})]}),t.jsxs("button",{onClick:n,disabled:w,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[w?t.jsx(be,{className:"animate-spin",size:18}):t.jsx(Ce,{size:18}),"Save Changes"]})]}),t.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold mb-1",children:"Weekly Availability"}),t.jsxs("p",{className:"text-indigo-100",children:[Vt.filter(b=>{var R;return!((R=l[b.id])!=null&&R.closed)}).length," days open • ",Math.round(z)," hours/week"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-4xl font-bold",children:Math.round(z)}),t.jsx("div",{className:"text-sm text-indigo-100",children:"hours"})]})]})}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Js,{size:18,className:"text-amber-500"}),"Operating Hours"]})}),t.jsx("div",{className:"divide-y dark:divide-gray-700",children:Vt.map(b=>{const R=l[b.id]||{closed:!1,open:"09:00",close:"17:00"};return t.jsxs("div",{className:`p-4 flex items-center gap-4 ${R.closed?"bg-gray-50 dark:bg-[#1f2128]":""}`,children:[t.jsx("div",{className:"w-28",children:t.jsx("span",{className:`font-medium ${R.closed?"text-gray-400":"dark:text-white"}`,children:b.label})}),t.jsx("button",{onClick:()=>j(b.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition ${R.closed?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}`,children:R.closed?"Closed":"Open"}),!R.closed&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"time",value:R.open||"09:00",onChange:E=>k(b.id,"open",E.target.value),className:"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("span",{className:"text-gray-400",children:"to"}),t.jsx("input",{type:"time",value:R.close||"17:00",onChange:E=>k(b.id,"close",E.target.value),className:"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),t.jsxs("span",{className:"text-sm text-gray-400 hidden md:inline",children:[$(R.open)," – ",$(R.close)]}),t.jsx("button",{onClick:()=>y(b.id),className:"ml-auto p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Copy to all weekdays",children:t.jsx(De,{size:16})})]})]},b.id)})})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Fr,{size:18,className:"text-indigo-500"}),"Blackout Dates"]}),t.jsxs("button",{onClick:()=>x(!S),className:"text-sm bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition flex items-center gap-1",children:[t.jsx(ge,{size:16})," Add Blackout"]})]}),S&&t.jsx("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/20 border-b dark:border-gray-700",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Start Date *"}),t.jsx("input",{type:"date",value:g.start,onChange:b=>p({...g,start:b.target.value}),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"End Date"}),t.jsx("input",{type:"date",value:g.end,onChange:b=>p({...g,end:b.target.value}),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:g.start})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Reason"}),t.jsx("input",{type:"text",value:g.reason,onChange:b=>p({...g,reason:b.target.value}),placeholder:"e.g. Holiday, Maintenance",className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("button",{onClick:v,className:"flex-1 p-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition",children:"Add"}),t.jsx("button",{onClick:()=>x(!1),className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:t.jsx(D,{size:20})})]})]})}),t.jsx("div",{className:"p-4",children:c.length===0?t.jsxs("div",{className:"text-center py-8 text-gray-400",children:[t.jsx(Fr,{size:32,className:"mx-auto mb-2 opacity-30"}),t.jsx("p",{className:"text-sm",children:"No blackout dates scheduled"}),t.jsx("p",{className:"text-xs",children:"Add dates when your studio is unavailable"})]}):t.jsx("div",{className:"space-y-2",children:c.sort((b,R)=>new Date(b.start)-new Date(R.start)).map(b=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-10 h-10 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg flex items-center justify-center",children:t.jsx(de,{className:"text-indigo-600 dark:text-indigo-400",size:18})}),t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium dark:text-white text-sm",children:[new Date(b.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),b.end!==b.start&&t.jsxs(t.Fragment,{children:[" – ",new Date(b.end).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),t.jsx("div",{className:"text-xs text-gray-500",children:b.reason})]})]}),t.jsx("button",{onClick:()=>F(b.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:t.jsx(oe,{size:16})})]},b.id))})})]}),t.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx(Be,{className:"text-amber-600 flex-shrink-0",size:20}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"font-bold text-amber-800 dark:text-amber-300 mb-1",children:"Availability Tips"}),t.jsxs("ul",{className:"text-amber-700 dark:text-amber-400 space-y-1",children:[t.jsx("li",{children:"• Operating hours determine when clients can book sessions"}),t.jsx("li",{children:"• Use blackout dates for holidays, maintenance, or personal time"}),t.jsx("li",{children:"• Individual room availability can be set in the Rooms section"})]})]})]})})]})}function Ka({user:r,userData:s,onUpdate:d}){var n,k,j,y,v,F,$,z,b,R,E,o,M,h,P,B,q,L,Y,_,W;const[l,i]=u.useState({minBookingHours:((n=s==null?void 0:s.policies)==null?void 0:n.minBookingHours)??2,maxBookingHours:((k=s==null?void 0:s.policies)==null?void 0:k.maxBookingHours)??12,advanceBookingDays:((j=s==null?void 0:s.policies)==null?void 0:j.advanceBookingDays)??14,minAdvanceHours:((y=s==null?void 0:s.policies)==null?void 0:y.minAdvanceHours)??24,autoApprove:((v=s==null?void 0:s.policies)==null?void 0:v.autoApprove)??!1,cancellationPolicy:((F=s==null?void 0:s.policies)==null?void 0:F.cancellationPolicy)??"moderate",cancellationNoticeHours:(($=s==null?void 0:s.policies)==null?void 0:$.cancellationNoticeHours)??48,refundPercentage:((z=s==null?void 0:s.policies)==null?void 0:z.refundPercentage)??50,depositRequired:((b=s==null?void 0:s.policies)==null?void 0:b.depositRequired)??!0,depositPercentage:((R=s==null?void 0:s.policies)==null?void 0:R.depositPercentage)??25,peakHourMultiplier:((E=s==null?void 0:s.policies)==null?void 0:E.peakHourMultiplier)??1,peakHoursStart:((o=s==null?void 0:s.policies)==null?void 0:o.peakHoursStart)??"",peakHoursEnd:((M=s==null?void 0:s.policies)==null?void 0:M.peakHoursEnd)??"",weekendMultiplier:((h=s==null?void 0:s.policies)==null?void 0:h.weekendMultiplier)??1,houseRules:((P=s==null?void 0:s.policies)==null?void 0:P.houseRules)??"",whatToExpect:((B=s==null?void 0:s.policies)==null?void 0:B.whatToExpect)??"",whatToBring:((q=s==null?void 0:s.policies)==null?void 0:q.whatToBring)??"",parkingInstructions:((L=s==null?void 0:s.policies)==null?void 0:L.parkingInstructions)??"",requiresWaiver:((Y=s==null?void 0:s.policies)==null?void 0:Y.requiresWaiver)??!1,waiverText:((_=s==null?void 0:s.policies)==null?void 0:_.waiverText)??"",ageRequirement:((W=s==null?void 0:s.policies)==null?void 0:W.ageRequirement)??18}),[c,C]=u.useState(!1),[w,N]=u.useState("booking"),g=async()=>{C(!0);const T=H.loading("Saving policies..."),J=(s==null?void 0:s.id)||(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const G=await fetch(`/api/studio-ops/profiles/${J}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({policies:l})}),Q=await G.json();if(!G.ok)throw new Error(Q.error||"Failed to save");H.success("Policies saved!",{id:T}),d&&d({policies:l})}catch(G){console.error("Save failed:",G),H.error("Failed to save",{id:T})}finally{C(!1)}},p=(T,J)=>{i(G=>({...G,[T]:J}))},S=[{id:"flexible",label:"Flexible",description:"Full refund up to 24 hours before session",color:"green"},{id:"moderate",label:"Moderate",description:"50% refund up to 48 hours before session",color:"amber"},{id:"strict",label:"Strict",description:"No refunds within 7 days of session",color:"red"},{id:"custom",label:"Custom",description:"Set your own cancellation terms",color:"blue"}],x=({id:T,title:J,icon:G,children:Q})=>{const me=w===T;return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("button",{onClick:()=>N(me?null:T),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-[#23262f] transition",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-brand-blue/10 rounded-lg flex items-center justify-center",children:t.jsx(G,{className:"text-brand-blue",size:20})}),t.jsx("h3",{className:"font-bold dark:text-white",children:J})]}),me?t.jsx(rs,{size:20}):t.jsx(ss,{size:20})]}),me&&t.jsx("div",{className:"p-4 pt-0 border-t dark:border-gray-700",children:Q})]})};return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Qe,{className:"text-brand-blue",size:24}),"Policies & Rules"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Set booking rules, cancellation policies, and house rules"})]}),t.jsxs("button",{onClick:g,disabled:c,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[c?t.jsx(be,{className:"animate-spin",size:18}):t.jsx(Ce,{size:18}),"Save Changes"]})]}),t.jsx(x,{id:"booking",title:"Booking Rules",icon:Me,children:t.jsxs("div",{className:"space-y-6 pt-4",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Hours"}),t.jsx("input",{type:"number",value:l.minBookingHours,onChange:T=>p("minBookingHours",parseInt(T.target.value)||1),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Max Hours"}),t.jsx("input",{type:"number",value:l.maxBookingHours,onChange:T=>p("maxBookingHours",parseInt(T.target.value)||12),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Book Ahead (Days)"}),t.jsx("input",{type:"number",value:l.advanceBookingDays,onChange:T=>p("advanceBookingDays",parseInt(T.target.value)||7),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Notice (Hrs)"}),t.jsx("input",{type:"number",value:l.minAdvanceHours,onChange:T=>p("minAdvanceHours",parseInt(T.target.value)||0),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:"Auto-Approve Bookings"}),t.jsx("div",{className:"text-sm text-gray-500",children:"Automatically confirm bookings without manual approval"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:l.autoApprove,onChange:T=>p("autoApprove",T.target.checked),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-brand-blue"})]})]})]})}),t.jsx(x,{id:"cancellation",title:"Cancellation Policy",icon:Xs,children:t.jsxs("div",{className:"space-y-4 pt-4",children:[t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:S.map(T=>t.jsxs("button",{onClick:()=>p("cancellationPolicy",T.id),className:`p-4 rounded-xl border-2 text-left transition ${l.cancellationPolicy===T.id?`border-${T.color}-500 bg-${T.color}-50 dark:bg-${T.color}-900/20`:"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[t.jsx("div",{className:`font-bold mb-1 ${l.cancellationPolicy===T.id?`text-${T.color}-700 dark:text-${T.color}-400`:"dark:text-white"}`,children:T.label}),t.jsx("div",{className:"text-xs text-gray-500",children:T.description})]},T.id))}),l.cancellationPolicy==="custom"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Notice Required (Hours)"}),t.jsx("input",{type:"number",value:l.cancellationNoticeHours,onChange:T=>p("cancellationNoticeHours",parseInt(T.target.value)||24),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Refund Percentage"}),t.jsx("input",{type:"number",value:l.refundPercentage,onChange:T=>p("refundPercentage",parseInt(T.target.value)||0),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0,max:100})]})]})]})}),t.jsx(x,{id:"pricing",title:"Pricing & Deposits",icon:qe,children:t.jsxs("div",{className:"space-y-6 pt-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:"Require Deposit"}),t.jsx("div",{className:"text-sm text-gray-500",children:"Collect partial payment when booking"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:l.depositRequired,onChange:T=>p("depositRequired",T.target.checked),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue"})]})]}),l.depositRequired&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Deposit Percentage"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"range",value:l.depositPercentage,onChange:T=>p("depositPercentage",parseInt(T.target.value)),className:"flex-1",min:10,max:100,step:5}),t.jsxs("span",{className:"font-bold text-brand-blue w-14 text-right",children:[l.depositPercentage,"%"]})]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white mb-3",children:"Peak Hour Pricing"}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Peak Start"}),t.jsx("input",{type:"time",value:l.peakHoursStart,onChange:T=>p("peakHoursStart",T.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Peak End"}),t.jsx("input",{type:"time",value:l.peakHoursEnd,onChange:T=>p("peakHoursEnd",T.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Rate Multiplier"}),t.jsx("input",{type:"number",value:l.peakHourMultiplier,onChange:T=>p("peakHourMultiplier",parseFloat(T.target.value)||1),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1,max:3,step:.1})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Weekend Rate Multiplier"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("input",{type:"range",value:l.weekendMultiplier,onChange:T=>p("weekendMultiplier",parseFloat(T.target.value)),className:"flex-1",min:1,max:2,step:.1}),t.jsxs("span",{className:"font-bold dark:text-white w-16 text-right",children:[l.weekendMultiplier,"x"]})]}),l.weekendMultiplier>1&&t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Saturday & Sunday bookings will be ",Math.round((l.weekendMultiplier-1)*100),"% more"]})]})]})}),t.jsx(x,{id:"rules",title:"House Rules & Info",icon:Qe,children:t.jsxs("div",{className:"space-y-4 pt-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio Rules"}),t.jsx("textarea",{value:l.houseRules,onChange:T=>p("houseRules",T.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:4,placeholder:`• No smoking inside the studio
• Please arrive 10 minutes early
• Clean up after your session`})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"What to Expect"}),t.jsx("textarea",{value:l.whatToExpect,onChange:T=>p("whatToExpect",T.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:"Describe what clients can expect when they arrive..."})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"What to Bring"}),t.jsx("textarea",{value:l.whatToBring,onChange:T=>p("whatToBring",T.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:`• Instrument cables
• Lyrics/charts
• Reference tracks`})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Parking Instructions"}),t.jsx("textarea",{value:l.parkingInstructions,onChange:T=>p("parkingInstructions",T.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:"Describe parking situation and directions..."})]})]})]})}),t.jsx(x,{id:"legal",title:"Legal & Safety",icon:as,children:t.jsxs("div",{className:"space-y-4 pt-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Minimum Age Requirement"}),t.jsx("input",{type:"number",value:l.ageRequirement,onChange:T=>p("ageRequirement",parseInt(T.target.value)||0),className:"w-32 p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]}),t.jsx("p",{className:"text-sm text-gray-500 mt-6",children:l.ageRequirement>0?`Clients must be ${l.ageRequirement}+ to book`:"No age restriction"})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:"Require Liability Waiver"}),t.jsx("div",{className:"text-sm text-gray-500",children:"Clients must sign a waiver before booking"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:l.requiresWaiver,onChange:T=>p("requiresWaiver",T.target.checked),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue"})]})]}),l.requiresWaiver&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Waiver Text"}),t.jsx("textarea",{value:l.waiverText,onChange:T=>p("waiverText",T.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white font-mono text-sm",rows:6,placeholder:"Enter your liability waiver text..."})]})]})]})})]})}function Za({booking:r,onClose:s,onSuccess:d}){const[l,i]=u.useState("weekly"),[c,C]=u.useState(1),[w,N]=u.useState([]),[g,p]=u.useState(""),[S,x]=u.useState(""),[n,k]=u.useState(!1),j=v=>{N(F=>F.includes(v)?F.filter($=>$!==v):[...F,v].sort())},y=async v=>{if(v.preventDefault(),!r)return;k(!0);const F=H.loading("Creating recurring bookings...");try{const $=new Date(r.date);if(isNaN($.getTime()))throw new Error("Invalid booking date");let z=new Date($);if(l==="weekly"&&w.length>0){const E=$.getDay(),o=w.find(h=>h>E)||w[0],M=o-E+(o<E?7:0);z=new Date($.getTime()+M*24*60*60*1e3)}else l==="daily"?z=new Date($.getTime()+c*24*60*60*1e3):l==="monthly"&&(z=new Date($),z.setMonth(z.getMonth()+c));const b={type:l,interval:c,daysOfWeek:l==="weekly"?w:null},R=await os(`
                INSERT INTO recurring_bookings (
                    parent_booking_id, studio_id, sender_id,
                    recurrence_type, recurrence_pattern,
                    start_date, end_date, next_occurrence,
                    max_occurrences, is_active
                ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
                RETURNING *
            `,[r.id,r.studio_owner_id||r.target_id,r.sender_id,l,JSON.stringify(b),$.toISOString().split("T")[0],g||null,z.toISOString().split("T")[0],S?parseInt(S):null,!0]);if(!R||R.length===0)throw new Error("Failed to create recurring booking");H.success("Recurring booking created!",{id:F}),d==null||d(),s()}catch($){console.error("Error creating recurring booking:",$),H.error("Failed to create recurring booking: "+$.message,{id:F})}finally{k(!1)}};return t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-md w-full",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Ks,{size:18,className:"text-brand-blue"}),"Create Recurring Booking"]}),t.jsx("button",{onClick:s,children:t.jsx(D,{size:20,className:"text-gray-500"})})]}),t.jsxs("form",{onSubmit:y,className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Repeat"}),t.jsxs("select",{value:l,onChange:v=>i(v.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[t.jsx("option",{value:"daily",children:"Daily"}),t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"monthly",children:"Monthly"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:["Every ",l==="daily"?"X days":l==="weekly"?"X weeks":"X months"]}),t.jsx("input",{type:"number",min:"1",value:c,onChange:v=>C(parseInt(v.target.value)||1),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),l==="weekly"&&t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Days of Week"}),t.jsx("div",{className:"grid grid-cols-7 gap-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((v,F)=>t.jsx("button",{type:"button",onClick:()=>j(F),className:`p-2 rounded-lg text-sm font-medium transition ${w.includes(F)?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:v},F))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"End Date (optional)"}),t.jsx("input",{type:"date",value:g,onChange:v=>p(v.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Max Occurrences (optional)"}),t.jsx("input",{type:"number",min:"1",value:S,onChange:v=>x(v.target.value),placeholder:"Unlimited if empty",className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:s,className:"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:n||l==="weekly"&&w.length===0,className:"flex-1 py-2.5 bg-brand-blue text-white rounded-lg font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50",children:[t.jsx(Ce,{size:16}),"Create Recurring"]})]})]})]})})}function Qa({booking:r,rooms:s,onClose:d,onSuccess:l}){const[i,c]=u.useState([]),[C,w]=u.useState({}),[N,g]=u.useState(!1);u.useEffect(()=>{if(r!=null&&r.booking_start&&(r!=null&&r.duration)){const n=new Date(r.booking_start),k=new Date(n.getTime()+r.duration*60*60*1e3),j={};i.forEach(y=>{j[y]={start:n.toISOString().slice(0,16),end:k.toISOString().slice(0,16)}}),w(j)}},[i,r]);const p=n=>{c(k=>k.includes(n)?k.filter(j=>j!==n):[...k,n])},S=(n,k,j)=>{w(y=>({...y,[n]:{...y[n],[k]:j}}))},x=async n=>{if(n.preventDefault(),!r||i.length===0)return;g(!0);const k=H.loading("Assigning rooms...");try{const j=i.map(y=>{const v=C[y],F=v!=null&&v.start?new Date(v.start):new Date(r.booking_start||r.date),$=v!=null&&v.end?new Date(v.end):new Date(F.getTime()+r.duration*60*60*1e3),z=s.find(b=>b.id===y);return{booking_id:r.id,room_id:y,room_name:(z==null?void 0:z.name)||`Room ${y}`,start_time:F.toISOString(),end_time:$.toISOString()}});await Promise.all(j.map(y=>os(`
                        INSERT INTO room_bookings (
                            booking_id, room_id, room_name, start_time, end_time
                        ) VALUES ($1, $2, $3, $4, $5)
                    `,[y.booking_id,y.room_id,y.room_name,y.start_time,y.end_time]))),H.success(`${i.length} room(s) assigned!`,{id:k}),l==null||l(),d()}catch(j){console.error("Error assigning rooms:",j),H.error("Failed to assign rooms: "+j.message,{id:k})}finally{g(!1)}};return t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(je,{size:18,className:"text-brand-blue"}),"Assign Rooms"]}),t.jsx("button",{onClick:d,children:t.jsx(D,{size:20,className:"text-gray-500"})})]}),t.jsxs("form",{onSubmit:x,className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Select Rooms"}),t.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:s.map(n=>{var k,j;return t.jsxs("div",{className:`p-3 border rounded-lg cursor-pointer transition ${i.includes(n.id)?"border-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,onClick:()=>p(n.id),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:n.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:["$",n.rate,"/hr • ",n.capacity," people"]})]}),t.jsx("input",{type:"checkbox",checked:i.includes(n.id),onChange:()=>p(n.id),className:"w-4 h-4 text-brand-blue"})]}),i.includes(n.id)&&t.jsxs("div",{className:"mt-3 pt-3 border-t dark:border-gray-600 grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"Start"}),t.jsx("input",{type:"datetime-local",value:((k=C[n.id])==null?void 0:k.start)||"",onChange:y=>S(n.id,"start",y.target.value),className:"w-full p-1.5 text-sm border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"End"}),t.jsx("input",{type:"datetime-local",value:((j=C[n.id])==null?void 0:j.end)||"",onChange:y=>S(n.id,"end",y.target.value),className:"w-full p-1.5 text-sm border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]})]})]},n.id)})})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:d,className:"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:N||i.length===0,className:"flex-1 py-2.5 bg-brand-blue text-white rounded-lg font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50",children:[t.jsx(Ce,{size:16}),"Assign ",i.length>0?`(${i.length})`:""]})]})]})]})})}function Da({currentDate:r=new Date,onDateChange:s,bookings:d=[],blockedDates:l=[],onDateClick:i,onBookingClick:c,view:C="month",onViewChange:w,showControls:N=!0,className:g=""}){const[p,S]=u.useState(r),[x,n]=u.useState(C),k=r||p,j=C||x,y=M=>{S(M),s&&s(M)},v=M=>{n(M),w&&w(M)},F=M=>{const h=new Date(k);j==="month"?h.setMonth(h.getMonth()+M):j==="week"?h.setDate(h.getDate()+M*7):j==="day"&&h.setDate(h.getDate()+M),y(h)},$=()=>{y(new Date)},z=M=>{const h=new Date(M),P=h.getDay(),B=h.getDate()-P;return new Date(h.setDate(B))},b=M=>{const h=z(M),P=[];for(let B=0;B<7;B++){const q=new Date(h);q.setDate(h.getDate()+B),P.push(q)}return P},R=M=>M?d.filter(h=>{if(!h.date)return!1;const P=h.date instanceof Date?h.date:new Date(h.date);return isNaN(P.getTime())?!1:P.toDateString()===M.toDateString()}):[],E=M=>M?l.filter(h=>{if(!h.date)return!1;const P=h.date instanceof Date?h.date:new Date(h.date);return isNaN(P.getTime())?!1:P.toDateString()===M.toDateString()}):[],o=()=>{if(j==="month")return k.toLocaleDateString("en-US",{month:"long",year:"numeric"});if(j==="week"){const M=b(k),h=M[0],P=M[6];return h.getMonth()===P.getMonth()?`${h.toLocaleDateString("en-US",{month:"long",day:"numeric"})} - ${P.toLocaleDateString("en-US",{day:"numeric",year:"numeric"})}`:`${h.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${P.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`}else return k.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})};return t.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden ${g}`,children:[N&&t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("div",{className:"flex bg-gray-200 dark:bg-gray-700 rounded-lg p-1",children:["month","week","day"].map(M=>t.jsx("button",{onClick:()=>v(M),className:`px-3 py-1.5 rounded-md text-sm font-medium transition capitalize ${j===M?"bg-white dark:bg-gray-600 shadow text-brand-blue dark:text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:M},M))}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>F(-1),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition",children:t.jsx(ar,{size:20,className:"text-gray-600 dark:text-gray-300"})}),t.jsx("button",{onClick:$,className:"px-3 py-1.5 text-sm font-medium text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",children:"Today"}),t.jsx("button",{onClick:()=>F(1),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition",children:t.jsx(Oe,{size:20,className:"text-gray-600 dark:text-gray-300"})})]})]}),t.jsx("div",{className:"text-center",children:t.jsx("h3",{className:"font-bold dark:text-white text-lg",children:o()})})]}),t.jsxs("div",{className:"p-4",children:[j==="month"&&t.jsx(el,{date:k,bookings:d,blockedDates:l,onDateClick:i,onBookingClick:c,getDayBookings:R,getDayBlocks:E}),j==="week"&&t.jsx(tl,{date:k,bookings:d,blockedDates:l,onDateClick:i,onBookingClick:c,getDayBookings:R,getDayBlocks:E,getWeekDates:b}),j==="day"&&t.jsx(rl,{date:k,bookings:d,blockedDates:l,onDateClick:i,onBookingClick:c,getDayBookings:R,getDayBlocks:E})]}),t.jsx("div",{className:"px-4 pb-4",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-4 border-t dark:border-gray-700 text-xs text-gray-500",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Confirmed"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"Pending"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ke,{size:12,className:"text-red-500"}),"Blocked"]})]})})]})}function el({date:r,bookings:s,blockedDates:d,onDateClick:l,onBookingClick:i,getDayBookings:c,getDayBlocks:C}){const w=r.getFullYear(),N=r.getMonth(),g=new Date,p=new Date(w,N,1).getDay(),S=new Date(w,N+1,0).getDate(),x=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=[];for(let k=0;k<p;k++)n.push(null);for(let k=1;k<=S;k++)n.push(k);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:x.map(k=>t.jsx("div",{className:"text-center text-sm font-bold text-gray-500 py-2",children:k},k))}),t.jsx("div",{className:"grid grid-cols-7 gap-2",children:n.map((k,j)=>{if(k===null)return t.jsx("div",{className:"aspect-square"},`empty-${j}`);const y=new Date(w,N,k),v=y<new Date(g.getFullYear(),g.getMonth(),g.getDate()),F=y.toDateString()===g.toDateString(),$=c(y),z=C(y),b=$.some(o=>(o.status||"").toLowerCase()==="confirmed"),R=$.some(o=>(o.status||"").toLowerCase()==="pending"),E=z.length>0;return t.jsxs("button",{onClick:()=>{!v&&l&&l(y),$.length>0&&i&&i($[0],y)},disabled:v,className:`aspect-square p-1 rounded-xl flex flex-col items-center justify-center relative transition ${v?"opacity-40 cursor-not-allowed":E?"bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 hover:bg-red-200 dark:hover:bg-red-900/40":F?"bg-brand-blue text-white":b||R?"bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[t.jsx("span",{className:`text-sm font-medium ${F?"text-white":E?"text-red-700 dark:text-red-400":"dark:text-white"}`,children:k}),t.jsxs("div",{className:"flex gap-0.5 mt-0.5",children:[b&&t.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),R&&t.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),E&&t.jsx(Ke,{size:10,className:"text-red-600 dark:text-red-400"})]}),$.length>0&&!F&&t.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-brand-blue text-white text-[10px] rounded-full flex items-center justify-center font-bold",children:$.length})]},k)})})]})}function tl({date:r,bookings:s,blockedDates:d,onDateClick:l,onBookingClick:i,getDayBookings:c,getDayBlocks:C,getWeekDates:w}){const N=w(r),g=new Date,p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],S=[];for(let x=6;x<=23;x++)S.push(x);return t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("div",{className:"min-w-[800px]",children:[t.jsxs("div",{className:"grid grid-cols-8 gap-2 mb-2 border-b dark:border-gray-700 pb-2",children:[t.jsx("div",{className:"text-sm font-bold text-gray-500",children:"Time"}),N.map((x,n)=>{const k=x.toDateString()===g.toDateString();return t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`text-xs font-medium text-gray-400 mb-1 ${k?"text-brand-blue":""}`,children:p[x.getDay()]}),t.jsx("div",{className:`text-sm font-bold ${k?"text-brand-blue":"dark:text-white"}`,children:x.getDate()})]},n)})]}),t.jsxs("div",{className:"grid grid-cols-8 gap-2",children:[t.jsx("div",{className:"space-y-1",children:S.map(x=>t.jsxs("div",{className:"h-16 flex items-start pt-1 text-xs text-gray-400",children:[x.toString().padStart(2,"0"),":00"]},x))}),N.map((x,n)=>{const k=c(x),j=C(x),y=x.toDateString()===g.toDateString();return t.jsx("div",{className:"relative",children:S.map((v,F)=>{const $=new Date(x);$.setHours(v,0,0,0);const z=new Date(x);z.setHours(v+1,0,0,0);const b=k.filter(E=>{if(!E.startTime)return!1;const o=new Date(`${x.toDateString()} ${E.startTime}`);return o>=$&&o<z}),R=j.some(E=>(E.time_slot||E.timeSlot)==="full");return t.jsx("div",{onClick:()=>l&&l($),className:`h-16 border-b dark:border-gray-700 cursor-pointer transition ${y?"bg-blue-50 dark:bg-blue-900/10":"hover:bg-gray-50 dark:hover:bg-gray-800"} ${R?"bg-red-50 dark:bg-red-900/20":""}`,children:b.map((E,o)=>t.jsxs("div",{onClick:M=>{M.stopPropagation(),i&&i(E,x)},className:`text-xs p-1 m-0.5 rounded cursor-pointer ${(E.status||"").toLowerCase()==="confirmed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:[E.startTime||""," ",E.clientName||"Booking"]},o))},F)})},n)})]})]})})}function rl({date:r,bookings:s,blockedDates:d,onDateClick:l,onBookingClick:i,getDayBookings:c,getDayBlocks:C}){const w=new Date,N=r.toDateString()===w.toDateString(),g=c(r),p=C(r),S=[];for(let n=6;n<=23;n++)S.push(n);const x=u.useMemo(()=>{const n={};return g.forEach(k=>{if(!k.startTime)return;const j=parseInt(k.startTime.split(":")[0]);n[j]||(n[j]=[]),n[j].push(k)}),n},[g]);return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${N?"bg-brand-blue text-white border-brand-blue":"bg-gray-50 dark:bg-[#1f2128] border-gray-200 dark:border-gray-700"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-lg",children:r.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),t.jsxs("p",{className:`text-sm mt-1 ${N?"text-blue-100":"text-gray-500"}`,children:[g.length," booking",g.length!==1?"s":"",p.length>0&&` • ${p.length} blocked slot${p.length!==1?"s":""}`]})]}),p.length>0&&t.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400",children:[t.jsx(Ke,{size:20}),t.jsx("span",{className:"font-medium",children:"Blocked"})]})]})}),t.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[t.jsx("div",{className:"col-span-2 space-y-1",children:S.map(n=>t.jsxs("div",{className:"h-20 flex items-start pt-2 text-sm text-gray-500 font-medium",children:[n.toString().padStart(2,"0"),":00"]},n))}),t.jsx("div",{className:"col-span-10 relative",children:S.map((n,k)=>{const j=new Date(r);j.setHours(n,0,0,0),new Date(r).setHours(n+1,0,0,0);const v=x[n]||[],F=p.some($=>{const z=$.time_slot||$.timeSlot,b=$.start_time||$.startTime,R=$.end_time||$.endTime;if(z==="full")return!0;if(z==="custom"&&b&&R){const E=parseInt(b.split(":")[0]),o=parseInt(R.split(":")[0]);return n>=E&&n<o}return!1});return t.jsx("div",{onClick:()=>l&&l(j),className:`h-20 border-b dark:border-gray-700 cursor-pointer transition relative ${N?"bg-blue-50 dark:bg-blue-900/10":"hover:bg-gray-50 dark:hover:bg-gray-800"} ${F?"bg-red-50 dark:bg-red-900/20":""}`,children:v.map(($,z)=>t.jsxs("div",{onClick:b=>{b.stopPropagation(),i&&i($,r)},className:`absolute left-1 right-1 p-2 rounded-lg cursor-pointer shadow-sm ${($.status||"").toLowerCase()==="confirmed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-300 dark:border-green-700":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 border border-amber-300 dark:border-amber-700"}`,style:{top:`${(parseInt(($.startTime||"00:00").split(":")[1])||0)/60*100}%`,height:`${($.duration||1)/60*100}%`},children:[t.jsxs("div",{className:"font-medium text-sm",children:[$.startTime||""," ",$.clientName||"Booking"]}),$.roomName&&t.jsxs("div",{className:"text-xs opacity-75 flex items-center gap-1 mt-0.5",children:[t.jsx(_t,{size:10}),$.roomName]})]},z))},k)})})]}),g.length>0&&t.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-gray-700",children:[t.jsx("h4",{className:"font-bold text-sm dark:text-white mb-3",children:"All Bookings"}),t.jsx("div",{className:"space-y-2",children:g.map(n=>t.jsx("div",{onClick:()=>i&&i(n,r),className:`p-3 rounded-lg cursor-pointer transition ${(n.status||"").toLowerCase()==="confirmed"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium dark:text-white",children:[n.startTime||"TBD"," - ",n.clientName||"Unknown"]}),n.roomName&&t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5 flex items-center gap-1",children:[t.jsx(_t,{size:10}),n.roomName]})]}),t.jsx("span",{className:`text-xs px-2 py-1 rounded font-medium ${(n.status||"").toLowerCase()==="confirmed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:n.status||"Pending"})]})},n.id))})]})]})}function sl({user:r,userData:s,onCreateBooking:d}){const[l,i]=u.useState([]),[c,C]=u.useState(!0),[w,N]=u.useState(!1),[g,p]=u.useState(!1),[S,x]=u.useState(null),[n,k]=u.useState({name:"",description:"",durationHours:2,basePrice:100,rooms:[],equipmentPackages:[],addOnServices:[],isActive:!0});u.useEffect(()=>{j()},[]);const j=async()=>{C(!0);try{const M=await(await fetch(`/api/studio-ops/booking-templates?studioId=${s==null?void 0:s.id}`)).json();M.success&&i(M.data)}catch(o){console.error("Error fetching templates:",o)}finally{C(!1)}},y=async o=>{o.preventDefault();try{const h=await(await fetch("/api/studio-ops/booking-templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,studioId:s==null?void 0:s.id})})).json();h.success?(i([...l,h.data]),N(!1),R()):alert(`Error: ${h.error||"Failed to create template"}`)}catch(M){console.error("Error creating template:",M),alert("Failed to create template. Please try again.")}},v=async o=>{o.preventDefault();try{const h=await(await fetch(`/api/studio-ops/booking-templates/${S.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();h.success?(i(l.map(P=>P.id===S.id?h.data:P)),p(!1),x(null),R()):alert(`Error: ${h.error||"Failed to update template"}`)}catch(M){console.error("Error updating template:",M),alert("Failed to update template. Please try again.")}},F=async o=>{const M=l.find(h=>h.id===o);if(M.usage_count>0){alert(`This template has been used ${M.usage_count} time(s). Please deactivate it instead of deleting.`);return}if(confirm(`Are you sure you want to delete "${M.name}"?`))try{const P=await(await fetch(`/api/studio-ops/booking-templates/${o}`,{method:"DELETE"})).json();P.success?i(l.filter(B=>B.id!==o)):alert(`Error: ${P.error||"Failed to delete template"}`)}catch(h){console.error("Error deleting template:",h),alert("Failed to delete template. Please try again.")}},$=async o=>{try{const h=await(await fetch(`/api/studio-ops/booking-templates/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!o.is_active})})).json();h.success&&i(l.map(P=>P.id===o.id?h.data:P))}catch(M){console.error("Error toggling template:",M)}},z=async o=>{if(d)d(o);else try{const h=await(await fetch(`/api/studio-ops/booking-templates/${o.id}/use`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studioId:s==null?void 0:s.id,clientId:null,date:new Date().toISOString().split("T")[0],startTime:"10:00"})})).json();h.success?alert(`Booking created from "${o.name}" template!`):alert(`Error: ${h.error||"Failed to create booking"}`)}catch(M){console.error("Error using template:",M)}},b=o=>{x(o),k({name:o.name,description:o.description||"",durationHours:o.duration_hours,basePrice:o.base_price,rooms:o.rooms||[],equipmentPackages:o.equipment_packages||[],addOnServices:o.add_on_services||[],isActive:o.is_active}),p(!0)},R=()=>{k({name:"",description:"",durationHours:2,basePrice:100,rooms:[],equipmentPackages:[],addOnServices:[],isActive:!0})},E=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o);return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center text-white",children:t.jsx(ls,{size:20})}),"Booking Templates"]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Create reusable booking packages for quick scheduling"})]}),t.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors",children:[t.jsx(ge,{size:18}),"New Template"]})]})}),c?t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400",children:"Loading templates..."}):l.length===0?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(De,{size:32,className:"text-gray-400"})}),t.jsx("p",{className:"font-semibold mb-2",children:"No booking templates yet"}),t.jsx("p",{className:"text-sm",children:"Create templates to speed up your booking process"})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(o=>{var M,h,P,B,q,L,Y,_,W,T,J;return t.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5 transition-all ${o.is_active?"":"opacity-60"}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-lg font-semibold dark:text-white",children:o.name}),!o.is_active&&t.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded",children:"Inactive"})]}),o.description&&t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2",children:o.description})]}),t.jsx("button",{onClick:()=>$(o),className:`p-2 rounded-lg transition-colors ${o.is_active?"text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20":"text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,title:o.is_active?"Active":"Inactive",children:t.jsx(et,{size:18})})]}),t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[t.jsx(Me,{size:16}),o.duration_hours," hour",o.duration_hours!==1?"s":""]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-green-600 dark:text-green-400",children:[t.jsx(qe,{size:16}),E(o.base_price)]}),o.usage_count>0&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:["Used ",o.usage_count," time",o.usage_count!==1?"s":""]}),(((M=o.rooms)==null?void 0:M.length)>0||((h=o.equipment_packages)==null?void 0:h.length)>0||((P=o.add_on_services)==null?void 0:P.length)>0)&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:[((B=o.rooms)==null?void 0:B.length)>0&&`${o.rooms.length} room(s)`,((q=o.rooms)==null?void 0:q.length)>0&&((L=o.equipment_packages)==null?void 0:L.length)>0&&" • ",((Y=o.equipment_packages)==null?void 0:Y.length)>0&&`${o.equipment_packages.length} equipment package(s)`,(((_=o.rooms)==null?void 0:_.length)>0||((W=o.equipment_packages)==null?void 0:W.length)>0)&&((T=o.add_on_services)==null?void 0:T.length)>0&&" • ",((J=o.add_on_services)==null?void 0:J.length)>0&&`${o.add_on_services.length} add-on(s)`]})]}),t.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t dark:border-gray-700",children:[t.jsxs("button",{onClick:()=>z(o),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm transition-colors",children:[t.jsx(De,{size:16}),"Use"]}),t.jsx("button",{onClick:()=>b(o),className:"p-2 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",title:"Edit template",children:t.jsx(We,{size:16})}),t.jsx("button",{onClick:()=>F(o.id),className:"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors",title:"Delete template",children:t.jsx(oe,{size:16})})]})]},o.id)})}),w&&t.jsx(Hr,{mode:"add",formData:n,setFormData:k,onSubmit:y,onClose:()=>{N(!1),R()}}),g&&S&&t.jsx(Hr,{mode:"edit",formData:n,setFormData:k,onSubmit:v,onClose:()=>{p(!1),x(null),R()}})]})}function Hr({mode:r,formData:s,setFormData:d,onSubmit:l,onClose:i}){const[c,C]=u.useState({}),w=()=>{const g={};return s.name.trim()||(g.name="Name is required"),(!s.durationHours||s.durationHours<=0)&&(g.durationHours="Duration must be greater than 0"),(!s.basePrice||s.basePrice<0)&&(g.basePrice="Price must be 0 or greater"),C(g),Object.keys(g).length===0},N=g=>{g.preventDefault(),w()&&l(g)};return t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-bold dark:text-white",children:r==="add"?"Create Booking Template":"Edit Booking Template"}),t.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors",children:t.jsx(D,{size:20,className:"dark:text-gray-400"})})]}),t.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Template Name *"}),t.jsx("input",{type:"text",value:s.name,onChange:g=>d({...s,name:g.target.value}),className:`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-orange-500 ${c.name?"border-red-500":"dark:border-gray-600"}`,placeholder:"e.g., 4-Hour Recording Session"}),c.name&&t.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.name})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),t.jsx("textarea",{rows:"2",value:s.description,onChange:g=>d({...s,description:g.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-orange-500",placeholder:"Brief description of this template"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Duration (hours) *"}),t.jsx("input",{type:"number",step:"0.5",min:"0.5",value:s.durationHours,onChange:g=>d({...s,durationHours:parseFloat(g.target.value)}),className:`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-orange-500 ${c.durationHours?"border-red-500":"dark:border-gray-600"}`}),c.durationHours&&t.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.durationHours})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Base Price ($) *"}),t.jsx("input",{type:"number",step:"0.01",min:"0",value:s.basePrice,onChange:g=>d({...s,basePrice:parseFloat(g.target.value)}),className:`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-orange-500 ${c.basePrice?"border-red-500":"dark:border-gray-600"}`}),c.basePrice&&t.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.basePrice})]})]}),t.jsx("div",{className:"flex items-center gap-3 pt-4 border-t dark:border-gray-700",children:t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:s.isActive,onChange:g=>d({...s,isActive:g.target.checked}),className:"w-4 h-4 text-orange-600 rounded focus:ring-orange-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Active template"})]})}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:i,className:"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors",children:r==="add"?"Create Template":"Save Changes"})]})]})]})})}function al({user:r,userData:s}){const[d,l]=u.useState([]),[i,c]=u.useState(!0),[C,w]=u.useState("all");u.useEffect(()=>{N()},[]);const N=async()=>{c(!0);try{const v=await(await fetch(`/api/studio-ops/waitlist?studioId=${s==null?void 0:s.id}`)).json();v.success&&l(v.data)}catch(y){console.error("Error fetching waitlist:",y)}finally{c(!1)}},g=async y=>{try{const F=await(await fetch(`/api/studio-ops/waitlist/${y}/notify`,{method:"POST"})).json();F.success?(l(d.map($=>$.id===y?{...$,status:"notified"}:$)),alert("Client notified successfully! They have 24 hours to respond.")):alert(`Error: ${F.error||"Failed to notify client"}`)}catch(v){console.error("Error notifying client:",v),alert("Failed to notify client. Please try again.")}},p=async y=>{if(confirm("Remove this entry from the waitlist?"))try{const F=await(await fetch(`/api/studio-ops/waitlist/${y}`,{method:"DELETE"})).json();F.success?l(d.filter($=>$.id!==y)):alert(`Error: ${F.error||"Failed to remove entry"}`)}catch(v){console.error("Error removing entry:",v),alert("Failed to remove entry. Please try again.")}},S=y=>{const v={pending:{label:"Pending",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",icon:Me},notified:{label:"Awaiting Response",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:Rr},accepted:{label:"Accepted",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:et},cancelled:{label:"Cancelled",color:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400",icon:Kt},expired:{label:"Expired",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",icon:Kt}},F=v[y.status]||v.pending,$=F.icon;return t.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full ${F.color}`,children:[t.jsx($,{size:12}),F.label]})},x=y=>y>=80?t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",children:[t.jsx(Xe,{size:10,className:"fill-current"}),"High Priority"]}):y>=50?t.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",children:"Medium"}):t.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400",children:"Normal"}),n=y=>y?new Date(y).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",k=C==="all"?d:d.filter(y=>y.status===C),j={total:d.length,pending:d.filter(y=>y.status==="pending").length,notified:d.filter(y=>y.status==="notified").length,expired:d.filter(y=>y.status==="expired").length};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6",children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white",children:t.jsx(ke,{size:20})}),"Booking Waitlist"]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage waitlist entries and notify clients of availability"})]})}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:j.total}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Entries"})]}),t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:j.pending}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pending"})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:j.notified}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Awaiting Response"})]}),t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:j.expired}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Expired"})]})]}),t.jsxs("div",{className:"mt-4 flex gap-2",children:[t.jsxs("button",{onClick:()=>w("all"),className:`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${C==="all"?"bg-gray-800 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:["All (",j.total,")"]}),t.jsxs("button",{onClick:()=>w("pending"),className:`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${C==="pending"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:["Pending (",j.pending,")"]}),t.jsxs("button",{onClick:()=>w("notified"),className:`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${C==="notified"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:["Notified (",j.notified,")"]})]})]}),i?t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400",children:"Loading waitlist entries..."}):k.length===0?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400",children:[t.jsx(Be,{size:48,className:"mx-auto mb-4 text-gray-400"}),t.jsx("p",{className:"font-semibold mb-2",children:"No waitlist entries found"}),t.jsx("p",{className:"text-sm",children:C!=="all"?"Try a different filter":"Waitlist is currently empty"})]}):t.jsx("div",{className:"space-y-3",children:k.map(y=>t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold dark:text-white",children:y.client_name||"Unknown Client"}),x(y.priority),S(y)]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[y.client_email&&t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Email:"})," ",y.client_email]}),y.client_phone&&t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Phone:"})," ",y.client_phone]}),t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Requested:"})," ",n(y.requested_date)]}),y.room_name&&t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Room:"})," ",y.room_name]}),y.booking_type&&t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Type:"})," ",y.booking_type]}),y.expires_at&&t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Expires:"})," ",n(y.expires_at)]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[y.status==="pending"&&t.jsxs("button",{onClick:()=>g(y.id),className:"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm transition-colors",children:[t.jsx(Rr,{size:16}),"Notify"]}),y.status==="notified"&&t.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 px-3 py-2 rounded-lg",children:"Awaiting response"}),t.jsx("button",{onClick:()=>p(y.id),className:"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors",title:"Remove from waitlist",children:t.jsx(oe,{size:16})})]})]}),y.booking_date&&t.jsxs("div",{className:"mt-3 pt-3 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-500 mb-1",children:"Originally requested booking:"}),t.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[y.booking_date," at ",y.booking_start_time,y.booking_end_time&&` - ${y.booking_end_time}`]})]})]},y.id))})]})}function ll({user:r,userData:s,bookingId:d}){var q;const[l,i]=u.useState([]),[c,C]=u.useState(!0),[w,N]=u.useState(!1),[g,p]=u.useState(!1),[S,x]=u.useState(null),[n,k]=u.useState({paymentType:"deposit",amount:100,dueDate:"",paymentIntentId:""});u.useEffect(()=>{j()},[d]);const j=async()=>{C(!0);try{const L=d?`/api/studio-ops/booking-payments?bookingId=${d}`:`/api/studio-ops/booking-payments?studioId=${s==null?void 0:s.id}`,_=await(await fetch(L)).json();_.success&&i(_.data)}catch(L){console.error("Error fetching payments:",L)}finally{C(!1)}},y=async L=>{L.preventDefault();try{const _=await(await fetch("/api/studio-ops/booking-payments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:d,paymentType:n.paymentType,amount:n.amount,dueDate:n.dueDate||null,paymentIntentId:n.paymentIntentId||null})})).json();_.success?(i([...l,_.data]),N(!1),b()):alert(`Error: ${_.error||"Failed to create payment"}`)}catch(Y){console.error("Error creating payment:",Y),alert("Failed to create payment. Please try again.")}},v=async L=>{L.preventDefault();try{const _=await(await fetch(`/api/studio-ops/booking-payments/${S.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();_.success?(i(l.map(W=>W.id===S.id?_.data:W)),p(!1),x(null),b()):alert(`Error: ${_.error||"Failed to update payment"}`)}catch(Y){console.error("Error updating payment:",Y),alert("Failed to update payment. Please try again.")}},F=async L=>{const Y=l.find(_=>_.id===L);if(Y.status==="completed"){alert("Cannot delete completed payments. Please create a refund instead.");return}if(confirm(`Are you sure you want to delete this ${Y.payment_type} payment of $${Y.amount}?`))try{const W=await(await fetch(`/api/studio-ops/booking-payments/${L}`,{method:"DELETE"})).json();W.success?i(l.filter(T=>T.id!==L)):alert(`Error: ${W.error||"Failed to delete payment"}`)}catch(_){console.error("Error deleting payment:",_),alert("Failed to delete payment. Please try again.")}},$=async L=>{if(confirm("Mark this payment as received? This will update payment records and booking status."))try{const _=await(await fetch(`/api/studio-ops/booking-payments/${L}/confirm`,{method:"POST"})).json();_.success?(i(l.map(W=>W.id===L?_.data.payment:W)),alert(_.message)):alert(`Error: ${_.error||"Failed to confirm payment"}`)}catch(Y){console.error("Error confirming payment:",Y),alert("Failed to confirm payment. Please try again.")}},z=L=>{x(L),k({paymentType:L.payment_type,amount:parseFloat(L.amount),dueDate:L.due_date?L.due_date.split("T")[0]:"",paymentIntentId:L.payment_intent_id||""}),p(!0)},b=()=>{k({paymentType:"deposit",amount:100,dueDate:"",paymentIntentId:""})},R=L=>{const Y={pending:{label:"Pending",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",icon:Me},processing:{label:"Processing",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:Me},completed:{label:"Paid",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:et},failed:{label:"Failed",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",icon:D},refunded:{label:"Refunded",color:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400",icon:D}},_=Y[L.status]||Y.pending,W=_.icon;return t.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full ${_.color}`,children:[t.jsx(W,{size:12}),_.label]})},E=L=>{const Y={deposit:{label:"Deposit",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},partial:{label:"Partial",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},full:{label:"Full Payment",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},refund:{label:"Refund",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}},_=Y[L]||Y.partial;return t.jsx("span",{className:`inline-flex items-center px-2 py-0.5 text-xs font-medium rounded ${_.color}`,children:_.label})},o=L=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(L),M=L=>L?new Date(L).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"No due date",h=l.reduce((L,Y)=>{const _=parseFloat(Y.amount||0);return L.total+=_,Y.status==="completed"?L.paid+=_:(Y.status==="pending"||Y.status==="processing")&&(L.pending+=_),L},{total:0,paid:0,pending:0}),P=((q=l[0])==null?void 0:q.booking_total)||0,B=Math.max(0,P-h.paid);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center text-white",children:t.jsx(Zt,{size:20})}),"Booking Payments"]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage deposits, partial payments, and refunds"})]}),t.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[t.jsx(ge,{size:18}),"Add Payment"]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:o(P)}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Booking Total"})]}),t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:o(h.paid)}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Paid"})]}),t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:o(h.pending)}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pending"})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:o(B)}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Remaining"})]})]})]}),c?t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400",children:"Loading payments..."}):l.length===0?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400",children:[t.jsx(Zt,{size:48,className:"mx-auto mb-4 text-gray-400"}),t.jsx("p",{className:"font-semibold mb-2",children:"No payments found"}),t.jsx("p",{className:"text-sm",children:"Add a payment to get started"})]}):t.jsx("div",{className:"space-y-3",children:l.map(L=>t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsxs("h3",{className:"text-lg font-semibold dark:text-white flex items-center gap-2",children:[t.jsx(qe,{size:20,className:"text-green-600"}),o(L.amount)]}),E(L.payment_type),R(L)]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Due Date:"})," ",M(L.due_date)]}),L.paid_at&&t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Paid On:"})," ",M(L.paid_at)]}),L.client_name&&t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Client:"})," ",L.client_name]}),L.booking_date&&t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Booking:"})," ",L.booking_date," at ",L.booking_start_time]}),L.payment_intent_id&&t.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Stripe Intent:"})," ",L.payment_intent_id]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[L.status==="pending"&&t.jsxs("button",{onClick:()=>$(L.id),className:"flex items-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm transition-colors",children:[t.jsx(et,{size:16}),"Confirm"]}),t.jsx("button",{onClick:()=>z(L),className:"p-2 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",title:"Edit payment",children:t.jsx(We,{size:16})}),t.jsx("button",{onClick:()=>F(L.id),className:"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors",title:"Delete payment",children:t.jsx(oe,{size:16})})]})]})},L.id))}),w&&t.jsx(Gr,{mode:"add",formData:n,setFormData:k,onSubmit:y,onClose:()=>{N(!1),b()}}),g&&S&&t.jsx(Gr,{mode:"edit",formData:n,setFormData:k,onSubmit:v,onClose:()=>{p(!1),x(null),b()}})]})}function Gr({mode:r,formData:s,setFormData:d,onSubmit:l,onClose:i}){const[c,C]=u.useState({}),w=()=>{const g={};return s.paymentType||(g.paymentType="Payment type is required"),(!s.amount||s.amount<=0)&&(g.amount="Amount must be greater than 0"),C(g),Object.keys(g).length===0},N=g=>{g.preventDefault(),w()&&l(g)};return t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-bold dark:text-white",children:r==="add"?"Add Payment":"Edit Payment"}),t.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors",children:t.jsx(D,{size:20,className:"dark:text-gray-400"})})]}),t.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Payment Type *"}),t.jsxs("select",{value:s.paymentType,onChange:g=>d({...s,paymentType:g.target.value}),className:`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-green-500 ${c.paymentType?"border-red-500":"dark:border-gray-600"}`,children:[t.jsx("option",{value:"deposit",children:"Deposit"}),t.jsx("option",{value:"partial",children:"Partial Payment"}),t.jsx("option",{value:"full",children:"Full Payment"}),t.jsx("option",{value:"refund",children:"Refund"})]}),c.paymentType&&t.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.paymentType})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount ($) *"}),t.jsx("input",{type:"number",step:"0.01",min:"0",value:s.amount,onChange:g=>d({...s,amount:parseFloat(g.target.value)}),className:`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-green-500 ${c.amount?"border-red-500":"dark:border-gray-600"}`}),c.amount&&t.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.amount})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Due Date"}),t.jsx("input",{type:"date",value:s.dueDate,onChange:g=>d({...s,dueDate:g.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-green-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Stripe Payment Intent ID"}),t.jsx("input",{type:"text",value:s.paymentIntentId,onChange:g=>d({...s,paymentIntentId:g.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-green-500",placeholder:"pi_..."})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:i,className:"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:r==="add"?"Add Payment":"Save Changes"})]})]})]})})}function nl({user:r,userData:s}){const[d,l]=u.useState(null),[i,c]=u.useState(!0),[C,w]=u.useState(!1),[N,g]=u.useState(!1),[p,S]=u.useState(null),[x,n]=u.useState({bidirectionalSync:!0,syncInterval:15,autoSync:!0,syncConfirmedOnly:!1});u.useEffect(()=>{k()},[]);const k=async()=>{c(!0);try{const b=await(await fetch(`/api/studio-ops/calendar-sync/status?studioId=${s==null?void 0:s.id}`)).json();b.success&&(l(b.data),b.data.syncSettings&&n(b.data.syncSettings))}catch(z){console.error("Error fetching sync status:",z)}finally{c(!1)}},j=async()=>{const z=prompt(`Enter your Google Calendar access token:

Note: In production, this would be handled through a proper OAuth flow with a "Connect Google Calendar" button.`);if(z)try{const R=await(await fetch("/api/studio-ops/calendar-sync/connect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studioId:s==null?void 0:s.id,accessToken:z})})).json();R.success?(l({...d,isConnected:!0,calendarName:R.data.calendarName,calendarId:R.data.calendarId}),alert("Google Calendar connected successfully!")):alert(`Error: ${R.error||"Failed to connect Google Calendar"}`)}catch(b){console.error("Error connecting Google Calendar:",b),alert("Failed to connect Google Calendar. Please try again.")}},y=async()=>{if(confirm("Are you sure you want to disconnect Google Calendar? This will stop syncing your bookings."))try{const b=await(await fetch("/api/studio-ops/calendar-sync/disconnect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studioId:s==null?void 0:s.id})})).json();b.success?(l({...d,isConnected:!1}),alert("Google Calendar disconnected successfully.")):alert(`Error: ${b.error||"Failed to disconnect Google Calendar"}`)}catch(z){console.error("Error disconnecting Google Calendar:",z),alert("Failed to disconnect Google Calendar. Please try again.")}},v=async(z="both")=>{w(!0),S(null);try{const R=await(await fetch("/api/studio-ops/calendar-sync/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studioId:s==null?void 0:s.id,direction:z})})).json();if(R.success){S(R.data),await k();const{syncedToGoogle:E,syncedFromGoogle:o,conflicts:M}=R.data;let h=`Sync completed!
`;h+=`• ${E} bookings synced to Google Calendar
`,h+=`• ${o} events synced from Google Calendar`,M.length>0&&(h+=`

⚠️ ${M.length} conflict(s) detected`),alert(h)}else alert(`Error: ${R.error||"Failed to sync with Google Calendar"}`)}catch(b){console.error("Error syncing with Google Calendar:",b),alert("Failed to sync with Google Calendar. Please try again.")}finally{w(!1)}},F=async()=>{alert("Settings saved! (Feature not fully implemented)"),g(!1)},$=z=>{if(!z)return"Never";const b=new Date(z),E=new Date-b,o=Math.floor(E/6e4);return o<1?"Just now":o<60?`${o} minute${o>1?"s":""} ago`:o<1440?`${Math.floor(o/60)} hour${Math.floor(o/60)>1?"s":""} ago`:b.toLocaleDateString()};return i?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400",children:[t.jsx(Qt,{className:"animate-spin mx-auto mb-4",size:32}),t.jsx("p",{children:"Loading calendar sync status..."})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white",children:t.jsx(de,{size:20})}),"Google Calendar Sync"]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Two-way synchronization between your bookings and Google Calendar"})]}),t.jsx("div",{className:"flex items-center gap-2",children:(d==null?void 0:d.isConnected)&&t.jsxs("button",{onClick:()=>g(!N),className:"flex items-center gap-2 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[t.jsx(Et,{size:18}),"Settings"]})})]}),t.jsx("div",{className:`p-4 rounded-lg border ${d!=null&&d.isConnected?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800":"bg-gray-50 border-gray-200 dark:bg-gray-800 dark:border-gray-700"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[d!=null&&d.isConnected?t.jsx(et,{className:"text-green-600 dark:text-green-400",size:24}):t.jsx(Ar,{className:"text-gray-400 dark:text-gray-500",size:24}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold dark:text-white",children:d!=null&&d.isConnected?"Connected":"Not Connected"}),(d==null?void 0:d.isConnected)&&t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:d.calendarName||d.calendarId})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Last Synced"}),t.jsx("div",{className:"font-medium dark:text-white",children:$(d==null?void 0:d.lastSyncedAt)})]})]})}),t.jsx("div",{className:"flex items-center gap-3 mt-4",children:d!=null&&d.isConnected?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>v("both"),disabled:C,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:[C?t.jsx(Qt,{className:"animate-spin",size:18}):t.jsx(dt,{size:18}),C?"Syncing...":"Sync Now"]}),t.jsx("button",{onClick:()=>v("to-google"),disabled:C,className:"flex items-center gap-2 px-4 py-2 border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:bg-gray-100 dark:disabled:bg-gray-800 rounded-lg dark:text-gray-300 transition-colors",children:"Upload to Google"}),t.jsx("button",{onClick:()=>v("from-google"),disabled:C,className:"flex items-center gap-2 px-4 py-2 border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:bg-gray-100 dark:disabled:bg-gray-800 rounded-lg dark:text-gray-300 transition-colors",children:"Download from Google"}),t.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[t.jsx(Zs,{size:18}),"Disconnect"]})]}):t.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[t.jsx(Ar,{size:18}),"Connect Google Calendar"]})})]}),N&&(d==null?void 0:d.isConnected)&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6",children:[t.jsxs("h3",{className:"text-lg font-semibold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(Et,{size:18}),"Sync Settings"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:"Bidirectional Sync"}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sync changes both ways between SeshNx and Google Calendar"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:x.bidirectionalSync,onChange:z=>n({...x,bidirectionalSync:z.target.checked}),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:"Auto Sync"}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Automatically sync when bookings are created or modified"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:x.autoSync,onChange:z=>n({...x,autoSync:z.target.checked}),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:"Sync Confirmed Bookings Only"}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Only sync bookings that have been confirmed (skip pending)"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:x.syncConfirmedOnly,onChange:z=>n({...x,syncConfirmedOnly:z.target.checked}),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sync Interval (minutes)"}),t.jsx("input",{type:"number",min:"1",max:"60",value:x.syncInterval,onChange:z=>n({...x,syncInterval:parseInt(z.target.value)}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{onClick:F,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Save Settings"}),t.jsx("button",{onClick:()=>g(!1),className:"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Cancel"})]})]})]}),p&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6",children:[t.jsxs("h3",{className:"text-lg font-semibold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(Me,{size:18}),"Sync Results"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:p.syncedToGoogle}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Synced to Google Calendar"})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:p.syncedFromGoogle}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Synced from Google Calendar"})]})]}),p.conflicts&&p.conflicts.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Be,{className:"text-yellow-600 dark:text-yellow-400",size:20}),t.jsx("h4",{className:"font-semibold dark:text-white",children:"Conflicts Detected"}),t.jsx("span",{className:"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400 rounded-full",children:p.conflicts.length})]}),t.jsx("div",{className:"space-y-2",children:p.conflicts.map((z,b)=>t.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:[t.jsx("div",{className:"text-sm font-medium dark:text-white",children:z.message}),z.bookingTime&&t.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["Booking: ",z.bookingTime," vs Google: ",z.googleEventTime]})]},b))})]}),p.errors&&p.errors.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Be,{className:"text-red-600 dark:text-red-400",size:20}),t.jsx("h4",{className:"font-semibold dark:text-white",children:"Errors"}),t.jsx("span",{className:"px-2 py-0.5 text-xs bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-full",children:p.errors.length})]}),t.jsx("div",{className:"space-y-2",children:p.errors.map((z,b)=>t.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[t.jsx("div",{className:"text-sm font-medium dark:text-white",children:z.message}),z.bookingId&&t.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["Booking ID: ",z.bookingId]})]},b))})]})]}),t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 p-6",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(Be,{className:"text-blue-600 dark:text-blue-400 flex-shrink-0 mt-1",size:20}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold dark:text-white mb-2",children:"How Google Calendar Sync Works"}),t.jsxs("ul",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-1",children:[t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Two-way sync:"})," Changes in SeshNx sync to Google, and Google events are checked for conflicts"]}),t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Conflict detection:"})," Warnings appear when Google Calendar events overlap with existing bookings"]}),t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Automatic updates:"})," When enabled, bookings automatically update in Google Calendar when modified"]}),t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Event tracking:"})," Each booking tracks its Google Calendar event ID for accurate synchronization"]})]})]})]})})]})}function il({user:r,userData:s,onNavigateToChat:d}){const[l,i]=u.useState("bookings"),[c,C]=u.useState([]),[w,N]=u.useState([]),[g,p]=u.useState(!0),[S,x]=u.useState("all"),[n,k]=u.useState(""),[j,y]=u.useState(null),[v,F]=u.useState(null),[$,z]=u.useState("list"),[b,R]=u.useState("month"),[E,o]=u.useState(new Date),[M,h]=u.useState(!1),[P,B]=u.useState(null),[q,L]=u.useState(""),[Y,_]=u.useState("full"),[W,T]=u.useState("09:00"),[J,G]=u.useState("17:00"),[Q,me]=u.useState(!1),[_e,re]=u.useState(!1),[ee,ze]=u.useState(null),[te,$e]=u.useState(null);u.useEffect(()=>{if(!(s!=null&&s.id))return;se();const I=setInterval(()=>{se()},3e4);return()=>clearInterval(I)},[s==null?void 0:s.id]);const se=async()=>{if(s!=null&&s.id){p(!0);try{const I=await fetch(`/api/studio-ops/bookings?studioId=${s==null?void 0:s.id}`);if(!I.ok)throw new Error("Failed to fetch bookings");const V=await I.json();if(V.success)C(V.data||[]);else throw new Error(V.error||"Failed to load bookings")}catch(I){console.error("Error fetching bookings:",I),H.error("Failed to load bookings"),C([])}finally{p(!1)}}};u.useEffect(()=>{if(!(s!=null&&s.id))return;Fe();const I=setInterval(()=>{Fe()},3e4);return()=>clearInterval(I)},[s==null?void 0:s.id]);const Fe=async()=>{if(s!=null&&s.id)try{const I=await fetch(`/api/studio-ops/blocked-dates?studioId=${s==null?void 0:s.id}`);if(!I.ok)throw new Error("Failed to fetch blocked dates");const V=await I.json();if(V.success)N(V.data||[]);else throw new Error(V.error||"Failed to load blocked dates")}catch(I){console.error("Error fetching blocked dates:",I),H.error("Failed to load blocked dates"),N([])}},le=async(I,V)=>{F(I);const X=H.loading("Updating booking...");try{const ae=await fetch(`/api/studio-ops/bookings/${I}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:V})}),He=await ae.json();if(!ae.ok||!He.success)throw new Error(He.error||"Failed to update booking");H.success(`Booking ${V}!`,{id:X}),await se()}catch(ae){console.error("Update failed:",ae),H.error(ae.message||"Failed to update booking",{id:X})}finally{F(null)}},xt=async()=>{if(!P||!(s!=null&&s.id))return;const I=H.loading("Blocking time slot...");try{const V=await fetch("/api/studio-ops/blocked-dates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studioId:s==null?void 0:s.id,date:P.toISOString(),reason:q||"Off-platform booking",timeSlot:Y,startTime:Y==="custom"?W:null,endTime:Y==="custom"?J:null})}),X=await V.json();if(!V.ok||!X.success)throw new Error(X.error||"Failed to block time slot");H.success("Time slot blocked!",{id:I}),h(!1),L(""),_("full"),B(null),await Fe()}catch(V){console.error("Error blocking date:",V),H.error(V.message||"Failed to block time slot. Please try again.",{id:I})}},ce=async I=>{const V=H.loading("Removing block...");try{const X=await fetch(`/api/studio-ops/blocked-dates/${I}`,{method:"DELETE"}),ae=await X.json();if(!X.ok||!ae.success)throw new Error(ae.error||"Failed to remove block");H.success("Block removed!",{id:V}),await Fe()}catch(X){console.error("Error unblocking date:",X),H.error("Failed to remove block",{id:V})}},gt=I=>{B(I),h(!0)},tt=c.filter(I=>{var ie,st;const V=(I.status||"").toLowerCase(),X=S.toLowerCase(),ae=S==="all"||V===X,He=!n||((ie=I.clientName)==null?void 0:ie.toLowerCase().includes(n.toLowerCase()))||((st=I.roomName)==null?void 0:st.toLowerCase().includes(n.toLowerCase()));return ae&&He}),Mt=tt.reduce((I,V)=>{if(!V.date)return I;const X=V.date.toDateString();return I[X]||(I[X]=[]),I[X].push(V),I},{}),rt=c.filter(I=>(I.status||"").toLowerCase()==="pending").length,$t=c.filter(I=>{if(!I.date)return!1;const V=new Date().toDateString();return I.date.toDateString()===V&&(I.status||"").toLowerCase()==="confirmed"}).length,mt=c.filter(I=>I.date?(I.status||"").toLowerCase()==="confirmed"&&I.date>=new Date:!1).reduce((I,V)=>I+(V.totalPrice||V.offer_amount||0),0);return g?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Qt,{className:"animate-spin text-brand-blue",size:32})}):t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(de,{className:"text-brand-blue",size:24}),"Booking Management"]}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[c.length," total bookings • ",w.length," blocked slots"]})]}),l==="bookings"&&t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex",children:[t.jsx("button",{onClick:()=>z("list"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition ${$==="list"?"bg-white dark:bg-gray-700 text-brand-blue shadow-sm":"text-gray-500"}`,children:"List"}),t.jsx("button",{onClick:()=>z("calendar"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition ${$==="calendar"?"bg-white dark:bg-gray-700 text-brand-blue shadow-sm":"text-gray-500"}`,children:"Calendar"})]})})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-2 flex flex-wrap gap-2",children:[t.jsxs("button",{onClick:()=>i("bookings"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${l==="bookings"?"bg-brand-blue text-white":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[t.jsx(de,{size:16}),"Bookings"]}),t.jsxs("button",{onClick:()=>i("templates"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${l==="templates"?"bg-orange-600 text-white":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[t.jsx(ls,{size:16}),"Templates"]}),t.jsxs("button",{onClick:()=>i("waitlist"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${l==="waitlist"?"bg-blue-600 text-white":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[t.jsx(ke,{size:16}),"Waitlist"]}),t.jsxs("button",{onClick:()=>i("payments"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${l==="payments"?"bg-green-600 text-white":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[t.jsx(Zt,{size:16}),"Payments"]}),t.jsxs("button",{onClick:()=>i("calendar-sync"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${l==="calendar-sync"?"bg-indigo-600 text-white":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[t.jsx(de,{size:16}),"Calendar Sync"]})]}),l==="bookings"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl border border-amber-200 dark:border-amber-800",children:[t.jsx("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:rt}),t.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Pending Approval"})]}),t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:$t}),t.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Today's Sessions"})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[t.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:["$",mt.toLocaleString()]}),t.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Upcoming Revenue"})]})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),t.jsx("input",{type:"text",value:n,onChange:I=>k(I.target.value),placeholder:"Search by client or room...",className:"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsx("div",{className:"flex gap-2",children:["all","pending","confirmed","completed","cancelled"].map(I=>t.jsxs("button",{onClick:()=>x(I),className:`px-4 py-2 rounded-lg font-medium text-sm transition ${S===I?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[I.charAt(0).toUpperCase()+I.slice(1),I==="pending"&&rt>0&&t.jsx("span",{className:"ml-1.5 bg-amber-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:rt})]},I))})]}),$==="calendar"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx(Da,{currentDate:E,onDateChange:o,view:b,onViewChange:R,bookings:c,blockedDates:w,onDateClick:I=>{const V=new Date;I<new Date(V.getFullYear(),V.getMonth(),V.getDate())||gt(I)},onBookingClick:(I,V)=>{y(I)},showControls:!0}),w.length>0&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-4",children:[t.jsxs("h4",{className:"font-bold text-sm dark:text-white mb-3 flex items-center gap-2",children:[t.jsx(Ke,{size:14,className:"text-red-500"}),"Blocked Time Slots"]}),t.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:w.map(I=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg border dark:border-gray-700",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium dark:text-white text-sm",children:[new Date(I.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),I.time_slot&&I.time_slot!=="full"&&t.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",I.time_slot==="custom"?`${I.start_time||""} - ${I.end_time||""}`:I.time_slot,")"]})]}),t.jsx("div",{className:"text-xs text-gray-500",children:I.reason})]}),t.jsx("button",{onClick:()=>ce(I.id),className:"p-1.5 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition",title:"Remove block",children:t.jsx(oe,{size:16})})]},I.id))})]})]}),$==="list"&&t.jsx(t.Fragment,{children:tt.length===0?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center",children:[t.jsx(de,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),t.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Bookings Found"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:S!=="all"?`No ${S} bookings`:"Bookings will appear here when clients book your studio"})]}):t.jsx("div",{className:"space-y-6",children:Object.entries(Mt).map(([I,V])=>t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-3 flex items-center gap-2",children:[t.jsx(de,{size:14}),new Date(I).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),t.jsxs("span",{className:"text-gray-400",children:["(",V.length,")"]})]}),t.jsx("div",{className:"space-y-3",children:V.map(X=>{const ae=getStatusConfig(X.status);return t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:t.jsxs("div",{className:"p-4 flex items-center gap-4",children:[t.jsxs("div",{className:"text-center min-w-[70px]",children:[t.jsx("div",{className:"text-lg font-bold dark:text-white",children:X.startTime}),t.jsxs("div",{className:"text-xs text-gray-500",children:[X.duration,"h"]})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-bold dark:text-white truncate",children:X.clientName||"Unknown Client"}),t.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${ae.bgClass}`,children:ae.label})]}),t.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[X.roomName||"Main Room"," • $",X.totalPrice||0]}),X.notes&&t.jsxs("div",{className:"text-xs text-gray-400 mt-1 truncate",children:["Note: ",X.notes]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[(X.status||"").toLowerCase()==="pending"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>le(X.id,"Confirmed"),disabled:v===X.id,className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition",title:"Approve",children:t.jsx(et,{size:18})}),t.jsx("button",{onClick:()=>le(X.id,"Cancelled"),disabled:v===X.id,className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition",title:"Decline",children:t.jsx(D,{size:18})})]}),(X.status||"").toLowerCase()==="confirmed"&&t.jsx("button",{onClick:()=>le(X.id,"Completed"),disabled:v===X.id,className:"px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium",children:"Mark Complete"}),X.clientId&&d&&t.jsx("button",{onClick:()=>d(X.clientId),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Message Client",children:t.jsx(Qs,{size:18})}),t.jsx("button",{onClick:()=>y(X),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"View Details",children:t.jsx(lr,{size:18})})]})]})},X.id)})})]},I))})}),M&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-md w-full",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Ke,{size:18,className:"text-red-500"}),"Block Time Slot"]}),t.jsx("button",{onClick:()=>{h(!1),B(null),L("")},children:t.jsx(D,{size:20,className:"text-gray-500"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg text-center",children:[t.jsx("div",{className:"text-sm text-gray-500 uppercase font-bold mb-1",children:"Selected Date"}),t.jsx("div",{className:"text-lg font-bold dark:text-white",children:P==null?void 0:P.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Time Slot"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"full",label:"Full Day"},{id:"morning",label:"Morning (6AM-12PM)"},{id:"afternoon",label:"Afternoon (12PM-6PM)"},{id:"evening",label:"Evening (6PM-12AM)"}].map(I=>t.jsx("button",{onClick:()=>_(I.id),className:`p-2 text-sm rounded-lg border transition ${Y===I.id?"bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400":"border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300"}`,children:I.label},I.id))}),t.jsx("button",{onClick:()=>_("custom"),className:`w-full mt-2 p-2 text-sm rounded-lg border transition ${Y==="custom"?"bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400":"border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300"}`,children:"Custom Time Range"}),Y==="custom"&&t.jsxs("div",{className:"flex gap-2 mt-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"Start"}),t.jsx("input",{type:"time",value:W,onChange:I=>T(I.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"End"}),t.jsx("input",{type:"time",value:J,onChange:I=>G(I.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Reason (optional)"}),t.jsx("input",{type:"text",value:q,onChange:I=>L(I.target.value),placeholder:"e.g., Private session, Maintenance, Personal...",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{onClick:()=>{h(!1),B(null),L("")},className:"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Cancel"}),t.jsxs("button",{onClick:xt,className:"flex-1 py-2.5 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition flex items-center justify-center gap-2",children:[t.jsx(Ke,{size:16}),"Block Time"]})]})]})]})}),j&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsx("h3",{className:"font-bold dark:text-white",children:"Booking Details"}),t.jsx("button",{onClick:()=>y(null),children:t.jsx(D,{size:20,className:"text-gray-500"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-brand-blue/10 rounded-full flex items-center justify-center",children:t.jsx(Dt,{className:"text-brand-blue",size:24})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-bold dark:text-white",children:j.clientName}),t.jsx("div",{className:"text-sm text-gray-500",children:j.clientEmail})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Date"}),t.jsx("div",{className:"dark:text-white",children:j.date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Time"}),t.jsxs("div",{className:"dark:text-white",children:[j.startTime," (",j.duration,"h)"]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Room"}),t.jsx("div",{className:"dark:text-white",children:j.roomName})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Total"}),t.jsxs("div",{className:"dark:text-white font-bold text-green-600",children:["$",j.totalPrice||j.offer_amount||0]})]})]}),j.notes&&t.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-amber-600 uppercase font-bold mb-1",children:"Client Notes"}),t.jsx("div",{className:"text-amber-800 dark:text-amber-300 text-sm",children:j.notes})]}),t.jsx("div",{className:"flex gap-2 pt-2 border-t dark:border-gray-700",children:(j.status||"").toLowerCase()==="confirmed"&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>{ze(j),me(!0)},className:"flex-1 py-2 px-3 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-900/50 transition text-sm font-medium flex items-center justify-center gap-2",children:[t.jsx(Repeat,{size:14}),"Make Recurring"]}),(s==null?void 0:s.rooms)&&s.rooms.length>0&&t.jsxs("button",{onClick:()=>{$e(j),re(!0)},className:"flex-1 py-2 px-3 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium flex items-center justify-center gap-2",children:[t.jsx(Home,{size:14}),"Assign Rooms"]})]})}),t.jsxs("div",{className:"text-xs text-gray-400 pt-2",children:["Booked ",j.createdAt&&j.createdAt instanceof Date?j.createdAt.toLocaleDateString():new Date(j.created_at||j.timestamp||Date.now()).toLocaleDateString()]})]})]})}),Q&&ee&&t.jsx(Za,{booking:ee,onClose:()=>{me(!1),ze(null)},onSuccess:()=>{se()}}),_e&&te&&t.jsx(Qa,{booking:te,rooms:(s==null?void 0:s.rooms)||[],onClose:()=>{re(!1),$e(null)},onSuccess:()=>{se()}})]}),l==="templates"&&t.jsx(sl,{user:r,userData:s}),l==="waitlist"&&t.jsx(al,{user:r,userData:s}),l==="payments"&&t.jsx(ll,{user:r,userData:s}),l==="calendar-sync"&&t.jsx(nl,{user:r,userData:s})]})}function dl(r){if(!r)return"other";const s=r.toLowerCase().trim(),d={microphones:"microphones","microphones & transducers":"microphones","audio interfaces":"audio_interfaces",preamps:"preamps","preamps & channel strips":"preamps","mixing consoles":"mixing_consoles","mixers & consoles":"mixing_consoles","mixing consoles & mixers":"mixing_consoles","studio monitors":"monitors",monitors:"monitors",headphones:"headphones","outboard gear":"outboard_processing","outboard processing":"outboard_processing","effects processors":"effects_processors",converters:"converters","ad/da converters":"converters","recording devices":"recorders",recorders:"recorders","electric guitars":"electric_guitars","acoustic guitars":"acoustic_guitars","bass guitars":"bass_guitars","guitar amps":"guitar_amps","guitar & bass amplifiers":"guitar_amps","guitar effects":"guitar_effects","guitar pedals":"guitar_effects",synthesizers:"synthesizers",keyboards:"keyboards","midi controllers":"midi_controllers",pianos:"pianos","drum kits":"drum_kits","electronic drums":"electronic_drums","drum machines":"drum_machines","string instruments":"string_instruments","wind instruments":"wind_instruments","pa speakers":"pa_speakers","power amps":"power_amps","live mixers":"live_mixers","wireless systems":"wireless_systems","in ear monitors":"in_ear_monitors","stage gear":"stage_gear",turntables:"turntables","dj controllers":"dj_controllers","dj mixers":"dj_mixers",cables:"cables",patchbays:"patchbays","acoustic treatment":"acoustic_treatment","studio furniture":"studio_furniture",computers:"computers","software licenses":"software_licenses","storage drives":"storage_drives","stands & mounts":"stands_mounts","cases & bags":"cases_bags","vintage gear":"vintage_gear"};if(d[s])return d[s];for(const[i,c]of Object.entries(d))if(s.includes(i)||i.includes(s))return c;const l=Tt.find(i=>i.label.toLowerCase()===s||i.label.toLowerCase().includes(s)||s.includes(i.label.toLowerCase()));return l?l.id:"other"}function ol({user:r,userData:s,onUpdate:d}){const[l,i]=u.useState((s==null?void 0:s.studioEquipment)||[]),[c,C]=u.useState(!1),[w,N]=u.useState(""),[g,p]=u.useState("all"),[S,x]=u.useState(!1),[n,k]=u.useState(null),j=async h=>{C(!0);const P=H.loading("Saving equipment..."),B=(s==null?void 0:s.id)||(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const q=await fetch(`/api/studio-ops/profiles/${B}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({studioEquipment:h})}),L=await q.json();if(!q.ok)throw new Error(L.error||"Failed to save");i(h),H.success("Equipment saved!",{id:P}),d&&d({studioEquipment:h})}catch(q){console.error("Save failed:",q),H.error("Failed to save",{id:P})}finally{C(!1)}},y=async h=>{const P={...h,id:Date.now().toString(),addedAt:new Date().toISOString()};await j([...l,P]),x(!1)},v=async h=>{const P=l.map(B=>B.id===h.id?h:B);await j(P),k(null)},F=async h=>{if(!confirm("Remove this item from inventory?"))return;const P=l.filter(B=>B.id!==h);await j(P)},$=l.filter(h=>{var q,L,Y;const P=!w||((q=h.name)==null?void 0:q.toLowerCase().includes(w.toLowerCase()))||((L=h.brand)==null?void 0:L.toLowerCase().includes(w.toLowerCase()))||((Y=h.model)==null?void 0:Y.toLowerCase().includes(w.toLowerCase())),B=g==="all"||h.category===g;return P&&B}),z=$.reduce((h,P)=>{const B=P.category||"Other";return h[B]||(h[B]=[]),h[B].push(P),h},{}),b=[...new Set(l.map(h=>h.category).filter(Boolean))],R=l.length,E=l.reduce((h,P)=>h+(parseFloat(P.value)||0),0),o=h=>({microphones_and_input_transducers:ts,monitoring_and_playback:ea,mixing_consoles_and_control:Ds,outboard_signal_processing:Lr,computer_audio_and_interfaces:Lr})[h]||Ct,M=h=>{const P=Tt.find(B=>B.id===h);return(P==null?void 0:P.label)||h};return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Ct,{className:"text-brand-blue",size:24}),"Equipment Inventory"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage your studio gear and equipment"})]}),t.jsxs("button",{onClick:()=>x(!0),className:"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2",children:[t.jsx(ge,{size:18})," Add Equipment"]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:R}),t.jsx("div",{className:"text-sm text-gray-500",children:"Total Items"})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",E.toLocaleString()]}),t.jsx("div",{className:"text-sm text-gray-500",children:"Est. Value"})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:b.length}),t.jsx("div",{className:"text-sm text-gray-500",children:"Categories"})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsx("div",{className:"text-2xl font-bold text-brand-blue",children:l.filter(h=>h.featured).length}),t.jsx("div",{className:"text-sm text-gray-500",children:"Featured Items"})]})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),t.jsx("input",{type:"text",value:w,onChange:h=>N(h.target.value),placeholder:"Search equipment...",className:"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("select",{value:g,onChange:h=>p(h.target.value),className:"px-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[t.jsx("option",{value:"all",children:"All Categories"}),Tt.map(h=>t.jsx("option",{value:h.id,children:h.label},h.id))]})]}),$.length===0?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center",children:[t.jsx(Ct,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),t.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Equipment Found"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:w||g!=="all"?"Try adjusting your filters":"Add your studio equipment to showcase your gear"}),t.jsx("button",{onClick:()=>x(!0),className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition",children:"Add Your First Item"})]}):t.jsx("div",{className:"space-y-6",children:Object.entries(z).map(([h,P])=>{const B=o(h);return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-[#23262f] border-b dark:border-gray-700 flex items-center gap-3",children:[t.jsx(B,{className:"text-brand-blue",size:20}),t.jsx("h3",{className:"font-bold dark:text-white",children:M(h)}),t.jsxs("span",{className:"text-sm text-gray-500",children:["(",P.length,")"]})]}),t.jsx("div",{className:"divide-y dark:divide-gray-700",children:P.map(q=>t.jsxs("div",{className:"p-4 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-[#23262f] transition",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"font-bold dark:text-white",children:[q.brand&&t.jsx("span",{className:"text-gray-500 font-medium",children:q.brand})," ",q.name||q.model]}),q.quantity&&q.quantity>1&&t.jsxs("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 px-2 py-0.5 rounded font-medium",children:["Qty: ",q.quantity]}),q.featured&&t.jsx("span",{className:"text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 px-2 py-0.5 rounded",children:"Featured"})]}),t.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[q.model&&q.name!==q.model&&t.jsx("span",{children:q.model}),q.serial&&t.jsxs("span",{className:"ml-2",children:["S/N: ",q.serial]})]}),q.notes&&t.jsx("div",{className:"text-xs text-gray-400 mt-1",children:q.notes})]}),q.value&&t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:["$",parseFloat(q.value).toLocaleString()]})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>k(q),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",children:t.jsx(We,{size:16})}),t.jsx("button",{onClick:()=>F(q.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:t.jsx(oe,{size:16})})]})]},q.id))})]},h)})}),(S||n)&&t.jsx(cl,{item:n,onSave:n?v:y,onClose:()=>{x(!1),k(null)},saving:c})]})}function cl({item:r,onSave:s,onClose:d,saving:l}){const[i,c]=u.useState(r||{name:"",brand:"",model:"",category:"",serial:"",value:"",notes:"",featured:!1,quantity:1}),C=()=>{if(!i.name&&!i.model){H.error("Name or model is required");return}s(i)},w=N=>{const g=dl(N.category);c(p=>({...p,name:N.name||p.name,brand:N.brand||p.brand,model:N.model||p.model,category:g}))};return t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto animate-in zoom-in-95",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsx("h3",{className:"font-bold dark:text-white",children:r?"Edit Equipment":"Add Equipment"}),t.jsx("button",{onClick:d,children:t.jsx(D,{size:20,className:"text-gray-500"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:["Search Equipment Database",t.jsx("span",{className:"text-gray-400 font-normal ml-2",children:"(Recommended)"})]}),t.jsx(ds,{onSelect:w,placeholder:"Search for equipment (e.g. U87, SSL, Fender Twin)...",className:"w-full"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Start typing to search from verified equipment database"})]}),t.jsxs("div",{className:"border-t dark:border-gray-700 pt-4 space-y-4",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:[t.jsx("p",{className:"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2",children:"Or enter manually:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),t.jsx("input",{value:i.brand,onChange:N=>c({...i,brand:N.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"e.g. Neumann"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model *"}),t.jsx("input",{value:i.model||i.name,onChange:N=>c({...i,model:N.target.value,name:N.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"e.g. U87"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),t.jsxs("select",{value:i.category,onChange:N=>c({...i,category:N.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[t.jsx("option",{value:"",children:"Select category..."}),Tt.map(N=>t.jsx("option",{value:N.id,children:N.label},N.id))]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Quantity"}),t.jsx("input",{type:"number",min:"1",value:i.quantity||1,onChange:N=>c({...i,quantity:parseInt(N.target.value)||1}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"1"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Serial Number"}),t.jsx("input",{value:i.serial,onChange:N=>c({...i,serial:N.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"Optional"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Value ($)"}),t.jsx("input",{type:"number",value:i.value,onChange:N=>c({...i,value:N.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"Estimated value"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Notes"}),t.jsx("textarea",{value:i.notes,onChange:N=>c({...i,notes:N.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:2,placeholder:"Additional details..."})]}),t.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-[#1f2128] rounded-xl cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:i.featured,onChange:N=>c({...i,featured:N.target.checked}),className:"w-4 h-4 text-brand-blue rounded"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white text-sm",children:"Featured Equipment"}),t.jsx("div",{className:"text-xs text-gray-500",children:"Highlight this item on your studio profile"})]})]})]})]}),t.jsxs("div",{className:"p-4 border-t dark:border-gray-700 flex justify-end gap-3",children:[t.jsx("button",{onClick:d,className:"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl font-medium",children:"Cancel"}),t.jsxs("button",{onClick:C,disabled:l,className:"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[l?t.jsx(be,{className:"animate-spin",size:18}):t.jsx(Ce,{size:18}),r?"Update":"Add Item"]})]})]})})}const xl=sa({studioName:xe().min(3,"Studio name is required"),address:xe().min(5,"Address is required"),city:xe().optional(),state:xe().optional(),zip:xe().optional(),lat:Ir().optional(),lng:Ir().optional(),studioDescription:xe().max(1e3).optional(),email:xe().email().optional().or(Br("")),phoneCell:xe().optional(),phoneLand:xe().optional(),website:xe().url().optional().or(Br("")),hours:xe().optional(),amenities:ia(xe()).optional(),hideAddress:na().optional()});function gl({user:r,userData:s,onUpdate:d}){const[l,i]=u.useState(!1),{register:c,control:C,handleSubmit:w,watch:N,setValue:g,formState:{errors:p,isDirty:S}}=ta({resolver:ra(xl),defaultValues:{studioName:(s==null?void 0:s.studioName)||(s==null?void 0:s.profileName)||"",address:(s==null?void 0:s.address)||"",city:(s==null?void 0:s.city)||"",state:(s==null?void 0:s.state)||"",zip:(s==null?void 0:s.zip)||"",lat:s==null?void 0:s.lat,lng:s==null?void 0:s.lng,studioDescription:(s==null?void 0:s.studioDescription)||"",email:(s==null?void 0:s.email)||"",phoneCell:(s==null?void 0:s.phoneCell)||"",phoneLand:(s==null?void 0:s.phoneLand)||"",website:(s==null?void 0:s.website)||"",hours:(s==null?void 0:s.hours)||"",amenities:(s==null?void 0:s.amenities)||[],hideAddress:(s==null?void 0:s.hideAddress)||!1}}),x=N("amenities"),n=N("hideAddress"),k=v=>{const F=x||[];F.includes(v)?g("amenities",F.filter($=>$!==v),{shouldDirty:!0}):g("amenities",[...F,v],{shouldDirty:!0})},j=async v=>{i(!0);const F=H.loading("Saving settings..."),$=(s==null?void 0:s.id)||(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const z=await fetch(`/api/studio-ops/profiles/${$}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({studioName:v.studioName,profileName:v.studioName,address:v.address,city:v.city,state:v.state,zip:v.zip,lat:v.lat,lng:v.lng,studioDescription:v.studioDescription,email:v.email,phoneCell:v.phoneCell,phoneLand:v.phoneLand,website:v.website,hours:v.hours,amenities:v.amenities,hideAddress:v.hideAddress})}),b=await z.json();if(!z.ok)throw new Error(b.error||"Failed to save");H.success("Settings saved!",{id:F}),d&&d(v)}catch(z){console.error("Save failed",z),H.error("Failed to save settings.",{id:F})}finally{i(!1)}},y=v=>`w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none ${v?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200"}`;return t.jsxs("form",{onSubmit:w(j),className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Et,{className:"text-brand-blue",size:24}),"Studio Settings"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Basic information and contact details"})]}),t.jsxs("button",{type:"submit",disabled:l||!S,className:`px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 transition ${l||!S?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600"}`,children:[l?t.jsx(be,{className:"animate-spin",size:18}):t.jsx(Ce,{size:18}),"Save Changes"]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(je,{size:18,className:"text-brand-blue"}),"General Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio Name *"}),t.jsx("input",{...c("studioName"),className:y(p.studioName),placeholder:"Your Studio Name"}),p.studioName&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.studioName.message})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Description"}),t.jsx("textarea",{...c("studioDescription"),rows:3,className:y(p.studioDescription),placeholder:"Describe your studio, the vibe, and what makes it special..."})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(_t,{size:18,className:"text-brand-blue"}),"Location"]}),t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800 mb-4",children:t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",...c("hideAddress"),className:"w-5 h-5 mt-0.5 text-brand-blue rounded"}),t.jsxs("div",{children:[t.jsxs("div",{className:"font-bold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[t.jsx(as,{size:16,className:"text-brand-blue"}),"Private Home Studio Mode"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your exact address will be hidden from the public map. It will only be revealed after you approve a booking request."})]})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(aa,{control:C,name:"address",render:({field:{onChange:v,value:F}})=>{var $;return t.jsx(fa,{label:"Street Address",value:F||"",onChange:v,onSelect:z=>{z.lat&&g("lat",z.lat),z.lng&&g("lng",z.lng),z.city&&g("city",z.city,{shouldDirty:!0}),z.state&&g("state",z.state,{shouldDirty:!0}),z.zip&&g("zip",z.zip,{shouldDirty:!0})},placeholder:"Start typing your address...",error:($=p.address)==null?void 0:$.message,required:!0})}}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"City"}),t.jsx("input",{...c("city"),className:y(),placeholder:"City"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"State"}),t.jsx("input",{...c("state"),className:y(),placeholder:"State"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"ZIP"}),t.jsx("input",{...c("zip"),className:y(),placeholder:"ZIP Code"})]})]})]}),n&&t.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-amber-600 dark:text-amber-400",children:[t.jsx(es,{size:16}),t.jsx("span",{children:"Address will be hidden until booking approval"})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(Pt,{size:18,className:"text-brand-blue"}),"Contact Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Email"}),t.jsx("input",{...c("email"),type:"email",className:y(p.email),placeholder:"studio@email.com"}),p.email&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.email.message})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Website"}),t.jsx("input",{...c("website"),className:y(p.website),placeholder:"https://yourstudio.com"}),p.website&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.website.message})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Cell Phone"}),t.jsx("input",{...c("phoneCell"),className:y(),placeholder:"(555) 123-4567"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Landline"}),t.jsx("input",{...c("phoneLand"),className:y(),placeholder:"(555) 123-4567"})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hours of Operation"}),t.jsx("input",{...c("hours"),className:y(),placeholder:"e.g. Mon-Fri 9AM-10PM, Sat-Sun 10AM-8PM"})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(la,{size:18,className:"text-brand-blue"}),"Amenities"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Na.map(v=>t.jsx("button",{type:"button",onClick:()=>k(v),className:`px-3 py-2 rounded-lg text-sm font-medium transition-all border ${x!=null&&x.includes(v)?"bg-brand-blue text-white border-brand-blue shadow-md":"bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:v},v))})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs("button",{type:"submit",disabled:l||!S,className:`px-8 py-3 rounded-xl font-bold text-lg flex items-center gap-2 transition shadow-lg ${l||!S?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"}`,children:[l?t.jsx(be,{className:"animate-spin",size:20}):t.jsx(Ce,{size:20}),"Save Settings"]})})]})}function ml({client:r,onClose:s,onUpdate:d,studioId:l,mode:i="view"}){var E;const[c,C]=u.useState(i==="edit"),[w,N]=u.useState(i==="add"),[g,p]=u.useState("off-platform"),[S,x]=u.useState(""),[n,k]=u.useState([]),[j,y]=u.useState(!1),[v,F]=u.useState({name:"",email:"",phone:"",company:"",client_type:"regular",notes:"",client_id:null});u.useEffect(()=>{r&&!w&&F({name:r.name||"",email:r.email||"",phone:r.phone||"",company:r.company||"",client_type:r.client_type||"regular",notes:r.notes||"",client_id:r.client_id||null})},[r,w]);const $=async()=>{if(!(!S.trim()||j)){y(!0);try{const M=await(await fetch(`/api/studio-ops/clients/search-users?search=${encodeURIComponent(S)}&studioId=${l}&limit=10`)).json();M.success?k(M.data):console.error("Search failed:",M.error)}catch(o){console.error("Error searching users:",o)}finally{y(!1)}}},z=o=>{F({...v,name:o.display_name||o.profile_name||o.username,email:o.email,client_id:o.user_id,company:""}),k([]),x("")},b=async()=>{try{const o=w?"/api/studio-ops/clients":`/api/studio-ops/clients/${r.id}`,P=await(await fetch(o,{method:w?"POST":"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...v,studioId:l,clientType:v.client_type})})).json();P.success?(d(P.data),s()):alert(`Error: ${P.error||"Failed to save client"}`)}catch(o){console.error("Error saving client:",o),alert("Failed to save client. Please try again.")}},R=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o||0);return w?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Ur,{size:20}),"Add New Client"]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Choose how to add this client"})]}),t.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors",children:t.jsx(D,{size:20,className:"dark:text-gray-400"})})]}),t.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:t.jsxs("div",{className:"flex gap-4 mb-4",children:[t.jsxs("button",{onClick:()=>p("off-platform"),className:`flex-1 p-4 rounded-lg border-2 transition-all ${g==="off-platform"?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[t.jsx(Ur,{className:"mx-auto mb-2",size:24}),t.jsx("div",{className:"font-semibold dark:text-white",children:"Off-Platform Client"}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Client not registered on SeshNx"})]}),t.jsxs("button",{onClick:()=>p("platform"),className:`flex-1 p-4 rounded-lg border-2 transition-all ${g==="platform"?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[t.jsx(ke,{className:"mx-auto mb-2",size:24}),t.jsx("div",{className:"font-semibold dark:text-white",children:"Platform User"}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Search for existing SeshNx users"})]})]})}),g==="platform"&&t.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search Platform Users"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(ot,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by username, email, or name...",value:S,onChange:o=>x(o.target.value),onKeyPress:o=>o.key==="Enter"&&$(),className:"w-full pl-10 pr-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),t.jsx("button",{onClick:$,disabled:j||!S.trim(),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:j?"Searching...":"Search"})]}),n.length>0&&t.jsxs("div",{className:"mt-4 max-h-60 overflow-y-auto",children:[t.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Found ",n.length," user",n.length!==1?"s":""]}),t.jsx("div",{className:"space-y-2",children:n.map(o=>t.jsxs("button",{onClick:()=>z(o),className:"w-full p-3 text-left bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors flex items-center gap-3",children:[o.photo_url?t.jsx("img",{src:o.photo_url,alt:o.display_name,className:"w-10 h-10 rounded-full object-cover"}):t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white font-semibold",children:(o.display_name||o.username||"?").charAt(0).toUpperCase()}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold dark:text-white truncate",children:o.display_name||o.profile_name||o.username}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:o.email})]}),t.jsx(ge,{size:18,className:"text-purple-600 dark:text-purple-400 flex-shrink-0"})]},o.user_id))})]})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"space-y-4",children:[g==="platform"&&v.client_id&&t.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-center gap-2",children:[t.jsx(Dt,{size:18,className:"text-green-600 dark:text-green-400"}),t.jsxs("span",{className:"text-sm text-green-700 dark:text-green-300",children:["Platform user selected: ",t.jsx("strong",{children:v.name})]}),t.jsx("button",{onClick:()=>{F({...v,client_id:null,name:"",email:""})},className:"ml-auto",children:t.jsx(Kt,{size:16,className:"text-green-600 dark:text-green-400"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name *"}),t.jsx("input",{type:"text",required:!0,value:v.name,onChange:o=>F({...v,name:o.target.value}),disabled:g==="platform"&&!!v.client_id,className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:cursor-not-allowed"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),t.jsx("input",{type:"email",value:v.email,onChange:o=>F({...v,email:o.target.value}),disabled:g==="platform"&&!!v.client_id,className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:cursor-not-allowed"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone"}),t.jsx("input",{type:"tel",value:v.phone,onChange:o=>F({...v,phone:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Company"}),t.jsx("input",{type:"text",value:v.company,onChange:o=>F({...v,company:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Client Type *"}),t.jsx("select",{required:!0,value:v.client_type,onChange:o=>F({...v,client_type:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500",children:Ze.map(o=>t.jsx("option",{value:o.id,children:o.label},o.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes"}),t.jsx("textarea",{rows:"3",value:v.notes,onChange:o=>F({...v,notes:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500"})]})]}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:b,disabled:!v.name,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[t.jsx(ge,{size:18}),"Add Client"]})]})]})]})}):t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Dt,{size:20}),c?"Edit Client":"Client Details"]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:c?"Update client information":"View full client profile"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!c&&t.jsx("button",{onClick:()=>C(!0),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",title:"Edit client",children:t.jsx(da,{size:18,className:"dark:text-gray-400"})}),t.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors",children:t.jsx(D,{size:20,className:"dark:text-gray-400"})})]})]}),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-3",children:[(r==null?void 0:r.client_id)&&t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full text-sm",children:[t.jsx(ke,{size:14}),"Platform User"]}),t.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${(r==null?void 0:r.client_type)==="vip"?"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400":(r==null?void 0:r.client_type)==="regular"?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":(r==null?void 0:r.client_type)==="prospect"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400":"bg-gray-100 dark:bg-gray-900/30 text-gray-600 dark:text-gray-400"}`,children:((E=Ze.find(o=>o.id===(r==null?void 0:r.client_type)))==null?void 0:E.label)||"Unknown"})]})}),c?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name *"}),t.jsx("input",{type:"text",required:!0,value:v.name,onChange:o=>F({...v,name:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),t.jsx("input",{type:"email",value:v.email,onChange:o=>F({...v,email:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone"}),t.jsx("input",{type:"tel",value:v.phone,onChange:o=>F({...v,phone:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Company"}),t.jsx("input",{type:"text",value:v.company,onChange:o=>F({...v,company:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Client Type *"}),t.jsx("select",{required:!0,value:v.client_type,onChange:o=>F({...v,client_type:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500",children:Ze.map(o=>t.jsx("option",{value:o.id,children:o.label},o.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes"}),t.jsx("textarea",{rows:"3",value:v.notes,onChange:o=>F({...v,notes:o.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{onClick:()=>{C(!1),r&&F({name:r.name||"",email:r.email||"",phone:r.phone||"",company:r.company||"",client_type:r.client_type||"regular",notes:r.notes||"",client_id:r.client_id||null})},className:"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:b,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[t.jsx(Ce,{size:18}),"Save Changes"]})]})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsx(Pt,{size:18,className:"text-gray-600 dark:text-gray-400"}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Email"}),t.jsx("div",{className:"font-medium dark:text-white truncate",children:(r==null?void 0:r.email)||"Not provided"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsx(ir,{size:18,className:"text-gray-600 dark:text-gray-400"}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Phone"}),t.jsx("div",{className:"font-medium dark:text-white",children:(r==null?void 0:r.phone)||"Not provided"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsx(ns,{size:18,className:"text-gray-600 dark:text-gray-400"}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Company"}),t.jsx("div",{className:"font-medium dark:text-white truncate",children:(r==null?void 0:r.company)||"Not provided"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsx(de,{size:18,className:"text-gray-600 dark:text-gray-400"}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Client Since"}),t.jsx("div",{className:"font-medium dark:text-white",children:r!=null&&r.created_at?new Date(r.created_at).toLocaleDateString():"N/A"})]})]})]}),(r==null?void 0:r.notes)&&t.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Notes"}),t.jsx("div",{className:"text-sm dark:text-white",children:r.notes})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:(r==null?void 0:r.total_bookings)||0}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total Bookings"})]}),t.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:R(r==null?void 0:r.total_spent)}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Lifetime Value"})]}),t.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:r!=null&&r.first_booking_date?new Date(r.first_booking_date).toLocaleDateString():"N/A"}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"First Booking"})]})]}),(r==null?void 0:r.tags)&&r.tags.length>0&&t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Tags"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map((o,M)=>t.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded",children:o},M))})]})]})]})]})})}function ul({user:r,userData:s}){const[d,l]=u.useState([]),[i,c]=u.useState([]),[C,w]=u.useState(!0),[N,g]=u.useState(""),[p,S]=u.useState("all"),[x,n]=u.useState(!1),[k,j]=u.useState(null),[y,v]=u.useState("view");u.useEffect(()=>{F()},[]),u.useEffect(()=>{let h=d;if(p!=="all"&&(h=h.filter(P=>P.client_type===p)),N){const P=N.toLowerCase();h=h.filter(B=>{var q,L,Y;return((q=B.name)==null?void 0:q.toLowerCase().includes(P))||((L=B.email)==null?void 0:L.toLowerCase().includes(P))||((Y=B.company)==null?void 0:Y.toLowerCase().includes(P))})}c(h)},[d,N,p]);const F=async()=>{w(!0);try{l([{id:"1",name:"John Doe",email:"john@example.com",phone:"555-0101",company:"Doe Productions",client_type:"vip",tags:["recording","mixing"],notes:"Regular weekly sessions",total_bookings:24,total_spent:12e3,first_booking_date:"2024-01-15",last_booking_date:"2025-01-10",created_at:"2024-01-15T10:00:00Z"},{id:"2",name:"Jane Smith",email:"jane@example.com",phone:"555-0102",company:"Smith Music LLC",client_type:"regular",tags:["recording"],notes:"Prefers morning sessions",total_bookings:8,total_spent:3200,first_booking_date:"2024-06-01",last_booking_date:"2024-12-20",created_at:"2024-06-01T14:30:00Z"},{id:"3",name:"Bob Johnson",email:"bob@potential.com",phone:"555-0103",company:null,client_type:"prospect",tags:["inquiry"],notes:"Interested in booking for February",total_bookings:0,total_spent:0,first_booking_date:null,last_booking_date:null,created_at:"2025-01-05T09:00:00Z"}])}catch(h){console.error("Error fetching clients:",h)}finally{w(!1)}},$=()=>{j(null),v("add"),n(!0)},z=h=>{j(h),v("edit"),n(!0)},b=async h=>{if(confirm("Are you sure you want to delete this client?"))try{const P=await fetch(`/api/studio-ops/clients/${h}`,{method:"DELETE"});if(P.ok)l(d.filter(B=>B.id!==h));else{const B=await P.json();alert(`Error: ${B.error||"Failed to delete client"}`)}}catch(P){console.error("Error deleting client:",P),l(d.filter(B=>B.id!==h))}},R=h=>{y==="add"?l([...d,h]):y==="edit"&&l(d.map(P=>P.id===h.id?h:P)),n(!1),j(null)},E=h=>{const P=Ze.find(B=>B.id===h);return(P==null?void 0:P.color)||"gray"},o=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(h),M={total:d.length,vip:d.filter(h=>h.client_type==="vip").length,regular:d.filter(h=>h.client_type==="regular").length,prospect:d.filter(h=>h.client_type==="prospect").length,totalRevenue:d.reduce((h,P)=>h+(P.total_spent||0),0)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center text-white",children:t.jsx(ke,{size:20})}),"Client Database"]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage your client relationships and track bookings"})]}),t.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors",children:[t.jsx(ge,{size:18}),"Add Client"]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:M.total}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Clients"})]}),t.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:M.vip}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"VIP"})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:M.regular}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Regular"})]}),t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:M.prospect}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Prospects"})]}),t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:o(M.totalRevenue)}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Revenue"})]})]})]}),t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-4",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(ot,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search clients by name, email, or company...",value:N,onChange:h=>g(h.target.value),className:"w-full pl-10 pr-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),t.jsxs("select",{value:p,onChange:h=>S(h.target.value),className:"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[t.jsx("option",{value:"all",children:"All Types"}),Ze.map(h=>t.jsx("option",{value:h.id,children:h.label},h.id))]})]})}),t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:C?t.jsx("div",{className:"p-8 text-center text-gray-600 dark:text-gray-400",children:"Loading clients..."}):i.length===0?t.jsx("div",{className:"p-8 text-center text-gray-600 dark:text-gray-400",children:N||p!=="all"?"No clients match your search":"No clients yet. Add your first client to get started."}):t.jsx("div",{className:"divide-y dark:divide-gray-700",children:i.map(h=>{var P;return t.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold dark:text-white",children:h.name}),t.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full bg-${E(h.client_type)}-100 dark:bg-${E(h.client_type)}-900/30 text-${E(h.client_type)}-600 dark:text-${E(h.client_type)}-400`,children:((P=Ze.find(B=>B.id===h.client_type))==null?void 0:P.label)||"Unknown"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 dark:text-gray-400",children:[h.email&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Pt,{size:14}),h.email]}),h.phone&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ir,{size:14}),h.phone]}),h.company&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ns,{size:14}),h.company]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(de,{size:14}),h.total_bookings," booking",h.total_bookings!==1?"s":""]})]}),h.notes&&t.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-500 line-clamp-1",children:h.notes})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.jsxs("div",{className:"text-right mr-4",children:[t.jsx("div",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:o(h.total_spent)}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Lifetime value"})]}),t.jsx("button",{onClick:()=>z(h),className:"p-2 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",title:"Edit client",children:t.jsx(We,{size:16})}),t.jsx("button",{onClick:()=>b(h.id),className:"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors",title:"Delete client",children:t.jsx(oe,{size:16})})]})]})},h.id)})})}),x&&t.jsx(ml,{client:k,onClose:()=>{n(!1),j(null)},onUpdate:R,studioId:s==null?void 0:s.id,mode:y})]})}function hl({user:r,userData:s}){const[d,l]=u.useState([]),[i,c]=u.useState([]),[C,w]=u.useState(!0),[N,g]=u.useState(""),[p,S]=u.useState("all"),[x,n]=u.useState("all"),[k,j]=u.useState(!1),[y,v]=u.useState(!1),[F,$]=u.useState(null),[z,b]=u.useState({name:"",email:"",phone:"",role:"assistant",pay_rate_type:"hourly",pay_rate:"",skills:[],status:"active",hire_date:""});u.useEffect(()=>{R()},[]),u.useEffect(()=>{let _=d;if(p!=="all"&&(_=_.filter(W=>W.role===p)),x!=="all"&&(_=_.filter(W=>W.status===x)),N){const W=N.toLowerCase();_=_.filter(T=>{var J,G,Q;return((J=T.name)==null?void 0:J.toLowerCase().includes(W))||((G=T.email)==null?void 0:G.toLowerCase().includes(W))||((Q=T.role)==null?void 0:Q.toLowerCase().includes(W))})}c(_)},[d,N,p,x]);const R=async()=>{w(!0);try{l([{id:"1",name:"Mike Chen",email:"mike@studio.com",phone:"555-0201",role:"engineer",pay_rate_type:"hourly",pay_rate:75,skills:["mixing","mastering","pro-tools"],status:"active",hire_date:"2023-06-15",total_shifts:156,hours_worked:1248,total_earnings:93600,created_at:"2023-06-15T09:00:00Z"},{id:"2",name:"Sarah Williams",email:"sarah@studio.com",phone:"555-0202",role:"assistant",pay_rate_type:"hourly",pay_rate:25,skills:["setup","teardown","equipment"],status:"active",hire_date:"2024-01-10",total_shifts:89,hours_worked:356,total_earnings:8900,created_at:"2024-01-10T14:00:00Z"},{id:"3",name:"Alex Johnson",email:"alex@studio.com",phone:"555-0203",role:"producer",pay_rate_type:"per_session",pay_rate:200,skills:["production","songwriting","arrangement"],status:"active",hire_date:"2023-09-01",total_shifts:45,hours_worked:180,total_earnings:9e3,created_at:"2023-09-01T10:30:00Z"},{id:"4",name:"Jordan Lee",email:"jordan@studio.com",phone:"555-0204",role:"intern",pay_rate_type:"hourly",pay_rate:15,skills:["assistant","learning"],status:"active",hire_date:"2025-01-05",total_shifts:12,hours_worked:48,total_earnings:720,created_at:"2025-01-05T11:00:00Z"}])}catch(_){console.error("Error fetching staff:",_)}finally{w(!1)}},E=async _=>{_.preventDefault();try{const W={id:Date.now().toString(),...z,studio_id:s==null?void 0:s.id,pay_rate:parseFloat(z.pay_rate),total_shifts:0,hours_worked:0,total_earnings:0,created_at:new Date().toISOString()};l([...d,W]),j(!1),P()}catch(W){console.error("Error adding staff:",W)}},o=async _=>{_.preventDefault();try{const W=d.map(T=>T.id===F.id?{...T,...z,pay_rate:parseFloat(z.pay_rate)}:T);l(W),v(!1),$(null),P()}catch(W){console.error("Error updating staff:",W)}},M=async _=>{if(confirm("Are you sure you want to remove this staff member?"))try{l(d.filter(W=>W.id!==_))}catch(W){console.error("Error deleting staff:",W)}},h=_=>{var W;$(_),b({name:_.name||"",email:_.email||"",phone:_.phone||"",role:_.role||"assistant",pay_rate_type:_.pay_rate_type||"hourly",pay_rate:((W=_.pay_rate)==null?void 0:W.toString())||"",skills:_.skills||[],status:_.status||"active",hire_date:_.hire_date||""}),v(!0)},P=()=>{b({name:"",email:"",phone:"",role:"assistant",pay_rate_type:"hourly",pay_rate:"",skills:[],status:"active",hire_date:""})},B=_=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(_),q=_=>({engineer:"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400",assistant:"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400",manager:"bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400",intern:"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400",technician:"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400",producer:"bg-pink-100 text-pink-600 dark:bg-pink-900/30 dark:text-pink-400"})[_]||"bg-gray-100 text-gray-600 dark:bg-gray-900/30 dark:text-gray-400",L=_=>({active:"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400",inactive:"bg-gray-100 text-gray-600 dark:bg-gray-900/30 dark:text-gray-400",on_leave:"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400"})[_]||"bg-gray-100 text-gray-600 dark:bg-gray-900/30 dark:text-gray-400",Y={total:d.length,active:d.filter(_=>_.status==="active").length,onLeave:d.filter(_=>_.status==="on_leave").length,totalShifts:d.reduce((_,W)=>_+(W.total_shifts||0),0),totalHours:d.reduce((_,W)=>_+(W.hours_worked||0),0),totalPayroll:d.reduce((_,W)=>_+(W.total_earnings||0),0)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg flex items-center justify-center text-white",children:t.jsx(ct,{size:20})}),"Staff Management"]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage your team, schedule shifts, and track performance"})]}),t.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[t.jsx(ge,{size:18}),"Add Staff"]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:Y.total}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Staff"})]}),t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:Y.active}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active"})]}),t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:Y.onLeave}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"On Leave"})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:Y.totalShifts}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Shifts"})]}),t.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[t.jsxs("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:[Y.totalHours,"h"]}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Hours Worked"})]})]})]}),t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-4",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(ot,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search staff by name, email, or role...",value:N,onChange:_=>g(_.target.value),className:"w-full pl-10 pr-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),t.jsxs("select",{value:p,onChange:_=>S(_.target.value),className:"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"all",children:"All Roles"}),St.map(_=>t.jsx("option",{value:_.id,children:_.label},_.id))]}),t.jsxs("select",{value:x,onChange:_=>n(_.target.value),className:"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"}),t.jsx("option",{value:"on_leave",children:"On Leave"})]})]})}),t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:C?t.jsx("div",{className:"p-8 text-center text-gray-600 dark:text-gray-400",children:"Loading staff..."}):i.length===0?t.jsx("div",{className:"p-8 text-center text-gray-600 dark:text-gray-400",children:N||p!=="all"||x!=="all"?"No staff members match your search":"No staff members yet. Add your first team member to get started."}):t.jsx("div",{className:"divide-y dark:divide-gray-700",children:i.map(_=>{var W;return t.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold dark:text-white",children:_.name}),t.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${q(_.role)}`,children:((W=St.find(T=>T.id===_.role))==null?void 0:W.label)||"Unknown"}),t.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${L(_.status)}`,children:_.status==="on_leave"?"On Leave":_.status})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 dark:text-gray-400",children:[_.email&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Pt,{size:14}),_.email]}),_.phone&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ir,{size:14}),_.phone]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(qe,{size:14}),_.pay_rate_type==="hourly"&&"$",_.pay_rate,_.pay_rate_type==="hourly"&&"/hr",_.pay_rate_type==="per_session"&&"/session",_.pay_rate_type==="percentage"&&"%",_.pay_rate_type==="salary"&&"/yr"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(oa,{size:14}),"Hired ",new Date(_.hire_date).toLocaleDateString()]})]}),_.skills&&_.skills.length>0&&t.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:_.skills.map((T,J)=>t.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded",children:T},J))})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.jsxs("div",{className:"text-right mr-4",children:[t.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[_.total_shifts," shifts · ",_.hours_worked,"h"]}),t.jsx("div",{className:"text-sm font-semibold text-green-600 dark:text-green-400",children:B(_.total_earnings)})]}),t.jsx("button",{onClick:()=>h(_),className:"p-2 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",title:"Edit staff",children:t.jsx(We,{size:16})}),t.jsx("button",{onClick:()=>M(_.id),className:"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors",title:"Remove staff",children:t.jsx(oe,{size:16})})]})]})},_.id)})})}),k&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Add Staff Member"}),t.jsx("button",{onClick:()=>{j(!1),P()},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors",children:t.jsx(D,{size:20,className:"dark:text-gray-400"})})]}),t.jsxs("form",{onSubmit:E,className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name *"}),t.jsx("input",{type:"text",required:!0,value:z.name,onChange:_=>b({...z,name:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),t.jsx("input",{type:"email",value:z.email,onChange:_=>b({...z,email:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone"}),t.jsx("input",{type:"tel",value:z.phone,onChange:_=>b({...z,phone:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Role *"}),t.jsx("select",{required:!0,value:z.role,onChange:_=>b({...z,role:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500",children:St.map(_=>t.jsx("option",{value:_.id,children:_.label},_.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status *"}),t.jsxs("select",{required:!0,value:z.status,onChange:_=>b({...z,status:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"}),t.jsx("option",{value:"on_leave",children:"On Leave"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Pay Rate Type *"}),t.jsxs("select",{required:!0,value:z.pay_rate_type,onChange:_=>b({...z,pay_rate_type:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"hourly",children:"Hourly"}),t.jsx("option",{value:"per_session",children:"Per Session"}),t.jsx("option",{value:"percentage",children:"Percentage"}),t.jsx("option",{value:"salary",children:"Salary"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Pay Rate *"}),t.jsx("input",{type:"number",step:"0.01",required:!0,value:z.pay_rate,onChange:_=>b({...z,pay_rate:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hire Date"}),t.jsx("input",{type:"date",value:z.hire_date,onChange:_=>b({...z,hire_date:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:()=>{j(!1),P()},className:"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Add Staff"})]})]})]})}),y&&F&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Edit Staff Member"}),t.jsx("button",{onClick:()=>{v(!1),$(null),P()},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors",children:t.jsx(D,{size:20,className:"dark:text-gray-400"})})]}),t.jsxs("form",{onSubmit:o,className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name *"}),t.jsx("input",{type:"text",required:!0,value:z.name,onChange:_=>b({...z,name:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),t.jsx("input",{type:"email",value:z.email,onChange:_=>b({...z,email:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone"}),t.jsx("input",{type:"tel",value:z.phone,onChange:_=>b({...z,phone:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Role *"}),t.jsx("select",{required:!0,value:z.role,onChange:_=>b({...z,role:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500",children:St.map(_=>t.jsx("option",{value:_.id,children:_.label},_.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status *"}),t.jsxs("select",{required:!0,value:z.status,onChange:_=>b({...z,status:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"}),t.jsx("option",{value:"on_leave",children:"On Leave"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Pay Rate Type *"}),t.jsxs("select",{required:!0,value:z.pay_rate_type,onChange:_=>b({...z,pay_rate_type:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"hourly",children:"Hourly"}),t.jsx("option",{value:"per_session",children:"Per Session"}),t.jsx("option",{value:"percentage",children:"Percentage"}),t.jsx("option",{value:"salary",children:"Salary"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Pay Rate *"}),t.jsx("input",{type:"number",step:"0.01",required:!0,value:z.pay_rate,onChange:_=>b({...z,pay_rate:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hire Date"}),t.jsx("input",{type:"date",value:z.hire_date,onChange:_=>b({...z,hire_date:_.target.value}),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:()=>{v(!1),$(null),P()},className:"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Save Changes"})]})]})]})})]})}function bl({user:r,userData:s}){return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8",children:[t.jsx("div",{className:"flex items-center justify-between mb-6",children:t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center text-white",children:t.jsx(er,{size:20})}),"Analytics Dashboard"]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Track revenue, utilization, client insights, and business performance"})]})}),t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-24 h-24 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:t.jsx(er,{size:48,className:"text-green-600 dark:text-green-400"})}),t.jsx("h3",{className:"text-xl font-semibold dark:text-white mb-2",children:"Analytics Dashboard Coming Soon"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto",children:"This module will include revenue tracking, room utilization, client lifetime value, performance metrics, and custom reports."}),t.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-4 max-w-3xl mx-auto",children:[t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsx("div",{className:"text-2xl mb-2",children:"💰"}),t.jsx("h4",{className:"font-semibold dark:text-white",children:"Revenue Dashboard"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Income trends & forecasts"})]}),t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsx("div",{className:"text-2xl mb-2",children:"📊"}),t.jsx("h4",{className:"font-semibold dark:text-white",children:"Utilization Report"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Room usage statistics"})]}),t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsx("div",{className:"text-2xl mb-2",children:"🎯"}),t.jsx("h4",{className:"font-semibold dark:text-white",children:"Client Insights"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"CLV & engagement analysis"})]})]})]})]})}const Vr=[{id:"overview",label:"Overview",icon:je,description:"Dashboard & quick stats"},{id:"rooms",label:"Rooms",icon:Xt,description:"Manage studio rooms"},{id:"equipment",label:"Equipment",icon:Ct,description:"Equipment inventory"},{id:"gallery",label:"Gallery",icon:Ue,description:"Photo gallery"},{id:"availability",label:"Hours",icon:Me,description:"Operating hours"},{id:"policies",label:"Policies",icon:Qe,description:"Rules & pricing"},{id:"bookings",label:"Bookings",icon:de,description:"Manage bookings"},{id:"clients",label:"Clients",icon:ke,description:"Client database & CRM"},{id:"staff",label:"Staff",icon:ct,description:"Staff management & scheduling"},{id:"analytics",label:"Analytics",icon:er,description:"Business insights & reports"},{id:"settings",label:"Settings",icon:Et,description:"Studio info"}];function pl({user:r,userData:s}){const[d,l]=u.useState("overview"),[i,c]=u.useState({pendingBookings:0,recentBookings:[],totalRevenue:0}),[C,w]=u.useState(s);u.useEffect(()=>{const x=async()=>{if(!(r!=null&&r.id)&&!(r!=null&&r.uid))return;const k=(s==null?void 0:s.id)||(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const j=await fetch(`/api/studio-ops/bookings?studioId=${k}`),y=await j.json();if(!j.ok)throw new Error(y.error||"Failed to fetch stats");const v=y.data||[],F=v.filter(b=>b.status==="Pending").length,$=v.filter(b=>new Date(b.date)>=new Date).sort((b,R)=>new Date(b.date)-new Date(R.date)).slice(0,5),z=v.filter(b=>b.status==="Completed").reduce((b,R)=>b+(R.totalPrice||R.offer_amount||0),0);c({pendingBookings:F,recentBookings:$,totalRevenue:z})}catch(j){console.error("Error fetching stats:",j)}};x();const n=setInterval(x,3e4);return()=>clearInterval(n)},[s==null?void 0:s.id,r==null?void 0:r.id,r==null?void 0:r.uid]);const N=x=>{w(n=>({...n,...x}))},g=x=>{l(x)},p=()=>{const x={user:r,userData:C,onUpdate:N};switch(d){case"overview":return t.jsx(Or,{...x,stats:i,onNavigate:g});case"rooms":return t.jsx(Ga,{...x});case"equipment":return t.jsx(ol,{...x});case"gallery":return t.jsx(Ya,{...x});case"availability":return t.jsx(Xa,{...x});case"policies":return t.jsx(Ka,{...x});case"bookings":return t.jsx(il,{...x,userData:C});case"clients":return t.jsx(ul,{...x});case"staff":return t.jsx(hl,{...x});case"analytics":return t.jsx(bl,{...x});case"settings":return t.jsx(gl,{...x});default:return t.jsx(Or,{...x,stats:i,onNavigate:g})}},S=Vr.find(x=>x.id===d);return t.jsxs("div",{className:"max-w-7xl mx-auto pb-20",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2",children:[t.jsx(ct,{size:14}),t.jsx("span",{children:"Business Center"}),t.jsx(Oe,{size:14}),t.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:"Studio Manager"})]}),t.jsxs("h1",{className:"text-3xl font-bold dark:text-white flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white",children:t.jsx(je,{size:24})}),(C==null?void 0:C.studioName)||(C==null?void 0:C.profileName)||"Studio Manager"]})]}),t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 mb-6 overflow-hidden",children:t.jsx("div",{className:"flex overflow-x-auto scrollbar-hide",children:Vr.map(x=>{const n=x.icon,k=d===x.id,j=x.id==="bookings"&&i.pendingBookings>0;return t.jsxs("button",{onClick:()=>l(x.id),className:`flex items-center gap-2 px-5 py-4 text-sm font-medium whitespace-nowrap transition-all border-b-2 relative ${k?"border-brand-blue text-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[t.jsx(n,{size:18}),x.label,j&&t.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:i.pendingBookings})]},x.id)})})}),t.jsx("div",{className:"md:hidden mb-4 px-1",children:t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:S==null?void 0:S.description})}),t.jsx("div",{className:"min-h-[50vh]",children:p()})]})}const yl=({data:r,setData:s})=>t.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4",children:[t.jsx("h3",{className:"text-lg font-bold dark:text-white mb-4",children:"Release Essentials"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Title"}),t.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:r.title,onChange:d=>s({...r,title:d.target.value}),placeholder:"e.g. Dark Side of the Moon"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Artist"}),t.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:r.primaryArtist,onChange:d=>s({...r,primaryArtist:d.target.value}),placeholder:"e.g. Pink Floyd"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Type"}),t.jsx("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:r.type,onChange:d=>s({...r,type:d.target.value}),children:wa.map(d=>t.jsx("option",{value:d.id,children:d.label},d.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Genre"}),t.jsxs("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:r.genre,onChange:d=>s({...r,genre:d.target.value}),children:[t.jsx("option",{value:"",children:"Select Genre..."}),Sa.map(d=>t.jsx("option",{value:d,children:d},d))]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Date"}),t.jsx("input",{type:"date",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:r.releaseDate,onChange:d=>s({...r,releaseDate:d.target.value})}),t.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Standard: 2 weeks out. Express: 48hrs."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Label Name"}),t.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:r.labelName,onChange:d=>s({...r,labelName:d.target.value}),placeholder:"Optional (Default: Independent)"})]})]})]}),fl=({data:r,setData:s,user:d})=>{const{uploadMedia:l,uploading:i}=or(),[c,C]=u.useState(r.artworkUrl||null),[w,N]=u.useState(""),g=async p=>{const S=p.target.files[0];if(!S)return;const x=new Image;x.src=URL.createObjectURL(S),x.onload=async()=>{if(x.width<3e3||x.height<3e3){N("Error: Image must be at least 3000 x 3000 pixels.");return}x.width!==x.height?N("Warning: Image should be a perfect square (1:1 ratio)."):N("");const n=await l(S,`distribution/${d.uid}/artwork`);n!=null&&n.url&&(C(n.url),s({...r,artworkUrl:n.url}))}};return t.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 animate-in slide-in-from-right-4",children:[t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Cover Art"}),t.jsx("p",{className:"text-sm text-gray-500",children:"3000 x 3000 px • JPG or PNG • No Blurry Text"})]}),t.jsxs("div",{className:"relative group w-64 h-64 bg-gray-100 dark:bg-[#1f2128] rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center overflow-hidden",children:[c?t.jsx("img",{src:c,className:"w-full h-full object-cover"}):t.jsxs("div",{className:"text-gray-400 flex flex-col items-center",children:[t.jsx(Ue,{size:48,className:"mb-2"}),t.jsx("span",{className:"text-xs font-bold",children:"Click to Upload"})]}),t.jsxs("label",{className:"absolute inset-0 cursor-pointer bg-black/0 hover:bg-black/20 transition flex items-center justify-center",children:[t.jsx("input",{type:"file",className:"hidden",accept:"image/png, image/jpeg",onChange:g,disabled:i}),i&&t.jsx(be,{className:"animate-spin text-white",size:32})]})]}),w&&t.jsxs("div",{className:"text-red-500 text-sm font-bold flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[t.jsx(Be,{size:16})," ",w]})]})},jl=({data:r,setData:s,user:d})=>{var N,g;const{uploadMedia:l,uploading:i}=or(),c=async p=>{if(!p.name.toLowerCase().endsWith(".wav")){alert("Only .WAV files are accepted for distribution.");return}const S={id:Date.now(),title:p.name.replace(".wav",""),fileUrl:"",status:"uploading",isExplicit:!1,isInstrumental:!1},x=[...r.tracks||[],S];s({...r,tracks:x});try{const n=await l(p,`distribution/${d.uid}/audio_vault`);if(n!=null&&n.url){const k=x.map(j=>j.id===S.id?{...j,fileUrl:n.url,status:"ready",duration:0}:j);s({...r,tracks:k})}}catch(n){console.error("Track upload failed",n),alert("Upload failed.")}},C=p=>{s({...r,tracks:r.tracks.filter(S=>S.id!==p)})},w=(p,S,x)=>{s({...r,tracks:r.tracks.map(n=>n.id===p?{...n,[S]:x}:n)})};return t.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[t.jsxs("div",{className:"flex justify-between items-end",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Audio"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Stereo WAV files only (16-bit / 44.1kHz minimum)"})]}),t.jsxs("label",{className:"bg-brand-blue hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs cursor-pointer flex items-center gap-2 transition",children:[t.jsx(nr,{size:14})," Add Track",t.jsx("input",{type:"file",className:"hidden",accept:".wav",onChange:p=>c(p.target.files[0]),disabled:i})]})]}),t.jsxs("div",{className:"space-y-3",children:[((N=r.tracks)==null?void 0:N.length)===0&&t.jsx("div",{className:"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400",children:"No tracks added yet."}),(g=r.tracks)==null?void 0:g.map((p,S)=>t.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 flex flex-col gap-3",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded text-gray-500 font-mono text-xs",children:["#",S+1]}),t.jsx("div",{className:"font-bold dark:text-white text-sm",children:p.status==="uploading"?t.jsxs("span",{className:"flex items-center gap-2 text-brand-blue",children:[t.jsx(be,{className:"animate-spin",size:14})," Uploading..."]}):p.title})]}),t.jsx("button",{onClick:()=>C(p.id),className:"text-gray-400 hover:text-red-500",children:t.jsx(D,{size:16})})]}),p.status==="ready"&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[t.jsx("input",{className:"col-span-2 p-2 text-xs border rounded bg-transparent dark:border-gray-600 dark:text-white",placeholder:"Track Title",value:p.title,onChange:x=>w(p.id,"title",x.target.value)}),t.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:p.isExplicit,onChange:x=>w(p.id,"isExplicit",x.target.checked)})," Explicit"]}),t.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:p.isInstrumental,onChange:x=>w(p.id,"isInstrumental",x.target.checked)})," Instrumental"]})]})]},p.id))]})]})},kl=({data:r,setData:s})=>{var i;const d=c=>{const C=r.stores||[],w=C.includes(c)?C.filter(N=>N!==c):[...C,c];s({...r,stores:w})},l=()=>{var c;((c=r.stores)==null?void 0:c.length)===nt.length?s({...r,stores:[]}):s({...r,stores:nt.map(C=>C.id)})};return t.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Select Stores"}),t.jsx("button",{onClick:l,className:"text-xs font-bold text-brand-blue hover:underline",children:((i=r.stores)==null?void 0:i.length)===nt.length?"Deselect All":"Select All"})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:nt.map(c=>{var w;const C=(w=r.stores)==null?void 0:w.includes(c.id);return t.jsxs("div",{onClick:()=>d(c.id),className:`p-3 rounded-xl border flex items-center gap-3 cursor-pointer transition-all ${C?"bg-blue-50 border-brand-blue dark:bg-blue-900/20":"bg-white dark:bg-[#1f2128] dark:border-gray-700 hover:border-gray-300"}`,children:[t.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${C?"bg-brand-blue border-brand-blue":"border-gray-400"}`,children:C&&t.jsx(sr,{size:12,className:"text-white"})}),t.jsx("span",{className:`text-sm font-bold ${C?"text-brand-blue dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:c.name})]},c.id)})}),t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/10 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800 text-sm text-yellow-800 dark:text-yellow-200 flex items-start gap-3",children:[t.jsx(ca,{size:18,className:"mt-0.5 shrink-0"}),t.jsx("p",{children:"Deliveries usually take 2-5 days for Spotify/Apple, and up to 2 weeks for other stores. Please plan your release date accordingly."})]})]})};function vl({user:r,userData:s,initialData:d,onCancel:l,onSuccess:i}){const[c,C]=u.useState(1),[w,N]=u.useState(!1),[g,p]=u.useState(d||{title:"",primaryArtist:s&&`${s.firstName||""} ${s.lastName||""}`.trim()||"Artist",type:"single",genre:"",releaseDate:"",labelName:"",artworkUrl:"",tracks:[],stores:nt.map(n=>n.id),status:"Draft"}),S=()=>c===1?g.title&&g.primaryArtist&&g.genre&&g.releaseDate:c===2?!!g.artworkUrl:c===3?g.tracks.length>0&&g.tracks.every(n=>n.status==="ready"):c===4?g.stores.length>0:!0,x=async()=>{if(!supabase)return;N(!0);const n=(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const k={uploader_id:n,title:g.title,primary_artist:g.primaryArtist,type:g.type,genre:g.genre,release_date:g.releaseDate,label_name:g.labelName||null,artwork_url:g.artworkUrl||null,tracks:g.tracks||[],updated_at:new Date().toISOString(),status:"Processing"};d!=null&&d.id?await supabase.from("distribution_releases").update(k).eq("id",d.id).eq("uploader_id",n):await supabase.from("distribution_releases").insert({...k,created_at:new Date().toISOString()}),alert("Release submitted successfully! It is now in the review queue."),i()}catch(k){console.error("Submission error:",k),alert("Failed to submit release.")}N(!1)};return t.jsxs("div",{className:"max-w-4xl mx-auto bg-white dark:bg-[#2c2e36] rounded-2xl shadow-xl overflow-hidden border dark:border-gray-700 min-h-[600px] flex flex-col",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-6 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-extrabold dark:text-white",children:"New Release"}),t.jsxs("p",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mt-1",children:["Step ",c," of 4"]})]}),t.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white",children:t.jsx(D,{})})]}),t.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700 w-full",children:t.jsx("div",{className:"h-full bg-brand-blue transition-all duration-300",style:{width:`${c/4*100}%`}})}),t.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[c===1&&t.jsx(yl,{data:g,setData:p}),c===2&&t.jsx(fl,{data:g,setData:p,user:r}),c===3&&t.jsx(jl,{data:g,setData:p,user:r}),c===4&&t.jsx(kl,{data:g,setData:p})]}),t.jsxs("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[c>1?t.jsxs("button",{onClick:()=>C(c-1),className:"flex items-center gap-2 text-gray-500 font-bold hover:text-gray-800 dark:hover:text-white transition",children:[t.jsx(ar,{size:18})," Back"]}):t.jsx("div",{}),c<4?t.jsxs("button",{onClick:()=>C(c+1),disabled:!S(),className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-600 transition",children:["Next Step ",t.jsx(Oe,{size:18})]}):t.jsx("button",{onClick:x,disabled:w||!S(),className:"bg-green-600 text-white px-8 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 hover:bg-green-700 transition shadow-lg",children:w?t.jsx(be,{className:"animate-spin"}):"Submit Release"})]})]})}function Nl({user:r,userData:s}){const d=(r==null?void 0:r.id)||(r==null?void 0:r.uid),{data:l,loading:i}=_a(d),{deleteRelease:c}=za(),[C,w]=u.useState("list"),[N,g]=u.useState(null),p=(l||[]).map(n=>({id:n.id,...n,uploaderId:n.uploader_id,updatedAt:n.updated_at,createdAt:n.created_at})),S=async(n,k)=>{if(confirm(`Are you sure you want to delete "${k}"? This cannot be undone if already distributed.`))try{await c(n)}catch(j){console.error(j),alert("Failed to delete release.")}},x=n=>{if(n.status!=="Draft"&&n.status!=="Action Needed")return alert("Cannot edit a release that is currently processing or live. Contact support for takedowns.");g(n),w("create")};return C==="create"?t.jsx(vl,{user:r,userData:s,initialData:N,onCancel:()=>{w("list"),g(null)},onSuccess:()=>{w("list"),g(null)}}):t.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(is,{className:"text-brand-blue"})," Distribution Portal"]}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your catalog across Spotify, Apple Music, and 150+ stores."})]}),t.jsxs("button",{onClick:()=>w("create"),className:"bg-brand-blue text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 shadow-lg hover:shadow-blue-500/20",children:[t.jsx(ge,{size:20})," New Release"]})]}),t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 overflow-hidden min-h-[400px]",children:i?t.jsx("div",{className:"p-12 text-center text-gray-500",children:"Loading catalog..."}):p.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[t.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4",children:t.jsx(dr,{size:48,className:"text-gray-400"})}),t.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"No Releases Yet"}),t.jsx("p",{className:"text-gray-500 max-w-sm mt-2 mb-6",children:"Start your journey by uploading your first single, EP, or album to the world."}),t.jsx("button",{onClick:()=>w("create"),className:"text-brand-blue font-bold hover:underline",children:"Create First Release"})]}):t.jsx("div",{className:"divide-y dark:divide-gray-700",children:p.map(n=>{var k;return t.jsxs("div",{className:"p-5 hover:bg-gray-50 dark:hover:bg-white/5 transition flex flex-col md:flex-row md:items-center justify-between gap-4 group",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"h-16 w-16 bg-gray-200 dark:bg-black rounded-lg shadow-sm overflow-hidden shrink-0 border dark:border-gray-700",children:n.artworkUrl?t.jsx("img",{src:n.artworkUrl,alt:"Art",className:"h-full w-full object-cover"}):t.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:t.jsx(xa,{size:20})})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide border ${n.status==="Live"?"bg-green-100 text-green-700 border-green-200":n.status==="Processing"?"bg-blue-100 text-blue-700 border-blue-200":n.status==="Action Needed"?"bg-red-100 text-red-700 border-red-200":"bg-gray-100 text-gray-600 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600"}`,children:n.status}),t.jsx("span",{className:"text-xs text-gray-400 uppercase font-bold",children:n.type})]}),t.jsx("h4",{className:"font-bold text-lg dark:text-white leading-tight",children:n.title||"Untitled Release"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.primaryArtist," • ",((k=n.tracks)==null?void 0:k.length)||0," Tracks"]})]})]}),t.jsxs("div",{className:"flex items-center gap-4 pl-4 md:pl-0 border-l md:border-l-0 dark:border-gray-700",children:[t.jsxs("div",{className:"text-right hidden md:block mr-4",children:[t.jsx("div",{className:"text-xs text-gray-400 uppercase font-bold",children:"Release Date"}),t.jsx("div",{className:"text-sm font-medium dark:text-gray-200",children:n.releaseDate?new Date(n.releaseDate).toLocaleDateString():"TBD"})]}),t.jsx("button",{onClick:()=>x(n),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit / View Details",children:t.jsx(We,{size:18})}),(n.status==="Draft"||n.status==="Action Needed")&&t.jsx("button",{onClick:()=>S(n.id,n.title),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete Release",children:t.jsx(oe,{size:18})})]})]},n.id)})})})]})}function wl({data:r,onNavigate:s}){const d=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(i||0),l=i=>new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(i||0);return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Label Overview"}),t.jsxs("button",{onClick:()=>s&&s("roster"),className:"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1",children:["View Details ",t.jsx(Oe,{size:16})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 mb-2",children:t.jsx(ke,{className:"text-blue-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(r==null?void 0:r.total_artists)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Artists"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 mb-2",children:t.jsx(dr,{className:"text-purple-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(r==null?void 0:r.active_releases)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Releases"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2",children:t.jsx(qe,{className:"text-green-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:d(r==null?void 0:r.total_revenue)}),t.jsx("div",{className:"text-xs text-gray-500",children:"Revenue"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-orange-50 dark:bg-orange-900/20 mb-2",children:t.jsx(ga,{className:"text-orange-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:l(r==null?void 0:r.total_streams)}),t.jsx("div",{className:"text-xs text-gray-500",children:"Streams"})]})]})]})}function Sl({data:r,onNavigate:s}){return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Studio Overview"}),t.jsxs("button",{onClick:()=>s&&s("studio"),className:"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1",children:["View Details ",t.jsx(Oe,{size:16})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 mb-2",children:t.jsx(je,{className:"text-blue-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(r==null?void 0:r.total_rooms)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Rooms"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-yellow-50 dark:bg-yellow-900/20 mb-2",children:t.jsx(de,{className:"text-yellow-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(r==null?void 0:r.pending_bookings)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Pending"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2",children:t.jsx(sr,{className:"text-green-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(r==null?void 0:r.completed_bookings)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Completed"})]})]})]})}function Cl({data:r,onNavigate:s}){return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Distribution Overview"}),t.jsxs("button",{onClick:()=>s&&s("distribution"),className:"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1",children:["View Details ",t.jsx(Oe,{size:16})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 mb-2",children:t.jsx(dr,{className:"text-purple-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(r==null?void 0:r.total_releases)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Total"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2",children:t.jsx(ma,{className:"text-green-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(r==null?void 0:r.live_releases)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Live"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-gray-50 dark:bg-gray-900/20 mb-2",children:t.jsx(Qe,{className:"text-gray-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(r==null?void 0:r.draft_releases)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Drafts"})]})]})]})}function _l({user:r,userData:s,setActiveTab:d}){var x,n,k;const[l,i]=u.useState({}),[c,C]=u.useState(!0),w=(x=s==null?void 0:s.accountTypes)==null?void 0:x.includes("Studio"),N=(n=s==null?void 0:s.accountTypes)==null?void 0:n.some(j=>["Label","Agent"].includes(j)),g=(k=s==null?void 0:s.accountTypes)==null?void 0:k.some(j=>["Talent","Producer","Engineer"].includes(j)),p=w||N||g;u.useEffect(()=>{(async()=>{const y=(r==null?void 0:r.id)||(r==null?void 0:r.uid);if(!y){C(!1);return}C(!0);const v={};try{if(N){const F=await ja(y);v.label=(F==null?void 0:F[0])||{}}if(w){const F=await ka(y);v.studio=(F==null?void 0:F[0])||{}}if(p){const F=await va(y);v.distribution=(F==null?void 0:F[0])||{}}i(v)}catch(F){console.error("Error fetching business metrics:",F)}finally{C(!1)}})()},[r==null?void 0:r.id,r==null?void 0:r.uid,N,w,p]);const S=[{id:"studio",title:"Studio Settings",description:"Configure your studio rooms, rates, and amenities",icon:"Home",color:"blue",show:w},{id:"distribution",title:"New Release",description:"Distribute your music to 150+ streaming platforms",icon:"Globe",color:"green",show:p},{id:"roster",title:"Manage Roster",description:"Sign artists and manage your label roster",icon:"Users",color:"purple",show:N}].filter(j=>j.show);return c?t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue"})}):t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-8 text-white relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),t.jsxs("div",{className:"relative z-10",children:[t.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Business Center"}),t.jsx("p",{className:"text-indigo-100 max-w-xl",children:"Manage your studio operations, distribute music, and grow your roster — all in one place."})]})]}),N&&t.jsx(wl,{data:l.label,onNavigate:d}),w&&t.jsx(Sl,{data:l.studio,onNavigate:d}),p&&t.jsx(Cl,{data:l.distribution,onNavigate:d}),S.length>0&&t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(ua,{size:20,className:"text-gray-400"}),"Quick Actions"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:S.map(j=>t.jsxs("button",{onClick:()=>d(j.id),className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all text-left group hover:border-brand-blue dark:hover:border-brand-blue",children:[t.jsx("h3",{className:"font-bold dark:text-white mb-1 flex items-center gap-2",children:j.title}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:j.description})]},j.id))})]}),S.length===0&&!N&&!w&&!p&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center",children:[t.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(ct,{size:32,className:"text-gray-400"})}),t.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"No Business Features Enabled"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Upgrade your account to access studio management, music distribution, and label features."}),t.jsx("p",{className:"text-sm text-gray-400",children:'Update your profile to add "Studio", "Talent", "Label", or "Agent" account types.'})]})]})}function Wl({user:r,userData:s}){var n,k,j;const d=ha(),l=ba(),i=y=>{const v=y.split("/").filter(Boolean);return v[0]==="business"&&v[1]?v[1]:"overview"},[c,C]=u.useState(()=>i(d.pathname));u.useEffect(()=>{const y=c==="overview"?"/business":`/business/${c}`;d.pathname!==y&&l(y,{replace:!0})},[c]),u.useEffect(()=>{const y=i(d.pathname);y!==c&&C(y)},[d.pathname]);const w=(n=s==null?void 0:s.accountTypes)==null?void 0:n.includes("Studio"),N=(k=s==null?void 0:s.accountTypes)==null?void 0:k.some(y=>["Label","Agent"].includes(y)),g=(j=s==null?void 0:s.accountTypes)==null?void 0:j.some(y=>["Talent","Producer","Engineer"].includes(y)),S=[{id:"overview",label:"Overview",icon:ct,iconSize:18,available:!0},{id:"studio",label:"Studio Ops",icon:je,iconSize:18,available:w,description:"Manage rooms, rates & amenities"},{id:"distribution",label:"Distribution",icon:is,iconSize:18,available:w||N||g,description:"Release music to streaming platforms"},{id:"roster",label:"Label Manager",icon:ke,iconSize:18,available:N,description:"Manage your signed artists"}].filter(y=>y.available),x=()=>{switch(c){case"studio":return t.jsx(pl,{user:r,userData:s});case"distribution":return t.jsx(Nl,{user:r,userData:s});case"roster":return t.jsx(Ca,{user:r,userData:s});case"overview":default:return t.jsx(_l,{user:r,userData:s,setActiveTab:C})}};return t.jsxs("div",{className:"max-w-7xl mx-auto pb-20",children:[t.jsx("div",{className:"mb-6 bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-1.5 flex flex-wrap gap-1 shadow-sm sticky top-0 z-10",children:S.map(y=>{const v=y.icon;return t.jsxs("button",{onClick:()=>C(y.id),className:`
                                flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all
                                ${c===y.id?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}
                            `,children:[t.jsx(v,{size:y.iconSize}),t.jsx("span",{className:"hidden sm:inline",children:y.label})]},y.id)})}),x()]})}export{Wl as default};
