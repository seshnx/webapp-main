import{j as e,r as d,a6 as at,X as q,am as je,al as rt,ap as te,W as lt,h as Me,y as H,g as $e,d4 as it,ac as nt,L as ie,ag as ee,cd as Ne,d5 as ve,R as De,a0 as ue,a1 as de,c8 as ze,i as xe,a2 as Ie,ao as Be,c9 as re,cB as He,cA as Ge,S as Ve,d6 as Ye,P as We,d7 as le,d8 as Ze,ce as W,cn as dt,N as ke,ar as ot,as as ct,d9 as qe,c6 as Xe,z as xt,da as Oe,cO as Te,cX as Ke,db as Qe,cm as Je,Q as gt,Z as ht,D as bt,bN as mt,bM as pt}from"./vendor-mIyI6DiM.js";import{j as be,U as Fe,b as ut}from"./chat-P1NCmzAv.js";import{u as ft,a as me,b as yt,c as jt,d as Nt,e as vt,f as kt}from"./useMarketplace-VvJPAWav.js";import{SAFE_EXCHANGE_STATUS as v,SAFE_EXCHANGE_STEPS as Ae,EQUIP_CATEGORIES as fe,HIGH_VALUE_THRESHOLD as he}from"./config-VNvva2Pv.js";import{m as ge,A as Ue}from"./vendor-framer-_HoVf1_M.js";import{R as wt,S as St}from"./ReportModal-MivBJc5d.js";import"./index-BCKV8ync.js";import"./edu-V9buPGJB.js";import"./vendor-audio-CY3oQc7h.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new a.Error().stack;r&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[r]="5740eb52-5ee8-4dcc-ab02-7aa02267e702",a._sentryDebugIdIdentifier="sentry-dbid-5740eb52-5ee8-4dcc-ab02-7aa02267e702")})()}catch{}const Ct=[{id:"guitar_electric",label:"Electric Guitar"},{id:"guitar_acoustic",label:"Acoustic Guitar"},{id:"amp_head",label:"Amplifier Head"},{id:"amp_combo",label:"Combo Amp"},{id:"keyboard",label:"Keyboard/Synth"},{id:"rack_unit",label:"Rack Gear (1U/2U)"},{id:"pedal",label:"Pedal/Stompbox"}],et=({type:a,view:r,onClick:c,markers:l=[]})=>{var b;const f=()=>l.map((w,p)=>e.jsxs("g",{transform:`translate(${w.x}, ${w.y})`,children:[e.jsx("circle",{r:"6",fill:"#ef4444",stroke:"white",strokeWidth:"2",className:"drop-shadow-md"}),e.jsx("text",{y:"-10",textAnchor:"middle",fill:"#ef4444",fontSize:"10",fontWeight:"bold",children:p+1})]},p)),y={width:"100%",height:"400",viewBox:"0 0 300 400",className:"w-full h-full cursor-crosshair touch-none select-none",onClick:w=>{const p=w.target.getBoundingClientRect(),u=(w.clientX-p.left)*(300/p.width),j=(w.clientY-p.top)*(400/p.height);c(u,j)}},n={guitar_electric:{front:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2",strokeDasharray:"5,5"})},amp_combo:{front:e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsxs("g",{children:[e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2"}),e.jsx("rect",{x:"70",y:"200",width:"160",height:"80",fill:"#9ca3af",opacity:"0.5"})]})}},h=()=>e.jsx("rect",{x:"50",y:"50",width:"200",height:"300",rx:"10",fill:"#f3f4f6",stroke:"#9ca3af",strokeWidth:"2",strokeDasharray:"4"}),k=((b=n[a])==null?void 0:b[r])||e.jsx(h,{});return e.jsxs("svg",{...y,children:[k,f()]})};function Pt({initialData:a,onSave:r,onCancel:c,type:l}){const[f,y]=d.useState((a==null?void 0:a.gearType)||"guitar_electric"),[n,h]=d.useState("front"),[k,b]=d.useState((a==null?void 0:a.markers)||[]),[w,p]=d.useState((a==null?void 0:a.notes)||""),[u,j]=d.useState((a==null?void 0:a.photos)||[]),[S,E]=d.useState(null),[L,D]=d.useState(""),{uploadMedia:g,uploading:T}=be(),F=(o,t)=>{const C={x:o,y:t,view:n,id:Date.now(),label:""};b([...k,C]),E(C),D("")},i=()=>{S&&(b(k.map(o=>o.id===S.id?{...o,label:L}:o)),E(null))},m=async o=>{const t=o.target.files[0];if(!t)return;const C=await g(t,`inspections/${Date.now()}`);C&&j(I=>[...I,C])};return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden flex flex-col h-[80vh]",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(at,{className:l==="Pre"?"text-orange-500":"text-green-500",size:20})," ",l,"-Inspection Report"]}),e.jsx("button",{onClick:c,children:e.jsx(q,{className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-black/40 relative flex flex-col items-center justify-center p-4",children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[e.jsx("select",{className:"p-2 rounded-lg border dark:border-gray-600 bg-white dark:bg-[#1f2128] text-sm font-bold dark:text-white shadow-sm",value:f,onChange:o=>y(o.target.value),children:Ct.map(o=>e.jsx("option",{value:o.id,children:o.label},o.id))}),e.jsx("div",{className:"flex bg-white dark:bg-[#1f2128] rounded-lg border dark:border-gray-600 p-1 shadow-sm",children:["front","back","sides"].map(o=>e.jsx("button",{onClick:()=>h(o),className:`px-3 py-1 text-xs font-bold rounded-md capitalize ${n===o?"bg-brand-blue text-white":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:o},o))})]}),e.jsxs("div",{className:"w-full max-w-md h-full aspect-[3/4] bg-white dark:bg-[#1f2128] rounded-xl shadow-inner border dark:border-gray-700 relative",children:[e.jsx(et,{type:f,view:n,markers:k.filter(o=>o.view===n),onClick:F}),S&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 bg-white dark:bg-[#2c2e36] p-4 rounded-xl shadow-2xl border border-brand-blue z-20 animate-in zoom-in-95",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 mb-2",children:"Identify Issue"}),e.jsx("input",{autoFocus:!0,className:"w-full p-2 border rounded mb-2 text-sm dark:bg-black/20 dark:text-white",placeholder:"e.g. Scratch",value:L,onChange:o=>D(o.target.value),onKeyDown:o=>o.key==="Enter"&&i()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{b(k.filter(o=>o.id!==S.id)),E(null)},className:"flex-1 bg-red-100 text-red-600 py-1 rounded text-xs font-bold",children:"Delete"}),e.jsx("button",{onClick:i,className:"flex-1 bg-brand-blue text-white py-1 rounded text-xs font-bold",children:"Save"})]})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Damage Log"}),e.jsx("div",{className:"space-y-2",children:k.map((o,t)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-black/20 rounded border dark:border-gray-700",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-red-500 text-white flex items-center justify-center text-xs font-bold shrink-0",children:t+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:o.label||"Unlabeled"}),e.jsxs("div",{className:"text-[10px] text-gray-500 uppercase",children:[o.view," View"]})]}),e.jsx("button",{onClick:()=>b(k.filter(C=>C.id!==o.id)),children:e.jsx(q,{size:14,className:"text-gray-400 hover:text-red-500"})})]},t))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Notes"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg text-sm dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Overall condition...",value:w,onChange:o=>p(o.target.value)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Evidence Photos"}),e.jsxs("label",{className:"cursor-pointer text-brand-blue hover:text-blue-600",children:[e.jsx(je,{size:16}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:m,disabled:T})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:u.map((o,t)=>e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden border dark:border-gray-600 relative group",children:[e.jsx("img",{src:o.url,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>j(u.filter((C,I)=>I!==t)),className:"absolute top-1 right-1 bg-red-500 text-white p-0.5 rounded opacity-0 group-hover:opacity-100 transition",children:e.jsx(q,{size:12})})]},t))})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:()=>r({gearType:f,markers:k,notes:w,photos:u,timestamp:new Date().toISOString()}),className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:18})," Finalize Report"]})})]})]})]})}const Et=(a,r,c,l)=>{const y=a*Math.PI/180,n=c*Math.PI/180,h=(c-a)*Math.PI/180,k=(l-r)*Math.PI/180,b=Math.sin(h/2)*Math.sin(h/2)+Math.cos(y)*Math.cos(n)*Math.sin(k/2)*Math.sin(k/2);return 6371e3*(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)))};function _t(a,r){const[c,l]=d.useState(null),[f,y]=d.useState(null),[n,h]=d.useState(!1),[k,b]=d.useState(null),[w,p]=d.useState([]),[u,j]=d.useState(null),[S,E]=d.useState(null),[L,D]=d.useState(!1),g=d.useCallback(()=>{if(!navigator.geolocation)return y("Geolocation not supported"),null;navigator.geolocation.getCurrentPosition(i=>{const m={lat:i.coords.latitude,lng:i.coords.longitude,accuracy:i.coords.accuracy};return l(m),m},i=>(y(i.message),null))},[]),T=d.useCallback(async()=>(c&&console.warn("Safe zone verification not yet implemented with Neon"),!1),[c]),F=d.useCallback(()=>{if(!c||!u)return null;const i=Et(c.lat,c.lng,u.lat,u.lng);return E(i),D(i<=100),i},[c,u]);return{currentPosition:c,locationError:f,isInSafeZone:n,nearestSafeZone:k,safeZones:w,otherPartyPosition:u,proximityToOther:S,isWithinProximity:L,getCurrentPosition:g,verifySafeZone:T,verifyProximity:F}}function Le({mode:a="capture",role:r="seller",listingPhotos:c=[],sellerDeparturePhotos:l=[],itemDescription:f="",onPhotosSubmitted:y,onVerificationComplete:n,requiredPhotoCount:h=3,userId:k}){const[b,w]=d.useState([]),[p,u]=d.useState(0),[j,S]=d.useState(!1),[E,L]=d.useState(0),[D,g]=d.useState(null),[T,F]=d.useState(""),[i,m]=d.useState(!1),[o,t]=d.useState(!1),C=d.useRef(null),I=d.useRef(null),V=d.useRef(null),{uploadMedia:N,uploading:Y}=be(),R=d.useCallback(async()=>{try{const _=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});C.current&&(C.current.srcObject=_,V.current=_,m(!0))}catch(_){console.error("Failed to access camera:",_),alert("Unable to access camera. Please check permissions.")}},[]),K=d.useCallback(()=>{V.current&&(V.current.getTracks().forEach(_=>_.stop()),V.current=null),m(!1)},[]),J=d.useCallback(async()=>{if(!C.current||!I.current)return;const _=C.current,x=I.current;x.width=_.videoWidth,x.height=_.videoHeight,x.getContext("2d").drawImage(_,0,0),x.toBlob(async Q=>{if(Q)try{const U=new File([Q],`verification_${Date.now()}.jpg`,{type:"image/jpeg"}),se=await N(U,`safe_exchange/${k}/verification`);se!=null&&se.url&&w(ne=>[...ne,{url:se.url,timestamp:Date.now(),type:r==="seller"?"departure":"inspection"}])}catch(U){console.error("Failed to upload photo:",U)}},"image/jpeg",.9)},[N,k,r]),X=async _=>{const x=_.target.files[0];if(x)try{const A=await N(x,`safe_exchange/${k}/verification`);A!=null&&A.url&&w(Q=>[...Q,{url:A.url,timestamp:Date.now(),type:r==="seller"?"departure":"inspection"}])}catch(A){console.error("Failed to upload photo:",A)}},s=_=>{w(x=>x.filter((A,Q)=>Q!==_)),p>=b.length-1&&u(Math.max(0,b.length-2))},z=async()=>{if(b.length<h){alert(`Please capture at least ${h} photos.`);return}t(!0);try{await(y==null?void 0:y(b,T))}finally{t(!1),K()}},O=async _=>{g(_),t(!0);try{await(n==null?void 0:n({result:_,notes:T,buyerPhotos:b,timestamp:Date.now()}))}finally{t(!1)}},M=()=>{var _;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 p-6 rounded-xl text-white",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:r==="seller"?"ðŸ“¦ Pre-Departure Photos":"ðŸ” Inspection Photos"}),e.jsx("p",{className:"text-sm opacity-90",children:r==="seller"?"Take clear photos of the item before leaving for the exchange. These will be shown to the buyer for verification.":"Take photos of the item as received. Compare with seller's photos to verify condition."})]}),e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:i?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:C,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:I,className:"hidden"}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-4",children:[e.jsx("button",{onClick:K,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full backdrop-blur-sm transition",children:e.jsx(q,{className:"text-white",size:24})}),e.jsx("button",{onClick:J,disabled:Y,className:"p-5 bg-white rounded-full shadow-lg hover:scale-110 transition disabled:opacity-50",children:e.jsx(te,{className:Y?"animate-pulse text-orange-500":"text-gray-900",size:32})}),e.jsx("button",{className:"p-3 bg-white/20 rounded-full opacity-0 pointer-events-none",children:e.jsx(q,{size:24})})]})]}):b.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:(_=b[p])==null?void 0:_.url,alt:`Photo ${p+1}`,className:"w-full h-full object-contain"}),b.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(Math.max(0,p-1)),className:"absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full hover:bg-black/70",disabled:p===0,children:e.jsx(lt,{className:"text-white"})}),e.jsx("button",{onClick:()=>u(Math.min(b.length-1,p+1)),className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full hover:bg-black/70",disabled:p===b.length-1,children:e.jsx(Me,{className:"text-white"})})]}),e.jsxs("div",{className:"absolute top-4 right-4 bg-black/60 text-white text-sm px-3 py-1 rounded-full",children:[p+1," / ",b.length]}),e.jsx("button",{onClick:()=>s(p),className:"absolute top-4 left-4 p-2 bg-red-600 rounded-full hover:bg-red-700",children:e.jsx(q,{className:"text-white",size:16})})]}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(te,{size:64,className:"mb-4 opacity-30"}),e.jsx("p",{children:"No photos captured yet"})]})}),b.length>0&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[b.map((x,A)=>e.jsx("button",{onClick:()=>u(A),className:`relative shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition ${A===p?"border-orange-500 ring-2 ring-orange-500/30":"border-transparent hover:border-gray-400"}`,children:e.jsx("img",{src:x.url,alt:"",className:"w-full h-full object-cover"})},A)),b.length<10&&e.jsx("button",{onClick:R,className:"shrink-0 w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center hover:border-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition",children:e.jsx(te,{className:"text-gray-400",size:20})})]}),e.jsx("div",{className:"flex gap-3",children:!i&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:R,className:"flex-1 bg-gray-900 dark:bg-white dark:text-black text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition",children:[e.jsx(te,{size:20})," Open Camera"]}),e.jsxs("label",{className:"flex-1 bg-gray-100 dark:bg-gray-800 py-3 rounded-xl font-bold flex items-center justify-center gap-2 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition",children:[e.jsx(je,{size:20})," Upload Photo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:X})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:T,onChange:x=>F(x.target.value),placeholder:r==="seller"?"Any notes about current condition...":"Note any concerns or observations...",className:"w-full p-3 border rounded-xl dark:bg-gray-800 dark:border-gray-600 dark:text-white resize-none",rows:3})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-bold dark:text-white",children:["Photos: ",b.length," / ",h," required"]}),b.length>=h&&e.jsx(H,{className:"text-green-500",size:20})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${Math.min(100,b.length/h*100)}%`}})})]}),e.jsx("button",{onClick:z,disabled:b.length<h||o,className:"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-700 transition shadow-lg",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{size:20})," Submit Photos"]})})]})},$=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-6 rounded-xl text-white",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"ðŸ” Verify Item Condition"}),e.jsx("p",{className:"text-sm opacity-90",children:"Compare the seller's pre-departure photos with the item in front of you. Does it match the listing description?"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Seller's Photo (",E+1,"/",l.length,")"]}),e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-square",children:l[E]?e.jsx("img",{src:l[E].url,alt:"Seller's photo",className:"w-full h-full object-contain"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No photo available"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Original Listing (",E+1,"/",c.length,")"]}),e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-square",children:c[E]?e.jsx("img",{src:c[E],alt:"Listing photo",className:"w-full h-full object-contain"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No photo available"})})]})]}),e.jsx("div",{className:"flex justify-center gap-2",children:Array.from({length:Math.max(l.length,c.length)}).map((_,x)=>e.jsx("button",{onClick:()=>L(x),className:`w-3 h-3 rounded-full transition ${x===E?"bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},x))}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white mb-2",children:"ðŸ“‹ Listing Description"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:f||"No description provided"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-bold dark:text-white text-center",children:"Does the item match the photos and description?"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>O("match"),disabled:o,className:"p-4 bg-green-100 dark:bg-green-900/30 border-2 border-green-500 rounded-xl flex flex-col items-center gap-2 hover:bg-green-200 dark:hover:bg-green-900/50 transition",children:[e.jsx(H,{className:"text-green-600",size:32}),e.jsx("span",{className:"font-bold text-green-700 dark:text-green-400",children:"Yes, Matches"})]}),e.jsxs("button",{onClick:()=>O("unsure"),disabled:o,className:"p-4 bg-yellow-100 dark:bg-yellow-900/30 border-2 border-yellow-500 rounded-xl flex flex-col items-center gap-2 hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition",children:[e.jsx(it,{className:"text-yellow-600",size:32}),e.jsx("span",{className:"font-bold text-yellow-700 dark:text-yellow-400",children:"Unsure"})]}),e.jsxs("button",{onClick:()=>O("mismatch"),disabled:o,className:"p-4 bg-red-100 dark:bg-red-900/30 border-2 border-red-500 rounded-xl flex flex-col items-center gap-2 hover:bg-red-200 dark:hover:bg-red-900/50 transition",children:[e.jsx(nt,{className:"text-red-600",size:32}),e.jsx("span",{className:"font-bold text-red-700 dark:text-red-400",children:"No, Different"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Describe Any Concerns"}),e.jsx("textarea",{value:T,onChange:_=>F(_.target.value),placeholder:"Note any differences, damage, or concerns...",className:"w-full p-3 border rounded-xl dark:bg-gray-800 dark:border-gray-600 dark:text-white resize-none",rows:3})]})]});return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[a==="capture"&&M(),a==="compare"&&$()]})}function zt({transactionId:a,user:r,userData:c,onClose:l,onComplete:f,onMessage:y}){var ne,G,we,Se,Ce,Pe,Ee,_e;const n=(r==null?void 0:r.id)||(r==null?void 0:r.uid),{transaction:h,loading:k}=ft(a),{updateTransaction:b}=me(),[w,p]=d.useState(!1),[u,j]=d.useState(null),[S,E]=d.useState(""),[L,D]=d.useState(""),[g,T]=d.useState(!1),[F,i]=d.useState([]),[m,o]=d.useState(null),t=h?{id:h.id,...h,buyerId:(ne=h.parties)==null?void 0:ne.buyer,sellerId:(G=h.parties)==null?void 0:G.seller,listingId:h.item_id,itemDetails:h.item_details,verificationData:h.verification_data}:null,C=(t==null?void 0:t.sellerId)===n,I=(t==null?void 0:t.buyerId)===n,V=C?"seller":"buyer",{currentPosition:N,isInSafeZone:Y,nearestSafeZone:R,isWithinProximity:K,startWatching:J,findNearbySafeZones:X}=_t(a,r==null?void 0:r.uid);d.useEffect(()=>{if(!t||!N)return;(async()=>{try{await b(a,{[V==="seller"?"seller_location":"buyer_location"]:{lat:N.lat,lng:N.lng,updated_at:Date.now()}})}catch(Z){console.error("Failed to update position:",Z)}})()},[N,t,a,V,b]),d.useEffect(()=>{g&&N&&X().then(P=>i(P))},[g,N,X]);const s=d.useCallback(async(P,Z={})=>{if(!a)return;p(!0);const oe=(r==null?void 0:r.id)||(r==null?void 0:r.uid);try{const ae=(t==null?void 0:t.verificationData)||{},ce=ae.status_history||{};ce[P]={timestamp:Date.now(),userId:oe},await b(a,{status:P,verification_data:{...ae,status_history:ce,...Z}})}catch(ae){console.error("Failed to update status:",ae),alert("Failed to update transaction. Please try again.")}p(!1)},[a,t,r==null?void 0:r.id,r==null?void 0:r.uid,b]),z=async()=>{if(!u||!S||!L){alert("Please select a safe zone and set a date/time.");return}await s(v.MEETUP_SCHEDULED,{meetupLocation:u,meetupDate:S,meetupTime:L}),T(!1)},O=()=>{o("seller_depart"),J()},M=async(P,Z)=>{await s(v.SELLER_PHOTOS_UPLOADED,{sellerDeparturePhotos:P,sellerDepartureNotes:Z}),o(null),await s(v.SELLER_EN_ROUTE)},$=()=>{J(),s(v.BUYER_EN_ROUTE)},_=async P=>{await s(v.BUYER_PHOTOS_UPLOADED,{buyerInspectionResult:P.result,buyerInspectionPhotos:P.buyerPhotos,buyerInspectionNotes:P.notes}),P.result==="mismatch"?await s(v.DISPUTED):await s(v.PENDING_DUAL_APPROVAL),o(null)},x=async()=>{const P=C?"sellerApproved":"buyerApproved",Z=C?v.SELLER_APPROVED:v.BUYER_APPROVED;await s(Z,{[P]:!0,[`${P}At`]:Date.now()}),(C?t.buyerApproved:t.sellerApproved)&&await A()},A=async()=>{r!=null&&r.id||(r==null||r.uid),await s(v.COMPLETED,{completedAt:new Date().toISOString(),fundsReleased:!0,fundsReleasedAt:new Date().toISOString()}),f==null||f()},Q=async()=>{if(!confirm("Are you sure you want to cancel this transaction? This may affect your seller rating."))return;const P=(r==null?void 0:r.id)||(r==null?void 0:r.uid);await s(v.CANCELLED,{cancelledBy:P,cancelledAt:new Date().toISOString()}),l==null||l()},U=async P=>{const Z=(r==null?void 0:r.id)||(r==null?void 0:r.uid);await s(v.DISPUTED,{disputeReason:P,disputeRaisedBy:Z,disputeRaisedAt:new Date().toISOString()})},se=()=>({[v.INTENT_CREATED]:0,[v.HOLD_PLACED]:1,[v.SELLER_NOTIFIED]:1,[v.MEETUP_SCHEDULED]:2,[v.SELLER_EN_ROUTE]:3,[v.SELLER_PHOTOS_UPLOADED]:3,[v.BUYER_EN_ROUTE]:4,[v.AT_SAFE_ZONE]:4,[v.BUYER_INSPECTING]:5,[v.BUYER_PHOTOS_UPLOADED]:5,[v.PENDING_DUAL_APPROVAL]:6,[v.SELLER_APPROVED]:6,[v.BUYER_APPROVED]:6,[v.COMPLETED]:7})[t==null?void 0:t.status]||0;return k?e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[80]",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-8 rounded-2xl flex flex-col items-center gap-4",children:[e.jsx(ie,{className:"animate-spin text-orange-500",size:48}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading transaction..."})]})}):m==="seller_depart"?e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[80] overflow-y-auto",children:e.jsx("div",{className:"min-h-screen p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsxs("button",{onClick:()=>o(null),className:"mb-4 text-white flex items-center gap-2 hover:underline",children:[e.jsx(q,{size:20})," Cancel"]}),e.jsx(Le,{mode:"capture",role:"seller",listingPhotos:t.itemPhotos||[],itemDescription:t.itemDescription,onPhotosSubmitted:M,requiredPhotoCount:3,userId:r.uid})]})})}):m==="buyer_inspect"?e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[80] overflow-y-auto",children:e.jsx("div",{className:"min-h-screen p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsxs("button",{onClick:()=>o(null),className:"mb-4 text-white flex items-center gap-2 hover:underline",children:[e.jsx(q,{size:20})," Cancel"]}),e.jsx(Le,{mode:"compare",role:"buyer",listingPhotos:t.itemPhotos||[],sellerDeparturePhotos:t.sellerDeparturePhotos||[],itemDescription:t.itemDescription,onVerificationComplete:_,requiredPhotoCount:2,userId:r.uid})]})})}):e.jsxs("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden my-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 p-6 text-white relative overflow-hidden",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition",children:e.jsx(q,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 text-orange-200 text-xs font-bold uppercase tracking-widest mb-2",children:[e.jsx(ee,{size:14})," Safe Exchange"]}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:t==null?void 0:t.itemTitle}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ne,{size:16})," $",(we=t==null?void 0:t.price)==null?void 0:we.toLocaleString(),(t==null?void 0:t.serviceFee)&&e.jsx("span",{className:"text-orange-200 text-xs ml-1",children:"(1% mutual service fee)"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{size:16})," ",t==null?void 0:t.itemBrand]})]}),e.jsx(ee,{size:150,className:"absolute -right-10 -bottom-10 text-white opacity-10 rotate-12"})]}),e.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Transaction Progress"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${(t==null?void 0:t.status)===v.COMPLETED?"bg-green-100 text-green-700":(t==null?void 0:t.status)===v.DISPUTED?"bg-red-100 text-red-700":"bg-orange-100 text-orange-700"}`,children:(Se=t==null?void 0:t.status)==null?void 0:Se.replace(/_/g," ").toUpperCase()})]}),e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto pb-2",children:Ae.map((P,Z)=>{const oe=se(),ae=Z<oe,ce=Z===oe;return e.jsxs(De.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center shrink-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${ae?"bg-green-500 text-white":ce?"bg-orange-500 text-white animate-pulse":"bg-gray-200 dark:bg-gray-700 text-gray-500"}`,children:ae?e.jsx($e,{size:16}):Z+1}),e.jsx("span",{className:`text-[10px] mt-1 whitespace-nowrap ${ce?"font-bold text-orange-600":"text-gray-500"}`,children:P.label})]}),Z<Ae.length-1&&e.jsx("div",{className:`flex-1 h-1 min-w-[20px] rounded ${ae?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}`})]},P.key)})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500 rounded-full",children:e.jsx(ue,{className:"text-white",size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-green-800 dark:text-green-300",children:"Escrow Protected"}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:I?e.jsxs(e.Fragment,{children:["$",((Ce=t==null?void 0:t.buyerTotal)==null?void 0:Ce.toFixed(2))||((Pe=t==null?void 0:t.price)==null?void 0:Pe.toLocaleString())," held securely",(t==null?void 0:t.serviceFee)&&e.jsxs("span",{className:"text-green-500 text-xs",children:[" (includes 1% service fee: $",t.serviceFee.toFixed(2),")"]})]}):e.jsxs(e.Fragment,{children:["You'll receive $",((Ee=t==null?void 0:t.sellerPayout)==null?void 0:Ee.toFixed(2))||((_e=t==null?void 0:t.price)==null?void 0:_e.toLocaleString())," on completion",(t==null?void 0:t.serviceFee)&&e.jsxs("span",{className:"text-green-500 text-xs",children:[" (after 1% service fee: $",t.serviceFee.toFixed(2),")"]})]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-xl border ${C?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"dark:border-gray-700"}`,children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:["Seller ",C&&"(You)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{src:t==null?void 0:t.sellerPhoto,name:t==null?void 0:t.sellerName,size:"md"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:t==null?void 0:t.sellerName}),(t==null?void 0:t.sellerApproved)&&e.jsxs("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(H,{size:12})," Approved"]})]})]})]}),e.jsxs("div",{className:`p-4 rounded-xl border ${I?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"dark:border-gray-700"}`,children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:["Buyer ",I&&"(You)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{src:t==null?void 0:t.buyerPhoto,name:t==null?void 0:t.buyerName,size:"md"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:t==null?void 0:t.buyerName}),(t==null?void 0:t.buyerApproved)&&e.jsxs("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(H,{size:12})," Approved"]})]})]})]})]}),(t==null?void 0:t.meetupLocation)&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 flex items-center gap-2 mb-3",children:[e.jsx(de,{size:18})," Exchange Location"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300",children:[e.jsx(ee,{size:16}),e.jsx("span",{className:"font-bold",children:t.meetupLocation.name}),e.jsx("span",{className:"bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs px-2 py-0.5 rounded",children:t.meetupLocation.typeLabel})]}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:t.meetupLocation.address}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ze,{size:14})," ",t.meetupDate]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{size:14})," ",t.meetupTime]})]})]})]}),N&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl",children:[e.jsxs("h4",{className:"font-bold dark:text-white text-sm mb-3 flex items-center gap-2",children:[e.jsx(Ie,{size:16,className:"text-blue-500"})," Live Location"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Your Position:"}),e.jsxs("div",{className:"flex items-center gap-1 font-mono text-xs dark:text-white",children:[N.lat.toFixed(6),", ",N.lng.toFixed(6)]})]}),R&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Safe Zone:"}),e.jsx("div",{className:"flex items-center gap-1",children:Y?e.jsxs("span",{className:"text-green-600 font-bold flex items-center gap-1",children:[e.jsx(H,{size:14})," In Zone"]}):e.jsxs("span",{className:"text-orange-600",children:[Math.round(R.distance),"m away"]})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[C&&(t==null?void 0:t.status)===v.SELLER_NOTIFIED&&e.jsxs("button",{onClick:()=>T(!0),className:"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-orange-700 transition",children:[e.jsx(ze,{size:20})," Schedule Safe Exchange"]}),C&&(t==null?void 0:t.status)===v.MEETUP_SCHEDULED&&e.jsxs("button",{onClick:O,className:"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-orange-700 transition",children:[e.jsx(te,{size:20})," Take Pre-Departure Photos"]}),I&&(t==null?void 0:t.status)===v.SELLER_PHOTOS_UPLOADED&&e.jsxs("button",{onClick:$,className:"w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition",children:[e.jsx(Ie,{size:20})," I'm On My Way"]}),I&&((t==null?void 0:t.status)===v.BUYER_EN_ROUTE||(t==null?void 0:t.status)===v.AT_SAFE_ZONE)&&Y&&K&&e.jsxs("button",{onClick:()=>o("buyer_inspect"),className:"w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition",children:[e.jsx(te,{size:20})," Start Item Inspection"]}),(t==null?void 0:t.status)===v.PENDING_DUAL_APPROVAL&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800",children:[e.jsx("h4",{className:"font-bold text-yellow-800 dark:text-yellow-300 mb-2",children:"Final Approval Required"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:"Both parties must approve to release funds."})]}),(C&&!t.sellerApproved||I&&!t.buyerApproved)&&e.jsx("button",{onClick:x,disabled:w,className:"w-full bg-green-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-green-700 transition disabled:opacity-50",children:w?e.jsx(ie,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(H,{size:20})," Approve & Release Funds"]})}),(C&&t.sellerApproved||I&&t.buyerApproved)&&e.jsxs("div",{className:"text-center text-green-600 font-bold py-4",children:[e.jsx(H,{className:"inline mr-2"}),"You have approved. Waiting for other party..."]})]}),(t==null?void 0:t.status)===v.COMPLETED&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-6 rounded-xl border border-green-200 dark:border-green-800 text-center",children:[e.jsx(H,{className:"text-green-500 mx-auto mb-4",size:48}),e.jsx("h4",{className:"text-xl font-bold text-green-700 dark:text-green-300 mb-2",children:"Exchange Completed!"}),e.jsx("p",{className:"text-green-600 dark:text-green-400",children:C?"Funds have been released to your account.":"Thank you for your purchase!"})]}),(t==null?void 0:t.status)===v.DISPUTED&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-6 rounded-xl border border-red-200 dark:border-red-800 text-center",children:[e.jsx(Be,{className:"text-red-500 mx-auto mb-4",size:48}),e.jsx("h4",{className:"text-xl font-bold text-red-700 dark:text-red-300 mb-2",children:"Dispute Raised"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-4",children:"Our support team will review this transaction."}),e.jsx("button",{className:"bg-red-600 text-white px-6 py-2 rounded-lg font-bold",children:"Contact Support"})]}),(t==null?void 0:t.status)!==v.COMPLETED&&e.jsxs("button",{onClick:()=>y==null?void 0:y(C?t.buyerId:t.sellerId),className:"w-full border-2 border-gray-300 dark:border-gray-600 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-800 transition dark:text-white",children:[e.jsx(re,{size:18})," Message ",C?"Buyer":"Seller"]})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex justify-between",children:(t==null?void 0:t.status)!==v.COMPLETED&&(t==null?void 0:t.status)!==v.CANCELLED&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Q,className:"text-red-600 font-bold text-sm hover:underline",children:"Cancel Transaction"}),(t==null?void 0:t.status)!==v.DISPUTED&&e.jsx("button",{onClick:()=>U("Item not as described"),className:"text-orange-600 font-bold text-sm hover:underline",children:"Raise Dispute"})]})})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[75] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 w-full max-w-lg rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Select Safe Exchange Zone"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Choose a verified safe location for the exchange"})]}),e.jsx("div",{className:"p-4 max-h-[400px] overflow-y-auto space-y-2",children:F.length>0?F.map(P=>e.jsx("button",{onClick:()=>j(P),className:`w-full p-4 rounded-xl border text-left transition ${(u==null?void 0:u.id)===P.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-400"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${(u==null?void 0:u.id)===P.id?"bg-orange-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:e.jsx(ee,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold dark:text-white",children:P.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:P.address}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded",children:P.typeLabel}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(P.distance/1e3).toFixed(1)," km away"]})]})]}),(u==null?void 0:u.id)===P.id&&e.jsx(H,{className:"text-orange-500",size:20})]})},P.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(de,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Loading nearby safe zones..."})]})}),u&&e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date"}),e.jsx("input",{type:"date",value:S,onChange:P=>E(P.target.value),min:new Date().toISOString().split("T")[0],className:"w-full p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time"}),e.jsx("input",{type:"time",value:L,onChange:P=>D(P.target.value),className:"w-full p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]})]}),e.jsx("button",{onClick:z,disabled:!S||!L||w,className:"w-full bg-orange-600 text-white py-3 rounded-xl font-bold disabled:opacity-50 hover:bg-orange-700 transition",children:w?"Scheduling...":"Confirm & Notify Buyer"})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:()=>T(!1),className:"w-full text-gray-500 font-bold hover:text-gray-700 dark:hover:text-gray-300",children:"Cancel"})})]})})]})}const It=["Mint","Excellent","Good","Fair","Non-Functioning"],B={PENDING:"pending",CONFIRMED:"confirmed",SHIPPED:"shipped",DELIVERED:"delivered",COMPLETED:"completed",CANCELLED:"cancelled",REFUNDED:"refunded"},pe={[B.PENDING]:{label:"Pending",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",icon:xe},[B.CONFIRMED]:{label:"Confirmed",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:H},[B.SHIPPED]:{label:"Shipped",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400",icon:le},[B.DELIVERED]:{label:"Delivered",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:ve},[B.COMPLETED]:{label:"Completed",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:H},[B.CANCELLED]:{label:"Cancelled",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",icon:q},[B.REFUNDED]:{label:"Refunded",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400",icon:qe}},Re=.01,ye=a=>{const r=parseFloat(a)||0,c=Math.round(r*Re*100)/100,l=Math.round((r+c)*100)/100,f=Math.round((r-c)*100)/100;return{itemPrice:r,serviceFee:c,serviceFeeRate:Re,buyerTotal:l,sellerPayout:f}},tt=({rating:a,reviewCount:r,size:c="sm"})=>{if(!a&&!r)return null;const f={sm:{star:12,text:"text-xs"},md:{star:14,text:"text-sm"},lg:{star:16,text:"text-base"}}[c];return e.jsxs("div",{className:`flex items-center gap-1 ${f.text}`,children:[e.jsx(dt,{size:f.star,className:"text-yellow-500 fill-yellow-500"}),e.jsx("span",{className:"font-bold text-yellow-600 dark:text-yellow-400",children:(a==null?void 0:a.toFixed(1))||"â€”"}),r>0&&e.jsxs("span",{className:"text-gray-400",children:["(",r," sale",r!==1?"s":"",")"]})]})},Ot=({status:a})=>{const r={pending:{label:"Pending",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"},accepted:{label:"Accepted",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},declined:{label:"Declined",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},countered:{label:"Countered",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},expired:{label:"Expired",color:"bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400"}},c=r[a]||r.pending;return e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${c.color}`,children:c.label})},st=a=>a>=he;function Tt({user:a,userData:r,setActiveTab:c,openChat:l}){const f=r==null?void 0:r.id,y=f&&!f.startsWith("user_"),{data:n}=yt({status:"active"}),{data:h}=jt(y?f:null),{data:k}=Nt(y?f:null),{updateListingStatus:b,createOrder:w,updateOrderStatus:p,createTransaction:u}=me(),[j,S]=d.useState("browse"),[E,L]=d.useState("All"),[D,g]=d.useState(""),[T,F]=d.useState(null),[i,m]=d.useState(null),[o,t]=d.useState(null),C=(n||[]).map(s=>({id:s.id,...s,sellerId:s.seller_id,sellerName:s.seller_name,sellerPhoto:s.seller_photo,sellerRating:s.seller_rating,sellerSalesCount:s.seller_sales_count,sellerVerified:s.seller_verified,sellerResponseTime:s.seller_response_time,minimumOffer:s.minimum_offer,conditionReport:s.condition_report,timestamp:s.timestamp})),I=[...(h||[]).map(s=>{var O,M,$;const z=((O=s.parties)==null?void 0:O.buyer)===f;return{id:s.id,...s,buyerId:(M=s.parties)==null?void 0:M.buyer,sellerId:($=s.parties)==null?void 0:$.seller,listingId:s.item_id,role:z?"buyer":"seller"}})],V=(k||[]).map(s=>{const z=s.buyer_id===f;return{id:s.id,...s,buyerId:s.buyer_id,sellerId:s.seller_id,listingId:s.listing_id,itemTitle:s.item_title,itemBrand:s.item_brand,itemDescription:s.item_description,itemPhotos:s.item_photos,itemCondition:s.item_condition,itemPrice:s.item_price,serviceFee:s.service_fee,serviceFeeRate:s.service_fee_rate,buyerTotal:s.buyer_total,sellerPayout:s.seller_payout,buyerName:s.buyer_name,buyerPhoto:s.buyer_photo,sellerName:s.seller_name,sellerPhoto:s.seller_photo,fulfillmentMethod:s.fulfillment_method,shippingAddress:s.shipping_address,shippingPhone:s.shipping_phone,shippingNotes:s.shipping_notes,statusHistory:s.status_history,createdAt:s.created_at,updatedAt:s.updated_at,role:z?"buyer":"seller"}}).sort((s,z)=>{const O=s.createdAt?new Date(s.createdAt).getTime():0;return(z.createdAt?new Date(z.createdAt).getTime():0)-O}),N=async s=>{const z=r==null?void 0:r.id;if(!z||z.startsWith("user_")){alert("User profile not loaded. Please wait a moment and try again.");return}const O=ye(s.price);try{const M={[v.INTENT_CREATED]:{timestamp:Date.now(),userId:z}},$=await u({itemId:s.id,transactionType:"gear_sale",parties:{buyer:z,seller:s.sellerId,buyerName:r&&`${r.firstName||""} ${r.lastName||""}`.trim()||"Buyer",buyerPhoto:r.photoURL||null,sellerName:s.sellerName,sellerPhoto:s.sellerPhoto},itemDetails:{title:s.title,brand:s.brand,description:s.description||null,photos:s.images||[],condition:s.condition,price:s.price,itemPrice:O.itemPrice,serviceFee:O.serviceFee,serviceFeeRate:O.serviceFeeRate,buyerTotal:O.buyerTotal,sellerPayout:O.sellerPayout},verificationData:{statusHistory:M,escrowAmount:O.buyerTotal,escrowStatus:"held",sellerApproved:!1,buyerApproved:!1},status:v.SELLER_NOTIFIED});m($.id),F(null),W.success("Purchase initiated! Seller will be notified.")}catch(M){console.error("Failed to create safe exchange:",M),alert("Failed to initiate purchase. Please try again.")}},Y=async(s,z)=>{const O=W.loading("Processing your order..."),M=r==null?void 0:r.id;if(!M||M.startsWith("user_")){W.error("User profile not loaded. Please wait a moment and try again.",{id:O});return}const $=ye(s.price);try{const _=await w({listing_id:s.id,buyer_id:M,seller_id:s.sellerId,total_price:$.buyerTotal,item_title:s.title,item_brand:s.brand,item_description:s.description||null,item_photos:s.images||[],item_condition:s.condition,item_price:$.itemPrice,service_fee:$.serviceFee,service_fee_rate:$.serviceFeeRate,seller_payout:$.sellerPayout,buyer_name:r&&`${r.firstName||""} ${r.lastName||""}`.trim()||"Buyer",buyer_photo:r.photoURL||null,seller_name:s.sellerName,seller_photo:s.sellerPhoto,fulfillment_method:z.method,shipping_address:z.method==="shipping"?z.address:null,shipping_phone:z.phone||null,shipping_notes:z.notes||null,status_history:[{status:B.PENDING,timestamp:Date.now(),note:"Order placed by buyer"}]});return await b(s.id,"Pending Sale"),W.success("Order placed successfully!",{id:O}),F(null),S("orders"),_.id}catch(_){return console.error("Failed to create order:",_),W.error("Failed to place order. Please try again.",{id:O}),null}},R=async(s,z,O=null)=>{const M=W.loading("Updating order...");try{const $=V.find(A=>A.id===s);if(!$){W.error("Order not found",{id:M});return}const _=$.statusHistory||[],x={status:z,status_history:[..._,{status:z,timestamp:Date.now(),note:`Status updated to ${z}`}]};O&&(x.tracking_number=O.trackingNumber,x.tracking_carrier=O.carrier),await p(s,z),W.success(`Order ${z}!`,{id:M})}catch($){console.error("Failed to update order:",$),W.error("Failed to update order. Please try again.",{id:M})}},K=V.filter(s=>s.status!==B.COMPLETED&&s.status!==B.CANCELLED&&s.status!==B.REFUNDED),J=C.filter(s=>(E==="All"||s.category===E)&&(s.title.toLowerCase().includes(D.toLowerCase())||s.brand.toLowerCase().includes(D.toLowerCase()))),X=I.filter(s=>s.status!==v.COMPLETED&&s.status!==v.CANCELLED);return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 animate-in fade-in",children:[i&&e.jsx(zt,{transactionId:i,user:a,userData:r,onClose:()=>m(null),onComplete:()=>{m(null)},onMessage:s=>{l==null||l(s)}}),j==="browse"&&e.jsxs(e.Fragment,{children:[X.length>0&&e.jsxs("div",{className:"mb-6 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ee,{className:"text-orange-600",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-orange-800 dark:text-orange-300",children:"Active Safe Exchanges"}),e.jsxs("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:["You have ",X.length," pending transaction",X.length>1?"s":""]})]})]}),e.jsx("div",{className:"space-y-2",children:X.map(s=>e.jsxs("button",{onClick:()=>m(s.id),className:"w-full flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${s.role==="buyer"?"bg-blue-100 text-blue-600":"bg-green-100 text-green-600"}`,children:s.role==="buyer"?e.jsx(He,{size:16}):e.jsx(Ne,{size:16})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:s.itemTitle}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.role==="buyer"?"Buying":"Selling"," â€¢ $",s.price]})]})]}),e.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-bold",children:s.status.replace(/_/g," ")})]},s.id))})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ge,{className:"text-orange-500"})," Gear Exchange"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Buy and sell verified studio equipment."})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(Ve,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2c2e36] text-sm dark:text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Search gear...",value:D,onChange:s=>g(s.target.value)})]}),e.jsxs("button",{onClick:()=>S("orders"),className:"relative bg-white dark:bg-[#2c2e36] border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 transition",children:[e.jsx(Ye,{size:16})," Orders",K.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center",children:K.length})]}),e.jsxs("button",{onClick:()=>S("create"),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 shadow-lg transition",children:[e.jsx(We,{size:16})," Sell Gear"]})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2",children:[e.jsx("button",{onClick:()=>L("All"),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${E==="All"?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:"All Gear"}),fe.map(s=>e.jsx("button",{onClick:()=>L(s.id),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${E===s.id?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:s.label},s.id))]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:J.map(s=>{var O;const z=st(s.price);return e.jsxs("div",{onClick:()=>F(s),className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-xl transition cursor-pointer group flex flex-col",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 dark:bg-black/40 relative flex items-center justify-center overflow-hidden",children:[(O=s.images)!=null&&O[0]?e.jsx("img",{src:s.images[0],className:"w-full h-full object-cover group-hover:scale-105 transition duration-500"}):e.jsx(te,{size:32,className:"text-gray-400"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur-md",children:["$",s.price]}),z&&e.jsxs("div",{className:"absolute top-2 left-2 bg-orange-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(ee,{size:10})," Safe Exchange"]}),s.conditionReport&&e.jsxs("div",{className:"absolute bottom-2 left-2 bg-green-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(H,{size:10})," Inspected"]}),s.acceptsOffers&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-blue-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(re,{size:10})," Offers"]})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-400 uppercase mb-1",children:s.brand}),e.jsx("h4",{className:"font-bold dark:text-white text-sm mb-1 line-clamp-1",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[s.condition," Condition"]}),s.sellerRating&&e.jsx("div",{className:"mb-2",children:e.jsx(tt,{rating:s.sellerRating,reviewCount:s.sellerSalesCount,size:"sm"})}),e.jsxs("div",{className:"mt-auto pt-3 border-t dark:border-gray-700 flex justify-between items-center text-xs text-gray-400",children:[e.jsx("span",{className:"flex items-center gap-1",children:z?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:10})," Local Pickup"]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{size:10})," ",s.location||"Ships"]})}),s.sellerVerified&&e.jsx(Ze,{size:14,className:"text-blue-500"})]})]})]},s.id)})})]}),j==="create"&&e.jsx(Ft,{user:a,userData:r,onCancel:()=>S("browse"),onSuccess:()=>S("browse")}),j==="orders"&&e.jsx(Lt,{orders:V,user:a,userData:r,onBack:()=>S("browse"),onUpdateStatus:R,openChat:l}),T&&e.jsx(At,{item:T,onClose:()=>F(null),currentUser:a,currentUserData:r,onSafeExchangePurchase:N,onStandardPurchase:Y})]})}function Ft({user:a,userData:r,onCancel:c,onSuccess:l}){const[f,y]=d.useState(1),[n,h]=d.useState({title:"",brand:"",category:fe[0].id,condition:"Good",price:"",description:"",location:r.city||"",weight:"",length:"",width:"",height:"",acceptsOffers:!0,minimumOffer:""}),[k,b]=d.useState([]),[w,p]=d.useState(null),[u,j]=d.useState(!1),{uploadMedia:S,uploading:E}=be(),L=async g=>{const T=g.target.files[0];if(!T)return;const F=await S(T,`gear/${a.uid}`);F!=null&&F.url&&b([...k,F.url])},D=async()=>{if(!n.title||!n.price){alert("Title and Price required.");return}const g=r==null?void 0:r.id;if(!g||g.startsWith("user_")){alert("User profile not loaded. Please wait a moment and try again.");return}j(!0);try{await createListing({seller_id:g,title:n.title,brand:n.brand,category:n.category,condition:n.condition,price:parseInt(n.price),description:n.description||null,location:n.location||null,weight:n.weight||null,length:n.length||null,width:n.width||null,height:n.height||null,accepts_offers:n.acceptsOffers||!1,minimum_offer:n.minimumOffer?parseInt(n.minimumOffer):null,images:k||[],condition_report:w}),W.success("Listing posted!"),l()}catch(T){console.error(T),W.error("Failed to post listing.")}j(!1)};return f==="inspection"?e.jsx("div",{className:"h-[600px]",children:e.jsx(Pt,{type:"Pre",onSave:g=>{p(g),y(1)},onCancel:()=>y(1)})}):e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border dark:border-gray-700 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"List Gear for Sale"}),e.jsx("button",{onClick:c,children:e.jsx(q,{className:"text-gray-400"})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:n.brand,onChange:g=>h({...n,brand:g.target.value}),placeholder:"e.g. Fender"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model / Title"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:n.title,onChange:g=>h({...n,title:g.target.value}),placeholder:"e.g. Stratocaster"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:n.category,onChange:g=>h({...n,category:g.target.value}),children:fe.map(g=>e.jsx("option",{value:g.id,children:g.label},g.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Condition"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:n.condition,onChange:g=>h({...n,condition:g.target.value}),children:It.map(g=>e.jsx("option",{value:g,children:g},g))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Price ($)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",value:n.price,onChange:g=>h({...n,price:g.target.value})}),n.price&&parseInt(n.price)>=he&&e.jsx("div",{className:"mt-3 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{className:"text-orange-500 shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-300 text-sm",children:"Safe Exchange Required"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-orange-400 mt-1",children:["Items priced at $",he,"+ require in-person exchange at a verified safe location (police station, bank, etc.). Buyers will initiate a Safe Exchange with payment held in escrow until both parties approve."]}),e.jsxs("ul",{className:"text-xs text-orange-600 dark:text-orange-400 mt-2 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:10})," No shipping available for high-value items"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(te,{size:10})," You must upload pre-departure photos"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(de,{size:10})," GPS verification at exchange location"]})]})]})]})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-400 text-sm flex items-center gap-2",children:[e.jsx(re,{size:16}),"Accept Offers"]}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300 mt-1",children:"Allow buyers to negotiate on price"})]}),e.jsx("button",{type:"button",onClick:()=>h({...n,acceptsOffers:!n.acceptsOffers}),className:"p-1",children:n.acceptsOffers?e.jsx(ot,{size:32,className:"text-blue-600"}):e.jsx(ct,{size:32,className:"text-gray-400"})})]}),n.acceptsOffers&&n.price&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 dark:border-blue-800",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Minimum Acceptable Offer (Optional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",placeholder:`e.g., ${Math.round(parseInt(n.price)*.8)}`,value:n.minimumOffer,onChange:g=>h({...n,minimumOffer:g.target.value}),className:"flex-1 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm"}),e.jsx("span",{className:"text-sm text-gray-500",children:n.minimumOffer&&n.price?`(${Math.round(parseInt(n.minimumOffer)/parseInt(n.price)*100)}%)`:""})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:'Offers below this will be flagged as "Low Offer" to buyers'})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Weight (lb)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"lbs",value:n.weight,onChange:g=>h({...n,weight:g.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"L (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Len",value:n.length,onChange:g=>h({...n,length:g.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"W (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Wid",value:n.width,onChange:g=>h({...n,width:g.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"H (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Hgt",value:n.height,onChange:g=>h({...n,height:g.target.value})})]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-1",children:"Tech Inspection Report"}),e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-300",children:w?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{size:12})," Report Attached (",w.markers.length," points)"]}):"Mark scratches, dents, or issues on a diagram to build trust."})]}),e.jsx("button",{onClick:()=>y("inspection"),className:`text-xs font-bold px-3 py-2 rounded-lg border transition ${w?"bg-white text-green-600 border-green-200":"bg-orange-100 text-orange-700 border-orange-200 hover:bg-orange-200"}`,children:w?"Edit Report":"Create Report"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Photos"}),e.jsxs("div",{className:"flex gap-2",children:[k.map((g,T)=>e.jsx("img",{src:g,className:"w-16 h-16 rounded-lg object-cover border dark:border-gray-600"},T)),e.jsxs("label",{className:"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",children:[E?e.jsx(ie,{className:"animate-spin text-gray-400"}):e.jsx(We,{className:"text-gray-400"}),e.jsx("input",{type:"file",className:"hidden",onChange:L,disabled:E})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:c,className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"Cancel"}),e.jsx("button",{onClick:D,disabled:u||E,className:"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg flex items-center justify-center gap-2",children:u?e.jsx(ie,{className:"animate-spin"}):"Post Listing"})]})]})]})}function At({item:a,onClose:r,currentUser:c,currentUserData:l,onSafeExchangePurchase:f,onStandardPurchase:y}){var O,M,$,_;const[n,h]=d.useState(!1),[k,b]=d.useState(!1),[w,p]=d.useState(!1),[u,j]=d.useState(!1),[S,E]=d.useState(""),[L,D]=d.useState(""),[g,T]=d.useState(!1),[F,i]=d.useState([]),[m,o]=d.useState(!0),[t,C]=d.useState(1),[I,V]=d.useState("shipping"),[N,Y]=d.useState({street:((O=l==null?void 0:l.address)==null?void 0:O.street)||"",city:(l==null?void 0:l.city)||"",state:(l==null?void 0:l.state)||"",zip:(l==null?void 0:l.zip)||"",phone:(l==null?void 0:l.phone)||"",notes:""}),R=st(a.price);d.useEffect(()=>{if(!a.id||!(c!=null&&c.uid)){o(!1);return}if(!supabase)return;l!=null&&l.id||c!=null&&c.id||(c==null||c.uid);const x=supabase.channel(`gear-offers-${a.id}`).on("postgres_changes",{event:"*",schema:"public",table:"gear_offers",filter:`listing_id=eq.${a.id}`},()=>{A()}).subscribe();return A(),()=>{supabase.removeChannel(x)};async function A(){if(!supabase)return;const Q=(l==null?void 0:l.id)||(c==null?void 0:c.id)||(c==null?void 0:c.uid);o(!0);try{const{data:U,error:se}=await supabase.from("gear_offers").select("*").eq("listing_id",a.id).eq("buyer_id",Q).order("created_at",{ascending:!1});if(se)throw se;const ne=(U||[]).map(G=>({id:G.id,...G,listingId:G.listing_id,buyerId:G.buyer_id,sellerId:G.seller_id,itemTitle:G.item_title,itemBrand:G.item_brand,askingPrice:G.asking_price,offerAmount:G.offer_amount,buyerName:G.buyer_name,buyerPhoto:G.buyer_photo,sellerName:G.seller_name,createdAt:G.created_at?new Date(G.created_at):new Date,expiresAt:G.expires_at}));i(ne)}catch(U){console.error("Error fetching offers:",U)}o(!1)}},[a.id,c==null?void 0:c.uid]);const K=async()=>{R?(b(!0),await f(a),b(!1)):(j(!0),C(1))},J=async()=>{b(!0);const x={method:I,address:I==="shipping"?{street:N.street,city:N.city,state:N.state,zip:N.zip}:null,phone:N.phone,notes:N.notes};await y(a,x)&&(j(!1),r()),b(!1)},X=()=>I==="shipping"?N.street&&N.city&&N.state&&N.zip:!0,s=async()=>{if(!S||parseFloat(S)<=0){W.error("Please enter a valid offer amount");return}const x=parseFloat(S);if(x>=a.price){W.error("Offer must be less than the asking price");return}T(!0);const A=W.loading("Submitting offer..."),Q=(l==null?void 0:l.id)||(c==null?void 0:c.id)||(c==null?void 0:c.uid);try{await createOffer({listing_id:a.id,offeror_id:Q,recipient_id:a.sellerId,offer_amount:x,message:L||null}),W.success("Offer submitted!",{id:A}),p(!1),E(""),D("")}catch(U){console.error("Failed to submit offer:",U),W.error("Failed to submit offer",{id:A})}T(!1)},z=x=>Math.round(x/a.price*100);return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-4xl h-[90vh] rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden border dark:border-gray-700",children:[e.jsxs("div",{className:"md:w-1/2 bg-black relative flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 relative",children:[n&&a.conditionReport?e.jsxs("div",{className:"w-full h-full bg-white rounded-xl overflow-hidden",children:[e.jsx(et,{type:a.conditionReport.gearType,view:"front",markers:a.conditionReport.markers,onClick:()=>{}}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/80 text-white px-3 py-1 rounded-full text-xs",children:"Inspection View"})]}):(M=a.images)!=null&&M[0]?e.jsx("img",{src:a.images[0],className:"max-h-full max-w-full object-contain"}):e.jsx(te,{size:48,className:"text-gray-600"}),e.jsx("button",{onClick:r,className:"absolute top-4 left-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70",children:e.jsx(q,{size:20})}),R&&e.jsxs("div",{className:"absolute top-4 right-4 bg-orange-500 text-white px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1.5 shadow-lg",children:[e.jsx(ee,{size:14})," Safe Exchange Required"]})]}),a.conditionReport&&e.jsxs("div",{className:"p-4 bg-[#1f2128] border-t border-gray-800 flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>h(!1),className:`px-4 py-2 rounded text-xs font-bold ${n?"bg-gray-800 text-gray-400":"bg-orange-600 text-white"}`,children:"Photos"}),e.jsxs("button",{onClick:()=>h(!0),className:`px-4 py-2 rounded text-xs font-bold flex items-center gap-1 ${n?"bg-orange-600 text-white":"bg-gray-800 text-gray-400"}`,children:[e.jsx(Be,{size:12})," Condition Map"]})]})]}),e.jsxs("div",{className:"md:w-1/2 p-8 overflow-y-auto bg-white dark:bg-[#2c2e36]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-bold text-gray-400 uppercase tracking-wider mb-1",children:a.brand}),e.jsx("h2",{className:"text-3xl font-extrabold dark:text-white mb-2",children:a.title}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["$",a.price]}),e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-1 rounded text-xs font-bold",children:a.condition}),a.acceptsOffers&&e.jsxs("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-1 rounded text-xs font-bold flex items-center gap-1",children:[e.jsx(re,{size:12})," Open to Offers"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[R&&e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-500 rounded-lg",children:e.jsx(ee,{className:"text-white",size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-300 mb-1",children:"Safe Exchange Protection"}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-400 mb-3",children:["High-value items ($",he,"+) require in-person exchange at a verified safe location."]}),e.jsxs("ul",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(ue,{size:12})," Payment held in escrow until exchange"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(de,{size:12})," Meet at police station or safe zone"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(te,{size:12})," Photo verification required"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(H,{size:12})," Both parties must approve"]})]})]})]})}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.sellerPhoto?e.jsx("img",{src:a.sellerPhoto,className:"w-12 h-12 rounded-full bg-gray-300 object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-lg",children:($=a.sellerName)==null?void 0:$[0]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold dark:text-white",children:a.sellerName}),a.sellerVerified&&e.jsx(Ze,{size:16,className:"text-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx(tt,{rating:a.sellerRating,reviewCount:a.sellerSalesCount,size:"md"}),a.sellerResponseTime&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(xe,{size:12}),"Responds in ",a.sellerResponseTime]})]})]})]})}),F.length>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm mb-3 flex items-center gap-2",children:[e.jsx(re,{size:16}),"Your Offers"]}),e.jsx("div",{className:"space-y-2",children:F.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold dark:text-white",children:["$",x.offerAmount]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",z(x.offerAmount),"% of asking)"]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:x.createdAt.toLocaleDateString()})]}),e.jsx(Ot,{status:x.status})]},x.id))})]}),e.jsxs("div",{className:`p-3 rounded-xl border ${R?"bg-orange-50 dark:bg-orange-900/10 border-orange-200 dark:border-orange-800":"bg-green-50 dark:bg-green-900/10 border-green-200 dark:border-green-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:R?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"text-orange-600",size:18}),e.jsx("span",{className:"font-bold text-orange-700 dark:text-orange-400",children:"Local Pickup Only"})]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"text-green-600",size:18}),e.jsx("span",{className:"font-bold text-green-700 dark:text-green-400",children:"Shipping Available"})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:R?"You will coordinate a meetup at a verified safe exchange zone":a.location||"Contact seller for shipping details"})]}),((_=a.conditionReport)==null?void 0:_.notes)&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800/50",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-2 flex items-center gap-2",children:[e.jsx(Ge,{size:16})," Tech Notes"]}),e.jsxs("p",{className:"text-sm text-orange-900 dark:text-orange-200 italic",children:['"',a.conditionReport.notes,'"']})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm uppercase",children:"Description"}),e.jsx("p",{children:a.description||"No description provided."})]})]}),w&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm mb-3 flex items-center gap-2",children:[e.jsx(re,{size:16}),"Make an Offer"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Your Offer ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"number",value:S,onChange:x=>E(x.target.value),placeholder:`Asking: $${a.price}`,className:"w-full pl-9 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),S&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[z(parseFloat(S)),"% of asking price",parseFloat(S)<a.price*.7&&e.jsx("span",{className:"text-amber-600 ml-1",children:"(Low offer)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Message (Optional)"}),e.jsx("textarea",{value:L,onChange:x=>D(x.target.value),placeholder:"Add a message to the seller...",rows:2,className:"w-full p-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 py-2 text-gray-600 dark:text-gray-400 font-medium hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:s,disabled:g||!S,className:"flex-1 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:g?e.jsx(ie,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:[e.jsx(xt,{size:16})," Submit Offer"]})})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[e.jsx(xe,{size:10}),"Offers expire after 48 hours if not responded to"]})]})]}),e.jsx(Ue,{children:u&&e.jsxs(ge.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mt-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-5 rounded-xl border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-bold text-green-800 dark:text-green-300 flex items-center gap-2",children:[e.jsx(Oe,{size:18}),"Checkout"]}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{size:18})})]}),e.jsx("div",{className:"flex items-center gap-2 mb-6",children:[1,2,3].map(x=>e.jsxs(De.Fragment,{children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all ${t>=x?"bg-green-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-500"}`,children:t>x?e.jsx(H,{size:16}):x}),x<3&&e.jsx("div",{className:`flex-1 h-1 rounded ${t>x?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}`})]},x))}),t===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"How would you like to receive this item?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>V("shipping"),className:`p-4 rounded-xl border-2 transition-all ${I==="shipping"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx(le,{size:24,className:I==="shipping"?"text-green-600 mx-auto mb-2":"text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Ship to Me"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Delivered to your door"})]}),e.jsxs("button",{onClick:()=>V("pickup"),className:`p-4 rounded-xl border-2 transition-all ${I==="pickup"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx(Xe,{size:24,className:I==="pickup"?"text-green-600 mx-auto mb-2":"text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Local Pickup"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Meet the seller"})]})]}),e.jsxs("button",{onClick:()=>C(2),className:"w-full py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition flex items-center justify-center gap-2",children:["Continue ",e.jsx(Te,{size:16})]})]}),t===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:I==="shipping"?"Enter your shipping address":"Add your contact details"}),I==="shipping"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Street Address",value:N.street,onChange:x=>Y({...N,street:x.target.value}),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{type:"text",placeholder:"City",value:N.city,onChange:x=>Y({...N,city:x.target.value}),className:"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsx("input",{type:"text",placeholder:"State",value:N.state,onChange:x=>Y({...N,state:x.target.value}),className:"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsx("input",{type:"text",placeholder:"ZIP",value:N.zip,onChange:x=>Y({...N,zip:x.target.value}),className:"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]})]}),e.jsx("input",{type:"tel",placeholder:"Phone Number",value:N.phone,onChange:x=>Y({...N,phone:x.target.value}),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsx("textarea",{placeholder:"Notes for seller (optional)",value:N.notes,onChange:x=>Y({...N,notes:x.target.value}),rows:2,className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white resize-none"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(1),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:"Back"}),e.jsxs("button",{onClick:()=>C(3),disabled:!X(),className:"flex-1 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:["Review Order ",e.jsx(Te,{size:16})]})]})]}),t===3&&(()=>{var A;const x=ye(a.price);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h5",{className:"font-bold text-sm dark:text-white mb-3",children:"Order Summary"}),e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b dark:border-gray-700",children:[((A=a.images)==null?void 0:A[0])&&e.jsx("img",{src:a.images[0],className:"w-16 h-16 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold dark:text-white",children:a.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.brand," â€¢ ",a.condition]})]})]}),e.jsxs("div",{className:"pt-3 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Item Price"}),e.jsxs("span",{className:"dark:text-white",children:["$",x.itemPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:["Service Fee",e.jsx("span",{className:"text-[10px] text-gray-400",children:"(1% buyer fee)"})]}),e.jsxs("span",{className:"dark:text-white",children:["$",x.serviceFee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Fulfillment"}),e.jsx("span",{className:"dark:text-white capitalize",children:I})]}),I==="shipping"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Ship to"}),e.jsxs("span",{className:"dark:text-white text-right text-xs",children:[N.city,", ",N.state," ",N.zip]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t dark:border-gray-700 font-bold",children:[e.jsx("span",{className:"dark:text-white",children:"Total"}),e.jsxs("span",{className:"text-green-600",children:["$",x.buyerTotal.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(ee,{size:14,className:"shrink-0 mt-0.5"}),e.jsx("span",{children:"Your purchase is protected by SeshNx Buyer Protection. If there's an issue with your order, we've got your back."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(2),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:"Back"}),e.jsx("button",{onClick:J,disabled:k,className:"flex-1 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-xl hover:from-green-700 hover:to-emerald-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:k?e.jsx(ie,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(He,{size:18})," Place Order"]})})]})]})})()]})}),!u&&e.jsxs("div",{className:"mt-8 pt-6 border-t dark:border-gray-700",children:[a.sellerId===c.uid?e.jsx("button",{className:"w-full bg-gray-100 dark:bg-gray-700 text-gray-500 font-bold py-3 rounded-xl cursor-not-allowed",children:"You own this listing"}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:K,disabled:k,className:`w-full font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed ${R?"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white":"bg-orange-600 hover:bg-orange-700 text-white"}`,children:k?e.jsx(ie,{className:"animate-spin",size:20}):R?e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:20})," Initiate Safe Exchange"]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{size:20})," Buy Now - $",a.price]})}),!w&&a.acceptsOffers!==!1&&e.jsxs("button",{onClick:()=>p(!0),className:"w-full py-3 border-2 border-blue-500 text-blue-600 dark:text-blue-400 font-bold rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 transition flex items-center justify-center gap-2",children:[e.jsx(re,{size:18}),"Make an Offer"]})]}),e.jsx("p",{className:"text-center text-[10px] text-gray-400 mt-3 flex items-center justify-center gap-1",children:R?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:10})," Funds held in escrow â€¢ GPS verified exchange â€¢ Dual approval release"]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{size:10})," Purchases covered by SeshNx Buyer Protection"]})})]})]})]})})}function Lt({orders:a,user:r,userData:c,onBack:l,onUpdateStatus:f,openChat:y}){const[n,h]=d.useState(null),[k,b]=d.useState(!1),[w,p]=d.useState(""),[u,j]=d.useState("usps"),[S,E]=d.useState("all"),L=[{id:"usps",label:"USPS"},{id:"ups",label:"UPS"},{id:"fedex",label:"FedEx"},{id:"dhl",label:"DHL"},{id:"other",label:"Other"}],D=a.filter(i=>S==="buying"?i.role==="buyer":S==="selling"?i.role==="seller":!0),g=async()=>{if(!w){W.error("Please enter a tracking number");return}await f(n.id,B.SHIPPED,{trackingNumber:w,carrier:u}),b(!1),p(""),h(null)},T=async i=>{await f(i.id,B.COMPLETED)},F=i=>{const m=pe[i];if(m){const o=m.icon;return e.jsx(o,{size:16})}return e.jsx(xe,{size:16})};return e.jsxs("div",{className:"animate-in fade-in",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition",children:e.jsx(Me,{className:"rotate-180 text-gray-500",size:20})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(qe,{className:"text-orange-500"})," My Orders"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Track your purchases and sales"})]})]})}),e.jsx("div",{className:"flex gap-2 mb-6",children:[{id:"all",label:"All Orders"},{id:"buying",label:"Buying"},{id:"selling",label:"Selling"}].map(i=>e.jsx("button",{onClick:()=>E(i.id),className:`px-4 py-2 rounded-lg text-sm font-bold transition ${S===i.id?"bg-orange-600 text-white shadow":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:i.label},i.id))}),D.length===0?e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700",children:[e.jsx(Ye,{size:48,className:"mx-auto text-gray-300 dark:text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No orders yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:S==="buying"?"You haven't purchased anything yet":S==="selling"?"You haven't received any orders yet":"Start shopping or selling to see your orders here"}),e.jsx("button",{onClick:l,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700 transition",children:"Browse Gear"})]}):e.jsx("div",{className:"space-y-4",children:D.map(i=>{var C,I,V,N,Y,R,K,J,X,s;const m=pe[i.status]||pe[B.PENDING],o=i.role==="seller",t=i.role==="buyer";return e.jsx(ge.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg bg-gray-100 dark:bg-gray-800 overflow-hidden shrink-0",children:(C=i.itemPhotos)!=null&&C[0]?e.jsx("img",{src:i.itemPhotos[0],className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(ve,{className:"text-gray-400",size:24})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white truncate",children:i.itemTitle}),e.jsx("p",{className:"text-sm text-gray-500",children:i.itemBrand})]}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1.5 ${m.color}`,children:[F(i.status),m.label]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm flex-wrap",children:[t?e.jsxs("span",{className:"font-bold text-green-600",children:["$",((I=i.buyerTotal)==null?void 0:I.toFixed(2))||i.price,i.serviceFee&&e.jsxs("span",{className:"text-[10px] text-gray-400 font-normal ml-1",children:["(incl. $",(V=i.serviceFee)==null?void 0:V.toFixed(2)," fee)"]})]}):e.jsxs("span",{className:"font-bold text-green-600",children:["$",((N=i.sellerPayout)==null?void 0:N.toFixed(2))||i.price,i.serviceFee&&e.jsxs("span",{className:"text-[10px] text-gray-400 font-normal ml-1",children:["(after $",(Y=i.serviceFee)==null?void 0:Y.toFixed(2)," fee)"]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${t?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"}`,children:t?"Purchasing":"Selling"}),e.jsx("span",{className:"text-gray-400 text-xs",children:((K=(R=i.createdAt)==null?void 0:R.toDate)==null?void 0:K.call(R).toLocaleDateString())||"Recently"})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:i.fulfillmentMethod==="shipping"?e.jsxs(e.Fragment,{children:[e.jsx(le,{size:12}),e.jsxs("span",{children:["Shipping to ",(J=i.shippingAddress)==null?void 0:J.city,", ",(X=i.shippingAddress)==null?void 0:X.state]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:12}),e.jsx("span",{children:"Local Pickup"})]})}),i.trackingNumber&&e.jsx("div",{className:"mt-2 p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-xs",children:e.jsxs("span",{className:"text-purple-700 dark:text-purple-400 font-bold",children:["Tracking: ",(s=i.trackingCarrier)==null?void 0:s.toUpperCase()," - ",i.trackingNumber]})})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t dark:border-gray-700",children:[o&&i.status===B.PENDING&&e.jsxs("button",{onClick:()=>f(i.id,B.CONFIRMED),className:"flex-1 py-2 bg-blue-600 text-white text-sm font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2",children:[e.jsx(H,{size:16})," Confirm Order"]}),o&&i.status===B.CONFIRMED&&i.fulfillmentMethod==="shipping"&&e.jsxs("button",{onClick:()=>{h(i),b(!0)},className:"flex-1 py-2 bg-purple-600 text-white text-sm font-bold rounded-lg hover:bg-purple-700 transition flex items-center justify-center gap-2",children:[e.jsx(le,{size:16})," Mark as Shipped"]}),o&&i.status===B.CONFIRMED&&i.fulfillmentMethod==="pickup"&&e.jsxs("button",{onClick:()=>f(i.id,B.COMPLETED),className:"flex-1 py-2 bg-green-600 text-white text-sm font-bold rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2",children:[e.jsx(H,{size:16})," Mark as Picked Up"]}),t&&(i.status===B.SHIPPED||i.status===B.DELIVERED)&&e.jsxs("button",{onClick:()=>T(i),className:"flex-1 py-2 bg-green-600 text-white text-sm font-bold rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2",children:[e.jsx(H,{size:16})," Confirm Receipt"]}),e.jsxs("button",{onClick:()=>y==null?void 0:y(t?i.sellerId:i.buyerId),className:"px-4 py-2 border border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 text-sm font-bold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition flex items-center gap-2",children:[e.jsx(re,{size:16}),"Contact ",t?"Seller":"Buyer"]})]})]})},i.id)})}),e.jsx(Ue,{children:k&&n&&e.jsx(ge.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",onClick:()=>b(!1),children:e.jsxs(ge.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:i=>i.stopPropagation(),className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-6 w-full max-w-md shadow-2xl",children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(le,{className:"text-purple-600"})," Add Shipping Info"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Carrier"}),e.jsx("select",{value:u,onChange:i=>j(i.target.value),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:L.map(i=>e.jsx("option",{value:i.id,children:i.label},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Tracking Number"}),e.jsx("input",{type:"text",value:w,onChange:i=>p(i.target.value),placeholder:"Enter tracking number",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300",children:[e.jsx(ke,{size:12,className:"inline mr-1"}),"The buyer will be notified with the tracking information"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:"Cancel"}),e.jsxs("button",{onClick:g,className:"flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition flex items-center justify-center gap-2",children:[e.jsx(le,{size:16})," Confirm Shipment"]})]})]})]})})})]})}function Rt({user:a,userData:r,tokenBalance:c}){const l=(r==null?void 0:r.id)||(a==null?void 0:a.id)||(a==null?void 0:a.uid),{data:f}=vt({type:h==="All"?void 0:h}),{data:y}=kt(l),{purchaseItem:n}=me(),[h,k]=d.useState("All"),[b,w]=d.useState(""),[p,u]=d.useState(!1),[j,S]=d.useState(null),[E,L]=d.useState(null),D=f||[],g=new Set((y||[]).map(m=>m.item_id)),T=async m=>{if(c<m.price){alert("Insufficient tokens! Please top up.");return}if(window.confirm(`Purchase ${m.title} for ${m.price} Tokens?`))try{await n(l,m.id),alert("Purchase successful! Item added to your library.")}catch(o){console.error("Purchase error:",o),alert("Failed to purchase item. Please try again.")}},F=async m=>{try{const o=document.createElement("a");o.href=m.download_url,o.download=`${m.title}.${m.download_url.split(".").pop()}`,document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(o){console.error("Download error:",o),alert("Failed to download item.")}},i=D.filter(m=>(h==="All"||m.type===h)&&m.title.toLowerCase().includes(b.toLowerCase()));return e.jsxs("div",{className:"pb-32",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 md:pb-0 scrollbar-hide",children:["All","Presets","Samples","Beats"].map(m=>e.jsx("button",{onClick:()=>k(m),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-all ${h===m?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300"}`,children:m},m))}),e.jsxs("div",{className:"ml-auto flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(Ve,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card text-sm dark:text-white focus:outline-none",placeholder:"Search...",value:b,onChange:m=>w(m.target.value)})]}),e.jsxs("button",{onClick:()=>u(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-green-700",children:[e.jsx(je,{size:16})," Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:i.map(m=>{const o=g.has(m.id);return e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition flex flex-col group",children:[e.jsxs("div",{className:"aspect-square relative bg-gray-100 dark:bg-gray-800 flex items-center justify-center cursor-pointer",onClick:()=>S(m),children:[m.type==="Presets"?e.jsx(Ke,{size:40,className:"text-gray-400"}):e.jsx(Qe,{size:40,className:"text-gray-400"}),o&&e.jsxs("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded flex items-center gap-1",children:[e.jsx(H,{size:8})," OWNED"]})]}),e.jsxs("div",{className:"p-3 flex flex-col flex-1",children:[e.jsx("div",{className:"text-[10px] font-bold text-brand-blue uppercase mb-1",children:m.type}),e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate mb-1",title:m.title,children:m.title}),e.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[e.jsxs("span",{className:"text-xs font-bold text-yellow-600 dark:text-yellow-400 flex items-center gap-1",children:[e.jsx(Je,{size:10,fill:"currentColor"})," ",m.price]}),!o&&e.jsx("button",{onClick:()=>T(m),className:"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1 rounded text-[10px] font-bold hover:opacity-80",children:"Buy"})]})]})]},m.id)})}),p&&e.jsx(Mt,{user:a,userData:r,onClose:()=>u(!1)}),j&&e.jsx($t,{item:j,isOwned:g.has(j.id),user:a,onClose:()=>S(null),onBuy:()=>T(j),onDownload:()=>F(j),onReport:()=>L({id:j.id,type:"market_item",summary:j.title})}),E&&e.jsx(wt,{user:a,target:E,onClose:()=>L(null)})]})}function Mt({user:a,userData:r,onClose:c}){const[l,f]=d.useState({title:"",price:"",type:"Presets",tags:"",description:""}),[y,n]=d.useState(null),[h,k]=d.useState(""),{uploadMedia:b,uploading:w}=be(),{createMarketplaceItem:p}=me(),u=async()=>{if(!l.title||!l.price||!y)return alert("Title, Price, and Audio File are required.");const j=(r==null?void 0:r.id)||(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{k("Uploading Audio Asset...");const S=await b(y,`market-assets/${j}`);k("Listing Item..."),await p({userId:j,title:l.title,type:l.type,price:parseInt(l.price),downloadUrl:S,tags:l.tags.split(",").map(E=>E.trim()).filter(E=>E),description:l.description||null,author:`${(r==null?void 0:r.firstName)||""} ${(r==null?void 0:r.lastName)||""}`.trim()||"Unknown"}),k("Success!"),setTimeout(c,1e3)}catch(S){console.error(S),k("Error listing item."),alert("Failed to submit item to market. Check console.")}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Creator Studio"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"List a new sound for sale"})]}),e.jsx("button",{onClick:c,children:e.jsx(q,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Title"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:l.title,onChange:j=>f({...l,title:j.target.value}),placeholder:"e.g. Midnight Lofi"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Type"}),e.jsxs("select",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:l.type,onChange:j=>f({...l,type:j.target.value}),children:[e.jsx("option",{children:"Presets"}),e.jsx("option",{children:"Samples"}),e.jsx("option",{children:"Beats"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Price (TK)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:l.price,onChange:j=>f({...l,price:j.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:"3",value:l.description,onChange:j=>f({...l,description:j.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Tags (Comma Separated)"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:l.tags,onChange:j=>f({...l,tags:j.target.value}),placeholder:"lofi, hiphop, boom-bap"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-2 border-dashed dark:border-gray-600 rounded-xl p-6 text-center hover:bg-gray-50 dark:hover:bg-gray-800 transition relative bg-blue-50/50 dark:bg-blue-900/10 h-full flex flex-col justify-center items-center",children:[e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"audio/*",onChange:j=>n(j.target.files[0])}),e.jsx(gt,{size:48,className:"mx-auto text-blue-500 mb-2"}),e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:y?y.name:"Upload Audio File (Product Asset)"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"MP3/WAV (Max 50MB)"}),y&&e.jsx("div",{className:"mt-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Selected"})]})})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:u,disabled:w||!l.title||!l.price||!y,className:"w-full bg-brand-blue text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50",children:w?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"animate-spin"})," ",h]}):"List Item for Sale"})})]})})}function $t({item:a,isOwned:r,onClose:c,onBuy:l,onDownload:f,onReport:y}){return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-2xl overflow-hidden w-full max-w-4xl shadow-2xl flex flex-col md:flex-row h-[80vh] md:h-[600px]",children:[e.jsxs("div",{className:"md:w-5/12 bg-gray-100 dark:bg-black/40 relative p-8 flex flex-col justify-center items-center text-center",children:[e.jsx("div",{className:"w-64 h-64 bg-gradient-to-br from-brand-blue to-purple-600 rounded-lg shadow-2xl mb-6 flex items-center justify-center text-white",children:a.type==="Presets"?e.jsx(Ke,{size:80}):e.jsx(Qe,{size:80})}),e.jsx("h2",{className:"text-2xl font-bold dark:text-white mb-2",children:a.title}),e.jsxs("div",{className:"text-brand-blue font-medium mb-6",children:["by ",a.author]}),a.download_url&&e.jsx("div",{className:"w-full",children:e.jsx(St,{audioUrl:a.download_url,fileName:"Preview Track",previewMode:!r})})]}),e.jsxs("div",{className:"md:w-7/12 p-8 overflow-y-auto flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded uppercase tracking-wide",children:a.type}),e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white mt-2",children:a.title})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-gray-400 hover:text-red-500 rounded-full transition",title:"Report Violation",children:e.jsx(ht,{size:20})}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(q,{size:20})})]})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300 mb-8",children:[e.jsx("p",{children:a.description||"No description provided by the creator."}),!r&&e.jsxs("div",{className:"mt-4 bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded text-yellow-800 dark:text-yellow-200 text-xs flex items-center gap-2",children:[e.jsx(ke,{size:14})," Audio preview is truncated to 15 seconds. Purchase to unlock full track."]})]}),e.jsx("div",{className:"mt-auto",children:r?e.jsxs("button",{onClick:f,className:"w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx(bt,{size:24})," Download Now"]}):e.jsxs("button",{onClick:l,className:"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx("span",{children:"Buy for"}),e.jsxs("span",{className:"bg-yellow-400 text-black px-2 py-0.5 rounded text-sm flex items-center gap-1",children:[e.jsx(Je,{size:12,fill:"black"})," ",a.price]})]})})]})]})})}function Xt({user:a,userData:r,tokenBalance:c}){const l=mt(),f=pt(),{t:y}=ut(),n=p=>{const u=p.split("/").filter(Boolean);return u[0]==="marketplace"&&u[1]?u[1]:"gear"},[h,k]=d.useState(()=>n(l.pathname));d.useEffect(()=>{const p=n(l.pathname);p!==h&&k(p)},[l.pathname]);const b=p=>{k(p),f(`/marketplace/${p}`,{replace:!0})},w=[{id:"gear",label:y("gearExchange")},{id:"fx",label:y("seshFxStore")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:y("marketplace")}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-1 rounded-lg border dark:border-gray-700 flex gap-1",children:w.map(p=>e.jsx("button",{onClick:()=>b(p.id),className:`px-4 py-2 text-sm font-bold rounded-md transition-all ${h===p.id?"bg-brand-blue text-white shadow-md":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:p.label},p.id))})]}),e.jsxs("div",{className:"tab-content-wrapper",children:[h==="gear"&&e.jsx("div",{className:"tab-content",children:e.jsx(Tt,{user:a,userData:r})},"gear"),h==="fx"&&e.jsx("div",{className:"tab-content",children:e.jsx(Rt,{user:a,userData:r,tokenBalance:c})},"fx")]})]})}export{Xt as default};
