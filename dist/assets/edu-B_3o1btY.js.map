{"version":3,"file":"edu-B_3o1btY.js","sources":["../../src/utils/geocode.js","../../src/contexts/SchoolContext.jsx","../../src/hooks/useImageUpload.js","../../src/hooks/useAddressSearch.js","../../src/components/shared/AddressAutocomplete.jsx","../../src/utils/eduPermissions.js","../../src/contexts/EduAuthContext.jsx","../../src/components/EDU/EduStudentDashboard.jsx","../../src/utils/eduTime.js","../../src/components/EDU/EduInternDashboard.jsx","../../src/utils/dataExport.js","../../src/components/EDU/modules/EduOverview.jsx","../../src/components/EDU/modules/EduRoster.jsx","../../src/components/EDU/modules/EduHours.jsx","../../src/components/EDU/modules/EduCourseBuilder.jsx","../../src/components/EDU/modules/EduCourses.jsx","../../src/components/EDU/modules/EduLearningPaths.jsx","../../src/components/EDU/modules/EduStaff.jsx","../../src/components/EDU/modules/EduRoles.jsx","../../src/components/EDU/modules/EduResources.jsx","../../src/components/EDU/modules/EduAnnouncements.jsx","../../src/components/EDU/modules/EduPartners.jsx","../../src/components/EDU/modules/EduEvaluations.jsx","../../src/components/EDU/modules/EduCohorts.jsx","../../src/components/EDU/modules/EduAudit.jsx","../../src/components/EDU/modules/EduSettings.jsx","../../src/components/EDU/EduAdminDashboard.jsx","../../src/components/EDU/EduStaffDashboard.jsx"],"sourcesContent":["import { supabase } from '../config/supabase';\r\n\r\n/**\r\n * Fetches location data for a US Zip Code using Zippopotam.us\r\n * @param {string} zip - 5-digit US Zip Code\r\n * @returns {Promise<{lat: number, lng: number, name: string, state: string, cityState: string}|null>}\r\n */\r\nexport const fetchZipLocation = async (zip) => {\r\n  if (!zip || zip.length < 5) return null;\r\n\r\n  try {\r\n    const response = await fetch(`https://api.zippopotam.us/us/${zip}`);\r\n    if (!response.ok) return null;\r\n\r\n    const data = await response.json();\r\n    const place = data.places[0];\r\n\r\n    return {\r\n      lat: parseFloat(place.latitude),\r\n      lng: parseFloat(place.longitude),\r\n      name: place['place name'],\r\n      state: place['state abbreviation'],\r\n      cityState: `${place['place name']}, ${place['state abbreviation']}`\r\n    };\r\n  } catch (error) {\r\n    console.warn(\"Geocoding failed:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Converts Latitude and Longitude into a readable address (City, State, Zip)\r\n * Uses OpenStreetMap Nominatim API (No Key Required for low volume)\r\n * @param {number} lat - Latitude\r\n * @param {number} lng - Longitude\r\n * @returns {Promise<{city: string, state: string, zip: string, displayName: string}|null>}\r\n */\r\nexport const reverseGeocode = async (lat, lng) => {\r\n  if (!lat || !lng) return null;\r\n\r\n  try {\r\n    const response = await fetch(\r\n      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`\r\n    );\r\n    \r\n    if (!response.ok) return null;\r\n\r\n    const data = await response.json();\r\n    const address = data.address;\r\n\r\n    // Nominatim address fields can vary, so we try fallback keys\r\n    const city = address.city || address.town || address.village || address.hamlet || \"Unknown Location\";\r\n    const state = address.state || \"\";\r\n    const zip = address.postcode || \"\";\r\n    \r\n    return {\r\n      city,\r\n      state,\r\n      zip,\r\n      displayName: `${city}, ${state} ${zip}`.trim()\r\n    };\r\n  } catch (error) {\r\n    console.warn(\"Reverse geocoding failed:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Queries Supabase for the number of users in the wider region (Zip Prefix)\r\n * This simulates a \"25 mile radius\" heatmap without expensive geospatial math.\r\n * @param {string} zip - The 5-digit Zip Code to check\r\n * @returns {Promise<{count: number, density: string, label: string}>}\r\n */\r\nexport const fetchRegionalUserCount = async (zip) => {\r\n  // If zip is incomplete, return a neutral \"Scanning\" state\r\n  if (!zip || zip.length < 3) return { count: 0, density: '#6B7280', label: 'Scanning...' };\r\n\r\n  if (!supabase) {\r\n    return { count: 0, density: '#9CA3AF', label: 'Unknown Region' };\r\n  }\r\n\r\n  try {\r\n    // 1. Use the first 3 digits to define the \"Region\" (approx 20-50 miles)\r\n    const regionPrefix = zip.substring(0, 3);\r\n    \r\n    // Query: Zip starts with \"902...\" using Supabase pattern matching\r\n    const { count, error } = await supabase\r\n      .from('public_profiles')\r\n      .select('*', { count: 'exact', head: true })\r\n      .like('zip_code', `${regionPrefix}%`);\r\n\r\n    if (error) throw error;\r\n\r\n    const userCount = count || 0;\r\n\r\n    // 2. Determine Density Color based on regional count\r\n    let color = '#3D84ED'; // Blue (Quiet)\r\n    let label = 'Quiet Area';\r\n    \r\n    if (userCount > 25) { color = '#10B981'; label = 'Active Area'; } // Green\r\n    if (userCount > 100) { color = '#F59E0B'; label = 'Buzzing'; }    // Orange\r\n    if (userCount > 500) { color = '#EF4444'; label = 'Hotspot'; }    // Red\r\n\r\n    return { count: userCount, density: color, label };\r\n\r\n  } catch (error) {\r\n    console.warn(\"Regional stats failed:\", error);\r\n    // Return 0 count but \"Unknown\" status so the UI doesn't break\r\n    return { count: 0, density: '#9CA3AF', label: 'Unknown Region' };\r\n  }\r\n};\r\n\r\n/**\r\n * Calculate the distance between two points on Earth using the Haversine formula\r\n * @param {number} lat1 - Latitude of first point\r\n * @param {number} lon1 - Longitude of first point\r\n * @param {number} lat2 - Latitude of second point\r\n * @param {number} lon2 - Longitude of second point\r\n * @returns {number} Distance in kilometers\r\n */\r\nexport const getDistanceFromLatLonInKm = (lat1, lon1, lat2, lon2) => {\r\n  const R = 6371; // Radius of the Earth in kilometers\r\n  const dLat = (lat2 - lat1) * (Math.PI / 180);\r\n  const dLon = (lon2 - lon1) * (Math.PI / 180);\r\n  const a =\r\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos(lat1 * (Math.PI / 180)) *\r\n      Math.cos(lat2 * (Math.PI / 180)) *\r\n      Math.sin(dLon / 2) *\r\n      Math.sin(dLon / 2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  return R * c; // Distance in kilometers\r\n};\r\n\r\n/**\r\n * Search for addresses using OpenStreetMap Nominatim API\r\n * Free API for geocoding/address search (no API key required for low volume)\r\n * Rate limited to 1 request per second\r\n * @param {string} query - Search query (partial address, city name, etc.)\r\n * @param {Object} options - Search options\r\n * @param {string} options.countryCode - Limit results to specific country (e.g., 'us')\r\n * @param {number} options.limit - Max number of results (default 5)\r\n * @param {boolean} options.addressDetails - Include detailed address breakdown\r\n * @returns {Promise<Array<{displayName: string, lat: number, lng: number, address: Object, type: string}>>}\r\n */\r\nexport const searchAddress = async (query, options = {}) => {\r\n  if (!query || query.trim().length < 3) return [];\r\n\r\n  const {\r\n    countryCode = 'us',\r\n    limit = 5,\r\n    addressDetails = true\r\n  } = options;\r\n\r\n  try {\r\n    const params = new URLSearchParams({\r\n      q: query,\r\n      format: 'json',\r\n      addressdetails: addressDetails ? '1' : '0',\r\n      limit: limit.toString(),\r\n      countrycodes: countryCode,\r\n    });\r\n\r\n    const response = await fetch(\r\n      `https://nominatim.openstreetmap.org/search?${params}`,\r\n      {\r\n        headers: {\r\n          // Nominatim requires a valid User-Agent\r\n          'Accept': 'application/json',\r\n        }\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      console.warn('Address search failed:', response.status);\r\n      return [];\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    return data.map(place => {\r\n      const address = place.address || {};\r\n      \r\n      return {\r\n        id: place.place_id,\r\n        displayName: place.display_name,\r\n        shortName: formatShortAddress(place),\r\n        lat: parseFloat(place.lat),\r\n        lng: parseFloat(place.lon),\r\n        type: place.type,\r\n        category: place.category,\r\n        address: {\r\n          houseNumber: address.house_number || '',\r\n          street: address.road || address.street || '',\r\n          city: address.city || address.town || address.village || address.hamlet || '',\r\n          state: address.state || '',\r\n          stateCode: getStateCode(address.state),\r\n          zip: address.postcode || '',\r\n          country: address.country || '',\r\n          countryCode: address.country_code || '',\r\n        },\r\n        // Formatted address line\r\n        formattedAddress: formatFullAddress(address),\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.warn('Address search error:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * Format a short, readable address from Nominatim place data\r\n */\r\nfunction formatShortAddress(place) {\r\n  const addr = place.address || {};\r\n  const parts = [];\r\n  \r\n  // Street address\r\n  if (addr.house_number && addr.road) {\r\n    parts.push(`${addr.house_number} ${addr.road}`);\r\n  } else if (addr.road) {\r\n    parts.push(addr.road);\r\n  }\r\n  \r\n  // City\r\n  const city = addr.city || addr.town || addr.village || addr.hamlet;\r\n  if (city) parts.push(city);\r\n  \r\n  // State abbreviation\r\n  const state = getStateCode(addr.state);\r\n  if (state) parts.push(state);\r\n  \r\n  return parts.join(', ') || place.display_name.split(',').slice(0, 3).join(',');\r\n}\r\n\r\n/**\r\n * Format full street address from address components\r\n */\r\nfunction formatFullAddress(address) {\r\n  const parts = [];\r\n  \r\n  // Street line\r\n  if (address.house_number && address.road) {\r\n    parts.push(`${address.house_number} ${address.road}`);\r\n  } else if (address.road) {\r\n    parts.push(address.road);\r\n  }\r\n  \r\n  // City, State ZIP\r\n  const city = address.city || address.town || address.village || '';\r\n  const state = getStateCode(address.state);\r\n  const zip = address.postcode || '';\r\n  \r\n  const cityStateZip = [city, state].filter(Boolean).join(', ');\r\n  if (cityStateZip) {\r\n    parts.push(zip ? `${cityStateZip} ${zip}` : cityStateZip);\r\n  }\r\n  \r\n  return parts.join(', ');\r\n}\r\n\r\n/**\r\n * Convert full state name to abbreviation (US only)\r\n */\r\nfunction getStateCode(stateName) {\r\n  if (!stateName) return '';\r\n  \r\n  const stateMap = {\r\n    'alabama': 'AL', 'alaska': 'AK', 'arizona': 'AZ', 'arkansas': 'AR',\r\n    'california': 'CA', 'colorado': 'CO', 'connecticut': 'CT', 'delaware': 'DE',\r\n    'florida': 'FL', 'georgia': 'GA', 'hawaii': 'HI', 'idaho': 'ID',\r\n    'illinois': 'IL', 'indiana': 'IN', 'iowa': 'IA', 'kansas': 'KS',\r\n    'kentucky': 'KY', 'louisiana': 'LA', 'maine': 'ME', 'maryland': 'MD',\r\n    'massachusetts': 'MA', 'michigan': 'MI', 'minnesota': 'MN', 'mississippi': 'MS',\r\n    'missouri': 'MO', 'montana': 'MT', 'nebraska': 'NE', 'nevada': 'NV',\r\n    'new hampshire': 'NH', 'new jersey': 'NJ', 'new mexico': 'NM', 'new york': 'NY',\r\n    'north carolina': 'NC', 'north dakota': 'ND', 'ohio': 'OH', 'oklahoma': 'OK',\r\n    'oregon': 'OR', 'pennsylvania': 'PA', 'rhode island': 'RI', 'south carolina': 'SC',\r\n    'south dakota': 'SD', 'tennessee': 'TN', 'texas': 'TX', 'utah': 'UT',\r\n    'vermont': 'VT', 'virginia': 'VA', 'washington': 'WA', 'west virginia': 'WV',\r\n    'wisconsin': 'WI', 'wyoming': 'WY', 'district of columbia': 'DC',\r\n  };\r\n  \r\n  // If already a 2-letter code, return as-is\r\n  if (stateName.length === 2) return stateName.toUpperCase();\r\n  \r\n  return stateMap[stateName.toLowerCase()] || stateName;\r\n}\r\n","import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { supabase } from '../config/supabase';\r\n\r\n// Provide default value to prevent errors when context is not available\r\nconst defaultContextValue = {\r\n    schoolId: null,\r\n    schoolData: null,\r\n    studentProfile: null,\r\n    staffProfile: null,\r\n    myPermissions: [],\r\n    internshipStudio: null,\r\n    isStudent: false,\r\n    isStaff: false,\r\n    checkIn: async () => {},\r\n    checkOut: async () => {},\r\n    loading: false\r\n};\r\n\r\nconst SchoolContext = createContext(defaultContextValue);\r\n\r\nexport function useSchool() {\r\n    return useContext(SchoolContext);\r\n}\r\n\r\nexport function SchoolProvider({ children, user, userData }) {\r\n    const [schoolData, setSchoolData] = useState(null);\r\n    const [studentProfile, setStudentProfile] = useState(null);\r\n    const [staffProfile, setStaffProfile] = useState(null); // NEW: Staff Identity\r\n    const [myPermissions, setMyPermissions] = useState([]); // NEW: Resolved Permissions\r\n    const [internshipStudio, setInternshipStudio] = useState(null); // NEW: Assigned Studio Data\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!user || !userData?.schoolId || !supabase) {\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const schoolId = userData.schoolId;\r\n        const userId = user.id || user.uid;\r\n\r\n        // 1. Fetch Public School Data\r\n        supabase\r\n            .from('schools')\r\n            .select('*')\r\n            .eq('id', schoolId)\r\n            .single()\r\n            .then(({ data, error }) => {\r\n                if (error) {\r\n                    console.error(\"Error fetching school data:\", error);\r\n                } else if (data) {\r\n                    setSchoolData(data);\r\n                }\r\n            });\r\n\r\n        // 2. Determine Role & Load Context (Student vs Staff)\r\n        const loadContext = async () => {\r\n            try {\r\n                // A. Check if STUDENT/INTERN\r\n                if (userData.accountTypes?.includes('Student') || userData.accountTypes?.includes('Intern')) {\r\n                    // Subscribe to student record changes\r\n                    const studentChannel = supabase\r\n                        .channel(`student-${userId}-${schoolId}`)\r\n                        .on(\r\n                            'postgres_changes',\r\n                            {\r\n                                event: '*',\r\n                                schema: 'public',\r\n                                table: 'students',\r\n                                filter: `school_id=eq.${schoolId} AND user_id=eq.${userId}`\r\n                            },\r\n                            async (payload) => {\r\n                                if (payload.eventType === 'DELETE') {\r\n                                    setStudentProfile(null);\r\n                                } else {\r\n                                    const sData = payload.new || payload.old;\r\n                                    setStudentProfile(sData);\r\n                                    \r\n                                    // Load Assigned Studio if exists\r\n                                    if (sData?.internship_studio_id) {\r\n                                        // First check 'partners' table\r\n                                        const { data: partnerData } = await supabase\r\n                                            .from('school_partners')\r\n                                            .select('*')\r\n                                            .eq('school_id', schoolId)\r\n                                            .eq('id', sData.internship_studio_id)\r\n                                            .single();\r\n                                        \r\n                                        if (partnerData) {\r\n                                            setInternshipStudio(partnerData);\r\n                                        } else {\r\n                                            // Fallback to global studios\r\n                                            const { data: studioData } = await supabase\r\n                                                .from('studios')\r\n                                                .select('*')\r\n                                                .eq('id', sData.internship_studio_id)\r\n                                                .single();\r\n                                            \r\n                                            if (studioData) setInternshipStudio(studioData);\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        )\r\n                        .subscribe();\r\n\r\n                    // Initial fetch\r\n                    const { data: studentData } = await supabase\r\n                        .from('students')\r\n                        .select('*')\r\n                        .eq('school_id', schoolId)\r\n                        .eq('user_id', userId)\r\n                        .single();\r\n\r\n                    if (studentData) {\r\n                        setStudentProfile(studentData);\r\n                        if (studentData.internship_studio_id) {\r\n                            const { data: partnerData } = await supabase\r\n                                .from('school_partners')\r\n                                .select('*')\r\n                                .eq('school_id', schoolId)\r\n                                .eq('id', studentData.internship_studio_id)\r\n                                .single();\r\n                            \r\n                            if (partnerData) {\r\n                                setInternshipStudio(partnerData);\r\n                            } else {\r\n                                const { data: studioData } = await supabase\r\n                                    .from('studios')\r\n                                    .select('*')\r\n                                    .eq('id', studentData.internship_studio_id)\r\n                                    .single();\r\n                                \r\n                                if (studioData) setInternshipStudio(studioData);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    return () => {\r\n                        supabase.removeChannel(studentChannel);\r\n                    };\r\n                }\r\n\r\n                // B. Check if STAFF (EDUStaff/EDUAdmin)\r\n                if (userData.accountTypes?.includes('EDUStaff') || userData.accountTypes?.includes('EDUAdmin')) {\r\n                    // Find my staff entry to get Role ID\r\n                    const { data: staffData, error: staffError } = await supabase\r\n                        .from('school_staff')\r\n                        .select('*')\r\n                        .eq('school_id', schoolId)\r\n                        .eq('user_id', userId)\r\n                        .single();\r\n                    \r\n                    if (!staffError && staffData) {\r\n                        setStaffProfile(staffData);\r\n\r\n                        // Fetch Permissions for this Role\r\n                        if (staffData.role_id) {\r\n                            const { data: roleData } = await supabase\r\n                                .from('school_roles')\r\n                                .select('*')\r\n                                .eq('school_id', schoolId)\r\n                                .eq('id', staffData.role_id)\r\n                                .single();\r\n                            \r\n                            if (roleData) {\r\n                                setMyPermissions(roleData.permissions || []);\r\n                            }\r\n                        } else if (userData.accountTypes.includes('EDUAdmin')) {\r\n                            setMyPermissions(['ALL']); \r\n                        }\r\n                    }\r\n                }\r\n\r\n            } catch (e) {\r\n                console.error(\"Error setting up school context:\", e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        loadContext();\r\n\r\n    }, [user, userData]);\r\n\r\n    // --- Time Tracking Actions ---\r\n    const checkIn = async (location, type = 'remote') => {\r\n        if (!studentProfile || !userData.schoolId || !supabase) return;\r\n        try {\r\n            const userId = user.id || user.uid;\r\n            const { data: logData, error: logError } = await supabase\r\n                .from('internship_logs')\r\n                .insert({\r\n                    school_id: userData.schoolId,\r\n                    student_id: userId,\r\n                    student_name: userData.displayName || userData.firstName || 'Unknown',\r\n                    check_in: new Date().toISOString(),\r\n                    check_out: null,\r\n                    location: location || 'Unknown',\r\n                    type: type,\r\n                    status: 'active',\r\n                    description: ''\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (logError) throw logError;\r\n\r\n            // Update student record\r\n            await supabase\r\n                .from('students')\r\n                .update({ \r\n                    active_session_id: logData.id, \r\n                    is_clocked_in: true \r\n                })\r\n                .eq('school_id', userData.schoolId)\r\n                .eq('user_id', userId);\r\n        } catch (error) { \r\n            console.error(\"Check-in failed:\", error); \r\n            throw error; \r\n        }\r\n    };\r\n\r\n    const checkOut = async (description) => {\r\n        if (!studentProfile?.active_session_id || !userData.schoolId || !supabase) return;\r\n        try {\r\n            const userId = user.id || user.uid;\r\n            \r\n            // Update log\r\n            await supabase\r\n                .from('internship_logs')\r\n                .update({ \r\n                    check_out: new Date().toISOString(), \r\n                    status: 'pending_approval', \r\n                    description: description || 'No description' \r\n                })\r\n                .eq('id', studentProfile.active_session_id);\r\n\r\n            // Update student record\r\n            await supabase\r\n                .from('students')\r\n                .update({ \r\n                    active_session_id: null, \r\n                    is_clocked_in: false \r\n                })\r\n                .eq('school_id', userData.schoolId)\r\n                .eq('user_id', userId);\r\n        } catch (error) { \r\n            console.error(\"Check-out failed:\", error); \r\n            throw error; \r\n        }\r\n    };\r\n\r\n    const value = {\r\n        schoolId: userData?.schoolId,\r\n        schoolData,\r\n        studentProfile,\r\n        staffProfile,\r\n        myPermissions,\r\n        internshipStudio,\r\n        isStudent: !!studentProfile,\r\n        isStaff: !!staffProfile || userData?.accountTypes?.includes('EDUAdmin'),\r\n        checkIn,\r\n        checkOut,\r\n        loading\r\n    };\r\n\r\n    return (\r\n        <SchoolContext.Provider value={value}>\r\n            {children}\r\n        </SchoolContext.Provider>\r\n    );\r\n}\r\n","import { useState } from 'react';\r\nimport { supabase } from '../config/supabase';\r\n\r\nconst DEFAULT_BUCKET = import.meta.env.VITE_SUPABASE_STORAGE_BUCKET || 'public';\r\n\r\nexport const useImageUpload = () => {\r\n  const [uploading, setUploading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  const uploadImage = async (file, path) => {\r\n    if (!file) return null;\r\n    \r\n    if (!supabase) {\r\n      setError('Supabase is not configured. Please set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your environment variables.');\r\n      console.error('Supabase Storage is not available.');\r\n      return null;\r\n    }\r\n    \r\n    setUploading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Create a unique filename\r\n      const timestamp = Date.now();\r\n      const uniqueName = `${timestamp}_${file.name}`;\r\n      const fullPath = `${path}/${uniqueName}`;\r\n      \r\n      // Upload to Supabase Storage\r\n      const { data: uploadData, error: uploadError } = await supabase.storage\r\n        .from(DEFAULT_BUCKET)\r\n        .upload(fullPath, file, {\r\n          upsert: true,\r\n          cacheControl: '3600',\r\n        });\r\n      \r\n      if (uploadError) {\r\n        throw uploadError;\r\n      }\r\n      \r\n      // Get public URL\r\n      const { data: urlData } = supabase.storage\r\n        .from(DEFAULT_BUCKET)\r\n        .getPublicUrl(fullPath);\r\n      \r\n      setUploading(false);\r\n      return urlData.publicUrl;\r\n    } catch (err) {\r\n      console.error(\"Upload failed:\", err);\r\n      setError(err);\r\n      setUploading(false);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  return { uploadImage, uploading, error };\r\n};\r\n","import { useState, useCallback, useRef } from 'react';\r\nimport { searchAddress } from '../utils/geocode';\r\n\r\n/**\r\n * Hook for searching addresses with debouncing and rate limiting\r\n * Uses OpenStreetMap Nominatim API (free, no API key required)\r\n * \r\n * @param {Object} options - Configuration options\r\n * @param {number} options.debounceMs - Debounce delay in milliseconds (default 300)\r\n * @param {string} options.countryCode - Limit results to country (default 'us')\r\n * @param {number} options.limit - Max results to return (default 5)\r\n * @returns {Object} { search, results, loading, error, clearResults }\r\n */\r\nexport function useAddressSearch(options = {}) {\r\n    const {\r\n        debounceMs = 300,\r\n        countryCode = 'us',\r\n        limit = 5,\r\n    } = options;\r\n\r\n    const [results, setResults] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState(null);\r\n    \r\n    // Refs for debouncing and preventing stale results\r\n    const debounceTimer = useRef(null);\r\n    const lastQuery = useRef('');\r\n    const requestId = useRef(0);\r\n\r\n    /**\r\n     * Search for addresses\r\n     * @param {string} query - Search query\r\n     */\r\n    const search = useCallback(async (query) => {\r\n        const trimmedQuery = query?.trim() || '';\r\n        \r\n        // Clear existing timer\r\n        if (debounceTimer.current) {\r\n            clearTimeout(debounceTimer.current);\r\n        }\r\n\r\n        // If query is too short, clear results\r\n        if (trimmedQuery.length < 3) {\r\n            setResults([]);\r\n            setLoading(false);\r\n            setError(null);\r\n            return;\r\n        }\r\n\r\n        // Don't search if same as last query\r\n        if (trimmedQuery === lastQuery.current) {\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        // Debounce the actual API call\r\n        debounceTimer.current = setTimeout(async () => {\r\n            const currentRequestId = ++requestId.current;\r\n            lastQuery.current = trimmedQuery;\r\n\r\n            try {\r\n                const searchResults = await searchAddress(trimmedQuery, {\r\n                    countryCode,\r\n                    limit,\r\n                    addressDetails: true,\r\n                });\r\n\r\n                // Only update if this is still the most recent request\r\n                if (currentRequestId === requestId.current) {\r\n                    setResults(searchResults);\r\n                    setLoading(false);\r\n                }\r\n            } catch (err) {\r\n                if (currentRequestId === requestId.current) {\r\n                    setError(err.message || 'Address search failed');\r\n                    setResults([]);\r\n                    setLoading(false);\r\n                }\r\n            }\r\n        }, debounceMs);\r\n    }, [debounceMs, countryCode, limit]);\r\n\r\n    /**\r\n     * Clear all results\r\n     */\r\n    const clearResults = useCallback(() => {\r\n        setResults([]);\r\n        setError(null);\r\n        lastQuery.current = '';\r\n    }, []);\r\n\r\n    return {\r\n        search,\r\n        results,\r\n        loading,\r\n        error,\r\n        clearResults,\r\n    };\r\n}\r\n\r\nexport default useAddressSearch;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { MapPin, X, Loader2, Navigation } from 'lucide-react';\r\nimport { useAddressSearch } from '../../hooks/useAddressSearch';\r\nimport { reverseGeocode } from '../../utils/geocode';\r\n\r\n/**\r\n * Address autocomplete component using OpenStreetMap Nominatim\r\n * Provides address suggestions as user types, with geolocation support\r\n * \r\n * @param {Object} props\r\n * @param {function} props.onSelect - Callback when address is selected: (addressData) => void\r\n * @param {string} props.value - Controlled value for the input\r\n * @param {function} props.onChange - Controlled change handler: (value) => void\r\n * @param {string} props.placeholder - Input placeholder text\r\n * @param {string} props.className - Additional CSS classes\r\n * @param {string} props.label - Label text above input\r\n * @param {boolean} props.required - Show required indicator\r\n * @param {boolean} props.showGeolocation - Show \"Use my location\" button\r\n * @param {string} props.countryCode - Limit results to country (default 'us')\r\n * @param {string} props.error - Error message to display\r\n */\r\nexport default function AddressAutocomplete({\r\n    onSelect,\r\n    value,\r\n    onChange,\r\n    placeholder = \"Start typing an address...\",\r\n    className = \"\",\r\n    label = \"Address\",\r\n    required = false,\r\n    showGeolocation = true,\r\n    countryCode = 'us',\r\n    error: externalError,\r\n}) {\r\n    const { search, results, loading, error: searchError, clearResults } = useAddressSearch({ \r\n        countryCode,\r\n        debounceMs: 350,\r\n        limit: 6,\r\n    });\r\n    \r\n    const [localQuery, setLocalQuery] = useState('');\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [geoLoading, setGeoLoading] = useState(false);\r\n    const wrapperRef = useRef(null);\r\n    const inputRef = useRef(null);\r\n\r\n    // Determine displayed value (controlled vs uncontrolled)\r\n    const displayValue = value !== undefined ? value : localQuery;\r\n\r\n    // Close dropdown when clicking outside\r\n    useEffect(() => {\r\n        function handleClickOutside(event) {\r\n            if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\r\n                setIsOpen(false);\r\n            }\r\n        }\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, []);\r\n\r\n    // Handle input changes\r\n    const handleInputChange = (e) => {\r\n        const val = e.target.value;\r\n        \r\n        // Update state\r\n        if (onChange) onChange(val);\r\n        else setLocalQuery(val);\r\n\r\n        // Trigger search\r\n        if (val.trim().length >= 3) {\r\n            search(val);\r\n            setIsOpen(true);\r\n        } else {\r\n            setIsOpen(false);\r\n            clearResults();\r\n        }\r\n    };\r\n\r\n    // Handle address selection\r\n    const handleSelect = (item) => {\r\n        const selectedAddress = {\r\n            displayName: item.displayName,\r\n            shortName: item.shortName,\r\n            formattedAddress: item.formattedAddress,\r\n            lat: item.lat,\r\n            lng: item.lng,\r\n            ...item.address,\r\n        };\r\n\r\n        // Update input with formatted address\r\n        const displayText = item.formattedAddress || item.shortName || item.displayName;\r\n        if (onChange) onChange(displayText);\r\n        else setLocalQuery(displayText);\r\n\r\n        // Callback with full address data\r\n        if (onSelect) onSelect(selectedAddress);\r\n\r\n        setIsOpen(false);\r\n        clearResults();\r\n    };\r\n\r\n    // Handle geolocation\r\n    const handleUseLocation = async () => {\r\n        if (!navigator.geolocation) {\r\n            alert(\"Geolocation is not supported by your browser\");\r\n            return;\r\n        }\r\n\r\n        setGeoLoading(true);\r\n\r\n        navigator.geolocation.getCurrentPosition(\r\n            async (position) => {\r\n                const { latitude, longitude } = position.coords;\r\n                \r\n                try {\r\n                    const locationData = await reverseGeocode(latitude, longitude);\r\n                    \r\n                    if (locationData) {\r\n                        const displayText = locationData.displayName;\r\n                        if (onChange) onChange(displayText);\r\n                        else setLocalQuery(displayText);\r\n\r\n                        if (onSelect) {\r\n                            onSelect({\r\n                                displayName: displayText,\r\n                                formattedAddress: displayText,\r\n                                lat: latitude,\r\n                                lng: longitude,\r\n                                city: locationData.city,\r\n                                state: locationData.state,\r\n                                zip: locationData.zip,\r\n                            });\r\n                        }\r\n                    }\r\n                } catch (err) {\r\n                    console.error('Reverse geocode failed:', err);\r\n                }\r\n                \r\n                setGeoLoading(false);\r\n            },\r\n            (err) => {\r\n                console.warn('Geolocation error:', err);\r\n                alert(\"Unable to get your location. Please enter address manually.\");\r\n                setGeoLoading(false);\r\n            },\r\n            { enableHighAccuracy: true, timeout: 10000 }\r\n        );\r\n    };\r\n\r\n    // Clear input\r\n    const handleClear = () => {\r\n        if (onChange) onChange('');\r\n        else setLocalQuery('');\r\n        clearResults();\r\n        setIsOpen(false);\r\n        inputRef.current?.focus();\r\n    };\r\n\r\n    const hasError = externalError || searchError;\r\n\r\n    return (\r\n        <div ref={wrapperRef} className={`relative ${className}`}>\r\n            {/* Label */}\r\n            {label && (\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">\r\n                    {label}\r\n                    {required && <span className=\"text-red-500 ml-1\">*</span>}\r\n                </label>\r\n            )}\r\n\r\n            {/* Input container */}\r\n            <div className=\"relative flex gap-2\">\r\n                <div className=\"relative flex-1\">\r\n                    <MapPin \r\n                        className={`absolute left-3 top-3 ${loading ? 'text-brand-blue animate-pulse' : 'text-gray-400'}`} \r\n                        size={16} \r\n                    />\r\n                    <input\r\n                        ref={inputRef}\r\n                        type=\"text\"\r\n                        className={`\r\n                            w-full pl-9 pr-8 p-2.5 text-sm\r\n                            bg-white dark:bg-[#1f2128] \r\n                            border ${hasError ? 'border-red-400 focus:ring-red-200' : 'border-gray-200 dark:border-gray-600 focus:ring-brand-blue'}\r\n                            rounded-lg focus:ring-2 outline-none \r\n                            dark:text-white transition-all\r\n                        `}\r\n                        placeholder={placeholder}\r\n                        value={displayValue}\r\n                        onChange={handleInputChange}\r\n                        onFocus={() => {\r\n                            if (results.length > 0) setIsOpen(true);\r\n                        }}\r\n                        autoComplete=\"off\"\r\n                    />\r\n                    \r\n                    {/* Clear button */}\r\n                    {displayValue && !loading && (\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={handleClear}\r\n                            className=\"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors\"\r\n                        >\r\n                            <X size={16} />\r\n                        </button>\r\n                    )}\r\n                    \r\n                    {/* Loading indicator */}\r\n                    {loading && (\r\n                        <Loader2 \r\n                            className=\"absolute right-3 top-3 text-brand-blue animate-spin\" \r\n                            size={16} \r\n                        />\r\n                    )}\r\n                </div>\r\n\r\n                {/* Geolocation button */}\r\n                {showGeolocation && (\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={handleUseLocation}\r\n                        disabled={geoLoading}\r\n                        className=\"p-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-brand-blue transition-colors disabled:opacity-50\"\r\n                        title=\"Use my current location\"\r\n                    >\r\n                        {geoLoading ? (\r\n                            <Loader2 size={18} className=\"animate-spin\" />\r\n                        ) : (\r\n                            <Navigation size={18} />\r\n                        )}\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {/* Error message */}\r\n            {hasError && (\r\n                <p className=\"text-red-500 text-xs mt-1\">{externalError || searchError}</p>\r\n            )}\r\n\r\n            {/* Results dropdown */}\r\n            {isOpen && results.length > 0 && (\r\n                <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-72 overflow-y-auto animate-in fade-in slide-in-from-top-2 duration-200\">\r\n                    <div className=\"py-1\">\r\n                        {results.map((item) => (\r\n                            <button\r\n                                key={item.id}\r\n                                type=\"button\"\r\n                                onClick={() => handleSelect(item)}\r\n                                className=\"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group\"\r\n                            >\r\n                                <div className=\"flex items-start gap-3\">\r\n                                    <MapPin \r\n                                        size={16} \r\n                                        className=\"text-gray-400 group-hover:text-brand-blue transition-colors mt-0.5 shrink-0\" \r\n                                    />\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                        <div className=\"font-medium text-sm dark:text-white group-hover:text-brand-blue transition-colors truncate\">\r\n                                            {item.shortName || item.formattedAddress}\r\n                                        </div>\r\n                                        {item.displayName !== item.shortName && (\r\n                                            <div className=\"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5\">\r\n                                                {item.displayName}\r\n                                            </div>\r\n                                        )}\r\n                                        {item.address?.zip && (\r\n                                            <div className=\"text-xs text-gray-400 mt-0.5\">\r\n                                                ZIP: {item.address.zip}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                    \r\n                    {/* Attribution (required by Nominatim) */}\r\n                    <div className=\"px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-t dark:border-gray-700 text-[10px] text-gray-400 text-center\">\r\n                        Powered by OpenStreetMap\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Loading state for dropdown */}\r\n            {isOpen && loading && results.length === 0 && displayValue.length >= 3 && (\r\n                <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2\">\r\n                    <Loader2 className=\"animate-spin\" size={16} />\r\n                    <span className=\"text-sm\">Searching addresses...</span>\r\n                </div>\r\n            )}\r\n\r\n            {/* No results state */}\r\n            {isOpen && !loading && results.length === 0 && displayValue.length >= 3 && (\r\n                <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 text-sm\">\r\n                    No addresses found. Try a different search.\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","// src/utils/eduPermissions.js\r\n\r\nimport { EDU_ROLES, EDU_ROLE_HIERARCHY, GLOBAL_ADMIN_ROLE } from '../config/constants';\r\n\r\n/**\r\n * Check if user has any EDU access (has any EDU role)\r\n * @param {Object} userData - User profile data\r\n * @returns {boolean}\r\n */\r\nexport function hasEduAccess(userData) {\r\n    if (!userData || !userData.accountTypes) return false;\r\n    return userData.accountTypes.some(role => EDU_ROLES.includes(role));\r\n}\r\n\r\n/**\r\n * Get user's highest EDU role level\r\n * @param {Object} userData - User profile data\r\n * @returns {string|null} - Highest role or null if no EDU access\r\n */\r\nexport function getEduRole(userData) {\r\n    if (!hasEduAccess(userData)) return null;\r\n    \r\n    const userRoles = userData.accountTypes.filter(role => EDU_ROLES.includes(role));\r\n    \r\n    // Return highest role based on hierarchy\r\n    for (const role of EDU_ROLE_HIERARCHY) {\r\n        if (userRoles.includes(role)) {\r\n            return role;\r\n        }\r\n    }\r\n    \r\n    return userRoles[0] || null;\r\n}\r\n\r\n/**\r\n * Check if user has specific EDU permission\r\n * @param {Object} userData - User profile data\r\n * @param {string} permission - Permission ID to check\r\n * @returns {boolean}\r\n */\r\nexport function hasEduPermission(userData, permission) {\r\n    if (!hasEduAccess(userData)) return false;\r\n    \r\n    const role = getEduRole(userData);\r\n    \r\n    // EDU Admin has all school permissions\r\n    if (role === 'EDUAdmin') return true;\r\n    \r\n    // For other roles, check if they have the permission in their role\r\n    // This would need to check the school's role permissions\r\n    // For now, return true for EDUStaff for most permissions\r\n    if (role === 'EDUStaff') {\r\n        // EDUStaff typically have most permissions except school admin ones\r\n        return permission !== 'edit_settings' || userData.accountTypes?.includes('EDUAdmin');\r\n    }\r\n    \r\n    // Students and Interns have limited permissions\r\n    if (role === 'Student' || role === 'Intern') {\r\n        return false; // Students don't have admin permissions\r\n    }\r\n    \r\n    return false;\r\n}\r\n\r\n/**\r\n * Check if user can access a specific school\r\n * This checks:\r\n * - Student: enrolled in school (enrollments collection or students collection)\r\n * - Intern: listed in school roster with \"Active Internship\" status\r\n * - EDUStaff: listed in school staff collection\r\n * - EDUAdmin: listed in school admins array\r\n * - GAdmin: can access all schools\r\n * \r\n * @param {Object} userData - User profile data\r\n * @param {string} schoolId - School ID to check\r\n * @param {Array} userSchoolIds - Array of school IDs user is assigned to (from enrollments/staff)\r\n * @returns {boolean|Promise<boolean>} - Returns boolean if userSchoolIds provided, Promise if needs async check\r\n */\r\nexport async function canAccessSchool(userData, schoolId, userSchoolIds = null) {\r\n    if (!userData) return false;\r\n    \r\n    // Global Admin (GAdmin) can access all schools\r\n    if (userData.accountTypes?.includes(GLOBAL_ADMIN_ROLE)) return true;\r\n    \r\n    // If userSchoolIds provided, check if schoolId is in the list\r\n    if (userSchoolIds !== null && Array.isArray(userSchoolIds)) {\r\n        return userSchoolIds.includes(schoolId);\r\n    }\r\n    \r\n    // If no userSchoolIds provided, perform async check\r\n    if (!hasEduAccess(userData)) return false;\r\n    \r\n    const { isStudentInSchool, isInternInSchool, isStaffInSchool, isAdminInSchool } = await import('./eduRoleAssignment');\r\n    const accountTypes = userData.accountTypes || [];\r\n    \r\n    // Check each role\r\n    if (accountTypes.includes('Student')) {\r\n        if (await isStudentInSchool(userData.uid || userData.id, schoolId)) return true;\r\n    }\r\n    if (accountTypes.includes('Intern')) {\r\n        if (await isInternInSchool(userData.uid || userData.id, schoolId)) return true;\r\n    }\r\n    if (accountTypes.includes('EDUStaff')) {\r\n        if (await isStaffInSchool(userData.uid || userData.id, schoolId)) return true;\r\n    }\r\n    if (accountTypes.includes('EDUAdmin')) {\r\n        if (await isAdminInSchool(userData.uid || userData.id, schoolId)) return true;\r\n    }\r\n    \r\n    // Fallback: check if schoolId matches user's primary schoolId\r\n    return userData.schoolId === schoolId;\r\n}\r\n\r\n/**\r\n * Check if user is a Global Admin (GAdmin)\r\n * @param {Object} userData - User profile data\r\n * @returns {boolean}\r\n */\r\nexport function isGlobalAdmin(userData) {\r\n    if (!userData || !userData.accountTypes) return false;\r\n    return userData.accountTypes.includes(GLOBAL_ADMIN_ROLE);\r\n}\r\n\r\n/**\r\n * Check if user is an EDU Admin (school admin)\r\n * @param {Object} userData - User profile data\r\n * @returns {boolean}\r\n */\r\nexport function isEduAdmin(userData) {\r\n    if (!userData || !userData.accountTypes) return false;\r\n    return userData.accountTypes.includes('EDUAdmin');\r\n}\r\n\r\n/**\r\n * Check if user is EDU Staff\r\n * @param {Object} userData - User profile data\r\n * @returns {boolean}\r\n */\r\nexport function isEduStaff(userData) {\r\n    if (!userData || !userData.accountTypes) return false;\r\n    return userData.accountTypes.includes('EDUStaff');\r\n}\r\n\r\n/**\r\n * Get user's assigned schools\r\n * This checks:\r\n * - Students: enrollments collection or students collection\r\n * - Interns: school roster with \"Active Internship\" status\r\n * - EDUStaff: staff collection\r\n * - EDUAdmin: school admins arrays\r\n * \r\n * @param {string} userId - User ID\r\n * @param {Array<string>} accountTypes - User's account types\r\n * @returns {Promise<Array<string>>} - Array of school IDs\r\n */\r\nexport async function getUserAssignedSchools(userId, accountTypes = []) {\r\n    const { getSchoolsForRole } = await import('./eduRoleAssignment');\r\n    const schools = new Set();\r\n    \r\n    // Check each EDU role the user has\r\n    for (const role of ['Student', 'Intern', 'EDUStaff', 'EDUAdmin']) {\r\n        if (accountTypes.includes(role)) {\r\n            const roleSchools = await getSchoolsForRole(userId, role);\r\n            roleSchools.forEach(schoolId => schools.add(schoolId));\r\n        }\r\n    }\r\n    \r\n    return Array.from(schools);\r\n}\r\n\r\n","// src/contexts/EduAuthContext.jsx\r\n\r\nimport React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { supabase } from '../config/supabase';\r\nimport { hasEduAccess, getEduRole, canAccessSchool } from '../utils/eduPermissions';\r\n\r\nconst EduAuthContext = createContext();\r\n\r\nexport function useEduAuth() {\r\n    const context = useContext(EduAuthContext);\r\n    if (!context) {\r\n        throw new Error('useEduAuth must be used within an EduAuthProvider');\r\n    }\r\n    return context;\r\n}\r\n\r\nexport function EduAuthProvider({ children, user: mainUser, userData: mainUserData }) {\r\n    const [eduUser, setEduUser] = useState(null);\r\n    const [eduUserData, setEduUserData] = useState(null);\r\n    const [eduSessionValid, setEduSessionValid] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!mainUser || !supabase) {\r\n            setEduUser(null);\r\n            setEduUserData(null);\r\n            setEduSessionValid(false);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        // Check if user has EDU access (EDUAdmin, EDUStaff, Student, Intern)\r\n        // Note: GAdmin (Global Admin) is NOT an EDU role - they use separate Admin App\r\n        // Role assignment rules:\r\n        // - Student: Only when enrolled in a school (enrollments collection)\r\n        // - Intern: Only when listed as \"Active Internship\" on school roster\r\n        // - EDUStaff: Only when listed as \"Staff\" within a school\r\n        // - EDUAdmin: Only granted by GAdmin from Global Admin App\r\n        if (!mainUserData || !hasEduAccess(mainUserData)) {\r\n            setEduUser(null);\r\n            setEduUserData(null);\r\n            setEduSessionValid(false);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        // User has EDU access - set up EDU session\r\n        setEduUser(mainUser);\r\n        setEduUserData(mainUserData);\r\n        setEduSessionValid(hasEduAccess(mainUserData));\r\n        setLoading(false);\r\n\r\n        // Subscribe to profile changes via Supabase realtime\r\n        const userId = mainUser.id || mainUser.uid;\r\n        const profileChannel = supabase\r\n            .channel(`edu-profile-${userId}`)\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: '*',\r\n                    schema: 'public',\r\n                    table: 'profiles',\r\n                    filter: `id=eq.${userId}`\r\n                },\r\n                async (payload) => {\r\n                    try {\r\n                        const { data: profile } = await supabase\r\n                            .from('profiles')\r\n                            .select('*')\r\n                            .eq('id', userId)\r\n                            .single();\r\n                        \r\n                        if (profile) {\r\n                            // Normalize data structure\r\n                            const normalizedData = {\r\n                                ...profile,\r\n                                firstName: profile.first_name,\r\n                                lastName: profile.last_name,\r\n                                accountTypes: profile.account_types || ['Fan'],\r\n                                activeProfileRole: profile.active_role || 'Fan',\r\n                                photoURL: profile.avatar_url\r\n                            };\r\n                            setEduUserData(normalizedData);\r\n                            setEduSessionValid(hasEduAccess(normalizedData));\r\n                        } else {\r\n                            setEduUserData(null);\r\n                            setEduSessionValid(false);\r\n                        }\r\n                    } catch (error) {\r\n                        console.error('Error updating EDU user data:', error);\r\n                    }\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(profileChannel);\r\n        };\r\n    }, [mainUser, mainUserData]);\r\n\r\n    const value = {\r\n        user: eduUser,\r\n        userData: eduUserData,\r\n        isAuthenticated: !!eduUser && eduSessionValid,\r\n        hasEduAccess: eduSessionValid,\r\n        eduRole: eduUserData ? getEduRole(eduUserData) : null,\r\n        canAccessSchool: async (schoolId) => {\r\n            if (!eduUserData) return false;\r\n            // canAccessSchool is now async - it checks school assignments dynamically\r\n            return await canAccessSchool(eduUserData, schoolId);\r\n        },\r\n        loading\r\n    };\r\n\r\n    return (\r\n        <EduAuthContext.Provider value={value}>\r\n            {children}\r\n        </EduAuthContext.Provider>\r\n    );\r\n}\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useSchool } from '../../contexts/SchoolContext';\r\nimport { supabase } from '../../config/supabase';\r\nimport { MapPin, Search, CheckCircle, Clock, School, BookOpen, Award, Users, Calendar, Play } from 'lucide-react';\r\nimport { useEduAuth } from '../../contexts/EduAuthContext';\r\n\r\nexport default function EduStudentDashboard({ user: propUser, userData: propUserData }) {\r\n    // Use EduAuth hook if available, otherwise fall back to props (backward compatibility)\r\n    let eduAuth;\r\n    try {\r\n        eduAuth = useEduAuth();\r\n    } catch (e) {\r\n        // Not wrapped in EduAuthProvider, use props\r\n        eduAuth = null;\r\n    }\r\n    \r\n    const user = eduAuth?.user || propUser;\r\n    const userData = eduAuth?.userData || propUserData;\r\n    \r\n    const { schoolData, studentProfile } = useSchool();\r\n    \r\n    const [newInterest, setNewInterest] = useState('');\r\n    const [studios, setStudios] = useState([]);\r\n    const [loadingStudios, setLoadingStudios] = useState(false);\r\n    const [courses, setCourses] = useState([]);\r\n    const [enrollments, setEnrollments] = useState([]);\r\n    const [learningPaths, setLearningPaths] = useState([]);\r\n    const [badges, setBadges] = useState([]);\r\n    const [loadingCourses, setLoadingCourses] = useState(false);\r\n\r\n    const interests = userData?.internshipCities || [];\r\n    const schoolId = userData?.schoolId;\r\n    \r\n    const handleAddInterest = async () => {\r\n        const trimmed = newInterest.trim();\r\n        const userId = user?.id || user?.uid;\r\n        if (trimmed && interests.length < 3 && supabase) {\r\n            try {\r\n                const updatedInterests = [...interests, trimmed];\r\n                await supabase\r\n                    .from('profiles')\r\n                    .update({ internship_cities: updatedInterests })\r\n                    .eq('id', userId);\r\n                setNewInterest('');\r\n            } catch (e) { console.error(\"Error adding interest:\", e); }\r\n        }\r\n    };\r\n\r\n    const handleRemoveInterest = async (interest) => {\r\n        const userId = user?.id || user?.uid;\r\n        if (!supabase) return;\r\n        try {\r\n            const updatedInterests = interests.filter(i => i !== interest);\r\n            await supabase\r\n                .from('profiles')\r\n                .update({ internship_cities: updatedInterests })\r\n                .eq('id', userId);\r\n        } catch (e) { console.error(\"Error removing interest:\", e); }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (userData?.programComplete) {\r\n            fetchAvailableStudios();\r\n        }\r\n    }, [userData?.programComplete, interests]);\r\n\r\n    useEffect(() => {\r\n        if (schoolId && user?.uid) {\r\n            loadCourses();\r\n            loadEnrollments();\r\n            loadLearningPaths();\r\n            loadBadges();\r\n        }\r\n    }, [schoolId, user?.uid]);\r\n\r\n    const fetchAvailableStudios = async () => {\r\n        if (!supabase) return;\r\n        setLoadingStudios(true);\r\n        try {\r\n            const { data: studiosData, error } = await supabase\r\n                .from('studios')\r\n                .select('*')\r\n                .eq('allow_internship', true);\r\n            \r\n            if (error) throw error;\r\n            \r\n            let results = (studiosData || []).map(d => ({\r\n                id: d.id,\r\n                ...d,\r\n                allowInternship: d.allow_internship,\r\n                zipCode: d.zip_code\r\n            }));\r\n\r\n            if (interests.length > 0) {\r\n                results = results.filter(studio => \r\n                    interests.some(interest => \r\n                        studio.city?.toLowerCase().includes(interest.toLowerCase()) || \r\n                        studio.zipCode?.includes(interest)\r\n                    )\r\n                );\r\n            }\r\n            setStudios(results);\r\n        } catch (e) { console.error(\"Error fetching studios:\", e); } \r\n        finally { setLoadingStudios(false); }\r\n    };\r\n\r\n    const loadCourses = async () => {\r\n        if (!supabase || !schoolId) return;\r\n        setLoadingCourses(true);\r\n        try {\r\n            const { data: coursesData, error } = await supabase\r\n                .from('courses')\r\n                .select('*')\r\n                .eq('school_id', schoolId)\r\n                .eq('status', 'published');\r\n            \r\n            if (error) throw error;\r\n            \r\n            setCourses((coursesData || []).map(c => ({ id: c.id, ...c })));\r\n        } catch (error) {\r\n            console.error('Error loading courses:', error);\r\n        }\r\n        setLoadingCourses(false);\r\n    };\r\n\r\n    const loadEnrollments = async () => {\r\n        if (!supabase || !schoolId) return;\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const { data: enrollmentsData, error } = await supabase\r\n                .from('enrollments')\r\n                .select('*')\r\n                .eq('school_id', schoolId)\r\n                .eq('student_id', userId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            setEnrollments((enrollmentsData || []).map(e => ({\r\n                id: e.id,\r\n                ...e,\r\n                studentId: e.student_id,\r\n                courseId: e.course_id,\r\n                enrolledAt: e.enrolled_at\r\n            })));\r\n        } catch (error) {\r\n            console.error('Error loading enrollments:', error);\r\n        }\r\n    };\r\n\r\n    const loadLearningPaths = async () => {\r\n        if (!supabase || !schoolId) return;\r\n        try {\r\n            const { data: pathsData, error } = await supabase\r\n                .from('learning_paths')\r\n                .select('*')\r\n                .eq('school_id', schoolId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            setLearningPaths((pathsData || []).map(p => ({ id: p.id, ...p })));\r\n        } catch (error) {\r\n            console.error('Error loading learning paths:', error);\r\n        }\r\n    };\r\n\r\n    const loadBadges = async () => {\r\n        if (!supabase || !schoolId) return;\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const { data: badgesData, error } = await supabase\r\n                .from('badges')\r\n                .select('*')\r\n                .eq('school_id', schoolId)\r\n                .eq('student_id', userId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            setBadges((badgesData || []).map(b => ({\r\n                id: b.id,\r\n                ...b,\r\n                studentId: b.student_id\r\n            })));\r\n        } catch (error) {\r\n            console.error('Error loading badges:', error);\r\n        }\r\n    };\r\n\r\n    const handleEnroll = async (courseId) => {\r\n        if (!supabase || !schoolId) return;\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            await supabase\r\n                .from('enrollments')\r\n                .insert({\r\n                    school_id: schoolId,\r\n                    student_id: userId,\r\n                    course_id: courseId,\r\n                    enrolled_at: new Date().toISOString(),\r\n                    progress: 0,\r\n                    status: 'active'\r\n                });\r\n            loadEnrollments();\r\n        } catch (error) {\r\n            console.error('Error enrolling:', error);\r\n            alert('Failed to enroll in course.');\r\n        }\r\n    };\r\n\r\n    const enrolledCourseIds = enrollments.map(e => e.courseId);\r\n    const availableCourses = courses.filter(c => !enrolledCourseIds.includes(c.id));\r\n    const myEnrolledCourses = courses.filter(c => enrolledCourseIds.includes(c.id));\r\n    \r\n    const progress = (studentProfile?.hoursLogged || 0) / (schoolData?.requiredHours || 100);\r\n\r\n    return (\r\n        <div className=\"max-w-5xl mx-auto space-y-8 pb-20\">\r\n            \r\n            {/* --- SCHOOL IDENTITY HEADER --- */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6\">\r\n                <div className=\"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2\">\r\n                    {schoolData?.logoURL ? (\r\n                        <img src={schoolData.logoURL} className=\"h-full w-full object-contain\" alt=\"School Logo\" />\r\n                    ) : (\r\n                        <School size={32} className=\"text-gray-400\"/>\r\n                    )}\r\n                </div>\r\n                <div className=\"flex-1 text-center md:text-left\">\r\n                    <h1 className=\"text-3xl font-extrabold dark:text-white tracking-tight mb-1\">\r\n                        {schoolData?.name || 'Student Dashboard'}\r\n                    </h1>\r\n                    <div className=\"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                        <span className=\"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide\">\r\n                            Student Portal\r\n                        </span>\r\n                        <span></span>\r\n                        <span>ID: {userData?.studentId || 'N/A'}</span>\r\n                        <span></span>\r\n                        <span>Cohort: {studentProfile?.cohort || 'General'}</span>\r\n                    </div>\r\n                </div>\r\n                \r\n                {/* Progress Stats */}\r\n                <div className=\"w-full md:w-64 bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700\">\r\n                    <div className=\"flex justify-between text-sm font-bold mb-2\">\r\n                        <span className=\"dark:text-gray-300\">Progress</span>\r\n                        <span className=\"text-indigo-600\">{Math.round(progress * 100)}%</span>\r\n                    </div>\r\n                    <div className=\"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-2\">\r\n                        <div className=\"h-full bg-indigo-600\" style={{ width: `${Math.min(100, progress * 100)}%` }}></div>\r\n                    </div>\r\n                    <p className=\"text-xs text-gray-500 text-right\">{studentProfile?.hoursLogged || 0} / {schoolData?.requiredHours || 100} Hours</p>\r\n                </div>\r\n            </div>\r\n            \r\n            {/* Internship Interests */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-6\">\r\n                <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\"><MapPin size={20} className=\"text-indigo-500\" /> Internship Locations</h2>\r\n                <p className=\"text-gray-500 text-sm\">Add up to 3 target locations (City, Zip, or County) to find matched studios.</p>\r\n                \r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    {interests.map(interest => (\r\n                        <span key={interest} className=\"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300 text-sm font-medium px-3 py-1 rounded-full flex items-center gap-1\">\r\n                            {interest}\r\n                            <button onClick={() => handleRemoveInterest(interest)} className=\"ml-1 hover:text-indigo-800\">&times;</button>\r\n                        </span>\r\n                    ))}\r\n                </div>\r\n\r\n                {interests.length < 3 && (\r\n                    <div className=\"flex gap-2\">\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Enter City or Zip Code\"\r\n                            value={newInterest}\r\n                            onChange={(e) => setNewInterest(e.target.value)}\r\n                            onKeyDown={(e) => e.key === 'Enter' && handleAddInterest()}\r\n                            className=\"flex-1 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none\"\r\n                        />\r\n                        <button onClick={handleAddInterest} disabled={!newInterest.trim()} className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg font-bold disabled:opacity-50\">Add</button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n            \r\n            {/* My Courses */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4\">\r\n                <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                    <BookOpen size={20} className=\"text-indigo-500\" /> \r\n                    My Courses\r\n                </h2>\r\n                {myEnrolledCourses.length === 0 ? (\r\n                    <p className=\"text-gray-500\">You haven't enrolled in any courses yet.</p>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        {myEnrolledCourses.map(course => {\r\n                            const enrollment = enrollments.find(e => e.courseId === course.id);\r\n                            return (\r\n                                <div key={course.id} className=\"p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5 transition\">\r\n                                    <div className=\"flex items-start justify-between mb-2\">\r\n                                        <h3 className=\"font-bold dark:text-white\">{course.title}</h3>\r\n                                        <span className=\"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-1 rounded\">\r\n                                            Enrolled\r\n                                        </span>\r\n                                    </div>\r\n                                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2\">\r\n                                        {course.description}\r\n                                    </p>\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div className=\"flex items-center gap-2 text-sm text-gray-500\">\r\n                                            <Play size={14} />\r\n                                            <span>{course.lessonCount || 0} lessons</span>\r\n                                        </div>\r\n                                        <button className=\"text-indigo-600 text-sm font-semibold hover:underline\">\r\n                                            Continue Learning \r\n                                        </button>\r\n                                    </div>\r\n                                    {enrollment && (\r\n                                        <div className=\"mt-3\">\r\n                                            <div className=\"flex justify-between text-xs mb-1\">\r\n                                                <span className=\"text-gray-500\">Progress</span>\r\n                                                <span className=\"text-gray-700 dark:text-gray-300\">{enrollment.progress || 0}%</span>\r\n                                            </div>\r\n                                            <div className=\"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\r\n                                                <div \r\n                                                    className=\"h-full bg-indigo-600 transition-all\"\r\n                                                    style={{ width: `${enrollment.progress || 0}%` }}\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Available Courses */}\r\n            {availableCourses.length > 0 && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4\">\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <BookOpen size={20} className=\"text-indigo-500\" /> \r\n                        Available Courses\r\n                    </h2>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        {availableCourses.slice(0, 4).map(course => (\r\n                            <div key={course.id} className=\"p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5 transition\">\r\n                                <h3 className=\"font-bold dark:text-white mb-1\">{course.title}</h3>\r\n                                <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2\">\r\n                                    {course.description}\r\n                                </p>\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-2 text-sm text-gray-500\">\r\n                                        <Play size={14} />\r\n                                        <span>{course.lessonCount || 0} lessons</span>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => handleEnroll(course.id)}\r\n                                        className=\"px-4 py-1.5 bg-indigo-600 text-white text-sm font-semibold rounded-lg hover:bg-indigo-700 transition\"\r\n                                    >\r\n                                        Enroll\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Badges & Certificates */}\r\n            {badges.length > 0 && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4\">\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Award size={20} className=\"text-yellow-500\" /> \r\n                        Earned Badges & Certificates\r\n                    </h2>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        {badges.map(badge => (\r\n                            <div key={badge.id} className=\"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                                <Award size={32} className=\"mx-auto text-yellow-500 mb-2\" />\r\n                                <p className=\"text-sm font-semibold dark:text-white\">{badge.name}</p>\r\n                                <p className=\"text-xs text-gray-500 mt-1\">\r\n                                    {badge.earnedAt?.toDate?.().toLocaleDateString() || 'Recently'}\r\n                                </p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Available Studios */}\r\n            {userData?.programComplete && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4\">\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\"><Search size={20} className=\"text-indigo-500\" /> Available Studios</h2>\r\n                    {loadingStudios ? <p className=\"text-gray-500 flex items-center gap-2\"><Clock className=\"animate-spin\" size={16}/> Searching...</p> : (\r\n                        studios.length > 0 ? (\r\n                            <div className=\"space-y-3\">\r\n                                {studios.map(studio => (\r\n                                    <div key={studio.id} className=\"p-4 border rounded-lg dark:border-gray-700 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition\">\r\n                                        <div>\r\n                                            <p className=\"font-bold dark:text-white text-lg\">{studio.name}</p>\r\n                                            <p className=\"text-sm text-gray-500 flex items-center gap-1\"><MapPin size={12}/> {studio.city}, {studio.state}</p>\r\n                                        </div>\r\n                                        <button className=\"text-indigo-600 font-bold text-sm hover:underline\">View Details</button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        ) : <p className=\"text-gray-500 flex items-center gap-2\"><CheckCircle size={16}/> No studios found matching your criteria yet.</p>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","/**\r\n * src/utils/eduTime.js\r\n * Utilities for tracking internship hours, session durations, and academic calendars.\r\n */\r\n\r\n/**\r\n * Calculates the duration in minutes between two timestamps.\r\n * Handles native Date objects and Firestore Timestamps.\r\n * @param {Date|Object} startTime \r\n * @param {Date|Object} endTime \r\n * @returns {number} Duration in minutes\r\n */\r\nexport const calculateDurationMinutes = (startTime, endTime) => {\r\n    if (!startTime || !endTime) return 0;\r\n\r\n    const start = startTime.toMillis ? startTime.toMillis() : new Date(startTime).getTime();\r\n    const end = endTime.toMillis ? endTime.toMillis() : new Date(endTime).getTime();\r\n\r\n    const diffMs = end - start;\r\n    return Math.max(0, Math.floor(diffMs / 60000));\r\n};\r\n\r\n/**\r\n * Formats minutes into a readable string (e.g., \"4h 15m\").\r\n * @param {number} totalMinutes \r\n * @returns {string}\r\n */\r\nexport const formatHours = (totalMinutes) => {\r\n    const hours = Math.floor(totalMinutes / 60);\r\n    const minutes = Math.floor(totalMinutes % 60);\r\n    return `${hours}h ${minutes > 0 ? `${minutes}m` : ''}`;\r\n};\r\n\r\n/**\r\n * Sums up total hours from an array of log entries.\r\n * Expects logs to have 'checkIn' and 'checkOut' fields.\r\n * @param {Array} logs - Array of log objects\r\n * @returns {Object} { totalMinutes: number, formatted: string, progress: number }\r\n */\r\nexport const calculateInternshipProgress = (logs = [], targetHours = 0) => {\r\n    let totalMinutes = 0;\r\n\r\n    logs.forEach(log => {\r\n        if (log.checkIn && log.checkOut) {\r\n            totalMinutes += calculateDurationMinutes(log.checkIn, log.checkOut);\r\n        }\r\n    });\r\n\r\n    // Convert target hours to minutes for calculation\r\n    const targetMinutes = targetHours * 60;\r\n    const progress = targetMinutes > 0 ? Math.min(100, Math.round((totalMinutes / targetMinutes) * 100)) : 0;\r\n\r\n    return {\r\n        totalMinutes,\r\n        formatted: formatHours(totalMinutes),\r\n        progress\r\n    };\r\n};\r\n\r\n/**\r\n * Determines the current Academic Term based on a date.\r\n * Default Logic: Spring (Jan-May), Summer (Jun-Aug), Fall (Sep-Dec)\r\n * @param {Date} date \r\n * @returns {string} e.g., \"Fall 2024\"\r\n */\r\nexport const getAcademicTerm = (date = new Date()) => {\r\n    const month = date.getMonth(); // 0-11\r\n    const year = date.getFullYear();\r\n\r\n    if (month >= 0 && month <= 4) return `Spring ${year}`;\r\n    if (month >= 5 && month <= 7) return `Summer ${year}`;\r\n    return `Fall ${year}`;\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useSchool } from '../../contexts/SchoolContext';\r\nimport { MapPin, Clock, Briefcase, CheckCircle, AlertCircle, School, BookOpen, Award, Target } from 'lucide-react';\r\nimport { formatHours } from '../../utils/eduTime';\r\nimport { useEduAuth } from '../../contexts/EduAuthContext';\r\nimport { supabase } from '../../config/supabase';\r\n\r\nexport default function EduInternDashboard({ user: propUser, userData: propUserData }) {\r\n    // Use EduAuth hook if available, otherwise fall back to props (backward compatibility)\r\n    let eduAuth;\r\n    try {\r\n        eduAuth = useEduAuth();\r\n    } catch (e) {\r\n        // Not wrapped in EduAuthProvider, use props\r\n        eduAuth = null;\r\n    }\r\n    \r\n    const user = eduAuth?.user || propUser;\r\n    const userData = eduAuth?.userData || propUserData;\r\n    \r\n    const { \r\n        schoolData, studentProfile, internshipStudio, \r\n        checkIn, checkOut \r\n    } = useSchool();\r\n\r\n    const [description, setDescription] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [enrollments, setEnrollments] = useState([]);\r\n    const [badges, setBadges] = useState([]);\r\n    const [milestones, setMilestones] = useState([]);\r\n\r\n    const schoolId = userData?.schoolId;\r\n\r\n    useEffect(() => {\r\n        if (schoolId && (user?.id || user?.uid) && supabase) {\r\n            loadEnrollments();\r\n            loadBadges();\r\n            loadMilestones();\r\n        }\r\n    }, [schoolId, user?.id, user?.uid]);\r\n\r\n    const loadEnrollments = async () => {\r\n        if (!supabase || !schoolId) return;\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const { data: enrollmentsData, error } = await supabase\r\n                .from('enrollments')\r\n                .select('*')\r\n                .eq('school_id', schoolId)\r\n                .eq('student_id', userId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            setEnrollments((enrollmentsData || []).map(e => ({\r\n                id: e.id,\r\n                ...e,\r\n                studentId: e.student_id,\r\n                courseId: e.course_id,\r\n                enrolledAt: e.enrolled_at\r\n            })));\r\n        } catch (error) {\r\n            console.error('Error loading enrollments:', error);\r\n        }\r\n    };\r\n\r\n    const loadBadges = async () => {\r\n        if (!supabase || !schoolId) return;\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const { data: badgesData, error } = await supabase\r\n                .from('badges')\r\n                .select('*')\r\n                .eq('school_id', schoolId)\r\n                .eq('student_id', userId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            setBadges((badgesData || []).map(b => ({\r\n                id: b.id,\r\n                ...b,\r\n                studentId: b.student_id\r\n            })));\r\n        } catch (error) {\r\n            console.error('Error loading badges:', error);\r\n        }\r\n    };\r\n\r\n    const loadMilestones = async () => {\r\n        // Load internship milestones from student profile or separate collection\r\n        if (studentProfile?.milestones) {\r\n            setMilestones(studentProfile.milestones);\r\n        }\r\n    };\r\n\r\n    const handleClockAction = async () => {\r\n        setLoading(true);\r\n        try {\r\n            if (studentProfile?.isClockedIn) {\r\n                await checkOut(description);\r\n                setDescription('');\r\n            } else {\r\n                await checkIn(internshipStudio?.name || 'Remote Internship', 'studio');\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    if (!studentProfile) return <div className=\"p-8 text-center\">Loading student profile...</div>;\r\n\r\n    const progress = Math.min(100, (studentProfile.hoursLogged || 0) / (schoolData?.requiredHours || 100) * 100);\r\n\r\n    return (\r\n        <div className=\"max-w-5xl mx-auto space-y-6 pb-20\">\r\n            \r\n            {/* --- SCHOOL IDENTITY HEADER --- */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6\">\r\n                <div className=\"h-20 w-20 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-1\">\r\n                    {schoolData?.logoURL ? (\r\n                        <img src={schoolData.logoURL} className=\"h-full w-full object-contain\" alt=\"School Logo\" />\r\n                    ) : (\r\n                        <School size={32} className=\"text-gray-400\"/>\r\n                    )}\r\n                </div>\r\n                <div className=\"flex-1 text-center md:text-left\">\r\n                    <h1 className=\"text-3xl font-extrabold dark:text-white tracking-tight mb-1\">\r\n                        {schoolData?.name || 'Internship Dashboard'}\r\n                    </h1>\r\n                    <div className=\"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                         <span className=\"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide\">\r\n                            Active Intern\r\n                        </span>\r\n                        <span></span>\r\n                        <span>Cohort: {studentProfile.cohort}</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"text-right hidden md:block\">\r\n                    <div className=\"text-3xl font-black dark:text-white text-indigo-600\">{studentProfile.hoursLogged || 0}</div>\r\n                    <div className=\"text-xs text-gray-500 uppercase font-bold tracking-wider\">Total Hours</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Active Internship Card */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                <div className=\"md:col-span-2 bg-gradient-to-br from-indigo-900 to-slate-900 text-white p-8 rounded-2xl relative overflow-hidden shadow-lg border border-indigo-800/50\">\r\n                    <div className=\"relative z-10\">\r\n                        <h3 className=\"text-xs font-bold uppercase tracking-widest opacity-60 mb-2\">Assigned Studio Location</h3>\r\n                        <h2 className=\"text-3xl font-extrabold mb-4 tracking-tight\">{internshipStudio?.name || \"Pending Assignment\"}</h2>\r\n                        \r\n                        {internshipStudio ? (\r\n                            <div className=\"space-y-3 text-sm opacity-90\">\r\n                                <p className=\"flex items-center gap-2\"><MapPin size={18} className=\"text-indigo-400\"/> {internshipStudio.address || \"Address not listed\"}</p>\r\n                                <p className=\"flex items-center gap-2\"><CheckCircle size={18} className=\"text-green-400\"/> Status: Active Placement</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"bg-white/10 p-4 rounded-xl flex items-start gap-3 border border-white/10\">\r\n                                <AlertCircle className=\"text-yellow-400 shrink-0 mt-0.5\" size={20}/>\r\n                                <p className=\"text-sm leading-relaxed\">You haven't been assigned an internship location yet. Please contact your school coordinator to get placed.</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                    {/* Decorative Circle */}\r\n                    <div className=\"absolute -right-12 -bottom-12 w-64 h-64 bg-indigo-600/20 rounded-full blur-3xl\"></div>\r\n                </div>\r\n\r\n                {/* Time Clock */}\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col justify-between\">\r\n                    <div>\r\n                        <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                            <Clock className={studentProfile.isClockedIn ? \"text-green-500 animate-pulse\" : \"text-gray-400\"}/> \r\n                            {studentProfile.isClockedIn ? 'Currently Working' : 'Time Clock'}\r\n                        </h3>\r\n                        {studentProfile.isClockedIn && (\r\n                            <textarea \r\n                                className=\"w-full p-3 text-sm border rounded-xl mb-4 dark:bg-black/20 dark:border-gray-600 dark:text-white resize-none focus:ring-2 focus:ring-indigo-500 outline-none\"\r\n                                rows=\"4\"\r\n                                placeholder=\"Describe your tasks for this session...\"\r\n                                value={description}\r\n                                onChange={e => setDescription(e.target.value)}\r\n                            />\r\n                        )}\r\n                    </div>\r\n                    \r\n                    <button \r\n                        onClick={handleClockAction}\r\n                        disabled={loading || (!internshipStudio && !studentProfile.isClockedIn)}\r\n                        className={`w-full py-3.5 rounded-xl font-bold text-white transition shadow-lg transform active:scale-95 ${\r\n                            loading ? 'bg-gray-400' :\r\n                            studentProfile.isClockedIn ? 'bg-red-500 hover:bg-red-600 shadow-red-500/30' : \r\n                            'bg-green-600 hover:bg-green-700 shadow-green-600/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none'\r\n                        }`}\r\n                    >\r\n                        {loading ? 'Processing...' : studentProfile.isClockedIn ? 'Clock Out' : 'Clock In'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Progress Bar */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm\">\r\n                <div className=\"flex justify-between text-sm font-bold mb-2\">\r\n                    <span className=\"dark:text-white\">Completion Progress</span>\r\n                    <span className=\"text-indigo-600\">{Math.round(progress)}%</span>\r\n                </div>\r\n                <div className=\"w-full h-4 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden\">\r\n                    <div className=\"h-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-1000 ease-out\" style={{width: `${progress}%`}}></div>\r\n                </div>\r\n                <p className=\"text-xs text-gray-500 mt-2 text-center\">\r\n                    {studentProfile.hoursLogged} / {schoolData?.requiredHours || 100} Hours Required\r\n                </p>\r\n            </div>\r\n\r\n            {/* Course Progress */}\r\n            {enrollments.length > 0 && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4\">\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <BookOpen size={20} className=\"text-indigo-500\" />\r\n                        Course Progress\r\n                    </h2>\r\n                    <div className=\"space-y-3\">\r\n                        {enrollments.map(enrollment => (\r\n                            <div key={enrollment.id} className=\"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                                <div className=\"flex justify-between items-center mb-2\">\r\n                                    <span className=\"font-semibold dark:text-white\">Course {enrollment.courseId}</span>\r\n                                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">{enrollment.progress || 0}%</span>\r\n                                </div>\r\n                                <div className=\"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\r\n                                    <div \r\n                                        className=\"h-full bg-indigo-600 transition-all\"\r\n                                        style={{ width: `${enrollment.progress || 0}%` }}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Milestones */}\r\n            {milestones.length > 0 && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4\">\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Target size={20} className=\"text-purple-500\" />\r\n                        Internship Milestones\r\n                    </h2>\r\n                    <div className=\"space-y-2\">\r\n                        {milestones.map((milestone, idx) => (\r\n                            <div key={idx} className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                                {milestone.completed ? (\r\n                                    <CheckCircle size={20} className=\"text-green-500\" />\r\n                                ) : (\r\n                                    <div className=\"w-5 h-5 border-2 border-gray-300 dark:border-gray-600 rounded-full\" />\r\n                                )}\r\n                                <span className={milestone.completed ? 'text-gray-600 dark:text-gray-400 line-through' : 'dark:text-white'}>\r\n                                    {milestone.name}\r\n                                </span>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Badges */}\r\n            {badges.length > 0 && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4\">\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Award size={20} className=\"text-yellow-500\" />\r\n                        Earned Badges\r\n                    </h2>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        {badges.map(badge => (\r\n                            <div key={badge.id} className=\"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                                <Award size={32} className=\"mx-auto text-yellow-500 mb-2\" />\r\n                                <p className=\"text-sm font-semibold dark:text-white\">{badge.name}</p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","/**\r\n * Utilities for exporting system data to CSV for external reporting.\r\n */\r\nexport const exportToCSV = (data, filename = 'export') => {\r\n    if (!data || !data.length) {\r\n        console.warn(\"No data to export.\");\r\n        return;\r\n    }\r\n\r\n    const allKeys = new Set();\r\n    data.forEach(item => Object.keys(item).forEach(k => allKeys.add(k)));\r\n    const headers = Array.from(allKeys);\r\n\r\n    const csvRows = [];\r\n    csvRows.push(headers.join(','));\r\n\r\n    data.forEach(row => {\r\n        const values = headers.map(header => {\r\n            const val = row[header];\r\n            \r\n            if (val && typeof val === 'object') {\r\n                if (val.toMillis) {\r\n                    return `\"${new Date(val.toMillis()).toLocaleString()}\"`;\r\n                }\r\n                return `\"${JSON.stringify(val).replace(/\"/g, '\"\"')}\"`; \r\n            }\r\n            \r\n            const escaped = ('' + (val ?? '')).replace(/\"/g, '\"\"');\r\n            return `\"${escaped}\"`;\r\n        });\r\n        csvRows.push(values.join(','));\r\n    });\r\n\r\n    const blob = new Blob([csvRows.join('\\n')], { type: 'text/csv;charset=utf-8;' });\r\n    const url = URL.createObjectURL(blob);\r\n    \r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.setAttribute('download', `${filename}_${new Date().toISOString().slice(0,10)}.csv`);\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Users, Briefcase, Clock, Activity, School, Globe } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\nimport StatCard from '../../shared/StatCard';\r\n\r\nexport default function EduOverview({ schoolId, schoolData }) {\r\n    const [stats, setStats] = useState({ students: 0, interns: 0, pending: 0 });\r\n    const [recentActivity, setRecentActivity] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const loadStats = async () => {\r\n            setLoading(true);\r\n            try {\r\n                // 1. Get Student Count\r\n                const { count: studentCount, error: studentError } = await supabase\r\n                    .from('students')\r\n                    .select('*', { count: 'exact', head: true })\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (studentError) throw studentError;\r\n                \r\n                // 2. Get Active Interns (students with internship_studio_id)\r\n                const { data: studentsData, error: studentsError } = await supabase\r\n                    .from('students')\r\n                    .select('id, internship_studio_id')\r\n                    .eq('school_id', schoolId)\r\n                    .not('internship_studio_id', 'is', null);\r\n                \r\n                if (studentsError) throw studentsError;\r\n                \r\n                const activeInterns = (studentsData || []).length;\r\n\r\n                // 3. Get Pending Logs\r\n                const { data: logsData, error: logsError } = await supabase\r\n                    .from('internship_logs')\r\n                    .select('id')\r\n                    .eq('school_id', schoolId)\r\n                    .eq('status', 'pending_approval');\r\n                \r\n                if (logsError) throw logsError;\r\n                \r\n                const pendingLogs = (logsData || []).length;\r\n\r\n                setStats({\r\n                    students: studentCount || 0, \r\n                    interns: activeInterns,\r\n                    pending: pendingLogs\r\n                });\r\n\r\n                // 4. Recent Audit Logs\r\n                const { data: auditData, error: auditError } = await supabase\r\n                    .from('audit_logs')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId)\r\n                    .order('timestamp', { ascending: false })\r\n                    .limit(5);\r\n                \r\n                if (auditError) throw auditError;\r\n                \r\n                setRecentActivity((auditData || []).map(a => ({\r\n                    id: a.id,\r\n                    ...a,\r\n                    adminName: a.admin_name,\r\n                    timestamp: a.timestamp ? new Date(a.timestamp) : null\r\n                })));\r\n\r\n            } catch (e) {\r\n                console.error(\"Overview load failed:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n        \r\n        loadStats();\r\n    }, [schoolId]);\r\n\r\n    if (loading) return <div className=\"p-10 text-center text-gray-500\">Loading Overview...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-2\">\r\n            {/* Stats Row */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <StatCard \r\n                    title=\"Total Students\" \r\n                    value={stats.students} \r\n                    icon={<Users className=\"text-white\"/>} \r\n                    bg=\"bg-gradient-to-br from-indigo-500 to-blue-600\" \r\n                    text=\"text-white\" \r\n                />\r\n                <StatCard \r\n                    title=\"Active Internships\" \r\n                    value={stats.interns} \r\n                    icon={<Briefcase className=\"text-white\"/>} \r\n                    bg=\"bg-gradient-to-br from-purple-500 to-pink-600\" \r\n                    text=\"text-white\" \r\n                />\r\n                <StatCard \r\n                    title=\"Pending Approvals\" \r\n                    value={stats.pending} \r\n                    icon={<Clock className=\"text-white\"/>} \r\n                    bg=\"bg-gradient-to-br from-yellow-500 to-orange-600\" \r\n                    text=\"text-white\" \r\n                />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Recent Activity */}\r\n                <div className=\"border dark:border-gray-700 rounded-xl p-4 bg-gray-50 dark:bg-gray-800/50\">\r\n                    <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                        <Activity size={18} className=\"text-gray-400\"/> Recent Activity\r\n                    </h3>\r\n                    <div className=\"space-y-3\">\r\n                        {recentActivity.length === 0 ? (\r\n                            <p className=\"text-sm text-gray-500 italic\">No recent activity recorded.</p>\r\n                        ) : (\r\n                            recentActivity.map(log => (\r\n                                <div key={log.id} className=\"text-xs border-b dark:border-gray-700 pb-2 last:border-0\">\r\n                                    <div className=\"flex justify-between font-bold dark:text-gray-200\">\r\n                                        <span>{log.action}</span>\r\n                                        <span className=\"text-gray-500 font-normal\">\r\n                                            {log.timestamp?.toDate ? log.timestamp.toDate().toLocaleTimeString() : ''}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"text-gray-500 mt-0.5\">\r\n                                        {log.details} <span className=\"opacity-70\"> {log.adminName}</span>\r\n                                    </div>\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                    </div>\r\n                </div>\r\n                \r\n                {/* School Identity Card */}\r\n                <div className=\"border dark:border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center text-center bg-white dark:bg-black/20 shadow-sm\">\r\n                    <div className=\"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center shadow-lg mb-4 overflow-hidden border-4 border-white dark:border-gray-700\">\r\n                        {schoolData?.logoURL ? (\r\n                            <img src={schoolData.logoURL} className=\"h-full w-full object-contain\" alt=\"School Logo\" />\r\n                        ) : (\r\n                            <School size={40} className=\"text-indigo-500\"/>\r\n                        )}\r\n                    </div>\r\n                    <h2 className=\"text-2xl font-extrabold dark:text-white mb-1\">{schoolData?.name || 'School Name'}</h2>\r\n                    <p className=\"text-sm text-gray-500 mb-4\">{schoolData?.address || 'No Address Set'}</p>\r\n                    \r\n                    {schoolData?.website && (\r\n                        <a \r\n                            href={schoolData.website} \r\n                            target=\"_blank\" \r\n                            rel=\"noreferrer\" \r\n                            className=\"text-xs font-bold text-indigo-600 bg-indigo-50 dark:bg-indigo-900/20 px-3 py-1.5 rounded-full hover:bg-indigo-100 transition flex items-center gap-1\"\r\n                        >\r\n                            <Globe size={12}/> Visit Website\r\n                        </a>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Search, UserPlus, Briefcase, Link, Edit2, Trash2, X, Save } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\nimport { exportToCSV } from '../../../utils/dataExport';\r\n\r\nexport default function EduRoster({ schoolId, logAction }) {\r\n    const [students, setStudents] = useState([]);\r\n    const [partners, setPartners] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    \r\n    // Modal States\r\n    const [showStudentModal, setShowStudentModal] = useState(false);\r\n    const [showAssignModal, setShowAssignModal] = useState(false);\r\n    const [selectedStudent, setSelectedStudent] = useState(null);\r\n    const [isEditing, setIsEditing] = useState(false);\r\n\r\n    // Forms\r\n    const [studentForm, setStudentForm] = useState({ \r\n        firstName: '', lastName: '', email: '', studentId: '', cohort: '', status: 'Enrolled' \r\n    });\r\n    const [assignStudioId, setAssignStudioId] = useState('');\r\n\r\n    // --- DATA FETCHING ---\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const loadData = async () => {\r\n            setLoading(true);\r\n            try {\r\n                // Fetch Students\r\n                const { data: studentsData, error: studentsError } = await supabase\r\n                    .from('students')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (studentsError) throw studentsError;\r\n                \r\n                setStudents((studentsData || []).map(d => ({\r\n                    id: d.id,\r\n                    ...d,\r\n                    displayName: d.display_name,\r\n                    studentId: d.student_id,\r\n                    hoursLogged: d.hours_logged || 0\r\n                })));\r\n\r\n                // Fetch Partners (for assignment dropdown)\r\n                const { data: partnersData, error: partnersError } = await supabase\r\n                    .from('school_partners')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (partnersError) throw partnersError;\r\n                \r\n                setPartners((partnersData || []).map(d => ({ id: d.id, ...d })));\r\n            } catch (e) {\r\n                console.error(\"Roster load failed:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n        loadData();\r\n    }, [schoolId]);\r\n\r\n    // --- HANDLERS ---\r\n\r\n    const handleOpenAdd = () => {\r\n        setStudentForm({ firstName: '', lastName: '', email: '', studentId: '', cohort: '', status: 'Enrolled' });\r\n        setIsEditing(false);\r\n        setSelectedStudent(null);\r\n        setShowStudentModal(true);\r\n    };\r\n\r\n    const handleOpenEdit = (student) => {\r\n        setStudentForm({\r\n            firstName: student.displayName?.split(' ')[0] || '',\r\n            lastName: student.displayName?.split(' ').slice(1).join(' ') || '',\r\n            email: student.email || '',\r\n            studentId: student.studentId || '',\r\n            cohort: student.cohort || '',\r\n            status: student.status || 'Enrolled'\r\n        });\r\n        setIsEditing(true);\r\n        setSelectedStudent(student);\r\n        setShowStudentModal(true);\r\n    };\r\n\r\n    const handleSaveStudent = async () => {\r\n        if (!supabase || !schoolId) return;\r\n        \r\n        const displayName = `${studentForm.firstName} ${studentForm.lastName}`.trim();\r\n        if (!displayName || !studentForm.email) return alert(\"Name and Email required.\");\r\n\r\n        try {\r\n            if (isEditing && selectedStudent) {\r\n                const { error } = await supabase\r\n                    .from('students')\r\n                    .update({\r\n                        first_name: studentForm.firstName,\r\n                        last_name: studentForm.lastName,\r\n                        display_name: displayName,\r\n                        email: studentForm.email,\r\n                        student_id: studentForm.studentId || null,\r\n                        cohort: studentForm.cohort || null,\r\n                        status: studentForm.status\r\n                    })\r\n                    .eq('id', selectedStudent.id)\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (error) throw error;\r\n                \r\n                setStudents(prev => prev.map(s => s.id === selectedStudent.id ? { ...s, ...studentForm, displayName } : s));\r\n                if (logAction) await logAction('Edit Student', `Updated ${displayName}`);\r\n            } else {\r\n                const { data: newStudent, error } = await supabase\r\n                    .from('students')\r\n                    .insert({\r\n                        school_id: schoolId,\r\n                        first_name: studentForm.firstName,\r\n                        last_name: studentForm.lastName,\r\n                        display_name: displayName,\r\n                        email: studentForm.email,\r\n                        student_id: studentForm.studentId || null,\r\n                        cohort: studentForm.cohort || null,\r\n                        status: studentForm.status,\r\n                        hours_logged: 0,\r\n                        created_at: new Date().toISOString()\r\n                    })\r\n                    .select()\r\n                    .single();\r\n                \r\n                if (error) throw error;\r\n                \r\n                setStudents(prev => [...prev, { \r\n                    id: newStudent.id, \r\n                    ...studentForm, \r\n                    displayName, \r\n                    hoursLogged: 0 \r\n                }]);\r\n                if (logAction) await logAction('Add Student', `Added ${displayName}`);\r\n            }\r\n            setShowStudentModal(false);\r\n        } catch (e) {\r\n            console.error(\"Save student failed:\", e);\r\n            alert(\"Failed to save student.\");\r\n        }\r\n    };\r\n\r\n    const handleDeleteStudent = async (id, name) => {\r\n        if (!confirm(`Remove ${name} from the roster? This does not delete their user account.`) || !supabase) return;\r\n        try {\r\n            await supabase\r\n                .from('students')\r\n                .delete()\r\n                .eq('id', id)\r\n                .eq('school_id', schoolId);\r\n            \r\n            setStudents(prev => prev.filter(s => s.id !== id));\r\n            if (logAction) await logAction('Remove Student', `Removed ${name}`);\r\n        } catch (e) {\r\n            console.error(\"Delete failed:\", e);\r\n        }\r\n    };\r\n\r\n    const handleAssignStudio = async () => {\r\n        if (!selectedStudent || !assignStudioId || !supabase) return;\r\n        try {\r\n            await supabase\r\n                .from('students')\r\n                .update({ internship_studio_id: assignStudioId })\r\n                .eq('id', selectedStudent.id)\r\n                .eq('school_id', schoolId);\r\n            \r\n            setStudents(prev => prev.map(s => s.id === selectedStudent.id ? { ...s, internshipStudioId: assignStudioId, internship_studio_id: assignStudioId } : s));\r\n            setShowAssignModal(false);\r\n            setAssignStudioId('');\r\n            alert(`Assigned ${selectedStudent.displayName} to studio.`);\r\n            if (logAction) await logAction('Assign Internship', `Assigned ${selectedStudent.displayName}`);\r\n        } catch (e) {\r\n            console.error(\"Assignment failed:\", e);\r\n        }\r\n    };\r\n\r\n    const filteredStudents = students.filter(s => \r\n        s.displayName?.toLowerCase().includes(searchTerm.toLowerCase()) || \r\n        s.studentId?.includes(searchTerm)\r\n    );\r\n\r\n    if (loading) return <div className=\"p-10 text-center text-gray-500\">Loading Roster...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-4 animate-in fade-in\">\r\n            {/* Actions Bar */}\r\n            <div className=\"flex flex-col sm:flex-row gap-2 justify-between\">\r\n                <div className=\"relative flex-1 max-w-md\">\r\n                    <Search className=\"absolute left-3 top-2.5 text-gray-400\" size={16}/>\r\n                    <input \r\n                        className=\"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\"\r\n                        placeholder=\"Search by Name or ID...\"\r\n                        value={searchTerm}\r\n                        onChange={e => setSearchTerm(e.target.value)}\r\n                    />\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <button onClick={() => exportToCSV(students, 'student_roster')} className=\"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-bold text-xs\">\r\n                        Export CSV\r\n                    </button>\r\n                    <button onClick={handleOpenAdd} className=\"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-indigo-700\">\r\n                        <UserPlus size={16}/> Add Student\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Data Table */}\r\n            <div className=\"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700\">\r\n                <table className=\"w-full text-sm text-left\">\r\n                    <thead className=\"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs\">\r\n                        <tr>\r\n                            <th className=\"p-3\">Name</th>\r\n                            <th className=\"p-3\">ID</th>\r\n                            <th className=\"p-3\">Cohort</th>\r\n                            <th className=\"p-3\">Internship</th>\r\n                            <th className=\"p-3 text-right\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y dark:divide-gray-700\">\r\n                        {filteredStudents.length === 0 ? (\r\n                            <tr><td colSpan=\"5\" className=\"p-6 text-center text-gray-500\">No students found.</td></tr>\r\n                        ) : (\r\n                            filteredStudents.map(s => (\r\n                                <tr key={s.id} className=\"group hover:bg-gray-50 dark:hover:bg-white/5 transition\">\r\n                                    <td className=\"p-3 font-bold dark:text-white\">{s.displayName}</td>\r\n                                    <td className=\"p-3 text-gray-500\">{s.studentId || '--'}</td>\r\n                                    <td className=\"p-3\">{s.cohort || 'General'}</td>\r\n                                    <td className=\"p-3 text-gray-500\">\r\n                                        {s.internshipStudioId ? (\r\n                                            <span className=\"flex items-center gap-1 text-green-600 font-medium text-xs bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded w-fit\">\r\n                                                <Briefcase size={12}/> Assigned\r\n                                            </span>\r\n                                        ) : (\r\n                                            <span className=\"text-gray-400 italic text-xs\">Pending</span>\r\n                                        )}\r\n                                    </td>\r\n                                    <td className=\"p-3 text-right\">\r\n                                        <div className=\"flex justify-end gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity\">\r\n                                            <button \r\n                                                onClick={() => { setSelectedStudent(s); setShowAssignModal(true); }} \r\n                                                className=\"p-1.5 bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-300 rounded hover:bg-indigo-100\" \r\n                                                title=\"Assign Internship\"\r\n                                            >\r\n                                                <Link size={14}/>\r\n                                            </button>\r\n                                            <button \r\n                                                onClick={() => handleOpenEdit(s)} \r\n                                                className=\"p-1.5 bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded hover:bg-gray-200\" \r\n                                                title=\"Edit Details\"\r\n                                            >\r\n                                                <Edit2 size={14}/>\r\n                                            </button>\r\n                                            <button \r\n                                                onClick={() => handleDeleteStudent(s.id, s.displayName)} \r\n                                                className=\"p-1.5 bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-100\" \r\n                                                title=\"Remove Student\"\r\n                                            >\r\n                                                <Trash2 size={14}/>\r\n                                            </button>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* --- MODALS --- */}\r\n\r\n            {/* Add/Edit Student Modal */}\r\n            {showStudentModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl\">\r\n                        <div className=\"flex justify-between items-center\">\r\n                            <h3 className=\"font-bold text-xl dark:text-white\">{isEditing ? 'Edit Student' : 'Add New Student'}</h3>\r\n                            <button onClick={() => setShowStudentModal(false)}><X className=\"text-gray-400 hover:text-red-500\"/></button>\r\n                        </div>\r\n                        \r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">First Name</label>\r\n                                <input className=\"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white\" value={studentForm.firstName} onChange={e => setStudentForm({...studentForm, firstName: e.target.value})}/>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Last Name</label>\r\n                                <input className=\"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white\" value={studentForm.lastName} onChange={e => setStudentForm({...studentForm, lastName: e.target.value})}/>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Email Address</label>\r\n                            <input type=\"email\" className=\"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white\" value={studentForm.email} onChange={e => setStudentForm({...studentForm, email: e.target.value})}/>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Student ID</label>\r\n                                <input className=\"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white\" value={studentForm.studentId} onChange={e => setStudentForm({...studentForm, studentId: e.target.value})} placeholder=\"e.g. S123\"/>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Cohort</label>\r\n                                <input className=\"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white\" value={studentForm.cohort} onChange={e => setStudentForm({...studentForm, cohort: e.target.value})} placeholder=\"Fall 2024\"/>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Enrollment Status</label>\r\n                            <select className=\"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white\" value={studentForm.status} onChange={e => setStudentForm({...studentForm, status: e.target.value})}>\r\n                                <option value=\"Enrolled\">Enrolled</option>\r\n                                <option value=\"Graduated\">Graduated</option>\r\n                                <option value=\"Dropped\">Dropped</option>\r\n                                <option value=\"Leave\">On Leave</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <button onClick={handleSaveStudent} className=\"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 mt-2\">\r\n                            {isEditing ? 'Update Student' : 'Create Student Record'}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Assign Studio Modal */}\r\n            {showAssignModal && selectedStudent && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] w-full max-w-sm rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl\">\r\n                        <h3 className=\"font-bold text-lg dark:text-white\">Assign Internship</h3>\r\n                        <p className=\"text-sm text-gray-500\">Select a partner studio for <strong>{selectedStudent.displayName}</strong>.</p>\r\n                        \r\n                        <select className=\"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white\" value={assignStudioId} onChange={e => setAssignStudioId(e.target.value)}>\r\n                            <option value=\"\">Select Studio...</option>\r\n                            {partners.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}\r\n                        </select>\r\n\r\n                        <div className=\"flex gap-2\">\r\n                            <button onClick={() => setShowAssignModal(false)} className=\"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm\">Cancel</button>\r\n                            <button onClick={handleAssignStudio} disabled={!assignStudioId} className=\"flex-1 bg-indigo-600 text-white py-2 rounded font-bold disabled:opacity-50\">Confirm</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { CheckCircle, XCircle, Clock, Filter, Download } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\nimport { formatHours, calculateDurationMinutes } from '../../../utils/eduTime';\r\nimport { exportToCSV } from '../../../utils/dataExport';\r\n\r\nexport default function EduHours({ schoolId }) {\r\n    const [logs, setLogs] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filterStatus, setFilterStatus] = useState('all'); // 'all', 'pending_approval', 'approved'\r\n\r\n    // --- DATA FETCHING ---\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const fetchLogs = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const { data: logsData, error } = await supabase\r\n                    .from('internship_logs')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId)\r\n                    .order('check_in', { ascending: false })\r\n                    .limit(100);\r\n                \r\n                if (error) throw error;\r\n                \r\n                const fetchedLogs = (logsData || []).map(log => {\r\n                    const duration = calculateDurationMinutes(log.check_in, log.check_out);\r\n                    return {\r\n                        id: log.id,\r\n                        ...log,\r\n                        checkIn: log.check_in,\r\n                        checkOut: log.check_out,\r\n                        studentId: log.student_id,\r\n                        studentName: log.student_name,\r\n                        duration\r\n                    };\r\n                });\r\n\r\n                setLogs(fetchedLogs);\r\n            } catch (e) {\r\n                console.error(\"Error fetching logs:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n\r\n        fetchLogs();\r\n    }, [schoolId]);\r\n\r\n    // --- ACTIONS ---\r\n\r\n    const handleLogAction = async (logId, status) => {\r\n        if (!supabase || !schoolId) return;\r\n        \r\n        try {\r\n            // 1. Update the log status\r\n            const { error } = await supabase\r\n                .from('internship_logs')\r\n                .update({ status })\r\n                .eq('id', logId)\r\n                .eq('school_id', schoolId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            // 2. Optimistic Update UI\r\n            setLogs(prev => prev.map(log => log.id === logId ? { ...log, status } : log));\r\n            \r\n            // Note: In a real app, if 'approved', you might trigger a Cloud Function \r\n            // to increment the student's total hours atomically.\r\n            \r\n        } catch (error) {\r\n            console.error(\"Error updating log:\", error);\r\n            alert(\"Failed to update log status.\");\r\n        }\r\n    };\r\n\r\n    // Filter Logic\r\n    const visibleLogs = filterStatus === 'all' \r\n        ? logs \r\n        : logs.filter(l => l.status === filterStatus);\r\n\r\n    if (loading) return <div className=\"p-10 text-center text-gray-500\">Loading Internship Hours...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-4 animate-in fade-in\">\r\n            {/* Toolbar */}\r\n            <div className=\"flex flex-col sm:flex-row justify-between gap-3 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <Filter size={16} className=\"text-gray-500\"/>\r\n                    <select \r\n                        className=\"bg-white dark:bg-[#1f2128] border dark:border-gray-600 text-sm rounded-md p-1.5 outline-none dark:text-white\"\r\n                        value={filterStatus}\r\n                        onChange={(e) => setFilterStatus(e.target.value)}\r\n                    >\r\n                        <option value=\"all\">All Activity</option>\r\n                        <option value=\"pending_approval\">Pending Approval</option>\r\n                        <option value=\"approved\">Approved</option>\r\n                        <option value=\"rejected\">Rejected</option>\r\n                        <option value=\"active\">Active (Clocked In)</option>\r\n                    </select>\r\n                </div>\r\n\r\n                <button \r\n                    onClick={() => exportToCSV(visibleLogs, 'internship_hours')} \r\n                    className=\"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700\"\r\n                >\r\n                    <Download size={14}/> Export CSV\r\n                </button>\r\n            </div>\r\n\r\n            {/* Logs Table */}\r\n            <div className=\"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <table className=\"w-full text-sm text-left\">\r\n                    <thead className=\"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs\">\r\n                        <tr>\r\n                            <th className=\"p-3\">Date</th>\r\n                            <th className=\"p-3\">Student</th>\r\n                            <th className=\"p-3\">Activity / Description</th>\r\n                            <th className=\"p-3\">Duration</th>\r\n                            <th className=\"p-3\">Status</th>\r\n                            <th className=\"p-3 text-right\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y dark:divide-gray-700\">\r\n                        {visibleLogs.length === 0 ? (\r\n                            <tr>\r\n                                <td colSpan=\"6\" className=\"p-8 text-center text-gray-500\">No logs found matching criteria.</td>\r\n                            </tr>\r\n                        ) : (\r\n                            visibleLogs.map(log => (\r\n                                <tr key={log.id} className=\"group hover:bg-gray-50 dark:hover:bg-white/5 transition\">\r\n                                    <td className=\"p-3 text-gray-600 dark:text-gray-300 whitespace-nowrap\">\r\n                                        <div className=\"font-medium\">\r\n                                            {log.checkIn?.toDate ? log.checkIn.toDate().toLocaleDateString() : 'N/A'}\r\n                                        </div>\r\n                                        <div className=\"text-[10px] text-gray-400\">\r\n                                            {log.checkIn?.toDate ? log.checkIn.toDate().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : ''}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"p-3 font-bold dark:text-white\">\r\n                                        {log.studentName}\r\n                                    </td>\r\n                                    <td className=\"p-3 max-w-xs\">\r\n                                        <span className=\"block text-[10px] uppercase font-bold text-gray-400 mb-0.5\">\r\n                                            {log.type}  {log.location}\r\n                                        </span>\r\n                                        <span className=\"text-gray-700 dark:text-gray-300 truncate block\" title={log.description}>\r\n                                            {log.description || <span className=\"italic opacity-50\">No description provided</span>}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"p-3 font-mono font-bold text-indigo-600 dark:text-indigo-400\">\r\n                                        {log.checkOut ? formatHours(log.duration) : <span className=\"animate-pulse text-green-500\">Active...</span>}\r\n                                    </td>\r\n                                    <td className=\"p-3\">\r\n                                        <StatusBadge status={log.status} />\r\n                                    </td>\r\n                                    <td className=\"p-3 text-right\">\r\n                                        {log.status === 'pending_approval' && (\r\n                                            <div className=\"flex justify-end gap-1\">\r\n                                                <button \r\n                                                    onClick={() => handleLogAction(log.id, 'approved')} \r\n                                                    className=\"p-1.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded hover:bg-green-200 transition\" \r\n                                                    title=\"Approve\"\r\n                                                >\r\n                                                    <CheckCircle size={16}/>\r\n                                                </button>\r\n                                                <button \r\n                                                    onClick={() => handleLogAction(log.id, 'rejected')} \r\n                                                    className=\"p-1.5 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-200 transition\" \r\n                                                    title=\"Reject\"\r\n                                                >\r\n                                                    <XCircle size={16}/>\r\n                                                </button>\r\n                                            </div>\r\n                                        )}\r\n                                    </td>\r\n                                </tr>\r\n                            ))\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// Helper Component for Status Styles\r\nfunction StatusBadge({ status }) {\r\n    const styles = {\r\n        'approved': 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',\r\n        'rejected': 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400',\r\n        'pending_approval': 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400',\r\n        'active': 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 animate-pulse',\r\n    };\r\n    \r\n    const labels = {\r\n        'approved': 'Approved',\r\n        'rejected': 'Rejected',\r\n        'pending_approval': 'Pending',\r\n        'active': 'In Progress',\r\n    };\r\n\r\n    return (\r\n        <span className={`px-2.5 py-0.5 rounded-full text-[10px] uppercase font-bold tracking-wide ${styles[status] || 'bg-gray-100 text-gray-500'}`}>\r\n            {labels[status] || status}\r\n        </span>\r\n    );\r\n}\r\n","// src/components/EDU/modules/EduCourseBuilder.jsx\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { \r\n    X, Save, Plus, Trash2, GripVertical, Upload, \r\n    Play, FileText, Clock, BookOpen \r\n} from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\n\r\nexport default function EduCourseBuilder({ schoolId, course, onSave, onCancel, logAction }) {\r\n    const [formData, setFormData] = useState({\r\n        title: '',\r\n        description: '',\r\n        duration: '',\r\n        prerequisites: [],\r\n        category: ''\r\n    });\r\n    const [lessons, setLessons] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [newPrerequisite, setNewPrerequisite] = useState('');\r\n    const [editingLesson, setEditingLesson] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (course) {\r\n            setFormData({\r\n                title: course.title || '',\r\n                description: course.description || '',\r\n                duration: course.duration || '',\r\n                prerequisites: course.prerequisites || [],\r\n                category: course.category || ''\r\n            });\r\n            loadLessons();\r\n        }\r\n    }, [course]);\r\n\r\n    const loadLessons = async () => {\r\n        if (!course?.id || !supabase) return;\r\n        try {\r\n            const { data: lessonsData, error } = await supabase\r\n                .from('lessons')\r\n                .select('*')\r\n                .eq('course_id', course.id)\r\n                .order('order', { ascending: true });\r\n            \r\n            if (error) throw error;\r\n            \r\n            const lessonsList = (lessonsData || []).map(l => ({\r\n                id: l.id,\r\n                ...l,\r\n                courseId: l.course_id\r\n            }));\r\n            setLessons(lessonsList);\r\n        } catch (error) {\r\n            console.error('Error loading lessons:', error);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        if (!formData.title.trim()) {\r\n            alert('Course title is required.');\r\n            return;\r\n        }\r\n\r\n        if (!supabase || !schoolId) return;\r\n        \r\n        setLoading(true);\r\n        try {\r\n            const courseData = {\r\n                school_id: schoolId,\r\n                title: formData.title,\r\n                description: formData.description || null,\r\n                duration: formData.duration || null,\r\n                prerequisites: formData.prerequisites || [],\r\n                category: formData.category || null,\r\n                lesson_count: lessons.length,\r\n                updated_at: new Date().toISOString()\r\n            };\r\n\r\n            if (course) {\r\n                // Update existing course\r\n                const { error } = await supabase\r\n                    .from('courses')\r\n                    .update(courseData)\r\n                    .eq('id', course.id)\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (error) throw error;\r\n                \r\n                if (logAction) {\r\n                    logAction('update_course', { courseId: course.id, title: formData.title });\r\n                }\r\n            } else {\r\n                // Create new course\r\n                courseData.created_at = new Date().toISOString();\r\n                courseData.status = 'draft'; // Default status\r\n                \r\n                const { data: newCourse, error } = await supabase\r\n                    .from('courses')\r\n                    .insert(courseData)\r\n                    .select()\r\n                    .single();\r\n                \r\n                if (error) throw error;\r\n                \r\n                if (logAction) {\r\n                    logAction('create_course', { courseId: newCourse.id, title: formData.title });\r\n                }\r\n            }\r\n\r\n            onSave();\r\n        } catch (error) {\r\n            console.error('Error saving course:', error);\r\n            alert('Failed to save course.');\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleAddPrerequisite = () => {\r\n        if (newPrerequisite.trim() && !formData.prerequisites.includes(newPrerequisite.trim())) {\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                prerequisites: [...prev.prerequisites, newPrerequisite.trim()]\r\n            }));\r\n            setNewPrerequisite('');\r\n        }\r\n    };\r\n\r\n    const handleRemovePrerequisite = (prereq) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            prerequisites: prev.prerequisites.filter(p => p !== prereq)\r\n        }));\r\n    };\r\n\r\n    const handleAddLesson = () => {\r\n        const newLesson = {\r\n            id: `temp-${Date.now()}`,\r\n            title: 'New Lesson',\r\n            description: '',\r\n            type: 'video',\r\n            content: '',\r\n            order: lessons.length,\r\n            duration: 0\r\n        };\r\n        setLessons([...lessons, newLesson]);\r\n        setEditingLesson(newLesson.id);\r\n    };\r\n\r\n    const handleSaveLesson = async (lessonData) => {\r\n        if (!course?.id || !supabase) {\r\n            if (!course?.id) alert('Please save the course first before adding lessons.');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const lessonPayload = {\r\n                course_id: course.id,\r\n                title: lessonData.title,\r\n                description: lessonData.description || null,\r\n                type: lessonData.type || 'video',\r\n                content: lessonData.content || null,\r\n                order: lessonData.order || lessons.length,\r\n                duration: lessonData.duration || 0,\r\n                updated_at: new Date().toISOString()\r\n            };\r\n\r\n            if (lessonData.id.startsWith('temp-')) {\r\n                lessonPayload.created_at = new Date().toISOString();\r\n                const { error } = await supabase\r\n                    .from('lessons')\r\n                    .insert(lessonPayload);\r\n                \r\n                if (error) throw error;\r\n            } else {\r\n                const { error } = await supabase\r\n                    .from('lessons')\r\n                    .update(lessonPayload)\r\n                    .eq('id', lessonData.id)\r\n                    .eq('course_id', course.id);\r\n                \r\n                if (error) throw error;\r\n            }\r\n\r\n            loadLessons();\r\n            setEditingLesson(null);\r\n        } catch (error) {\r\n            console.error('Error saving lesson:', error);\r\n            alert('Failed to save lesson.');\r\n        }\r\n    };\r\n\r\n    const handleDeleteLesson = async (lessonId) => {\r\n        if (!confirm('Delete this lesson?') || !supabase || !course?.id) return;\r\n        \r\n        if (lessonId.startsWith('temp-')) {\r\n            setLessons(lessons.filter(l => l.id !== lessonId));\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await supabase\r\n                .from('lessons')\r\n                .delete()\r\n                .eq('id', lessonId)\r\n                .eq('course_id', course.id);\r\n            \r\n            loadLessons();\r\n        } catch (error) {\r\n            console.error('Error deleting lesson:', error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <h2 className=\"text-2xl font-bold dark:text-white\">\r\n                    {course ? 'Edit Course' : 'Create New Course'}\r\n                </h2>\r\n                <div className=\"flex gap-2\">\r\n                    <button\r\n                        onClick={onCancel}\r\n                        className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button\r\n                        onClick={handleSave}\r\n                        disabled={loading}\r\n                        className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50\"\r\n                    >\r\n                        {loading ? 'Saving...' : 'Save Course'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Course Form */}\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 space-y-4\">\r\n                <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                        Course Title *\r\n                    </label>\r\n                    <input\r\n                        type=\"text\"\r\n                        value={formData.title}\r\n                        onChange={(e) => setFormData({ ...formData, title: e.target.value })}\r\n                        className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white\"\r\n                        placeholder=\"e.g., Introduction to Music Production\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                        Description\r\n                    </label>\r\n                    <textarea\r\n                        value={formData.description}\r\n                        onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                        rows={4}\r\n                        className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white\"\r\n                        placeholder=\"Course description...\"\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Duration\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.duration}\r\n                            onChange={(e) => setFormData({ ...formData, duration: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white\"\r\n                            placeholder=\"e.g., 8 weeks\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Category\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.category}\r\n                            onChange={(e) => setFormData({ ...formData, category: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white\"\r\n                            placeholder=\"e.g., Production, Engineering\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                        Prerequisites\r\n                    </label>\r\n                    <div className=\"flex gap-2 mb-2\">\r\n                        <input\r\n                            type=\"text\"\r\n                            value={newPrerequisite}\r\n                            onChange={(e) => setNewPrerequisite(e.target.value)}\r\n                            onKeyPress={(e) => e.key === 'Enter' && handleAddPrerequisite()}\r\n                            className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white\"\r\n                            placeholder=\"Add prerequisite...\"\r\n                        />\r\n                        <button\r\n                            onClick={handleAddPrerequisite}\r\n                            className=\"px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition\"\r\n                        >\r\n                            Add\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                        {formData.prerequisites.map((prereq, idx) => (\r\n                            <span\r\n                                key={idx}\r\n                                className=\"inline-flex items-center gap-1 px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-full text-sm\"\r\n                            >\r\n                                {prereq}\r\n                                <button\r\n                                    onClick={() => handleRemovePrerequisite(prereq)}\r\n                                    className=\"hover:text-indigo-900 dark:hover:text-indigo-100\"\r\n                                >\r\n                                    <X size={14} />\r\n                                </button>\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Lessons Section */}\r\n            {course && (\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"text-lg font-bold dark:text-white\">Lessons</h3>\r\n                        <button\r\n                            onClick={handleAddLesson}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\r\n                        >\r\n                            <Plus size={18} />\r\n                            Add Lesson\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        {lessons.map((lesson, idx) => (\r\n                            <div\r\n                                key={lesson.id}\r\n                                className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\"\r\n                            >\r\n                                <GripVertical className=\"text-gray-400 cursor-move\" size={18} />\r\n                                <div className=\"flex-1\">\r\n                                    <p className=\"font-medium dark:text-white\">{lesson.title || 'Untitled Lesson'}</p>\r\n                                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                        {lesson.type}  {lesson.duration || 0} min\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"flex gap-2\">\r\n                                    <button\r\n                                        onClick={() => setEditingLesson(lesson.id)}\r\n                                        className=\"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition\"\r\n                                    >\r\n                                        <Edit2 size={16} className=\"text-gray-600 dark:text-gray-400\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDeleteLesson(lesson.id)}\r\n                                        className=\"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition\"\r\n                                    >\r\n                                        <Trash2 size={16} className=\"text-red-600 dark:text-red-400\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                        {lessons.length === 0 && (\r\n                            <p className=\"text-center text-gray-500 dark:text-gray-400 py-8\">\r\n                                No lessons yet. Add your first lesson!\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/EDU/modules/EduCourses.jsx\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { \r\n    BookOpen, Plus, Search, Edit2, Trash2, Users, Clock, \r\n    Play, FileText, Award, X, Save, Upload \r\n} from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\nimport EduCourseBuilder from './EduCourseBuilder';\r\n\r\nexport default function EduCourses({ schoolId, logAction }) {\r\n    const [courses, setCourses] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [showBuilder, setShowBuilder] = useState(false);\r\n    const [editingCourse, setEditingCourse] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (!schoolId) return;\r\n        loadCourses();\r\n    }, [schoolId]);\r\n\r\n    const loadCourses = async () => {\r\n        if (!schoolId || !supabase) return;\r\n        setLoading(true);\r\n        try {\r\n            const { data: coursesData, error } = await supabase\r\n                .from('courses')\r\n                .select('*')\r\n                .eq('school_id', schoolId)\r\n                .order('created_at', { ascending: false });\r\n            \r\n            if (error) throw error;\r\n            \r\n            const coursesList = (coursesData || []).map(c => ({\r\n                id: c.id,\r\n                ...c,\r\n                createdAt: c.created_at\r\n            }));\r\n            setCourses(coursesList);\r\n        } catch (error) {\r\n            console.error('Error loading courses:', error);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleCreateCourse = () => {\r\n        setEditingCourse(null);\r\n        setShowBuilder(true);\r\n    };\r\n\r\n    const handleEditCourse = (course) => {\r\n        setEditingCourse(course);\r\n        setShowBuilder(true);\r\n    };\r\n\r\n    const handleDeleteCourse = async (courseId) => {\r\n        if (!confirm('Are you sure you want to delete this course? This action cannot be undone.') || !supabase) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Delete all lessons first (if foreign key constraints allow, otherwise handled by CASCADE)\r\n            const { error: lessonsError } = await supabase\r\n                .from('lessons')\r\n                .delete()\r\n                .eq('course_id', courseId);\r\n            \r\n            if (lessonsError) {\r\n                console.warn('Error deleting lessons (may be handled by CASCADE):', lessonsError);\r\n            }\r\n            \r\n            // Delete course\r\n            const { error: courseError } = await supabase\r\n                .from('courses')\r\n                .delete()\r\n                .eq('id', courseId)\r\n                .eq('school_id', schoolId);\r\n            \r\n            if (courseError) throw courseError;\r\n            \r\n            if (logAction) {\r\n                logAction('delete_course', { courseId });\r\n            }\r\n            \r\n            loadCourses();\r\n        } catch (error) {\r\n            console.error('Error deleting course:', error);\r\n            alert('Failed to delete course.');\r\n        }\r\n    };\r\n\r\n    const filteredCourses = courses.filter(course =>\r\n        course.title?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        course.description?.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    if (showBuilder) {\r\n        return (\r\n            <EduCourseBuilder\r\n                schoolId={schoolId}\r\n                course={editingCourse}\r\n                onSave={() => {\r\n                    setShowBuilder(false);\r\n                    setEditingCourse(null);\r\n                    loadCourses();\r\n                }}\r\n                onCancel={() => {\r\n                    setShowBuilder(false);\r\n                    setEditingCourse(null);\r\n                }}\r\n                logAction={logAction}\r\n            />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <BookOpen size={24} />\r\n                        Courses\r\n                    </h2>\r\n                    <p className=\"text-gray-600 dark:text-gray-400 text-sm mt-1\">\r\n                        Manage courses and learning materials\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={handleCreateCourse}\r\n                    className=\"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition\"\r\n                >\r\n                    <Plus size={18} />\r\n                    New Course\r\n                </button>\r\n            </div>\r\n\r\n            {/* Search */}\r\n            <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" size={18} />\r\n                <input\r\n                    type=\"text\"\r\n                    placeholder=\"Search courses...\"\r\n                    value={searchTerm}\r\n                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                    className=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-800 dark:text-white\"\r\n                />\r\n            </div>\r\n\r\n            {/* Courses Grid */}\r\n            {loading ? (\r\n                <div className=\"text-center py-12\">\r\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto\"></div>\r\n                    <p className=\"mt-4 text-gray-600 dark:text-gray-400\">Loading courses...</p>\r\n                </div>\r\n            ) : filteredCourses.length === 0 ? (\r\n                <div className=\"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n                    <BookOpen size={48} className=\"mx-auto text-gray-400 mb-4\" />\r\n                    <p className=\"text-gray-600 dark:text-gray-400\">\r\n                        {searchTerm ? 'No courses found matching your search.' : 'No courses yet. Create your first course!'}\r\n                    </p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                    {filteredCourses.map(course => (\r\n                        <div\r\n                            key={course.id}\r\n                            className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow\"\r\n                        >\r\n                            <div className=\"flex items-start justify-between mb-4\">\r\n                                <div className=\"flex-1\">\r\n                                    <h3 className=\"text-lg font-bold dark:text-white mb-1\">\r\n                                        {course.title || 'Untitled Course'}\r\n                                    </h3>\r\n                                    <p className=\"text-sm text-gray-600 dark:text-gray-400 line-clamp-2\">\r\n                                        {course.description || 'No description'}\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"flex gap-2 ml-2\">\r\n                                    <button\r\n                                        onClick={() => handleEditCourse(course)}\r\n                                        className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                                        title=\"Edit course\"\r\n                                    >\r\n                                        <Edit2 size={16} className=\"text-gray-600 dark:text-gray-400\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDeleteCourse(course.id)}\r\n                                        className=\"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                        title=\"Delete course\"\r\n                                    >\r\n                                        <Trash2 size={16} className=\"text-red-600 dark:text-red-400\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400\">\r\n                                <div className=\"flex items-center gap-1\">\r\n                                    <Play size={14} />\r\n                                    <span>{course.lessonCount || 0} lessons</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-1\">\r\n                                    <Users size={14} />\r\n                                    <span>{course.enrollmentCount || 0} enrolled</span>\r\n                                </div>\r\n                                {course.duration && (\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        <Clock size={14} />\r\n                                        <span>{course.duration}</span>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {course.prerequisites && course.prerequisites.length > 0 && (\r\n                                <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Prerequisites:</p>\r\n                                    <div className=\"flex flex-wrap gap-1\">\r\n                                        {course.prerequisites.map((prereq, idx) => (\r\n                                            <span\r\n                                                key={idx}\r\n                                                className=\"px-2 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs\"\r\n                                            >\r\n                                                {prereq}\r\n                                            </span>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/EDU/modules/EduLearningPaths.jsx\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { \r\n    GraduationCap, Plus, Search, Edit2, Trash2, Users, \r\n    Award, Target, BookOpen, X, Save \r\n} from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\n\r\nexport default function EduLearningPaths({ schoolId, logAction }) {\r\n    const [paths, setPaths] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [showForm, setShowForm] = useState(false);\r\n    const [editingPath, setEditingPath] = useState(null);\r\n    const [formData, setFormData] = useState({\r\n        title: '',\r\n        description: '',\r\n        courses: [],\r\n        badges: [],\r\n        skills: [],\r\n        mentorshipEnabled: false\r\n    });\r\n    const [availableCourses, setAvailableCourses] = useState([]);\r\n\r\n    useEffect(() => {\r\n        if (!schoolId) return;\r\n        loadPaths();\r\n        loadCourses();\r\n    }, [schoolId]);\r\n\r\n    const loadPaths = async () => {\r\n        if (!schoolId || !supabase) return;\r\n        setLoading(true);\r\n        try {\r\n            const { data: pathsData, error } = await supabase\r\n                .from('learning_paths')\r\n                .select('*')\r\n                .eq('school_id', schoolId)\r\n                .order('created_at', { ascending: false });\r\n            \r\n            if (error) throw error;\r\n            \r\n            const pathsList = (pathsData || []).map(p => ({\r\n                id: p.id,\r\n                ...p,\r\n                createdAt: p.created_at,\r\n                mentorshipEnabled: p.mentorship_enabled || false\r\n            }));\r\n            setPaths(pathsList);\r\n        } catch (error) {\r\n            console.error('Error loading learning paths:', error);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const loadCourses = async () => {\r\n        if (!schoolId || !supabase) return;\r\n        try {\r\n            const { data: coursesData, error } = await supabase\r\n                .from('courses')\r\n                .select('id, title')\r\n                .eq('school_id', schoolId)\r\n                .order('title', { ascending: true });\r\n            \r\n            if (error) throw error;\r\n            \r\n            const coursesList = (coursesData || []).map(c => ({\r\n                id: c.id,\r\n                title: c.title\r\n            }));\r\n            setAvailableCourses(coursesList);\r\n        } catch (error) {\r\n            console.error('Error loading courses:', error);\r\n        }\r\n    };\r\n\r\n    const handleCreatePath = () => {\r\n        setFormData({\r\n            title: '',\r\n            description: '',\r\n            courses: [],\r\n            badges: [],\r\n            skills: [],\r\n            mentorshipEnabled: false\r\n        });\r\n        setEditingPath(null);\r\n        setShowForm(true);\r\n    };\r\n\r\n    const handleEditPath = (path) => {\r\n        setFormData({\r\n            title: path.title || '',\r\n            description: path.description || '',\r\n            courses: path.courses || [],\r\n            badges: path.badges || [],\r\n            skills: path.skills || [],\r\n            mentorshipEnabled: path.mentorshipEnabled || false\r\n        });\r\n        setEditingPath(path);\r\n        setShowForm(true);\r\n    };\r\n\r\n    const handleSavePath = async () => {\r\n        if (!formData.title.trim() || !supabase || !schoolId) {\r\n            if (!formData.title.trim()) alert('Path title is required.');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        try {\r\n            const pathData = {\r\n                school_id: schoolId,\r\n                title: formData.title,\r\n                description: formData.description || null,\r\n                courses: formData.courses || [],\r\n                badges: formData.badges || [],\r\n                skills: formData.skills || [],\r\n                mentorship_enabled: formData.mentorshipEnabled || false,\r\n                updated_at: new Date().toISOString()\r\n            };\r\n\r\n            if (editingPath) {\r\n                const { error } = await supabase\r\n                    .from('learning_paths')\r\n                    .update(pathData)\r\n                    .eq('id', editingPath.id)\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (error) throw error;\r\n                \r\n                if (logAction) {\r\n                    logAction('update_learning_path', { pathId: editingPath.id, title: formData.title });\r\n                }\r\n            } else {\r\n                pathData.created_at = new Date().toISOString();\r\n                const { data: newPath, error } = await supabase\r\n                    .from('learning_paths')\r\n                    .insert(pathData)\r\n                    .select()\r\n                    .single();\r\n                \r\n                if (error) throw error;\r\n                \r\n                if (logAction) {\r\n                    logAction('create_learning_path', { pathId: newPath.id, title: formData.title });\r\n                }\r\n            }\r\n\r\n            setShowForm(false);\r\n            setEditingPath(null);\r\n            loadPaths();\r\n        } catch (error) {\r\n            console.error('Error saving learning path:', error);\r\n            alert('Failed to save learning path.');\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleDeletePath = async (pathId) => {\r\n        if (!confirm('Are you sure you want to delete this learning path?') || !supabase) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const { error } = await supabase\r\n                .from('learning_paths')\r\n                .delete()\r\n                .eq('id', pathId)\r\n                .eq('school_id', schoolId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            if (logAction) {\r\n                logAction('delete_learning_path', { pathId });\r\n            }\r\n            loadPaths();\r\n        } catch (error) {\r\n            console.error('Error deleting learning path:', error);\r\n            alert('Failed to delete learning path.');\r\n        }\r\n    };\r\n\r\n    const toggleCourse = (courseId) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            courses: prev.courses.includes(courseId)\r\n                ? prev.courses.filter(id => id !== courseId)\r\n                : [...prev.courses, courseId]\r\n        }));\r\n    };\r\n\r\n    const addBadge = () => {\r\n        const badgeName = prompt('Enter badge name:');\r\n        if (badgeName && !formData.badges.includes(badgeName)) {\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                badges: [...prev.badges, badgeName]\r\n            }));\r\n        }\r\n    };\r\n\r\n    const removeBadge = (badge) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            badges: prev.badges.filter(b => b !== badge)\r\n        }));\r\n    };\r\n\r\n    const addSkill = () => {\r\n        const skillName = prompt('Enter skill name:');\r\n        if (skillName && !formData.skills.includes(skillName)) {\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                skills: [...prev.skills, skillName]\r\n            }));\r\n        }\r\n    };\r\n\r\n    const removeSkill = (skill) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            skills: prev.skills.filter(s => s !== skill)\r\n        }));\r\n    };\r\n\r\n    const filteredPaths = paths.filter(path =>\r\n        path.title?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        path.description?.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    if (showForm) {\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <h2 className=\"text-2xl font-bold dark:text-white\">\r\n                        {editingPath ? 'Edit Learning Path' : 'Create Learning Path'}\r\n                    </h2>\r\n                    <div className=\"flex gap-2\">\r\n                        <button\r\n                            onClick={() => {\r\n                                setShowForm(false);\r\n                                setEditingPath(null);\r\n                            }}\r\n                            className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            onClick={handleSavePath}\r\n                            disabled={loading}\r\n                            className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50\"\r\n                        >\r\n                            {loading ? 'Saving...' : 'Save Path'}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Path Title *\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.title}\r\n                            onChange={(e) => setFormData({ ...formData, title: e.target.value })}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white\"\r\n                            placeholder=\"e.g., Advanced Music Production Track\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Description\r\n                        </label>\r\n                        <textarea\r\n                            value={formData.description}\r\n                            onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                            rows={4}\r\n                            className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white\"\r\n                            placeholder=\"Learning path description...\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Courses\r\n                        </label>\r\n                        <div className=\"space-y-2 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-3\">\r\n                            {availableCourses.map(course => (\r\n                                <label\r\n                                    key={course.id}\r\n                                    className=\"flex items-center gap-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded\"\r\n                                >\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={formData.courses.includes(course.id)}\r\n                                        onChange={() => toggleCourse(course.id)}\r\n                                        className=\"rounded\"\r\n                                    />\r\n                                    <span className=\"dark:text-white\">{course.title}</span>\r\n                                </label>\r\n                            ))}\r\n                            {availableCourses.length === 0 && (\r\n                                <p className=\"text-gray-500 dark:text-gray-400 text-sm\">\r\n                                    No courses available. Create courses first.\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Badges\r\n                        </label>\r\n                        <div className=\"flex flex-wrap gap-2 mb-2\">\r\n                            {formData.badges.map((badge, idx) => (\r\n                                <span\r\n                                    key={idx}\r\n                                    className=\"inline-flex items-center gap-1 px-3 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded-full text-sm\"\r\n                                >\r\n                                    <Award size={14} />\r\n                                    {badge}\r\n                                    <button\r\n                                        onClick={() => removeBadge(badge)}\r\n                                        className=\"hover:text-yellow-900 dark:hover:text-yellow-100\"\r\n                                    >\r\n                                        <X size={14} />\r\n                                    </button>\r\n                                </span>\r\n                            ))}\r\n                        </div>\r\n                        <button\r\n                            onClick={addBadge}\r\n                            className=\"text-sm text-indigo-600 dark:text-indigo-400 hover:underline\"\r\n                        >\r\n                            + Add Badge\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                            Skills\r\n                        </label>\r\n                        <div className=\"flex flex-wrap gap-2 mb-2\">\r\n                            {formData.skills.map((skill, idx) => (\r\n                                <span\r\n                                    key={idx}\r\n                                    className=\"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-sm\"\r\n                                >\r\n                                    <Target size={14} />\r\n                                    {skill}\r\n                                    <button\r\n                                        onClick={() => removeSkill(skill)}\r\n                                        className=\"hover:text-blue-900 dark:hover:text-blue-100\"\r\n                                    >\r\n                                        <X size={14} />\r\n                                    </button>\r\n                                </span>\r\n                            ))}\r\n                        </div>\r\n                        <button\r\n                            onClick={addSkill}\r\n                            className=\"text-sm text-indigo-600 dark:text-indigo-400 hover:underline\"\r\n                        >\r\n                            + Add Skill\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            id=\"mentorship\"\r\n                            checked={formData.mentorshipEnabled}\r\n                            onChange={(e) => setFormData({ ...formData, mentorshipEnabled: e.target.checked })}\r\n                            className=\"rounded\"\r\n                        />\r\n                        <label htmlFor=\"mentorship\" className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                            Enable Mentorship Matching\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <GraduationCap size={24} />\r\n                        Learning Paths\r\n                    </h2>\r\n                    <p className=\"text-gray-600 dark:text-gray-400 text-sm mt-1\">\r\n                        Create structured learning programs with courses, badges, and mentorship\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={handleCreatePath}\r\n                    className=\"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition\"\r\n                >\r\n                    <Plus size={18} />\r\n                    New Path\r\n                </button>\r\n            </div>\r\n\r\n            {/* Search */}\r\n            <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" size={18} />\r\n                <input\r\n                    type=\"text\"\r\n                    placeholder=\"Search learning paths...\"\r\n                    value={searchTerm}\r\n                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                    className=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-800 dark:text-white\"\r\n                />\r\n            </div>\r\n\r\n            {/* Paths Grid */}\r\n            {loading ? (\r\n                <div className=\"text-center py-12\">\r\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto\"></div>\r\n                    <p className=\"mt-4 text-gray-600 dark:text-gray-400\">Loading learning paths...</p>\r\n                </div>\r\n            ) : filteredPaths.length === 0 ? (\r\n                <div className=\"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n                    <GraduationCap size={48} className=\"mx-auto text-gray-400 mb-4\" />\r\n                    <p className=\"text-gray-600 dark:text-gray-400\">\r\n                        {searchTerm ? 'No paths found matching your search.' : 'No learning paths yet. Create your first path!'}\r\n                    </p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                    {filteredPaths.map(path => (\r\n                        <div\r\n                            key={path.id}\r\n                            className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow\"\r\n                        >\r\n                            <div className=\"flex items-start justify-between mb-4\">\r\n                                <div className=\"flex-1\">\r\n                                    <h3 className=\"text-lg font-bold dark:text-white mb-1\">\r\n                                        {path.title || 'Untitled Path'}\r\n                                    </h3>\r\n                                    <p className=\"text-sm text-gray-600 dark:text-gray-400 line-clamp-2\">\r\n                                        {path.description || 'No description'}\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"flex gap-2 ml-2\">\r\n                                    <button\r\n                                        onClick={() => handleEditPath(path)}\r\n                                        className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                                        title=\"Edit path\"\r\n                                    >\r\n                                        <Edit2 size={16} className=\"text-gray-600 dark:text-gray-400\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDeletePath(path.id)}\r\n                                        className=\"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                        title=\"Delete path\"\r\n                                    >\r\n                                        <Trash2 size={16} className=\"text-red-600 dark:text-red-400\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                                    <BookOpen size={14} />\r\n                                    <span>{path.courses?.length || 0} courses</span>\r\n                                </div>\r\n                                {path.badges && path.badges.length > 0 && (\r\n                                    <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                                        <Award size={14} />\r\n                                        <span>{path.badges.length} badges</span>\r\n                                    </div>\r\n                                )}\r\n                                {path.mentorshipEnabled && (\r\n                                    <div className=\"flex items-center gap-2 text-sm text-indigo-600 dark:text-indigo-400\">\r\n                                        <Users size={14} />\r\n                                        <span>Mentorship Enabled</span>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport { UserPlus, Shield, X, Mail } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\n\r\nexport default function EduStaff({ schoolId, logAction }) {\r\n    const [staff, setStaff] = useState([]);\r\n    const [roles, setRoles] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    \r\n    // Form State\r\n    const [newStaffEmail, setNewStaffEmail] = useState('');\r\n    const [selectedStaffRole, setSelectedStaffRole] = useState('');\r\n\r\n    // --- DATA FETCHING ---\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const loadData = async () => {\r\n            setLoading(true);\r\n            try {\r\n                // 1. Fetch Staff List\r\n                const { data: staffData, error: staffError } = await supabase\r\n                    .from('school_staff')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (staffError) throw staffError;\r\n                \r\n                setStaff((staffData || []).map(d => ({\r\n                    id: d.id,\r\n                    ...d,\r\n                    uid: d.user_id,\r\n                    roleId: d.role_id,\r\n                    roleName: d.role_name,\r\n                    addedAt: d.added_at\r\n                })));\r\n\r\n                // 2. Fetch Available Roles (for the dropdown)\r\n                const { data: rolesData, error: rolesError } = await supabase\r\n                    .from('school_roles')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (rolesError) throw rolesError;\r\n                \r\n                setRoles((rolesData || []).map(d => ({ id: d.id, ...d })));\r\n            } catch (e) {\r\n                console.error(\"Staff load failed:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n        loadData();\r\n    }, [schoolId]);\r\n\r\n    // --- ACTIONS ---\r\n\r\n    const handleAddStaff = async () => {\r\n        if (!newStaffEmail || !selectedStaffRole || !supabase || !schoolId) {\r\n            return alert(\"Email and Role are required.\");\r\n        }\r\n        \r\n        try {\r\n            // 1. Find User by Email\r\n            const { data: profileData, error: profileError } = await supabase\r\n                .from('profiles')\r\n                .select('id, email, first_name, last_name, account_types, school_id')\r\n                .eq('email', newStaffEmail)\r\n                .single();\r\n            \r\n            if (profileError || !profileData) {\r\n                return alert(\"User not found. They must sign up for SeshNx first.\");\r\n            }\r\n\r\n            const targetUserId = profileData.id;\r\n            const roleData = roles.find(r => r.id === selectedStaffRole);\r\n\r\n            // 2. Create Staff Entry in School\r\n            const { data: newStaff, error: staffError } = await supabase\r\n                .from('school_staff')\r\n                .insert({\r\n                    school_id: schoolId,\r\n                    user_id: targetUserId,\r\n                    email: profileData.email,\r\n                    name: `${profileData.first_name} ${profileData.last_name}`,\r\n                    role_id: selectedStaffRole,\r\n                    role_name: roleData?.name || 'Unknown',\r\n                    added_at: new Date().toISOString()\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (staffError) throw staffError;\r\n\r\n            // 3. Update User's Global Profile (Grant 'EDUStaff' Access)\r\n            // This allows them to see the EDU dashboards\r\n            // Note: Role is determined by being listed in school staff collection\r\n            const currentAccountTypes = profileData.account_types || [];\r\n            const updatedAccountTypes = currentAccountTypes.includes('EDUStaff') \r\n                ? currentAccountTypes \r\n                : [...currentAccountTypes, 'EDUStaff'];\r\n            \r\n            await supabase\r\n                .from('profiles')\r\n                .update({\r\n                    school_id: schoolId, // Link them to this school\r\n                    account_types: updatedAccountTypes // Grant EDUStaff access\r\n                })\r\n                .eq('id', targetUserId);\r\n\r\n            // 4. Update Local State\r\n            setStaff(prev => [...prev, {\r\n                id: newStaff.id,\r\n                ...newStaff,\r\n                uid: newStaff.user_id,\r\n                roleId: newStaff.role_id,\r\n                roleName: newStaff.role_name,\r\n                addedAt: newStaff.added_at\r\n            }]);\r\n            setNewStaffEmail('');\r\n            alert(`${profileData.first_name} added as ${roleData?.name}.`);\r\n            if (logAction) await logAction('Add Staff', `Added ${profileData.email} as ${roleData?.name}`);\r\n\r\n        } catch (e) {\r\n            console.error(\"Add staff error:\", e);\r\n            alert(\"Failed to add staff member. Check console.\");\r\n        }\r\n    };\r\n\r\n    const handleRemoveStaff = async (staffId, name) => {\r\n        // Note: This removes them from the school list, but doesn't strip the 'EDUStaff' role \r\n        // from their main profile automatically (safer to leave manual, or add strict logic).\r\n        // For MVP, we just remove the school record.\r\n        if(!confirm(`Remove ${name} from staff?`) || !supabase) return;\r\n        \r\n        try {\r\n            // Get staff member info before deletion\r\n            const staffMember = staff.find(s => s.id === staffId);\r\n            \r\n            // Remove from school_staff table\r\n            const { error } = await supabase\r\n                .from('school_staff')\r\n                .delete()\r\n                .eq('id', staffId)\r\n                .eq('school_id', schoolId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            // In a full implementation, you might want to remove 'schoolId' from their profile too.\r\n            // For now, we just remove the school record.\r\n            \r\n            setStaff(prev => prev.filter(s => s.id !== staffId));\r\n            if (logAction) await logAction('Remove Staff', `Removed ${name}`);\r\n        } catch (e) {\r\n            console.error(\"Remove staff error:\", e);\r\n            alert(\"Failed to remove staff member.\");\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"p-10 text-center text-gray-500\">Loading Staff...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Add Staff Form */}\r\n            <div className=\"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <UserPlus size={18} className=\"text-indigo-600\"/> Add New Staff Member\r\n                </h3>\r\n                <div className=\"flex flex-col md:flex-row gap-3\">\r\n                    <div className=\"flex-1 relative\">\r\n                        <Mail size={16} className=\"absolute left-3 top-3 text-gray-400\"/>\r\n                        <input \r\n                            className=\"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\"\r\n                            placeholder=\"User Email Address\"\r\n                            value={newStaffEmail}\r\n                            onChange={e => setNewStaffEmail(e.target.value)}\r\n                        />\r\n                    </div>\r\n                    <div className=\"relative min-w-[200px]\">\r\n                        <Shield size={16} className=\"absolute left-3 top-3 text-gray-400\"/>\r\n                        <select \r\n                            className=\"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white appearance-none\"\r\n                            value={selectedStaffRole}\r\n                            onChange={e => setSelectedStaffRole(e.target.value)}\r\n                        >\r\n                            <option value=\"\">Select Role...</option>\r\n                            {roles.map(r => <option key={r.id} value={r.id}>{r.name}</option>)}\r\n                        </select>\r\n                    </div>\r\n                    <button \r\n                        onClick={handleAddStaff} \r\n                        className=\"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 transition shadow-md\"\r\n                    >\r\n                        Add Staff\r\n                    </button>\r\n                </div>\r\n                <p className=\"text-xs text-gray-500 mt-3\">\r\n                    * The user must already have a SeshNx account. This will grant them <strong>EDUStaff</strong> access to this school.\r\n                </p>\r\n            </div>\r\n\r\n            {/* Staff List */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]\">\r\n                    <span className=\"font-bold text-sm dark:text-gray-200\">Authorized Personnel</span>\r\n                    <span className=\"text-xs bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded-full font-bold\">\r\n                        {staff.length} Active\r\n                    </span>\r\n                </div>\r\n                \r\n                <div className=\"divide-y dark:divide-gray-700\">\r\n                    {staff.length === 0 ? (\r\n                        <div className=\"p-8 text-center text-gray-500\">No staff members found.</div>\r\n                    ) : (\r\n                        staff.map(s => (\r\n                            <div key={s.id} className=\"p-4 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition\">\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div className=\"h-10 w-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-sm\">\r\n                                        {s.name ? s.name.charAt(0) : '?'}\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"font-bold dark:text-white text-sm\">{s.name}</div>\r\n                                        <div className=\"text-xs text-gray-500\">{s.email}</div>\r\n                                    </div>\r\n                                </div>\r\n                                \r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <span className=\"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs font-bold border dark:border-gray-600\">\r\n                                        {s.roleName}\r\n                                    </span>\r\n                                    {/* Remove button placeholder */}\r\n                                    {/* <button onClick={() => handleRemoveStaff(s.id, s.name)} className=\"text-gray-400 hover:text-red-500\"><X size={16}/></button> */}\r\n                                </div>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Plus, Trash2, Key, Save, Check } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\nimport { SCHOOL_PERMISSIONS } from '../../../config/constants';\r\n\r\nexport default function EduRoles({ schoolId, logAction }) {\r\n    const [roles, setRoles] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    \r\n    // Modal / Form State\r\n    const [showCreateModal, setShowCreateModal] = useState(false);\r\n    const [roleForm, setRoleForm] = useState({ name: '', color: '#3b82f6', permissions: [] });\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    // --- DATA FETCHING ---\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const fetchRoles = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const { data: rolesData, error } = await supabase\r\n                    .from('school_roles')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (error) throw error;\r\n                \r\n                setRoles((rolesData || []).map(r => ({ id: r.id, ...r })));\r\n            } catch (e) {\r\n                console.error(\"Error loading roles:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n        fetchRoles();\r\n    }, [schoolId]);\r\n\r\n    // --- ACTIONS ---\r\n\r\n    const handleCreateRole = async () => {\r\n        if (!roleForm.name || !supabase || !schoolId) return;\r\n        setSaving(true);\r\n        try {\r\n            const { data: newRole, error } = await supabase\r\n                .from('school_roles')\r\n                .insert({\r\n                    school_id: schoolId,\r\n                    name: roleForm.name,\r\n                    color: roleForm.color || '#3b82f6',\r\n                    permissions: roleForm.permissions || []\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (error) throw error;\r\n            \r\n            setRoles(prev => [...prev, { id: newRole.id, ...newRole }]);\r\n            if (logAction) await logAction('Create Role', `Created role: ${roleForm.name}`);\r\n            \r\n            // Reset\r\n            setRoleForm({ name: '', color: '#3b82f6', permissions: [] });\r\n            setShowCreateModal(false);\r\n        } catch (e) {\r\n            console.error(\"Create role failed:\", e);\r\n            alert(\"Failed to create role.\");\r\n        }\r\n        setSaving(false);\r\n    };\r\n\r\n    const handleDeleteRole = async (roleId, roleName) => {\r\n        if (!confirm(`Delete role \"${roleName}\"? Staff assigned to this role will lose their permissions.`) || !supabase) return;\r\n        try {\r\n            await supabase\r\n                .from('school_roles')\r\n                .delete()\r\n                .eq('id', roleId)\r\n                .eq('school_id', schoolId);\r\n            \r\n            setRoles(prev => prev.filter(r => r.id !== roleId));\r\n            if (logAction) await logAction('Delete Role', `Deleted role: ${roleName}`);\r\n        } catch (e) {\r\n            console.error(\"Delete role failed:\", e);\r\n        }\r\n    };\r\n\r\n    const handleUpdatePermissions = async (roleId, newPermissions) => {\r\n        if (!supabase || !schoolId) return;\r\n        \r\n        // Optimistic update\r\n        setRoles(prev => prev.map(r => r.id === roleId ? { ...r, permissions: newPermissions } : r));\r\n        try {\r\n            await supabase\r\n                .from('school_roles')\r\n                .update({ permissions: newPermissions })\r\n                .eq('id', roleId)\r\n                .eq('school_id', schoolId);\r\n        } catch (e) {\r\n            console.error(\"Update perms failed:\", e);\r\n            // Revert would go here in a full production app\r\n        }\r\n    };\r\n\r\n    const toggleFormPermission = (permId) => {\r\n        setRoleForm(prev => ({\r\n            ...prev,\r\n            permissions: prev.permissions.includes(permId) \r\n                ? prev.permissions.filter(p => p !== permId) \r\n                : [...prev.permissions, permId]\r\n        }));\r\n    };\r\n\r\n    const toggleExistingRolePermission = (role, permId) => {\r\n        const currentPerms = role.permissions || [];\r\n        const newPerms = currentPerms.includes(permId)\r\n            ? currentPerms.filter(p => p !== permId)\r\n            : [...currentPerms, permId];\r\n        \r\n        handleUpdatePermissions(role.id, newPerms);\r\n    };\r\n\r\n    if (loading) return <div className=\"p-10 text-center text-gray-500\">Loading Roles...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            <button \r\n                onClick={() => setShowCreateModal(true)} \r\n                className=\"w-full py-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-500 font-bold hover:bg-gray-50 dark:hover:bg-white/5 transition flex items-center justify-center gap-2\"\r\n            >\r\n                <Plus size={20}/> Create New Role\r\n            </button>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                {roles.map(role => (\r\n                    <div key={role.id} className=\"bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm flex flex-col overflow-hidden\">\r\n                        {/* Role Header */}\r\n                        <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-start bg-gray-50 dark:bg-gray-800/50\">\r\n                            <div>\r\n                                <h4 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                                    <span className=\"w-3 h-3 rounded-full\" style={{backgroundColor: role.color}}></span> \r\n                                    {role.name}\r\n                                </h4>\r\n                                <span className=\"text-[10px] text-gray-400 uppercase tracking-wider font-bold\">\r\n                                    {role.permissions?.length || 0} Permissions\r\n                                </span>\r\n                            </div>\r\n                            <button \r\n                                onClick={() => handleDeleteRole(role.id, role.name)} \r\n                                className=\"text-gray-400 hover:text-red-500 transition p-1\"\r\n                                title=\"Delete Role\"\r\n                            >\r\n                                <Trash2 size={16}/>\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Permissions List */}\r\n                        <div className=\"p-2 flex-1 overflow-y-auto max-h-[300px] custom-scrollbar\">\r\n                            <div className=\"space-y-0.5\">\r\n                                {SCHOOL_PERMISSIONS.map(perm => {\r\n                                    const isActive = role.permissions?.includes(perm.id);\r\n                                    return (\r\n                                        <label \r\n                                            key={perm.id} \r\n                                            className={`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition ${isActive ? 'bg-indigo-50 dark:bg-indigo-900/20' : 'hover:bg-gray-50 dark:hover:bg-white/5'}`}\r\n                                        >\r\n                                            <div className={`w-4 h-4 rounded border flex items-center justify-center ${isActive ? 'bg-indigo-600 border-indigo-600' : 'border-gray-400'}`}>\r\n                                                {isActive && <Check size={10} className=\"text-white\" strokeWidth={4}/>}\r\n                                            </div>\r\n                                            <input \r\n                                                type=\"checkbox\" \r\n                                                className=\"hidden\" \r\n                                                checked={isActive} \r\n                                                onChange={() => toggleExistingRolePermission(role, perm.id)} \r\n                                            />\r\n                                            <div className=\"flex-1\">\r\n                                                <div className={`text-xs font-bold ${isActive ? 'text-indigo-700 dark:text-indigo-300' : 'text-gray-600 dark:text-gray-400'}`}>\r\n                                                    {perm.label}\r\n                                                </div>\r\n                                                <div className=\"text-[10px] text-gray-400 leading-tight\">\r\n                                                    {perm.description}\r\n                                                </div>\r\n                                            </div>\r\n                                        </label>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Create Modal */}\r\n            {showCreateModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-xl p-6 space-y-4 max-h-[90vh] overflow-y-auto animate-in zoom-in-95 shadow-2xl\">\r\n                        <h3 className=\"font-bold text-xl dark:text-white flex items-center gap-2\">\r\n                            <Key className=\"text-indigo-600\"/> Create New Role\r\n                        </h3>\r\n                        \r\n                        <div className=\"grid grid-cols-4 gap-4\">\r\n                            <div className=\"col-span-3\">\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Role Name</label>\r\n                                <input \r\n                                    className=\"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                                    placeholder=\"e.g. Academic Advisor\" \r\n                                    value={roleForm.name} \r\n                                    onChange={e=>setRoleForm({...roleForm, name:e.target.value})}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Color</label>\r\n                                <div className=\"flex items-center border rounded dark:border-gray-600 p-1 dark:bg-black/20\">\r\n                                    <input \r\n                                        type=\"color\" \r\n                                        className=\"h-8 w-8 rounded cursor-pointer border-none bg-transparent\" \r\n                                        value={roleForm.color} \r\n                                        onChange={e=>setRoleForm({...roleForm, color:e.target.value})}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        \r\n                        <div className=\"border-t dark:border-gray-700 pt-4\">\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-3 block\">Assign Initial Permissions</label>\r\n                            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\r\n                                {SCHOOL_PERMISSIONS.map(perm => (\r\n                                    <label \r\n                                        key={perm.id} \r\n                                        className={`flex items-start gap-2 p-2 border rounded cursor-pointer transition ${roleForm.permissions.includes(perm.id) ? 'border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20' : 'dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5'}`}\r\n                                    >\r\n                                        <input \r\n                                            type=\"checkbox\" \r\n                                            className=\"mt-1\" \r\n                                            checked={roleForm.permissions.includes(perm.id)} \r\n                                            onChange={() => toggleFormPermission(perm.id)} \r\n                                        />\r\n                                        <div>\r\n                                            <div className=\"text-sm font-bold dark:text-gray-200\">{perm.label}</div>\r\n                                            <div className=\"text-[10px] text-gray-500 leading-tight\">{perm.description}</div>\r\n                                        </div>\r\n                                    </label>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-2 pt-2\">\r\n                            <button onClick={() => setShowCreateModal(false)} className=\"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm\">Cancel</button>\r\n                            <button onClick={handleCreateRole} disabled={saving} className=\"flex-1 bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700 disabled:opacity-50\">\r\n                                {saving ? 'Saving...' : 'Create Role'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Lock, Plus, Trash2 } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\n\r\nexport default function EduResources({ schoolId, logAction }) {\r\n    const [rules, setRules] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    \r\n    // Form State\r\n    const [ruleForm, setRuleForm] = useState({ \r\n        resource: '', \r\n        limit: 4, \r\n        unit: 'hours/week', \r\n        role: 'Student' \r\n    });\r\n\r\n    // --- DATA FETCHING ---\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const fetchRules = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const { data: rulesData, error } = await supabase\r\n                    .from('resource_rules')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId);\r\n                \r\n                if (error) throw error;\r\n                \r\n                setRules((rulesData || []).map(r => ({ id: r.id, ...r })));\r\n            } catch (e) {\r\n                console.error(\"Error loading rules:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n        fetchRules();\r\n    }, [schoolId]);\r\n\r\n    // --- ACTIONS ---\r\n\r\n    const handleAddRule = async () => {\r\n        if (!ruleForm.resource || !supabase || !schoolId) {\r\n            if (!ruleForm.resource) alert(\"Resource name required.\");\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            const { data: newRule, error } = await supabase\r\n                .from('resource_rules')\r\n                .insert({\r\n                    school_id: schoolId,\r\n                    resource: ruleForm.resource,\r\n                    limit: ruleForm.limit,\r\n                    unit: ruleForm.unit,\r\n                    role: ruleForm.role\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (error) throw error;\r\n            \r\n            setRules(prev => [...prev, { id: newRule.id, ...newRule }]);\r\n            if (logAction) await logAction('Add Resource Rule', `Set ${ruleForm.limit} ${ruleForm.unit} limit for ${ruleForm.resource}`);\r\n            \r\n            // Reset default\r\n            setRuleForm({ resource: '', limit: 4, unit: 'hours/week', role: 'Student' });\r\n        } catch (e) {\r\n            console.error(\"Add rule failed:\", e);\r\n        }\r\n    };\r\n\r\n    const handleDeleteRule = async (id, resourceName) => {\r\n        if(!confirm(\"Delete this rule?\") || !supabase || !schoolId) return;\r\n        try {\r\n            await supabase\r\n                .from('resource_rules')\r\n                .delete()\r\n                .eq('id', id)\r\n                .eq('school_id', schoolId);\r\n            \r\n            setRules(prev => prev.filter(r => r.id !== id));\r\n            if (logAction) await logAction('Delete Rule', `Removed rule for ${resourceName}`);\r\n        } catch (e) {\r\n            console.error(\"Delete failed:\", e);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"p-10 text-center text-gray-500\">Loading Rules...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Add Rule Form */}\r\n            <div className=\"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Lock size={18} className=\"text-indigo-600\"/> Add Restriction / Quota\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3\">\r\n                    <div className=\"md:col-span-2\">\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Resource Name</label>\r\n                        <input \r\n                            className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                            placeholder=\"e.g. Studio A, SSL Room\" \r\n                            value={ruleForm.resource} \r\n                            onChange={e => setRuleForm({...ruleForm, resource: e.target.value})}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Limit</label>\r\n                        <div className=\"flex gap-2\">\r\n                            <input \r\n                                type=\"number\" \r\n                                className=\"w-20 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                                value={ruleForm.limit} \r\n                                onChange={e => setRuleForm({...ruleForm, limit: e.target.value})}\r\n                            />\r\n                            <select \r\n                                className=\"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm\"\r\n                                value={ruleForm.unit}\r\n                                onChange={e => setRuleForm({...ruleForm, unit: e.target.value})}\r\n                            >\r\n                                <option value=\"hours/week\">Hrs/Wk</option>\r\n                                <option value=\"hours/term\">Hrs/Term</option>\r\n                                <option value=\"bookings/week\">Bookings/Wk</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-end\">\r\n                        <button \r\n                            onClick={handleAddRule} \r\n                            className=\"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2\"\r\n                        >\r\n                            <Plus size={18}/> Add Rule\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                <div className=\"mt-3\">\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Applies To Role</label>\r\n                    <select \r\n                        className=\"w-full md:w-1/2 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\"\r\n                        value={ruleForm.role}\r\n                        onChange={e => setRuleForm({...ruleForm, role: e.target.value})}\r\n                    >\r\n                        <option value=\"Student\">All Students</option>\r\n                        <option value=\"Senior\">Seniors Only</option>\r\n                        <option value=\"Junior\">Juniors Only</option>\r\n                        <option value=\"Probation\">Probationary</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Rules List */}\r\n            <div className=\"space-y-3\">\r\n                {rules.length === 0 ? (\r\n                    <div className=\"text-center text-gray-500 py-8 border-2 border-dashed dark:border-gray-700 rounded-xl\">\r\n                        No active restrictions. Students have default access.\r\n                    </div>\r\n                ) : (\r\n                    rules.map(r => (\r\n                        <div key={r.id} className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 flex justify-between items-center shadow-sm hover:shadow-md transition\">\r\n                            <div>\r\n                                <h4 className=\"font-bold dark:text-white text-lg\">{r.resource}</h4>\r\n                                <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300 mt-1\">\r\n                                    <span className=\"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 px-2 py-0.5 rounded text-xs font-bold border border-indigo-100 dark:border-indigo-800\">\r\n                                        {r.limit} {r.unit}\r\n                                    </span>\r\n                                    <span className=\"text-gray-400\"></span>\r\n                                    <span>Applies to: <strong>{r.role}</strong></span>\r\n                                </div>\r\n                            </div>\r\n                            <button \r\n                                onClick={() => handleDeleteRule(r.id, r.resource)} \r\n                                className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                            >\r\n                                <Trash2 size={18}/>\r\n                            </button>\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Megaphone, Send, Trash2, Users, User, Shield } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\n\r\nexport default function EduAnnouncements({ schoolId, logAction, user, userData }) {\r\n    const [announcements, setAnnouncements] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [sending, setSending] = useState(false);\r\n    \r\n    const [form, setForm] = useState({ \r\n        title: '', \r\n        message: '', \r\n        target: 'All' \r\n    });\r\n\r\n    // --- DATA FETCHING ---\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const fetchNews = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const { data: announcementsData, error } = await supabase\r\n                    .from('announcements')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId)\r\n                    .order('created_at', { ascending: false });\r\n                \r\n                if (error) throw error;\r\n                \r\n                setAnnouncements((announcementsData || []).map(a => ({\r\n                    id: a.id,\r\n                    ...a,\r\n                    schoolId: a.school_id,\r\n                    authorId: a.author_id,\r\n                    authorName: a.author_name,\r\n                    authorRole: a.author_role,\r\n                    createdAt: a.created_at\r\n                })));\r\n            } catch (e) {\r\n                console.error(\"Error loading announcements:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n        fetchNews();\r\n    }, [schoolId]);\r\n\r\n    // --- ACTIONS ---\r\n\r\n    const handlePost = async () => {\r\n        if (!form.title.trim() || !form.message.trim() || !supabase) {\r\n            if (!form.title.trim() || !form.message.trim()) alert(\"Title and Message required.\");\r\n            return;\r\n        }\r\n        \r\n        const userId = user?.id || user?.uid;\r\n        setSending(true);\r\n        \r\n        try {\r\n            const { data: newPost, error } = await supabase\r\n                .from('announcements')\r\n                .insert({\r\n                    school_id: schoolId,\r\n                    title: form.title,\r\n                    message: form.message,\r\n                    target: form.target,\r\n                    author_id: userId,\r\n                    author_name: userData?.displayName || userData?.effectiveDisplayName || 'School Admin',\r\n                    author_role: userData?.activeProfileRole || 'Admin',\r\n                    created_at: new Date().toISOString()\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (error) throw error;\r\n            \r\n            // Optimistic Update\r\n            setAnnouncements(prev => [{\r\n                id: newPost.id,\r\n                ...newPost,\r\n                schoolId: newPost.school_id,\r\n                authorId: newPost.author_id,\r\n                authorName: newPost.author_name,\r\n                authorRole: newPost.author_role,\r\n                createdAt: newPost.created_at\r\n            }, ...prev]);\r\n            \r\n            if (logAction) await logAction('Post Announcement', `Posted: ${form.title}`);\r\n            setForm({ title: '', message: '', target: 'All' });\r\n            \r\n        } catch (e) {\r\n            console.error(\"Post failed:\", e);\r\n            alert(\"Failed to post announcement.\");\r\n        }\r\n        setSending(false);\r\n    };\r\n\r\n    const handleDelete = async (id) => {\r\n        if(!confirm(\"Delete this announcement?\") || !supabase) return;\r\n        try {\r\n            await supabase\r\n                .from('announcements')\r\n                .delete()\r\n                .eq('id', id)\r\n                .eq('school_id', schoolId);\r\n            \r\n            setAnnouncements(prev => prev.filter(a => a.id !== id));\r\n            if (logAction) await logAction('Delete Announcement', 'Removed a post');\r\n        } catch (e) {\r\n            console.error(\"Delete failed:\", e);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"p-10 text-center text-gray-500\">Loading News...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Composer */}\r\n            <div className=\"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Megaphone size={18} className=\"text-indigo-600\"/> Post New Announcement\r\n                </h3>\r\n                \r\n                <div className=\"space-y-3\">\r\n                    <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                        <div className=\"flex-1\">\r\n                            <input \r\n                                className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold\"\r\n                                placeholder=\"Headline / Title\"\r\n                                value={form.title}\r\n                                onChange={e => setForm({...form, title: e.target.value})}\r\n                            />\r\n                        </div>\r\n                        <div className=\"sm:w-1/4\">\r\n                            <select \r\n                                className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white cursor-pointer\"\r\n                                value={form.target}\r\n                                onChange={e => setForm({...form, target: e.target.value})}\r\n                            >\r\n                                <option value=\"All\">Everyone</option>\r\n                                <option value=\"Student\">Students Only</option>\r\n                                <option value=\"EDUStaff\">Staff Only</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <textarea \r\n                        className=\"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]\"\r\n                        placeholder=\"Write your message here...\"\r\n                        value={form.message}\r\n                        onChange={e => setForm({...form, message: e.target.value})}\r\n                    />\r\n\r\n                    <div className=\"flex justify-end\">\r\n                        <button \r\n                            onClick={handlePost} \r\n                            disabled={sending || !form.title}\r\n                            className=\"bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition\"\r\n                        >\r\n                            {sending ? 'Posting...' : <><Send size={16}/> Post Announcement</>}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Feed */}\r\n            <div className=\"space-y-4\">\r\n                {announcements.length === 0 ? (\r\n                    <div className=\"text-center text-gray-500 py-10 border-2 border-dashed dark:border-gray-700 rounded-xl\">\r\n                        No announcements yet.\r\n                    </div>\r\n                ) : (\r\n                    announcements.map(post => (\r\n                        <div key={post.id} className=\"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm relative group\">\r\n                            <div className=\"flex justify-between items-start mb-2\">\r\n                                <div>\r\n                                    <h4 className=\"text-lg font-bold dark:text-white\">{post.title}</h4>\r\n                                    <div className=\"text-xs text-gray-500 flex items-center gap-2 mt-1\">\r\n                                        <span className=\"flex items-center gap-1\">\r\n                                            <User size={12}/> {post.authorName}\r\n                                        </span>\r\n                                        <span></span>\r\n                                        <span className=\"flex items-center gap-1\">\r\n                                            {post.target === 'All' ? <Users size={12}/> : <Shield size={12}/>} \r\n                                            {post.target}\r\n                                        </span>\r\n                                        <span></span>\r\n                                        <span>\r\n                                            {post.createdAt?.toDate ? post.createdAt.toDate().toLocaleDateString() : 'Just now'}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                                <button \r\n                                    onClick={() => handleDelete(post.id)} \r\n                                    className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition opacity-0 group-hover:opacity-100\"\r\n                                    title=\"Delete Post\"\r\n                                >\r\n                                    <Trash2 size={16}/>\r\n                                </button>\r\n                            </div>\r\n                            \r\n                            <div className=\"text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed bg-gray-50 dark:bg-black/20 p-3 rounded-lg\">\r\n                                {post.message}\r\n                            </div>\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Briefcase, MapPin, Phone, Plus, Trash2, ExternalLink } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\nimport AddressAutocomplete from '../../shared/AddressAutocomplete';\r\n\r\nexport default function EduPartners({ schoolId, logAction }) {\r\n    const [partners, setPartners] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    \r\n    const [form, setForm] = useState({ \r\n        name: '', \r\n        address: '', \r\n        website: '', \r\n        contactEmail: '' \r\n    });\r\n\r\n    // --- DATA FETCHING ---\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const fetchPartners = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const { data: partnersData, error } = await supabase\r\n                    .from('school_partners')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId)\r\n                    .order('name', { ascending: true });\r\n                \r\n                if (error) throw error;\r\n                \r\n                setPartners((partnersData || []).map(p => ({ id: p.id, ...p })));\r\n            } catch (e) {\r\n                console.error(\"Error loading partners:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n        fetchPartners();\r\n    }, [schoolId]);\r\n\r\n    // --- ACTIONS ---\r\n\r\n    const handleAdd = async () => {\r\n        if (!form.name || !supabase || !schoolId) {\r\n            if (!form.name) alert(\"Partner Name is required.\");\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            const { data: newPartner, error } = await supabase\r\n                .from('school_partners')\r\n                .insert({\r\n                    school_id: schoolId,\r\n                    name: form.name,\r\n                    address: form.address || null,\r\n                    website: form.website || null,\r\n                    contact_email: form.contactEmail || null,\r\n                    status: 'Approved'\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (error) throw error;\r\n            \r\n            setPartners(prev => [...prev, { id: newPartner.id, ...newPartner }]);\r\n            if (logAction) await logAction('Add Partner', `Added studio: ${form.name}`);\r\n            \r\n            // Reset\r\n            setForm({ name: '', address: '', website: '', contactEmail: '' });\r\n        } catch (e) {\r\n            console.error(\"Add partner failed:\", e);\r\n            alert(\"Failed to add partner.\");\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (id, name) => {\r\n        if(!confirm(`Remove ${name} from approved partners?`) || !supabase || !schoolId) return;\r\n        try {\r\n            await supabase\r\n                .from('school_partners')\r\n                .delete()\r\n                .eq('id', id)\r\n                .eq('school_id', schoolId);\r\n            \r\n            setPartners(prev => prev.filter(p => p.id !== id));\r\n            if (logAction) await logAction('Remove Partner', `Removed: ${name}`);\r\n        } catch (e) {\r\n            console.error(\"Delete failed:\", e);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"p-10 text-center text-gray-500\">Loading Partners...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Add Partner Form */}\r\n            <div className=\"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Briefcase size={18} className=\"text-indigo-600\"/> Add Approved Partner\r\n                </h3>\r\n                \r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                    <div className=\"md:col-span-2\">\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Studio / Company Name</label>\r\n                        <input \r\n                            className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold\"\r\n                            placeholder=\"e.g. Sound City Studios\"\r\n                            value={form.name}\r\n                            onChange={e => setForm({...form, name: e.target.value})}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <AddressAutocomplete\r\n                            label=\"Address\"\r\n                            value={form.address}\r\n                            onChange={(val) => setForm({...form, address: val})}\r\n                            onSelect={(addressData) => {\r\n                                setForm({\r\n                                    ...form, \r\n                                    address: addressData.formattedAddress || addressData.displayName\r\n                                });\r\n                            }}\r\n                            placeholder=\"123 Main St...\"\r\n                            showGeolocation={false}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Contact Email</label>\r\n                        <div className=\"relative\">\r\n                            <Phone size={14} className=\"absolute left-3 top-3 text-gray-400\"/>\r\n                            <input \r\n                                className=\"w-full pl-9 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\"\r\n                                placeholder=\"manager@studio.com\"\r\n                                value={form.contactEmail}\r\n                                onChange={e => setForm({...form, contactEmail: e.target.value})}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div className=\"mt-3 flex justify-end\">\r\n                    <button \r\n                        onClick={handleAdd} \r\n                        className=\"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center gap-2 shadow-md transition\"\r\n                    >\r\n                        <Plus size={18}/> Add Partner\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Partners List */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                {partners.length === 0 ? (\r\n                    <div className=\"col-span-full text-center py-10 text-gray-500 border-2 border-dashed dark:border-gray-700 rounded-xl\">\r\n                        No partners added yet.\r\n                    </div>\r\n                ) : (\r\n                    partners.map(p => (\r\n                        <div key={p.id} className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition group relative\">\r\n                            <div className=\"flex justify-between items-start mb-2\">\r\n                                <h4 className=\"font-bold dark:text-white text-lg truncate pr-8\">{p.name}</h4>\r\n                                <button \r\n                                    onClick={() => handleDelete(p.id, p.name)}\r\n                                    className=\"text-gray-400 hover:text-red-500 absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition\"\r\n                                >\r\n                                    <Trash2 size={16}/>\r\n                                </button>\r\n                            </div>\r\n                            \r\n                            <div className=\"space-y-2 text-sm text-gray-600 dark:text-gray-300\">\r\n                                {p.address && (\r\n                                    <div className=\"flex items-start gap-2\">\r\n                                        <MapPin size={14} className=\"mt-0.5 text-indigo-500 shrink-0\"/>\r\n                                        <span className=\"truncate\">{p.address}</span>\r\n                                    </div>\r\n                                )}\r\n                                {p.contactEmail && (\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <Phone size={14} className=\"text-green-500 shrink-0\"/>\r\n                                        <a href={`mailto:${p.contactEmail}`} className=\"hover:underline truncate\">{p.contactEmail}</a>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"mt-4 pt-3 border-t dark:border-gray-700 flex justify-between items-center\">\r\n                                <span className=\"text-[10px] font-bold uppercase text-green-600 bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded border border-green-200 dark:border-green-800\">\r\n                                    Approved\r\n                                </span>\r\n                                {p.website && (\r\n                                    <a href={p.website} target=\"_blank\" rel=\"noreferrer\" className=\"text-gray-400 hover:text-indigo-500\">\r\n                                        <ExternalLink size={14}/>\r\n                                    </a>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { \r\n    GraduationCap, Search, ChevronRight, Star, User, Plus, History, Save \r\n} from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\nimport { formatHours } from '../../../utils/eduTime';\r\n\r\nexport default function EduEvaluations({ schoolId, logAction, graderName }) {\r\n    const [students, setStudents] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    \r\n    // Selection State\r\n    const [selectedStudent, setSelectedStudent] = useState(null);\r\n    const [studentHistory, setStudentHistory] = useState([]);\r\n    const [loadingHistory, setLoadingHistory] = useState(false);\r\n    \r\n    // Form State\r\n    const [showForm, setShowForm] = useState(false);\r\n    const [gradeForm, setGradeForm] = useState({ \r\n        technical: 5, \r\n        softSkills: 5, \r\n        notes: '' \r\n    });\r\n\r\n    // --- INITIAL DATA ---\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const fetchStudents = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const { data: studentsData, error } = await supabase\r\n                    .from('students')\r\n                    .select('id, display_name, first_name, last_name, email, status')\r\n                    .eq('school_id', schoolId)\r\n                    .order('display_name', { ascending: true });\r\n                \r\n                if (error) throw error;\r\n                \r\n                setStudents((studentsData || []).map(s => ({\r\n                    id: s.id,\r\n                    displayName: s.display_name,\r\n                    firstName: s.first_name,\r\n                    lastName: s.last_name,\r\n                    email: s.email,\r\n                    status: s.status\r\n                })));\r\n            } catch (e) {\r\n                console.error(\"Error loading students:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n        fetchStudents();\r\n    }, [schoolId]);\r\n\r\n    // --- FETCH HISTORY ON SELECTION ---\r\n    useEffect(() => {\r\n        if (!selectedStudent || !supabase || !schoolId) return;\r\n        \r\n        const fetchHistory = async () => {\r\n            setLoadingHistory(true);\r\n            try {\r\n                const { data: evaluationsData, error } = await supabase\r\n                    .from('evaluations')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId)\r\n                    .eq('student_id', selectedStudent.id)\r\n                    .order('date', { ascending: false });\r\n                \r\n                if (error) throw error;\r\n                \r\n                setStudentHistory((evaluationsData || []).map(e => ({\r\n                    id: e.id,\r\n                    ...e,\r\n                    softSkills: e.soft_skills,\r\n                    date: e.date\r\n                })));\r\n            } catch (e) {\r\n                console.error(\"Error loading history:\", e);\r\n            }\r\n            setLoadingHistory(false);\r\n        };\r\n        \r\n        fetchHistory();\r\n        setShowForm(false); // Reset view to history\r\n        setGradeForm({ technical: 5, softSkills: 5, notes: '' }); // Reset form\r\n    }, [selectedStudent, schoolId]);\r\n\r\n    // --- ACTIONS ---\r\n\r\n    const handleSubmitGrade = async () => {\r\n        if (!selectedStudent || !supabase || !schoolId) return;\r\n        \r\n        try {\r\n            const { data: newEvaluation, error } = await supabase\r\n                .from('evaluations')\r\n                .insert({\r\n                    school_id: schoolId,\r\n                    student_id: selectedStudent.id,\r\n                    technical: gradeForm.technical,\r\n                    soft_skills: gradeForm.softSkills,\r\n                    notes: gradeForm.notes || null,\r\n                    evaluator: graderName || 'EDUStaff',\r\n                    date: new Date().toISOString()\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (error) throw error;\r\n\r\n            // Update local history\r\n            setStudentHistory(prev => [{\r\n                id: newEvaluation.id,\r\n                ...newEvaluation,\r\n                softSkills: newEvaluation.soft_skills,\r\n                date: newEvaluation.date\r\n            }, ...prev]);\r\n            \r\n            if (logAction) await logAction('Grade Student', `Graded ${selectedStudent.displayName}: Tech(${gradeForm.technical}) Soft(${gradeForm.softSkills})`);\r\n            \r\n            setShowForm(false);\r\n            alert(\"Evaluation submitted successfully.\");\r\n        } catch (e) {\r\n            console.error(\"Grading failed:\", e);\r\n            alert(\"Failed to save evaluation.\");\r\n        }\r\n    };\r\n\r\n    // --- HELPERS ---\r\n    const filteredStudents = students.filter(s => \r\n        s.displayName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        s.studentId?.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    const getScoreColor = (score) => {\r\n        if (score >= 8) return 'text-green-500';\r\n        if (score >= 5) return 'text-yellow-500';\r\n        return 'text-red-500';\r\n    };\r\n\r\n    if (loading) return <div className=\"p-10 text-center text-gray-500\">Loading Roster...</div>;\r\n\r\n    return (\r\n        <div className=\"flex flex-col md:flex-row h-[600px] border dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-[#2c2e36] animate-in fade-in shadow-sm\">\r\n            \r\n            {/* LEFT: STUDENT LIST */}\r\n            <div className=\"w-full md:w-1/3 border-r dark:border-gray-700 flex flex-col bg-gray-50 dark:bg-[#23262f]\">\r\n                <div className=\"p-4 border-b dark:border-gray-700\">\r\n                    <div className=\"relative\">\r\n                        <Search className=\"absolute left-3 top-2.5 text-gray-400\" size={16}/>\r\n                        <input \r\n                            className=\"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\"\r\n                            placeholder=\"Search Students...\"\r\n                            value={searchTerm}\r\n                            onChange={e => setSearchTerm(e.target.value)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex-1 overflow-y-auto\">\r\n                    {filteredStudents.map(s => (\r\n                        <div \r\n                            key={s.id} \r\n                            onClick={() => setSelectedStudent(s)} \r\n                            className={`p-3 px-4 cursor-pointer flex justify-between items-center transition border-b dark:border-gray-700/50 last:border-0\r\n                                ${selectedStudent?.id === s.id ? 'bg-white dark:bg-[#2c2e36] border-l-4 border-l-indigo-600 shadow-sm' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}\r\n                            `}\r\n                        >\r\n                            <div>\r\n                                <div className={`font-bold text-sm ${selectedStudent?.id === s.id ? 'text-indigo-700 dark:text-white' : 'dark:text-gray-300'}`}>\r\n                                    {s.displayName}\r\n                                </div>\r\n                                <div className=\"text-xs text-gray-500\">{s.cohort || 'General'}  {s.hoursLogged || 0} hrs</div>\r\n                            </div>\r\n                            {selectedStudent?.id === s.id && <ChevronRight size={16} className=\"text-indigo-500\"/>}\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* RIGHT: GRADING PANEL */}\r\n            <div className=\"flex-1 flex flex-col relative\">\r\n                {!selectedStudent ? (\r\n                    <div className=\"flex-1 flex flex-col items-center justify-center text-gray-400\">\r\n                        <GraduationCap size={48} className=\"mb-4 opacity-20\"/>\r\n                        <p>Select a student to view history or submit grades.</p>\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header */}\r\n                        <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36]\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-700 dark:text-indigo-300 font-bold\">\r\n                                    {selectedStudent.displayName[0]}\r\n                                </div>\r\n                                <div>\r\n                                    <h2 className=\"font-bold dark:text-white\">{selectedStudent.displayName}</h2>\r\n                                    <p className=\"text-xs text-gray-500\">ID: {selectedStudent.studentId || 'N/A'}</p>\r\n                                </div>\r\n                            </div>\r\n                            {!showForm ? (\r\n                                <button \r\n                                    onClick={() => setShowForm(true)} \r\n                                    className=\"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 flex items-center gap-2\"\r\n                                >\r\n                                    <Plus size={16}/> New Evaluation\r\n                                </button>\r\n                            ) : (\r\n                                <button \r\n                                    onClick={() => setShowForm(false)} \r\n                                    className=\"text-gray-500 hover:text-gray-700 dark:hover:text-white flex items-center gap-2 text-sm font-bold\"\r\n                                >\r\n                                    <History size={16}/> View History\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Content */}\r\n                        <div className=\"flex-1 overflow-y-auto p-6 bg-white dark:bg-[#2c2e36]\">\r\n                            \r\n                            {/* MODE 1: NEW EVALUATION FORM */}\r\n                            {showForm && (\r\n                                <div className=\"max-w-lg mx-auto space-y-6 animate-in slide-in-from-bottom-4\">\r\n                                    <div className=\"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-lg border border-indigo-100 dark:border-indigo-800/50 mb-6\">\r\n                                        <h4 className=\"font-bold text-indigo-800 dark:text-indigo-300 mb-1\">New Assessment</h4>\r\n                                        <p className=\"text-xs text-indigo-600 dark:text-indigo-400\">\r\n                                            Rating performance for {new Date().toLocaleDateString()}.\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-6\">\r\n                                        <div>\r\n                                            <div className=\"flex justify-between mb-2\">\r\n                                                <label className=\"font-bold text-sm dark:text-gray-300\">Technical Proficiency</label>\r\n                                                <span className={`font-bold ${getScoreColor(gradeForm.technical)}`}>{gradeForm.technical}/10</span>\r\n                                            </div>\r\n                                            <input \r\n                                                type=\"range\" min=\"1\" max=\"10\" step=\"1\" \r\n                                                className=\"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer\"\r\n                                                value={gradeForm.technical}\r\n                                                onChange={e => setGradeForm({...gradeForm, technical: parseInt(e.target.value)})}\r\n                                            />\r\n                                            <p className=\"text-xs text-gray-400 mt-1\">Knowledge of equipment, software, and signal flow.</p>\r\n                                        </div>\r\n\r\n                                        <div>\r\n                                            <div className=\"flex justify-between mb-2\">\r\n                                                <label className=\"font-bold text-sm dark:text-gray-300\">Soft Skills / Professionalism</label>\r\n                                                <span className={`font-bold ${getScoreColor(gradeForm.softSkills)}`}>{gradeForm.softSkills}/10</span>\r\n                                            </div>\r\n                                            <input \r\n                                                type=\"range\" min=\"1\" max=\"10\" step=\"1\" \r\n                                                className=\"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer\"\r\n                                                value={gradeForm.softSkills}\r\n                                                onChange={e => setGradeForm({...gradeForm, softSkills: parseInt(e.target.value)})}\r\n                                            />\r\n                                            <p className=\"text-xs text-gray-400 mt-1\">Punctuality, attitude, communication, and client handling.</p>\r\n                                        </div>\r\n\r\n                                        <div>\r\n                                            <label className=\"font-bold text-sm dark:text-gray-300 block mb-2\">Instructor Notes</label>\r\n                                            <textarea \r\n                                                className=\"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]\"\r\n                                                placeholder=\"Detailed feedback...\"\r\n                                                value={gradeForm.notes}\r\n                                                onChange={e => setGradeForm({...gradeForm, notes: e.target.value})}\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <button \r\n                                            onClick={handleSubmitGrade}\r\n                                            className=\"w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition flex items-center justify-center gap-2 shadow-lg\"\r\n                                        >\r\n                                            <Save size={18}/> Submit Evaluation\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* MODE 2: HISTORY LIST */}\r\n                            {!showForm && (\r\n                                <div className=\"space-y-4\">\r\n                                    {loadingHistory ? (\r\n                                        <p className=\"text-center text-gray-500\">Loading history...</p>\r\n                                    ) : studentHistory.length === 0 ? (\r\n                                        <div className=\"text-center py-10 border-2 border-dashed dark:border-gray-700 rounded-xl\">\r\n                                            <GraduationCap size={32} className=\"mx-auto text-gray-300 mb-2\"/>\r\n                                            <p className=\"text-gray-500\">No evaluations recorded yet.</p>\r\n                                            <button onClick={() => setShowForm(true)} className=\"text-indigo-500 font-bold text-sm mt-2 hover:underline\">Start first evaluation</button>\r\n                                        </div>\r\n                                    ) : (\r\n                                        studentHistory.map(evalItem => (\r\n                                            <div key={evalItem.id} className=\"border dark:border-gray-700 rounded-xl p-4 hover:shadow-md transition bg-gray-50 dark:bg-[#23262f]\">\r\n                                                <div className=\"flex justify-between items-start mb-3\">\r\n                                                    <div>\r\n                                                        <div className=\"text-xs text-gray-500 uppercase font-bold tracking-wider mb-1\">\r\n                                                            {evalItem.date?.toDate ? evalItem.date.toDate().toLocaleDateString() : 'Unknown Date'}\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <User size={14} className=\"text-gray-400\"/>\r\n                                                            <span className=\"text-sm font-medium dark:text-gray-200\">{evalItem.evaluator}</span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className=\"flex gap-2\">\r\n                                                        <div className=\"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600\">\r\n                                                            <div className={`font-bold ${getScoreColor(evalItem.technical)}`}>{evalItem.technical}</div>\r\n                                                            <div className=\"text-[9px] text-gray-400 uppercase\">Tech</div>\r\n                                                        </div>\r\n                                                        <div className=\"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600\">\r\n                                                            <div className={`font-bold ${getScoreColor(evalItem.softSkills)}`}>{evalItem.softSkills}</div>\r\n                                                            <div className=\"text-[9px] text-gray-400 uppercase\">Soft</div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                                {evalItem.notes && (\r\n                                                    <div className=\"text-sm text-gray-600 dark:text-gray-300 border-t dark:border-gray-700 pt-3 mt-2\">\r\n                                                        \"{evalItem.notes}\"\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Users, Upload, Archive, AlertTriangle, FileText } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\n\r\nexport default function EduCohorts({ schoolId, logAction }) {\r\n    const [csvInput, setCsvInput] = useState('');\r\n    const [processing, setProcessing] = useState(false);\r\n\r\n    const handleBatchImport = async () => {\r\n        if (!csvInput.trim() || !supabase || !schoolId) {\r\n            if (!csvInput.trim()) alert(\"Please paste CSV data first.\");\r\n            return;\r\n        }\r\n        \r\n        setProcessing(true);\r\n        const lines = csvInput.trim().split('\\n');\r\n        let count = 0;\r\n        let errors = 0;\r\n\r\n        try {\r\n            const studentsToInsert = [];\r\n            \r\n            for (let line of lines) {\r\n                // Expected format: email, firstName, lastName, cohort\r\n                const parts = line.split(',');\r\n                if (parts.length >= 3) {\r\n                    const email = parts[0].trim();\r\n                    const firstName = parts[1].trim();\r\n                    const lastName = parts[2].trim();\r\n                    const cohort = parts[3]?.trim() || 'General';\r\n                    const displayName = `${firstName} ${lastName}`;\r\n\r\n                    if (email && firstName) {\r\n                        studentsToInsert.push({\r\n                            school_id: schoolId,\r\n                            email,\r\n                            display_name: displayName,\r\n                            first_name: firstName,\r\n                            last_name: lastName,\r\n                            cohort,\r\n                            student_id: null, // Can be updated later\r\n                            status: 'Enrolled',\r\n                            hours_logged: 0,\r\n                            created_at: new Date().toISOString()\r\n                        });\r\n                        count++;\r\n                    } else {\r\n                        errors++;\r\n                    }\r\n                } else {\r\n                    errors++;\r\n                }\r\n            }\r\n            \r\n            if (studentsToInsert.length > 0) {\r\n                const { error } = await supabase\r\n                    .from('students')\r\n                    .insert(studentsToInsert);\r\n                \r\n                if (error) throw error;\r\n            }\r\n            \r\n            if (logAction) await logAction('Batch Import', `Imported ${count} students. (${errors} skipped)`);\r\n            alert(`Import complete! Added ${count} students.`);\r\n            setCsvInput('');\r\n        } catch (e) {\r\n            console.error(\"Import failed:\", e);\r\n            alert(\"Batch import encountered an error.\");\r\n        }\r\n        setProcessing(false);\r\n    };\r\n\r\n    const handleRollover = async () => {\r\n        // Safety check for destructive action\r\n        const confirmation = prompt(\"Type 'ROLLOVER' to confirm. This will archive current internship logs for all students.\");\r\n        if (confirmation !== 'ROLLOVER') return;\r\n\r\n        // In a real app, this would trigger a Cloud Function to move data to 'archived_logs' collection\r\n        alert(\"Rollover process initiated. (This is a placeholder for the Cloud Function trigger).\");\r\n        await logAction('Term Rollover', 'Initiated term archival');\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            \r\n            {/* Batch Import Section */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Upload size={18} className=\"text-indigo-600\"/> Batch Import Students\r\n                </h3>\r\n                \r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-4 border border-blue-100 dark:border-blue-800 text-xs text-blue-800 dark:text-blue-300\">\r\n                    <strong>Format:</strong> <code>email, first_name, last_name, cohort</code><br/>\r\n                    Example: <code>student@test.edu, John, Doe, Fall 2024</code>\r\n                </div>\r\n\r\n                <textarea \r\n                    className=\"w-full h-40 p-3 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono resize-y focus:ring-2 focus:ring-indigo-500 outline-none\" \r\n                    placeholder=\"Paste CSV data here...\"\r\n                    value={csvInput}\r\n                    onChange={e => setCsvInput(e.target.value)}\r\n                    disabled={processing}\r\n                />\r\n                \r\n                <div className=\"mt-3 flex justify-end\">\r\n                    <button \r\n                        onClick={handleBatchImport} \r\n                        disabled={processing || !csvInput}\r\n                        className=\"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition\"\r\n                    >\r\n                        {processing ? 'Processing...' : <><FileText size={16}/> Import Students</>}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Term Management Section */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Archive size={18} className=\"text-orange-500\"/> Term Management\r\n                </h3>\r\n                \r\n                <div className=\"flex flex-col md:flex-row gap-6 items-start\">\r\n                    <div className=\"flex-1\">\r\n                        <h4 className=\"font-bold text-sm dark:text-gray-200 mb-1\">End of Term Rollover</h4>\r\n                        <p className=\"text-xs text-gray-500 leading-relaxed\">\r\n                            Use this tool at the end of a semester or cohort period. It will:\r\n                        </p>\r\n                        <ul className=\"list-disc list-inside text-xs text-gray-500 mt-2 space-y-1 ml-1\">\r\n                            <li>Archive all active internship logs.</li>\r\n                            <li>Reset \"Current Hours\" counters (preserving Total Lifetime Hours).</li>\r\n                            <li>Mark graduating students as \"Alumni\" (optional).</li>\r\n                        </ul>\r\n                    </div>\r\n                    \r\n                    <div className=\"w-full md:w-auto\">\r\n                        <button \r\n                            onClick={handleRollover} \r\n                            className=\"w-full md:w-auto bg-red-50 hover:bg-red-100 dark:bg-red-900/20 dark:hover:bg-red-900/40 text-red-600 dark:text-red-400 px-4 py-3 rounded-lg font-bold text-xs flex items-center justify-center gap-2 border border-red-200 dark:border-red-800 transition\"\r\n                        >\r\n                            <AlertTriangle size={16}/> Execute Rollover\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Activity, Shield, FileText, Clock } from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\nimport { exportToCSV } from '../../../utils/dataExport';\r\n\r\nexport default function EduAudit({ schoolId }) {\r\n    const [logs, setLogs] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [logLimit, setLogLimit] = useState(50);\r\n\r\n    // --- DATA FETCHING ---\r\n    useEffect(() => {\r\n        if (!schoolId || !supabase) return;\r\n        \r\n        const fetchLogs = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const { data: logsData, error } = await supabase\r\n                    .from('audit_logs')\r\n                    .select('*')\r\n                    .eq('school_id', schoolId)\r\n                    .order('timestamp', { ascending: false })\r\n                    .limit(logLimit);\r\n                \r\n                if (error) throw error;\r\n                \r\n                setLogs((logsData || []).map(log => ({\r\n                    id: log.id,\r\n                    ...log,\r\n                    adminName: log.admin_name,\r\n                    timestamp: log.timestamp ? new Date(log.timestamp) : null\r\n                })));\r\n            } catch (e) {\r\n                console.error(\"Error loading audit logs:\", e);\r\n            }\r\n            setLoading(false);\r\n        };\r\n        fetchLogs();\r\n    }, [schoolId, logLimit]);\r\n\r\n    // --- RENDER HELPERS ---\r\n    const getActionColor = (action) => {\r\n        if (action.includes('Delete') || action.includes('Remove')) return 'text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400';\r\n        if (action.includes('Create') || action.includes('Add')) return 'text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400';\r\n        if (action.includes('Update') || action.includes('Edit')) return 'text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400';\r\n        return 'text-gray-600 bg-gray-100 dark:bg-gray-700 dark:text-gray-300';\r\n    };\r\n\r\n    if (loading && logs.length === 0) return <div className=\"p-10 text-center text-gray-500\">Loading Audit Trail...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-4 animate-in fade-in\">\r\n            {/* Header Actions */}\r\n            <div className=\"flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700\">\r\n                <div className=\"flex items-center gap-2 text-sm text-gray-500\">\r\n                    <Activity size={16}/>\r\n                    <span>Showing last <strong>{logs.length}</strong> actions</span>\r\n                </div>\r\n                <button \r\n                    onClick={() => exportToCSV(logs, 'audit_logs')} \r\n                    className=\"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700\"\r\n                >\r\n                    <FileText size={14}/> Export Log\r\n                </button>\r\n            </div>\r\n\r\n            {/* Logs Table */}\r\n            <div className=\"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <table className=\"w-full text-sm text-left\">\r\n                    <thead className=\"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs\">\r\n                        <tr>\r\n                            <th className=\"p-3\">Timestamp</th>\r\n                            <th className=\"p-3\">Admin / Staff</th>\r\n                            <th className=\"p-3\">Action Type</th>\r\n                            <th className=\"p-3\">Details</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y dark:divide-gray-700\">\r\n                        {logs.length === 0 ? (\r\n                            <tr><td colSpan=\"4\" className=\"p-8 text-center text-gray-500\">No audit history found.</td></tr>\r\n                        ) : (\r\n                            logs.map(log => (\r\n                                <tr key={log.id} className=\"hover:bg-gray-50 dark:hover:bg-white/5 transition\">\r\n                                    <td className=\"p-3 text-gray-500 whitespace-nowrap flex items-center gap-2\">\r\n                                        <Clock size={14} className=\"opacity-50\"/>\r\n                                        {log.timestamp?.toDate ? log.timestamp.toDate().toLocaleString() : 'N/A'}\r\n                                    </td>\r\n                                    <td className=\"p-3 font-bold dark:text-white\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <Shield size={14} className=\"text-indigo-500\"/>\r\n                                            {log.adminName || 'System'}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"p-3\">\r\n                                        <span className={`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider ${getActionColor(log.action)}`}>\r\n                                            {log.action}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"p-3 text-gray-600 dark:text-gray-300 font-mono text-xs\">\r\n                                        {log.details}\r\n                                    </td>\r\n                                </tr>\r\n                            ))\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Load More */}\r\n            {logs.length >= logLimit && (\r\n                <div className=\"text-center pt-2\">\r\n                    <button \r\n                        onClick={() => setLogLimit(prev => prev + 50)} \r\n                        className=\"text-xs font-bold text-indigo-600 hover:underline\"\r\n                    >\r\n                        Load Older Logs\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { \r\n    School, Camera, Save, Globe, Mail, GraduationCap, \r\n    Settings, ToggleLeft, ToggleRight, MapPin \r\n} from 'lucide-react';\r\nimport { supabase } from '../../../config/supabase';\r\nimport { useImageUpload } from '../../../hooks/useImageUpload';\r\n\r\nexport default function EduSettings({ schoolId, initialData, logAction, refreshMeta }) {\r\n    const [formData, setFormData] = useState(initialData || {});\r\n    const { uploadImage, uploading } = useImageUpload();\r\n\r\n    // Sync state if initialData loads late\r\n    useEffect(() => {\r\n        if (initialData) setFormData(initialData);\r\n    }, [initialData]);\r\n\r\n    // --- ACTIONS ---\r\n\r\n    const handleUpdate = async () => {\r\n        if (!supabase || !schoolId) return;\r\n        \r\n        try {\r\n            const updateData = {\r\n                name: formData.name,\r\n                primary_color: formData.primaryColor,\r\n                website: formData.website || null,\r\n                contact_email: formData.contactEmail || null,\r\n                address: formData.address || null,\r\n                description: formData.description || null,\r\n                enabled_features: formData.enabledFeatures || {},\r\n                updated_at: new Date().toISOString()\r\n            };\r\n            \r\n            const { error } = await supabase\r\n                .from('schools')\r\n                .update(updateData)\r\n                .eq('id', schoolId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            alert(\"School settings updated successfully.\");\r\n            if (refreshMeta) refreshMeta(formData); // Update parent state immediately\r\n            if (logAction) await logAction('Update Settings', 'Updated school configuration');\r\n        } catch (e) {\r\n            console.error(\"Update failed:\", e);\r\n            alert(\"Failed to update school settings.\");\r\n        }\r\n    };\r\n\r\n    const handleLogoUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file || !schoolId || !supabase) return;\r\n\r\n        try {\r\n            const url = await uploadImage(file, `schools/${schoolId}/images/logo`);\r\n            if (url) {\r\n                await supabase\r\n                    .from('schools')\r\n                    .update({ logo_url: url, updated_at: new Date().toISOString() })\r\n                    .eq('id', schoolId);\r\n                \r\n                setFormData(prev => ({ ...prev, logoURL: url, logo_url: url }));\r\n                if (refreshMeta) refreshMeta({ ...formData, logoURL: url });\r\n                if (logAction) await logAction('Update Logo', 'Uploaded new school logo');\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Logo upload failed\", err);\r\n            alert(\"Failed to upload logo.\");\r\n        }\r\n    };\r\n\r\n    const toggleSetting = (key) => {\r\n        setFormData(prev => ({ ...prev, [key]: !prev[key] }));\r\n    };\r\n\r\n    if (!formData.name && !initialData) return <div className=\"p-10 text-center text-gray-500\">Loading Settings...</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-in fade-in\">\r\n            {/* School Identity Section */}\r\n            <section className=\"flex flex-col md:flex-row gap-6 items-start\">\r\n                <div className=\"relative group\">\r\n                    <div className=\"h-32 w-32 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300 dark:border-gray-600\">\r\n                        {formData.logoURL ? (\r\n                            <img src={formData.logoURL} className=\"h-full w-full object-contain\" alt=\"Logo\" />\r\n                        ) : (\r\n                            <School size={40} className=\"text-gray-400\"/>\r\n                        )}\r\n                        {uploading && <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center text-white text-xs\">Uploading...</div>}\r\n                    </div>\r\n                    <label className=\"absolute bottom-2 right-2 bg-indigo-600 p-2 rounded-full text-white cursor-pointer shadow-lg hover:bg-indigo-700 transition\">\r\n                        <Camera size={14}/>\r\n                        <input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleLogoUpload} disabled={uploading}/>\r\n                    </label>\r\n                </div>\r\n                \r\n                <div className=\"flex-1 w-full grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">School Name</label>\r\n                        <input \r\n                            className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                            value={formData.name || ''} \r\n                            onChange={e => setFormData({...formData, name: e.target.value})} \r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Primary Color</label>\r\n                        <div className=\"flex gap-2\">\r\n                            <input \r\n                                type=\"color\" \r\n                                className=\"h-10 w-10 p-0 border-0 rounded cursor-pointer\" \r\n                                value={formData.primaryColor || '#4f46e5'} \r\n                                onChange={e => setFormData({...formData, primaryColor: e.target.value})} \r\n                            />\r\n                            <input \r\n                                className=\"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono\" \r\n                                value={formData.primaryColor || ''} \r\n                                onChange={e => setFormData({...formData, primaryColor: e.target.value})} \r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"md:col-span-2\">\r\n                        <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Address</label>\r\n                        <div className=\"relative\">\r\n                            <MapPin size={16} className=\"absolute left-3 top-3 text-gray-400\"/>\r\n                            <input \r\n                                className=\"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                                value={formData.address || ''} \r\n                                onChange={e => setFormData({...formData, address: e.target.value})} \r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* Extended Details */}\r\n            <section className=\"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t dark:border-gray-700\">\r\n                <div>\r\n                    <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Website</label>\r\n                    <div className=\"relative\">\r\n                        <Globe size={16} className=\"absolute left-3 top-3 text-gray-400\"/>\r\n                        <input \r\n                            className=\"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                            value={formData.website || ''} \r\n                            onChange={e => setFormData({...formData, website: e.target.value})} \r\n                            placeholder=\"https://\" \r\n                        />\r\n                    </div>\r\n                </div>\r\n                <div>\r\n                    <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Contact Email</label>\r\n                    <div className=\"relative\">\r\n                        <Mail size={16} className=\"absolute left-3 top-3 text-gray-400\"/>\r\n                        <input \r\n                            className=\"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                            value={formData.contactEmail || ''} \r\n                            onChange={e => setFormData({...formData, contactEmail: e.target.value})} \r\n                            placeholder=\"admin@school.edu\" \r\n                        />\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* Academic Config */}\r\n            <section>\r\n                <h3 className=\"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2\">\r\n                    <GraduationCap size={18} className=\"text-indigo-600\"/> Academic Structure\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Cohort Mode</label>\r\n                        <select \r\n                            className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                            value={formData.cohortMode || 'Semester'} \r\n                            onChange={e => setFormData({...formData, cohortMode: e.target.value})}\r\n                        >\r\n                            <option value=\"Semester\">Semester Based</option>\r\n                            <option value=\"Trimester\">Trimester</option>\r\n                            <option value=\"Monthly\">Monthly</option>\r\n                            <option value=\"Rolling\">Rolling</option>\r\n                        </select>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Grading Scale</label>\r\n                        <select \r\n                            className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                            value={formData.gradingScale || '1-10'} \r\n                            onChange={e => setFormData({...formData, gradingScale: e.target.value})}\r\n                        >\r\n                            <option value=\"1-10\">Numeric (1-10)</option>\r\n                            <option value=\"Pass/Fail\">Pass/Fail</option>\r\n                            <option value=\"Letter\">Letter Grades</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* Operational Toggles */}\r\n            <section>\r\n                <h3 className=\"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2\">\r\n                    <Settings size={18} className=\"text-indigo-600\"/> Operational Rules\r\n                </h3>\r\n                <div className=\"space-y-3\">\r\n                    <div className=\"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800\">\r\n                        <div>\r\n                            <div className=\"font-bold text-sm dark:text-white\">Strict Geofencing</div>\r\n                            <div className=\"text-xs text-gray-500\">Require GPS location match for clock-in</div>\r\n                        </div>\r\n                        <button onClick={() => toggleSetting('geofencing')}>\r\n                            {formData.geofencing ? <ToggleRight size={24} className=\"text-indigo-600\"/> : <ToggleLeft size={24} className=\"text-gray-400\"/>}\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800\">\r\n                        <div>\r\n                            <div className=\"font-bold text-sm dark:text-white\">Supervisor Approval</div>\r\n                            <div className=\"text-xs text-gray-500\">Require partner studio sign-off on hours</div>\r\n                        </div>\r\n                        <button onClick={() => toggleSetting('requireApproval')}>\r\n                            {formData.requireApproval ? <ToggleRight size={24} className=\"text-indigo-600\"/> : <ToggleLeft size={24} className=\"text-gray-400\"/>}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            <div className=\"pt-4 border-t dark:border-gray-700\">\r\n                <button \r\n                    onClick={handleUpdate} \r\n                    className=\"w-full sm:w-auto bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2 shadow-lg\"\r\n                >\r\n                    <Save size={18}/> Save Configuration\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { \r\n    Shield, Plus, MapPin, School, Activity, Users, Briefcase, Clock \r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport { useSchool } from '../../contexts/SchoolContext';\r\nimport { exportToCSV } from '../../utils/dataExport';\r\nimport { SCHOOL_PERMISSIONS } from '../../config/constants';\r\nimport { useEduAuth } from '../../contexts/EduAuthContext';\r\nimport { isGlobalAdmin } from '../../utils/eduPermissions';\r\n\r\n// --- MODULE IMPORTS ---\r\nimport EduOverview from './modules/EduOverview';\r\nimport EduRoster from './modules/EduRoster';\r\nimport EduHours from './modules/EduHours';\r\nimport EduCourses from './modules/EduCourses';\r\nimport EduLearningPaths from './modules/EduLearningPaths';\r\nimport EduStaff from './modules/EduStaff';\r\nimport EduRoles from './modules/EduRoles';\r\nimport EduResources from './modules/EduResources';\r\nimport EduAnnouncements from './modules/EduAnnouncements';\r\nimport EduPartners from './modules/EduPartners';\r\nimport EduEvaluations from './modules/EduEvaluations';\r\nimport EduCohorts from './modules/EduCohorts';\r\nimport EduAudit from './modules/EduAudit';\r\nimport EduSettings from './modules/EduSettings';\r\n\r\nexport default function EduAdminDashboard({ user: propUser, userData: propUserData, allowedTabs, staffTitle, currentView }) {\r\n    // Use EduAuth hook if available, otherwise fall back to props (backward compatibility)\r\n    let eduAuth;\r\n    try {\r\n        eduAuth = useEduAuth();\r\n    } catch (e) {\r\n        // Not wrapped in EduAuthProvider, use props\r\n        eduAuth = null;\r\n    }\r\n    \r\n    const user = eduAuth?.user || propUser;\r\n    const userData = eduAuth?.userData || propUserData;\r\n    \r\n    const { schoolId: contextSchoolId } = useSchool();\r\n    \r\n    // Parse the view from the ID (e.g., 'edu-roster' -> 'roster'), default to 'overview'\r\n    const activeTab = currentView ? currentView.replace('edu-', '') : (allowedTabs ? allowedTabs[0] : 'overview');\r\n\r\n    const [activeSchoolId, setActiveSchoolId] = useState(contextSchoolId || null);\r\n    const [activeSchoolData, setActiveSchoolData] = useState(null);\r\n    const [allSchools, setAllSchools] = useState([]); \r\n    \r\n    // School Creation State (Global Admin Only)\r\n    const [showCreateModal, setShowCreateModal] = useState(false);\r\n    const [newSchoolForm, setNewSchoolForm] = useState({ name: '', address: '', primaryColor: '#4f46e5' });\r\n\r\n    const isGlobalAdminUser = isGlobalAdmin(userData);\r\n\r\n    // --- 1. FETCH SCHOOLS (Global Admin) ---\r\n    useEffect(() => {\r\n        if (isGlobalAdminUser && supabase) {\r\n            const fetchSchools = async () => {\r\n                try {\r\n                    const { data: schools, error } = await supabase\r\n                        .from('schools')\r\n                        .select('*')\r\n                        .order('name');\r\n                    \r\n                    if (error) throw error;\r\n                    \r\n                    const schoolsList = schools || [];\r\n                    setAllSchools(schoolsList);\r\n                    \r\n                    // Default to first school if none selected\r\n                    if (!activeSchoolId && !contextSchoolId && schoolsList.length > 0) {\r\n                        setActiveSchoolId(schoolsList[0].id);\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Error fetching schools list:\", e);\r\n                }\r\n            };\r\n            fetchSchools();\r\n        }\r\n    }, [isGlobalAdminUser, activeSchoolId, contextSchoolId]);\r\n\r\n    // --- 2. FETCH ACTIVE SCHOOL DATA ---\r\n    useEffect(() => {\r\n        if (!activeSchoolId || !supabase) return;\r\n\r\n        const loadSchoolMeta = async () => {\r\n            try {\r\n                const { data: school, error } = await supabase\r\n                    .from('schools')\r\n                    .select('*')\r\n                    .eq('id', activeSchoolId)\r\n                    .single();\r\n                \r\n                if (error) throw error;\r\n                \r\n                if (school) {\r\n                    setActiveSchoolData(school);\r\n                }\r\n            } catch (e) { \r\n                console.error(\"Error loading school meta:\", e); \r\n            }\r\n        };\r\n        loadSchoolMeta();\r\n    }, [activeSchoolId]);\r\n\r\n    // --- HELPER: CENTRALIZED AUDIT LOGGER ---\r\n    const logAction = async (action, details) => {\r\n        if (!activeSchoolId || !supabase) return;\r\n        try {\r\n            const userId = user?.id || user?.uid;\r\n            await supabase\r\n                .from('audit_logs')\r\n                .insert({\r\n                    school_id: activeSchoolId,\r\n                    action,\r\n                    details,\r\n                    admin_id: userId,\r\n                    admin_name: `${userData?.firstName || ''} ${userData?.lastName || ''}`.trim(),\r\n                    created_at: new Date().toISOString()\r\n                });\r\n        } catch (e) {\r\n            console.error(\"Failed to log action:\", e);\r\n        }\r\n    };\r\n\r\n    // --- ACTION: CREATE NEW SCHOOL ---\r\n    const handleCreateSchool = async () => {\r\n        if (!newSchoolForm.name || !supabase) return;\r\n        \r\n        // Double-check permissions before attempting to create\r\n        if (!isGlobalAdminUser) {\r\n            alert(\"Only SeshNx Platform Administrators can create new schools. Please contact a platform administrator.\");\r\n            setShowCreateModal(false);\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            const { data: newSchool, error: schoolError } = await supabase\r\n                .from('schools')\r\n                .insert({ \r\n                    name: newSchoolForm.name,\r\n                    address: newSchoolForm.address || null,\r\n                    primary_color: newSchoolForm.primaryColor || '#4f46e5',\r\n                    required_hours: 100,\r\n                    created_at: new Date().toISOString()\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (schoolError) throw schoolError;\r\n            \r\n            if (!newSchool) {\r\n                throw new Error('School creation failed - no data returned');\r\n            }\r\n            \r\n            // Create Default Admin Role for new school\r\n            const { error: roleError } = await supabase\r\n                .from('school_roles')\r\n                .insert({ \r\n                    school_id: newSchool.id,\r\n                    name: 'Admin', \r\n                    color: '#dc2626', \r\n                    permissions: SCHOOL_PERMISSIONS.map(p => p.id) \r\n                });\r\n\r\n            if (roleError) {\r\n                console.error(\"Error creating default admin role:\", roleError);\r\n                // Continue anyway - role can be created later\r\n            }\r\n\r\n            setAllSchools(prev => [...prev, newSchool]);\r\n            setActiveSchoolId(newSchool.id);\r\n            setShowCreateModal(false);\r\n            setNewSchoolForm({ name: '', address: '', primaryColor: '#4f46e5' });\r\n            \r\n            // Log is implied since we switch to the new school immediately\r\n        } catch (e) {\r\n            console.error(\"Error creating school:\", e);\r\n            if (e.message?.includes('permission') || e.code === 'PGRST301') {\r\n                alert(\"Permission denied. Only SeshNx Platform Administrators can create new schools.\");\r\n            } else {\r\n                alert(\"Failed to create school. Please try again.\");\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto space-y-6 pb-20\">\r\n            \r\n            {/* --- SCHOOL IDENTITY HEADER --- */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6 relative overflow-hidden\">\r\n                <div className=\"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2 z-10\">\r\n                    {activeSchoolData?.logoURL ? (\r\n                        <img src={activeSchoolData.logoURL} className=\"h-full w-full object-contain\" alt=\"School Logo\" />\r\n                    ) : (\r\n                        <School size={40} className=\"text-gray-400\"/>\r\n                    )}\r\n                </div>\r\n                \r\n                <div className=\"flex-1 text-center md:text-left z-10\">\r\n                    <h1 className=\"text-3xl font-extrabold dark:text-white tracking-tight flex items-center justify-center md:justify-start gap-3\">\r\n                        {activeSchoolData?.name || 'Select School'}\r\n                        {isGlobalAdminUser && !staffTitle && (\r\n                            <div className=\"relative group\">\r\n                                <select \r\n                                    className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n                                    value={activeSchoolId || ''}\r\n                                    onChange={(e) => setActiveSchoolId(e.target.value)}\r\n                                >\r\n                                    {allSchools.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}\r\n                                </select>\r\n                                <div className=\"bg-gray-100 dark:bg-gray-700 border-none rounded-lg text-sm font-bold p-1 px-2 flex items-center gap-1 pointer-events-none group-hover:bg-gray-200 dark:group-hover:bg-gray-600 transition\">\r\n                                    <span>Switch</span> <Shield size={10}/>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </h1>\r\n                    \r\n                    <div className=\"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400 mt-1\">\r\n                        {staffTitle ? (\r\n                            <span className=\"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide\">\r\n                                {staffTitle} Dashboard\r\n                            </span>\r\n                        ) : (\r\n                            <span className=\"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide\">\r\n                                Global Admin Mode\r\n                            </span>\r\n                        )}\r\n                        {activeSchoolData?.address && (\r\n                            <>\r\n                                <span></span>\r\n                                <span className=\"flex items-center gap-1\"><MapPin size={12}/> {activeSchoolData.address}</span>\r\n                            </>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {isGlobalAdminUser && (\r\n                    <div className=\"z-10\">\r\n                        <button onClick={() => setShowCreateModal(true)} className=\"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 transition shadow-md\">\r\n                            <Plus size={16}/> New School\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Decorative BG */}\r\n                <div className=\"absolute top-0 right-0 w-64 h-64 bg-indigo-600/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none\"></div>\r\n            </div>\r\n\r\n            {/* --- MODULE CONTENT AREA --- */}\r\n            {/* Note: The Sidebar handles navigation, this component acts as the view controller */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 min-h-[400px] p-4\">\r\n                {!activeSchoolId ? (\r\n                    <div className=\"flex flex-col items-center justify-center h-96 text-gray-500\">\r\n                        <School size={48} className=\"mb-4 opacity-20\"/>\r\n                        <p>Please select or create a school to manage.</p>\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {activeTab === 'overview' && <EduOverview schoolId={activeSchoolId} schoolData={activeSchoolData} />}\r\n                        \r\n                        {activeTab === 'roster' && <EduRoster schoolId={activeSchoolId} logAction={logAction} />}\r\n                        \r\n                        {activeTab === 'hours' && <EduHours schoolId={activeSchoolId} />}\r\n                        \r\n                        {activeTab === 'courses' && <EduCourses schoolId={activeSchoolId} logAction={logAction} />}\r\n                        \r\n                        {activeTab === 'learning-paths' && <EduLearningPaths schoolId={activeSchoolId} logAction={logAction} />}\r\n                        \r\n                        {activeTab === 'instructors' && <EduStaff schoolId={activeSchoolId} logAction={logAction} />}\r\n                        \r\n                        {activeTab === 'roles' && <EduRoles schoolId={activeSchoolId} logAction={logAction} />}\r\n                        \r\n                        {activeTab === 'resources' && <EduResources schoolId={activeSchoolId} logAction={logAction} />}\r\n                        \r\n                        {activeTab === 'news' && <EduAnnouncements schoolId={activeSchoolId} logAction={logAction} user={user} userData={userData} />}\r\n                        \r\n                        {activeTab === 'partners' && <EduPartners schoolId={activeSchoolId} logAction={logAction} />}\r\n                        \r\n                        {activeTab === 'evaluations' && <EduEvaluations schoolId={activeSchoolId} logAction={logAction} graderName={userData.displayName} />}\r\n                        \r\n                        {activeTab === 'cohorts' && <EduCohorts schoolId={activeSchoolId} logAction={logAction} />}\r\n                        \r\n                        {activeTab === 'audit' && <EduAudit schoolId={activeSchoolId} />}\r\n                        \r\n                        {activeTab === 'settings' && (\r\n                            <EduSettings \r\n                                schoolId={activeSchoolId} \r\n                                initialData={activeSchoolData} \r\n                                logAction={logAction} \r\n                                refreshMeta={(newData) => setActiveSchoolData(prev => ({...prev, ...newData}))} \r\n                            />\r\n                        )}\r\n                    </>\r\n                )}\r\n            </div>\r\n\r\n            {/* --- GLOBAL MODALS --- */}\r\n            \r\n            {/* Create School Modal */}\r\n            {showCreateModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95\">\r\n                        <h3 className=\"font-bold text-xl dark:text-white\">Create School</h3>\r\n                        <input \r\n                            className=\"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white\" \r\n                            placeholder=\"School Name\" \r\n                            value={newSchoolForm.name} \r\n                            onChange={e => setNewSchoolForm({...newSchoolForm, name: e.target.value})}\r\n                        />\r\n                        <button onClick={handleCreateSchool} className=\"w-full bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700\">Create</button>\r\n                        <button onClick={() => setShowCreateModal(false)} className=\"w-full text-gray-500 text-sm hover:underline\">Cancel</button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React from 'react';\r\nimport { useSchool } from '../../contexts/SchoolContext';\r\nimport EduAdminDashboard from './EduAdminDashboard';\r\nimport { Lock } from 'lucide-react';\r\nimport { useEduAuth } from '../../contexts/EduAuthContext';\r\n\r\nexport default function EduStaffDashboard({ user: propUser, userData: propUserData, currentView }) {\r\n    // Use EduAuth hook if available, otherwise fall back to props (backward compatibility)\r\n    let eduAuth;\r\n    try {\r\n        eduAuth = useEduAuth();\r\n    } catch (e) {\r\n        // Not wrapped in EduAuthProvider, use props\r\n        eduAuth = null;\r\n    }\r\n    \r\n    const user = eduAuth?.user || propUser;\r\n    const userData = eduAuth?.userData || propUserData;\r\n    \r\n    const { myPermissions, staffProfile } = useSchool();\r\n    \r\n    // Map permissions to the Tabs available in EduAdminDashboard\r\n    const PERM_TO_TAB = {\r\n        'manage_roster': 'roster',\r\n        'manage_enrollment': 'cohorts',\r\n        'approve_hours': 'hours',\r\n        'manage_partners': 'partners',\r\n        'grade_students': 'evaluations',\r\n        'post_announcements': 'news',\r\n        'manage_resources': 'resources',\r\n        'manage_staff': 'instructors',\r\n        'view_audit': 'audit',\r\n        'edit_settings': 'settings'\r\n    };\r\n\r\n    // Calculate allowed tabs\r\n    const allowedTabs = myPermissions.includes('ALL') \r\n        ? Object.values(PERM_TO_TAB) \r\n        : myPermissions.map(p => PERM_TO_TAB[p]).filter(Boolean);\r\n\r\n    // If no permissions found\r\n    if (allowedTabs.length === 0 && !myPermissions.includes('ALL')) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center h-[50vh] text-gray-500\">\r\n                <Lock size={48} className=\"mb-4 text-gray-300\"/>\r\n                <h3 className=\"text-lg font-bold\">Access Restricted</h3>\r\n                <p>You are listed as staff but have no assigned permissions.</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <EduAdminDashboard \r\n            user={user} \r\n            userData={userData} \r\n            allowedTabs={allowedTabs} \r\n            staffTitle={staffProfile?.roleName}\r\n            currentView={currentView}\r\n        />\r\n    );\r\n}\r\n"],"names":["fetchZipLocation","zip","response","place","error","reverseGeocode","lat","lng","address","city","state","searchAddress","query","options","countryCode","limit","addressDetails","params","formatShortAddress","getStateCode","formatFullAddress","addr","parts","cityStateZip","stateName","stateMap","defaultContextValue","SchoolContext","createContext","useSchool","useContext","SchoolProvider","children","user","userData","schoolData","setSchoolData","useState","studentProfile","setStudentProfile","staffProfile","setStaffProfile","myPermissions","setMyPermissions","internshipStudio","setInternshipStudio","loading","setLoading","useEffect","supabase","checkIn","location","type","checkOut","description","value","_a","jsx","useImageUpload","uploading","setUploading","setError","file","path","useAddressSearch","debounceMs","results","setResults","debounceTimer","useRef","lastQuery","requestId","search","useCallback","trimmedQuery","currentRequestId","searchResults","err","clearResults","AddressAutocomplete","onSelect","onChange","placeholder","className","label","required","showGeolocation","externalError","searchError","localQuery","setLocalQuery","isOpen","setIsOpen","geoLoading","setGeoLoading","wrapperRef","inputRef","displayValue","handleClickOutside","event","handleInputChange","e","val","handleSelect","item","selectedAddress","displayText","handleUseLocation","position","latitude","longitude","locationData","handleClear","hasError","jsxs","MapPin","X","Loader2","Navigation","isGlobalAdmin","GLOBAL_ADMIN_ROLE","EduAuthContext","useEduAuth","context","EduStudentDashboard","propUser","propUserData","eduAuth","newInterest","setNewInterest","studios","setStudios","loadingStudios","setLoadingStudios","courses","setCourses","enrollments","setEnrollments","learningPaths","setLearningPaths","badges","setBadges","loadingCourses","setLoadingCourses","interests","schoolId","handleAddInterest","trimmed","handleRemoveInterest","interest","fetchAvailableStudios","loadCourses","loadEnrollments","loadLearningPaths","loadBadges","handleEnroll","courseId","enrolledCourseIds","availableCourses","c","myEnrolledCourses","progress","School","BookOpen","course","enrollment","Play","Award","badge","_b","Search","Clock","studio","CheckCircle","formatHours","totalMinutes","hours","minutes","EduInternDashboard","setDescription","milestones","setMilestones","loadMilestones","handleClockAction","AlertCircle","Target","milestone","idx","exportToCSV","data","filename","allKeys","k","headers","csvRows","row","values","header","blob","url","link","EduOverview","stats","setStats","recentActivity","setRecentActivity","StatCard","Users","Briefcase","Activity","log","Globe","EduRoster","logAction","students","setStudents","partners","setPartners","searchTerm","setSearchTerm","showStudentModal","setShowStudentModal","showAssignModal","setShowAssignModal","selectedStudent","setSelectedStudent","isEditing","setIsEditing","studentForm","setStudentForm","assignStudioId","setAssignStudioId","handleOpenAdd","handleOpenEdit","student","handleSaveStudent","handleDeleteStudent","id","name","handleAssignStudio","filteredStudents","s","UserPlus","Link","Edit2","Trash2","p","EduHours","logs","setLogs","filterStatus","setFilterStatus","handleLogAction","logId","status","visibleLogs","l","Filter","Download","StatusBadge","XCircle","styles","labels","EduCourseBuilder","onSave","onCancel","formData","setFormData","lessons","setLessons","newPrerequisite","setNewPrerequisite","editingLesson","setEditingLesson","loadLessons","handleSave","handleAddPrerequisite","prev","handleRemovePrerequisite","prereq","handleAddLesson","newLesson","handleDeleteLesson","lessonId","Plus","lesson","GripVertical","EduCourses","showBuilder","setShowBuilder","editingCourse","setEditingCourse","handleCreateCourse","handleEditCourse","handleDeleteCourse","filteredCourses","EduLearningPaths","paths","setPaths","showForm","setShowForm","editingPath","setEditingPath","setAvailableCourses","loadPaths","handleCreatePath","handleEditPath","handleSavePath","handleDeletePath","pathId","toggleCourse","addBadge","badgeName","removeBadge","b","addSkill","skillName","removeSkill","skill","filteredPaths","GraduationCap","EduStaff","staff","setStaff","roles","setRoles","newStaffEmail","setNewStaffEmail","selectedStaffRole","setSelectedStaffRole","handleAddStaff","Mail","Shield","r","EduRoles","showCreateModal","setShowCreateModal","roleForm","setRoleForm","saving","setSaving","handleCreateRole","handleDeleteRole","roleId","roleName","handleUpdatePermissions","newPermissions","toggleFormPermission","permId","toggleExistingRolePermission","role","currentPerms","SCHOOL_PERMISSIONS","perm","isActive","Check","Key","EduResources","rules","setRules","ruleForm","setRuleForm","handleAddRule","handleDeleteRule","resourceName","Lock","EduAnnouncements","announcements","setAnnouncements","sending","setSending","form","setForm","handlePost","handleDelete","Megaphone","Fragment","Send","post","User","EduPartners","handleAdd","addressData","Phone","ExternalLink","EduEvaluations","graderName","studentHistory","setStudentHistory","loadingHistory","setLoadingHistory","gradeForm","setGradeForm","handleSubmitGrade","getScoreColor","score","ChevronRight","History","Save","evalItem","EduCohorts","csvInput","setCsvInput","processing","setProcessing","handleBatchImport","handleRollover","Upload","FileText","Archive","AlertTriangle","EduAudit","logLimit","setLogLimit","getActionColor","action","EduSettings","initialData","refreshMeta","handleUpdate","handleLogoUpload","toggleSetting","key","Camera","Settings","ToggleRight","ToggleLeft","EduAdminDashboard","allowedTabs","staffTitle","currentView","contextSchoolId","activeTab","activeSchoolId","setActiveSchoolId","activeSchoolData","setActiveSchoolData","allSchools","setAllSchools","newSchoolForm","setNewSchoolForm","isGlobalAdminUser","details","handleCreateSchool","newData","EduStaffDashboard","PERM_TO_TAB"],"mappings":"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"}