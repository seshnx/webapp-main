import{r as m,j as e,a1 as M,X as W,L as se,a2 as Re,a3 as G,a4 as H,v as ae,a5 as V,S as Y,i as J,y as Z,a6 as qe,a7 as Ne,U as Q,Y as ne,a8 as ve,K as ke,a9 as we,J as Pe,aa as de,T as F,ab as $e,D as Ie,ac as De,P as B,ad as Te,ae as K,af as Se,ag as X,n as Ue,ah as Oe,a0 as _e,ai as Me,z as Fe,b as Ce,aj as fe,E as Be,h as Ge,ak as He,al as Ee,am as Ve,F as Le,an as We,ao as Ke,ap as Ye,aq as Je,ar as pe,as as be}from"./vendor-Dl7DtIXW.js";import{s as x,S as re}from"./chat-BYF7Vx2D.js";import{GLOBAL_ADMIN_ROLE as Ze,SCHOOL_PERMISSIONS as ie}from"./config-DGZTEYpI.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="42679f3b-fdae-4a7b-b39c-a6c4ce0f6c25",t._sentryDebugIdIdentifier="sentry-dbid-42679f3b-fdae-4a7b-b39c-a6c4ce0f6c25")})()}catch{}const Qe="modulepreload",Xe=function(t){return"/"+t},ye={},Pt=function(s,o,a){let u=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),y=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));u=Promise.allSettled(o.map(b=>{if(b=Xe(b),b in ye)return;ye[b]=!0;const i=b.endsWith(".css"),r=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${r}`))return;const c=document.createElement("link");if(c.rel=i?"stylesheet":Qe,i||(c.as="script"),c.crossOrigin="",c.href=b,y&&c.setAttribute("nonce",y),document.head.appendChild(c),i)return new Promise((f,j)=>{c.addEventListener("load",f),c.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(l){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=l,window.dispatchEvent(y),!y.defaultPrevented)throw l}return u.then(l=>{for(const y of l||[])y.status==="rejected"&&d(y.reason);return s().catch(d)})},$t=async t=>{if(!t||t.length<5)return null;try{const s=await fetch(`https://api.zippopotam.us/us/${t}`);if(!s.ok)return null;const a=(await s.json()).places[0];return{lat:parseFloat(a.latitude),lng:parseFloat(a.longitude),name:a["place name"],state:a["state abbreviation"],cityState:`${a["place name"]}, ${a["state abbreviation"]}`}}catch(s){return console.warn("Geocoding failed:",s),null}},et=async(t,s)=>{if(!t||!s)return null;try{const o=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${s}`);if(!o.ok)return null;const u=(await o.json()).address,d=u.city||u.town||u.village||u.hamlet||"Unknown Location",l=u.state||"",y=u.postcode||"";return{city:d,state:l,zip:y,displayName:`${d}, ${l} ${y}`.trim()}}catch(o){return console.warn("Reverse geocoding failed:",o),null}},tt=async(t,s={})=>{if(!t||t.trim().length<3)return[];const{countryCode:o="us",limit:a=5,addressDetails:u=!0}=s;try{const d=new URLSearchParams({q:t,format:"json",addressdetails:u?"1":"0",limit:a.toString(),countrycodes:o}),l=await fetch(`https://nominatim.openstreetmap.org/search?${d}`,{headers:{Accept:"application/json"}});return l.ok?(await l.json()).map(b=>{const i=b.address||{};return{id:b.place_id,displayName:b.display_name,shortName:st(b),lat:parseFloat(b.lat),lng:parseFloat(b.lon),type:b.type,category:b.category,address:{houseNumber:i.house_number||"",street:i.road||i.street||"",city:i.city||i.town||i.village||i.hamlet||"",state:i.state||"",stateCode:le(i.state),zip:i.postcode||"",country:i.country||"",countryCode:i.country_code||""},formattedAddress:rt(i)}}):(console.warn("Address search failed:",l.status),[])}catch(d){return console.warn("Address search error:",d),[]}};function st(t){const s=t.address||{},o=[];s.house_number&&s.road?o.push(`${s.house_number} ${s.road}`):s.road&&o.push(s.road);const a=s.city||s.town||s.village||s.hamlet;a&&o.push(a);const u=le(s.state);return u&&o.push(u),o.join(", ")||t.display_name.split(",").slice(0,3).join(",")}function rt(t){const s=[];t.house_number&&t.road?s.push(`${t.house_number} ${t.road}`):t.road&&s.push(t.road);const o=t.city||t.town||t.village||"",a=le(t.state),u=t.postcode||"",d=[o,a].filter(Boolean).join(", ");return d&&s.push(u?`${d} ${u}`:d),s.join(", ")}function le(t){if(!t)return"";const s={alabama:"AL",alaska:"AK",arizona:"AZ",arkansas:"AR",california:"CA",colorado:"CO",connecticut:"CT",delaware:"DE",florida:"FL",georgia:"GA",hawaii:"HI",idaho:"ID",illinois:"IL",indiana:"IN",iowa:"IA",kansas:"KS",kentucky:"KY",louisiana:"LA",maine:"ME",maryland:"MD",massachusetts:"MA",michigan:"MI",minnesota:"MN",mississippi:"MS",missouri:"MO",montana:"MT",nebraska:"NE",nevada:"NV","new hampshire":"NH","new jersey":"NJ","new mexico":"NM","new york":"NY","north carolina":"NC","north dakota":"ND",ohio:"OH",oklahoma:"OK",oregon:"OR",pennsylvania:"PA","rhode island":"RI","south carolina":"SC","south dakota":"SD",tennessee:"TN",texas:"TX",utah:"UT",vermont:"VT",virginia:"VA",washington:"WA","west virginia":"WV",wisconsin:"WI",wyoming:"WY","district of columbia":"DC"};return t.length===2?t.toUpperCase():s[t.toLowerCase()]||t}const at={schoolId:null,schoolData:null,studentProfile:null,staffProfile:null,myPermissions:[],internshipStudio:null,isStudent:!1,isStaff:!1,checkIn:async()=>{},checkOut:async()=>{},loading:!1},Ae=m.createContext(at);function ee(){return m.useContext(Ae)}function It({children:t,user:s,userData:o}){var p;const[a,u]=m.useState(null),[d,l]=m.useState(null),[y,b]=m.useState(null),[i,r]=m.useState([]),[c,f]=m.useState(null),[j,w]=m.useState(!0);m.useEffect(()=>{if(!s||!(o!=null&&o.schoolId)||!x){w(!1);return}const v=o.schoolId,_=s.id||s.uid;x.from("schools").select("*").eq("id",v).single().then(({data:k,error:S})=>{S?console.error("Error fetching school data:",S):k&&u(k)}),(async()=>{var k,S,L,q;try{if((k=o.accountTypes)!=null&&k.includes("Student")||(S=o.accountTypes)!=null&&S.includes("Intern")){const R=x.channel(`student-${_}-${v}`).on("postgres_changes",{event:"*",schema:"public",table:"students",filter:`school_id=eq.${v} AND user_id=eq.${_}`},async n=>{if(n.eventType==="DELETE")l(null);else{const h=n.new||n.old;if(l(h),h!=null&&h.internship_studio_id){const{data:z}=await x.from("school_partners").select("*").eq("school_id",v).eq("id",h.internship_studio_id).single();if(z)f(z);else{const{data:D}=await x.from("studios").select("*").eq("id",h.internship_studio_id).single();D&&f(D)}}}}).subscribe(),{data:P}=await x.from("students").select("*").eq("school_id",v).eq("user_id",_).single();if(P&&(l(P),P.internship_studio_id)){const{data:n}=await x.from("school_partners").select("*").eq("school_id",v).eq("id",P.internship_studio_id).single();if(n)f(n);else{const{data:h}=await x.from("studios").select("*").eq("id",P.internship_studio_id).single();h&&f(h)}}return()=>{x.removeChannel(R)}}if((L=o.accountTypes)!=null&&L.includes("EDUStaff")||(q=o.accountTypes)!=null&&q.includes("EDUAdmin")){const{data:R,error:P}=await x.from("school_staff").select("*").eq("school_id",v).eq("user_id",_).single();if(!P&&R)if(b(R),R.role_id){const{data:n}=await x.from("school_roles").select("*").eq("school_id",v).eq("id",R.role_id).single();n&&r(n.permissions||[])}else o.accountTypes.includes("EDUAdmin")&&r(["ALL"])}}catch(R){console.error("Error setting up school context:",R)}finally{w(!1)}})()},[s,o]);const C=async(v,_="remote")=>{if(!(!d||!o.schoolId||!x))try{const N=s.id||s.uid,{data:k,error:S}=await x.from("internship_logs").insert({school_id:o.schoolId,student_id:N,student_name:o.displayName||o.firstName||"Unknown",check_in:new Date().toISOString(),check_out:null,location:v||"Unknown",type:_,status:"active",description:""}).select().single();if(S)throw S;await x.from("students").update({active_session_id:k.id,is_clocked_in:!0}).eq("school_id",o.schoolId).eq("user_id",N)}catch(N){throw console.error("Check-in failed:",N),N}},E=async v=>{if(!(!(d!=null&&d.active_session_id)||!o.schoolId||!x))try{const _=s.id||s.uid;await x.from("internship_logs").update({check_out:new Date().toISOString(),status:"pending_approval",description:v||"No description"}).eq("id",d.active_session_id),await x.from("students").update({active_session_id:null,is_clocked_in:!1}).eq("school_id",o.schoolId).eq("user_id",_)}catch(_){throw console.error("Check-out failed:",_),_}},g={schoolId:o==null?void 0:o.schoolId,schoolData:a,studentProfile:d,staffProfile:y,myPermissions:i,internshipStudio:c,isStudent:!!d,isStaff:!!y||((p=o==null?void 0:o.accountTypes)==null?void 0:p.includes("EDUAdmin")),checkIn:C,checkOut:E,loading:j};return e.jsx(Ae.Provider,{value:g,children:t})}const je="public",it=()=>{const[t,s]=m.useState(!1),[o,a]=m.useState(null);return{uploadImage:async(d,l)=>{if(!d)return null;if(!x)return a("Supabase is not configured. Please set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your environment variables."),console.error("Supabase Storage is not available."),null;s(!0),a(null);try{const b=`${Date.now()}_${d.name}`,i=`${l}/${b}`,{data:r,error:c}=await x.storage.from(je).upload(i,d,{upsert:!0,cacheControl:"3600"});if(c)throw c;const{data:f}=x.storage.from(je).getPublicUrl(i);return s(!1),f.publicUrl}catch(y){return console.error("Upload failed:",y),a(y),s(!1),null}},uploading:t,error:o}};function nt(t={}){const{debounceMs:s=300,countryCode:o="us",limit:a=5}=t,[u,d]=m.useState([]),[l,y]=m.useState(!1),[b,i]=m.useState(null),r=m.useRef(null),c=m.useRef(""),f=m.useRef(0),j=m.useCallback(async C=>{const E=(C==null?void 0:C.trim())||"";if(r.current&&clearTimeout(r.current),E.length<3){d([]),y(!1),i(null);return}E!==c.current&&(y(!0),i(null),r.current=setTimeout(async()=>{const g=++f.current;c.current=E;try{const p=await tt(E,{countryCode:o,limit:a,addressDetails:!0});g===f.current&&(d(p),y(!1))}catch(p){g===f.current&&(i(p.message||"Address search failed"),d([]),y(!1))}},s))},[s,o,a]),w=m.useCallback(()=>{d([]),i(null),c.current=""},[]);return{search:j,results:u,loading:l,error:b,clearResults:w}}function dt({onSelect:t,value:s,onChange:o,placeholder:a="Start typing an address...",className:u="",label:d="Address",required:l=!1,showGeolocation:y=!0,countryCode:b="us",error:i}){const{search:r,results:c,loading:f,error:j,clearResults:w}=nt({countryCode:b,debounceMs:350,limit:6}),[C,E]=m.useState(""),[g,p]=m.useState(!1),[v,_]=m.useState(!1),N=m.useRef(null),k=m.useRef(null),S=s!==void 0?s:C;m.useEffect(()=>{function h(z){N.current&&!N.current.contains(z.target)&&p(!1)}return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]);const L=h=>{const z=h.target.value;o?o(z):E(z),z.trim().length>=3?(r(z),p(!0)):(p(!1),w())},q=h=>{const z={displayName:h.displayName,shortName:h.shortName,formattedAddress:h.formattedAddress,lat:h.lat,lng:h.lng,...h.address},D=h.formattedAddress||h.shortName||h.displayName;o?o(D):E(D),t&&t(z),p(!1),w()},R=async()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}_(!0),navigator.geolocation.getCurrentPosition(async h=>{const{latitude:z,longitude:D}=h.coords;try{const O=await et(z,D);if(O){const U=O.displayName;o?o(U):E(U),t&&t({displayName:U,formattedAddress:U,lat:z,lng:D,city:O.city,state:O.state,zip:O.zip})}}catch(O){console.error("Reverse geocode failed:",O)}_(!1)},h=>{console.warn("Geolocation error:",h),alert("Unable to get your location. Please enter address manually."),_(!1)},{enableHighAccuracy:!0,timeout:1e4})},P=()=>{var h;o?o(""):E(""),w(),p(!1),(h=k.current)==null||h.focus()},n=i||j;return e.jsxs("div",{ref:N,className:`relative ${u}`,children:[d&&e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:[d,l&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(M,{className:`absolute left-3 top-3 ${f?"text-brand-blue animate-pulse":"text-gray-400"}`,size:16}),e.jsx("input",{ref:k,type:"text",className:`
                            w-full pl-9 pr-8 p-2.5 text-sm
                            bg-white dark:bg-[#1f2128] 
                            border ${n?"border-red-400 focus:ring-red-200":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"}
                            rounded-lg focus:ring-2 outline-none 
                            dark:text-white transition-all
                        `,placeholder:a,value:S,onChange:L,onFocus:()=>{c.length>0&&p(!0)},autoComplete:"off"}),S&&!f&&e.jsx("button",{type:"button",onClick:P,className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",children:e.jsx(W,{size:16})}),f&&e.jsx(se,{className:"absolute right-3 top-3 text-brand-blue animate-spin",size:16})]}),y&&e.jsx("button",{type:"button",onClick:R,disabled:v,className:"p-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-brand-blue transition-colors disabled:opacity-50",title:"Use my current location",children:v?e.jsx(se,{size:18,className:"animate-spin"}):e.jsx(Re,{size:18})})]}),n&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i||j}),g&&c.length>0&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-72 overflow-y-auto animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsx("div",{className:"py-1",children:c.map(h=>{var z;return e.jsx("button",{type:"button",onClick:()=>q(h),className:"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(M,{size:16,className:"text-gray-400 group-hover:text-brand-blue transition-colors mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm dark:text-white group-hover:text-brand-blue transition-colors truncate",children:h.shortName||h.formattedAddress}),h.displayName!==h.shortName&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5",children:h.displayName}),((z=h.address)==null?void 0:z.zip)&&e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:["ZIP: ",h.address.zip]})]})]})},h.id)})}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-t dark:border-gray-700 text-[10px] text-gray-400 text-center",children:"Powered by OpenStreetMap"})]}),g&&f&&c.length===0&&S.length>=3&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2",children:[e.jsx(se,{className:"animate-spin",size:16}),e.jsx("span",{className:"text-sm",children:"Searching addresses..."})]}),g&&!f&&c.length===0&&S.length>=3&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 text-sm",children:"No addresses found. Try a different search."})]})}function lt(t){return!t||!t.accountTypes?!1:t.accountTypes.includes(Ze)}const ot=m.createContext();function te(){const t=m.useContext(ot);if(!t)throw new Error("useEduAuth must be used within an EduAuthProvider");return t}function ct({user:t,userData:s}){let o;try{o=te()}catch{o=null}const a=(o==null?void 0:o.user)||t,u=(o==null?void 0:o.userData)||s,{schoolData:d,studentProfile:l}=ee(),[y,b]=m.useState(""),[i,r]=m.useState([]),[c,f]=m.useState(!1),[j,w]=m.useState([]),[C,E]=m.useState([]),[g,p]=m.useState([]),[v,_]=m.useState([]),[N,k]=m.useState(!1),S=(u==null?void 0:u.internshipCities)||[],L=u==null?void 0:u.schoolId,q=async()=>{const A=y.trim(),$=(a==null?void 0:a.id)||(a==null?void 0:a.uid);if(A&&S.length<3&&x)try{const I=[...S,A];await x.from("profiles").update({internship_cities:I}).eq("id",$),b("")}catch(I){console.error("Error adding interest:",I)}},R=async A=>{const $=(a==null?void 0:a.id)||(a==null?void 0:a.uid);if(x)try{const I=S.filter(T=>T!==A);await x.from("profiles").update({internship_cities:I}).eq("id",$)}catch(I){console.error("Error removing interest:",I)}};m.useEffect(()=>{u!=null&&u.programComplete&&P()},[u==null?void 0:u.programComplete,S]),m.useEffect(()=>{L&&(a!=null&&a.uid)&&(n(),h(),z(),D())},[L,a==null?void 0:a.uid]);const P=async()=>{if(x){f(!0);try{const{data:A,error:$}=await x.from("studios").select("*").eq("allow_internship",!0);if($)throw $;let I=(A||[]).map(T=>({id:T.id,...T,allowInternship:T.allow_internship,zipCode:T.zip_code}));S.length>0&&(I=I.filter(T=>S.some(me=>{var ue,he;return((ue=T.city)==null?void 0:ue.toLowerCase().includes(me.toLowerCase()))||((he=T.zipCode)==null?void 0:he.includes(me))}))),r(I)}catch(A){console.error("Error fetching studios:",A)}finally{f(!1)}}},n=async()=>{if(!(!x||!L)){k(!0);try{const{data:A,error:$}=await x.from("courses").select("*").eq("school_id",L).eq("status","published");if($)throw $;w((A||[]).map(I=>({id:I.id,...I})))}catch(A){console.error("Error loading courses:",A)}k(!1)}},h=async()=>{if(!x||!L)return;const A=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const{data:$,error:I}=await x.from("enrollments").select("*").eq("school_id",L).eq("student_id",A);if(I)throw I;E(($||[]).map(T=>({id:T.id,...T,studentId:T.student_id,courseId:T.course_id,enrolledAt:T.enrolled_at})))}catch($){console.error("Error loading enrollments:",$)}},z=async()=>{if(!(!x||!L))try{const{data:A,error:$}=await x.from("learning_paths").select("*").eq("school_id",L);if($)throw $;p((A||[]).map(I=>({id:I.id,...I})))}catch(A){console.error("Error loading learning paths:",A)}},D=async()=>{if(!x||!L)return;const A=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const{data:$,error:I}=await x.from("badges").select("*").eq("school_id",L).eq("student_id",A);if(I)throw I;_(($||[]).map(T=>({id:T.id,...T,studentId:T.student_id})))}catch($){console.error("Error loading badges:",$)}},O=async A=>{if(!x||!L)return;const $=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{await x.from("enrollments").insert({school_id:L,student_id:$,course_id:A,enrolled_at:new Date().toISOString(),progress:0,status:"active"}),h()}catch(I){console.error("Error enrolling:",I),alert("Failed to enroll in course.")}},U=C.map(A=>A.courseId),ce=j.filter(A=>!U.includes(A.id)),xe=j.filter(A=>U.includes(A.id)),ge=((l==null?void 0:l.hoursLogged)||0)/((d==null?void 0:d.requiredHours)||100);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2",children:d!=null&&d.logoURL?e.jsx("img",{src:d.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(G,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight mb-1",children:(d==null?void 0:d.name)||"Student Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Student Portal"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["ID: ",(u==null?void 0:u.studentId)||"N/A"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Cohort: ",(l==null?void 0:l.cohort)||"General"]})]})]}),e.jsxs("div",{className:"w-full md:w-64 bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"dark:text-gray-300",children:"Progress"}),e.jsxs("span",{className:"text-indigo-600",children:[Math.round(ge*100),"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:"h-full bg-indigo-600",style:{width:`${Math.min(100,ge*100)}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 text-right",children:[(l==null?void 0:l.hoursLogged)||0," / ",(d==null?void 0:d.requiredHours)||100," Hours"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(M,{size:20,className:"text-indigo-500"})," Internship Locations"]}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Add up to 3 target locations (City, Zip, or County) to find matched studios."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(A=>e.jsxs("span",{className:"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300 text-sm font-medium px-3 py-1 rounded-full flex items-center gap-1",children:[A,e.jsx("button",{onClick:()=>R(A),className:"ml-1 hover:text-indigo-800",children:"×"})]},A))}),S.length<3&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter City or Zip Code",value:y,onChange:A=>b(A.target.value),onKeyDown:A=>A.key==="Enter"&&q(),className:"flex-1 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none"}),e.jsx("button",{onClick:q,disabled:!y.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg font-bold disabled:opacity-50",children:"Add"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(H,{size:20,className:"text-indigo-500"}),"My Courses"]}),xe.length===0?e.jsx("p",{className:"text-gray-500",children:"You haven't enrolled in any courses yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:xe.map(A=>{const $=C.find(I=>I.courseId===A.id);return e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:A.title}),e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-1 rounded",children:"Enrolled"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:A.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(ae,{size:14}),e.jsxs("span",{children:[A.lessonCount||0," lessons"]})]}),e.jsx("button",{className:"text-indigo-600 text-sm font-semibold hover:underline",children:"Continue Learning →"})]}),$&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Progress"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[$.progress||0,"%"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all",style:{width:`${$.progress||0}%`}})})]})]},A.id)})})]}),ce.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(H,{size:20,className:"text-indigo-500"}),"Available Courses"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ce.slice(0,4).map(A=>e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsx("h3",{className:"font-bold dark:text-white mb-1",children:A.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:A.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(ae,{size:14}),e.jsxs("span",{children:[A.lessonCount||0," lessons"]})]}),e.jsx("button",{onClick:()=>O(A.id),className:"px-4 py-1.5 bg-indigo-600 text-white text-sm font-semibold rounded-lg hover:bg-indigo-700 transition",children:"Enroll"})]})]},A.id))})]}),v.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(V,{size:20,className:"text-yellow-500"}),"Earned Badges & Certificates"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:v.map(A=>{var $,I;return e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(V,{size:32,className:"mx-auto text-yellow-500 mb-2"}),e.jsx("p",{className:"text-sm font-semibold dark:text-white",children:A.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:((I=($=A.earnedAt)==null?void 0:$.toDate)==null?void 0:I.call($).toLocaleDateString())||"Recently"})]},A.id)})})]}),(u==null?void 0:u.programComplete)&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Y,{size:20,className:"text-indigo-500"})," Available Studios"]}),c?e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(J,{className:"animate-spin",size:16})," Searching..."]}):i.length>0?e.jsx("div",{className:"space-y-3",children:i.map(A=>e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold dark:text-white text-lg",children:A.name}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(M,{size:12})," ",A.city,", ",A.state]})]}),e.jsx("button",{className:"text-indigo-600 font-bold text-sm hover:underline",children:"View Details"})]},A.id))}):e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(Z,{size:16})," No studios found matching your criteria yet."]})]})]})}const Dt=Object.freeze(Object.defineProperty({__proto__:null,default:ct},Symbol.toStringTag,{value:"Module"})),xt=(t,s)=>{if(!t||!s)return 0;const o=t.toMillis?t.toMillis():new Date(t).getTime(),u=(s.toMillis?s.toMillis():new Date(s).getTime())-o;return Math.max(0,Math.floor(u/6e4))},gt=t=>{const s=Math.floor(t/60),o=Math.floor(t%60);return`${s}h ${o>0?`${o}m`:""}`};function mt({user:t,userData:s}){let o;try{o=te()}catch{o=null}const a=(o==null?void 0:o.user)||t,u=(o==null?void 0:o.userData)||s,{schoolData:d,studentProfile:l,internshipStudio:y,checkIn:b,checkOut:i}=ee(),[r,c]=m.useState(""),[f,j]=m.useState(!1),[w,C]=m.useState([]),[E,g]=m.useState([]),[p,v]=m.useState([]),_=u==null?void 0:u.schoolId;m.useEffect(()=>{_&&(a!=null&&a.id||a!=null&&a.uid)&&x&&(N(),k(),S())},[_,a==null?void 0:a.id,a==null?void 0:a.uid]);const N=async()=>{if(!x||!_)return;const R=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const{data:P,error:n}=await x.from("enrollments").select("*").eq("school_id",_).eq("student_id",R);if(n)throw n;C((P||[]).map(h=>({id:h.id,...h,studentId:h.student_id,courseId:h.course_id,enrolledAt:h.enrolled_at})))}catch(P){console.error("Error loading enrollments:",P)}},k=async()=>{if(!x||!_)return;const R=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const{data:P,error:n}=await x.from("badges").select("*").eq("school_id",_).eq("student_id",R);if(n)throw n;g((P||[]).map(h=>({id:h.id,...h,studentId:h.student_id})))}catch(P){console.error("Error loading badges:",P)}},S=async()=>{l!=null&&l.milestones&&v(l.milestones)},L=async()=>{j(!0);try{l!=null&&l.isClockedIn?(await i(r),c("")):await b((y==null?void 0:y.name)||"Remote Internship","studio")}catch(R){console.error(R)}j(!1)};if(!l)return e.jsx("div",{className:"p-8 text-center",children:"Loading student profile..."});const q=Math.min(100,(l.hoursLogged||0)/((d==null?void 0:d.requiredHours)||100)*100);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"h-20 w-20 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-1",children:d!=null&&d.logoURL?e.jsx("img",{src:d.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(G,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight mb-1",children:(d==null?void 0:d.name)||"Internship Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Active Intern"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Cohort: ",l.cohort]})]})]}),e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("div",{className:"text-3xl font-black dark:text-white text-indigo-600",children:l.hoursLogged||0}),e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider",children:"Total Hours"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-gradient-to-br from-indigo-900 to-slate-900 text-white p-8 rounded-2xl relative overflow-hidden shadow-lg border border-indigo-800/50",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-xs font-bold uppercase tracking-widest opacity-60 mb-2",children:"Assigned Studio Location"}),e.jsx("h2",{className:"text-3xl font-extrabold mb-4 tracking-tight",children:(y==null?void 0:y.name)||"Pending Assignment"}),y?e.jsxs("div",{className:"space-y-3 text-sm opacity-90",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(M,{size:18,className:"text-indigo-400"})," ",y.address||"Address not listed"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:18,className:"text-green-400"})," Status: Active Placement"]})]}):e.jsxs("div",{className:"bg-white/10 p-4 rounded-xl flex items-start gap-3 border border-white/10",children:[e.jsx(qe,{className:"text-yellow-400 shrink-0 mt-0.5",size:20}),e.jsx("p",{className:"text-sm leading-relaxed",children:"You haven't been assigned an internship location yet. Please contact your school coordinator to get placed."})]})]}),e.jsx("div",{className:"absolute -right-12 -bottom-12 w-64 h-64 bg-indigo-600/20 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(J,{className:l.isClockedIn?"text-green-500 animate-pulse":"text-gray-400"}),l.isClockedIn?"Currently Working":"Time Clock"]}),l.isClockedIn&&e.jsx("textarea",{className:"w-full p-3 text-sm border rounded-xl mb-4 dark:bg-black/20 dark:border-gray-600 dark:text-white resize-none focus:ring-2 focus:ring-indigo-500 outline-none",rows:"4",placeholder:"Describe your tasks for this session...",value:r,onChange:R=>c(R.target.value)})]}),e.jsx("button",{onClick:L,disabled:f||!y&&!l.isClockedIn,className:`w-full py-3.5 rounded-xl font-bold text-white transition shadow-lg transform active:scale-95 ${f?"bg-gray-400":l.isClockedIn?"bg-red-500 hover:bg-red-600 shadow-red-500/30":"bg-green-600 hover:bg-green-700 shadow-green-600/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none"}`,children:f?"Processing...":l.isClockedIn?"Clock Out":"Clock In"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"dark:text-white",children:"Completion Progress"}),e.jsxs("span",{className:"text-indigo-600",children:[Math.round(q),"%"]})]}),e.jsx("div",{className:"w-full h-4 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-1000 ease-out",style:{width:`${q}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-center",children:[l.hoursLogged," / ",(d==null?void 0:d.requiredHours)||100," Hours Required"]})]}),w.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(H,{size:20,className:"text-indigo-500"}),"Course Progress"]}),e.jsx("div",{className:"space-y-3",children:w.map(R=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"font-semibold dark:text-white",children:["Course ",R.courseId]}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.progress||0,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all",style:{width:`${R.progress||0}%`}})})]},R.id))})]}),p.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{size:20,className:"text-purple-500"}),"Internship Milestones"]}),e.jsx("div",{className:"space-y-2",children:p.map((R,P)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[R.completed?e.jsx(Z,{size:20,className:"text-green-500"}):e.jsx("div",{className:"w-5 h-5 border-2 border-gray-300 dark:border-gray-600 rounded-full"}),e.jsx("span",{className:R.completed?"text-gray-600 dark:text-gray-400 line-through":"dark:text-white",children:R.name})]},P))})]}),E.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(V,{size:20,className:"text-yellow-500"}),"Earned Badges"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:E.map(R=>e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(V,{size:32,className:"mx-auto text-yellow-500 mb-2"}),e.jsx("p",{className:"text-sm font-semibold dark:text-white",children:R.name})]},R.id))})]})]})}const Tt=Object.freeze(Object.defineProperty({__proto__:null,default:mt},Symbol.toStringTag,{value:"Module"})),oe=(t,s="export")=>{if(!t||!t.length){console.warn("No data to export.");return}const o=new Set;t.forEach(b=>Object.keys(b).forEach(i=>o.add(i)));const a=Array.from(o),u=[];u.push(a.join(",")),t.forEach(b=>{const i=a.map(r=>{const c=b[r];return c&&typeof c=="object"?c.toMillis?`"${new Date(c.toMillis()).toLocaleString()}"`:`"${JSON.stringify(c).replace(/"/g,'""')}"`:`"${(""+(c??"")).replace(/"/g,'""')}"`});u.push(i.join(","))});const d=new Blob([u.join(`
`)],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(d),y=document.createElement("a");y.href=l,y.setAttribute("download",`${s}_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(y),y.click(),document.body.removeChild(y)};function ut({schoolId:t,schoolData:s}){const[o,a]=m.useState({students:0,interns:0,pending:0}),[u,d]=m.useState([]),[l,y]=m.useState(!0);return m.useEffect(()=>{if(!t||!x)return;(async()=>{y(!0);try{const{count:i,error:r}=await x.from("students").select("*",{count:"exact",head:!0}).eq("school_id",t);if(r)throw r;const{data:c,error:f}=await x.from("students").select("id, internship_studio_id").eq("school_id",t).not("internship_studio_id","is",null);if(f)throw f;const j=(c||[]).length,{data:w,error:C}=await x.from("internship_logs").select("id").eq("school_id",t).eq("status","pending_approval");if(C)throw C;const E=(w||[]).length;a({students:i||0,interns:j,pending:E});const{data:g,error:p}=await x.from("audit_logs").select("*").eq("school_id",t).order("timestamp",{ascending:!1}).limit(5);if(p)throw p;d((g||[]).map(v=>({id:v.id,...v,adminName:v.admin_name,timestamp:v.timestamp?new Date(v.timestamp):null})))}catch(i){console.error("Overview load failed:",i)}y(!1)})()},[t]),l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Overview..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(re,{title:"Total Students",value:o.students,icon:e.jsx(Q,{className:"text-white"}),bg:"bg-gradient-to-br from-indigo-500 to-blue-600",text:"text-white"}),e.jsx(re,{title:"Active Internships",value:o.interns,icon:e.jsx(ne,{className:"text-white"}),bg:"bg-gradient-to-br from-purple-500 to-pink-600",text:"text-white"}),e.jsx(re,{title:"Pending Approvals",value:o.pending,icon:e.jsx(J,{className:"text-white"}),bg:"bg-gradient-to-br from-yellow-500 to-orange-600",text:"text-white"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-4 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ve,{size:18,className:"text-gray-400"})," Recent Activity"]}),e.jsx("div",{className:"space-y-3",children:u.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No recent activity recorded."}):u.map(b=>{var i;return e.jsxs("div",{className:"text-xs border-b dark:border-gray-700 pb-2 last:border-0",children:[e.jsxs("div",{className:"flex justify-between font-bold dark:text-gray-200",children:[e.jsx("span",{children:b.action}),e.jsx("span",{className:"text-gray-500 font-normal",children:(i=b.timestamp)!=null&&i.toDate?b.timestamp.toDate().toLocaleTimeString():""})]}),e.jsxs("div",{className:"text-gray-500 mt-0.5",children:[b.details," ",e.jsxs("span",{className:"opacity-70",children:["— ",b.adminName]})]})]},b.id)})})]}),e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center text-center bg-white dark:bg-black/20 shadow-sm",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center shadow-lg mb-4 overflow-hidden border-4 border-white dark:border-gray-700",children:s!=null&&s.logoURL?e.jsx("img",{src:s.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(G,{size:40,className:"text-indigo-500"})}),e.jsx("h2",{className:"text-2xl font-extrabold dark:text-white mb-1",children:(s==null?void 0:s.name)||"School Name"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:(s==null?void 0:s.address)||"No Address Set"}),(s==null?void 0:s.website)&&e.jsxs("a",{href:s.website,target:"_blank",rel:"noreferrer",className:"text-xs font-bold text-indigo-600 bg-indigo-50 dark:bg-indigo-900/20 px-3 py-1.5 rounded-full hover:bg-indigo-100 transition flex items-center gap-1",children:[e.jsx(ke,{size:12})," Visit Website"]})]})]})]})}function ht({schoolId:t,logAction:s}){const[o,a]=m.useState([]),[u,d]=m.useState([]),[l,y]=m.useState(!0),[b,i]=m.useState(""),[r,c]=m.useState(!1),[f,j]=m.useState(!1),[w,C]=m.useState(null),[E,g]=m.useState(!1),[p,v]=m.useState({firstName:"",lastName:"",email:"",studentId:"",cohort:"",status:"Enrolled"}),[_,N]=m.useState("");m.useEffect(()=>{if(!t||!x)return;(async()=>{y(!0);try{const{data:h,error:z}=await x.from("students").select("*").eq("school_id",t);if(z)throw z;a((h||[]).map(U=>({id:U.id,...U,displayName:U.display_name,studentId:U.student_id,hoursLogged:U.hours_logged||0})));const{data:D,error:O}=await x.from("school_partners").select("*").eq("school_id",t);if(O)throw O;d((D||[]).map(U=>({id:U.id,...U})))}catch(h){console.error("Roster load failed:",h)}y(!1)})()},[t]);const k=()=>{v({firstName:"",lastName:"",email:"",studentId:"",cohort:"",status:"Enrolled"}),g(!1),C(null),c(!0)},S=n=>{var h,z;v({firstName:((h=n.displayName)==null?void 0:h.split(" ")[0])||"",lastName:((z=n.displayName)==null?void 0:z.split(" ").slice(1).join(" "))||"",email:n.email||"",studentId:n.studentId||"",cohort:n.cohort||"",status:n.status||"Enrolled"}),g(!0),C(n),c(!0)},L=async()=>{if(!x||!t)return;const n=`${p.firstName} ${p.lastName}`.trim();if(!n||!p.email)return alert("Name and Email required.");try{if(E&&w){const{error:h}=await x.from("students").update({first_name:p.firstName,last_name:p.lastName,display_name:n,email:p.email,student_id:p.studentId||null,cohort:p.cohort||null,status:p.status}).eq("id",w.id).eq("school_id",t);if(h)throw h;a(z=>z.map(D=>D.id===w.id?{...D,...p,displayName:n}:D)),s&&await s("Edit Student",`Updated ${n}`)}else{const{data:h,error:z}=await x.from("students").insert({school_id:t,first_name:p.firstName,last_name:p.lastName,display_name:n,email:p.email,student_id:p.studentId||null,cohort:p.cohort||null,status:p.status,hours_logged:0,created_at:new Date().toISOString()}).select().single();if(z)throw z;a(D=>[...D,{id:h.id,...p,displayName:n,hoursLogged:0}]),s&&await s("Add Student",`Added ${n}`)}c(!1)}catch(h){console.error("Save student failed:",h),alert("Failed to save student.")}},q=async(n,h)=>{if(!(!confirm(`Remove ${h} from the roster? This does not delete their user account.`)||!x))try{await x.from("students").delete().eq("id",n).eq("school_id",t),a(z=>z.filter(D=>D.id!==n)),s&&await s("Remove Student",`Removed ${h}`)}catch(z){console.error("Delete failed:",z)}},R=async()=>{if(!(!w||!_||!x))try{await x.from("students").update({internship_studio_id:_}).eq("id",w.id).eq("school_id",t),a(n=>n.map(h=>h.id===w.id?{...h,internshipStudioId:_,internship_studio_id:_}:h)),j(!1),N(""),alert(`Assigned ${w.displayName} to studio.`),s&&await s("Assign Internship",`Assigned ${w.displayName}`)}catch(n){console.error("Assignment failed:",n)}},P=o.filter(n=>{var h,z;return((h=n.displayName)==null?void 0:h.toLowerCase().includes(b.toLowerCase()))||((z=n.studentId)==null?void 0:z.includes(b))});return l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roster..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Y,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Search by Name or ID...",value:b,onChange:n=>i(n.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>oe(o,"student_roster"),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-bold text-xs",children:"Export CSV"}),e.jsxs("button",{onClick:k,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-indigo-700",children:[e.jsx(we,{size:16})," Add Student"]})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3",children:"ID"}),e.jsx("th",{className:"p-3",children:"Cohort"}),e.jsx("th",{className:"p-3",children:"Internship"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-6 text-center text-gray-500",children:"No students found."})}):P.map(n=>e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsx("td",{className:"p-3 font-bold dark:text-white",children:n.displayName}),e.jsx("td",{className:"p-3 text-gray-500",children:n.studentId||"--"}),e.jsx("td",{className:"p-3",children:n.cohort||"General"}),e.jsx("td",{className:"p-3 text-gray-500",children:n.internshipStudioId?e.jsxs("span",{className:"flex items-center gap-1 text-green-600 font-medium text-xs bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded w-fit",children:[e.jsx(ne,{size:12})," Assigned"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"Pending"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>{C(n),j(!0)},className:"p-1.5 bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-300 rounded hover:bg-indigo-100",title:"Assign Internship",children:e.jsx(Pe,{size:14})}),e.jsx("button",{onClick:()=>S(n),className:"p-1.5 bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded hover:bg-gray-200",title:"Edit Details",children:e.jsx(de,{size:14})}),e.jsx("button",{onClick:()=>q(n.id,n.displayName),className:"p-1.5 bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-100",title:"Remove Student",children:e.jsx(F,{size:14})})]})})]},n.id))})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:E?"Edit Student":"Add New Student"}),e.jsx("button",{onClick:()=>c(!1),children:e.jsx(W,{className:"text-gray-400 hover:text-red-500"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"First Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:p.firstName,onChange:n=>v({...p,firstName:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Last Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:p.lastName,onChange:n=>v({...p,lastName:n.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Email Address"}),e.jsx("input",{type:"email",className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:p.email,onChange:n=>v({...p,email:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Student ID"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:p.studentId,onChange:n=>v({...p,studentId:n.target.value}),placeholder:"e.g. S123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Cohort"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:p.cohort,onChange:n=>v({...p,cohort:n.target.value}),placeholder:"Fall 2024"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Enrollment Status"}),e.jsxs("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:p.status,onChange:n=>v({...p,status:n.target.value}),children:[e.jsx("option",{value:"Enrolled",children:"Enrolled"}),e.jsx("option",{value:"Graduated",children:"Graduated"}),e.jsx("option",{value:"Dropped",children:"Dropped"}),e.jsx("option",{value:"Leave",children:"On Leave"})]})]}),e.jsx("button",{onClick:L,className:"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 mt-2",children:E?"Update Student":"Create Student Record"})]})}),f&&w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-sm rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Assign Internship"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Select a partner studio for ",e.jsx("strong",{children:w.displayName}),"."]}),e.jsxs("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:_,onChange:n=>N(n.target.value),children:[e.jsx("option",{value:"",children:"Select Studio..."}),u.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(!1),className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm",children:"Cancel"}),e.jsx("button",{onClick:R,disabled:!_,className:"flex-1 bg-indigo-600 text-white py-2 rounded font-bold disabled:opacity-50",children:"Confirm"})]})]})})]})}function ft({schoolId:t}){const[s,o]=m.useState([]),[a,u]=m.useState(!0),[d,l]=m.useState("all");m.useEffect(()=>{if(!t||!x)return;(async()=>{u(!0);try{const{data:r,error:c}=await x.from("internship_logs").select("*").eq("school_id",t).order("check_in",{ascending:!1}).limit(100);if(c)throw c;const f=(r||[]).map(j=>{const w=xt(j.check_in,j.check_out);return{id:j.id,...j,checkIn:j.check_in,checkOut:j.check_out,studentId:j.student_id,studentName:j.student_name,duration:w}});o(f)}catch(r){console.error("Error fetching logs:",r)}u(!1)})()},[t]);const y=async(i,r)=>{if(!(!x||!t))try{const{error:c}=await x.from("internship_logs").update({status:r}).eq("id",i).eq("school_id",t);if(c)throw c;o(f=>f.map(j=>j.id===i?{...j,status:r}:j))}catch(c){console.error("Error updating log:",c),alert("Failed to update log status.")}},b=d==="all"?s:s.filter(i=>i.status===d);return a?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Internship Hours..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{size:16,className:"text-gray-500"}),e.jsxs("select",{className:"bg-white dark:bg-[#1f2128] border dark:border-gray-600 text-sm rounded-md p-1.5 outline-none dark:text-white",value:d,onChange:i=>l(i.target.value),children:[e.jsx("option",{value:"all",children:"All Activity"}),e.jsx("option",{value:"pending_approval",children:"Pending Approval"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"active",children:"Active (Clocked In)"})]})]}),e.jsxs("button",{onClick:()=>oe(b,"internship_hours"),className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(Ie,{size:14})," Export CSV"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Date"}),e.jsx("th",{className:"p-3",children:"Student"}),e.jsx("th",{className:"p-3",children:"Activity / Description"}),e.jsx("th",{className:"p-3",children:"Duration"}),e.jsx("th",{className:"p-3",children:"Status"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:"No logs found matching criteria."})}):b.map(i=>{var r,c;return e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[e.jsx("div",{className:"font-medium",children:(r=i.checkIn)!=null&&r.toDate?i.checkIn.toDate().toLocaleDateString():"N/A"}),e.jsx("div",{className:"text-[10px] text-gray-400",children:(c=i.checkIn)!=null&&c.toDate?i.checkIn.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:i.studentName}),e.jsxs("td",{className:"p-3 max-w-xs",children:[e.jsxs("span",{className:"block text-[10px] uppercase font-bold text-gray-400 mb-0.5",children:[i.type," • ",i.location]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 truncate block",title:i.description,children:i.description||e.jsx("span",{className:"italic opacity-50",children:"No description provided"})})]}),e.jsx("td",{className:"p-3 font-mono font-bold text-indigo-600 dark:text-indigo-400",children:i.checkOut?gt(i.duration):e.jsx("span",{className:"animate-pulse text-green-500",children:"Active..."})}),e.jsx("td",{className:"p-3",children:e.jsx(pt,{status:i.status})}),e.jsx("td",{className:"p-3 text-right",children:i.status==="pending_approval"&&e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx("button",{onClick:()=>y(i.id,"approved"),className:"p-1.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded hover:bg-green-200 transition",title:"Approve",children:e.jsx(Z,{size:16})}),e.jsx("button",{onClick:()=>y(i.id,"rejected"),className:"p-1.5 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-200 transition",title:"Reject",children:e.jsx(De,{size:16})})]})})]},i.id)})})]})})]})}function pt({status:t}){const s={approved:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",rejected:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",pending_approval:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",active:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 animate-pulse"},o={approved:"Approved",rejected:"Rejected",pending_approval:"Pending",active:"In Progress"};return e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-[10px] uppercase font-bold tracking-wide ${s[t]||"bg-gray-100 text-gray-500"}`,children:o[t]||t})}function bt({schoolId:t,course:s,onSave:o,onCancel:a,logAction:u}){const[d,l]=m.useState({title:"",description:"",duration:"",prerequisites:[],category:""}),[y,b]=m.useState([]),[i,r]=m.useState(!1),[c,f]=m.useState(""),[j,w]=m.useState(null);m.useEffect(()=>{s&&(l({title:s.title||"",description:s.description||"",duration:s.duration||"",prerequisites:s.prerequisites||[],category:s.category||""}),C())},[s]);const C=async()=>{if(!(!(s!=null&&s.id)||!x))try{const{data:N,error:k}=await x.from("lessons").select("*").eq("course_id",s.id).order("order",{ascending:!0});if(k)throw k;const S=(N||[]).map(L=>({id:L.id,...L,courseId:L.course_id}));b(S)}catch(N){console.error("Error loading lessons:",N)}},E=async()=>{if(!d.title.trim()){alert("Course title is required.");return}if(!(!x||!t)){r(!0);try{const N={school_id:t,title:d.title,description:d.description||null,duration:d.duration||null,prerequisites:d.prerequisites||[],category:d.category||null,lesson_count:y.length,updated_at:new Date().toISOString()};if(s){const{error:k}=await x.from("courses").update(N).eq("id",s.id).eq("school_id",t);if(k)throw k;u&&u("update_course",{courseId:s.id,title:d.title})}else{N.created_at=new Date().toISOString(),N.status="draft";const{data:k,error:S}=await x.from("courses").insert(N).select().single();if(S)throw S;u&&u("create_course",{courseId:k.id,title:d.title})}o()}catch(N){console.error("Error saving course:",N),alert("Failed to save course.")}r(!1)}},g=()=>{c.trim()&&!d.prerequisites.includes(c.trim())&&(l(N=>({...N,prerequisites:[...N.prerequisites,c.trim()]})),f(""))},p=N=>{l(k=>({...k,prerequisites:k.prerequisites.filter(S=>S!==N)}))},v=()=>{const N={id:`temp-${Date.now()}`,title:"New Lesson",description:"",type:"video",content:"",order:y.length,duration:0};b([...y,N]),w(N.id)},_=async N=>{if(!(!confirm("Delete this lesson?")||!x||!(s!=null&&s.id))){if(N.startsWith("temp-")){b(y.filter(k=>k.id!==N));return}try{await x.from("lessons").delete().eq("id",N).eq("course_id",s.id),C()}catch(k){console.error("Error deleting lesson:",k)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:s?"Edit Course":"Create New Course"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:i,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50",children:i?"Saving...":"Save Course"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Course Title *"}),e.jsx("input",{type:"text",value:d.title,onChange:N=>l({...d,title:N.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., Introduction to Music Production"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:N=>l({...d,description:N.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"Course description..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Duration"}),e.jsx("input",{type:"text",value:d.duration,onChange:N=>l({...d,duration:N.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., 8 weeks"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),e.jsx("input",{type:"text",value:d.category,onChange:N=>l({...d,category:N.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., Production, Engineering"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Prerequisites"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:c,onChange:N=>f(N.target.value),onKeyPress:N=>N.key==="Enter"&&g(),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"Add prerequisite..."}),e.jsx("button",{onClick:g,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.prerequisites.map((N,k)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-full text-sm",children:[N,e.jsx("button",{onClick:()=>p(N),className:"hover:text-indigo-900 dark:hover:text-indigo-100",children:e.jsx(W,{size:14})})]},k))})]})]}),s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Lessons"}),e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:[e.jsx(B,{size:18}),"Add Lesson"]})]}),e.jsxs("div",{className:"space-y-2",children:[y.map((N,k)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx(Te,{className:"text-gray-400 cursor-move",size:18}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium dark:text-white",children:N.title||"Untitled Lesson"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[N.type," • ",N.duration||0," min"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(N.id),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition",children:e.jsx(Edit2,{size:16,className:"text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>_(N.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition",children:e.jsx(F,{size:16,className:"text-red-600 dark:text-red-400"})})]})]},N.id)),y.length===0&&e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No lessons yet. Add your first lesson!"})]})]})]})}function yt({schoolId:t,logAction:s}){const[o,a]=m.useState([]),[u,d]=m.useState(!0),[l,y]=m.useState(""),[b,i]=m.useState(!1),[r,c]=m.useState(null);m.useEffect(()=>{t&&f()},[t]);const f=async()=>{if(!(!t||!x)){d(!0);try{const{data:g,error:p}=await x.from("courses").select("*").eq("school_id",t).order("created_at",{ascending:!1});if(p)throw p;const v=(g||[]).map(_=>({id:_.id,..._,createdAt:_.created_at}));a(v)}catch(g){console.error("Error loading courses:",g)}d(!1)}},j=()=>{c(null),i(!0)},w=g=>{c(g),i(!0)},C=async g=>{if(!(!confirm("Are you sure you want to delete this course? This action cannot be undone.")||!x))try{const{error:p}=await x.from("lessons").delete().eq("course_id",g);p&&console.warn("Error deleting lessons (may be handled by CASCADE):",p);const{error:v}=await x.from("courses").delete().eq("id",g).eq("school_id",t);if(v)throw v;s&&s("delete_course",{courseId:g}),f()}catch(p){console.error("Error deleting course:",p),alert("Failed to delete course.")}},E=o.filter(g=>{var p,v;return((p=g.title)==null?void 0:p.toLowerCase().includes(l.toLowerCase()))||((v=g.description)==null?void 0:v.toLowerCase().includes(l.toLowerCase()))});return b?e.jsx(bt,{schoolId:t,course:r,onSave:()=>{i(!1),c(null),f()},onCancel:()=>{i(!1),c(null)},logAction:s}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(H,{size:24}),"Courses"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Manage courses and learning materials"})]}),e.jsxs("button",{onClick:j,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition",children:[e.jsx(B,{size:18}),"New Course"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search courses...",value:l,onChange:g=>y(g.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-800 dark:text-white"})]}),u?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading courses..."})]}):E.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx(H,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:l?"No courses found matching your search.":"No courses yet. Create your first course!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(g=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-1",children:g.title||"Untitled Course"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:g.description||"No description"})]}),e.jsxs("div",{className:"flex gap-2 ml-2",children:[e.jsx("button",{onClick:()=>w(g),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"Edit course",children:e.jsx(de,{size:16,className:"text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>C(g.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete course",children:e.jsx(F,{size:16,className:"text-red-600 dark:text-red-400"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{size:14}),e.jsxs("span",{children:[g.lessonCount||0," lessons"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{size:14}),e.jsxs("span",{children:[g.enrollmentCount||0," enrolled"]})]}),g.duration&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{size:14}),e.jsx("span",{children:g.duration})]})]}),g.prerequisites&&g.prerequisites.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Prerequisites:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:g.prerequisites.map((p,v)=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs",children:p},v))})]})]},g.id))})]})}function jt({schoolId:t,logAction:s}){const[o,a]=m.useState([]),[u,d]=m.useState(!0),[l,y]=m.useState(""),[b,i]=m.useState(!1),[r,c]=m.useState(null),[f,j]=m.useState({title:"",description:"",courses:[],badges:[],skills:[],mentorshipEnabled:!1}),[w,C]=m.useState([]);m.useEffect(()=>{t&&(E(),g())},[t]);const E=async()=>{if(!(!t||!x)){d(!0);try{const{data:n,error:h}=await x.from("learning_paths").select("*").eq("school_id",t).order("created_at",{ascending:!1});if(h)throw h;const z=(n||[]).map(D=>({id:D.id,...D,createdAt:D.created_at,mentorshipEnabled:D.mentorship_enabled||!1}));a(z)}catch(n){console.error("Error loading learning paths:",n)}d(!1)}},g=async()=>{if(!(!t||!x))try{const{data:n,error:h}=await x.from("courses").select("id, title").eq("school_id",t).order("title",{ascending:!0});if(h)throw h;const z=(n||[]).map(D=>({id:D.id,title:D.title}));C(z)}catch(n){console.error("Error loading courses:",n)}},p=()=>{j({title:"",description:"",courses:[],badges:[],skills:[],mentorshipEnabled:!1}),c(null),i(!0)},v=n=>{j({title:n.title||"",description:n.description||"",courses:n.courses||[],badges:n.badges||[],skills:n.skills||[],mentorshipEnabled:n.mentorshipEnabled||!1}),c(n),i(!0)},_=async()=>{if(!f.title.trim()||!x||!t){f.title.trim()||alert("Path title is required.");return}d(!0);try{const n={school_id:t,title:f.title,description:f.description||null,courses:f.courses||[],badges:f.badges||[],skills:f.skills||[],mentorship_enabled:f.mentorshipEnabled||!1,updated_at:new Date().toISOString()};if(r){const{error:h}=await x.from("learning_paths").update(n).eq("id",r.id).eq("school_id",t);if(h)throw h;s&&s("update_learning_path",{pathId:r.id,title:f.title})}else{n.created_at=new Date().toISOString();const{data:h,error:z}=await x.from("learning_paths").insert(n).select().single();if(z)throw z;s&&s("create_learning_path",{pathId:h.id,title:f.title})}i(!1),c(null),E()}catch(n){console.error("Error saving learning path:",n),alert("Failed to save learning path.")}d(!1)},N=async n=>{if(!(!confirm("Are you sure you want to delete this learning path?")||!x))try{const{error:h}=await x.from("learning_paths").delete().eq("id",n).eq("school_id",t);if(h)throw h;s&&s("delete_learning_path",{pathId:n}),E()}catch(h){console.error("Error deleting learning path:",h),alert("Failed to delete learning path.")}},k=n=>{j(h=>({...h,courses:h.courses.includes(n)?h.courses.filter(z=>z!==n):[...h.courses,n]}))},S=()=>{const n=prompt("Enter badge name:");n&&!f.badges.includes(n)&&j(h=>({...h,badges:[...h.badges,n]}))},L=n=>{j(h=>({...h,badges:h.badges.filter(z=>z!==n)}))},q=()=>{const n=prompt("Enter skill name:");n&&!f.skills.includes(n)&&j(h=>({...h,skills:[...h.skills,n]}))},R=n=>{j(h=>({...h,skills:h.skills.filter(z=>z!==n)}))},P=o.filter(n=>{var h,z;return((h=n.title)==null?void 0:h.toLowerCase().includes(l.toLowerCase()))||((z=n.description)==null?void 0:z.toLowerCase().includes(l.toLowerCase()))});return b?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:r?"Edit Learning Path":"Create Learning Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{i(!1),c(null)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:u,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50",children:u?"Saving...":"Save Path"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Path Title *"}),e.jsx("input",{type:"text",value:f.title,onChange:n=>j({...f,title:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., Advanced Music Production Track"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:f.description,onChange:n=>j({...f,description:n.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"Learning path description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Courses"}),e.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-3",children:[w.map(n=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:f.courses.includes(n.id),onChange:()=>k(n.id),className:"rounded"}),e.jsx("span",{className:"dark:text-white",children:n.title})]},n.id)),w.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No courses available. Create courses first."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Badges"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:f.badges.map((n,h)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded-full text-sm",children:[e.jsx(V,{size:14}),n,e.jsx("button",{onClick:()=>L(n),className:"hover:text-yellow-900 dark:hover:text-yellow-100",children:e.jsx(W,{size:14})})]},h))}),e.jsx("button",{onClick:S,className:"text-sm text-indigo-600 dark:text-indigo-400 hover:underline",children:"+ Add Badge"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:f.skills.map((n,h)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-sm",children:[e.jsx(Ne,{size:14}),n,e.jsx("button",{onClick:()=>R(n),className:"hover:text-blue-900 dark:hover:text-blue-100",children:e.jsx(W,{size:14})})]},h))}),e.jsx("button",{onClick:q,className:"text-sm text-indigo-600 dark:text-indigo-400 hover:underline",children:"+ Add Skill"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"mentorship",checked:f.mentorshipEnabled,onChange:n=>j({...f,mentorshipEnabled:n.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"mentorship",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enable Mentorship Matching"})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(K,{size:24}),"Learning Paths"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Create structured learning programs with courses, badges, and mentorship"})]}),e.jsxs("button",{onClick:p,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition",children:[e.jsx(B,{size:18}),"New Path"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search learning paths...",value:l,onChange:n=>y(n.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-800 dark:text-white"})]}),u?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading learning paths..."})]}):P.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx(K,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:l?"No paths found matching your search.":"No learning paths yet. Create your first path!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.map(n=>{var h;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-1",children:n.title||"Untitled Path"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:n.description||"No description"})]}),e.jsxs("div",{className:"flex gap-2 ml-2",children:[e.jsx("button",{onClick:()=>v(n),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"Edit path",children:e.jsx(de,{size:16,className:"text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>N(n.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete path",children:e.jsx(F,{size:16,className:"text-red-600 dark:text-red-400"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(H,{size:14}),e.jsxs("span",{children:[((h=n.courses)==null?void 0:h.length)||0," courses"]})]}),n.badges&&n.badges.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(V,{size:14}),e.jsxs("span",{children:[n.badges.length," badges"]})]}),n.mentorshipEnabled&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-600 dark:text-indigo-400",children:[e.jsx(Q,{size:14}),e.jsx("span",{children:"Mentorship Enabled"})]})]})]},n.id)})})]})}function Nt({schoolId:t,logAction:s}){const[o,a]=m.useState([]),[u,d]=m.useState([]),[l,y]=m.useState(!0),[b,i]=m.useState(""),[r,c]=m.useState("");m.useEffect(()=>{if(!t||!x)return;(async()=>{y(!0);try{const{data:w,error:C}=await x.from("school_staff").select("*").eq("school_id",t);if(C)throw C;a((w||[]).map(p=>({id:p.id,...p,uid:p.user_id,roleId:p.role_id,roleName:p.role_name,addedAt:p.added_at})));const{data:E,error:g}=await x.from("school_roles").select("*").eq("school_id",t);if(g)throw g;d((E||[]).map(p=>({id:p.id,...p})))}catch(w){console.error("Staff load failed:",w)}y(!1)})()},[t]);const f=async()=>{if(!b||!r||!x||!t)return alert("Email and Role are required.");try{const{data:j,error:w}=await x.from("profiles").select("id, email, first_name, last_name, account_types, school_id").eq("email",b).single();if(w||!j)return alert("User not found. They must sign up for SeshNx first.");const C=j.id,E=u.find(N=>N.id===r),{data:g,error:p}=await x.from("school_staff").insert({school_id:t,user_id:C,email:j.email,name:`${j.first_name} ${j.last_name}`,role_id:r,role_name:(E==null?void 0:E.name)||"Unknown",added_at:new Date().toISOString()}).select().single();if(p)throw p;const v=j.account_types||[],_=v.includes("EDUStaff")?v:[...v,"EDUStaff"];await x.from("profiles").update({school_id:t,account_types:_}).eq("id",C),a(N=>[...N,{id:g.id,...g,uid:g.user_id,roleId:g.role_id,roleName:g.role_name,addedAt:g.added_at}]),i(""),alert(`${j.first_name} added as ${E==null?void 0:E.name}.`),s&&await s("Add Staff",`Added ${j.email} as ${E==null?void 0:E.name}`)}catch(j){console.error("Add staff error:",j),alert("Failed to add staff member. Check console.")}};return l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Staff..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(we,{size:18,className:"text-indigo-600"})," Add New Staff Member"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Se,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"User Email Address",value:b,onChange:j=>i(j.target.value)})]}),e.jsxs("div",{className:"relative min-w-[200px]",children:[e.jsx(X,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsxs("select",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white appearance-none",value:r,onChange:j=>c(j.target.value),children:[e.jsx("option",{value:"",children:"Select Role..."}),u.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsx("button",{onClick:f,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 transition shadow-md",children:"Add Staff"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["* The user must already have a SeshNx account. This will grant them ",e.jsx("strong",{children:"EDUStaff"})," access to this school."]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("span",{className:"font-bold text-sm dark:text-gray-200",children:"Authorized Personnel"}),e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded-full font-bold",children:[o.length," Active"]})]}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:o.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No staff members found."}):o.map(j=>e.jsxs("div",{className:"p-4 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-sm",children:j.name?j.name.charAt(0):"?"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white text-sm",children:j.name}),e.jsx("div",{className:"text-xs text-gray-500",children:j.email})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs font-bold border dark:border-gray-600",children:j.roleName})})]},j.id))})]})]})}function vt({schoolId:t,logAction:s}){const[o,a]=m.useState([]),[u,d]=m.useState(!0),[l,y]=m.useState(!1),[b,i]=m.useState({name:"",color:"#3b82f6",permissions:[]}),[r,c]=m.useState(!1);m.useEffect(()=>{if(!t||!x)return;(async()=>{d(!0);try{const{data:p,error:v}=await x.from("school_roles").select("*").eq("school_id",t);if(v)throw v;a((p||[]).map(_=>({id:_.id,..._})))}catch(p){console.error("Error loading roles:",p)}d(!1)})()},[t]);const f=async()=>{if(!(!b.name||!x||!t)){c(!0);try{const{data:g,error:p}=await x.from("school_roles").insert({school_id:t,name:b.name,color:b.color||"#3b82f6",permissions:b.permissions||[]}).select().single();if(p)throw p;a(v=>[...v,{id:g.id,...g}]),s&&await s("Create Role",`Created role: ${b.name}`),i({name:"",color:"#3b82f6",permissions:[]}),y(!1)}catch(g){console.error("Create role failed:",g),alert("Failed to create role.")}c(!1)}},j=async(g,p)=>{if(!(!confirm(`Delete role "${p}"? Staff assigned to this role will lose their permissions.`)||!x))try{await x.from("school_roles").delete().eq("id",g).eq("school_id",t),a(v=>v.filter(_=>_.id!==g)),s&&await s("Delete Role",`Deleted role: ${p}`)}catch(v){console.error("Delete role failed:",v)}},w=async(g,p)=>{if(!(!x||!t)){a(v=>v.map(_=>_.id===g?{..._,permissions:p}:_));try{await x.from("school_roles").update({permissions:p}).eq("id",g).eq("school_id",t)}catch(v){console.error("Update perms failed:",v)}}},C=g=>{i(p=>({...p,permissions:p.permissions.includes(g)?p.permissions.filter(v=>v!==g):[...p.permissions,g]}))},E=(g,p)=>{const v=g.permissions||[],_=v.includes(p)?v.filter(N=>N!==p):[...v,p];w(g.id,_)};return u?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roles..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("button",{onClick:()=>y(!0),className:"w-full py-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-500 font-bold hover:bg-gray-50 dark:hover:bg-white/5 transition flex items-center justify-center gap-2",children:[e.jsx(B,{size:20})," Create New Role"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(g=>{var p;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-start bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:g.color}}),g.name]}),e.jsxs("span",{className:"text-[10px] text-gray-400 uppercase tracking-wider font-bold",children:[((p=g.permissions)==null?void 0:p.length)||0," Permissions"]})]}),e.jsx("button",{onClick:()=>j(g.id,g.name),className:"text-gray-400 hover:text-red-500 transition p-1",title:"Delete Role",children:e.jsx(F,{size:16})})]}),e.jsx("div",{className:"p-2 flex-1 overflow-y-auto max-h-[300px] custom-scrollbar",children:e.jsx("div",{className:"space-y-0.5",children:ie.map(v=>{var N;const _=(N=g.permissions)==null?void 0:N.includes(v.id);return e.jsxs("label",{className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition ${_?"bg-indigo-50 dark:bg-indigo-900/20":"hover:bg-gray-50 dark:hover:bg-white/5"}`,children:[e.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center ${_?"bg-indigo-600 border-indigo-600":"border-gray-400"}`,children:_&&e.jsx(Ue,{size:10,className:"text-white",strokeWidth:4})}),e.jsx("input",{type:"checkbox",className:"hidden",checked:_,onChange:()=>E(g,v.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-xs font-bold ${_?"text-indigo-700 dark:text-indigo-300":"text-gray-600 dark:text-gray-400"}`,children:v.label}),e.jsx("div",{className:"text-[10px] text-gray-400 leading-tight",children:v.description})]})]},v.id)})})})]},g.id)})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-xl p-6 space-y-4 max-h-[90vh] overflow-y-auto animate-in zoom-in-95 shadow-2xl",children:[e.jsxs("h3",{className:"font-bold text-xl dark:text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"text-indigo-600"})," Create New Role"]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Role Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g. Academic Advisor",value:b.name,onChange:g=>i({...b,name:g.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Color"}),e.jsx("div",{className:"flex items-center border rounded dark:border-gray-600 p-1 dark:bg-black/20",children:e.jsx("input",{type:"color",className:"h-8 w-8 rounded cursor-pointer border-none bg-transparent",value:b.color,onChange:g=>i({...b,color:g.target.value})})})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Assign Initial Permissions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:ie.map(g=>e.jsxs("label",{className:`flex items-start gap-2 p-2 border rounded cursor-pointer transition ${b.permissions.includes(g.id)?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"checkbox",className:"mt-1",checked:b.permissions.includes(g.id),onChange:()=>C(g.id)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-gray-200",children:g.label}),e.jsx("div",{className:"text-[10px] text-gray-500 leading-tight",children:g.description})]})]},g.id))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>y(!1),className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:r,className:"flex-1 bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700 disabled:opacity-50",children:r?"Saving...":"Create Role"})]})]})})]})}function kt({schoolId:t,logAction:s}){const[o,a]=m.useState([]),[u,d]=m.useState(!0),[l,y]=m.useState({resource:"",limit:4,unit:"hours/week",role:"Student"});m.useEffect(()=>{if(!t||!x)return;(async()=>{d(!0);try{const{data:c,error:f}=await x.from("resource_rules").select("*").eq("school_id",t);if(f)throw f;a((c||[]).map(j=>({id:j.id,...j})))}catch(c){console.error("Error loading rules:",c)}d(!1)})()},[t]);const b=async()=>{if(!l.resource||!x||!t){l.resource||alert("Resource name required.");return}try{const{data:r,error:c}=await x.from("resource_rules").insert({school_id:t,resource:l.resource,limit:l.limit,unit:l.unit,role:l.role}).select().single();if(c)throw c;a(f=>[...f,{id:r.id,...r}]),s&&await s("Add Resource Rule",`Set ${l.limit} ${l.unit} limit for ${l.resource}`),y({resource:"",limit:4,unit:"hours/week",role:"Student"})}catch(r){console.error("Add rule failed:",r)}},i=async(r,c)=>{if(!(!confirm("Delete this rule?")||!x||!t))try{await x.from("resource_rules").delete().eq("id",r).eq("school_id",t),a(f=>f.filter(j=>j.id!==r)),s&&await s("Delete Rule",`Removed rule for ${c}`)}catch(f){console.error("Delete failed:",f)}};return u?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Rules..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(_e,{size:18,className:"text-indigo-600"})," Add Restriction / Quota"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Resource Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g. Studio A, SSL Room",value:l.resource,onChange:r=>y({...l,resource:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Limit"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",className:"w-20 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:l.limit,onChange:r=>y({...l,limit:r.target.value})}),e.jsxs("select",{className:"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:l.unit,onChange:r=>y({...l,unit:r.target.value}),children:[e.jsx("option",{value:"hours/week",children:"Hrs/Wk"}),e.jsx("option",{value:"hours/term",children:"Hrs/Term"}),e.jsx("option",{value:"bookings/week",children:"Bookings/Wk"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:b,className:"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2",children:[e.jsx(B,{size:18})," Add Rule"]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Applies To Role"}),e.jsxs("select",{className:"w-full md:w-1/2 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:l.role,onChange:r=>y({...l,role:r.target.value}),children:[e.jsx("option",{value:"Student",children:"All Students"}),e.jsx("option",{value:"Senior",children:"Seniors Only"}),e.jsx("option",{value:"Junior",children:"Juniors Only"}),e.jsx("option",{value:"Probation",children:"Probationary"})]})]})]}),e.jsx("div",{className:"space-y-3",children:o.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No active restrictions. Students have default access."}):o.map(r=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 flex justify-between items-center shadow-sm hover:shadow-md transition",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:r.resource}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300 mt-1",children:[e.jsxs("span",{className:"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 px-2 py-0.5 rounded text-xs font-bold border border-indigo-100 dark:border-indigo-800",children:[r.limit," ",r.unit]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{children:["Applies to: ",e.jsx("strong",{children:r.role})]})]})]}),e.jsx("button",{onClick:()=>i(r.id,r.resource),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:e.jsx(F,{size:18})})]},r.id))})]})}function wt({schoolId:t,logAction:s,user:o,userData:a}){const[u,d]=m.useState([]),[l,y]=m.useState(!0),[b,i]=m.useState(!1),[r,c]=m.useState({title:"",message:"",target:"All"});m.useEffect(()=>{if(!t||!x)return;(async()=>{y(!0);try{const{data:C,error:E}=await x.from("announcements").select("*").eq("school_id",t).order("created_at",{ascending:!1});if(E)throw E;d((C||[]).map(g=>({id:g.id,...g,schoolId:g.school_id,authorId:g.author_id,authorName:g.author_name,authorRole:g.author_role,createdAt:g.created_at})))}catch(C){console.error("Error loading announcements:",C)}y(!1)})()},[t]);const f=async()=>{if(!r.title.trim()||!r.message.trim()||!x){(!r.title.trim()||!r.message.trim())&&alert("Title and Message required.");return}const w=(o==null?void 0:o.id)||(o==null?void 0:o.uid);i(!0);try{const{data:C,error:E}=await x.from("announcements").insert({school_id:t,title:r.title,message:r.message,target:r.target,author_id:w,author_name:(a==null?void 0:a.displayName)||(a==null?void 0:a.effectiveDisplayName)||"School Admin",author_role:(a==null?void 0:a.activeProfileRole)||"Admin",created_at:new Date().toISOString()}).select().single();if(E)throw E;d(g=>[{id:C.id,...C,schoolId:C.school_id,authorId:C.author_id,authorName:C.author_name,authorRole:C.author_role,createdAt:C.created_at},...g]),s&&await s("Post Announcement",`Posted: ${r.title}`),c({title:"",message:"",target:"All"})}catch(C){console.error("Post failed:",C),alert("Failed to post announcement.")}i(!1)},j=async w=>{if(!(!confirm("Delete this announcement?")||!x))try{await x.from("announcements").delete().eq("id",w).eq("school_id",t),d(C=>C.filter(E=>E.id!==w)),s&&await s("Delete Announcement","Removed a post")}catch(C){console.error("Delete failed:",C)}};return l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading News..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Me,{size:18,className:"text-indigo-600"})," Post New Announcement"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"Headline / Title",value:r.title,onChange:w=>c({...r,title:w.target.value})})}),e.jsx("div",{className:"sm:w-1/4",children:e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white cursor-pointer",value:r.target,onChange:w=>c({...r,target:w.target.value}),children:[e.jsx("option",{value:"All",children:"Everyone"}),e.jsx("option",{value:"Student",children:"Students Only"}),e.jsx("option",{value:"EDUStaff",children:"Staff Only"})]})})]}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Write your message here...",value:r.message,onChange:w=>c({...r,message:w.target.value})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:f,disabled:b||!r.title,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition",children:b?"Posting...":e.jsxs(e.Fragment,{children:[e.jsx(Fe,{size:16})," Post Announcement"]})})})]})]}),e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsx("div",{className:"text-center text-gray-500 py-10 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No announcements yet."}):u.map(w=>{var C;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm relative group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold dark:text-white",children:w.title}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ce,{size:12})," ",w.authorName]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[w.target==="All"?e.jsx(Q,{size:12}):e.jsx(X,{size:12}),w.target]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:(C=w.createdAt)!=null&&C.toDate?w.createdAt.toDate().toLocaleDateString():"Just now"})]})]}),e.jsx("button",{onClick:()=>j(w.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition opacity-0 group-hover:opacity-100",title:"Delete Post",children:e.jsx(F,{size:16})})]}),e.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed bg-gray-50 dark:bg-black/20 p-3 rounded-lg",children:w.message})]},w.id)})})]})}function St({schoolId:t,logAction:s}){const[o,a]=m.useState([]),[u,d]=m.useState(!0),[l,y]=m.useState({name:"",address:"",website:"",contactEmail:""});m.useEffect(()=>{if(!t||!x)return;(async()=>{d(!0);try{const{data:c,error:f}=await x.from("school_partners").select("*").eq("school_id",t).order("name",{ascending:!0});if(f)throw f;a((c||[]).map(j=>({id:j.id,...j})))}catch(c){console.error("Error loading partners:",c)}d(!1)})()},[t]);const b=async()=>{if(!l.name||!x||!t){l.name||alert("Partner Name is required.");return}try{const{data:r,error:c}=await x.from("school_partners").insert({school_id:t,name:l.name,address:l.address||null,website:l.website||null,contact_email:l.contactEmail||null,status:"Approved"}).select().single();if(c)throw c;a(f=>[...f,{id:r.id,...r}]),s&&await s("Add Partner",`Added studio: ${l.name}`),y({name:"",address:"",website:"",contactEmail:""})}catch(r){console.error("Add partner failed:",r),alert("Failed to add partner.")}},i=async(r,c)=>{if(!(!confirm(`Remove ${c} from approved partners?`)||!x||!t))try{await x.from("school_partners").delete().eq("id",r).eq("school_id",t),a(f=>f.filter(j=>j.id!==r)),s&&await s("Remove Partner",`Removed: ${c}`)}catch(f){console.error("Delete failed:",f)}};return u?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Partners..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ne,{size:18,className:"text-indigo-600"})," Add Approved Partner"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio / Company Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"e.g. Sound City Studios",value:l.name,onChange:r=>y({...l,name:r.target.value})})]}),e.jsx("div",{children:e.jsx(dt,{label:"Address",value:l.address,onChange:r=>y({...l,address:r}),onSelect:r=>{y({...l,address:r.formattedAddress||r.displayName})},placeholder:"123 Main St...",showGeolocation:!1})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Contact Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{size:14,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-9 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"manager@studio.com",value:l.contactEmail,onChange:r=>y({...l,contactEmail:r.target.value})})]})]})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsxs("button",{onClick:b,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center gap-2 shadow-md transition",children:[e.jsx(B,{size:18})," Add Partner"]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.length===0?e.jsx("div",{className:"col-span-full text-center py-10 text-gray-500 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No partners added yet."}):o.map(r=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition group relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg truncate pr-8",children:r.name}),e.jsx("button",{onClick:()=>i(r.id,r.name),className:"text-gray-400 hover:text-red-500 absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition",children:e.jsx(F,{size:16})})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-300",children:[r.address&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{size:14,className:"mt-0.5 text-indigo-500 shrink-0"}),e.jsx("span",{className:"truncate",children:r.address})]}),r.contactEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{size:14,className:"text-green-500 shrink-0"}),e.jsx("a",{href:`mailto:${r.contactEmail}`,className:"hover:underline truncate",children:r.contactEmail})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t dark:border-gray-700 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase text-green-600 bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded border border-green-200 dark:border-green-800",children:"Approved"}),r.website&&e.jsx("a",{href:r.website,target:"_blank",rel:"noreferrer",className:"text-gray-400 hover:text-indigo-500",children:e.jsx(Be,{size:14})})]})]},r.id))})]})}function _t({schoolId:t,logAction:s,graderName:o}){const[a,u]=m.useState([]),[d,l]=m.useState(!0),[y,b]=m.useState(""),[i,r]=m.useState(null),[c,f]=m.useState([]),[j,w]=m.useState(!1),[C,E]=m.useState(!1),[g,p]=m.useState({technical:5,softSkills:5,notes:""});m.useEffect(()=>{if(!t||!x)return;(async()=>{l(!0);try{const{data:S,error:L}=await x.from("students").select("id, display_name, first_name, last_name, email, status").eq("school_id",t).order("display_name",{ascending:!0});if(L)throw L;u((S||[]).map(q=>({id:q.id,displayName:q.display_name,firstName:q.first_name,lastName:q.last_name,email:q.email,status:q.status})))}catch(S){console.error("Error loading students:",S)}l(!1)})()},[t]),m.useEffect(()=>{if(!i||!x||!t)return;(async()=>{w(!0);try{const{data:S,error:L}=await x.from("evaluations").select("*").eq("school_id",t).eq("student_id",i.id).order("date",{ascending:!1});if(L)throw L;f((S||[]).map(q=>({id:q.id,...q,softSkills:q.soft_skills,date:q.date})))}catch(S){console.error("Error loading history:",S)}w(!1)})(),E(!1),p({technical:5,softSkills:5,notes:""})},[i,t]);const v=async()=>{if(!(!i||!x||!t))try{const{data:k,error:S}=await x.from("evaluations").insert({school_id:t,student_id:i.id,technical:g.technical,soft_skills:g.softSkills,notes:g.notes||null,evaluator:o||"EDUStaff",date:new Date().toISOString()}).select().single();if(S)throw S;f(L=>[{id:k.id,...k,softSkills:k.soft_skills,date:k.date},...L]),s&&await s("Grade Student",`Graded ${i.displayName}: Tech(${g.technical}) Soft(${g.softSkills})`),E(!1),alert("Evaluation submitted successfully.")}catch(k){console.error("Grading failed:",k),alert("Failed to save evaluation.")}},_=a.filter(k=>{var S,L;return((S=k.displayName)==null?void 0:S.toLowerCase().includes(y.toLowerCase()))||((L=k.studentId)==null?void 0:L.toLowerCase().includes(y.toLowerCase()))}),N=k=>k>=8?"text-green-500":k>=5?"text-yellow-500":"text-red-500";return d?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roster..."}):e.jsxs("div",{className:"flex flex-col md:flex-row h-[600px] border dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-[#2c2e36] animate-in fade-in shadow-sm",children:[e.jsxs("div",{className:"w-full md:w-1/3 border-r dark:border-gray-700 flex flex-col bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Search Students...",value:y,onChange:k=>b(k.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:_.map(k=>e.jsxs("div",{onClick:()=>r(k),className:`p-3 px-4 cursor-pointer flex justify-between items-center transition border-b dark:border-gray-700/50 last:border-0
                                ${(i==null?void 0:i.id)===k.id?"bg-white dark:bg-[#2c2e36] border-l-4 border-l-indigo-600 shadow-sm":"hover:bg-gray-100 dark:hover:bg-gray-700"}
                            `,children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-bold text-sm ${(i==null?void 0:i.id)===k.id?"text-indigo-700 dark:text-white":"dark:text-gray-300"}`,children:k.displayName}),e.jsxs("div",{className:"text-xs text-gray-500",children:[k.cohort||"General"," • ",k.hoursLogged||0," hrs"]})]}),(i==null?void 0:i.id)===k.id&&e.jsx(Ge,{size:16,className:"text-indigo-500"})]},k.id))})]}),e.jsx("div",{className:"flex-1 flex flex-col relative",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-700 dark:text-indigo-300 font-bold",children:i.displayName[0]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold dark:text-white",children:i.displayName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",i.studentId||"N/A"]})]})]}),C?e.jsxs("button",{onClick:()=>E(!1),className:"text-gray-500 hover:text-gray-700 dark:hover:text-white flex items-center gap-2 text-sm font-bold",children:[e.jsx(He,{size:16})," View History"]}):e.jsxs("button",{onClick:()=>E(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(B,{size:16})," New Evaluation"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-white dark:bg-[#2c2e36]",children:[C&&e.jsxs("div",{className:"max-w-lg mx-auto space-y-6 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-lg border border-indigo-100 dark:border-indigo-800/50 mb-6",children:[e.jsx("h4",{className:"font-bold text-indigo-800 dark:text-indigo-300 mb-1",children:"New Assessment"}),e.jsxs("p",{className:"text-xs text-indigo-600 dark:text-indigo-400",children:["Rating performance for ",new Date().toLocaleDateString(),"."]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300",children:"Technical Proficiency"}),e.jsxs("span",{className:`font-bold ${N(g.technical)}`,children:[g.technical,"/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"1",className:"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",value:g.technical,onChange:k=>p({...g,technical:parseInt(k.target.value)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Knowledge of equipment, software, and signal flow."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300",children:"Soft Skills / Professionalism"}),e.jsxs("span",{className:`font-bold ${N(g.softSkills)}`,children:[g.softSkills,"/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"1",className:"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",value:g.softSkills,onChange:k=>p({...g,softSkills:parseInt(k.target.value)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Punctuality, attitude, communication, and client handling."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300 block mb-2",children:"Instructor Notes"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Detailed feedback...",value:g.notes,onChange:k=>p({...g,notes:k.target.value})})]}),e.jsxs("button",{onClick:v,className:"w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(Ee,{size:18})," Submit Evaluation"]})]})]}),!C&&e.jsx("div",{className:"space-y-4",children:j?e.jsx("p",{className:"text-center text-gray-500",children:"Loading history..."}):c.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed dark:border-gray-700 rounded-xl",children:[e.jsx(K,{size:32,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No evaluations recorded yet."}),e.jsx("button",{onClick:()=>E(!0),className:"text-indigo-500 font-bold text-sm mt-2 hover:underline",children:"Start first evaluation"})]}):c.map(k=>{var S;return e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-4 hover:shadow-md transition bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mb-1",children:(S=k.date)!=null&&S.toDate?k.date.toDate().toLocaleDateString():"Unknown Date"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium dark:text-gray-200",children:k.evaluator})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600",children:[e.jsx("div",{className:`font-bold ${N(k.technical)}`,children:k.technical}),e.jsx("div",{className:"text-[9px] text-gray-400 uppercase",children:"Tech"})]}),e.jsxs("div",{className:"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600",children:[e.jsx("div",{className:`font-bold ${N(k.softSkills)}`,children:k.softSkills}),e.jsx("div",{className:"text-[9px] text-gray-400 uppercase",children:"Soft"})]})]})]}),k.notes&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 border-t dark:border-gray-700 pt-3 mt-2",children:['"',k.notes,'"']})]},k.id)})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(K,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"Select a student to view history or submit grades."})]})})]})}function Ct({schoolId:t,logAction:s}){const[o,a]=m.useState(""),[u,d]=m.useState(!1),l=async()=>{var c;if(!o.trim()||!x||!t){o.trim()||alert("Please paste CSV data first.");return}d(!0);const b=o.trim().split(`
`);let i=0,r=0;try{const f=[];for(let j of b){const w=j.split(",");if(w.length>=3){const C=w[0].trim(),E=w[1].trim(),g=w[2].trim(),p=((c=w[3])==null?void 0:c.trim())||"General",v=`${E} ${g}`;C&&E?(f.push({school_id:t,email:C,display_name:v,first_name:E,last_name:g,cohort:p,student_id:null,status:"Enrolled",hours_logged:0,created_at:new Date().toISOString()}),i++):r++}else r++}if(f.length>0){const{error:j}=await x.from("students").insert(f);if(j)throw j}s&&await s("Batch Import",`Imported ${i} students. (${r} skipped)`),alert(`Import complete! Added ${i} students.`),a("")}catch(f){console.error("Import failed:",f),alert("Batch import encountered an error.")}d(!1)},y=async()=>{prompt("Type 'ROLLOVER' to confirm. This will archive current internship logs for all students.")==="ROLLOVER"&&(alert("Rollover process initiated. (This is a placeholder for the Cloud Function trigger)."),await s("Term Rollover","Initiated term archival"))};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ve,{size:18,className:"text-indigo-600"})," Batch Import Students"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-4 border border-blue-100 dark:border-blue-800 text-xs text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Format:"})," ",e.jsx("code",{children:"email, first_name, last_name, cohort"}),e.jsx("br",{}),"Example: ",e.jsx("code",{children:"student@test.edu, John, Doe, Fall 2024"})]}),e.jsx("textarea",{className:"w-full h-40 p-3 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono resize-y focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"Paste CSV data here...",value:o,onChange:b=>a(b.target.value),disabled:u}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:l,disabled:u||!o,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition",children:u?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:16})," Import Students"]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(We,{size:18,className:"text-orange-500"})," Term Management"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-gray-200 mb-1",children:"End of Term Rollover"}),e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Use this tool at the end of a semester or cohort period. It will:"}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 mt-2 space-y-1 ml-1",children:[e.jsx("li",{children:"Archive all active internship logs."}),e.jsx("li",{children:'Reset "Current Hours" counters (preserving Total Lifetime Hours).'}),e.jsx("li",{children:'Mark graduating students as "Alumni" (optional).'})]})]}),e.jsx("div",{className:"w-full md:w-auto",children:e.jsxs("button",{onClick:y,className:"w-full md:w-auto bg-red-50 hover:bg-red-100 dark:bg-red-900/20 dark:hover:bg-red-900/40 text-red-600 dark:text-red-400 px-4 py-3 rounded-lg font-bold text-xs flex items-center justify-center gap-2 border border-red-200 dark:border-red-800 transition",children:[e.jsx(Ke,{size:16})," Execute Rollover"]})})]})]})]})}function Et({schoolId:t}){const[s,o]=m.useState([]),[a,u]=m.useState(!0),[d,l]=m.useState(50);m.useEffect(()=>{if(!t||!x)return;(async()=>{u(!0);try{const{data:i,error:r}=await x.from("audit_logs").select("*").eq("school_id",t).order("timestamp",{ascending:!1}).limit(d);if(r)throw r;o((i||[]).map(c=>({id:c.id,...c,adminName:c.admin_name,timestamp:c.timestamp?new Date(c.timestamp):null})))}catch(i){console.error("Error loading audit logs:",i)}u(!1)})()},[t,d]);const y=b=>b.includes("Delete")||b.includes("Remove")?"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400":b.includes("Create")||b.includes("Add")?"text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400":b.includes("Update")||b.includes("Edit")?"text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 bg-gray-100 dark:bg-gray-700 dark:text-gray-300";return a&&s.length===0?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Audit Trail..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(ve,{size:16}),e.jsxs("span",{children:["Showing last ",e.jsx("strong",{children:s.length})," actions"]})]}),e.jsxs("button",{onClick:()=>oe(s,"audit_logs"),className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(Le,{size:14})," Export Log"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Timestamp"}),e.jsx("th",{className:"p-3",children:"Admin / Staff"}),e.jsx("th",{className:"p-3",children:"Action Type"}),e.jsx("th",{className:"p-3",children:"Details"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-gray-500",children:"No audit history found."})}):s.map(b=>{var i;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-gray-500 whitespace-nowrap flex items-center gap-2",children:[e.jsx(J,{size:14,className:"opacity-50"}),(i=b.timestamp)!=null&&i.toDate?b.timestamp.toDate().toLocaleString():"N/A"]}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{size:14,className:"text-indigo-500"}),b.adminName||"System"]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider ${y(b.action)}`,children:b.action})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-300 font-mono text-xs",children:b.details})]},b.id)})})]})}),s.length>=d&&e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{onClick:()=>l(b=>b+50),className:"text-xs font-bold text-indigo-600 hover:underline",children:"Load Older Logs"})})]})}function Lt({schoolId:t,initialData:s,logAction:o,refreshMeta:a}){const[u,d]=m.useState(s||{}),{uploadImage:l,uploading:y}=it();m.useEffect(()=>{s&&d(s)},[s]);const b=async()=>{if(!(!x||!t))try{const c={name:u.name,primary_color:u.primaryColor,website:u.website||null,contact_email:u.contactEmail||null,address:u.address||null,description:u.description||null,enabled_features:u.enabledFeatures||{},updated_at:new Date().toISOString()},{error:f}=await x.from("schools").update(c).eq("id",t);if(f)throw f;alert("School settings updated successfully."),a&&a(u),o&&await o("Update Settings","Updated school configuration")}catch(c){console.error("Update failed:",c),alert("Failed to update school settings.")}},i=async c=>{const f=c.target.files[0];if(!(!f||!t||!x))try{const j=await l(f,`schools/${t}/images/logo`);j&&(await x.from("schools").update({logo_url:j,updated_at:new Date().toISOString()}).eq("id",t),d(w=>({...w,logoURL:j,logo_url:j})),a&&a({...u,logoURL:j}),o&&await o("Update Logo","Uploaded new school logo"))}catch(j){console.error("Logo upload failed",j),alert("Failed to upload logo.")}},r=c=>{d(f=>({...f,[c]:!f[c]}))};return!u.name&&!s?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Settings..."}):e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("section",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"h-32 w-32 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300 dark:border-gray-600",children:[u.logoURL?e.jsx("img",{src:u.logoURL,className:"h-full w-full object-contain",alt:"Logo"}):e.jsx(G,{size:40,className:"text-gray-400"}),y&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white text-xs",children:"Uploading..."})]}),e.jsxs("label",{className:"absolute bottom-2 right-2 bg-indigo-600 p-2 rounded-full text-white cursor-pointer shadow-lg hover:bg-indigo-700 transition",children:[e.jsx(Ye,{size:14}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:i,disabled:y})]})]}),e.jsxs("div",{className:"flex-1 w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"School Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:u.name||"",onChange:c=>d({...u,name:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Primary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",className:"h-10 w-10 p-0 border-0 rounded cursor-pointer",value:u.primaryColor||"#4f46e5",onChange:c=>d({...u,primaryColor:c.target.value})}),e.jsx("input",{className:"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono",value:u.primaryColor||"",onChange:c=>d({...u,primaryColor:c.target.value})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:u.address||"",onChange:c=>d({...u,address:c.target.value})})]})]})]})]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Website"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:u.website||"",onChange:c=>d({...u,website:c.target.value}),placeholder:"https://"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Contact Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:u.contactEmail||"",onChange:c=>d({...u,contactEmail:c.target.value}),placeholder:"admin@school.edu"})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2",children:[e.jsx(K,{size:18,className:"text-indigo-600"})," Academic Structure"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Cohort Mode"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:u.cohortMode||"Semester",onChange:c=>d({...u,cohortMode:c.target.value}),children:[e.jsx("option",{value:"Semester",children:"Semester Based"}),e.jsx("option",{value:"Trimester",children:"Trimester"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Rolling",children:"Rolling"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Grading Scale"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:u.gradingScale||"1-10",onChange:c=>d({...u,gradingScale:c.target.value}),children:[e.jsx("option",{value:"1-10",children:"Numeric (1-10)"}),e.jsx("option",{value:"Pass/Fail",children:"Pass/Fail"}),e.jsx("option",{value:"Letter",children:"Letter Grades"})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2",children:[e.jsx(Je,{size:18,className:"text-indigo-600"})," Operational Rules"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Strict Geofencing"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Require GPS location match for clock-in"})]}),e.jsx("button",{onClick:()=>r("geofencing"),children:u.geofencing?e.jsx(pe,{size:24,className:"text-indigo-600"}):e.jsx(be,{size:24,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Supervisor Approval"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Require partner studio sign-off on hours"})]}),e.jsx("button",{onClick:()=>r("requireApproval"),children:u.requireApproval?e.jsx(pe,{size:24,className:"text-indigo-600"}):e.jsx(be,{size:24,className:"text-gray-400"})})]})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:b,className:"w-full sm:w-auto bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(Ee,{size:18})," Save Configuration"]})})]})}function ze({user:t,userData:s,allowedTabs:o,staffTitle:a,currentView:u}){let d;try{d=te()}catch{d=null}const l=(d==null?void 0:d.user)||t,y=(d==null?void 0:d.userData)||s,{schoolId:b}=ee(),i=u?u.replace("edu-",""):o?o[0]:"overview",[r,c]=m.useState(b||null),[f,j]=m.useState(null),[w,C]=m.useState([]),[E,g]=m.useState(!1),[p,v]=m.useState({name:"",address:"",primaryColor:"#4f46e5"}),_=lt(y);m.useEffect(()=>{_&&x&&(async()=>{try{const{data:L,error:q}=await x.from("schools").select("*").order("name");if(q)throw q;const R=L||[];C(R),!r&&!b&&R.length>0&&c(R[0].id)}catch(L){console.error("Error fetching schools list:",L)}})()},[_,r,b]),m.useEffect(()=>{if(!r||!x)return;(async()=>{try{const{data:L,error:q}=await x.from("schools").select("*").eq("id",r).single();if(q)throw q;L&&j(L)}catch(L){console.error("Error loading school meta:",L)}})()},[r]);const N=async(S,L)=>{if(!(!r||!x))try{const q=(l==null?void 0:l.id)||(l==null?void 0:l.uid);await x.from("audit_logs").insert({school_id:r,action:S,details:L,admin_id:q,admin_name:`${(y==null?void 0:y.firstName)||""} ${(y==null?void 0:y.lastName)||""}`.trim(),created_at:new Date().toISOString()})}catch(q){console.error("Failed to log action:",q)}},k=async()=>{var S;if(!(!p.name||!x)){if(!_){alert("Only SeshNx Platform Administrators can create new schools. Please contact a platform administrator."),g(!1);return}try{const{data:L,error:q}=await x.from("schools").insert({name:p.name,address:p.address||null,primary_color:p.primaryColor||"#4f46e5",required_hours:100,created_at:new Date().toISOString()}).select().single();if(q)throw q;if(!L)throw new Error("School creation failed - no data returned");const{error:R}=await x.from("school_roles").insert({school_id:L.id,name:"Admin",color:"#dc2626",permissions:ie.map(P=>P.id)});R&&console.error("Error creating default admin role:",R),C(P=>[...P,L]),c(L.id),g(!1),v({name:"",address:"",primaryColor:"#4f46e5"})}catch(L){console.error("Error creating school:",L),(S=L.message)!=null&&S.includes("permission")||L.code==="PGRST301"?alert("Permission denied. Only SeshNx Platform Administrators can create new schools."):alert("Failed to create school. Please try again.")}}};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6 relative overflow-hidden",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2 z-10",children:f!=null&&f.logoURL?e.jsx("img",{src:f.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(G,{size:40,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left z-10",children:[e.jsxs("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight flex items-center justify-center md:justify-start gap-3",children:[(f==null?void 0:f.name)||"Select School",_&&!a&&e.jsxs("div",{className:"relative group",children:[e.jsx("select",{className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",value:r||"",onChange:S=>c(S.target.value),children:w.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 border-none rounded-lg text-sm font-bold p-1 px-2 flex items-center gap-1 pointer-events-none group-hover:bg-gray-200 dark:group-hover:bg-gray-600 transition",children:[e.jsx("span",{children:"Switch"})," ",e.jsx(X,{size:10})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400 mt-1",children:[a?e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:[a," Dashboard"]}):e.jsx("span",{className:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Global Admin Mode"}),(f==null?void 0:f.address)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{size:12})," ",f.address]})]})]})]}),_&&e.jsx("div",{className:"z-10",children:e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 transition shadow-md",children:[e.jsx(B,{size:16})," New School"]})}),e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-indigo-600/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"})]}),e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 min-h-[400px] p-4",children:r?e.jsxs(e.Fragment,{children:[i==="overview"&&e.jsx(ut,{schoolId:r,schoolData:f}),i==="roster"&&e.jsx(ht,{schoolId:r,logAction:N}),i==="hours"&&e.jsx(ft,{schoolId:r}),i==="courses"&&e.jsx(yt,{schoolId:r,logAction:N}),i==="learning-paths"&&e.jsx(jt,{schoolId:r,logAction:N}),i==="instructors"&&e.jsx(Nt,{schoolId:r,logAction:N}),i==="roles"&&e.jsx(vt,{schoolId:r,logAction:N}),i==="resources"&&e.jsx(kt,{schoolId:r,logAction:N}),i==="news"&&e.jsx(wt,{schoolId:r,logAction:N,user:l,userData:y}),i==="partners"&&e.jsx(St,{schoolId:r,logAction:N}),i==="evaluations"&&e.jsx(_t,{schoolId:r,logAction:N,graderName:y.displayName}),i==="cohorts"&&e.jsx(Ct,{schoolId:r,logAction:N}),i==="audit"&&e.jsx(Et,{schoolId:r}),i==="settings"&&e.jsx(Lt,{schoolId:r,initialData:f,logAction:N,refreshMeta:S=>j(L=>({...L,...S}))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-gray-500",children:[e.jsx(G,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"Please select or create a school to manage."})]})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Create School"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"School Name",value:p.name,onChange:S=>v({...p,name:S.target.value})}),e.jsx("button",{onClick:k,className:"w-full bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700",children:"Create"}),e.jsx("button",{onClick:()=>g(!1),className:"w-full text-gray-500 text-sm hover:underline",children:"Cancel"})]})})]})}const Ut=Object.freeze(Object.defineProperty({__proto__:null,default:ze},Symbol.toStringTag,{value:"Module"}));function At({user:t,userData:s,currentView:o}){let a;try{a=te()}catch{a=null}const u=(a==null?void 0:a.user)||t,d=(a==null?void 0:a.userData)||s,{myPermissions:l,staffProfile:y}=ee(),b={manage_roster:"roster",manage_enrollment:"cohorts",approve_hours:"hours",manage_partners:"partners",grade_students:"evaluations",post_announcements:"news",manage_resources:"resources",manage_staff:"instructors",view_audit:"audit",edit_settings:"settings"},i=l.includes("ALL")?Object.values(b):l.map(r=>b[r]).filter(Boolean);return i.length===0&&!l.includes("ALL")?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-gray-500",children:[e.jsx(_e,{size:48,className:"mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-bold",children:"Access Restricted"}),e.jsx("p",{children:"You are listed as staff but have no assigned permissions."})]}):e.jsx(ze,{user:u,userData:d,allowedTabs:i,staffTitle:y==null?void 0:y.roleName,currentView:o})}const Ot=Object.freeze(Object.defineProperty({__proto__:null,default:At},Symbol.toStringTag,{value:"Module"}));export{dt as A,Dt as E,It as S,Pt as _,it as a,Tt as b,Ut as c,Ot as d,$t as f,ee as u};
