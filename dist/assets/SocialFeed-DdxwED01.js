import{r as n,j as e,o as de,a as ue,bg as pe,bh as be,_ as re,K as fe,T as ye,m as ve,aL as je,h as Ne,bi as we,aI as ke,bj as V,B as se,X as ie,l as Ce,z as Se,V as Ie,aT as Le,L as Z,bk as Re,U as le,aP as Fe}from"./vendor-C40xFgTg.js";import{q as H,K,C as B,G as ce,I as me,H as xe,M as U,A as Y,B as Pe,X as Oe,V as q,E as J,T as ze,L as Q,k as $e}from"./vendor-firebase-CMJMOSQ_.js";import{b as T,d as I,U as D,g as oe,u as Me}from"./chat-CcyNTB2o.js";import{S as ne,R as Te}from"./ReportModal-DoEeV0t_.js";import{c as he,u as Ee,F as Ae}from"./index-4fuDHSE7.js";import{m as v,A as X}from"./vendor-framer-0jBYu9jQ.js";import{b as _e}from"./edu-esCIx5ew.js";import{M as We}from"./Inputs-Lae8QM8u.js";import"./vendor-convex-CkYEP-FB.js";import"./vendor-audio-Bu2lAtPy.js";import"./vendor-maps-OcfH4d_h.js";function Ge({post:a,currentUser:t,currentUserData:i,blockedUsers:b,onCountChange:E}){const[f,j]=n.useState([]),[h,L]=n.useState(""),[c,R]=n.useState(!1);n.useEffect(()=>{const d=H(B(I,`artifacts/${T}/public/data/posts/${a.id}/replies`),K("timestamp","asc")),g=ce(d,C=>{const O=C.docs.map(S=>({id:S.id,...S.data()})).filter(S=>!(b!=null&&b.includes(S.userId)));j(O),E(O.length)});return()=>g()},[a.id]);const N=async d=>{var C;if(d.preventDefault(),!h.trim()||!(t!=null&&t.uid))return;R(!0);const g=(i==null?void 0:i.effectiveDisplayName)||(i==null?void 0:i.firstName)||(t==null?void 0:t.displayName)||"User";try{await me(B(I,`artifacts/${T}/public/data/posts/${a.id}/replies`),{text:h,userId:t.uid,displayName:g,userPhoto:(i==null?void 0:i.photoURL)||null,timestamp:xe()}),a.userId!==t.uid&&he({targetUserId:a.userId,type:"comment",fromUserId:t.uid,fromUserName:g,fromUserPhoto:i==null?void 0:i.photoURL,postId:a.id,postPreview:(C=a.text)==null?void 0:C.substring(0,50),message:"commented on your post"}),L("")}catch(u){console.error(u)}R(!1)},P=async d=>{if(window.confirm("Delete comment?"))try{await U(Y(I,`artifacts/${T}/public/data/posts/${a.id}/replies`,d))}catch(g){console.error("Delete comment error:",g)}};return e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] border-t dark:border-gray-700 p-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-4 mb-4 max-h-80 overflow-y-auto custom-scrollbar pr-2",children:[f.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-2",children:"No comments yet. Be the first!"}),f.map(d=>e.jsxs("div",{className:"group flex gap-3 text-sm",children:[e.jsx(D,{src:d.userPhoto,name:d.displayName,size:"xs",className:"shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card border dark:border-gray-700 p-3 rounded-2xl rounded-tl-none inline-block max-w-full",children:[e.jsxs("div",{className:"flex justify-between items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-bold dark:text-white text-xs truncate",children:d.displayName}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0",children:d.timestamp?new Date(d.timestamp.toMillis()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"..."})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 break-words",children:d.text})]}),e.jsxs("div",{className:"flex gap-3 mt-1 ml-2",children:[e.jsx("button",{className:"text-[10px] font-bold text-gray-500 hover:text-brand-blue transition",children:"Reply"}),d.userId===(t==null?void 0:t.uid)&&e.jsx("button",{onClick:()=>P(d.id),className:"text-[10px] font-bold text-gray-400 hover:text-red-500 transition",children:"Delete"})]})]})]},d.id))]}),e.jsxs("form",{onSubmit:N,className:"flex gap-2",children:[e.jsx(D,{src:i==null?void 0:i.photoURL,name:(i==null?void 0:i.firstName)||"You",size:"xs",className:"shrink-0 hidden sm:block"}),e.jsx("input",{className:"flex-1 bg-white dark:bg-dark-card border dark:border-gray-600 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition",placeholder:"Write a comment...",value:h,onChange:d=>L(d.target.value)}),e.jsx("button",{type:"submit",disabled:!h.trim()||c,className:"bg-brand-blue text-white p-2 rounded-full hover:bg-blue-600 disabled:opacity-50 transition shadow-sm",children:e.jsx(de,{size:16,className:c?"animate-pulse":""})})]})]})}const Ve=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"],Ye=a=>a?a.split(/(\s+)/).map((t,i)=>t.match(/^#\w+/)?e.jsx("span",{className:"text-brand-blue font-bold cursor-pointer hover:underline",children:t},i):t.match(/^@\w+/)?e.jsx("span",{className:"text-purple-600 font-bold cursor-pointer hover:underline",children:t},i):t):null,Be={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},exit:{opacity:0,scale:.95,transition:{duration:.2}}};function qe({post:a,currentUser:t,currentUserData:i,openPublicProfile:b,onReport:E,isFollowingAuthor:f,onToggleFollow:j}){var ee,ae,te;const[h,L]=n.useState(!1),[c,R]=n.useState(a.commentCount||0),[N,P]=n.useState(!1),[d,g]=n.useState(!1),[C,u]=n.useState(!1),[O,S]=n.useState(!1),[l,p]=n.useState(!1),m=n.useRef(null),x=n.useRef(null),$=a.userId===(t==null?void 0:t.uid),w=(ee=a.reactions)==null?void 0:ee[t==null?void 0:t.uid],A=a.reactions?Object.values(a.reactions).reduce((s,r)=>(s[r]=(s[r]||0)+1,s),{}):{},o=Object.values(A).reduce((s,r)=>s+r,0);n.useEffect(()=>{if(!(t!=null&&t.uid))return;(async()=>{try{const r=Y(I,oe(t.uid).savedPosts,a.id),F=await Pe(r);P(F.exists())}catch(r){console.error("Error checking saved status:",r)}})()},[t==null?void 0:t.uid,a.id]),n.useEffect(()=>{const s=r=>{m.current&&!m.current.contains(r.target)&&g(!1),x.current&&!x.current.contains(r.target)&&u(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const M=async s=>{var F;if(g(!1),!(t!=null&&t.uid))return;const r=Y(I,`artifacts/${T}/public/data/posts/${a.id}`);try{const z={},ge=!!w;w===s?(z[`reactions.${t.uid}`]=Oe(),z.reactionCount=q(-1)):(z[`reactions.${t.uid}`]=s,w||(z.reactionCount=q(1)),!ge&&!$&&he({targetUserId:a.userId,type:"like",fromUserId:t.uid,fromUserName:(i==null?void 0:i.effectiveDisplayName)||(i==null?void 0:i.firstName)||"Someone",fromUserPhoto:i==null?void 0:i.photoURL,postId:a.id,postPreview:(F=a.text)==null?void 0:F.substring(0,50),message:`reacted ${s} to your post`})),await J(r,z)}catch(z){console.error("Reaction failed",z),V.error("Couldn't add reaction")}},_=async()=>{var s,r;if(!(!(t!=null&&t.uid)||l)){p(!0);try{const F=Y(I,oe(t.uid).savedPosts,a.id),z=Y(I,`artifacts/${T}/public/data/posts/${a.id}`);N?(await U(F),await J(z,{saveCount:q(-1)}),P(!1),V.success("Removed from saved")):(await ze(F,{postId:a.id,authorId:a.userId,authorName:a.displayName,preview:((s=a.text)==null?void 0:s.substring(0,100))||"Media post",savedAt:new Date,hasMedia:!!((r=a.attachments)!=null&&r.length||a.imageUrl||a.audioUrl)}),await J(z,{saveCount:q(1)}),P(!0),V.success("Post saved!"))}catch(F){console.error("Save failed",F),V.error("Couldn't save post")}p(!1)}},W=async()=>{var r;const s=`${window.location.origin}/post/${a.id}`;if(navigator.share)try{await navigator.share({title:`Post by ${a.displayName}`,text:((r=a.text)==null?void 0:r.substring(0,100))||"Check out this post",url:s})}catch(F){F.name!=="AbortError"&&y(s)}else y(s)},y=s=>{navigator.clipboard.writeText(s),S(!0),V.success("Link copied to clipboard!"),setTimeout(()=>S(!1),2e3)},G=async()=>{if($&&window.confirm("Are you sure you want to delete this post?"))try{const s=Y(I,`artifacts/${T}/public/data/posts/${a.id}`);await U(s),V.success("Post deleted")}catch(s){console.error("Delete failed:",s),V.error("Couldn't delete post")}};return e.jsxs(v.div,{variants:Be,initial:"hidden",animate:"show",exit:"exit",layout:!0,className:"bg-white dark:bg-dark-card border dark:border-gray-700 rounded-xl overflow-visible shadow-sm mb-4 relative",children:[e.jsxs("div",{className:"p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden cursor-pointer shrink-0",onClick:()=>b(a.userId),children:a.authorPhoto?e.jsx("img",{src:a.authorPhoto,className:"h-full w-full object-cover",alt:"avatar"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-tr from-brand-blue to-purple-500 flex items-center justify-center text-white font-bold",children:((ae=a.displayName)==null?void 0:ae[0])||e.jsx(ue,{size:16})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm hover:underline decoration-brand-blue cursor-pointer truncate",onClick:()=>b(a.userId),children:a.displayName}),!$&&j&&!f&&e.jsx("button",{onClick:s=>{s.stopPropagation(),j()},className:"text-xs font-bold text-brand-blue hover:text-blue-700 transition shrink-0",children:"â€¢ Follow"})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"truncate",children:a.role}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"shrink-0",children:a.timestamp?new Date(a.timestamp.toMillis?a.timestamp.toMillis():a.timestamp).toLocaleDateString():"Just now"})]})]})]}),e.jsxs("div",{className:"relative",ref:x,children:[e.jsx("button",{className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>u(!C),children:e.jsx(pe,{size:20})}),e.jsx(X,{children:C&&e.jsxs(v.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden z-50",children:[e.jsxs("button",{onClick:()=>{y(`${window.location.origin}/post/${a.id}`),u(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(be,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Copy link"})]}),!$&&e.jsxs(e.Fragment,{children:[j&&e.jsxs("button",{onClick:()=>{j(),u(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(re,{size:16,className:"text-gray-400"}),e.jsxs("span",{className:"dark:text-gray-200",children:[f?"Unfollow":"Follow"," ",(te=a.displayName)==null?void 0:te.split(" ")[0]]})]}),e.jsxs("button",{onClick:()=>{E(),u(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(fe,{size:16}),e.jsx("span",{children:"Report post"})]})]}),$&&e.jsxs("button",{onClick:()=>{G(),u(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(ye,{size:16}),e.jsx("span",{children:"Delete post"})]})]})})]})]}),e.jsxs("div",{className:"px-4 pb-2",children:[a.text&&e.jsx("p",{className:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap text-sm leading-relaxed mb-3",children:Ye(a.text)}),a.attachments&&a.attachments.length>0&&e.jsx("div",{className:`grid gap-2 mb-3 ${a.attachments.length>1?"grid-cols-2":"grid-cols-1"}`,children:a.attachments.map((s,r)=>e.jsxs("div",{className:"rounded-lg overflow-hidden bg-transparent relative",children:[s.type==="image"&&e.jsx("img",{src:s.url,className:"w-full h-full object-cover max-h-96",alt:"content"}),s.type==="video"&&e.jsx("video",{src:s.url,controls:!0,className:"w-full h-full max-h-96 bg-black"}),s.type==="audio"&&e.jsx("div",{className:"w-full",children:e.jsx(ne,{audioUrl:s.url,fileName:s.name||"Audio Track"})})]},r))}),a.audioUrl&&!a.attachments&&e.jsx("div",{className:"rounded-lg overflow-hidden bg-transparent mb-3",children:e.jsx(ne,{audioUrl:a.audioUrl,fileName:a.audioName||"Track"})}),a.imageUrl&&!a.attachments&&e.jsx("img",{src:a.imageUrl,className:"rounded-lg w-full mb-3 border dark:border-gray-700",alt:"legacy content"})]}),(o>0||a.saveCount>0)&&e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:Object.entries(A).map(([s,r])=>e.jsxs(v.div,{initial:{scale:0},animate:{scale:1},className:`text-xs px-2 py-1 rounded-full border flex items-center gap-1 ${w===s?"bg-blue-50 border-blue-200 dark:bg-blue-900/30 dark:border-blue-800":"bg-gray-50 border-gray-100 dark:bg-gray-800 dark:border-gray-700"} dark:text-gray-300`,children:[e.jsx("span",{children:s}),e.jsx("span",{className:"font-bold",children:r})]},s))}),a.saveCount>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[a.saveCount," save",a.saveCount!==1?"s":""]})]}),e.jsxs("div",{className:"px-4 py-3 border-t dark:border-gray-700 flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(v.button,{whileTap:{scale:.9},onClick:()=>g(!d),className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg ${w?"text-blue-600 bg-blue-50 dark:bg-blue-900/20":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[w?e.jsx("span",{className:"text-lg",children:w}):e.jsx(ve,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:w?"Reacted":"React"})]}),e.jsx(X,{children:d&&e.jsx(v.div,{ref:m,initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},className:"absolute bottom-full left-0 mb-2 bg-white dark:bg-gray-800 shadow-xl rounded-full p-2 flex gap-1 sm:gap-2 z-50 border dark:border-gray-600 origin-bottom-left",children:Ve.map(s=>e.jsx(v.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:r=>{r.stopPropagation(),M(s)},className:`text-xl p-1 sm:p-1.5 rounded-full ${w===s?"bg-blue-100 dark:bg-blue-900":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:s},s))})})]}),e.jsxs(v.button,{whileTap:{scale:.95},onClick:()=>L(!h),className:"flex items-center gap-1.5 sm:gap-2 text-sm font-medium text-gray-500 hover:text-brand-blue transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx(je,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:c>0?c:"Comment"}),c>0&&e.jsx("span",{className:"sm:hidden",children:c})]}),e.jsxs(v.button,{whileTap:{scale:.95},onClick:W,className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 ${O?"text-green-500":"text-gray-500 hover:text-green-500"}`,children:[O?e.jsx(Ne,{size:18}):e.jsx(we,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:O?"Copied!":"Share"})]})]}),e.jsx(v.button,{whileTap:{scale:.8},onClick:_,disabled:l,className:`${N?"text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"} transition p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full disabled:opacity-50`,title:N?"Remove from saved":"Save post",children:e.jsx(ke,{size:18,fill:N?"currentColor":"none"})})]}),e.jsx(X,{children:h&&e.jsx(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx(Ge,{post:a,currentUser:t,currentUserData:i,blockedUsers:[],onCountChange:R})})})]})}function He({user:a,userData:t,onPost:i}){const[b,E]=n.useState(""),[f,j]=n.useState([]),[h,L]=n.useState(!1),[c,R]=n.useState([]),[N,P]=n.useState(null),[d,g]=n.useState(!1),{uploadMedia:C}=Me(),u=(l,p)=>{if(l.target.files&&l.target.files[0]){const m=l.target.files[0],x=URL.createObjectURL(m);j([...f,{file:m,type:p,previewUrl:x}])}},O=l=>{j(f.filter((p,m)=>m!==l))},S=async()=>{if(!(!b.trim()&&f.length===0)){g(!0);try{const l=await Promise.all(f.map(async x=>{const $=x.type==="video"?"postVideos":x.type==="audio"?"postAudio":"postImages",w=`artifacts/${a.uid}/${$}`,A=await C(x.file,w);return A?{...A,type:x.type}:null}));let p=null;if(N){const x=await C(N,`artifacts/${a.uid}/postPresets`);p=x==null?void 0:x.url}const m={text:b,attachments:l.filter(x=>x!==null),seshFx:h&&(c.length>0||p)?{plugins:c,presetUrl:p,presetName:N?N.name:null}:null};await i(m),E(""),j([]),L(!1),R([]),P(null)}catch(l){console.error("Error creating post:",l),alert("Failed to create post. Please try again.")}finally{g(!1)}}};return e.jsx("div",{className:"bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-gray-700 shadow-sm mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden shrink-0",children:t!=null&&t.photoURL?e.jsx("img",{src:t.photoURL,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-brand-blue"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{className:"w-full bg-transparent outline-none text-gray-900 dark:text-white placeholder-gray-500 min-h-[80px] resize-none",placeholder:"What's creating sound today? (#tags @mentions)",value:b,onChange:l=>E(l.target.value)}),f.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:f.map((l,p)=>e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black/5 border dark:border-gray-600 aspect-video group flex items-center justify-center",children:[l.type==="image"&&e.jsx("img",{src:l.previewUrl,className:"h-full w-full object-cover"}),l.type==="video"&&e.jsx("video",{src:l.previewUrl,className:"h-full w-full object-cover"}),l.type==="audio"&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-brand-blue bg-gray-100 dark:bg-gray-800 w-full h-full",children:[e.jsx(se,{size:32}),e.jsx("span",{className:"text-xs text-gray-500 mt-2 truncate max-w-[90%] px-2",children:l.file.name})]}),e.jsx("button",{onClick:()=>O(p),className:"absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-red-500",children:e.jsx(ie,{size:12})})]},p))}),h&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-3 border border-blue-100 dark:border-blue-800/50 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue uppercase",children:"SeshFx Data"}),e.jsx("button",{onClick:()=>L(!1),children:e.jsx(ie,{size:14,className:"text-gray-400 hover:text-brand-blue"})})]}),e.jsx(We,{label:"",options:_e,initialValues:c,onChange:(l,p)=>R(p)}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(Ce,{size:14,className:"text-gray-400"}),e.jsx("input",{type:"file",className:"text-xs text-gray-500 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:bg-white dark:file:bg-gray-700 dark:file:text-white",onChange:l=>P(l.target.files[0])})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-brand-blue cursor-pointer transition",title:"Add Image",children:[e.jsx(Se,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:l=>u(l,"image")})]}),e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-green-500 cursor-pointer transition",title:"Add Video",children:[e.jsx(Ie,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:l=>u(l,"video")})]}),e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-purple-500 cursor-pointer transition",title:"Add Audio Track",children:[e.jsx(se,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"audio/*",onChange:l=>u(l,"audio")})]}),e.jsx("button",{onClick:()=>L(!h),className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition ${h?"bg-blue-50 dark:bg-blue-900/20 text-brand-blue":"text-gray-400"}`,title:"Add Plugin Data",children:e.jsx(Le,{size:20})})]}),e.jsx("button",{onClick:S,disabled:d||!b&&f.length===0,className:"bg-brand-blue text-white px-5 py-1.5 rounded-full font-bold text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition",children:d?e.jsx(Z,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:["Post ",e.jsx(de,{size:14})]})})]})]})]})})}const k={FOR_YOU:"for_you",FOLLOWING:"following"};function ia({user:a,userData:t,openPublicProfile:i}){const[b,E]=n.useState([]),[f,j]=n.useState(!0),[h,L]=n.useState(null),[c,R]=n.useState(k.FOR_YOU),[N,P]=n.useState([]),[d,g]=n.useState(!1),{following:C,stats:u,loading:O,isFollowing:S,toggleFollow:l,getFollowingIds:p}=Ee(a==null?void 0:a.uid,t),m=n.useMemo(()=>p(),[C]);n.useEffect(()=>{c===k.FOLLOWING&&m.length===0&&(a!=null&&a.uid)&&x()},[c,m.length,a==null?void 0:a.uid]);const x=async()=>{g(!0);try{const o=H(B(I,`artifacts/${T}/public/data/posts`),K("timestamp","desc"),Q(20)),M=await $e(o),_=new Map;M.docs.forEach(W=>{const y=W.data();y.userId!==(a==null?void 0:a.uid)&&!_.has(y.userId)&&_.set(y.userId,{userId:y.userId,displayName:y.displayName,photoURL:y.authorPhoto,role:y.role})}),P(Array.from(_.values()).slice(0,5))}catch(o){console.error("Error loading suggestions:",o)}g(!1)};n.useEffect(()=>{j(!0);const o=`artifacts/${T}/public/data/posts`;let M;c===k.FOLLOWING&&m.length>0?M=H(B(I,o),K("timestamp","desc"),Q(50)):M=H(B(I,o),K("timestamp","desc"),Q(20));const _=ce(M,W=>{let y=W.docs.map(G=>({id:G.id,...G.data()}));c===k.FOLLOWING&&m.length>0&&(y=y.filter(G=>m.includes(G.userId)||G.userId===(a==null?void 0:a.uid))),E(y),j(!1)},W=>{console.error("Feed error:",W),j(!1)});return()=>_()},[c,m,a==null?void 0:a.uid]);const $=async o=>{if(a)try{await me(B(I,`artifacts/${T}/public/data/posts`),{...o,userId:a.uid,displayName:(t==null?void 0:t.effectiveDisplayName)||`${(t==null?void 0:t.firstName)||"User"} ${(t==null?void 0:t.lastName)||""}`.trim(),authorPhoto:(t==null?void 0:t.photoURL)||null,role:(t==null?void 0:t.activeProfileRole)||"User",timestamp:xe(),reactions:{},reactionCount:0,commentCount:0,saveCount:0,visibility:"Public"})}catch(M){console.error("Failed to post:",M),alert("Could not post update. Please try again.")}},w={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},A=({suggestedUser:o})=>e.jsxs(v.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 hover:border-brand-blue/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1 min-w-0",onClick:()=>i==null?void 0:i(o.userId),children:[e.jsx(D,{src:o.photoURL,name:o.displayName,size:"md"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate hover:text-brand-blue transition",children:o.displayName}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:o.role})]})]}),e.jsx(Ae,{isFollowing:S(o.userId),onToggle:()=>l(o.userId,o),size:"sm",variant:"default"})]});return e.jsxs("div",{className:"max-w-2xl mx-auto pb-20",children:[e.jsx(He,{user:a,userData:t,onPost:$}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("button",{onClick:()=>R(k.FOR_YOU),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${c===k.FOR_YOU?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(Re,{size:16}),e.jsx("span",{children:"For You"})]}),e.jsxs("button",{onClick:()=>R(k.FOLLOWING),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${c===k.FOLLOWING?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(le,{size:16}),e.jsx("span",{children:"Following"}),u.followingCount>0&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${c===k.FOLLOWING?"bg-white/20":"bg-gray-200 dark:bg-gray-700"}`,children:u.followingCount})]})]}),f||O?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(Z,{className:"animate-spin text-brand-blue",size:32})}):e.jsxs(e.Fragment,{children:[c===k.FOLLOWING&&m.length===0&&e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-6 border border-blue-100 dark:border-blue-800/30",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-brand-blue/10 flex items-center justify-center",children:e.jsx(re,{size:28,className:"text-brand-blue"})}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Start following creators"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-sm mx-auto",children:"Follow artists, engineers, and studios to see their posts in your Following feed."})]}),d?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Z,{className:"animate-spin text-brand-blue",size:24})}):N.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Suggested for you"}),N.map(o=>e.jsx(A,{suggestedUser:o},o.userId))]})]}),e.jsxs(v.div,{variants:w,initial:"hidden",animate:"show",className:"space-y-4",children:[e.jsx(X,{mode:"popLayout",children:b.map(o=>e.jsx(qe,{post:o,currentUser:a,currentUserData:t,openPublicProfile:i||(()=>{}),onReport:()=>L(o),isFollowingAuthor:S(o.userId),onToggleFollow:()=>l(o.userId,{displayName:o.displayName,photoURL:o.authorPhoto,role:o.role})},o.id))}),b.length===0&&c===k.FOR_YOU&&e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(Fe,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsx("p",{children:"No posts yet. Be the first to share something!"})]}),b.length===0&&c===k.FOLLOWING&&m.length>0&&e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(le,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsx("p",{children:"No recent posts from people you follow."}),e.jsx("button",{onClick:()=>R(k.FOR_YOU),className:"mt-3 text-brand-blue hover:underline text-sm font-medium",children:"Browse For You feed â†’"})]})]})]}),h&&e.jsx(Te,{user:a,target:{id:h.id,type:"Post",summary:h.text?h.text.substring(0,50):"Media Post"},onClose:()=>L(null)})]})}export{ia as default};
