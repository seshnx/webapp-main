import{bI as N,bH as S,r as s,e as C,j as t}from"./vendor-M-mhr7Zm.js";import{b as A,i as j,a as E,C as U,d as M,e as D}from"./chat-Wu-U_tWR.js";import{m as k,A as $}from"./vendor-framer-1_AFqeeG.js";function z({user:a,userData:f,openPublicProfile:v,pendingChatTarget:d,clearPendingChatTarget:c}){const b=N(),u=S(),[o,r]=s.useState(null),[p,y]=s.useState(!1);A(a==null?void 0:a.uid),s.useEffect(()=>{if(d&&(a!=null&&a.uid)){const e=[a.uid,d.uid].sort().join("_");h({id:e,uid:d.uid,name:d.name,type:"direct"}),c==null||c()}},[d,a==null?void 0:a.uid,c]);const w=j(),I=s.useMemo(()=>a!=null&&a.uid&&w?{userId:a.uid}:"skip",[a==null?void 0:a.uid,w]),x=C(E.conversations.getConversations,I),m=s.useMemo(()=>x?x.map(e=>({id:e.chatId,uid:e.otherUserId||e.chatId,name:e.chatName||"Unknown",n:e.chatName||"Unknown",photo:e.chatPhoto||"",type:e.chatType||"direct",lm:e.lastMessage||"",lmt:e.lastMessageTime||0,ls:e.lastSenderId||"",uc:e.unreadCount||0})).sort((e,i)=>(i.lmt||0)-(e.lmt||0)):[],[x]),h=e=>{r(e),e!=null&&e.id?u(`/messages/chat/${e.id}`,{replace:!0}):u("/messages",{replace:!0})};return s.useEffect(()=>{const e=b.pathname.split("/").filter(Boolean);if(e[0]==="messages"&&e[1]==="chat"&&e[2]){const i=e[2],n=m.find(l=>l.id===i);n&&r(l=>(l==null?void 0:l.id)===i?l:{id:n.id,uid:n.uid,name:n.name,type:n.type})}else e[0]==="messages"&&(!e[1]||e[1]!=="chat")&&r(i=>i&&null)},[b.pathname,m]),s.useEffect(()=>{j()||console.warn("Convex is not available. Chat functionality is disabled.")},[]),t.jsxs("div",{className:"flex h-[calc(100vh-100px)] bg-white dark:bg-[#1f2128] rounded-2xl overflow-hidden border dark:border-gray-800 shadow-xl",children:[t.jsx(k.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`w-full md:w-80 border-r dark:border-gray-800 flex flex-col ${o?"hidden md:flex":"flex"}`,children:t.jsx(U,{user:a,userData:f,conversations:m,activeChat:o,onSelectChat:h})}),t.jsxs("div",{className:`flex-1 flex flex-col relative ${o?"flex":"hidden md:flex"}`,children:[t.jsx(M,{activeChat:o,user:a,userData:f,conversations:m,onBack:()=>h(null),toggleDetails:()=>y(!p),openPublicProfile:v}),t.jsx($,{children:p&&o&&t.jsx(k.div,{initial:{width:0,opacity:0},animate:{width:300,opacity:1},exit:{width:0,opacity:0},className:"border-l dark:border-gray-800 bg-gray-50 dark:bg-[#23262f] overflow-hidden relative z-20",children:t.jsx(D,{activeChat:o,currentUser:f,onClose:()=>y(!1)})})})]})]})}export{z as default};
