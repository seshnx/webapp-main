import{r as B,c3 as P,c7 as U,c8 as O,j as e,U as R,X as L,t as M,T as V,c5 as G,ce as H,a as J,L as X,y as Y,c6 as j,ca as Z,c9 as N}from"./vendor-Dl7DtIXW.js";import{s as T}from"./chat-BYF7Vx2D.js";import"./vendor-framer-CUELlS5e.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new t.Error().stack;a&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[a]="643e74fb-a61f-4b72-932c-d23caa5713ea",t._sentryDebugIdIdentifier="sentry-dbid-643e74fb-a61f-4b72-932c-d23caa5713ea")})()}catch{}const q=O({sessionName:N().min(3,"Session name must be at least 3 chars"),date:N().optional(),time:N().optional(),duration:Z().min(1).max(24)});function ee({user:t,userData:a,cart:l,onRemoveFromCart:I,onClose:_,onComplete:$}){const[f,w]=B.useState(!1),{register:c,handleSubmit:C,watch:z,formState:{errors:x,isValid:k}}=P({resolver:U(q),defaultValues:{sessionName:a!=null&&a.lastName?`${a.lastName} Session`:"Session",duration:4,date:"",time:""},mode:"onChange"}),v=z("duration")||0,E=()=>{let s=0;const o=parseInt(v)||0,d=l.map(n=>{const r=n.rate||0,i=r*o;return s+=i,{...n,itemTotal:i,hourlyRate:r}}),b=l.length>=3,u=b?s*.1:0,y=s-u;return{subtotal:s,discountAmount:u,finalTotal:y,lineItems:d,shouldDiscount:b}},{subtotal:F,discountAmount:D,finalTotal:p,lineItems:h,shouldDiscount:g}=E(),A=async s=>{w(!0);const o=j.loading("Initializing Session...");try{let d=null;if(p>0)try{const r=await fetch("/api/stripe/create-split-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({totalAmount:p,description:`Session: ${s.sessionName}`,transfers:h.map(i=>{var S;return{recipientId:i.id,amount:i.itemTotal*(g?.9:1),role:((S=i.accountTypes)==null?void 0:S[0])||"Creative"}})})});if(!r.ok)console.warn("Payment initialization failed, continuing without payment");else{const i=await r.json();i!=null&&i.paymentIntentId&&(d=i.paymentIntentId)}}catch(n){console.warn("Payment setup error, continuing without payment:",n)}if(!T)throw new Error("Supabase not initialized");const b=(t==null?void 0:t.id)||(t==null?void 0:t.uid),u=`session_${Date.now()}`,y=h.map(n=>{var r;return T.from("bookings").insert({group_id:u,session_name:s.sessionName,sender_id:b,sender_name:a&&`${a.firstName||""} ${a.lastName||""}`.trim()||"User",target_id:n.id,target_name:`${n.firstName} ${n.lastName}`,service_type:((r=n.accountTypes)==null?void 0:r[0])||"Session",date:s.date||"Flexible",time:s.time||"Flexible",duration:s.duration,offer_amount:n.itemTotal*(g?.9:1),status:"Pending",payment_intent_id:d,timestamp:new Date().toISOString(),type:"GroupSession"})});await Promise.all(y),j.success("Session Created!",{id:o}),$()}catch(d){console.error("Booking Error:",d),j.error("Failed: "+d.message,{id:o})}finally{w(!1)}},m=s=>M("w-full p-2 border rounded-lg dark:bg-black/20 dark:text-white transition-colors focus:ring-2 focus:ring-brand-blue outline-none",s?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-600");return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-in fade-in",children:e.jsxs("form",{onSubmit:C(A),className:"bg-white dark:bg-[#2c2e36] w-full max-w-2xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] rounded-t-2xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(R,{className:"text-brand-blue"})," Session Builder"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[l.length," Members Selected"]})]}),e.jsx("button",{type:"button",onClick:_,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(L,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Session Name"}),e.jsx("input",{...c("sessionName"),className:m(x.sessionName),placeholder:"e.g. My Album Recording"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date (Optional)"}),e.jsx("input",{type:"date",...c("date"),className:m(x.date)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time (Optional)"}),e.jsx("input",{type:"time",...c("time"),className:m(x.time)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Duration (Hours)"}),e.jsx("input",{type:"number",...c("duration",{valueAsNumber:!0}),className:m(x.duration)})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-bold dark:text-white mb-3",children:"Session Roster"}),e.jsxs("div",{className:"space-y-2",children:[l.map(s=>{var o;return e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-[#2c2e36] p-2 rounded-lg border dark:border-gray-600 shadow-sm animate-in slide-in-from-right-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold",children:s.firstName[0]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-bold dark:text-white",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(o=s.accountTypes)==null?void 0:o[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-mono",children:["$",s.rate,"/hr"]}),e.jsx("button",{type:"button",onClick:()=>I(s.id),className:"text-red-400 hover:text-red-600 transition-colors",children:e.jsx(V,{size:14})})]})]},s.id)}),l.length===0&&e.jsx("div",{className:"text-center text-xs text-gray-400 py-4 italic",children:"No members added yet."})]})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(G,{size:20})," Cost Breakdown"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-800 transition-all",children:[e.jsx("div",{className:"space-y-2 mb-4 text-sm",children:h.map(s=>e.jsxs("div",{className:"flex justify-between text-blue-900 dark:text-blue-100",children:[e.jsxs("span",{children:[s.firstName," (",s.accountTypes[0],") x ",v,"hrs"]}),e.jsxs("span",{className:"font-mono",children:["$",s.itemTotal.toFixed(2)]})]},s.id))}),e.jsxs("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-blue-800 dark:text-blue-300 font-bold",children:"Subtotal"}),e.jsxs("span",{className:"text-blue-800 dark:text-blue-300 font-bold font-mono",children:["$",F.toFixed(2)]})]}),g&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400 font-bold mt-2 animate-in slide-in-from-right-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{size:14,fill:"currentColor"})," Bundle Discount (10%)"]}),e.jsxs("span",{className:"font-mono",children:["-$",D.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-2xl font-black dark:text-white",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{className:"font-mono",children:["$",p.toFixed(2)]})]})]})]})]}),e.jsx("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] rounded-b-2xl",children:e.jsx("button",{type:"submit",disabled:f||l.length===0||!k,className:J("w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg flex items-center justify-center gap-2",f||l.length===0||!k?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"),children:f?e.jsx(X,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:20})," Confirm & Book"]})})})]})})}export{ee as default};
