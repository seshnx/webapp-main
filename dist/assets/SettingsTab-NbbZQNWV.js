import{r,j as e,U as ue,b2 as he,aP as _,a0 as pe,L as h,a3 as G,a2 as X,a4 as Z,ae as fe,bu as K,aV as ye,N as we,bv as je,Y as ke,D as Ne,aS as ve,Q as Pe,ac as Ce,X as Q,n as Se}from"./vendor-DTDDt3fP.js";import{E as J,A as y,B as Ee,T as ze,Y as Re,Z as Ae,_ as De,$ as Te,a0 as Le}from"./vendor-firebase-C38qHjbM.js";import{d as w,g as j}from"./chat-BCnoKXi-.js";import{A as ee}from"./edu-Bzk_yg6o.js";import"./vendor-convex-DiXsReyd.js";import"./vendor-framer-CzAUfL-F.js";const Ue=["Student","Instructor","Intern","Admin"];function Ye({user:d,userData:o,onUpdate:k,onRoleSwitch:N}){var q,V,Y,H,W,B,O;const[i,v]=r.useState(o.settings||{notifications:{email:!0,push:!0,marketing:!1},privacy:{publicProfile:!0,showLocation:!0,hideProfile:!1},theme:"system",social:{mutedUsers:[],blockedUsers:[]},messenger:{mutedThreads:[],blockedContacts:[]},preferences:{seeAllProfiles:!1}}),[n,se]=r.useState(o.accountTypes||[]),[P,ae]=r.useState(o.preferredRole||n[0]),[m,C]=r.useState(o.activeProfileRole||n[0]),[S,E]=r.useState(!1),[z,R]=r.useState(!1),[A,D]=r.useState(!1),[p,T]=r.useState(""),[re,L]=r.useState(!1),[te,f]=r.useState(!1),[c,le]=r.useState(null),[l,x]=r.useState({newEmail:"",newPassword:"",currentPassword:""}),[U,M]=r.useState(!1),[F,de]=r.useState(!1);r.useEffect(()=>{o.activeProfileRole&&C(o.activeProfileRole)},[o.activeProfileRole]);const g=(s,a)=>{v(t=>{var u;const b={...t,[s]:{...t[s],[a]:!((u=t[s])!=null&&u[a])}};return k(b),b})},ie=s=>{v(a=>{const t={...a,theme:s};return k(t),t})},oe=async()=>{if(n.length===0)return alert("You must have at least one role.");E(!0);try{await J(y(w,j(d.uid).userProfile),{accountTypes:n,preferredRole:P,activeProfileRole:m}),m!==o.activeProfileRole&&N&&N(m);for(const s of n){const a=y(w,j(d.uid).userSubProfile(s));(await Ee(a)).exists()||await ze(a,{useRealName:!0,useGlobalName:!0})}alert("Roles & Preferences updated!")}catch(s){console.error(s),alert("Failed to update.")}E(!1)},ne=s=>{se(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},$=s=>{le(s),x({newEmail:"",newPassword:"",currentPassword:""}),f(!0)},ce=async()=>{if(!l.currentPassword)return alert("Current password is required to verify your identity.");M(!0);try{const s=Re.credential(d.email,l.currentPassword);if(await Ae(d,s),c==="email"){if(!l.newEmail)throw new Error("New email address is required.");await De(d,l.newEmail),await J(y(w,j(d.uid).userProfile),{email:l.newEmail}),alert("Email updated successfully.")}else if(c==="password"){if(l.newPassword.length<6)throw new Error("Password must be at least 6 characters.");await Te(d,l.newPassword),alert("Password updated successfully.")}f(!1),x({newEmail:"",newPassword:"",currentPassword:""})}catch(s){console.error("Security Update Error:",s),s.code==="auth/wrong-password"?alert("Incorrect current password."):s.code==="auth/email-already-in-use"?alert("This email is already associated with another account."):alert("Failed to update: "+s.message)}M(!1)},xe=async()=>{R(!0);try{throw new Error("Data export functionality is temporarily unavailable. Firebase Functions service is not configured.")}catch(s){console.error(s),alert("Failed to export data. Please try again later.")}R(!1)},ge=async()=>{if(p==="DELETE"){D(!0);try{await Le(d)}catch(s){console.error("Deletion Error:",s),s.code==="auth/requires-recent-login"?alert("For security, please log out and log back in before deleting your account."):alert("Failed to delete account: "+s.message),D(!1)}}},I=({title:s,items:a,type:t,icon:b})=>e.jsxs("div",{className:"mt-4 border-t dark:border-gray-700 pt-4",children:[e.jsxs("h5",{className:"text-sm font-bold dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(b,{size:14})," ",s]}),a&&a.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map((u,be)=>e.jsxs("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded flex items-center gap-1 text-gray-600 dark:text-gray-300",children:[u.substring(0,8),"... ",e.jsx(Q,{size:10,className:"cursor-pointer hover:text-red-500"})]},be))}):e.jsxs("p",{className:"text-xs text-gray-400 italic",children:["No active ",t,"."]})]}),me=F?[...new Set([...ee,...Ue])]:ee;return e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-300 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ue,{size:18,className:"text-purple-500"})," Roles & Workflow"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block",children:"Active Account Types"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-yellow-50 dark:bg-yellow-900/10 px-2 py-1 rounded border border-yellow-200 dark:border-yellow-800",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:s=>de(s.target.checked),className:"rounded text-yellow-600 focus:ring-yellow-500"}),e.jsx("span",{className:"text-[10px] font-bold text-yellow-700 dark:text-yellow-400",children:"Unlock All Roles"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:me.map(s=>e.jsx("button",{onClick:()=>ne(s),className:`px-3 py-1.5 rounded-full text-xs font-bold transition border ${n.includes(s)?"bg-purple-100 border-purple-200 text-purple-700 dark:bg-purple-900/30 dark:border-purple-700 dark:text-purple-300":"bg-gray-50 border-gray-200 text-gray-500 dark:bg-transparent dark:border-gray-600 dark:text-gray-400"}`,children:s},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(he,{size:12})," Preferred Profile"]}),e.jsx("select",{className:"w-full p-2 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:P,onChange:s=>ae(s.target.value),children:n.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(_,{size:12})," Active Workflow Context"]}),e.jsx("select",{className:"w-full p-2 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:m,onChange:s=>C(s.target.value),children:n.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 p-2 rounded transition border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{size:16,className:"text-brand-blue"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-200",children:"See All (Unfiltered View)"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Show all content types regardless of active workflow."})]})]}),e.jsxs("div",{className:`w-10 h-5 rounded-full p-0.5 flex transition-colors ${(q=i.preferences)!=null&&q.seeAllProfiles?"bg-brand-blue justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:[e.jsx("input",{type:"checkbox",className:"hidden",checked:((V=i.preferences)==null?void 0:V.seeAllProfiles)||!1,onChange:()=>g("preferences","seeAllProfiles")}),e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:oe,disabled:S,className:"w-full bg-purple-600 text-white px-4 py-2.5 rounded-lg font-bold hover:bg-purple-700 disabled:opacity-50 flex items-center justify-center gap-2 shadow-md transition",children:[S?e.jsx(h,{className:"animate-spin",size:16}):e.jsx(_,{size:16})," Save Workflow Settings"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(G,{size:18,className:"text-blue-500"})," Account Security"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400",children:e.jsx(X,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Email Address"}),e.jsx("div",{className:"text-xs text-gray-500",children:d.email})]})]}),e.jsx("button",{onClick:()=>$("email"),className:"text-xs font-bold bg-white dark:bg-gray-700 border dark:border-gray-600 px-3 py-1.5 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition",children:"Change Email"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400",children:e.jsx(Z,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Password"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Last changed: Never (or unknown)"})]})]}),e.jsx("button",{onClick:()=>$("password"),className:"text-xs font-bold bg-white dark:bg-gray-700 border dark:border-gray-600 px-3 py-1.5 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition",children:"Change Password"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(fe,{size:18,className:"text-gray-500"})," Content & Safety"]}),e.jsx(I,{title:"Blocked Users",items:(Y=i.social)==null?void 0:Y.blockedUsers,type:"blocks",icon:K}),e.jsx(I,{title:"Muted Threads",items:(H=i.messenger)==null?void 0:H.mutedThreads,type:"mutes",icon:ye})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(we,{size:18,className:"text-brand-blue"})," Notification Preferences"]}),e.jsx("div",{className:"space-y-3",children:Object.entries({email:"Email Notifications",push:"Push Notifications",marketing:"Marketing & Updates"}).map(([s,a])=>{var t;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-300",children:a}),e.jsx("div",{onClick:()=>g("notifications",s),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(t=i.notifications)!=null&&t[s]?"bg-brand-blue justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]},s)})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(G,{size:18,className:"text-green-500"})," Privacy & Visibility"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Public Profile Visibility"})]}),e.jsx("div",{onClick:()=>g("privacy","publicProfile"),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(W=i.privacy)!=null&&W.publicProfile?"bg-green-500 justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Show Location on Map"})]}),e.jsx("div",{onClick:()=>g("privacy","showLocation"),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(B=i.privacy)!=null&&B.showLocation?"bg-green-500 justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Hide Profile Completely"})]}),e.jsx("div",{onClick:()=>g("privacy","hideProfile"),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(O=i.privacy)!=null&&O.hideProfile?"bg-brand-blue justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]}),e.jsx("div",{className:"pt-4 mt-2 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-bold dark:text-white",children:"Your Data"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Download a copy of your personal data (GDPR/CCPA)."})]}),e.jsxs("button",{onClick:xe,disabled:z,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs font-bold text-gray-700 dark:text-gray-200 transition",children:[z?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(Ne,{size:14}),"Download Data"]})]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ve,{size:18,className:"text-purple-500"})," Appearance"]}),e.jsx("div",{className:"flex bg-gray-100 dark:bg-black/20 p-1 rounded-lg",children:["light","dark","system"].map(s=>e.jsx("button",{onClick:()=>ie(s),className:`flex-1 py-2 text-xs font-bold rounded-md capitalize transition-all ${i.theme===s?"bg-white dark:bg-gray-700 shadow-sm text-brand-blue":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:s},s))})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 p-6 rounded-xl border border-red-100 dark:border-red-800/30 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg text-red-600 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(Pe,{size:18})," Danger Zone"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:"Deleting your account is permanent. This action will trigger the data cleanup process, removing your profile, posts, and messages."}),re?e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border border-red-200 dark:border-red-900 shadow-lg animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("h4",{className:"font-bold text-red-600 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(Ce,{size:16})," Confirm Deletion"]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["Type ",e.jsx("strong",{children:"DELETE"})," below to confirm. This cannot be undone."]}),e.jsx("input",{type:"text",className:"w-full p-2 border border-red-300 dark:border-red-900 rounded mb-3 text-sm focus:ring-2 focus:ring-red-500 outline-none dark:bg-black/20 dark:text-white",placeholder:"Type DELETE",value:p,onChange:s=>T(s.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ge,disabled:p!=="DELETE"||A,className:"flex-1 bg-red-600 text-white py-2 rounded font-bold text-xs hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:A?e.jsx(h,{className:"animate-spin",size:14}):"Confirm Delete"}),e.jsx("button",{onClick:()=>{L(!1),T("")},className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-xs hover:opacity-80",children:"Cancel"})]})]}):e.jsx("button",{onClick:()=>L(!0),className:"bg-red-100 hover:bg-red-200 dark:bg-red-900/40 dark:hover:bg-red-900/60 text-red-700 dark:text-red-300 px-4 py-2 rounded-lg text-sm font-bold transition",children:"Delete Account"})]}),te&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 shadow-2xl animate-in zoom-in-95 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white flex items-center gap-2",children:[c==="email"?e.jsx(X,{size:20}):e.jsx(Z,{size:20}),"Update ",c==="email"?"Email":"Password"]}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-white",children:e.jsx(Q,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Current Password (Required)"}),e.jsx("input",{type:"password",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Verify your identity",value:l.currentPassword,onChange:s=>x({...l,currentPassword:s.target.value})})]}),c==="email"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"New Email Address"}),e.jsx("input",{type:"email",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"name@example.com",value:l.newEmail,onChange:s=>x({...l,newEmail:s.target.value})})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"New Password"}),e.jsx("input",{type:"password",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Min 6 characters",value:l.newPassword,onChange:s=>x({...l,newPassword:s.target.value})})]}),e.jsxs("button",{onClick:ce,disabled:U,className:"w-full bg-blue-600 text-white py-2.5 rounded-lg font-bold hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2 shadow-lg mt-2",children:[U?e.jsx(h,{className:"animate-spin",size:18}):e.jsx(Se,{size:18}),"Confirm Update"]})]})]})})]})}export{Ye as default};
