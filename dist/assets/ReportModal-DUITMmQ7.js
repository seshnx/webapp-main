import{r,j as e,B as ee,Q as te,ah as re,L as B,q as se,s as ae,ac as ne,X as ie,K as L}from"./vendor-DTDDt3fP.js";import{w as oe}from"./vendor-audio-Bu2lAtPy.js";import{I as ce,C as le,H as O,E as ue,A as de}from"./vendor-firebase-C38qHjbM.js";import{d as F,b as S}from"./chat-BCnoKXi-.js";const me="/assets/Fevicon-TMLO4Pj9.png";function be({audioUrl:u,fileName:c="Audio Track",previewMode:b=!1}){const m=r.useRef(null),f=r.useRef(null),x=r.useRef(null),v=r.useRef(null),s=r.useRef(null),h=r.useRef(null),p=r.useRef(Math.random().toString(36).substr(2,9)),d=r.useRef(null),g=r.useRef(null),n=r.useRef(null),[z,E]=r.useState(!1),[H,V]=r.useState(!1),[A,q]=r.useState(!1),[P,W]=r.useState(!1),[C,G]=r.useState(document.documentElement.classList.contains("dark")),D=r.useRef(C),w={dark:{star:"rgba(255, 255, 255, 0.5)",special:"#3D84ED",wave:"rgba(255, 255, 255, 0.3)"},light:{star:"rgba(0, 0, 0, 0.5)",special:"#2563EB",wave:"rgba(0, 0, 0, 0.2)"}},$=400,K=120,Q=80,i=r.useRef({stars:[],avg:0,width:0,height:0,cx:0,cy:0});r.useEffect(()=>{const t=new MutationObserver(a=>{a.forEach(l=>{if(l.attributeName==="class"){const j=document.documentElement.classList.contains("dark");G(j),D.current=j,s.current&&s.current.setOptions({waveColor:j?w.dark.wave:w.light.wave})}})});return t.observe(document.documentElement,{attributes:!0}),()=>t.disconnect()},[]),r.useEffect(()=>{if(!x.current||!v.current)return;const t=C?w.dark:w.light;s.current=oe.create({container:v.current,waveColor:t.wave,progressColor:"#3D84ED",cursorColor:"#3D84ED",barWidth:4,barGap:3,barRadius:3,height:100,responsive:!0,normalize:!0,backend:"MediaElement",media:x.current,minPxPerSec:50,fillParent:!0,interact:!b,cursorWidth:2,barAlign:"bottom"});const a=l=>{l.detail.id!==p.current&&s.current&&s.current.isPlaying()&&s.current.pause()};return window.addEventListener("seshnx-audio-play",a),s.current.on("ready",()=>V(!0)),s.current.on("play",()=>{E(!0),window.dispatchEvent(new CustomEvent("seshnx-audio-play",{detail:{id:p.current}}))}),s.current.on("pause",()=>E(!1)),s.current.on("finish",()=>{E(!1),cancelAnimationFrame(h.current)}),()=>{window.removeEventListener("seshnx-audio-play",a),s.current&&s.current.destroy(),cancelAnimationFrame(h.current)}},[u,b]),r.useEffect(()=>{const t=()=>{if(m.current&&f.current){const{clientWidth:a,clientHeight:l}=m.current;f.current.width=a,f.current.height=l,i.current.width=a,i.current.height=l,i.current.cx=a/2,i.current.cy=l/2,U()}};return window.addEventListener("resize",t),t(),()=>{window.removeEventListener("resize",t),d.current&&d.current.state!=="closed"&&d.current.close()}},[]);const U=()=>{i.current.stars=[];for(let t=0;t<$;t++)i.current.stars.push({x:Math.random()*i.current.width-i.current.cx,y:Math.random()*i.current.height-i.current.cy,z:Math.random()*i.current.width})},X=()=>{if(!(P||A||!x.current))try{const t=window.AudioContext||window.webkitAudioContext;d.current=new t,g.current=d.current.createAnalyser(),g.current.fftSize=2048,n.current=d.current.createMediaElementSource(x.current),n.current.connect(g.current),g.current.connect(d.current.destination),W(!0)}catch(t){console.warn("Audio Context Error:",t)}},Y=async t=>{var a;t.stopPropagation(),P||X(),((a=d.current)==null?void 0:a.state)==="suspended"&&await d.current.resume(),s.current&&s.current.playPause(),z||I()},I=()=>{if(!f.current)return;const t=f.current.getContext("2d"),{width:a,height:l,cx:j,cy:M,stars:J}=i.current;let N=0;if(g.current){const o=g.current.frequencyBinCount,y=new Uint8Array(o);g.current.getByteFrequencyData(y);let R=0;for(let k=0;k<y.length;k++)R+=y[k];N=R/y.length}i.current.avg=N,t.clearRect(0,0,a,l);const T=D.current?w.dark:w.light,Z=N>Q?N/10:N/30+.5;J.forEach(o=>{o.z-=Z,o.z<=0&&(o.z=a,o.x=Math.random()*a-j,o.y=Math.random()*l-M);const y=o.x/o.z*a+j,R=o.y/o.z*l+M,k=(1-o.z/a)*2.5;y>=0&&y<=a&&R>=0&&R<=l&&(t.fillStyle=N>K?T.special:T.star,t.globalAlpha=1-o.z/a,t.beginPath(),t.arc(y,R,k,0,Math.PI*2),t.fill(),t.globalAlpha=1)}),s.current&&s.current.isPlaying()&&(h.current=requestAnimationFrame(I))};return e.jsxs("div",{ref:m,className:"relative w-full h-32 rounded-xl overflow-hidden group bg-transparent transition-colors",children:[e.jsx("canvas",{ref:f,className:"w-full h-full absolute inset-0 z-0 pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 z-20 flex flex-col justify-end pointer-events-none",children:e.jsx("div",{ref:v,className:"w-full pointer-events-auto opacity-80 hover:opacity-100 transition-opacity"})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-3 z-30 flex justify-between items-start pointer-events-none",children:[e.jsxs("div",{className:"flex items-center gap-2 text-black dark:text-white/90",children:[e.jsx(ee,{size:16,className:"text-brand-blue"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[200px] shadow-sm",children:c}),b&&e.jsxs("span",{className:"text-[10px] bg-yellow-500 text-black px-2 rounded font-bold flex items-center gap-1",children:[e.jsx(te,{size:8})," PREVIEW"]})]}),A&&e.jsxs("div",{className:"bg-red-500/80 text-white text-[10px] px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(re,{size:10})," Visuals Disabled"]})]}),e.jsx("div",{className:"absolute bottom-2 left-2 z-30 opacity-50 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.jsx("img",{src:me,alt:"SeshNx",className:"w-5 h-5 object-contain"})}),e.jsx("div",{className:`absolute inset-0 z-40 flex items-center justify-center transition-opacity duration-300 pointer-events-none
                ${z?"opacity-0 group-hover:opacity-100 bg-white/20 dark:bg-black/20":"opacity-100 bg-white/10 dark:bg-black/10"}`,children:H?e.jsx("button",{onClick:Y,className:"w-14 h-14 bg-white/80 dark:bg-black/40 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/40 text-brand-blue shadow-lg hover:scale-110 transition-transform pointer-events-auto",children:z?e.jsx(se,{fill:"currentColor",className:"ml-0.5",size:24}):e.jsx(ae,{fill:"currentColor",className:"ml-1",size:24})}):e.jsx(B,{className:"animate-spin text-brand-blue",size:32})}),e.jsx("audio",{ref:x,src:u,crossOrigin:"anonymous",onError:()=>q(!0)})]})}const _=["Spam or commercial solicitation","Harassment or bullying","Hate speech","Nudity or sexual activity","Violence or dangerous organizations","Copyright / Intellectual Property Violation","Scam or fraud","Other"],fe=async({contentId:u,contentType:c,contentSummary:b,reporterId:m,reporterName:f,reason:x,description:v="",schoolId:s=null,isFacultyAction:h=!1})=>{try{if(await ce(le(F,`artifacts/${S}/moderation_queue`),{type:"Report",status:"Open",priority:h?"High":"Normal",targetId:u,targetType:c,targetSummary:b||"No preview available",reporterId:m,reporterName:f,reason:x,description:v,schoolId:s,timestamp:O()}),h&&(c==="post"||c==="comment")){const p=c==="post"?`artifacts/${S}/public/data/posts`:`artifacts/${S}/public/data/comments`;await ue(de(F,p,u),{visibility:"Hidden",moderationStatus:"Flagged",flaggedBy:m,flaggedAt:O()})}return{success:!0}}catch(p){return console.error("Reporting failed:",p),{success:!1,error:p}}};function ye({user:u,target:c,onClose:b}){const[m,f]=r.useState(_[0]),[x,v]=r.useState(""),[s,h]=r.useState(!1),[p,d]=r.useState(!1),g=async()=>{if(!(!m||!(u!=null&&u.uid))){h(!0);try{(await fe({contentId:c.id,contentType:c.type,contentSummary:c.summary,reporterId:u.uid,reporterName:u.displayName||"Anonymous User",reason:m,description:x})).success?(d(!0),setTimeout(b,2e3)):alert("Failed to submit report. Please try again.")}catch(n){console.error("Submission error:",n),alert("An unexpected error occurred during submission.")}h(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-lg animate-in fade-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h3",{className:"font-bold text-xl dark:text-white flex items-center gap-2 text-red-500",children:[e.jsx(ne,{size:24})," Report Violation"]}),e.jsx("button",{onClick:b,className:"text-gray-500 hover:text-gray-800 dark:text-gray-400 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:e.jsx(ie,{size:20})})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:["You are reporting a violation regarding: ",e.jsx("strong",{className:"font-bold",children:c.summary})," (",c.type,")"]}),p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{size:48,className:"text-green-500 mx-auto mb-4"}),e.jsx("h4",{className:"font-bold text-lg dark:text-white",children:"Report Submitted!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Thank you for helping keep the community safe. We will review this shortly."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Reason for Report"}),e.jsx("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:m,onChange:n=>f(n.target.value),children:_.map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Additional Details (Optional)"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm resize-none",rows:"3",placeholder:"Provide any further context or relevant details.",value:x,onChange:n=>v(n.target.value)})]}),e.jsx("button",{onClick:g,disabled:s,className:"w-full bg-red-600 text-white py-3 rounded-xl font-bold hover:bg-red-700 transition disabled:opacity-50 flex items-center justify-center gap-2 shadow-md",children:s?e.jsx(B,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(L,{size:18})," Submit Report"]})})]})]})})})}export{ye as R,be as S};
