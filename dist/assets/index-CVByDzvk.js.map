{"version":3,"mappings":"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","names":["AuthWizard","lazy","AppRoutes","MainLayout","App","user","setUser","useState","userData","setUserData","loading","setLoading","initialSessionHandledRef","useRef","navigate","useNavigate","location","useLocation","darkMode","setDarkMode","useEffect","toggleTheme","handleLogout","useCallback","err","jsx","Loader2","isFromSignup","isAuthenticated","hasUserData","isOnLoginPage","isTestLoginPage","Suspense","jsxs","Toaster","Sentry","sentryLoadAttempted","initSentry","logError","error","errorInfo","context","errorData","sentry","storedErrors","ErrorBoundary","React","props","__publicField","currentPath","errorText","_a","_b","_c","loggedError","phrases","AlertTriangle","Fragment","Check","Copy","RefreshCw","AppWrapper","children","ReactDOM","ConvexProvider","convex","BrowserRouter","removeLoader","loader"],"ignoreList":[],"sources":["../../src/App.jsx","../../src/utils/errorReporting.js","../../src/components/shared/ErrorBoundary.jsx","../../src/main.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback, lazy, Suspense } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { supabase } from './config/supabase'; \r\nimport { Loader2 } from 'lucide-react';\r\nimport { Toaster } from 'react-hot-toast';\r\n\r\n// Lazy load components to avoid initialization order issues\r\nconst AuthWizard = lazy(() => import('./components/AuthWizard'));\r\nconst AppRoutes = lazy(() => import('./routes/AppRoutes'));\r\nconst MainLayout = lazy(() => import('./components/MainLayout'));\r\n\r\nexport default function App() {\r\n  const [user, setUser] = useState(null);\r\n  const [userData, setUserData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  // Track if initial session has been handled to prevent duplicate loading clears\r\n  const initialSessionHandledRef = useRef(false);\r\n  \r\n  // These hooks must be called unconditionally at the top level\r\n  // They're safe because App is always rendered inside BrowserRouter\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  // Dark Mode\r\n  const [darkMode, setDarkMode] = useState(() => {\r\n    if (typeof window !== 'undefined') {\r\n        return localStorage.getItem('theme') === 'dark' ||\r\n            (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);\r\n    }\r\n    return false;\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (darkMode) {\r\n        document.documentElement.classList.add('dark');\r\n        localStorage.setItem('theme', 'dark');\r\n    } else {\r\n        document.documentElement.classList.remove('dark');\r\n        localStorage.setItem('theme', 'light');\r\n    }\r\n  }, [darkMode]);\r\n\r\n  const toggleTheme = () => setDarkMode(!darkMode);\r\n\r\n  // --- SUPABASE AUTH & DATA LISTENER ---\r\n  useEffect(() => {\r\n    // Reset the ref on each mount\r\n    initialSessionHandledRef.current = false;\r\n    \r\n    if (!supabase) {\r\n        setLoading(false);\r\n        return;\r\n    }\r\n\r\n    // Track loading state to prevent duplicate calls\r\n    const loadingUsers = new Set();\r\n\r\n    /**\r\n     * ROBUST USER DATA LOADER\r\n     * This function is designed to never throw an uncaught error.\r\n     * It will always set userData to *something*, preventing the \"null account\" crash.\r\n     */\r\n    const loadUserData = async (userId, sessionUser = null) => {\r\n        // 1. Sanity Check\r\n        if (!userId) {\r\n            // Don't set to null - if we have a user, we should always have userData\r\n            // Only set to null if we truly have no user\r\n            return;\r\n        }\r\n\r\n        // 2. Prevent duplicate calls for the same user\r\n        if (loadingUsers.has(userId)) {\r\n            console.log('User data already loading for:', userId);\r\n            return;\r\n        }\r\n        loadingUsers.add(userId);\r\n\r\n        let authUser = sessionUser || user; // Use provided sessionUser or current user state\r\n        \r\n        try {\r\n            // 2. Safe Auth Retrieval (only if we don't have user data)\r\n            // Use session user if provided, otherwise fetch (but prefer current user state)\r\n            if (!authUser) {\r\n                const { data: authData } = await supabase.auth.getUser();\r\n                authUser = authData?.user || null;\r\n            }\r\n            \r\n            // 3. Fetch Profile (Safely)\r\n            // .maybeSingle() returns null instead of throwing an error if 0 rows are found\r\n            const { data: profile, error: profileError } = await supabase\r\n                .from('profiles')\r\n                .select('*')\r\n                .eq('id', userId)\r\n                .maybeSingle();\r\n            \r\n            if (profileError) {\r\n                console.warn(\"Minor warning fetching profile:\", profileError.message);\r\n            }\r\n\r\n            // 4. Construct Fallback/Default Data\r\n            // We use the most reliable source available for each field\r\n            const currentEmail = profile?.email || authUser?.email || user?.email || '';\r\n            const metadata = authUser?.user_metadata || {};\r\n            \r\n            const currentFirstName = \r\n                profile?.first_name || \r\n                metadata.first_name || \r\n                metadata.given_name || \r\n                'User';\r\n                \r\n            const currentLastName = \r\n                profile?.last_name || \r\n                metadata.last_name || \r\n                metadata.family_name || \r\n                '';\r\n\r\n            // Base object that guarantees the app can render\r\n            let finalUserData = {\r\n                id: userId,\r\n                firstName: currentFirstName,\r\n                lastName: currentLastName,\r\n                email: currentEmail,\r\n                accountTypes: ['Fan'], // Safe default\r\n                activeProfileRole: 'Fan',\r\n                photoURL: profile?.avatar_url || metadata.avatar_url || metadata.picture || null,\r\n                settings: profile?.settings || {},\r\n                effectiveDisplayName: profile?.effective_display_name || currentFirstName\r\n            };\r\n\r\n            // 5. Merge Real Profile Data (if it exists)\r\n            if (profile) {\r\n                const accountTypes = profile.account_types && profile.account_types.length > 0 \r\n                    ? profile.account_types \r\n                    : ['Fan'];\r\n                \r\n                finalUserData = {\r\n                    ...finalUserData,\r\n                    ...profile, // Overwrite defaults with DB data\r\n                    accountTypes,\r\n                    activeProfileRole: profile.active_role || accountTypes[0],\r\n                };\r\n            } else {\r\n                // Profile doesn't exist - create it from auth data\r\n                console.log('Profile not found, creating from auth data');\r\n                \r\n                const firstName = authUser?.user_metadata?.first_name || authUser?.user_metadata?.given_name || '';\r\n                const lastName = authUser?.user_metadata?.last_name || authUser?.user_metadata?.family_name || '';\r\n                const email = authUser?.email || '';\r\n                \r\n                // Calculate effective display name\r\n                const effectiveName = firstName && lastName \r\n                    ? `${firstName} ${lastName}`\r\n                    : firstName || lastName || email?.split('@')[0] || 'User';\r\n                \r\n                // Try to create profile using upsert (handles race conditions)\r\n                // Only create if profile truly doesn't exist (AuthWizard should have created it)\r\n                const { error: createError } = await supabase\r\n                    .from('profiles')\r\n                    .upsert({\r\n                        id: userId,\r\n                        email: email,\r\n                        first_name: firstName,\r\n                        last_name: lastName,\r\n                        avatar_url: authUser?.user_metadata?.avatar_url || authUser?.user_metadata?.picture || null,\r\n                        account_types: ['Fan'],\r\n                        active_role: 'Fan',\r\n                        preferred_role: 'Fan', // Fallback role when user has multiple roles\r\n                        effective_display_name: effectiveName,\r\n                        search_terms: [\r\n                            firstName?.toLowerCase(),\r\n                            lastName?.toLowerCase(),\r\n                            effectiveName.toLowerCase()\r\n                        ].filter(Boolean),\r\n                        settings: {},\r\n                        updated_at: new Date().toISOString()\r\n                    }, { onConflict: 'id' });\r\n                \r\n                if (createError) {\r\n                    console.error(\"Error creating/updating profile:\", createError);\r\n                } else {\r\n                    console.log('Profile created/updated successfully');\r\n                }\r\n                \r\n                // Update finalUserData with the created profile data\r\n                finalUserData = {\r\n                    ...finalUserData,\r\n                    firstName: firstName || 'User',\r\n                    lastName: lastName || '',\r\n                    email: email,\r\n                    effectiveDisplayName: effectiveName\r\n                };\r\n            }\r\n\r\n            // 6. Set State (The most important part)\r\n            setUserData(finalUserData);\r\n\r\n            // Wallet fetching removed for minimal setup\r\n        } catch (err) {\r\n            console.error(\"CRITICAL: Error loading user data:\", err);\r\n            // FAILSAFE: Always set userData to prevent null state\r\n            // This ensures the app never renders with null userData when user exists\r\n            setUserData({\r\n                id: userId,\r\n                firstName: authUser?.user_metadata?.first_name || authUser?.user_metadata?.given_name || 'User',\r\n                lastName: authUser?.user_metadata?.last_name || authUser?.user_metadata?.family_name || '',\r\n                email: authUser?.email || '',\r\n                accountTypes: ['Fan'],\r\n                activeProfileRole: 'Fan',\r\n                effectiveDisplayName: authUser?.user_metadata?.first_name || authUser?.user_metadata?.given_name || 'User',\r\n                photoURL: authUser?.user_metadata?.avatar_url || authUser?.user_metadata?.picture || null,\r\n                settings: {}\r\n            });\r\n        } finally {\r\n            // Remove from loading set when done\r\n            loadingUsers.delete(userId);\r\n        }\r\n    };\r\n\r\n    // 1. Get initial session\r\n    const loadInitialSession = async () => {\r\n        try {\r\n            const { data: { session }, error } = await supabase.auth.getSession();\r\n            \r\n            if (error) {\r\n                console.error(\"Error getting session:\", error);\r\n                // If error is related to storage, it's likely Tracking Prevention\r\n                if (error.message?.includes('storage') || error.message?.includes('localStorage')) {\r\n                    console.warn(\"Storage access blocked - session cannot be persisted\");\r\n                }\r\n                setUser(null);\r\n                setUserData(null);\r\n                // Only clear loading if we haven't already\r\n                if (!initialSessionHandledRef.current) {\r\n                    setLoading(false);\r\n                    initialSessionHandledRef.current = true;\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Validate session exists and has a valid user\r\n            const currentUser = session?.user ?? null;\r\n            \r\n            if (currentUser && currentUser.id) {\r\n                console.log('Session restored:', currentUser.id);\r\n                setUser(currentUser);\r\n                \r\n                // Create minimal userData immediately from session user (prevents blocking)\r\n                const metadata = currentUser.user_metadata || {};\r\n                const minimalUserData = {\r\n                    id: currentUser.id,\r\n                    firstName: metadata.first_name || metadata.given_name || 'User',\r\n                    lastName: metadata.last_name || metadata.family_name || '',\r\n                    email: currentUser.email || '',\r\n                    accountTypes: ['Fan'],\r\n                    activeProfileRole: 'Fan',\r\n                    photoURL: metadata.avatar_url || metadata.picture || null,\r\n                    settings: {},\r\n                    effectiveDisplayName: metadata.first_name || metadata.given_name || 'User'\r\n                };\r\n                setUserData(minimalUserData);\r\n                \r\n                // Clear loading immediately to show UI\r\n                if (!initialSessionHandledRef.current) {\r\n                    setLoading(false);\r\n                    initialSessionHandledRef.current = true;\r\n                }\r\n                \r\n                // Load full user data in background (will update userData when complete)\r\n                loadUserData(currentUser.id, currentUser).catch(err => {\r\n                    console.error(\"User data load failed:\", err);\r\n                });\r\n            } else {\r\n                setUser(null);\r\n                setUserData(null);\r\n                // No user - clear loading immediately\r\n                if (!initialSessionHandledRef.current) {\r\n                    setLoading(false);\r\n                    initialSessionHandledRef.current = true;\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Session check failed:\", err);\r\n            setUser(null);\r\n            setUserData(null);\r\n            if (!initialSessionHandledRef.current) {\r\n                setLoading(false);\r\n                initialSessionHandledRef.current = true;\r\n            }\r\n        }\r\n    };\r\n    \r\n    // Start loading session\r\n    loadInitialSession();\r\n\r\n    // 2. Listen for auth changes\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n        console.log('Auth event:', event);\r\n        const currentUser = session?.user ?? null;\r\n        \r\n        // Handle INITIAL_SESSION event - this fires on page load\r\n        // loadInitialSession already handled this, so just sync state if needed\r\n        if (event === 'INITIAL_SESSION') {\r\n            if (currentUser && currentUser.id) {\r\n                setUser(currentUser);\r\n                // Load userData in background if we don't have it yet\r\n                if (!userData) {\r\n                    loadUserData(currentUser.id).catch(err => {\r\n                        console.error(\"Background user data load failed:\", err);\r\n                    });\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (currentUser) {\r\n            setUser(currentUser);\r\n            // Refresh data on sign-in or token refresh\r\n            if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {\r\n                loadUserData(currentUser.id).catch(err => {\r\n                    console.error(\"Background user data load failed:\", err);\r\n                });\r\n            }\r\n        } else if (event === 'SIGNED_OUT') {\r\n            setUser(null);\r\n            setUserData(null);\r\n            // Navigate to login on sign out\r\n            navigate('/login', { replace: true });\r\n        }\r\n        \r\n        // Clear loading for other events (but INITIAL_SESSION is handled above)\r\n        if (event !== 'INITIAL_SESSION') {\r\n            setLoading(false);\r\n        }\r\n    });\r\n\r\n    // 3. Safety timeout - reduced to 1.5 seconds (just in case)\r\n    const timeoutId = setTimeout(() => {\r\n        if (loading) {\r\n            console.warn(\"Force clearing loading state after timeout\");\r\n            setLoading(false);\r\n            initialSessionHandledRef.current = true;\r\n        }\r\n    }, 1500);\r\n\r\n    return () => {\r\n        subscription.unsubscribe();\r\n        clearTimeout(timeoutId);\r\n    };\r\n  }, []); // Empty dependency array = runs once on mount\r\n\r\n  const handleLogout = useCallback(async () => {\r\n      try {\r\n          // Clear state immediately for responsive UI\r\n          setUser(null);\r\n          setUserData(null);\r\n          \r\n          // Sign out from Supabase\r\n          if (supabase) {\r\n              const { error } = await supabase.auth.signOut();\r\n              if (error) {\r\n                  console.error(\"Logout error:\", error);\r\n              }\r\n          }\r\n          \r\n          // Navigate to login - auth state change will also trigger, but this ensures immediate redirect\r\n          navigate('/login', { replace: true });\r\n      } catch (err) {\r\n          console.error(\"Logout error:\", err);\r\n          // Even if signOut fails, clear state and redirect\r\n          setUser(null);\r\n          setUserData(null);\r\n          navigate('/login', { replace: true });\r\n      }\r\n  }, [navigate]);\r\n\r\n  // Show loading spinner while we're checking session or loading userData\r\n  // This prevents flashing between AuthWizard and MainLayout\r\n  if (loading) {\r\n    return (\r\n      <div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]\">\r\n        <Loader2 className=\"animate-spin text-brand-blue\" size={48} />\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Check if coming from OAuth signup flow\r\n  const isFromSignup = new URLSearchParams(window.location.search).get('intent') === 'signup';\r\n  \r\n  // === AUTHENTICATION GUARD ===\r\n  const isAuthenticated = user && user.id;\r\n  const hasUserData = userData && userData.id;\r\n  const isOnLoginPage = location.pathname === '/login';\r\n  const isTestLoginPage = location.pathname === '/test-login';\r\n  \r\n  // CRITICAL: If no user is loaded, always show AuthWizard\r\n  // This ensures the app never renders with null user\r\n  if (!isAuthenticated && !isOnLoginPage && !isTestLoginPage) {\r\n    return (\r\n      <Suspense fallback={<div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]\"><Loader2 className=\"animate-spin text-brand-blue\" size={48} /></div>}>\r\n        <AuthWizard darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/')} isNewUser={false} />\r\n      </Suspense>\r\n    );\r\n  }\r\n  \r\n  // CRITICAL: If user exists but no userData, show loading (not AuthWizard)\r\n  // This prevents flashing - we wait for userData before showing UI\r\n  if (isAuthenticated && !hasUserData && !isOnLoginPage && !isTestLoginPage) {\r\n    // UserData is still loading - show loading spinner instead of AuthWizard\r\n    // This prevents the flash between AuthWizard and MainLayout\r\n    return (\r\n      <div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]\">\r\n        <Loader2 className=\"animate-spin text-brand-blue\" size={48} />\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Handle test login page (always show login, route to debug report)\r\n  if (isTestLoginPage) {\r\n    if (isAuthenticated && hasUserData) {\r\n      // Already logged in - redirect to debug report\r\n      navigate('/debug-report', { replace: true });\r\n      return null;\r\n    }\r\n    // Show login form - route to debug report on success\r\n    return (\r\n      <Suspense fallback={<div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]\"><Loader2 className=\"animate-spin text-brand-blue\" size={48} /></div>}>\r\n        <AuthWizard darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/debug-report')} isNewUser={false} />\r\n      </Suspense>\r\n    );\r\n  }\r\n  \r\n  // Handle login page\r\n  if (isOnLoginPage) {\r\n    if (isAuthenticated && hasUserData) {\r\n      // Already logged in - redirect to dashboard\r\n      navigate('/', { replace: true });\r\n      return null;\r\n    }\r\n    // Show login form - normal flow\r\n    return (\r\n      <Suspense fallback={<div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]\"><Loader2 className=\"animate-spin text-brand-blue\" size={48} /></div>}>\r\n        <AuthWizard darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/')} isNewUser={false} />\r\n      </Suspense>\r\n    );\r\n  }\r\n  \r\n  // Handle OAuth onboarding\r\n  if (isAuthenticated && !hasUserData && isFromSignup) {\r\n    return (\r\n      <Suspense fallback={<div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]\"><Loader2 className=\"animate-spin text-brand-blue\" size={48} /></div>}>\r\n        <AuthWizard user={user} isNewUser={true} darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/debug-report')} />\r\n      </Suspense>\r\n    );\r\n  }\r\n  \r\n  // Require authentication for all other routes\r\n  if (!isAuthenticated || !hasUserData) {\r\n    // This should be caught above, but double-check\r\n    return (\r\n      <Suspense fallback={<div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]\"><Loader2 className=\"animate-spin text-brand-blue\" size={48} /></div>}>\r\n        <AuthWizard darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/')} isNewUser={false} />\r\n      </Suspense>\r\n    );\r\n  }\r\n\r\n  // Render app with full layout (Sidebar + Navbar + Content)\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 dark:bg-[#1a1d21]\">\r\n      <Toaster position=\"bottom-right\" toastOptions={{ style: { background: '#333', color: '#fff' } }} />\r\n      \r\n      {/* Check if we're on a special route that needs different layout */}\r\n      {location.pathname === '/settings' || location.pathname === '/debug-report' ? (\r\n        // Settings and Debug Report use simple layout\r\n        <main className=\"p-6\">\r\n          <Suspense fallback={<div className=\"flex items-center justify-center min-h-screen\"><Loader2 className=\"animate-spin text-brand-blue\" size={32} /></div>}>\r\n            <AppRoutes\r\n              user={user}\r\n              userData={userData}\r\n              loading={loading}\r\n              darkMode={darkMode}\r\n              toggleTheme={toggleTheme}\r\n              handleLogout={handleLogout}\r\n            />\r\n          </Suspense>\r\n        </main>\r\n      ) : (\r\n        // All other routes use MainLayout with Sidebar + Navbar\r\n        <Suspense fallback={<div className=\"flex items-center justify-center min-h-screen\"><Loader2 className=\"animate-spin text-brand-blue\" size={32} /></div>}>\r\n          <MainLayout\r\n            user={user}\r\n            userData={userData}\r\n            loading={loading}\r\n            darkMode={darkMode}\r\n            toggleTheme={toggleTheme}\r\n            handleLogout={handleLogout}\r\n          />\r\n        </Suspense>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Error Reporting Utility\r\n * \r\n * Centralized error logging and reporting service.\r\n * Supports:\r\n * - Sentry (optional, requires @sentry/react package and VITE_SENTRY_DSN)\r\n * - Local storage for debugging\r\n * - Console logging in development\r\n */\r\n\r\n// Lazy load Sentry to avoid bundling if not used\r\nlet Sentry = null;\r\nlet sentryLoadAttempted = false;\r\n\r\n/**\r\n * Initialize Sentry if available\r\n * @returns {Promise<Object|null>} Sentry module or null if not available\r\n */\r\nconst initSentry = async () => {\r\n  // Return cached result\r\n  if (Sentry !== null) return Sentry;\r\n  if (sentryLoadAttempted) return null;\r\n  \r\n  const dsn = import.meta.env.VITE_SENTRY_DSN;\r\n  if (!dsn) {\r\n    sentryLoadAttempted = true;\r\n    Sentry = false;\r\n    return null;\r\n  }\r\n\r\n  sentryLoadAttempted = true;\r\n\r\n  try {\r\n    // Dynamic import - will fail gracefully if package not installed\r\n    const sentryModule = await import('@sentry/react');\r\n    \r\n    // Real Sentry - proceed with initialization\r\n    Sentry = sentryModule;\r\n    const { init, BrowserTracing, Replay } = sentryModule;\r\n    \r\n    // Check if already initialized\r\n    const hub = sentryModule.getCurrentHub?.();\r\n    if (!hub?.getClient?.()) {\r\n      init({\r\n        dsn,\r\n        environment: import.meta.env.MODE || 'development',\r\n        tracesSampleRate: import.meta.env.PROD ? 0.1 : 1.0,\r\n        replaysSessionSampleRate: import.meta.env.PROD ? 0.1 : 1.0,\r\n        replaysOnErrorSampleRate: 1.0,\r\n        integrations: [\r\n          new BrowserTracing(),\r\n          new Replay(),\r\n        ],\r\n      });\r\n    }\r\n    \r\n    return Sentry;\r\n  } catch (e) {\r\n    // Package not installed or other error - silently fail\r\n    if (import.meta.env.DEV) {\r\n      console.debug('Sentry not available:', e.message);\r\n    }\r\n    Sentry = false;\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Log an error with context\r\n * @param {Error} error - The error object\r\n * @param {Object} errorInfo - Additional error information\r\n * @param {Object} context - Additional context (user, component, etc.)\r\n */\r\nexport const logError = (error, errorInfo = {}, context = {}) => {\r\n  const errorData = {\r\n    message: error?.message || 'Unknown error',\r\n    stack: error?.stack,\r\n    name: error?.name,\r\n    timestamp: new Date().toISOString(),\r\n    userAgent: navigator.userAgent,\r\n    url: window.location.href,\r\n    ...errorInfo,\r\n    context,\r\n  };\r\n\r\n  // Log to console in development\r\n  if (import.meta.env.DEV) {\r\n    console.error('ðŸš¨ Error Reported:', errorData);\r\n  }\r\n\r\n  // Send to Sentry if available (async, non-blocking)\r\n  initSentry().then(sentry => {\r\n    if (sentry && sentry.captureException) {\r\n      sentry.captureException(error, {\r\n        extra: errorData,\r\n        tags: {\r\n          component: context.component || 'Unknown',\r\n          errorBoundary: context.errorBoundary || 'None',\r\n        },\r\n        contexts: {\r\n          custom: context,\r\n        },\r\n      });\r\n    }\r\n  }).catch(() => {\r\n    // Ignore Sentry errors\r\n  });\r\n\r\n  // Store errors locally for debugging (limited to last 10)\r\n  try {\r\n    const storedErrors = JSON.parse(localStorage.getItem('seshnx_errors') || '[]');\r\n    storedErrors.unshift(errorData);\r\n    storedErrors.splice(10); // Keep only last 10 errors\r\n    localStorage.setItem('seshnx_errors', JSON.stringify(storedErrors));\r\n  } catch (e) {\r\n    // Ignore localStorage errors\r\n  }\r\n\r\n  return errorData;\r\n};\r\n\r\n/**\r\n * Report a non-error event (warnings, info)\r\n * @param {string} message - The message to report\r\n * @param {string} level - 'warning' | 'info' | 'error'\r\n * @param {Object} context - Additional context\r\n */\r\nexport const reportEvent = (message, level = 'info', context = {}) => {\r\n  const eventData = {\r\n    message,\r\n    level,\r\n    timestamp: new Date().toISOString(),\r\n    url: window.location.href,\r\n    context,\r\n  };\r\n\r\n  if (import.meta.env.DEV) {\r\n    console[level === 'error' ? 'error' : level === 'warning' ? 'warn' : 'log'](\r\n      `ðŸ“Š Event [${level}]:`,\r\n      eventData\r\n    );\r\n  }\r\n\r\n  // Send to Sentry if available (async, non-blocking)\r\n  initSentry().then(sentry => {\r\n    if (sentry && sentry.captureMessage) {\r\n      sentry.captureMessage(message, {\r\n        level: level === 'error' ? 'error' : level === 'warning' ? 'warning' : 'info',\r\n        extra: eventData,\r\n      });\r\n    }\r\n  }).catch(() => {\r\n    // Ignore Sentry errors\r\n  });\r\n\r\n  return eventData;\r\n};\r\n\r\n/**\r\n * Get stored errors (for debugging)\r\n * @returns {Array} Array of stored errors\r\n */\r\nexport const getStoredErrors = () => {\r\n  try {\r\n    return JSON.parse(localStorage.getItem('seshnx_errors') || '[]');\r\n  } catch (e) {\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * Clear stored errors\r\n */\r\nexport const clearStoredErrors = () => {\r\n  try {\r\n    localStorage.removeItem('seshnx_errors');\r\n  } catch (e) {\r\n    // Ignore\r\n  }\r\n};\r\n\r\n","import React from 'react';\nimport { AlertTriangle, RefreshCw, Home, Copy, Check } from 'lucide-react';\nimport { logError } from '../../utils/errorReporting';\n\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { \n      hasError: false, \n      error: null,\n      errorInfo: null,\n      meme: \"Unexpected signal chain failure.\",\n      errorId: null,\n      copied: false\n    };\n  }\n\n  static getDerivedStateFromError(error) {\n    // Update state so the next render will show the fallback UI.\n    return { \n      hasError: true, \n      error,\n      errorId: `ERR-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n    };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    // Log error with full context\n    const context = {\n      componentStack: errorInfo.componentStack,\n      errorBoundary: this.props.name || 'Default',\n      props: this.props.context || {},\n    };\n\n    const loggedError = logError(error, errorInfo, context);\n    \n    // Store error info for display\n    this.setState({ \n      errorInfo: {\n        ...errorInfo,\n        errorId: this.state.errorId || loggedError.timestamp,\n      }\n    });\n  }\n\n  componentDidMount() {\n    // Pre-load a random error meme\n    const phrases = [\n      \"CoreAudio Overload detected.\",\n      \"The plugin crashed the session.\",\n      \"Buffer underrun exception.\",\n      \"Who deleted the master fader?\",\n      \"Sample rate mismatch: Reality is 44.1k, we are 48k.\",\n      \"The drummer kicked the power cable.\",\n      \"Ilok license not found.\",\n      \"Fatal Error: Not enough headroom.\",\n      \"The mix bus is clipping... hard.\",\n      \"Phantom power failure.\"\n    ];\n    this.setState({ meme: phrases[Math.floor(Math.random() * phrases.length)] });\n  }\n\n  handleReset = () => {\n    this.setState({ \n      hasError: false, \n      error: null, \n      errorInfo: null,\n      errorId: null,\n      copied: false\n    });\n    // Optional: Redirect to home/dashboard if recovery isn't possible\n    if (this.props.onReset) {\n      this.props.onReset();\n    } else {\n      // Try to reset to a safe state\n      const currentPath = window.location.pathname;\n      if (currentPath !== '/' && currentPath !== '/dashboard') {\n        window.location.href = '/?tab=dashboard';\n      } else {\n        window.location.reload();\n      }\n    }\n  };\n\n  handleCopyError = async () => {\n    const errorText = `\nError ID: ${this.state.errorId}\nMessage: ${this.state.error?.message || 'Unknown error'}\nStack: ${this.state.error?.stack || 'No stack trace'}\nComponent Stack: ${this.state.errorInfo?.componentStack || 'No component stack'}\nURL: ${window.location.href}\nUser Agent: ${navigator.userAgent}\nTimestamp: ${new Date().toISOString()}\n    `.trim();\n\n    try {\n      await navigator.clipboard.writeText(errorText);\n      this.setState({ copied: true });\n      setTimeout(() => this.setState({ copied: false }), 2000);\n    } catch (err) {\n      console.error('Failed to copy error:', err);\n    }\n  };\n\n  render() {\n    if (this.state.hasError) {\n      // You can render any custom fallback UI\n      return (\n        <div className=\"min-h-screen bg-[#1f2128] flex flex-col items-center justify-center p-4 text-center text-white font-sans\">\n          <div className=\"bg-[#2c2e36] border border-red-500/30 p-8 rounded-2xl shadow-2xl max-w-lg w-full relative overflow-hidden\">\n            \n            {/* Background Glow */}\n            <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-32 h-32 bg-red-500/20 blur-[50px] rounded-full pointer-events-none\"></div>\n\n            <div className=\"relative z-10 flex flex-col items-center\">\n              <div className=\"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mb-6 text-red-500\">\n                <AlertTriangle size={32} strokeWidth={2} />\n              </div>\n\n              <h1 className=\"text-3xl font-bold mb-2\">Session Crashed</h1>\n              \n              <p className=\"text-xl text-[#3D84ED] font-medium mb-6 italic\">\n                \"{this.state.meme}\"\n              </p>\n\n              <div className=\"bg-[#1f2128] p-4 rounded-lg w-full mb-6 text-left border border-gray-700\">\n                <div className=\"flex justify-between items-center mb-2\">\n                  <p className=\"text-xs text-gray-500 uppercase font-bold tracking-wider\">Error Details</p>\n                  <button\n                    onClick={this.handleCopyError}\n                    className=\"text-xs text-gray-400 hover:text-white flex items-center gap-1 transition-colors\"\n                    title=\"Copy error details\"\n                  >\n                    {this.state.copied ? (\n                      <>\n                        <Check size={12} />\n                        Copied!\n                      </>\n                    ) : (\n                      <>\n                        <Copy size={12} />\n                        Copy\n                      </>\n                    )}\n                  </button>\n                </div>\n                <div className=\"space-y-2\">\n                  {this.state.errorId && (\n                    <div>\n                      <span className=\"text-xs text-gray-500\">Error ID: </span>\n                      <code className=\"text-xs text-blue-400 font-mono\">{this.state.errorId}</code>\n                    </div>\n                  )}\n                  <code className=\"text-sm text-red-400 font-mono break-words block\">\n                    {this.state.error?.message || 'Unknown error occurred'}\n                  </code>\n                  {this.state.error?.stack && (\n                    <details className=\"mt-2\">\n                      <summary className=\"text-xs text-gray-500 cursor-pointer hover:text-gray-400\">\n                        Stack Trace\n                      </summary>\n                      <pre className=\"text-xs text-gray-400 font-mono mt-2 overflow-auto max-h-32\">\n                        {this.state.error.stack}\n                      </pre>\n                    </details>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex gap-4 w-full\">\n                <button \n                  onClick={() => window.history.back()}\n                  className=\"flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2\"\n                >\n                  Go Back\n                </button>\n                <button \n                  onClick={this.handleReset}\n                  className=\"flex-1 bg-[#3D84ED] hover:bg-blue-600 text-white py-3 px-4 rounded-xl font-bold transition-all shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2\"\n                >\n                  <RefreshCw size={18} />\n                  Reload App\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children; \n  }\n}\n\nexport default ErrorBoundary;\n","import React from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport { BrowserRouter } from 'react-router-dom'\r\nimport { ConvexProvider } from \"convex/react\"\r\nimport * as Sentry from '@sentry/react'\r\nimport App from './App.jsx'\r\nimport { convex } from './config/convex'\r\nimport ErrorBoundary from './components/shared/ErrorBoundary'\r\nimport './index.css'\r\n\r\n// Initialize Sentry if DSN is provided\r\nconst sentryDsn = import.meta.env.VITE_SENTRY_DSN\r\nif (sentryDsn) {\r\n  Sentry.init({\r\n    dsn: sentryDsn,\r\n    environment: import.meta.env.MODE || 'development',\r\n    integrations: [\r\n      Sentry.browserTracingIntegration(),\r\n      Sentry.replayIntegration({\r\n        maskAllText: false,\r\n        blockAllMedia: false,\r\n      }),\r\n    ],\r\n    // Performance Monitoring\r\n    tracesSampleRate: import.meta.env.PROD ? 0.1 : 1.0,\r\n    // Session Replay\r\n    replaysSessionSampleRate: import.meta.env.PROD ? 0.1 : 1.0,\r\n    replaysOnErrorSampleRate: 1.0,\r\n    // Filter out common non-critical errors\r\n    beforeSend(event, hint) {\r\n      // Filter out localStorage errors (tracking prevention)\r\n      if (event.exception?.values?.[0]?.value?.includes('localStorage') ||\r\n          event.exception?.values?.[0]?.value?.includes('QuotaExceededError')) {\r\n        return null; // Don't send these errors\r\n      }\r\n      return event;\r\n    },\r\n  });\r\n  \r\n  if (import.meta.env.DEV) {\r\n    console.log('âœ“ Sentry initialized for error monitoring');\r\n  }\r\n}\r\n\r\n// Development: Enhanced error logging\r\nif (import.meta.env.DEV) {\r\n  const originalError = console.error;\r\n  console.error = (...args) => {\r\n    const errorMessage = args[0]?.toString() || '';\r\n    if (errorMessage.includes('Rendered more hooks') || errorMessage.includes('301')) {\r\n      console.group('ðŸ”´ React Hook Error #301');\r\n      console.error('Component rendered with different hook count than previous render.');\r\n      console.error('Check component stack above for the problematic component.');\r\n      console.groupEnd();\r\n    }\r\n    originalError.apply(console, args);\r\n  };\r\n}\r\n\r\n// App wrapper with error boundaries\r\nconst AppWrapper = ({ children }) => {\r\n  if (sentryDsn) {\r\n    return (\r\n      <Sentry.ErrorBoundary \r\n        fallback={({ error, resetError }) => (\r\n          <div className=\"flex items-center justify-center min-h-screen bg-gray-50 dark:bg-[#1a1d21]\">\r\n            <div className=\"text-center p-8\">\r\n              <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-4\">Something went wrong</h1>\r\n              <p className=\"text-gray-600 dark:text-gray-400 mb-6\">{error?.message || 'An unexpected error occurred'}</p>\r\n              <button\r\n                onClick={resetError}\r\n                className=\"px-4 py-2 bg-brand-blue text-white rounded-lg hover:bg-blue-600 transition-colors\"\r\n              >\r\n                Try again\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      >\r\n        {children}\r\n      </Sentry.ErrorBoundary>\r\n    );\r\n  }\r\n  return <>{children}</>;\r\n};\r\n\r\nReactDOM.createRoot(document.getElementById('root')).render(\r\n  <AppWrapper>\r\n    <ErrorBoundary name=\"Root\">\r\n      <ConvexProvider client={convex}>\r\n        <BrowserRouter>\r\n          <App />\r\n        </BrowserRouter>\r\n      </ConvexProvider>\r\n    </ErrorBoundary>\r\n  </AppWrapper>\r\n)\r\n\r\nconst removeLoader = () => {\r\n  const loader = document.getElementById('loading-fallback');\r\n  if (loader) {\r\n    loader.classList.add('fade-out');\r\n    setTimeout(() => {\r\n      if (loader && loader.parentNode) {\r\n        loader.parentNode.removeChild(loader);\r\n      }\r\n      document.body.style.overflow = 'auto';\r\n    }, 400);\r\n  }\r\n};\r\n\r\nsetTimeout(removeLoader, 600);\r\n"],"file":"assets/index-CVByDzvk.js"}