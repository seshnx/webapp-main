import{r as x,j as e,z as je,cK as Se,cL as Ie,a9 as we,Z as Ce,T as Fe,x as Re,c1 as ze,n as _e,cM as Oe,cv as Le,c6 as K,L as ce,Q as oe,X as me,w as Me,O as Ee,V as Te,cN as Ae,v as Ve,b as $e,cD as Ye,cO as Be,a3 as We,cP as Ge,U as he,S as qe,bO as ue}from"./vendor-Dl7DtIXW.js";import{f as He,h as Je,i as fe,j as Ke,k as Qe,l as ye,m as Xe,n as pe,s as Ze,o as Ue,p as le,c as Pe,q as De}from"./index-DMeDGzcs.js";import{S as be,R as es}from"./ReportModal-e6fXq6Ul.js";import{c as ve}from"./useNotifications-B67BOr67.js";import{U as ae,s as H,u as ss}from"./chat-BYF7Vx2D.js";import{m as _,A as X}from"./vendor-framer-CUELlS5e.js";import{a as ts}from"./useVercelUpload-OMd9iZ6b.js";import{POPULAR_PLUGINS_LIST as as}from"./config-DGZTEYpI.js";import{M as rs}from"./Inputs-BLEJ7bwJ.js";import{F as Ne,u as ge}from"./FollowButton-CKe_jms9.js";import"./edu-BMUxkX2v.js";import"./vendor-audio-CY3oQc7h.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="fad5cf75-a792-4f4a-8e96-5ca42273c76c",s._sentryDebugIdIdentifier="sentry-dbid-fad5cf75-a792-4f4a-8e96-5ca42273c76c")})()}catch{}function ns({post:s,currentUser:t,currentUserData:a,blockedUsers:l,onCountChange:d}){const[n,o]=x.useState([]),[i,r]=x.useState(""),[m,w]=x.useState(!1);x.useEffect(()=>{if(!s.id)return;f();const u=setInterval(f,3e4);return()=>{clearInterval(u)}},[s.id,l]);const f=async()=>{try{const u=await He(s.id);if(u){const k=u.filter(E=>!(l!=null&&l.includes(E.user_id)));o(k),d(k.length)}}catch(u){console.error("Comments fetch error:",u)}},M=async u=>{var O;u.preventDefault();const k=(t==null?void 0:t.id)||(t==null?void 0:t.uid);if(!i.trim()||!k)return;w(!0);const E=(a==null?void 0:a.effectiveDisplayName)||(a==null?void 0:a.firstName)||(t==null?void 0:t.displayName)||"User";try{const S=i.trim();if(!S){alert("Please enter a comment"),w(!1);return}await Je({post_id:s.id,user_id:k,content:S}),await fe(s.id,1),await f(),s.userId!==k&&ve({targetUserId:s.userId,type:"comment",fromUserId:k,fromUserName:E,fromUserPhoto:a==null?void 0:a.photoURL,postId:s.id,postPreview:(O=s.text)==null?void 0:O.substring(0,50),message:"commented on your post"}),r(""),w(!1)}catch(S){console.error("Comment submission error:",S),alert(`Failed to post comment: ${S.message||"Unknown error"}`),w(!1)}},p=async u=>{if(window.confirm("Delete comment?"))try{await Ke(u),await fe(s.id,-1),await f()}catch(k){console.error("Delete comment error:",k)}};return e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] border-t dark:border-gray-700 p-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-4 mb-4 max-h-80 overflow-y-auto custom-scrollbar pr-2",children:[n.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-2",children:"No comments yet. Be the first!"}),n.map(u=>e.jsxs("div",{className:"group flex gap-3 text-sm",children:[e.jsx(ae,{src:u.userPhoto,name:u.displayName,size:"xs",className:"shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card border dark:border-gray-700 p-3 rounded-2xl rounded-tl-none inline-block max-w-full",children:[e.jsxs("div",{className:"flex justify-between items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-bold dark:text-white text-xs truncate",children:u.displayName}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0",children:u.timestamp?new Date(u.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Just now"})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 break-words",children:u.text})]}),e.jsxs("div",{className:"flex gap-3 mt-1 ml-2",children:[e.jsx("button",{className:"text-[10px] font-bold text-gray-500 hover:text-brand-blue transition",children:"Reply"}),u.userId===(t==null?void 0:t.uid)&&e.jsx("button",{onClick:()=>p(u.id),className:"text-[10px] font-bold text-gray-400 hover:text-red-500 transition",children:"Delete"})]})]})]},u.id))]}),e.jsxs("form",{onSubmit:M,className:"flex gap-2",children:[e.jsx(ae,{src:a==null?void 0:a.photoURL,name:(a==null?void 0:a.firstName)||"You",size:"xs",className:"shrink-0 hidden sm:block"}),e.jsx("input",{className:"flex-1 bg-white dark:bg-dark-card border dark:border-gray-600 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition",placeholder:"Write a comment...",value:i,onChange:u=>r(u.target.value)}),e.jsx("button",{type:"submit",disabled:!i.trim()||m,className:"bg-brand-blue text-white p-2 rounded-full hover:bg-blue-600 disabled:opacity-50 transition shadow-sm",children:e.jsx(je,{size:16,className:m?"animate-pulse":""})})]})]})}const os=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"],is=s=>s?s.split(/(\s+)/).map((t,a)=>t.match(/^#\w+/)?e.jsx("span",{className:"text-brand-blue font-bold cursor-pointer hover:underline",children:t},a):t.match(/^@\w+/)?e.jsx("span",{className:"text-purple-600 font-bold cursor-pointer hover:underline",children:t},a):t):null,ds={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},exit:{opacity:0,scale:.95,transition:{duration:.2}}};function ls({post:s,currentUser:t,currentUserData:a,openPublicProfile:l,onReport:d,onDelete:n,isFollowingAuthor:o,onToggleFollow:i,autoPlayVideos:r=!1}){var P,D;const[m,w]=x.useState(!1),[f,M]=x.useState(s.commentCount||0),[p,u]=x.useState(!1),[k,E]=x.useState(!1),[O,S]=x.useState(!1),[T,L]=x.useState(!1),[g,y]=x.useState(!1),R=x.useRef(null),$=x.useRef(null),I=(t==null?void 0:t.id)||(t==null?void 0:t.uid),B=s.userId===I,N=(P=s.reactions)==null?void 0:P[I],j=s.reactions?Object.values(s.reactions).reduce((c,b)=>(c[b]=(c[b]||0)+1,c),{}):{},Q=Object.values(j).reduce((c,b)=>c+b,0);x.useEffect(()=>{if(!I)return;(async()=>{try{const b=await Qe(I,s.id);u(b)}catch(b){console.error("Error checking saved status:",b),u(!1)}})()},[I,s.id]),x.useEffect(()=>{const c=b=>{R.current&&!R.current.contains(b.target)&&E(!1),$.current&&!$.current.contains(b.target)&&S(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]);const Z=async c=>{var b;if(E(!1),!!I)try{const G=!!N,h=s.reactions||{};if(N===c){const Y={...h};delete Y[I],await ye(s.id,{reactions:Y,reaction_count:Math.max((s.reactionCount||0)-1,0)})}else{const Y={...h,[I]:c},C=N?0:1;await ye(s.id,{reactions:Y,reaction_count:(s.reactionCount||0)+C}),!G&&!B&&ve({targetUserId:s.userId,type:"like",fromUserId:I,fromUserName:(a==null?void 0:a.effectiveDisplayName)||(a==null?void 0:a.firstName)||"Someone",fromUserPhoto:a==null?void 0:a.photoURL,postId:s.id,postPreview:(b=s.text)==null?void 0:b.substring(0,50),message:`reacted ${c} to your post`})}}catch(G){console.error("Reaction failed",G),K.error("Couldn't add reaction")}},ie=async()=>{var c,b;if(!(!I||g)){y(!0);try{p?(await Xe(I,s.id),await pe(s.id,-1),u(!1),K.success("Removed from saved")):(await Ze(I,s.id,{author_id:s.userId,author_name:s.displayName,preview:((c=s.text)==null?void 0:c.substring(0,100))||"Media post",has_media:!!((b=s.attachments)!=null&&b.length||s.imageUrl||s.audioUrl)}),await pe(s.id,1),u(!0),K.success("Post saved!"))}catch(G){console.error("Save failed",G),K.error("Couldn't save post")}y(!1)}},de=async()=>{var b;const c=`${window.location.origin}/post/${s.id}`;if(navigator.share)try{await navigator.share({title:`Post by ${s.displayName}`,text:((b=s.text)==null?void 0:b.substring(0,100))||"Check out this post",url:c})}catch(G){G.name!=="AbortError"&&U(c)}else U(c)},U=c=>{navigator.clipboard.writeText(c),L(!0),K.success("Link copied to clipboard!"),setTimeout(()=>L(!1),2e3)},ne=async()=>{if(B&&window.confirm("Are you sure you want to delete this post?"))try{if(!await Ue(s.id)){K.error("Couldn't delete post - permission denied");return}K.success("Post deleted"),n&&n(s.id)}catch(c){console.error("Delete failed:",c),K.error("Couldn't delete post")}};return e.jsxs(_.div,{variants:ds,initial:"hidden",animate:"show",exit:"exit",layout:!0,className:"bg-white dark:bg-dark-card border dark:border-gray-700 rounded-xl overflow-visible shadow-sm mb-4 relative",children:[e.jsxs("div",{className:"p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"cursor-pointer shrink-0",onClick:()=>s.userId&&l(s.userId),role:"button",tabIndex:0,"aria-label":`View ${s.displayName||"user"}'s profile`,children:e.jsx(ae,{src:s.authorPhoto,name:s.displayName,size:"md"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm hover:underline decoration-brand-blue cursor-pointer truncate",onClick:()=>s.userId&&l(s.userId),children:s.displayName||"Unknown User"}),!B&&i&&!o&&e.jsx("button",{onClick:c=>{c.stopPropagation(),i()},className:"text-xs font-bold text-brand-blue hover:text-blue-700 transition shrink-0",children:"â€¢ Follow"})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"truncate",children:s.role}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"shrink-0",children:s.timestamp||s.created_at?new Date(s.timestamp||s.created_at).toLocaleDateString():"Just now"})]})]})]}),e.jsxs("div",{className:"relative",ref:$,children:[e.jsx("button",{className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>S(!O),children:e.jsx(Se,{size:20})}),e.jsx(X,{children:O&&e.jsxs(_.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden z-50",children:[e.jsxs("button",{onClick:()=>{U(`${window.location.origin}/post/${s.id}`),S(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(Ie,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Copy link"})]}),!B&&e.jsxs(e.Fragment,{children:[i&&e.jsxs("button",{onClick:()=>{i(),S(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(we,{size:16,className:"text-gray-400"}),e.jsxs("span",{className:"dark:text-gray-200",children:[o?"Unfollow":"Follow"," ",(D=s.displayName)==null?void 0:D.split(" ")[0]]})]}),e.jsxs("button",{onClick:()=>{d(),S(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(Ce,{size:16}),e.jsx("span",{children:"Report post"})]})]}),B&&e.jsxs("button",{onClick:()=>{ne(),S(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(Fe,{size:16}),e.jsx("span",{children:"Delete post"})]})]})})]})]}),e.jsxs("div",{className:"px-4 pb-2",children:[s.text&&e.jsx("p",{className:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap text-sm leading-relaxed mb-3",children:is(s.text)}),s.attachments&&s.attachments.length>0&&e.jsx("div",{className:`grid gap-2 mb-3 ${s.attachments.length>1?"grid-cols-2":"grid-cols-1"}`,children:s.attachments.map((c,b)=>e.jsxs("div",{className:"rounded-lg overflow-hidden bg-transparent relative",children:[c.type==="image"&&e.jsx("img",{src:c.url,className:"w-full h-full object-cover max-h-96",alt:"content"}),c.type==="video"&&e.jsx("video",{src:c.url,controls:!0,className:"w-full h-full max-h-96 bg-black",autoPlay:r,playsInline:!0,muted:r,preload:"metadata"}),c.type==="audio"&&e.jsx("div",{className:"w-full",children:e.jsx(be,{audioUrl:c.url,fileName:c.name||"Audio Track"})})]},b))}),s.audioUrl&&!s.attachments&&e.jsx("div",{className:"rounded-lg overflow-hidden bg-transparent mb-3",children:e.jsx(be,{audioUrl:s.audioUrl,fileName:s.audioName||"Track"})}),s.imageUrl&&!s.attachments&&e.jsx("img",{src:s.imageUrl,className:"rounded-lg w-full mb-3 border dark:border-gray-700",alt:"legacy content"})]}),(Q>0||s.saveCount>0)&&e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:Object.entries(j).map(([c,b])=>e.jsxs(_.div,{initial:{scale:0},animate:{scale:1},className:`text-xs px-2 py-1 rounded-full border flex items-center gap-1 ${N===c?"bg-blue-50 border-blue-200 dark:bg-blue-900/30 dark:border-blue-800":"bg-gray-50 border-gray-100 dark:bg-gray-800 dark:border-gray-700"} dark:text-gray-300`,children:[e.jsx("span",{children:c}),e.jsx("span",{className:"font-bold",children:b})]},c))}),s.saveCount>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[s.saveCount," save",s.saveCount!==1?"s":""]})]}),e.jsxs("div",{className:"px-4 py-3 border-t dark:border-gray-700 flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(_.button,{whileTap:{scale:.9},onClick:()=>E(!k),className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg ${N?"text-blue-600 bg-blue-50 dark:bg-blue-900/20":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[N?e.jsx("span",{className:"text-lg",children:N}):e.jsx(Re,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:N?"Reacted":"React"})]}),e.jsx(X,{children:k&&e.jsx(_.div,{ref:R,initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},className:"absolute bottom-full left-0 mb-2 bg-white dark:bg-gray-800 shadow-xl rounded-full p-2 flex gap-1 sm:gap-2 z-50 border dark:border-gray-600 origin-bottom-left",children:os.map(c=>e.jsx(_.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:b=>{b.stopPropagation(),Z(c)},className:`text-xl p-1 sm:p-1.5 rounded-full ${N===c?"bg-blue-100 dark:bg-blue-900":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:c},c))})})]}),e.jsxs(_.button,{whileTap:{scale:.95},onClick:()=>w(!m),className:"flex items-center gap-1.5 sm:gap-2 text-sm font-medium text-gray-500 hover:text-brand-blue transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx(ze,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:f>0?f:"Comment"}),f>0&&e.jsx("span",{className:"sm:hidden",children:f})]}),e.jsxs(_.button,{whileTap:{scale:.95},onClick:de,className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 ${T?"text-green-500":"text-gray-500 hover:text-green-500"}`,children:[T?e.jsx(_e,{size:18}):e.jsx(Oe,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:T?"Copied!":"Share"})]})]}),e.jsx(_.button,{whileTap:{scale:.8},onClick:ie,disabled:g,className:`${p?"text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"} transition p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full disabled:opacity-50`,title:p?"Remove from saved":"Save post",children:e.jsx(Le,{size:18,fill:p?"currentColor":"none"})})]}),e.jsx(X,{children:m&&e.jsx(_.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx(ns,{post:s,currentUser:t,currentUserData:a,blockedUsers:[],onCountChange:M})})})]})}function cs({user:s,userData:t,onPost:a}){const[l,d]=x.useState(""),[n,o]=x.useState([]),[i,r]=x.useState(!1),[m,w]=x.useState([]),[f,M]=x.useState(null),[p,u]=x.useState(!1),[k,E]=x.useState({current:0,total:0,percent:0}),{uploadMedia:O}=ts(),S=(g,y)=>{if(g.target.files&&g.target.files[0]){const R=g.target.files[0],$=URL.createObjectURL(R);o([...n,{file:R,type:y,previewUrl:$}])}},T=g=>{o(n.filter((y,R)=>R!==g))},L=async()=>{if(!(!l.trim()&&n.length===0)){u(!0);try{const g=n.length+(f?1:0);let y=0;const R=()=>{y++,E({current:y,total:g,percent:Math.round(y/g*100)})};E({current:0,total:g,percent:0});const $=[];for(const N of n){const j=await O(N.file);j&&$.push({url:j.url,type:N.type}),R()}let I=null;if(f){const N=await O(f);I=N==null?void 0:N.url,R()}const B={text:l,attachments:$.filter(N=>N!==null),seshFx:i&&(m.length>0||I)?{plugins:m,presetUrl:I,presetName:f?f.name:null}:null};await a(B),d(""),o([]),r(!1),w([]),M(null),E({current:0,total:0,percent:0})}catch(g){console.error("Error creating post:",g),alert("Failed to create post. Please try again.")}finally{u(!1)}}};return e.jsxs("div",{className:"bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-gray-700 shadow-sm mb-6",children:[e.jsx(X,{children:p&&k.total>0&&e.jsx(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4 overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-4 border border-blue-100 dark:border-blue-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"relative",children:e.jsx(ce,{className:"animate-spin text-brand-blue",size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white",children:"Getting Post Ready..."}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Uploading ",k.current," of ",k.total," files"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 overflow-hidden",children:e.jsx(_.div,{className:"h-full bg-gradient-to-r from-brand-blue to-purple-500 rounded-full",initial:{width:0},animate:{width:`${k.percent}%`},transition:{duration:.3,ease:"easeOut"}})}),e.jsx("div",{className:"flex justify-end mt-1",children:e.jsxs("span",{className:"text-xs font-semibold text-brand-blue",children:[k.percent,"%"]})})]})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden shrink-0",children:t!=null&&t.photoURL?e.jsx("img",{src:t.photoURL,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-brand-blue"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{className:"w-full bg-transparent outline-none text-gray-900 dark:text-white placeholder-gray-500 min-h-[80px] resize-none",placeholder:"What's creating sound today? (#tags @mentions)",value:l,onChange:g=>d(g.target.value),disabled:p}),n.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:n.map((g,y)=>e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black/5 border dark:border-gray-600 aspect-video group flex items-center justify-center",children:[g.type==="image"&&e.jsx("img",{src:g.previewUrl,className:"h-full w-full object-cover"}),g.type==="video"&&e.jsx("video",{src:g.previewUrl,className:"h-full w-full object-cover"}),g.type==="audio"&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-brand-blue bg-gray-100 dark:bg-gray-800 w-full h-full",children:[e.jsx(oe,{size:32}),e.jsx("span",{className:"text-xs text-gray-500 mt-2 truncate max-w-[90%] px-2",children:g.file.name})]}),!p&&e.jsx("button",{onClick:()=>T(y),className:"absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-red-500",children:e.jsx(me,{size:12})})]},y))}),i&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-3 border border-blue-100 dark:border-blue-800/50 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue uppercase",children:"SeshFx Data"}),e.jsx("button",{onClick:()=>r(!1),children:e.jsx(me,{size:14,className:"text-gray-400 hover:text-brand-blue"})})]}),e.jsx(rs,{label:"",options:as,initialValues:m,onChange:(g,y)=>w(y)}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(Me,{size:14,className:"text-gray-400"}),e.jsx("input",{type:"file",className:"text-xs text-gray-500 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:bg-white dark:file:bg-gray-700 dark:file:text-white",onChange:g=>M(g.target.files[0])})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("label",{className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-brand-blue cursor-pointer transition ${p?"opacity-50 pointer-events-none":""}`,title:"Add Image",children:[e.jsx(Ee,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:g=>S(g,"image"),disabled:p})]}),e.jsxs("label",{className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-green-500 cursor-pointer transition ${p?"opacity-50 pointer-events-none":""}`,title:"Add Video",children:[e.jsx(Te,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:g=>S(g,"video"),disabled:p})]}),e.jsxs("label",{className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-purple-500 cursor-pointer transition ${p?"opacity-50 pointer-events-none":""}`,title:"Add Audio Track",children:[e.jsx(oe,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"audio/*",onChange:g=>S(g,"audio"),disabled:p})]}),e.jsx("button",{onClick:()=>r(!i),disabled:p,className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition ${i?"bg-blue-50 dark:bg-blue-900/20 text-brand-blue":"text-gray-400"} ${p?"opacity-50":""}`,title:"Add Plugin Data",children:e.jsx(Ae,{size:20})})]}),e.jsx("button",{onClick:L,disabled:p||!l&&n.length===0,className:"bg-brand-blue text-white px-5 py-1.5 rounded-full font-bold text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition",children:p?e.jsx(ce,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Post"})," ",e.jsx(je,{size:14})]})})]})]})]})]})}function A({title:s,description:t,items:a,loading:l,emptyMessage:d,onSeeMore:n,renderItem:o,gridCols:i="grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}){return l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:s}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t})]}),e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(ce,{className:"animate-spin text-indigo-600",size:32})})]}):!a||a.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:s}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t})]}),e.jsx("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:d||"No items found."})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:s}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t})]}),n&&e.jsx("button",{onClick:n,className:"text-sm text-indigo-600 dark:text-indigo-400 font-semibold hover:underline",children:"See More â†’"})]}),e.jsx("div",{className:`grid ${i} gap-4`,children:a.map((r,m)=>e.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:m*.05},children:o?o(r,m):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:JSON.stringify(r)})},r.id||m))})]})}function V({item:s,type:t,onFollow:a,onViewProfile:l,onPlay:d,isFollowing:n,currentUser:o}){const i=()=>t==="sound"?s.text||"Audio Post":s.displayName||s.name||s.title||"Unknown",r=()=>t==="sound"?s.displayName||"Unknown Artist":t==="artist"||t==="producer"?s.role||s.activeProfileRole||"User":t==="studio"?s.address||s.city||"Location not specified":t==="school"?s.address||"Location not specified":null;return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-all",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"shrink-0",children:t==="sound"?e.jsx("div",{className:"w-12 h-12 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center",children:e.jsx(oe,{size:24,className:"text-indigo-600 dark:text-indigo-400"})}):e.jsx(ae,{src:s.photoURL||s.logoURL,name:i(),size:"md"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold dark:text-white truncate cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition",onClick:l,children:i()}),r()&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate mt-0.5",children:r()}),t==="studio"&&s.amenities&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:s.amenities.slice(0,2).join(", ")}),t==="school"&&s.programs&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[s.programs.length," program",s.programs.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[t==="sound"&&d&&e.jsx("button",{onClick:d,className:"p-2 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition",title:"Play",children:e.jsx(Ve,{size:16,fill:"currentColor"})}),(t==="artist"||t==="producer")&&a&&e.jsx(Ne,{isFollowing:n,onToggle:a,size:"sm"})]})]}),(s.followerCount||s.enrollmentCount)&&e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500 dark:text-gray-400",children:[s.followerCount!==void 0&&e.jsxs("span",{children:[s.followerCount," followers"]}),s.enrollmentCount!==void 0&&e.jsxs("span",{children:[s.enrollmentCount," enrolled"]})]})]})]})})}function ke(s){const t=s.reactionCount||0,a=s.commentCount||0,l=s.saveCount||0;return t*1+a*2+0*3+l*1.5}function gs(s,t="7d"){var i,r;const a=ke(s);if(!s.timestamp)return a;const l=Date.now(),d=((r=(i=s.timestamp)==null?void 0:i.toMillis)==null?void 0:r.call(i))||s.timestamp||l,n=(l-d)/(1e3*60*60);let o=1;return t==="24h"?o=Math.exp(-n/24):t==="7d"?o=Math.exp(-n/168):t==="30d"&&(o=Math.exp(-n/720)),a*o}function ee(s,t,a,l=10){if(!a||a.length===0)return[];const d=a.map(n=>({...n,trendingScore:gs(n,t)}));return d.sort((n,o)=>o.trendingScore-n.trendingScore),d.slice(0,l)}function se(s,t,a,l,d=[],n=10){if(!a||a.length===0)return[];const o=a.filter(r=>r.userId!==s);if(d.length>0){const r=d.map(f=>f.id||f.userId),m=o.filter(f=>r.includes(f.userId||f.id)),w=o.filter(f=>!r.includes(f.userId||f.id));return[...m,...w].slice(0,n)}const i=o.map(r=>({...r,engagementScore:ke(r)}));return i.sort((r,m)=>m.engagementScore-r.engagementScore),i.slice(0,n)}function te(s,t=10){return!s||s.length===0?[]:[...s].sort((l,d)=>{var i,r,m,w,f,M,p,u;const n=((r=(i=l.timestamp)==null?void 0:i.toMillis)==null?void 0:r.call(i))||l.timestamp||((w=(m=l.createdAt)==null?void 0:m.toMillis)==null?void 0:w.call(m))||l.createdAt||0;return(((M=(f=d.timestamp)==null?void 0:f.toMillis)==null?void 0:M.call(f))||d.timestamp||((u=(p=d.createdAt)==null?void 0:p.toMillis)==null?void 0:u.call(p))||d.createdAt||0)-n}).slice(0,t)}function re(s,t){const[a,l]=x.useState(!0),[d,n]=x.useState([]),[o,i]=x.useState([]),[r,m]=x.useState([]),[w,f]=x.useState([]),[M,p]=x.useState([]),[u,k]=x.useState([]);x.useEffect(()=>{if(!(s!=null&&s.id)&&!(s!=null&&s.uid)||!H)return;const T=(s==null?void 0:s.id)||(s==null?void 0:s.uid);(async()=>{try{const{data:g,error:y}=await H.from("follows").select("following_id").eq("follower_id",T);if(y)throw y;k((g||[]).map(R=>R.following_id))}catch(g){console.error("Error loading following:",g)}})()},[s==null?void 0:s.id,s==null?void 0:s.uid]),x.useEffect(()=>{if(!(s!=null&&s.id)&&!(s!=null&&s.uid)||!H){l(!1);return}(async()=>{l(!0);try{const{data:L,error:g}=await H.from("documents").select("*").eq("collection_path","artifacts/seshnx-70c04/public/data/posts").order("created_at",{ascending:!1}).limit(50);if(!g&&L){const N=L.map(j=>({id:j.id,...j.data})).filter(j=>{var Q;return j.audioUrl||((Q=j.media)==null?void 0:Q.some(Z=>Z.type==="audio"))});n(N)}const y=await E(["Talent"]);i(y);const R=await E(["Producer","Engineer"]);m(R);const $=await O();f($);const{data:I,error:B}=await H.from("documents").select("*").eq("collection_path","schools").limit(20);if(!B&&I){const N=I.map(j=>({id:j.id,...j.data}));p(N)}}catch(L){console.error("Error loading discover data:",L)}l(!1)})()},[s==null?void 0:s.id,s==null?void 0:s.uid]);const E=async T=>{if(!H)return[];try{const{data:L,error:g}=await H.from("public_profiles").select("*").limit(100);if(g)throw g;return(L||[]).filter(y=>{const R=y.account_types||[];return T.some($=>R.includes($))}).map(y=>({id:y.id,userId:y.id,...y}))}catch(L){return console.error("Error loading users by role:",L),[]}},O=async()=>{if(!H)return[];try{const{data:T}=await H.from("documents").select("*").eq("collection_path","studios").limit(50),L=(T||[]).map(y=>({id:y.id,...y.data,isStudio:!0})),g=await E(["Studio"]);return[...L,...g]}catch(T){return console.error("Error loading studios:",T),[]}},S=x.useMemo(()=>!t||a?{}:{sounds:{trending:ee("sounds","7d",d,10),recent:te(d,10),personalized:se(s.uid,"sounds",d,t,[],10)},artists:{trending:ee("artists","7d",o,10),recent:te(o,10),personalized:se(s.uid,"artists",o,t,[],10)},producers:{trending:ee("producers","7d",r,10),recent:te(r,10),personalized:se(s.uid,"producers",r,t,[],10)},studios:{trending:ee("studios","7d",w,10),recent:te(w,10),personalized:se(s.uid,"studios",w,t,[],10)},schools:{trending:ee("schools","7d",M,10),recent:te(M,10),personalized:se(s.uid,"schools",M,t,[],10)}},[d,o,r,w,M,t,s==null?void 0:s.uid,a]);return{loading:a,sounds:d,artists:o,producers:r,studios:w,schools:M,following:u,recommendations:S}}function xs({user:s,userData:t,openPublicProfile:a,onFollow:l}){const{loading:d,recommendations:n}=re(s,t),o=(n==null?void 0:n.sounds)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(A,{title:"Trending Sounds",description:"Most popular audio content right now",items:o.trending||[],loading:d,emptyMessage:"No trending sounds found.",renderItem:i=>e.jsx(V,{item:i,type:"sound",onViewProfile:()=>a==null?void 0:a(i.userId),onPlay:()=>{console.log("Play sound:",i.id)}})}),e.jsx(A,{title:"New Releases",description:"Recently posted audio content",items:o.recent||[],loading:d,emptyMessage:"No new sounds found.",renderItem:i=>e.jsx(V,{item:i,type:"sound",onViewProfile:()=>a==null?void 0:a(i.userId),onPlay:()=>{console.log("Play sound:",i.id)}})}),o.personalized&&o.personalized.length>0&&e.jsx(A,{title:"Recommended for You",description:"Based on your activity",items:o.personalized||[],loading:d,emptyMessage:"No recommendations yet.",renderItem:i=>e.jsx(V,{item:i,type:"sound",onViewProfile:()=>a==null?void 0:a(i.userId),onPlay:()=>{console.log("Play sound:",i.id)}})})]})}function ms({user:s,userData:t,openPublicProfile:a}){const{loading:l,recommendations:d}=re(s,t),{isFollowing:n,toggleFollow:o}=ge(s==null?void 0:s.uid),i=(d==null?void 0:d.artists)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(A,{title:"Trending Artists",description:"Most popular artists right now",items:i.trending||[],loading:l,emptyMessage:"No trending artists found.",renderItem:r=>e.jsx(V,{item:r,type:"artist",onViewProfile:()=>a==null?void 0:a(r.userId||r.id),onFollow:()=>o(r.userId||r.id,r),isFollowing:n(r.userId||r.id)})}),e.jsx(A,{title:"New Artists",description:"Recently joined artists",items:i.recent||[],loading:l,emptyMessage:"No new artists found.",renderItem:r=>e.jsx(V,{item:r,type:"artist",onViewProfile:()=>a==null?void 0:a(r.userId||r.id),onFollow:()=>o(r.userId||r.id,r),isFollowing:n(r.userId||r.id)})}),i.personalized&&i.personalized.length>0&&e.jsx(A,{title:"Recommended for You",description:"Based on artists you follow",items:i.personalized||[],loading:l,emptyMessage:"No recommendations yet.",renderItem:r=>e.jsx(V,{item:r,type:"artist",onViewProfile:()=>a==null?void 0:a(r.userId||r.id),onFollow:()=>o(r.userId||r.id,r),isFollowing:n(r.userId||r.id)})})]})}function hs({user:s,userData:t,openPublicProfile:a}){const{loading:l,recommendations:d}=re(s,t),{isFollowing:n,toggleFollow:o}=ge(s==null?void 0:s.uid),i=(d==null?void 0:d.producers)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(A,{title:"Trending Producers",description:"Most popular producers right now",items:i.trending||[],loading:l,emptyMessage:"No trending producers found.",renderItem:r=>e.jsx(V,{item:r,type:"producer",onViewProfile:()=>a==null?void 0:a(r.userId||r.id),onFollow:()=>o(r.userId||r.id,r),isFollowing:n(r.userId||r.id)})}),e.jsx(A,{title:"New Producers",description:"Recently joined producers",items:i.recent||[],loading:l,emptyMessage:"No new producers found.",renderItem:r=>e.jsx(V,{item:r,type:"producer",onViewProfile:()=>a==null?void 0:a(r.userId||r.id),onFollow:()=>o(r.userId||r.id,r),isFollowing:n(r.userId||r.id)})}),i.personalized&&i.personalized.length>0&&e.jsx(A,{title:"Recommended for You",description:"Based on producers you follow",items:i.personalized||[],loading:l,emptyMessage:"No recommendations yet.",renderItem:r=>e.jsx(V,{item:r,type:"producer",onViewProfile:()=>a==null?void 0:a(r.userId||r.id),onFollow:()=>o(r.userId||r.id,r),isFollowing:n(r.userId||r.id)})})]})}function us({user:s,userData:t,openPublicProfile:a}){const{loading:l,recommendations:d}=re(s,t),n=(d==null?void 0:d.studios)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(A,{title:"Trending Studios",description:"Most popular studios right now",items:n.trending||[],loading:l,emptyMessage:"No trending studios found.",renderItem:o=>e.jsx(V,{item:o,type:"studio",onViewProfile:()=>a==null?void 0:a(o.userId||o.id)})}),e.jsx(A,{title:"New Studios",description:"Recently added studios",items:n.recent||[],loading:l,emptyMessage:"No new studios found.",renderItem:o=>e.jsx(V,{item:o,type:"studio",onViewProfile:()=>a==null?void 0:a(o.userId||o.id)})}),n.personalized&&n.personalized.length>0&&e.jsx(A,{title:"Recommended for You",description:"Based on your location and interests",items:n.personalized||[],loading:l,emptyMessage:"No recommendations yet.",renderItem:o=>e.jsx(V,{item:o,type:"studio",onViewProfile:()=>a==null?void 0:a(o.userId||o.id)})})]})}function fs({user:s,userData:t}){const{loading:a,recommendations:l}=re(s,t),d=(l==null?void 0:l.schools)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(A,{title:"Featured Schools",description:"Top music education programs",items:d.trending||[],loading:a,emptyMessage:"No featured schools found.",renderItem:n=>e.jsx(V,{item:n,type:"school",onViewProfile:()=>{console.log("View school:",n.id)}})}),e.jsx(A,{title:"New Schools",description:"Recently added schools",items:d.recent||[],loading:a,emptyMessage:"No new schools found.",renderItem:n=>e.jsx(V,{item:n,type:"school",onViewProfile:()=>{console.log("View school:",n.id)}})}),d.personalized&&d.personalized.length>0&&e.jsx(A,{title:"Recommended for You",description:"Based on your location and interests",items:d.personalized||[],loading:a,emptyMessage:"No recommendations yet.",renderItem:n=>e.jsx(V,{item:n,type:"school",onViewProfile:()=>{console.log("View school:",n.id)}})})]})}const ys=[{id:"sounds",label:"Sounds",icon:oe},{id:"artists",label:"Artists",icon:$e},{id:"producers",label:"Producers",icon:Ye},{id:"studios",label:"Studios",icon:Be},{id:"schools",label:"Schools",icon:We}];function ps({user:s,userData:t,openPublicProfile:a}){const[l,d]=x.useState("sounds"),n=()=>{switch(l){case"sounds":return e.jsx(xs,{user:s,userData:t,openPublicProfile:a});case"artists":return e.jsx(ms,{user:s,userData:t,openPublicProfile:a});case"producers":return e.jsx(hs,{user:s,userData:t,openPublicProfile:a});case"studios":return e.jsx(us,{user:s,userData:t,openPublicProfile:a});case"schools":return e.jsx(fs,{user:s,userData:t});default:return null}};return e.jsxs("div",{className:"max-w-6xl mx-auto pb-20",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm overflow-x-auto",children:ys.map(o=>{const i=o.icon;return e.jsxs("button",{onClick:()=>d(o.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all whitespace-nowrap ${l===o.id?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(i,{size:16}),e.jsx("span",{children:o.label})]},o.id)})}),e.jsx("div",{className:"mt-6",children:n()})]})}const z={FOR_YOU:"for_you",FOLLOWING:"following",DISCOVER:"discover"};function _s({user:s,userData:t,openPublicProfile:a}){var ne,P,D,c,b,G;const[l,d]=x.useState([]),[n,o]=x.useState(!0),[i,r]=x.useState(null),[m,w]=x.useState(z.FOR_YOU),[f,M]=x.useState([]),[p,u]=x.useState(!1),[k,E]=x.useState(!1),{t:O}=ss(),S=((P=(ne=t==null?void 0:t.settings)==null?void 0:ne.social)==null?void 0:P.feedAlgorithm)||"recommended",T=((c=(D=t==null?void 0:t.settings)==null?void 0:D.social)==null?void 0:c.autoPlayVideos)!==!1,L=((G=(b=t==null?void 0:t.settings)==null?void 0:b.social)==null?void 0:G.showSuggestedAccounts)!==!1,g=(s==null?void 0:s.id)||(s==null?void 0:s.uid),{following:y,stats:R,loading:$,isFollowing:I,toggleFollow:B,getFollowingIds:N}=ge(g),j=x.useMemo(()=>N(),[y]);x.useEffect(()=>{const h=(s==null?void 0:s.id)||(s==null?void 0:s.uid);m===z.FOLLOWING&&j.length===0&&h&&Q()},[m,j.length,s==null?void 0:s.id,s==null?void 0:s.uid]);const Q=async()=>{u(!0);try{if(!(s!=null&&s.id)&&!(s!=null&&s.uid))return;const h=s.id||s.uid,C=(await le({limit:20})).filter(F=>F.user_id!==h),q=[...new Set(C.map(F=>F.user_id))];let W={};q.length>0&&(await Pe(q)).forEach(J=>{W[J.user_id]=J.avatar_url||J.photo_url});const v=new Map;C.forEach(F=>{v.has(F.user_id)||v.set(F.user_id,{userId:F.user_id,displayName:F.display_name,photoURL:W[F.user_id]||null,role:F.role})}),M(Array.from(v.values()).slice(0,5))}catch(h){console.error("Error loading suggestions:",h)}u(!1)},Z=()=>{const h=Array.from({length:3});return e.jsxs("div",{className:"space-y-4 p-fluid",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] rounded-2xl border border-gray-200 dark:border-gray-700 p-4 animate-pulse",children:[e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded-xl w-48 mb-3"}),e.jsx("div",{className:"h-14 bg-gray-100 dark:bg-gray-800 rounded-xl w-full mb-2"})]}),h.map((Y,C)=>e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] rounded-2xl border border-gray-200 dark:border-gray-700 p-4 animate-pulse space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3.5 w-32 bg-gray-200 dark:bg-gray-700 rounded-full mb-2"}),e.jsx("div",{className:"h-3 w-20 bg-gray-100 dark:bg-gray-800 rounded-full"})]})]}),e.jsx("div",{className:"h-3 w-5/6 bg-gray-100 dark:bg-gray-800 rounded-full"}),e.jsx("div",{className:"h-3 w-2/3 bg-gray-100 dark:bg-gray-800 rounded-full"}),e.jsx("div",{className:"h-48 bg-gray-100 dark:bg-gray-800 rounded-xl"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsx("div",{className:"h-3 w-12 bg-gray-200 dark:bg-gray-700 rounded-full"})]})]},C))]})};x.useEffect(()=>{o(!0),(async()=>{try{const C=m===z.FOLLOWING&&j.length>0?50:20;let W=(await le({limit:C})).map(v=>({id:v.id,...v,userId:v.user_id,displayName:v.display_name,authorPhoto:v.author_photo,timestamp:v.created_at,commentCount:v.comment_count||0,reactionCount:v.reaction_count||0,saveCount:v.save_count||0}));if(m===z.FOR_YOU&&(S==="following"?j.length>0?W=W.filter(v=>j.includes(v.userId)):W=[]:S==="chronological"||W.sort((v,F)=>{const J=(v.reactionCount||0)*2+(v.commentCount||0)*3+(v.saveCount||0);return(F.reactionCount||0)*2+(F.commentCount||0)*3+(F.saveCount||0)-J})),m===z.FOLLOWING&&j.length>0){const v=(s==null?void 0:s.id)||(s==null?void 0:s.uid);W=W.filter(F=>j.includes(F.userId)||F.userId===v)}d(W),o(!1)}catch(C){console.error("Feed error:",C),o(!1)}})();const Y=setInterval(async()=>{try{const C=await le({limit:10}),q=(s==null?void 0:s.id)||(s==null?void 0:s.uid);C.some(v=>{const F=!C.find(xe=>xe.id===v.id),J=v.user_id!==q;return m===z.FOLLOWING&&j.length>0?F&&J&&j.includes(v.user_id):m===z.FOR_YOU?F&&J:!1})&&E(!0)}catch(C){console.error("Polling error:",C)}},3e4);return()=>{clearInterval(Y)}},[m,j,S,s==null?void 0:s.id,s==null?void 0:s.uid]);const ie=async h=>{if(s)try{const Y=s.id||s.uid,C=h.attachments||[];await De({user_id:Y,display_name:(t==null?void 0:t.effectiveDisplayName)||`${(t==null?void 0:t.firstName)||"User"} ${(t==null?void 0:t.lastName)||""}`.trim(),author_photo:(t==null?void 0:t.photoURL)||null,role:(t==null?void 0:t.activeProfileRole)||"User",text:h.text||null,content:h.text||null,attachments:C,media_urls:C.map(q=>q.url),media_type:C.length>0?C[0].type:null,seshfx:h.seshFx||null,reactions:{},reaction_count:0,comment_count:0,save_count:0,visibility:"public"})}catch(Y){console.error("Failed to post:",Y),alert("Could not post update. Please try again.")}},de={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},U=({suggestedUser:h})=>e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 hover:border-brand-blue/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1 min-w-0",onClick:()=>a==null?void 0:a(h.userId),children:[e.jsx(ae,{src:h.photoURL,name:h.displayName,size:"md"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate hover:text-brand-blue transition",children:h.displayName}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:h.role})]})]}),e.jsx(Ne,{isFollowing:I(h.userId),onToggle:()=>B(h.userId,h),size:"sm",variant:"default"})]});return e.jsxs("div",{className:"max-w-2xl mx-auto pb-20",children:[e.jsx(cs,{user:s,userData:t,onPost:ie}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("button",{onClick:()=>w(z.FOR_YOU),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${m===z.FOR_YOU?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(Ge,{size:16}),e.jsx("span",{children:O("forYou")})]}),e.jsxs("button",{onClick:()=>w(z.FOLLOWING),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${m===z.FOLLOWING?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(he,{size:16}),e.jsx("span",{children:O("following")}),R.followingCount>0&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${m===z.FOLLOWING?"bg-white/20":"bg-gray-200 dark:bg-gray-700"}`,children:R.followingCount})]}),e.jsxs("button",{onClick:()=>w(z.DISCOVER),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${m===z.DISCOVER?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(qe,{size:16}),e.jsx("span",{children:O("discover")})]})]}),e.jsx(X,{children:k&&m!==z.DISCOVER&&e.jsx(_.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-4",children:e.jsxs("button",{onClick:()=>window.location.reload(),className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-gradient-to-r from-brand-blue to-blue-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all",children:[e.jsx(ue,{size:18}),e.jsx("span",{children:"There Are New Posts."}),e.jsx("span",{className:"underline underline-offset-2",children:"Refresh?"})]})})}),m===z.DISCOVER?e.jsx(ps,{user:s,userData:t,openPublicProfile:a}):n||$?Z():e.jsxs(e.Fragment,{children:[m===z.FOLLOWING&&j.length===0&&e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-6 border border-blue-100 dark:border-blue-800/30",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-brand-blue/10 flex items-center justify-center",children:e.jsx(we,{size:28,className:"text-brand-blue"})}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Start following creators"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-sm mx-auto",children:"Follow artists, engineers, and studios to see their posts in your Following feed."})]}),L&&e.jsx(e.Fragment,{children:p?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Suggested for you"}),[1,2,3].map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded-lg"})]},h))]}):f.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Suggested for you"}),f.map(h=>e.jsx(U,{suggestedUser:h},h.userId))]})})]}),e.jsxs(_.div,{variants:de,initial:"hidden",animate:"show",className:"space-y-4",children:[e.jsx(X,{mode:"popLayout",children:l.map(h=>e.jsx(ls,{post:h,currentUser:s,currentUserData:t,openPublicProfile:a||(()=>{}),onReport:()=>r(h),onDelete:Y=>d(C=>C.filter(q=>q.id!==Y)),isFollowingAuthor:I(h.userId),onToggleFollow:()=>B(h.userId,{displayName:h.displayName,photoURL:h.authorPhoto,role:h.role}),autoPlayVideos:T},h.id))}),l.length===0&&m===z.FOR_YOU&&e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(ue,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsxs("p",{children:[O("noPosts"),". ",O("beFirst")]})]}),l.length===0&&m===z.FOLLOWING&&j.length>0&&e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(he,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsxs("p",{children:[O("noPostsFollowing"),"."]}),e.jsx("button",{onClick:()=>w(z.FOR_YOU),className:"mt-3 text-brand-blue hover:underline text-sm font-medium",children:O("browseForYou")})]})]})]}),i&&e.jsx(es,{user:s,target:{id:i.id,type:"Post",summary:i.text?i.text.substring(0,50):"Media Post"},onClose:()=>r(null)})]})}export{_s as default};
