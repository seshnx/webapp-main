{"version":3,"file":"useNotifications-42Kdrv6W.js","sources":["../../src/hooks/useNotifications.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    getNotifications,\r\n    markNotificationAsRead,\r\n    markAllNotificationsAsRead,\r\n    deleteNotification as deleteNotificationQuery,\r\n    clearAllNotifications as clearAllNotificationsQuery,\r\n    createNotification as createNotificationQuery\r\n} from '../config/neonQueries';\r\n\r\n/**\r\n * Notification types:\r\n * - follow: Someone followed you\r\n * - like: Someone reacted to your post\r\n * - comment: Someone commented on your post\r\n * - mention: Someone mentioned you in a post/comment\r\n * - reply: Someone replied to your comment\r\n * - save: Someone saved your post (optional, might be private)\r\n */\r\n\r\n/**\r\n * Hook for managing user notifications\r\n * @param {string} userId - The authenticated user's UID\r\n * @param {number} fetchLimit - Max notifications to fetch (default 50)\r\n */\r\nexport function useNotifications(userId, fetchLimit = 50) {\r\n    const [notifications, setNotifications] = useState([]);\r\n    const [unreadCount, setUnreadCount] = useState(0);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Subscribe to notifications\r\n    useEffect(() => {\r\n        if (!userId) {\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const loadNotifications = async () => {\r\n            try {\r\n                const data = await getNotifications(userId, { limit: fetchLimit, deleted: false });\r\n\r\n                const notifList = data.map(notif => ({\r\n                    id: notif.id,\r\n                    ...notif,\r\n                    timestamp: notif.created_at,\r\n                    read: notif.read || false\r\n                }));\r\n                setNotifications(notifList);\r\n                setUnreadCount(notifList.filter(n => !n.read).length);\r\n                setLoading(false);\r\n            } catch (error) {\r\n                console.error('Notifications fetch error:', error);\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        loadNotifications();\r\n\r\n        // Set up polling (every 30 seconds)\r\n        const pollInterval = setInterval(() => {\r\n            loadNotifications();\r\n        }, 30000);\r\n\r\n        return () => {\r\n            clearInterval(pollInterval);\r\n        };\r\n    }, [userId, fetchLimit]);\r\n\r\n    /**\r\n     * Mark a single notification as read\r\n     */\r\n    const markAsRead = useCallback(async (notificationId) => {\r\n        if (!userId) return;\r\n\r\n        try {\r\n            await markNotificationAsRead(notificationId);\r\n        } catch (error) {\r\n            console.error('Mark as read error:', error);\r\n        }\r\n    }, [userId]);\r\n\r\n    /**\r\n     * Mark all notifications as read\r\n     */\r\n    const markAllAsRead = useCallback(async () => {\r\n        if (!userId || unreadCount === 0) return;\r\n\r\n        try {\r\n            await markAllNotificationsAsRead(userId);\r\n        } catch (error) {\r\n            console.error('Mark all as read error:', error);\r\n        }\r\n    }, [userId, unreadCount]);\r\n\r\n    /**\r\n     * Delete a notification\r\n     */\r\n    const deleteNotification = useCallback(async (notificationId) => {\r\n        if (!userId) return;\r\n\r\n        try {\r\n            await deleteNotificationQuery(notificationId);\r\n        } catch (error) {\r\n            console.error('Delete notification error:', error);\r\n        }\r\n    }, [userId]);\r\n\r\n    /**\r\n     * Clear all notifications (soft delete)\r\n     */\r\n    const clearAll = useCallback(async () => {\r\n        if (!userId) return;\r\n\r\n        try {\r\n            await clearAllNotificationsQuery(userId);\r\n        } catch (error) {\r\n            console.error('Clear all error:', error);\r\n        }\r\n    }, [userId]);\r\n\r\n    return {\r\n        notifications: notifications.filter(n => !n.deleted),\r\n        unreadCount,\r\n        loading,\r\n        markAsRead,\r\n        markAllAsRead,\r\n        deleteNotification,\r\n        clearAll\r\n    };\r\n}\r\n\r\n/**\r\n * Helper function to create notifications (use in other parts of the app)\r\n * Call this when actions happen that should notify users\r\n */\r\nexport async function createNotification({\r\n    targetUserId,\r\n    type,\r\n    fromUserId,\r\n    fromUserName,\r\n    fromUserPhoto,\r\n    postId = null,\r\n    postPreview = null,\r\n    commentId = null,\r\n    message\r\n}) {\r\n    if (!targetUserId || targetUserId === fromUserId) return; // Don't notify yourself\r\n\r\n    try {\r\n        await createNotificationQuery({\r\n            user_id: targetUserId,\r\n            type,\r\n            from_user_id: fromUserId,\r\n            from_user_name: fromUserName,\r\n            from_user_photo: fromUserPhoto || null,\r\n            post_id: postId,\r\n            post_preview: postPreview,\r\n            comment_id: commentId,\r\n            message,\r\n            metadata: {\r\n                postId,\r\n                postPreview,\r\n                commentId,\r\n                fromUserName,\r\n                fromUserPhoto\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error('Create notification error:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Notification message templates\r\n */\r\nexport const NOTIFICATION_MESSAGES = {\r\n    follow: 'started following you',\r\n    like: 'reacted to your post',\r\n    comment: 'commented on your post',\r\n    mention: 'mentioned you',\r\n    reply: 'replied to your comment',\r\n    save: 'saved your post'\r\n};\r\n\r\n/**\r\n * Get notification icon based on type\r\n */\r\nexport const getNotificationIcon = (type) => {\r\n    const icons = {\r\n        follow: 'UserPlus',\r\n        like: 'Heart',\r\n        comment: 'MessageCircle',\r\n        mention: 'AtSign',\r\n        reply: 'CornerDownRight',\r\n        save: 'Bookmark'\r\n    };\r\n    return icons[type] || 'Bell';\r\n};\r\n\r\n"],"names":["useNotifications","userId","fetchLimit","notifications","setNotifications","useState","unreadCount","setUnreadCount","loading","setLoading","useEffect","loadNotifications","notifList","getNotifications","notif","n","error","pollInterval","markAsRead","useCallback","notificationId","markNotificationAsRead","markAllAsRead","markAllNotificationsAsRead","deleteNotification","deleteNotificationQuery","clearAll","clearAllNotificationsQuery","createNotification","targetUserId","type","fromUserId","fromUserName","fromUserPhoto","postId","postPreview","commentId","message","createNotificationQuery"],"mappings":"wnBAyBO,SAASA,EAAiBC,EAAQC,EAAa,GAAI,CACtD,KAAM,CAACC,EAAeC,CAAgB,EAAIC,EAAAA,SAAS,CAAA,CAAE,EAC/C,CAACC,EAAaC,CAAc,EAAIF,EAAAA,SAAS,CAAC,EAC1C,CAACG,EAASC,CAAU,EAAIJ,EAAAA,SAAS,EAAI,EAG3CK,EAAAA,UAAU,IAAM,CACZ,GAAI,CAACT,EAAQ,CACTQ,EAAW,EAAK,EAChB,MACJ,CAEA,MAAME,EAAoB,SAAY,CAClC,GAAI,CAGA,MAAMC,GAFO,MAAMC,EAAiBZ,EAAQ,CAAE,MAAOC,EAAY,QAAS,EAAK,CAAE,GAE1D,IAAIY,IAAU,CACjC,GAAIA,EAAM,GACV,GAAGA,EACH,UAAWA,EAAM,WACjB,KAAMA,EAAM,MAAQ,EACxC,EAAkB,EACFV,EAAiBQ,CAAS,EAC1BL,EAAeK,EAAU,OAAOG,GAAK,CAACA,EAAE,IAAI,EAAE,MAAM,EACpDN,EAAW,EAAK,CACpB,OAASO,EAAO,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,EACjDP,EAAW,EAAK,CACpB,CACJ,EAEAE,IAGA,MAAMM,EAAe,YAAY,IAAM,CACnCN,GACJ,EAAG,GAAK,EAER,MAAO,IAAM,CACT,cAAcM,CAAY,CAC9B,CACJ,EAAG,CAAChB,EAAQC,CAAU,CAAC,EAKvB,MAAMgB,EAAaC,cAAY,MAAOC,GAAmB,CACrD,GAAKnB,EAEL,GAAI,CACA,MAAMoB,EAAuBD,CAAc,CAC/C,OAASJ,EAAO,CACZ,QAAQ,MAAM,sBAAuBA,CAAK,CAC9C,CACJ,EAAG,CAACf,CAAM,CAAC,EAKLqB,EAAgBH,EAAAA,YAAY,SAAY,CAC1C,GAAI,GAAClB,GAAUK,IAAgB,GAE/B,GAAI,CACA,MAAMiB,EAA2BtB,CAAM,CAC3C,OAASe,EAAO,CACZ,QAAQ,MAAM,0BAA2BA,CAAK,CAClD,CACJ,EAAG,CAACf,EAAQK,CAAW,CAAC,EAKlBkB,EAAqBL,cAAY,MAAOC,GAAmB,CAC7D,GAAKnB,EAEL,GAAI,CACA,MAAMwB,EAAwBL,CAAc,CAChD,OAASJ,EAAO,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,CACrD,CACJ,EAAG,CAACf,CAAM,CAAC,EAKLyB,EAAWP,EAAAA,YAAY,SAAY,CACrC,GAAKlB,EAEL,GAAI,CACA,MAAM0B,EAA2B1B,CAAM,CAC3C,OAASe,EAAO,CACZ,QAAQ,MAAM,mBAAoBA,CAAK,CAC3C,CACJ,EAAG,CAACf,CAAM,CAAC,EAEX,MAAO,CACH,cAAeE,EAAc,OAAOY,GAAK,CAACA,EAAE,OAAO,EACnD,YAAAT,EACA,QAAAE,EACA,WAAAU,EACA,cAAAI,EACR,mBAAQE,EACA,SAAAE,CACR,CACA,CAMO,eAAeE,EAAmB,CACrC,aAAAC,EACA,KAAAC,EACA,WAAAC,EACA,aAAAC,EACA,cAAAC,EACA,OAAAC,EAAS,KACT,YAAAC,EAAc,KACd,UAAAC,EAAY,KACZ,QAAAC,CACJ,EAAG,CACC,GAAI,GAACR,GAAgBA,IAAiBE,GAEtC,GAAI,CACA,MAAMO,EAAwB,CAC1B,QAAST,EACT,KAAAC,EACA,aAAcC,EACd,eAAgBC,EAChB,gBAAiBC,GAAiB,KAClC,QAASC,EACT,aAAcC,EACd,WAAYC,EACZ,QAAAC,EACA,SAAU,CACN,OAAAH,EACA,YAAAC,EACA,UAAAC,EACA,aAAAJ,EACA,cAAAC,CAChB,CACA,CAAS,CACL,OAASjB,EAAO,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,CACrD,CACJ"}