import{r as o,e as v,j as i}from"./vendor-CzMudb4J.js";import{b as j,i as h,a as k,C as u,d as I,e as N}from"./chat-C8KEVgfe.js";import{m as b,A as S}from"./vendor-framer-BfJ9H82C.js";function M({user:a,userData:d,openPublicProfile:p,pendingChatTarget:s,clearPendingChatTarget:l}){const[e,n]=o.useState(null),[m,f]=o.useState(!1);j(a==null?void 0:a.uid),o.useEffect(()=>{if(s&&(a!=null&&a.uid)){const t=[a.uid,s.uid].sort().join("_");n({id:t,uid:s.uid,name:s.name,type:"direct"}),l==null||l()}},[s,a==null?void 0:a.uid,l]);const r=h(),w=o.useMemo(()=>a!=null&&a.uid&&r?{userId:a.uid}:"skip",[a==null?void 0:a.uid,r]),c=v(k.conversations.getConversations,w),x=o.useMemo(()=>c?c.map(t=>({id:t.chatId,uid:t.otherUserId||t.chatId,name:t.chatName||"Unknown",n:t.chatName||"Unknown",photo:t.chatPhoto||"",type:t.chatType||"direct",lm:t.lastMessage||"",lmt:t.lastMessageTime||0,ls:t.lastSenderId||"",uc:t.unreadCount||0})).sort((t,y)=>(y.lmt||0)-(t.lmt||0)):[],[c]);return o.useEffect(()=>{h()||console.warn("Convex is not available. Chat functionality is disabled.")},[]),i.jsxs("div",{className:"flex h-[calc(100vh-100px)] bg-white dark:bg-[#1f2128] rounded-2xl overflow-hidden border dark:border-gray-800 shadow-xl",children:[i.jsx(b.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`w-full md:w-80 border-r dark:border-gray-800 flex flex-col ${e?"hidden md:flex":"flex"}`,children:i.jsx(u,{user:a,userData:d,conversations:x,activeChat:e,onSelectChat:n})}),i.jsxs("div",{className:`flex-1 flex flex-col relative ${e?"flex":"hidden md:flex"}`,children:[i.jsx(I,{activeChat:e,user:a,userData:d,conversations:x,onBack:()=>n(null),toggleDetails:()=>f(!m),openPublicProfile:p}),i.jsx(S,{children:m&&e&&i.jsx(b.div,{initial:{width:0,opacity:0},animate:{width:300,opacity:1},exit:{width:0,opacity:0},className:"border-l dark:border-gray-800 bg-gray-50 dark:bg-[#23262f] overflow-hidden relative z-20",children:i.jsx(N,{activeChat:e,currentUser:d,onClose:()=>f(!1)})})})]})]})}export{M as default};
