{"version":3,"mappings":"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","names":["MobileBottomNav","activeTab","setActiveTab","isMobile","setIsMobile","useState","useEffect","checkMobile","navItems","Home","MessageSquare","Calendar","MessageCircle","User","jsx","item","Icon","isActive","jsxs","retryLazyLoad","importFn","retries","delay","lazy","resolve","reject","attempt","attemptNumber","promise","module","error","Sidebar","__vitePreload","Navbar","PublicProfileModal","Dashboard","SocialFeed","ChatInterface","BookingSystem","Marketplace","TechServices","PaymentsManager","ProfileManager","BusinessCenter","LegalDocs","EduStudentDashboard","n","EduInternDashboard","EduStaffDashboard","EduAdminDashboard","LoadingFallback","Loader2","MainLayout","user","userData","loading","darkMode","toggleTheme","handleLogout","navigate","useNavigate","location","useLocation","getTabFromPath","path","sidebarOpen","setSidebarOpen","subProfiles","setSubProfiles","tokenBalance","setTokenBalance","viewingProfile","setViewingProfile","pendingChatTarget","setPendingChatTarget","isInitializingRef","useRef","fromPathnameRef","prevPathnameRef","isNavigatingRef","newTab","prevTab","route","supabase","data","profiles","profile","err","handleRoleSwitch","newRole","openPublicProfile","useCallback","uid","name","clearPendingChatTarget","renderContent","ErrorBoundary","Suspense","SchoolProvider"],"ignoreList":[],"sources":["../../src/components/MobileBottomNav.jsx","../../src/components/MainLayout.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { User, MessageSquare, Calendar, MessageCircle, Home } from 'lucide-react';\r\n\r\n/**\r\n * Mobile Bottom Navigation\r\n * \r\n * Provides quick access to primary navigation items on mobile devices.\r\n * Only visible on screens < 1024px (mobile/tablet).\r\n */\r\nexport default function MobileBottomNav({ activeTab, setActiveTab }) {\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  \r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n      setIsMobile(window.innerWidth < 1024);\r\n    };\r\n    \r\n    checkMobile();\r\n    window.addEventListener('resize', checkMobile);\r\n    return () => window.removeEventListener('resize', checkMobile);\r\n  }, []);\r\n  \r\n  if (!isMobile) return null;\r\n  \r\n  const navItems = [\r\n    { id: 'dashboard', icon: Home, label: 'Home' },\r\n    { id: 'feed', icon: MessageSquare, label: 'Feed' },\r\n    { id: 'bookings', icon: Calendar, label: 'Bookings' },\r\n    { id: 'messages', icon: MessageCircle, label: 'Messages' },\r\n    { id: 'profile', icon: User, label: 'Profile' },\r\n  ];\r\n  \r\n  return (\r\n    <nav \r\n      className=\"fixed bottom-0 left-0 right-0 bg-white dark:bg-[#1f2128] border-t border-gray-200 dark:border-gray-700 z-50 safe-area-bottom shadow-lg\"\r\n      aria-label=\"Bottom navigation\"\r\n      style={{ paddingBottom: 'max(0.5rem, env(safe-area-inset-bottom))' }}\r\n    >\r\n      <div className=\"flex justify-around items-center h-16 px-2\">\r\n        {navItems.map((item) => {\r\n          const Icon = item.icon;\r\n          const isActive = activeTab === item.id;\r\n          \r\n          return (\r\n            <button\r\n              key={item.id}\r\n              onClick={() => setActiveTab(item.id)}\r\n              className={`flex flex-col items-center justify-center gap-1 flex-1 h-full transition-colors ${\r\n                isActive\r\n                  ? 'text-brand-blue dark:text-blue-400'\r\n                  : 'text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'\r\n              }`}\r\n              aria-label={item.label}\r\n              aria-current={isActive ? 'page' : undefined}\r\n            >\r\n              <Icon size={22} strokeWidth={isActive ? 2.5 : 2} />\r\n              <span className=\"text-xs font-medium\">{item.label}</span>\r\n              {isActive && (\r\n                <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-8 h-1 bg-brand-blue dark:bg-blue-400 rounded-b-full\" />\r\n              )}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n    </nav>\r\n  );\r\n}\r\n\r\n","import React, { useState, useEffect, useRef, useCallback, Suspense, lazy } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { SchoolProvider } from '../contexts/SchoolContext';\nimport { supabase } from '../config/supabase';\nimport { Loader2 } from 'lucide-react';\nimport ErrorBoundary from './shared/ErrorBoundary';\nimport MobileBottomNav from './MobileBottomNav';\n\n// Retry wrapper for lazy loading to handle initialization errors\nconst retryLazyLoad = (importFn, retries = 3, delay = 100) => {\n  return lazy(() => {\n    return new Promise((resolve, reject) => {\n      const attempt = (attemptNumber) => {\n        // Wrap in try-catch to handle synchronous errors\n        try {\n          const promise = importFn();\n          // If it's already a promise, handle it\n          if (promise && typeof promise.then === 'function') {\n            promise\n              .then((module) => {\n                // Ensure we get the default export\n                resolve(module.default ? module : { default: module });\n              })\n              .catch((error) => {\n                if (attemptNumber < retries) {\n                  console.warn(`Lazy load failed, retrying... (${attemptNumber + 1}/${retries})`, error);\n                  setTimeout(() => attempt(attemptNumber + 1), delay * (attemptNumber + 1));\n                } else {\n                  console.error('Lazy load failed after retries:', error);\n                  reject(error);\n                }\n              });\n          } else {\n            resolve(promise);\n          }\n        } catch (error) {\n          // Handle synchronous errors (like circular dependencies)\n          if (attemptNumber < retries) {\n            console.warn(`Lazy load sync error, retrying... (${attemptNumber + 1}/${retries})`, error);\n            setTimeout(() => attempt(attemptNumber + 1), delay * (attemptNumber + 1));\n          } else {\n            console.error('Lazy load failed after retries (sync error):', error);\n            reject(error);\n          }\n        }\n      };\n      attempt(0);\n    });\n  });\n};\n\n// Lazy load ALL components to prevent initialization errors with retry mechanism\nconst Sidebar = retryLazyLoad(() => import('./Sidebar'));\nconst Navbar = retryLazyLoad(() => import('./Navbar'));\nconst PublicProfileModal = retryLazyLoad(() => import('./PublicProfileModal'));\nconst Dashboard = retryLazyLoad(() => import('./Dashboard'));\nconst SocialFeed = retryLazyLoad(() => import('./SocialFeed'));\nconst ChatInterface = retryLazyLoad(() => import('./ChatInterface'));\nconst BookingSystem = retryLazyLoad(() => import('./BookingSystem'));\nconst Marketplace = retryLazyLoad(() => import('./Marketplace'));\nconst TechServices = retryLazyLoad(() => import('./TechServices'));\nconst PaymentsManager = retryLazyLoad(() => import('./PaymentsManager'));\nconst ProfileManager = retryLazyLoad(() => import('./ProfileManager'));\nconst BusinessCenter = retryLazyLoad(() => import('./BusinessCenter'));\nconst LegalDocs = retryLazyLoad(() => import('./LegalDocs'));\nconst EduStudentDashboard = retryLazyLoad(() => import('./EDU/EduStudentDashboard'));\nconst EduInternDashboard = retryLazyLoad(() => import('./EDU/EduInternDashboard'));\nconst EduStaffDashboard = retryLazyLoad(() => import('./EDU/EduStaffDashboard'));\nconst EduAdminDashboard = retryLazyLoad(() => import('./EDU/EduAdminDashboard'));\n\n// Shared loading fallback component\nconst LoadingFallback = () => (\n  <div className=\"flex items-center justify-center p-4\">\n    <Loader2 className=\"animate-spin text-brand-blue\" size={24} />\n  </div>\n);\n\nexport default function MainLayout({ \n  user, \n  userData, \n  loading, \n  darkMode, \n  toggleTheme, \n  handleLogout \n}) {\n  // CRITICAL: Call hooks first before using them in state initializers\n  const navigate = useNavigate();\n  const location = useLocation();\n  \n  // Helper function to get tab from pathname (supports nested routes)\n  const getTabFromPath = (path) => {\n    if (path === '/') return 'dashboard';\n    if (path.startsWith('/feed') || path === '/social') return 'feed';\n    if (path.startsWith('/messages') || path.startsWith('/chat')) return 'messages';\n    if (path.startsWith('/bookings')) return 'bookings';\n    if (path.startsWith('/marketplace')) return 'marketplace';\n    if (path.startsWith('/tech')) return 'tech';\n    if (path.startsWith('/payments') || path === '/billing') return 'payments';\n    if (path.startsWith('/profile')) return 'profile';\n    if (path.startsWith('/business-center')) return 'business-center';\n    if (path === '/legal') return 'legal';\n    if (path.startsWith('/studio-ops')) return 'studio-ops';\n    if (path.startsWith('/edu-')) return path.substring(1).split('/')[0]; // Handle nested edu routes\n    return 'dashboard'; // default\n  };\n\n  // Initialize activeTab from current pathname (now location is available)\n  const [activeTab, setActiveTab] = useState(() => getTabFromPath(location.pathname));\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const [subProfiles, setSubProfiles] = useState({});\n  const [tokenBalance, setTokenBalance] = useState(0);\n  const [viewingProfile, setViewingProfile] = useState(null);\n  const [pendingChatTarget, setPendingChatTarget] = useState(null);\n  \n  // Track if we're initializing to prevent navigation loops\n  const isInitializingRef = useRef(true);\n  // Track if activeTab change came from pathname (to prevent navigation loop)\n  const fromPathnameRef = useRef(false);\n  // Track previous pathname to detect actual changes\n  const prevPathnameRef = useRef(location.pathname);\n  // Track if user is currently navigating (to prevent pathname sync from overriding)\n  const isNavigatingRef = useRef(false);\n\n  // Sync activeTab with route (pathname is source of truth)\n  useEffect(() => {\n    const path = location.pathname;\n    \n    // Only sync if pathname actually changed (not just a re-render)\n    if (prevPathnameRef.current === path) {\n      // Still mark initialization as complete even if pathname didn't change\n      if (isInitializingRef.current) {\n        isInitializingRef.current = false;\n      }\n      return;\n    }\n    \n    prevPathnameRef.current = path;\n    const newTab = getTabFromPath(path);\n    \n    // If we were navigating, this is the completion of that navigation\n    // Reset the flag and update activeTab\n    if (isNavigatingRef.current) {\n      isNavigatingRef.current = false;\n    }\n    \n    // Always update from pathname (pathname is source of truth)\n    // Use functional update to compare against latest state\n    setActiveTab(prevTab => {\n      if (prevTab !== newTab) {\n        fromPathnameRef.current = true; // Mark that this change came from pathname\n        return newTab;\n      }\n      return prevTab; // No change needed\n    });\n    \n    // Mark initialization as complete after first sync\n    if (isInitializingRef.current) {\n      isInitializingRef.current = false;\n    }\n  }, [location.pathname]); // Only depend on pathname\n\n  // Update URL when tab changes (only if user-initiated, not from pathname sync)\n  useEffect(() => {\n    // Skip navigation during initialization\n    if (isInitializingRef.current) {\n      return;\n    }\n    \n    // Skip navigation if the change came from pathname sync\n    if (fromPathnameRef.current) {\n      fromPathnameRef.current = false; // Reset flag\n      return;\n    }\n    \n    const tabRoutes = {\n      'dashboard': '/',\n      'feed': '/feed',\n      'messages': '/messages',\n      'bookings': '/bookings',\n      'marketplace': '/marketplace',\n      'tech': '/tech',\n      'payments': '/payments',\n      'profile': '/profile',\n      'business-center': '/business-center',\n      'legal': '/legal',\n      'edu-student': '/edu-student',\n      'edu-intern': '/edu-intern',\n      'edu-overview': '/edu-overview',\n      'edu-admin': '/edu-admin',\n      'studio-ops': '/studio-ops',\n    };\n\n    const route = tabRoutes[activeTab];\n    // Only navigate if route exists and pathname doesn't start with the route\n    // This allows nested routes to persist (e.g., /bookings/calendar stays as is)\n    if (route && !location.pathname.startsWith(route)) {\n      isNavigatingRef.current = true; // Mark that we're navigating\n      navigate(route, { replace: true });\n    }\n  }, [activeTab, navigate, location.pathname]);\n\n  // Load sub-profiles\n  useEffect(() => {\n    if (!user?.id || !supabase) return;\n\n    const loadSubProfiles = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('sub_profiles')\n          .select('*')\n          .eq('user_id', user.id);\n\n        if (error) {\n          console.warn('Error loading sub-profiles:', error);\n          return;\n        }\n\n        const profiles = {};\n        data?.forEach(profile => {\n          profiles[profile.role] = profile;\n        });\n        setSubProfiles(profiles);\n      } catch (err) {\n        console.error('Failed to load sub-profiles:', err);\n      }\n    };\n\n    loadSubProfiles();\n  }, [user?.id]);\n\n  // Load token balance\n  useEffect(() => {\n    if (!user?.id || !supabase) return;\n\n    const loadBalance = async () => {\n      try {\n        const { data } = await supabase\n          .from('wallets')\n          .select('balance')\n          .eq('user_id', user.id)\n          .maybeSingle();\n\n        if (data) {\n          setTokenBalance(data.balance || 0);\n        }\n      } catch (err) {\n        console.warn('Failed to load token balance:', err);\n      }\n    };\n\n    loadBalance();\n  }, [user?.id]);\n\n  const handleRoleSwitch = async (newRole) => {\n    if (!user || !supabase) return;\n    \n    // Optimistic update\n    const updatedUserData = { ...userData, activeProfileRole: newRole };\n    \n    try {\n      await supabase\n        .from('profiles')\n        .update({ active_role: newRole, updated_at: new Date().toISOString() })\n        .eq('id', user.id);\n    } catch (e) {\n      console.error(\"Role switch failed:\", e);\n    }\n  };\n\n  const openPublicProfile = useCallback((uid, name) => {\n    setViewingProfile({ uid, name });\n  }, []);\n\n  const clearPendingChatTarget = useCallback(() => {\n    setPendingChatTarget(null);\n  }, []);\n\n\n  // Determine which content to render based on activeTab\n  // Using a function instead of useMemo to avoid hook initialization issues\n  const renderContent = () => {\n    // Guard: Return loading if userData is not ready\n    if (!userData || !userData.id) {\n      return (\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue mx-auto mb-4\"></div>\n            <p className=\"text-gray-600 dark:text-gray-400\">Loading...</p>\n          </div>\n        </div>\n      );\n    }\n\n    const LoadingFallback = () => (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <Loader2 className=\"animate-spin text-brand-blue\" size={32} />\n      </div>\n    );\n\n    switch (activeTab) {\n      case 'dashboard':\n        return (\n          <ErrorBoundary name=\"Dashboard\">\n            <Suspense \n              fallback={<LoadingFallback />}\n              // Add error boundary inside Suspense to catch initialization errors\n            >\n              <ErrorBoundary name=\"Dashboard-Inner\">\n                <Dashboard\n                  user={user}\n                  userData={userData}\n                  setActiveTab={setActiveTab}\n                  bookingCount={0}\n                  subProfiles={subProfiles}\n                  tokenBalance={tokenBalance}\n                />\n              </ErrorBoundary>\n            </Suspense>\n          </ErrorBoundary>\n        );\n\n      case 'feed':\n      case 'social':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <SocialFeed\n              user={user}\n              userData={userData}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'messages':\n      case 'chat':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <ChatInterface\n              user={user}\n              userData={userData}\n              openPublicProfile={openPublicProfile}\n              pendingChatTarget={pendingChatTarget}\n              clearPendingChatTarget={clearPendingChatTarget}\n            />\n          </Suspense>\n        );\n\n      case 'bookings':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <BookingSystem\n              user={user}\n              userData={userData}\n              subProfiles={subProfiles}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'marketplace':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <Marketplace\n              user={user}\n              userData={userData}\n              tokenBalance={tokenBalance}\n            />\n          </Suspense>\n        );\n\n      case 'tech':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <TechServices\n              user={user}\n              userData={userData}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'payments':\n      case 'billing':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <PaymentsManager\n              user={user}\n              userData={userData}\n              tokenBalance={tokenBalance}\n            />\n          </Suspense>\n        );\n\n      case 'profile':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <ProfileManager\n              user={user}\n              userData={userData}\n              subProfiles={subProfiles}\n              handleLogout={handleLogout}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'business-center':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <BusinessCenter\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'legal':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <LegalDocs />\n          </Suspense>\n        );\n\n      case 'edu-student':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduStudentDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'edu-intern':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduInternDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'edu-overview':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduStaffDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'edu-admin':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduAdminDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'studio-ops':\n        // Studio operations are handled within BusinessCenter\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <BusinessCenter\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      default:\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <Dashboard\n              user={user}\n              userData={userData}\n              setActiveTab={setActiveTab}\n              bookingCount={0}\n              subProfiles={subProfiles}\n              tokenBalance={tokenBalance}\n            />\n          </Suspense>\n        );\n    }\n  };\n\n  return (\n    <SchoolProvider user={user} userData={userData}>\n      <div className=\"flex h-screen overflow-hidden bg-gray-50 dark:bg-[#1a1d21]\">\n        {/* Sidebar */}\n        <Suspense fallback={<LoadingFallback />}>\n          <Sidebar\n            userData={userData}\n            activeTab={activeTab}\n            setActiveTab={setActiveTab}\n            sidebarOpen={sidebarOpen}\n            setSidebarOpen={setSidebarOpen}\n            handleLogout={handleLogout}\n          />\n        </Suspense>\n\n      {/* Main Content Area */}\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* Navbar */}\n        <Suspense fallback={<LoadingFallback />}>\n          <Navbar\n            user={user}\n            userData={userData}\n            subProfiles={subProfiles}\n            darkMode={darkMode}\n            toggleTheme={toggleTheme}\n            activeTab={activeTab}\n            setActiveTab={setActiveTab}\n            onMenuClick={() => setSidebarOpen(!sidebarOpen)}\n            onRoleSwitch={handleRoleSwitch}\n            openPublicProfile={openPublicProfile}\n          />\n        </Suspense>\n\n        {/* Content */}\n        <main className=\"flex-1 overflow-y-auto pb-16 lg:pb-0 px-fluid pt-4\">\n          {renderContent()}\n        </main>\n      </div>\n\n        {/* Mobile Bottom Navigation */}\n        <MobileBottomNav activeTab={activeTab} setActiveTab={setActiveTab} />\n\n        {/* Public Profile Modal */}\n        {viewingProfile && (\n          <Suspense fallback={null}>\n            <PublicProfileModal\n            userId={viewingProfile.uid}\n            currentUser={user}\n            currentUserData={userData}\n            onClose={() => setViewingProfile(null)}\n            onMessage={(uid, name) => {\n              setPendingChatTarget({ uid, name });\n              setActiveTab('messages');\n              setViewingProfile(null);\n            }}\n          />\n          </Suspense>\n        )}\n      </div>\n    </SchoolProvider>\n  );\n}\n\n"],"file":"assets/MainLayout-BIgwDEJb.js"}