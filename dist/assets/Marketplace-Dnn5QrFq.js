import{j as e,r as a,a5 as st,X as Y,al as je,ak as at,ao as X,Q as rt,g as De,x as _,m as Re,cF as lt,ab as nt,L as te,af as q,b_ as ye,cG as Ne,R as Me,$ as pe,a0 as ae,bV as Pe,h as ne,a1 as ze,an as _e,bW as J,c9 as $e,c8 as Be,S as Ue,cH as He,P as Ge,cI as ee,cJ as Ve,c5 as it,K as Ye,aq as dt,ar as ot,cK as We,bT as Ze,y as ct,cL as Oe,cn as Ie,b$ as oe,cw as qe,cM as Xe,ck as Ke,O as xt,Y as gt,D as ht,bI as bt,bH as mt}from"./vendor-DgLHK7fS.js";import{u as ge,U as Le,s as re}from"./chat-B_DYfz3i.js";import{PROXIMITY_THRESHOLD_METERS as me,SAFE_ZONE_TYPES as ut,SAFE_ZONE_RADIUS_METERS as pt,SAFE_EXCHANGE_STATUS as k,SAFE_EXCHANGE_STEPS as Ae,EQUIP_CATEGORIES as fe,HIGH_VALUE_THRESHOLD as xe}from"./config-yUl3KxdD.js";import{m as ce,A as Qe}from"./vendor-framer-Bk6jyNS8.js";import{R as ft,S as jt}from"./ReportModal-Bg43gDOB.js";import"./vendor-audio-Bu2lAtPy.js";const yt=[{id:"guitar_electric",label:"Electric Guitar"},{id:"guitar_acoustic",label:"Acoustic Guitar"},{id:"amp_head",label:"Amplifier Head"},{id:"amp_combo",label:"Combo Amp"},{id:"keyboard",label:"Keyboard/Synth"},{id:"rack_unit",label:"Rack Gear (1U/2U)"},{id:"pedal",label:"Pedal/Stompbox"}],Je=({type:s,view:l,onClick:d,markers:i=[]})=>{var g;const v=()=>i.map((c,b)=>e.jsxs("g",{transform:`translate(${c.x}, ${c.y})`,children:[e.jsx("circle",{r:"6",fill:"#ef4444",stroke:"white",strokeWidth:"2",className:"drop-shadow-md"}),e.jsx("text",{y:"-10",textAnchor:"middle",fill:"#ef4444",fontSize:"10",fontWeight:"bold",children:b+1})]},b)),p={width:"100%",height:"400",viewBox:"0 0 300 400",className:"w-full h-full cursor-crosshair touch-none select-none",onClick:c=>{const b=c.target.getBoundingClientRect(),f=(c.clientX-b.left)*(300/b.width),T=(c.clientY-b.top)*(400/b.height);d(f,T)}},t={guitar_electric:{front:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2",strokeDasharray:"5,5"})},amp_combo:{front:e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsxs("g",{children:[e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2"}),e.jsx("rect",{x:"70",y:"200",width:"160",height:"80",fill:"#9ca3af",opacity:"0.5"})]})}},y=()=>e.jsx("rect",{x:"50",y:"50",width:"200",height:"300",rx:"10",fill:"#f3f4f6",stroke:"#9ca3af",strokeWidth:"2",strokeDasharray:"4"}),m=((g=t[s])==null?void 0:g[l])||e.jsx(y,{});return e.jsxs("svg",{...p,children:[m,v()]})};function Nt({initialData:s,onSave:l,onCancel:d,type:i}){const[v,p]=a.useState((s==null?void 0:s.gearType)||"guitar_electric"),[t,y]=a.useState("front"),[m,g]=a.useState((s==null?void 0:s.markers)||[]),[c,b]=a.useState((s==null?void 0:s.notes)||""),[f,T]=a.useState((s==null?void 0:s.photos)||[]),[j,P]=a.useState(null),[A,$]=a.useState(""),{uploadMedia:h,uploading:L}=ge(),u=(o,S)=>{const N={x:o,y:S,view:t,id:Date.now(),label:""};g([...m,N]),P(N),$("")},n=()=>{j&&(g(m.map(o=>o.id===j.id?{...o,label:A}:o)),P(null))},U=async o=>{const S=o.target.files[0];if(!S)return;const N=await h(S,`inspections/${Date.now()}`);N&&T(C=>[...C,N])};return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden flex flex-col h-[80vh]",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(st,{className:i==="Pre"?"text-orange-500":"text-green-500",size:20})," ",i,"-Inspection Report"]}),e.jsx("button",{onClick:d,children:e.jsx(Y,{className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-black/40 relative flex flex-col items-center justify-center p-4",children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[e.jsx("select",{className:"p-2 rounded-lg border dark:border-gray-600 bg-white dark:bg-[#1f2128] text-sm font-bold dark:text-white shadow-sm",value:v,onChange:o=>p(o.target.value),children:yt.map(o=>e.jsx("option",{value:o.id,children:o.label},o.id))}),e.jsx("div",{className:"flex bg-white dark:bg-[#1f2128] rounded-lg border dark:border-gray-600 p-1 shadow-sm",children:["front","back","sides"].map(o=>e.jsx("button",{onClick:()=>y(o),className:`px-3 py-1 text-xs font-bold rounded-md capitalize ${t===o?"bg-brand-blue text-white":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:o},o))})]}),e.jsxs("div",{className:"w-full max-w-md h-full aspect-[3/4] bg-white dark:bg-[#1f2128] rounded-xl shadow-inner border dark:border-gray-700 relative",children:[e.jsx(Je,{type:v,view:t,markers:m.filter(o=>o.view===t),onClick:u}),j&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 bg-white dark:bg-[#2c2e36] p-4 rounded-xl shadow-2xl border border-brand-blue z-20 animate-in zoom-in-95",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 mb-2",children:"Identify Issue"}),e.jsx("input",{autoFocus:!0,className:"w-full p-2 border rounded mb-2 text-sm dark:bg-black/20 dark:text-white",placeholder:"e.g. Scratch",value:A,onChange:o=>$(o.target.value),onKeyDown:o=>o.key==="Enter"&&n()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{g(m.filter(o=>o.id!==j.id)),P(null)},className:"flex-1 bg-red-100 text-red-600 py-1 rounded text-xs font-bold",children:"Delete"}),e.jsx("button",{onClick:n,className:"flex-1 bg-brand-blue text-white py-1 rounded text-xs font-bold",children:"Save"})]})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Damage Log"}),e.jsx("div",{className:"space-y-2",children:m.map((o,S)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-black/20 rounded border dark:border-gray-700",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-red-500 text-white flex items-center justify-center text-xs font-bold shrink-0",children:S+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:o.label||"Unlabeled"}),e.jsxs("div",{className:"text-[10px] text-gray-500 uppercase",children:[o.view," View"]})]}),e.jsx("button",{onClick:()=>g(m.filter(N=>N.id!==o.id)),children:e.jsx(Y,{size:14,className:"text-gray-400 hover:text-red-500"})})]},S))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Notes"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg text-sm dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Overall condition...",value:c,onChange:o=>b(o.target.value)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Evidence Photos"}),e.jsxs("label",{className:"cursor-pointer text-brand-blue hover:text-blue-600",children:[e.jsx(je,{size:16}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:U,disabled:L})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:f.map((o,S)=>e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden border dark:border-gray-600 relative group",children:[e.jsx("img",{src:o.url,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>T(f.filter((N,C)=>C!==S)),className:"absolute top-1 right-1 bg-red-500 text-white p-0.5 rounded opacity-0 group-hover:opacity-100 transition",children:e.jsx(Y,{size:12})})]},S))})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:()=>l({gearType:v,markers:m,notes:c,photos:f,timestamp:new Date().toISOString()}),className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(at,{size:18})," Finalize Report"]})})]})]})]})}const de=(s,l,d,i)=>{const p=s*Math.PI/180,t=d*Math.PI/180,y=(d-s)*Math.PI/180,m=(i-l)*Math.PI/180,g=Math.sin(y/2)*Math.sin(y/2)+Math.cos(p)*Math.cos(t)*Math.sin(m/2)*Math.sin(m/2);return 6371e3*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))};function vt(s,l){const[d,i]=a.useState(null),[v,p]=a.useState(null),[t,y]=a.useState(!1),[m,g]=a.useState(null),[c,b]=a.useState([]),[f,T]=a.useState(null),[j,P]=a.useState(null),[A,$]=a.useState(!1),[h,L]=a.useState(!0),[u,n]=a.useState(null),U=a.useRef(Date.now());a.useEffect(()=>{(async()=>{})()},[]);const o=a.useCallback(()=>{if(!navigator.geolocation){p("Geolocation is not supported by your browser"),L(!1);return}const w={enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3},H=z=>{const{latitude:R,longitude:W,accuracy:G}=z.coords;i({lat:R,lng:W,accuracy:G,timestamp:Date.now()}),p(null),L(!1),U.current=Date.now()},D=z=>{let R;switch(z.code){case z.PERMISSION_DENIED:R="Location permission denied. Please enable location access.";break;case z.POSITION_UNAVAILABLE:R="Location information unavailable.";break;case z.TIMEOUT:R="Location request timed out.";break;default:R="An unknown error occurred getting location."}p(R),L(!1)},O=navigator.geolocation.watchPosition(H,D,w);return n(O),()=>{O&&navigator.geolocation.clearWatch(O)}},[]),S=a.useCallback(()=>{u&&(navigator.geolocation.clearWatch(u),n(null))},[u]);a.useEffect(()=>{if(!d||c.length===0){y(!1);return}let w=null,H=1/0,D=!1;for(const O of c){if(!O.lat||!O.lng)continue;const z=de(d.lat,d.lng,O.lat,O.lng);z<H&&(H=z,w={...O,distance:z}),z<=pt&&(D=!0)}g(w),y(D)},[d,c]),a.useEffect(()=>{if(!d||!f){P(null),$(!1);return}const w=de(d.lat,d.lng,f.lat,f.lng);P(w),$(w<=me)},[d,f]);const N=a.useCallback(w=>{T(w)},[]),C=a.useCallback(async()=>{if(!d)return[];try{const w=["police","fire_station","bank","library","townhall"],H=[];for(const D of w)try{const O=await fetch(`https://nominatim.openstreetmap.org/search?q=${D}&format=json&lat=${d.lat}&lon=${d.lng}&bounded=1&viewbox=${d.lng-.1},${d.lat+.1},${d.lng+.1},${d.lat-.1}&limit=5`,{headers:{"User-Agent":"SeshNx-SafeExchange/1.0"}});if(O.ok){const z=await O.json();for(const R of z){const W=de(d.lat,d.lng,parseFloat(R.lat),parseFloat(R.lon)),G=ut.find(K=>D.includes(K.id.split("_")[0]));H.push({id:`osm_${R.place_id}`,name:R.display_name.split(",")[0],address:R.display_name,lat:parseFloat(R.lat),lng:parseFloat(R.lon),distance:W,type:(G==null?void 0:G.id)||"public_building",typeLabel:(G==null?void 0:G.label)||"Public Building",priority:(G==null?void 0:G.priority)||10})}}}catch(O){console.warn(`Failed to fetch ${D}:`,O)}return H.sort((D,O)=>D.priority!==O.priority?D.priority-O.priority:D.distance-O.distance),H.slice(0,10)}catch(w){return console.error("Failed to find nearby safe zones:",w),[]}},[d]),B=a.useCallback(async w=>{throw new Error("Supabase not configured")},[]),r=a.useCallback(()=>!d||!m?{verified:!1,message:"Unable to verify location"}:t?{verified:!0,zone:m,message:`Arrived at ${m.name}`,timestamp:Date.now()}:{verified:!1,message:`Not within safe zone. ${Math.round(m.distance)}m from ${m.name}`,nearestZone:m},[d,m,t]),F=a.useCallback(()=>!d||!f?{verified:!1,message:"Unable to verify proximity - waiting for other party location"}:A?{verified:!0,distance:j,message:`Both parties are within ${me}m`,timestamp:Date.now()}:{verified:!1,distance:j,message:`Other party is ${Math.round(j)}m away. Must be within ${me}m to proceed.`},[d,f,A,j]);return{currentPosition:d,locationError:v,loading:h,isInSafeZone:t,nearestSafeZone:m,safeZones:c,otherPartyPosition:f,proximityToOther:j,isWithinProximity:A,startWatching:o,stopWatching:S,findNearbySafeZones:C,createSafeZone:B,updateOtherPartyPosition:N,verifyArrival:r,verifyProximity:F,calculateDistance:de}}function Te({mode:s="capture",role:l="seller",listingPhotos:d=[],sellerDeparturePhotos:i=[],itemDescription:v="",onPhotosSubmitted:p,onVerificationComplete:t,requiredPhotoCount:y=3,userId:m}){const[g,c]=a.useState([]),[b,f]=a.useState(0),[T,j]=a.useState(!1),[P,A]=a.useState(0),[$,h]=a.useState(null),[L,u]=a.useState(""),[n,U]=a.useState(!1),[o,S]=a.useState(!1),N=a.useRef(null),C=a.useRef(null),B=a.useRef(null),{uploadMedia:r,uploading:F}=ge(),w=a.useCallback(async()=>{try{const I=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});N.current&&(N.current.srcObject=I,B.current=I,U(!0))}catch(I){console.error("Failed to access camera:",I),alert("Unable to access camera. Please check permissions.")}},[]),H=a.useCallback(()=>{B.current&&(B.current.getTracks().forEach(I=>I.stop()),B.current=null),U(!1)},[]),D=a.useCallback(async()=>{if(!N.current||!C.current)return;const I=N.current,x=C.current;x.width=I.videoWidth,x.height=I.videoHeight,x.getContext("2d").drawImage(I,0,0),x.toBlob(async Q=>{if(Q)try{const le=new File([Q],`verification_${Date.now()}.jpg`,{type:"image/jpeg"}),se=await r(le,`safe_exchange/${m}/verification`);se!=null&&se.url&&c(ie=>[...ie,{url:se.url,timestamp:Date.now(),type:l==="seller"?"departure":"inspection"}])}catch(le){console.error("Failed to upload photo:",le)}},"image/jpeg",.9)},[r,m,l]),O=async I=>{const x=I.target.files[0];if(x)try{const V=await r(x,`safe_exchange/${m}/verification`);V!=null&&V.url&&c(Q=>[...Q,{url:V.url,timestamp:Date.now(),type:l==="seller"?"departure":"inspection"}])}catch(V){console.error("Failed to upload photo:",V)}},z=I=>{c(x=>x.filter((V,Q)=>Q!==I)),b>=g.length-1&&f(Math.max(0,g.length-2))},R=async()=>{if(g.length<y){alert(`Please capture at least ${y} photos.`);return}S(!0);try{await(p==null?void 0:p(g,L))}finally{S(!1),H()}},W=async I=>{h(I),S(!0);try{await(t==null?void 0:t({result:I,notes:L,buyerPhotos:g,timestamp:Date.now()}))}finally{S(!1)}},G=()=>{var I;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 p-6 rounded-xl text-white",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:l==="seller"?"ðŸ“¦ Pre-Departure Photos":"ðŸ” Inspection Photos"}),e.jsx("p",{className:"text-sm opacity-90",children:l==="seller"?"Take clear photos of the item before leaving for the exchange. These will be shown to the buyer for verification.":"Take photos of the item as received. Compare with seller's photos to verify condition."})]}),e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:n?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:N,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:C,className:"hidden"}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-4",children:[e.jsx("button",{onClick:H,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full backdrop-blur-sm transition",children:e.jsx(Y,{className:"text-white",size:24})}),e.jsx("button",{onClick:D,disabled:F,className:"p-5 bg-white rounded-full shadow-lg hover:scale-110 transition disabled:opacity-50",children:e.jsx(X,{className:F?"animate-pulse text-orange-500":"text-gray-900",size:32})}),e.jsx("button",{className:"p-3 bg-white/20 rounded-full opacity-0 pointer-events-none",children:e.jsx(Y,{size:24})})]})]}):g.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:(I=g[b])==null?void 0:I.url,alt:`Photo ${b+1}`,className:"w-full h-full object-contain"}),g.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(Math.max(0,b-1)),className:"absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full hover:bg-black/70",disabled:b===0,children:e.jsx(rt,{className:"text-white"})}),e.jsx("button",{onClick:()=>f(Math.min(g.length-1,b+1)),className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full hover:bg-black/70",disabled:b===g.length-1,children:e.jsx(De,{className:"text-white"})})]}),e.jsxs("div",{className:"absolute top-4 right-4 bg-black/60 text-white text-sm px-3 py-1 rounded-full",children:[b+1," / ",g.length]}),e.jsx("button",{onClick:()=>z(b),className:"absolute top-4 left-4 p-2 bg-red-600 rounded-full hover:bg-red-700",children:e.jsx(Y,{className:"text-white",size:16})})]}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(X,{size:64,className:"mb-4 opacity-30"}),e.jsx("p",{children:"No photos captured yet"})]})}),g.length>0&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[g.map((x,V)=>e.jsx("button",{onClick:()=>f(V),className:`relative shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition ${V===b?"border-orange-500 ring-2 ring-orange-500/30":"border-transparent hover:border-gray-400"}`,children:e.jsx("img",{src:x.url,alt:"",className:"w-full h-full object-cover"})},V)),g.length<10&&e.jsx("button",{onClick:w,className:"shrink-0 w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center hover:border-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition",children:e.jsx(X,{className:"text-gray-400",size:20})})]}),e.jsx("div",{className:"flex gap-3",children:!n&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:w,className:"flex-1 bg-gray-900 dark:bg-white dark:text-black text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition",children:[e.jsx(X,{size:20})," Open Camera"]}),e.jsxs("label",{className:"flex-1 bg-gray-100 dark:bg-gray-800 py-3 rounded-xl font-bold flex items-center justify-center gap-2 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition",children:[e.jsx(je,{size:20})," Upload Photo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:O})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:L,onChange:x=>u(x.target.value),placeholder:l==="seller"?"Any notes about current condition...":"Note any concerns or observations...",className:"w-full p-3 border rounded-xl dark:bg-gray-800 dark:border-gray-600 dark:text-white resize-none",rows:3})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-bold dark:text-white",children:["Photos: ",g.length," / ",y," required"]}),g.length>=y&&e.jsx(_,{className:"text-green-500",size:20})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${Math.min(100,g.length/y*100)}%`}})})]}),e.jsx("button",{onClick:R,disabled:g.length<y||o,className:"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-700 transition shadow-lg",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:20})," Submit Photos"]})})]})},K=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-6 rounded-xl text-white",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"ðŸ” Verify Item Condition"}),e.jsx("p",{className:"text-sm opacity-90",children:"Compare the seller's pre-departure photos with the item in front of you. Does it match the listing description?"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Seller's Photo (",P+1,"/",i.length,")"]}),e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-square",children:i[P]?e.jsx("img",{src:i[P].url,alt:"Seller's photo",className:"w-full h-full object-contain"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No photo available"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Original Listing (",P+1,"/",d.length,")"]}),e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-square",children:d[P]?e.jsx("img",{src:d[P],alt:"Listing photo",className:"w-full h-full object-contain"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No photo available"})})]})]}),e.jsx("div",{className:"flex justify-center gap-2",children:Array.from({length:Math.max(i.length,d.length)}).map((I,x)=>e.jsx("button",{onClick:()=>A(x),className:`w-3 h-3 rounded-full transition ${x===P?"bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},x))}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white mb-2",children:"ðŸ“‹ Listing Description"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:v||"No description provided"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-bold dark:text-white text-center",children:"Does the item match the photos and description?"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>W("match"),disabled:o,className:"p-4 bg-green-100 dark:bg-green-900/30 border-2 border-green-500 rounded-xl flex flex-col items-center gap-2 hover:bg-green-200 dark:hover:bg-green-900/50 transition",children:[e.jsx(_,{className:"text-green-600",size:32}),e.jsx("span",{className:"font-bold text-green-700 dark:text-green-400",children:"Yes, Matches"})]}),e.jsxs("button",{onClick:()=>W("unsure"),disabled:o,className:"p-4 bg-yellow-100 dark:bg-yellow-900/30 border-2 border-yellow-500 rounded-xl flex flex-col items-center gap-2 hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition",children:[e.jsx(lt,{className:"text-yellow-600",size:32}),e.jsx("span",{className:"font-bold text-yellow-700 dark:text-yellow-400",children:"Unsure"})]}),e.jsxs("button",{onClick:()=>W("mismatch"),disabled:o,className:"p-4 bg-red-100 dark:bg-red-900/30 border-2 border-red-500 rounded-xl flex flex-col items-center gap-2 hover:bg-red-200 dark:hover:bg-red-900/50 transition",children:[e.jsx(nt,{className:"text-red-600",size:32}),e.jsx("span",{className:"font-bold text-red-700 dark:text-red-400",children:"No, Different"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Describe Any Concerns"}),e.jsx("textarea",{value:L,onChange:I=>u(I.target.value),placeholder:"Note any differences, damage, or concerns...",className:"w-full p-3 border rounded-xl dark:bg-gray-800 dark:border-gray-600 dark:text-white resize-none",rows:3})]})]});return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[s==="capture"&&G(),s==="compare"&&K()]})}function kt({transactionId:s,user:l,userData:d,onClose:i,onComplete:v,onMessage:p}){var ie,ve,ke,we,Se,Ce;const[t,y]=a.useState(null),[m,g]=a.useState(!0),[c,b]=a.useState(!1),[f,T]=a.useState(null),[j,P]=a.useState(""),[A,$]=a.useState(""),[h,L]=a.useState(!1),[u,n]=a.useState([]),[U,o]=a.useState(null),S=(l==null?void 0:l.id)||(l==null?void 0:l.uid),N=(t==null?void 0:t.sellerId)===S,C=(t==null?void 0:t.buyerId)===S,B=N?"seller":"buyer",{currentPosition:r,isInSafeZone:F,nearestSafeZone:w,isWithinProximity:H,startWatching:D,findNearbySafeZones:O}=vt(s,l==null?void 0:l.uid);a.useEffect(()=>{},[s]),a.useEffect(()=>{},[r,t,s,B]),a.useEffect(()=>{h&&r&&O().then(E=>n(E))},[h,r,O]);const z=a.useCallback(async(E,Z={})=>{},[s,t,l==null?void 0:l.id,l==null?void 0:l.uid]),R=async()=>{if(!f||!j||!A){alert("Please select a safe zone and set a date/time.");return}await z(k.MEETUP_SCHEDULED,{meetupLocation:f,meetupDate:j,meetupTime:A}),L(!1)},W=()=>{o("seller_depart"),D()},G=async(E,Z)=>{await z(k.SELLER_PHOTOS_UPLOADED,{sellerDeparturePhotos:E,sellerDepartureNotes:Z}),o(null),await z(k.SELLER_EN_ROUTE)},K=()=>{D(),z(k.BUYER_EN_ROUTE)},I=async E=>{await z(k.BUYER_PHOTOS_UPLOADED,{buyerInspectionResult:E.result,buyerInspectionPhotos:E.buyerPhotos,buyerInspectionNotes:E.notes}),E.result==="mismatch"?await z(k.DISPUTED):await z(k.PENDING_DUAL_APPROVAL),o(null)},x=async()=>{const E=N?"sellerApproved":"buyerApproved",Z=N?k.SELLER_APPROVED:k.BUYER_APPROVED;await z(Z,{[E]:!0,[`${E}At`]:Date.now()}),(N?t.buyerApproved:t.sellerApproved)&&await V()},V=async()=>{},Q=async()=>{if(!confirm("Are you sure you want to cancel this transaction? This may affect your seller rating."))return;const E=(l==null?void 0:l.id)||(l==null?void 0:l.uid);await z(k.CANCELLED,{cancelledBy:E,cancelledAt:new Date().toISOString()}),i==null||i()},le=async E=>{const Z=(l==null?void 0:l.id)||(l==null?void 0:l.uid);await z(k.DISPUTED,{disputeReason:E,disputeRaisedBy:Z,disputeRaisedAt:new Date().toISOString()})},se=()=>({[k.INTENT_CREATED]:0,[k.HOLD_PLACED]:1,[k.SELLER_NOTIFIED]:1,[k.MEETUP_SCHEDULED]:2,[k.SELLER_EN_ROUTE]:3,[k.SELLER_PHOTOS_UPLOADED]:3,[k.BUYER_EN_ROUTE]:4,[k.AT_SAFE_ZONE]:4,[k.BUYER_INSPECTING]:5,[k.BUYER_PHOTOS_UPLOADED]:5,[k.PENDING_DUAL_APPROVAL]:6,[k.SELLER_APPROVED]:6,[k.BUYER_APPROVED]:6,[k.COMPLETED]:7})[t==null?void 0:t.status]||0;return m?e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[80]",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-8 rounded-2xl flex flex-col items-center gap-4",children:[e.jsx(te,{className:"animate-spin text-orange-500",size:48}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading transaction..."})]})}):U==="seller_depart"?e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[80] overflow-y-auto",children:e.jsx("div",{className:"min-h-screen p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsxs("button",{onClick:()=>o(null),className:"mb-4 text-white flex items-center gap-2 hover:underline",children:[e.jsx(Y,{size:20})," Cancel"]}),e.jsx(Te,{mode:"capture",role:"seller",listingPhotos:t.itemPhotos||[],itemDescription:t.itemDescription,onPhotosSubmitted:G,requiredPhotoCount:3,userId:l.uid})]})})}):U==="buyer_inspect"?e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[80] overflow-y-auto",children:e.jsx("div",{className:"min-h-screen p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsxs("button",{onClick:()=>o(null),className:"mb-4 text-white flex items-center gap-2 hover:underline",children:[e.jsx(Y,{size:20})," Cancel"]}),e.jsx(Te,{mode:"compare",role:"buyer",listingPhotos:t.itemPhotos||[],sellerDeparturePhotos:t.sellerDeparturePhotos||[],itemDescription:t.itemDescription,onVerificationComplete:I,requiredPhotoCount:2,userId:l.uid})]})})}):e.jsxs("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden my-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 p-6 text-white relative overflow-hidden",children:[e.jsx("button",{onClick:i,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition",children:e.jsx(Y,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 text-orange-200 text-xs font-bold uppercase tracking-widest mb-2",children:[e.jsx(q,{size:14})," Safe Exchange"]}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:t==null?void 0:t.itemTitle}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{size:16})," $",(ie=t==null?void 0:t.price)==null?void 0:ie.toLocaleString(),(t==null?void 0:t.serviceFee)&&e.jsx("span",{className:"text-orange-200 text-xs ml-1",children:"(1% mutual service fee)"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ne,{size:16})," ",t==null?void 0:t.itemBrand]})]}),e.jsx(q,{size:150,className:"absolute -right-10 -bottom-10 text-white opacity-10 rotate-12"})]}),e.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Transaction Progress"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${(t==null?void 0:t.status)===k.COMPLETED?"bg-green-100 text-green-700":(t==null?void 0:t.status)===k.DISPUTED?"bg-red-100 text-red-700":"bg-orange-100 text-orange-700"}`,children:(ve=t==null?void 0:t.status)==null?void 0:ve.replace(/_/g," ").toUpperCase()})]}),e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto pb-2",children:Ae.map((E,Z)=>{const he=se(),be=Z<he,Ee=Z===he;return e.jsxs(Me.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center shrink-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${be?"bg-green-500 text-white":Ee?"bg-orange-500 text-white animate-pulse":"bg-gray-200 dark:bg-gray-700 text-gray-500"}`,children:be?e.jsx(Re,{size:16}):Z+1}),e.jsx("span",{className:`text-[10px] mt-1 whitespace-nowrap ${Ee?"font-bold text-orange-600":"text-gray-500"}`,children:E.label})]}),Z<Ae.length-1&&e.jsx("div",{className:`flex-1 h-1 min-w-[20px] rounded ${be?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}`})]},E.key)})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500 rounded-full",children:e.jsx(pe,{className:"text-white",size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-green-800 dark:text-green-300",children:"Escrow Protected"}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:C?e.jsxs(e.Fragment,{children:["$",((ke=t==null?void 0:t.buyerTotal)==null?void 0:ke.toFixed(2))||((we=t==null?void 0:t.price)==null?void 0:we.toLocaleString())," held securely",(t==null?void 0:t.serviceFee)&&e.jsxs("span",{className:"text-green-500 text-xs",children:[" (includes 1% service fee: $",t.serviceFee.toFixed(2),")"]})]}):e.jsxs(e.Fragment,{children:["You'll receive $",((Se=t==null?void 0:t.sellerPayout)==null?void 0:Se.toFixed(2))||((Ce=t==null?void 0:t.price)==null?void 0:Ce.toLocaleString())," on completion",(t==null?void 0:t.serviceFee)&&e.jsxs("span",{className:"text-green-500 text-xs",children:[" (after 1% service fee: $",t.serviceFee.toFixed(2),")"]})]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-xl border ${N?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"dark:border-gray-700"}`,children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:["Seller ",N&&"(You)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Le,{src:t==null?void 0:t.sellerPhoto,name:t==null?void 0:t.sellerName,size:"md"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:t==null?void 0:t.sellerName}),(t==null?void 0:t.sellerApproved)&&e.jsxs("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(_,{size:12})," Approved"]})]})]})]}),e.jsxs("div",{className:`p-4 rounded-xl border ${C?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"dark:border-gray-700"}`,children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:["Buyer ",C&&"(You)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Le,{src:t==null?void 0:t.buyerPhoto,name:t==null?void 0:t.buyerName,size:"md"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:t==null?void 0:t.buyerName}),(t==null?void 0:t.buyerApproved)&&e.jsxs("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(_,{size:12})," Approved"]})]})]})]})]}),(t==null?void 0:t.meetupLocation)&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 flex items-center gap-2 mb-3",children:[e.jsx(ae,{size:18})," Exchange Location"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300",children:[e.jsx(q,{size:16}),e.jsx("span",{className:"font-bold",children:t.meetupLocation.name}),e.jsx("span",{className:"bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs px-2 py-0.5 rounded",children:t.meetupLocation.typeLabel})]}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:t.meetupLocation.address}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Pe,{size:14})," ",t.meetupDate]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{size:14})," ",t.meetupTime]})]})]})]}),r&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl",children:[e.jsxs("h4",{className:"font-bold dark:text-white text-sm mb-3 flex items-center gap-2",children:[e.jsx(ze,{size:16,className:"text-blue-500"})," Live Location"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Your Position:"}),e.jsxs("div",{className:"flex items-center gap-1 font-mono text-xs dark:text-white",children:[r.lat.toFixed(6),", ",r.lng.toFixed(6)]})]}),w&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Safe Zone:"}),e.jsx("div",{className:"flex items-center gap-1",children:F?e.jsxs("span",{className:"text-green-600 font-bold flex items-center gap-1",children:[e.jsx(_,{size:14})," In Zone"]}):e.jsxs("span",{className:"text-orange-600",children:[Math.round(w.distance),"m away"]})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[N&&(t==null?void 0:t.status)===k.SELLER_NOTIFIED&&e.jsxs("button",{onClick:()=>L(!0),className:"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-orange-700 transition",children:[e.jsx(Pe,{size:20})," Schedule Safe Exchange"]}),N&&(t==null?void 0:t.status)===k.MEETUP_SCHEDULED&&e.jsxs("button",{onClick:W,className:"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-orange-700 transition",children:[e.jsx(X,{size:20})," Take Pre-Departure Photos"]}),C&&(t==null?void 0:t.status)===k.SELLER_PHOTOS_UPLOADED&&e.jsxs("button",{onClick:K,className:"w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition",children:[e.jsx(ze,{size:20})," I'm On My Way"]}),C&&((t==null?void 0:t.status)===k.BUYER_EN_ROUTE||(t==null?void 0:t.status)===k.AT_SAFE_ZONE)&&F&&H&&e.jsxs("button",{onClick:()=>o("buyer_inspect"),className:"w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition",children:[e.jsx(X,{size:20})," Start Item Inspection"]}),(t==null?void 0:t.status)===k.PENDING_DUAL_APPROVAL&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800",children:[e.jsx("h4",{className:"font-bold text-yellow-800 dark:text-yellow-300 mb-2",children:"Final Approval Required"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:"Both parties must approve to release funds."})]}),(N&&!t.sellerApproved||C&&!t.buyerApproved)&&e.jsx("button",{onClick:x,disabled:c,className:"w-full bg-green-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-green-700 transition disabled:opacity-50",children:c?e.jsx(te,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(_,{size:20})," Approve & Release Funds"]})}),(N&&t.sellerApproved||C&&t.buyerApproved)&&e.jsxs("div",{className:"text-center text-green-600 font-bold py-4",children:[e.jsx(_,{className:"inline mr-2"}),"You have approved. Waiting for other party..."]})]}),(t==null?void 0:t.status)===k.COMPLETED&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-6 rounded-xl border border-green-200 dark:border-green-800 text-center",children:[e.jsx(_,{className:"text-green-500 mx-auto mb-4",size:48}),e.jsx("h4",{className:"text-xl font-bold text-green-700 dark:text-green-300 mb-2",children:"Exchange Completed!"}),e.jsx("p",{className:"text-green-600 dark:text-green-400",children:N?"Funds have been released to your account.":"Thank you for your purchase!"})]}),(t==null?void 0:t.status)===k.DISPUTED&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-6 rounded-xl border border-red-200 dark:border-red-800 text-center",children:[e.jsx(_e,{className:"text-red-500 mx-auto mb-4",size:48}),e.jsx("h4",{className:"text-xl font-bold text-red-700 dark:text-red-300 mb-2",children:"Dispute Raised"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-4",children:"Our support team will review this transaction."}),e.jsx("button",{className:"bg-red-600 text-white px-6 py-2 rounded-lg font-bold",children:"Contact Support"})]}),(t==null?void 0:t.status)!==k.COMPLETED&&e.jsxs("button",{onClick:()=>p==null?void 0:p(N?t.buyerId:t.sellerId),className:"w-full border-2 border-gray-300 dark:border-gray-600 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-800 transition dark:text-white",children:[e.jsx(J,{size:18})," Message ",N?"Buyer":"Seller"]})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex justify-between",children:(t==null?void 0:t.status)!==k.COMPLETED&&(t==null?void 0:t.status)!==k.CANCELLED&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Q,className:"text-red-600 font-bold text-sm hover:underline",children:"Cancel Transaction"}),(t==null?void 0:t.status)!==k.DISPUTED&&e.jsx("button",{onClick:()=>le("Item not as described"),className:"text-orange-600 font-bold text-sm hover:underline",children:"Raise Dispute"})]})})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[75] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 w-full max-w-lg rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Select Safe Exchange Zone"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Choose a verified safe location for the exchange"})]}),e.jsx("div",{className:"p-4 max-h-[400px] overflow-y-auto space-y-2",children:u.length>0?u.map(E=>e.jsx("button",{onClick:()=>T(E),className:`w-full p-4 rounded-xl border text-left transition ${(f==null?void 0:f.id)===E.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-400"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${(f==null?void 0:f.id)===E.id?"bg-orange-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:e.jsx(q,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold dark:text-white",children:E.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:E.address}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded",children:E.typeLabel}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(E.distance/1e3).toFixed(1)," km away"]})]})]}),(f==null?void 0:f.id)===E.id&&e.jsx(_,{className:"text-orange-500",size:20})]})},E.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ae,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Loading nearby safe zones..."})]})}),f&&e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date"}),e.jsx("input",{type:"date",value:j,onChange:E=>P(E.target.value),min:new Date().toISOString().split("T")[0],className:"w-full p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time"}),e.jsx("input",{type:"time",value:A,onChange:E=>$(E.target.value),className:"w-full p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]})]}),e.jsx("button",{onClick:R,disabled:!j||!A||c,className:"w-full bg-orange-600 text-white py-3 rounded-xl font-bold disabled:opacity-50 hover:bg-orange-700 transition",children:c?"Scheduling...":"Confirm & Notify Buyer"})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:()=>L(!1),className:"w-full text-gray-500 font-bold hover:text-gray-700 dark:hover:text-gray-300",children:"Cancel"})})]})})]})}const wt=["Mint","Excellent","Good","Fair","Non-Functioning"],M={PENDING:"pending",CONFIRMED:"confirmed",SHIPPED:"shipped",DELIVERED:"delivered",COMPLETED:"completed",CANCELLED:"cancelled",REFUNDED:"refunded"},ue={[M.PENDING]:{label:"Pending",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",icon:ne},[M.CONFIRMED]:{label:"Confirmed",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:_},[M.SHIPPED]:{label:"Shipped",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400",icon:ee},[M.DELIVERED]:{label:"Delivered",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:Ne},[M.COMPLETED]:{label:"Completed",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:_},[M.CANCELLED]:{label:"Cancelled",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",icon:Y},[M.REFUNDED]:{label:"Refunded",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400",icon:We}},Fe=.01,St=s=>{const l=parseFloat(s)||0,d=Math.round(l*Fe*100)/100,i=Math.round((l+d)*100)/100,v=Math.round((l-d)*100)/100;return{itemPrice:l,serviceFee:d,serviceFeeRate:Fe,buyerTotal:i,sellerPayout:v}},et=({rating:s,reviewCount:l,size:d="sm"})=>{if(!s&&!l)return null;const v={sm:{star:12,text:"text-xs"},md:{star:14,text:"text-sm"},lg:{star:16,text:"text-base"}}[d];return e.jsxs("div",{className:`flex items-center gap-1 ${v.text}`,children:[e.jsx(it,{size:v.star,className:"text-yellow-500 fill-yellow-500"}),e.jsx("span",{className:"font-bold text-yellow-600 dark:text-yellow-400",children:(s==null?void 0:s.toFixed(1))||"â€”"}),l>0&&e.jsxs("span",{className:"text-gray-400",children:["(",l," sale",l!==1?"s":"",")"]})]})},Ct=({status:s})=>{const l={pending:{label:"Pending",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"},accepted:{label:"Accepted",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},declined:{label:"Declined",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},countered:{label:"Countered",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},expired:{label:"Expired",color:"bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400"}},d=l[s]||l.pending;return e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${d.color}`,children:d.label})},tt=s=>s>=xe;function Et({user:s,userData:l,setActiveTab:d,openChat:i}){const[v,p]=a.useState("browse"),[t,y]=a.useState([]),[m,g]=a.useState("All"),[c,b]=a.useState(""),[f,T]=a.useState(null),[j,P]=a.useState(null),[A,$]=a.useState([]),[h,L]=a.useState([]),[u,n]=a.useState(null);a.useEffect(()=>{},[s==null?void 0:s.id,s==null?void 0:s.uid]),a.useEffect(()=>{!(s!=null&&s.id)&&!(s!=null&&s.uid)||re},[s==null?void 0:s.id,s==null?void 0:s.uid]),a.useEffect(()=>{!(s!=null&&s.id)&&!(s!=null&&s.uid)||re},[s==null?void 0:s.id,s==null?void 0:s.uid]);const U=async r=>{},o=async(r,F)=>{},S=async(r,F,w=null)=>{},N=h.filter(r=>r.status!==M.COMPLETED&&r.status!==M.CANCELLED&&r.status!==M.REFUNDED),C=t.filter(r=>(m==="All"||r.category===m)&&(r.title.toLowerCase().includes(c.toLowerCase())||r.brand.toLowerCase().includes(c.toLowerCase()))),B=A.filter(r=>r.status!==k.COMPLETED&&r.status!==k.CANCELLED);return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 animate-in fade-in",children:[j&&e.jsx(kt,{transactionId:j,user:s,userData:l,onClose:()=>P(null),onComplete:()=>{P(null)},onMessage:r=>{i==null||i(r)}}),v==="browse"&&e.jsxs(e.Fragment,{children:[B.length>0&&e.jsxs("div",{className:"mb-6 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(q,{className:"text-orange-600",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-orange-800 dark:text-orange-300",children:"Active Safe Exchanges"}),e.jsxs("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:["You have ",B.length," pending transaction",B.length>1?"s":""]})]})]}),e.jsx("div",{className:"space-y-2",children:B.map(r=>e.jsxs("button",{onClick:()=>P(r.id),className:"w-full flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${r.role==="buyer"?"bg-blue-100 text-blue-600":"bg-green-100 text-green-600"}`,children:r.role==="buyer"?e.jsx($e,{size:16}):e.jsx(ye,{size:16})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:r.itemTitle}),e.jsxs("div",{className:"text-xs text-gray-500",children:[r.role==="buyer"?"Buying":"Selling"," â€¢ $",r.price]})]})]}),e.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-bold",children:r.status.replace(/_/g," ")})]},r.id))})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Be,{className:"text-orange-500"})," Gear Exchange"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Buy and sell verified studio equipment."})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(Ue,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2c2e36] text-sm dark:text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Search gear...",value:c,onChange:r=>b(r.target.value)})]}),e.jsxs("button",{onClick:()=>p("orders"),className:"relative bg-white dark:bg-[#2c2e36] border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 transition",children:[e.jsx(He,{size:16})," Orders",N.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center",children:N.length})]}),e.jsxs("button",{onClick:()=>p("create"),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 shadow-lg transition",children:[e.jsx(Ge,{size:16})," Sell Gear"]})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2",children:[e.jsx("button",{onClick:()=>g("All"),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${m==="All"?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:"All Gear"}),fe.map(r=>e.jsx("button",{onClick:()=>g(r.id),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${m===r.id?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:r.label},r.id))]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:C.map(r=>{var w;const F=tt(r.price);return e.jsxs("div",{onClick:()=>T(r),className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-xl transition cursor-pointer group flex flex-col",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 dark:bg-black/40 relative flex items-center justify-center overflow-hidden",children:[(w=r.images)!=null&&w[0]?e.jsx("img",{src:r.images[0],className:"w-full h-full object-cover group-hover:scale-105 transition duration-500"}):e.jsx(X,{size:32,className:"text-gray-400"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur-md",children:["$",r.price]}),F&&e.jsxs("div",{className:"absolute top-2 left-2 bg-orange-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(q,{size:10})," Safe Exchange"]}),r.conditionReport&&e.jsxs("div",{className:"absolute bottom-2 left-2 bg-green-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(_,{size:10})," Inspected"]}),r.acceptsOffers&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-blue-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(J,{size:10})," Offers"]})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-400 uppercase mb-1",children:r.brand}),e.jsx("h4",{className:"font-bold dark:text-white text-sm mb-1 line-clamp-1",children:r.title}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[r.condition," Condition"]}),r.sellerRating&&e.jsx("div",{className:"mb-2",children:e.jsx(et,{rating:r.sellerRating,reviewCount:r.sellerSalesCount,size:"sm"})}),e.jsxs("div",{className:"mt-auto pt-3 border-t dark:border-gray-700 flex justify-between items-center text-xs text-gray-400",children:[e.jsx("span",{className:"flex items-center gap-1",children:F?e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:10})," Local Pickup"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:10})," ",r.location||"Ships"]})}),r.sellerVerified&&e.jsx(Ve,{size:14,className:"text-blue-500"})]})]})]},r.id)})})]}),v==="create"&&e.jsx(Pt,{user:s,userData:l,onCancel:()=>p("browse"),onSuccess:()=>p("browse")}),v==="orders"&&e.jsx(Ot,{orders:h,user:s,userData:l,onBack:()=>p("browse"),onUpdateStatus:S,openChat:i}),f&&e.jsx(zt,{item:f,onClose:()=>T(null),currentUser:s,currentUserData:l,onSafeExchangePurchase:U,onStandardPurchase:o})]})}function Pt({user:s,userData:l,onCancel:d,onSuccess:i}){const[v,p]=a.useState(1),[t,y]=a.useState({title:"",brand:"",category:fe[0].id,condition:"Good",price:"",description:"",location:l.city||"",weight:"",length:"",width:"",height:"",acceptsOffers:!0,minimumOffer:""}),[m,g]=a.useState([]),[c,b]=a.useState(null),[f,T]=a.useState(!1),{uploadMedia:j,uploading:P}=ge(),A=async h=>{const L=h.target.files[0];if(!L)return;const u=await j(L,`gear/${s.uid}`);u!=null&&u.url&&g([...m,u.url])},$=async()=>{if(!t.title||!t.price||!re){(!t.title||!t.price)&&alert("Title and Price required.");return}};return v==="inspection"?e.jsx("div",{className:"h-[600px]",children:e.jsx(Nt,{type:"Pre",onSave:h=>{b(h),p(1)},onCancel:()=>p(1)})}):e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border dark:border-gray-700 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"List Gear for Sale"}),e.jsx("button",{onClick:d,children:e.jsx(Y,{className:"text-gray-400"})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:t.brand,onChange:h=>y({...t,brand:h.target.value}),placeholder:"e.g. Fender"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model / Title"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:t.title,onChange:h=>y({...t,title:h.target.value}),placeholder:"e.g. Stratocaster"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:t.category,onChange:h=>y({...t,category:h.target.value}),children:fe.map(h=>e.jsx("option",{value:h.id,children:h.label},h.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Condition"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:t.condition,onChange:h=>y({...t,condition:h.target.value}),children:wt.map(h=>e.jsx("option",{value:h,children:h},h))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Price ($)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",value:t.price,onChange:h=>y({...t,price:h.target.value})}),t.price&&parseInt(t.price)>=xe&&e.jsx("div",{className:"mt-3 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(q,{className:"text-orange-500 shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-300 text-sm",children:"Safe Exchange Required"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-orange-400 mt-1",children:["Items priced at $",xe,"+ require in-person exchange at a verified safe location (police station, bank, etc.). Buyers will initiate a Safe Exchange with payment held in escrow until both parties approve."]}),e.jsxs("ul",{className:"text-xs text-orange-600 dark:text-orange-400 mt-2 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(Ye,{size:10})," No shipping available for high-value items"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(X,{size:10})," You must upload pre-departure photos"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(ae,{size:10})," GPS verification at exchange location"]})]})]})]})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-400 text-sm flex items-center gap-2",children:[e.jsx(J,{size:16}),"Accept Offers"]}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300 mt-1",children:"Allow buyers to negotiate on price"})]}),e.jsx("button",{type:"button",onClick:()=>y({...t,acceptsOffers:!t.acceptsOffers}),className:"p-1",children:t.acceptsOffers?e.jsx(dt,{size:32,className:"text-blue-600"}):e.jsx(ot,{size:32,className:"text-gray-400"})})]}),t.acceptsOffers&&t.price&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 dark:border-blue-800",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Minimum Acceptable Offer (Optional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",placeholder:`e.g., ${Math.round(parseInt(t.price)*.8)}`,value:t.minimumOffer,onChange:h=>y({...t,minimumOffer:h.target.value}),className:"flex-1 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm"}),e.jsx("span",{className:"text-sm text-gray-500",children:t.minimumOffer&&t.price?`(${Math.round(parseInt(t.minimumOffer)/parseInt(t.price)*100)}%)`:""})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:'Offers below this will be flagged as "Low Offer" to buyers'})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Weight (lb)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"lbs",value:t.weight,onChange:h=>y({...t,weight:h.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"L (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Len",value:t.length,onChange:h=>y({...t,length:h.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"W (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Wid",value:t.width,onChange:h=>y({...t,width:h.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"H (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Hgt",value:t.height,onChange:h=>y({...t,height:h.target.value})})]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-1",children:"Tech Inspection Report"}),e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-300",children:c?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{size:12})," Report Attached (",c.markers.length," points)"]}):"Mark scratches, dents, or issues on a diagram to build trust."})]}),e.jsx("button",{onClick:()=>p("inspection"),className:`text-xs font-bold px-3 py-2 rounded-lg border transition ${c?"bg-white text-green-600 border-green-200":"bg-orange-100 text-orange-700 border-orange-200 hover:bg-orange-200"}`,children:c?"Edit Report":"Create Report"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Photos"}),e.jsxs("div",{className:"flex gap-2",children:[m.map((h,L)=>e.jsx("img",{src:h,className:"w-16 h-16 rounded-lg object-cover border dark:border-gray-600"},L)),e.jsxs("label",{className:"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",children:[P?e.jsx(te,{className:"animate-spin text-gray-400"}):e.jsx(Ge,{className:"text-gray-400"}),e.jsx("input",{type:"file",className:"hidden",onChange:A,disabled:P})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:d,className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:f||P,className:"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg flex items-center justify-center gap-2",children:f?e.jsx(te,{className:"animate-spin"}):"Post Listing"})]})]})]})}function zt({item:s,onClose:l,currentUser:d,currentUserData:i,onSafeExchangePurchase:v,onStandardPurchase:p}){var W,G,K,I;const[t,y]=a.useState(!1),[m,g]=a.useState(!1),[c,b]=a.useState(!1),[f,T]=a.useState(!1),[j,P]=a.useState(""),[A,$]=a.useState(""),[h,L]=a.useState(!1),[u,n]=a.useState([]),[U,o]=a.useState(!0),[S,N]=a.useState(1),[C,B]=a.useState("shipping"),[r,F]=a.useState({street:((W=i==null?void 0:i.address)==null?void 0:W.street)||"",city:(i==null?void 0:i.city)||"",state:(i==null?void 0:i.state)||"",zip:(i==null?void 0:i.zip)||"",phone:(i==null?void 0:i.phone)||"",notes:""}),w=tt(s.price);a.useEffect(()=>{if(!s.id||!(d!=null&&d.uid)){o(!1);return}},[s.id,d==null?void 0:d.uid]);const H=async()=>{w?(g(!0),await v(s),g(!1)):(T(!0),N(1))},D=async()=>{g(!0);const x={method:C,address:C==="shipping"?{street:r.street,city:r.city,state:r.state,zip:r.zip}:null,phone:r.phone,notes:r.notes};await p(s,x)&&(T(!1),l()),g(!1)},O=()=>C==="shipping"?r.street&&r.city&&r.state&&r.zip:!0,z=async()=>{if(!j||parseFloat(j)<=0){oe.error("Please enter a valid offer amount");return}if(parseFloat(j)>=s.price){oe.error("Offer must be less than the asking price");return}L(!0),oe.loading("Submitting offer...")},R=x=>Math.round(x/s.price*100);return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-4xl h-[90vh] rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden border dark:border-gray-700",children:[e.jsxs("div",{className:"md:w-1/2 bg-black relative flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 relative",children:[t&&s.conditionReport?e.jsxs("div",{className:"w-full h-full bg-white rounded-xl overflow-hidden",children:[e.jsx(Je,{type:s.conditionReport.gearType,view:"front",markers:s.conditionReport.markers,onClick:()=>{}}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/80 text-white px-3 py-1 rounded-full text-xs",children:"Inspection View"})]}):(G=s.images)!=null&&G[0]?e.jsx("img",{src:s.images[0],className:"max-h-full max-w-full object-contain"}):e.jsx(X,{size:48,className:"text-gray-600"}),e.jsx("button",{onClick:l,className:"absolute top-4 left-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70",children:e.jsx(Y,{size:20})}),w&&e.jsxs("div",{className:"absolute top-4 right-4 bg-orange-500 text-white px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1.5 shadow-lg",children:[e.jsx(q,{size:14})," Safe Exchange Required"]})]}),s.conditionReport&&e.jsxs("div",{className:"p-4 bg-[#1f2128] border-t border-gray-800 flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>y(!1),className:`px-4 py-2 rounded text-xs font-bold ${t?"bg-gray-800 text-gray-400":"bg-orange-600 text-white"}`,children:"Photos"}),e.jsxs("button",{onClick:()=>y(!0),className:`px-4 py-2 rounded text-xs font-bold flex items-center gap-1 ${t?"bg-orange-600 text-white":"bg-gray-800 text-gray-400"}`,children:[e.jsx(_e,{size:12})," Condition Map"]})]})]}),e.jsxs("div",{className:"md:w-1/2 p-8 overflow-y-auto bg-white dark:bg-[#2c2e36]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-bold text-gray-400 uppercase tracking-wider mb-1",children:s.brand}),e.jsx("h2",{className:"text-3xl font-extrabold dark:text-white mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["$",s.price]}),e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-1 rounded text-xs font-bold",children:s.condition}),s.acceptsOffers&&e.jsxs("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-1 rounded text-xs font-bold flex items-center gap-1",children:[e.jsx(J,{size:12})," Open to Offers"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[w&&e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-500 rounded-lg",children:e.jsx(q,{className:"text-white",size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-300 mb-1",children:"Safe Exchange Protection"}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-400 mb-3",children:["High-value items ($",xe,"+) require in-person exchange at a verified safe location."]}),e.jsxs("ul",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(pe,{size:12})," Payment held in escrow until exchange"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(ae,{size:12})," Meet at police station or safe zone"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(X,{size:12})," Photo verification required"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(_,{size:12})," Both parties must approve"]})]})]})]})}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.sellerPhoto?e.jsx("img",{src:s.sellerPhoto,className:"w-12 h-12 rounded-full bg-gray-300 object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-lg",children:(K=s.sellerName)==null?void 0:K[0]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold dark:text-white",children:s.sellerName}),s.sellerVerified&&e.jsx(Ve,{size:16,className:"text-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx(et,{rating:s.sellerRating,reviewCount:s.sellerSalesCount,size:"md"}),s.sellerResponseTime&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ne,{size:12}),"Responds in ",s.sellerResponseTime]})]})]})]})}),u.length>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm mb-3 flex items-center gap-2",children:[e.jsx(J,{size:16}),"Your Offers"]}),e.jsx("div",{className:"space-y-2",children:u.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold dark:text-white",children:["$",x.offerAmount]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",R(x.offerAmount),"% of asking)"]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:x.createdAt.toLocaleDateString()})]}),e.jsx(Ct,{status:x.status})]},x.id))})]}),e.jsxs("div",{className:`p-3 rounded-xl border ${w?"bg-orange-50 dark:bg-orange-900/10 border-orange-200 dark:border-orange-800":"bg-green-50 dark:bg-green-900/10 border-green-200 dark:border-green-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"text-orange-600",size:18}),e.jsx("span",{className:"font-bold text-orange-700 dark:text-orange-400",children:"Local Pickup Only"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"text-green-600",size:18}),e.jsx("span",{className:"font-bold text-green-700 dark:text-green-400",children:"Shipping Available"})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:w?"You will coordinate a meetup at a verified safe exchange zone":s.location||"Contact seller for shipping details"})]}),((I=s.conditionReport)==null?void 0:I.notes)&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800/50",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-2 flex items-center gap-2",children:[e.jsx(Be,{size:16})," Tech Notes"]}),e.jsxs("p",{className:"text-sm text-orange-900 dark:text-orange-200 italic",children:['"',s.conditionReport.notes,'"']})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm uppercase",children:"Description"}),e.jsx("p",{children:s.description||"No description provided."})]})]}),c&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm mb-3 flex items-center gap-2",children:[e.jsx(J,{size:16}),"Make an Offer"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Your Offer ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"number",value:j,onChange:x=>P(x.target.value),placeholder:`Asking: $${s.price}`,className:"w-full pl-9 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),j&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[R(parseFloat(j)),"% of asking price",parseFloat(j)<s.price*.7&&e.jsx("span",{className:"text-amber-600 ml-1",children:"(Low offer)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Message (Optional)"}),e.jsx("textarea",{value:A,onChange:x=>$(x.target.value),placeholder:"Add a message to the seller...",rows:2,className:"w-full p-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 py-2 text-gray-600 dark:text-gray-400 font-medium hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:z,disabled:h||!j,className:"flex-1 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:h?e.jsx(te,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{size:16})," Submit Offer"]})})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[e.jsx(ne,{size:10}),"Offers expire after 48 hours if not responded to"]})]})]}),e.jsx(Qe,{children:f&&e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mt-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-5 rounded-xl border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-bold text-green-800 dark:text-green-300 flex items-center gap-2",children:[e.jsx(Oe,{size:18}),"Checkout"]}),e.jsx("button",{onClick:()=>T(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Y,{size:18})})]}),e.jsx("div",{className:"flex items-center gap-2 mb-6",children:[1,2,3].map(x=>e.jsxs(Me.Fragment,{children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all ${S>=x?"bg-green-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-500"}`,children:S>x?e.jsx(_,{size:16}):x}),x<3&&e.jsx("div",{className:`flex-1 h-1 rounded ${S>x?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}`})]},x))}),S===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"How would you like to receive this item?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>B("shipping"),className:`p-4 rounded-xl border-2 transition-all ${C==="shipping"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx(ee,{size:24,className:C==="shipping"?"text-green-600 mx-auto mb-2":"text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Ship to Me"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Delivered to your door"})]}),e.jsxs("button",{onClick:()=>B("pickup"),className:`p-4 rounded-xl border-2 transition-all ${C==="pickup"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx(Ze,{size:24,className:C==="pickup"?"text-green-600 mx-auto mb-2":"text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Local Pickup"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Meet the seller"})]})]}),e.jsxs("button",{onClick:()=>N(2),className:"w-full py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition flex items-center justify-center gap-2",children:["Continue ",e.jsx(Ie,{size:16})]})]}),S===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:C==="shipping"?"Enter your shipping address":"Add your contact details"}),C==="shipping"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Street Address",value:r.street,onChange:x=>F({...r,street:x.target.value}),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{type:"text",placeholder:"City",value:r.city,onChange:x=>F({...r,city:x.target.value}),className:"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsx("input",{type:"text",placeholder:"State",value:r.state,onChange:x=>F({...r,state:x.target.value}),className:"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsx("input",{type:"text",placeholder:"ZIP",value:r.zip,onChange:x=>F({...r,zip:x.target.value}),className:"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]})]}),e.jsx("input",{type:"tel",placeholder:"Phone Number",value:r.phone,onChange:x=>F({...r,phone:x.target.value}),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsx("textarea",{placeholder:"Notes for seller (optional)",value:r.notes,onChange:x=>F({...r,notes:x.target.value}),rows:2,className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white resize-none"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(1),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:"Back"}),e.jsxs("button",{onClick:()=>N(3),disabled:!O(),className:"flex-1 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:["Review Order ",e.jsx(Ie,{size:16})]})]})]}),S===3&&(()=>{var V;const x=St(s.price);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h5",{className:"font-bold text-sm dark:text-white mb-3",children:"Order Summary"}),e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b dark:border-gray-700",children:[((V=s.images)==null?void 0:V[0])&&e.jsx("img",{src:s.images[0],className:"w-16 h-16 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold dark:text-white",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.brand," â€¢ ",s.condition]})]})]}),e.jsxs("div",{className:"pt-3 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Item Price"}),e.jsxs("span",{className:"dark:text-white",children:["$",x.itemPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:["Service Fee",e.jsx("span",{className:"text-[10px] text-gray-400",children:"(1% buyer fee)"})]}),e.jsxs("span",{className:"dark:text-white",children:["$",x.serviceFee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Fulfillment"}),e.jsx("span",{className:"dark:text-white capitalize",children:C})]}),C==="shipping"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Ship to"}),e.jsxs("span",{className:"dark:text-white text-right text-xs",children:[r.city,", ",r.state," ",r.zip]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t dark:border-gray-700 font-bold",children:[e.jsx("span",{className:"dark:text-white",children:"Total"}),e.jsxs("span",{className:"text-green-600",children:["$",x.buyerTotal.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(q,{size:14,className:"shrink-0 mt-0.5"}),e.jsx("span",{children:"Your purchase is protected by SeshNx Buyer Protection. If there's an issue with your order, we've got your back."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(2),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:"Back"}),e.jsx("button",{onClick:D,disabled:m,className:"flex-1 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-xl hover:from-green-700 hover:to-emerald-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:m?e.jsx(te,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx($e,{size:18})," Place Order"]})})]})]})})()]})}),!f&&e.jsxs("div",{className:"mt-8 pt-6 border-t dark:border-gray-700",children:[s.sellerId===d.uid?e.jsx("button",{className:"w-full bg-gray-100 dark:bg-gray-700 text-gray-500 font-bold py-3 rounded-xl cursor-not-allowed",children:"You own this listing"}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:H,disabled:m,className:`w-full font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed ${w?"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white":"bg-orange-600 hover:bg-orange-700 text-white"}`,children:m?e.jsx(te,{className:"animate-spin",size:20}):w?e.jsxs(e.Fragment,{children:[e.jsx(q,{size:20})," Initiate Safe Exchange"]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{size:20})," Buy Now - $",s.price]})}),!c&&s.acceptsOffers!==!1&&e.jsxs("button",{onClick:()=>b(!0),className:"w-full py-3 border-2 border-blue-500 text-blue-600 dark:text-blue-400 font-bold rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 transition flex items-center justify-center gap-2",children:[e.jsx(J,{size:18}),"Make an Offer"]})]}),e.jsx("p",{className:"text-center text-[10px] text-gray-400 mt-3 flex items-center justify-center gap-1",children:w?e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:10})," Funds held in escrow â€¢ GPS verified exchange â€¢ Dual approval release"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{size:10})," Purchases covered by SeshNx Buyer Protection"]})})]})]})]})})}function Ot({orders:s,user:l,userData:d,onBack:i,onUpdateStatus:v,openChat:p}){const[t,y]=a.useState(null),[m,g]=a.useState(!1),[c,b]=a.useState(""),[f,T]=a.useState("usps"),[j,P]=a.useState("all"),A=[{id:"usps",label:"USPS"},{id:"ups",label:"UPS"},{id:"fedex",label:"FedEx"},{id:"dhl",label:"DHL"},{id:"other",label:"Other"}],$=s.filter(n=>j==="buying"?n.role==="buyer":j==="selling"?n.role==="seller":!0),h=async()=>{if(!c){oe.error("Please enter a tracking number");return}await v(t.id,M.SHIPPED,{trackingNumber:c,carrier:f}),g(!1),b(""),y(null)},L=async n=>{await v(n.id,M.COMPLETED)},u=n=>{const U=ue[n];if(U){const o=U.icon;return e.jsx(o,{size:16})}return e.jsx(ne,{size:16})};return e.jsxs("div",{className:"animate-in fade-in",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition",children:e.jsx(De,{className:"rotate-180 text-gray-500",size:20})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(We,{className:"text-orange-500"})," My Orders"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Track your purchases and sales"})]})]})}),e.jsx("div",{className:"flex gap-2 mb-6",children:[{id:"all",label:"All Orders"},{id:"buying",label:"Buying"},{id:"selling",label:"Selling"}].map(n=>e.jsx("button",{onClick:()=>P(n.id),className:`px-4 py-2 rounded-lg text-sm font-bold transition ${j===n.id?"bg-orange-600 text-white shadow":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:n.label},n.id))}),$.length===0?e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700",children:[e.jsx(He,{size:48,className:"mx-auto text-gray-300 dark:text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No orders yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:j==="buying"?"You haven't purchased anything yet":j==="selling"?"You haven't received any orders yet":"Start shopping or selling to see your orders here"}),e.jsx("button",{onClick:i,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700 transition",children:"Browse Gear"})]}):e.jsx("div",{className:"space-y-4",children:$.map(n=>{var N,C,B,r,F,w,H,D,O,z;const U=ue[n.status]||ue[M.PENDING],o=n.role==="seller",S=n.role==="buyer";return e.jsx(ce.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg bg-gray-100 dark:bg-gray-800 overflow-hidden shrink-0",children:(N=n.itemPhotos)!=null&&N[0]?e.jsx("img",{src:n.itemPhotos[0],className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Ne,{className:"text-gray-400",size:24})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white truncate",children:n.itemTitle}),e.jsx("p",{className:"text-sm text-gray-500",children:n.itemBrand})]}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1.5 ${U.color}`,children:[u(n.status),U.label]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm flex-wrap",children:[S?e.jsxs("span",{className:"font-bold text-green-600",children:["$",((C=n.buyerTotal)==null?void 0:C.toFixed(2))||n.price,n.serviceFee&&e.jsxs("span",{className:"text-[10px] text-gray-400 font-normal ml-1",children:["(incl. $",(B=n.serviceFee)==null?void 0:B.toFixed(2)," fee)"]})]}):e.jsxs("span",{className:"font-bold text-green-600",children:["$",((r=n.sellerPayout)==null?void 0:r.toFixed(2))||n.price,n.serviceFee&&e.jsxs("span",{className:"text-[10px] text-gray-400 font-normal ml-1",children:["(after $",(F=n.serviceFee)==null?void 0:F.toFixed(2)," fee)"]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${S?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"}`,children:S?"Purchasing":"Selling"}),e.jsx("span",{className:"text-gray-400 text-xs",children:((H=(w=n.createdAt)==null?void 0:w.toDate)==null?void 0:H.call(w).toLocaleDateString())||"Recently"})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:n.fulfillmentMethod==="shipping"?e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:12}),e.jsxs("span",{children:["Shipping to ",(D=n.shippingAddress)==null?void 0:D.city,", ",(O=n.shippingAddress)==null?void 0:O.state]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{size:12}),e.jsx("span",{children:"Local Pickup"})]})}),n.trackingNumber&&e.jsx("div",{className:"mt-2 p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-xs",children:e.jsxs("span",{className:"text-purple-700 dark:text-purple-400 font-bold",children:["Tracking: ",(z=n.trackingCarrier)==null?void 0:z.toUpperCase()," - ",n.trackingNumber]})})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t dark:border-gray-700",children:[o&&n.status===M.PENDING&&e.jsxs("button",{onClick:()=>v(n.id,M.CONFIRMED),className:"flex-1 py-2 bg-blue-600 text-white text-sm font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2",children:[e.jsx(_,{size:16})," Confirm Order"]}),o&&n.status===M.CONFIRMED&&n.fulfillmentMethod==="shipping"&&e.jsxs("button",{onClick:()=>{y(n),g(!0)},className:"flex-1 py-2 bg-purple-600 text-white text-sm font-bold rounded-lg hover:bg-purple-700 transition flex items-center justify-center gap-2",children:[e.jsx(ee,{size:16})," Mark as Shipped"]}),o&&n.status===M.CONFIRMED&&n.fulfillmentMethod==="pickup"&&e.jsxs("button",{onClick:()=>v(n.id,M.COMPLETED),className:"flex-1 py-2 bg-green-600 text-white text-sm font-bold rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2",children:[e.jsx(_,{size:16})," Mark as Picked Up"]}),S&&(n.status===M.SHIPPED||n.status===M.DELIVERED)&&e.jsxs("button",{onClick:()=>L(n),className:"flex-1 py-2 bg-green-600 text-white text-sm font-bold rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2",children:[e.jsx(_,{size:16})," Confirm Receipt"]}),e.jsxs("button",{onClick:()=>p==null?void 0:p(S?n.sellerId:n.buyerId),className:"px-4 py-2 border border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 text-sm font-bold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition flex items-center gap-2",children:[e.jsx(J,{size:16}),"Contact ",S?"Seller":"Buyer"]})]})]})},n.id)})}),e.jsx(Qe,{children:m&&t&&e.jsx(ce.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",onClick:()=>g(!1),children:e.jsxs(ce.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:n=>n.stopPropagation(),className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-6 w-full max-w-md shadow-2xl",children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"text-purple-600"})," Add Shipping Info"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Carrier"}),e.jsx("select",{value:f,onChange:n=>T(n.target.value),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:A.map(n=>e.jsx("option",{value:n.id,children:n.label},n.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Tracking Number"}),e.jsx("input",{type:"text",value:c,onChange:n=>b(n.target.value),placeholder:"Enter tracking number",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300",children:[e.jsx(Ye,{size:12,className:"inline mr-1"}),"The buyer will be notified with the tracking information"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(!1),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:"Cancel"}),e.jsxs("button",{onClick:h,className:"flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition flex items-center justify-center gap-2",children:[e.jsx(ee,{size:16})," Confirm Shipment"]})]})]})]})})})]})}function It({user:s,userData:l,tokenBalance:d,refreshWallet:i}){const[v,p]=a.useState([]),[t,y]=a.useState("All"),[m,g]=a.useState(""),[c,b]=a.useState(new Set),[f,T]=a.useState(!1),[j,P]=a.useState(null),[A,$]=a.useState(null);a.useEffect(()=>{!(s!=null&&s.id)&&!(s!=null&&s.uid)||re},[s==null?void 0:s.id,s==null?void 0:s.uid]),a.useEffect(()=>{!(s!=null&&s.id)&&!(s!=null&&s.uid)||re},[s==null?void 0:s.id,s==null?void 0:s.uid]);const h=async u=>{if(d<u.price){alert("Insufficient tokens! Please top up.");return}if(window.confirm(`Purchase ${u.title} for ${u.price} Tokens?`)){alert("Transaction failed. Database unavailable.");return}},L=v.filter(u=>(t==="All"||u.type===t)&&u.title.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"pb-32",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 md:pb-0 scrollbar-hide",children:["All","Presets","Samples","Beats"].map(u=>e.jsx("button",{onClick:()=>y(u),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-all ${t===u?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300"}`,children:u},u))}),e.jsxs("div",{className:"ml-auto flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(Ue,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card text-sm dark:text-white focus:outline-none",placeholder:"Search...",value:m,onChange:u=>g(u.target.value)})]}),e.jsxs("button",{onClick:()=>T(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-green-700",children:[e.jsx(je,{size:16})," Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:L.map(u=>{const n=c.has(u.id);return e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition flex flex-col group",children:[e.jsxs("div",{className:"aspect-square relative bg-gray-100 dark:bg-gray-800 flex items-center justify-center cursor-pointer",onClick:()=>P(u),children:[u.type==="Presets"?e.jsx(qe,{size:40,className:"text-gray-400"}):e.jsx(Xe,{size:40,className:"text-gray-400"}),n&&e.jsxs("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded flex items-center gap-1",children:[e.jsx(_,{size:8})," OWNED"]})]}),e.jsxs("div",{className:"p-3 flex flex-col flex-1",children:[e.jsx("div",{className:"text-[10px] font-bold text-brand-blue uppercase mb-1",children:u.type}),e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate mb-1",title:u.title,children:u.title}),e.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[e.jsxs("span",{className:"text-xs font-bold text-yellow-600 dark:text-yellow-400 flex items-center gap-1",children:[e.jsx(Ke,{size:10,fill:"currentColor"})," ",u.price]}),!n&&e.jsx("button",{onClick:()=>h(u),className:"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1 rounded text-[10px] font-bold hover:opacity-80",children:"Buy"})]})]})]},u.id)})}),f&&e.jsx(Lt,{user:s,userData:l,onClose:()=>T(!1)}),j&&e.jsx(At,{item:j,isOwned:c.has(j.id),user:s,onClose:()=>P(null),onBuy:()=>h(j),onDownload:()=>handleDownload(j),onReport:()=>$({id:j.id,type:"market_item",summary:j.title})}),A&&e.jsx(ft,{user:s,target:A,onClose:()=>$(null)})]})}function Lt({user:s,userData:l,onClose:d}){const[i,v]=a.useState({title:"",price:"",type:"Presets",tags:"",description:""}),[p,t]=a.useState(null),[y,m]=a.useState(""),{uploading:g}=ge(),c=async()=>{if(!i.title||!i.price||!p||!re)return alert("Title, Price, and Audio File are required.")};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Creator Studio"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"List a new sound for sale"})]}),e.jsx("button",{onClick:d,children:e.jsx(Y,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Title"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:i.title,onChange:b=>v({...i,title:b.target.value}),placeholder:"e.g. Midnight Lofi"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Type"}),e.jsxs("select",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:i.type,onChange:b=>v({...i,type:b.target.value}),children:[e.jsx("option",{children:"Presets"}),e.jsx("option",{children:"Samples"}),e.jsx("option",{children:"Beats"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Price (TK)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:i.price,onChange:b=>v({...i,price:b.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:"3",value:i.description,onChange:b=>v({...i,description:b.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Tags (Comma Separated)"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:i.tags,onChange:b=>v({...i,tags:b.target.value}),placeholder:"lofi, hiphop, boom-bap"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-2 border-dashed dark:border-gray-600 rounded-xl p-6 text-center hover:bg-gray-50 dark:hover:bg-gray-800 transition relative bg-blue-50/50 dark:bg-blue-900/10 h-full flex flex-col justify-center items-center",children:[e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"audio/*",onChange:b=>t(b.target.files[0])}),e.jsx(xt,{size:48,className:"mx-auto text-blue-500 mb-2"}),e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:p?p.name:"Upload Audio File (Product Asset)"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"MP3/WAV (Max 50MB)"}),p&&e.jsx("div",{className:"mt-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Selected"})]})})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:c,disabled:g||!i.title||!i.price||!p,className:"w-full bg-brand-blue text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50",children:g?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"animate-spin"})," ",y]}):"List Item for Sale"})})]})})}function At({item:s,isOwned:l,onClose:d,onBuy:i,onDownload:v,onReport:p}){return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-2xl overflow-hidden w-full max-w-4xl shadow-2xl flex flex-col md:flex-row h-[80vh] md:h-[600px]",children:[e.jsxs("div",{className:"md:w-5/12 bg-gray-100 dark:bg-black/40 relative p-8 flex flex-col justify-center items-center text-center",children:[e.jsx("div",{className:"w-64 h-64 bg-gradient-to-br from-brand-blue to-purple-600 rounded-lg shadow-2xl mb-6 flex items-center justify-center text-white",children:s.type==="Presets"?e.jsx(qe,{size:80}):e.jsx(Xe,{size:80})}),e.jsx("h2",{className:"text-2xl font-bold dark:text-white mb-2",children:s.title}),e.jsxs("div",{className:"text-brand-blue font-medium mb-6",children:["by ",s.author]}),s.downloadUrl&&e.jsx("div",{className:"w-full",children:e.jsx(jt,{audioUrl:s.downloadUrl,fileName:"Preview Track",previewMode:!l})})]}),e.jsxs("div",{className:"md:w-7/12 p-8 overflow-y-auto flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded uppercase tracking-wide",children:s.type}),e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white mt-2",children:s.title})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-gray-400 hover:text-red-500 rounded-full transition",title:"Report Violation",children:e.jsx(gt,{size:20})}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(Y,{size:20})})]})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300 mb-8",children:[e.jsx("p",{children:s.description||"No description provided by the creator."}),!l&&e.jsxs("div",{className:"mt-4 bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded text-yellow-800 dark:text-yellow-200 text-xs flex items-center gap-2",children:[e.jsx(Info,{size:14})," Audio preview is truncated to 15 seconds. Purchase to unlock full track."]})]}),e.jsx("div",{className:"mt-auto",children:l?e.jsxs("button",{onClick:v,className:"w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx(ht,{size:24})," Download Now"]}):e.jsxs("button",{onClick:i,className:"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx("span",{children:"Buy for"}),e.jsxs("span",{className:"bg-yellow-400 text-black px-2 py-0.5 rounded text-sm flex items-center gap-1",children:[e.jsx(Ke,{size:12,fill:"black"})," ",s.price]})]})})]})]})})}function $t({user:s,userData:l,tokenBalance:d}){const i=bt(),v=mt(),p=c=>{const b=c.split("/").filter(Boolean);return b[0]==="marketplace"&&b[1]?b[1]:"gear"},[t,y]=a.useState(()=>p(i.pathname));a.useEffect(()=>{const c=p(i.pathname);c!==t&&y(c)},[i.pathname]);const m=c=>{y(c),v(`/marketplace/${c}`,{replace:!0})},g=[{id:"gear",label:"Gear Exchange"},{id:"fx",label:"SeshFX Store"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:"Marketplace"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-1 rounded-lg border dark:border-gray-700 flex gap-1",children:g.map(c=>e.jsx("button",{onClick:()=>m(c.id),className:`px-4 py-2 text-sm font-bold rounded-md transition-all ${t===c.id?"bg-brand-blue text-white shadow-md":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:c.label},c.id))})]}),e.jsxs("div",{className:"tab-content-wrapper",children:[t==="gear"&&e.jsx("div",{className:"tab-content",children:e.jsx(Et,{user:s,userData:l})},"gear"),t==="fx"&&e.jsx("div",{className:"tab-content",children:e.jsx(It,{user:s,tokenBalance:d})},"fx")]})]})}export{$t as default};
