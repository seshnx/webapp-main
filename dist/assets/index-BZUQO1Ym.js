const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-firebase-BUoA1mzI.js","assets/vendor-EXZBxtf4.js"])))=>i.map(i=>d[i]);
var tr=Object.defineProperty;var sr=(t,s,a)=>s in t?tr(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var cs=(t,s,a)=>sr(t,typeof s!="symbol"?s+"":s,a);import{j as e,w as ar,Z as st,T as $e,X as le,aO as ca,aP as rr,aQ as lr,aR as pt,aS as Et,a4 as wt,r,aT as ir,aU as nr,ad as ys,aV as ft,aW as et,aX as js,aY as At,a as Le,aZ as St,a_ as Dt,a$ as vt,b0 as Pe,b1 as xa,ak as ht,b2 as Wt,W as ot,b3 as ga,A as es,b4 as or,U as _e,h as qe,aa as Vt,$ as yt,ab as dr,a3 as cr,a9 as Ie,z as Lt,b5 as xr,g as dt,J as Ut,an as Fe,m as Je,L as K,a0 as Te,b6 as ua,a2 as Os,S as Ge,a8 as Ht,b7 as ze,b8 as gr,b9 as bs,ai as at,aj as ut,ba as Ce,O as mt,s as re,e as ma,bb as Rt,bc as je,i as ur,bd as ts,a5 as ss,x as mr,y as ba,v as ha,be as br,bf as hr,Y as jt,q as pr,bg as fr,bh as I,p as yr,N as It,V as vs,bi as jr,a6 as pa,P as lt,H as vr,bj as Nr,bk as Ns,bl as Gt,bm as Se,bn as ks,t as fa,c as ya,bo as ws,bp as ja,bq as kr,Q as wr,ag as Mt,K as Sr,br as Ss,af as rt,bs as va,bt as as,bu as Na,bv as De,D as rs,bw as Cr,E as ka,bx as Yt,by as wa,bz as Rr,bA as Bs,bB as tt,B as Ft,bC as zr,bD as Pr,bE as Er,bF as hs,bG as Ar,bH as Lr,M as Sa,bI as Cs,bJ as Ir,a7 as $r,bK as Tr,bL as _s,bM as Mr,bN as Fr,bO as Or,bP as Br,bQ as Kt,bR as _r,bS as qr,bT as Wr,bU as qs,al as zt,am as Pt,bV as Vr,bW as Ur,bX as Hr,bY as Gr,bZ as Yr,b_ as Kr,b$ as Qr,c0 as ke,c1 as gt,R as Xr,c2 as Zr,c3 as Jr,c4 as Dr,c5 as el,c6 as tl,c7 as sl}from"./vendor-EXZBxtf4.js";import{E as D,q as me,N as Qe,M as Re,I as ge,C as W,G as te,P as $t,K as Ee,J as X,Q as Rs,k as He,w as we,R as al,S as rl,T as ll,U as il,O as ct,V as Oe,W as nl,X as Ke,D as Be,Y as ol,j as ls,r as Ws,Z as dl,h as cl,_ as xl,$ as Vs,a0 as gl,a1 as ul,a2 as ml,a3 as bl,a4 as hl,H as Us,a as pl,d as fl,a5 as yl}from"./vendor-firebase-BUoA1mzI.js";import{U as kt,g as Z,d as P,b as Nt,a as ee,i as ps,c as Ca,S as xs,u as xt,e as jl,C as vl,f as Nl,h as kl,s as Hs,j as Gs,k as wl}from"./chat-BfZcpZNA.js";import{A as nt,m as Ne}from"./vendor-framer-DUUZAQQa.js";import{u as Sl,A as Qt,f as is,a as Cl,b as Ra,P as Xt,c as Rl,I as zl,G as Pl,D as Ct,R as El,d as Al,E as bt,e as Ll,g as Il,S as Zt,T as za,h as $l,i as Tl,j as Ml,k as Fl,l as Ol,m as Bl,n as _l}from"./edu-D-aZ-A8E.js";import{M as Pa,T as Ea,C as qt,u as Aa,L as La,i as ql,a as Wl,b as Vl,P as Ul}from"./vendor-maps-DHq-_Uxv.js";import{w as Hl}from"./vendor-audio-Bu2lAtPy.js";import"./vendor-stripe-OXK3Micb.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function a(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(l){if(l.ep)return;l.ep=!0;const n=a(l);fetch(l.href,n)}})();const Ia="/assets/SeshNx-PNG%20cCropped%20white%20text-BvB6QJif.png",$a="/assets/SeshNx-PNG%20cCropped-mikqxod_.png",Gl=({type:t})=>{const s={size:14},a={follow:e.jsx(wt,{...s}),like:e.jsx(Et,{...s}),comment:e.jsx(pt,{...s}),mention:e.jsx(lr,{...s}),reply:e.jsx(rr,{...s}),save:e.jsx(ca,{...s})},i={follow:"bg-brand-blue/10 text-brand-blue dark:bg-brand-blue/20",like:"bg-red-100 text-red-500 dark:bg-red-900/30 dark:text-red-400",comment:"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400",mention:"bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400",reply:"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400",save:"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400"};return e.jsx("div",{className:`p-1.5 rounded-full ${i[t]||"bg-gray-100 text-gray-500"}`,children:a[t]||e.jsx(st,{size:14})})},Yl=t=>{if(!t)return"";const s=t.toMillis?new Date(t.toMillis()):new Date(t),i=new Date-s,l=Math.floor(i/6e4),n=Math.floor(l/60),o=Math.floor(n/24);return l<1?"Just now":l<60?`${l}m`:n<24?`${n}h`:o<7?`${o}d`:s.toLocaleDateString()},Kl=({notification:t,onMarkAsRead:s,onDelete:a,onUserClick:i,onPostClick:l})=>{const n=()=>{t.read||s(t.id),t.type==="follow"&&i?i(t.fromUserId):t.postId&&l&&l(t.postId)};return e.jsxs(Ne.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},className:`
                p-3 cursor-pointer border-b dark:border-gray-700 last:border-0 
                flex gap-3 items-start group transition-colors
                ${t.read?"hover:bg-gray-50 dark:hover:bg-gray-800":"bg-blue-50/50 dark:bg-blue-900/10 hover:bg-blue-50 dark:hover:bg-blue-900/20"}
            `,onClick:n,children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx(kt,{src:t.fromUserPhoto,name:t.fromUserName,size:"sm"}),e.jsx("div",{className:"absolute -bottom-1 -right-1",children:e.jsx(Gl,{type:t.type})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("p",{className:"text-sm dark:text-gray-200 leading-snug",children:[e.jsx("span",{className:"font-bold hover:text-brand-blue transition-colors",children:t.fromUserName})," ",e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.message})]}),e.jsx("span",{className:"text-[10px] text-gray-400 whitespace-nowrap shrink-0",children:Yl(t.timestamp)})]}),t.postPreview&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1 line-clamp-1 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded",children:['"',t.postPreview,'"']}),!t.read&&e.jsx("div",{className:"w-2 h-2 bg-brand-blue rounded-full absolute right-3 top-1/2 -translate-y-1/2"})]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),a(t.id)},className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-all text-gray-400 hover:text-red-500 shrink-0",children:e.jsx(le,{size:14})})]})};function Ql({notifications:t,unreadCount:s,loading:a,onMarkAsRead:i,onMarkAllAsRead:l,onDeleteNotification:n,onClearAll:o,onUserClick:p,onPostClick:x,onClose:b}){return e.jsxs("div",{className:"absolute right-0 top-full mt-3 w-80 sm:w-96 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-2xl z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"p-3 px-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm",children:"Notifications"}),s>0&&e.jsx("span",{className:"text-xs bg-brand-blue text-white px-2 py-0.5 rounded-full font-bold animate-pulse",children:s})]}),s>0&&e.jsxs("button",{onClick:l,className:"text-xs text-brand-blue hover:text-blue-700 font-medium flex items-center gap-1 transition",children:[e.jsx(ar,{size:14}),"Mark all read"]})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto custom-scrollbar",children:a?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-brand-blue border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading..."})]}):t.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-3",children:e.jsx(st,{size:24,className:"opacity-30"})}),e.jsx("p",{className:"text-sm font-medium dark:text-gray-400",children:"All caught up!"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"No new notifications"})]}):e.jsx(nt,{mode:"popLayout",children:t.map(m=>e.jsx(Kl,{notification:m,onMarkAsRead:i,onDelete:n,onUserClick:p,onPostClick:x},m.id))})}),t.length>0&&e.jsxs("div",{className:"p-2 bg-gray-50 dark:bg-[#23262f] border-t dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("button",{onClick:o,className:"text-xs text-gray-400 hover:text-red-500 font-medium flex items-center gap-1 transition px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx($e,{size:12}),"Clear all"]}),e.jsx("button",{onClick:b,className:"text-xs text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Close"})]})]})}function Xl({count:t}){return t===0?null:e.jsx(Ne.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-0.5 -right-0.5 min-w-[18px] h-[18px] bg-red-500 rounded-full text-[10px] text-white font-bold flex items-center justify-center border-2 border-white dark:border-dark-card",children:t>99?"99+":t})}function Ta(t,s=50){const[a,i]=r.useState([]),[l,n]=r.useState(0),[o,p]=r.useState(!0);r.useEffect(()=>{if(!t){p(!1);return}const d=D(P,Z(t).notifications),v=me(d,Re("timestamp","desc"),Qe(s)),u=ge(v,g=>{const y=g.docs.map(c=>({id:c.id,...c.data()}));i(y),n(y.filter(c=>!c.read).length),p(!1)},g=>{console.error("Notifications listener error:",g),p(!1)});return()=>u()},[t,s]);const x=r.useCallback(async d=>{if(t)try{const v=W(P,Z(t).notifications,d);await te(v,{read:!0})}catch(v){console.error("Mark as read error:",v)}},[t]),b=r.useCallback(async()=>{if(!(!t||l===0))try{const d=$t(P);a.filter(u=>!u.read).forEach(u=>{const g=W(P,Z(t).notifications,u.id);d.update(g,{read:!0})}),await d.commit()}catch(d){console.error("Mark all as read error:",d)}},[t,a,l]),m=r.useCallback(async d=>{if(t)try{const v=W(P,Z(t).notifications,d);await te(v,{deleted:!0})}catch(v){console.error("Delete notification error:",v)}},[t]),h=r.useCallback(async()=>{if(t)try{const d=$t(P);a.forEach(v=>{const u=W(P,Z(t).notifications,v.id);d.update(u,{deleted:!0})}),await d.commit()}catch(d){console.error("Clear all error:",d)}},[t,a]);return{notifications:a.filter(d=>!d.deleted),unreadCount:l,loading:o,markAsRead:x,markAllAsRead:b,deleteNotification:m,clearAll:h}}async function Ma({targetUserId:t,type:s,fromUserId:a,fromUserName:i,fromUserPhoto:l,postId:n=null,postPreview:o=null,commentId:p=null,message:x}){if(!(!t||t===a))try{await Ee(D(P,Z(t).notifications),{type:s,fromUserId:a,fromUserName:i,fromUserPhoto:l||null,postId:n,postPreview:o,commentId:p,message:x,read:!1,timestamp:X()})}catch(b){console.error("Create notification error:",b)}}function Zl({user:t,userData:s,subProfiles:a,darkMode:i,toggleTheme:l,activeTab:n,setActiveTab:o,onMenuClick:p,onRoleSwitch:x,openPublicProfile:b}){var B;const[m,h]=r.useState(!1),[d,v]=r.useState(!1),[u,g]=r.useState(!1),y=r.useRef(null),c=r.useRef(null),{notifications:k,unreadCount:N,loading:f,markAsRead:S,markAllAsRead:j,deleteNotification:C,clearAll:R}=Ta(t==null?void 0:t.uid),E=(s==null?void 0:s.activeProfileRole)||((B=s==null?void 0:s.accountTypes)==null?void 0:B[0])||"User",w=(s==null?void 0:s.accountTypes)||[],z=["Student","Instructor","Intern","Admin"],A=w.some(U=>z.includes(U)),q=n.startsWith("edu"),G=U=>{if(!U||U==="Main"||U==="Fan"||U==="User")return(s==null?void 0:s.effectiveDisplayName)||(s==null?void 0:s.firstName)||"User";const Q=a==null?void 0:a[U];return(Q==null?void 0:Q.displayName)||(s==null?void 0:s.effectiveDisplayName)||(s==null?void 0:s.firstName)||"User"},H=G(E),J=()=>{o(E==="Student"?"edu-student":E==="Intern"?"edu-intern":"edu-overview")};r.useEffect(()=>{{g(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{g(!0)})});const U=setTimeout(()=>g(!1),600);return()=>clearTimeout(U)}},[E]),r.useEffect(()=>{function U(Q){y.current&&!y.current.contains(Q.target)&&h(!1),c.current&&!c.current.contains(Q.target)&&v(!1)}return document.addEventListener("mousedown",U),()=>document.removeEventListener("mousedown",U)},[y,c]);const M=U=>{h(!1),b&&b(U)},L=U=>{h(!1),o("feed")},_=U=>{x&&x(U),v(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed top-0 bottom-0 w-full pointer-events-none z-[9999] 
          bg-gradient-to-r from-transparent via-white/30 dark:via-white/10 to-transparent
          ${u?"left-[-100%] transition-all duration-500 ease-out":"left-[100%] transition-none duration-0"}
        `}),e.jsxs("nav",{className:"h-16 bg-white dark:bg-dark-card border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 shrink-0 z-20 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:p,className:"p-2 -ml-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 lg:hidden",children:e.jsx(ir,{size:24})}),e.jsx("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>o("dashboard"),children:e.jsx("img",{src:i?Ia:$a,alt:"SeshNx Logo",className:"h-8 w-auto object-contain transition-opacity duration-300"})})]}),e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[A&&e.jsxs("div",{className:"hidden md:flex items-center bg-gray-100 dark:bg-gray-800 rounded-lg p-1 border dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>o("dashboard"),className:`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${q?"text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200":"bg-white dark:bg-gray-600 shadow-sm text-brand-blue dark:text-white"}`,children:[e.jsx(nr,{size:14})," Studio"]}),e.jsxs("button",{onClick:J,className:`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${q?"bg-white dark:bg-gray-600 shadow-sm text-indigo-600 dark:text-white":"text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200"}`,children:[e.jsx(ys,{size:14})," Education"]})]}),w.length>1&&e.jsxs("div",{className:"relative hidden sm:flex items-center gap-3",ref:c,children:[e.jsxs("button",{onClick:()=>v(!d),className:"group flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs font-bold transition border border-gray-200 dark:border-gray-700",children:[e.jsx(ft,{size:12,className:`text-brand-blue shrink-0 transition-transform ${u?"rotate-180 duration-500":""}`}),e.jsx("span",{children:E}),e.jsx(et,{size:12,className:`shrink-0 transition-transform ${d?"rotate-180":""}`})]}),e.jsxs("div",{className:"flex flex-col leading-tight",children:[e.jsx("span",{className:"text-[10px] text-gray-500 font-medium",children:"Posting as"}),e.jsx("span",{className:"text-xs font-bold dark:text-white truncate max-w-[150px]",children:H})]}),d&&e.jsxs("div",{className:"absolute left-0 top-full mt-2 w-56 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-xl z-50 overflow-hidden animate-in fade-in slide-in-from-top-1 duration-200",children:[e.jsx("div",{className:"p-2 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wider pl-2",children:"Switch Profile Context"})}),e.jsx("div",{className:"p-1",children:w.map(U=>{const Q=G(U);return e.jsxs("button",{onClick:()=>_(U),className:`w-full text-left px-3 py-2 rounded-lg text-sm font-medium transition flex items-center justify-between ${E===U?"bg-blue-50 dark:bg-blue-900/20 text-brand-blue":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:Q}),e.jsx("span",{className:"text-[10px] opacity-70 font-normal uppercase",children:U})]}),E===U&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-blue"})]},U)})})]})]}),e.jsx("button",{onClick:l,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300",children:i?e.jsx(js,{size:20}):e.jsx(At,{size:20})}),e.jsxs("div",{className:"relative",ref:y,children:[e.jsxs("button",{className:`relative p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition ${m?"bg-gray-100 dark:bg-gray-800 text-brand-blue":""}`,onClick:()=>h(!m),children:[e.jsx(st,{size:20}),e.jsx(Xl,{count:N})]}),m&&e.jsx(Ql,{notifications:k,unreadCount:N,loading:f,onMarkAsRead:S,onMarkAllAsRead:j,onDeleteNotification:C,onClearAll:R,onUserClick:M,onPostClick:L,onClose:()=>h(!1)})]}),e.jsx(kt,{src:s==null?void 0:s.photoURL,name:H,size:"sm",className:"border-2 border-transparent hover:border-brand-blue transition",onClick:()=>o("profile")})]})]})]})}function Jl({userData:t,activeTab:s,setActiveTab:a,sidebarOpen:i,setSidebarOpen:l,handleLogout:n}){var u,g,y;const{isStudent:o,isStaff:p}=Sl(),x=[{id:"dashboard",icon:e.jsx(Le,{size:18}),label:"Dashboard"},{id:"feed",icon:e.jsx(St,{size:18}),label:"SocialNx"},{id:"marketplace",icon:e.jsx(Dt,{size:18}),label:"Marketplace"},{id:"tech",icon:e.jsx(vt,{size:18}),label:"Tech Services"},{id:"bookings",icon:e.jsx(Pe,{size:18}),label:"Bookings"},{id:"messages",icon:e.jsx(pt,{size:18}),label:"Messages"},{id:"payments",icon:e.jsx(xa,{size:18}),label:"Billing"},{id:"profile",icon:e.jsx(ht,{size:18}),label:"Profile"}],b=(u=t==null?void 0:t.accountTypes)==null?void 0:u.includes("Intern");if(o||b||p||(g=t==null?void 0:t.accountTypes)!=null&&g.includes("student")){const c=x.findIndex(f=>f.id==="payments");let k="EDU Panel";b?k="Internship":p&&(k="School Admin");let N="edu-overview";b?N="edu-intern":o&&(N="edu-student"),x.splice(c,0,{id:N,icon:e.jsx(ys,{size:18}),label:k,highlight:!0})}const m=(y=t==null?void 0:t.accountTypes)==null?void 0:y.some(c=>["Studio","Label","Agent","Artist","Producer","Engineer","DJ"].includes(c)),h=n||(()=>Rs(Nt)),d=c=>{a(c);const k=window.innerWidth<1024;l&&(k||i)&&l(!1)},v=({isMobile:c})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 py-4 overflow-y-auto scrollbar-hide",children:[c&&e.jsxs("div",{className:"px-4 mb-6 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase",children:"Menu"}),e.jsx("button",{onClick:()=>l(!1),className:"p-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors",children:e.jsx(le,{size:20})})]}),e.jsx("nav",{className:"space-y-1 px-2",children:x.map(k=>e.jsxs("button",{onClick:()=>d(k.id),className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition
                ${s===k.id?"bg-blue-50 text-brand-blue dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}
                ${k.highlight?"text-amber-600 dark:text-amber-500":""}
                `,children:[k.icon,k.label]},k.id))}),e.jsxs("div",{className:"mt-auto px-2 pt-4 space-y-1",children:[e.jsxs("button",{onClick:()=>d("legal"),className:`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium w-full transition ${s==="legal"?"bg-blue-50 text-brand-blue dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx(Wt,{size:18}),"Legal Center"]}),m&&e.jsxs("button",{onClick:()=>d("business-center"),className:`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium w-full transition ${s==="business-center"?"bg-indigo-50 text-indigo-600 dark:bg-indigo-900/20 dark:text-indigo-400":"text-indigo-600 dark:text-indigo-400 hover:bg-indigo-50 dark:hover:bg-indigo-900/10"}`,children:[e.jsx(ot,{size:18}),"Business Center"]})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 shrink-0 bg-white dark:bg-[#1f2128]",children:e.jsxs("button",{onClick:h,className:"flex items-center gap-2 text-red-500 text-sm font-medium hover:opacity-80 px-2 w-full py-2 rounded hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors",children:[e.jsx(ga,{size:16})," Sign Out"]})})]});return e.jsxs(e.Fragment,{children:[e.jsx("aside",{className:"hidden lg:flex w-64 bg-white dark:bg-[#1f2128] border-r border-gray-200 dark:border-gray-700 flex-col h-full shrink-0 relative z-30",children:e.jsx(v,{isMobile:!1})}),e.jsx("div",{className:`fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] transition-opacity duration-300 lg:hidden ${i?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:()=>l(!1)}),e.jsx("aside",{className:`fixed inset-y-0 left-0 z-[10000] w-72 bg-white dark:bg-[#1f2128] shadow-2xl transform transition-transform duration-300 cubic-bezier(0.4, 0, 0.2, 1) flex flex-col h-full lg:hidden ${i?"translate-x-0":"-translate-x-full"}`,children:e.jsx(v,{isMobile:!0})})]})}function Dl({activeTab:t,setActiveTab:s,sidebarOpen:a,setSidebarOpen:i,isGlobalAdmin:l}){const n=[{id:"edu-overview",icon:or,label:"Overview"},{id:"edu-roster",icon:_e,label:"Student Roster"},{id:"edu-hours",icon:qe,label:"Internship Hours"},{id:"edu-instructors",icon:wt,label:"Staff Management"},{id:"edu-roles",icon:Vt,label:"Role Permissions"},{id:"edu-resources",icon:yt,label:"Resource Rules"},{id:"edu-news",icon:dr,label:"Announcements"},{id:"edu-partners",icon:ot,label:"Partnerships"},{id:"edu-evaluations",icon:ys,label:"Grading & Evals"},{id:"edu-cohorts",icon:_e,label:"Cohorts"},{id:"edu-audit",icon:cr,label:"Audit Logs"},{id:"edu-settings",icon:ht,label:"School Settings"}],o=x=>{s(x),i&&i(!1)},p=()=>e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>s("dashboard"),className:"flex items-center gap-2 text-xs font-bold text-gray-500 hover:text-brand-blue transition mb-4",children:[e.jsx(es,{size:14})," Back to Studio"]}),e.jsx("h2",{className:"text-lg font-extrabold dark:text-white tracking-tight px-1",children:"EDU Control"})]}),e.jsx("div",{className:"flex-1 py-4 overflow-y-auto custom-scrollbar px-3 space-y-1",children:n.map(x=>e.jsxs("button",{onClick:()=>o(x.id),className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors
                        ${t===x.id?"bg-indigo-50 text-indigo-600 dark:bg-indigo-900/20 dark:text-indigo-300":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}
                        `,children:[e.jsx(x.icon,{size:18}),x.label]},x.id))}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 shrink-0 bg-gray-50 dark:bg-[#23262f]",children:e.jsxs("div",{className:"flex items-center gap-3 px-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center text-indigo-700 dark:text-indigo-300 font-bold text-xs",children:"EA"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold dark:text-white truncate",children:"EDU Admin"}),e.jsx("p",{className:"text-[10px] text-gray-500 truncate",children:"School Management"})]}),e.jsx("button",{onClick:()=>Rs(Nt),className:"text-gray-400 hover:text-red-500",children:e.jsx(ga,{size:16})})]})})]});return e.jsxs(e.Fragment,{children:[e.jsx("aside",{className:"hidden lg:flex w-64 bg-white dark:bg-[#1f2128] border-r border-gray-200 dark:border-gray-700 flex-col h-full shrink-0 relative z-30",children:e.jsx(p,{})}),e.jsx("div",{className:`fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] transition-opacity duration-300 lg:hidden ${a?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:()=>i(!1)}),e.jsx("aside",{className:`fixed inset-y-0 left-0 z-[10000] w-72 bg-white dark:bg-[#1f2128] shadow-2xl transform transition-transform duration-300 cubic-bezier(0.4, 0, 0.2, 1) flex flex-col h-full lg:hidden ${a?"translate-x-0":"-translate-x-full"}`,children:e.jsx(p,{})})]})}function Fa({isEmbedded:t=!1}){const[s,a]=r.useState("tos"),i=[{id:"tos",label:"Terms of Service",icon:Lt},{id:"privacy",label:"Privacy Policy",icon:yt},{id:"cookies",label:"Cookie Policy",icon:xr},{id:"dmca",label:"DMCA & Copyright",icon:Ie}];return e.jsxs("div",{className:`flex flex-col md:flex-row bg-white dark:bg-[#1f2128] h-full ${t?"":"max-w-6xl mx-auto rounded-2xl shadow-xl border dark:border-gray-700 overflow-hidden my-8 min-h-[600px]"}`,children:[e.jsxs("div",{className:"w-full md:w-72 bg-gray-50 dark:bg-[#23262f] border-r dark:border-gray-700 flex flex-col shrink-0",children:[!t&&e.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:e.jsxs("h2",{className:"text-2xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(Ie,{className:"text-brand-blue"})," Legal Center"]})}),e.jsx("div",{className:"p-4 space-y-1 overflow-y-auto flex-1",children:i.map(l=>e.jsxs("button",{onClick:()=>a(l.id),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all duration-200 group text-left
                            ${s===l.id?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm border border-gray-200 dark:border-gray-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-200/50 dark:hover:bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l.icon,{size:18,className:s===l.id?"text-brand-blue":"text-gray-400 group-hover:text-gray-500"}),e.jsx("span",{className:"font-bold text-sm",children:l.label})]}),s===l.id&&e.jsx(dt,{size:16,className:"text-brand-blue"})]},l.id))}),e.jsxs("div",{className:"p-6 bg-blue-50 dark:bg-blue-900/10 border-t border-blue-100 dark:border-blue-800/30",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-400 font-bold text-xs mb-2",children:[e.jsx(Ut,{size:14})," US Compliance Standard"]}),e.jsx("p",{className:"text-[10px] text-blue-600 dark:text-blue-300 leading-relaxed opacity-80",children:"Documents compliant with CCPA, DMCA, and federal payment regulations."})]})]}),e.jsx("div",{className:"flex-1 bg-white dark:bg-[#1f2128] relative overflow-hidden flex flex-col",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-6 md:p-12 custom-scrollbar",children:e.jsxs("div",{className:"max-w-3xl mx-auto animate-in fade-in slide-in-from-bottom-2 duration-300",children:[s==="tos"&&e.jsx(ei,{}),s==="privacy"&&e.jsx(ti,{}),s==="cookies"&&e.jsx(si,{}),s==="dmca"&&e.jsx(ai,{}),e.jsx("div",{className:"mt-20 pt-8 border-t dark:border-gray-800",children:e.jsx("p",{className:"text-xs text-gray-400 text-center font-medium",children:"Last updated: November 29, 2025 • SeshNx Legal Department"})})]})})})]})}const ns=({children:t})=>e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-gray-900 dark:text-white mb-8 tracking-tight",children:t}),Ue=({title:t,children:s})=>e.jsxs("div",{className:"mb-10",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:t}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300 leading-7 text-sm md:text-base space-y-4",children:s})]}),Tt=({items:t})=>e.jsx("ul",{className:"space-y-2 mt-2",children:t.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-2 w-1.5 h-1.5 rounded-full bg-brand-blue shrink-0"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:s}})]},a))}),ei=()=>e.jsxs(e.Fragment,{children:[e.jsx(ns,{children:"Terms of Service"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 leading-relaxed",children:"Welcome to SeshNx. By accessing or using our platform, you agree to be bound by these Terms of Service. Please read them carefully."}),e.jsx(Ue,{title:"1. Platform Services",children:e.jsx("p",{children:'SeshNx provides a marketplace and collaboration tool for music professionals ("Creatives") and educational institutions ("Schools"). We facilitate bookings, payments, and content sharing but are not a party to the actual service contracts between users.'})}),e.jsx(Ue,{title:"2. User Accounts",children:e.jsx("p",{children:"You are responsible for maintaining the confidentiality of your account credentials. You must be at least 13 years old to use SeshNx. Users under 18 require parental consent or School authorization to participate in educational programs."})}),e.jsxs(Ue,{title:"3. Payments & Fees",children:[e.jsxs("p",{children:["Payments are processed securely via Stripe. By using our payment features, you agree to the ",e.jsx("a",{href:"https://stripe.com/connect-account/legal",target:"_blank",rel:"noreferrer",className:"text-brand-blue hover:underline font-bold",children:"Stripe Connected Account Agreement"}),"."]}),e.jsx("p",{children:"SeshNx charges a platform fee on transactions (ranging from 0% to 20% depending on your subscription tier), which is automatically deducted at the time of payout."})]}),e.jsx(Ue,{title:"4. User Generated Content",children:e.jsx("p",{children:"You retain full ownership of the content you upload (audio, images, text). By uploading, you grant SeshNx a non-exclusive, worldwide license to display, transcode, and distribute your content strictly for the purpose of operating the service."})}),e.jsxs(Ue,{title:"5. Prohibited Conduct",children:[e.jsx("p",{children:"You agree not to use SeshNx for:"}),e.jsx(Tt,{items:["Harassment, hate speech, or bullying.","Distribution of malware or unauthorized automated scraping.","Fraudulent transactions or money laundering.","Copyright infringement or uploading content you do not own."]}),e.jsx("p",{className:"mt-2",children:"We reserve the right to suspend or ban accounts violating these rules without prior notice."})]})]}),ti=()=>e.jsxs(e.Fragment,{children:[e.jsx(ns,{children:"Privacy Policy"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 leading-relaxed",children:"Your privacy is critical to us. This policy explains how we collect, use, and share your data in compliance with US and international standards."}),e.jsx(Ue,{title:"1. Information We Collect",children:e.jsx(Tt,{items:["<strong>Account Data:</strong> Name, email, password (hashed), and profile bio.","<strong>Financial Data:</strong> Bank account and tax info (processed and stored securely via Stripe; SeshNx does not store full credit card numbers).","<strong>Usage Data:</strong> Location (for studio search), IP address, and browser type.","<strong>Content:</strong> Direct messages, audio files, and images you upload."]})}),e.jsx(Ue,{title:"2. How We Use Information",children:e.jsx("p",{children:"We use your data to: provide and personalize services, process payments, verify student enrollment with partner schools, improve platform performance, and comply with legal obligations."})}),e.jsxs(Ue,{title:"3. Data Sharing",children:[e.jsx("p",{children:"We do not sell your personal data. We only share data with:"}),e.jsx(Tt,{items:["<strong>Service Providers:</strong> Google (Hosting/Auth), Stripe (Payments).","<strong>Educational Institutions:</strong> If you link a student account, your School Administrators can view your internship activity logs.","<strong>Legal Authorities:</strong> When required by valid legal process or subpoena."]})]}),e.jsx(Ue,{title:"4. CCPA / California Rights",children:e.jsxs("p",{children:["California residents have the right to request access to or deletion of their personal data. Please contact ",e.jsx("strong",{children:"legal@seshnx.com"})," to exercise these rights."]})})]}),si=()=>e.jsxs(e.Fragment,{children:[e.jsx(ns,{children:"Cookie Policy"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 leading-relaxed",children:"SeshNx uses cookies to enhance your experience. By using our site, you consent to our use of cookies."}),e.jsx(Ue,{title:"Types of Cookies We Use",children:e.jsx(Tt,{items:["<strong>Essential Cookies:</strong> Required for login authentication (e.g., Firebase Auth tokens). The site cannot function without these.","<strong>Functional Cookies:</strong> Remember your preferences, such as Dark Mode settings and Sidebar state.","<strong>Analytics Cookies:</strong> Help us understand how you use the site to improve features. These are aggregated and anonymous."]})}),e.jsx(Ue,{title:"Managing Cookies",children:e.jsx("p",{children:"You can control or delete cookies through your browser settings. However, please note that disabling Essential Cookies will prevent you from logging in to SeshNx."})})]}),ai=()=>e.jsxs(e.Fragment,{children:[e.jsx(ns,{children:"DMCA & Copyright"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 leading-relaxed",children:"SeshNx respects the intellectual property rights of others and complies with the Digital Millennium Copyright Act (DMCA)."}),e.jsxs(Ue,{title:"Reporting Infringement",children:[e.jsxs("p",{children:["If you believe your copyrighted work has been infringed on SeshNx, please send a notice to our Designated Agent at ",e.jsx("strong",{children:"legal@seshnx.com"})," including:"]}),e.jsx(Tt,{items:["Identification of the copyrighted work claimed to have been infringed.","Identification of the infringing material (URL or Post ID).","Your contact information (Email, Phone).","A statement of good faith belief that the use is unauthorized.","A statement, under penalty of perjury, that the information is accurate and you are the copyright owner."]})]}),e.jsx(Ue,{title:"Counter-Notices",children:e.jsx("p",{children:"If your content was removed by mistake, you may file a counter-notice. We may restore the content within 10-14 business days if the complainant does not file a court action against you."})})]});function ri({onImagesLoaded:t}){const[s,a]=r.useState([]),[i,l]=r.useState(0),[n,o]=r.useState(!0),[p,x]=r.useState(!1),[b,m]=r.useState({x:0,y:0,startX:0,startY:0}),h=r.useRef(null);if(r.useEffect(()=>{(async()=>{var f;try{const S=me(D(P,`artifacts/${ee}/auth_backgrounds`),Re("order","asc"),Qe(20)),j=await He(S);if(j.empty)a([{id:"1",url:"https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1920&q=80",order:0},{id:"2",url:"https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=1920&q=80",order:1},{id:"3",url:"https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=1920&q=80",order:2},{id:"4",url:"https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1920&q=80",order:3}]);else{const C=j.docs.map(R=>({id:R.id,url:R.data().url,order:R.data().order||0}));a(C)}}catch(S){(f=S.message)!=null&&f.includes("BLOCKED_BY_CLIENT")||S.code==="unavailable"?console.warn("Firestore request blocked by browser extension. Using fallback images."):console.error("Error loading background images:",S),a([{id:"1",url:"https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1920&q=80",order:0},{id:"2",url:"https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=1920&q=80",order:1},{id:"3",url:"https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=1920&q=80",order:2}])}finally{o(!1)}})()},[]),r.useEffect(()=>{if(s.length===0)return;const N=[{startX:0,startY:0,endX:100,endY:0},{startX:100,startY:0,endX:0,endY:0},{startX:0,startY:0,endX:0,endY:100},{startX:0,startY:100,endX:0,endY:0},{startX:0,startY:0,endX:100,endY:100},{startX:100,startY:0,endX:0,endY:100},{startX:0,startY:100,endX:100,endY:0},{startX:100,startY:100,endX:0,endY:0}],f=N[Math.floor(Math.random()*N.length)];m(f)},[i,s.length]),r.useEffect(()=>{if(s.length===0||n)return;const N=3e4;return h.current=setInterval(()=>{l(f=>{let S;do S=Math.floor(Math.random()*s.length);while(S===f&&s.length>1);return S})},N),()=>{h.current&&clearInterval(h.current)}},[s.length,n]),r.useEffect(()=>{if(!n&&s.length>0&&!p){const N=new Image;N.onload=()=>{x(!0),t&&t(!0)},N.onerror=()=>{x(!0),t&&t(!0)},N.src=s[0].url}},[n,s,p,t]),n||s.length===0)return null;const d=s[i],v=2.2,u=40,g=(N,f)=>{const S=N===0?"0%":N===100?`-${u}%`:`-${u/2}%`,j=f===0?"0%":f===100?`-${u}%`:`-${u/2}%`;return`scale(${v}) translate(${S}, ${j}) translateZ(0)`},y=g(b.startX,b.startY),c=g(b.endX,b.endY),k=`pan-${b.startX}-${b.startY}-${b.endX}-${b.endY}`;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes ${k} {
          0% {
            transform: ${y};
          }
          100% {
            transform: ${c};
          }
        }
      `}),e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",style:{zIndex:-1},children:[e.jsxs("div",{className:"absolute inset-0 background-pan-container",style:{willChange:"opacity",transform:"translateZ(0)"},children:[e.jsx("div",{className:"absolute inset-0 background-pan-image",style:{backgroundImage:`url(${d.url})`,backgroundSize:"cover",backgroundPosition:"center",animation:`${k} 30s linear forwards`,willChange:"transform",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"translateZ(0)"}}),e.jsx("div",{className:"absolute inset-0",style:{background:"radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.4) 70%, rgba(0,0,0,0.7) 100%)",pointerEvents:"none"}}),e.jsx("div",{className:"absolute inset-0",style:{backdropFilter:"blur(1px)",WebkitBackdropFilter:"blur(1px)",opacity:.15,pointerEvents:"none"}})]},d.id),e.jsx("div",{className:"absolute inset-0 bg-black/20 pointer-events-none"})]})]})}const li=["Student","Instructor","Intern","Admin"];function ii({lat:t,lng:s}){const a=Aa();return r.useEffect(()=>{a.setView([t,s],11)},[t,s,a]),null}function ni({zip:t}){const[s,a]=r.useState({center:[34.0522,-118.2437],userCount:0,densityColor:"gray",locationName:"",regionLabel:"",isValid:!1,loading:!1});return r.useEffect(()=>{if(!t||t.length<5)return;const l=setTimeout(async()=>{a(o=>({...o,loading:!0}));const n=await is(t);if(n){const{count:o,density:p,label:x}=await Cl(t);a({center:[n.lat,n.lng],userCount:o,densityColor:p,locationName:n.cityState,regionLabel:x,isValid:!0,loading:!1})}else a(o=>({...o,loading:!1}))},800);return()=>clearTimeout(l)},[t]),e.jsxs("div",{className:"w-full h-36 rounded-xl overflow-hidden relative border dark:border-gray-600 shadow-inner animate-in fade-in duration-500 bg-gray-100 dark:bg-[#1f2128]",children:[e.jsxs(Pa,{center:s.center,zoom:11,scrollWheelZoom:!1,zoomControl:!1,className:"h-full w-full",style:{background:"transparent"},children:[e.jsx(Ea,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'© <a href="https://carto.com/attributions">CARTO</a>'}),e.jsx(ii,{lat:s.center[0],lng:s.center[1]}),s.isValid&&e.jsxs(e.Fragment,{children:[e.jsx(qt,{center:s.center,radius:8e3,pathOptions:{color:s.densityColor,fillColor:s.densityColor,fillOpacity:.05,stroke:!1}}),e.jsx(qt,{center:s.center,radius:4e3,pathOptions:{color:s.densityColor,fillColor:s.densityColor,fillOpacity:.15,stroke:!1}}),e.jsx(qt,{center:s.center,radius:400,pathOptions:{color:"white",fillColor:s.densityColor,fillOpacity:.9,weight:2}})]})]}),e.jsxs("div",{className:"absolute bottom-3 right-3 bg-white/95 dark:bg-black/85 backdrop-blur-md p-2.5 rounded-xl shadow-lg z-[400] border border-gray-100 dark:border-gray-700 flex flex-col items-end min-w-[120px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${s.loading?"animate-ping":""} shadow-sm`,style:{backgroundColor:s.isValid?s.densityColor:"gray"}}),e.jsx("div",{className:"text-xs font-extrabold text-gray-700 dark:text-gray-100 leading-none",children:s.loading?"Scanning...":s.isValid?`${s.userCount} Nearby`:"Enter Zip"})]}),s.isValid&&!s.loading&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wider",children:s.regionLabel}),e.jsx("span",{className:"text-[9px] text-gray-400 font-normal truncate max-w-[140px]",children:s.locationName})]})]})]})}function Ys({darkMode:t,toggleTheme:s,user:a,onSuccess:i}){const[l,n]=r.useState(1),[o,p]=r.useState("login"),[x,b]=r.useState(!1),[m,h]=r.useState(!1),[d,v]=r.useState({email:"",password:"",firstName:"",lastName:"",zip:"",roles:[]}),[u,g]=r.useState(""),[y,c]=r.useState(!1),[k,N]=r.useState("auto"),[f,S]=r.useState(!1),[j,C]=r.useState(!1),R=r.useRef(null),[E,w]=r.useState(!1),[z,A]=r.useState(""),[q,G]=r.useState([]),[H,J]=r.useState(null),[M,L]=r.useState(""),[_,B]=r.useState(""),[U,Q]=r.useState(""),[xe,ye]=r.useState(null),[pe,ce]=r.useState(null),he=Qt.filter($=>!li.includes($)),ue=()=>o==="signup"?"Create your Account":o==="forgot"?"Password Recovery":o==="onboarding"?"Finalize Setup":null;r.useEffect(()=>{if(a){p("onboarding"),n(1);const $=a.displayName?a.displayName.split(" "):["User",""];v(T=>({...T,email:a.email,firstName:$[0]||"",lastName:$.slice(1).join(" ")||""})),h(!1)}else p("login"),n(1),v({email:"",password:"",firstName:"",lastName:"",zip:"",roles:[]})},[a]);const[fe,O]=r.useState({hasUpper:!1,hasLower:!1,hasNumber:!1,isLength:!1});r.useEffect(()=>{const $=d.password;O({hasUpper:/[A-Z]/.test($),hasLower:/[a-z]/.test($),hasNumber:/[0-9]/.test($),isLength:$.length>=6})},[d.password]);const ie=Object.values(fe).every(Boolean);r.useEffect(()=>{if(!R.current)return;const $=new ResizeObserver(()=>{if(R.current){const T=R.current.scrollHeight+80;T>200&&N(`${T}px`)}});return $.observe(R.current),()=>$.disconnect()},[l,o,u,y,d.zip,E,q,xe]),r.useEffect(()=>{g("")},[l]);const ne=async()=>{if(!d.email||!d.password)return g("Please fill in all fields.");h(!0);try{await al(Nt,d.email,d.password)}catch{g("Invalid email or password."),h(!1)}},V=async()=>{g(""),h(!0);try{const $=new rl;$.setCustomParameters({prompt:"select_account"}),await ll(Nt,$)}catch($){console.error("Google Sign-In Error:",$),g($.message),h(!1)}},ae=async()=>{if(o==="signup"&&!ie)return g("Password requirements not met.");h(!0);try{let $;o==="onboarding"&&a?$=a.uid:$=(await il(Nt,d.email,d.password)).user.uid;let T=d.roles.length>0?d.roles:["Fan"];if(pe&&!T.includes("Student")&&T.push("Student"),pe){await ct(pe.ref);const be=pe.data();await Oe(W(P,`schools/${H.id}/students`,$),{...be,uid:$,email:d.email,status:"Active"})}const se={firstName:d.firstName,lastName:d.lastName,zip:d.zip,accountTypes:T,activeProfileRole:T[0],schoolId:(H==null?void 0:H.id)||null,studentId:M||null,createdAt:X(),email:d.email,photoURL:(a==null?void 0:a.photoURL)||null};await Promise.all([Oe(W(P,Z($).userProfile),se,{merge:!0}),Oe(W(P,Z($).userPublicProfile),{...se,uid:$,searchTerms:[d.firstName.toLowerCase(),d.lastName.toLowerCase(),d.zip,...T.map(be=>be.toLowerCase())]},{merge:!0}),Oe(W(P,Z($).userWallet),{balance:0,createdAt:X()},{merge:!0})]),i&&i()}catch($){g($.message.replace("Firebase: ","").replace("auth/","")),h(!1)}},ve=async()=>{if(!d.email)return g("Enter email address.");h(!0);try{await nl(Nt,d.email),c(!0),g("")}catch($){g($.message)}h(!1)},Xe=()=>{if(!navigator.geolocation)return g("Geolocation not supported.");S(!0),navigator.geolocation.getCurrentPosition(async $=>{try{const se=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${$.coords.latitude}&lon=${$.coords.longitude}`)).json();se.address.postcode?v(be=>({...be,zip:se.address.postcode.split("-")[0]})):g("Could not determine Zip Code.")}catch{g("Failed to find location.")}S(!1)},()=>{g("Location permission denied."),S(!1)})};r.useEffect(()=>{if(z.length<2){G([]);return}const $=setTimeout(async()=>{const T=me(D(P,"schools"),we("name",">=",z),we("name","<=",z+"")),se=await He(T);G(se.docs.map(be=>({id:be.id,...be.data()})))},300);return()=>clearTimeout($)},[z]);const Ye=async()=>{if(!H||!M||!_)return g("All fields required.");h(!0);try{const $=me(D(P,`schools/${H.id}/students`),we("studentId","==",M)),T=await He($);if(T.empty){g("Student ID not found in this school's roster."),h(!1);return}const se=T.docs[0].data();if(se.email.toLowerCase()!==_.toLowerCase()){g("Email provided does not match the student record."),h(!1);return}v(os=>({...os,firstName:se.firstName||se.displayName.split(" ")[0],lastName:se.lastName||se.displayName.split(" ").slice(1).join(" ")}));const be=Math.floor(1e5+Math.random()*9e5).toString();console.log("MOCK AUTH CODE SENT:",be),ye(be),ce(T.docs[0]),alert(`Code sent to ${_}. (Dev: ${be})`),h(!1)}catch($){console.error($),g("Verification failed."),h(!1)}},de=()=>{U===xe?(v($=>({...$,roles:[...$.roles,"Student"]})),n(5)):g("Invalid authorization code.")},F=($,T)=>{$.key==="Enter"&&T()},Y=({met:$,text:T})=>e.jsxs("div",{className:`flex items-center gap-1.5 text-xs transition-colors ${$?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"}`,children:[$?e.jsx(Je,{size:12,strokeWidth:3}):e.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-300 dark:border-gray-600"}),T]});return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 transition-colors duration-500 relative overflow-hidden",children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:0},children:e.jsx(ri,{onImagesLoaded:b})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-900 dark:to-black transition-opacity duration-1000",style:{zIndex:0,opacity:x?0:1,pointerEvents:x?"none":"auto"}}),e.jsx("div",{className:"absolute top-6 right-6 z-20",children:e.jsx("button",{onClick:s,className:"p-3 rounded-full bg-white/80 dark:bg-black/50 backdrop-blur-md border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:scale-110 transition-transform shadow-sm",children:t?e.jsx(js,{size:20}):e.jsx(At,{size:20})})}),e.jsx("div",{className:"bg-white/95 dark:bg-dark-card/95 dark:border dark:border-gray-700 rounded-3xl shadow-2xl w-full max-w-md relative overflow-hidden transition-[height] duration-500 z-10 backdrop-blur-md",style:{height:k,minHeight:"500px"},children:e.jsxs("div",{ref:R,className:"pt-12 px-8 pb-8",children:[e.jsxs("div",{className:"relative w-full h-48 mb-6 flex justify-center shrink-0",children:[e.jsx("div",{className:`absolute transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)] ${o==="signup"||o==="onboarding"?"top-0 scale-90":"top-8 scale-100"} z-0`,children:e.jsx("div",{className:`w-96 h-40 ${o==="signup"||o==="onboarding"?"":"animate-float"}`,children:e.jsx("img",{src:t?Ia:$a,alt:"SeshNx",className:"w-full h-full object-contain drop-shadow-md"})})}),e.jsx("div",{className:"absolute bottom-2 w-full text-center z-10 pointer-events-none",children:ue()&&e.jsx("p",{className:"text-sm font-bold text-gray-500 dark:text-gray-300 uppercase tracking-wider animate-pulse transition-opacity duration-300",children:ue()})})]}),u&&e.jsxs("div",{className:"absolute top-4 left-0 right-0 mx-8 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-300 p-3 rounded-xl text-sm flex items-center gap-2 animate-in fade-in slide-in-from-top-2 z-30 border border-red-100 dark:border-red-800/30",children:[e.jsx(Fe,{size:16}),e.jsx("span",{className:"capitalize font-medium",children:u})]}),y&&e.jsxs("div",{className:"absolute top-4 left-0 right-0 mx-8 bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-300 p-3 rounded-xl text-sm flex items-center gap-2 animate-in fade-in slide-in-from-top-2 z-30 border border-green-100 dark:border-green-800/30",children:[e.jsx(Je,{size:16}),e.jsx("span",{children:"Check your email."})]}),e.jsxs("div",{className:"animate-in fade-in slide-in-from-right-4 duration-500 fill-mode-forwards",children:[o==="login"&&e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all",placeholder:"Email Address",type:"email",value:d.email,onChange:$=>v({...d,email:$.target.value}),onKeyDown:$=>F($,ne),disabled:m}),e.jsx("input",{className:"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all",type:"password",placeholder:"Password",value:d.password,onChange:$=>v({...d,password:$.target.value}),onKeyDown:$=>F($,ne),disabled:m})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>p("forgot"),className:"text-xs text-gray-500 hover:text-brand-blue font-medium transition-colors",children:"Forgot Password?"})}),e.jsx("button",{className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 transition-all shadow-lg flex justify-center disabled:opacity-70",onClick:ne,disabled:m,children:m?e.jsx(K,{className:"animate-spin"}):"Sign In"}),e.jsxs("button",{onClick:V,className:"w-full bg-white dark:bg-transparent border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white py-3.5 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-800 transition-all flex justify-center items-center gap-2",disabled:m,children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Continue with Google"]}),e.jsxs("div",{className:"relative py-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white dark:bg-dark-card text-gray-500",children:"or"})})]}),e.jsx("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400 cursor-pointer hover:text-brand-blue font-medium transition-colors pt-2",onClick:()=>p("signup"),children:"New here? Create an Account"})]}),o==="forgot"&&e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center mb-2",children:"Enter your email to receive reset instructions."}),e.jsx("input",{className:"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all",placeholder:"Email Address",type:"email",value:d.email,onChange:$=>v({...d,email:$.target.value}),onKeyDown:$=>F($,ve),disabled:m||y}),e.jsx("button",{className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 transition-all flex justify-center items-center gap-2 disabled:opacity-50",onClick:ve,disabled:m||y,children:m?e.jsx(K,{className:"animate-spin"}):y?"Sent!":"Send Reset Link"}),e.jsx("button",{className:"w-full text-gray-500 text-sm hover:text-gray-800 dark:hover:text-gray-200 mt-2",onClick:()=>p("login"),children:"Back to Login"})]}),(o==="signup"||o==="onboarding")&&e.jsxs("div",{className:"w-full",children:[l===1&&e.jsx("div",{className:"space-y-4 animate-in fade-in slide-in-from-right-8 duration-500",children:o==="signup"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all",placeholder:"Email Address",type:"email",value:d.email,onChange:$=>v({...d,email:$.target.value}),disabled:m}),e.jsx("input",{className:`w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border ${!ie&&d.password?"border-red-300 focus:ring-red-200":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"} rounded-xl focus:ring-2 outline-none dark:text-white transition-all`,type:"password",placeholder:"Create Password",value:d.password,onChange:$=>v({...d,password:$.target.value}),disabled:m})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 pl-1",children:[e.jsx(Y,{met:fe.hasUpper,text:"Uppercase Letter"}),e.jsx(Y,{met:fe.hasLower,text:"Lowercase Letter"}),e.jsx(Y,{met:fe.hasNumber,text:"Number (0-9)"}),e.jsx(Y,{met:fe.isLength,text:"6+ Characters"})]})}),e.jsx("button",{className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 transition-all shadow-lg flex justify-center disabled:opacity-50",onClick:()=>{if(!d.email)return g("Email required");if(!ie)return g("Fix password issues");n(2)},disabled:m||!ie||!d.email,children:"Continue"}),e.jsxs("button",{onClick:V,className:"w-full bg-white dark:bg-transparent border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white py-3.5 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-800 transition-all flex justify-center items-center gap-2",disabled:m,children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Continue with Google"]}),e.jsxs("div",{className:"relative py-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white dark:bg-dark-card text-gray-500",children:"or"})})]}),e.jsx("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400 cursor-pointer hover:text-brand-blue font-medium transition-colors pt-2",onClick:()=>p("login"),children:"Already have an account? Log In"})]}):e.jsxs("div",{className:"space-y-6 text-center",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-gray-100 dark:bg-gray-800 p-1 border-2 border-brand-blue shadow-lg overflow-hidden",children:a!=null&&a.photoURL?e.jsx("img",{src:a.photoURL,alt:"Profile",className:"w-full h-full object-cover rounded-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-brand-blue",children:e.jsx(Le,{size:40})})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold dark:text-white",children:["Welcome, ",d.firstName,"!"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm mt-1",children:"Let's finish setting up your creative profile."})]}),e.jsx("button",{className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 transition-all shadow-lg flex justify-center",onClick:()=>n(2),children:"Let's Go"})]})}),l===2&&e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{className:"w-1/2 p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white",placeholder:"First Name",value:d.firstName,onChange:$=>v({...d,firstName:$.target.value}),autoFocus:!0}),e.jsx("input",{className:"w-1/2 p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white",placeholder:"Last Name",value:d.lastName,onChange:$=>v({...d,lastName:$.target.value})})]}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{className:"w-full p-3.5 pl-10 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white",placeholder:"Zip Code",maxLength:5,value:d.zip,onChange:$=>v({...d,zip:$.target.value.replace(/\D/g,"")})}),e.jsx(Te,{className:"absolute left-3 top-3.5 text-gray-400",size:18})]}),e.jsx("button",{onClick:Xe,className:"p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 text-brand-blue transition-colors",children:f?e.jsx(K,{size:20,className:"animate-spin"}):e.jsx(ua,{size:20})})]}),e.jsx(ni,{zip:d.zip}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-3 rounded-xl border dark:border-gray-700 flex items-center gap-3 cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-[#2a2d36]",onClick:()=>w(!E),children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center transition-colors ${E?"bg-brand-blue border-brand-blue":"border-gray-400"}`,children:E&&e.jsx(Je,{size:12,className:"text-white",strokeWidth:3})}),e.jsx("span",{className:"text-sm font-bold dark:text-white flex-1",children:"Are you a student?"}),e.jsx(Os,{size:18,className:E?"text-brand-blue":"text-gray-400"})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsxs("button",{className:`text-gray-500 flex items-center gap-1 text-sm font-medium ${o==="onboarding"?"opacity-0 pointer-events-none":""}`,onClick:()=>n(1),children:[e.jsx(es,{size:16})," Back"]}),e.jsx("button",{className:"bg-gray-900 dark:bg-white dark:text-black text-white px-6 py-2.5 rounded-xl font-bold transition-transform active:scale-95",onClick:()=>{d.firstName&&d.zip?n(E?3:5):g("Info required")},children:"Next Step"})]})]}),l===3&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg mb-2",children:"Find your School"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Search for your institution to link your enrollment."})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",placeholder:"Search School Name...",value:z,onChange:$=>A($.target.value),autoFocus:!0}),q.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-xl max-h-48 overflow-y-auto p-1",children:q.map($=>e.jsxs("div",{onClick:()=>{J($),n(4)},className:"p-3 hover:bg-gray-50 dark:hover:bg-white/10 cursor-pointer rounded-lg flex items-center gap-3 transition",children:[e.jsx("div",{className:"h-8 w-8 bg-gray-200 dark:bg-gray-700 rounded flex items-center justify-center text-gray-500",children:e.jsx(Os,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white text-sm",children:$.name}),e.jsx("div",{className:"text-xs text-gray-500",children:$.city||"Location N/A"})]})]},$.id))})]}),e.jsx("button",{className:"w-full text-gray-400 text-sm hover:text-gray-600",onClick:()=>n(2),children:"Back"})]}),l===4&&H&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:H.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Verify your enrollment"})]}),xe?e.jsxs("div",{className:"space-y-4 text-center animate-in fade-in",children:[e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-3 rounded-lg border border-green-100 dark:border-green-800",children:e.jsxs("p",{className:"text-xs text-green-700 dark:text-green-400",children:["Code sent to ",_]})}),e.jsxs("div",{className:"relative",children:[e.jsx(Vt,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white text-center font-mono tracking-widest text-lg",placeholder:"000000",maxLength:6,value:U,onChange:$=>Q($.target.value)})]}),e.jsx("button",{onClick:de,className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 transition",children:"Confirm Code"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Student ID Number",value:M,onChange:$=>L($.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ht,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"School Email Address",value:_,onChange:$=>B($.target.value)})]}),e.jsx("button",{onClick:Ye,disabled:m,className:"w-full bg-brand-blue text-white py-3 rounded-xl font-bold hover:bg-blue-600 transition",children:m?"Verifying...":"Verify & Send Code"})]}),e.jsx("button",{className:"w-full text-gray-400 text-sm hover:text-gray-600",onClick:()=>n(3),children:"Change School"})]}),l===5&&e.jsxs("div",{className:"space-y-5 animate-in fade-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-bold dark:text-white",children:"Select Additional Roles"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"You can change these later."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5 h-auto",children:he.map($=>e.jsxs("div",{onClick:()=>{const T=d.roles.includes($)?d.roles.filter(se=>se!==$):[...d.roles,$];v({...d,roles:T})},className:`relative p-3 border-2 rounded-xl cursor-pointer text-sm font-bold text-center transition-colors duration-200 select-none ${d.roles.includes($)?"bg-blue-50 border-brand-blue text-brand-blue dark:bg-blue-900/20 dark:border-blue-500 dark:text-blue-300 shadow-sm":"bg-white border-gray-100 text-gray-500 hover:border-gray-300 dark:bg-[#1f2128] dark:border-gray-700 dark:text-gray-400"}`,children:[$,d.roles.includes($)&&e.jsx("div",{className:"absolute top-1 right-1 text-brand-blue",children:e.jsx(Je,{size:10,strokeWidth:4})})]},$))}),e.jsxs("p",{className:"text-[10px] text-gray-400 text-center px-4 leading-tight",children:["By completing setup, you agree to our ",e.jsx("button",{onClick:()=>C(!0),className:"underline hover:text-brand-blue mx-1",children:"Terms of Service"})," and ",e.jsx("button",{onClick:()=>C(!0),className:"underline hover:text-brand-blue mx-1",children:"Privacy Policy"}),"."]}),e.jsx("button",{className:"w-full bg-green-600 text-white py-3.5 rounded-xl font-bold mt-2 hover:bg-green-700 transition-colors flex justify-center items-center gap-2 disabled:opacity-50",onClick:ae,disabled:m,children:m?e.jsx(K,{className:"animate-spin"}):"Complete Setup"}),e.jsx("button",{className:"w-full text-gray-400 text-xs hover:text-gray-600 transition-colors",onClick:()=>n(2),children:"Back to Personal Info"})]})]})]},o)]})}),e.jsx("div",{className:"absolute bottom-6 z-20",children:e.jsxs("button",{onClick:()=>C(!0),className:"text-xs text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 transition-colors flex items-center gap-2 opacity-80 hover:opacity-100 backdrop-blur-sm px-3 py-1.5 rounded-full",children:[e.jsx(Wt,{size:14})," Legal Center & Terms"]})}),j&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col border border-gray-200 dark:border-gray-700 relative animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(Wt,{size:20,className:"text-brand-blue"})," Legal Center"]}),e.jsx("button",{onClick:()=>C(!1),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(le,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto relative",children:e.jsx(Fa,{isEmbedded:!0})})]})})]})}function oi({rating:t=0,setRating:s,interactive:a=!1,size:i=16}){const[l,n]=r.useState(0);return e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(o=>e.jsx(ze,{size:i,className:`transition-colors ${a?"cursor-pointer":""} ${(a&&l||t)>=o?"fill-yellow-400 text-yellow-400":"text-gray-300 dark:text-gray-600"}`,fill:(a&&l||t)>=o?"currentColor":"none",onMouseEnter:()=>a&&n(o),onMouseLeave:()=>a&&n(0),onClick:()=>a&&s(o)},o))})}function Oa(t,s){const[a,i]=r.useState([]),[l,n]=r.useState([]),[o,p]=r.useState({followersCount:0,followingCount:0}),[x,b]=r.useState(!0);r.useEffect(()=>{if(!t){b(!1);return}const y=D(P,Z(t).following),c=D(P,Z(t).followers),k=W(P,Z(t).socialStats),N=ge(me(y,Re("timestamp","desc")),j=>{const C=j.docs.map(R=>({odId:R.id,...R.data()}));i(C)},j=>console.error("Following listener error:",j)),f=ge(me(c,Re("timestamp","desc")),j=>{const C=j.docs.map(R=>({odId:R.id,...R.data()}));n(C)},j=>console.error("Followers listener error:",j)),S=ge(k,j=>{j.exists()&&p(j.data()),b(!1)});return()=>{N(),f(),S()}},[t]);const m=r.useCallback(y=>a.some(c=>c.odId===y),[a]),h=r.useCallback(async(y,c)=>{if(!t||!y||t===y)return;const k=$t(P),N=W(P,Z(t).following,y);k.set(N,{displayName:(c==null?void 0:c.displayName)||(c==null?void 0:c.firstName)||"User",photoURL:(c==null?void 0:c.photoURL)||null,role:(c==null?void 0:c.activeProfileRole)||"User",timestamp:X()});const f=W(P,Z(y).followers,t);k.set(f,{displayName:(s==null?void 0:s.displayName)||`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"User",photoURL:(s==null?void 0:s.photoURL)||null,role:(s==null?void 0:s.activeProfileRole)||"User",timestamp:X()});const S=W(P,Z(t).socialStats);k.set(S,{followingCount:Ke(1)},{merge:!0});const j=W(P,Z(y).socialStats);k.set(j,{followersCount:Ke(1)},{merge:!0});const C=W(D(P,Z(y).notifications));k.set(C,{type:"follow",fromUserId:t,fromUserName:(s==null?void 0:s.displayName)||`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"Someone",fromUserPhoto:(s==null?void 0:s.photoURL)||null,message:"started following you",read:!1,timestamp:X()});try{return await k.commit(),{success:!0}}catch(R){return console.error("Follow error:",R),{success:!1,error:R}}},[t,s]),d=r.useCallback(async y=>{if(!t||!y)return;const c=$t(P),k=W(P,Z(t).following,y);c.delete(k);const N=W(P,Z(y).followers,t);c.delete(N);const f=W(P,Z(t).socialStats);c.set(f,{followingCount:Ke(-1)},{merge:!0});const S=W(P,Z(y).socialStats);c.set(S,{followersCount:Ke(-1)},{merge:!0});try{return await c.commit(),{success:!0}}catch(j){return console.error("Unfollow error:",j),{success:!1,error:j}}},[t]),v=r.useCallback(async(y,c)=>m(y)?d(y):h(y,c),[m,h,d]),u=r.useCallback(async y=>{try{const c=await Be(W(P,Z(y).socialStats));return c.exists()?c.data():{followersCount:0,followingCount:0}}catch(c){return console.error("Get stats error:",c),{followersCount:0,followingCount:0}}},[]),g=r.useCallback(()=>a.map(y=>y.odId),[a]);return{following:a,followers:l,stats:o,loading:x,isFollowing:m,followUser:h,unfollowUser:d,toggleFollow:v,getUserStats:u,getFollowingIds:g}}function di(t){const[s,a]=r.useState({followersCount:0,followingCount:0}),[i,l]=r.useState(!0);return r.useEffect(()=>{if(!t){l(!1);return}const n=W(P,Z(t).socialStats),o=ge(n,p=>{p.exists()&&a(p.data()),l(!1)});return()=>o()},[t]),{stats:s,loading:i}}function zs({isFollowing:t,onToggle:s,size:a="md",variant:i="default",disabled:l=!1,showIcon:n=!0,className:o=""}){const[p,x]=r.useState(!1),[b,m]=r.useState(!1),h=async k=>{if(k.stopPropagation(),!(l||p)){x(!0);try{await s()}catch(N){console.error("Follow toggle error:",N)}x(!1)}},d={sm:"px-3 py-1 text-xs",md:"px-4 py-1.5 text-sm",lg:"px-6 py-2 text-base"},v={sm:12,md:14,lg:16},u=()=>t?i==="outline"||i==="minimal"?b?"border-red-300 text-red-500 hover:bg-red-50 dark:border-red-800 dark:hover:bg-red-900/20":"border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300":b?"bg-red-500 text-white hover:bg-red-600":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200":i==="outline"?"border-brand-blue text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20":i==="minimal"?"text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20":"bg-brand-blue text-white hover:bg-blue-600",g=`
        font-semibold rounded-full transition-all duration-200 
        flex items-center justify-center gap-1.5
        disabled:opacity-50 disabled:cursor-not-allowed
        ${i==="outline"?"border-2 bg-transparent":""}
        ${i==="minimal"?"bg-transparent":""}
        ${d[a]}
        ${u()}
        ${o}
    `,y=()=>p?e.jsx(K,{className:"animate-spin",size:v[a]}):t?b?e.jsx(gr,{size:v[a]}):e.jsx(bs,{size:v[a]}):e.jsx(wt,{size:v[a]}),c=()=>t?b?"Unfollow":"Following":"Follow";return e.jsx(Ne.button,{whileHover:{scale:l?1:1.02},whileTap:{scale:l?1:.98},className:g,onClick:h,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),disabled:l||p,children:e.jsx(nt,{mode:"wait",children:e.jsxs(Ne.span,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},transition:{duration:.15},className:"flex items-center gap-1.5",children:[n&&y(),e.jsx("span",{children:c()})]},`${t}-${b}`)})})}const Ze={FOLLOWERS:"followers",FOLLOWING:"following"};function ci({userId:t,userName:s,initialTab:a=Ze.FOLLOWERS,currentUser:i,currentUserData:l,isFollowing:n,toggleFollow:o,onClose:p,openPublicProfile:x}){const[b,m]=r.useState(a),[h,d]=r.useState([]),[v,u]=r.useState([]),[g,y]=r.useState(!0),[c,k]=r.useState("");r.useEffect(()=>{if(!t)return;y(!0);const R=D(P,Z(t).followers),E=me(R,Re("timestamp","desc"),Qe(100)),w=ge(E,z=>{const A=z.docs.map(q=>({odId:q.id,userId:q.id,...q.data()}));d(A),y(!1)},z=>{console.error("Followers fetch error:",z),y(!1)});return()=>w()},[t]),r.useEffect(()=>{if(!t)return;const R=D(P,Z(t).following),E=me(R,Re("timestamp","desc"),Qe(100)),w=ge(E,z=>{const A=z.docs.map(q=>({odId:q.id,userId:q.id,...q.data()}));u(A)},z=>{console.error("Following fetch error:",z)});return()=>w()},[t]);const N=b===Ze.FOLLOWERS?h:v,f=c.trim()?N.filter(R=>{var E;return(E=R.displayName)==null?void 0:E.toLowerCase().includes(c.toLowerCase())}):N,S=t===(i==null?void 0:i.uid),j=R=>{x&&(x(R),p())},C=async R=>{o&&await o(R.userId,{displayName:R.displayName,photoURL:R.photoURL,role:R.role})};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs(Ne.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:s||"User"}),e.jsx("button",{onClick:p,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-xl p-1",children:[e.jsxs("button",{onClick:()=>m(Ze.FOLLOWERS),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-all ${b===Ze.FOLLOWERS?"bg-white dark:bg-gray-700 shadow-sm text-brand-blue":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:[e.jsx(_e,{size:16}),e.jsx("span",{children:"Followers"}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${b===Ze.FOLLOWERS?"bg-brand-blue/10 text-brand-blue":"bg-gray-200 dark:bg-gray-600"}`,children:h.length})]}),e.jsxs("button",{onClick:()=>m(Ze.FOLLOWING),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-all ${b===Ze.FOLLOWING?"bg-white dark:bg-gray-700 shadow-sm text-brand-blue":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:[e.jsx(bs,{size:16}),e.jsx("span",{children:"Following"}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${b===Ze.FOLLOWING?"bg-brand-blue/10 text-brand-blue":"bg-gray-200 dark:bg-gray-600"}`,children:v.length})]})]})]}),N.length>5&&e.jsx("div",{className:"px-4 py-3 border-b dark:border-gray-700 shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search...",value:c,onChange:R=>k(R.target.value),className:"w-full pl-9 pr-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white transition"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:g?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(K,{className:"animate-spin text-brand-blue mb-2",size:28}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading..."})]}):f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4",children:b===Ze.FOLLOWERS?e.jsx(_e,{size:24,className:"text-gray-400"}):e.jsx(bs,{size:24,className:"text-gray-400"})}),e.jsx("p",{className:"text-gray-500 text-center",children:c?`No results for "${c}"`:b===Ze.FOLLOWERS?S?"You don't have any followers yet":"No followers yet":S?"You're not following anyone yet":"Not following anyone yet"}),!c&&b===Ze.FOLLOWING&&S&&e.jsx("p",{className:"text-xs text-gray-400 mt-2 text-center",children:"Find artists and creators to follow in the feed!"})]}):e.jsx(nt,{mode:"popLayout",children:f.map((R,E)=>e.jsx(xi,{user:R,index:E,currentUserId:i==null?void 0:i.uid,isFollowingUser:n==null?void 0:n(R.userId),onToggleFollow:()=>C(R),onUserClick:()=>j(R.userId)},R.userId))})})]})})}function xi({user:t,index:s,currentUserId:a,isFollowingUser:i,onToggleFollow:l,onUserClick:n}){const o=t.userId===a;return e.jsxs(Ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:-10},transition:{delay:s*.03},className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition border-b dark:border-gray-700/50 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 cursor-pointer",onClick:n,children:[e.jsx(kt,{src:t.photoURL,name:t.displayName,size:"md"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm dark:text-white truncate hover:text-brand-blue transition",children:t.displayName}),t.role&&e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.role})]})]}),!o&&e.jsx(zs,{isFollowing:i,onToggle:l,size:"sm",variant:"outline"}),o&&e.jsx("span",{className:"text-xs text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded-full",children:"You"})]})}function gi({followersCount:t=0,followingCount:s=0,onFollowersClick:a,onFollowingClick:i,size:l="md"}){const n={sm:"text-xs gap-3",md:"text-sm gap-4",lg:"text-base gap-5"},o={sm:"text-sm",md:"text-base",lg:"text-lg"};return e.jsxs("div",{className:`flex items-center ${n[l]}`,children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-1 hover:text-brand-blue transition group",children:[e.jsx("span",{className:`font-bold dark:text-white group-hover:text-brand-blue ${o[l]}`,children:t.toLocaleString()}),e.jsx("span",{className:"text-gray-500",children:t===1?"Follower":"Followers"})]}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"•"}),e.jsxs("button",{onClick:i,className:"flex items-center gap-1 hover:text-brand-blue transition group",children:[e.jsx("span",{className:`font-bold dark:text-white group-hover:text-brand-blue ${o[l]}`,children:s.toLocaleString()}),e.jsx("span",{className:"text-gray-500",children:"Following"})]})]})}function ui({userId:t,currentUser:s,currentUserData:a,onClose:i,onMessage:l}){var w,z,A,q,G;const[n,o]=r.useState(null),[p,x]=r.useState(!0),[b,m]=r.useState(null),[h,d]=r.useState(!1),[v,u]=r.useState(!1),[g,y]=r.useState("followers"),c=(s==null?void 0:s.uid)===t,{uploadImage:k}=Ra(),{isFollowing:N,toggleFollow:f}=Oa(s==null?void 0:s.uid,a),{stats:S}=di(t),j=(H="followers")=>{y(H),u(!0)},C=async()=>{try{const H=W(P,Z(t).userPublicProfile),J=await Be(H);if(J.exists())o(J.data());else{const M=W(P,Z(t).userProfile),L=await Be(M);L.exists()?o(L.data()):m("Profile not found or is private.")}}catch(H){console.error("Failed to load profile:",H),m("Unable to load profile. Please try again later.")}finally{x(!1)}};r.useEffect(()=>{t&&C()},[t]);const R=async H=>{const J=H.target.files[0];if(!(!J||!c)){d(!0);try{const M=await k(J,`artifacts/${t}/images/banners`);M&&(await te(W(P,Z(t).userPublicProfile),{bannerURL:M}),o(L=>({...L,bannerURL:M})))}catch(M){console.error("Banner upload failed:",M),alert("Failed to upload banner.")}d(!1)}};if(!t)return null;const E=()=>e.jsxs("div",{className:"p-8 flex flex-col items-center space-y-6 animate-pulse",children:[e.jsx("div",{className:"h-40 w-full bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-28 w-28 bg-gray-300 dark:bg-gray-600 rounded-full -mt-20 border-4 border-white dark:border-dark-card"}),e.jsx("div",{className:"h-6 w-1/2 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 w-1/3 bg-gray-200 dark:bg-gray-700 rounded"})]});return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] border border-gray-200 dark:border-gray-700",onClick:H=>H.stopPropagation(),children:[e.jsx("button",{onClick:i,className:"absolute top-4 right-4 z-30 p-2 bg-black/30 hover:bg-black/50 text-white rounded-full transition-colors backdrop-blur-md",children:e.jsx(le,{size:20})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative",children:p?e.jsx(E,{}):b||!n?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-12 text-gray-500",children:[e.jsx(at,{size:48,className:"text-yellow-500 mb-4 opacity-80"}),e.jsx("h3",{className:"text-xl font-bold dark:text-gray-200 mb-2",children:"Profile Unavailable"}),e.jsx("p",{className:"text-sm text-center max-w-xs",children:b||"This user's profile information could not be retrieved."}),e.jsx("button",{onClick:i,className:"mt-6 px-6 py-2 bg-gray-200 dark:bg-gray-700 rounded-full font-bold text-sm hover:bg-gray-300 transition",children:"Close"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-48 relative bg-gray-800 group",children:[n.bannerURL?e.jsx("img",{src:n.bannerURL,alt:"Cover",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-r from-brand-blue to-purple-600",children:e.jsx("div",{className:"absolute inset-0 opacity-30 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"})}),c&&e.jsxs("label",{className:"absolute top-4 left-4 cursor-pointer bg-black/40 hover:bg-black/60 text-white px-3 py-1.5 rounded-lg text-xs font-bold backdrop-blur-md transition-all flex items-center gap-2 border border-white/10",children:[h?e.jsx(K,{size:14,className:"animate-spin"}):e.jsx(ut,{size:14}),h?"Uploading...":"Edit Cover",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:R,disabled:h})]}),e.jsxs("div",{className:"absolute bottom-4 right-6 flex gap-3 opacity-90",children:[n.rate>0&&e.jsxs("span",{className:"bg-black/60 backdrop-blur-md text-white text-xs font-bold px-3 py-1 rounded-full border border-white/10 flex items-center gap-1 shadow-sm",children:[e.jsx(Ce,{size:12})," $",n.rate,"/hr"]}),n.city&&e.jsxs("span",{className:"bg-black/60 backdrop-blur-md text-white text-xs font-bold px-3 py-1 rounded-full border border-white/10 flex items-center gap-1 shadow-sm",children:[e.jsx(Te,{size:12})," ",n.city,", ",n.state]})]})]}),e.jsxs("div",{className:"px-8 pb-8 relative",children:[e.jsxs("div",{className:"flex justify-between items-end -mt-14 mb-6",children:[e.jsx("div",{className:"relative z-10 group",children:e.jsx("div",{className:"h-32 w-32 rounded-full border-[5px] border-white dark:border-[#1f2128] bg-gray-200 dark:bg-gray-700 overflow-hidden shadow-xl",children:n.photoURL?e.jsx("img",{src:n.photoURL,alt:"Profile",className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400",children:e.jsx(Le,{size:48})})})}),s&&!c&&e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(zs,{isFollowing:N(t),onToggle:()=>{var H;return f(t,{displayName:`${n.firstName||""} ${n.lastName||""}`.trim(),photoURL:n.photoURL,role:((H=n.accountTypes)==null?void 0:H[0])||"User"})},size:"md"}),e.jsxs("button",{onClick:()=>l(t,`${n.firstName} ${n.lastName}`),className:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 px-5 py-2.5 rounded-xl font-bold text-sm hover:bg-gray-200 dark:hover:bg-gray-700 transition flex items-center gap-2 border dark:border-gray-700",children:[e.jsx(pt,{size:18})," Message"]})]}),c&&e.jsx("div",{className:"mb-2 px-3 py-1.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-bold rounded-lg border border-green-200 dark:border-green-800",children:"Public View Mode"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-extrabold dark:text-white flex items-center gap-2 mb-2",children:[n.firstName||"User"," ",n.lastName||"",n.isVerified&&e.jsx(Ie,{size:22,className:"text-blue-500 fill-blue-500 text-white"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-gray-500 dark:text-gray-400 font-medium mb-4",children:(n.accountTypes||["Creative"]).map((H,J)=>e.jsx("span",{className:"flex items-center gap-1 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full text-xs font-bold",children:H},J))}),e.jsx(gi,{followersCount:S.followersCount||0,followingCount:S.followingCount||0,onFollowersClick:()=>j("followers"),onFollowingClick:()=>j("following"),size:"md"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 py-6 border-y dark:border-gray-800 mb-8",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:"Rating"}),e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-1",children:[e.jsx("span",{className:"text-xl font-bold dark:text-white",children:n.rating||"New"}),n.rating>0&&e.jsx(oi,{rating:n.rating,size:14})]})]}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:"Experience"}),e.jsxs("div",{className:"text-xl font-bold dark:text-white",children:[n.yearsExp||"1+"," ",e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Yrs"})]})]}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:"Response"}),e.jsxs("div",{className:"text-xl font-bold dark:text-white",children:["~1 ",e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Hr"})]})]}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:"Bookings"}),e.jsx("div",{className:"text-xl font-bold dark:text-white",children:n.completedJobs||0})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(Le,{size:14})," About"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-[#252830] p-5 rounded-xl border dark:border-gray-800",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed text-sm whitespace-pre-line",children:n.bio||"No biography provided yet."})})]}),(((w=n.genres)==null?void 0:w.length)>0||((z=n.instruments)==null?void 0:z.length)>0)&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(mt,{size:14})," Sound Profile"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(A=n.genres)==null?void 0:A.map(H=>e.jsx("span",{className:"px-3 py-1.5 bg-purple-50 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300 rounded-lg text-xs font-bold border border-purple-100 dark:border-purple-800",children:H},H)),(q=n.instruments)==null?void 0:q.map(H=>e.jsx("span",{className:"px-3 py-1.5 bg-blue-50 dark:bg-blue-900/20 text-brand-blue dark:text-blue-300 rounded-lg text-xs font-bold border border-blue-100 dark:border-blue-800",children:H},H))]})]}),((G=n.equipmentList)==null?void 0:G.length)>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(ot,{size:14})," Select Gear"]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#252830] rounded-xl p-4 border dark:border-gray-800",children:[e.jsx("ul",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-600 dark:text-gray-400",children:n.equipmentList.slice(0,10).map((H,J)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(re,{size:14,className:"text-brand-blue shrink-0 mt-0.5"}),e.jsx("span",{className:"truncate",children:H})]},J))}),n.equipmentList.length>10&&e.jsx("div",{className:"mt-3 pt-3 border-t dark:border-gray-700 text-center",children:e.jsxs("span",{className:"text-xs text-gray-400 font-medium italic",children:["+",n.equipmentList.length-10," more items available"]})})]})]})]})]})})]}),v&&e.jsx(ci,{userId:t,userName:`${(n==null?void 0:n.firstName)||""} ${(n==null?void 0:n.lastName)||""}`.trim()||"User",initialTab:g,currentUser:s,currentUserData:a,isFollowing:N,toggleFollow:f,onClose:()=>u(!1),openPublicProfile:H=>{u(!1)}})]})}function mi({user:t,userData:s,setActiveTab:a,bookingCount:i=0,subProfiles:l={},tokenBalance:n=0}){var R,E;const[o,p]=r.useState([]),[x,b]=r.useState(null),{notifications:m,unreadCount:h}=Ta(t==null?void 0:t.uid),d=(R=s==null?void 0:s.accountTypes)==null?void 0:R.includes("Studio"),v=((E=l==null?void 0:l.Studio)==null?void 0:E.rooms)||[],u=(s==null?void 0:s.profileViews)||0,g=(s==null?void 0:s.accountTypes)||[];let y=0,c=0;g.forEach(w=>{const z=(l==null?void 0:l[w])||{},A=Xt[w]||[];if(A.length===0)return;const q=A.filter(H=>!H.isToggle&&H.type!=="list").length||1,G=A.filter(H=>!H.isToggle&&H.type!=="list"&&z[H.key]&&z[H.key].length).length;y+=G/q,c++});const k=c>0?Math.round(y/c*100):100,N=k<60,f=r.useMemo(()=>ps(),[]),S=r.useMemo(()=>t!=null&&t.uid&&f?{userId:t.uid}:"skip",[t==null?void 0:t.uid,f]),j=ma(Ca.conversations.getConversations,S);r.useEffect(()=>{if(!j){p([]);return}const w=j.map(z=>({uid:z.otherUserId||z.chatId,name:z.chatName||"Unknown",lastMessage:z.lastMessage||"",timestamp:z.lastMessageTime||0,isMe:z.lastSenderId===t.uid})).sort((z,A)=>A.timestamp-z.timestamp).slice(0,3);p(w)},[j,t==null?void 0:t.uid]),r.useEffect(()=>{const w=me(D(P,`artifacts/${ee}/public/data/market_items`),Re("timestamp","desc"),Qe(1)),z=ge(w,A=>{A.empty||b({id:A.docs[0].id,...A.docs[0].data()})});return()=>z()},[]);const C=w=>{if(!w)return"Just now";let z;if(typeof w.toMillis=="function")z=new Date(w.toMillis());else if(typeof w=="number")z=new Date(w);else if(w instanceof Date)z=w;else return"Just now";if(isNaN(z.getTime()))return"Just now";const A=new Date;return z.getDate()===A.getDate()&&z.getMonth()===A.getMonth()&&z.getFullYear()===A.getFullYear()?z.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):z.toLocaleDateString()};return e.jsxs("div",{className:"space-y-8 max-w-6xl mx-auto pb-20 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-end gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight",children:["Welcome, ",s==null?void 0:s.firstName]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Your creative command center."})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-sm font-medium text-gray-500 bg-white dark:bg-[#2c2e36] px-4 py-2 rounded-full border dark:border-gray-700 shadow-sm flex items-center gap-2",children:[e.jsx(qe,{size:14}),new Date().toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})]})})]}),N&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-xl p-4 flex items-center justify-between gap-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-orange-100 dark:bg-orange-900/50 p-2 rounded-full text-orange-600 dark:text-orange-400",children:e.jsx(at,{size:20})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-300 text-sm",children:["Profile Incomplete (",k,"%)"]}),e.jsx("p",{className:"text-xs text-orange-700 dark:text-orange-400",children:"Please complete your profile details before booking sessions."})]})]}),e.jsx("button",{onClick:()=>a("profile"),className:"bg-orange-600 hover:bg-orange-700 text-white text-xs font-bold px-4 py-2 rounded-lg transition",children:"Complete Profile"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-yellow-500 to-orange-600 p-5 rounded-xl text-white shadow-lg cursor-pointer transform transition hover:scale-[1.02] relative overflow-hidden group",onClick:()=>a("payments"),children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"text-yellow-100 text-sm font-medium mb-1 flex items-center gap-1",children:["SeshFx Balance ",e.jsx(Rt,{size:12,className:"opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"text-3xl font-extrabold flex items-center gap-2",children:[e.jsx(je,{fill:"currentColor",size:28})," ",n]}),e.jsx("div",{className:"text-xs text-yellow-100 mt-2 opacity-80 bg-white/20 inline-block px-2 py-0.5 rounded-full",children:"+ Add Funds"})]}),e.jsx(je,{size:120,className:"absolute -bottom-6 -right-6 text-white opacity-20 rotate-12 group-hover:rotate-0 transition-transform duration-500"})]}),e.jsx("div",{className:"cursor-pointer transform transition hover:scale-[1.02]",onClick:()=>a("bookings"),children:e.jsx(xs,{title:"Pending Bookings",value:i,icon:e.jsx(Pe,{className:"text-white"}),bg:"bg-gradient-to-br from-brand-blue to-blue-600",text:"text-white",sub:i>0?"Action Required":"No pending requests"})}),e.jsx("div",{className:"cursor-pointer transform transition hover:scale-[1.02]",onClick:()=>a("messages"),children:e.jsx(xs,{title:"Active Chats",value:o.length,icon:e.jsx(pt,{className:"text-brand-blue"}),sub:"Check Inbox"})}),e.jsx("div",{className:"cursor-pointer transform transition hover:scale-[1.02]",onClick:()=>a("profile"),children:e.jsx(xs,{title:"Profile Views",value:u,icon:e.jsx(ur,{className:"text-brand-blue"}),sub:"Lifetime views"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-[#23262f]",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(st,{size:18,className:"text-gray-500"})," Activity Feed"]}),h>0&&e.jsxs("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full animate-pulse",children:[h," New"]})]}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:!m||m.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(st,{size:20,className:"text-gray-400"})}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"You're all caught up!"})]}):m.slice(0,5).map((w,z)=>e.jsxs("div",{className:`p-4 hover:bg-gray-50 dark:hover:bg-[#25272e] transition flex justify-between items-center group cursor-pointer ${w.read?"":"bg-blue-50/30 dark:bg-blue-900/10"}`,onClick:()=>a("feed"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${w.type==="follow"?"bg-brand-blue":w.type==="like"?"bg-red-500":w.type==="comment"?"bg-green-500":w.type==="mention"?"bg-purple-500":"bg-yellow-500"}`}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm dark:text-gray-200 font-medium",children:[e.jsx("span",{className:"font-bold",children:w.fromUserName})," ",w.message]}),e.jsx("p",{className:"text-xs text-gray-500",children:C(w.timestamp)})]})]}),e.jsx(dt,{size:14,className:"text-gray-300"})]},w.id||z))})]}),d&&e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 p-5 relative overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 relative z-10",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(ts,{size:18,className:"text-brand-blue"})," Studio Status"]}),e.jsxs("button",{onClick:()=>a("studio-ops"),className:"text-sm text-brand-blue hover:underline flex items-center gap-1",children:["Manage Ops ",e.jsx(Rt,{size:14})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 relative z-10",children:v.length===0?e.jsxs("div",{className:"col-span-full text-center py-6 text-gray-400 text-sm border-2 border-dashed dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-[#1f2128]",children:[e.jsx("div",{className:"mb-2",children:"No rooms configured."}),e.jsx("button",{className:"text-brand-blue font-bold hover:underline",onClick:()=>a("studio-ops"),children:"+ Add Room"})]}):v.map((w,z)=>{var A;return e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg border dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm dark:text-gray-200",children:w.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[((A=w.equipment)==null?void 0:A.length)||0," items • $",w.rate,"/hr"]})]}),e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full font-bold flex items-center gap-1 ${w.active?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-yellow-100 text-yellow-700"}`,children:[w.active?e.jsx(re,{size:10}):e.jsx(at,{size:10}),w.active?"Active":"Maint."]})]},z)})})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 p-5 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(pt,{size:18,className:"text-gray-400"})," Recent Messages"]}),e.jsx("button",{onClick:()=>a("messages"),className:"text-sm text-brand-blue hover:underline",children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:o.length===0?e.jsx("div",{className:"text-center text-gray-400 text-sm py-4",children:"No recent messages."}):o.map((w,z)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 dark:hover:bg-[#25272e] rounded-lg cursor-pointer transition",onClick:()=>a("messages"),children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-600 dark:text-gray-300",children:w.name?w.name.charAt(0):"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm font-bold dark:text-gray-200 flex justify-between",children:[w.name||"Unknown User",e.jsx("span",{className:"text-[10px] text-gray-400 font-normal",children:new Date(w.timestamp).toLocaleDateString()})]}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[w.isMe?"You: ":"",w.lastMessage]})]})]},w.uid+z))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 p-4 shadow-sm",children:[e.jsx("h3",{className:"font-bold mb-3 dark:text-white text-sm uppercase tracking-wide text-gray-500",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{className:"w-full text-left px-4 py-3 rounded-lg border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm flex items-center gap-3 dark:text-gray-300 transition group",onClick:()=>a("feed"),children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded text-brand-blue group-hover:scale-110 transition-transform",children:e.jsx(ss,{size:16})}),e.jsx("span",{className:"font-medium",children:"Create Post"})]}),e.jsxs("button",{className:"w-full text-left px-4 py-3 rounded-lg border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm flex items-center gap-3 dark:text-gray-300 transition group",onClick:()=>a("bookings"),children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-2 rounded text-purple-600 group-hover:scale-110 transition-transform",children:e.jsx(Ge,{size:16})}),e.jsx("span",{className:"font-medium",children:"Find Talent"})]}),e.jsxs("button",{className:"w-full text-left px-4 py-3 rounded-lg border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm flex items-center gap-3 dark:text-gray-300 transition group",onClick:()=>a("marketplace"),children:[e.jsx("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 p-2 rounded text-yellow-600 group-hover:scale-110 transition-transform",children:e.jsx(Dt,{size:16})}),e.jsx("span",{className:"font-medium",children:"Browse Marketplace"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-black text-white rounded-xl p-5 relative overflow-hidden shadow-lg",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(je,{size:16,className:"text-yellow-400",fill:"currentColor"}),e.jsx("span",{className:"text-xs font-bold text-yellow-400 uppercase",children:"Trending on SeshFx"})]}),x?e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-bold text-lg mb-1 truncate",children:x.title}),e.jsxs("p",{className:"text-xs text-gray-400 mb-4",children:["by ",x.author," • ",x.price," Tokens"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-bold text-lg mb-1",children:"Discover Sounds"}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"Fresh beats & presets added daily."})]}),e.jsxs("button",{onClick:()=>a("seshfx"),className:"w-full bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition",children:["Visit Store ",e.jsx(Rt,{size:12})]})]}),e.jsx("div",{className:"absolute -right-4 -bottom-4 w-24 h-24 bg-yellow-500 rounded-full blur-3xl opacity-20 animate-pulse"})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 p-4 shadow-sm",children:[e.jsx("h3",{className:"font-bold dark:text-white text-sm mb-3",children:"Completion"}),e.jsx("div",{className:"space-y-3",children:((s==null?void 0:s.accountTypes)||[]).map(w=>{const z=(l==null?void 0:l[w])||{},A=Xt[w]||[];if(A.length===0)return null;const q=A.filter(J=>!J.isToggle&&J.type!=="list").length||1,G=A.filter(J=>!J.isToggle&&J.type!=="list"&&z[J.key]&&z[J.key].length).length,H=Math.round(G/q*100);return e.jsxs("div",{className:"space-y-1 cursor-pointer hover:bg-gray-50 dark:hover:bg-white/5 p-2 rounded transition",onClick:()=>a("profile"),title:"Click to edit profile",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:w}),e.jsxs("span",{className:H===100?"text-green-500 font-bold":"text-gray-500",children:[H,"%"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-1000 ${H>=80?"bg-green-500":H>=40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${H}%`}})})]},w)})})]})]})]})]})}const bi="/assets/Fevicon-TMLO4Pj9.png";function fs({audioUrl:t,fileName:s="Audio Track",previewMode:a=!1}){const i=r.useRef(null),l=r.useRef(null),n=r.useRef(null),o=r.useRef(null),p=r.useRef(null),x=r.useRef(null),b=r.useRef(Math.random().toString(36).substr(2,9)),m=r.useRef(null),h=r.useRef(null),d=r.useRef(null),[v,u]=r.useState(!1),[g,y]=r.useState(!1),[c,k]=r.useState(!1),[N,f]=r.useState(!1),[S,j]=r.useState(document.documentElement.classList.contains("dark")),C=r.useRef(S),R={dark:{star:"rgba(255, 255, 255, 0.5)",special:"#3D84ED",wave:"rgba(255, 255, 255, 0.3)"},light:{star:"rgba(0, 0, 0, 0.5)",special:"#2563EB",wave:"rgba(0, 0, 0, 0.2)"}},E=400,w=120,z=80,A=r.useRef({stars:[],avg:0,width:0,height:0,cx:0,cy:0});r.useEffect(()=>{const M=new MutationObserver(L=>{L.forEach(_=>{if(_.attributeName==="class"){const B=document.documentElement.classList.contains("dark");j(B),C.current=B,p.current&&p.current.setOptions({waveColor:B?R.dark.wave:R.light.wave})}})});return M.observe(document.documentElement,{attributes:!0}),()=>M.disconnect()},[]),r.useEffect(()=>{if(!n.current||!o.current)return;const M=S?R.dark:R.light;p.current=Hl.create({container:o.current,waveColor:M.wave,progressColor:"#3D84ED",cursorColor:"#3D84ED",barWidth:4,barGap:3,barRadius:3,height:100,responsive:!0,normalize:!0,backend:"MediaElement",media:n.current,minPxPerSec:50,fillParent:!0,interact:!a,cursorWidth:2,barAlign:"bottom"});const L=_=>{_.detail.id!==b.current&&p.current&&p.current.isPlaying()&&p.current.pause()};return window.addEventListener("seshnx-audio-play",L),p.current.on("ready",()=>y(!0)),p.current.on("play",()=>{u(!0),window.dispatchEvent(new CustomEvent("seshnx-audio-play",{detail:{id:b.current}}))}),p.current.on("pause",()=>u(!1)),p.current.on("finish",()=>{u(!1),cancelAnimationFrame(x.current)}),()=>{window.removeEventListener("seshnx-audio-play",L),p.current&&p.current.destroy(),cancelAnimationFrame(x.current)}},[t,a]),r.useEffect(()=>{const M=()=>{if(i.current&&l.current){const{clientWidth:L,clientHeight:_}=i.current;l.current.width=L,l.current.height=_,A.current.width=L,A.current.height=_,A.current.cx=L/2,A.current.cy=_/2,q()}};return window.addEventListener("resize",M),M(),()=>{window.removeEventListener("resize",M),m.current&&m.current.state!=="closed"&&m.current.close()}},[]);const q=()=>{A.current.stars=[];for(let M=0;M<E;M++)A.current.stars.push({x:Math.random()*A.current.width-A.current.cx,y:Math.random()*A.current.height-A.current.cy,z:Math.random()*A.current.width})},G=()=>{if(!(N||c||!n.current))try{const M=window.AudioContext||window.webkitAudioContext;m.current=new M,h.current=m.current.createAnalyser(),h.current.fftSize=2048,d.current=m.current.createMediaElementSource(n.current),d.current.connect(h.current),h.current.connect(m.current.destination),f(!0)}catch(M){console.warn("Audio Context Error:",M)}},H=async M=>{var L;M.stopPropagation(),N||G(),((L=m.current)==null?void 0:L.state)==="suspended"&&await m.current.resume(),p.current&&p.current.playPause(),v||J()},J=()=>{if(!l.current)return;const M=l.current.getContext("2d"),{width:L,height:_,cx:B,cy:U,stars:Q}=A.current;let xe=0;if(h.current){const ce=h.current.frequencyBinCount,he=new Uint8Array(ce);h.current.getByteFrequencyData(he);let ue=0;for(let fe=0;fe<he.length;fe++)ue+=he[fe];xe=ue/he.length}A.current.avg=xe,M.clearRect(0,0,L,_);const ye=C.current?R.dark:R.light,pe=xe>z?xe/10:xe/30+.5;Q.forEach(ce=>{ce.z-=pe,ce.z<=0&&(ce.z=L,ce.x=Math.random()*L-B,ce.y=Math.random()*_-U);const he=ce.x/ce.z*L+B,ue=ce.y/ce.z*_+U,fe=(1-ce.z/L)*2.5;he>=0&&he<=L&&ue>=0&&ue<=_&&(M.fillStyle=xe>w?ye.special:ye.star,M.globalAlpha=1-ce.z/L,M.beginPath(),M.arc(he,ue,fe,0,Math.PI*2),M.fill(),M.globalAlpha=1)}),p.current&&p.current.isPlaying()&&(x.current=requestAnimationFrame(J))};return e.jsxs("div",{ref:i,className:"relative w-full h-32 rounded-xl overflow-hidden group bg-transparent transition-colors",children:[e.jsx("canvas",{ref:l,className:"w-full h-full absolute inset-0 z-0 pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 z-20 flex flex-col justify-end pointer-events-none",children:e.jsx("div",{ref:o,className:"w-full pointer-events-auto opacity-80 hover:opacity-100 transition-opacity"})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-3 z-30 flex justify-between items-start pointer-events-none",children:[e.jsxs("div",{className:"flex items-center gap-2 text-black dark:text-white/90",children:[e.jsx(mt,{size:16,className:"text-brand-blue"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[200px] shadow-sm",children:s}),a&&e.jsxs("span",{className:"text-[10px] bg-yellow-500 text-black px-2 rounded font-bold flex items-center gap-1",children:[e.jsx(yt,{size:8})," PREVIEW"]})]}),c&&e.jsxs("div",{className:"bg-red-500/80 text-white text-[10px] px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(Fe,{size:10})," Visuals Disabled"]})]}),e.jsx("div",{className:"absolute bottom-2 left-2 z-30 opacity-50 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.jsx("img",{src:bi,alt:"SeshNx",className:"w-5 h-5 object-contain"})}),e.jsx("div",{className:`absolute inset-0 z-40 flex items-center justify-center transition-opacity duration-300 pointer-events-none
                ${v?"opacity-0 group-hover:opacity-100 bg-white/20 dark:bg-black/20":"opacity-100 bg-white/10 dark:bg-black/10"}`,children:g?e.jsx("button",{onClick:H,className:"w-14 h-14 bg-white/80 dark:bg-black/40 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/40 text-brand-blue shadow-lg hover:scale-110 transition-transform pointer-events-auto",children:v?e.jsx(mr,{fill:"currentColor",className:"ml-0.5",size:24}):e.jsx(ba,{fill:"currentColor",className:"ml-1",size:24})}):e.jsx(K,{className:"animate-spin text-brand-blue",size:32})}),e.jsx("audio",{ref:n,src:t,crossOrigin:"anonymous",onError:()=>k(!0)})]})}function hi({post:t,currentUser:s,currentUserData:a,blockedUsers:i,onCountChange:l}){const[n,o]=r.useState([]),[p,x]=r.useState(""),[b,m]=r.useState(!1);r.useEffect(()=>{const v=me(D(P,`artifacts/${ee}/public/data/posts/${t.id}/replies`),Re("timestamp","asc")),u=ge(v,g=>{const c=g.docs.map(k=>({id:k.id,...k.data()})).filter(k=>!(i!=null&&i.includes(k.userId)));o(c),l(c.length)});return()=>u()},[t.id]);const h=async v=>{var g;if(v.preventDefault(),!p.trim()||!(s!=null&&s.uid))return;m(!0);const u=(a==null?void 0:a.effectiveDisplayName)||(a==null?void 0:a.firstName)||(s==null?void 0:s.displayName)||"User";try{await Ee(D(P,`artifacts/${ee}/public/data/posts/${t.id}/replies`),{text:p,userId:s.uid,displayName:u,userPhoto:(a==null?void 0:a.photoURL)||null,timestamp:X()}),t.userId!==s.uid&&Ma({targetUserId:t.userId,type:"comment",fromUserId:s.uid,fromUserName:u,fromUserPhoto:a==null?void 0:a.photoURL,postId:t.id,postPreview:(g=t.text)==null?void 0:g.substring(0,50),message:"commented on your post"}),x("")}catch(y){console.error(y)}m(!1)},d=async v=>{if(window.confirm("Delete comment?"))try{await ct(W(P,`artifacts/${ee}/public/data/posts/${t.id}/replies`,v))}catch(u){console.error("Delete comment error:",u)}};return e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] border-t dark:border-gray-700 p-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-4 mb-4 max-h-80 overflow-y-auto custom-scrollbar pr-2",children:[n.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-2",children:"No comments yet. Be the first!"}),n.map(v=>e.jsxs("div",{className:"group flex gap-3 text-sm",children:[e.jsx(kt,{src:v.userPhoto,name:v.displayName,size:"xs",className:"shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card border dark:border-gray-700 p-3 rounded-2xl rounded-tl-none inline-block max-w-full",children:[e.jsxs("div",{className:"flex justify-between items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-bold dark:text-white text-xs truncate",children:v.displayName}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0",children:v.timestamp?new Date(v.timestamp.toMillis()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"..."})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 break-words",children:v.text})]}),e.jsxs("div",{className:"flex gap-3 mt-1 ml-2",children:[e.jsx("button",{className:"text-[10px] font-bold text-gray-500 hover:text-brand-blue transition",children:"Reply"}),v.userId===(s==null?void 0:s.uid)&&e.jsx("button",{onClick:()=>d(v.id),className:"text-[10px] font-bold text-gray-400 hover:text-red-500 transition",children:"Delete"})]})]})]},v.id))]}),e.jsxs("form",{onSubmit:h,className:"flex gap-2",children:[e.jsx(kt,{src:a==null?void 0:a.photoURL,name:(a==null?void 0:a.firstName)||"You",size:"xs",className:"shrink-0 hidden sm:block"}),e.jsx("input",{className:"flex-1 bg-white dark:bg-dark-card border dark:border-gray-600 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition",placeholder:"Write a comment...",value:p,onChange:v=>x(v.target.value)}),e.jsx("button",{type:"submit",disabled:!p.trim()||b,className:"bg-brand-blue text-white p-2 rounded-full hover:bg-blue-600 disabled:opacity-50 transition shadow-sm",children:e.jsx(ha,{size:16,className:b?"animate-pulse":""})})]})]})}const pi=["👍","❤️","😂","😮","😢","🔥"],fi=t=>t?t.split(/(\s+)/).map((s,a)=>s.match(/^#\w+/)?e.jsx("span",{className:"text-brand-blue font-bold cursor-pointer hover:underline",children:s},a):s.match(/^@\w+/)?e.jsx("span",{className:"text-purple-600 font-bold cursor-pointer hover:underline",children:s},a):s):null,yi={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},exit:{opacity:0,scale:.95,transition:{duration:.2}}};function ji({post:t,currentUser:s,currentUserData:a,openPublicProfile:i,onReport:l,isFollowingAuthor:n,onToggleFollow:o}){var J,M,L;const[p,x]=r.useState(!1),[b,m]=r.useState(t.commentCount||0),[h,d]=r.useState(!1),[v,u]=r.useState(!1),[g,y]=r.useState(!1),[c,k]=r.useState(!1),[N,f]=r.useState(!1),S=r.useRef(null),j=r.useRef(null),C=t.userId===(s==null?void 0:s.uid),R=(J=t.reactions)==null?void 0:J[s==null?void 0:s.uid],E=t.reactions?Object.values(t.reactions).reduce((_,B)=>(_[B]=(_[B]||0)+1,_),{}):{},w=Object.values(E).reduce((_,B)=>_+B,0);r.useEffect(()=>{if(!(s!=null&&s.uid))return;(async()=>{try{const B=W(P,Z(s.uid).savedPosts,t.id),U=await Be(B);d(U.exists())}catch(B){console.error("Error checking saved status:",B)}})()},[s==null?void 0:s.uid,t.id]),r.useEffect(()=>{const _=B=>{S.current&&!S.current.contains(B.target)&&u(!1),j.current&&!j.current.contains(B.target)&&y(!1)};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[]);const z=async _=>{var U;if(u(!1),!(s!=null&&s.uid))return;const B=W(P,`artifacts/${ee}/public/data/posts/${t.id}`);try{const Q={},xe=!!R;R===_?(Q[`reactions.${s.uid}`]=ol(),Q.reactionCount=Ke(-1)):(Q[`reactions.${s.uid}`]=_,R||(Q.reactionCount=Ke(1)),!xe&&!C&&Ma({targetUserId:t.userId,type:"like",fromUserId:s.uid,fromUserName:(a==null?void 0:a.effectiveDisplayName)||(a==null?void 0:a.firstName)||"Someone",fromUserPhoto:a==null?void 0:a.photoURL,postId:t.id,postPreview:(U=t.text)==null?void 0:U.substring(0,50),message:`reacted ${_} to your post`})),await te(B,Q)}catch(Q){console.error("Reaction failed",Q),I.error("Couldn't add reaction")}},A=async()=>{var _,B;if(!(!(s!=null&&s.uid)||N)){f(!0);try{const U=W(P,Z(s.uid).savedPosts,t.id),Q=W(P,`artifacts/${ee}/public/data/posts/${t.id}`);h?(await ct(U),await te(Q,{saveCount:Ke(-1)}),d(!1),I.success("Removed from saved")):(await Oe(U,{postId:t.id,authorId:t.userId,authorName:t.displayName,preview:((_=t.text)==null?void 0:_.substring(0,100))||"Media post",savedAt:new Date,hasMedia:!!((B=t.attachments)!=null&&B.length||t.imageUrl||t.audioUrl)}),await te(Q,{saveCount:Ke(1)}),d(!0),I.success("Post saved!"))}catch(U){console.error("Save failed",U),I.error("Couldn't save post")}f(!1)}},q=async()=>{var B;const _=`${window.location.origin}/post/${t.id}`;if(navigator.share)try{await navigator.share({title:`Post by ${t.displayName}`,text:((B=t.text)==null?void 0:B.substring(0,100))||"Check out this post",url:_})}catch(U){U.name!=="AbortError"&&G(_)}else G(_)},G=_=>{navigator.clipboard.writeText(_),k(!0),I.success("Link copied to clipboard!"),setTimeout(()=>k(!1),2e3)},H=async()=>{if(C&&window.confirm("Are you sure you want to delete this post?"))try{const _=W(P,`artifacts/${ee}/public/data/posts/${t.id}`);await ct(_),I.success("Post deleted")}catch(_){console.error("Delete failed:",_),I.error("Couldn't delete post")}};return e.jsxs(Ne.div,{variants:yi,initial:"hidden",animate:"show",exit:"exit",layout:!0,className:"bg-white dark:bg-dark-card border dark:border-gray-700 rounded-xl overflow-visible shadow-sm mb-4 relative",children:[e.jsxs("div",{className:"p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden cursor-pointer shrink-0",onClick:()=>i(t.userId),children:t.authorPhoto?e.jsx("img",{src:t.authorPhoto,className:"h-full w-full object-cover",alt:"avatar"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-tr from-brand-blue to-purple-500 flex items-center justify-center text-white font-bold",children:((M=t.displayName)==null?void 0:M[0])||e.jsx(Le,{size:16})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm hover:underline decoration-brand-blue cursor-pointer truncate",onClick:()=>i(t.userId),children:t.displayName}),!C&&o&&!n&&e.jsx("button",{onClick:_=>{_.stopPropagation(),o()},className:"text-xs font-bold text-brand-blue hover:text-blue-700 transition shrink-0",children:"• Follow"})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"truncate",children:t.role}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"shrink-0",children:t.timestamp?new Date(t.timestamp.toMillis?t.timestamp.toMillis():t.timestamp).toLocaleDateString():"Just now"})]})]})]}),e.jsxs("div",{className:"relative",ref:j,children:[e.jsx("button",{className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>y(!g),children:e.jsx(br,{size:20})}),e.jsx(nt,{children:g&&e.jsxs(Ne.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden z-50",children:[e.jsxs("button",{onClick:()=>{G(`${window.location.origin}/post/${t.id}`),y(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(hr,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Copy link"})]}),!C&&e.jsxs(e.Fragment,{children:[o&&e.jsxs("button",{onClick:()=>{o(),y(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(wt,{size:16,className:"text-gray-400"}),e.jsxs("span",{className:"dark:text-gray-200",children:[n?"Unfollow":"Follow"," ",(L=t.displayName)==null?void 0:L.split(" ")[0]]})]}),e.jsxs("button",{onClick:()=>{l(),y(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(jt,{size:16}),e.jsx("span",{children:"Report post"})]})]}),C&&e.jsxs("button",{onClick:()=>{H(),y(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx($e,{size:16}),e.jsx("span",{children:"Delete post"})]})]})})]})]}),e.jsxs("div",{className:"px-4 pb-2",children:[t.text&&e.jsx("p",{className:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap text-sm leading-relaxed mb-3",children:fi(t.text)}),t.attachments&&t.attachments.length>0&&e.jsx("div",{className:`grid gap-2 mb-3 ${t.attachments.length>1?"grid-cols-2":"grid-cols-1"}`,children:t.attachments.map((_,B)=>e.jsxs("div",{className:"rounded-lg overflow-hidden bg-transparent relative",children:[_.type==="image"&&e.jsx("img",{src:_.url,className:"w-full h-full object-cover max-h-96",alt:"content"}),_.type==="video"&&e.jsx("video",{src:_.url,controls:!0,className:"w-full h-full max-h-96 bg-black"}),_.type==="audio"&&e.jsx("div",{className:"w-full",children:e.jsx(fs,{audioUrl:_.url,fileName:_.name||"Audio Track"})})]},B))}),t.audioUrl&&!t.attachments&&e.jsx("div",{className:"rounded-lg overflow-hidden bg-transparent mb-3",children:e.jsx(fs,{audioUrl:t.audioUrl,fileName:t.audioName||"Track"})}),t.imageUrl&&!t.attachments&&e.jsx("img",{src:t.imageUrl,className:"rounded-lg w-full mb-3 border dark:border-gray-700",alt:"legacy content"})]}),(w>0||t.saveCount>0)&&e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:Object.entries(E).map(([_,B])=>e.jsxs(Ne.div,{initial:{scale:0},animate:{scale:1},className:`text-xs px-2 py-1 rounded-full border flex items-center gap-1 ${R===_?"bg-blue-50 border-blue-200 dark:bg-blue-900/30 dark:border-blue-800":"bg-gray-50 border-gray-100 dark:bg-gray-800 dark:border-gray-700"} dark:text-gray-300`,children:[e.jsx("span",{children:_}),e.jsx("span",{className:"font-bold",children:B})]},_))}),t.saveCount>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[t.saveCount," save",t.saveCount!==1?"s":""]})]}),e.jsxs("div",{className:"px-4 py-3 border-t dark:border-gray-700 flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Ne.button,{whileTap:{scale:.9},onClick:()=>u(!v),className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg ${R?"text-blue-600 bg-blue-50 dark:bg-blue-900/20":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[R?e.jsx("span",{className:"text-lg",children:R}):e.jsx(pr,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:R?"Reacted":"React"})]}),e.jsx(nt,{children:v&&e.jsx(Ne.div,{ref:S,initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},className:"absolute bottom-full left-0 mb-2 bg-white dark:bg-gray-800 shadow-xl rounded-full p-2 flex gap-1 sm:gap-2 z-50 border dark:border-gray-600 origin-bottom-left",children:pi.map(_=>e.jsx(Ne.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:B=>{B.stopPropagation(),z(_)},className:`text-xl p-1 sm:p-1.5 rounded-full ${R===_?"bg-blue-100 dark:bg-blue-900":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:_},_))})})]}),e.jsxs(Ne.button,{whileTap:{scale:.95},onClick:()=>x(!p),className:"flex items-center gap-1.5 sm:gap-2 text-sm font-medium text-gray-500 hover:text-brand-blue transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx(pt,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:b>0?b:"Comment"}),b>0&&e.jsx("span",{className:"sm:hidden",children:b})]}),e.jsxs(Ne.button,{whileTap:{scale:.95},onClick:q,className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 ${c?"text-green-500":"text-gray-500 hover:text-green-500"}`,children:[c?e.jsx(Je,{size:18}):e.jsx(fr,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:c?"Copied!":"Share"})]})]}),e.jsx(Ne.button,{whileTap:{scale:.8},onClick:A,disabled:N,className:`${h?"text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"} transition p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full disabled:opacity-50`,title:h?"Remove from saved":"Save post",children:e.jsx(ca,{size:18,fill:h?"currentColor":"none"})})]}),e.jsx(nt,{children:p&&e.jsx(Ne.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx(hi,{post:t,currentUser:s,currentUserData:a,blockedUsers:[],onCountChange:m})})})]})}function Ba({text:t,onRemove:s}){return e.jsxs("span",{className:"flex items-center gap-1 bg-gray-100 dark:bg-gray-700 text-sm px-2 py-1 rounded-full text-gray-700 dark:text-gray-300",children:[t,e.jsx(le,{size:12,className:"cursor-pointer hover:text-red-500",onClick:s})]})}function Ps({label:t,fieldKey:s,options:a,initialValues:i,onChange:l}){const[n,o]=r.useState(""),[p,x]=r.useState(i||[]);r.useEffect(()=>{x(i||[])},[i]);const b=()=>{if(n&&!p.includes(n)){const h=[...p,n];x(h),l(s,h),o("")}},m=h=>{const d=p.filter(v=>v!==h);x(d),l(s,d)};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:t}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("select",{className:"flex-1 p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:n,onChange:h=>o(h.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),a.map(h=>e.jsx("option",{value:h,children:h},h))]}),e.jsx("button",{type:"button",onClick:b,className:"bg-brand-blue text-white px-3 rounded-lg text-sm",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(h=>e.jsx(Ba,{text:h,onRemove:()=>m(h)},h))})]})}function vi({label:t,fieldKey:s,data:a,initialValues:i,onChange:l}){const[n,o]=r.useState(""),[p,x]=r.useState(""),[b,m]=r.useState(i||[]);r.useEffect(()=>{m(i||[])},[i]);const h=a[n]||[],d=()=>{const u=n&&p?`${n} - ${p}`:"";if(u&&!b.includes(u)){const g=[...b,u];m(g),l(s,g),x("")}},v=u=>{const g=b.filter(y=>y!==u);m(g),l(s,g)};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:t}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("select",{className:"w-1/3 p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:n,onChange:u=>{o(u.target.value),x("")},children:[e.jsx("option",{value:"",children:"Category..."}),Object.keys(a).map(u=>e.jsx("option",{value:u,children:u},u))]}),e.jsxs("select",{className:"w-1/3 p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:p,onChange:u=>x(u.target.value),disabled:!n,children:[e.jsx("option",{value:"",children:"Select..."}),h.map(u=>e.jsx("option",{value:u,children:u},u))]}),e.jsx("button",{type:"button",onClick:d,className:"bg-brand-blue text-white px-3 rounded-lg text-sm",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(u=>e.jsx(Ba,{text:u,onRemove:()=>v(u)},u))})]})}function Ni({user:t,userData:s,onPost:a}){const[i,l]=r.useState(""),[n,o]=r.useState([]),[p,x]=r.useState(!1),[b,m]=r.useState([]),[h,d]=r.useState(null),[v,u]=r.useState(!1),{uploadMedia:g}=xt(),y=(N,f)=>{if(N.target.files&&N.target.files[0]){const S=N.target.files[0],j=URL.createObjectURL(S);o([...n,{file:S,type:f,previewUrl:j}])}},c=N=>{o(n.filter((f,S)=>S!==N))},k=async()=>{if(!(!i.trim()&&n.length===0)){u(!0);try{const N=await Promise.all(n.map(async j=>{const C=j.type==="video"?"postVideos":j.type==="audio"?"postAudio":"postImages",R=`artifacts/${t.uid}/${C}`,E=await g(j.file,R);return E?{...E,type:j.type}:null}));let f=null;if(h){const j=await g(h,`artifacts/${t.uid}/postPresets`);f=j==null?void 0:j.url}const S={text:i,attachments:N.filter(j=>j!==null),seshFx:p&&(b.length>0||f)?{plugins:b,presetUrl:f,presetName:h?h.name:null}:null};await a(S),l(""),o([]),x(!1),m([]),d(null)}catch(N){console.error("Error creating post:",N),alert("Failed to create post. Please try again.")}finally{u(!1)}}};return e.jsx("div",{className:"bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-gray-700 shadow-sm mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden shrink-0",children:s!=null&&s.photoURL?e.jsx("img",{src:s.photoURL,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-brand-blue"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{className:"w-full bg-transparent outline-none text-gray-900 dark:text-white placeholder-gray-500 min-h-[80px] resize-none",placeholder:"What's creating sound today? (#tags @mentions)",value:i,onChange:N=>l(N.target.value)}),n.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:n.map((N,f)=>e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black/5 border dark:border-gray-600 aspect-video group flex items-center justify-center",children:[N.type==="image"&&e.jsx("img",{src:N.previewUrl,className:"h-full w-full object-cover"}),N.type==="video"&&e.jsx("video",{src:N.previewUrl,className:"h-full w-full object-cover"}),N.type==="audio"&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-brand-blue bg-gray-100 dark:bg-gray-800 w-full h-full",children:[e.jsx(mt,{size:32}),e.jsx("span",{className:"text-xs text-gray-500 mt-2 truncate max-w-[90%] px-2",children:N.file.name})]}),e.jsx("button",{onClick:()=>c(f),className:"absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-red-500",children:e.jsx(le,{size:12})})]},f))}),p&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-3 border border-blue-100 dark:border-blue-800/50 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue uppercase",children:"SeshFx Data"}),e.jsx("button",{onClick:()=>x(!1),children:e.jsx(le,{size:14,className:"text-gray-400 hover:text-brand-blue"})})]}),e.jsx(Ps,{label:"",options:Rl,initialValues:b,onChange:(N,f)=>m(f)}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(yr,{size:14,className:"text-gray-400"}),e.jsx("input",{type:"file",className:"text-xs text-gray-500 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:bg-white dark:file:bg-gray-700 dark:file:text-white",onChange:N=>d(N.target.files[0])})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-brand-blue cursor-pointer transition",title:"Add Image",children:[e.jsx(It,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:N=>y(N,"image")})]}),e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-green-500 cursor-pointer transition",title:"Add Video",children:[e.jsx(vs,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:N=>y(N,"video")})]}),e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-purple-500 cursor-pointer transition",title:"Add Audio Track",children:[e.jsx(mt,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"audio/*",onChange:N=>y(N,"audio")})]}),e.jsx("button",{onClick:()=>x(!p),className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition ${p?"bg-blue-50 dark:bg-blue-900/20 text-brand-blue":"text-gray-400"}`,title:"Add Plugin Data",children:e.jsx(ts,{size:20})})]}),e.jsx("button",{onClick:k,disabled:v||!i&&n.length===0,className:"bg-brand-blue text-white px-5 py-1.5 rounded-full font-bold text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition",children:v?e.jsx(K,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:["Post ",e.jsx(ha,{size:14})]})})]})]})]})})}const Ks=["Spam or commercial solicitation","Harassment or bullying","Hate speech","Nudity or sexual activity","Violence or dangerous organizations","Copyright / Intellectual Property Violation","Scam or fraud","Other"],ki=async({contentId:t,contentType:s,contentSummary:a,reporterId:i,reporterName:l,reason:n,description:o="",schoolId:p=null,isFacultyAction:x=!1})=>{try{if(await Ee(D(P,`artifacts/${ee}/moderation_queue`),{type:"Report",status:"Open",priority:x?"High":"Normal",targetId:t,targetType:s,targetSummary:a||"No preview available",reporterId:i,reporterName:l,reason:n,description:o,schoolId:p,timestamp:X()}),x&&(s==="post"||s==="comment")){const b=s==="post"?`artifacts/${ee}/public/data/posts`:`artifacts/${ee}/public/data/comments`;await te(W(P,b,t),{visibility:"Hidden",moderationStatus:"Flagged",flaggedBy:i,flaggedAt:X()})}return{success:!0}}catch(b){return console.error("Reporting failed:",b),{success:!1,error:b}}};function _a({user:t,target:s,onClose:a}){const[i,l]=r.useState(Ks[0]),[n,o]=r.useState(""),[p,x]=r.useState(!1),[b,m]=r.useState(!1),h=async()=>{if(!(!i||!(t!=null&&t.uid))){x(!0);try{(await ki({contentId:s.id,contentType:s.type,contentSummary:s.summary,reporterId:t.uid,reporterName:t.displayName||"Anonymous User",reason:i,description:n})).success?(m(!0),setTimeout(a,2e3)):alert("Failed to submit report. Please try again.")}catch(d){console.error("Submission error:",d),alert("An unexpected error occurred during submission.")}x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-lg animate-in fade-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h3",{className:"font-bold text-xl dark:text-white flex items-center gap-2 text-red-500",children:[e.jsx(at,{size:24})," Report Violation"]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-800 dark:text-gray-400 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:["You are reporting a violation regarding: ",e.jsx("strong",{className:"font-bold",children:s.summary})," (",s.type,")"]}),b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(jt,{size:48,className:"text-green-500 mx-auto mb-4"}),e.jsx("h4",{className:"font-bold text-lg dark:text-white",children:"Report Submitted!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Thank you for helping keep the community safe. We will review this shortly."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Reason for Report"}),e.jsx("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:i,onChange:d=>l(d.target.value),children:Ks.map(d=>e.jsx("option",{value:d,children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Additional Details (Optional)"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm resize-none",rows:"3",placeholder:"Provide any further context or relevant details.",value:n,onChange:d=>o(d.target.value)})]}),e.jsx("button",{onClick:h,disabled:p,className:"w-full bg-red-600 text-white py-3 rounded-xl font-bold hover:bg-red-700 transition disabled:opacity-50 flex items-center justify-center gap-2 shadow-md",children:p?e.jsx(K,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{size:18})," Submit Report"]})})]})]})})})}const We={FOR_YOU:"for_you",FOLLOWING:"following"};function wi({user:t,userData:s,openPublicProfile:a}){const[i,l]=r.useState([]),[n,o]=r.useState(!0),[p,x]=r.useState(null),[b,m]=r.useState(We.FOR_YOU),[h,d]=r.useState([]),[v,u]=r.useState(!1),{following:g,stats:y,loading:c,isFollowing:k,toggleFollow:N,getFollowingIds:f}=Oa(t==null?void 0:t.uid,s),S=r.useMemo(()=>f(),[g]);r.useEffect(()=>{b===We.FOLLOWING&&S.length===0&&(t!=null&&t.uid)&&j()},[b,S.length,t==null?void 0:t.uid]);const j=async()=>{u(!0);try{const w=me(D(P,`artifacts/${ee}/public/data/posts`),Re("timestamp","desc"),Qe(20)),z=await He(w),A=new Map;z.docs.forEach(q=>{const G=q.data();G.userId!==(t==null?void 0:t.uid)&&!A.has(G.userId)&&A.set(G.userId,{userId:G.userId,displayName:G.displayName,photoURL:G.authorPhoto,role:G.role})}),d(Array.from(A.values()).slice(0,5))}catch(w){console.error("Error loading suggestions:",w)}u(!1)};r.useEffect(()=>{o(!0);const w=`artifacts/${ee}/public/data/posts`;let z;b===We.FOLLOWING&&S.length>0?z=me(D(P,w),Re("timestamp","desc"),Qe(50)):z=me(D(P,w),Re("timestamp","desc"),Qe(20));const A=ge(z,q=>{let G=q.docs.map(H=>({id:H.id,...H.data()}));b===We.FOLLOWING&&S.length>0&&(G=G.filter(H=>S.includes(H.userId)||H.userId===(t==null?void 0:t.uid))),l(G),o(!1)},q=>{console.error("Feed error:",q),o(!1)});return()=>A()},[b,S,t==null?void 0:t.uid]);const C=async w=>{if(t)try{await Ee(D(P,`artifacts/${ee}/public/data/posts`),{...w,userId:t.uid,displayName:(s==null?void 0:s.effectiveDisplayName)||`${(s==null?void 0:s.firstName)||"User"} ${(s==null?void 0:s.lastName)||""}`.trim(),authorPhoto:(s==null?void 0:s.photoURL)||null,role:(s==null?void 0:s.activeProfileRole)||"User",timestamp:X(),reactions:{},reactionCount:0,commentCount:0,saveCount:0,visibility:"Public"})}catch(z){console.error("Failed to post:",z),alert("Could not post update. Please try again.")}},R={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},E=({suggestedUser:w})=>e.jsxs(Ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 hover:border-brand-blue/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1 min-w-0",onClick:()=>a==null?void 0:a(w.userId),children:[e.jsx(kt,{src:w.photoURL,name:w.displayName,size:"md"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate hover:text-brand-blue transition",children:w.displayName}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:w.role})]})]}),e.jsx(zs,{isFollowing:k(w.userId),onToggle:()=>N(w.userId,w),size:"sm",variant:"default"})]});return e.jsxs("div",{className:"max-w-2xl mx-auto pb-20",children:[e.jsx(Ni,{user:t,userData:s,onPost:C}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("button",{onClick:()=>m(We.FOR_YOU),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${b===We.FOR_YOU?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(jr,{size:16}),e.jsx("span",{children:"For You"})]}),e.jsxs("button",{onClick:()=>m(We.FOLLOWING),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${b===We.FOLLOWING?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(_e,{size:16}),e.jsx("span",{children:"Following"}),y.followingCount>0&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${b===We.FOLLOWING?"bg-white/20":"bg-gray-200 dark:bg-gray-700"}`,children:y.followingCount})]})]}),n||c?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(K,{className:"animate-spin text-brand-blue",size:32})}):e.jsxs(e.Fragment,{children:[b===We.FOLLOWING&&S.length===0&&e.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-6 border border-blue-100 dark:border-blue-800/30",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-brand-blue/10 flex items-center justify-center",children:e.jsx(wt,{size:28,className:"text-brand-blue"})}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Start following creators"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-sm mx-auto",children:"Follow artists, engineers, and studios to see their posts in your Following feed."})]}),v?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(K,{className:"animate-spin text-brand-blue",size:24})}):h.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Suggested for you"}),h.map(w=>e.jsx(E,{suggestedUser:w},w.userId))]})]}),e.jsxs(Ne.div,{variants:R,initial:"hidden",animate:"show",className:"space-y-4",children:[e.jsx(nt,{mode:"popLayout",children:i.map(w=>e.jsx(ji,{post:w,currentUser:t,currentUserData:s,openPublicProfile:a||(()=>{}),onReport:()=>x(w),isFollowingAuthor:k(w.userId),onToggleFollow:()=>N(w.userId,{displayName:w.displayName,photoURL:w.authorPhoto,role:w.role})},w.id))}),i.length===0&&b===We.FOR_YOU&&e.jsxs(Ne.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(ft,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsx("p",{children:"No posts yet. Be the first to share something!"})]}),i.length===0&&b===We.FOLLOWING&&S.length>0&&e.jsxs(Ne.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(_e,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsx("p",{children:"No recent posts from people you follow."}),e.jsx("button",{onClick:()=>m(We.FOR_YOU),className:"mt-3 text-brand-blue hover:underline text-sm font-medium",children:"Browse For You feed →"})]})]})]}),p&&e.jsx(_a,{user:t,target:{id:p.id,type:"Post",summary:p.text?p.text.substring(0,50):"Media Post"},onClose:()=>x(null)})]})}function qa({initialZip:t="",onLocationChange:s,showMap:a=!1,label:i="Location"}){const[l,n]=r.useState(t),[o,p]=r.useState(""),[x,b]=r.useState(!1),[m,h]=r.useState(null);r.useEffect(()=>{t&&t!==l&&(n(t),d(t))},[t]);const d=async u=>{const g=u.replace(/\D/g,"").slice(0,5);if(n(g),g.length===5){b(!0);const y=await is(g);y?(p(y.cityState),h({lat:y.lat,lng:y.lng}),s({zip:g,...y})):(p("Unknown Location"),s({zip:g,valid:!1})),b(!1)}else p("")},v=()=>{if(!navigator.geolocation)return alert("Geolocation not supported");b(!0),navigator.geolocation.getCurrentPosition(async u=>{const{latitude:g,longitude:y}=u.coords;try{const N=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${g}&lon=${y}`)).json()).address.postcode;if(N){const f=N.split("-")[0];n(f),d(f)}else h({lat:g,lng:y}),p("Current Location"),s({lat:g,lng:y,name:"Current Location",valid:!0})}catch(c){console.error(c),alert("Failed to determine location.")}b(!1)},u=>{console.warn(u),alert("Location access denied."),b(!1)})};return e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:i}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{className:"w-full pl-9 p-2.5 bg-white dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all text-sm",placeholder:"Zip Code",maxLength:5,value:l,onChange:u=>d(u.target.value)}),e.jsx(Te,{className:`absolute left-3 top-3 text-gray-400 ${x?"animate-pulse":""}`,size:16})]}),e.jsx("button",{onClick:v,disabled:x,className:"p-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-brand-blue transition-colors",title:"Use my location",children:x?e.jsx(K,{size:18,className:"animate-spin"}):e.jsx(ua,{size:18})})]}),o&&e.jsxs("div",{className:"mt-1.5 text-xs font-medium text-gray-500 dark:text-gray-400 flex items-center gap-1 animate-in fade-in",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),o]})]})}let Si=La.icon({iconUrl:Wl,shadowUrl:ql,iconSize:[25,41],iconAnchor:[12,41]});La.Marker.prototype.options.icon=Si;function Ci({center:t,zoom:s}){const a=Aa();return r.useEffect(()=>{a.setView(t,s)},[t,s,a]),null}function Wa({locations:t=[],center:s=[34.0522,-118.2437],zoom:a=10,height:i="400px",drawRadius:l=!1,radiusMiles:n=0}){const o=t.filter(x=>x.lat&&x.lng&&(!x.hideAddress||x.forceReveal)),p=n*1609.34;return e.jsx("div",{className:"rounded-xl overflow-hidden shadow-inner border dark:border-gray-700 relative z-0",style:{height:i,width:"100%"},children:e.jsxs(Pa,{center:s,zoom:a,style:{height:"100%",width:"100%"},scrollWheelZoom:!1,children:[e.jsx(Ea,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Ci,{center:s,zoom:a}),l&&n>0&&e.jsx(qt,{center:s,pathOptions:{fillColor:"#3D84ED",color:"#3D84ED",fillOpacity:.2},radius:p}),o.map(x=>e.jsx(Vl,{position:[x.lat,x.lng],children:e.jsx(Ul,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{className:"block mb-1",children:x.name}),e.jsx("span",{className:"text-xs text-gray-500",children:x.address||"Location Hidden"})]})})},x.id))]})})}function Qs(t,s,a,i){const n=(a-t)*(Math.PI/180),o=(i-s)*(Math.PI/180),p=Math.sin(n/2)*Math.sin(n/2)+Math.cos(t*(Math.PI/180))*Math.cos(a*(Math.PI/180))*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))*.621371}function Ri({userData:t,sessionParams:s,setSessionParams:a,onNext:i}){var v,u;const[l,n]=r.useState(1),[o,p]=r.useState(!1),[x,b]=r.useState([]),m=g=>{g.preventDefault(),n(2),h()},h=async()=>{p(!0);try{const g=me(ls(P,"public_profile"),we("accountTypes","array-contains","Studio")),k=(await He(g)).docs.map(N=>({id:N.ref.parent.parent.id,...N.data()})).filter(N=>!N.location||!s.location?!1:Qs(s.location.lat,s.location.lng,N.location.lat,N.location.lng)<=s.radius).map(N=>({...N,distance:Qs(s.location.lat,s.location.lng,N.location.lat,N.location.lng)})).sort((N,f)=>N.distance-f.distance);b(k)}catch(g){console.error("Studio fetch error:",g)}p(!1)},d=g=>{a(y=>({...y,venue:g})),i()};return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 shadow-sm overflow-hidden min-h-[600px]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"bg-brand-blue text-white w-8 h-8 rounded-full flex items-center justify-center text-sm",children:l}),l===1?"Session Logistics":"Select Studio"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 ml-10",children:l===1?"Define the when and where.":`Found ${x.length} studios within range.`})]}),l===1&&e.jsxs("form",{onSubmit:m,className:"p-8 space-y-6 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:[e.jsx(Pe,{size:14,className:"inline mr-1"})," Date"]}),e.jsx("input",{type:"date",required:!0,className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white outline-none focus:ring-2 focus:ring-brand-blue",value:s.date,onChange:g=>a({...s,date:g.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:[e.jsx(qe,{size:14,className:"inline mr-1"})," Start Time"]}),e.jsx("input",{type:"time",required:!0,className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white outline-none focus:ring-2 focus:ring-brand-blue",value:s.time,onChange:g=>a({...s,time:g.target.value})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(qa,{initialZip:t==null?void 0:t.zip,label:"Center Location",onLocationChange:g=>a({...s,location:g})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Max Distance"}),e.jsxs("span",{className:"text-xs font-bold text-brand-blue",children:[s.radius," miles"]})]}),e.jsx("input",{type:"range",min:"5",max:"100",step:"5",value:s.radius,onChange:g=>a({...s,radius:parseInt(g.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:[e.jsx(Fe,{size:14,className:"inline mr-1"})," Urgency"]}),e.jsx("div",{className:"flex gap-2",children:["Low","Normal","High"].map(g=>e.jsx("button",{type:"button",onClick:()=>a({...s,urgency:g}),className:`flex-1 py-2 rounded-lg text-sm font-bold border transition ${s.urgency===g?"bg-brand-blue text-white border-brand-blue":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:g},g))})]})]}),e.jsx("div",{className:"pt-6",children:e.jsxs("button",{type:"submit",className:"w-full bg-brand-blue text-white py-4 rounded-xl font-bold shadow-lg hover:bg-blue-600 transition flex justify-center items-center gap-2",children:["Find Studios ",e.jsx(dt,{size:20})]})})]}),l===2&&e.jsx("div",{className:"flex flex-col h-[600px]",children:o?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[e.jsx(K,{className:"animate-spin text-brand-blue mb-4",size:40}),e.jsx("p",{className:"text-gray-500",children:"Scouting locations..."})]}):e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-1/2 overflow-y-auto p-4 space-y-3",children:[e.jsx("button",{onClick:()=>n(1),className:"text-xs text-gray-500 hover:text-brand-blue mb-2 flex items-center gap-1",children:"← Change Filters"}),e.jsxs("div",{onClick:()=>d({id:"remote",name:"Remote / TBD",address:"No physical location set"}),className:"p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer text-center",children:[e.jsx("h4",{className:"font-bold text-gray-600 dark:text-gray-300",children:"No Studio Needed / Remote"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Skip venue selection"})]}),x.map(g=>e.jsxs("div",{onClick:()=>d(g),className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 hover:border-brand-blue dark:hover:border-blue-500 cursor-pointer transition shadow-sm group",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-bold dark:text-white group-hover:text-brand-blue",children:g.name||"Studio"}),e.jsxs("span",{className:"text-xs font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-600 dark:text-gray-300",children:["$",g.rate,"/hr"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1",children:[e.jsx(Te,{size:10})," ",g.distance.toFixed(1)," miles away"]}),e.jsx("div",{className:"flex gap-1 mt-2",children:(g.equipmentList||[]).slice(0,3).map(y=>e.jsx("span",{className:"text-[10px] bg-blue-50 dark:bg-blue-900/20 text-blue-600 px-1.5 py-0.5 rounded",children:y},y))})]},g.id))]}),e.jsx("div",{className:"hidden md:block w-1/2 h-full border-l dark:border-gray-700 relative",children:e.jsx(Wa,{locations:x,center:[(v=s.location)==null?void 0:v.lat,(u=s.location)==null?void 0:u.lng],height:"100%",drawRadius:!0,radiusMiles:s.radius})})]})})]})}function Xs({user:t,userData:s,openPublicProfile:a,onAddToCart:i,sessionCartIds:l=[],onBook:n,mode:o="direct"}){const[p,x]=r.useState(""),[b,m]=r.useState([]),[h,d]=r.useState(!1),[v,u]=r.useState("list"),[g,y]=r.useState(!0),[c,k]=r.useState({role:"All",minRate:0,maxRate:500}),N=async()=>{d(!0);try{const f=ls(P,Z().publicProfileCollectionGroup),S=[];c.role!=="All"&&S.push(we("accountTypes","array-contains",c.role)),S.push(Qe(50));const j=me(f,...S);let R=(await He(j)).docs.map(E=>{const w=E.data();return{id:w.uid||E.ref.parent.parent.id,...w}}).filter(E=>E.id!==t.uid);if(p){const E=p.toLowerCase();R=R.filter(w=>{var z,A,q;return((z=w.firstName)==null?void 0:z.toLowerCase().includes(E))||((A=w.lastName)==null?void 0:A.toLowerCase().includes(E))||((q=w.searchTerms)==null?void 0:q.includes(E))})}m(R)}catch(f){console.error("Search failed:",f)}d(!1)};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 h-full",children:[e.jsx("div",{className:`lg:col-span-3 space-y-4 ${g?"block":"hidden lg:block"}`,children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm h-fit sticky top-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(pa,{size:18})," Filters"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Profile Type"}),e.jsxs("select",{className:"w-full p-2 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:c.role,onChange:f=>k({...c,role:f.target.value}),children:[e.jsx("option",{value:"All",children:"All Profiles"}),e.jsx("option",{value:"Musician",children:"Musician"}),e.jsx("option",{value:"Producer",children:"Producer"}),e.jsx("option",{value:"Engineer",children:"Audio Engineer"})]})]}),e.jsx("button",{onClick:N,className:"w-full bg-brand-blue text-white py-2 rounded-lg text-sm font-bold hover:bg-blue-600 transition",children:"Update Results"})]})]})}),e.jsxs("div",{className:"lg:col-span-9 space-y-4",children:[e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] p-3 rounded-xl border dark:border-gray-700 flex gap-3 items-center shadow-sm",children:e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(Ge,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsx("input",{className:"w-full pl-10 p-2.5 bg-gray-50 dark:bg-[#1f2128] border-transparent focus:bg-white dark:focus:bg-black focus:border-brand-blue border rounded-lg dark:text-white transition-all outline-none",placeholder:"Search talent...",value:p,onChange:f=>x(f.target.value),onKeyDown:f=>f.key==="Enter"&&N()})]})}),e.jsx("div",{className:"min-h-[400px]",children:h?e.jsx("div",{className:"text-center py-10 text-gray-500",children:"Searching..."}):b.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:b.map(f=>{var j;const S=l.includes(f.id);return e.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] p-4 rounded-xl border flex flex-col transition ${S?"border-brand-blue ring-1 ring-brand-blue bg-blue-50 dark:bg-blue-900/10":"dark:border-gray-700 hover:border-gray-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 cursor-pointer",onClick:()=>a(f.id,f.firstName),children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center font-bold",children:(j=f.firstName)==null?void 0:j[0]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold dark:text-white",children:[f.firstName," ",f.lastName]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[f.accountTypes[0]," • $",f.rate||"?","/hr"]})]})]}),o==="planner"&&e.jsx("button",{onClick:()=>!S&&i(f),disabled:S,className:`mt-auto w-full py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 ${S?"bg-green-100 text-green-700 cursor-default":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-white hover:bg-brand-blue hover:text-white transition"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14})," Added to Session"]}):e.jsxs(e.Fragment,{children:[e.jsx(lt,{size:14})," Add to Session"]})}),o==="direct"&&e.jsxs("button",{onClick:()=>n(f),className:"mt-auto w-full py-2 rounded-lg text-xs font-bold bg-brand-blue text-white hover:bg-blue-600 transition flex items-center justify-center gap-2",children:[e.jsx(Pe,{size:14})," Book Now"]})]},f.id)})}):e.jsx("div",{className:"text-center py-20 text-gray-400",children:"Try adjusting filters to find talent."})})]})]})}function zi({user:t,userData:s,broadcast:a,onClose:i}){const[l,n]=r.useState(Math.floor(a.offerAmount/(a.duration||1))),[o,p]=r.useState(""),[x,b]=r.useState(!1),m=l*(a.duration||1),h=a.offerAmount,d=m>h,v=async()=>{if(!l||!o)return alert("Please enter a rate and a message.");if(d)return alert("Your bid exceeds the client's budget.");b(!0);try{const u={type:"Bid",broadcastId:a.id,targetId:a.senderId,targetName:a.senderName,senderId:t.uid,senderName:`${s.firstName} ${s.lastName}`,serviceType:`Bid: ${a.serviceType||"Session"}`,offerAmount:m,ratePerHour:parseInt(l),message:o,status:"Pending",date:"Flexible",timestamp:X()};await Ee(D(P,`artifacts/${ee}/public/data/bookings`),u),alert("Bid submitted successfully! The client has been notified."),i()}catch(u){console.error("Error submitting bid:",u),alert("Failed to submit bid.")}b(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Place Your Bid"}),e.jsx("button",{onClick:i,children:e.jsx(le,{size:20,className:"text-gray-500 hover:text-white"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 uppercase mb-1",children:"Client's Budget"}),e.jsxs("div",{className:"text-2xl font-extrabold dark:text-white",children:["$",h," ",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["Total (",a.duration," hrs)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-500 mb-2",children:"Your Hourly Rate ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{size:16,className:"absolute left-3 top-3.5 text-gray-400"}),e.jsx("input",{type:"number",className:`w-full pl-8 p-3 border rounded-xl font-bold text-lg outline-none dark:bg-[#1f2128] dark:text-white ${d?"border-red-500 focus:ring-red-500":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"}`,value:l,onChange:u=>n(u.target.value)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Total Bid:"}),e.jsxs("span",{className:`font-bold ${d?"text-red-500":"text-green-600"}`,children:["$",m]})]}),d&&e.jsxs("div",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(Fe,{size:12})," Bid exceeds budget. Consider lowering your rate."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-500 mb-2",children:"Message to Client"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl text-sm dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none resize-none",rows:"3",placeholder:"Introduce yourself and your gear...",value:o,onChange:u=>p(u.target.value)})]}),e.jsx("button",{onClick:v,disabled:x||d,className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold shadow-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:shadow-none",children:x?e.jsx(K,{className:"animate-spin"}):"Submit Proposal"})]})]})})}function Zs(t,s,a,i){var l=6371,n=_t(a-t),o=_t(i-s),p=Math.sin(n/2)*Math.sin(n/2)+Math.cos(_t(t))*Math.cos(_t(a))*Math.sin(o/2)*Math.sin(o/2),x=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p));return l*x*.621371}function _t(t){return t*(Math.PI/180)}function Pi({user:t,userData:s,onBid:a}){const[i,l]=r.useState([]),[n,o]=r.useState([]),[p,x]=r.useState(null),[b,m]=r.useState(null),[h,d]=r.useState(50);r.useEffect(()=>{(async()=>{if(s!=null&&s.zip){const g=await is(s.zip);g&&m({lat:g.lat,lng:g.lng})}else navigator.geolocation&&navigator.geolocation.getCurrentPosition(g=>m({lat:g.coords.latitude,lng:g.coords.longitude}))})()},[s]),r.useEffect(()=>{const u=me(D(P,`artifacts/${ee}/public/data/bookings`),we("type","==","Broadcast"),we("status","==","Broadcasting"),Re("timestamp","desc")),g=ge(u,y=>{l(y.docs.map(c=>({id:c.id,...c.data()})))});return()=>g()},[]),r.useEffect(()=>{if(!b){o(i);return}const u=i.filter(g=>!g.location||!g.location.lat||!g.location.lng?!0:Zs(b.lat,b.lng,g.location.lat,g.location.lng)<=h).map(g=>{const y=g.location?Zs(b.lat,b.lng,g.location.lat,g.location.lng):null;return{...g,distance:y}}).sort((g,y)=>(g.distance||9999)-(y.distance||9999));o(u)},[i,b,h]);const v=async u=>{if(window.confirm("Cancel this broadcast? This will remove it from the board."))try{await te(W(P,`artifacts/${ee}/public/data/bookings`,u),{status:"Cancelled"})}catch(g){console.error(g),alert("Failed to cancel.")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-end gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(je,{className:"text-yellow-500",size:20})," Open Sessions"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Live opportunities near you."})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[e.jsx(Te,{size:14,className:"ml-2 text-gray-500"}),e.jsxs("select",{className:"bg-transparent text-sm font-bold text-gray-700 dark:text-gray-300 p-1 outline-none cursor-pointer",value:h,onChange:u=>d(Number(u.target.value)),children:[e.jsx("option",{value:10,children:"Within 10 mi"}),e.jsx("option",{value:25,children:"Within 25 mi"}),e.jsx("option",{value:50,children:"Within 50 mi"}),e.jsx("option",{value:100,children:"Within 100 mi"}),e.jsx("option",{value:5e3,children:"Anywhere"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.length===0?e.jsx("div",{className:"col-span-full text-center py-12 bg-white dark:bg-[#2c2e36] rounded-xl border border-dashed dark:border-gray-700 text-gray-500",children:"No open sessions found."}):n.map(u=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all group relative overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 right-0 bg-brand-blue text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg",children:["BUDGET: $",u.offerAmount||"N/A"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 flex justify-between",children:[e.jsx("span",{children:u.serviceType}),typeof u.distance=="number"&&e.jsxs("span",{className:"text-brand-blue flex items-center gap-1",children:[e.jsx(Te,{size:10})," ",u.distance.toFixed(1)," mi"]})]}),e.jsx("h4",{className:"text-lg font-bold dark:text-white truncate pr-16",children:u.targetName||"Session Request"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-300 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{size:14})," ",u.senderName]}),u.date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{size:14})," ",u.date==="Flexible"?"Flexible":new Date(u.date).toLocaleDateString()]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:u.requirements&&u.requirements.slice(0,3).map((g,y)=>e.jsx("span",{className:"text-[10px] bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-600 dark:text-gray-300 border dark:border-gray-600",children:g.value},y))}),e.jsx("div",{className:"flex gap-2",children:u.senderId===t.uid?e.jsxs("button",{onClick:()=>v(u.id),className:"w-full bg-red-100 text-red-600 py-2.5 rounded-lg font-bold text-sm hover:bg-red-200 transition flex items-center justify-center gap-2",children:[e.jsx($e,{size:16})," Cancel"]}):e.jsxs("button",{onClick:()=>x(u),className:"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-2.5 rounded-lg font-bold text-sm hover:opacity-90 transition flex justify-center items-center gap-2",children:["View & Bid ",e.jsx(dt,{size:16})]})})]},u.id))}),p&&e.jsx(zi,{user:t,userData:s,broadcast:p,onClose:()=>x(null)})]})}const Js=[{id:"computer_audio_and_interfaces",label:"Computer Audio & Interfaces"},{id:"microphones_and_input_transducers",label:"Microphones"},{id:"mixing_consoles_and_control",label:"Mixing Consoles"},{id:"monitoring_and_playback",label:"Monitoring & Playback"},{id:"outboard_signal_processing",label:"Outboard Gear"}],Va=()=>{const[t,s]=r.useState({}),[a,i]=r.useState(!0);return r.useEffect(()=>{(async()=>{i(!0);const n={};try{const o=`artifacts/${ee}/public/data/equipment_database`;await Promise.all(Js.map(async p=>{const x=W(P,o,p.id),b=D(x,"items"),m=await He(b),h={};m.forEach(d=>{h[d.id]=d.data()}),n[p.id]=h})),s(n)}catch(o){console.error("Failed to load equipment database:",o)}i(!1)})()},[]),{loading:a,data:t,categories:Js}};function Ei({user:t,userData:s,onBack:a,onSuccess:i}){const{loading:l,data:n,categories:o}=Va(),[p,x]=r.useState(2),b=[5,10,15,25,50,100,250,500],m=b[p],[h,d]=r.useState({lat:34.0522,lng:-118.2437,name:"Default"});r.useEffect(()=>{(async()=>{if(s!=null&&s.zip){const ie=await is(s.zip);if(ie){d({lat:ie.lat,lng:ie.lng,name:ie.cityState});return}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(ie=>{d({lat:ie.coords.latitude,lng:ie.coords.longitude,name:"Current Location"})})})()},[s]);const v=O=>{O.lat&&O.lng&&d({lat:O.lat,lng:O.lng,name:O.cityState||"Selected Location"})},[u,g]=r.useState("Musician"),[y,c]=r.useState("Play"),[k,N]=r.useState(""),[f,S]=r.useState(""),[j,C]=r.useState(""),[R,E]=r.useState(""),[w,z]=r.useState(""),[A,q]=r.useState(""),[G,H]=r.useState(""),[J,M]=r.useState("Any"),[L,_]=r.useState("Flat Rate"),[B,U]=r.useState([{id:Date.now(),type:"General",value:""}]),Q=Qt.filter(O=>O!=="Technician"),xe=O=>{switch(O){case"Musician":return["Play","Compose","Improvise"];case"Engineer":return["Mix","Master","Record","Edit"];case"Producer":return["Produce","Remix","Arrange"];case"Studio":return["Host Session","Rent Gear"];default:return["Work"]}},ye=()=>U([...B,{id:Date.now(),type:"Gear",value:"",gearSelection:{}}]),pe=O=>{B.length!==1&&U(B.filter(ie=>ie.id!==O))},ce=(O,ie,ne)=>U(B.map(V=>V.id===O?{...V,[ie]:ne}:V)),he=(O,ie,ne)=>{U(B.map(V=>{if(V.id!==O)return V;const ae={...V.gearSelection,[ie]:ne};return ie==="category"&&(delete ae.subCategory,delete ae.type,delete ae.item),ie==="subCategory"&&(delete ae.type,delete ae.item),ie==="type"&&delete ae.item,{...V,gearSelection:ae,value:ne}}))},ue=async()=>{if(!j||!f)return alert("Please complete the request sentence.");if(u==="Musician"&&y==="Play"&&!k)return alert("Please select an instrument.");const O=B.filter(ne=>ne.value.trim()!=="");let ie=`${u} - ${y}`;k&&(ie+=` ${k}`);try{await Ee(D(P,`artifacts/${ee}/public/data/bookings`),{senderId:t.uid,senderName:"Broadcast Request",targetId:"BROADCAST",targetName:j,role:u,action:y,instrument:k||null,genre:f,serviceType:ie,date:R||"Flexible",time:w||"Flexible",offerAmount:A?parseInt(A):null,references:G,experienceLevel:J,paymentType:L,requirements:O,message:O.map(ne=>`[${ne.type}] ${ne.value}`).join(`
`),range:m,status:"Broadcasting",type:"Broadcast",location:{lat:h.lat,lng:h.lng},timestamp:X()}),alert(`Broadcast sent to ${u}s within ${m} miles!`),i()}catch(ne){console.error(ne),alert("Failed to send broadcast.")}},fe=[{label:"Gear / Equipment",value:"Gear",icon:ht},{label:"Technique / Skill",value:"Technique",icon:je},{label:"Feel / Vibe",value:"Vibe",icon:mt},{label:"Logistics",value:"Logistics",icon:qe},{label:"General Note",value:"General",icon:Nr}];return e.jsxs("div",{className:"max-w-5xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-lg text-brand-blue",children:e.jsx(Te,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold dark:text-white",children:"Broadcast Builder"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Reach professionals in your area."})]})]}),e.jsx("button",{onClick:a,className:"text-sm font-medium text-gray-500 hover:text-brand-blue transition",children:"Cancel & Exit"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"lg:col-span-4 space-y-5",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-5 rounded-2xl border dark:border-gray-700",children:[e.jsx(qa,{initialZip:s==null?void 0:s.zip,onLocationChange:v,label:"Broadcast Center"}),e.jsxs("div",{className:"mt-4 flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-extrabold text-gray-400 uppercase tracking-wider",children:"Range"}),e.jsxs("span",{className:"bg-brand-blue text-white text-xs font-bold px-2 py-1 rounded-md",children:[m," Miles"]})]}),e.jsx("div",{className:"mb-5 rounded-xl overflow-hidden border dark:border-gray-600 shadow-md relative h-48",children:e.jsx(Wa,{center:[h.lat,h.lng],zoom:9,height:"100%",drawRadius:!0,radiusMiles:m})}),e.jsx("input",{type:"range",min:"0",max:b.length-1,value:p,onChange:O=>x(parseInt(O.target.value)),className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-brand-blue"})]})}),e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl border-2 border-blue-100 dark:border-gray-700 shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-brand-blue"}),e.jsx("label",{className:"text-xs font-extrabold text-brand-blue uppercase tracking-widest mb-4 block",children:"Step 1: Core Request"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-lg md:text-xl text-gray-700 dark:text-gray-200 leading-relaxed font-medium",children:[e.jsx("span",{children:"I need a"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("select",{value:u,onChange:O=>{g(O.target.value),c(xe(O.target.value)[0])},className:"appearance-none bg-blue-50 dark:bg-gray-700 text-blue-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-blue-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-blue-100 dark:hover:bg-gray-600 transition",children:Q.map(O=>e.jsx("option",{value:O,children:O},O))}),e.jsx(et,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-blue-500 dark:text-gray-400 pointer-events-none",size:16})]}),e.jsx("span",{children:"that can"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("select",{value:y,onChange:O=>c(O.target.value),className:"appearance-none bg-purple-50 dark:bg-gray-700 text-purple-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-purple-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-purple-100 dark:hover:bg-gray-600 transition",children:xe(u).map(O=>e.jsx("option",{value:O,children:O},O))}),e.jsx(et,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-purple-500 dark:text-gray-400 pointer-events-none",size:16})]}),(y==="Play"||y==="Improvise")&&e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("select",{value:k,onChange:O=>N(O.target.value),className:"appearance-none bg-green-50 dark:bg-gray-700 text-green-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-green-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-green-100 dark:hover:bg-gray-600 transition",children:[e.jsx("option",{value:"",children:"(Select Instrument)"}),Object.entries(zl).map(([O,ie])=>e.jsx("optgroup",{label:O,children:ie.map(ne=>e.jsx("option",{value:ne,children:ne},ne))},O))]}),e.jsx(et,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-green-500 dark:text-gray-400 pointer-events-none",size:16})]}),e.jsx("span",{children:"for a song in the"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("select",{value:f,onChange:O=>S(O.target.value),className:"appearance-none bg-orange-50 dark:bg-gray-700 text-orange-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-orange-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-orange-100 dark:hover:bg-gray-600 transition",children:[e.jsx("option",{value:"",children:"(Select Genre)"}),Pl.map(O=>e.jsx("option",{value:O,children:O},O))]}),e.jsx(et,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-orange-500 dark:text-gray-400 pointer-events-none",size:16})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase mb-2 block",children:"Project Title"}),e.jsx("input",{className:"w-full bg-gray-50 dark:bg-black/20 border-none rounded-lg p-3 text-gray-700 dark:text-gray-200 font-medium placeholder-gray-400 focus:ring-2 focus:ring-brand-blue",placeholder:"e.g. Summer Hit Single - Drum Tracking",value:j,onChange:O=>C(O.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-5 rounded-xl border dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Logistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Date"}),e.jsx("input",{type:"date",className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:R,onChange:O=>E(O.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Time"}),e.jsx("input",{type:"time",className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:w,onChange:O=>z(O.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Budget ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-2.5 text-green-500",size:14}),e.jsx("input",{type:"number",className:"w-full pl-8 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm font-bold",placeholder:"Flexible",value:A,onChange:O=>q(O.target.value)})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-5 rounded-xl border dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Project Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Payment Type"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:L,onChange:O=>_(O.target.value),children:[e.jsx("option",{children:"Flat Rate"}),e.jsx("option",{children:"Hourly"}),e.jsx("option",{children:"Royalty Split"}),e.jsx("option",{children:"Trade / Barter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Experience Required"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:J,onChange:O=>M(O.target.value),children:[e.jsx("option",{children:"Any"}),e.jsx("option",{children:"Intermediate"}),e.jsx("option",{children:"Pro / Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Reference Link"}),e.jsxs("div",{className:"relative",children:[e.jsx(vr,{className:"absolute left-3 top-2.5 text-gray-400",size:14}),e.jsx("input",{className:"w-full pl-8 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Spotify / SoundCloud...",value:G,onChange:O=>H(O.target.value)})]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsx("label",{className:"text-xs font-extrabold text-brand-blue uppercase tracking-widest",children:"Step 2: Specific Needs"}),e.jsxs("button",{onClick:ye,className:"text-xs bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-white px-3 py-1.5 rounded-full font-bold flex items-center gap-1 transition",children:[e.jsx(lt,{size:14})," Add Condition"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:B.map(O=>{var ie,ne,V,ae,ve,Xe,Ye;return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 bg-gray-50 dark:bg-black/20 p-3 rounded-xl border dark:border-gray-700 animate-in slide-in-from-bottom-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 min-w-[140px]",children:e.jsx("select",{className:"w-full p-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2c2e36] dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:O.type,onChange:de=>ce(O.id,"type",de.target.value),children:fe.map(de=>e.jsx("option",{value:de.value,children:de.label},de.value))})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[O.type==="Gear"&&!l?e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsxs("select",{className:"w-full p-2 text-xs border rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:((ie=O.gearSelection)==null?void 0:ie.category)||"",onChange:de=>he(O.id,"category",de.target.value),children:[e.jsx("option",{value:"",children:"Select Category..."}),o.map(de=>e.jsx("option",{value:de.id,children:de.label},de.id))]}),((ne=O.gearSelection)==null?void 0:ne.category)&&n[O.gearSelection.category]&&e.jsxs("select",{className:"w-full p-2 text-xs border rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:((V=O.gearSelection)==null?void 0:V.subCategory)||"",onChange:de=>he(O.id,"subCategory",de.target.value),children:[e.jsx("option",{value:"",children:"Select Type..."}),Object.keys(n[O.gearSelection.category]).map(de=>e.jsx("option",{value:de,children:de.replace(/_/g," ")},de))]}),((ae=O.gearSelection)==null?void 0:ae.subCategory)&&e.jsxs("select",{className:"w-full p-2 text-xs border rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:((ve=O.gearSelection)==null?void 0:ve.type)||"",onChange:de=>he(O.id,"type",de.target.value),children:[e.jsx("option",{value:"",children:"Select Subtype..."}),Object.keys(n[O.gearSelection.category][O.gearSelection.subCategory]).map(de=>e.jsx("option",{value:de,children:de.replace(/_/g," ")},de))]}),((Xe=O.gearSelection)==null?void 0:Xe.type)&&e.jsxs("select",{className:"w-full p-2 text-sm font-bold border-l-4 border-brand-blue rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white shadow-sm",value:((Ye=O.gearSelection)==null?void 0:Ye.item)||"",onChange:de=>he(O.id,"item",de.target.value),children:[e.jsx("option",{value:"",children:"Select Specific Item..."}),n[O.gearSelection.category][O.gearSelection.subCategory][O.gearSelection.type].map(de=>e.jsx("option",{value:de,children:de},de))]})]}):e.jsx("input",{className:"w-full p-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2c2e36] dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-brand-blue",placeholder:"Describe requirement...",value:O.value,onChange:de=>ce(O.id,"value",de.target.value)}),e.jsx("button",{onClick:()=>pe(O.id),className:"text-gray-400 hover:text-red-500 px-2",children:e.jsx($e,{size:18})})]})]},O.id)})}),e.jsx("div",{className:"h-6 w-0.5 bg-gray-200 dark:bg-gray-700 mx-auto my-2"}),e.jsxs("button",{className:"w-full bg-gradient-to-r from-brand-blue to-blue-600 text-white py-4 rounded-xl font-bold shadow-lg hover:scale-[1.01] transition-all text-lg flex items-center justify-center gap-2",onClick:ue,children:[e.jsx(je,{fill:"currentColor",size:20})," Broadcast Opportunity"]})]})]})]})]})}function Ai({user:t,userData:s,target:a,onClose:i}){var g;const[l,n]=r.useState(!1),[o,p]=r.useState([]),[x,b]=r.useState("me"),m=(g=s==null?void 0:s.accountTypes)==null?void 0:g.some(y=>["Label","Agent"].includes(y)),[h,d]=r.useState({date:"",time:"",duration:2,serviceType:"Session",offerAmount:a.rate?a.rate*2:100,message:""});r.useEffect(()=>{m&&(async()=>{try{const k=(await He(D(P,Z(t.uid).labelRoster(t.uid)))).docs.map(N=>({id:N.id,...N.data()}));p(k)}catch(c){console.error("Roster fetch error",c)}})()},[m,t.uid]);const v=y=>{const c=y.target.value,k=c===""?"":parseInt(c);d(N=>({...N,duration:k,offerAmount:k&&a.rate?a.rate*k:N.offerAmount}))},u=async()=>{if(!h.date||!h.time||!h.message)return alert("Please fill in all required fields.");if(!h.duration||h.duration<=0)return alert("Duration must be at least 1 hour.");n(!0);try{const y=new Date(`${h.date}T${h.time}`);let c={senderId:t.uid,senderName:`${s.firstName} ${s.lastName}`,onBehalfOf:null};if(x!=="me"){const k=o.find(N=>N.artistId===x);k&&(c.senderName=`${s.firstName} (for ${k.name})`,c.onBehalfOf={id:k.artistId,name:k.name,photo:k.photoURL})}await Ee(D(P,`artifacts/${ee}/public/data/bookings`),{...c,targetId:a.id,targetName:a.firstName?`${a.firstName} ${a.lastName}`:a.name,serviceType:h.serviceType,date:h.date,time:h.time,duration:Number(h.duration),offerAmount:Number(h.offerAmount),message:h.message,status:"Pending",timestamp:X(),bookingStart:y,type:"Direct"}),alert("Booking request sent successfully!"),i()}catch(y){console.error("Booking failed:",y),alert("Failed to send booking request.")}n(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-in fade-in zoom-in-95",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Book Session"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["with ",e.jsx("span",{className:"text-brand-blue font-bold",children:a.firstName||a.name})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition text-gray-500 dark:text-gray-400",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto space-y-5",children:[m&&o.length>0&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-3 rounded-xl border border-purple-100 dark:border-purple-800",children:[e.jsxs("label",{className:"text-xs font-bold text-purple-700 dark:text-purple-300 uppercase mb-1 flex items-center gap-1",children:[e.jsx(ot,{size:12})," Booking On Behalf Of:"]}),e.jsxs("select",{className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-purple-800/50 dark:text-white text-sm font-bold",value:x,onChange:y=>b(y.target.value),children:[e.jsxs("option",{value:"me",children:["Myself (",s.firstName,")"]}),o.map(y=>e.jsxs("option",{value:y.artistId,children:["Artist: ",y.name]},y.artistId))]})]}),a.rate&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl border border-blue-100 dark:border-blue-800 flex items-center gap-2 text-xs text-blue-700 dark:text-blue-300",children:[e.jsx(Fe,{size:14}),e.jsxs("span",{children:["Standard Rate: ",e.jsxs("strong",{children:["$",a.rate,"/hr"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{type:"date",className:"w-full pl-10 p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:h.date,onChange:y=>d({...h,date:y.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Start Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{type:"time",className:"w-full pl-10 p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:h.time,onChange:y=>d({...h,time:y.target.value})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Duration (Hrs)"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm font-bold",value:h.duration,onChange:v})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Total Offer ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-2.5 text-green-500",size:16}),e.jsx("input",{type:"number",className:"w-full pl-9 p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm font-bold text-green-600",value:h.offerAmount,onChange:y=>d({...h,offerAmount:y.target.value})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Type"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:h.serviceType,onChange:y=>d({...h,serviceType:y.target.value}),children:[e.jsx("option",{children:"Session"}),e.jsx("option",{children:"Lesson"}),e.jsx("option",{children:"Consultation"}),e.jsx("option",{children:"Mixing/Mastering"}),e.jsx("option",{children:"Rehearsal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Message / Requirements"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm min-h-[100px] resize-none",placeholder:"Describe what you need...",value:h.message,onChange:y=>d({...h,message:y.target.value})})]})]}),e.jsx("div",{className:"p-5 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("button",{onClick:u,disabled:l,className:"w-full bg-brand-blue text-white py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 shadow-lg disabled:opacity-50",children:l?e.jsx(K,{className:"animate-spin"}):"Send Request"})})]})})}const Li=Ns({sessionName:Se().min(3,"Session name must be at least 3 chars"),date:Se().optional(),time:Se().optional(),duration:Gt().min(1).max(24)});function Ii({user:t,userData:s,cart:a,onRemoveFromCart:i,onClose:l,onComplete:n}){const[o,p]=r.useState(!1),{register:x,handleSubmit:b,watch:m,formState:{errors:h,isValid:d}}=ks({resolver:ws(Li),defaultValues:{sessionName:`${s.lastName} Session`,duration:4,date:"",time:""},mode:"onChange"}),v=m("duration")||0,u=()=>{let j=0;const C=parseInt(v)||0,R=a.map(A=>{const q=A.rate||0,G=q*C;return j+=G,{...A,itemTotal:G,hourlyRate:q}}),E=a.length>=3,w=E?j*.1:0,z=j-w;return{subtotal:j,discountAmount:w,finalTotal:z,lineItems:R,shouldDiscount:E}},{subtotal:g,discountAmount:y,finalTotal:c,lineItems:k,shouldDiscount:N}=u(),f=async j=>{p(!0);const C=I.loading("Initializing Session...");try{let R=null;const E=`session_${Date.now()}`,w=k.map(z=>{var A;return Ee(D(P,`artifacts/${ee}/public/data/bookings`),{groupId:E,sessionName:j.sessionName,senderId:t.uid,senderName:`${s.firstName} ${s.lastName}`,targetId:z.id,targetName:`${z.firstName} ${z.lastName}`,serviceType:((A=z.accountTypes)==null?void 0:A[0])||"Session",date:j.date||"Flexible",time:j.time||"Flexible",duration:j.duration,offerAmount:z.itemTotal*(N?.9:1),status:"Pending",paymentIntentId:R,timestamp:X(),type:"GroupSession"})});await Promise.all(w),I.success("Session Created!",{id:C}),n()}catch(R){console.error("Booking Error:",R),I.error("Failed: "+R.message,{id:C})}finally{p(!1)}},S=j=>fa("w-full p-2 border rounded-lg dark:bg-black/20 dark:text-white transition-colors focus:ring-2 focus:ring-brand-blue outline-none",j?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-600");return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-in fade-in",children:e.jsxs("form",{onSubmit:b(f),className:"bg-white dark:bg-[#2c2e36] w-full max-w-2xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] rounded-t-2xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(_e,{className:"text-brand-blue"})," Session Builder"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.length," Members Selected"]})]}),e.jsx("button",{type:"button",onClick:l,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Session Name"}),e.jsx("input",{...x("sessionName"),className:S(h.sessionName),placeholder:"e.g. My Album Recording"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date (Optional)"}),e.jsx("input",{type:"date",...x("date"),className:S(h.date)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time (Optional)"}),e.jsx("input",{type:"time",...x("time"),className:S(h.time)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Duration (Hours)"}),e.jsx("input",{type:"number",...x("duration",{valueAsNumber:!0}),className:S(h.duration)})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-bold dark:text-white mb-3",children:"Session Roster"}),e.jsxs("div",{className:"space-y-2",children:[a.map(j=>{var C;return e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-[#2c2e36] p-2 rounded-lg border dark:border-gray-600 shadow-sm animate-in slide-in-from-right-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold",children:j.firstName[0]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-bold dark:text-white",children:[j.firstName," ",j.lastName]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(C=j.accountTypes)==null?void 0:C[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-mono",children:["$",j.rate,"/hr"]}),e.jsx("button",{type:"button",onClick:()=>i(j.id),className:"text-red-400 hover:text-red-600 transition-colors",children:e.jsx($e,{size:14})})]})]},j.id)}),a.length===0&&e.jsx("div",{className:"text-center text-xs text-gray-400 py-4 italic",children:"No members added yet."})]})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ce,{size:20})," Cost Breakdown"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-800 transition-all",children:[e.jsx("div",{className:"space-y-2 mb-4 text-sm",children:k.map(j=>e.jsxs("div",{className:"flex justify-between text-blue-900 dark:text-blue-100",children:[e.jsxs("span",{children:[j.firstName," (",j.accountTypes[0],") x ",v,"hrs"]}),e.jsxs("span",{className:"font-mono",children:["$",j.itemTotal.toFixed(2)]})]},j.id))}),e.jsxs("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-blue-800 dark:text-blue-300 font-bold",children:"Subtotal"}),e.jsxs("span",{className:"text-blue-800 dark:text-blue-300 font-bold font-mono",children:["$",g.toFixed(2)]})]}),N&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400 font-bold mt-2 animate-in slide-in-from-right-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{size:14,fill:"currentColor"})," Bundle Discount (10%)"]}),e.jsxs("span",{className:"font-mono",children:["-$",y.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-2xl font-black dark:text-white",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{className:"font-mono",children:["$",c.toFixed(2)]})]})]})]})]}),e.jsx("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] rounded-b-2xl",children:e.jsx("button",{type:"submit",disabled:o||a.length===0||!d,className:ya("w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg flex items-center justify-center gap-2",o||a.length===0||!d?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"),children:o?e.jsx(K,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{size:20})," Confirm & Book"]})})})]})})}const gs=[{id:"Pending",label:"Created",icon:Pe},{id:"Confirmed",label:"Deposit",icon:Ce},{id:"En Route",label:"En Route",icon:ja},{id:"In Progress",label:"Started",icon:kr},{id:"Completed",label:"Done",icon:re}];function $i({booking:t,user:s,onClose:a}){var v;const[i,l]=r.useState(t.status),[n,o]=r.useState(!1),p=s.uid===t.targetId,x=s.uid===t.senderId,m=(u=>{const g=gs.findIndex(y=>y.id===u);return g===-1?0:g})(i),h=async u=>{o(!0);try{await te(W(P,`artifacts/${ee}/public/data/bookings`,t.id),{status:u,[`statusTimestamps.${u}`]:X()}),l(u),I.success(`Session ${u}`)}catch(g){console.error("Update failed:",g),I.error("Failed to update status")}o(!1)},d=m/(gs.length-1)*100;return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[90] p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-3xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:["Session Details ",e.jsxs("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded-full font-medium",children:["#",t.id.slice(-6).toUpperCase()]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["With ",x?t.targetName:t.senderName]})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"relative pt-4 pb-8 px-4",children:[e.jsx("div",{className:"absolute top-8 left-0 w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full -z-10"}),e.jsx("div",{className:"absolute top-8 left-0 h-1.5 bg-brand-blue rounded-full -z-10 transition-all duration-700 ease-in-out",style:{width:`${d}%`}}),e.jsx("div",{className:"flex justify-between",children:gs.map((u,g)=>{const y=g<=m,c=g===m;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`
                                                w-10 h-10 rounded-full flex items-center justify-center border-4 transition-all duration-500
                                                ${y?"bg-brand-blue border-white dark:border-[#2c2e36] text-white":"bg-gray-200 dark:bg-gray-700 border-white dark:border-[#2c2e36] text-gray-400"}
                                                ${c?"scale-125 shadow-lg ring-4 ring-blue-100 dark:ring-blue-900/50":""}
                                            `,children:e.jsx(u.icon,{size:c?18:16,fill:y?"currentColor":"none"})}),e.jsx("span",{className:`text-xs font-bold uppercase tracking-wider transition-colors ${y?"text-brand-blue":"text-gray-400"}`,children:u.label})]},u.id)})})]}),p&&i!=="Completed"&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-blue-800 dark:text-blue-300",children:"Update Session Status"}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Keep the client informed."})]}),e.jsxs("div",{className:"flex gap-2",children:[i==="Pending"&&e.jsx("button",{onClick:()=>h("Confirmed"),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-green-700 transition shadow-sm",children:"Accept & Confirm"}),i==="Confirmed"&&e.jsxs("button",{onClick:()=>h("En Route"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-blue-700 transition shadow-sm flex items-center gap-1",children:[e.jsx(ja,{size:14})," I'm En Route"]}),i==="En Route"&&e.jsxs("button",{onClick:()=>h("In Progress"),className:"bg-purple-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-purple-700 transition shadow-sm flex items-center gap-1",children:[e.jsx(ba,{size:14})," Start Session"]}),i==="In Progress"&&e.jsxs("button",{onClick:()=>h("Completed"),className:"bg-gray-900 dark:bg-white dark:text-black text-white px-4 py-2 rounded-lg font-bold text-xs hover:opacity-90 transition shadow-sm flex items-center gap-1",children:[e.jsx(re,{size:14})," Complete Session"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase border-b dark:border-gray-700 pb-2",children:"Logistics"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(Pe,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Date"}),e.jsx("div",{className:"dark:text-white font-medium",children:t.date})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(qe,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Time"}),e.jsxs("div",{className:"dark:text-white font-medium",children:[t.time," (",t.duration," hrs)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(Te,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Location"}),e.jsx("div",{className:"dark:text-white font-medium",children:((v=t.venue)==null?void 0:v.name)||"Remote / TBD"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase border-b dark:border-gray-700 pb-2",children:"Financials"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(Ce,{size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Total Value"}),e.jsxs("div",{className:"dark:text-white font-mono font-bold text-lg",children:["$",t.offerAmount]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(Lt,{size:20,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Agreement"}),e.jsx("div",{className:"text-brand-blue text-xs font-bold cursor-pointer hover:underline",children:"View Contract"})]})]})]})]}),t.message&&e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Notes"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 italic",children:['"',t.message,'"']})]})]})]})})}function Ti({user:t,userData:s,openPublicProfile:a}){var _;const[i,l]=r.useState("search"),[n,o]=r.useState("list"),[p,x]=r.useState("outgoing"),[b,m]=r.useState([]),[h,d]=r.useState([]),[v,u]=r.useState(!0),[g,y]=r.useState("wizard"),[c,k]=r.useState(!1),[N,f]=r.useState({date:"",time:"",location:null,radius:25,urgency:"Normal",venue:null}),[S,j]=r.useState([]),[C,R]=r.useState(!1),[E,w]=r.useState(null),[z,A]=r.useState(null);r.useEffect(()=>{if(!(t!=null&&t.uid))return;u(!0);const B=me(D(P,`artifacts/${ee}/public/data/bookings`),we("senderId","==",t.uid)),U=me(D(P,`artifacts/${ee}/public/data/bookings`),we("targetId","==",t.uid)),Q=ge(B,ye=>{d(ye.docs.map(pe=>({id:pe.id,...pe.data()}))),u(!1)}),xe=ge(U,ye=>{m(ye.docs.map(pe=>({id:pe.id,...pe.data()}))),u(!1)});return()=>{Q(),xe()}},[t==null?void 0:t.uid]);const q=B=>{w(B),R(!0)},G=()=>y("talent"),H=B=>{if(S.find(U=>U.id===B.id))return I.error("Already added.");j([...S,B]),I.success("Added to Session")},J=B=>j(S.filter(U=>U.id!==B)),M=()=>{k(!1),y("wizard"),j([]),f({date:"",time:"",location:null,radius:25,urgency:"Normal",venue:null}),l("requests")},L=(B,U)=>B.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400 border-2 border-dashed dark:border-gray-700 rounded-2xl",children:[e.jsx(Pe,{size:48,className:"mb-4 opacity-20"}),e.jsxs("p",{children:["No ",U==="outgoing"?"outgoing":"incoming"," bookings found."]})]}):e.jsx("div",{className:"grid gap-4",children:B.map(Q=>{var xe,ye;return e.jsx("div",{onClick:()=>A(Q),className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm hover:border-brand-blue transition group cursor-pointer",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-lg font-bold",children:U==="outgoing"?(xe=Q.targetName)==null?void 0:xe[0]:(ye=Q.senderName)==null?void 0:ye[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:U==="outgoing"?Q.targetName:Q.senderName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-xs",children:Q.serviceType||"Session"}),Q.date&&e.jsxs("span",{children:["• ",Q.date]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide inline-block mb-1 ${Q.status==="Pending"?"bg-yellow-100 text-yellow-700":Q.status==="Confirmed"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:Q.status}),e.jsxs("div",{className:"font-mono font-bold dark:text-white",children:["$",Q.offerAmount]})]})]})},Q.id)})});return e.jsxs("div",{className:"max-w-7xl mx-auto relative min-h-screen pb-20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-end mb-6 border-b dark:border-gray-700 gap-4",children:[e.jsxs("div",{className:"flex gap-6 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>l("broadcasts"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${i==="broadcasts"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(je,{size:16})," Open Jobs"]}),e.jsxs("button",{onClick:()=>l("search"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${i==="search"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Ge,{size:16})," Talent Search"]})]}),e.jsxs("div",{className:"flex gap-6 w-full sm:w-auto justify-end",children:[e.jsxs("button",{onClick:()=>l("planner"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${i==="planner"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Pe,{size:16})," Session Planner"]}),e.jsxs("button",{onClick:()=>l("requests"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${i==="requests"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(qe,{size:16})," My Bookings"]})]})]}),e.jsxs("div",{className:"tab-content-wrapper",children:[i==="broadcasts"&&e.jsx("div",{className:"tab-content",children:n==="create_broadcast"?e.jsx(Ei,{user:t,userData:s,onBack:()=>o("list"),onSuccess:()=>o("list")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>o("create_broadcast"),className:"bg-brand-blue text-white px-4 py-2 rounded-lg font-bold text-sm shadow-lg hover:bg-blue-600 transition flex items-center gap-2",children:[e.jsx(je,{size:16})," New Broadcast"]})}),e.jsx(Pi,{user:t,userData:s})]})},"broadcasts"),i==="search"&&e.jsx("div",{className:"tab-content",children:e.jsx(Xs,{user:t,userData:s,openPublicProfile:a,onBook:q,mode:"direct"})},"search"),i==="requests"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Booking Management"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Track your sessions and requests."})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex",children:[e.jsx("button",{onClick:()=>x("outgoing"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${p==="outgoing"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"I Booked"}),e.jsx("button",{onClick:()=>x("incoming"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${p==="incoming"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"Booked Me"})]})]}),p==="outgoing"?L(h,"outgoing"):L(b,"incoming")]},"requests"),i==="planner"&&e.jsxs("div",{className:"tab-content",children:[g==="wizard"&&e.jsx(Ri,{userData:s,sessionParams:N,setSessionParams:f,onNext:G}),g==="talent"&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 mb-6 flex justify-between items-center shadow-lg sticky top-4 z-40",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Pe,{size:18,className:"text-brand-blue"})," ",N.date||"Flexible Date"," @ ",((_=N.venue)==null?void 0:_.name)||"Remote"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[S.length," talent added"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y("wizard"),className:"text-xs font-bold text-gray-500 hover:text-gray-900 dark:hover:text-white px-3 py-2",children:"Back"}),e.jsxs("button",{onClick:()=>k(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-green-700 shadow flex items-center gap-2",children:[e.jsx(re,{size:16})," Review Session"]})]})]}),e.jsx(Xs,{user:t,userData:s,openPublicProfile:a,onAddToCart:H,sessionCartIds:S.map(B=>B.id),mode:"planner"})]})]},"planner")]}),e.jsxs(e.Fragment,{children:[C&&E&&e.jsx(Ai,{user:t,userData:s,target:E,allInstruments:[],onClose:()=>R(!1)}),c&&e.jsx(Ii,{user:t,userData:s,cart:[...N.venue&&N.venue.id!=="remote"?[{...N.venue,accountTypes:["Studio"]}]:[],...S],onRemoveFromCart:J,onClose:()=>k(!1),onComplete:M}),z&&e.jsx($i,{booking:z,user:t,onClose:()=>A(null)})]})]})}const Mi=({data:t,setData:s})=>e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-4",children:"Release Essentials"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Title"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.title,onChange:a=>s({...t,title:a.target.value}),placeholder:"e.g. Dark Side of the Moon"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Artist"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.primaryArtist,onChange:a=>s({...t,primaryArtist:a.target.value}),placeholder:"e.g. Pink Floyd"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Type"}),e.jsx("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.type,onChange:a=>s({...t,type:a.target.value}),children:El.map(a=>e.jsx("option",{value:a.id,children:a.label},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Genre"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.genre,onChange:a=>s({...t,genre:a.target.value}),children:[e.jsx("option",{value:"",children:"Select Genre..."}),Al.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Date"}),e.jsx("input",{type:"date",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.releaseDate,onChange:a=>s({...t,releaseDate:a.target.value})}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Standard: 2 weeks out. Express: 48hrs."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Label Name"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.labelName,onChange:a=>s({...t,labelName:a.target.value}),placeholder:"Optional (Default: Independent)"})]})]})]}),Fi=({data:t,setData:s,user:a})=>{const{uploadMedia:i,uploading:l}=xt(),[n,o]=r.useState(t.artworkUrl||null),[p,x]=r.useState(""),b=async m=>{const h=m.target.files[0];if(!h)return;const d=new Image;d.src=URL.createObjectURL(h),d.onload=async()=>{if(d.width<3e3||d.height<3e3){x("Error: Image must be at least 3000 x 3000 pixels.");return}d.width!==d.height?x("Warning: Image should be a perfect square (1:1 ratio)."):x("");const v=await i(h,`distribution/${a.uid}/artwork`);v!=null&&v.url&&(o(v.url),s({...t,artworkUrl:v.url}))}};return e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 animate-in slide-in-from-right-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Cover Art"}),e.jsx("p",{className:"text-sm text-gray-500",children:"3000 x 3000 px • JPG or PNG • No Blurry Text"})]}),e.jsxs("div",{className:"relative group w-64 h-64 bg-gray-100 dark:bg-[#1f2128] rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center overflow-hidden",children:[n?e.jsx("img",{src:n,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"text-gray-400 flex flex-col items-center",children:[e.jsx(It,{size:48,className:"mb-2"}),e.jsx("span",{className:"text-xs font-bold",children:"Click to Upload"})]}),e.jsxs("label",{className:"absolute inset-0 cursor-pointer bg-black/0 hover:bg-black/20 transition flex items-center justify-center",children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/png, image/jpeg",onChange:b,disabled:l}),l&&e.jsx(K,{className:"animate-spin text-white",size:32})]})]}),p&&e.jsxs("div",{className:"text-red-500 text-sm font-bold flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[e.jsx(Fe,{size:16})," ",p]})]})},Oi=({data:t,setData:s,user:a})=>{var x,b;const{uploadMedia:i,uploading:l}=xt(),n=async m=>{if(!m.name.toLowerCase().endsWith(".wav")){alert("Only .WAV files are accepted for distribution.");return}const h={id:Date.now(),title:m.name.replace(".wav",""),fileUrl:"",status:"uploading",isExplicit:!1,isInstrumental:!1},d=[...t.tracks||[],h];s({...t,tracks:d});try{const v=await i(m,`distribution/${a.uid}/audio_vault`);if(v!=null&&v.url){const u=d.map(g=>g.id===h.id?{...g,fileUrl:v.url,status:"ready",duration:0}:g);s({...t,tracks:u})}}catch(v){console.error("Track upload failed",v),alert("Upload failed.")}},o=m=>{s({...t,tracks:t.tracks.filter(h=>h.id!==m)})},p=(m,h,d)=>{s({...t,tracks:t.tracks.map(v=>v.id===m?{...v,[h]:d}:v)})};return e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Audio"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Stereo WAV files only (16-bit / 44.1kHz minimum)"})]}),e.jsxs("label",{className:"bg-brand-blue hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs cursor-pointer flex items-center gap-2 transition",children:[e.jsx(Mt,{size:14})," Add Track",e.jsx("input",{type:"file",className:"hidden",accept:".wav",onChange:m=>n(m.target.files[0]),disabled:l})]})]}),e.jsxs("div",{className:"space-y-3",children:[((x=t.tracks)==null?void 0:x.length)===0&&e.jsx("div",{className:"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400",children:"No tracks added yet."}),(b=t.tracks)==null?void 0:b.map((m,h)=>e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded text-gray-500 font-mono text-xs",children:["#",h+1]}),e.jsx("div",{className:"font-bold dark:text-white text-sm",children:m.status==="uploading"?e.jsxs("span",{className:"flex items-center gap-2 text-brand-blue",children:[e.jsx(K,{className:"animate-spin",size:14})," Uploading..."]}):m.title})]}),e.jsx("button",{onClick:()=>o(m.id),className:"text-gray-400 hover:text-red-500",children:e.jsx(le,{size:16})})]}),m.status==="ready"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("input",{className:"col-span-2 p-2 text-xs border rounded bg-transparent dark:border-gray-600 dark:text-white",placeholder:"Track Title",value:m.title,onChange:d=>p(m.id,"title",d.target.value)}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.isExplicit,onChange:d=>p(m.id,"isExplicit",d.target.checked)})," Explicit"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.isInstrumental,onChange:d=>p(m.id,"isInstrumental",d.target.checked)})," Instrumental"]})]})]},m.id))]})]})},Bi=({data:t,setData:s})=>{var l;const a=n=>{const o=t.stores||[],p=o.includes(n)?o.filter(x=>x!==n):[...o,n];s({...t,stores:p})},i=()=>{var n;((n=t.stores)==null?void 0:n.length)===Ct.length?s({...t,stores:[]}):s({...t,stores:Ct.map(o=>o.id)})};return e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Select Stores"}),e.jsx("button",{onClick:i,className:"text-xs font-bold text-brand-blue hover:underline",children:((l=t.stores)==null?void 0:l.length)===Ct.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Ct.map(n=>{var p;const o=(p=t.stores)==null?void 0:p.includes(n.id);return e.jsxs("div",{onClick:()=>a(n.id),className:`p-3 rounded-xl border flex items-center gap-3 cursor-pointer transition-all ${o?"bg-blue-50 border-brand-blue dark:bg-blue-900/20":"bg-white dark:bg-[#1f2128] dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${o?"bg-brand-blue border-brand-blue":"border-gray-400"}`,children:o&&e.jsx(re,{size:12,className:"text-white"})}),e.jsx("span",{className:`text-sm font-bold ${o?"text-brand-blue dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:n.name})]},n.id)})}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/10 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800 text-sm text-yellow-800 dark:text-yellow-200 flex items-start gap-3",children:[e.jsx(Sr,{size:18,className:"mt-0.5 shrink-0"}),e.jsx("p",{children:"Deliveries usually take 2-5 days for Spotify/Apple, and up to 2 weeks for other stores. Please plan your release date accordingly."})]})]})};function _i({user:t,userData:s,initialData:a,onCancel:i,onSuccess:l}){const[n,o]=r.useState(1),[p,x]=r.useState(!1),[b,m]=r.useState(a||{title:"",primaryArtist:`${s.firstName} ${s.lastName}`,type:"single",genre:"",releaseDate:"",labelName:"",artworkUrl:"",tracks:[],stores:Ct.map(v=>v.id),status:"Draft"}),h=()=>n===1?b.title&&b.primaryArtist&&b.genre&&b.releaseDate:n===2?!!b.artworkUrl:n===3?b.tracks.length>0&&b.tracks.every(v=>v.status==="ready"):n===4?b.stores.length>0:!0,d=async()=>{x(!0);try{const v={...b,uploaderId:t.uid,updatedAt:X(),status:"Processing"};a!=null&&a.id?await te(W(P,Z(t.uid).distributionReleases,a.id),v):await Ee(D(P,Z(t.uid).distributionReleases),{...v,createdAt:X()}),alert("Release submitted successfully! It is now in the review queue."),l()}catch(v){console.error("Submission error:",v),alert("Failed to submit release.")}x(!1)};return e.jsxs("div",{className:"max-w-4xl mx-auto bg-white dark:bg-[#2c2e36] rounded-2xl shadow-xl overflow-hidden border dark:border-gray-700 min-h-[600px] flex flex-col",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-6 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-extrabold dark:text-white",children:"New Release"}),e.jsxs("p",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mt-1",children:["Step ",n," of 4"]})]}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white",children:e.jsx(le,{})})]}),e.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700 w-full",children:e.jsx("div",{className:"h-full bg-brand-blue transition-all duration-300",style:{width:`${n/4*100}%`}})}),e.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[n===1&&e.jsx(Mi,{data:b,setData:m}),n===2&&e.jsx(Fi,{data:b,setData:m,user:t}),n===3&&e.jsx(Oi,{data:b,setData:m,user:t}),n===4&&e.jsx(Bi,{data:b,setData:m})]}),e.jsxs("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[n>1?e.jsxs("button",{onClick:()=>o(n-1),className:"flex items-center gap-2 text-gray-500 font-bold hover:text-gray-800 dark:hover:text-white transition",children:[e.jsx(wr,{size:18})," Back"]}):e.jsx("div",{}),n<4?e.jsxs("button",{onClick:()=>o(n+1),disabled:!h(),className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-600 transition",children:["Next Step ",e.jsx(dt,{size:18})]}):e.jsx("button",{onClick:d,disabled:p||!h(),className:"bg-green-600 text-white px-8 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 hover:bg-green-700 transition shadow-lg",children:p?e.jsx(K,{className:"animate-spin"}):"Submit Release"})]})]})}function Ua({user:t,userData:s}){const[a,i]=r.useState("list"),[l,n]=r.useState([]),[o,p]=r.useState(!0),[x,b]=r.useState(null);r.useEffect(()=>{if(!(t!=null&&t.uid))return;const d=me(D(P,Z(t.uid).distributionReleases),we("uploaderId","==",t.uid),Re("updatedAt","desc")),v=ge(d,u=>{n(u.docs.map(g=>({id:g.id,...g.data()}))),p(!1)});return()=>v()},[t==null?void 0:t.uid]);const m=async(d,v)=>{if(confirm(`Are you sure you want to delete "${v}"? This cannot be undone if already distributed.`))try{await ct(W(P,Z(t.uid).distributionReleases,d))}catch(u){console.error(u),alert("Failed to delete release.")}},h=d=>{if(d.status!=="Draft"&&d.status!=="Action Needed")return alert("Cannot edit a release that is currently processing or live. Contact support for takedowns.");b(d),i("create")};return a==="create"?e.jsx(_i,{user:t,userData:s,initialData:x,onCancel:()=>{i("list"),b(null)},onSuccess:()=>{i("list"),b(null)}}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ut,{className:"text-brand-blue"})," Distribution Portal"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your catalog across Spotify, Apple Music, and 150+ stores."})]}),e.jsxs("button",{onClick:()=>i("create"),className:"bg-brand-blue text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 shadow-lg hover:shadow-blue-500/20",children:[e.jsx(lt,{size:20})," New Release"]})]}),e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 overflow-hidden min-h-[400px]",children:o?e.jsx("div",{className:"p-12 text-center text-gray-500",children:"Loading catalog..."}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4",children:e.jsx(Ss,{size:48,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"No Releases Yet"}),e.jsx("p",{className:"text-gray-500 max-w-sm mt-2 mb-6",children:"Start your journey by uploading your first single, EP, or album to the world."}),e.jsx("button",{onClick:()=>i("create"),className:"text-brand-blue font-bold hover:underline",children:"Create First Release"})]}):e.jsx("div",{className:"divide-y dark:divide-gray-700",children:l.map(d=>{var v;return e.jsxs("div",{className:"p-5 hover:bg-gray-50 dark:hover:bg-white/5 transition flex flex-col md:flex-row md:items-center justify-between gap-4 group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 bg-gray-200 dark:bg-black rounded-lg shadow-sm overflow-hidden shrink-0 border dark:border-gray-700",children:d.artworkUrl?e.jsx("img",{src:d.artworkUrl,alt:"Art",className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:e.jsx(mt,{size:20})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide border ${d.status==="Live"?"bg-green-100 text-green-700 border-green-200":d.status==="Processing"?"bg-blue-100 text-blue-700 border-blue-200":d.status==="Action Needed"?"bg-red-100 text-red-700 border-red-200":"bg-gray-100 text-gray-600 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600"}`,children:d.status}),e.jsx("span",{className:"text-xs text-gray-400 uppercase font-bold",children:d.type})]}),e.jsx("h4",{className:"font-bold text-lg dark:text-white leading-tight",children:d.title||"Untitled Release"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[d.primaryArtist," • ",((v=d.tracks)==null?void 0:v.length)||0," Tracks"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pl-4 md:pl-0 border-l md:border-l-0 dark:border-gray-700",children:[e.jsxs("div",{className:"text-right hidden md:block mr-4",children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase font-bold",children:"Release Date"}),e.jsx("div",{className:"text-sm font-medium dark:text-gray-200",children:d.releaseDate?new Date(d.releaseDate).toLocaleDateString():"TBD"})]}),e.jsx("button",{onClick:()=>h(d),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit / View Details",children:e.jsx(ss,{size:18})}),(d.status==="Draft"||d.status==="Action Needed")&&e.jsx("button",{onClick:()=>m(d.id,d.title),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete Release",children:e.jsx($e,{size:18})})]})]},d.id)})})})]})}const qi=[{id:"guitar_electric",label:"Electric Guitar"},{id:"guitar_acoustic",label:"Acoustic Guitar"},{id:"amp_head",label:"Amplifier Head"},{id:"amp_combo",label:"Combo Amp"},{id:"keyboard",label:"Keyboard/Synth"},{id:"rack_unit",label:"Rack Gear (1U/2U)"},{id:"pedal",label:"Pedal/Stompbox"}],Ha=({type:t,view:s,onClick:a,markers:i=[]})=>{var b;const l=()=>i.map((m,h)=>e.jsxs("g",{transform:`translate(${m.x}, ${m.y})`,children:[e.jsx("circle",{r:"6",fill:"#ef4444",stroke:"white",strokeWidth:"2",className:"drop-shadow-md"}),e.jsx("text",{y:"-10",textAnchor:"middle",fill:"#ef4444",fontSize:"10",fontWeight:"bold",children:h+1})]},h)),n={width:"100%",height:"400",viewBox:"0 0 300 400",className:"w-full h-full cursor-crosshair touch-none select-none",onClick:m=>{const h=m.target.getBoundingClientRect(),d=(m.clientX-h.left)*(300/h.width),v=(m.clientY-h.top)*(400/h.height);a(d,v)}},o={guitar_electric:{front:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2",strokeDasharray:"5,5"})},amp_combo:{front:e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsxs("g",{children:[e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2"}),e.jsx("rect",{x:"70",y:"200",width:"160",height:"80",fill:"#9ca3af",opacity:"0.5"})]})}},p=()=>e.jsx("rect",{x:"50",y:"50",width:"200",height:"300",rx:"10",fill:"#f3f4f6",stroke:"#9ca3af",strokeWidth:"2",strokeDasharray:"4"}),x=((b=o[t])==null?void 0:b[s])||e.jsx(p,{});return e.jsxs("svg",{...n,children:[x,l()]})};function Wi({initialData:t,onSave:s,onCancel:a,type:i}){const[l,n]=r.useState((t==null?void 0:t.gearType)||"guitar_electric"),[o,p]=r.useState("front"),[x,b]=r.useState((t==null?void 0:t.markers)||[]),[m,h]=r.useState((t==null?void 0:t.notes)||""),[d,v]=r.useState((t==null?void 0:t.photos)||[]),[u,g]=r.useState(null),[y,c]=r.useState(""),{uploadMedia:k,uploading:N}=xt(),f=(C,R)=>{const E={x:C,y:R,view:o,id:Date.now(),label:""};b([...x,E]),g(E),c("")},S=()=>{u&&(b(x.map(C=>C.id===u.id?{...C,label:y}:C)),g(null))},j=async C=>{const R=C.target.files[0];if(!R)return;const E=await k(R,`inspections/${Date.now()}`);E&&v(w=>[...w,E])};return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden flex flex-col h-[80vh]",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Fe,{className:i==="Pre"?"text-orange-500":"text-green-500",size:20})," ",i,"-Inspection Report"]}),e.jsx("button",{onClick:a,children:e.jsx(le,{className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-black/40 relative flex flex-col items-center justify-center p-4",children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[e.jsx("select",{className:"p-2 rounded-lg border dark:border-gray-600 bg-white dark:bg-[#1f2128] text-sm font-bold dark:text-white shadow-sm",value:l,onChange:C=>n(C.target.value),children:qi.map(C=>e.jsx("option",{value:C.id,children:C.label},C.id))}),e.jsx("div",{className:"flex bg-white dark:bg-[#1f2128] rounded-lg border dark:border-gray-600 p-1 shadow-sm",children:["front","back","sides"].map(C=>e.jsx("button",{onClick:()=>p(C),className:`px-3 py-1 text-xs font-bold rounded-md capitalize ${o===C?"bg-brand-blue text-white":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:C},C))})]}),e.jsxs("div",{className:"w-full max-w-md h-full aspect-[3/4] bg-white dark:bg-[#1f2128] rounded-xl shadow-inner border dark:border-gray-700 relative",children:[e.jsx(Ha,{type:l,view:o,markers:x.filter(C=>C.view===o),onClick:f}),u&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 bg-white dark:bg-[#2c2e36] p-4 rounded-xl shadow-2xl border border-brand-blue z-20 animate-in zoom-in-95",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 mb-2",children:"Identify Issue"}),e.jsx("input",{autoFocus:!0,className:"w-full p-2 border rounded mb-2 text-sm dark:bg-black/20 dark:text-white",placeholder:"e.g. Scratch",value:y,onChange:C=>c(C.target.value),onKeyDown:C=>C.key==="Enter"&&S()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{b(x.filter(C=>C.id!==u.id)),g(null)},className:"flex-1 bg-red-100 text-red-600 py-1 rounded text-xs font-bold",children:"Delete"}),e.jsx("button",{onClick:S,className:"flex-1 bg-brand-blue text-white py-1 rounded text-xs font-bold",children:"Save"})]})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Damage Log"}),e.jsx("div",{className:"space-y-2",children:x.map((C,R)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-black/20 rounded border dark:border-gray-700",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-red-500 text-white flex items-center justify-center text-xs font-bold shrink-0",children:R+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:C.label||"Unlabeled"}),e.jsxs("div",{className:"text-[10px] text-gray-500 uppercase",children:[C.view," View"]})]}),e.jsx("button",{onClick:()=>b(x.filter(E=>E.id!==C.id)),children:e.jsx(le,{size:14,className:"text-gray-400 hover:text-red-500"})})]},R))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Notes"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg text-sm dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Overall condition...",value:m,onChange:C=>h(C.target.value)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Evidence Photos"}),e.jsxs("label",{className:"cursor-pointer text-brand-blue hover:text-blue-600",children:[e.jsx(Mt,{size:16}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:j,disabled:N})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:d.map((C,R)=>e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden border dark:border-gray-600 relative group",children:[e.jsx("img",{src:C.url,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>v(d.filter((E,w)=>w!==R)),className:"absolute top-1 right-1 bg-red-500 text-white p-0.5 rounded opacity-0 group-hover:opacity-100 transition",children:e.jsx(le,{size:12})})]},R))})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:()=>s({gearType:l,markers:x,notes:m,photos:d,timestamp:new Date().toISOString()}),className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:18})," Finalize Report"]})})]})]})]})}function Es(t){const[s,a]=r.useState([]),[i,l]=r.useState(new Set),[n,o]=r.useState(!0),p=()=>`artifacts/${ee}/users/${t}/wishlist`;r.useEffect(()=>{if(!t){a([]),l(new Set),o(!1);return}const g=D(P,p()),y=ge(g,c=>{const k=c.docs.map(N=>({id:N.id,...N.data()}));a(k),l(new Set(k.map(N=>N.itemId))),o(!1)},c=>{console.error("Error fetching wishlist:",c),o(!1)});return()=>y()},[t]);const x=r.useCallback(g=>i.has(g),[i]),b=r.useCallback(async g=>{var y;if(!t)return I.error("Please sign in to use wishlist"),!1;try{const c=W(P,p(),g.id);return await Oe(c,{itemId:g.id,itemType:g.itemType||"gear",title:g.title,brand:g.brand||"",price:g.price,image:((y=g.images)==null?void 0:y[0])||g.coverImage||null,sellerId:g.sellerId||g.authorId,sellerName:g.sellerName||g.author,addedAt:X(),alertOnPriceDrop:!1,alertPrice:null}),I.success("Added to wishlist"),!0}catch(c){return console.error("Error adding to wishlist:",c),I.error("Failed to add to wishlist"),!1}},[t]),m=r.useCallback(async g=>{if(!t)return!1;try{const y=W(P,p(),g);return await ct(y),I.success("Removed from wishlist"),!0}catch(y){return console.error("Error removing from wishlist:",y),I.error("Failed to remove from wishlist"),!1}},[t]),h=r.useCallback(async g=>x(g.id)?m(g.id):b(g),[x,b,m]),d=r.useCallback(async(g,y)=>{if(!t)return!1;try{const c=W(P,p(),g);return await Oe(c,{alertOnPriceDrop:!0,alertPrice:y,alertSetAt:X()},{merge:!0}),I.success(`Price alert set for $${y}`),!0}catch(c){return console.error("Error setting price alert:",c),I.error("Failed to set price alert"),!1}},[t]),v=r.useCallback(async g=>{if(!t)return!1;try{const y=W(P,p(),g);return await Oe(y,{alertOnPriceDrop:!1,alertPrice:null,alertSetAt:null},{merge:!0}),I.success("Price alert removed"),!0}catch(y){return console.error("Error removing price alert:",y),!1}},[t]),u=r.useCallback(()=>s.filter(g=>g.alertOnPriceDrop&&g.alertPrice),[s]);return{wishlist:s,wishlistIds:i,loading:n,isInWishlist:x,addToWishlist:b,removeFromWishlist:m,toggleWishlist:h,setPriceAlert:d,removePriceAlert:v,getItemsWithAlerts:u,wishlistCount:s.length}}function Ga({item:t,userId:s,size:a="default",showLabel:i=!1,showPriceAlert:l=!1}){const{isInWishlist:n,toggleWishlist:o,setPriceAlert:p,removePriceAlert:x,wishlist:b}=Es(s),[m,h]=r.useState(!1),[d,v]=r.useState(""),[u,g]=r.useState(!1),y=n(t.id),c=b.find(R=>R.itemId===t.id),k=c==null?void 0:c.alertOnPriceDrop,N={small:"p-1.5",default:"p-2",large:"p-3"},f={small:14,default:18,large:24},S=async R=>{R.stopPropagation(),g(!0),await o(t),g(!1)},j=async()=>{!d||isNaN(parseFloat(d))||(g(!0),await p(t.id,parseFloat(d)),g(!1),h(!1))},C=async R=>{R.stopPropagation(),g(!0),await x(t.id),g(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:S,disabled:u,className:`${N[a]} rounded-full transition-all ${y?"bg-red-500 text-white hover:bg-red-600":"bg-white/90 dark:bg-gray-800/90 text-gray-600 dark:text-gray-300 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-500"} backdrop-blur-sm ${u?"opacity-50":""}`,title:y?"Remove from wishlist":"Add to wishlist",children:e.jsx(Et,{size:f[a],fill:y?"currentColor":"none"})}),i&&e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:y?"Saved":"Save"}),l&&y&&e.jsx("button",{onClick:R=>{R.stopPropagation(),k?C(R):(v(t.price?(t.price*.9).toFixed(0):""),h(!0))},className:`${N[a]} rounded-full transition-all ${k?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-white/90 dark:bg-gray-800/90 text-gray-600 dark:text-gray-300 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 hover:text-yellow-500"} backdrop-blur-sm`,title:k?`Alert set at $${c.alertPrice}`:"Set price alert",children:k?e.jsx(va,{size:f[a]}):e.jsx(st,{size:f[a]})})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4",onClick:R=>R.stopPropagation(),children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl p-6 w-full max-w-sm shadow-2xl",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Set Price Alert"}),e.jsx("button",{onClick:()=>h(!1),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(le,{size:18})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:["Get notified when ",e.jsx("strong",{children:t.title})," drops below your target price."]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-3",children:["Current price: ",e.jsxs("span",{className:"font-bold text-green-600",children:["$",t.price]})]}),e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Alert me when price drops to"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"number",value:d,onChange:R=>v(R.target.value),className:"w-full pl-9 pr-4 py-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-lg font-bold",placeholder:"0"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 py-2.5 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:"Cancel"}),e.jsxs("button",{onClick:j,disabled:u||!d,className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-2.5 rounded-lg font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(st,{size:16}),"Set Alert"]})]})]})})]})}function Ya(t){const[s,a]=r.useState([]),[i,l]=r.useState({averageRating:0,totalReviews:0,ratingDistribution:{1:0,2:0,3:0,4:0,5:0}}),[n,o]=r.useState(!0),p=()=>`artifacts/${ee}/sellerReviews`,x=u=>`artifacts/${ee}/users/${u}/profiles/main`;r.useEffect(()=>{if(!t){a([]),o(!1);return}const u=D(P,p()),g=me(u,we("sellerId","==",t),Re("createdAt","desc")),y=ge(g,c=>{const k=c.docs.map(N=>{var f,S;return{id:N.id,...N.data(),createdAt:((S=(f=N.data().createdAt)==null?void 0:f.toDate)==null?void 0:S.call(f))||new Date}});if(a(k),k.length>0){const N=k.length,f=k.reduce((j,C)=>j+C.rating,0),S={1:0,2:0,3:0,4:0,5:0};k.forEach(j=>{j.rating>=1&&j.rating<=5&&S[j.rating]++}),l({averageRating:Math.round(f/N*10)/10,totalReviews:N,ratingDistribution:S})}else l({averageRating:0,totalReviews:0,ratingDistribution:{1:0,2:0,3:0,4:0,5:0}});o(!1)},c=>{console.error("Error fetching reviews:",c),o(!1)});return()=>y()},[t]);const b=r.useCallback(async({reviewerId:u,reviewerName:g,reviewerPhoto:y,rating:c,title:k,comment:N,orderId:f,itemId:S,itemTitle:j})=>{if(!t||!u)return I.error("Unable to submit review"),!1;if(c<1||c>5)return I.error("Please select a rating between 1 and 5"),!1;try{const C=D(P,p()),R=me(C,we("sellerId","==",t),we("reviewerId","==",u),we("orderId","==",f));return(await He(R)).empty?(await Ee(C,{sellerId:t,reviewerId:u,reviewerName:g,reviewerPhoto:y||null,rating:c,title:k||"",comment:N||"",orderId:f||null,itemId:S||null,itemTitle:j||"",createdAt:X(),helpful:0,reported:!1}),await m(t),I.success("Review submitted successfully!"),!0):(I.error("You have already reviewed this seller for this order"),!1)}catch(C){return console.error("Error submitting review:",C),I.error("Failed to submit review"),!1}},[t]),m=async u=>{try{const g=D(P,p()),y=me(g,we("sellerId","==",u)),c=await He(y);if(c.empty)return;const k=c.size,N=c.docs.reduce((j,C)=>j+C.data().rating,0),f=Math.round(N/k*10)/10,S=W(P,x(u));await te(S,{sellerRating:f,sellerReviewCount:k})}catch(g){console.error("Error updating seller rating:",g)}},h=r.useCallback(async u=>{try{const g=W(P,p(),u);await te(g,{helpful:Ke(1)})}catch(g){console.error("Error marking helpful:",g)}},[]),d=r.useCallback(async(u,g)=>{try{const y=W(P,p(),u);return await te(y,{reported:!0,reportReason:g,reportedAt:X()}),I.success("Review reported. Our team will review it."),!0}catch(y){return console.error("Error reporting review:",y),I.error("Failed to report review"),!1}},[]),v=r.useCallback(async(u,g)=>{try{const y=W(P,p(),u),c=await Be(y);return!c.exists()||c.data().reviewerId!==g?(I.error("You can only delete your own reviews"),!1):(await ct(y),await m(t),I.success("Review deleted"),!0)}catch(y){return console.error("Error deleting review:",y),I.error("Failed to delete review"),!1}},[t]);return{reviews:s,stats:i,loading:n,submitReview:b,markHelpful:h,reportReview:d,deleteReview:v}}function Ka(t){const[s,a]=r.useState(null),[i,l]=r.useState(0),[n,o]=r.useState(!0);return r.useEffect(()=>{if(!t){o(!1);return}const p=W(P,`artifacts/${ee}/users/${t}/profiles/main`),x=ge(p,b=>{b.exists()&&(a(b.data().sellerRating||null),l(b.data().sellerReviewCount||0)),o(!1)},()=>{o(!1)});return()=>x()},[t]),{rating:s,reviewCount:i,loading:n}}function Qa({rating:t,size:s=16,showValue:a=!0}){const i=Math.floor(t),l=t-i>=.5,n=5-i-(l?1:0);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"flex",children:[[...Array(i)].map((o,p)=>e.jsx(ze,{size:s,fill:"#facc15",className:"text-yellow-400"},`full-${p}`)),l&&e.jsxs("div",{className:"relative",children:[e.jsx(ze,{size:s,className:"text-gray-300"}),e.jsx("div",{className:"absolute inset-0 overflow-hidden w-1/2",children:e.jsx(ze,{size:s,fill:"#facc15",className:"text-yellow-400"})})]}),[...Array(n)].map((o,p)=>e.jsx(ze,{size:s,className:"text-gray-300"},`empty-${p}`))]}),a&&e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 ml-1",children:t.toFixed(1)})]})}function Vi({value:t,onChange:s,size:a=24}){const[i,l]=r.useState(0);return e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(n=>e.jsx("button",{type:"button",onClick:()=>s(n),onMouseEnter:()=>l(n),onMouseLeave:()=>l(0),className:"transition-transform hover:scale-110",children:e.jsx(ze,{size:a,fill:(i||t)>=n?"#facc15":"none",className:(i||t)>=n?"text-yellow-400":"text-gray-300"})},n))})}function Ui({sellerId:t,size:s="default"}){const{rating:a,reviewCount:i,loading:l}=Ka(t);if(l||!a)return null;const n={small:"text-xs px-1.5 py-0.5",default:"text-sm px-2 py-1",large:"text-base px-3 py-1.5"};return e.jsxs("div",{className:`flex items-center gap-1 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-full ${n[s]}`,children:[e.jsx(ze,{size:s==="small"?10:s==="large"?16:12,fill:"#facc15",className:"text-yellow-400"}),e.jsx("span",{className:"font-bold text-gray-700 dark:text-gray-200",children:a.toFixed(1)}),e.jsxs("span",{className:"text-gray-400",children:["(",i,")"]})]})}function Hi({sellerId:t,userId:s,userName:a,userPhoto:i,orderId:l,itemId:n,itemTitle:o,onSuccess:p,onCancel:x}){const{submitReview:b}=Ya(t),[m,h]=r.useState(0),[d,v]=r.useState(""),[u,g]=r.useState(""),[y,c]=r.useState(!1),k=async N=>{if(N.preventDefault(),m===0)return;c(!0);const f=await b({reviewerId:s,reviewerName:a,reviewerPhoto:i,rating:m,title:d,comment:u,orderId:l,itemId:n,itemTitle:o});c(!1),f&&p&&p()};return e.jsxs("form",{onSubmit:k,className:"bg-white dark:bg-[#2c2e36] rounded-xl p-6 border dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-4",children:"Write a Review"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Your Rating"}),e.jsx(Vi,{value:m,onChange:h})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Review Title (Optional)"}),e.jsx("input",{type:"text",value:d,onChange:N=>v(N.target.value),placeholder:"Summarize your experience",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Your Review"}),e.jsx("textarea",{value:u,onChange:N=>g(N.target.value),placeholder:"Share your experience with this seller...",rows:4,className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white resize-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[x&&e.jsx("button",{type:"button",onClick:x,className:"flex-1 py-2.5 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m===0||y,className:"flex-1 bg-brand-blue hover:bg-blue-600 text-white py-2.5 rounded-lg font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:y?e.jsx(K,{size:16,className:"animate-spin"}):"Submit Review"})]})]})}function Gi({review:t,currentUserId:s,onMarkHelpful:a,onReport:i,onDelete:l}){const[n,o]=r.useState(!1),[p,x]=r.useState(""),b=t.reviewerId===s,m=t.createdAt instanceof Date?t.createdAt.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Unknown date";return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl p-4 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.reviewerPhoto?e.jsx("img",{src:t.reviewerPhoto,alt:t.reviewerName,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:e.jsx(Le,{size:20,className:"text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium dark:text-white flex items-center gap-2",children:[t.reviewerName,t.verified&&e.jsx(Wt,{size:14,className:"text-green-500",title:"Verified Purchase"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:m})]})]}),e.jsx(Qa,{rating:t.rating,size:14,showValue:!1})]}),t.title&&e.jsx("h4",{className:"font-bold dark:text-white mb-1",children:t.title}),t.comment&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3",children:t.comment}),t.itemTitle&&e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:["Purchased: ",t.itemTitle]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("button",{onClick:()=>a(t.id),className:"flex items-center gap-1 text-gray-500 hover:text-blue-500 transition",children:[e.jsx(Na,{size:12}),"Helpful (",t.helpful||0,")"]}),b?e.jsxs("button",{onClick:()=>l(t.id,s),className:"flex items-center gap-1 text-gray-500 hover:text-red-500 transition",children:[e.jsx($e,{size:12}),"Delete"]}):e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-1 text-gray-500 hover:text-red-500 transition",children:[e.jsx(jt,{size:12}),"Report"]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl p-6 w-full max-w-sm shadow-2xl",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Fe,{size:20,className:"text-red-500"}),"Report Review"]}),e.jsxs("select",{value:p,onChange:h=>x(h.target.value),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white mb-4",children:[e.jsx("option",{value:"",children:"Select a reason..."}),e.jsx("option",{value:"spam",children:"Spam or fake review"}),e.jsx("option",{value:"offensive",children:"Offensive content"}),e.jsx("option",{value:"irrelevant",children:"Not relevant to the seller"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:()=>{i(t.id,p),o(!1)},disabled:!p,className:"flex-1 bg-red-500 text-white py-2 rounded-lg font-medium disabled:opacity-50",children:"Report"})]})]})})]})}function Yi({sellerId:t,currentUserId:s}){const{reviews:a,stats:i,loading:l,markHelpful:n,reportReview:o,deleteReview:p}=Ya(t),[x,b]=r.useState(!1);if(l)return e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(K,{size:24,className:"animate-spin text-gray-400"})});const m=x?a:a.slice(0,3);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl p-4 border dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold dark:text-white",children:i.averageRating.toFixed(1)}),e.jsx(Qa,{rating:i.averageRating,size:14,showValue:!1}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[i.totalReviews," reviews"]})]}),e.jsx("div",{className:"flex-1 space-y-1",children:[5,4,3,2,1].map(h=>{const d=i.ratingDistribution[h]||0,v=i.totalReviews>0?d/i.totalReviews*100:0;return e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"w-4 text-gray-500",children:h}),e.jsx(ze,{size:10,fill:"#facc15",className:"text-yellow-400"}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-400 rounded-full transition-all",style:{width:`${v}%`}})}),e.jsx("span",{className:"w-8 text-gray-400 text-right",children:d})]},h)})})]})}),a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ze,{size:32,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No reviews yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:m.map(h=>e.jsx(Gi,{review:h,currentUserId:s,onMarkHelpful:n,onReport:o,onDelete:p},h.id))}),a.length>3&&e.jsx("button",{onClick:()=>b(!x),className:"w-full py-2 text-sm font-medium text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition flex items-center justify-center gap-1",children:x?e.jsxs(e.Fragment,{children:["Show Less ",e.jsx(as,{size:16})]}):e.jsxs(e.Fragment,{children:["Show All ",a.length," Reviews ",e.jsx(et,{size:16})]})})]})]})}const Ki=500,Qi=2.5;function Xi({isOpen:t,onClose:s}){return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx(Ie,{size:24,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"SeshNx Escrow"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Secure payment protection"})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Escrow protection ensures safe transactions for high-value items by holding payment until both parties are satisfied."}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white mb-4",children:"How it Works"}),e.jsx("div",{className:"space-y-4",children:[{icon:Ce,title:"Buyer Pays",desc:"Payment is sent to SeshNx escrow, not directly to seller"},{icon:De,title:"Seller Ships",desc:"Seller ships item knowing payment is secured"},{icon:Le,title:"Buyer Confirms",desc:"Buyer inspects and confirms receipt"},{icon:re,title:"Funds Released",desc:"Payment is released to seller"}].map((a,i)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-blue/10 rounded-full flex items-center justify-center shrink-0",children:e.jsx(a.icon,{size:16,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:a.title}),e.jsx("div",{className:"text-sm text-gray-500",children:a.desc})]})]},i))})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4",children:[e.jsxs("h4",{className:"font-bold dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(Ie,{size:16,className:"text-green-500"}),"What's Protected"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(re,{size:14,className:"text-green-500 shrink-0 mt-0.5"}),"Item not as described"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(re,{size:14,className:"text-green-500 shrink-0 mt-0.5"}),"Item never arrives"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(re,{size:14,className:"text-green-500 shrink-0 mt-0.5"}),"Undisclosed damage or defects"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(re,{size:14,className:"text-green-500 shrink-0 mt-0.5"}),"Seller does not ship"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 dark:bg-blue-900/10 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Escrow Fee"}),e.jsx("div",{className:"text-sm text-gray-500",children:"One-time protection fee"})]}),e.jsxs("div",{className:"text-xl font-bold text-brand-blue",children:[Qi,"%"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["Escrow is recommended for items over $",Ki,". Disputes are resolved within 5-7 business days."]})]}),e.jsx("div",{className:"p-6 border-t dark:border-gray-700",children:e.jsx("button",{onClick:s,className:"w-full bg-brand-blue hover:bg-blue-600 text-white py-3 rounded-xl font-bold transition",children:"Got It"})})]})}):null}const Zi="modulepreload",Ji=function(t){return"/"+t},Ds={},Di=function(s,a,i){let l=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),p=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));l=Promise.allSettled(a.map(x=>{if(x=Ji(x),x in Ds)return;Ds[x]=!0;const b=x.endsWith(".css"),m=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${m}`))return;const h=document.createElement("link");if(h.rel=b?"stylesheet":Zi,b||(h.as="script"),h.crossOrigin="",h.href=x,p&&h.setAttribute("nonce",p),document.head.appendChild(h),b)return new Promise((d,v)=>{h.addEventListener("load",d),h.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${x}`)))})}))}function n(o){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=o,window.dispatchEvent(p),!p.defaultPrevented)throw o}return l.then(o=>{for(const p of o||[])p.status==="rejected"&&n(p.reason);return s().catch(n)})},ea=500,oe={PENDING_DEPOSIT:"pending_deposit",DEPOSIT_RECEIVED:"deposit_received",PICKUP_SCHEDULED:"pickup_scheduled",SELLER_VERIFICATION_PENDING:"seller_verification_pending",SELLER_VERIFIED:"seller_verified",BUYER_VERIFICATION_PENDING:"buyer_verification_pending",BUYER_VERIFIED:"buyer_verified",AWAITING_SELLER_APPROVAL:"awaiting_seller_approval",AWAITING_BUYER_APPROVAL:"awaiting_buyer_approval",MUTUALLY_APPROVED:"mutually_approved",COMPLETED:"completed",DISPUTED:"disputed",CANCELLED:"cancelled"};function en(t){const[s,a]=r.useState(null),[i,l]=r.useState(!0),n=o=>`artifacts/${ee}/pickupSessions/${o}`;return r.useEffect(()=>{if(!t){a(null),l(!1);return}const o=W(P,n(t)),p=ge(o,x=>{var b,m,h,d,v,u;x.exists()?a({id:x.id,...x.data(),createdAt:((m=(b=x.data().createdAt)==null?void 0:b.toDate)==null?void 0:m.call(b))||new Date,scheduledDate:((d=(h=x.data().scheduledDate)==null?void 0:h.toDate)==null?void 0:d.call(h))||null,updatedAt:((u=(v=x.data().updatedAt)==null?void 0:v.toDate)==null?void 0:u.call(v))||new Date}):a(null),l(!1)},x=>{console.error("Error fetching pickup session:",x),l(!1)});return()=>p()},[t]),{session:s,loading:i}}function Xa(t){const[s,a]=r.useState([]),[i,l]=r.useState(!0),n=()=>`artifacts/${ee}/pickupSessions`,o=r.useCallback(async({orderId:y,itemId:c,itemTitle:k,itemPrice:N,itemImages:f,sellerId:S,sellerName:j,sellerPhoto:C,buyerId:R,buyerName:E,buyerPhoto:w,pickupLocation:z})=>{try{const A=await Ee(D(P,n()),{orderId:y,itemId:c,itemTitle:k,itemPrice:N,itemImages:f||[],sellerId:S,sellerName:j,sellerPhoto:C||null,buyerId:R,buyerName:E,buyerPhoto:w||null,pickupLocation:z,scheduledDate:null,depositAmount:N,depositPaid:!1,depositPaidAt:null,status:oe.PENDING_DEPOSIT,sellerVerification:{completed:!1,photos:[],notes:"",timestamp:null},buyerVerification:{completed:!1,photos:[],notes:"",timestamp:null},sellerApproved:!1,sellerApprovedAt:null,buyerApproved:!1,buyerApprovedAt:null,completedAt:null,fundsReleasedAt:null,disputed:!1,disputeReason:null,disputedAt:null,createdAt:X(),updatedAt:X()});return I.success("Pickup session created"),{success:!0,sessionId:A.id}}catch(A){return console.error("Error creating pickup session:",A),I.error("Failed to create pickup session"),{success:!1,error:A}}},[]),p=r.useCallback(async y=>{try{const c=W(P,n(),y);return await te(c,{depositPaid:!0,depositPaidAt:X(),status:oe.DEPOSIT_RECEIVED,updatedAt:X()}),I.success("Deposit recorded"),!0}catch(c){return console.error("Error recording deposit:",c),I.error("Failed to record deposit"),!1}},[]),x=r.useCallback(async(y,c,k)=>{try{const N=W(P,n(),y);return await te(N,{scheduledDate:c,pickupLocation:k,status:oe.PICKUP_SCHEDULED,updatedAt:X()}),I.success("Pickup scheduled"),!0}catch(N){return console.error("Error scheduling pickup:",N),I.error("Failed to schedule pickup"),!1}},[]),b=r.useCallback(async(y,c,k="")=>{if(!c||c.length<3)return I.error("Please upload at least 3 condition photos"),!1;try{const N=W(P,n(),y);return await te(N,{sellerVerification:{completed:!0,photos:c,notes:k,timestamp:X()},status:oe.SELLER_VERIFIED,updatedAt:X()}),I.success("Seller verification submitted"),!0}catch(N){return console.error("Error submitting seller verification:",N),I.error("Failed to submit verification"),!1}},[]),m=r.useCallback(async(y,c,k="")=>{if(!c||c.length<2)return I.error("Please upload at least 2 verification photos"),!1;try{const N=W(P,n(),y);return await te(N,{buyerVerification:{completed:!0,photos:c,notes:k,timestamp:X()},status:oe.BUYER_VERIFIED,updatedAt:X()}),I.success("Buyer verification submitted"),!0}catch(N){return console.error("Error submitting buyer verification:",N),I.error("Failed to submit verification"),!1}},[]),h=r.useCallback(async y=>{try{const c=W(P,n(),y),k=await Be(c);if(!k.exists())return I.error("Session not found"),!1;const f=k.data().buyerApproved;return await te(c,{sellerApproved:!0,sellerApprovedAt:X(),status:f?oe.MUTUALLY_APPROVED:oe.AWAITING_BUYER_APPROVAL,updatedAt:X()}),f&&await v(y),I.success("Seller approval recorded"),!0}catch(c){return console.error("Error recording seller approval:",c),I.error("Failed to record approval"),!1}},[]),d=r.useCallback(async y=>{try{const c=W(P,n(),y),k=await Be(c);if(!k.exists())return I.error("Session not found"),!1;const f=k.data().sellerApproved;return await te(c,{buyerApproved:!0,buyerApprovedAt:X(),status:f?oe.MUTUALLY_APPROVED:oe.AWAITING_SELLER_APPROVAL,updatedAt:X()}),f&&await v(y),I.success("Buyer approval recorded"),!0}catch(c){return console.error("Error recording buyer approval:",c),I.error("Failed to record approval"),!1}},[]),v=r.useCallback(async y=>{try{const c=W(P,n(),y),k=await Be(c);if(!k.exists())return!1;const N=k.data();await te(c,{status:oe.COMPLETED,completedAt:X(),fundsReleasedAt:X(),updatedAt:X()});const f=W(P,`artifacts/${ee}/users/${N.sellerId}/wallet/main`),S=await Be(f);if(S.exists()){const j=S.data().withdrawableBalance||0;await te(f,{withdrawableBalance:j+N.depositAmount,lastUpdated:X()})}else{const{setDoc:j}=await Di(async()=>{const{setDoc:C}=await import("./vendor-firebase-BUoA1mzI.js").then(R=>R.a6);return{setDoc:C}},__vite__mapDeps([0,1]));await j(f,{withdrawableBalance:N.depositAmount,pendingBalance:0,totalEarnings:N.depositAmount,lastUpdated:X()})}return I.success("Pickup completed! Funds released to seller."),!0}catch(c){return console.error("Error completing pickup:",c),I.error("Failed to complete pickup"),!1}},[]),u=r.useCallback(async(y,c,k)=>{try{const N=W(P,n(),y);return await te(N,{status:oe.DISPUTED,disputed:!0,disputeReason:c,disputedBy:k,disputedAt:X(),updatedAt:X()}),I.success("Dispute opened. Our team will review this case."),!0}catch(N){return console.error("Error opening dispute:",N),I.error("Failed to open dispute"),!1}},[]),g=r.useCallback(async(y,c,k)=>{try{const N=W(P,n(),y);return await te(N,{status:oe.CANCELLED,cancellationReason:c,cancelledBy:k,cancelledAt:X(),updatedAt:X()}),I.success("Pickup session cancelled"),!0}catch(N){return console.error("Error cancelling session:",N),I.error("Failed to cancel session"),!1}},[]);return{sessions:s,loading:i,createPickupSession:o,recordDeposit:p,schedulePickup:x,submitSellerVerification:b,submitBuyerVerification:m,sellerApprove:h,buyerApprove:d,completePickup:v,openDispute:u,cancelSession:g,PICKUP_STATUS:oe}}const Jt={[oe.PENDING_DEPOSIT]:{label:"Awaiting Deposit",color:"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20",icon:Ce,buyerAction:"Pay full deposit to secure item",sellerAction:"Waiting for buyer deposit"},[oe.DEPOSIT_RECEIVED]:{label:"Deposit Received",color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:re,buyerAction:"Schedule pickup date with seller",sellerAction:"Schedule pickup date with buyer"},[oe.PICKUP_SCHEDULED]:{label:"Pickup Scheduled",color:"text-blue-600 bg-blue-100 dark:bg-blue-900/20",icon:Pe,buyerAction:"Wait for pickup day",sellerAction:"Prepare item and submit verification photos on pickup day"},[oe.SELLER_VERIFICATION_PENDING]:{label:"Seller Verification Pending",color:"text-orange-600 bg-orange-100 dark:bg-orange-900/20",icon:ut,buyerAction:"Wait for seller to verify item condition",sellerAction:"Upload condition photos of item"},[oe.SELLER_VERIFIED]:{label:"Seller Verified",color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:re,buyerAction:"Proceed to pickup and upload verification photos",sellerAction:"Wait for buyer verification"},[oe.BUYER_VERIFICATION_PENDING]:{label:"Buyer Verification Pending",color:"text-orange-600 bg-orange-100 dark:bg-orange-900/20",icon:ut,buyerAction:"Upload verification photos of item",sellerAction:"Wait for buyer verification"},[oe.BUYER_VERIFIED]:{label:"Buyer Verified",color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:re,buyerAction:"Approve handover to complete",sellerAction:"Approve handover to complete"},[oe.AWAITING_SELLER_APPROVAL]:{label:"Awaiting Seller Approval",color:"text-purple-600 bg-purple-100 dark:bg-purple-900/20",icon:qe,buyerAction:"Waiting for seller approval",sellerAction:"Review and approve handover"},[oe.AWAITING_BUYER_APPROVAL]:{label:"Awaiting Buyer Approval",color:"text-purple-600 bg-purple-100 dark:bg-purple-900/20",icon:qe,buyerAction:"Review and approve handover",sellerAction:"Waiting for buyer approval"},[oe.MUTUALLY_APPROVED]:{label:"Mutually Approved",color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:re,buyerAction:"Transaction completing...",sellerAction:"Transaction completing..."},[oe.COMPLETED]:{label:"Completed",color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:re,buyerAction:"Pickup complete!",sellerAction:"Funds released to your balance!"},[oe.DISPUTED]:{label:"Disputed",color:"text-red-600 bg-red-100 dark:bg-red-900/20",icon:at,buyerAction:"Under review by our team",sellerAction:"Under review by our team"},[oe.CANCELLED]:{label:"Cancelled",color:"text-gray-600 bg-gray-100 dark:bg-gray-900/20",icon:le,buyerAction:"Session cancelled",sellerAction:"Session cancelled"}};function tn({status:t}){const s=Jt[t]||Jt[oe.PENDING_DEPOSIT],a=s.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold ${s.color}`,children:[e.jsx(a,{size:12}),s.label]})}function ta({photos:t,onPhotosChange:s,minPhotos:a=2,maxPhotos:i=6,title:l="Verification Photos",description:n="Upload clear photos"}){const{uploadMedia:o,uploading:p}=xt(),x=async m=>{const h=m.target.files[0];if(!h)return;if(t.length>=i){I.error(`Maximum ${i} photos allowed`);return}const d=await o(h,"pickup-verification");d!=null&&d.url&&s([...t,d.url])},b=m=>{s(t.filter((h,d)=>d!==m))};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium dark:text-white flex items-center gap-2",children:[e.jsx(ut,{size:18}),l]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[n," (min ",a,", max ",i,")"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.map((m,h)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:m,alt:`Photo ${h+1}`,className:"w-full h-full object-cover rounded-lg border dark:border-gray-700"}),e.jsx("button",{onClick:()=>b(h),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-sm hover:bg-red-600",children:"×"})]},h)),t.length<i&&e.jsxs("label",{className:"aspect-square border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:[p?e.jsx(K,{size:24,className:"animate-spin text-gray-400"}):e.jsxs(e.Fragment,{children:[e.jsx(Mt,{size:24,className:"text-gray-400 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Add Photo"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:x,disabled:p})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${t.length>=a?"bg-green-500":"bg-yellow-500"}`,style:{width:`${Math.min(100,t.length/a*100)}%`}})}),e.jsxs("span",{className:`text-xs font-medium ${t.length>=a?"text-green-600":"text-yellow-600"}`,children:[t.length,"/",a," required"]})]})]})}function sa({photos:t,title:s}){const[a,i]=r.useState(null);return!t||t.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500",children:s}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:t.map((l,n)=>e.jsx("button",{onClick:()=>i(l),className:"shrink-0 w-16 h-16 rounded-lg overflow-hidden border dark:border-gray-700 hover:ring-2 hover:ring-brand-blue transition",children:e.jsx("img",{src:l,alt:`Photo ${n+1}`,className:"w-full h-full object-cover"})},n))}),a&&e.jsxs("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-[90] p-4",onClick:()=>i(null),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 bg-white/10 rounded-full text-white hover:bg-white/20",onClick:()=>i(null),children:e.jsx(le,{size:24})}),e.jsx("img",{src:a,alt:"Full size",className:"max-w-full max-h-full object-contain",onClick:l=>l.stopPropagation()})]})]})}function sn({session:t,isSeller:s}){var l,n;const a=[{key:"deposit",label:"Deposit Paid",complete:t.depositPaid},{key:"scheduled",label:"Pickup Scheduled",complete:!!t.scheduledDate},{key:"seller_verify",label:"Seller Verification",complete:(l=t.sellerVerification)==null?void 0:l.completed},{key:"buyer_verify",label:"Buyer Verification",complete:(n=t.buyerVerification)==null?void 0:n.completed},{key:"mutual_approve",label:"Mutual Approval",complete:t.sellerApproved&&t.buyerApproved},{key:"complete",label:"Completed",complete:t.status===oe.COMPLETED}],i=a.findIndex(o=>!o.complete);return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-4 bottom-4 w-0.5 bg-gray-200 dark:bg-gray-700"}),e.jsx("div",{className:"absolute left-3 top-4 w-0.5 bg-green-500 transition-all",style:{height:`${Math.max(0,i-1)*20}%`}}),e.jsx("div",{className:"space-y-4",children:a.map((o,p)=>{const x=p===i,b=o.complete;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center relative z-10 ${b?"bg-green-500 text-white":x?"bg-brand-blue text-white animate-pulse":"bg-gray-200 dark:bg-gray-700 text-gray-400"}`,children:b?e.jsx(Je,{size:14}):e.jsx("span",{className:"text-xs",children:p+1})}),e.jsx("span",{className:`text-sm ${b?"text-green-600 font-medium":x?"text-gray-900 dark:text-white font-medium":"text-gray-400"}`,children:o.label})]},o.key)})})]})}function an({sessionId:t,userId:s,onClose:a,onMessageOther:i}){var pe,ce,he,ue,fe,O,ie,ne,V;const{session:l,loading:n}=en(t),{recordDeposit:o,schedulePickup:p,submitSellerVerification:x,submitBuyerVerification:b,sellerApprove:m,buyerApprove:h,openDispute:d}=Xa(),[v,u]=r.useState([]),[g,y]=r.useState(""),[c,k]=r.useState([]),[N,f]=r.useState(""),[S,j]=r.useState(""),[C,R]=r.useState(""),[E,w]=r.useState(""),[z,A]=r.useState(!1),[q,G]=r.useState(!1);if(n)return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[80]",children:e.jsx(K,{size:32,className:"animate-spin text-white"})});if(!l)return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl p-6 text-center",children:[e.jsx(at,{size:48,className:"mx-auto mb-4 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Session Not Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"This pickup session may have been cancelled or doesn't exist."}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-brand-blue text-white rounded-lg",children:"Close"})]})});const H=l.sellerId===s,J=l.buyerId===s,M=Jt[l.status]||Jt[oe.PENDING_DEPOSIT],L=H?M.sellerAction:M.buyerAction,_=async()=>{G(!0),await o(t),G(!1)},B=async()=>{if(!S||!C){I.error("Please select date and time");return}G(!0);const ae=new Date(`${S}T${C}`);await p(t,ae,l.pickupLocation),G(!1)},U=async()=>{G(!0),await x(t,v,g),G(!1)},Q=async()=>{G(!0),await b(t,c,N),G(!1)},xe=async()=>{G(!0),H?await m(t):await h(t),G(!1)},ye=async()=>{if(!E.trim()){I.error("Please provide a reason for the dispute");return}G(!0),await d(t,E,s),A(!1),G(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-2xl max-h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx(Ie,{size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold dark:text-white",children:"Secure Pickup"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Two-Party Verification"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tn,{status:l.status}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(le,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl",children:[((pe=l.itemImages)==null?void 0:pe[0])&&e.jsx("img",{src:l.itemImages[0],alt:l.itemTitle,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:l.itemTitle}),e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["$",l.itemPrice]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(Te,{size:12}),l.pickupLocation||"Location to be confirmed"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-3 rounded-xl border ${H?"border-brand-blue bg-blue-50 dark:bg-blue-900/10":"border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Seller"}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.sellerPhoto?e.jsx("img",{src:l.sellerPhoto,alt:"",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(Le,{size:14})}),e.jsx("span",{className:"font-medium dark:text-white text-sm",children:l.sellerName}),H&&e.jsx("span",{className:"text-[10px] bg-brand-blue text-white px-1 rounded",children:"You"})]})]}),e.jsxs("div",{className:`p-3 rounded-xl border ${J?"border-brand-blue bg-blue-50 dark:bg-blue-900/10":"border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Buyer"}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.buyerPhoto?e.jsx("img",{src:l.buyerPhoto,alt:"",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(Le,{size:14})}),e.jsx("span",{className:"font-medium dark:text-white text-sm",children:l.buyerName}),J&&e.jsx("span",{className:"text-[10px] bg-brand-blue text-white px-1 rounded",children:"You"})]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl",children:[e.jsx("h4",{className:"font-medium dark:text-white mb-3",children:"Progress"}),e.jsx(sn,{session:l,isSeller:H})]}),e.jsxs("div",{className:"p-4 bg-brand-blue/10 border border-brand-blue/20 rounded-xl",children:[e.jsx("div",{className:"text-sm font-medium text-brand-blue mb-1",children:"Your Next Step"}),e.jsx("div",{className:"font-bold dark:text-white",children:L})]}),l.status===oe.PENDING_DEPOSIT&&J&&e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/10 rounded-xl border border-yellow-200 dark:border-yellow-800",children:[e.jsx("h4",{className:"font-bold text-yellow-800 dark:text-yellow-200 mb-2",children:"Pay Full Deposit"}),e.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:["Pay $",l.depositAmount," to secure this item. Funds will be held until pickup is complete."]}),e.jsxs("button",{onClick:_,disabled:q,className:"w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50",children:[q?e.jsx(K,{className:"animate-spin"}):e.jsx(Ce,{size:18}),"Pay $",l.depositAmount," Deposit"]})]}),l.status===oe.DEPOSIT_RECEIVED&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/10 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-200 mb-2 flex items-center gap-2",children:[e.jsx(Pe,{size:18}),"Schedule Pickup"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date"}),e.jsx("input",{type:"date",value:S,onChange:ae=>j(ae.target.value),min:new Date().toISOString().split("T")[0],className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time"}),e.jsx("input",{type:"time",value:C,onChange:ae=>R(ae.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]})]}),e.jsx("button",{onClick:B,disabled:q||!S||!C,className:"w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50",children:q?e.jsx(K,{className:"animate-spin"}):"Confirm Schedule"})]}),l.scheduledDate&&e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl flex items-center gap-3",children:[e.jsx(Pe,{size:24,className:"text-brand-blue"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Scheduled Pickup"}),e.jsx("div",{className:"font-bold dark:text-white",children:((he=(ce=l.scheduledDate)==null?void 0:ce.toLocaleDateString)==null?void 0:he.call(ce,"en-US",{weekday:"long",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"}))||"Date set"})]})]}),(l.status===oe.PICKUP_SCHEDULED||l.status===oe.SELLER_VERIFICATION_PENDING)&&H&&!((ue=l.sellerVerification)!=null&&ue.completed)&&e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/10 rounded-xl border border-orange-200 dark:border-orange-800",children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-200 mb-2",children:"Day of Pickup - Seller Verification"}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300 mb-4",children:"Upload at least 3 clear photos showing the current condition of the item. Include all angles and any existing damage."}),e.jsx(ta,{photos:v,onPhotosChange:u,minPhotos:3,maxPhotos:8,title:"Condition Photos",description:"Take clear photos from multiple angles"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:g,onChange:ae=>y(ae.target.value),placeholder:"Any notes about the item condition...",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white resize-none",rows:2})]}),e.jsx("button",{onClick:U,disabled:q||v.length<3,className:"w-full mt-4 bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50",children:q?e.jsx(K,{className:"animate-spin"}):"Submit Verification"})]}),((fe=l.sellerVerification)==null?void 0:fe.completed)&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/10 rounded-xl border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(re,{size:18,className:"text-green-600"}),e.jsx("h4",{className:"font-bold text-green-800 dark:text-green-200",children:"Seller Verification Complete"})]}),e.jsx(sa,{photos:l.sellerVerification.photos,title:"Seller's Condition Photos"}),l.sellerVerification.notes&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300 italic",children:['"',l.sellerVerification.notes,'"']})]}),((O=l.sellerVerification)==null?void 0:O.completed)&&J&&!((ie=l.buyerVerification)!=null&&ie.completed)&&e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/10 rounded-xl border border-purple-200 dark:border-purple-800",children:[e.jsx("h4",{className:"font-bold text-purple-800 dark:text-purple-200 mb-2",children:"Buyer Verification - At Pickup"}),e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300 mb-4",children:"Upload at least 2 photos of the item when you receive it. This confirms the handover."}),e.jsx(ta,{photos:c,onPhotosChange:k,minPhotos:2,maxPhotos:6,title:"Handover Photos",description:"Photos proving you received the item"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Notes (Optional)"}),e.jsx("textarea",{value:N,onChange:ae=>f(ae.target.value),placeholder:"Any notes about receiving the item...",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white resize-none",rows:2})]}),e.jsx("button",{onClick:Q,disabled:q||c.length<2,className:"w-full mt-4 bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50",children:q?e.jsx(K,{className:"animate-spin"}):"Submit Verification"})]}),((ne=l.buyerVerification)==null?void 0:ne.completed)&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/10 rounded-xl border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(re,{size:18,className:"text-green-600"}),e.jsx("h4",{className:"font-bold text-green-800 dark:text-green-200",children:"Buyer Verification Complete"})]}),e.jsx(sa,{photos:l.buyerVerification.photos,title:"Buyer's Handover Photos"}),l.buyerVerification.notes&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300 italic",children:['"',l.buyerVerification.notes,'"']})]}),((V=l.buyerVerification)==null?void 0:V.completed)&&l.status!==oe.COMPLETED&&l.status!==oe.DISPUTED&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/10 rounded-xl border border-green-200 dark:border-green-800",children:[e.jsx("h4",{className:"font-bold text-green-800 dark:text-green-200 mb-3",children:"Approve Handover"}),e.jsxs("div",{className:"flex items-center justify-between mb-4 text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Seller Approval"}),l.sellerApproved?e.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[e.jsx(re,{size:14})," Approved"]}):e.jsx("span",{className:"text-yellow-600",children:"Pending"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4 text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Buyer Approval"}),l.buyerApproved?e.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[e.jsx(re,{size:14})," Approved"]}):e.jsx("span",{className:"text-yellow-600",children:"Pending"})]}),(H&&!l.sellerApproved||J&&!l.buyerApproved)&&e.jsx("button",{onClick:xe,disabled:q,className:"w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50",children:q?e.jsx(K,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{size:18}),"Approve Handover"]})})]}),l.status===oe.COMPLETED&&e.jsxs("div",{className:"p-6 bg-green-50 dark:bg-green-900/10 rounded-xl border border-green-200 dark:border-green-800 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(re,{size:32,className:"text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-green-800 dark:text-green-200 mb-2",children:"Pickup Complete!"}),e.jsx("p",{className:"text-green-700 dark:text-green-300",children:H?`$${l.depositAmount} has been added to your withdrawal balance.`:"Thank you for using SeshNx Secure Pickup!"})]}),z&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-200 dark:border-red-800",children:[e.jsxs("h4",{className:"font-bold text-red-800 dark:text-red-200 mb-2 flex items-center gap-2",children:[e.jsx(jt,{size:18}),"Open Dispute"]}),e.jsx("textarea",{value:E,onChange:ae=>w(ae.target.value),placeholder:"Describe the issue...",className:"w-full p-3 border border-red-200 dark:border-red-800 rounded-lg dark:bg-[#1f2128] dark:text-white resize-none mb-3",rows:3}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(!1),className:"flex-1 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:ye,disabled:q||!E.trim(),className:"flex-1 bg-red-500 text-white py-2 rounded-lg font-medium disabled:opacity-50",children:"Submit Dispute"})]})]})]}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 flex gap-2",children:[i&&e.jsxs("button",{onClick:()=>i(H?l.buyerId:l.sellerId),className:"flex-1 py-2.5 border dark:border-gray-600 rounded-xl font-medium flex items-center justify-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(St,{size:18}),"Message ",H?"Buyer":"Seller"]}),l.status!==oe.COMPLETED&&l.status!==oe.CANCELLED&&l.status!==oe.DISPUTED&&e.jsxs("button",{onClick:()=>A(!z),className:"px-4 py-2.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl font-medium flex items-center gap-1",children:[e.jsx(jt,{size:16}),"Dispute"]})]})]})})}function rn({item:t,user:s,userData:a,onClose:i,onSessionCreated:l}){var v;const{createPickupSession:n}=Xa(s==null?void 0:s.uid),[o,p]=r.useState(t.location||""),[x,b]=r.useState(!1),[m,h]=r.useState(!1),d=async()=>{if(!o.trim()){I.error("Please enter a pickup location");return}if(!x){I.error("Please agree to the terms");return}h(!0);const u=await n({orderId:`ORD-${Date.now()}`,itemId:t.id,itemTitle:t.title,itemPrice:t.price,itemImages:t.images,sellerId:t.sellerId,sellerName:t.sellerName,sellerPhoto:t.sellerPhoto,buyerId:s.uid,buyerName:`${(a==null?void 0:a.firstName)||""} ${(a==null?void 0:a.lastName)||""}`.trim()||"Anonymous",buyerPhoto:a==null?void 0:a.photoURL,pickupLocation:o});h(!1),u.success&&(l==null||l(u.sessionId))};return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-2xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx(Ie,{size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold dark:text-white",children:"High-Value Purchase"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Secure 2-Party Pickup Required"})]}),e.jsx("button",{onClick:i,className:"ml-auto p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-xl",children:[((v=t.images)==null?void 0:v[0])&&e.jsx("img",{src:t.images[0],alt:t.title,className:"w-16 h-16 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium dark:text-white",children:t.title}),e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["$",t.price]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-bold text-blue-800 dark:text-blue-200 mb-2",children:"How Secure Pickup Works"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-5 h-5 bg-blue-200 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold shrink-0",children:"1"}),"Pay full deposit ($",t.price,") to secure the item"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-5 h-5 bg-blue-200 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold shrink-0",children:"2"}),"Schedule local pickup with seller"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-5 h-5 bg-blue-200 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold shrink-0",children:"3"}),"Seller uploads condition photos on pickup day"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-5 h-5 bg-blue-200 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold shrink-0",children:"4"}),"You upload verification photos at handover"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-5 h-5 bg-blue-200 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold shrink-0",children:"5"}),"Both approve → Seller receives funds"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Pickup Location"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:o,onChange:u=>p(u.target.value),placeholder:"City, neighborhood, or meeting point",className:"w-full pl-10 pr-4 py-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Local pickup only. Exact location confirmed after deposit."})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-xl cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:u=>b(u.target.checked),className:"mt-1"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"I understand that this purchase requires local pickup and mutual verification. My deposit will be held until both parties confirm the handover."})]})]}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 py-3 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl",children:"Cancel"}),e.jsx("button",{onClick:d,disabled:m||!o.trim()||!x,className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50",children:m?e.jsx(K,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{size:18}),"Initiate Purchase"]})})]})]})})}const ln=["Mint","Excellent","Good","Fair","Non-Functioning"];function nn({user:t,userData:s,onNavigateToChat:a}){const[i,l]=r.useState("browse"),[n,o]=r.useState([]),[p,x]=r.useState("All"),[b,m]=r.useState(""),[h,d]=r.useState(null),{wishlistIds:v}=Es(t==null?void 0:t.uid);r.useEffect(()=>{const g=me(D(P,Z(t.uid).gearListings),Re("timestamp","desc")),y=ge(g,c=>{o(c.docs.map(k=>({id:k.id,...k.data()})))});return()=>y()},[t.uid]);const u=n.filter(g=>{var y,c;return(p==="All"||g.category===p)&&(((y=g.title)==null?void 0:y.toLowerCase().includes(b.toLowerCase()))||((c=g.brand)==null?void 0:c.toLowerCase().includes(b.toLowerCase())))});return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 animate-in fade-in",children:[i==="browse"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(vt,{className:"text-orange-500"})," Gear Exchange"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Buy and sell verified studio equipment."})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(Ge,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2c2e36] text-sm dark:text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Search gear...",value:b,onChange:g=>m(g.target.value)})]}),e.jsxs("button",{onClick:()=>l("create"),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 shadow-lg transition",children:[e.jsx(lt,{size:16})," Sell Gear"]})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2",children:[e.jsx("button",{onClick:()=>x("All"),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${p==="All"?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:"All Gear"}),bt.map(g=>e.jsx("button",{onClick:()=>x(g.id),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${p===g.id?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:g.label},g.id))]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:u.map(g=>e.jsx(on,{item:g,userId:t==null?void 0:t.uid,isInWishlist:v.has(g.id),onClick:()=>d(g)},g.id))}),u.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ut,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium dark:text-white mb-2",children:"No listings found"}),e.jsx("p",{className:"text-sm text-gray-500",children:b?"Try adjusting your search":"Be the first to list gear for sale!"})]})]}),i==="create"&&e.jsx(dn,{user:t,userData:s,onCancel:()=>l("browse"),onSuccess:()=>l("browse")}),h&&e.jsx(cn,{item:h,onClose:()=>d(null),currentUser:t,userData:s,onNavigateToChat:a})]})}function on({item:t,userId:s,isInWishlist:a,onClick:i}){var o;const{rating:l,reviewCount:n}=Ka(t.sellerId);return e.jsxs("div",{onClick:i,className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-xl transition cursor-pointer group flex flex-col",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 dark:bg-black/40 relative flex items-center justify-center overflow-hidden",children:[(o=t.images)!=null&&o[0]?e.jsx("img",{src:t.images[0],alt:t.title,className:"w-full h-full object-cover group-hover:scale-105 transition duration-500"}):e.jsx(ut,{size:32,className:"text-gray-400"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur-md",children:["$",t.price]}),e.jsx("div",{className:"absolute top-2 left-2",onClick:p=>p.stopPropagation(),children:e.jsx(Ga,{item:{...t,itemType:"gear"},userId:s,size:"small",showPriceAlert:!0})}),t.conditionReport&&e.jsxs("div",{className:"absolute bottom-2 left-2 bg-green-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(re,{size:10})," Inspected"]}),t.price>=500&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-green-600/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(Ie,{size:10})," Escrow"]})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-400 uppercase mb-1",children:t.brand}),e.jsx("h4",{className:"font-bold dark:text-white text-sm mb-1 line-clamp-1",children:t.title}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[t.condition," Condition"]}),l>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(ze,{size:12,fill:"#facc15",className:"text-yellow-400"}),e.jsx("span",{className:"text-xs font-medium dark:text-white",children:l.toFixed(1)}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",n,")"]})]}),e.jsx("div",{className:"mt-auto pt-3 border-t dark:border-gray-700 flex justify-between items-center text-xs text-gray-400",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Te,{size:10})," ",t.location||"Ships Anywhere"]})})]})]})}function dn({user:t,userData:s,onCancel:a,onSuccess:i}){var k,N;const[l,n]=r.useState(1),[o,p]=r.useState({title:"",brand:"",category:((k=bt[0])==null?void 0:k.id)||"microphones",condition:"Good",price:"",description:"",location:(s==null?void 0:s.city)||"",weight:"",length:"",width:"",height:""}),[x,b]=r.useState([]),[m,h]=r.useState(null),[d,v]=r.useState(!1),{uploadMedia:u,uploading:g}=xt(),y=async f=>{const S=f.target.files[0];if(!S)return;const j=await u(S,`gear/${t.uid}`);j!=null&&j.url&&b([...x,j.url])},c=async()=>{if(!o.title||!o.price){I.error("Title and Price are required");return}v(!0);try{await Ee(D(P,Z(t.uid).gearListings),{...o,price:parseInt(o.price),images:x,conditionReport:m,sellerId:t.uid,sellerName:`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"Anonymous",sellerPhoto:(s==null?void 0:s.photoURL)||null,timestamp:X(),status:"Active"}),I.success("Listing posted successfully!"),i()}catch(f){console.error(f),I.error("Failed to post listing.")}v(!1)};return l==="inspection"?e.jsx("div",{className:"h-[600px]",children:e.jsx(Wi,{type:"Pre",onSave:f=>{h(f),n(1)},onCancel:()=>n(1)})}):e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border dark:border-gray-700 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"List Gear for Sale"}),e.jsx("button",{onClick:a,children:e.jsx(le,{className:"text-gray-400"})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:o.brand,onChange:f=>p({...o,brand:f.target.value}),placeholder:"e.g. Fender"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model / Title"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:o.title,onChange:f=>p({...o,title:f.target.value}),placeholder:"e.g. Stratocaster"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:o.category,onChange:f=>p({...o,category:f.target.value}),children:bt.map(f=>e.jsx("option",{value:f.id,children:f.label},f.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Condition"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:o.condition,onChange:f=>p({...o,condition:f.target.value}),children:ln.map(f=>e.jsx("option",{value:f,children:f},f))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Price ($)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",value:o.price,onChange:f=>p({...o,price:f.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Weight (lb)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"lbs",value:o.weight,onChange:f=>p({...o,weight:f.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"L (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Len",value:o.length,onChange:f=>p({...o,length:f.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"W (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Wid",value:o.width,onChange:f=>p({...o,width:f.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"H (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Hgt",value:o.height,onChange:f=>p({...o,height:f.target.value})})]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-1",children:"Tech Inspection Report"}),e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-300",children:m?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{size:12})," Report Attached (",((N=m.markers)==null?void 0:N.length)||0," points)"]}):"Mark scratches, dents, or issues on a diagram to build trust."})]}),e.jsx("button",{onClick:()=>n("inspection"),className:`text-xs font-bold px-3 py-2 rounded-lg border transition ${m?"bg-white text-green-600 border-green-200":"bg-orange-100 text-orange-700 border-orange-200 hover:bg-orange-200"}`,children:m?"Edit Report":"Create Report"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Photos"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[x.map((f,S)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f,alt:`Upload ${S+1}`,className:"w-16 h-16 rounded-lg object-cover border dark:border-gray-600"}),e.jsx("button",{onClick:()=>b(x.filter((j,C)=>C!==S)),className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white rounded-full flex items-center justify-center text-xs",children:"×"})]},S)),e.jsxs("label",{className:"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",children:[g?e.jsx(K,{className:"animate-spin text-gray-400"}):e.jsx(lt,{className:"text-gray-400"}),e.jsx("input",{type:"file",className:"hidden",onChange:y,disabled:g,accept:"image/*"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Description"}),e.jsx("textarea",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white resize-none",rows:3,value:o.description,onChange:f=>p({...o,description:f.target.value}),placeholder:"Describe your item, its history, any modifications..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:a,className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"Cancel"}),e.jsx("button",{onClick:c,disabled:d||g,className:"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg flex items-center justify-center gap-2 disabled:opacity-50",children:d?e.jsx(K,{className:"animate-spin"}):"Post Listing"})]})]})]})}function cn({item:t,onClose:s,currentUser:a,userData:i,onNavigateToChat:l}){var f,S;const[n,o]=r.useState(!1),[p,x]=r.useState("details"),[b,m]=r.useState(!1),[h,d]=r.useState(!1),[v,u]=r.useState(null),g=t.price>=ea,y=t.sellerId===(a==null?void 0:a.uid),c=()=>{g?d(!0):I.success("Starting purchase...")},k=()=>{l&&l(t.sellerId)},N=j=>{d(!1),u(j)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-4xl h-[90vh] rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden border dark:border-gray-700",children:[e.jsxs("div",{className:"md:w-1/2 bg-black relative flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 relative",children:[n&&t.conditionReport?e.jsxs("div",{className:"w-full h-full bg-white rounded-xl overflow-hidden",children:[e.jsx(Ha,{type:t.conditionReport.gearType,view:"front",markers:t.conditionReport.markers,onClick:()=>{}}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/80 text-white px-3 py-1 rounded-full text-xs",children:"Inspection View"})]}):(f=t.images)!=null&&f[0]?e.jsx("img",{src:t.images[0],alt:t.title,className:"max-h-full max-w-full object-contain"}):e.jsx(ut,{size:48,className:"text-gray-600"}),e.jsx("button",{onClick:s,className:"absolute top-4 left-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70",children:e.jsx(le,{size:20})}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(Ga,{item:{...t,itemType:"gear"},userId:a==null?void 0:a.uid,showPriceAlert:!0})})]}),t.conditionReport&&e.jsxs("div",{className:"p-4 bg-[#1f2128] border-t border-gray-800 flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>o(!1),className:`px-4 py-2 rounded text-xs font-bold ${n?"bg-gray-800 text-gray-400":"bg-orange-600 text-white"}`,children:"Photos"}),e.jsxs("button",{onClick:()=>o(!0),className:`px-4 py-2 rounded text-xs font-bold flex items-center gap-1 ${n?"bg-orange-600 text-white":"bg-gray-800 text-gray-400"}`,children:[e.jsx(at,{size:12})," Condition Map"]})]})]}),e.jsxs("div",{className:"md:w-1/2 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex border-b dark:border-gray-700",children:[e.jsx("button",{onClick:()=>x("details"),className:`flex-1 py-3 text-sm font-medium transition ${p==="details"?"text-orange-600 border-b-2 border-orange-600":"text-gray-500 hover:text-gray-700"}`,children:"Details"}),e.jsxs("button",{onClick:()=>x("reviews"),className:`flex-1 py-3 text-sm font-medium transition flex items-center justify-center gap-1 ${p==="reviews"?"text-orange-600 border-b-2 border-orange-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ze,{size:14}),"Seller Reviews"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:p==="details"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-bold text-gray-400 uppercase tracking-wider mb-1",children:t.brand}),e.jsx("h2",{className:"text-2xl font-extrabold dark:text-white mb-2",children:t.title}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["$",t.price]}),e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-1 rounded text-xs font-bold",children:t.condition}),t.location&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Te,{size:12}),t.location]})]})]}),g&&!y&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/10 border border-green-200 dark:border-green-800 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ie,{className:"text-green-600 shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-green-800 dark:text-green-200 mb-1",children:"Secure Local Pickup Required"}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 mb-2",children:["High-value items ($",ea,"+) require local pickup with our two-party verification system to protect both buyer and seller."]}),e.jsxs("ul",{className:"text-xs text-green-600 dark:text-green-400 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(re,{size:10})," Full deposit held securely"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(re,{size:10})," Photo verification from both parties"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(re,{size:10})," Mutual approval before funds release"]})]}),e.jsx("button",{onClick:()=>m(!0),className:"mt-2 text-sm font-medium text-green-600 dark:text-green-400 hover:underline",children:"Learn more →"})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border dark:border-gray-700 my-4",children:[t.sellerPhoto?e.jsx("img",{src:t.sellerPhoto,alt:t.sellerName,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-gray-500",children:"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Seller"}),e.jsxs("div",{className:"font-bold dark:text-white text-sm flex items-center gap-2",children:[t.sellerName,e.jsx(Ui,{sellerId:t.sellerId,size:"small"})]})]}),!y&&e.jsx("button",{onClick:k,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition",children:e.jsx(St,{size:18,className:"text-gray-500"})})]}),((S=t.conditionReport)==null?void 0:S.notes)&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800/50 mb-4",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-2 flex items-center gap-2",children:[e.jsx(vt,{size:16})," Tech Notes"]}),e.jsxs("p",{className:"text-sm text-orange-900 dark:text-orange-200 italic",children:['"',t.conditionReport.notes,'"']})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300 mb-4",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm uppercase",children:"Description"}),e.jsx("p",{children:t.description||"No description provided."})]}),(t.weight||t.length)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm uppercase mb-2",children:"Specifications"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[t.weight&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 rounded",children:[e.jsx("span",{className:"text-gray-500",children:"Weight:"}),e.jsxs("span",{className:"ml-2 dark:text-white",children:[t.weight," lbs"]})]}),t.length&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 rounded",children:[e.jsx("span",{className:"text-gray-500",children:"Dimensions:"}),e.jsxs("span",{className:"ml-2 dark:text-white",children:[t.length,"×",t.width,"×",t.height," in"]})]})]})]})]}):e.jsx(Yi,{sellerId:t.sellerId,currentUserId:a==null?void 0:a.uid})}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700 bg-white dark:bg-[#2c2e36]",children:y?e.jsx("button",{className:"w-full bg-gray-100 dark:bg-gray-700 text-gray-500 font-bold py-3 rounded-xl cursor-not-allowed",children:"You own this listing"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition transform hover:scale-[1.02]",children:g?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{size:18}),e.jsx(De,{size:18}),"Secure Local Pickup - $",t.price]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{size:20}),"Buy Now"]})}),e.jsxs("p",{className:"text-center text-[10px] text-gray-400 mt-3 flex items-center justify-center gap-1",children:[e.jsx(re,{size:10}),g?"Protected by 2-Party Verification System":"Purchases covered by SeshNx Buyer Protection"]})]})})]})]}),e.jsx(Xi,{isOpen:b,onClose:()=>m(!1)})]}),h&&e.jsx(rn,{item:t,user:a,userData:i,onClose:()=>d(!1),onSessionCreated:N}),v&&e.jsx(an,{sessionId:v,userId:a==null?void 0:a.uid,onClose:()=>{u(null),s()},onMessageOther:l})]})}function xn({user:t,userData:s,tokenBalance:a,refreshWallet:i}){const[l,n]=r.useState([]),[o,p]=r.useState("All"),[x,b]=r.useState(""),[m,h]=r.useState(new Set),[d,v]=r.useState(!1),[u,g]=r.useState(null),[y,c]=r.useState(null);r.useEffect(()=>{if(!(t!=null&&t.uid))return;const f=me(D(P,Z(t.uid).marketplaceItems),Re("timestamp","desc")),S=ge(f,j=>{n(j.docs.map(C=>({id:C.id,...C.data()})))});return()=>S()},[t.uid]),r.useEffect(()=>{if(!(t!=null&&t.uid))return;const f=D(P,Z(t.uid).userLibrary),S=ge(f,j=>{h(new Set(j.docs.map(C=>C.data().itemId)))});return()=>S()},[t==null?void 0:t.uid]);const k=async f=>{if(a<f.price){alert("Insufficient tokens! Please top up.");return}if(window.confirm(`Purchase ${f.title} for ${f.price} Tokens?`))try{const S=W(P,Z(t.uid).userWallet);await te(S,{balance:Ke(-f.price)}),await Ee(D(P,Z(t.uid).userLibrary),{itemId:f.id,title:f.title,type:f.type,pricePaid:f.price,purchaseDate:X(),downloadUrl:f.downloadUrl}),i&&i(),alert("Purchased successfully!")}catch(S){console.error(S),alert("Transaction failed.")}},N=l.filter(f=>(o==="All"||f.type===o)&&f.title.toLowerCase().includes(x.toLowerCase()));return e.jsxs("div",{className:"pb-32",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 md:pb-0 scrollbar-hide",children:["All","Presets","Samples","Beats"].map(f=>e.jsx("button",{onClick:()=>p(f),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-all ${o===f?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300"}`,children:f},f))}),e.jsxs("div",{className:"ml-auto flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(Ge,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card text-sm dark:text-white focus:outline-none",placeholder:"Search...",value:x,onChange:f=>b(f.target.value)})]}),e.jsxs("button",{onClick:()=>v(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-green-700",children:[e.jsx(Mt,{size:16})," Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:N.map(f=>{const S=m.has(f.id);return e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition flex flex-col group",children:[e.jsxs("div",{className:"aspect-square relative bg-gray-100 dark:bg-gray-800 flex items-center justify-center cursor-pointer",onClick:()=>g(f),children:[f.type==="Presets"?e.jsx(ts,{size:40,className:"text-gray-400"}):e.jsx(Ss,{size:40,className:"text-gray-400"}),S&&e.jsxs("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded flex items-center gap-1",children:[e.jsx(re,{size:8})," OWNED"]})]}),e.jsxs("div",{className:"p-3 flex flex-col flex-1",children:[e.jsx("div",{className:"text-[10px] font-bold text-brand-blue uppercase mb-1",children:f.type}),e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate mb-1",title:f.title,children:f.title}),e.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[e.jsxs("span",{className:"text-xs font-bold text-yellow-600 dark:text-yellow-400 flex items-center gap-1",children:[e.jsx(je,{size:10,fill:"currentColor"})," ",f.price]}),!S&&e.jsx("button",{onClick:()=>k(f),className:"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1 rounded text-[10px] font-bold hover:opacity-80",children:"Buy"})]})]})]},f.id)})}),d&&e.jsx(gn,{user:t,userData:s,onClose:()=>v(!1)}),u&&e.jsx(un,{item:u,isOwned:m.has(u.id),user:t,onClose:()=>g(null),onBuy:()=>k(u),onDownload:()=>handleDownload(u),onReport:()=>c({id:u.id,type:"market_item",summary:u.title})}),y&&e.jsx(_a,{user:t,target:y,onClose:()=>c(null)})]})}function gn({user:t,userData:s,onClose:a}){const[i,l]=r.useState({title:"",price:"",type:"Presets",tags:"",description:""}),[n,o]=r.useState(null),[p,x]=r.useState(""),{uploadMedia:b,uploading:m}=xt(),h=async()=>{if(!i.title||!i.price||!n)return alert("Title, Price, and Audio File are required.");try{x("Uploading Audio Asset...");const d=await b(n,Z(t.uid).marketAssets);x("Listing Item..."),await Ee(D(P,Z(t.uid).marketplaceItems),{...i,price:parseInt(i.price),tags:i.tags.split(",").map(v=>v.trim()).filter(v=>v),author:`${s.firstName} ${s.lastName}`,authorId:t.uid,downloadUrl:d,timestamp:X()}),x("Success!"),setTimeout(a,1e3)}catch(d){console.error(d),x("Error listing item."),alert("Failed to submit item to market. Check console.")}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Creator Studio"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"List a new sound for sale"})]}),e.jsx("button",{onClick:a,children:e.jsx(le,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Title"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:i.title,onChange:d=>l({...i,title:d.target.value}),placeholder:"e.g. Midnight Lofi"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Type"}),e.jsxs("select",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:i.type,onChange:d=>l({...i,type:d.target.value}),children:[e.jsx("option",{children:"Presets"}),e.jsx("option",{children:"Samples"}),e.jsx("option",{children:"Beats"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Price (TK)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:i.price,onChange:d=>l({...i,price:d.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:"3",value:i.description,onChange:d=>l({...i,description:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Tags (Comma Separated)"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:i.tags,onChange:d=>l({...i,tags:d.target.value}),placeholder:"lofi, hiphop, boom-bap"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-2 border-dashed dark:border-gray-600 rounded-xl p-6 text-center hover:bg-gray-50 dark:hover:bg-gray-800 transition relative bg-blue-50/50 dark:bg-blue-900/10 h-full flex flex-col justify-center items-center",children:[e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"audio/*",onChange:d=>o(d.target.files[0])}),e.jsx(mt,{size:48,className:"mx-auto text-blue-500 mb-2"}),e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:n?n.name:"Upload Audio File (Product Asset)"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"MP3/WAV (Max 50MB)"}),n&&e.jsx("div",{className:"mt-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Selected"})]})})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:h,disabled:m||!i.title||!i.price||!n,className:"w-full bg-brand-blue text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50",children:m?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"animate-spin"})," ",p]}):"List Item for Sale"})})]})})}function un({item:t,isOwned:s,onClose:a,onBuy:i,onDownload:l,onReport:n}){return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-2xl overflow-hidden w-full max-w-4xl shadow-2xl flex flex-col md:flex-row h-[80vh] md:h-[600px]",children:[e.jsxs("div",{className:"md:w-5/12 bg-gray-100 dark:bg-black/40 relative p-8 flex flex-col justify-center items-center text-center",children:[e.jsx("div",{className:"w-64 h-64 bg-gradient-to-br from-brand-blue to-purple-600 rounded-lg shadow-2xl mb-6 flex items-center justify-center text-white",children:t.type==="Presets"?e.jsx(ts,{size:80}):e.jsx(Ss,{size:80})}),e.jsx("h2",{className:"text-2xl font-bold dark:text-white mb-2",children:t.title}),e.jsxs("div",{className:"text-brand-blue font-medium mb-6",children:["by ",t.author]}),t.downloadUrl&&e.jsx("div",{className:"w-full",children:e.jsx(fs,{audioUrl:t.downloadUrl,fileName:"Preview Track",previewMode:!s})})]}),e.jsxs("div",{className:"md:w-7/12 p-8 overflow-y-auto flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded uppercase tracking-wide",children:t.type}),e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white mt-2",children:t.title})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:n,className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-gray-400 hover:text-red-500 rounded-full transition",title:"Report Violation",children:e.jsx(jt,{size:20})}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(le,{size:20})})]})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300 mb-8",children:[e.jsx("p",{children:t.description||"No description provided by the creator."}),!s&&e.jsxs("div",{className:"mt-4 bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded text-yellow-800 dark:text-yellow-200 text-xs flex items-center gap-2",children:[e.jsx(Info,{size:14})," Audio preview is truncated to 15 seconds. Purchase to unlock full track."]})]}),e.jsx("div",{className:"mt-auto",children:s?e.jsxs("button",{onClick:l,className:"w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx(rs,{size:24})," Download Now"]}):e.jsxs("button",{onClick:i,className:"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx("span",{children:"Buy for"}),e.jsxs("span",{className:"bg-yellow-400 text-black px-2 py-0.5 rounded text-sm flex items-center gap-1",children:[e.jsx(je,{size:12,fill:"black"})," ",t.price]})]})})]})]})})}function mn({item:t,onRemove:s,onSetAlert:a,onRemoveAlert:i,onViewItem:l,onAddToCart:n}){var g,y,c;const[o,p]=r.useState(!1),[x,b]=r.useState(t.alertPrice||""),[m,h]=r.useState(!1),d=async()=>{if(!x||isNaN(parseFloat(x))){I.error("Enter a valid price");return}h(!0),await a(t.itemId,parseFloat(x)),h(!1),p(!1)},v=async()=>{h(!0),await i(t.itemId),h(!1)},u=((c=(y=(g=t.addedAt)==null?void 0:g.toDate)==null?void 0:y.call(g))==null?void 0:c.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}))||"Recently added";return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition group",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 dark:bg-gray-800 relative cursor-pointer",onClick:()=>l==null?void 0:l(t),children:[t.image?e.jsx("img",{src:t.image,alt:t.title,className:"w-full h-full object-cover group-hover:scale-105 transition duration-500"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(ut,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 backdrop-blur-sm text-white text-sm font-bold px-2 py-1 rounded",children:["$",t.price]}),t.alertOnPriceDrop&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded flex items-center gap-1",children:[e.jsx(st,{size:10}),"Alert at $",t.alertPrice]}),e.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:k=>{k.stopPropagation(),l==null||l(t)},className:"p-2 bg-white rounded-full hover:scale-110 transition",children:e.jsx(ka,{size:18,className:"text-gray-700"})}),t.itemType==="fx"&&e.jsx("button",{onClick:k=>{k.stopPropagation(),n==null||n(t)},className:"p-2 bg-brand-blue rounded-full hover:scale-110 transition",children:e.jsx(Yt,{size:18,className:"text-white"})})]})]}),e.jsxs("div",{className:"p-4",children:[t.brand&&e.jsx("div",{className:"text-[10px] font-bold text-gray-400 uppercase mb-1",children:t.brand}),e.jsx("h4",{className:"font-bold dark:text-white text-sm mb-1 line-clamp-2",title:t.title,children:t.title}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:["Added ",u]}),o?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{size:14,className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"number",value:x,onChange:k=>b(k.target.value),placeholder:"Target price",className:"w-full pl-7 pr-3 py-2 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 py-1.5 text-xs text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition",children:"Cancel"}),e.jsx("button",{onClick:d,disabled:m,className:"flex-1 py-1.5 text-xs bg-yellow-500 text-white rounded font-medium disabled:opacity-50",children:m?e.jsx(K,{size:12,className:"animate-spin mx-auto"}):"Set Alert"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[t.alertOnPriceDrop?e.jsxs("button",{onClick:v,disabled:m,className:"flex-1 flex items-center justify-center gap-1 py-2 text-xs bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400 rounded-lg font-medium hover:bg-yellow-200 dark:hover:bg-yellow-900/30 transition disabled:opacity-50",children:[e.jsx(va,{size:12}),"Remove Alert"]}):e.jsxs("button",{onClick:()=>{b(Math.floor(t.price*.9)),p(!0)},className:"flex-1 flex items-center justify-center gap-1 py-2 text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 rounded-lg font-medium hover:bg-yellow-100 dark:hover:bg-yellow-900/20 hover:text-yellow-700 dark:hover:text-yellow-400 transition",children:[e.jsx(st,{size:12}),"Price Alert"]}),e.jsx("button",{onClick:()=>s(t.itemId),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Remove from wishlist",children:e.jsx($e,{size:16})})]})]})]})}function bn({userId:t,onViewItem:s,onAddToCart:a}){const{wishlist:i,loading:l,removeFromWishlist:n,setPriceAlert:o,removePriceAlert:p,getItemsWithAlerts:x}=Es(t),[b,m]=r.useState(""),[h,d]=r.useState("all"),v=x(),u=i.filter(g=>{var c;const y=g.title.toLowerCase().includes(b.toLowerCase())||((c=g.brand)==null?void 0:c.toLowerCase().includes(b.toLowerCase()));return h==="alerts"?y&&g.alertOnPriceDrop:h==="gear"?y&&g.itemType==="gear":h==="fx"?y&&g.itemType==="fx":y});return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(K,{size:32,className:"animate-spin text-gray-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Et,{size:24,className:"text-red-500",fill:"currentColor"}),"My Wishlist"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i.length," saved item",i.length!==1?"s":"",v.length>0&&e.jsxs("span",{className:"ml-2 text-yellow-600",children:["• ",v.length," price alert",v.length!==1?"s":""," active"]})]})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Ge,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:b,onChange:g=>m(g.target.value),placeholder:"Search wishlist...",className:"w-full pl-9 pr-4 py-2 rounded-lg border dark:border-gray-700 bg-white dark:bg-[#2c2e36] text-sm dark:text-white focus:outline-none focus:ring-2 focus:ring-brand-blue"})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:[{id:"all",label:"All Items"},{id:"gear",label:"Gear"},{id:"fx",label:"SeshFx"},{id:"alerts",label:`Price Alerts (${v.length})`}].map(g=>e.jsx("button",{onClick:()=>d(g.id),className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition ${h===g.id?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:g.label},g.id))}),v.length>0&&h!=="alerts"&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center",children:e.jsx(Cr,{size:20,className:"text-yellow-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:[v.length," Price Alert",v.length!==1?"s":""," Active"]}),e.jsx("div",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:"We'll notify you when prices drop"})]})]}),e.jsx("button",{onClick:()=>d("alerts"),className:"text-sm font-medium text-yellow-700 dark:text-yellow-400 hover:underline",children:"View All"})]}),u.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700",children:[e.jsx(Et,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium dark:text-white mb-2",children:i.length===0?"Your wishlist is empty":"No items match your search"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.length===0?"Save items you like to your wishlist":"Try adjusting your filters"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:u.map(g=>e.jsx(mn,{item:g,onRemove:n,onSetAlert:o,onRemoveAlert:p,onViewItem:s,onAddToCart:a},g.id))})]})}const Ae={PENDING:"pending",PROCESSING:"processing",PAID:"paid",COMPLETED:"completed",CANCELLED:"cancelled",REFUNDED:"refunded",DISPUTED:"disputed",SHIPPED:"shipped",DELIVERED:"delivered",ESCROW_HELD:"escrow_held",ESCROW_RELEASED:"escrow_released"};function As(t,s="buyer"){const[a,i]=r.useState([]),[l,n]=r.useState(!0),o=()=>`artifacts/${ee}/orders`;r.useEffect(()=>{if(!t){i([]),n(!1);return}const c=D(P,o()),N=me(c,we(s==="seller"?"sellerId":"buyerId","==",t),Re("createdAt","desc")),f=ge(N,S=>{const j=S.docs.map(C=>{var R,E,w,z;return{id:C.id,...C.data(),createdAt:((E=(R=C.data().createdAt)==null?void 0:R.toDate)==null?void 0:E.call(R))||new Date,updatedAt:((z=(w=C.data().updatedAt)==null?void 0:w.toDate)==null?void 0:z.call(w))||new Date}});i(j),n(!1)},S=>{console.error("Error fetching orders:",S),n(!1)});return()=>f()},[t,s]);const p=r.useCallback(async({buyerId:c,buyerName:k,buyerEmail:N,sellerId:f,sellerName:S,items:j,subtotal:C,fees:R,total:E,paymentMethod:w,shippingAddress:z,orderType:A="digital",useEscrow:q=!1})=>{try{return{success:!0,orderId:(await Ee(D(P,o()),{buyerId:c,buyerName:k,buyerEmail:N,sellerId:f,sellerName:S,items:j,itemCount:j.length,subtotal:C,fees:R||0,total:E,paymentMethod:w,paymentStatus:"pending",shippingAddress:z||null,trackingNumber:null,shippingCarrier:null,orderType:A,status:q?Ae.ESCROW_HELD:Ae.PENDING,useEscrow:q,escrowReleased:!1,createdAt:X(),updatedAt:X(),completedAt:null,buyerReviewed:!1,sellerReviewed:!1})).id}}catch(G){return console.error("Error creating order:",G),I.error("Failed to create order"),{success:!1,error:G}}},[]),x=r.useCallback(async(c,k,N={})=>{try{const f=W(P,o(),c),S={status:k,updatedAt:X(),...N};return(k===Ae.COMPLETED||k===Ae.DELIVERED)&&(S.completedAt=X()),await te(f,S),I.success(`Order status updated to ${k}`),!0}catch(f){return console.error("Error updating order status:",f),I.error("Failed to update order status"),!1}},[]),b=r.useCallback(async(c,k,N)=>{try{const f=W(P,o(),c);return await te(f,{trackingNumber:k,shippingCarrier:N,status:Ae.SHIPPED,shippedAt:X(),updatedAt:X()}),I.success("Tracking information added"),!0}catch(f){return console.error("Error adding tracking:",f),I.error("Failed to add tracking"),!1}},[]),m=r.useCallback(async c=>x(c,Ae.DELIVERED,{deliveredAt:X()}),[x]),h=r.useCallback(async c=>{try{const k=W(P,o(),c),N=await Be(k);if(!N.exists())return I.error("Order not found"),!1;const f=N.data();return f.useEscrow?f.escrowReleased?(I.error("Escrow already released"),!1):(await te(k,{status:Ae.ESCROW_RELEASED,escrowReleased:!0,escrowReleasedAt:X(),updatedAt:X()}),I.success("Escrow funds released to seller"),!0):(I.error("This order does not use escrow"),!1)}catch(k){return console.error("Error releasing escrow:",k),I.error("Failed to release escrow"),!1}},[]),d=r.useCallback(async(c,k)=>{try{const N=W(P,o(),c);return await te(N,{status:Ae.DISPUTED,disputeReason:k,disputedAt:X(),updatedAt:X()}),I.success("Dispute submitted. Our team will review your case."),!0}catch(N){return console.error("Error disputing order:",N),I.error("Failed to submit dispute"),!1}},[]),v=r.useCallback(async(c,k)=>{try{const N=W(P,o(),c),f=await Be(N);if(!f.exists())return I.error("Order not found"),!1;const S=f.data();return[Ae.PENDING,Ae.PROCESSING,Ae.ESCROW_HELD].includes(S.status)?(await te(N,{status:Ae.CANCELLED,cancellationReason:k,cancelledAt:X(),updatedAt:X()}),S.useEscrow&&S.escrowReleased,I.success("Order cancelled"),!0):(I.error("This order cannot be cancelled"),!1)}catch(N){return console.error("Error cancelling order:",N),I.error("Failed to cancel order"),!1}},[]),u=r.useCallback(async c=>{var k,N,f,S;try{const j=W(P,o(),c),C=await Be(j);return C.exists()?{id:C.id,...C.data(),createdAt:((N=(k=C.data().createdAt)==null?void 0:k.toDate)==null?void 0:N.call(k))||new Date,updatedAt:((S=(f=C.data().updatedAt)==null?void 0:f.toDate)==null?void 0:S.call(f))||new Date}:null}catch(j){return console.error("Error getting order:",j),null}},[]),g=r.useCallback(c=>a.filter(k=>k.status===c),[a]),y={total:a.length,pending:a.filter(c=>c.status===Ae.PENDING).length,processing:a.filter(c=>c.status===Ae.PROCESSING).length,completed:a.filter(c=>[Ae.COMPLETED,Ae.DELIVERED].includes(c.status)).length,disputed:a.filter(c=>c.status===Ae.DISPUTED).length};return{orders:a,loading:l,orderStats:y,ORDER_STATUS:Ae,createOrder:p,updateOrderStatus:x,addTracking:b,markDelivered:m,releaseEscrow:h,disputeOrder:d,cancelOrder:v,getOrder:u,getOrdersByStatus:g}}const aa={pending:{label:"Pending",color:"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20",icon:qe,description:"Waiting for confirmation"},processing:{label:"Processing",color:"text-blue-600 bg-blue-100 dark:bg-blue-900/20",icon:ft,description:"Order is being prepared"},paid:{label:"Paid",color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:re,description:"Payment confirmed"},shipped:{label:"Shipped",color:"text-purple-600 bg-purple-100 dark:bg-purple-900/20",icon:wa,description:"On the way to you"},delivered:{label:"Delivered",color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:re,description:"Order delivered"},completed:{label:"Completed",color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:re,description:"Order complete"},cancelled:{label:"Cancelled",color:"text-gray-600 bg-gray-100 dark:bg-gray-900/20",icon:le,description:"Order was cancelled"},disputed:{label:"Disputed",color:"text-red-600 bg-red-100 dark:bg-red-900/20",icon:Fe,description:"Under review"},escrow_held:{label:"In Escrow",color:"text-orange-600 bg-orange-100 dark:bg-orange-900/20",icon:Ie,description:"Funds held securely"},escrow_released:{label:"Escrow Released",color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:re,description:"Funds released to seller"}};function hn({status:t}){const s=aa[t]||aa.pending,a=s.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold ${s.color}`,children:[e.jsx(a,{size:12}),s.label]})}function pn({order:t}){const l=t.orderType==="digital"?[{key:"pending",label:"Order Placed"},{key:"paid",label:"Payment Confirmed"},{key:"completed",label:"Download Ready"}]:[{key:"pending",label:"Order Placed"},{key:"processing",label:"Processing"},{key:"shipped",label:"Shipped"},{key:"delivered",label:"Delivered"}],n=l.findIndex(o=>o.key===t.status);return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-4 bottom-4 w-0.5 bg-gray-200 dark:bg-gray-700"}),e.jsx("div",{className:"absolute left-3 top-4 w-0.5 bg-green-500 transition-all",style:{height:`${Math.max(0,n)*100/(l.length-1)}%`}}),e.jsx("div",{className:"space-y-6",children:l.map((o,p)=>{const x=p<=n&&n>=0,b=p===n;return e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center relative z-10 ${x?"bg-green-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-400"}`,children:x?e.jsx(re,{size:14}):e.jsx("div",{className:"w-2 h-2 rounded-full bg-current"})}),e.jsxs("div",{className:`flex-1 ${b?"text-gray-900 dark:text-white":"text-gray-500"}`,children:[e.jsx("div",{className:`font-medium ${b?"text-green-600":""}`,children:o.label}),b&&t.status==="shipped"&&t.trackingNumber&&e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-gray-500",children:"Tracking: "}),e.jsxs("a",{href:`https://www.google.com/search?q=${t.shippingCarrier}+tracking+${t.trackingNumber}`,target:"_blank",rel:"noopener noreferrer",className:"text-brand-blue hover:underline flex items-center gap-1 inline-flex",children:[t.trackingNumber,e.jsx(ka,{size:12})]})]})]})]},o.key)})})]})}function fn({order:t,userId:s,userName:a,userPhoto:i,onMessageSeller:l}){var S,j,C,R,E;const[n,o]=r.useState(!1),[p,x]=r.useState(!1),[b,m]=r.useState(""),[h,d]=r.useState(!1),{releaseEscrow:v,disputeOrder:u,markDelivered:g}=As(s),y=["paid","shipped","escrow_held"].includes(t.status),c=t.useEscrow&&t.status==="escrow_held",k=t.status==="shipped",N=["completed","delivered","escrow_released"].includes(t.status)&&!t.buyerReviewed,f=t.createdAt instanceof Date?t.createdAt.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown date";return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 transition",onClick:()=>o(!n),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center",children:e.jsx(De,{size:20,className:"text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium dark:text-white flex items-center gap-2",children:["Order #",t.id.slice(0,8),e.jsx(hn,{status:t.status})]}),e.jsx("div",{className:"text-xs text-gray-500",children:f})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold dark:text-white",children:["$",t.total]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.itemCount," item",t.itemCount>1?"s":""]})]}),n?e.jsx(as,{size:20}):e.jsx(et,{size:20})]})]})}),n&&e.jsxs("div",{className:"border-t dark:border-gray-700",children:[e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase",children:"Items"}),(S=t.items)==null?void 0:S.map((w,z)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:w.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Qty: ",w.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-medium dark:text-white",children:["$",w.price]}),w.downloadUrl&&t.status!=="cancelled"&&e.jsxs("a",{href:w.downloadUrl,download:!0,className:"flex items-center gap-1 text-brand-blue hover:underline text-sm",children:[e.jsx(rs,{size:14}),"Download"]})]})]},z))]}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-4",children:"Order Progress"}),e.jsx(pn,{order:t})]}),t.trackingNumber&&e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-purple-50 dark:bg-purple-900/10",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-600 dark:text-purple-400 mb-2 flex items-center gap-2",children:[e.jsx(wa,{size:16}),"Tracking Information"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Carrier: "}),e.jsx("span",{className:"dark:text-white",children:t.shippingCarrier})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Tracking #: "}),e.jsx("a",{href:`https://www.google.com/search?q=${t.shippingCarrier}+tracking+${t.trackingNumber}`,target:"_blank",rel:"noopener noreferrer",className:"text-brand-blue hover:underline",children:t.trackingNumber})]})]}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>l==null?void 0:l(t.sellerId),className:"flex items-center gap-1 px-3 py-2 text-sm bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(St,{size:14}),"Message Seller"]}),k&&e.jsxs("button",{onClick:()=>g(t.id),className:"flex items-center gap-1 px-3 py-2 text-sm bg-green-100 text-green-700 hover:bg-green-200 rounded-lg transition",children:[e.jsx(re,{size:14}),"Confirm Delivery"]}),c&&e.jsxs("button",{onClick:()=>v(t.id),className:"flex items-center gap-1 px-3 py-2 text-sm bg-green-100 text-green-700 hover:bg-green-200 rounded-lg transition",children:[e.jsx(Ie,{size:14}),"Release Escrow"]}),N&&e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-1 px-3 py-2 text-sm bg-yellow-100 text-yellow-700 hover:bg-yellow-200 rounded-lg transition",children:[e.jsx(ze,{size:14}),"Leave Review"]}),y&&e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-1 px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg transition",children:[e.jsx(Fe,{size:14}),"Report Issue"]})]}),h&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-bold text-red-600 dark:text-red-400 mb-2",children:"Report an Issue"}),e.jsx("textarea",{value:b,onChange:w=>m(w.target.value),placeholder:"Describe the issue with your order...",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white resize-none",rows:3}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:()=>{u(t.id,b),d(!1)},disabled:!b.trim(),className:"flex-1 bg-red-500 text-white py-2 rounded-lg font-medium disabled:opacity-50",children:"Submit Dispute"})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(Hi,{sellerId:t.sellerId,userId:s,userName:a,userPhoto:i,orderId:t.id,itemId:(C=(j=t.items)==null?void 0:j[0])==null?void 0:C.itemId,itemTitle:(E=(R=t.items)==null?void 0:R[0])==null?void 0:E.title,onSuccess:()=>x(!1),onCancel:()=>x(!1)})})})]})]})]})}function yn({user:t,userData:s,onMessageSeller:a}){const{orders:i,loading:l,orderStats:n}=As(t==null?void 0:t.uid,"buyer"),[o,p]=r.useState("all"),x=o==="all"?i:i.filter(b=>b.status===o);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(De,{size:24}),"My Orders"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Track and manage your purchases"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-center px-4",children:[e.jsx("div",{className:"text-2xl font-bold dark:text-white",children:n.total}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total"})]}),e.jsxs("div",{className:"text-center px-4 border-l dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:n.pending}),e.jsx("div",{className:"text-xs text-gray-500",children:"Pending"})]}),e.jsxs("div",{className:"text-center px-4 border-l dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.completed}),e.jsx("div",{className:"text-xs text-gray-500",children:"Completed"})]})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:[{id:"all",label:"All Orders"},{id:"pending",label:"Pending"},{id:"processing",label:"Processing"},{id:"shipped",label:"Shipped"},{id:"completed",label:"Completed"},{id:"disputed",label:"Disputed"}].map(b=>e.jsx("button",{onClick:()=>p(b.id),className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition ${o===b.id?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:b.label},b.id))}),l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(K,{size:32,className:"animate-spin text-gray-400"})}):x.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700",children:[e.jsx(De,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium dark:text-white mb-2",children:"No orders found"}),e.jsx("p",{className:"text-sm text-gray-500",children:o==="all"?"You haven't made any purchases yet":`No ${o} orders`})]}):e.jsx("div",{className:"space-y-4",children:x.map(b=>e.jsx(fn,{order:b,userId:t==null?void 0:t.uid,userName:`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`,userPhoto:s==null?void 0:s.photoURL,onMessageSeller:a},b.id))})]})}const Za=r.createContext(null);function jn({children:t,userId:s}){const[a,i]=r.useState([]),[l,n]=r.useState(!0),o=()=>`artifacts/${ee}/users/${s}/cart`;r.useEffect(()=>{if(!s){i([]),n(!1);return}const g=D(P,o()),y=ge(g,c=>{const k=c.docs.map(N=>({cartId:N.id,...N.data()}));i(k),n(!1)},c=>{console.error("Error fetching cart:",c),n(!1)});return()=>y()},[s]);const p=r.useCallback(async(g,y=1)=>{var c;if(!s)return I.error("Please sign in to add items to cart"),!1;try{const k=a.find(N=>N.itemId===g.id);if(k){const N=W(P,o(),k.cartId);await Oe(N,{quantity:k.quantity+y},{merge:!0}),I.success("Updated cart quantity")}else{const N=W(D(P,o()));await Oe(N,{itemId:g.id,title:g.title,type:g.type||"digital",price:g.price,quantity:y,image:g.coverImage||((c=g.images)==null?void 0:c[0])||null,sellerId:g.sellerId||g.authorId,sellerName:g.sellerName||g.author,downloadUrl:g.downloadUrl||null,addedAt:X()}),I.success("Added to cart")}return!0}catch(k){return console.error("Error adding to cart:",k),I.error("Failed to add to cart"),!1}},[s,a]),x=r.useCallback(async g=>{if(!s)return!1;try{const y=W(P,o(),g);return await ct(y),I.success("Removed from cart"),!0}catch(y){return console.error("Error removing from cart:",y),I.error("Failed to remove from cart"),!1}},[s]),b=r.useCallback(async(g,y)=>{if(!s||y<1)return!1;try{const c=W(P,o(),g);return await Oe(c,{quantity:y},{merge:!0}),!0}catch(c){return console.error("Error updating quantity:",c),!1}},[s]),m=r.useCallback(async()=>{if(!(!s||a.length===0))try{const g=$t(P);a.forEach(y=>{const c=W(P,o(),y.cartId);g.delete(c)}),await g.commit(),I.success("Cart cleared")}catch(g){console.error("Error clearing cart:",g),I.error("Failed to clear cart")}},[s,a]),h=r.useCallback(g=>a.some(y=>y.itemId===g),[a]),d=a.reduce((g,y)=>g+y.price*y.quantity,0),v=a.reduce((g,y)=>g+y.quantity,0),u={cartItems:a,loading:l,addToCart:p,removeFromCart:x,updateQuantity:b,clearCart:m,isInCart:h,cartTotal:d,cartCount:v};return e.jsx(Za.Provider,{value:u,children:t})}function Ls(){const t=r.useContext(Za);if(!t)throw new Error("useCart must be used within a CartProvider");return t}function vn({onClick:t}){const{cartCount:s}=Ls();return e.jsxs("button",{onClick:t,className:"relative p-2 bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(Yt,{size:20,className:"dark:text-white"}),s>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-brand-blue text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center",children:s>99?"99+":s})]})}function Nn({item:t,onUpdateQuantity:s,onRemove:a}){const[i,l]=r.useState(!1),n=async o=>{o<1||(l(!0),await s(t.cartId,o),l(!1))};return e.jsxs("div",{className:"flex gap-4 p-4 bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center shrink-0",children:t.image?e.jsx("img",{src:t.image,alt:t.title,className:"w-full h-full object-cover rounded-lg"}):e.jsx(Dt,{size:24,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium dark:text-white truncate",children:t.title}),e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:t.type}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(t.quantity-1),disabled:i||t.quantity<=1,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-50",children:e.jsx(Rr,{size:14})}),e.jsx("span",{className:"w-8 text-center font-medium dark:text-white",children:i?e.jsx(K,{size:14,className:"animate-spin mx-auto"}):t.quantity}),e.jsx("button",{onClick:()=>n(t.quantity+1),disabled:i,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-50",children:e.jsx(lt,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600 dark:text-yellow-400 font-bold",children:[e.jsx(je,{size:12,fill:"currentColor"}),t.price*t.quantity]})]})]}),e.jsx("button",{onClick:()=>a(t.cartId),className:"p-1 text-gray-400 hover:text-red-500 transition self-start",children:e.jsx($e,{size:16})})]})}function kn({subtotal:t,fees:s=0,total:a,onCheckout:i,loading:l}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsxs("span",{className:"flex items-center gap-1 dark:text-white",children:[e.jsx(je,{size:12,className:"text-yellow-500",fill:"currentColor"}),t]})]}),s>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Processing Fee"}),e.jsxs("span",{className:"flex items-center gap-1 dark:text-white",children:[e.jsx(je,{size:12,className:"text-yellow-500",fill:"currentColor"}),s]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-3 flex justify-between",children:[e.jsx("span",{className:"font-bold dark:text-white",children:"Total"}),e.jsxs("span",{className:"flex items-center gap-1 font-bold text-lg text-yellow-600 dark:text-yellow-400",children:[e.jsx(je,{size:16,fill:"currentColor"}),a]})]}),e.jsx("button",{onClick:i,disabled:l,className:"w-full bg-brand-blue hover:bg-blue-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:l?e.jsx(K,{size:20,className:"animate-spin"}):e.jsxs(e.Fragment,{children:["Checkout",e.jsx(Rt,{size:18})]})})]})}function wn({isOpen:t,onClose:s,onCheckout:a,tokenBalance:i=0}){const{cartItems:l,loading:n,updateQuantity:o,removeFromCart:p,clearCart:x,cartTotal:b}=Ls(),[m,h]=r.useState(!1),d=i<b,v=async()=>{d||(h(!0),await(a==null?void 0:a(l,b)),h(!1))};return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[70]",onClick:s}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-full max-w-md bg-white dark:bg-[#23252b] z-[71] shadow-2xl flex flex-col animate-in slide-in-from-right",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yt,{size:20,className:"dark:text-white"}),e.jsx("h2",{className:"text-lg font-bold dark:text-white",children:"Shopping Cart"}),l.length>0&&e.jsx("span",{className:"bg-brand-blue text-white text-xs font-bold px-2 py-0.5 rounded-full",children:l.length})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:e.jsx(le,{size:20,className:"dark:text-white"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(K,{size:32,className:"animate-spin text-gray-400"})}):l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Yt,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium dark:text-white mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Browse the store and add items to your cart"}),e.jsx("button",{onClick:s,className:"mt-4 px-6 py-2 bg-brand-blue text-white rounded-lg font-medium hover:bg-blue-600 transition",children:"Continue Shopping"})]}):e.jsxs("div",{className:"space-y-3",children:[l.map(u=>e.jsx(Nn,{item:u,onUpdateQuantity:o,onRemove:p},u.cartId)),e.jsx("button",{onClick:x,className:"w-full py-2 text-sm text-gray-500 hover:text-red-500 transition",children:"Clear Cart"})]})}),l.length>0&&e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 space-y-3",children:[d&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-3 rounded-lg text-sm flex items-start gap-2",children:[e.jsx(Fe,{size:16,className:"shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Insufficient tokens."}),e.jsx("br",{}),"You need ",e.jsx("span",{className:"font-bold",children:b-i})," more tokens."]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Your Token Balance"}),e.jsxs("span",{className:"flex items-center gap-1 font-medium dark:text-white",children:[e.jsx(je,{size:12,className:"text-yellow-500",fill:"currentColor"}),i]})]}),e.jsx(kn,{subtotal:b,fees:0,total:b,onCheckout:v,loading:m})]})]})]}):null}function Sn({currentStep:t,steps:s}){return e.jsx("div",{className:"flex items-center justify-center gap-2 mb-8",children:s.map((a,i)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all ${i+1<t?"bg-green-500 text-white":i+1===t?"bg-brand-blue text-white":"bg-gray-200 dark:bg-gray-700 text-gray-500"}`,children:i+1<t?e.jsx(re,{size:16}):i+1}),e.jsx("span",{className:`ml-2 text-sm hidden sm:block ${i+1<=t?"text-gray-900 dark:text-white font-medium":"text-gray-400"}`,children:a}),i<s.length-1&&e.jsx("div",{className:`w-12 h-0.5 mx-3 ${i+1<t?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}`})]},a))})}function Cn({items:t,total:s,onNext:a,onBack:i}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:e.jsx("h3",{className:"font-bold dark:text-white",children:"Order Summary"})}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:t.map(l=>e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center",children:l.image?e.jsx("img",{src:l.image,alt:l.title,className:"w-full h-full object-cover rounded-lg"}):e.jsx(Dt,{size:20,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium dark:text-white truncate",children:l.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Qty: ",l.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-1 font-bold text-yellow-600 dark:text-yellow-400",children:[e.jsx(je,{size:12,fill:"currentColor"}),l.price*l.quantity]})]},l.cartId))}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-[#1f2128] border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold dark:text-white",children:"Total"}),e.jsxs("span",{className:"flex items-center gap-1 text-xl font-bold text-yellow-600 dark:text-yellow-400",children:[e.jsx(je,{size:18,fill:"currentColor"}),s]})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:i,className:"flex-1 py-3 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition flex items-center justify-center gap-2",children:[e.jsx(es,{size:18}),"Back to Cart"]}),e.jsx("button",{onClick:a,className:"flex-1 bg-brand-blue hover:bg-blue-600 text-white py-3 rounded-xl font-bold transition",children:"Continue to Payment"})]})]})}function Rn({total:t,tokenBalance:s,onConfirm:a,onBack:i,loading:l}){const n=s<t;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(xa,{size:20}),"Payment Method"]}),e.jsxs("div",{className:`p-4 rounded-xl border-2 ${n?"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/10":"border-brand-blue bg-blue-50 dark:bg-blue-900/10"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center",children:e.jsx(je,{size:20,fill:"white",className:"text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:"SeshNx Tokens"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Balance: ",e.jsx("span",{className:"font-medium",children:s})," tokens"]})]})]}),e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${n?"border-gray-300":"border-brand-blue bg-brand-blue"}`,children:!n&&e.jsx(re,{size:14,className:"text-white"})})]}),n&&e.jsxs("div",{className:"flex items-start gap-2 text-red-600 dark:text-red-400 text-sm",children:[e.jsx(Fe,{size:16,className:"shrink-0 mt-0.5"}),e.jsxs("span",{children:["Insufficient balance. You need ",e.jsx("strong",{children:t-s})," more tokens."]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(yt,{size:12}),"Your transaction is secured with end-to-end encryption"]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-[#1f2128] rounded-xl p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Amount to Pay"}),e.jsxs("span",{className:"flex items-center gap-1 text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[e.jsx(je,{size:20,fill:"currentColor"}),t]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:i,className:"flex-1 py-3 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition flex items-center justify-center gap-2",children:[e.jsx(es,{size:18}),"Back"]}),e.jsx("button",{onClick:a,disabled:l||n,className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold transition flex items-center justify-center gap-2 disabled:opacity-50",children:l?e.jsx(K,{size:20,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(yt,{size:18}),"Confirm Purchase"]})})]})]})}function zn({order:t,onContinue:s,onViewOrders:a}){var i,l;return e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(re,{size:40,className:"text-green-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white mb-2",children:"Purchase Complete!"}),e.jsx("p",{className:"text-gray-500",children:"Your order has been processed successfully."})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 mb-3",children:[e.jsx(De,{size:16}),"Order ID: ",e.jsxs("span",{className:"font-mono",children:[(i=t==null?void 0:t.id)==null?void 0:i.slice(0,8),"..."]})]}),e.jsx("div",{className:"space-y-2",children:(l=t==null?void 0:t.items)==null?void 0:l.map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"dark:text-white",children:n.title}),n.downloadUrl&&e.jsxs("a",{href:n.downloadUrl,download:!0,className:"flex items-center gap-1 text-brand-blue hover:underline",children:[e.jsx(rs,{size:14}),"Download"]})]},o))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:a,className:"flex-1 py-3 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"View Orders"}),e.jsx("button",{onClick:s,className:"flex-1 bg-brand-blue hover:bg-blue-600 text-white py-3 rounded-xl font-bold transition",children:"Continue Shopping"})]})]})}function Pn({user:t,userData:s,tokenBalance:a,onClose:i,onSuccess:l,onViewOrders:n,refreshWallet:o}){const{cartItems:p,cartTotal:x,clearCart:b}=Ls(),{createOrder:m}=As(t==null?void 0:t.uid),[h,d]=r.useState(1),[v,u]=r.useState(!1),[g,y]=r.useState(null),c=["Review","Payment","Confirmation"],k=async()=>{var f;if(a<x){I.error("Insufficient token balance");return}u(!0);try{const S=p.reduce((C,R)=>{const E=R.sellerId||"platform";return C[E]||(C[E]=[]),C[E].push(R),C},{}),j=[];for(const[C,R]of Object.entries(S)){const E=R.reduce((z,A)=>z+A.price*A.quantity,0),w=await m({buyerId:t.uid,buyerName:`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"Anonymous",buyerEmail:t.email,sellerId:C,sellerName:((f=R[0])==null?void 0:f.sellerName)||"SeshNx Store",items:R.map(z=>({itemId:z.itemId,title:z.title,type:z.type,quantity:z.quantity,price:z.price,downloadUrl:z.downloadUrl})),subtotal:E,fees:0,total:E,paymentMethod:"tokens",orderType:"digital"});w.success&&j.push({id:w.orderId,items:R,total:E})}j.length>0?(y({id:j[0].id,items:p,total:x}),await b(),o&&o(),d(3),I.success("Purchase complete!")):I.error("Failed to process order")}catch(S){console.error("Checkout error:",S),I.error("Failed to process payment")}u(!1)},N=()=>{l==null||l(),i==null||i()};return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#23252b] rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:e.jsx(Sn,{currentStep:h,steps:c})}),e.jsxs("div",{className:"p-6",children:[h===1&&e.jsx(Cn,{items:p,total:x,onNext:()=>d(2),onBack:i}),h===2&&e.jsx(Rn,{total:x,tokenBalance:a,onConfirm:k,onBack:()=>d(1),loading:v}),h===3&&e.jsx(zn,{order:g,onContinue:N,onViewOrders:n})]})]})})}function En({user:t,userData:s,tokenBalance:a,refreshWallet:i,onNavigateToChat:l}){const[n,o]=r.useState("gear"),[p,x]=r.useState(!1),[b,m]=r.useState(!1),h=[{id:"gear",label:"Gear Exchange",icon:vt},{id:"fx",label:"SeshFX Store",icon:mt},{id:"distribution",label:"Distribution",icon:Bs},{id:"wishlist",label:"Wishlist",icon:Et},{id:"orders",label:"My Orders",icon:De}],d=()=>{x(!1),m(!0)};return e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Bs,{className:"text-brand-blue"}),"Marketplace"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Buy, sell, and distribute your music and gear"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(vn,{onClick:()=>x(!0)})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-1 rounded-xl border dark:border-gray-700 flex gap-1 overflow-x-auto",children:h.map(v=>{const u=v.icon;return e.jsxs("button",{onClick:()=>o(v.id),className:`px-4 py-2.5 text-sm font-medium rounded-lg transition-all flex items-center gap-2 whitespace-nowrap ${n===v.id?"bg-brand-blue text-white shadow-md":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(u,{size:16}),v.label]},v.id)})}),e.jsxs("div",{className:"min-h-[600px]",children:[n==="distribution"&&e.jsx(Ua,{user:t,userData:s}),n==="gear"&&e.jsx(nn,{user:t,userData:s,onNavigateToChat:l}),n==="fx"&&e.jsx(xn,{user:t,userData:s,tokenBalance:a,refreshWallet:i}),n==="wishlist"&&e.jsx(bn,{userId:t==null?void 0:t.uid,onViewItem:v=>{v.itemType==="gear"?o("gear"):o("fx")}}),n==="orders"&&e.jsx(yn,{user:t,userData:s,onMessageSeller:l})]}),e.jsx(wn,{isOpen:p,onClose:()=>x(!1),onCheckout:d,tokenBalance:a}),b&&e.jsx(Pn,{user:t,userData:s,tokenBalance:a,onClose:()=>m(!1),onSuccess:()=>m(!1),onViewOrders:()=>{m(!1),o("orders")},refreshWallet:i})]})}function An({user:t,userData:s,tokenBalance:a,refreshWallet:i,onNavigateToChat:l}){return e.jsx(jn,{userId:t==null?void 0:t.uid,children:e.jsx(En,{user:t,userData:s,tokenBalance:a,refreshWallet:i,onNavigateToChat:l})})}function Ln({user:t,userData:s,openPublicProfile:a,pendingChatTarget:i,clearPendingChatTarget:l}){const[n,o]=r.useState(null),[p,x]=r.useState(!1);jl(t==null?void 0:t.uid),r.useEffect(()=>{if(i&&(t!=null&&t.uid)){const v=[t.uid,i.uid].sort().join("_");o({id:v,uid:i.uid,name:i.name,type:"direct"}),l==null||l()}},[i,t==null?void 0:t.uid,l]);const b=ps(),m=r.useMemo(()=>t!=null&&t.uid&&b?{userId:t.uid}:"skip",[t==null?void 0:t.uid,b]),h=ma(Ca.conversations.getConversations,m),d=r.useMemo(()=>h?h.map(v=>({id:v.chatId,uid:v.otherUserId||v.chatId,name:v.chatName||"Unknown",n:v.chatName||"Unknown",photo:v.chatPhoto||"",type:v.chatType||"direct",lm:v.lastMessage||"",lmt:v.lastMessageTime||0,ls:v.lastSenderId||"",uc:v.unreadCount||0})).sort((v,u)=>(u.lmt||0)-(v.lmt||0)):[],[h]);return r.useEffect(()=>{ps()||console.warn("Convex is not available. Chat functionality is disabled.")},[]),e.jsxs("div",{className:"flex h-[calc(100vh-100px)] bg-white dark:bg-[#1f2128] rounded-2xl overflow-hidden border dark:border-gray-800 shadow-xl",children:[e.jsx(Ne.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`w-full md:w-80 border-r dark:border-gray-800 flex flex-col ${n?"hidden md:flex":"flex"}`,children:e.jsx(vl,{user:t,userData:s,conversations:d,activeChat:n,onSelectChat:o})}),e.jsxs("div",{className:`flex-1 flex flex-col relative ${n?"flex":"hidden md:flex"}`,children:[e.jsx(Nl,{activeChat:n,user:t,userData:s,conversations:d,onBack:()=>o(null),toggleDetails:()=>x(!p),openPublicProfile:a}),e.jsx(nt,{children:p&&n&&e.jsx(Ne.div,{initial:{width:0,opacity:0},animate:{width:300,opacity:1},exit:{width:0,opacity:0},className:"border-l dark:border-gray-800 bg-gray-50 dark:bg-[#23262f] overflow-hidden relative z-20",children:e.jsx(kl,{activeChat:n,currentUser:s,onClose:()=>x(!1)})})})]})]})}function ra({userData:t,stats:s,onNavigate:a}){const i=(t==null?void 0:t.studioName)||(t==null?void 0:t.profileName)||"My Studio",l=(t==null?void 0:t.rooms)||[],n=(t==null?void 0:t.amenities)||[],o=l.reduce((m,h)=>m+(h.capacity||0),0),p=l.length>0?Math.round(l.reduce((m,h)=>m+(h.rate||0),0)/l.length):0,x=[{label:"Active Rooms",value:l.length,icon:e.jsx(tt,{size:20}),color:"blue",onClick:()=>a("rooms")},{label:"Total Capacity",value:`${o} ppl`,icon:e.jsx(_e,{size:20}),color:"green"},{label:"Avg. Rate",value:`$${p}/hr`,icon:e.jsx(Ce,{size:20}),color:"purple"},{label:"Amenities",value:n.length,icon:e.jsx(ze,{size:20}),color:"amber"}],b=(s==null?void 0:s.pendingBookings)||0;return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-8 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm",children:e.jsx(tt,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:i}),e.jsxs("p",{className:"text-blue-100 text-sm flex items-center gap-1",children:[e.jsx(Te,{size:14}),t!=null&&t.city&&(t!=null&&t.state)?`${t.city}, ${t.state}`:"Location not set"]})]})]}),(t==null?void 0:t.studioDescription)&&e.jsx("p",{className:"text-blue-100 text-sm mt-4 max-w-2xl line-clamp-2",children:t.studioDescription})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:x.map((m,h)=>e.jsxs("button",{onClick:m.onClick,className:`bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm text-left transition-all ${m.onClick?"hover:shadow-md hover:border-brand-blue cursor-pointer":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-lg bg-${m.color}-100 dark:bg-${m.color}-900/20 flex items-center justify-center text-${m.color}-600 dark:text-${m.color}-400 mb-3`,children:m.icon}),e.jsx("div",{className:"text-2xl font-bold dark:text-white",children:m.value}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase font-medium tracking-wide",children:m.label})]},h))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Fe,{size:18,className:"text-amber-500"}),"Pending Actions"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[b>0?e.jsxs("button",{onClick:()=>a("bookings"),className:"w-full flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30 transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"text-amber-600",size:18}),e.jsxs("span",{className:"text-sm font-medium dark:text-amber-300",children:[b," Pending Booking",b>1?"s":""]})]}),e.jsx("span",{className:"text-xs text-amber-600 font-bold",children:"Review →"})]}):e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx(re,{className:"text-green-600",size:18}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"All caught up!"})]}),!(t!=null&&t.studioDescription)&&e.jsxs("button",{onClick:()=>a("settings"),className:"w-full flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Add studio description"}),e.jsx("span",{className:"text-xs text-blue-600 font-bold",children:"Setup →"})]}),l.length===0&&e.jsxs("button",{onClick:()=>a("rooms"),className:"w-full flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Add your first room"}),e.jsx("span",{className:"text-xs text-purple-600 font-bold",children:"Add →"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(tt,{size:18,className:"text-brand-blue"}),"Rooms"]}),e.jsx("button",{onClick:()=>a("rooms"),className:"text-xs text-brand-blue font-bold hover:underline",children:"Manage →"})]}),e.jsx("div",{className:"p-4",children:l.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(tt,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No rooms configured yet"})]}):e.jsxs("div",{className:"space-y-2",children:[l.slice(0,4).map((m,h)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white text-sm",children:m.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m.capacity," people • ",m.equipment?m.equipment.split(",").length:0," gear items"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-bold text-green-600 dark:text-green-400",children:["$",m.rate,"/hr"]})})]},h)),l.length>4&&e.jsxs("p",{className:"text-xs text-center text-gray-400 pt-2",children:["+",l.length-4," more rooms"]})]})})]})]}),n.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(ze,{size:18,className:"text-amber-500"}),"Studio Amenities"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map((m,h)=>e.jsx("span",{className:"px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:m},h))})]})]})}const In=()=>{const{data:t,loading:s}=Va(),[a,i]=r.useState([]),l=r.useMemo(()=>{if(s||!t)return[];let o=[];try{Object.keys(t).forEach(p=>{const x=t[p];x&&Object.entries(x).forEach(([b,m])=>{if(!m||typeof m!="object")return;const h=m.brand||m.searchTokens&&m.searchTokens[0]||"Unknown",d=m.name||m.searchTokens&&m.searchTokens[1]||"Unknown Item",v=m.searchTokens||[],u=[d,h,...v].join(" ").toLowerCase();o.push({id:b,name:d,brand:h,category:m.category||p,subCategory:m.subCategory||"General",searchString:u,original:m})})})}catch(p){console.warn("Error processing equipment data:",p)}return o},[t,s]);return{searchEquipment:o=>{if(!o||o.trim().length<1){i([]);return}const p=o.toLowerCase().trim().split(/\s+/),x=l.filter(b=>p.every(m=>b.searchString.includes(m))).slice(0,50);i(x)},results:a,loading:s}};function Is({onSelect:t,placeholder:s="Search for gear (e.g. U87, SSL)...",className:a="",value:i,onChange:l,multi:n=!1}){const{searchEquipment:o,results:p,loading:x}=In(),[b,m]=r.useState(""),[h,d]=r.useState(!1),v=r.useRef(null),u=i!==void 0?i:b;r.useEffect(()=>{function c(k){v.current&&!v.current.contains(k.target)&&d(!1)}return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[v]);const g=c=>{const k=c.target.value;l?l(k):m(k);const N=n?k.split(",").pop().trim():k;N.length>=2?(o(N),d(!0)):d(!1)},y=c=>{const k=c.brand!=="Various"&&c.brand!=="Unknown"?`${c.brand} ${c.name}`:c.name;if(n){const N=u.split(",");N.pop();const S=[...N.map(j=>j.trim()).filter(Boolean),k].join(", ")+", ";l?l(S):m(S)}else t&&t({...c,fullName:k}),l?l(k):m(k);d(!1)};return e.jsxs("div",{ref:v,className:`relative ${a}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-8 p-3 text-sm border rounded-xl bg-white dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none transition-all",placeholder:s,value:u,onChange:g,onFocus:c=>g(c)}),u&&e.jsx("button",{type:"button",onClick:()=>{l?l(""):m(""),d(!1)},className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:e.jsx(le,{size:16})})]}),h&&p.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-60 overflow-y-auto animate-in fade-in slide-in-from-top-2",children:e.jsx("div",{className:"py-1",children:p.map(c=>{var k;return e.jsxs("button",{type:"button",onClick:()=>y(c),className:"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group",children:[e.jsx("div",{className:"font-bold text-sm dark:text-white group-hover:text-brand-blue transition-colors",children:c.name}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1.5 mt-0.5",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:c.brand}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600"}),e.jsx("span",{className:"opacity-75",children:(k=c.subCategory)==null?void 0:k.replace(/_/g," ")})]})]},c.id)})})}),h&&x&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2",children:[e.jsx(K,{className:"animate-spin",size:16})," Searching database..."]})]})}const Ve=10,$n=(t,s,a,i,l,n)=>{const o=t-a,p=s-i,x=l-a,b=n-i,m=o*x+p*b,h=x*x+b*b;let d=-1;h!==0&&(d=m/h);let v,u;d<0?(v=a,u=i):d>1?(v=l,u=n):(v=a+d*x,u=i+d*b);const g=t-v,y=s-u;return Math.sqrt(g*g+y*y)};function Tn({rooms:t,walls:s,structures:a,onRoomClick:i,onLayoutChange:l,onWallsChange:n,onStructuresChange:o}){var de;const p=r.useRef(null),[x,b]=r.useState(!1),[m,h]=r.useState(!1),[d,v]=r.useState({x:0,y:0}),[u,g]=r.useState(null),[y,c]=r.useState(null),[k,N]=r.useState(null),[f,S]=r.useState(null),[j,C]=r.useState(s||[]),[R,E]=r.useState(a||[]),[w,z]=r.useState(null),[A,q]=r.useState("select"),[G,H]=r.useState(null),J=800,M=600;r.useEffect(()=>{C(s||[])},[s]),r.useEffect(()=>{E(a||[])},[a]);const L=F=>{const Y=p.current.getBoundingClientRect();let $=F.clientX,T=F.clientY;F.touches&&F.touches.length>0&&($=F.touches[0].clientX,T=F.touches[0].clientY);const se=$-Y.left,be=T-Y.top;return{x:Math.round(se/Ve)*Ve,y:Math.round(be/Ve)*Ve}},_=F=>{C(F),n(F)},B=F=>{E(F),o(F)},U=r.useCallback(()=>{if(y){const F=R.filter(Y=>Y.id!==y);B(F),c(null)}else if(k){const F=j.filter(Y=>Y.id!==k);_(F),N(null)}},[y,k,R,j]),Q=r.useCallback(()=>{if(y){const F=R.find(Y=>Y.id===y);F&&z({type:"structure",data:F})}else if(k){const F=j.find(Y=>Y.id===k);F&&z({type:"wall",data:F})}},[y,k,R,j]),xe=r.useCallback(()=>{if(!w)return;const F=20;if(w.type==="structure"){const Y={...w.data,id:`struct_${Date.now()}`,layout:{...w.data.layout,x:w.data.layout.x+F,y:w.data.layout.y+F}};B([...R,Y]),c(Y.id)}else if(w.type==="wall"){const Y={...w.data,id:`wall_${Date.now()}`,x1:w.data.x1+F,y1:w.data.y1+F,x2:w.data.x2+F,y2:w.data.y2+F};_([...j,Y]),N(Y.id)}},[w,R,j]),ye=r.useCallback(()=>{Q(),U()},[Q,U]);r.useEffect(()=>{const F=Y=>{(Y.key==="Delete"||Y.key==="Backspace")&&U(),(Y.ctrlKey||Y.metaKey)&&Y.key==="c"&&(Y.preventDefault(),Q()),(Y.ctrlKey||Y.metaKey)&&Y.key==="v"&&(Y.preventDefault(),xe()),(Y.ctrlKey||Y.metaKey)&&Y.key==="x"&&(Y.preventDefault(),ye())};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)},[U,Q,xe,ye]);const pe=r.useCallback((F,Y)=>{if(A!=="select")return;F.preventDefault(),F.stopPropagation();const{x:$,y:T}=L(F);g(Y.id),c(null),N(null),b(!0),h(!1),v({x:$-Y.layout.x,y:T-Y.layout.y})},[A]),ce=r.useCallback((F,Y,$)=>{F.preventDefault(),F.stopPropagation(),g(Y.id),c(null),N(null),b(!1),h($)},[]),he=()=>{const F={id:`struct_${Date.now()}`,label:"Lobby / Area",layout:{x:100,y:100,width:150,height:100,color:"#94a3b8"}};B([...R,F]),q("select")},ue=r.useCallback((F,Y)=>{if(A!=="select")return;F.preventDefault(),F.stopPropagation();const{x:$,y:T}=L(F);c(Y.id),g(null),N(null),b(!0),h(!1),v({x:$-Y.layout.x,y:T-Y.layout.y})},[A]),fe=r.useCallback((F,Y,$)=>{F.preventDefault(),F.stopPropagation(),c(Y.id),g(null),N(null),b(!1),h($)},[]),O=r.useCallback((F,Y,$)=>{A==="select"&&(F.preventDefault(),F.stopPropagation(),S({id:Y,point:$}),g(null),c(null),N(Y))},[A]),ie=(F,Y)=>{A==="select"&&(F.stopPropagation(),N(Y),g(null),c(null))},ne=r.useCallback(F=>{if(!p.current)return;const{x:Y,y:$}=L(F);if(A==="wall"&&G){const T={id:"preview",x1:G.x,y1:G.y,x2:Y,y2:$};C(se=>[...se.filter(be=>be.id!=="preview"),T]);return}if(f){C(T=>T.map(se=>se.id!==f.id?se:f.point==="start"?{...se,x1:Y,y1:$}:{...se,x2:Y,y2:$}));return}if(x){const T={x:Y-d.x,y:$-d.y};if(u){const se=t.find(be=>be.id===u);se&&l(u,{...se.layout,...T})}else y&&E(se=>se.map(be=>be.id===y?{...be,layout:{...be.layout,...T}}:be))}if(m==="br")if(u){const T=t.find(se=>se.id===u);if(T){const se={width:Math.max(Ve,Y-T.layout.x),height:Math.max(Ve,$-T.layout.y)};l(u,{...T.layout,...se})}}else y&&E(T=>T.map(se=>se.id!==y?se:{...se,layout:{...se.layout,width:Math.max(Ve,Y-se.layout.x),height:Math.max(Ve,$-se.layout.y)}}))},[u,y,x,m,f,d,t,l,A,G]),V=r.useCallback(()=>{(x||m)&&y&&o(R),f&&n(j),b(!1),h(!1),S(null)},[x,m,f,y,R,j,o,n]),ae=r.useCallback(F=>{if(A!=="wall"){!x&&!m&&(g(null),c(null),N(null));return}F.stopPropagation();const{x:Y,y:$}=L(F);if(!G)H({x:Y,y:$});else{const T={id:`wall_${Date.now()}`,x1:G.x,y1:G.y,x2:Y,y2:$,stroke:"#52525B",strokeWidth:5},se=[...j.filter(be=>be.id!=="preview"),T];_(se),H(null)}},[A,G,x,m,j]),ve=F=>{q(F),H(null),F==="structure"?he():C(Y=>Y.filter($=>$.id!=="preview"))};r.useEffect(()=>(document.addEventListener("mousemove",ne),document.addEventListener("mouseup",V),document.addEventListener("touchmove",ne),document.addEventListener("touchend",V),()=>{document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",V),document.removeEventListener("touchmove",ne),document.removeEventListener("touchend",V)}),[ne,V]);const Xe=({wall:F})=>{const Y=F.id==="preview",$=k===F.id;return e.jsxs("g",{onClick:T=>ie(T,F.id),cursor:"pointer",children:[e.jsx("line",{x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,stroke:"transparent",strokeWidth:"15"}),e.jsx("line",{x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,stroke:Y?"#ef4444":$?"#3D84ED":F.stroke,strokeWidth:F.strokeWidth,strokeLinecap:"round",opacity:Y?.7:1}),!Y&&e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:F.x1,cy:F.y1,r:6,fill:"white",stroke:"#52525B",strokeWidth:"2",className:"cursor-move hover:fill-brand-blue",onMouseDown:T=>O(T,F.id,"start")}),e.jsx("circle",{cx:F.x2,cy:F.y2,r:6,fill:"white",stroke:"#52525B",strokeWidth:"2",className:"cursor-move hover:fill-brand-blue",onMouseDown:T=>O(T,F.id,"end")})]})]})},Ye=({data:F,isStructure:Y=!1,onClick:$})=>{const{layout:T,name:se,rate:be,label:os}=F,$s=Y?y===F.id:u===F.id,Ot=(Me,er)=>j.some(Bt=>$n(Me,er,Bt.x1,Bt.y1,Bt.x2,Bt.y2)<12),ds=Ot(T.x,T.y),Ts=Ot(T.x+T.width,T.y),Ms=Ot(T.x+T.width,T.y+T.height),Fs=Ot(T.x,T.y+T.height),it=8,Da=[`M ${T.x+(ds?0:it)} ${T.y}`,`L ${T.x+T.width-(Ts?0:it)} ${T.y}`,`Q ${T.x+T.width} ${T.y} ${T.x+T.width} ${T.y+(Ts?0:it)}`,`L ${T.x+T.width} ${T.y+T.height-(Ms?0:it)}`,`Q ${T.x+T.width} ${T.y+T.height} ${T.x+T.width-(Ms?0:it)} ${T.y+T.height}`,`L ${T.x+(Fs?0:it)} ${T.y+T.height}`,`Q ${T.x} ${T.y+T.height} ${T.x} ${T.y+T.height-(Fs?0:it)}`,`L ${T.x} ${T.y+(ds?0:it)}`,`Q ${T.x} ${T.y} ${T.x+(ds?0:it)} ${T.y}`,"Z"].join(" ");return e.jsxs("g",{onClick:Me=>{Me.stopPropagation(),$(F)},cursor:"pointer",style:{filter:$s?`drop-shadow(0 0 5px ${T.color})`:"none"},pointerEvents:A!=="select"?"none":"auto",children:[e.jsx("path",{d:Da,fill:T.color,opacity:Y?"0.5":"0.8",stroke:T.color,strokeWidth:"4",strokeDasharray:Y?"5,5":"0",onMouseDown:Me=>Y?ue(Me,F):pe(Me,F),onTouchStart:Me=>Y?ue(Me,F):pe(Me,F),style:{cursor:m?"default":"grab"}}),e.jsxs("text",{x:T.x+T.width/2,y:T.y+T.height/2,fill:"white",textAnchor:"middle",dominantBaseline:"middle",style:{pointerEvents:"none",userSelect:"none"},children:[e.jsx("tspan",{x:T.x+T.width/2,dy:"-0.5em",fontWeight:"bold",fontSize:"14",children:Y?os||"Area":se}),!Y&&be&&e.jsxs("tspan",{x:T.x+T.width/2,dy:"1.2em",fontSize:"12",children:["$",be,"/hr"]})]}),$s&&e.jsx("rect",{x:T.x+T.width-10,y:T.y+T.height-10,width:"20",height:"20",fill:"white",stroke:"black",strokeWidth:"2",rx:"4",cursor:"nwse-resize",onMouseDown:Me=>Y?fe(Me,F,"br"):ce(Me,F,"br"),onTouchStart:Me=>Y?fe(Me,F,"br"):ce(Me,F,"br")})]})};return e.jsxs("div",{className:"flex flex-col h-[650px]",children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36] rounded-t-xl",children:[e.jsxs("div",{className:"flex gap-4 text-sm text-gray-500 font-medium",children:[e.jsxs("button",{onClick:Q,disabled:!y&&!k,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[e.jsx(Ft,{size:14})," Copy"]}),e.jsxs("button",{onClick:xe,disabled:!w,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[e.jsx(zr,{size:14})," Paste"]}),e.jsxs("button",{onClick:ye,disabled:!y&&!k,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[e.jsx(Pr,{size:14})," Cut"]}),e.jsxs("button",{onClick:U,disabled:!y&&!k,className:"hover:text-red-500 disabled:opacity-50 flex items-center gap-1",children:[e.jsx($e,{size:14})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${A==="structure"?"bg-purple-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200"}`,onClick:()=>ve("structure"),children:[e.jsx(Er,{size:16})," Add Lobby / Area"]}),e.jsxs("button",{className:`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${A==="wall"?"bg-red-500 text-white shadow-lg":"bg-brand-blue text-white hover:bg-blue-600"}`,onClick:()=>ve(A==="wall"?"select":"wall"),children:[e.jsx(je,{size:16})," ",A==="wall"?G?"Finish Wall":"Drawing Mode":"Add Wall"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto bg-gray-50 dark:bg-[#1f2128] rounded-b-xl border-x border-b dark:border-gray-700 relative",style:{cursor:A==="wall"?"crosshair":"default"},tabIndex:0,onKeyDown:F=>{},children:[e.jsxs("svg",{ref:p,width:J,height:M,className:"w-full h-full shadow-inner focus:outline-none",viewBox:`0 0 ${J} ${M}`,onMouseMove:ne,onMouseUp:V,onTouchMove:ne,onTouchEnd:V,onClick:ae,children:[e.jsx("pattern",{id:"smallGrid",width:Ve,height:Ve,patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:`M ${Ve} 0 L 0 0 0 ${Ve}`,fill:"none",stroke:"#e5e7eb",strokeWidth:"0.5"})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#smallGrid)"}),R.map(F=>e.jsx(Ye,{data:F,isStructure:!0,onClick:()=>c(F.id)},F.id)),t.map(F=>e.jsx(Ye,{data:F,onClick:Y=>i(t.findIndex($=>$.id===Y.id))},F.id)),j.map(F=>e.jsx(Xe,{wall:F},F.id)),e.jsxs("text",{x:"10",y:"20",fontSize:"10",fill:"#9CA3AF",children:["Grid: ",Ve,"px | ",j.length," Walls"]})]}),y&&e.jsxs("div",{className:"absolute bottom-4 right-4 bg-white dark:bg-dark-card p-2 rounded shadow border dark:border-gray-600 text-xs flex gap-2",children:[e.jsx("input",{className:"bg-transparent border-b border-gray-300 focus:border-blue-500 outline-none dark:text-white",value:(de=R.find(F=>F.id===y))==null?void 0:de.label,onChange:F=>{const Y=F.target.value;E($=>$.map(se=>se.id===y?{...se,label:Y}:se))},onBlur:()=>B(R)}),e.jsx("button",{onClick:U,className:"text-red-500 hover:bg-red-50 rounded p-1",children:e.jsx($e,{size:14})})]})]})]})}function Mn({user:t,userData:s,onUpdate:a}){const[i,l]=r.useState((s==null?void 0:s.rooms)||[]),[n,o]=r.useState((s==null?void 0:s.floorplanWalls)||[]),[p,x]=r.useState((s==null?void 0:s.floorplanStructures)||[]),[b,m]=r.useState(null),[h,d]=r.useState(!1),[v,u]=r.useState(!1),[g,y]=r.useState(null),[c,k]=r.useState("list"),N={name:"",description:"",rate:50,capacity:4,equipment:"",amenities:[],minBookingHours:1,active:!0,color:"#3B82F6"},f=async(M,L=n,_=p)=>{u(!0);const B=I.loading("Saving rooms...");try{const U=W(P,`artifacts/${ee}/users/${t.uid}/profiles/main`);await te(U,{rooms:M,floorplanWalls:L,floorplanStructures:_}),l(M),o(L),x(_),I.success("Rooms saved!",{id:B}),a&&a({rooms:M,floorplanWalls:L,floorplanStructures:_})}catch(U){console.error("Save failed:",U),I.error("Failed to save",{id:B})}finally{u(!1)}},S=(M,L)=>{const _=i.map(B=>B.id===M?{...B,layout:L}:B);l(_)},j=async M=>{o(M);try{const L=W(P,`artifacts/${ee}/users/${t.uid}/profiles/main`);await te(L,{floorplanWalls:M})}catch(L){console.error("Error saving walls:",L)}},C=async M=>{x(M);try{const L=W(P,`artifacts/${ee}/users/${t.uid}/profiles/main`);await te(L,{floorplanStructures:M})}catch(L){console.error("Error saving structures:",L)}},R=M=>{M>=0&&M<i.length&&w(M)},E=()=>{m({...N,name:`Room ${i.length+1}`}),d(!0)},w=M=>{m({...i[M]}),d(!1),y(M)},z=async()=>{if(!b.name.trim()){I.error("Room name is required");return}let M;h?M=[...i,b]:M=i.map((L,_)=>_===g?b:L),await f(M),m(null),d(!1),y(null)},A=async M=>{if(!confirm(`Delete "${i[M].name}"? This cannot be undone.`))return;const L=i.filter((_,B)=>B!==M);await f(L)},q=async M=>{const L={...i[M],name:`${i[M].name} (Copy)`},_=[...i,L];await f(_)},G=()=>{m(null),d(!1),y(null)},H=["Isolation Booth","Live Room","Control Room","Lounge Area","Private Bathroom","Natural Light","Blackout Curtains","Video Feed","Climate Control","Sound Lock"],J=i.map((M,L)=>({...M,id:M.id||`room_${L}`,layout:M.layout||{x:50+L%3*200,y:50+Math.floor(L/3)*150,width:180,height:120,color:M.color||"#3B82F6"}}));return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(hs,{className:"text-brand-blue",size:24}),"Room Management"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Configure your studio rooms, rates, and equipment"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>k("list"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${c==="list"?"bg-white dark:bg-gray-700 shadow text-brand-blue":"text-gray-600 dark:text-gray-400"}`,children:[e.jsx(Ar,{size:16})," List"]}),e.jsxs("button",{onClick:()=>k("floorplan"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${c==="floorplan"?"bg-white dark:bg-gray-700 shadow text-brand-blue":"text-gray-600 dark:text-gray-400"}`,children:[e.jsx(Lr,{size:16})," Floorplan"]})]}),e.jsxs("button",{onClick:E,disabled:h||b,className:"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[e.jsx(lt,{size:18})," Add Room"]})]})]}),h&&b&&e.jsx(la,{room:b,setRoom:m,onSave:z,onCancel:G,saving:v,isNew:!0,roomAmenities:H}),c==="floorplan"&&!h&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsx(Tn,{rooms:J,walls:n,structures:p,onRoomClick:R,onLayoutChange:S,onWallsChange:j,onStructuresChange:C}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-[#23262f] border-t dark:border-gray-700 text-xs text-gray-500",children:[e.jsx("strong",{children:"Tips:"})," Click a room to edit • Drag to reposition • Use corner handles to resize • Add walls to define boundaries"]})]}),c==="list"&&e.jsx("div",{className:"space-y-4",children:i.length===0&&!h?e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center",children:[e.jsx(hs,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Rooms Yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-sm mx-auto",children:"Add your first room to start accepting bookings"}),e.jsx("button",{onClick:E,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition",children:"Add Your First Room"})]}):i.map((M,L)=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-[#23262f] transition",onClick:()=>y(g===L?null:L),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:M.color||"#3B82F6"},children:M.name.charAt(0)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:M.name}),M.active===!1&&e.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-0.5 rounded",children:"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ce,{size:14}),"$",M.rate,"/hr"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_e,{size:14}),M.capacity," people"]}),M.equipment&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Sa,{size:14}),M.equipment.split(",").length," items"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:_=>{_.stopPropagation(),q(L)},className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Duplicate",children:e.jsx(Ft,{size:16})}),e.jsx("button",{onClick:_=>{_.stopPropagation(),w(L)},className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit",children:e.jsx(ss,{size:16})}),e.jsx("button",{onClick:_=>{_.stopPropagation(),A(L)},className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete",children:e.jsx($e,{size:16})}),g===L?e.jsx(as,{size:20}):e.jsx(et,{size:20})]})]}),g===L&&b&&e.jsx("div",{className:"border-t dark:border-gray-700",children:e.jsx(la,{room:b,setRoom:m,onSave:z,onCancel:G,saving:v,isNew:!1,roomAmenities:H})}),g===L&&!b&&e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#1f2128]",children:[M.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:M.description}),M.equipment&&e.jsx("div",{className:"flex flex-wrap gap-2",children:M.equipment.split(",").map((_,B)=>e.jsx("span",{className:"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded",children:_.trim()},B))})]})]},L))})]})}function la({room:t,setRoom:s,onSave:a,onCancel:i,saving:l,isNew:n,roomAmenities:o}){const p=x=>{const b=t.amenities||[];b.includes(x)?s({...t,amenities:b.filter(m=>m!==x)}):s({...t,amenities:[...b,x]})};return e.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-[#1f2128] space-y-5",children:[n&&e.jsx("h3",{className:"font-bold dark:text-white text-lg mb-4",children:"Add New Room"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Room Name *"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:t.name,onChange:x=>s({...t,name:x.target.value}),placeholder:"e.g. Studio A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Room Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",className:"w-12 h-12 rounded-lg border dark:border-gray-600 cursor-pointer",value:t.color||"#3B82F6",onChange:x=>s({...t,color:x.target.value})}),e.jsx("input",{className:"flex-1 p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:t.color||"#3B82F6",onChange:x=>s({...t,color:x.target.value}),placeholder:"#3B82F6"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",rows:2,value:t.description||"",onChange:x=>s({...t,description:x.target.value}),placeholder:"Describe this room, its vibe, and what makes it special..."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hourly Rate ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:t.rate,onChange:x=>s({...t,rate:parseInt(x.target.value)||0}),min:0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Capacity"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:t.capacity,onChange:x=>s({...t,capacity:parseInt(x.target.value)||1}),min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Hours"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:t.minBookingHours||1,onChange:x=>s({...t,minBookingHours:parseInt(x.target.value)||1}),min:1})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl cursor-pointer w-full",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-brand-blue",checked:t.active!==!1,onChange:x=>s({...t,active:x.target.checked})}),e.jsx("span",{className:"text-sm font-medium dark:text-white",children:"Active"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Equipment"}),e.jsx(Is,{value:t.equipment||"",onChange:x=>s({...t,equipment:x}),placeholder:"Search and add equipment...",multi:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Room Features"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map(x=>e.jsx("button",{type:"button",onClick:()=>p(x),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all border ${(t.amenities||[]).includes(x)?"bg-brand-blue text-white border-brand-blue":"bg-white dark:bg-[#2c2e36] text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-brand-blue"}`,children:x},x))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{onClick:i,className:"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl font-medium transition",children:"Cancel"}),e.jsxs("button",{onClick:a,disabled:l,className:"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[l?e.jsx(K,{className:"animate-spin",size:18}):e.jsx(rt,{size:18}),n?"Add Room":"Save Changes"]})]})]})}function Fn({user:t,userData:s,onUpdate:a}){const[i,l]=r.useState((s==null?void 0:s.studioPhotos)||[]),[n,o]=r.useState(!1),[p,x]=r.useState(0),[b,m]=r.useState(null),[h,d]=r.useState(null),v=r.useCallback(async j=>{try{const C=W(P,`artifacts/${ee}/users/${t.uid}/profiles/main`);return await te(C,{studioPhotos:j}),l(j),a&&a({studioPhotos:j}),!0}catch(C){return console.error("Save failed:",C),I.error("Failed to save photos"),!1}},[t.uid,a]),u=r.useCallback(async j=>{if(!j||j.length===0)return;const C=12;if(i.length>=C){I.error(`Maximum ${C} photos allowed`);return}o(!0);const R=I.loading("Uploading photos..."),E=[];for(const w of Array.from(j).slice(0,C-i.length)){if(!w.type.startsWith("image/")){I.error(`${w.name} is not an image`);continue}if(w.size>5*1024*1024){I.error(`${w.name} is too large (max 5MB)`);continue}try{const z=Date.now(),A=`${z}_${w.name.replace(/[^a-zA-Z0-9.]/g,"_")}`,q=Ws(Hs,`studios/${t.uid}/gallery/${A}`),G=dl(q,w);await new Promise((H,J)=>{G.on("state_changed",M=>{const L=M.bytesTransferred/M.totalBytes*100;x(L)},M=>J(M),async()=>{const M=await cl(G.snapshot.ref);E.push({id:z.toString(),url:M,path:q.fullPath,filename:A,caption:"",isCover:i.length===0&&E.length===0,uploadedAt:new Date().toISOString()}),H()})})}catch(z){console.error("Upload error:",z),I.error(`Failed to upload ${w.name}`)}}E.length>0?await v([...i,...E])&&I.success(`${E.length} photo(s) uploaded!`,{id:R}):I.dismiss(R),o(!1),x(0)},[i,t.uid,v]),g=async j=>{const C=i[j];if(!confirm("Delete this photo?"))return;const R=I.loading("Deleting...");try{if(C.path){const w=Ws(Hs,C.path);await xl(w).catch(()=>{})}let E=i.filter((w,z)=>z!==j);C.isCover&&E.length>0&&(E=E.map((w,z)=>({...w,isCover:z===0}))),await v(E),I.success("Photo deleted",{id:R})}catch(E){console.error("Delete error:",E),I.error("Failed to delete photo",{id:R})}},y=async j=>{const C=i.map((R,E)=>({...R,isCover:E===j}));await v(C),I.success("Cover photo updated")},c=j=>{d(j)},k=(j,C)=>{if(j.preventDefault(),h===null||h===C)return;const R=[...i],[E]=R.splice(h,1);R.splice(C,0,E),l(R),d(C)},N=async()=>{h!==null&&(await v(i),d(null))},f=j=>{var R;j.preventDefault();const C=(R=j.dataTransfer)==null?void 0:R.files;C&&u(C)},S=i.find(j=>j.isCover)||i[0];return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(It,{className:"text-brand-blue",size:24}),"Photo Gallery"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Showcase your studio with up to 12 photos"})]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[i.length,"/12 photos"]})]}),S&&e.jsxs("div",{className:"relative rounded-xl overflow-hidden aspect-video bg-gray-100 dark:bg-gray-800 group",children:[e.jsx("img",{src:S.url,alt:"Cover",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"absolute bottom-4 left-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ze,{size:16,className:"fill-yellow-400 text-yellow-400"}),"Cover Photo"]})})})]}),e.jsx("div",{className:`border-2 border-dashed rounded-xl p-8 text-center transition-all ${n?"border-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-brand-blue hover:bg-blue-50/50 dark:hover:bg-blue-900/10"}`,onDrop:f,onDragOver:j=>j.preventDefault(),children:n?e.jsxs("div",{className:"space-y-3",children:[e.jsx(K,{className:"mx-auto animate-spin text-brand-blue",size:40}),e.jsx("div",{className:"w-full max-w-xs mx-auto bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-brand-blue h-2 rounded-full transition-all duration-300",style:{width:`${p}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Uploading... ",Math.round(p),"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Mt,{className:"mx-auto text-gray-400 mb-3",size:40}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Drag & drop images here, or"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-brand-blue font-bold hover:underline",children:"browse files"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:j=>u(j.target.files),disabled:n})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"JPG, PNG or WebP. Max 5MB per file."})]})}),i.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[i.map((j,C)=>e.jsxs("div",{draggable:!0,onDragStart:()=>c(C),onDragOver:R=>k(R,C),onDragEnd:N,className:`relative aspect-square rounded-xl overflow-hidden group bg-gray-100 dark:bg-gray-800 cursor-move ${h===C?"opacity-50 ring-2 ring-brand-blue":""}`,children:[e.jsx("img",{src:j.url,alt:j.caption||`Studio photo ${C+1}`,className:"w-full h-full object-cover"}),j.isCover&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-lg flex items-center gap-1",children:[e.jsx(ze,{size:12,className:"fill-white"})," Cover"]}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>m(j),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition",title:"View",children:e.jsx(Cs,{size:18})}),!j.isCover&&e.jsx("button",{onClick:()=>y(C),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition",title:"Set as cover",children:e.jsx(ze,{size:18})}),e.jsx("button",{onClick:()=>g(C),className:"p-2 bg-red-500/80 hover:bg-red-500 rounded-lg text-white transition",title:"Delete",children:e.jsx($e,{size:18})})]}),e.jsx("div",{className:"absolute top-2 right-2 p-1 bg-black/40 rounded text-white opacity-0 group-hover:opacity-100 transition",children:e.jsx(Ir,{size:14})})]},j.id)),i.length<12&&e.jsxs("label",{className:"aspect-square rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700 hover:border-brand-blue transition cursor-pointer flex flex-col items-center justify-center text-gray-400 hover:text-brand-blue",children:[e.jsx(lt,{size:32}),e.jsx("span",{className:"text-xs mt-1",children:"Add Photo"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:j=>u(j.target.files),disabled:n})]})]}),i.length===0&&!n&&e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(It,{size:48,className:"mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"No photos uploaded yet"}),e.jsx("p",{className:"text-sm",children:"Add photos to attract more clients"})]}),b&&e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>m(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition",onClick:()=>m(null),children:e.jsx(le,{size:32})}),e.jsx("img",{src:b.url,alt:b.caption||"Studio photo",className:"max-w-full max-h-[90vh] object-contain rounded-lg",onClick:j=>j.stopPropagation()}),b.caption&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black/70 text-white px-6 py-3 rounded-xl",children:b.caption})]})]})}const us=[{id:"sunday",label:"Sunday",short:"Sun"},{id:"monday",label:"Monday",short:"Mon"},{id:"tuesday",label:"Tuesday",short:"Tue"},{id:"wednesday",label:"Wednesday",short:"Wed"},{id:"thursday",label:"Thursday",short:"Thu"},{id:"friday",label:"Friday",short:"Fri"},{id:"saturday",label:"Saturday",short:"Sat"}],On={sunday:{closed:!0,open:"10:00",close:"18:00"},monday:{closed:!1,open:"09:00",close:"22:00"},tuesday:{closed:!1,open:"09:00",close:"22:00"},wednesday:{closed:!1,open:"09:00",close:"22:00"},thursday:{closed:!1,open:"09:00",close:"22:00"},friday:{closed:!1,open:"09:00",close:"23:00"},saturday:{closed:!1,open:"10:00",close:"23:00"}};function Bn({user:t,userData:s,onUpdate:a}){const[i,l]=r.useState((s==null?void 0:s.operatingHours)||On),[n,o]=r.useState((s==null?void 0:s.blackoutDates)||[]),[p,x]=r.useState(!1),[b,m]=r.useState({start:"",end:"",reason:""}),[h,d]=r.useState(!1),v=async()=>{x(!0);const S=I.loading("Saving availability...");try{const j=W(P,`artifacts/${ee}/users/${t.uid}/profiles/main`);await te(j,{operatingHours:i,blackoutDates:n}),I.success("Availability saved!",{id:S}),a&&a({operatingHours:i,blackoutDates:n})}catch(j){console.error("Save failed:",j),I.error("Failed to save",{id:S})}finally{x(!1)}},u=(S,j,C)=>{l(R=>({...R,[S]:{...R[S],[j]:C}}))},g=S=>{l(j=>{var C;return{...j,[S]:{...j[S],closed:!((C=j[S])!=null&&C.closed)}}})},y=S=>{const j=i[S],C=["monday","tuesday","wednesday","thursday","friday"];l(R=>{const E={...R};return C.forEach(w=>{E[w]={...j}}),E}),I.success("Copied to all weekdays")},c=()=>{if(!b.start){I.error("Start date is required");return}const S={id:Date.now().toString(),start:b.start,end:b.end||b.start,reason:b.reason||"Blocked"};o([...n,S]),m({start:"",end:"",reason:""}),d(!1)},k=S=>{o(n.filter(j=>j.id!==S))},N=S=>{if(!S)return"";const[j,C]=S.split(":"),R=parseInt(j),E=R>=12?"PM":"AM";return`${R===0?12:R>12?R-12:R}:${C} ${E}`},f=us.reduce((S,j)=>{const C=i[j.id];if(C!=null&&C.closed)return S;const[R,E]=((C==null?void 0:C.open)||"09:00").split(":").map(Number),[w,z]=((C==null?void 0:C.close)||"17:00").split(":").map(Number),A=R*60+E,q=w*60+z;return S+Math.max(0,(q-A)/60)},0);return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(qe,{className:"text-brand-blue",size:24}),"Availability & Hours"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Set your operating hours and manage blackout dates"})]}),e.jsxs("button",{onClick:v,disabled:p,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[p?e.jsx(K,{className:"animate-spin",size:18}):e.jsx(rt,{size:18}),"Save Changes"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-1",children:"Weekly Availability"}),e.jsxs("p",{className:"text-indigo-100",children:[us.filter(S=>{var j;return!((j=i[S.id])!=null&&j.closed)}).length," days open • ",Math.round(f)," hours/week"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold",children:Math.round(f)}),e.jsx("div",{className:"text-sm text-indigo-100",children:"hours"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(js,{size:18,className:"text-amber-500"}),"Operating Hours"]})}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:us.map(S=>{const j=i[S.id]||{closed:!1,open:"09:00",close:"17:00"};return e.jsxs("div",{className:`p-4 flex items-center gap-4 ${j.closed?"bg-gray-50 dark:bg-[#1f2128]":""}`,children:[e.jsx("div",{className:"w-28",children:e.jsx("span",{className:`font-medium ${j.closed?"text-gray-400":"dark:text-white"}`,children:S.label})}),e.jsx("button",{onClick:()=>g(S.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition ${j.closed?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}`,children:j.closed?"Closed":"Open"}),!j.closed&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"time",value:j.open||"09:00",onChange:C=>u(S.id,"open",C.target.value),className:"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),e.jsx("span",{className:"text-gray-400",children:"to"}),e.jsx("input",{type:"time",value:j.close||"17:00",onChange:C=>u(S.id,"close",C.target.value),className:"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),e.jsxs("span",{className:"text-sm text-gray-400 hidden md:inline",children:[N(j.open)," – ",N(j.close)]}),e.jsx("button",{onClick:()=>y(S.id),className:"ml-auto p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Copy to all weekdays",children:e.jsx(Ft,{size:16})})]})]},S.id)})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(At,{size:18,className:"text-indigo-500"}),"Blackout Dates"]}),e.jsxs("button",{onClick:()=>d(!h),className:"text-sm bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition flex items-center gap-1",children:[e.jsx(lt,{size:16})," Add Blackout"]})]}),h&&e.jsx("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/20 border-b dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Start Date *"}),e.jsx("input",{type:"date",value:b.start,onChange:S=>m({...b,start:S.target.value}),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"End Date"}),e.jsx("input",{type:"date",value:b.end,onChange:S=>m({...b,end:S.target.value}),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:b.start})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Reason"}),e.jsx("input",{type:"text",value:b.reason,onChange:S=>m({...b,reason:S.target.value}),placeholder:"e.g. Holiday, Maintenance",className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{onClick:c,className:"flex-1 p-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition",children:"Add"}),e.jsx("button",{onClick:()=>d(!1),className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(le,{size:20})})]})]})}),e.jsx("div",{className:"p-4",children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(At,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No blackout dates scheduled"}),e.jsx("p",{className:"text-xs",children:"Add dates when your studio is unavailable"})]}):e.jsx("div",{className:"space-y-2",children:n.sort((S,j)=>new Date(S.start)-new Date(j.start)).map(S=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Pe,{className:"text-indigo-600 dark:text-indigo-400",size:18})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium dark:text-white text-sm",children:[new Date(S.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),S.end!==S.start&&e.jsxs(e.Fragment,{children:[" – ",new Date(S.end).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:S.reason})]})]}),e.jsx("button",{onClick:()=>k(S.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:e.jsx($e,{size:16})})]},S.id))})})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Fe,{className:"text-amber-600 flex-shrink-0",size:20}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-bold text-amber-800 dark:text-amber-300 mb-1",children:"Availability Tips"}),e.jsxs("ul",{className:"text-amber-700 dark:text-amber-400 space-y-1",children:[e.jsx("li",{children:"• Operating hours determine when clients can book sessions"}),e.jsx("li",{children:"• Use blackout dates for holidays, maintenance, or personal time"}),e.jsx("li",{children:"• Individual room availability can be set in the Rooms section"})]})]})]})})]})}function _n({user:t,userData:s,onUpdate:a}){var v,u,g,y,c,k,N,f,S,j,C,R,E,w,z,A,q,G,H,J,M;const[i,l]=r.useState({minBookingHours:((v=s==null?void 0:s.policies)==null?void 0:v.minBookingHours)??2,maxBookingHours:((u=s==null?void 0:s.policies)==null?void 0:u.maxBookingHours)??12,advanceBookingDays:((g=s==null?void 0:s.policies)==null?void 0:g.advanceBookingDays)??14,minAdvanceHours:((y=s==null?void 0:s.policies)==null?void 0:y.minAdvanceHours)??24,autoApprove:((c=s==null?void 0:s.policies)==null?void 0:c.autoApprove)??!1,cancellationPolicy:((k=s==null?void 0:s.policies)==null?void 0:k.cancellationPolicy)??"moderate",cancellationNoticeHours:((N=s==null?void 0:s.policies)==null?void 0:N.cancellationNoticeHours)??48,refundPercentage:((f=s==null?void 0:s.policies)==null?void 0:f.refundPercentage)??50,depositRequired:((S=s==null?void 0:s.policies)==null?void 0:S.depositRequired)??!0,depositPercentage:((j=s==null?void 0:s.policies)==null?void 0:j.depositPercentage)??25,peakHourMultiplier:((C=s==null?void 0:s.policies)==null?void 0:C.peakHourMultiplier)??1,peakHoursStart:((R=s==null?void 0:s.policies)==null?void 0:R.peakHoursStart)??"",peakHoursEnd:((E=s==null?void 0:s.policies)==null?void 0:E.peakHoursEnd)??"",weekendMultiplier:((w=s==null?void 0:s.policies)==null?void 0:w.weekendMultiplier)??1,houseRules:((z=s==null?void 0:s.policies)==null?void 0:z.houseRules)??"",whatToExpect:((A=s==null?void 0:s.policies)==null?void 0:A.whatToExpect)??"",whatToBring:((q=s==null?void 0:s.policies)==null?void 0:q.whatToBring)??"",parkingInstructions:((G=s==null?void 0:s.policies)==null?void 0:G.parkingInstructions)??"",requiresWaiver:((H=s==null?void 0:s.policies)==null?void 0:H.requiresWaiver)??!1,waiverText:((J=s==null?void 0:s.policies)==null?void 0:J.waiverText)??"",ageRequirement:((M=s==null?void 0:s.policies)==null?void 0:M.ageRequirement)??18}),[n,o]=r.useState(!1),[p,x]=r.useState("booking"),b=async()=>{o(!0);const L=I.loading("Saving policies...");try{const _=W(P,`artifacts/${ee}/users/${t.uid}/profiles/main`);await te(_,{policies:i}),I.success("Policies saved!",{id:L}),a&&a({policies:i})}catch(_){console.error("Save failed:",_),I.error("Failed to save",{id:L})}finally{o(!1)}},m=(L,_)=>{l(B=>({...B,[L]:_}))},h=[{id:"flexible",label:"Flexible",description:"Full refund up to 24 hours before session",color:"green"},{id:"moderate",label:"Moderate",description:"50% refund up to 48 hours before session",color:"amber"},{id:"strict",label:"Strict",description:"No refunds within 7 days of session",color:"red"},{id:"custom",label:"Custom",description:"Set your own cancellation terms",color:"blue"}],d=({id:L,title:_,icon:B,children:U})=>{const Q=p===L;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>x(Q?null:L),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-[#23262f] transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-blue/10 rounded-lg flex items-center justify-center",children:e.jsx(B,{className:"text-brand-blue",size:20})}),e.jsx("h3",{className:"font-bold dark:text-white",children:_})]}),Q?e.jsx(as,{size:20}):e.jsx(et,{size:20})]}),Q&&e.jsx("div",{className:"p-4 pt-0 border-t dark:border-gray-700",children:U})]})};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Lt,{className:"text-brand-blue",size:24}),"Policies & Rules"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Set booking rules, cancellation policies, and house rules"})]}),e.jsxs("button",{onClick:b,disabled:n,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[n?e.jsx(K,{className:"animate-spin",size:18}):e.jsx(rt,{size:18}),"Save Changes"]})]}),e.jsx(d,{id:"booking",title:"Booking Rules",icon:qe,children:e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Hours"}),e.jsx("input",{type:"number",value:i.minBookingHours,onChange:L=>m("minBookingHours",parseInt(L.target.value)||1),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Max Hours"}),e.jsx("input",{type:"number",value:i.maxBookingHours,onChange:L=>m("maxBookingHours",parseInt(L.target.value)||12),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Book Ahead (Days)"}),e.jsx("input",{type:"number",value:i.advanceBookingDays,onChange:L=>m("advanceBookingDays",parseInt(L.target.value)||7),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Notice (Hrs)"}),e.jsx("input",{type:"number",value:i.minAdvanceHours,onChange:L=>m("minAdvanceHours",parseInt(L.target.value)||0),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Auto-Approve Bookings"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Automatically confirm bookings without manual approval"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.autoApprove,onChange:L=>m("autoApprove",L.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-brand-blue"})]})]})]})}),e.jsx(d,{id:"cancellation",title:"Cancellation Policy",icon:at,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:h.map(L=>e.jsxs("button",{onClick:()=>m("cancellationPolicy",L.id),className:`p-4 rounded-xl border-2 text-left transition ${i.cancellationPolicy===L.id?`border-${L.color}-500 bg-${L.color}-50 dark:bg-${L.color}-900/20`:"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx("div",{className:`font-bold mb-1 ${i.cancellationPolicy===L.id?`text-${L.color}-700 dark:text-${L.color}-400`:"dark:text-white"}`,children:L.label}),e.jsx("div",{className:"text-xs text-gray-500",children:L.description})]},L.id))}),i.cancellationPolicy==="custom"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Notice Required (Hours)"}),e.jsx("input",{type:"number",value:i.cancellationNoticeHours,onChange:L=>m("cancellationNoticeHours",parseInt(L.target.value)||24),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Refund Percentage"}),e.jsx("input",{type:"number",value:i.refundPercentage,onChange:L=>m("refundPercentage",parseInt(L.target.value)||0),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0,max:100})]})]})]})}),e.jsx(d,{id:"pricing",title:"Pricing & Deposits",icon:Ce,children:e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Require Deposit"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Collect partial payment when booking"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.depositRequired,onChange:L=>m("depositRequired",L.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue"})]})]}),i.depositRequired&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Deposit Percentage"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",value:i.depositPercentage,onChange:L=>m("depositPercentage",parseInt(L.target.value)),className:"flex-1",min:10,max:100,step:5}),e.jsxs("span",{className:"font-bold text-brand-blue w-14 text-right",children:[i.depositPercentage,"%"]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white mb-3",children:"Peak Hour Pricing"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Peak Start"}),e.jsx("input",{type:"time",value:i.peakHoursStart,onChange:L=>m("peakHoursStart",L.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Peak End"}),e.jsx("input",{type:"time",value:i.peakHoursEnd,onChange:L=>m("peakHoursEnd",L.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Rate Multiplier"}),e.jsx("input",{type:"number",value:i.peakHourMultiplier,onChange:L=>m("peakHourMultiplier",parseFloat(L.target.value)||1),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1,max:3,step:.1})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Weekend Rate Multiplier"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",value:i.weekendMultiplier,onChange:L=>m("weekendMultiplier",parseFloat(L.target.value)),className:"flex-1",min:1,max:2,step:.1}),e.jsxs("span",{className:"font-bold dark:text-white w-16 text-right",children:[i.weekendMultiplier,"x"]})]}),i.weekendMultiplier>1&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Saturday & Sunday bookings will be ",Math.round((i.weekendMultiplier-1)*100),"% more"]})]})]})}),e.jsx(d,{id:"rules",title:"House Rules & Info",icon:Lt,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio Rules"}),e.jsx("textarea",{value:i.houseRules,onChange:L=>m("houseRules",L.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:4,placeholder:`• No smoking inside the studio
• Please arrive 10 minutes early
• Clean up after your session`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"What to Expect"}),e.jsx("textarea",{value:i.whatToExpect,onChange:L=>m("whatToExpect",L.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:"Describe what clients can expect when they arrive..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"What to Bring"}),e.jsx("textarea",{value:i.whatToBring,onChange:L=>m("whatToBring",L.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:`• Instrument cables
• Lyrics/charts
• Reference tracks`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Parking Instructions"}),e.jsx("textarea",{value:i.parkingInstructions,onChange:L=>m("parkingInstructions",L.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:"Describe parking situation and directions..."})]})]})]})}),e.jsx(d,{id:"legal",title:"Legal & Safety",icon:Ie,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Minimum Age Requirement"}),e.jsx("input",{type:"number",value:i.ageRequirement,onChange:L=>m("ageRequirement",parseInt(L.target.value)||0),className:"w-32 p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-6",children:i.ageRequirement>0?`Clients must be ${i.ageRequirement}+ to book`:"No age restriction"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Require Liability Waiver"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Clients must sign a waiver before booking"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.requiresWaiver,onChange:L=>m("requiresWaiver",L.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue"})]})]}),i.requiresWaiver&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Waiver Text"}),e.jsx("textarea",{value:i.waiverText,onChange:L=>m("waiverText",L.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white font-mono text-sm",rows:6,placeholder:"Enter your liability waiver text..."})]})]})]})})]})}const ia={pending:{label:"Pending",color:"amber",icon:Tr,bgClass:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"},confirmed:{label:"Confirmed",color:"green",icon:re,bgClass:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"},cancelled:{label:"Cancelled",color:"red",icon:$r,bgClass:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"},completed:{label:"Completed",color:"blue",icon:Je,bgClass:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400"}};function qn({user:t,onNavigateToChat:s}){const[a,i]=r.useState([]),[l,n]=r.useState(!0),[o,p]=r.useState("all"),[x,b]=r.useState(""),[m,h]=r.useState(null),[d,v]=r.useState(null);r.useEffect(()=>{if(!(t!=null&&t.uid))return;const f=D(P,`artifacts/${ee}/bookings`),S=me(f,we("studioOwnerId","==",t.uid),Re("createdAt","desc")),j=ge(S,C=>{const R=C.docs.map(E=>{var w,z,A,q;return{id:E.id,...E.data(),date:((z=(w=E.data().date)==null?void 0:w.toDate)==null?void 0:z.call(w))||new Date(E.data().date),createdAt:((q=(A=E.data().createdAt)==null?void 0:A.toDate)==null?void 0:q.call(A))||new Date}});i(R),n(!1)},C=>{console.error("Error fetching bookings:",C),n(!1)});return()=>j()},[t==null?void 0:t.uid]);const u=async(f,S)=>{v(f);const j=I.loading("Updating booking...");try{const C=W(P,`artifacts/${ee}/bookings/${f}`);await te(C,{status:S,updatedAt:Vs.now(),[`${S}At`]:Vs.now()}),I.success(`Booking ${S}!`,{id:j})}catch(C){console.error("Update failed:",C),I.error("Failed to update booking",{id:j})}finally{v(null)}},g=a.filter(f=>{var C,R;const S=o==="all"||f.status===o,j=!x||((C=f.clientName)==null?void 0:C.toLowerCase().includes(x.toLowerCase()))||((R=f.roomName)==null?void 0:R.toLowerCase().includes(x.toLowerCase()));return S&&j}),y=g.reduce((f,S)=>{const j=S.date.toDateString();return f[j]||(f[j]=[]),f[j].push(S),f},{}),c=a.filter(f=>f.status==="pending").length,k=a.filter(f=>{const S=new Date().toDateString();return f.date.toDateString()===S&&f.status==="confirmed"}).length,N=a.filter(f=>f.status==="confirmed"&&f.date>=new Date).reduce((f,S)=>f+(S.totalPrice||0),0);return l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ft,{className:"animate-spin text-brand-blue",size:32})}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Pe,{className:"text-brand-blue",size:24}),"Booking Management"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[a.length," total bookings"]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl border border-amber-200 dark:border-amber-800",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:c}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Pending Approval"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:k}),e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Today's Sessions"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:["$",N.toLocaleString()]}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Upcoming Revenue"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",value:x,onChange:f=>b(f.target.value),placeholder:"Search by client or room...",className:"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","confirmed","completed","cancelled"].map(f=>e.jsxs("button",{onClick:()=>p(f),className:`px-4 py-2 rounded-lg font-medium text-sm transition ${o===f?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[f.charAt(0).toUpperCase()+f.slice(1),f==="pending"&&c>0&&e.jsx("span",{className:"ml-1.5 bg-amber-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:c})]},f))})]}),g.length===0?e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center",children:[e.jsx(Pe,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Bookings Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:o!=="all"?`No ${o} bookings`:"Bookings will appear here when clients book your studio"})]}):e.jsx("div",{className:"space-y-6",children:Object.entries(y).map(([f,S])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-3 flex items-center gap-2",children:[e.jsx(Pe,{size:14}),new Date(f).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),e.jsxs("span",{className:"text-gray-400",children:["(",S.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:S.map(j=>{const C=ia[j.status]||ia.pending;return e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsxs("div",{className:"text-center min-w-[70px]",children:[e.jsx("div",{className:"text-lg font-bold dark:text-white",children:j.startTime}),e.jsxs("div",{className:"text-xs text-gray-500",children:[j.duration,"h"]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold dark:text-white truncate",children:j.clientName||"Unknown Client"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${C.bgClass}`,children:C.label})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[j.roomName||"Main Room"," • $",j.totalPrice||0]}),j.notes&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1 truncate",children:["Note: ",j.notes]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(j.id,"confirmed"),disabled:d===j.id,className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition",title:"Approve",children:e.jsx(Je,{size:18})}),e.jsx("button",{onClick:()=>u(j.id,"cancelled"),disabled:d===j.id,className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition",title:"Decline",children:e.jsx(le,{size:18})})]}),j.status==="confirmed"&&e.jsx("button",{onClick:()=>u(j.id,"completed"),disabled:d===j.id,className:"px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium",children:"Mark Complete"}),j.clientId&&s&&e.jsx("button",{onClick:()=>s(j.clientId),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Message Client",children:e.jsx(St,{size:18})}),e.jsx("button",{onClick:()=>h(j),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"View Details",children:e.jsx(Cs,{size:18})})]})]})},j.id)})})]},f))}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Booking Details"}),e.jsx("button",{onClick:()=>h(null),children:e.jsx(le,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-blue/10 rounded-full flex items-center justify-center",children:e.jsx(Le,{className:"text-brand-blue",size:24})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:m.clientName}),e.jsx("div",{className:"text-sm text-gray-500",children:m.clientEmail})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Date"}),e.jsx("div",{className:"dark:text-white",children:m.date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Time"}),e.jsxs("div",{className:"dark:text-white",children:[m.startTime," (",m.duration,"h)"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Room"}),e.jsx("div",{className:"dark:text-white",children:m.roomName})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Total"}),e.jsxs("div",{className:"dark:text-white font-bold text-green-600",children:["$",m.totalPrice]})]})]}),m.notes&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-amber-600 uppercase font-bold mb-1",children:"Client Notes"}),e.jsx("div",{className:"text-amber-800 dark:text-amber-300 text-sm",children:m.notes})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Booked ",m.createdAt.toLocaleDateString()]})]})]})})]})}function Wn({user:t,userData:s,onUpdate:a}){const[i,l]=r.useState((s==null?void 0:s.studioEquipment)||[]),[n,o]=r.useState(!1),[p,x]=r.useState(""),[b,m]=r.useState("all"),[h,d]=r.useState(!1),[v,u]=r.useState(null),g=async w=>{o(!0);const z=I.loading("Saving equipment...");try{const A=W(P,`artifacts/${ee}/users/${t.uid}/profiles/main`);await te(A,{studioEquipment:w}),l(w),I.success("Equipment saved!",{id:z}),a&&a({studioEquipment:w})}catch(A){console.error("Save failed:",A),I.error("Failed to save",{id:z})}finally{o(!1)}},y=async w=>{const z={...w,id:Date.now().toString(),addedAt:new Date().toISOString()};await g([...i,z]),d(!1)},c=async w=>{const z=i.map(A=>A.id===w.id?w:A);await g(z),u(null)},k=async w=>{if(!confirm("Remove this item from inventory?"))return;const z=i.filter(A=>A.id!==w);await g(z)},N=i.filter(w=>{var q,G,H;const z=!p||((q=w.name)==null?void 0:q.toLowerCase().includes(p.toLowerCase()))||((G=w.brand)==null?void 0:G.toLowerCase().includes(p.toLowerCase()))||((H=w.model)==null?void 0:H.toLowerCase().includes(p.toLowerCase())),A=b==="all"||w.category===b;return z&&A}),f=N.reduce((w,z)=>{const A=z.category||"Other";return w[A]||(w[A]=[]),w[A].push(z),w},{}),S=[...new Set(i.map(w=>w.category).filter(Boolean))],j=i.length,C=i.reduce((w,z)=>w+(parseFloat(z.value)||0),0),R=w=>({microphones_and_input_transducers:Sa,monitoring_and_playback:Fr,mixing_consoles_and_control:Mr,outboard_signal_processing:_s,computer_audio_and_interfaces:_s})[w]||De,E=w=>{const z=bt.find(A=>A.id===w);return(z==null?void 0:z.label)||w};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(De,{className:"text-brand-blue",size:24}),"Equipment Inventory"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage your studio gear and equipment"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2",children:[e.jsx(lt,{size:18})," Add Equipment"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold dark:text-white",children:j}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Items"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",C.toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Est. Value"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold dark:text-white",children:S.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Categories"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-brand-blue",children:i.filter(w=>w.featured).length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Featured Items"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",value:p,onChange:w=>x(w.target.value),placeholder:"Search equipment...",className:"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("select",{value:b,onChange:w=>m(w.target.value),className:"px-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Categories"}),bt.map(w=>e.jsx("option",{value:w.id,children:w.label},w.id))]})]}),N.length===0?e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center",children:[e.jsx(De,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Equipment Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:p||b!=="all"?"Try adjusting your filters":"Add your studio equipment to showcase your gear"}),e.jsx("button",{onClick:()=>d(!0),className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition",children:"Add Your First Item"})]}):e.jsx("div",{className:"space-y-6",children:Object.entries(f).map(([w,z])=>{const A=R(w);return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-[#23262f] border-b dark:border-gray-700 flex items-center gap-3",children:[e.jsx(A,{className:"text-brand-blue",size:20}),e.jsx("h3",{className:"font-bold dark:text-white",children:E(w)}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",z.length,")"]})]}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:z.map(q=>e.jsxs("div",{className:"p-4 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-[#23262f] transition",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold dark:text-white",children:[q.brand&&e.jsx("span",{className:"text-gray-500 font-medium",children:q.brand})," ",q.name||q.model]}),q.featured&&e.jsx("span",{className:"text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 px-2 py-0.5 rounded",children:"Featured"})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[q.model&&q.name!==q.model&&e.jsx("span",{children:q.model}),q.serial&&e.jsxs("span",{className:"ml-2",children:["S/N: ",q.serial]})]}),q.notes&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:q.notes})]}),q.value&&e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:["$",parseFloat(q.value).toLocaleString()]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>u(q),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",children:e.jsx(ss,{size:16})}),e.jsx("button",{onClick:()=>k(q.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:e.jsx($e,{size:16})})]})]},q.id))})]},w)})}),(h||v)&&e.jsx(Vn,{item:v,onSave:v?c:y,onClose:()=>{d(!1),u(null)},saving:n})]})}function Vn({item:t,onSave:s,onClose:a,saving:i}){const[l,n]=r.useState(t||{name:"",brand:"",model:"",category:"",serial:"",value:"",notes:"",featured:!1}),o=()=>{if(!l.name&&!l.model){I.error("Name or model is required");return}s(l)},p=x=>{n(b=>({...b,name:x.name||b.name,brand:x.brand||b.brand,model:x.model||b.model,category:x.category||b.category}))};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:t?"Edit Equipment":"Add Equipment"}),e.jsx("button",{onClick:a,children:e.jsx(le,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Quick Search"}),e.jsx(Is,{onSelect:p,placeholder:"Search for equipment..."})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{value:l.brand,onChange:x=>n({...l,brand:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"e.g. Neumann"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model *"}),e.jsx("input",{value:l.model||l.name,onChange:x=>n({...l,model:x.target.value,name:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"e.g. U87"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsxs("select",{value:l.category,onChange:x=>n({...l,category:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select category..."}),bt.map(x=>e.jsx("option",{value:x.id,children:x.label},x.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Serial Number"}),e.jsx("input",{value:l.serial,onChange:x=>n({...l,serial:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Value ($)"}),e.jsx("input",{type:"number",value:l.value,onChange:x=>n({...l,value:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"Estimated value"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Notes"}),e.jsx("textarea",{value:l.notes,onChange:x=>n({...l,notes:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:2,placeholder:"Additional details..."})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-[#1f2128] rounded-xl cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.featured,onChange:x=>n({...l,featured:x.target.checked}),className:"w-4 h-4 text-brand-blue rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white text-sm",children:"Featured Equipment"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Highlight this item on your studio profile"})]})]})]})]}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:a,className:"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl font-medium",children:"Cancel"}),e.jsxs("button",{onClick:o,disabled:i,className:"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[i?e.jsx(K,{className:"animate-spin",size:18}):e.jsx(rt,{size:18}),t?"Update":"Add Item"]})]})]})})}const Un=Ns({studioName:Se().min(3,"Studio name is required"),address:Se().min(5,"Address is required"),city:Se().optional(),state:Se().optional(),zip:Se().optional(),lat:Gt().optional(),lng:Gt().optional(),studioDescription:Se().max(1e3).optional(),email:Se().email().optional().or(Kt("")),phoneCell:Se().optional(),phoneLand:Se().optional(),website:Se().url().optional().or(Kt("")),hours:Se().optional(),amenities:Br(Se()).optional(),hideAddress:Or().optional()});function Hn({user:t,userData:s,onUpdate:a}){const[i,l]=r.useState(!1),{register:n,control:o,handleSubmit:p,watch:x,setValue:b,formState:{errors:m,isDirty:h}}=ks({resolver:ws(Un),defaultValues:{studioName:(s==null?void 0:s.studioName)||(s==null?void 0:s.profileName)||"",address:(s==null?void 0:s.address)||"",city:(s==null?void 0:s.city)||"",state:(s==null?void 0:s.state)||"",zip:(s==null?void 0:s.zip)||"",lat:s==null?void 0:s.lat,lng:s==null?void 0:s.lng,studioDescription:(s==null?void 0:s.studioDescription)||"",email:(s==null?void 0:s.email)||"",phoneCell:(s==null?void 0:s.phoneCell)||"",phoneLand:(s==null?void 0:s.phoneLand)||"",website:(s==null?void 0:s.website)||"",hours:(s==null?void 0:s.hours)||"",amenities:(s==null?void 0:s.amenities)||[],hideAddress:(s==null?void 0:s.hideAddress)||!1}}),d=x("amenities"),v=x("hideAddress"),u=c=>{const k=d||[];k.includes(c)?b("amenities",k.filter(N=>N!==c),{shouldDirty:!0}):b("amenities",[...k,c],{shouldDirty:!0})},g=async c=>{l(!0);const k=I.loading("Saving settings...");try{const N=W(P,`artifacts/${ee}/users/${t.uid}/profiles/main`);await te(N,{studioName:c.studioName,profileName:c.studioName,address:c.address,city:c.city,state:c.state,zip:c.zip,lat:c.lat,lng:c.lng,studioDescription:c.studioDescription,email:c.email,phoneCell:c.phoneCell,phoneLand:c.phoneLand,website:c.website,hours:c.hours,amenities:c.amenities,hideAddress:c.hideAddress,isStudio:!0}),I.success("Settings saved!",{id:k}),a&&a(c)}catch(N){console.error("Save failed",N),I.error("Failed to save settings.",{id:k})}finally{l(!1)}},y=c=>`w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none ${c?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200"}`;return e.jsxs("form",{onSubmit:p(g),className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(ht,{className:"text-brand-blue",size:24}),"Studio Settings"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Basic information and contact details"})]}),e.jsxs("button",{type:"submit",disabled:i||!h,className:`px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 transition ${i||!h?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600"}`,children:[i?e.jsx(K,{className:"animate-spin",size:18}):e.jsx(rt,{size:18}),"Save Changes"]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(tt,{size:18,className:"text-brand-blue"}),"General Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio Name *"}),e.jsx("input",{...n("studioName"),className:y(m.studioName),placeholder:"Your Studio Name"}),m.studioName&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.studioName.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Description"}),e.jsx("textarea",{...n("studioDescription"),rows:3,className:y(m.studioDescription),placeholder:"Describe your studio, the vibe, and what makes it special..."})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Te,{size:18,className:"text-brand-blue"}),"Location"]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800 mb-4",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...n("hideAddress"),className:"w-5 h-5 mt-0.5 text-brand-blue rounded"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(Ie,{size:16,className:"text-brand-blue"}),"Private Home Studio Mode"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your exact address will be hidden from the public map. It will only be revealed after you approve a booking request."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(_r,{control:o,name:"address",render:({field:{onChange:c,value:k}})=>{var N;return e.jsx(Ll,{label:"Street Address",value:k||"",onChange:c,onSelect:f=>{f.lat&&b("lat",f.lat),f.lng&&b("lng",f.lng),f.city&&b("city",f.city,{shouldDirty:!0}),f.state&&b("state",f.state,{shouldDirty:!0}),f.zip&&b("zip",f.zip,{shouldDirty:!0})},placeholder:"Start typing your address...",error:(N=m.address)==null?void 0:N.message,required:!0})}}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"City"}),e.jsx("input",{...n("city"),className:y(),placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"State"}),e.jsx("input",{...n("state"),className:y(),placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"ZIP"}),e.jsx("input",{...n("zip"),className:y(),placeholder:"ZIP Code"})]})]})]}),v&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-amber-600 dark:text-amber-400",children:[e.jsx(qr,{size:16}),e.jsx("span",{children:"Address will be hidden until booking approval"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ht,{size:18,className:"text-brand-blue"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Email"}),e.jsx("input",{...n("email"),type:"email",className:y(m.email),placeholder:"studio@email.com"}),m.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Website"}),e.jsx("input",{...n("website"),className:y(m.website),placeholder:"https://yourstudio.com"}),m.website&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.website.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Cell Phone"}),e.jsx("input",{...n("phoneCell"),className:y(),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Landline"}),e.jsx("input",{...n("phoneLand"),className:y(),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hours of Operation"}),e.jsx("input",{...n("hours"),className:y(),placeholder:"e.g. Mon-Fri 9AM-10PM, Sat-Sun 10AM-8PM"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Wr,{size:18,className:"text-brand-blue"}),"Amenities"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Il.map(c=>e.jsx("button",{type:"button",onClick:()=>u(c),className:`px-3 py-2 rounded-lg text-sm font-medium transition-all border ${d!=null&&d.includes(c)?"bg-brand-blue text-white border-brand-blue shadow-md":"bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:c},c))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:i||!h,className:`px-8 py-3 rounded-xl font-bold text-lg flex items-center gap-2 transition shadow-lg ${i||!h?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"}`,children:[i?e.jsx(K,{className:"animate-spin",size:20}):e.jsx(rt,{size:20}),"Save Settings"]})})]})}const na=[{id:"overview",label:"Overview",icon:tt,description:"Dashboard & quick stats"},{id:"rooms",label:"Rooms",icon:hs,description:"Manage studio rooms"},{id:"equipment",label:"Equipment",icon:De,description:"Equipment inventory"},{id:"gallery",label:"Gallery",icon:It,description:"Photo gallery"},{id:"availability",label:"Hours",icon:qe,description:"Operating hours"},{id:"policies",label:"Policies",icon:Lt,description:"Rules & pricing"},{id:"bookings",label:"Bookings",icon:Pe,description:"Manage bookings"},{id:"settings",label:"Settings",icon:ht,description:"Studio info"}];function Gn({user:t,userData:s}){const[a,i]=r.useState("overview"),[l,n]=r.useState({pendingBookings:0,recentBookings:[],totalRevenue:0}),[o,p]=r.useState(s);r.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const v=D(P,`artifacts/${ee}/bookings`),u=me(v,we("studioOwnerId","==",t.uid)),y=(await He(u)).docs.map(f=>{var S,j;return{id:f.id,...f.data(),date:((j=(S=f.data().date)==null?void 0:S.toDate)==null?void 0:j.call(S))||new Date(f.data().date)}}),c=y.filter(f=>f.status==="pending").length,k=y.filter(f=>f.date>=new Date).sort((f,S)=>f.date-S.date).slice(0,5),N=y.filter(f=>f.status==="completed").reduce((f,S)=>f+(S.totalPrice||0),0);n({pendingBookings:c,recentBookings:k,totalRevenue:N})}catch(v){console.error("Error fetching stats:",v)}})()},[t==null?void 0:t.uid]);const x=d=>{p(v=>({...v,...d}))},b=d=>{i(d)},m=()=>{const d={user:t,userData:o,onUpdate:x};switch(a){case"overview":return e.jsx(ra,{...d,stats:l,onNavigate:b});case"rooms":return e.jsx(Mn,{...d});case"equipment":return e.jsx(Wn,{...d});case"gallery":return e.jsx(Fn,{...d});case"availability":return e.jsx(Bn,{...d});case"policies":return e.jsx(_n,{...d});case"bookings":return e.jsx(qn,{...d});case"settings":return e.jsx(Hn,{...d});default:return e.jsx(ra,{...d,stats:l,onNavigate:b})}},h=na.find(d=>d.id===a);return e.jsxs("div",{className:"max-w-7xl mx-auto pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx(ot,{size:14}),e.jsx("span",{children:"Business Center"}),e.jsx(dt,{size:14}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:"Studio Manager"})]}),e.jsxs("h1",{className:"text-3xl font-bold dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white",children:e.jsx(tt,{size:24})}),(o==null?void 0:o.studioName)||(o==null?void 0:o.profileName)||"Studio Manager"]})]}),e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 mb-6 overflow-hidden",children:e.jsx("div",{className:"flex overflow-x-auto scrollbar-hide",children:na.map(d=>{const v=d.icon,u=a===d.id,g=d.id==="bookings"&&l.pendingBookings>0;return e.jsxs("button",{onClick:()=>i(d.id),className:`flex items-center gap-2 px-5 py-4 text-sm font-medium whitespace-nowrap transition-all border-b-2 relative ${u?"border-brand-blue text-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx(v,{size:18}),d.label,g&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:l.pendingBookings})]},d.id)})})}),e.jsx("div",{className:"md:hidden mb-4 px-1",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:h==null?void 0:h.description})}),e.jsx("div",{className:"min-h-[50vh]",children:m()})]})}const Yn=["Student","Instructor","Intern","Admin"];function Ja({user:t,userData:s,onUpdate:a,onRoleSwitch:i}){var ce,he,ue,fe,O,ie,ne;const[l,n]=r.useState(s.settings||{notifications:{email:!0,push:!0,marketing:!1},privacy:{publicProfile:!0,showLocation:!0,hideProfile:!1},theme:"system",social:{mutedUsers:[],blockedUsers:[]},messenger:{mutedThreads:[],blockedContacts:[]},preferences:{seeAllProfiles:!1}}),[o,p]=r.useState(s.accountTypes||[]),[x,b]=r.useState(s.preferredRole||o[0]),[m,h]=r.useState(s.activeProfileRole||o[0]),[d,v]=r.useState(!1),[u,g]=r.useState(!1),[y,c]=r.useState(!1),[k,N]=r.useState(""),[f,S]=r.useState(!1),[j,C]=r.useState(!1),[R,E]=r.useState(null),[w,z]=r.useState({newEmail:"",newPassword:"",currentPassword:""}),[A,q]=r.useState(!1),[G,H]=r.useState(!1);r.useEffect(()=>{s.activeProfileRole&&h(s.activeProfileRole)},[s.activeProfileRole]);const J=(V,ae)=>{n(ve=>{var Ye;const Xe={...ve,[V]:{...ve[V],[ae]:!((Ye=ve[V])!=null&&Ye[ae])}};return a(Xe),Xe})},M=V=>{n(ae=>{const ve={...ae,theme:V};return a(ve),ve})},L=async()=>{if(o.length===0)return alert("You must have at least one role.");v(!0);try{await te(W(P,Z(t.uid).userProfile),{accountTypes:o,preferredRole:x,activeProfileRole:m}),m!==s.activeProfileRole&&i&&i(m);for(const V of o){const ae=W(P,Z(t.uid).userSubProfile(V));(await Be(ae)).exists()||await Oe(ae,{useRealName:!0,useGlobalName:!0})}alert("Roles & Preferences updated!")}catch(V){console.error(V),alert("Failed to update.")}v(!1)},_=V=>{p(ae=>ae.includes(V)?ae.filter(ve=>ve!==V):[...ae,V])},B=V=>{E(V),z({newEmail:"",newPassword:"",currentPassword:""}),C(!0)},U=async()=>{if(!w.currentPassword)return alert("Current password is required to verify your identity.");q(!0);try{const V=gl.credential(t.email,w.currentPassword);if(await ul(t,V),R==="email"){if(!w.newEmail)throw new Error("New email address is required.");await ml(t,w.newEmail),await te(W(P,Z(t.uid).userProfile),{email:w.newEmail}),alert("Email updated successfully.")}else if(R==="password"){if(w.newPassword.length<6)throw new Error("Password must be at least 6 characters.");await bl(t,w.newPassword),alert("Password updated successfully.")}C(!1),z({newEmail:"",newPassword:"",currentPassword:""})}catch(V){console.error("Security Update Error:",V),V.code==="auth/wrong-password"?alert("Incorrect current password."):V.code==="auth/email-already-in-use"?alert("This email is already associated with another account."):alert("Failed to update: "+V.message)}q(!1)},Q=async()=>{g(!0);try{throw new Error("Data export functionality is temporarily unavailable. Firebase Functions service is not configured.")}catch(V){console.error(V),alert("Failed to export data. Please try again later.")}g(!1)},xe=async()=>{if(k==="DELETE"){c(!0);try{await hl(t)}catch(V){console.error("Deletion Error:",V),V.code==="auth/requires-recent-login"?alert("For security, please log out and log back in before deleting your account."):alert("Failed to delete account: "+V.message),c(!1)}}},ye=({title:V,items:ae,type:ve,icon:Xe})=>e.jsxs("div",{className:"mt-4 border-t dark:border-gray-700 pt-4",children:[e.jsxs("h5",{className:"text-sm font-bold dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(Xe,{size:14})," ",V]}),ae&&ae.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:ae.map((Ye,de)=>e.jsxs("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded flex items-center gap-1 text-gray-600 dark:text-gray-300",children:[Ye.substring(0,8),"... ",e.jsx(le,{size:10,className:"cursor-pointer hover:text-red-500"})]},de))}):e.jsxs("p",{className:"text-xs text-gray-400 italic",children:["No active ",ve,"."]})]}),pe=G?[...new Set([...Qt,...Yn])]:Qt;return e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-300 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(_e,{size:18,className:"text-purple-500"})," Roles & Workflow"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block",children:"Active Account Types"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-yellow-50 dark:bg-yellow-900/10 px-2 py-1 rounded border border-yellow-200 dark:border-yellow-800",children:[e.jsx("input",{type:"checkbox",checked:G,onChange:V=>H(V.target.checked),className:"rounded text-yellow-600 focus:ring-yellow-500"}),e.jsx("span",{className:"text-[10px] font-bold text-yellow-700 dark:text-yellow-400",children:"Unlock All Roles"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:pe.map(V=>e.jsx("button",{onClick:()=>_(V),className:`px-3 py-1.5 rounded-full text-xs font-bold transition border ${o.includes(V)?"bg-purple-100 border-purple-200 text-purple-700 dark:bg-purple-900/30 dark:border-purple-700 dark:text-purple-300":"bg-gray-50 border-gray-200 text-gray-500 dark:bg-transparent dark:border-gray-600 dark:text-gray-400"}`,children:V},V))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(ze,{size:12})," Preferred Profile"]}),e.jsx("select",{className:"w-full p-2 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:x,onChange:V=>b(V.target.value),children:o.map(V=>e.jsx("option",{value:V,children:V},V))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(ft,{size:12})," Active Workflow Context"]}),e.jsx("select",{className:"w-full p-2 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:m,onChange:V=>h(V.target.value),children:o.map(V=>e.jsx("option",{value:V,children:V},V))})]})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 p-2 rounded transition border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pa,{size:16,className:"text-brand-blue"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-200",children:"See All (Unfiltered View)"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Show all content types regardless of active workflow."})]})]}),e.jsxs("div",{className:`w-10 h-5 rounded-full p-0.5 flex transition-colors ${(ce=l.preferences)!=null&&ce.seeAllProfiles?"bg-brand-blue justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:[e.jsx("input",{type:"checkbox",className:"hidden",checked:((he=l.preferences)==null?void 0:he.seeAllProfiles)||!1,onChange:()=>J("preferences","seeAllProfiles")}),e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:L,disabled:d,className:"w-full bg-purple-600 text-white px-4 py-2.5 rounded-lg font-bold hover:bg-purple-700 disabled:opacity-50 flex items-center justify-center gap-2 shadow-md transition",children:[d?e.jsx(K,{className:"animate-spin",size:16}):e.jsx(ft,{size:16})," Save Workflow Settings"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ie,{size:18,className:"text-blue-500"})," Account Security"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400",children:e.jsx(Ht,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Email Address"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]})]}),e.jsx("button",{onClick:()=>B("email"),className:"text-xs font-bold bg-white dark:bg-gray-700 border dark:border-gray-600 px-3 py-1.5 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition",children:"Change Email"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400",children:e.jsx(Vt,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Password"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Last changed: Never (or unknown)"})]})]}),e.jsx("button",{onClick:()=>B("password"),className:"text-xs font-bold bg-white dark:bg-gray-700 border dark:border-gray-600 px-3 py-1.5 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition",children:"Change Password"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ht,{size:18,className:"text-gray-500"})," Content & Safety"]}),e.jsx(ye,{title:"Blocked Users",items:(ue=l.social)==null?void 0:ue.blockedUsers,type:"blocks",icon:qs}),e.jsx(ye,{title:"Muted Threads",items:(fe=l.messenger)==null?void 0:fe.mutedThreads,type:"mutes",icon:St})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(st,{size:18,className:"text-brand-blue"})," Notification Preferences"]}),e.jsx("div",{className:"space-y-3",children:Object.entries({email:"Email Notifications",push:"Push Notifications",marketing:"Marketing & Updates"}).map(([V,ae])=>{var ve;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-300",children:ae}),e.jsx("div",{onClick:()=>J("notifications",V),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(ve=l.notifications)!=null&&ve[V]?"bg-brand-blue justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]},V)})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ie,{size:18,className:"text-green-500"})," Privacy & Visibility"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Public Profile Visibility"})]}),e.jsx("div",{onClick:()=>J("privacy","publicProfile"),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(O=l.privacy)!=null&&O.publicProfile?"bg-green-500 justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Show Location on Map"})]}),e.jsx("div",{onClick:()=>J("privacy","showLocation"),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(ie=l.privacy)!=null&&ie.showLocation?"bg-green-500 justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qs,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Hide Profile Completely"})]}),e.jsx("div",{onClick:()=>J("privacy","hideProfile"),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(ne=l.privacy)!=null&&ne.hideProfile?"bg-brand-blue justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]}),e.jsx("div",{className:"pt-4 mt-2 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-bold dark:text-white",children:"Your Data"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Download a copy of your personal data (GDPR/CCPA)."})]}),e.jsxs("button",{onClick:Q,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs font-bold text-gray-700 dark:text-gray-200 transition",children:[u?e.jsx(K,{size:14,className:"animate-spin"}):e.jsx(rs,{size:14}),"Download Data"]})]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(At,{size:18,className:"text-purple-500"})," Appearance"]}),e.jsx("div",{className:"flex bg-gray-100 dark:bg-black/20 p-1 rounded-lg",children:["light","dark","system"].map(V=>e.jsx("button",{onClick:()=>M(V),className:`flex-1 py-2 text-xs font-bold rounded-md capitalize transition-all ${l.theme===V?"bg-white dark:bg-gray-700 shadow-sm text-brand-blue":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:V},V))})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 p-6 rounded-xl border border-red-100 dark:border-red-800/30 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg text-red-600 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(yt,{size:18})," Danger Zone"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:"Deleting your account is permanent. This action will trigger the data cleanup process, removing your profile, posts, and messages."}),f?e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border border-red-200 dark:border-red-900 shadow-lg animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("h4",{className:"font-bold text-red-600 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(at,{size:16})," Confirm Deletion"]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["Type ",e.jsx("strong",{children:"DELETE"})," below to confirm. This cannot be undone."]}),e.jsx("input",{type:"text",className:"w-full p-2 border border-red-300 dark:border-red-900 rounded mb-3 text-sm focus:ring-2 focus:ring-red-500 outline-none dark:bg-black/20 dark:text-white",placeholder:"Type DELETE",value:k,onChange:V=>N(V.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:xe,disabled:k!=="DELETE"||y,className:"flex-1 bg-red-600 text-white py-2 rounded font-bold text-xs hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:y?e.jsx(K,{className:"animate-spin",size:14}):"Confirm Delete"}),e.jsx("button",{onClick:()=>{S(!1),N("")},className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-xs hover:opacity-80",children:"Cancel"})]})]}):e.jsx("button",{onClick:()=>S(!0),className:"bg-red-100 hover:bg-red-200 dark:bg-red-900/40 dark:hover:bg-red-900/60 text-red-700 dark:text-red-300 px-4 py-2 rounded-lg text-sm font-bold transition",children:"Delete Account"})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 shadow-2xl animate-in zoom-in-95 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white flex items-center gap-2",children:[R==="email"?e.jsx(Ht,{size:20}):e.jsx(Vt,{size:20}),"Update ",R==="email"?"Email":"Password"]}),e.jsx("button",{onClick:()=>C(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-white",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Current Password (Required)"}),e.jsx("input",{type:"password",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Verify your identity",value:w.currentPassword,onChange:V=>z({...w,currentPassword:V.target.value})})]}),R==="email"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"New Email Address"}),e.jsx("input",{type:"email",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"name@example.com",value:w.newEmail,onChange:V=>z({...w,newEmail:V.target.value})})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"New Password"}),e.jsx("input",{type:"password",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Min 6 characters",value:w.newPassword,onChange:V=>z({...w,newPassword:V.target.value})})]}),e.jsxs("button",{onClick:U,disabled:A,className:"w-full bg-blue-600 text-white py-2.5 rounded-lg font-bold hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2 shadow-lg mt-2",children:[A?e.jsx(K,{className:"animate-spin",size:18}):e.jsx(re,{size:18}),"Confirm Update"]})]})]})})]})}const Kn=Ns({firstName:Se().min(2,"First name too short"),lastName:Se().min(2,"Last name too short"),displayName:Se().optional(),bio:Se().max(500,"Bio exceeds 500 characters").optional(),zip:Se().regex(/^\d{5}$/,"Invalid ZIP code").optional().or(Kt("")),hourlyRate:Gt().min(0,"Rate cannot be negative").optional(),website:Se().url("Invalid URL").optional().or(Kt(""))}),Qn=(t,s,a)=>a?a.substring(0,2).toUpperCase():(((t==null?void 0:t[0])||"")+((s==null?void 0:s[0])||"")).toUpperCase()||"U";function Xn({user:t,userData:s,subProfiles:a={},handleLogout:i}){const[l,n]=r.useState("details"),[o,p]=r.useState("Main"),[x,b]=r.useState(!1),{uploadImage:m,uploading:h}=Ra(),[d,v]=r.useState((s==null?void 0:s.useLegalNameOnly)||!1),[u,g]=r.useState((s==null?void 0:s.useUserNameOnly)||!1);r.useEffect(()=>{v((s==null?void 0:s.useLegalNameOnly)||!1),g((s==null?void 0:s.useUserNameOnly)||!1)},[s]);const y=()=>{const w=!d;v(w),w&&g(!1)},c=()=>{const w=!u;g(w),w&&v(!1)},{register:k,handleSubmit:N,formState:{errors:f,isDirty:S}}=ks({resolver:ws(Kn),defaultValues:{firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",displayName:(s==null?void 0:s.displayName)||"",bio:(s==null?void 0:s.bio)||"",zip:(s==null?void 0:s.zip)||"",hourlyRate:(s==null?void 0:s.hourlyRate)||0,website:(s==null?void 0:s.website)||""}}),j=async w=>{b(!0);const z=I.loading("Saving main profile...");try{let A=`${w.firstName} ${w.lastName}`;d?A=`${w.firstName} ${w.lastName}`:u&&w.displayName?A=w.displayName:w.displayName&&(A=`${w.firstName} "${w.displayName}" ${w.lastName}`);const q=W(P,Z(t.uid).userProfile);await te(q,{...w,useLegalNameOnly:d,useUserNameOnly:u,effectiveDisplayName:A,searchTerms:[w.firstName.toLowerCase(),w.lastName.toLowerCase(),(w.displayName||"").toLowerCase(),A.toLowerCase()].filter(Boolean)}),I.success("Main Profile Updated!",{id:z})}catch(A){console.error("Update failed",A),I.error("Failed to update profile.",{id:z})}finally{b(!1)}},C=async w=>{const z=w.target.files[0];if(!z)return;const A=I.loading("Uploading photo...");try{const q=await m(z,`users/${t.uid}/avatars`),G=W(P,Z(t.uid).userProfile);await te(G,{photoURL:q}),I.success("Photo uploaded!",{id:A})}catch(q){console.error(q),I.error("Photo upload failed",{id:A})}},R=async w=>{try{const z=W(P,Z(t.uid).userProfile);await te(z,{settings:w}),I.success("Settings saved.")}catch(z){console.error("Settings save failed",z),I.error("Failed to save settings.")}},E=w=>fa("w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none",w?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-700");return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("h1",{className:"text-3xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Le,{className:"text-brand-blue"})," ",l==="details"?"Edit Profile":"Account Settings"]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex gap-1 self-start md:self-auto",children:[e.jsx("button",{onClick:()=>n("details"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${l==="details"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"Edit Details"}),e.jsxs("button",{onClick:()=>n("settings"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all flex items-center gap-1 ${l==="settings"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:[e.jsx(ht,{size:14})," Settings"]})]})]}),l==="details"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-2",children:[e.jsx("div",{className:"font-bold text-xs text-gray-500 uppercase tracking-wider mb-2 px-1",children:"Profiles"}),e.jsxs("button",{onClick:()=>p("Main"),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${o==="Main"?"bg-brand-blue text-white shadow-md":"bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:16})," ",e.jsx("span",{className:"font-bold text-sm",children:"Main Profile"})]}),o==="Main"&&e.jsx(dt,{size:16})]}),((s==null?void 0:s.accountTypes)||[]).map(w=>Xt[w]?e.jsxs("button",{onClick:()=>p(w),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${o===w?"bg-brand-blue text-white shadow-md":"bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{size:16})," ",e.jsx("span",{className:"font-bold text-sm",children:w})]}),o===w&&e.jsx(dt,{size:16})]},w):null)]}),e.jsx("div",{className:"lg:col-span-3",children:o==="Main"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsxs("div",{className:"relative group w-full aspect-square rounded-full overflow-hidden bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-700 shadow-md",children:[s!=null&&s.photoURL?e.jsx("img",{src:s.photoURL,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gradient-to-tr from-brand-blue to-purple-500 text-white font-bold text-4xl",children:Qn(s==null?void 0:s.firstName,s==null?void 0:s.lastName,s==null?void 0:s.displayName)}),e.jsxs("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity",children:[e.jsx("span",{className:"text-white font-bold text-sm",children:"Change Photo"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:C,disabled:h})]}),h&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(K,{className:"animate-spin text-white"})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl text-xs text-blue-800 dark:text-blue-200",children:[e.jsx("p",{className:"font-bold mb-1",children:"Pro Tip:"}),"High-quality profile photos increase booking rates by 40%."]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("form",{onSubmit:N(j),className:"space-y-6 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"First Name (Legal)"}),e.jsx("input",{...k("firstName"),className:E(f.firstName)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Last Name (Legal)"}),e.jsx("input",{...k("lastName"),className:E(f.lastName)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"User Name (Display Name)"}),e.jsx("input",{...k("displayName"),className:E(f.displayName),placeholder:"e.g. SeshMaster"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-1",children:"Display Name Preferences"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Legal Name Only"}),e.jsx("button",{type:"button",onClick:y,className:"text-brand-blue",children:d?e.jsx(zt,{size:28}):e.jsx(Pt,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use User Name Only"}),e.jsx("button",{type:"button",onClick:c,className:"text-brand-blue",children:u?e.jsx(zt,{size:28}):e.jsx(Pt,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2",children:["Preview: ",e.jsx("strong",{className:"text-brand-blue",children:d?`${s.firstName} ${s.lastName}`:u?s.displayName||"Not Set":`${s.firstName} "${s.displayName||"User"}" ${s.lastName}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Bio / About"}),e.jsx("textarea",{...k("bio"),rows:"4",className:E(f.bio),placeholder:"Tell us about your musical journey..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(Te,{size:12})," ZIP Code"]}),e.jsx("input",{...k("zip"),className:E(f.zip)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(Ce,{size:12})," Hourly Rate ($)"]}),e.jsx("input",{type:"number",...k("hourlyRate",{valueAsNumber:!0}),className:E(f.hourlyRate)})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700 flex justify-end",children:e.jsx("button",{type:"button",onClick:N(j),disabled:x,className:ya("px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg",x?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-105"),children:x?e.jsx(K,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{size:20})," Save Changes"]})})})]})})]}):e.jsx(Zn,{user:t,userData:s,role:o,initialData:a[o]||{},schema:Xt[o]||[]})})]}):e.jsx("div",{className:"animate-in fade-in slide-in-from-right-2",children:e.jsx(Ja,{user:t,userData:s,handleLogout:i,onUpdate:R})})]})}function Zn({user:t,userData:s,role:a,initialData:i,schema:l}){const[n,o]=r.useState(i),[p,x]=r.useState(!1),[b,m]=r.useState(i.followMainProfile??!0),[h,d]=r.useState(i.useLegalNameOnly??!1),[v,u]=r.useState(i.useUserNameOnly??!1),[g,y]=r.useState(i.syncStudioOps??!1);r.useEffect(()=>{o(i||{}),m(i.followMainProfile??!0),d(i.useLegalNameOnly??!1),u(i.useUserNameOnly??!1),y(i.syncStudioOps??!1)},[i]);const c=(j,C)=>o(R=>({...R,[j]:C})),k=()=>{d(!h),h||u(!1)},N=()=>{u(!v),v||d(!1)},f=async j=>{j.preventDefault(),x(!0);const C=I.loading(`Saving ${a} profile...`);try{let R="";b?R=s.effectiveDisplayName||`${s.firstName} ${s.lastName}`:h?R=`${s.firstName} ${s.lastName}`:v?R=s.displayName||`${s.firstName} ${s.lastName}`:R=n.profileName||`${s.firstName} ${s.lastName}`;const E={...n,followMainProfile:b,useLegalNameOnly:h,useUserNameOnly:v,syncStudioOps:g,displayName:R},w=W(P,Z(t.uid).userSubProfile(a));if(await Oe(w,E,{merge:!0}),s.activeProfileRole===a){const z=W(P,Z(t.uid).userPublicProfile);await te(z,{displayName:R,searchTerms:[R.toLowerCase()]})}if(a==="Studio"&&g){const z=W(P,Z(t.uid).userProfile);await te(z,{studioName:R})}I.success(`${a} Profile Saved!`,{id:C})}catch(R){console.error(R),I.error("Failed to save.",{id:C})}finally{x(!1)}};if(l.length===0)return e.jsx("div",{className:"p-10 text-center text-gray-500",children:"No configuration available for this role."});const S=l.filter(j=>j.key!=="profileName"&&j.key!=="useRealName");return e.jsxs("form",{onSubmit:f,className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white border-b dark:border-gray-700 pb-2",children:[a," Identity & Details"]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-1",children:"Identity Settings"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Follow Main Profile Name"}),e.jsxs("div",{className:"text-xs text-gray-500",children:['Use "',s.effectiveDisplayName||`${s.firstName} ${s.lastName}`,'"']})]}),e.jsx("button",{type:"button",onClick:()=>m(!b),className:"text-brand-blue",children:b?e.jsx(zt,{size:28}):e.jsx(Pt,{size:28,className:"text-gray-400"})})]}),!b&&e.jsxs("div",{className:"space-y-3 animate-in slide-in-from-top-1 pt-3 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Legal Name Only"}),e.jsx("button",{type:"button",onClick:k,className:"text-brand-blue",children:h?e.jsx(zt,{size:28}):e.jsx(Pt,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Main User Name Only"}),e.jsx("button",{type:"button",onClick:N,className:"text-brand-blue",children:v?e.jsx(zt,{size:28}):e.jsx(Pt,{size:28,className:"text-gray-400"})})]}),!h&&!v&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("label",{className:"text-xs font-bold text-brand-blue uppercase mb-1 block",children:[a," Name"]}),e.jsx("input",{type:"text",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none font-bold",placeholder:`e.g. ${a==="Studio"?"Sound City":"The Weeknd"}`,value:n.profileName||"",onChange:j=>c("profileName",j.target.value)}),a==="Studio"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:j=>y(j.target.checked),className:"rounded text-brand-blue focus:ring-brand-blue"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Force "Studio Ops" to use this name'})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2",children:["Preview: ",e.jsx("strong",{className:"text-brand-blue",children:h?`${s.firstName} ${s.lastName}`:v?s.displayName||"Not Set":n.profileName||"Not Set"})]})]})]}),S.map(j=>{var C;return j.isToggle?null:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:j.label}),j.type==="textarea"?e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",rows:4,value:n[j.key]||"",onChange:R=>c(j.key,R.target.value)}):j.type==="select"?e.jsx("select",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",value:n[j.key]||"",onChange:R=>c(j.key,R.target.value),children:(C=j.options)==null?void 0:C.map(R=>e.jsx("option",{value:R,children:R},R))}):j.type==="multi_select"?e.jsx(Ps,{label:"",fieldKey:j.key,options:j.data||j.options||[],initialValues:n[j.key]||[],onChange:c}):j.type==="nested_select"?e.jsx(vi,{label:"",fieldKey:j.key,data:j.data,initialValues:n[j.key]||[],onChange:c}):j.key==="equipment"?e.jsx(Is,{multi:!0,value:n[j.key]||"",onChange:R=>c(j.key,R),placeholder:"Add gear..."}):e.jsx("input",{type:j.type==="number"?"number":"text",className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",value:n[j.key]||"",onChange:R=>c(j.key,R.target.value)})]},j.key)}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700 flex justify-end",children:e.jsx("button",{type:"submit",disabled:p,className:"px-8 py-3 rounded-xl font-bold bg-brand-blue text-white hover:bg-blue-600 flex items-center gap-2 transition shadow-lg disabled:opacity-50",children:p?e.jsx(K,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{size:20})," Save ",a," Profile"]})})})]})}function Jn({user:t}){const[s,a]=r.useState([]),[i,l]=r.useState("All");return r.useEffect(()=>{const n=me(D(P,`artifacts/${ee}/public/data/service_requests`),Re("timestamp","desc"),Qe(50)),o=ge(n,p=>a(p.docs.map(x=>({id:x.id,...x.data()}))));return()=>o()},[]),e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2",children:[e.jsx("button",{onClick:()=>l("All"),className:`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap border transition ${i==="All"?"bg-orange-500 text-white border-orange-600":"bg-white dark:bg-dark-card border-gray-200 dark:border-gray-700 dark:text-gray-300"}`,children:"All Jobs"}),Zt.map(n=>e.jsx("button",{onClick:()=>l(n.label),className:`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap border transition ${i===n.label?"bg-orange-500 text-white border-orange-600":"bg-white dark:bg-dark-card border-gray-200 dark:border-gray-700 dark:text-gray-300"}`,children:n.label},n.id))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.filter(n=>i==="All"||n.category===i).map(n=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 hover:border-orange-400 transition shadow-sm group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20 px-2 py-0.5 rounded",children:n.category}),n.budget&&e.jsxs("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:["$",n.budget]})]}),e.jsx("h3",{className:"font-bold text-lg dark:text-white mb-1",children:n.topic}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-4",children:n.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 border-t dark:border-gray-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:12})," ",n.userName]}),n.userId!==t.uid&&e.jsxs("button",{className:"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1.5 rounded font-bold hover:opacity-80 flex items-center gap-1",children:[e.jsx(pt,{size:12})," Message"]})]})]},n.id)),s.length===0&&e.jsx("div",{className:"col-span-full text-center py-12 text-gray-400",children:"No active requests."})]})]})}function Dn({user:t,userData:s,target:a,onClose:i}){const[l,n]=r.useState(!1),[o,p]=r.useState({serviceCategory:"Repair",equipmentName:"",issueDescription:"",logistics:"Drop-off",preferredDate:"",budgetCap:""}),[x,b]=r.useState([]),{uploadMedia:m,uploading:h}=xt(),d=async u=>{const g=u.target.files[0];if(!g)return;const y=await m(g,`tech_requests/${t.uid}`);y&&b(c=>[...c,y])},v=async()=>{if(!o.equipmentName||!o.issueDescription)return alert("Please describe the equipment and the issue.");n(!0);try{await Ee(D(P,`artifacts/${ee}/public/data/bookings`),{senderId:t.uid,senderName:`${s.firstName} ${s.lastName}`,targetId:a.id,targetName:a.firstName?`${a.firstName} ${a.lastName}`:a.name,type:"TechRequest",serviceType:o.serviceCategory,equipment:o.equipmentName,description:o.issueDescription,logistics:o.logistics,budgetCap:o.budgetCap,status:"Pending",date:o.preferredDate||"Flexible",message:`[${o.serviceCategory}] ${o.equipmentName}: ${o.issueDescription}`,attachments:x,timestamp:X()}),alert("Service request sent!"),i()}catch{alert("Failed to send.")}n(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-in fade-in zoom-in-95",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(vt,{size:18,className:"text-orange-500"})," Service Request"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Hiring ",e.jsxs("span",{className:"font-bold text-orange-600 dark:text-orange-400",children:[a.firstName," ",a.lastName]})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Type"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:o.serviceCategory,onChange:u=>p({...o,serviceCategory:u.target.value}),children:Zt.map(u=>e.jsx("option",{value:u.label,children:u.label},u.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Logistics"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:o.logistics,onChange:u=>p({...o,logistics:u.target.value}),children:[e.jsx("option",{value:"Drop-off",children:"I will drop it off"}),e.jsx("option",{value:"On-site",children:"Tech comes to me"}),e.jsx("option",{value:"Ship",children:"I will ship it"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Equipment"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"e.g. Fender Twin Reverb",value:o.equipmentName,onChange:u=>p({...o,equipmentName:u.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Issue Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px] text-sm",placeholder:"Describe symptoms...",value:o.issueDescription,onChange:u=>p({...o,issueDescription:u.target.value})})]}),e.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-brand-blue hover:text-blue-600 font-bold mb-3",children:[e.jsx(vs,{size:16})," Add Video/Photo ",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,video/*",onChange:d,disabled:h})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:x.map((u,g)=>e.jsx("div",{className:"h-12 w-12 bg-black rounded border dark:border-gray-600 overflow-hidden",children:e.jsx("img",{src:u.url,className:"h-full w-full object-cover"})},g))})]})]}),e.jsx("div",{className:"p-5 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("button",{onClick:v,disabled:l||h,className:"w-full bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg",children:l?e.jsx(K,{className:"animate-spin mx-auto"}):"Submit Request"})})]})})}function eo({user:t,userData:s,openPublicProfile:a}){const[i,l]=r.useState([]),[n,o]=r.useState(!1),[p,x]=r.useState(""),[b,m]=r.useState(""),[h,d]=r.useState(null),v=async()=>{o(!0);try{const u=[we("accountTypes","array-contains","Technician"),Qe(20)];p&&u.push(we("searchTerms","array-contains",p.toLowerCase()));const g=me(ls(P,"public_profile"),...u);let c=(await He(g)).docs.map(k=>({id:k.ref.parent.parent.id,...k.data()})).filter(k=>k.id!==t.uid);b&&(c=c.filter(k=>k.subRoles&&k.subRoles.includes(b))),l(c)}catch(u){console.error(u)}o(!1)};return r.useEffect(()=>{v()},[b]),e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-4 top-3.5 text-gray-400",size:18}),e.jsx("input",{className:"w-full pl-12 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-orange-500 dark:text-white",placeholder:"Search technicians...",value:p,onChange:u=>x(u.target.value),onKeyDown:u=>u.key==="Enter"&&v()})]}),e.jsx("div",{className:"md:w-1/3",children:e.jsxs("select",{className:"w-full p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-orange-500 dark:text-white cursor-pointer",value:b,onChange:u=>m(u.target.value),children:[e.jsx("option",{value:"",children:"All Specialties"}),za.map(u=>e.jsx("option",{value:u,children:u},u))]})})]}),n?e.jsx("div",{className:"text-center py-12",children:e.jsx(K,{className:"animate-spin mx-auto text-orange-500"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(u=>{var g,y,c;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm hover:shadow-lg transition group",children:[e.jsx("div",{className:"h-24 bg-gradient-to-r from-slate-700 to-slate-600 relative",children:e.jsx("div",{className:"absolute -bottom-8 left-6",children:e.jsx("div",{className:"h-16 w-16 rounded-full border-4 border-white dark:border-[#2c2e36] bg-gray-200 overflow-hidden",children:u.photoURL?e.jsx("img",{src:u.photoURL,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:e.jsx(Le,{})})})})}),e.jsxs("div",{className:"pt-10 px-6 pb-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white text-lg",children:[u.firstName," ",u.lastName]}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 font-bold mb-2 flex items-center gap-1",children:[e.jsx(ot,{size:12})," ",((g=u.subRoles)==null?void 0:g[0])||"Technician"]})]}),u.rate>0&&e.jsxs("div",{className:"text-sm font-bold dark:text-gray-300 border border-gray-200 dark:border-gray-600 px-2 py-1 rounded-lg",children:["$",u.rate,"/hr"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:(y=u.subRoles)==null?void 0:y.slice(0,3).map(k=>e.jsx("span",{className:"text-[10px] bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-200 px-2 py-0.5 rounded border border-orange-200 dark:border-orange-800",children:k},k))}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-4 h-6 overflow-hidden",children:(((c=u.skills)==null?void 0:c.split(","))||[]).slice(0,3).map((k,N)=>e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 pr-2 border-r border-gray-300 dark:border-gray-600 last:border-0",children:k.trim()},N))}),e.jsxs("div",{className:"flex gap-2 mt-auto",children:[e.jsx("button",{onClick:()=>a(u.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 rounded-lg text-xs font-bold transition",children:"Profile"}),e.jsxs("button",{onClick:()=>d(u),className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white py-2 rounded-lg text-xs font-bold transition shadow-sm flex items-center justify-center gap-1",children:[e.jsx(vt,{size:14})," Request"]})]})]})]},u.id)})}),h&&e.jsx(Dn,{user:t,userData:s,target:h,onClose:()=>d(null)})]})}function to({user:t,userData:s,onSuccess:a,onCancel:i}){const[l,n]=r.useState(Zt[0].label),[o,p]=r.useState(""),[x,b]=r.useState("Normal"),[m,h]=r.useState(""),[d,v]=r.useState(""),[u,g]=r.useState(!1),[y,c]=r.useState(null),{uploadMedia:k,uploading:N}=xt(),f=async j=>{const C=j.target.files[0];if(!C)return;const R=await k(C,`service_requests/${t.uid}`);R&&c(R)},S=async()=>{if(!o||!d)return alert("Please complete the request.");g(!0);try{await Ee(D(P,`artifacts/${ee}/public/data/service_requests`),{topic:`${l} for ${o}`,category:l,equipment:o,urgency:x,budget:m?parseInt(m):null,description:d,userId:t.uid,userName:`${s.firstName} ${s.lastName}`,status:"Open",timestamp:X(),attachment:y||null}),alert("Tech Request Broadcasted!"),a()}catch(j){console.error(j),alert("Failed.")}g(!1)};return e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border border-orange-200 dark:border-gray-700 shadow-xl animate-in zoom-in-95",children:[e.jsxs("h2",{className:"text-2xl font-extrabold dark:text-white mb-6 flex items-center gap-2 text-orange-600",children:[e.jsx(je,{})," Broadcast Tech Need"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-6 bg-orange-50 dark:bg-gray-800 rounded-xl border border-orange-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-lg font-medium text-gray-700 dark:text-gray-200",children:[e.jsx("span",{children:"I need"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:l,onChange:j=>n(j.target.value),className:"appearance-none bg-white dark:bg-gray-700 border border-orange-300 dark:border-orange-700 rounded-lg py-1 pl-3 pr-8 font-bold text-orange-700 dark:text-white focus:outline-none",children:Zt.map(j=>e.jsx("option",{value:j.label,children:j.label},j.id))}),e.jsx(et,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-orange-500 dark:text-white pointer-events-none"})]}),e.jsx("span",{children:"for my"}),e.jsx("input",{className:"bg-transparent border-b-2 border-orange-300 dark:border-orange-700 text-center w-40 font-bold focus:outline-none focus:border-orange-500 dark:text-white",placeholder:"Equipment Name",value:o,onChange:j=>p(j.target.value)})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Urgency"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:x,onChange:j=>b(j.target.value),children:[e.jsx("option",{children:"Normal"}),e.jsx("option",{children:"High (Session Blocked)"}),e.jsx("option",{children:"Emergency (24h)"}),e.jsx("option",{children:"Flexible"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Est. Budget ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Optional",value:m,onChange:j=>h(j.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Details"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Describe the issue, specific model, symptoms...",value:d,onChange:j=>v(j.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Visual Reference"}),!y&&!N&&e.jsxs("label",{className:"flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition text-gray-500",children:[e.jsx(vs,{size:20}),e.jsx("span",{className:"text-sm font-bold",children:"Upload Video or Image"}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*,image/*",onChange:f})]}),y&&e.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden border dark:border-gray-700 bg-black",children:[y.type==="video"?e.jsx("video",{src:y.url,controls:!0,className:"w-full h-48 object-contain"}):e.jsx("img",{src:y.url,className:"w-full h-48 object-contain"}),e.jsx("button",{onClick:()=>c(null),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(le,{size:14})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:i,className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"Cancel"}),e.jsx("button",{onClick:S,disabled:u||N,className:"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:u?e.jsx(K,{className:"animate-spin"}):"Broadcast Now"})]})]})]})}function so({user:t,isTech:s}){const[a,i]=r.useState("feed"),[l,n]=r.useState([]),[o,p]=r.useState(!0);r.useEffect(()=>{const b=me(D(P,Z(t.uid).equipmentSubmissions),we("status","==","pending"),Re("timestamp","desc"),Qe(20)),m=ge(b,h=>{n(h.docs.map(d=>({id:d.id,...d.data()}))),p(!1)});return()=>m()},[t.uid]);const x=async(b,m,h)=>{var d,v,u,g,y,c;if(!s)return alert("Only verified Technicians can vote on gear accuracy.");try{const k=W(P,Z(t.uid).equipmentSubmissions,b),N=`votes.${m}`;await te(k,{[N]:Us(t.uid)});const f=3,S=3,j=(((v=(d=h.votes)==null?void 0:d.yes)==null?void 0:v.length)||0)+(m==="yes"?1:0),C=(((g=(u=h.votes)==null?void 0:u.fake)==null?void 0:g.length)||0)+(m==="fake"?1:0),R=(((c=(y=h.votes)==null?void 0:y.duplicate)==null?void 0:c.length)||0)+(m==="duplicate"?1:0);if(j>=f){const E=W(P,`artifacts/${ee}/public/data/equipment_database/${h.category}/items`,h.model.replace(/\s+/g,"_"));await Oe(E,{name:h.model,brand:h.brand,category:h.category,subCategory:h.subCategory,specs:h.specs,verifiedBy:Us(t.uid),addedBy:h.submittedBy,addedAt:X()}),await te(k,{status:"approved"}),await te(W(P,Z(h.submittedBy).userWallet),{balance:Ke(50)}),await te(W(P,Z(t.uid).userWallet),{balance:Ke(5)}),alert("Consensus reached! Item approved and rewards distributed.")}else(C>=S||R>=S)&&await te(k,{status:"rejected"})}catch(k){console.error("Voting failed:",k)}};return e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Vr,{className:"text-orange-500"})," Gear Knowledge Base"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Crowdsourced equipment specs verified by pros."})]}),e.jsxs("div",{className:"flex gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>i("feed"),className:`px-4 py-2 rounded-md text-xs font-bold transition ${a==="feed"?"bg-white dark:bg-gray-600 shadow text-orange-600 dark:text-orange-400":"text-gray-500"}`,children:"The Bench (Queue)"}),e.jsx("button",{onClick:()=>i("submit"),className:`px-4 py-2 rounded-md text-xs font-bold transition ${a==="submit"?"bg-white dark:bg-gray-600 shadow text-orange-600 dark:text-orange-400":"text-gray-500"}`,children:"Submit New Gear"})]})]}),a==="feed"&&e.jsx("div",{className:"grid grid-cols-1 gap-4",children:o?e.jsx("div",{className:"p-10 text-center",children:e.jsx(K,{className:"animate-spin mx-auto"})}):l.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl",children:[e.jsx(re,{size:48,className:"mx-auto text-green-500 mb-2 opacity-50"}),e.jsx("p",{className:"text-gray-500",children:"The bench is clear. No pending submissions."})]}):l.map(b=>{var m,h,d,v,u,g,y,c,k,N,f,S,j;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-500",children:b.brand}),e.jsx("span",{className:"text-[10px] font-bold uppercase bg-blue-50 dark:bg-blue-900/20 text-blue-600 px-2 py-0.5 rounded",children:(m=b.category)==null?void 0:m.replace(/_/g," ")})]}),e.jsx("h4",{className:"text-lg font-extrabold dark:text-white mb-2",children:b.model}),e.jsx("div",{className:"bg-gray-50 dark:bg-black/20 p-3 rounded-lg text-sm text-gray-600 dark:text-gray-300 mb-2 border dark:border-gray-700",children:b.specs}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(Le,{size:12})," Submitted by ",b.submitterName||"Unknown"," • 50 TK Reward Pending"]})]}),e.jsxs("div",{className:"w-full md:w-48 flex flex-col justify-center gap-2 border-l dark:border-gray-700 pl-0 md:pl-6",children:[e.jsxs("button",{onClick:()=>x(b.id,"yes",b),disabled:(d=(h=b.votes)==null?void 0:h.yes)==null?void 0:d.includes(t.uid),className:"w-full py-2 bg-green-100 dark:bg-green-900/20 hover:bg-green-200 text-green-700 dark:text-green-400 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(Na,{size:14})," Yes (",((u=(v=b.votes)==null?void 0:v.yes)==null?void 0:u.length)||0,")"]}),e.jsxs("button",{onClick:()=>x(b.id,"fake",b),disabled:(y=(g=b.votes)==null?void 0:g.fake)==null?void 0:y.includes(t.uid),className:"w-full py-2 bg-red-100 dark:bg-red-900/20 hover:bg-red-200 text-red-700 dark:text-red-400 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(Ur,{size:14})," Fake (",((k=(c=b.votes)==null?void 0:c.fake)==null?void 0:k.length)||0,")"]}),e.jsxs("button",{onClick:()=>x(b.id,"duplicate",b),disabled:(f=(N=b.votes)==null?void 0:N.duplicate)==null?void 0:f.includes(t.uid),className:"w-full py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 text-gray-600 dark:text-gray-300 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(Ft,{size:14})," Dup (",((j=(S=b.votes)==null?void 0:S.duplicate)==null?void 0:j.length)||0,")"]})]})]},b.id)})}),a==="submit"&&e.jsx(ao,{user:t,userData,onSuccess:()=>i("feed")})]})}function ao({user:t,userData:s,onSuccess:a}){const[i,l]=r.useState({brand:"",model:"",category:bt[0].id,subCategory:"",specs:""}),[n,o]=r.useState(!1),p=async()=>{if(!i.brand||!i.model||!i.specs)return alert("All fields required.");o(!0);try{await Ee(D(P,Z(t.uid).equipmentSubmissions),{...i,submittedBy:t.uid,submitterName:`${s.firstName} ${s.lastName}`,status:"pending",timestamp:X(),votes:{yes:[],fake:[],duplicate:[]}}),alert("Submission Received! You'll earn 50 TK once verified."),a()}catch(x){console.error(x),alert("Submission failed.")}o(!1)};return e.jsxs("div",{className:"max-w-xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border border-orange-200 dark:border-gray-700 shadow-lg",children:[e.jsx("h4",{className:"font-bold text-lg dark:text-white mb-4",children:"Submit New Equipment"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsx("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:i.category,onChange:x=>l({...i,category:x.target.value}),children:bt.map(x=>e.jsx("option",{value:x.id,children:x.label},x.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Sub-Category"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. Compressor",value:i.subCategory,onChange:x=>l({...i,subCategory:x.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. Neve",value:i.brand,onChange:x=>l({...i,brand:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. 1073LB",value:i.model,onChange:x=>l({...i,model:x.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Specs / Description"}),e.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm h-24",placeholder:"Brief technical specs...",value:i.specs,onChange:x=>l({...i,specs:x.target.value})})]}),e.jsx("button",{onClick:p,disabled:n,className:"w-full bg-orange-600 text-white py-2.5 rounded-lg font-bold hover:bg-orange-700 flex items-center justify-center gap-2",children:n?e.jsx(K,{className:"animate-spin"}):"Submit for Verification"})]})]})}function ro({user:t}){const[s,a]=r.useState({skills:"",rate:"",serviceRadius:"",subRoles:[]}),[i,l]=r.useState(!0);r.useEffect(()=>{Be(W(P,Z(t.uid).userSubProfile("Technician"))).then(o=>{o.exists()&&a(o.data()),l(!1)})},[t.uid]);const n=async()=>{try{await te(W(P,Z(t.uid).userSubProfile("Technician")),s);const o=[...s.skills?s.skills.toLowerCase().split(",").map(p=>p.trim()):[],...s.subRoles?s.subRoles.map(p=>p.toLowerCase()):[]];await te(W(P,Z(t.uid).userPublicProfile),{rate:parseInt(s.rate)||0,subRoles:s.subRoles||[],searchTerms:o}),alert("Tech Profile Updated Successfully")}catch{alert("Update failed")}};return i?e.jsx("div",{className:"p-10 text-center",children:e.jsx(K,{className:"animate-spin mx-auto"})}):e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm animate-in fade-in",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white mb-6 border-b dark:border-gray-700 pb-2",children:"Your Technician Settings"}),e.jsxs("div",{className:"space-y-5",children:[e.jsx(Ps,{label:"Primary Specialties",fieldKey:"subRoles",options:za,initialValues:s.subRoles,onChange:(o,p)=>a(x=>({...x,[o]:p}))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Detailed Skills (Comma Separated)"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:s.skills||"",onChange:o=>a({...s,skills:o.target.value}),placeholder:"e.g. SSL 4000 Maintenance, Tube Bias..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hourly Rate ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:s.rate||"",onChange:o=>a({...s,rate:o.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Radius (Miles)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:s.serviceRadius||"",onChange:o=>a({...s,serviceRadius:o.target.value})})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:n,className:"w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:18})," Save Changes"]})})]})]})}function lo({user:t,userData:s,openPublicProfile:a}){var o;const[i,l]=r.useState("board"),n=(o=s==null?void 0:s.accountTypes)==null?void 0:o.includes("Technician");return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-900 to-slate-900 p-8 rounded-2xl text-white shadow-xl relative overflow-hidden flex flex-col md:flex-row justify-between items-end",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-400 font-bold uppercase tracking-widest text-xs mb-2",children:[e.jsx(vt,{size:14})," SeshNx Technical"]}),e.jsx("h1",{className:"text-3xl font-extrabold mb-2",children:"Studio Tech Services"}),e.jsx("p",{className:"text-slate-300 max-w-lg",children:"Hire professionals for equipment repair, studio wiring, and acoustic calibration."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 relative z-10 mt-4 md:mt-0",children:[e.jsx("button",{onClick:()=>l("board"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${i==="board"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Job Board"}),e.jsx("button",{onClick:()=>l("directory"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${i==="directory"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Find a Tech"}),e.jsx("button",{onClick:()=>l("broadcast"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${i==="broadcast"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Post Request"}),e.jsx("button",{onClick:()=>l("database"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${i==="database"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Gear DB"}),n&&e.jsx("button",{onClick:()=>l("profile"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${i==="profile"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Tech Portal"})]}),e.jsx(ht,{size:200,className:"absolute -right-10 -top-10 text-white opacity-5 rotate-12 pointer-events-none"})]}),e.jsxs("div",{className:"min-h-[400px]",children:[i==="board"&&e.jsx(Jn,{user:t}),i==="directory"&&e.jsx(eo,{user:t,userData:s,openPublicProfile:a}),i==="broadcast"&&e.jsx(to,{user:t,userData:s,onSuccess:()=>l("board"),onCancel:()=>l("board")}),i==="database"&&e.jsx(so,{user:t,isTech:n}),i==="profile"&&n&&e.jsx(ro,{user:t})]})]})}const io=()=>{const[t,s]=r.useState({tierData:null,tokenPackages:null}),[a,i]=r.useState(!0),{DEFAULT_TIER_DATA:l,FALLBACK_TOKEN_PACKAGES:n}=r.useMemo(()=>({DEFAULT_TIER_DATA:{FREE:{name:"Free",price:0,feeMultiplier:1.2,features:["1 Broadcast Request / month","Cannot list on SeshFx Market"],limits:{broadcastsPerMonth:1,sessionsPerWeek:2,canListMarket:!1,monthlyTokens:0}},BASIC:{name:"Basic",price:4.99,feeMultiplier:1.1,features:["3 Broadcast Requests / month","10 Booked Sessions / week","Can list on SeshFx Market (5 items)"],limits:{broadcastsPerMonth:3,sessionsPerWeek:10,canListMarket:!0,monthlyTokens:25}},PRO:{name:"Pro Creative",price:14.99,feeMultiplier:1.02,features:["15 Broadcast Requests / month","Unlimited Booked Sessions","Profile Search Boost"],limits:{broadcastsPerMonth:15,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}},STUDIO:{name:"Studio Business",price:29.99,feeMultiplier:1,features:["Studio Manager Component Access","Unlimited Broadcast Requests","0% Session Fees"],limits:{broadcastsPerMonth:999,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}}},FALLBACK_TOKEN_PACKAGES:[{id:"pack_small",tokens:100,price:4.99,label:"Starter Stash"},{id:"pack_medium",tokens:550,price:19.99,label:"Producer Pack",highlight:!0},{id:"pack_large",tokens:1200,price:39.99,label:"Studio Vault"}]}),[]);r.useEffect(()=>{const p=W(P,"artifacts",ee,"public","config","subscriptions","tier_config"),x=ge(p,h=>{let d=h.exists()?h.data():{};const v=Object.keys(l).reduce((u,g)=>(u[g]={...l[g],...d[g]},u),{});s(u=>({...u,tierData:v}))}),b=W(P,"artifacts",ee,"public","config","subscriptions","token_packages"),m=ge(b,h=>{let d=h.exists()?Object.values(h.data()):n;(!Array.isArray(d)||d.length===0)&&(d=n),s(v=>({...v,tokenPackages:d}))});return i(!1),()=>{x(),m()}},[l,n]);const o=p=>{var b,m;const x=((b=t.tierData)==null?void 0:b[p])||((m=t.tierData)==null?void 0:m.FREE);return x?x.feeMultiplier:l.FREE.feeMultiplier};return{tierData:t.tierData||l,tokenPackages:t.tokenPackages||n,loading:a,getFeeMultiplier:o}},no=async t=>{throw t<=0?new Error("No funds available to cash out."):new Error("Payout functionality is temporarily unavailable. Firebase Functions service is not configured.")};function oo({user:t,userData:s}){var N;const[a,i]=r.useState("store"),[l,n]=r.useState({balance:0,escrowBalance:0,payoutBalance:0}),[o,p]=r.useState(!1),{tierData:x,tokenPackages:b,loading:m}=io(),h=(s==null?void 0:s.currentTier)||$l.FREE,d=(N=s==null?void 0:s.accountTypes)==null?void 0:N.some(f=>["Artist","Musician","Producer","Engineer","Studio","Composer","Technician","Label","Agent"].includes(f));r.useEffect(()=>{if(!(t!=null&&t.uid))return;const f=ge(W(P,Z(t.uid).userWallet),S=>{if(S.exists()){const j=S.data();n({balance:j.balance||0,escrowBalance:j.escrowBalance||0,payoutBalance:j.payoutBalance||0})}});return()=>f()},[t.uid]);const v=async(f,S="payment")=>{p(!0);try{throw new Error("Checkout functionality is temporarily unavailable. Firebase Functions service is not configured.")}catch(j){console.error("Checkout Error:",j),alert(`Checkout failed: ${j.message}`)}finally{p(!1)}},u=f=>{if(!f.stripePriceId)return alert("Configuration Error: This package is missing a Stripe Price ID.");v(f.stripePriceId,"payment")},g=f=>{if(!f.stripePriceId)return alert("Configuration Error: This plan is missing a Stripe Price ID.");v(f.stripePriceId,"subscription")},y=async()=>{if(d){if(l.payoutBalance<=0)return alert("No funds available for cash out.");if(window.confirm(`Cash out $${l.payoutBalance.toFixed(2)} to your connected account?`)){p(!0);try{await no(l.payoutBalance),alert("Cash out initiated! Funds should arrive in your bank account shortly.")}catch(f){alert(f.message)}finally{p(!1)}}}},c=Object.values(x).sort((f,S)=>f.id===h?-1:S.id===h?1:f.price-S.price),k=f=>{const S=(f-1)*100;return S>0?`+${S.toFixed(0)}% Service Fee`:S===0?"0% Service Fee":`-${Math.abs(S).toFixed(0)}% Fee (Discount)`};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 pb-24",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(Ce,{size:32,className:"text-green-500"})," My Wallet"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage tokens, subscriptions, and earnings."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-500/10 rounded-full",children:e.jsx(je,{fill:"currentColor",className:"text-yellow-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Spending Tokens"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:[l.balance.toLocaleString()," TK"]})]})]}),d&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-full",children:e.jsx(Ce,{className:"text-green-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Available USD"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:["$",l.payoutBalance.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 border-b dark:border-gray-700 mb-8 overflow-x-auto",children:[e.jsx("button",{onClick:()=>i("store"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${a==="store"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Token Store"}),e.jsx("button",{onClick:()=>i("plans"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${a==="plans"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Membership Plans"}),d&&e.jsx("button",{onClick:()=>i("earnings"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${a==="earnings"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Earnings & Escrow"})]}),a==="store"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-blue to-purple-600 rounded-2xl p-8 text-white shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10 max-w-lg",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Power Up Your Creativity"}),e.jsx("p",{className:"opacity-90 mb-6",children:"Use tokens to buy beats, presets, booking requests, and more on the SeshFx Marketplace."})]}),e.jsx(je,{size:200,className:"absolute -right-10 -bottom-20 text-white opacity-10 rotate-12 pointer-events-none"})]}),m?e.jsx("div",{className:"text-center py-20",children:e.jsx(K,{className:"animate-spin text-brand-blue mx-auto",size:32})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(f=>e.jsxs("div",{className:`relative bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border transition-all duration-200 hover:-translate-y-1 hover:shadow-xl ${f.highlight?"border-yellow-500 ring-2 ring-yellow-500/20":"dark:border-gray-700"}`,children:[f.highlight&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-yellow-500 text-black text-[10px] font-extrabold px-3 py-1 rounded-full tracking-wide shadow-sm",children:"BEST VALUE"}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-widest mb-2",children:f.label}),e.jsxs("div",{className:"text-5xl font-extrabold dark:text-white flex items-center justify-center gap-1",children:[f.tokens,e.jsx("span",{className:"text-lg font-medium text-gray-400",children:"TK"})]})]}),e.jsx("button",{onClick:()=>u(f),disabled:o,className:`w-full py-3 rounded-xl font-bold flex justify-center items-center gap-2 transition-all ${f.highlight?"bg-yellow-500 text-black hover:bg-yellow-400":"bg-gray-900 dark:bg-white text-white dark:text-black hover:opacity-90"}`,children:o?e.jsx(K,{className:"animate-spin",size:18}):`Buy for $${f.price}`})]},f.id))})]}),a==="plans"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"text-center max-w-2xl mx-auto mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold dark:text-white mb-2",children:"Upgrade Your Workflow"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Unlock lower fees, unlimited bookings, and premium visibility."})]}),m?e.jsx("div",{className:"text-center py-10",children:e.jsx(K,{className:"animate-spin text-brand-blue mx-auto",size:24})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:c.map(f=>{const S=f.id===h;return e.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border flex flex-col ${S?"border-brand-blue ring-1 ring-brand-blue":"dark:border-gray-700"} shadow-sm`,children:[S&&e.jsxs("div",{className:"text-xs font-bold text-brand-blue uppercase tracking-wide mb-2 flex items-center gap-1",children:[e.jsx(ze,{size:12,fill:"currentColor"})," Current Plan"]}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:f.name}),e.jsxs("div",{className:"text-3xl font-extrabold mb-6 dark:text-white",children:["$",f.price,e.jsx("span",{className:"text-sm font-normal text-gray-500",children:"/mo"})]}),e.jsxs("div",{className:"space-y-3 mb-8 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-gray-700 dark:text-gray-200",children:[e.jsx(Ce,{size:16,className:f.feeMultiplier<=1?"text-green-500":"text-gray-400"}),k(f.feeMultiplier)]}),f.features.map((j,C)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx(Je,{size:14,className:"text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:j})]},C))]}),e.jsx("button",{onClick:()=>g(f),className:`w-full py-2.5 rounded-lg font-bold text-sm transition-colors mt-auto ${S?"bg-gray-100 dark:bg-gray-700 text-gray-400 cursor-default":"bg-brand-blue text-white hover:bg-blue-600 shadow-lg shadow-blue-500/20"}`,disabled:S||o,children:S?"Active":o?e.jsx(K,{className:"animate-spin mx-auto"}):"Upgrade"})]},f.id)})})]}),a==="earnings"&&d&&e.jsx("div",{className:"space-y-6 animate-in fade-in duration-300",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg",children:e.jsx(yt,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Escrow Balance"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Funds held for active sessions"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold dark:text-white mb-4",children:["$",l.escrowBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("div",{className:"text-xs bg-orange-50 dark:bg-orange-900/10 text-orange-700 dark:text-orange-300 p-3 rounded-lg flex items-start gap-2",children:[e.jsx(Fe,{size:14,className:"mt-0.5 shrink-0"}),' Funds are released to "Available" 24 hours after a session is successfully completed.']})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border border-green-500/30 shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg",children:e.jsx(Ce,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Available for Payout"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Cleared funds ready to transfer"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold text-green-600 dark:text-green-400 mb-6",children:["$",l.payoutBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx("button",{onClick:y,disabled:o||l.payoutBalance<=0,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-green-500/30 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:shadow-none",children:o?e.jsx(K,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:["Cash Out Now ",e.jsx(Rt,{size:20})]})}),e.jsx("div",{className:"text-[10px] text-center text-gray-400 mt-3",children:"Transfers handled securely via Stripe Connect."})]})]})})]})}function co({user:t}){const[s,a]=r.useState([]),[i,l]=r.useState(""),[n,o]=r.useState([]),[p,x]=r.useState(!1),[b,m]=r.useState("list");r.useEffect(()=>{if(!(t!=null&&t.uid))return;const u=D(P,Z(t.uid).labelRoster(t.uid)),g=ge(u,y=>{a(y.docs.map(c=>({id:c.id,...c.data()})))});return()=>g()},[t==null?void 0:t.uid]);const h=async()=>{if(!(i.length<3)){x(!0);try{const u=me(ls(P,"public_profile"),we("searchTerms","array-contains",i.toLowerCase())),y=(await He(u)).docs.map(c=>({id:c.ref.parent.parent.id,...c.data()})).filter(c=>c.id!==t.uid&&!s.some(k=>k.artistId===c.id));o(y)}catch(u){console.error("Search failed:",u)}x(!1)}},d=async u=>{try{await Ee(D(P,Z(t.uid).labelRoster(t.uid)),{artistId:u.id,name:`${u.firstName} ${u.lastName}`,email:u.email||"N/A",photoURL:u.photoURL||null,signedAt:X(),status:"Active"}),alert(`Signed ${u.firstName} to roster!`),l(""),o([]),m("list")}catch(g){console.error("Signing failed:",g),alert("Failed to add artist.")}},v=async(u,g)=>{if(confirm(`Release ${g} from your roster?`))try{await ct(W(P,Z(t.uid).labelRoster(t.uid),u))}catch(y){console.error(y)}};return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-in fade-in pb-20",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ie,{className:"text-purple-600"})," Label Management"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your artist roster and bookings."})]}),e.jsx("button",{onClick:()=>m(b==="list"?"search":"list"),className:"bg-purple-600 text-white px-5 py-2.5 rounded-xl font-bold hover:bg-purple-700 transition flex items-center gap-2",children:b==="list"?e.jsxs(e.Fragment,{children:[e.jsx(wt,{size:18})," Sign Artist"]}):"Back to Roster"})]}),b==="search"&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm animate-in slide-in-from-top-4",children:[e.jsx("h3",{className:"font-bold dark:text-white mb-4",children:"Find Talent"}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-purple-500 outline-none",placeholder:"Search by name...",value:i,onChange:u=>l(u.target.value),onKeyDown:u=>u.key==="Enter"&&h()})]}),e.jsx("button",{onClick:h,disabled:p,className:"bg-gray-900 dark:bg-white dark:text-black text-white px-6 rounded-xl font-bold",children:p?"...":"Search"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.map(u=>{var g;return e.jsxs("div",{className:"p-4 border dark:border-gray-700 rounded-xl flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:u.photoURL?e.jsx("img",{src:u.photoURL,className:"h-full w-full object-cover"}):e.jsx(Le,{className:"m-2 text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold dark:text-white text-sm",children:[u.firstName," ",u.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:((g=u.accountTypes)==null?void 0:g[0])||"User"})]})]}),e.jsx("button",{onClick:()=>d(u),className:"text-xs bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 px-3 py-1.5 rounded-lg font-bold hover:bg-purple-200",children:"Sign"})]},u.id)}),n.length===0&&i&&!p&&e.jsx("div",{className:"col-span-full text-center text-gray-500 text-sm",children:"No artists found."})]})]}),b==="list"&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-[#23262f] border-b dark:border-gray-700 flex justify-between items-center",children:e.jsxs("span",{className:"font-bold text-sm text-gray-500 uppercase tracking-wide",children:["Current Roster (",s.length,")"]})}),s.length===0?e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx(_e,{size:48,className:"mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No artists signed yet."})]}):e.jsx("div",{className:"divide-y dark:divide-gray-700",children:s.map(u=>{var g;return e.jsxs("div",{className:"p-5 hover:bg-gray-50 dark:hover:bg-white/5 transition flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center text-indigo-600 font-bold text-lg overflow-hidden",children:u.photoURL?e.jsx("img",{src:u.photoURL,className:"h-full w-full object-cover"}):u.name[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:u.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Signed: ",(g=u.signedAt)!=null&&g.toDate?u.signedAt.toDate().toLocaleDateString():"Recent"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 px-2 py-1 rounded text-xs font-bold",children:u.status}),e.jsx("button",{onClick:()=>v(u.id,u.name),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Release Artist",children:e.jsx($e,{size:18})})]})]},u.id)})})]})]})}function xo({user:t,userData:s}){var d,v,u,g,y;const[a,i]=r.useState("overview"),l=(d=s==null?void 0:s.accountTypes)==null?void 0:d.includes("Studio"),n=(v=s==null?void 0:s.accountTypes)==null?void 0:v.some(c=>["Label","Agent"].includes(c)),o=(u=s==null?void 0:s.accountTypes)==null?void 0:u.some(c=>["Artist","Producer","Engineer","DJ"].includes(c)),p=l||n||o,x=[{id:"overview",label:"Overview",icon:e.jsx(ot,{size:18}),available:!0},{id:"studio",label:"Studio Ops",icon:e.jsx(tt,{size:18}),available:l,description:"Manage rooms, rates & amenities"},{id:"distribution",label:"Distribution",icon:e.jsx(Ut,{size:18}),available:p,description:"Release music to streaming platforms"},{id:"roster",label:"Artist Roster",icon:e.jsx(_e,{size:18}),available:n,description:"Manage your signed artists"}].filter(c=>c.available),b=[{label:"Account Type",value:((g=s==null?void 0:s.accountTypes)==null?void 0:g.join(", "))||"User",icon:e.jsx(Hr,{size:16})},{label:"Studio Rooms",value:((y=s==null?void 0:s.rooms)==null?void 0:y.length)||0,icon:e.jsx(tt,{size:16}),show:l},{label:"Releases",value:"—",icon:e.jsx(Gr,{size:16}),show:p},{label:"Roster Artists",value:"—",icon:e.jsx(_e,{size:16}),show:n}].filter(c=>c.show!==!1),m=[{id:"studio",title:"Studio Settings",description:"Configure your studio rooms, rates, and amenities",icon:e.jsx(tt,{className:"text-blue-500"}),color:"blue",show:l},{id:"distribution",title:"New Release",description:"Distribute your music to 150+ streaming platforms",icon:e.jsx(Ut,{className:"text-green-500"}),color:"green",show:p},{id:"roster",title:"Manage Roster",description:"Sign artists and manage your label roster",icon:e.jsx(_e,{className:"text-purple-500"}),color:"purple",show:n}].filter(c=>c.show),h=()=>{switch(a){case"studio":return e.jsx(Gn,{user:t,userData:s});case"distribution":return e.jsx(Ua,{user:t,userData:s});case"roster":return e.jsx(co,{user:t,userData:s});case"overview":default:return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-8 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Business Center"}),e.jsx("p",{className:"text-indigo-100 max-w-xl",children:"Manage your studio operations, distribute music, and grow your roster — all in one place."})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:b.map((c,k)=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-2",children:[c.icon,e.jsx("span",{className:"text-xs font-bold uppercase tracking-wide",children:c.label})]}),e.jsx("div",{className:"text-2xl font-bold dark:text-white",children:c.value})]},k))}),m.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Yr,{size:20,className:"text-gray-400"}),"Quick Actions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:m.map(c=>e.jsxs("button",{onClick:()=>i(c.id),className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all text-left group hover:border-brand-blue dark:hover:border-brand-blue",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-${c.color}-50 dark:bg-${c.color}-900/20 flex items-center justify-center mb-4`,children:c.icon}),e.jsxs("h3",{className:"font-bold dark:text-white mb-1 flex items-center gap-2",children:[c.title,e.jsx(dt,{size:16,className:"text-gray-400 group-hover:text-brand-blue group-hover:translate-x-1 transition-all"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c.description})]},c.id))})]}),m.length===0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ot,{size:32,className:"text-gray-400"})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"No Business Features Enabled"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Upgrade your account to access studio management, music distribution, and label features."}),e.jsx("p",{className:"text-sm text-gray-400",children:'Update your profile to add "Studio", "Artist", "Label", or "Agent" account types.'})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] rounded-xl p-6 border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(Kr,{size:18,className:"text-brand-blue"}),"Coming Soon"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-blue"}),"Advanced Analytics Dashboard"]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-blue"}),"Royalty Management & Splits"]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-blue"}),"Contract Templates"]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-blue"}),"Multi-Artist Collaboration Tools"]})]})]})]})}};return e.jsxs("div",{className:"max-w-7xl mx-auto pb-20",children:[e.jsx("div",{className:"mb-6 bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-1.5 flex flex-wrap gap-1 shadow-sm sticky top-0 z-10",children:x.map(c=>e.jsxs("button",{onClick:()=>i(c.id),className:`
                            flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all
                            ${a===c.id?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}
                        `,children:[c.icon,e.jsx("span",{className:"hidden sm:inline",children:c.label})]},c.id))}),h()]})}function oa({user:t,userData:s}){var i;switch(((i=s==null?void 0:s.accountTypes)==null?void 0:i.find(l=>["Admin","Instructor","Intern"].includes(l)))||"Student"){case"Admin":return e.jsx(Bl,{user:t,userData:s},`admin-${t==null?void 0:t.uid}`);case"Instructor":return e.jsx(Ol,{user:t,userData:s},`staff-${t==null?void 0:t.uid}`);case"Intern":return e.jsx(Fl,{user:t,userData:s},`intern-${t==null?void 0:t.uid}`);default:return e.jsx(Ml,{user:t,userData:s},`student-${t==null?void 0:t.uid}`)}}function go({user:t,userData:s,subProfiles:a,tokenBalance:i,setActiveTab:l,handleLogout:n,openPublicProfile:o,pendingChatTarget:p,clearPendingChatTarget:x}){return e.jsxs(Qr,{children:[e.jsx(ke,{path:"/",element:e.jsx(mi,{user:t,userData:s,subProfiles:a,setActiveTab:l,tokenBalance:i})}),e.jsx(ke,{path:"/dashboard",element:e.jsx(gt,{to:"/",replace:!0})}),e.jsx(ke,{path:"/home",element:e.jsx(gt,{to:"/",replace:!0})}),e.jsx(ke,{path:"/feed",element:e.jsx(wi,{user:t,userData:s,openPublicProfile:o})}),e.jsx(ke,{path:"/social",element:e.jsx(gt,{to:"/feed",replace:!0})}),e.jsx(ke,{path:"/bookings",element:e.jsx(Ti,{user:t,userData:s,openPublicProfile:o})}),e.jsx(ke,{path:"/find-talent",element:e.jsx(gt,{to:"/bookings",replace:!0})}),e.jsx(ke,{path:"/marketplace",element:e.jsx(An,{user:t,userData:s,tokenBalance:i})}),e.jsx(ke,{path:"/messages",element:e.jsx(Ln,{user:t,userData:s,openPublicProfile:o,pendingChatTarget:p,clearPendingChatTarget:x})}),e.jsx(ke,{path:"/tech",element:e.jsx(lo,{user:t,userData:s})}),e.jsx(ke,{path:"/business-center",element:e.jsx(xo,{user:t,userData:s})}),e.jsx(ke,{path:"/studio-ops",element:e.jsx(gt,{to:"/business-center",replace:!0})}),e.jsx(ke,{path:"/studio-manager",element:e.jsx(gt,{to:"/business-center",replace:!0})}),e.jsx(ke,{path:"/label-manager",element:e.jsx(gt,{to:"/business-center",replace:!0})}),e.jsx(ke,{path:"/payments",element:e.jsx(oo,{user:t,userData:s})}),e.jsx(ke,{path:"/profile",element:e.jsx(Xn,{user:t,userData:s,subProfiles:a,handleLogout:n})}),e.jsx(ke,{path:"/settings",element:e.jsx(Ja,{user:t,userData:s,handleLogout:n})}),e.jsx(ke,{path:"/legal",element:e.jsx(Fa,{})}),e.jsx(ke,{path:"/edu",element:e.jsx(oa,{user:t,userData:s})}),e.jsx(ke,{path:"/edu/enroll",element:e.jsx(Tl,{user:t,userData:s})}),e.jsx(ke,{path:"/edu/:view",element:e.jsx(oa,{user:t,userData:s})}),e.jsx(ke,{path:"*",element:e.jsx(gt,{to:"/",replace:!0})})]})}function uo({children:t,className:s=""}){return e.jsx("div",{className:`module-fade-in ${s}`,children:t})}let ms=null,da=!1;const mo=async()=>ms!==null?ms:(da||(da=!0,ms=!1),null),bo=(t,s={},a={})=>{const i={message:(t==null?void 0:t.message)||"Unknown error",stack:t==null?void 0:t.stack,name:t==null?void 0:t.name,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...s,context:a};mo().then(l=>{l&&l.captureException&&l.captureException(t,{extra:i,tags:{component:a.component||"Unknown",errorBoundary:a.errorBoundary||"None"},contexts:{custom:a}})}).catch(()=>{});try{const l=JSON.parse(localStorage.getItem("seshnx_errors")||"[]");l.unshift(i),l.splice(10),localStorage.setItem("seshnx_errors",JSON.stringify(l))}catch{}return i};class ho extends Xr.Component{constructor(a){super(a);cs(this,"handleReset",()=>{if(this.setState({hasError:!1,error:null,errorInfo:null,errorId:null,copied:!1}),this.props.onReset)this.props.onReset();else{const a=window.location.pathname;a!=="/"&&a!=="/dashboard"?window.location.href="/?tab=dashboard":window.location.reload()}});cs(this,"handleCopyError",async()=>{var i,l,n;const a=`
Error ID: ${this.state.errorId}
Message: ${((i=this.state.error)==null?void 0:i.message)||"Unknown error"}
Stack: ${((l=this.state.error)==null?void 0:l.stack)||"No stack trace"}
Component Stack: ${((n=this.state.errorInfo)==null?void 0:n.componentStack)||"No component stack"}
URL: ${window.location.href}
User Agent: ${navigator.userAgent}
Timestamp: ${new Date().toISOString()}
    `.trim();try{await navigator.clipboard.writeText(a),this.setState({copied:!0}),setTimeout(()=>this.setState({copied:!1}),2e3)}catch(o){console.error("Failed to copy error:",o)}});this.state={hasError:!1,error:null,errorInfo:null,meme:"Unexpected signal chain failure.",errorId:null,copied:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a,errorId:`ERR-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}componentDidCatch(a,i){const l={componentStack:i.componentStack,errorBoundary:this.props.name||"Default",props:this.props.context||{}},n=bo(a,i,l);this.setState({errorInfo:{...i,errorId:this.state.errorId||n.timestamp}})}componentDidMount(){const a=["CoreAudio Overload detected.","The plugin crashed the session.","Buffer underrun exception.","Who deleted the master fader?","Sample rate mismatch: Reality is 44.1k, we are 48k.","The drummer kicked the power cable.","Ilok license not found.","Fatal Error: Not enough headroom.","The mix bus is clipping... hard.","Phantom power failure."];this.setState({meme:a[Math.floor(Math.random()*a.length)]})}render(){var a,i;return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-[#1f2128] flex flex-col items-center justify-center p-4 text-center text-white font-sans",children:e.jsxs("div",{className:"bg-[#2c2e36] border border-red-500/30 p-8 rounded-2xl shadow-2xl max-w-lg w-full relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-32 h-32 bg-red-500/20 blur-[50px] rounded-full pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mb-6 text-red-500",children:e.jsx(at,{size:32,strokeWidth:2})}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Session Crashed"}),e.jsxs("p",{className:"text-xl text-[#3D84ED] font-medium mb-6 italic",children:['"',this.state.meme,'"']}),e.jsxs("div",{className:"bg-[#1f2128] p-4 rounded-lg w-full mb-6 text-left border border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider",children:"Error Details"}),e.jsx("button",{onClick:this.handleCopyError,className:"text-xs text-gray-400 hover:text-white flex items-center gap-1 transition-colors",title:"Copy error details",children:this.state.copied?e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:12}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ft,{size:12}),"Copy"]})})]}),e.jsxs("div",{className:"space-y-2",children:[this.state.errorId&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Error ID: "}),e.jsx("code",{className:"text-xs text-blue-400 font-mono",children:this.state.errorId})]}),e.jsx("code",{className:"text-sm text-red-400 font-mono break-words block",children:((a=this.state.error)==null?void 0:a.message)||"Unknown error occurred"}),((i=this.state.error)==null?void 0:i.stack)&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs text-gray-500 cursor-pointer hover:text-gray-400",children:"Stack Trace"}),e.jsx("pre",{className:"text-xs text-gray-400 font-mono mt-2 overflow-auto max-h-32",children:this.state.error.stack})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2",children:"Go Back"}),e.jsxs("button",{onClick:this.handleReset,className:"flex-1 bg-[#3D84ED] hover:bg-blue-600 text-white py-3 px-4 rounded-xl font-bold transition-all shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2",children:[e.jsx(ft,{size:18}),"Reload App"]})]})]})]})}):this.props.children}}function po(){var J,M,L,_;const[t,s]=r.useState(null),[a,i]=r.useState(null),[l,n]=r.useState({}),[o,p]=r.useState(!0),x=Zr(),b=Jr(),h=(()=>{const B=b.pathname;return B==="/"||B==="/dashboard"||B==="/home"?"dashboard":B==="/feed"||B==="/social"?"feed":B==="/bookings"||B==="/find-talent"?"bookings":B.startsWith("/edu")?B==="/edu/enroll"?"edu-enroll":"edu-overview":B.substring(1)||"dashboard"})(),d=B=>{const U={dashboard:"/",home:"/",feed:"/feed",social:"/feed",bookings:"/bookings","find-talent":"/bookings",marketplace:"/marketplace",messages:"/messages",tech:"/tech","business-center":"/business-center","studio-ops":"/business-center","studio-manager":"/business-center","label-manager":"/business-center",payments:"/payments",profile:"/profile",settings:"/settings",legal:"/legal","edu-enroll":"/edu/enroll","edu-overview":"/edu"};if(B.startsWith("edu-"))x(B==="edu-enroll"?"/edu/enroll":`/edu/${B.replace("edu-","")}`);else{const Q=U[B]||"/";x(Q)}},[v,u]=r.useState(!1),[g,y]=r.useState(null),[c,k]=r.useState(0),[N,f]=r.useState(null),[S,j]=r.useState(()=>typeof window<"u"?localStorage.getItem("theme")==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches:!1);r.useEffect(()=>{S?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},[S]);const C=()=>j(!S),R=pl(Gs),E=fl(Gs);r.useEffect(()=>{const B=yl(R,async U=>{if(p(!0),U){s(U);const Q=W(E,`artifacts/${ee}/users/${U.uid}/profiles/main`),xe=ge(Q,ue=>{ue.exists()?i(ue.data()):i(null)}),ye=W(E,`artifacts/${ee}/users/${U.uid}/wallet/account`),pe=ge(ye,ue=>{ue.exists()&&k(ue.data().balance||0)}),ce=D(E,`artifacts/${ee}/users/${U.uid}/profiles`),he=ge(ce,ue=>{const fe={};ue.forEach(O=>{O.id!=="main"&&(fe[O.id]=O.data())}),n(fe)});return p(!1),()=>{xe(),pe(),he()}}else s(null),i(null),n({}),p(!1)});return()=>B()},[]);const w=r.useCallback(()=>Rs(R),[R]);r.useEffect(()=>{if(!t)return;const B=30*60*1e3,U=15*60*1e3,Q="seshnx_last_active";localStorage.getItem(Q)||localStorage.setItem(Q,Date.now().toString());const xe=()=>{localStorage.setItem(Q,Date.now().toString())},ye=()=>{const O=parseInt(localStorage.getItem(Q)||"0",10),ne=Date.now()-O,V=document.hidden?U:B;ne>V&&(console.log(`User inactive for ${(ne/6e4).toFixed(1)}m (Limit: ${V/6e4}m). Logging out...`),w())},pe=["mousedown","mousemove","keydown","scroll","touchstart","click"];let ce=0;const he=()=>{const O=Date.now();O-ce>5e3&&(xe(),ce=O)},ue=()=>{if(!document.hidden){const O=parseInt(localStorage.getItem(Q)||"0",10);Date.now()-O>U?(console.log("Returned after background timeout (>15m). Logging out..."),w()):xe()}};pe.forEach(O=>window.addEventListener(O,he)),document.addEventListener("visibilitychange",ue);const fe=setInterval(ye,60*1e3);return()=>{pe.forEach(O=>window.removeEventListener(O,he)),document.removeEventListener("visibilitychange",ue),clearInterval(fe)}},[t,w]);const z=(B,U)=>y({uid:B,name:U}),A=async B=>{if(t)try{const U=W(E,`artifacts/${ee}/users/${t.uid}/profiles/main`);await te(U,{activeProfileRole:B})}catch(U){console.error("Role switch failed:",U)}};if(o)return e.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]",children:e.jsx(K,{className:"animate-spin text-brand-blue",size:48})});if(!t)return e.jsx(Ys,{darkMode:S,toggleTheme:C});if(t&&!a)return e.jsx(Ys,{user:t,isNewUser:!0,darkMode:S,toggleTheme:C});const G=h.startsWith("edu-")&&(((J=a==null?void 0:a.accountTypes)==null?void 0:J.includes("Admin"))||((M=a==null?void 0:a.accountTypes)==null?void 0:M.includes("Instructor")));return e.jsx(_l,{user:t,userData:a,children:e.jsxs("div",{className:"flex h-screen flex-col bg-gray-50 dark:bg-[#1a1d21] overflow-hidden selection:bg-brand-blue selection:text-white",children:[e.jsx(Dr,{position:"bottom-right",toastOptions:{style:{background:"#333",color:"#fff"},success:{style:{background:"green"},iconTheme:{primary:"white",secondary:"green"}},error:{style:{background:"red"}}}}),e.jsx(Zl,{user:t,userData:a,subProfiles:l,onMenuClick:()=>u(!v),setActiveTab:d,activeTab:h,tokenBalance:c,darkMode:S,toggleTheme:C,onRoleSwitch:A,openPublicProfile:z}),e.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[e.jsx("div",{className:`fixed inset-y-0 left-0 z-50 w-64 transform transition-transform duration-300 ease-in-out md:relative md:translate-x-0 ${v?"translate-x-0 shadow-2xl":"-translate-x-full"} bg-white dark:bg-[#23262f] border-r dark:border-gray-800`,children:G?e.jsx(Dl,{activeTab:h,setActiveTab:d,sidebarOpen:v,setSidebarOpen:u,isStaff:(L=a.accountTypes)==null?void 0:L.includes("Instructor"),isAdmin:(_=a.accountTypes)==null?void 0:_.includes("Admin")}):e.jsx(Jl,{activeTab:h,setActiveTab:d,sidebarOpen:v,setSidebarOpen:u,userData:a,handleLogout:w})}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 scroll-smooth",id:"main-scroll",children:e.jsx(uo,{className:"max-w-7xl mx-auto",children:e.jsx(go,{user:t,userData:a,subProfiles:l,tokenBalance:c,setActiveTab:d,handleLogout:w,openPublicProfile:z,pendingChatTarget:N,clearPendingChatTarget:()=>f(null)})},b.pathname)})]}),e.jsx(nt,{children:g&&e.jsx(ui,{userId:g.uid,currentUser:t,currentUserData:a,onClose:()=>y(null),onMessage:(B,U)=>{y(null),f({uid:B,name:U}),d("messages")}})})]})})}el.createRoot(document.getElementById("root")).render(e.jsx(ho,{name:"Root",children:e.jsx(tl,{client:wl,children:e.jsx(sl,{children:e.jsx(po,{})})})}));const fo=()=>{const t=document.getElementById("loading-fallback");t&&(t.classList.add("fade-out"),setTimeout(()=>{t&&t.parentNode&&t.parentNode.removeChild(t),document.body.style.overflow="auto"},400))};setTimeout(fo,600);
