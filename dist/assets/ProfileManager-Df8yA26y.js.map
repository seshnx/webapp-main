{"version":3,"file":"ProfileManager-Df8yA26y.js","sources":["../../src/components/ProfileManager.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { User, Mail, MapPin, Briefcase, Music, Save, Loader2, DollarSign, Settings, Users, ChevronRight, Check, ToggleLeft, ToggleRight, Camera, Eye, ExternalLink, Image as ImageIcon } from 'lucide-react';\r\nimport { supabase } from '../config/supabase';\r\nimport { useForm, Controller } from 'react-hook-form'; \r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport * as z from 'zod';\r\nimport { clsx } from 'clsx';\r\nimport { twMerge } from 'tailwind-merge';\r\nimport { useImageUpload } from '../hooks/useImageUpload';\r\nimport toast from 'react-hot-toast';\r\nimport SettingsTab from './SettingsTab';\r\nimport { PROFILE_SCHEMAS, GENRE_DATA, INSTRUMENT_DATA } from '../config/constants';\r\nimport { MultiSelect, NestedSelect } from './shared/Inputs';\r\nimport EquipmentAutocomplete from './shared/EquipmentAutocomplete';\r\n\r\n// --- Validation Schemas ---\r\nconst mainProfileSchema = z.object({\r\n    firstName: z.string().min(2, \"First name too short\"),\r\n    lastName: z.string().min(2, \"Last name too short\"),\r\n    displayName: z.string().optional(), \r\n    bio: z.string().max(500, \"Bio exceeds 500 characters\").optional(),\r\n    zip: z.string().regex(/^\\d{5}$/, \"Invalid ZIP code\").optional().or(z.literal('')),\r\n    hourlyRate: z.number().min(0, \"Rate cannot be negative\").optional(),\r\n    website: z.string().url(\"Invalid URL\").optional().or(z.literal('')),\r\n});\r\n\r\nconst getInitials = (first, last, display) => {\r\n    if (display) return display.substring(0, 2).toUpperCase();\r\n    return ((first?.[0] || '') + (last?.[0] || '')).toUpperCase() || 'U';\r\n};\r\n\r\n// Added openPublicProfile to props\r\nexport default function ProfileManager({ user, userData, subProfiles = {}, handleLogout, openPublicProfile }) {\r\n    const [activeSubTab, setActiveSubTab] = useState('details');\r\n    const [selectedRole, setSelectedRole] = useState('Main');\r\n    const [saving, setSaving] = useState(false);\r\n    const { uploadImage, uploading } = useImageUpload();\r\n    const [bannerUploading, setBannerUploading] = useState(false); // New state for banner\r\n\r\n    // Toggle States\r\n    const [useLegalNameOnly, setUseLegalNameOnly] = useState(userData?.useLegalNameOnly || false);\r\n    const [useUserNameOnly, setUseUserNameOnly] = useState(userData?.useUserNameOnly || false);\r\n\r\n    useEffect(() => {\r\n        setUseLegalNameOnly(userData?.useLegalNameOnly || false);\r\n        setUseUserNameOnly(userData?.useUserNameOnly || false);\r\n    }, [userData]);\r\n\r\n    const toggleLegalOnly = () => {\r\n        const newVal = !useLegalNameOnly;\r\n        setUseLegalNameOnly(newVal);\r\n        if (newVal) setUseUserNameOnly(false);\r\n    };\r\n\r\n    const toggleUserOnly = () => {\r\n        const newVal = !useUserNameOnly;\r\n        setUseUserNameOnly(newVal);\r\n        if (newVal) setUseLegalNameOnly(false);\r\n    };\r\n\r\n    const {\r\n        register,\r\n        handleSubmit,\r\n        formState: { errors, isDirty }\r\n    } = useForm({\r\n        resolver: zodResolver(mainProfileSchema),\r\n        defaultValues: {\r\n            firstName: userData?.firstName || '',\r\n            lastName: userData?.lastName || '',\r\n            displayName: userData?.displayName || '',\r\n            bio: userData?.bio || '',\r\n            zip: userData?.zip || '',\r\n            hourlyRate: userData?.hourlyRate || 0,\r\n            website: userData?.website || '',\r\n        }\r\n    });\r\n\r\n    const onMainSubmit = async (data) => {\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving main profile...');\r\n        try {\r\n            let effectiveName = `${data.firstName} ${data.lastName}`;\r\n            if (useLegalNameOnly) effectiveName = `${data.firstName} ${data.lastName}`;\r\n            else if (useUserNameOnly && data.displayName) effectiveName = data.displayName;\r\n            else if (data.displayName) effectiveName = `${data.firstName} \"${data.displayName}\" ${data.lastName}`;\r\n\r\n            const searchTerms = [\r\n                data.firstName.toLowerCase(), \r\n                data.lastName.toLowerCase(), \r\n                (data.displayName || '').toLowerCase(), \r\n                effectiveName.toLowerCase()\r\n            ].filter(Boolean);\r\n\r\n            const userId = user?.id || user?.uid;\r\n            \r\n            if (!supabase) {\r\n                throw new Error('Database unavailable');\r\n            }\r\n\r\n            // Update main profile\r\n            const { error: updateError } = await supabase\r\n                .from('profiles')\r\n                .update({\r\n                    first_name: data.firstName,\r\n                    last_name: data.lastName,\r\n                    display_name: data.displayName || null,\r\n                    bio: data.bio || null,\r\n                    zip: data.zip || null,\r\n                    hourly_rate: data.hourlyRate || null,\r\n                    website: data.website || null,\r\n                    use_legal_name_only: useLegalNameOnly,\r\n                    use_user_name_only: useUserNameOnly,\r\n                    effective_display_name: effectiveName,\r\n                    search_terms: searchTerms,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', userId);\r\n\r\n            if (updateError) {\r\n                throw updateError;\r\n            }\r\n\r\n            // Sync to public profile (if separate table exists, otherwise handled by triggers)\r\n            // Note: In Supabase, you might use database triggers or views for this\r\n            // For now, we'll update the profiles table which serves both purposes\r\n\r\n            toast.success('Profile Updated & Synced!', { id: toastId });\r\n        } catch (error) {\r\n            console.error(\"Update failed\", error);\r\n            const errorMessage = error?.message || \"Failed to update profile.\";\r\n            toast.error(errorMessage, { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handlePhotoUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        const toastId = toast.loading('Uploading photo...');\r\n        try {\r\n            const url = await uploadImage(file, `users/${userId}/avatars`);\r\n            \r\n            const { error: updateError } = await supabase\r\n                .from('profiles')\r\n                .update({ avatar_url: url, updated_at: new Date().toISOString() })\r\n                .eq('id', userId);\r\n            \r\n            if (updateError) {\r\n                throw updateError;\r\n            }\r\n            \r\n            toast.success('Photo updated!', { id: toastId });\r\n        } catch (err) {\r\n            console.error(err);\r\n            const errorMessage = err?.message || 'Photo upload failed';\r\n            toast.error(errorMessage, { id: toastId });\r\n        }\r\n    };\r\n\r\n    // --- NEW: Handle Banner Upload ---\r\n    const handleBannerUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        setBannerUploading(true);\r\n        const toastId = toast.loading('Uploading cover banner...');\r\n        try {\r\n            // Use same path structure as PublicProfileModal\r\n            const url = await uploadImage(file, `users/${userId}/images/banners`);\r\n            \r\n            const { error: updateError } = await supabase\r\n                .from('profiles')\r\n                .update({ banner_url: url, updated_at: new Date().toISOString() })\r\n                .eq('id', userId);\r\n\r\n            if (updateError) {\r\n                throw updateError;\r\n            }\r\n\r\n            toast.success('Cover banner updated!', { id: toastId });\r\n        } catch (err) {\r\n            console.error(err);\r\n            const errorMessage = err?.message || 'Banner upload failed';\r\n            toast.error(errorMessage, { id: toastId });\r\n        } finally {\r\n            setBannerUploading(false);\r\n        }\r\n    };\r\n\r\n    const handleSettingsUpdate = async (newSettings) => {\r\n        if (!supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const { error: updateError } = await supabase\r\n                .from('profiles')\r\n                .update({ settings: newSettings, updated_at: new Date().toISOString() })\r\n                .eq('id', userId);\r\n            \r\n            if (updateError) {\r\n                throw updateError;\r\n            }\r\n            \r\n            toast.success(\"Settings saved.\");\r\n        } catch (error) {\r\n            console.error(\"Settings save failed\", error);\r\n            const errorMessage = error?.message || \"Failed to save settings.\";\r\n            toast.error(errorMessage);\r\n        }\r\n    };\r\n\r\n    const inputClass = (error) => twMerge(\r\n        \"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none\",\r\n        error ? \"border-red-500 bg-red-50 dark:bg-red-900/10\" : \"border-gray-200 dark:border-gray-700\"\r\n    );\r\n\r\n    return (\r\n        <div className=\"max-w-5xl mx-auto space-y-6 pb-20\">\r\n            {/* Top Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                <h1 className=\"text-3xl font-bold dark:text-white flex items-center gap-2\">\r\n                    <User className=\"text-brand-blue\"/> {activeSubTab === 'details' ? 'Edit Profile' : 'Account Settings'}\r\n                </h1>\r\n                \r\n                <div className=\"flex gap-3 self-end\">\r\n                    {/* NEW: View Public Profile Button */}\r\n                    <button \r\n                        onClick={() => openPublicProfile(user?.id || user?.uid)} \r\n                        className=\"bg-gray-900 dark:bg-white text-white dark:text-black px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 hover:opacity-90 transition shadow-lg\"\r\n                    >\r\n                        <Eye size={16}/> View Public Profile\r\n                    </button>\r\n\r\n                    <div className=\"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex gap-1\">\r\n                        <button onClick={() => setActiveSubTab('details')} className={`px-4 py-2 text-xs font-bold rounded-md transition-all ${activeSubTab === 'details' ? 'bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm' : 'text-gray-500 hover:text-gray-900 dark:hover:text-gray-300'}`}>Edit Details</button>\r\n                        <button onClick={() => setActiveSubTab('settings')} className={`px-4 py-2 text-xs font-bold rounded-md transition-all flex items-center gap-1 ${activeSubTab === 'settings' ? 'bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm' : 'text-gray-500 hover:text-gray-900 dark:hover:text-gray-300'}`}><Settings size={14}/> Settings</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content Area */}\r\n            {activeSubTab === 'details' ? (\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-8 animate-in fade-in slide-in-from-bottom-2\">\r\n                    {/* Left Sidebar */}\r\n                    <div className=\"lg:col-span-1 space-y-2\">\r\n                        <div className=\"font-bold text-xs text-gray-500 uppercase tracking-wider mb-2 px-1\">Profiles</div>\r\n                        <button onClick={() => setSelectedRole('Main')} className={`w-full flex items-center justify-between p-3 rounded-xl transition-all ${selectedRole === 'Main' ? 'bg-brand-blue text-white shadow-md' : 'bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200'}`}><div className=\"flex items-center gap-2\"><User size={16}/> <span className=\"font-bold text-sm\">Main Profile</span></div>{selectedRole === 'Main' && <ChevronRight size={16}/>}</button>\r\n                        {(userData?.accountTypes || []).map(role => {\r\n                            if (!PROFILE_SCHEMAS[role]) return null;\r\n                            return <button key={role} onClick={() => setSelectedRole(role)} className={`w-full flex items-center justify-between p-3 rounded-xl transition-all ${selectedRole === role ? 'bg-brand-blue text-white shadow-md' : 'bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200'}`}><div className=\"flex items-center gap-2\"><Briefcase size={16}/> <span className=\"font-bold text-sm\">{role}</span></div>{selectedRole === role && <ChevronRight size={16}/>}</button>;\r\n                        })}\r\n                    </div>\r\n\r\n                    {/* Right Column */}\r\n                    <div className=\"lg:col-span-3\">\r\n                        {selectedRole === 'Main' ? (\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n                                <div className=\"md:col-span-1 space-y-6\">\r\n                                    {/* Avatar Upload */}\r\n                                    <div className=\"space-y-2\">\r\n                                        <div className=\"text-xs font-bold text-gray-500 uppercase\">Profile Photo</div>\r\n                                        <div className=\"relative group w-full aspect-square rounded-full overflow-hidden bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-700 shadow-md\">\r\n                                            {userData?.photoURL ? <img src={userData.photoURL} alt=\"Profile\" className=\"w-full h-full object-cover\" /> : <div className=\"flex items-center justify-center h-full bg-gradient-to-tr from-brand-blue to-purple-500 text-white font-bold text-4xl\">{getInitials(userData?.firstName, userData?.lastName, userData?.displayName)}</div>}\r\n                                            <label className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity\"><span className=\"text-white font-bold text-sm flex items-center gap-1\"><Camera size={16}/> Change</span><input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handlePhotoUpload} disabled={uploading} /></label>\r\n                                            {uploading && <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\"><Loader2 className=\"animate-spin text-white\"/></div>}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* NEW: Banner Upload */}\r\n                                    <div className=\"space-y-2\">\r\n                                        <div className=\"text-xs font-bold text-gray-500 uppercase\">Cover Banner</div>\r\n                                        <div className=\"relative group w-full aspect-[3/1] rounded-xl overflow-hidden bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-700 shadow-sm\">\r\n                                            {userData?.bannerURL ? (\r\n                                                <img src={userData.bannerURL} alt=\"Banner\" className=\"w-full h-full object-cover\" />\r\n                                            ) : (\r\n                                                <div className=\"w-full h-full flex items-center justify-center text-gray-400\">\r\n                                                    <ImageIcon size={24}/>\r\n                                                </div>\r\n                                            )}\r\n                                            <label className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity\">\r\n                                                <span className=\"text-white font-bold text-xs flex items-center gap-1\"><Camera size={14}/> Upload Cover</span>\r\n                                                <input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleBannerUpload} disabled={bannerUploading} />\r\n                                            </label>\r\n                                            {bannerUploading && <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\"><Loader2 className=\"animate-spin text-white\"/></div>}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl text-xs text-blue-800 dark:text-blue-200\"><p className=\"font-bold mb-1\">Pro Tip:</p>High-quality profile photos & banners increase booking rates by 40%.</div>\r\n                                </div>\r\n\r\n                                <div className=\"md:col-span-2\">\r\n                                    <form onSubmit={handleSubmit(onMainSubmit)} className=\"space-y-6 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm\">\r\n                                        <div className=\"grid grid-cols-2 gap-4\">\r\n                                            <div><label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">First Name (Legal)</label><input {...register(\"firstName\")} className={inputClass(errors.firstName)} /></div>\r\n                                            <div><label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Last Name (Legal)</label><input {...register(\"lastName\")} className={inputClass(errors.lastName)} /></div>\r\n                                        </div>\r\n                                        <div><label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">User Name (Display Name)</label><input {...register(\"displayName\")} className={inputClass(errors.displayName)} placeholder=\"e.g. SeshMaster\" /></div>\r\n                                        \r\n                                        {/* Name Toggle Logic */}\r\n                                        <div className=\"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3\">\r\n                                            <label className=\"text-xs font-bold text-gray-500 uppercase block mb-1\">Display Name Preferences</label>\r\n                                            <div className=\"flex items-center justify-between\"><span className=\"text-sm dark:text-gray-200\">Use Legal Name Only</span><button type=\"button\" onClick={toggleLegalOnly} className=\"text-brand-blue\">{useLegalNameOnly ? <ToggleRight size={28} /> : <ToggleLeft size={28} className=\"text-gray-400\"/>}</button></div>\r\n                                            <div className=\"flex items-center justify-between\"><span className=\"text-sm dark:text-gray-200\">Use User Name Only</span><button type=\"button\" onClick={toggleUserOnly} className=\"text-brand-blue\">{useUserNameOnly ? <ToggleRight size={28} /> : <ToggleLeft size={28} className=\"text-gray-400\"/>}</button></div>\r\n                                            <div className=\"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2\">Preview: <strong className=\"text-brand-blue\">{useLegalNameOnly ? `${userData?.firstName || ''} ${userData?.lastName || ''}`.trim() || 'Not Set' : useUserNameOnly ? (userData?.displayName || 'Not Set') : `${userData?.firstName || ''} \"${userData?.displayName || 'User'}\" ${userData?.lastName || ''}`.trim() || 'Not Set'}</strong></div>\r\n                                        </div>\r\n\r\n                                        <div><label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Bio / About</label><textarea {...register(\"bio\")} rows=\"4\" className={inputClass(errors.bio)} placeholder=\"Tell us about your musical journey...\" /></div>\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                            <div><label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1\"><MapPin size={12}/> ZIP Code</label><input {...register(\"zip\")} className={inputClass(errors.zip)} /></div>\r\n                                            <div><label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1\"><DollarSign size={12}/> Hourly Rate ($)</label><input type=\"number\" {...register(\"hourlyRate\", { valueAsNumber: true })} className={inputClass(errors.hourlyRate)} /></div>\r\n                                        </div>\r\n                                        <div><label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Website</label><input {...register(\"website\")} className={inputClass(errors.website)} placeholder=\"https://...\" /></div>\r\n\r\n                                        <div className=\"pt-4 border-t dark:border-gray-700 flex justify-end\">\r\n                                            <button type=\"button\" onClick={handleSubmit(onMainSubmit)} disabled={saving} className={clsx(\"px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg\", saving ? \"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed\" : \"bg-brand-blue text-white hover:bg-blue-600 hover:scale-105\")}>{saving ? <Loader2 className=\"animate-spin\" size={20}/> : <><Save size={20}/> Save Changes</>}</button>\r\n                                        </div>\r\n                                    </form>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <DynamicSubProfileForm user={user} userData={userData} role={selectedRole} initialData={subProfiles[selectedRole] || {}} schema={PROFILE_SCHEMAS[selectedRole] || []}/>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <div className=\"animate-in fade-in slide-in-from-right-2\"><SettingsTab user={user} userData={userData} handleLogout={handleLogout} onUpdate={handleSettingsUpdate}/></div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n// ... (DynamicSubProfileForm remains unchanged from previous version) ...\r\nfunction DynamicSubProfileForm({ user, userData, role, initialData, schema }) {\r\n    const [formData, setFormData] = useState(initialData);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [followMainProfile, setFollowMainProfile] = useState(initialData.followMainProfile ?? true);\r\n    const [useLegalNameOnly, setUseLegalNameOnly] = useState(initialData.useLegalNameOnly ?? false);\r\n    const [useUserNameOnly, setUseUserNameOnly] = useState(initialData.useUserNameOnly ?? false);\r\n    const [syncStudioOps, setSyncStudioOps] = useState(initialData.syncStudioOps ?? false);\r\n\r\n    useEffect(() => { \r\n        setFormData(initialData || {}); \r\n        setFollowMainProfile(initialData.followMainProfile ?? true);\r\n        setUseLegalNameOnly(initialData.useLegalNameOnly ?? false);\r\n        setUseUserNameOnly(initialData.useUserNameOnly ?? false);\r\n        setSyncStudioOps(initialData.syncStudioOps ?? false);\r\n    }, [initialData]);\r\n\r\n    const handleChange = (key, value) => setFormData(prev => ({ ...prev, [key]: value }));\r\n    const toggleLegalOnly = () => { setUseLegalNameOnly(!useLegalNameOnly); if(!useLegalNameOnly) setUseUserNameOnly(false); };\r\n    const toggleUserOnly = () => { setUseUserNameOnly(!useUserNameOnly); if(!useUserNameOnly) setUseLegalNameOnly(false); };\r\n\r\n    const handleSave = async (e) => {\r\n        e.preventDefault();\r\n        setIsSaving(true);\r\n        const toastId = toast.loading(`Saving ${role} profile...`);\r\n        try {\r\n            let effectiveName = '';\r\n            if (followMainProfile) effectiveName = userData?.effectiveDisplayName || (userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() : '');\r\n            else {\r\n                if (useLegalNameOnly) effectiveName = userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() : '';\r\n                else if (useUserNameOnly) effectiveName = userData?.displayName || (userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() : ''); \r\n                else effectiveName = formData.profileName || `${userData.firstName} ${userData.lastName}`;\r\n            }\r\n\r\n            const userId = user?.id || user?.uid;\r\n            \r\n            if (!supabase) {\r\n                throw new Error('Database unavailable');\r\n            }\r\n\r\n            // Save sub-profile data (assuming sub_profiles table or JSONB column)\r\n            // Note: This depends on your Supabase schema - you may need to adjust\r\n            const dataToSave = { ...formData, followMainProfile, useLegalNameOnly, useUserNameOnly, syncStudioOps, displayName: effectiveName };\r\n            \r\n            // Update sub-profiles (assuming a sub_profiles table or profiles.sub_profiles JSONB)\r\n            const { error: upsertError } = await supabase\r\n                .from('sub_profiles')\r\n                .upsert({\r\n                    user_id: userId,\r\n                    role: role,\r\n                    ...dataToSave\r\n                }, {\r\n                    onConflict: 'user_id,role'\r\n                });\r\n            \r\n            if (upsertError) {\r\n                throw upsertError;\r\n            }\r\n            \r\n            if (userData.activeProfileRole === role) {\r\n                const { error: profileError } = await supabase\r\n                    .from('profiles')\r\n                    .update({ \r\n                        display_name: effectiveName,\r\n                        effective_display_name: effectiveName,\r\n                        search_terms: [effectiveName.toLowerCase()],\r\n                        updated_at: new Date().toISOString()\r\n                    })\r\n                    .eq('id', userId);\r\n                \r\n                if (profileError) {\r\n                    throw profileError;\r\n                }\r\n            }\r\n            if (role === 'Studio' && syncStudioOps) {\r\n                const { error: studioError } = await supabase\r\n                    .from('profiles')\r\n                    .update({ \r\n                        studio_name: effectiveName,\r\n                        updated_at: new Date().toISOString()\r\n                    })\r\n                    .eq('id', userId);\r\n                \r\n                if (studioError) {\r\n                    throw studioError;\r\n                }\r\n            }\r\n            toast.success(`${role} Profile Saved!`, { id: toastId });\r\n        } catch (err) { \r\n            console.error(err); \r\n            const errorMessage = err?.message || \"Failed to save.\";\r\n            toast.error(errorMessage, { id: toastId }); \r\n        } \r\n        finally { setIsSaving(false); }\r\n    };\r\n\r\n    if (schema.length === 0) return <div className=\"p-10 text-center text-gray-500\">No configuration available for this role.</div>;\r\n    \r\n    const currentSubRole = formData.talentSubRole || '';\r\n    const filteredSchema = schema.filter(f => {\r\n        if (f.key === 'profileName' || f.key === 'useRealName') return false;\r\n        if (f.showFor && Array.isArray(f.showFor)) {\r\n            return f.showFor.includes(currentSubRole);\r\n        }\r\n        return true;\r\n    });\r\n\r\n    return (\r\n        <form onSubmit={handleSave} className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-6\">\r\n            <h2 className=\"text-xl font-bold dark:text-white border-b dark:border-gray-700 pb-2\">{role} Identity & Details</h2>\r\n            \r\n            <div className=\"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3\">\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase block mb-1\">Identity Settings</label>\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div><div className=\"text-sm font-bold dark:text-white\">Follow Main Profile Name</div><div className=\"text-xs text-gray-500\">Use \"{userData.effectiveDisplayName || `${userData.firstName} ${userData.lastName}`}\"</div></div>\r\n                    <button type=\"button\" onClick={() => setFollowMainProfile(!followMainProfile)} className=\"text-brand-blue\">{followMainProfile ? <ToggleRight size={28} /> : <ToggleLeft size={28} className=\"text-gray-400\"/>}</button>\r\n                </div>\r\n                {!followMainProfile && (\r\n                    <div className=\"space-y-3 animate-in slide-in-from-top-1 pt-3 border-t dark:border-gray-700\">\r\n                         <div className=\"flex items-center justify-between\"><span className=\"text-sm dark:text-gray-200\">Use Legal Name Only</span><button type=\"button\" onClick={toggleLegalOnly} className=\"text-brand-blue\">{useLegalNameOnly ? <ToggleRight size={28} /> : <ToggleLeft size={28} className=\"text-gray-400\"/>}</button></div>\r\n                        <div className=\"flex items-center justify-between\"><span className=\"text-sm dark:text-gray-200\">Use Main User Name Only</span><button type=\"button\" onClick={toggleUserOnly} className=\"text-brand-blue\">{useUserNameOnly ? <ToggleRight size={28} /> : <ToggleLeft size={28} className=\"text-gray-400\"/>}</button></div>\r\n                        {!useLegalNameOnly && !useUserNameOnly && (\r\n                            <div className=\"mt-2\">\r\n                                <label className=\"text-xs font-bold text-brand-blue uppercase mb-1 block\">{role} Name</label>\r\n                                <input type=\"text\" className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none font-bold\" placeholder={`e.g. ${role === 'Studio' ? 'Sound City' : 'The Weeknd'}`} value={formData.profileName || ''} onChange={e => handleChange('profileName', e.target.value)} />\r\n                                {role === 'Studio' && (<div className=\"flex items-center gap-2 mt-2\"><input type=\"checkbox\" checked={syncStudioOps} onChange={(e) => setSyncStudioOps(e.target.checked)} className=\"rounded text-brand-blue focus:ring-brand-blue\"/><span className=\"text-xs text-gray-500 dark:text-gray-400\">Force \"Studio Ops\" to use this name</span></div>)}\r\n                            </div>\r\n                        )}\r\n                         <div className=\"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2\">Preview: <strong className=\"text-brand-blue\">{useLegalNameOnly ? `${userData.firstName} ${userData.lastName}` : useUserNameOnly ? (userData.displayName || 'Not Set') : (formData.profileName || 'Not Set')}</strong></div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {filteredSchema.map((field) => {\r\n                if (field.isToggle) return null; \r\n                return (\r\n                    <div key={field.key}>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">{field.label}</label>\r\n                        {field.type === 'textarea' ? (\r\n                            <textarea className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none\" rows={4} value={formData[field.key] || ''} onChange={e => handleChange(field.key, e.target.value)} />\r\n                        ) : field.type === 'select' ? (\r\n                            <select className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none\" value={formData[field.key] || ''} onChange={e => handleChange(field.key, e.target.value)}>{field.options?.map(opt => <option key={opt} value={opt}>{opt}</option>)}</select>\r\n                        ) : field.type === 'multi_select' ? (\r\n                            <MultiSelect label=\"\" fieldKey={field.key} options={field.data || field.options || []} initialValues={formData[field.key] || []} onChange={handleChange} />\r\n                        ) : field.type === 'nested_select' ? (\r\n                            <NestedSelect label=\"\" fieldKey={field.key} data={field.data} initialValues={formData[field.key] || []} onChange={handleChange} />\r\n                        ) : field.key === 'equipment' ? (\r\n                                <EquipmentAutocomplete \r\n                                    multi={true} \r\n                                    value={formData[field.key] || ''} \r\n                                    onChange={(val) => handleChange(field.key, val)}\r\n                                    placeholder=\"Add gear...\" \r\n                                />\r\n                        ) : (\r\n                            <input type={field.type === 'number' ? 'number' : 'text'} className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none\" value={formData[field.key] || ''} onChange={e => handleChange(field.key, e.target.value)} />\r\n                        )}\r\n                    </div>\r\n                );\r\n            })}\r\n\r\n            <div className=\"pt-4 border-t dark:border-gray-700 flex justify-end\">\r\n                <button type=\"submit\" disabled={isSaving} className=\"px-8 py-3 rounded-xl font-bold bg-brand-blue text-white hover:bg-blue-600 flex items-center gap-2 transition shadow-lg disabled:opacity-50\">{isSaving ? <Loader2 className=\"animate-spin\" size={20}/> : <><Save size={20}/> Save {role} Profile</>}</button>\r\n            </div>\r\n        </form>\r\n    );\r\n}\r\n"],"names":["mainProfileSchema","z.object","z.string","z.literal","z.number","getInitials","first","last","display","ProfileManager","user","userData","subProfiles","handleLogout","openPublicProfile","activeSubTab","setActiveSubTab","useState","selectedRole","setSelectedRole","saving","setSaving","uploading","useImageUpload","bannerUploading","setBannerUploading","useLegalNameOnly","setUseLegalNameOnly","useUserNameOnly","setUseUserNameOnly","useEffect","toggleLegalOnly","newVal","toggleUserOnly","register","handleSubmit","errors","isDirty","useForm","zodResolver","onMainSubmit","data","toastId","toast","effectiveName","searchTerms","userId","supabase","updateError","error","errorMessage","handlePhotoUpload","e","handleBannerUpload","handleSettingsUpdate","newSettings","inputClass","twMerge","jsxs","jsx","User","Eye","Settings","ChevronRight","role","PROFILE_SCHEMAS","Briefcase","Camera","Loader2","ImageIcon","ToggleRight","ToggleLeft","MapPin","DollarSign","clsx","Fragment","Save","DynamicSubProfileForm","SettingsTab","initialData","schema","formData","setFormData","isSaving","setIsSaving","followMainProfile","setFollowMainProfile","syncStudioOps","setSyncStudioOps","handleChange","key","value","prev","handleSave","dataToSave","upsertError","profileError","studioError","err","currentSubRole","filteredSchema","f","field","_a","opt","MultiSelect","NestedSelect","EquipmentAutocomplete","val"],"mappings":"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"}