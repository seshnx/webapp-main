import{t as Ye,c as Re,j as e,U as ye,a as Ke,b as it,d as ot,C as ct,r as a,u as se,e as Te,f as _e,T as $e,P as ke,A as Je,X as Y,L as xe,g as Xe,S as Ne,h as Ge,i as dt,k as ut,V as ve,l as Ze,m as je,n as et,o as tt,F as xt,p as mt,I as ft,q as ht,M as gt,s as bt,v as pt,R as yt,E as jt,w as De,x as wt,y as Nt,z as we,D as Ce,B as vt,G as Me,H as kt,J as St,K as Rt,N as Pe,O as ze,Q as $t,W as Ue,Y as Oe,Z as Mt,_ as zt,$ as At}from"./vendor-DyN93z3-.js";import{g as Ft,i as It,a as Et,b as Lt,p as Tt,c as Gt,d as Ct,e as _t,f as Dt,r as Pt,u as Ut,h as Ot,q as Ae,w as oe,j as Be,k as qe,l as Bt,m as ne,s as qt,n as Wt,o as ge,t as Vt,v as Ht,x as Qt,y as Yt,z as Kt,A as We,B as Jt,C as Xt,D as Zt,E as es,F as ts}from"./vendor-firebase-DCUk-xrl.js";import{m as U,A as ue}from"./vendor-framer-D4Wnt9qz.js";const ce={apiKey:"AIzaSyCRRmP9lfWF2hWdquNmo1t-x5Pjz-l6idM",authDomain:"auth.seshnx.net",databaseURL:"https://seshnx-db-default-rtdb.firebaseio.com",projectId:"seshnx-70c04",storageBucket:"seshnx-70c04.firebasestorage.app",messagingSenderId:"98272119648",appId:"1:98272119648:web:ff6d186adf94a03fe0ac05",measurementId:"G-7SP53NK9FM"};ce.databaseURL||(ce.databaseURL="https://seshnx-db-default-rtdb.firebaseio.com");let Fe=null;try{Fe=Ft()}catch{Fe=null}const he=Fe||It(ce),$s=Et(he);let Ie;try{Ie=Lt(he,{localCache:Tt({tabManager:Gt()})})}catch{Ie=Ct(he)}const fe=Ie;let Ee=null,st=null;const ss=()=>{const t=ce.databaseURL;if(!t||t.trim()==="")return null;try{return Dt(he)||null}catch{return null}};st=ss();if(ce.storageBucket&&ce.storageBucket.trim()!=="")try{Ee=_t(he)}catch{Ee=null}const Ve=Ee,Q=st,L=ce.projectId,rs=t=>({userProfile:`artifacts/${L}/users/${t}/profiles/main`,userSubProfile:r=>`artifacts/${L}/users/${t}/profiles/${r}`,userPublicProfile:`artifacts/${L}/users/${t}/public_profile/main`,publicProfileCollectionGroup:"public_profile",publicFeed:`artifacts/${L}/public/data/posts`,serviceRequests:`artifacts/${L}/public/data/service_requests`,messages:`artifacts/${L}/public/data/direct_messages`,marketplaceItems:`artifacts/${L}/public/data/market_items`,userLibrary:`artifacts/${L}/users/${t}/library`,marketAssets:`artifacts/${L}/users/${t}/assets/market`,userWallet:`artifacts/${L}/users/${t}/wallet/account`,profileImages:`artifacts/${L}/users/${t}/images/profile`,equipmentSubmissions:`artifacts/${L}/public/data/equipment_submissions`,studentRecord:(r,s)=>`schools/${r}/students/${s}`,distributionReleases:`artifacts/${L}/distribution/${t}/releases`,royaltyReports:`artifacts/${L}/distribution/${t}/royalty_reports`,distributionStats:`artifacts/${L}/distribution/${t}/stats/main`,labelRoster:r=>`artifacts/${L}/labels/${r}/roster`,labelInvites:r=>`artifacts/${L}/labels/${r}/invites`,gearListings:`artifacts/${L}/public/data/gear_listings`,followers:`artifacts/${L}/users/${t}/followers`,following:`artifacts/${L}/users/${t}/following`,socialStats:`artifacts/${L}/users/${t}/stats/social`,notifications:`artifacts/${L}/users/${t}/notifications`,savedPosts:`artifacts/${L}/users/${t}/savedPosts`}),as=t=>{if(!t)return"";const r=t.trim().split(" ");return r.length>=2?(r[0][0]+r[1][0]).toUpperCase():t.substring(0,2).toUpperCase()};function me({src:t,name:r,size:s="md",className:l,onClick:u,status:i,isGroup:p=!1,square:h=!1}){const x=Ye(Re("relative overflow-hidden flex items-center justify-center shrink-0 bg-gray-200 dark:bg-gray-700 border border-transparent transition-all select-none",h?"rounded-xl":"rounded-full",{xs:"h-6 w-6 text-[10px]",sm:"h-8 w-8 text-xs",md:"h-10 w-10 text-sm",lg:"h-12 w-12 text-base",xl:"h-14 w-14 text-lg","2xl":"h-24 w-24 text-2xl","3xl":"h-32 w-32 text-4xl"}[s],u&&"cursor-pointer hover:opacity-90",l));return e.jsxs("div",{className:x,onClick:u,children:[t?e.jsx("img",{src:t,alt:r||"Avatar",className:"h-full w-full object-cover",onError:w=>w.target.style.display="none"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gradient-to-br from-brand-blue to-purple-600 text-white font-bold",children:p?e.jsx(ye,{className:"w-1/2 h-1/2"}):r?as(r):e.jsx(Ke,{className:"w-1/2 h-1/2"})}),i&&e.jsx("span",{className:Re("absolute bottom-0 right-0 rounded-full border-2 border-white dark:border-gray-900",i==="online"?"bg-green-500":"bg-gray-400",s==="xs"||s==="sm"?"h-2 w-2":"h-3.5 w-3.5")})]})}const X=ot;it();const Le="http://127.0.0.1:3210",rt=Le.trim()!==""?Le.trim():"https://placeholder.convex.cloud",Ms=new ct(rt),re=()=>Le.trim()!==""&&rt!=="https://placeholder.convex.cloud";function Se({title:t,value:r,icon:s,sub:l,bg:u="bg-white dark:bg-[#2c2e36]",text:i="text-gray-900 dark:text-white"}){return e.jsxs("div",{className:`${u} p-5 rounded-xl border border-gray-100 dark:border-gray-700 shadow-sm flex flex-col justify-between h-28`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-medium ${i==="text-white"?"text-blue-100":"text-gray-500"}`,children:t}),e.jsx("div",{className:`text-2xl font-extrabold ${i}`,children:r})]}),e.jsx("div",{className:"opacity-80",children:s})]}),l&&e.jsx("div",{className:"text-xs mt-auto opacity-75",children:l})]})}const ls=()=>{const[t,r]=a.useState(!1),[s,l]=a.useState(null);return{uploadMedia:async(i,p)=>{if(!i)return null;if(!Ve)return l("Firebase Storage is not configured. Please set VITE_FIREBASE_STORAGE_BUCKET in your environment variables."),console.error("Firebase Storage is not available. storageBucket is missing from Firebase config."),null;r(!0),l(null);try{const b=`${Date.now()}_${i.name.replace(/[^a-zA-Z0-9.]/g,"_")}`,x=`${p}/${b}`,w=Pt(Ve,x),k=await Ut(w,i),d=await Ot(k.ref);return r(!1),{url:d,type:i.type.startsWith("video/")?"video":i.type.startsWith("audio/")?"audio":"image",name:i.name}}catch(h){return console.error("Upload failed:",h),l(h),r(!1),null}},uploading:t,error:s}};function zs(t){const r=a.useRef(!1),s=se(X.presence.updatePresence);a.useEffect(()=>{if(!t||!re())return;s({userId:t,online:!0,lastSeen:Date.now()}).then(()=>{r.current=!0}).catch(u=>{console.error("Presence online error:",u)});const l=setInterval(()=>{r.current&&s({userId:t,online:!0,lastSeen:Date.now()}).catch(console.error)},3e4);return()=>{clearInterval(l),r.current&&(s({userId:t,online:!1,lastSeen:Date.now()}).catch(console.error),r.current=!1)}},[t])}function at(t){const r=a.useMemo(()=>re(),[]),s=a.useMemo(()=>t&&r?{userId:t}:"skip",[t,r]),l=Te(X.presence.getPresence,s);return l?{online:l.online===!0,lastSeen:l.lastSeen,loading:!1}:{online:!1,lastSeen:null,loading:!re()}}function ns(t){if(!t)return"Never";const r=t,l=Date.now()-r,u=Math.floor(l/6e4),i=Math.floor(u/60),p=Math.floor(i/24);return u<1?"Just now":u<60?`${u}m ago`:i<24?`${i}h ago`:p<7?`${p}d ago`:new Date(r).toLocaleDateString()}function lt({online:t,lastSeen:r,showText:s=!1,size:l="sm"}){const u={xs:"w-1.5 h-1.5",sm:"w-2 h-2",md:"w-2.5 h-2.5"},i={xs:"text-[10px]",sm:"text-xs",md:"text-sm"};return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:`${u[l]} ${t?"fill-green-500 text-green-500":"fill-gray-400 text-gray-400"}`}),t&&e.jsx("div",{className:"absolute inset-0 animate-ping",children:e.jsx(_e,{className:`${u[l]} fill-green-500 opacity-75`})})]}),s&&e.jsx("span",{className:`${i[l]} ${t?"text-green-500":"text-gray-400"} font-medium`,children:t?"Online":ns(r)})]})}function is({conversation:t,activeChat:r,currentUserId:s,onSelect:l,onDelete:u}){const i=t.type==="direct"?t.uid||(t.id.includes("_")?t.id.split("_").find(b=>b!==s):null):null,{online:p,lastSeen:h}=at(i||"");return e.jsxs("div",{onClick:()=>l(t),className:`group relative flex gap-3 p-4 cursor-pointer transition border-b dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-white/5 ${(r==null?void 0:r.id)===t.id?"bg-blue-50 dark:bg-blue-900/10 border-l-4 border-l-brand-blue":""}`,children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx(me,{src:t.photo,name:t.n,size:"lg",isGroup:t.type==="group"}),t.type==="direct"&&i&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5",children:e.jsx(lt,{online:p,lastSeen:h,size:"xs"})}),t.uc>0&&e.jsx("div",{className:"absolute -top-1 -right-1 h-5 w-5 bg-brand-blue text-white text-[10px] font-bold flex items-center justify-center rounded-full border-2 border-white dark:border-[#2c2e36]",children:t.uc>99?"99+":t.uc})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h4",{className:`text-sm truncate ${t.uc>0?"font-extrabold text-gray-900 dark:text-white":"font-bold text-gray-700 dark:text-gray-300"}`,children:t.n}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0 ml-2",children:t.lmt?new Date(t.lmt).toLocaleDateString():""})]}),e.jsxs("p",{className:`text-xs truncate ${t.uc>0?"text-gray-800 dark:text-gray-200 font-medium":"text-gray-500"}`,children:[t.ls===s?"You: ":"",t.lm]})]}),e.jsx("button",{onClick:b=>{b.stopPropagation(),u==null||u(t.id)},className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white dark:bg-gray-800 shadow-md rounded-full text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all z-10",children:e.jsx($e,{size:16})})]})}function As({user:t,conversations:r=[],activeChat:s,onSelectChat:l}){const[u,i]=a.useState(!1),[p,h]=a.useState(!1),[b,x]=a.useState("direct"),[w,k]=a.useState(!1),[d,g]=a.useState(""),[n,o]=a.useState([]),[j,S]=a.useState(""),[c,v]=a.useState([]),N=async y=>{S(y);const z=y.trim();if(z.length>1){const _=z.toLowerCase(),T=_.charAt(0).toUpperCase()+_.slice(1),K=Ae(Be(fe,"public_profile"),oe("firstName",">=",T),oe("firstName","<=",T+"ï£¿")),Z=Ae(Be(fe,"public_profile"),oe("lastName",">=",T),oe("lastName","<=",T+"ï£¿"));try{const[B,ie]=await Promise.all([qe(K),qe(Z)]),ae=new Map,J=te=>{const ee=te.ref.parent.parent.id;ee!==t.uid&&ae.set(ee,{id:ee,...te.data()})};B.forEach(J),ie.forEach(J),v(Array.from(ae.values()))}catch(B){console.error("Search error:",B),v([])}}else v([])},M=y=>{if(b==="direct"){const z=[t.uid,y.id].sort().join("_");l({id:z,uid:y.id,name:`${y.firstName} ${y.lastName}`,type:"direct"}),I()}else b==="add_member"&&(n.find(z=>z.id===y.id)||o(z=>[...z,y]),I())},I=()=>{i(!1),S(""),v([])},P=()=>{g(""),o([]),h(!0)},D=()=>{x("add_member"),i(!0)},A=async()=>{if(!d||n.length===0)return alert("Name and members required.");if(!Q){alert("Chat functionality is not available. Realtime Database is not configured.");return}k(!0);try{const z=Bt(ne(Q,"chats")).key,_=qt(),T=[t.uid,...n.map(B=>B.id)],K={meta:{name:d,createdBy:t.uid,createdAt:_},members:{}};T.forEach(B=>K.members[B]=!0),await Wt(ne(Q,`chats/${z}`),K);const Z={};T.forEach(B=>{Z[`conversations/${B}/${z}`]={uid:z,n:d,type:"group",lmt:_,lm:"Group created",ls:t.uid,uc:B===t.uid?0:1}}),await ge(ne(Q),Z),h(!1),l({id:z,name:d,type:"group"})}catch(y){console.error("Group creation failed",y),alert("Group creation failed: "+y.message)}finally{k(!1)}},O=async(y,z)=>{if(window.confirm("Delete this conversation?")){if(!Q){alert("Chat functionality is not available. Realtime Database is not configured.");return}try{await Vt(ne(Q,`conversations/${t.uid}/${z}`)),(s==null?void 0:s.id)===z&&l(null)}catch(_){console.error(_)}}};return e.jsxs("div",{className:"flex flex-col h-full relative overflow-hidden bg-white dark:bg-[#1f2128]",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsx("h2",{className:"font-extrabold text-lg dark:text-white tracking-tight",children:"Messages"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:P,className:"p-2 bg-white dark:bg-gray-700 rounded-full shadow-sm hover:text-brand-blue transition",title:"New Group",children:e.jsx(ye,{size:18})}),e.jsx("button",{onClick:()=>{x("direct"),i(!0)},className:"p-2 bg-white dark:bg-gray-700 rounded-full shadow-sm hover:text-brand-blue transition",title:"New Chat",children:e.jsx(ke,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:r.map(y=>e.jsx(is,{conversation:y,activeChat:s,currentUserId:t.uid,onSelect:l,onDelete:z=>{window.confirm("Delete this conversation?")&&O({},z)}},y.id))}),p&&e.jsxs("div",{className:"absolute inset-0 bg-white dark:bg-[#1f2128] z-20 flex flex-col animate-in slide-in-from-right-10 duration-200",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center gap-3 bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("button",{onClick:()=>h(!1),className:"hover:bg-gray-200 dark:hover:bg-gray-700 p-1 rounded-full",children:e.jsx(Je,{size:20})}),e.jsx("h3",{className:"font-bold dark:text-white",children:"New Group"})]}),e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"1. Group Name"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",placeholder:"Enter group name...",value:d,onChange:y=>g(y.target.value),autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["2. Members (",n.length,")"]}),e.jsxs("button",{onClick:D,className:"text-xs font-bold text-brand-blue flex items-center gap-1 hover:underline",children:[e.jsx(ke,{size:14})," Add Member"]})]}),e.jsx("div",{className:"space-y-2",children:n.length===0?e.jsx("div",{className:"text-center py-8 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400 text-sm",children:"No members selected"}):n.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-white/5 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{src:y.photoURL,name:y.firstName,size:"sm"}),e.jsxs("span",{className:"text-sm font-bold dark:text-white",children:[y.firstName," ",y.lastName]})]}),e.jsx("button",{onClick:()=>o(z=>z.filter(_=>_.id!==y.id)),className:"text-gray-400 hover:text-red-500",children:e.jsx(Y,{size:16})})]},y.id))})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:A,disabled:!d||n.length===0||w,className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-lg flex justify-center items-center gap-2",children:w?e.jsx(xe,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:["Create Group ",e.jsx(Xe,{size:18})]})})})]}),u&&e.jsxs("div",{className:"absolute inset-0 bg-white dark:bg-[#1f2128] z-30 flex flex-col animate-in fade-in duration-200",children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700 flex items-center gap-2 bg-white dark:bg-[#1f2128]",children:[e.jsx(Ne,{size:18,className:"text-gray-400 ml-2"}),e.jsx("input",{autoFocus:!0,className:"flex-1 p-2 bg-transparent outline-none dark:text-white placeholder-gray-400",placeholder:"Search...",value:j,onChange:y=>N(y.target.value)}),e.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",children:e.jsx(Y,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[c.length===0&&j.length>1&&e.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No users found."}),c.map(y=>{const z=b==="add_member"&&n.find(_=>_.id===y.id);return e.jsxs("div",{onClick:()=>M(y),className:`flex items-center gap-3 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl cursor-pointer transition mb-1 ${z?"opacity-50 pointer-events-none":""}`,children:[e.jsx(me,{src:y.photoURL,name:y.firstName,size:"md"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-bold dark:text-white",children:[y.firstName," ",y.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:y.role||"User"})]}),b==="add_member"&&e.jsx(ke,{size:18,className:"text-brand-blue"})]},y.id)})]})]})]})}const be={Recent:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥","ðŸŽ‰","ðŸ‘"],Smileys:["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ¤£","ðŸ˜‚","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Š","ðŸ˜‡","ðŸ¥°","ðŸ˜","ðŸ¤©","ðŸ˜˜","ðŸ˜—","ðŸ˜š","ðŸ˜™","ðŸ˜‹","ðŸ˜›","ðŸ˜œ","ðŸ¤ª","ðŸ˜","ðŸ¤‘","ðŸ¤—","ðŸ¤­","ðŸ¤«","ðŸ¤”","ðŸ¤","ðŸ¤¨","ðŸ˜","ðŸ˜‘","ðŸ˜¶","ðŸ˜","ðŸ˜’","ðŸ™„","ðŸ˜¬","ðŸ¤¥","ðŸ˜Œ","ðŸ˜”","ðŸ˜ª","ðŸ¤¤","ðŸ˜´","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤¢","ðŸ¤®"],Gestures:["ðŸ‘‹","ðŸ¤š","ðŸ–ï¸","âœ‹","ðŸ––","ðŸ‘Œ","ðŸ¤Œ","ðŸ¤","âœŒï¸","ðŸ¤ž","ðŸ¤Ÿ","ðŸ¤˜","ðŸ¤™","ðŸ‘ˆ","ðŸ‘‰","ðŸ‘†","ðŸ–•","ðŸ‘‡","â˜ï¸","ðŸ‘","ðŸ‘Ž","âœŠ","ðŸ‘Š","ðŸ¤›","ðŸ¤œ","ðŸ‘","ðŸ™Œ","ðŸ‘","ðŸ¤²","ðŸ¤","ðŸ™"],Hearts:["â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’”","â¤ï¸â€ðŸ”¥","â¤ï¸â€ðŸ©¹","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’Ÿ"],Objects:["ðŸ’Ž","ðŸ””","ðŸ”•","ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸ“»","ðŸŽ·","ðŸŽº","ðŸŽ¸","ðŸŽ¹","ðŸŽ®","ðŸ•¹ï¸","ðŸŽ¯","ðŸŽ²","ðŸŽ³","ðŸŽ´","ðŸƒ","ðŸ€„","ðŸŽ°","ðŸ“±","ðŸ“ž","â˜Žï¸","ðŸ“Ÿ","ðŸ“ ","ðŸ’»","ðŸ–¥ï¸","ðŸ–¨ï¸","âŒ¨ï¸","ðŸ–±ï¸","ðŸ–²ï¸","ðŸ•¹ï¸","ðŸ—œï¸","ðŸ’¾","ðŸ’¿","ðŸ“€"],Flags:["ðŸ³ï¸","ðŸ´","ðŸ","ðŸš©","ðŸ³ï¸â€ðŸŒˆ","ðŸ³ï¸â€âš§ï¸","ðŸ‡ºðŸ‡¸","ðŸ‡¬ðŸ‡§","ðŸ‡¨ðŸ‡¦","ðŸ‡¦ðŸ‡º","ðŸ‡«ðŸ‡·","ðŸ‡©ðŸ‡ª","ðŸ‡®ðŸ‡¹","ðŸ‡ªðŸ‡¸","ðŸ‡¯ðŸ‡µ","ðŸ‡°ðŸ‡·","ðŸ‡¨ðŸ‡³","ðŸ‡®ðŸ‡³","ðŸ‡§ðŸ‡·","ðŸ‡²ðŸ‡½"],Music:["ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸ“»","ðŸŽ·","ðŸŽº","ðŸŽ¸","ðŸŽ¹","ðŸ¥","ðŸª˜","ðŸŽ»","ðŸŽª","ðŸŽ­","ðŸŽ¨","ðŸŽ¬","ðŸŽ¤","ðŸŽ§","ðŸŽ¼","ðŸŽ¹"],Reactions:["ðŸ‘","ðŸ‘Ž","â¤ï¸","ðŸ”¥","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ‘","ðŸ™Œ","ðŸ¤","ðŸ¤—","ðŸ¤”","ðŸ¤¦","ðŸ¤·","ðŸ™","ðŸ‘€","ðŸ’ª","ðŸ¤˜","âœŒï¸","ðŸ¤ž"]},os=Object.values(be).flat();function cs({onSelect:t,onClose:r,position:s="bottom"}){const[l,u]=a.useState("Recent"),[i,p]=a.useState(""),[h,b]=a.useState(()=>{const d=localStorage.getItem("recentEmojis");return d?JSON.parse(d):be.Recent}),x=a.useMemo(()=>i.trim()?os.filter(d=>d.includes(i)||i.includes(d)):l==="Recent"?h:be[l]||[],[i,l,h]),w=d=>{const g=[d,...h.filter(n=>n!==d)].slice(0,8);b(g),localStorage.setItem("recentEmojis",JSON.stringify(g)),t(d),r&&r()},k=Object.keys(be);return e.jsxs(U.div,{initial:{opacity:0,scale:.95,y:s==="bottom"?-10:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},className:`
                absolute ${s==="bottom"?"bottom-full mb-2":"top-full mt-2"} 
                left-0
                w-[340px] bg-white dark:bg-gray-800 
                rounded-2xl shadow-2xl border dark:border-gray-700
                z-50 overflow-hidden
            `,children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(Ne,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search emojis...",value:i,onChange:d=>p(d.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white"}),i&&e.jsx("button",{onClick:()=>p(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Y,{size:16})})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide",children:k.map(d=>e.jsxs("button",{onClick:()=>u(d),className:`
                                px-3 py-1.5 rounded-lg text-xs font-semibold whitespace-nowrap transition
                                ${l===d?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}
                            `,children:[d==="Recent"?e.jsx(Ge,{size:12,className:"inline mr-1"}):null,d]},d))})]}),e.jsx("div",{className:"h-[280px] overflow-y-auto custom-scrollbar p-3",children:x.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"text-sm",children:"No emojis found"})}):e.jsx("div",{className:"grid grid-cols-8 gap-1",children:x.map((d,g)=>e.jsx(U.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:()=>w(d),className:"w-10 h-10 flex items-center justify-center text-xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:d},`${d}-${g}`))})})]})}const He="lfDGNSxY36zoFTAiGMVIOxjovvzFoBRp",Qe="https://api.giphy.com/v1/gifs";function ds({onSelect:t,onClose:r,position:s="bottom"}){const[l,u]=a.useState(""),[i,p]=a.useState([]),[h,b]=a.useState([]),[x,w]=a.useState(!1),[k,d]=a.useState("trending"),g=a.useRef(null);a.useEffect(()=>{n()},[]),a.useEffect(()=>(l.trim()?(d("search"),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{o(l)},500)):(d("trending"),p([])),()=>{g.current&&clearTimeout(g.current)}),[l]);const n=async()=>{w(!0);try{const v=await(await fetch(`${Qe}/trending?api_key=${He}&limit=24&rating=g`)).json();v.data&&b(v.data)}catch(c){console.error("Giphy trending error:",c)}w(!1)},o=async c=>{if(c.trim()){w(!0);try{const N=await(await fetch(`${Qe}/search?api_key=${He}&q=${encodeURIComponent(c)}&limit=24&rating=g`)).json();N.data&&p(N.data)}catch(v){console.error("Giphy search error:",v)}w(!1)}},j=c=>{t==null||t({url:c.images.fixed_height.url||c.images.original.url,previewUrl:c.images.preview_gif.url||c.images.fixed_height_small.url,width:c.images.fixed_height.width,height:c.images.fixed_height.height,title:c.title||"GIF"}),r&&r()},S=k==="trending"?h:i;return e.jsxs(U.div,{initial:{opacity:0,scale:.95,y:s==="bottom"?-10:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},className:`
                absolute ${s==="bottom"?"bottom-full mb-2":"top-full mt-2"} 
                left-0
                w-[380px] bg-white dark:bg-gray-800 
                rounded-2xl shadow-2xl border dark:border-gray-700
                z-50 overflow-hidden
            `,children:[e.jsx("div",{className:"p-3 border-b dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search GIFs...",value:l,onChange:c=>u(c.target.value),className:"w-full pl-9 pr-10 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white"}),l&&e.jsx("button",{onClick:()=>u(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Y,{size:16})})]})}),e.jsx("div",{className:"h-[320px] overflow-y-auto custom-scrollbar p-3",children:x?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx(xe,{className:"animate-spin text-brand-blue mb-2",size:24}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading GIFs..."})]}):S.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(dt,{size:32,className:"mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:k==="search"?"No GIFs found. Try a different search.":"Loading trending GIFs..."})]}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:S.map(c=>e.jsxs(U.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>j(c),className:"relative aspect-square rounded-lg overflow-hidden cursor-pointer bg-gray-100 dark:bg-gray-700 group",children:[e.jsx("img",{src:c.images.fixed_height_small.url||c.images.preview_gif.url,alt:c.title,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"})]},c.id))})}),e.jsx("div",{className:"p-2 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-center",children:e.jsxs("p",{className:"text-[10px] text-gray-400",children:["Powered by ",e.jsx("span",{className:"font-bold",children:"GIPHY"})]})})]})}function us({onRecorded:t,onClose:r,maxDuration:s=60}){const[l,u]=a.useState(!1),[i,p]=a.useState(null),[h,b]=a.useState(0),[x,w]=a.useState(null),[k,d]=a.useState(null),g=a.useRef(null),n=a.useRef(null),o=a.useRef(null),j=a.useRef([]),S=a.useRef(null);a.useEffect(()=>(c(),()=>{v()}),[]);const c=async()=>{try{const A=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!0});n.current=A,g.current&&(g.current.srcObject=A),w(!0),d(null)}catch(A){console.error("Permission error:",A),w(!1),d("Camera/microphone access denied")}},v=()=>{n.current&&(n.current.getTracks().forEach(A=>A.stop()),n.current=null),S.current&&clearInterval(S.current)},N=async()=>{if(!n.current){await c();return}try{j.current=[];const A={mimeType:"video/webm;codecs=vp9,opus",videoBitsPerSecond:25e5};o.current=new MediaRecorder(n.current,A),o.current.ondataavailable=O=>{O.data.size>0&&j.current.push(O.data)},o.current.onstop=()=>{const O=new Blob(j.current,{type:"video/webm"});p(O),u(!1),b(0),S.current&&clearInterval(S.current)},o.current.start(),u(!0),b(0),S.current=setInterval(()=>{b(O=>{const y=O+1;return y>=s&&M(),y})},1e3)}catch(A){console.error("Recording error:",A),d("Failed to start recording")}},M=()=>{o.current&&l&&o.current.stop()},I=()=>{p(null),b(0),u(!1)},P=()=>{if(i){const A=new File([i],`video_${Date.now()}.webm`,{type:"video/webm"});t==null||t(A),v(),r==null||r()}},D=A=>{const O=Math.floor(A/60),y=A%60;return`${O}:${y.toString().padStart(2,"0")}`};return!x&&x!==null?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsx(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-6 max-w-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ut,{size:48,className:"text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Camera Access Required"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Please allow camera and microphone access to record video messages."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-200 transition",children:"Cancel"}),e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 bg-brand-blue text-white rounded-lg text-sm font-semibold hover:bg-blue-600 transition",children:"Allow Access"})]})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-[80]",children:e.jsxs(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative w-full max-w-2xl aspect-video bg-black rounded-2xl overflow-hidden",children:[e.jsx("video",{ref:g,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),l&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-bold",children:D(h)})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent",children:e.jsx("div",{className:"flex items-center justify-center gap-4",children:i?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:I,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(Y,{size:24})}),e.jsx("button",{onClick:P,className:"p-4 bg-green-500 hover:bg-green-600 rounded-full text-white transition shadow-lg",children:e.jsx(je,{size:28})}),e.jsx("div",{className:"w-12"})," "]}):e.jsx(e.Fragment,{children:l?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:I,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(Y,{size:24})}),e.jsx("button",{onClick:M,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full text-white transition shadow-lg animate-pulse",children:e.jsx(Ze,{size:28})}),e.jsx("div",{className:"w-12"})," "]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(Y,{size:24})}),e.jsx("button",{onClick:N,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full text-white transition shadow-lg",children:e.jsx(ve,{size:28})}),e.jsx("div",{className:"w-12"})," "]})})})}),k&&e.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-4 py-2 rounded-lg text-sm",children:k})]})})}function xs({activeChatId:t,uid:r,onSend:s,replyingTo:l,editingMessage:u,onCancelReply:i,typingUsers:p=[]}){const[h,b]=a.useState(""),[x,w]=a.useState(null),[k,d]=a.useState(!1),[g,n]=a.useState(!1),[o,j]=a.useState(!1),[S,c]=a.useState(!1),[v,N]=a.useState(!1),M=a.useRef(null),I=a.useRef(null),P=a.useRef(null),D=a.useRef(null),A=a.useRef([]),O=a.useRef(null),y=a.useRef(null),{uploadMedia:z,uploading:_}=ls();a.useEffect(()=>{var f;u&&(b(u.b||""),(f=P.current)==null||f.focus())},[u]),a.useEffect(()=>{var f;l&&((f=P.current)==null||f.focus())},[l]),a.useEffect(()=>{const f=$=>{O.current&&!O.current.contains($.target)&&j(!1),y.current&&!y.current.contains($.target)&&c(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]);const T=async f=>{try{const W=await(await fetch(f.url)).blob(),m=new File([W],`gif_${Date.now()}.gif`,{type:"image/gif"}),R=await z(m,`chat_media/${t}`);if(R){const C={url:R.url,type:"image",name:f.title||"GIF",gif:!0};s("",C)}}catch($){console.error("GIF upload error:",$),alert("Failed to send GIF")}c(!1)},K=async f=>{try{const $=await z(f,`chat_media/${t}`);if($){const W={url:$.url,type:"video",name:f.name};s("",W)}}catch($){console.error("Video upload error:",$),alert("Failed to send video")}N(!1)},Z=f=>{b(f.target.value),t&&r&&Q&&(ge(ne(Q,`chats/${t}/typing`),{[r]:!0}),M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{Q&&ge(ne(Q,`chats/${t}/typing`),{[r]:!1})},2e3))},B=f=>{const $=P.current;if($){const W=$.selectionStart,m=$.selectionEnd,R=h.substring(0,W)+f+h.substring(m);b(R),setTimeout(()=>{$.selectionStart=$.selectionEnd=W+f.length,$.focus()},0)}else b(W=>W+f)},ie=async()=>{try{const f=await navigator.mediaDevices.getUserMedia({audio:!0});D.current=new MediaRecorder(f),A.current=[],D.current.ondataavailable=$=>A.current.push($.data),D.current.onstop=()=>{const $=new Blob(A.current,{type:"audio/mp3"}),W=new File([$],`voice_note_${Date.now()}.mp3`,{type:"audio/mp3"});w({file:W,type:"audio",previewUrl:URL.createObjectURL($)}),f.getTracks().forEach(m=>m.stop())},D.current.start(),d(!0)}catch{alert("Microphone access denied.")}},ae=()=>{D.current&&D.current.stop(),d(!1)},J=f=>{f.preventDefault(),f.stopPropagation(),f.type==="dragenter"||f.type==="dragover"?n(!0):n(!1)},te=f=>{f.preventDefault(),f.stopPropagation(),n(!1),f.dataTransfer.files&&f.dataTransfer.files[0]&&ee(f.dataTransfer.files[0])},ee=f=>{const $=f.type.startsWith("image/")?"image":f.type.startsWith("video/")?"video":f.type.startsWith("audio/")?"audio":"file";w({file:f,type:$,previewUrl:URL.createObjectURL(f)})},E=async f=>{if(f.preventDefault(),!h.trim()&&!x||_)return;let $=null;if(x){const W=await z(x.file,`chat_media/${t}`);W&&($={url:W.url,type:W.type,name:W.name})}s(h,$),b(""),w(null),t&&r&&Q&&ge(ne(Q,`chats/${t}/typing`),{[r]:!1})},H=()=>{u&&b(""),i==null||i()},de=()=>{var f,$;return u?((f=u.b)==null?void 0:f.substring(0,50))||"Message":l?(($=l.b)==null?void 0:$.substring(0,50))||"Media":""};return e.jsxs("div",{className:`p-3 bg-white dark:bg-[#2c2e36] border-t dark:border-gray-700 shrink-0 transition-colors ${g?"bg-blue-50 dark:bg-blue-900/20 border-blue-400":""}`,onDragEnter:J,onDragLeave:J,onDragOver:J,onDrop:te,children:[e.jsx(ue,{children:p.length>0&&e.jsxs(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-2 px-2 flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsxs("span",{className:"text-xs text-gray-400 italic",children:[p.length>1?"Multiple people are":"Someone is"," typing..."]})]})}),e.jsx(ue,{children:(l||u)&&e.jsxs(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-between items-center bg-gray-100 dark:bg-gray-800 p-2.5 px-4 rounded-xl border-l-4 border-brand-blue mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[u?e.jsx(et,{size:16,className:"text-brand-blue shrink-0"}):e.jsx(tt,{size:16,className:"text-brand-blue shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue block",children:u?"Editing Message":`Replying to ${(l==null?void 0:l.n)||"User"}`}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate block",children:de()})]})]}),e.jsx("button",{onClick:H,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(Y,{size:16,className:"text-gray-400 hover:text-red-500"})})]})}),e.jsx(ue,{children:x&&e.jsxs(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"flex items-center gap-3 p-3 bg-gray-100 dark:bg-gray-800 rounded-xl mb-2 border dark:border-gray-700",children:[x.type==="image"?e.jsx("img",{src:x.previewUrl,className:"h-14 w-14 object-cover rounded-lg"}):x.type==="video"?e.jsx("video",{src:x.previewUrl,className:"h-14 w-14 object-cover rounded-lg"}):e.jsx("div",{className:"h-14 w-14 bg-purple-100 dark:bg-purple-900/30 text-purple-600 flex items-center justify-center rounded-lg",children:e.jsx(xt,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-bold dark:text-white truncate",children:x.file.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(x.file.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:()=>w(null),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(Y,{size:18,className:"text-gray-400 hover:text-red-500"})})]})}),e.jsxs("form",{onSubmit:E,className:"flex items-end gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",ref:I,className:"hidden",accept:"image/*,audio/*,video/*,.pdf,.doc,.docx,.txt,.zip",onChange:f=>ee(f.target.files[0])}),e.jsx("button",{type:"button",onClick:()=>{var f;return(f=I.current)==null?void 0:f.click()},className:"p-2.5 text-gray-500 hover:text-brand-blue hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition shrink-0",title:"Attach file",children:e.jsx(mt,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-1 border-r dark:border-gray-700 pr-2",children:[e.jsx("button",{type:"button",onClick:()=>{N(!0),j(!1),c(!1)},className:"p-2 text-gray-500 hover:text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition",title:"Record video",children:e.jsx(ve,{size:18})}),e.jsxs("button",{type:"button",onClick:()=>{c(!S),j(!1)},className:"p-2 text-gray-500 hover:text-purple-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition relative",title:"GIF",ref:y,children:[e.jsx(ft,{size:18}),S&&e.jsx(ds,{onSelect:T,onClose:()=>c(!1),position:"bottom"})]})]}),e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-[#1f2128] rounded-2xl border dark:border-gray-700 focus-within:ring-2 focus-within:ring-brand-blue transition-all flex items-end relative",children:[e.jsx("textarea",{ref:P,className:"w-full bg-transparent p-3 max-h-32 min-h-[44px] text-sm resize-none outline-none dark:text-white custom-scrollbar pr-20",placeholder:u?"Update message...":g?"Drop files here...":"Type a message...",value:h,onChange:Z,onKeyDown:f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),E(f))},rows:1}),e.jsxs("div",{className:"absolute right-2 bottom-1.5 flex items-center gap-1",children:[e.jsxs("div",{className:"relative",ref:O,children:[e.jsx("button",{type:"button",onClick:()=>{j(!o),c(!1)},className:`p-1.5 rounded-full transition ${o?"bg-brand-blue/20 text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,title:"Emoji",children:e.jsx(ht,{size:18})}),e.jsx(ue,{children:o&&e.jsx(cs,{onSelect:B,onClose:()=>j(!1),position:"bottom"})})]}),e.jsx("button",{type:"button",onClick:k?ae:ie,className:`p-1.5 rounded-full transition ${k?"bg-red-500 text-white animate-pulse":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,children:k?e.jsx(Ze,{size:18}):e.jsx(gt,{size:18})})]})]}),e.jsx("button",{type:"submit",disabled:!h.trim()&&!x||_,className:`p-2.5 text-white rounded-full shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all shrink-0 ${u?"bg-green-600 hover:bg-green-700":"bg-brand-blue hover:bg-blue-600"}`,children:_?e.jsx(xe,{size:20,className:"animate-spin"}):u?e.jsx(bt,{size:20}):e.jsx(pt,{size:20})})]}),v&&e.jsx(us,{onRecorded:K,onClose:()=>N(!1),maxDuration:60})]})}function ms(...t){return Ye(Re(t))}const pe=yt.forwardRef(({className:t,variant:r="default",size:s="default",...l},u)=>{const i={default:"bg-blue-600 text-white hover:bg-blue-700 shadow-sm",destructive:"bg-red-500 text-white hover:bg-red-600 shadow-sm",outline:"border border-gray-200 bg-transparent hover:bg-gray-100 text-gray-900",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200",ghost:"hover:bg-gray-100 hover:text-gray-900 text-gray-600",link:"text-blue-600 underline-offset-4 hover:underline"},p={default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"};return e.jsx("button",{ref:u,className:ms("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:pointer-events-none disabled:opacity-50",i[r],p[s],t),...l})});pe.displayName="Button";function fs({url:t,isOpen:r,onClose:s,previewData:l}){if(!r||!t)return null;const u=new URL(t).pathname;let i="Content";u.startsWith("/profile/")?i="User Profile":u.startsWith("/session/")?i="Session Details":u.startsWith("/studio/")&&(i="Studio Listing");const p=(l==null?void 0:l.title)||`${i} Preview`;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black bg-opacity-70 backdrop-blur-sm",onClick:s,children:e.jsxs("div",{className:"bg-gray-900 rounded-xl shadow-2xl w-full max-w-2xl h-3/4 max-h-[800px] flex flex-col transform transition-all duration-300 scale-100 opacity-100",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-800 rounded-t-xl sticky top-0",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate max-w-[80%]",children:p}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:e.jsx(pe,{variant:"ghost",size:"icon",className:"text-blue-400 hover:text-blue-300",children:e.jsx(jt,{className:"w-5 h-5"})})}),e.jsx(pe,{onClick:s,variant:"ghost",size:"icon",className:"text-white hover:bg-gray-700",children:e.jsx(Y,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-y-auto custom-scrollbar text-gray-400 flex flex-col items-center justify-center text-center",children:[e.jsx("p",{className:"mb-4 text-lg font-medium text-white",children:"Embedded Content Simulation"}),e.jsx("p",{className:"mb-2",children:"This is where the actual SeshNx content (e.g., profile card, session details) would be rendered, based on the URL:"}),e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline break-all p-2 bg-gray-700 rounded-lg text-sm",children:t}),e.jsx("p",{className:"mt-4 text-sm",children:'In a real implementation, you would use a dedicated component (e.g., `ProfileCard id="..."`) here instead of an iframe to display the content securely and natively.'})]}),e.jsx("div",{className:"p-3 border-t border-gray-700 bg-gray-800 rounded-b-xl flex justify-end",children:e.jsx(pe,{onClick:s,variant:"secondary",children:"Done"})})]})})}function hs({status:t="sent",size:r=12,className:s=""}){const l={sending:{icon:Ge,color:"text-gray-400",animate:!0},sent:{icon:je,color:"text-gray-400",animate:!1},delivered:{icon:De,color:"text-gray-400",animate:!1},read:{icon:De,color:"text-brand-blue",animate:!1}},u=l[t]||l.sent,i=u.icon;return e.jsx(U.div,{animate:u.animate?{rotate:[0,360]}:{},transition:u.animate?{duration:2,repeat:1/0,ease:"linear"}:{},className:`inline-flex items-center ${u.color} ${s}`,children:e.jsx(i,{size:r,className:t==="read"?"fill-current":""})})}function gs({audioUrl:t,color:r="brand-blue",height:s=40}){const l=a.useRef(null),u=a.useRef(null),i=a.useRef(null),p=a.useRef(null),h=a.useRef(null),[b,x]=a.useState(!1);a.useEffect(()=>{if(!t||!l.current)return;const d=l.current,g=d.getContext("2d"),n=new Audio(t);u.current=n,d.width=d.offsetWidth,d.height=s;const o=new(window.AudioContext||window.webkitAudioContext),j=o.createAnalyser(),S=o.createMediaElementSource(n);j.fftSize=256,S.connect(j),j.connect(o.destination),p.current=o,h.current=j;const c=j.frequencyBinCount,v=new Uint8Array(c),N=()=>{if(n.paused){w(g,d.width,d.height);return}i.current=requestAnimationFrame(N),j.getByteFrequencyData(v),g.clearRect(0,0,d.width,d.height);const M=d.width/c*2;let I=0;for(let P=0;P<c;P++){const D=v[P]/255*d.height,A=g.createLinearGradient(0,0,0,d.height);A.addColorStop(0,"#3b82f6"),A.addColorStop(1,"#8b5cf6"),g.fillStyle=A,g.fillRect(I,d.height-D,M-1,D),I+=M}};return n.addEventListener("play",()=>{x(!0),N()}),n.addEventListener("pause",()=>{x(!1),i.current&&cancelAnimationFrame(i.current),w(g,d.width,d.height)}),n.addEventListener("ended",()=>{x(!1),i.current&&cancelAnimationFrame(i.current),w(g,d.width,d.height)}),w(g,d.width,d.height),()=>{var M;i.current&&cancelAnimationFrame(i.current),n.pause(),(M=p.current)==null||M.close()}},[t,s,b]);const w=(d,g,n)=>{d.clearRect(0,0,g,n),d.fillStyle="#3b82f6";const o=50,j=g/o,S=2;for(let c=0;c<o;c++){const v=Math.random()*n*.3+n*.1,N=c*j;d.fillRect(N,n-v,j-S,v)}},k=()=>{u.current&&(b?u.current.pause():u.current.play())};return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:k,className:"w-10 h-10 flex items-center justify-center bg-brand-blue text-white rounded-full hover:bg-blue-600 transition shrink-0",children:b?e.jsx(wt,{size:16}):e.jsx(Nt,{size:16,className:"ml-0.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("canvas",{ref:l,className:"w-full rounded",style:{height:`${s}px`}}),e.jsx("audio",{ref:u,src:t})]})]})}const bs=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"];function ps({message:t,isCurrentUser:r,previousMessage:s,currentUserId:l,chatId:u,linkPreviewData:i,messageStatus:p="sent",onReaction:h,onReply:b,onEdit:x,onDelete:w,onForward:k,onSeshNxLinkClick:d,onUserClick:g}){var ee;const[n,o]=a.useState(!1),[j,S]=a.useState(!1),[c,v]=a.useState(!1),N=a.useRef(null),M=a.useRef(null),I=!s||s.s!==t.s,P=s&&new Date(t.t).toDateString()===new Date(s.t).toDateString(),D=t.t||Date.now(),A=(s==null?void 0:s.t)||0,O=s&&D-A>3e5,y=!P||!s,z=I||O,_=!r&&I,T=new Date(t.t||Date.now());a.useEffect(()=>{const E=H=>{N.current&&!N.current.contains(H.target)&&(o(!1),S(!1))};return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[]);const K=()=>{navigator.clipboard.writeText(t.b||""),v(!0),setTimeout(()=>v(!1),2e3),o(!1)},Z=E=>{h==null||h(t.id,E),S(!1),o(!1)},B=t.reactions?Object.entries(t.reactions).reduce((E,[H,de])=>{const f=typeof de=="object"?Object.keys(de).length:0;return f>0&&(E[H]=f),E},{}):{},ie=Object.keys(B).length>0,ae=t.reactions?(ee=Object.entries(t.reactions).find(([E,H])=>typeof H=="object"&&H[l]))==null?void 0:ee[0]:null,J=r?"bg-brand-blue text-white rounded-br-sm":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-sm";if(t.deleted||t.deletedForAll)return e.jsx("div",{className:`flex ${r?"justify-end":"justify-start"} ${I?"mt-3":"mt-0.5"}`,children:e.jsx("div",{className:"px-4 py-2 rounded-2xl bg-gray-100 dark:bg-gray-800 text-gray-400 italic text-sm",children:"ðŸš« This message was deleted"})});if(t.deletedFor&&t.deletedFor[l])return null;const te=()=>{var H;if(!i)return null;const E=(H=i.url)==null?void 0:H.includes("seshnx.net");return e.jsx("div",{className:"mt-2 block border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden bg-white dark:bg-gray-800 max-w-[280px]",children:E?e.jsxs("button",{onClick:()=>d==null?void 0:d(i),className:"w-full text-left",children:[i.image&&e.jsx("div",{className:"h-28 w-full bg-cover bg-center",style:{backgroundImage:`url(${i.image})`}}),e.jsxs("div",{className:"p-2",children:[e.jsxs("p",{className:"font-semibold text-xs text-brand-blue truncate flex items-center",children:[e.jsx(kt,{className:"w-3 h-3 mr-1"}),i.title||"SeshNx Link"]}),i.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 line-clamp-2",children:i.description})]})]}):e.jsxs("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",children:[i.image&&e.jsx("div",{className:"h-28 w-full bg-cover bg-center",style:{backgroundImage:`url(${i.image})`}}),e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"font-semibold text-xs text-brand-blue truncate",children:i.title||i.url}),i.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 line-clamp-2",children:i.description}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-1 flex items-center",children:[e.jsx(St,{className:"w-2.5 h-2.5 mr-1"}),new URL(i.url).hostname]})]})]})})};return e.jsxs(e.Fragment,{children:[y&&e.jsx("div",{className:"text-center my-4",children:e.jsx("span",{className:"text-[10px] text-gray-400 dark:text-gray-500 font-bold uppercase tracking-wider bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full",children:T.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("div",{className:`group flex items-end gap-2 ${r?"flex-row-reverse":"flex-row"} ${I?"mt-3":"mt-0.5"}`,ref:M,children:[!r&&e.jsx("div",{className:"w-8 shrink-0",children:_&&e.jsx(me,{src:t.photo,name:t.n,size:"xs",className:"cursor-pointer",onClick:()=>g==null?void 0:g(t.s)})}),e.jsxs("div",{className:`relative max-w-[75%] ${r?"items-end":"items-start"}`,children:[!r&&I&&t.n&&e.jsx("p",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 mb-1 ml-1",children:t.n}),t.replyTo&&e.jsxs("div",{className:`mb-1 px-3 py-1.5 rounded-lg text-xs border-l-2 border-brand-blue ${r?"bg-blue-400/30 text-blue-100":"bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300"}`,children:[e.jsx("p",{className:"font-bold text-[10px] mb-0.5",children:t.replyTo.sender}),e.jsx("p",{className:"truncate opacity-80",children:t.replyTo.text})]}),e.jsxs("div",{className:`relative px-3 py-2 rounded-2xl shadow-sm ${J} cursor-pointer transition-all hover:shadow-md`,onClick:()=>o(!n),children:[t.media&&e.jsxs("div",{className:"mb-2",children:[t.media.type==="image"&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[t.media.gif&&e.jsx("span",{className:"absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full font-bold",children:"GIF"}),e.jsx("img",{src:t.media.url,alt:"Shared",className:"max-w-full h-auto rounded-lg max-h-60 object-cover"})]}),t.media.type==="video"&&e.jsx("video",{controls:!0,src:t.media.url,className:"max-w-full h-auto rounded-lg max-h-60"}),t.media.type==="audio"&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 max-w-[280px]",children:e.jsx(gs,{audioUrl:t.media.url,height:50})}),t.media.type==="file"&&e.jsxs("a",{href:t.media.url,target:"_blank",rel:"noopener noreferrer",download:t.media.name,className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center shrink-0",children:e.jsx(we,{size:20,className:"text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold dark:text-white truncate",children:t.media.name||"File"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click to download"})]}),e.jsx(Ce,{size:18,className:"text-gray-400 group-hover:text-brand-blue transition shrink-0"})]})]}),t.b&&e.jsx("p",{className:"text-sm break-words whitespace-pre-wrap leading-relaxed",children:t.b}),t.b&&te(),t.edited&&e.jsx("span",{className:`text-[9px] ${r?"text-blue-200":"text-gray-400"} ml-1`,children:"(edited)"})]}),ie&&e.jsx("div",{className:`flex flex-wrap gap-1 mt-1 ${r?"justify-end":"justify-start"}`,children:Object.entries(B).map(([E,H])=>e.jsxs(U.button,{initial:{scale:0},animate:{scale:1},onClick:()=>Z(E),className:`flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-xs border transition-all ${ae===E?"bg-brand-blue/20 border-brand-blue text-brand-blue":"bg-gray-100 dark:bg-gray-700 border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{children:E}),e.jsx("span",{className:"text-[10px] font-bold",children:H})]},E))}),z&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 ${r?"justify-end":"justify-start"}`,children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:T.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}),r&&e.jsx(hs,{status:p,size:10,className:"ml-0.5"})]}),e.jsx(ue,{children:n&&e.jsxs(U.div,{ref:N,initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},className:`absolute z-50 ${r?"right-0":"left-0"} bottom-full mb-2 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden min-w-[180px]`,children:[e.jsx("div",{className:"flex justify-center gap-1 p-2 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:bs.map(E=>e.jsx(U.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:()=>Z(E),className:`text-lg p-1 rounded-full transition ${ae===E?"bg-brand-blue/20":"hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:E},E))}),e.jsxs("div",{className:"p-1",children:[e.jsxs("button",{onClick:()=>{b==null||b(t),o(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(tt,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Reply"})]}),e.jsxs("button",{onClick:K,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(vt,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:c?"Copied!":"Copy"})]}),e.jsxs("button",{onClick:()=>{k==null||k(t),o(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(Me,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Forward"})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{x==null||x(t),o(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(et,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Edit"})]}),e.jsxs("button",{onClick:()=>{w==null||w(t,"everyone"),o(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition text-red-500",children:[e.jsx($e,{size:16}),e.jsx("span",{children:"Delete for Everyone"})]})]}),e.jsxs("button",{onClick:()=>{w==null||w(t,"me"),o(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition text-gray-500",children:[e.jsx($e,{size:16}),e.jsx("span",{children:"Delete for Me"})]})]})]})})]}),r&&e.jsx("div",{className:"w-8 shrink-0"})]})]})}function ys({message:t,conversations:r,currentUserId:s,onForward:l,onClose:u}){const[i,p]=a.useState(""),[h,b]=a.useState([]),[x,w]=a.useState(!1),k=i.trim()?r.filter(o=>{var j;return(j=o.n)==null?void 0:j.toLowerCase().includes(i.toLowerCase())}):r,d=o=>{b(j=>j.includes(o)?j.filter(S=>S!==o):[...j,o])},g=async()=>{if(h.length!==0){w(!0);try{await l(t,h),u()}catch(o){console.error("Forward error:",o),alert("Failed to forward message")}w(!1)}},n=()=>{var o;return t.media?t.media.type==="image"?"ðŸ“· Image":t.media.type==="video"?"ðŸŽ¥ Video":t.media.type==="audio"?"ðŸŽµ Audio":"ðŸ“Ž File":((o=t.b)==null?void 0:o.substring(0,100))||"Message"};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsxs(U.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"text-brand-blue",size:20}),e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Forward Message"})]}),e.jsx("button",{onClick:u,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(Y,{size:20})})]}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-800 border-b dark:border-gray-700 shrink-0",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Forwarding:"}),e.jsx("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:e.jsx("p",{className:"text-sm dark:text-gray-200 line-clamp-2",children:n()})})]}),e.jsx("div",{className:"px-4 py-3 border-b dark:border-gray-700 shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:i,onChange:o=>p(o.target.value),className:"w-full pl-9 pr-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white transition"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:k.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No conversations found"})}):k.map(o=>{const j=h.includes(o.id);return e.jsxs(U.div,{whileTap:{scale:.98},onClick:()=>d(o.id),className:`
                                        flex items-center gap-3 p-4 cursor-pointer transition
                                        border-b dark:border-gray-700/50
                                        ${j?"bg-brand-blue/10 dark:bg-brand-blue/20":"hover:bg-gray-50 dark:hover:bg-gray-800"}
                                    `,children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{src:o.photo,name:o.n,size:"md",isGroup:o.type==="group"}),j&&e.jsx(U.div,{initial:{scale:0},animate:{scale:1},className:"absolute -bottom-1 -right-1 w-5 h-5 bg-brand-blue rounded-full flex items-center justify-center",children:e.jsx(je,{size:12,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm dark:text-white truncate",children:o.n}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:o.type==="group"?"Group":"Direct message"})]}),e.jsx("div",{className:`
                                        w-5 h-5 rounded-full border-2 transition
                                        ${j?"border-brand-blue bg-brand-blue":"border-gray-300 dark:border-gray-600"}
                                    `,children:j&&e.jsx(je,{size:12,className:"text-white m-auto"})})]},o.id)})}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[h.length," conversation",h.length!==1?"s":""," selected"]}),h.length>0&&e.jsx("button",{onClick:()=>b([]),className:"text-xs text-brand-blue hover:underline",children:"Clear all"})]}),e.jsx("button",{onClick:g,disabled:h.length===0||x,className:"w-full bg-brand-blue text-white py-3 rounded-xl font-bold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"animate-spin",size:18}),"Forwarding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:18}),"Forward"]})})]})]})})}function js(t,r){var g;const s=a.useMemo(()=>re(),[]),l=a.useMemo(()=>t&&r&&s?{chatId:t}:"skip",[t,r,s]),u=Te(X.readReceipts.getReadReceipts,l),i=se(X.readReceipts.markAsRead),p=se(X.readReceipts.markMultipleAsRead),h=a.useMemo(()=>{if(!u)return{};const n={};return u.forEach(o=>{n[o.userId]?o.readAt>n[o.userId].readAt&&(n[o.userId]={lastReadMessageId:o.messageId,readAt:o.readAt}):n[o.userId]={lastReadMessageId:o.messageId,readAt:o.readAt}}),n},[u]),b=((g=h[r])==null?void 0:g.lastReadMessageId)||null,x=a.useCallback(async n=>{if(!(!t||!r||!n||!re()||!i||!p))try{const o=Array.isArray(n)?n:[n];o.length===1?await i({chatId:t,messageId:o[0],userId:r}):await p({chatId:t,messageIds:o,userId:r})}catch(o){console.error("Mark as read error:",o)}},[t,r,i,p]),w=a.useCallback((n,o,j=null)=>{if(!n||!o)return!1;const S=h[o];if(!S||!S.lastReadMessageId)return!1;const c=S.lastReadMessageId;if(c===n)return!0;if(j&&Array.isArray(j)){const v=j.find(M=>M.id===n),N=j.find(M=>M.id===c);if(v&&N&&v.t&&N.t)return v.t<=N.t}return c>=n},[h]),k=a.useCallback(n=>{var o;return((o=h[n])==null?void 0:o.lastReadMessageId)||null},[h]),d=a.useCallback(n=>b===n||b&&b>=n,[b]);return{readReceipts:h,myLastRead:b,markAsRead:x,isMessageRead:w,getLastReadMessage:k,hasCurrentUserRead:d}}async function ws(t){const r=t.match(/(https?:\/\/[^\s]+)/);if(!r)return null;const s=r[0];await new Promise(u=>setTimeout(u,500));const l={url:s,title:null,description:null,image:null};return s.includes("seshnx.net")?(l.title="SeshNx Official Platform Link",l.description="Shared content from the SeshNx platform. Tap to view embed.",l.image="https://placehold.co/600x400/374151/f9fafb?text=SeshNx+Link"):s.includes("youtube.com")?(l.title="YouTube Video",l.description="Watch this video on YouTube.",l.image="https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg"):s.includes("spotify.com")?(l.title="New Track on Spotify",l.description="Listen to the latest release now!",l.image="https://placehold.co/600x400/1DB954/f9fafb?text=Spotify+Album"):s.includes("github.com")?(l.title="SeshNx WebApp Repository",l.description="Check out the source code and contribute.",l.image="https://placehold.co/600x400/000000/ffffff?text=GitHub"):(l.title=`External Link: ${s}`,l.description=`Click to visit ${s}.`),l}function Fs({user:t,userData:r,activeChat:s,conversations:l,onBack:u,toggleDetails:i,openPublicProfile:p}){const[h,b]=a.useState({}),[x,w]=a.useState({isOpen:!1,url:"",previewData:null}),[k,d]=a.useState(null),[g,n]=a.useState(null),[o,j]=a.useState(null),S=a.useRef(null),c=s==null?void 0:s.id,v=(s==null?void 0:s.name)||(s==null?void 0:s.n)||"Unknown User",N=a.useMemo(()=>(s==null?void 0:s.type)==="group"?null:s!=null&&s.uid?s.uid:c&&c.includes("_")?c.split("_").find(R=>R!==(t==null?void 0:t.uid)):null,[s,c,t==null?void 0:t.uid]),{online:M,lastSeen:I,loading:P}=at(N),{markAsRead:D,hasCurrentUserRead:A,isMessageRead:O}=js(c,t==null?void 0:t.uid),y=a.useMemo(()=>re(),[]),z=a.useMemo(()=>c&&y?{chatId:c,limit:100}:"skip",[c,y]),_=Te(X.messages.getMessages,z),T=a.useMemo(()=>_?_.map(m=>({id:m._id,b:m.content||"",s:m.senderId,n:m.senderName,photo:m.senderPhoto||"",t:m.timestamp,edited:m.edited||!1,editedAt:m.editedAt,deleted:m.deleted||!1,deletedForAll:m.deletedForAll||!1,media:m.media,replyTo:m.replyTo,reactions:m.reactions||{}})):[],[_]),K=se(X.messages.sendMessage),Z=se(X.messages.editMessage),B=se(X.messages.deleteMessage),ie=se(X.messages.addReaction),ae=se(X.messages.removeReaction),J=se(X.conversations.updateConversation),te=se(X.conversations.updateUnreadCount);a.useEffect(()=>{S.current&&T.length>0&&S.current.scrollIntoView({behavior:"smooth"})},[T]);const ee=a.useRef(0);a.useEffect(()=>{if(c&&(t!=null&&t.uid)&&T.length>0){const m=T.map(C=>C.id),R=m.length;R!==ee.current&&(ee.current=R,D(m))}},[c,t==null?void 0:t.uid,T.length,D]),a.useEffect(()=>{T.forEach(m=>{if(m.b){const R=m.b.match(/(https?:\/\/[^\s]+)/);if(R){const C=R[0];h[m.id]||ws(C).then(V=>b(G=>({...G,[m.id]:V}))).catch(V=>console.error(V))}}})},[T]);const E=async(m,R)=>{var C,V;if(!(!c||!(t!=null&&t.uid)||!re()))try{const G=T.find(q=>q.id===m);if(!G)return;((V=(C=G.reactions)==null?void 0:C[R])==null?void 0:V.includes(t.uid))?await ae({messageId:m,userId:t.uid,emoji:R}):await ie({messageId:m,userId:t.uid,emoji:R})}catch(G){console.error("Reaction error:",G)}},H=async(m,R)=>{if(!re()||!K||!J){alert("Chat functionality is not available. Convex is not configured.");return}const C=m.b||"",V=m.media||null;for(const G of R)try{await K({chatId:G,senderId:t.uid,senderName:r.firstName||"User",senderPhoto:r.photoURL||null,content:`â†ª Forwarded: ${C}`,media:V});const F=l==null?void 0:l.find(le=>le.id===G),q=C||(V?`Forwarded ${V.type}`:"Forwarded message");await J({userId:t.uid,chatId:G,lastMessage:`â†ª ${q}`,lastMessageTime:Date.now(),lastSenderId:t.uid,chatName:(F==null?void 0:F.name)||(F==null?void 0:F.n),chatPhoto:(F==null?void 0:F.photo)||"",chatType:(F==null?void 0:F.type)||"direct",otherUserId:F==null?void 0:F.uid})}catch(F){console.error("Forward error for chat:",G,F)}},de=async(m,R)=>{var V;if(!c||!(m!=null&&m.trim())&&!R||!re()||!K||!Z||!J||!te)return;let C=m?m.trim():"";if(C.length===0&&R&&(C=R.type==="image"?"ðŸ“· Image":R.type==="video"?"ðŸŽ¥ Video":R.type==="audio"?"ðŸŽµ Audio":"ðŸ“Ž File"),g)try{await Z({messageId:g.id,content:C,senderId:t.uid}),n(null);return}catch(G){console.error("Edit error:",G);return}try{await K({chatId:c,senderId:t.uid,senderName:r.firstName||"User",senderPhoto:r.photoURL||null,content:C,media:R,replyTo:k?{messageId:k.id,text:((V=k.b)==null?void 0:V.substring(0,100))||"Media",sender:k.n||"User"}:void 0});const G=C||(R?`Sent ${R.type}`:"Message");let F=[],q=s.uid;!q&&s.type!=="group"&&c&&c.includes("_")&&(q=c.split("_").find(nt=>nt!==t.uid)),s.type==="group"?F=[t.uid]:q?F=[t.uid,q]:F=[t.uid];for(const le of F)await J({userId:le,chatId:c,lastMessage:G,lastMessageTime:Date.now(),lastSenderId:t.uid,chatName:s.type==="group"?v:s.name||s.n,chatPhoto:s.photo||"",chatType:s.type||"direct",otherUserId:s.type==="direct"?le===t.uid?q:t.uid:void 0}),le===t.uid?await te({userId:le,chatId:c,setTo:0}):await te({userId:le,chatId:c,increment:1});d(null)}catch(G){console.error("Send message error:",G)}},f=async(m,R=!1)=>{if(!(!c||!(t!=null&&t.uid)||!re()||!B))try{await B({messageId:m,senderId:t.uid,forEveryone:R})}catch(C){console.error("Delete error:",C)}},$=a.useMemo(()=>{var m;return e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-800 bg-white dark:bg-[#1f2128]",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("button",{onClick:u,className:"md:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 cursor-pointer",onClick:()=>p==null?void 0:p(N?{uid:N}:null),children:[e.jsx(me,{src:(s==null?void 0:s.photo)||((m=s==null?void 0:s.n)==null?void 0:m.photo)||"",name:v,size:"md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:v}),(s==null?void 0:s.type)!=="group"&&e.jsx(lt,{online:M,lastSeen:I,loading:P})]}),(s==null?void 0:s.type)!=="group"&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:M?"Online":I?`Last seen ${W(I)}`:"Offline"})]})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(Rt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})},[s,v,M,I,P,N,u,i,p]),W=m=>{if(!m)return"Never";const R=m,V=Date.now()-R,G=Math.floor(V/6e4),F=Math.floor(G/60),q=Math.floor(F/24);return G<1?"Just now":G<60?`${G}m ago`:F<24?`${F}h ago`:q<7?`${q}d ago`:new Date(R).toLocaleDateString()};return!s||!c?e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#1f2128] items-center justify-center text-gray-400",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx("span",{className:"text-4xl",children:"ðŸ’¬"})}),e.jsx("p",{children:"Select a conversation to start chatting"})]}):e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#1f2128]",children:[$,e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide",children:[T.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{children:"No messages yet. Start the conversation!"})}):T.map((m,R)=>{const C=R>0?T[R-1]:null,V=m.s===(t==null?void 0:t.uid),G=O(m.id),F=A(m.id);return e.jsx(ps,{message:m,isCurrentUser:V,previousMessage:C,currentUserId:t==null?void 0:t.uid,chatId:c,linkPreviewData:h[m.id],messageStatus:G?"read":F?"delivered":"sent",onReaction:q=>E(m.id,q),onReply:()=>d(m),onEdit:()=>n(m),onDelete:q=>f(m.id,q),onForward:()=>j(m),onSeshNxLinkClick:q=>w({isOpen:!0,url:q,previewData:null}),onUserClick:()=>p==null?void 0:p({uid:m.s})},m.id)}),e.jsx("div",{ref:S})]}),e.jsx(xs,{onSend:de,replyingTo:k,editingMessage:g,onCancelReply:()=>d(null),onCancelEdit:()=>n(null)}),o&&e.jsx(ys,{message:o,conversations:l,onClose:()=>j(null),onForward:H}),x.isOpen&&e.jsx(fs,{url:x.url,previewData:x.previewData,onClose:()=>w({isOpen:!1,url:"",previewData:null})})]})}function Ns({chatId:t,onClose:r,onMediaSelect:s}){const[l,u]=a.useState([]),[i,p]=a.useState(!0),[h,b]=a.useState(null),[x,w]=a.useState("all");a.useEffect(()=>{if(!t||!Q)return;const n=Ht(ne(Q,`messages/${t}`),Yt("t"),Qt(500)),o=Kt(n,j=>{const S=j.val();if(S){const v=Object.entries(S).map(([N,M])=>({id:N,...M})).filter(N=>N.media&&!N.deleted&&!N.deletedForAll).map(N=>({id:N.id,...N.media,messageId:N.id,timestamp:N.t,sender:N.n})).sort((N,M)=>(N.timestamp||0)-(M.timestamp||0));u(v)}else u([]);p(!1)});return()=>o()},[t,Q]);const k=x==="all"?l:l.filter(n=>x==="images"?n.type==="image":x==="videos"?n.type==="video":x==="audio"?n.type==="audio":x==="files"?n.type==="file":!0),d=n=>{b(n),s&&s(n)},g=n=>{const o=document.createElement("a");o.href=n.url,o.download=n.name||"download",o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)};return e.jsxs("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:[e.jsxs(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between shrink-0",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Media Gallery"}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(Y,{size:20})})]}),e.jsx("div",{className:"p-3 border-b dark:border-gray-700 flex gap-2 overflow-x-auto scrollbar-hide shrink-0",children:[{key:"all",label:"All",icon:null},{key:"images",label:"Images",icon:Pe},{key:"videos",label:"Videos",icon:ve},{key:"audio",label:"Audio",icon:ze},{key:"files",label:"Files",icon:we}].map(n=>e.jsxs("button",{onClick:()=>w(n.key),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold whitespace-nowrap transition ${x===n.key?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200"}`,children:[n.icon&&e.jsx(n.icon,{size:16}),n.label,e.jsxs("span",{className:"text-xs opacity-70",children:["(",k.filter(o=>n.key==="all"||o.type===n.key).length,")"]})]},n.key))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4",children:i?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-blue border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading media..."})]}):k.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(Pe,{size:48,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No media found"})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3",children:k.map(n=>e.jsxs(U.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d(n),className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 cursor-pointer group",children:[n.type==="image"?e.jsx("img",{src:n.url,alt:"Media",className:"w-full h-full object-cover"}):n.type==="video"?e.jsx("video",{src:n.url,className:"w-full h-full object-cover"}):n.type==="audio"?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-purple-100 dark:bg-purple-900/30",children:e.jsx(ze,{size:32,className:"text-purple-600 dark:text-purple-400"})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-100 dark:bg-blue-900/30",children:e.jsx(we,{size:32,className:"text-blue-600 dark:text-blue-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition flex items-center justify-center",children:e.jsx(Ce,{size:20,className:"text-white opacity-0 group-hover:opacity-100 transition"})})]},n.id))})})]}),e.jsx(ue,{children:h&&e.jsx(vs,{media:h,onClose:()=>b(null),onDownload:g})})]})}function vs({media:t,onClose:r,onDownload:s}){const[l,u]=a.useState([]),[i,p]=a.useState(0);a.useEffect(()=>{u([t]),p(0)},[t]);const h=()=>{i<l.length-1&&p(i+1)},b=()=>{i>0&&p(i-1)},x=l[i]||t;return e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/95 z-[90] flex items-center justify-center",onClick:r,children:e.jsxs("div",{className:"relative max-w-7xl max-h-[90vh] w-full h-full flex items-center justify-center p-4",onClick:w=>w.stopPropagation(),children:[e.jsx("button",{onClick:r,className:"absolute top-4 right-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70 transition z-10",children:e.jsx(Y,{size:24})}),x.type==="image"&&e.jsx("img",{src:x.url,alt:"Media",className:"max-w-full max-h-full object-contain rounded-lg"}),x.type==="video"&&e.jsx("video",{src:x.url,controls:!0,className:"max-w-full max-h-full rounded-lg",autoPlay:!0}),x.type==="audio"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md",children:[e.jsx("div",{className:"w-32 h-32 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(ze,{size:48,className:"text-purple-600 dark:text-purple-400"})}),e.jsx("audio",{src:x.url,controls:!0,className:"w-full",autoPlay:!0}),e.jsx("p",{className:"text-center mt-4 text-sm text-gray-500",children:x.name})]}),x.type==="file"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md text-center",children:[e.jsx(we,{size:64,className:"text-blue-600 dark:text-blue-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-bold dark:text-white mb-2",children:x.name}),e.jsx("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block mt-4 px-6 py-2 bg-brand-blue text-white rounded-lg hover:bg-blue-600 transition",children:"Open File"})]}),l.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:b,disabled:i===0,className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 transition",children:e.jsx($t,{size:24})}),e.jsx("button",{onClick:h,disabled:i===l.length-1,className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 transition",children:e.jsx(Xe,{size:24})})]}),e.jsx("button",{onClick:()=>s(x),className:"absolute bottom-4 left-1/2 -translate-x-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 transition",children:e.jsx(Ce,{size:20})})]})})}function Is({activeChat:t,onClose:r,currentUser:s}){const[l,u]=a.useState([]),[i,p]=a.useState({sessions:0,rating:0,responseTime:"N/A"}),[h,b]=a.useState(!0),[x,w]=a.useState(!1),[k,d]=a.useState(!1),g=t.type==="group",n=t.uid,o=t.name||t.n||"Unknown";a.useEffect(()=>{const c=async()=>{b(!0);try{if(u([]),!g&&n){const v=We(fe,`artifacts/${L}/users/${n}/public_profile/main`),N=await Jt(v),M=N.exists()?N.data():{},I=Xt(fe,`artifacts/${L}/public/data/bookings`),P=Ae(I,oe("senderId","==",s.uid||""),oe("targetId","==",n),oe("status","==","Completed")),D=await Zt(P);p({sessions:D.data().count,rating:M.rating||"New",responseTime:M.responseTime||"~1hr"})}}catch(v){console.error("Failed to load details:",v)}b(!1)};t!=null&&t.id&&c()},[t.id,n,g,s==null?void 0:s.uid]);const j=async()=>{if(!(g||!n||!s)&&confirm(`Are you sure you want to block ${o}?`)){w(!0);try{const c=We(fe,rs(s.uid).userProfile);await es(c,{"settings.social.blockedUsers":ts(n)}),alert("User blocked."),r()}catch(c){console.error("Block failed:",c),alert("Failed to block user.")}w(!1)}},S=()=>{alert("Please use the report option on their profile page for full moderation tools.")};return e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full md:w-80 bg-gray-800 shadow-xl z-20 flex flex-col transition-transform duration-300 ease-in-out border-l border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Details"}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-full transition duration-150","aria-label":"Close details",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 flex flex-col items-center border-b border-gray-700 bg-gray-800",children:[e.jsxs("div",{className:"relative w-24 h-24 rounded-full overflow-hidden mb-4 bg-gray-700 flex items-center justify-center shadow-lg border-4 border-gray-600",children:[e.jsx("img",{src:t.photo,className:"w-full h-full object-cover",onError:c=>c.target.src="",alt:o}),!t.photo&&(g?e.jsx(ye,{className:"w-10 h-10 text-gray-500"}):e.jsx(Ke,{className:"w-10 h-10 text-gray-500"}))]}),e.jsx("h4",{className:"text-xl font-bold text-white text-center leading-tight",children:o}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2 flex items-center px-3 py-1 bg-gray-700 rounded-full",children:[g?e.jsx(ye,{className:"w-3 h-3 mr-1"}):e.jsx(Ue,{className:"w-3 h-3 mr-1"}),g?"Group Chat":t.role||"Creative"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[!g&&e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3 tracking-wider",children:"Performance"}),h?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(xe,{className:"animate-spin text-brand-blue"})}):e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(Se,{title:"Sessions",value:i.sessions,icon:Ue,color:"text-blue-400"}),e.jsx(Se,{title:"Rating",value:i.rating,icon:Oe,color:"text-yellow-400"}),e.jsx(Se,{title:"Reply Time",value:i.responseTime,icon:Ge,color:"text-green-400"})]})]}),e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Shared Media"}),e.jsx("button",{onClick:()=>d(!0),className:"text-xs text-brand-blue hover:underline font-medium",children:"View All"})]}),l.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-2",children:l.slice(0,6).map((c,v)=>e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-700 cursor-pointer hover:opacity-80 transition",children:[c.type==="image"&&e.jsx("img",{src:c.url,className:"w-full h-full object-cover",alt:"Media"}),c.type==="video"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(ve,{size:20,className:"text-gray-400"})})]},v))}):e.jsx("p",{className:"text-xs text-gray-500 text-center py-4",children:"No shared media yet"})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition",children:[e.jsx(Mt,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{children:"Mute Notifications"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition",children:[e.jsx(zt,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Media Gallery"})]}),!g&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:j,disabled:x,className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-red-400 hover:bg-red-900/20 hover:text-red-300 rounded-lg transition disabled:opacity-50",children:[x?e.jsx(xe,{className:"w-4 h-4 animate-spin"}):e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{children:"Block User"})]}),e.jsxs("button",{onClick:S,className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-red-400 hover:bg-red-900/20 hover:text-red-300 rounded-lg transition",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Report User"})]})]})]})]}),k&&e.jsx(Ns,{chatId:t.id,onClose:()=>d(!1)})]})}export{As as C,Se as S,me as U,$s as a,L as b,X as c,fe as d,zs as e,Fs as f,rs as g,Is as h,re as i,he as j,Ms as k,Ve as s,ls as u};
