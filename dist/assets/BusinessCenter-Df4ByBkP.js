const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-Dl7DtIXW.js","assets/vendor-D33SxI2g.css"])))=>i.map(i=>d[i]);
import{r as y,j as t,b_ as we,U as Nt,c5 as St,cf as st,a1 as jt,a6 as Vt,c0 as $e,y as Gt,W as Yt,h as Ue,R as pr,d5 as fr,d6 as Ts,X as ie,d7 as kt,d8 as Bs,o as qt,cY as vt,d9 as yr,da as Ut,db as jr,dc as kr,g as Fs,dd as vr,de as wr,df as Nr,dg as Sr,F as Ze,O as qe,G as Ct,dh as Ps,di as As,T as Te,dj as Cr,dk as _r,dl as Ls,a0 as Is,dm as zr,dn as Mr,dp as Ce,c4 as Xt,ch as Ds,c6 as I,dq as Er,ce as $r,dr as Ot,ds as Rr,dt as Tr,P as Qe,M as qs,aa as Kt,du as Us,cB as Os,L as fe,am as Zt,al as Re,i as Qt,bV as Br,bW as Ss,ao as Fr,ag as Ws,dv as Pr,dw as Ke,bO as Ar,S as Hs,n as Lr,b$ as Ir,b as Dr,cX as yt,dx as Cs,cj as qr,dy as Ur,c3 as Or,c7 as Wr,c8 as Hr,aq as Vs,dz as Vr,af as Gr,cp as Yr,dA as Xr,dB as Kr,c9 as me,ca as _s,cb as zs,Y as Jt,N as Zr,K as Gs,d1 as es,Q as Qr,a8 as Jr,v as ea,dC as ta}from"./vendor-Dl7DtIXW.js";import{u as sa,s as U,f as ts}from"./chat-BYF7Vx2D.js";import{E as Ys}from"./EquipmentAutocomplete-BcGdmRJg.js";import{_ as Ms,a as ra,A as aa}from"./edu-BMUxkX2v.js";import{EQUIP_CATEGORIES as wt,AMENITIES_DATA as la,DISTRIBUTION_STORES as tt,RELEASE_TYPES as na,DDEX_GENRES as ia}from"./config-DGZTEYpI.js";import oa from"./LabelDashboard-BDBUXf-D.js";import{D as da,F as ca,G as xa}from"./index-ScyYHoNo.js";import"./vendor-framer-CUELlS5e.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new s.Error().stack;r&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[r]="c2a43b05-900d-4a31-9c8f-7e2e185133bb",s._sentryDebugIdIdentifier="sentry-dbid-c2a43b05-900d-4a31-9c8f-7e2e185133bb")})()}catch{}function Es({userData:s,stats:r,onNavigate:m}){var d;const[n,l]=y.useState(new Date),x=(s==null?void 0:s.studioName)||(s==null?void 0:s.profileName)||"My Studio",b=(s==null?void 0:s.rooms)||[],f=(s==null?void 0:s.amenities)||[],p=b.reduce((i,h)=>i+(h.capacity||0),0),u=b.length>0?Math.round(b.reduce((i,h)=>i+(h.rate||0),0)/b.length):0,g=[{label:"Active Rooms",value:b.length,icon:t.jsx(we,{size:20}),color:"blue",onClick:()=>m("rooms")},{label:"Total Capacity",value:`${p} ppl`,icon:t.jsx(Nt,{size:20}),color:"green"},{label:"Avg. Rate",value:`$${u}/hr`,icon:t.jsx(St,{size:20}),color:"purple"},{label:"Amenities",value:f.length,icon:t.jsx(st,{size:20}),color:"amber"}],j=(r==null?void 0:r.pendingBookings)||0;return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-8 text-white relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),t.jsxs("div",{className:"relative z-10",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm",children:t.jsx(we,{size:24})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:x}),t.jsxs("p",{className:"text-blue-100 text-sm flex items-center gap-1",children:[t.jsx(jt,{size:14}),s!=null&&s.city&&(s!=null&&s.state)?`${s.city}, ${s.state}`:"Location not set"]})]})]}),(s==null?void 0:s.studioDescription)&&t.jsx("p",{className:"text-blue-100 text-sm mt-4 max-w-2xl line-clamp-2",children:s.studioDescription})]})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:g.map((i,h)=>t.jsxs("button",{onClick:i.onClick,className:`bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm text-left transition-all ${i.onClick?"hover:shadow-md hover:border-brand-blue cursor-pointer":""}`,children:[t.jsx("div",{className:`w-10 h-10 rounded-lg bg-${i.color}-100 dark:bg-${i.color}-900/20 flex items-center justify-center text-${i.color}-600 dark:text-${i.color}-400 mb-3`,children:i.icon}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:i.value}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase font-medium tracking-wide",children:i.label})]},h))}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Vt,{size:18,className:"text-amber-500"}),"Pending Actions"]})}),t.jsxs("div",{className:"p-4 space-y-3",children:[j>0?t.jsxs("button",{onClick:()=>m("bookings"),className:"w-full flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30 transition",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx($e,{className:"text-amber-600",size:18}),t.jsxs("span",{className:"text-sm font-medium dark:text-amber-300",children:[j," Pending Booking",j>1?"s":""]})]}),t.jsx("span",{className:"text-xs text-amber-600 font-bold",children:"Review →"})]}):t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[t.jsx(Gt,{className:"text-green-600",size:18}),t.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"All caught up!"})]}),!(s!=null&&s.studioDescription)&&t.jsxs("button",{onClick:()=>m("settings"),className:"w-full flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition",children:[t.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Add studio description"}),t.jsx("span",{className:"text-xs text-blue-600 font-bold",children:"Setup →"})]}),b.length===0&&t.jsxs("button",{onClick:()=>m("rooms"),className:"w-full flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition",children:[t.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Add your first room"}),t.jsx("span",{className:"text-xs text-purple-600 font-bold",children:"Add →"})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(we,{size:18,className:"text-brand-blue"}),"Rooms"]}),t.jsx("button",{onClick:()=>m("rooms"),className:"text-xs text-brand-blue font-bold hover:underline",children:"Manage →"})]}),t.jsx("div",{className:"p-4",children:b.length===0?t.jsxs("div",{className:"text-center py-6 text-gray-500",children:[t.jsx(we,{size:32,className:"mx-auto mb-2 opacity-30"}),t.jsx("p",{className:"text-sm",children:"No rooms configured yet"})]}):t.jsxs("div",{className:"space-y-2",children:[b.slice(0,4).map((i,h)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white text-sm",children:i.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:[i.capacity," people • ",i.equipment?i.equipment.split(",").length:0," gear items"]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"font-bold text-green-600 dark:text-green-400",children:["$",i.rate,"/hr"]})})]},h)),b.length>4&&t.jsxs("p",{className:"text-xs text-center text-gray-400 pt-2",children:["+",b.length-4," more rooms"]})]})})]})]}),f.length>0&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-3 flex items-center gap-2",children:[t.jsx(st,{size:18,className:"text-amber-500"}),"Studio Amenities"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:f.map((i,h)=>t.jsx("span",{className:"px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:i},h))})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx($e,{size:18,className:"text-brand-blue"}),"Booking Calendar"]}),t.jsx("button",{onClick:()=>m("bookings"),className:"text-xs text-brand-blue font-bold hover:underline",children:"View All →"})]}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("button",{onClick:()=>l(new Date(n.getFullYear(),n.getMonth()-1,1)),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:t.jsx(Yt,{size:18,className:"text-gray-500"})}),t.jsx("span",{className:"font-bold dark:text-white",children:n.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),t.jsx("button",{onClick:()=>l(new Date(n.getFullYear(),n.getMonth()+1,1)),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:t.jsx(Ue,{size:18,className:"text-gray-500"})})]}),t.jsx(ga,{currentDate:n,bookings:(r==null?void 0:r.recentBookings)||[],onNavigate:m}),((d=r==null?void 0:r.recentBookings)==null?void 0:d.length)>0&&t.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Upcoming Sessions"}),t.jsx("div",{className:"space-y-2",children:r.recentBookings.slice(0,3).map((i,h)=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium dark:text-white",children:i.clientName||"Client"}),t.jsx("span",{className:"text-gray-500 ml-2",children:new Date(i.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),t.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${i.status==="confirmed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:i.status||"pending"})]},h))})]})]})]})]})}function ga({currentDate:s,bookings:r,onNavigate:m}){const n=s.getFullYear(),l=s.getMonth(),x=new Date,b=new Date(n,l,1).getDay(),f=new Date(n,l+1,0).getDate(),p=[];for(let d=0;d<b;d++)p.push(null);for(let d=1;d<=f;d++)p.push(d);const u=d=>d?r.filter(i=>{const h=new Date(i.date);return h.getDate()===d&&h.getMonth()===l&&h.getFullYear()===n}):[],g=d=>d===x.getDate()&&l===x.getMonth()&&n===x.getFullYear(),j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t.jsxs("div",{children:[t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:j.map(d=>t.jsx("div",{className:"text-center text-xs font-bold text-gray-400 py-1",children:d},d))}),t.jsx("div",{className:"grid grid-cols-7 gap-1",children:p.map((d,i)=>{const h=u(d),k=h.length>0,N=h.some($=>$.status==="confirmed"),z=h.some($=>$.status==="pending");return t.jsxs("button",{onClick:()=>d&&k&&m("bookings"),disabled:!d,className:`aspect-square flex flex-col items-center justify-center rounded-lg text-sm relative transition ${d?g(d)?"bg-brand-blue text-white font-bold":k?"bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 cursor-pointer":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700":""}`,children:[d,k&&!g(d)&&t.jsxs("div",{className:"flex gap-0.5 mt-0.5",children:[N&&t.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),z&&t.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"})]})]},i)})}),t.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-gray-500",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Confirmed"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"Pending"]})]})]})}function Xs({imageUrl:s,onClose:r,title:m="360° View"}){const n=y.useRef(null),l=y.useRef(null),[x,b]=pr.useState(!1);y.useEffect(()=>{if(!(!s||!l.current))return Promise.all([Ms(()=>import("./vendor-Dl7DtIXW.js").then(p=>p.dJ),__vite__mapDeps([0,1])),Ms(()=>import("./vendor-Dl7DtIXW.js").then(p=>p.dK),__vite__mapDeps([0,1]))]).then(([p])=>{const g=(p.default||p).viewer(l.current,{type:"equirectangular",panorama:s,autoLoad:!0,autoRotate:0,compass:!0,showControls:!0,keyboardZoom:!0,mouseZoom:!0,hfov:100,minHfov:50,maxHfov:120});n.current=g}).catch(p=>{console.error("Failed to load pannellum:",p)}),()=>{if(n.current)try{n.current.destroy()}catch(p){console.error("Error destroying viewer:",p)}}},[s]);const f=()=>{l.current&&(x?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():l.current.requestFullscreen?l.current.requestFullscreen():l.current.webkitRequestFullscreen?l.current.webkitRequestFullscreen():l.current.mozRequestFullScreen?l.current.mozRequestFullScreen():l.current.msRequestFullscreen&&l.current.msRequestFullscreen(),b(!x))};return y.useEffect(()=>{const p=()=>{b(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",p),document.addEventListener("webkitfullscreenchange",p),document.addEventListener("mozfullscreenchange",p),document.addEventListener("MSFullscreenChange",p),()=>{document.removeEventListener("fullscreenchange",p),document.removeEventListener("webkitfullscreenchange",p),document.removeEventListener("mozfullscreenchange",p),document.removeEventListener("MSFullscreenChange",p)}},[]),s?t.jsxs("div",{className:"relative w-full rounded-lg overflow-hidden border dark:border-gray-700 bg-black",children:[t.jsxs("div",{className:"absolute top-0 left-0 right-0 z-10 bg-gradient-to-b from-black/70 to-transparent p-3 flex justify-between items-center",children:[t.jsx("h3",{className:"text-white font-semibold text-sm",children:m}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:f,className:"p-2 bg-black/50 hover:bg-black/70 rounded-lg text-white transition",title:x?"Exit Fullscreen":"Fullscreen",children:x?t.jsx(fr,{size:18}):t.jsx(Ts,{size:18})}),r&&t.jsx("button",{onClick:r,className:"p-2 bg-black/50 hover:bg-black/70 rounded-lg text-white transition",title:"Close",children:t.jsx(ie,{size:18})})]})]}),t.jsx("div",{ref:l,className:"w-full h-96",style:{minHeight:"400px"}})]}):t.jsx("div",{className:"w-full h-64 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center",children:t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No 360° image available"})})}function ma({activeTool:s,setActiveTool:r,onUndo:m,onRedo:n,canUndo:l,canRedo:x,onZoomIn:b,onZoomOut:f,onFitToView:p,onExportSVG:u,onExportPNG:g,onExportPDF:j,showGrid:d,toggleGrid:i,measurementUnit:h,setMeasurementUnit:k,scale:N,setScale:z,onBackgroundImageUpload:$,onAddRoomTemplate:M}){const A=[{id:"select",icon:Bs,label:"Select",group:"basic"},{id:"wall",icon:qt,label:"Wall",group:"basic"},{id:"room",icon:qt,label:"Room",group:"basic"},{id:"structure",icon:vt,label:"Area",group:"basic"},{id:"door",icon:yr,label:"Door",group:"elements"},{id:"window",icon:Ut,label:"Window",group:"elements"},{id:"furniture",icon:vt,label:"Furniture",group:"elements"},{id:"measure",icon:jr,label:"Measure",group:"tools"},{id:"text",icon:kr,label:"Text",group:"tools"},{id:"circle",icon:Fs,label:"Circle",group:"shapes"},{id:"polygon",icon:vr,label:"Polygon",group:"shapes"}];return t.jsxs("div",{className:"flex flex-col gap-2 p-2 bg-white dark:bg-[#2c2e36] border-r dark:border-gray-700",children:[t.jsxs("div",{className:"flex gap-1 pb-2 border-b dark:border-gray-700",children:[t.jsx("button",{onClick:m,disabled:!l,className:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",title:"Undo (Ctrl+Z)",children:t.jsx(kt,{size:18,className:"rotate-180"})}),t.jsx("button",{onClick:n,disabled:!x,className:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",title:"Redo (Ctrl+Shift+Z)",children:t.jsx(kt,{size:18})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Basic"}),A.filter(v=>v.group==="basic").map(v=>{const R=v.icon;return t.jsxs("button",{onClick:()=>r(v.id),className:`w-full p-2 rounded flex items-center gap-2 text-sm transition ${s===v.id?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:v.label,children:[t.jsx(R,{size:16}),t.jsx("span",{className:"text-xs",children:v.label})]},v.id)}),t.jsxs("div",{className:"pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Templates"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("button",{onClick:()=>{M&&M({name:"Control Room",width:200,height:150,color:"#3B82F6"})},className:"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:"Control Room"}),t.jsx("button",{onClick:()=>{M&&M({name:"Live Room",width:300,height:250,color:"#10B981"})},className:"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:"Live Room"}),t.jsx("button",{onClick:()=>{M&&M({name:"Isolation Booth",width:120,height:120,color:"#F59E0B"})},className:"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:"Isolation Booth"})]})]})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Elements"}),A.filter(v=>v.group==="elements").map(v=>{const R=v.icon;return t.jsxs("button",{onClick:()=>r(v.id),className:`w-full p-2 rounded flex items-center gap-2 text-sm transition ${s===v.id?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:v.label,children:[t.jsx(R,{size:16}),t.jsx("span",{className:"text-xs",children:v.label})]},v.id)})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Tools"}),A.filter(v=>v.group==="tools").map(v=>{const R=v.icon;return t.jsxs("button",{onClick:()=>r(v.id),className:`w-full p-2 rounded flex items-center gap-2 text-sm transition ${s===v.id?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:v.label,children:[t.jsx(R,{size:16}),t.jsx("span",{className:"text-xs",children:v.label})]},v.id)})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Shapes"}),A.filter(v=>v.group==="shapes").map(v=>{const R=v.icon;return t.jsxs("button",{onClick:()=>r(v.id),className:`w-full p-2 rounded flex items-center gap-2 text-sm transition ${s===v.id?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:v.label,children:[t.jsx(R,{size:16}),t.jsx("span",{className:"text-xs",children:v.label})]},v.id)})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"View"}),t.jsx("button",{onClick:b,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",title:"Zoom In",children:t.jsx(wr,{size:16})}),t.jsx("button",{onClick:f,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",title:"Zoom Out",children:t.jsx(Nr,{size:16})}),t.jsx("button",{onClick:p,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",title:"Fit to View",children:t.jsx(Ts,{size:16})}),t.jsxs("button",{onClick:i,className:`w-full p-2 rounded flex items-center gap-2 text-sm ${d?"bg-brand-blue text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,title:"Toggle Grid",children:[t.jsx(Sr,{size:16}),t.jsx("span",{className:"text-xs",children:"Grid"})]})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Export"}),t.jsxs("button",{onClick:u,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2",title:"Export SVG",children:[t.jsx(Ze,{size:16}),t.jsx("span",{className:"text-xs",children:"SVG"})]}),t.jsxs("button",{onClick:g,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2",title:"Export PNG",children:[t.jsx(qe,{size:16}),t.jsx("span",{className:"text-xs",children:"PNG"})]}),t.jsxs("button",{onClick:j,className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2",title:"Export PDF",children:[t.jsx(Ze,{size:16}),t.jsx("span",{className:"text-xs",children:"PDF"})]})]}),t.jsxs("div",{className:"space-y-1 pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1",children:"Background"}),t.jsxs("label",{className:"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2 cursor-pointer",children:[t.jsx(qe,{size:16}),t.jsx("span",{className:"text-xs",children:"Import Image"}),t.jsx("input",{type:"file",accept:"image/*",onChange:v=>{var w;((w=v.target.files)==null?void 0:w[0])&&$&&$(v)},className:"hidden"})]})]}),t.jsxs("div",{className:"pt-2 border-t dark:border-gray-700",children:[t.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase px-2 py-1 mb-2",children:"Scale"}),t.jsxs("select",{value:N,onChange:v=>z(Number(v.target.value)),className:"w-full p-1.5 text-xs rounded border dark:border-gray-600 dark:bg-[#1f2128] dark:text-white",children:[t.jsx("option",{value:10,children:"1px = 1ft"}),t.jsx("option",{value:20,children:"1px = 0.5ft"}),t.jsx("option",{value:5,children:"1px = 2ft"})]}),t.jsxs("select",{value:h,onChange:v=>k(v.target.value),className:"w-full p-1.5 text-xs rounded border dark:border-gray-600 dark:bg-[#1f2128] dark:text-white mt-2",children:[t.jsx("option",{value:"ft",children:"Feet"}),t.jsx("option",{value:"m",children:"Meters"})]})]})]})}const Wt=(s,r,m,n)=>Math.sqrt(Math.pow(m-s,2)+Math.pow(n-r,2)),Ht=(s,r,m=1)=>{const n=s*r/(m*m);return{sqft:n,sqm:n*.092903,display:`${n.toFixed(1)} sq ft (${(n*.092903).toFixed(1)} m²)`}},ua=(s,r,m=1)=>{const n=2*(s+r)/m;return{feet:n,meters:n*.3048,display:`${n.toFixed(1)} ft (${(n*.3048).toFixed(1)} m)`}},ha=(s,r,m)=>({x:Math.round(s/m)*m,y:Math.round(r/m)*m}),ba=(s,r,m,n=10)=>{let l={x:s,y:r},x=n;return m.forEach(b=>{var d,i,h,k;const f=((d=b.layout)==null?void 0:d.x)||b.x||0,p=((i=b.layout)==null?void 0:i.y)||b.y||0,u=((h=b.layout)==null?void 0:h.width)||b.width||0,g=((k=b.layout)==null?void 0:k.height)||b.height||0;[{x:f,y:p},{x:f+u,y:p},{x:f+u,y:p+g},{x:f,y:p+g},{x:f+u/2,y:p},{x:f+u,y:p+g/2},{x:f+u/2,y:p+g},{x:f,y:p+g/2}].forEach(N=>{const z=Wt(s,r,N.x,N.y);z<x&&(x=z,l=N)})}),l},rt=(s,r=1,m="ft")=>{const n=s/r;return m==="ft"?`${n.toFixed(1)} ft`:m==="m"?`${(n*.3048).toFixed(2)} m`:`${n.toFixed(1)}`},pa=(s,r,m)=>{const l=new XMLSerializer().serializeToString(s),x=new Blob([l],{type:"image/svg+xml;charset=utf-8"}),b=URL.createObjectURL(x);return{svgString:l,url:b,blob:x}},fa=async(s,r,m,n=2)=>{const l=document.createElement("canvas");l.width=r*n,l.height=m*n;const x=l.getContext("2d"),b=new XMLSerializer().serializeToString(s),f=new Image,p=new Blob([b],{type:"image/svg+xml;charset=utf-8"}),u=URL.createObjectURL(p);return new Promise((g,j)=>{f.onload=()=>{x.fillStyle="white",x.fillRect(0,0,l.width,l.height),x.drawImage(f,0,0,l.width,l.height),l.toBlob(d=>{URL.revokeObjectURL(u),g(d)},"image/png")},f.onerror=j,f.src=u})},Ee=(s="item")=>`${s}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;function ya({selectedItem:s,onClose:r,onUpdate:m,scale:n=10,unit:l="ft"}){if(!s)return null;const x=s.layout&&s.name,b=s.layout&&s.label,f=s.x1!==void 0,p=s.type==="door",u=s.type==="window",g=s.type==="furniture",j=s.layout||{},d=j.width&&j.height?Ht(j.width,j.height,n):null,i=j.width&&j.height?ua(j.width,j.height,n):null,h=k=>{m({...s,...k})};return t.jsxs("div",{className:"w-64 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 p-4 overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"font-bold text-sm dark:text-white",children:"Properties"}),t.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:t.jsx(ie,{size:16})})]}),x&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Name"}),t.jsx("input",{type:"text",value:s.name||"",onChange:k=>h({name:k.target.value}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Position"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(j.x||0),onChange:k=>h({layout:{...j,x:Number(k.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:"X"}),t.jsx("input",{type:"number",value:Math.round(j.y||0),onChange:k=>h({layout:{...j,y:Number(k.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:"Y"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Size"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("input",{type:"number",value:Math.round(j.width||0),onChange:k=>h({layout:{...j,width:Number(k.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:"Width"}),t.jsx("span",{className:"text-xs text-gray-500",children:rt(j.width||0,n,l)})]}),t.jsxs("div",{children:[t.jsx("input",{type:"number",value:Math.round(j.height||0),onChange:k=>h({layout:{...j,height:Number(k.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:"Height"}),t.jsx("span",{className:"text-xs text-gray-500",children:rt(j.height||0,n,l)})]})]})]}),d&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Area"}),t.jsx("div",{className:"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm",children:d.display})]}),i&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Perimeter"}),t.jsx("div",{className:"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm",children:i.display})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Color"}),t.jsx("input",{type:"color",value:j.color||"#3B82F6",onChange:k=>h({layout:{...j,color:k.target.value}}),className:"w-full h-10 border rounded cursor-pointer"})]}),s.rotation!==void 0&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Rotation"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"number",value:s.rotation||0,onChange:k=>h({rotation:Number(k.target.value)}),className:"flex-1 p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",min:"0",max:"360"}),t.jsx("button",{onClick:()=>h({rotation:((s.rotation||0)+90)%360}),className:"p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-700",title:"Rotate 90°",children:t.jsx(kt,{size:16})})]})]})]}),b&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Label"}),t.jsx("input",{type:"text",value:s.label||"",onChange:k=>h({label:k.target.value}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Position"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(j.x||0),onChange:k=>h({layout:{...j,x:Number(k.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(j.y||0),onChange:k=>h({layout:{...j,y:Number(k.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Size"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(j.width||0),onChange:k=>h({layout:{...j,width:Number(k.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(j.height||0),onChange:k=>h({layout:{...j,height:Number(k.target.value)}}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]})]}),f&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Start Point"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(s.x1||0),onChange:k=>h({x1:Number(k.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(s.y1||0),onChange:k=>h({y1:Number(k.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"End Point"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(s.x2||0),onChange:k=>h({x2:Number(k.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(s.y2||0),onChange:k=>h({y2:Number(k.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Length"}),t.jsx("div",{className:"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm",children:rt(Math.sqrt(Math.pow((s.x2||0)-(s.x1||0),2)+Math.pow((s.y2||0)-(s.y1||0),2)),n,l)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Thickness"}),t.jsx("input",{type:"number",value:s.strokeWidth||5,onChange:k=>h({strokeWidth:Number(k.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",min:"1",max:"20"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Color"}),t.jsx("input",{type:"color",value:s.stroke||"#52525B",onChange:k=>h({stroke:k.target.value}),className:"w-full h-10 border rounded cursor-pointer"})]})]}),(p||u||g)&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Type"}),t.jsx("input",{type:"text",value:s.subType||"",onChange:k=>h({subType:k.target.value}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",placeholder:p?"Single, Double, Sliding...":u?"Standard, Bay...":"Chair, Table..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Position"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("input",{type:"number",value:Math.round(s.x||0),onChange:k=>h({x:Number(k.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("input",{type:"number",value:Math.round(s.y||0),onChange:k=>h({y:Number(k.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]}),s.rotation!==void 0&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Rotation"}),t.jsx("input",{type:"number",value:s.rotation||0,onChange:k=>h({rotation:Number(k.target.value)}),className:"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",min:"0",max:"360"})]})]})]})}function ja({x:s,y:r,onClose:m,onAction:n,canCopy:l,canPaste:x,canCut:b,canDelete:f,canRotate:p,canFlip:u,isLocked:g}){if(!s||!r)return null;const j=[{id:"copy",label:"Copy",icon:Ct,disabled:!l,shortcut:"Ctrl+C"},{id:"paste",label:"Paste",icon:Ps,disabled:!x,shortcut:"Ctrl+V"},{id:"cut",label:"Cut",icon:As,disabled:!b,shortcut:"Ctrl+X"},{id:"separator1"},{id:"delete",label:"Delete",icon:Te,disabled:!f,shortcut:"Del"},{id:"separator2"},{id:"rotate",label:"Rotate 90°",icon:kt,disabled:!p},{id:"flipH",label:"Flip Horizontal",icon:Cr,disabled:!u},{id:"flipV",label:"Flip Vertical",icon:_r,disabled:!u},{id:"separator3"},{id:"lock",label:g?"Unlock":"Lock",icon:g?Ls:Is},{id:"separator4"},{id:"bringToFront",label:"Bring to Front",icon:zr},{id:"sendToBack",label:"Send to Back",icon:Mr}];return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-50",onClick:m}),t.jsx("div",{className:"fixed z-50 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-lg shadow-lg py-1 min-w-[180px]",style:{left:`${s}px`,top:`${r}px`},children:j.map((d,i)=>{if(d.id.startsWith("separator"))return t.jsx("div",{className:"border-t dark:border-gray-700 my-1"},i);const h=d.icon;return t.jsxs("button",{onClick:()=>{n(d.id),m()},disabled:d.disabled,className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 dark:text-white",children:[t.jsx(h,{size:16}),t.jsx("span",{className:"flex-1",children:d.label}),d.shortcut&&t.jsx("span",{className:"text-xs text-gray-500",children:d.shortcut})]},d.id)})})]})}function ka({layers:s,onLayerToggle:r,onLayerLock:m}){const n=[{key:"structures",label:"Structures",icon:Ce},{key:"rooms",label:"Rooms",icon:Ce},{key:"walls",label:"Walls",icon:Ce},{key:"doors",label:"Doors",icon:Ce},{key:"windows",label:"Windows",icon:Ce},{key:"furniture",label:"Furniture",icon:Ce},{key:"text",label:"Text Labels",icon:Ce},{key:"measurements",label:"Measurements",icon:Ce}];return t.jsxs("div",{className:"w-48 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 p-3",children:[t.jsxs("h3",{className:"font-bold text-sm dark:text-white mb-3 flex items-center gap-2",children:[t.jsx(Ce,{size:16}),"Layers"]}),t.jsx("div",{className:"space-y-1",children:n.map(l=>{const x=s[l.key]||{visible:!0,locked:!1};return l.icon,t.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[t.jsx("button",{onClick:()=>r(l.key),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:x.visible?t.jsx(Xt,{size:16}):t.jsx(Ds,{size:16})}),t.jsx("span",{className:"text-xs dark:text-white",children:l.label})]}),t.jsx("button",{onClick:()=>m(l.key),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:x.locked?t.jsx(Is,{size:14}):t.jsx(Ls,{size:14})})]},l.key)})})]})}function va({door:s,isSelected:r,onClick:m,onMouseDown:n}){const{x:l,y:x,width:b=30,height:f=60,rotation:p=0,subType:u="single",direction:g="left"}=s,j=l+b/2,d=x+f/2,i=b;return t.jsxs("g",{onClick:m,onMouseDown:n,cursor:"pointer",style:{filter:r?"drop-shadow(0 0 3px #3D84ED)":"none"},children:[t.jsx("rect",{x:l,y:x,width:b,height:f,fill:"none",stroke:r?"#3D84ED":"#8B5CF6",strokeWidth:r?3:2,rx:2}),t.jsx("rect",{x:l+2,y:x+2,width:b-4,height:f-4,fill:"#F3F4F6",stroke:"#8B5CF6",strokeWidth:1}),t.jsx("path",{d:`M ${j} ${d} A ${i} ${i} 0 0 1 ${g==="left"?l:l+b} ${x}`,fill:"none",stroke:"#8B5CF6",strokeWidth:1,strokeDasharray:"3,3",opacity:"0.5"}),t.jsx("circle",{cx:g==="left"?l+b-8:l+8,cy:x+f/2,r:3,fill:"#8B5CF6"}),r&&t.jsx("rect",{x:l-4,y:x-4,width:b+8,height:f+8,fill:"none",stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"})]})}function wa({window:s,isSelected:r,onClick:m,onMouseDown:n}){const{x:l,y:x,width:b=40,height:f=60,rotation:p=0,subType:u="standard"}=s;return t.jsxs("g",{onClick:m,onMouseDown:n,cursor:"pointer",style:{filter:r?"drop-shadow(0 0 3px #3D84ED)":"none"},children:[t.jsx("rect",{x:l,y:x,width:b,height:f,fill:"#E0F2FE",stroke:r?"#3D84ED":"#0EA5E9",strokeWidth:r?3:2,rx:2,opacity:"0.7"}),t.jsx("line",{x1:l+b/2,y1:x,x2:l+b/2,y2:x+f,stroke:"#0EA5E9",strokeWidth:1}),t.jsx("line",{x1:l,y1:x+f/2,x2:l+b,y2:x+f/2,stroke:"#0EA5E9",strokeWidth:1}),r&&t.jsx("rect",{x:l-4,y:x-4,width:b+8,height:f+8,fill:"none",stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"})]})}function Na({furniture:s,isSelected:r,onClick:m,onMouseDown:n}){const{x:l,y:x,width:b=40,height:f=40,rotation:p=0,subType:u="box"}=s,j={box:vt,sofa:Ut,chair:qt,table:Fs,bed:Ut}[u]||vt,d=l+b/2,i=x+f/2;return t.jsxs("g",{onClick:m,onMouseDown:n,cursor:"pointer",transform:`translate(${d}, ${i}) rotate(${p}) translate(${-d}, ${-i})`,style:{filter:r?"drop-shadow(0 0 3px #3D84ED)":"none"},children:[t.jsx("rect",{x:l,y:x,width:b,height:f,fill:"#FEF3C7",stroke:r?"#3D84ED":"#F59E0B",strokeWidth:r?3:2,rx:4}),t.jsx("foreignObject",{x:l+b/2-12,y:x+f/2-12,width:24,height:24,children:t.jsx("div",{className:"flex items-center justify-center w-full h-full",children:t.jsx(j,{size:20,className:"text-amber-600"})})}),r&&t.jsx("rect",{x:l-4,y:x-4,width:b+8,height:f+8,fill:"none",stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"})]})}function Sa(s,r=50){const[m,n]=y.useState(s),l=y.useRef([s]),x=y.useRef(0),b=y.useCallback(d=>{x.current<l.current.length-1&&(l.current=l.current.slice(0,x.current+1)),l.current.push(d),l.current.length>r?l.current.shift():x.current++,n(d)},[r]),f=y.useCallback(()=>{x.current>0&&(x.current--,n(l.current[x.current]))},[]),p=y.useCallback(()=>{x.current<l.current.length-1&&(x.current++,n(l.current[x.current]))},[]),u=x.current>0,g=x.current<l.current.length-1,j=y.useCallback(()=>{l.current=[m],x.current=0},[m]);return{state:m,setState:b,undo:f,redo:p,canUndo:u,canRedo:g,clearHistory:j}}const It=10,Ca=(s,r,m,n,l,x)=>{const b=s-m,f=r-n,p=l-m,u=x-n,g=b*p+f*u,j=p*p+u*u;let d=-1;j!==0&&(d=g/j);let i,h;d<0?(i=m,h=n):d>1?(i=l,h=x):(i=m+d*p,h=n+d*u);const k=s-i,N=r-h;return Math.sqrt(k*k+N*N)};function _a({rooms:s,walls:r,structures:m,onRoomClick:n,onLayoutChange:l,onWallsChange:x,onStructuresChange:b}){var xs,gs,ms,us,hs,bs,ps,fs,ys,js,ks;const f=y.useRef(null),p=y.useRef(null),[u,g]=y.useState(!1),[j,d]=y.useState(!1),[i,h]=y.useState({x:0,y:0}),[k,N]=y.useState(!1),[z,$]=y.useState({x:0,y:0}),[M,A]=y.useState(null),[v,R]=y.useState(null),[w,B]=y.useState(null),[T,S]=y.useState(null),[F,O]=y.useState(null),[D,J]=y.useState(null),[ue,ye]=y.useState(new Set),[oe,C]=y.useState(null),[V,H]=y.useState(null),[Z,he]=y.useState(null),[Oe,se]=y.useState(!1),[ee,Be]=y.useState(r||[]),[Q,_e]=y.useState(m||[]),[ne,at]=y.useState([]),[ge,lt]=y.useState([]),[de,nt]=y.useState([]),[We,_t]=y.useState([]),[zt,E]=y.useState([]),[q,W]=y.useState(null),[G,K]=y.useState(null),[re,Fe]=y.useState([]),[ce,it]=y.useState({structures:{visible:!0,locked:!1},rooms:{visible:!0,locked:!1},walls:{visible:!0,locked:!1},doors:{visible:!0,locked:!1},windows:{visible:!0,locked:!1},furniture:{visible:!0,locked:!1},text:{visible:!0,locked:!1},measurements:{visible:!0,locked:!1}}),[Mt,Et]=y.useState([{name:"Control Room",width:200,height:150,color:"#3B82F6"},{name:"Live Room",width:300,height:250,color:"#10B981"},{name:"Isolation Booth",width:120,height:120,color:"#F59E0B"},{name:"Lounge",width:250,height:200,color:"#8B5CF6"}]),[Y,be]=y.useState("select"),[ae,xe]=y.useState(null),[le,He]=y.useState(null),[te,Pe]=y.useState(null),[Ve,$t]=y.useState(1),[ot,dl]=y.useState({x:0,y:0,width:800,height:600}),[Rt,Zs]=y.useState(!0),[Ge,cl]=y.useState(It),[Ae,Qs]=y.useState(10),[Je,Js]=y.useState("ft"),[er,xl]=y.useState(!0),je={walls:ee,structures:Q,doors:ne,windows:ge,furniture:de,textLabels:We},{setState:Ne,undo:Tt,redo:Bt,canUndo:tr,canRedo:sr}=Sa(je),Ft=800,Pt=600;y.useEffect(()=>{Be(r||[])},[r]),y.useEffect(()=>{_e(m||[])},[m]);const Le=(a,c=!0)=>{if(!f.current)return{x:0,y:0};const _=f.current.getBoundingClientRect();let o=a.clientX,P=a.clientY;a.touches&&a.touches.length>0&&(o=a.touches[0].clientX,P=a.touches[0].clientY);let L=(o-_.left)/(c?Ve:1)-z.x,et=(P-_.top)/(c?Ve:1)-z.y;const ve=ha(L,et,Ge);if(er&&Y==="select"){const pt=[...s,...Q,...ee.map(pe=>({x:pe.x1,y:pe.y1,width:pe.x2-pe.x1,height:pe.y2-pe.y1}))];return ba(ve.x,ve.y,pt,10)}return ve},dt=(a,c=!0)=>{Be(a),x(a),c&&Ne({...je,walls:a})},ct=(a,c=!0)=>{_e(a),b(a),c&&Ne({...je,structures:a})},xt=(a,c=!0)=>{at(a),c&&Ne({...je,doors:a})},gt=(a,c=!0)=>{lt(a),c&&Ne({...je,windows:a})},mt=(a,c=!0)=>{nt(a),c&&Ne({...je,furniture:a})},Ye=y.useCallback(()=>{if(v){const a=Q.filter(c=>c.id!==v);ct(a),R(null),se(!1)}else if(w){const a=ee.filter(c=>c.id!==w);dt(a),B(null),se(!1)}else if(T){const a=ne.filter(c=>c.id!==T);xt(a),S(null),se(!1)}else if(F){const a=ge.filter(c=>c.id!==F);gt(a),O(null),se(!1)}else if(D){const a=de.filter(c=>c.id!==D);mt(a),J(null),se(!1)}else M&&(A(null),se(!1))},[v,w,T,F,D,M,Q,ee,ne,ge,de]),Xe=y.useCallback(()=>{if(v){const a=Q.find(c=>c.id===v);a&&K({type:"structure",data:a})}else if(w){const a=ee.find(c=>c.id===w);a&&K({type:"wall",data:a})}},[v,w,Q,ee]),ut=y.useCallback(()=>{if(!G)return;const a=20;if(G.type==="structure"){const c={...G.data,id:`struct_${Date.now()}`,layout:{...G.data.layout,x:G.data.layout.x+a,y:G.data.layout.y+a}};ct([...Q,c]),R(c.id)}else if(G.type==="wall"){const c={...G.data,id:`wall_${Date.now()}`,x1:G.data.x1+a,y1:G.data.y1+a,x2:G.data.x2+a,y2:G.data.y2+a};dt([...ee,c]),B(c.id)}},[G,Q,ee]),ht=y.useCallback(()=>{Xe(),Ye()},[Xe,Ye]);y.useEffect(()=>{const a=c=>{if((c.ctrlKey||c.metaKey)&&c.key==="z"&&!c.shiftKey){c.preventDefault(),Tt();return}if((c.ctrlKey||c.metaKey)&&(c.key==="y"||c.key==="z"&&c.shiftKey)){c.preventDefault(),Bt();return}(c.key==="Delete"||c.key==="Backspace")&&Ye(),(c.ctrlKey||c.metaKey)&&c.key==="c"&&(c.preventDefault(),Xe()),(c.ctrlKey||c.metaKey)&&c.key==="v"&&(c.preventDefault(),ut()),(c.ctrlKey||c.metaKey)&&c.key==="x"&&(c.preventDefault(),ht()),(c.ctrlKey||c.metaKey)&&c.key==="="&&(c.preventDefault(),ls()),(c.ctrlKey||c.metaKey)&&c.key==="-"&&(c.preventDefault(),ns()),(c.ctrlKey||c.metaKey)&&c.key==="0"&&(c.preventDefault(),is())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[Ye,Xe,ut,ht,Tt,Bt]);const ss=y.useCallback((a,c)=>{if(Y!=="select")return;a.preventDefault(),a.stopPropagation();const{x:_,y:o}=Le(a);A(c.id),R(null),B(null),g(!0),d(!1),h({x:_-c.layout.x,y:o-c.layout.y})},[Y]),ze=y.useCallback((a,c,_)=>{a.preventDefault(),a.stopPropagation(),A(c.id),R(null),B(null),S(null),O(null),J(null),g(!1),d(_)},[]),rr=y.useCallback(a=>{Y==="select"&&(a.button===1||a.ctrlKey||a.metaKey||a.space)&&(a.preventDefault(),N({startX:a.clientX,startY:a.clientY}))},[Y]),bt=y.useCallback(()=>{N(!1)},[]),ar=()=>{const a={id:`struct_${Date.now()}`,label:"Lobby / Area",layout:{x:100,y:100,width:150,height:100,color:"#94a3b8"}};ct([...Q,a]),be("select")},rs=y.useCallback((a,c)=>{if(Y!=="select")return;a.preventDefault(),a.stopPropagation();const{x:_,y:o}=Le(a);R(c.id),A(null),B(null),g(!0),d(!1),h({x:_-c.layout.x,y:o-c.layout.y})},[Y]),Me=y.useCallback((a,c,_)=>{a.preventDefault(),a.stopPropagation(),R(c.id),A(null),B(null),g(!1),d(_)},[]),as=y.useCallback((a,c,_)=>{Y==="select"&&(a.preventDefault(),a.stopPropagation(),C({id:c,point:_}),A(null),R(null),B(c))},[Y]),lr=(a,c)=>{Y==="select"&&(a.stopPropagation(),B(c),A(null),R(null))},Ie=y.useCallback(a=>{if(!f.current)return;const{x:c,y:_}=Le(a);if(Y==="wall"&&ae){const o={id:"preview",x1:ae.x,y1:ae.y,x2:c,y2:_};Be(P=>[...P.filter(L=>L.id!=="preview"),o]);return}if(oe){Be(o=>o.map(P=>P.id!==oe.id?P:oe.point==="start"?{...P,x1:c,y1:_}:{...P,x2:c,y2:_}));return}if(u){const o={x:c-i.x,y:_-i.y};if(M){const P=s.find(L=>L.id===M);P&&l(M,{...P.layout,...o})}else v?_e(P=>P.map(L=>L.id===v?{...L,layout:{...L.layout,...o}}:L)):T?at(P=>P.map(L=>L.id===T?{...L,x:o.x,y:o.y}:L)):F?lt(P=>P.map(L=>L.id===F?{...L,x:o.x,y:o.y}:L)):D&&nt(P=>P.map(L=>L.id===D?{...L,x:o.x,y:o.y}:L))}if(j){if(M){const o=s.find(P=>P.id===M);if(o){let P={...o.layout};const L=It;j==="br"?(P.width=Math.max(L,c-o.layout.x),P.height=Math.max(L,_-o.layout.y)):j==="bl"?(P.width=Math.max(L,o.layout.x+o.layout.width-c),P.height=Math.max(L,_-o.layout.y),P.x=Math.min(c,o.layout.x+o.layout.width-L)):j==="tr"?(P.width=Math.max(L,c-o.layout.x),P.height=Math.max(L,o.layout.y+o.layout.height-_),P.y=Math.min(_,o.layout.y+o.layout.height-L)):j==="tl"?(P.width=Math.max(L,o.layout.x+o.layout.width-c),P.height=Math.max(L,o.layout.y+o.layout.height-_),P.x=Math.min(c,o.layout.x+o.layout.width-L),P.y=Math.min(_,o.layout.y+o.layout.height-L)):j==="t"?(P.height=Math.max(L,o.layout.y+o.layout.height-_),P.y=Math.min(_,o.layout.y+o.layout.height-L)):j==="r"?P.width=Math.max(L,c-o.layout.x):j==="b"?P.height=Math.max(L,_-o.layout.y):j==="l"&&(P.width=Math.max(L,o.layout.x+o.layout.width-c),P.x=Math.min(c,o.layout.x+o.layout.width-L)),l(M,P)}}else if(v){const o=Q.find(P=>P.id===v);if(o){let P={...o.layout};const L=It;j==="br"?(P.width=Math.max(L,c-o.layout.x),P.height=Math.max(L,_-o.layout.y)):j==="bl"?(P.width=Math.max(L,o.layout.x+o.layout.width-c),P.height=Math.max(L,_-o.layout.y),P.x=Math.min(c,o.layout.x+o.layout.width-L)):j==="tr"?(P.width=Math.max(L,c-o.layout.x),P.height=Math.max(L,o.layout.y+o.layout.height-_),P.y=Math.min(_,o.layout.y+o.layout.height-L)):j==="tl"?(P.width=Math.max(L,o.layout.x+o.layout.width-c),P.height=Math.max(L,o.layout.y+o.layout.height-_),P.x=Math.min(c,o.layout.x+o.layout.width-L),P.y=Math.min(_,o.layout.y+o.layout.height-L)):j==="t"?(P.height=Math.max(L,o.layout.y+o.layout.height-_),P.y=Math.min(_,o.layout.y+o.layout.height-L)):j==="r"?P.width=Math.max(L,c-o.layout.x):j==="b"?P.height=Math.max(L,_-o.layout.y):j==="l"&&(P.width=Math.max(L,o.layout.x+o.layout.width-c),P.x=Math.min(c,o.layout.x+o.layout.width-L)),_e(et=>et.map(ve=>ve.id===v?{...ve,layout:P}:ve))}}}if(Y==="measure"&&le){const o=Wt(le.x,le.y,c,_);Pe({x1:le.x,y1:le.y,x2:c,y2:_,distance:rt(o,Ae,Je)})}if(k&&(a.buttons===1||a.touches)){const o=a.movementX||(a.touches?a.touches[0].clientX-(k.startX||0):0),P=a.movementY||(a.touches?a.touches[0].clientY-(k.startY||0):0);$(L=>({x:L.x+o/Ve,y:L.y+P/Ve})),a.touches&&N({...k,startX:a.touches[0].clientX,startY:a.touches[0].clientY})}},[M,v,u,j,oe,i,s,l,Y,ae]),De=y.useCallback(()=>{(u||j)&&(v?(b(Q),Ne({...je,structures:Q})):T?xt(ne):F?gt(ge):D&&mt(de)),oe&&(x(ee),Ne({...je,walls:ee})),g(!1),d(!1),C(null)},[u,j,oe,v,T,F,D,Q,ee,ne,ge,de,b,x,je,Ne]),nr=y.useCallback(a=>{if(u||j||k)return;const{x:c,y:_}=Le(a);if(Y==="wall"){if(a.stopPropagation(),!ae)xe({x:c,y:_});else{const o={id:Ee("wall"),x1:ae.x,y1:ae.y,x2:c,y2:_,stroke:"#52525B",strokeWidth:5};dt([...ee.filter(P=>P.id!=="preview"),o]),xe(null)}return}if(Y==="measure"){if(a.stopPropagation(),!le)He({x:c,y:_});else{const o=Wt(le.x,le.y,c,_),P={id:Ee("measure"),x1:le.x,y1:le.y,x2:c,y2:_,distance:rt(o,Ae,Je)};E(L=>[...L,P]),He(null),Pe(null)}return}if(Y==="door"){a.stopPropagation();const o={id:Ee("door"),type:"door",x:c-15,y:_-30,width:30,height:60,subType:"single",direction:"left"};xt([...ne,o]),S(o.id);return}if(Y==="window"){a.stopPropagation();const o={id:Ee("window"),type:"window",x:c-20,y:_-30,width:40,height:60,subType:"standard"};gt([...ge,o]),O(o.id);return}if(Y==="furniture"){a.stopPropagation();const o={id:Ee("furniture"),type:"furniture",x:c-20,y:_-20,width:40,height:40,subType:"box",rotation:0};mt([...de,o]),J(o.id);return}if(Y==="text"){a.stopPropagation();const o={id:Ee("text"),type:"text",x:c,y:_,text:"Label",fontSize:14,color:"#000000"};_t(P=>[...P,o]);return}if(Y==="circle"){a.stopPropagation();const o={id:Ee("circle"),type:"circle",cx:c,cy:_,r:30,fill:"#3B82F6",stroke:"#1E40AF",strokeWidth:2};Fe(P=>[...P,o]);return}if(Y==="polygon"){a.stopPropagation(),I.info("Polygon tool: Click points, double-click to finish");return}Y==="select"&&!a.ctrlKey&&!a.metaKey&&(A(null),R(null),B(null),S(null),O(null),J(null),ye(new Set),se(!1))},[Y,ae,le,u,j,k,ee,ne,ge,de,Ae,Je]),ls=()=>{$t(a=>Math.min(a*1.2,5))},ns=()=>{$t(a=>Math.max(a/1.2,.1))},is=()=>{$t(1),$({x:0,y:0})},ir=()=>{if(!f.current)return;const{blob:a}=pa(f.current),c=URL.createObjectURL(a),_=document.createElement("a");_.href=c,_.download="floorplan.svg",_.click(),URL.revokeObjectURL(c),I.success("Floor plan exported as SVG")},or=async()=>{if(f.current)try{const a=await fa(f.current,Ft,Pt,2),c=URL.createObjectURL(a),_=document.createElement("a");_.href=c,_.download="floorplan.png",_.click(),URL.revokeObjectURL(c),I.success("Floor plan exported as PNG")}catch(a){console.error("Export failed:",a),I.error("Failed to export PNG")}},dr=async()=>{I.error("PDF export coming soon")},cr=a=>{var o;const c=(o=a.target.files)==null?void 0:o[0];if(!c)return;const _=new FileReader;_.onload=P=>{W(P.target.result),I.success("Background image loaded")},_.readAsDataURL(c)},At=a=>{be(a),xe(null),He(null),Pe(null),a==="structure"?ar():a==="room"?os():a==="door"||a==="window"||a==="furniture"||Be(c=>c.filter(_=>_.id!=="preview"))},os=(a=null)=>{const c=a||{name:`Room ${s.length+1}`,width:150,height:120,color:"#3B82F6"},_={id:Ee("room"),name:c.name,layout:{x:100,y:100,width:c.width,height:c.height,color:c.color}};[...s],l(_.id,_.layout),Ne({...je})};y.useEffect(()=>(document.addEventListener("mousemove",Ie),document.addEventListener("mouseup",De),document.addEventListener("touchmove",Ie),document.addEventListener("touchend",De),()=>{document.removeEventListener("mousemove",Ie),document.removeEventListener("mouseup",De),document.removeEventListener("touchmove",Ie),document.removeEventListener("touchend",De)}),[Ie,De]);const xr=({wall:a})=>{const c=a.id==="preview",_=w===a.id;return t.jsxs("g",{onClick:o=>lr(o,a.id),cursor:"pointer",children:[t.jsx("line",{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,stroke:"transparent",strokeWidth:"15"}),t.jsx("line",{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,stroke:c?"#ef4444":_?"#3D84ED":a.stroke,strokeWidth:a.strokeWidth,strokeLinecap:"round",opacity:c?.7:1}),!c&&t.jsxs(t.Fragment,{children:[t.jsx("circle",{cx:a.x1,cy:a.y1,r:6,fill:"white",stroke:"#52525B",strokeWidth:"2",className:"cursor-move hover:fill-brand-blue",onMouseDown:o=>as(o,a.id,"start")}),t.jsx("circle",{cx:a.x2,cy:a.y2,r:6,fill:"white",stroke:"#52525B",strokeWidth:"2",className:"cursor-move hover:fill-brand-blue",onMouseDown:o=>as(o,a.id,"end")})]})]})},ds=({data:a,isStructure:c=!1,onClick:_})=>{const{layout:o,name:P,rate:L,label:et}=a,ve=c?v===a.id:M===a.id,pt=o.width&&o.height?Ht(o.width,o.height,Ae):null,pe=(X,br)=>ee.some(ft=>Ca(X,br,ft.x1,ft.y1,ft.x2,ft.y2)<12),Lt=pe(o.x,o.y),vs=pe(o.x+o.width,o.y),ws=pe(o.x+o.width,o.y+o.height),Ns=pe(o.x,o.y+o.height),Se=8,hr=[`M ${o.x+(Lt?0:Se)} ${o.y}`,`L ${o.x+o.width-(vs?0:Se)} ${o.y}`,`Q ${o.x+o.width} ${o.y} ${o.x+o.width} ${o.y+(vs?0:Se)}`,`L ${o.x+o.width} ${o.y+o.height-(ws?0:Se)}`,`Q ${o.x+o.width} ${o.y+o.height} ${o.x+o.width-(ws?0:Se)} ${o.y+o.height}`,`L ${o.x+(Ns?0:Se)} ${o.y+o.height}`,`Q ${o.x} ${o.y+o.height} ${o.x} ${o.y+o.height-(Ns?0:Se)}`,`L ${o.x} ${o.y+(Lt?0:Se)}`,`Q ${o.x} ${o.y} ${o.x+(Lt?0:Se)} ${o.y}`,"Z"].join(" ");return t.jsxs("g",{onClick:X=>{X.stopPropagation(),_(a,X)},cursor:"pointer",style:{filter:ve?`drop-shadow(0 0 5px ${o.color})`:"none"},pointerEvents:Y!=="select"?"none":"auto",children:[t.jsx("path",{d:hr,fill:o.color,opacity:c?"0.5":"0.8",stroke:o.color,strokeWidth:"4",strokeDasharray:c?"5,5":"0",onMouseDown:X=>c?rs(X,a):ss(X,a),onTouchStart:X=>c?rs(X,a):ss(X,a),style:{cursor:j?"default":"grab"}}),t.jsxs("text",{x:o.x+o.width/2,y:o.y+o.height/2,fill:"white",textAnchor:"middle",dominantBaseline:"middle",style:{pointerEvents:"none",userSelect:"none"},children:[t.jsx("tspan",{x:o.x+o.width/2,dy:"-0.5em",fontWeight:"bold",fontSize:"14",children:c?et||"Area":P}),!c&&L&&t.jsxs("tspan",{x:o.x+o.width/2,dy:"1.2em",fontSize:"12",children:["$",L,"/hr"]}),pt&&t.jsxs("tspan",{x:o.x+o.width/2,dy:"1.2em",fontSize:"10",opacity:"0.8",children:[pt.sqft.toFixed(0)," sq ft"]})]}),!c&&a.panorama360Url&&t.jsxs("g",{transform:`translate(${o.x+o.width-20}, ${o.y+5})`,children:[t.jsx("circle",{cx:"0",cy:"0",r:"8",fill:"#10B981",opacity:"0.9"}),t.jsx("text",{x:"0",y:"3",fontSize:"8",fill:"white",textAnchor:"middle",style:{pointerEvents:"none"},children:"360"})]}),ve&&t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:o.x-5,y:o.y-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"nwse-resize",onMouseDown:X=>c?Me(X,a,"tl"):ze(X,a,"tl")}),t.jsx("rect",{x:o.x+o.width-5,y:o.y-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"nesw-resize",onMouseDown:X=>c?Me(X,a,"tr"):ze(X,a,"tr")}),t.jsx("rect",{x:o.x+o.width-5,y:o.y+o.height-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"nwse-resize",onMouseDown:X=>c?Me(X,a,"br"):ze(X,a,"br")}),t.jsx("rect",{x:o.x-5,y:o.y+o.height-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"nesw-resize",onMouseDown:X=>c?Me(X,a,"bl"):ze(X,a,"bl")}),t.jsx("rect",{x:o.x+o.width/2-5,y:o.y-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"ns-resize",onMouseDown:X=>c?Me(X,a,"t"):ze(X,a,"t")}),t.jsx("rect",{x:o.x+o.width-5,y:o.y+o.height/2-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"ew-resize",onMouseDown:X=>c?Me(X,a,"r"):ze(X,a,"r")}),t.jsx("rect",{x:o.x+o.width/2-5,y:o.y+o.height-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"ns-resize",onMouseDown:X=>c?Me(X,a,"b"):ze(X,a,"b")}),t.jsx("rect",{x:o.x-5,y:o.y+o.height/2-5,width:"10",height:"10",fill:"white",stroke:"#3D84ED",strokeWidth:"2",cursor:"ew-resize",onMouseDown:X=>c?Me(X,a,"l"):ze(X,a,"l")})]})]})},ke=()=>M?s.find(a=>a.id===M):v?Q.find(a=>a.id===v):w?ee.find(a=>a.id===w):T?ne.find(a=>a.id===T):F?ge.find(a=>a.id===F):D?de.find(a=>a.id===D):null,cs=a=>{const c=ke();if(c)if(M){const _={...c,...a};l(M,_.layout||c.layout)}else v?ct(Q.map(_=>_.id===v?{..._,...a}:_)):w?dt(ee.map(_=>_.id===w?{..._,...a}:_)):T?xt(ne.map(_=>_.id===T?{..._,...a}:_)):F?gt(ge.map(_=>_.id===F?{..._,...a}:_)):D&&mt(de.map(_=>_.id===D?{..._,...a}:_))},gr=a=>{it(c=>{var _;return{...c,[a]:{...c[a],visible:!((_=c[a])!=null&&_.visible)}}})},mr=a=>{it(c=>{var _;return{...c,[a]:{...c[a],locked:!((_=c[a])!=null&&_.locked)}}})},ur=a=>{const c=ke();if(c)switch(a){case"copy":Xe();break;case"paste":ut();break;case"cut":ht();break;case"delete":Ye();break;case"rotate":if(c.layout||c.x!==void 0){const _=c.rotation||0;cs({rotation:(_+90)%360})}break}};return t.jsxs("div",{className:"flex h-[650px]",children:[t.jsx(ma,{activeTool:Y,setActiveTool:At,onUndo:Tt,onRedo:Bt,canUndo:tr,canRedo:sr,onZoomIn:ls,onZoomOut:ns,onFitToView:is,onExportSVG:ir,onExportPNG:or,onExportPDF:dr,showGrid:Rt,toggleGrid:()=>Zs(!Rt),measurementUnit:Je,setMeasurementUnit:Js,scale:Ae,setScale:Qs,onBackgroundImageUpload:cr,onAddRoomTemplate:a=>os(a)}),t.jsxs("div",{className:"flex flex-col flex-1",children:[t.jsxs("div",{className:"p-3 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36] rounded-t-xl",children:[t.jsxs("div",{className:"flex gap-4 text-sm text-gray-500 font-medium",children:[t.jsxs("button",{onClick:Xe,disabled:!v&&!w&&!T&&!F&&!D,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[t.jsx(Ct,{size:14})," Copy"]}),t.jsxs("button",{onClick:ut,disabled:!G,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[t.jsx(Ps,{size:14})," Paste"]}),t.jsxs("button",{onClick:ht,disabled:!v&&!w&&!T&&!F&&!D,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[t.jsx(As,{size:14})," Cut"]}),t.jsxs("button",{onClick:Ye,disabled:!v&&!w&&!T&&!F&&!D,className:"hover:text-red-500 disabled:opacity-50 flex items-center gap-1",children:[t.jsx(Te,{size:14})," Delete"]})]}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsxs("span",{className:"text-xs text-gray-500",children:["Zoom: ",(Ve*100).toFixed(0),"%"]}),t.jsxs("button",{className:`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${Y==="structure"?"bg-purple-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200"}`,onClick:()=>At("structure"),children:[t.jsx(Er,{size:16})," Add Area"]}),t.jsxs("button",{className:`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${Y==="wall"?"bg-red-500 text-white shadow-lg":"bg-brand-blue text-white hover:bg-blue-600"}`,onClick:()=>At(Y==="wall"?"select":"wall"),children:[t.jsx($r,{size:16})," ",Y==="wall"?ae?"Finish":"Wall":"Add Wall"]})]})]}),t.jsx("div",{ref:p,className:"flex-1 overflow-hidden bg-gray-50 dark:bg-[#1f2128] rounded-b-xl border-x border-b dark:border-gray-700 relative",style:{cursor:Y==="wall"||Y==="measure"?"crosshair":k?"grabbing":"default"},tabIndex:0,onMouseDown:rr,onMouseUp:bt,onMouseLeave:bt,onContextMenu:a=>{a.preventDefault(),ke()&&he({x:a.clientX,y:a.clientY})},children:t.jsxs("svg",{ref:f,width:Ft,height:Pt,className:"w-full h-full shadow-inner focus:outline-none",viewBox:`${ot.x} ${ot.y} ${ot.width} ${ot.height}`,style:{transform:`scale(${Ve})`,transformOrigin:"top left"},onMouseMove:Ie,onMouseUp:a=>{De(),bt()},onTouchMove:Ie,onTouchEnd:a=>{De(),bt()},onClick:nr,children:[q&&t.jsx("image",{href:q,x:0,y:0,width:Ft,height:Pt,opacity:"0.3"}),Rt&&t.jsxs(t.Fragment,{children:[t.jsx("pattern",{id:"smallGrid",width:Ge,height:Ge,patternUnits:"userSpaceOnUse",children:t.jsx("path",{d:`M ${Ge} 0 L 0 0 0 ${Ge}`,fill:"none",stroke:"#e5e7eb",strokeWidth:"0.5"})}),t.jsx("rect",{width:"100%",height:"100%",fill:"url(#smallGrid)"})]}),((xs=ce.structures)==null?void 0:xs.visible)!==!1&&Q.map(a=>t.jsx(ds,{data:a,isStructure:!0,onClick:c=>{R(c.id),se(!0),A(null),B(null),S(null),O(null),J(null)}},a.id)),((gs=ce.rooms)==null?void 0:gs.visible)!==!1&&s.map(a=>t.jsx(ds,{data:a,onClick:c=>{c.panorama360Url&&(e!=null&&e.ctrlKey||e!=null&&e.metaKey)?H(c):(A(c.id),se(!0),R(null),B(null),S(null),O(null),J(null),n(s.findIndex(_=>_.id===c.id)))}},a.id)),((ms=ce.walls)==null?void 0:ms.visible)!==!1&&ee.map(a=>t.jsx(xr,{wall:a},a.id)),((us=ce.doors)==null?void 0:us.visible)!==!1&&ne.map(a=>t.jsx(va,{door:a,isSelected:T===a.id,onClick:()=>{S(a.id),se(!0),A(null),R(null),B(null),O(null),J(null)},onMouseDown:c=>{if(Y==="select"){c.preventDefault(),S(a.id),g(!0);const{x:_,y:o}=Le(c);h({x:_-a.x,y:o-a.y})}}},a.id)),((hs=ce.windows)==null?void 0:hs.visible)!==!1&&ge.map(a=>t.jsx(wa,{window:a,isSelected:F===a.id,onClick:()=>{O(a.id),se(!0),A(null),R(null),B(null),S(null),J(null)},onMouseDown:c=>{if(Y==="select"){c.preventDefault(),O(a.id),g(!0);const{x:_,y:o}=Le(c);h({x:_-a.x,y:o-a.y})}}},a.id)),((bs=ce.furniture)==null?void 0:bs.visible)!==!1&&de.map(a=>t.jsx(Na,{furniture:a,isSelected:D===a.id,onClick:()=>{J(a.id),se(!0),A(null),R(null),B(null),S(null),O(null)},onMouseDown:c=>{if(Y==="select"){c.preventDefault(),J(a.id),g(!0);const{x:_,y:o}=Le(c);h({x:_-a.x,y:o-a.y})}}},a.id)),((ps=ce.text)==null?void 0:ps.visible)!==!1&&We.map(a=>t.jsxs("g",{children:[t.jsx("text",{x:a.x,y:a.y,fontSize:a.fontSize||14,fill:a.color||"#000",fontWeight:a.bold?"bold":"normal",className:"cursor-pointer",onClick:()=>{},children:a.text}),a.selected&&t.jsx("rect",{x:a.x-5,y:a.y-a.fontSize-5,width:a.text.length*(a.fontSize*.6)+10,height:a.fontSize+10,fill:"none",stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"})]},a.id)),((fs=ce.shapes)==null?void 0:fs.visible)!==!1&&re.map(a=>a.type==="circle"?t.jsx("circle",{cx:a.cx,cy:a.cy,r:a.r,fill:a.fill,stroke:a.stroke,strokeWidth:a.strokeWidth,className:"cursor-pointer",onClick:()=>{}},a.id):a.type==="polygon"?t.jsx("polygon",{points:a.points.map(c=>`${c.x},${c.y}`).join(" "),fill:a.fill,stroke:a.stroke,strokeWidth:a.strokeWidth,className:"cursor-pointer"},a.id):null),((ys=ce.measurements)==null?void 0:ys.visible)!==!1&&zt.map(a=>t.jsxs("g",{children:[t.jsx("line",{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"}),t.jsx("circle",{cx:a.x1,cy:a.y1,r:4,fill:"#3D84ED"}),t.jsx("circle",{cx:a.x2,cy:a.y2,r:4,fill:"#3D84ED"}),t.jsx("text",{x:(a.x1+a.x2)/2,y:(a.y1+a.y2)/2-5,fontSize:"12",fill:"#3D84ED",textAnchor:"middle",className:"pointer-events-none",children:a.distance})]},a.id)),te&&t.jsxs("g",{children:[t.jsx("line",{x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,stroke:"#3D84ED",strokeWidth:2,strokeDasharray:"5,5"}),t.jsx("circle",{cx:te.x1,cy:te.y1,r:4,fill:"#3D84ED"}),t.jsx("circle",{cx:te.x2,cy:te.y2,r:4,fill:"#3D84ED"}),t.jsx("text",{x:(te.x1+te.x2)/2,y:(te.y1+te.y2)/2-5,fontSize:"12",fill:"#3D84ED",textAnchor:"middle",className:"pointer-events-none",children:te.distance})]}),t.jsxs("g",{className:"pointer-events-none",children:[t.jsxs("text",{x:"10",y:"20",fontSize:"10",fill:"#9CA3AF",children:["Grid: ",Ge,"px | ",ee.length," Walls | ",s.length," Rooms"]}),t.jsx("text",{x:"10",y:"35",fontSize:"10",fill:"#9CA3AF",children:"Ctrl+Click room with 360° icon to view | Space+Drag to pan"}),M&&(()=>{const a=s.find(c=>c.id===M);if(a&&a.layout){const c=Ht(a.layout.width,a.layout.height,Ae);return t.jsxs("text",{x:"10",y:"50",fontSize:"10",fill:"#9CA3AF",children:["Area: ",c.display]})}return null})()]})]})}),V&&t.jsx("div",{className:"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:t.jsx("div",{className:"w-full max-w-4xl",children:t.jsx(Xs,{imageUrl:V.panorama360Url,title:V.name||"Room View",onClose:()=>H(null)})})}),Z&&t.jsx(ja,{x:Z.x,y:Z.y,onClose:()=>he(null),onAction:ur,canCopy:!!ke(),canPaste:!!G,canCut:!!ke(),canDelete:!!ke(),canRotate:!!((js=ke())!=null&&js.layout),canFlip:!!((ks=ke())!=null&&ks.layout),isLocked:!1}),Oe&&ke()&&t.jsx(ya,{selectedItem:ke(),onClose:()=>se(!1),onUpdate:cs,scale:Ae,unit:Je}),t.jsx(ka,{layers:ce,onLayerToggle:gr,onLayerLock:mr})]})]})}function za({user:s,userData:r,onUpdate:m}){const{t:n}=sa(),[l,x]=y.useState((r==null?void 0:r.rooms)||[]),[b,f]=y.useState((r==null?void 0:r.floorplanWalls)||[]),[p,u]=y.useState((r==null?void 0:r.floorplanStructures)||[]),[g,j]=y.useState(null),[d,i]=y.useState(!1),[h,k]=y.useState(!1),[N,z]=y.useState(null),[$,M]=y.useState("list"),A={name:"",description:"",rate:50,capacity:4,equipment:[],amenities:[],minBookingHours:1,active:!0,color:"#3B82F6",panorama360Url:null},v=async(C,V=b,H=p)=>{if(!U)return;k(!0);const Z=I.loading("Saving rooms..."),he=(s==null?void 0:s.id)||(s==null?void 0:s.uid);try{await U.from("profiles").update({rooms:C,floorplan_walls:V,floorplan_structures:H,updated_at:new Date().toISOString()}).eq("id",he),x(C),f(V),u(H),I.success("Rooms saved!",{id:Z}),m&&m({rooms:C,floorplanWalls:V,floorplanStructures:H})}catch(Oe){console.error("Save failed:",Oe),I.error("Failed to save",{id:Z})}finally{k(!1)}},R=(C,V)=>{const H=l.map(Z=>Z.id===C?{...Z,layout:V}:Z);x(H)},w=async C=>{if(!U)return;f(C);const V=(s==null?void 0:s.id)||(s==null?void 0:s.uid);try{await U.from("profiles").update({floorplan_walls:C,updated_at:new Date().toISOString()}).eq("id",V)}catch(H){console.error("Error saving walls:",H)}},B=async C=>{if(!U)return;u(C);const V=(s==null?void 0:s.id)||(s==null?void 0:s.uid);try{await U.from("profiles").update({floorplan_structures:C,updated_at:new Date().toISOString()}).eq("id",V)}catch(H){console.error("Error saving structures:",H)}},T=C=>{C>=0&&C<l.length&&F(C)},S=()=>{j({...A,name:`Room ${l.length+1}`}),i(!0)},F=C=>{j({...l[C]}),i(!1),z(C)},O=async()=>{if(!g.name.trim()){I.error("Room name is required");return}let C;d?C=[...l,g]:C=l.map((V,H)=>H===N?g:V),await v(C),j(null),i(!1),z(null)},D=async C=>{if(!confirm(`Delete "${l[C].name}"? This cannot be undone.`))return;const V=l.filter((H,Z)=>Z!==C);await v(V)},J=async C=>{const V={...l[C],name:`${l[C].name} (Copy)`},H=[...l,V];await v(H)},ue=()=>{j(null),i(!1),z(null)},ye=["Isolation Booth","Live Room","Control Room","Lounge Area","Private Bathroom","Natural Light","Blackout Curtains","Video Feed","Climate Control","Sound Lock"],oe=l.map((C,V)=>({...C,id:C.id||`room_${V}`,layout:C.layout||{x:50+V%3*200,y:50+Math.floor(V/3)*150,width:180,height:120,color:C.color||"#3B82F6"}}));return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Ot,{className:"text-brand-blue",size:24}),"Room Management"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Configure your studio rooms, rates, and equipment"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:[t.jsxs("button",{onClick:()=>M("list"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${$==="list"?"bg-white dark:bg-gray-700 shadow text-brand-blue":"text-gray-600 dark:text-gray-400"}`,children:[t.jsx(Rr,{size:16})," List"]}),t.jsxs("button",{onClick:()=>M("floorplan"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${$==="floorplan"?"bg-white dark:bg-gray-700 shadow text-brand-blue":"text-gray-600 dark:text-gray-400"}`,children:[t.jsx(Tr,{size:16})," Floorplan"]})]}),t.jsxs("button",{onClick:S,disabled:d||g,className:"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[t.jsx(Qe,{size:18})," Add Room"]})]})]}),d&&g&&t.jsx($s,{room:g,setRoom:j,onSave:O,onCancel:ue,saving:h,isNew:!0,roomAmenities:ye,user:s}),$==="floorplan"&&!d&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsx(_a,{rooms:oe,walls:b,structures:p,onRoomClick:T,onLayoutChange:R,onWallsChange:w,onStructuresChange:B}),t.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-[#23262f] border-t dark:border-gray-700 text-xs text-gray-500",children:[t.jsx("strong",{children:"Tips:"})," Click a room to edit • Drag to reposition • Use corner handles to resize • Add walls to define boundaries"]})]}),$==="list"&&t.jsx("div",{className:"space-y-4",children:l.length===0&&!d?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center",children:[t.jsx(Ot,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),t.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Rooms Yet"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-sm mx-auto",children:"Add your first room to start accepting bookings"}),t.jsx("button",{onClick:S,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition",children:"Add Your First Room"})]}):l.map((C,V)=>t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm",children:[t.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-[#23262f] transition",onClick:()=>z(N===V?null:V),children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:C.color||"#3B82F6"},children:C.name.charAt(0)}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"font-bold dark:text-white",children:C.name}),C.active===!1&&t.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-0.5 rounded",children:"Inactive"})]}),t.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mt-1",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(St,{size:14}),"$",C.rate,"/hr"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Nt,{size:14}),C.capacity," people"]}),C.equipment&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(qs,{size:14}),Array.isArray(C.equipment)?C.equipment.reduce((H,Z)=>H+(Z.quantity||1),0):C.equipment.split(",").length," items"]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:H=>{H.stopPropagation(),J(V)},className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Duplicate",children:t.jsx(Ct,{size:16})}),t.jsx("button",{onClick:H=>{H.stopPropagation(),F(V)},className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit",children:t.jsx(Kt,{size:16})}),t.jsx("button",{onClick:H=>{H.stopPropagation(),D(V)},className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete",children:t.jsx(Te,{size:16})}),N===V?t.jsx(Us,{size:20}):t.jsx(Os,{size:20})]})]}),N===V&&g&&t.jsx("div",{className:"border-t dark:border-gray-700",children:t.jsx($s,{room:g,setRoom:j,onSave:O,onCancel:ue,saving:h,isNew:!1,roomAmenities:ye,user:s})}),N===V&&!g&&t.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#1f2128]",children:[C.description&&t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:C.description}),C.equipment&&t.jsx("div",{className:"flex flex-wrap gap-2",children:Array.isArray(C.equipment)?C.equipment.map((H,Z)=>t.jsxs("span",{className:"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded",children:[H.brand&&`${H.brand} `,H.name||H.model,H.quantity&&H.quantity>1&&` (×${H.quantity})`]},Z)):C.equipment.split(",").map((H,Z)=>t.jsx("span",{className:"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded",children:H.trim()},Z))})]})]},V))})]})}function $s({room:s,setRoom:r,onSave:m,onCancel:n,saving:l,isNew:x,roomAmenities:b,user:f}){const{uploadImage:p,uploading:u}=ra(),[g,j]=y.useState(!1),d=y.useRef(null),i=N=>{const z=s.amenities||[];z.includes(N)?r({...s,amenities:z.filter($=>$!==N)}):r({...s,amenities:[...z,N]})},h=async N=>{var R;const z=(R=N.target.files)==null?void 0:R[0];if(!z)return;if(!["image/jpeg","image/jpg","image/png"].includes(z.type)){I.error("Please upload a JPEG or PNG image");return}if(z.size>20*1024*1024){I.error("Image size must be less than 20MB");return}const A=`studio-rooms/${(f==null?void 0:f.id)||(f==null?void 0:f.uid)||"temp"}/360-images`,v=I.loading("Uploading 360° image...");try{const w=await p(z,A);w?(r({...s,panorama360Url:w}),I.success("360° image uploaded successfully!",{id:v})):I.error("Upload failed",{id:v})}catch(w){console.error("360 image upload error:",w),I.error("Failed to upload image",{id:v})}},k=()=>{r({...s,panorama360Url:null})};return t.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-[#1f2128] space-y-5",children:[x&&t.jsx("h3",{className:"font-bold dark:text-white text-lg mb-4",children:"Add New Room"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Room Name *"}),t.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:s.name,onChange:N=>r({...s,name:N.target.value}),placeholder:"e.g. Studio A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Room Color"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"color",className:"w-12 h-12 rounded-lg border dark:border-gray-600 cursor-pointer",value:s.color||"#3B82F6",onChange:N=>r({...s,color:N.target.value})}),t.jsx("input",{className:"flex-1 p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:s.color||"#3B82F6",onChange:N=>r({...s,color:N.target.value}),placeholder:"#3B82F6"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Description"}),t.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",rows:2,value:s.description||"",onChange:N=>r({...s,description:N.target.value}),placeholder:"Describe this room, its vibe, and what makes it special..."})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hourly Rate ($)"}),t.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:s.rate,onChange:N=>r({...s,rate:parseInt(N.target.value)||0}),min:0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Capacity"}),t.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:s.capacity,onChange:N=>r({...s,capacity:parseInt(N.target.value)||1}),min:1})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Hours"}),t.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:s.minBookingHours||1,onChange:N=>r({...s,minBookingHours:parseInt(N.target.value)||1}),min:1})]}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl cursor-pointer w-full",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 text-brand-blue",checked:s.active!==!1,onChange:N=>r({...s,active:N.target.checked})}),t.jsx("span",{className:"text-sm font-medium dark:text-white",children:"Active"})]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Equipment"}),t.jsx(Ma,{equipment:Array.isArray(s.equipment)?s.equipment:s.equipment?s.equipment.split(",").map(N=>({name:N.trim(),brand:"",model:"",quantity:1})):[],onChange:N=>r({...s,equipment:N})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Room Features"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(N=>t.jsx("button",{type:"button",onClick:()=>i(N),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all border ${(s.amenities||[]).includes(N)?"bg-brand-blue text-white border-brand-blue":"bg-white dark:bg-[#2c2e36] text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-brand-blue"}`,children:N},N))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"360° Panorama Image"}),t.jsx("div",{className:"space-y-3",children:s.panorama360Url?t.jsxs("div",{className:"relative",children:[t.jsx(Xs,{imageUrl:s.panorama360Url,title:s.name||"Room View"}),t.jsx("button",{type:"button",onClick:k,className:"absolute top-3 right-3 p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg shadow-lg transition z-20",title:"Remove 360° image",children:t.jsx(ie,{size:18})})]}):t.jsxs("div",{className:"border-2 border-dashed dark:border-gray-600 rounded-xl p-8 text-center bg-white dark:bg-[#2c2e36]",children:[t.jsx(qe,{size:48,className:"mx-auto mb-3 text-gray-400"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Upload a 360° equirectangular panorama image"}),t.jsx("input",{ref:d,type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:h,className:"hidden"}),t.jsx("button",{type:"button",onClick:()=>{var N;return(N=d.current)==null?void 0:N.click()},disabled:u,className:"px-4 py-2 bg-brand-blue text-white rounded-lg font-medium hover:bg-blue-600 transition flex items-center gap-2 mx-auto disabled:opacity-50",children:u?t.jsxs(t.Fragment,{children:[t.jsx(fe,{className:"animate-spin",size:18}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Zt,{size:18}),"Upload 360° Image"]})}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:"Supports JPEG/PNG • Max 20MB • Equirectangular format recommended"})]})})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[t.jsx("button",{onClick:n,className:"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl font-medium transition",children:"Cancel"}),t.jsxs("button",{onClick:m,disabled:l,className:"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[l?t.jsx(fe,{className:"animate-spin",size:18}):t.jsx(Re,{size:18}),x?"Add Room":"Save Changes"]})]})]})}function Ma({equipment:s,onChange:r}){const[m,n]=y.useState(null),[l,x]=y.useState(1),b=u=>{if(!u||!u.name)return;const g={name:u.name,brand:u.brand||"",model:u.model||u.name,quantity:l||1};r([...s||[],g]),n(null),x(1)},f=u=>{const g=s.filter((j,d)=>d!==u);r(g)},p=(u,g)=>{const j=s.map((d,i)=>i===u?{...d,quantity:Math.max(1,parseInt(g)||1)}:d);r(j)};return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(Ys,{onSelect:u=>{n(u),x(1)},placeholder:"Search and add equipment..."})}),m&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",min:"1",value:l,onChange:u=>x(parseInt(u.target.value)||1),className:"w-20 p-2 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white text-sm",placeholder:"Qty"}),t.jsxs("button",{type:"button",onClick:()=>b(m),className:"px-4 py-2 bg-brand-blue text-white rounded-xl font-medium hover:bg-blue-600 transition flex items-center gap-1",children:[t.jsx(Qe,{size:16})," Add"]})]})]}),s&&s.length>0&&t.jsx("div",{className:"space-y-2",children:s.map((u,g)=>t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg border dark:border-gray-700",children:[t.jsx("div",{className:"flex-1 min-w-0",children:t.jsxs("div",{className:"font-medium text-sm dark:text-white",children:[u.brand&&t.jsxs("span",{className:"text-gray-500",children:[u.brand," "]}),u.name||u.model]})}),t.jsx("input",{type:"number",min:"1",value:u.quantity||1,onChange:j=>p(g,j.target.value),className:"w-16 p-1.5 border rounded-lg dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white text-sm text-center"}),t.jsx("button",{type:"button",onClick:()=>f(g),className:"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:t.jsx(ie,{size:16})})]},g))})]})}function Ea({user:s,userData:r,onUpdate:m}){const[n,l]=y.useState((r==null?void 0:r.studioPhotos)||[]),[x,b]=y.useState(0),[f,p]=y.useState(null),[u,g]=y.useState(null),{uploadMedia:j,uploading:d}=ts(),i=(s==null?void 0:s.id)||(s==null?void 0:s.uid),h=y.useCallback(async w=>{if(!U)return!1;try{return await U.from("profiles").update({studio_photos:w,updated_at:new Date().toISOString()}).eq("id",i),l(w),m&&m({studioPhotos:w}),!0}catch(B){return console.error("Save failed:",B),I.error("Failed to save photos"),!1}},[i,m]),k=y.useCallback(async w=>{if(!w||w.length===0)return;const B=12;if(n.length>=B){I.error(`Maximum ${B} photos allowed`);return}const T=I.loading("Uploading photos..."),S=[];for(const F of Array.from(w).slice(0,B-n.length)){if(!F.type.startsWith("image/")){I.error(`${F.name} is not an image`);continue}if(F.size>5*1024*1024){I.error(`${F.name} is too large (max 5MB)`);continue}try{const O=Date.now(),D=await j(F,`studio/gallery/${i}`);D!=null&&D.url&&S.push({id:O.toString(),url:D.url,path:D.storageRef||`studio/gallery/${i}/${O}_${F.name}`,filename:F.name,caption:"",isCover:n.length===0&&S.length===0,uploadedAt:new Date().toISOString()})}catch(O){console.error("Upload error:",O),I.error(`Failed to upload ${F.name}`)}}S.length>0?await h([...n,...S])&&I.success(`${S.length} photo(s) uploaded!`,{id:T}):I.dismiss(T),b(0)},[n,i,h,j]),N=async w=>{const B=n[w];if(!confirm("Delete this photo?"))return;const T=I.loading("Deleting...");try{let S=n.filter((F,O)=>O!==w);B.isCover&&S.length>0&&(S=S.map((F,O)=>({...F,isCover:O===0}))),await h(S),I.success("Photo deleted",{id:T})}catch(S){console.error("Delete error:",S),I.error("Failed to delete photo",{id:T})}},z=async w=>{const B=n.map((T,S)=>({...T,isCover:S===w}));await h(B),I.success("Cover photo updated")},$=w=>{g(w)},M=(w,B)=>{if(w.preventDefault(),u===null||u===B)return;const T=[...n],[S]=T.splice(u,1);T.splice(B,0,S),l(T),g(B)},A=async()=>{u!==null&&(await h(n),g(null))},v=w=>{var T;w.preventDefault();const B=(T=w.dataTransfer)==null?void 0:T.files;B&&k(B)},R=n.find(w=>w.isCover)||n[0];return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(qe,{className:"text-brand-blue",size:24}),"Photo Gallery"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Showcase your studio with up to 12 photos"})]}),t.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.length,"/12 photos"]})]}),R&&t.jsxs("div",{className:"relative rounded-xl overflow-hidden aspect-video bg-gray-100 dark:bg-gray-800 group",children:[t.jsx("img",{src:R.url,alt:"Cover",className:"w-full h-full object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("div",{className:"absolute bottom-4 left-4 text-white",children:t.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[t.jsx(st,{size:16,className:"fill-yellow-400 text-yellow-400"}),"Cover Photo"]})})})]}),t.jsx("div",{className:`border-2 border-dashed rounded-xl p-8 text-center transition-all ${d?"border-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-brand-blue hover:bg-blue-50/50 dark:hover:bg-blue-900/10"}`,onDrop:v,onDragOver:w=>w.preventDefault(),children:d?t.jsxs("div",{className:"space-y-3",children:[t.jsx(fe,{className:"mx-auto animate-spin text-brand-blue",size:40}),t.jsx("div",{className:"w-full max-w-xs mx-auto bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"bg-brand-blue h-2 rounded-full transition-all duration-300",style:{width:`${x}%`}})}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Uploading... ",Math.round(x),"%"]})]}):t.jsxs(t.Fragment,{children:[t.jsx(Zt,{className:"mx-auto text-gray-400 mb-3",size:40}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Drag & drop images here, or"}),t.jsxs("label",{className:"cursor-pointer",children:[t.jsx("span",{className:"text-brand-blue font-bold hover:underline",children:"browse files"}),t.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:w=>k(w.target.files),disabled:d})]}),t.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"JPG, PNG or WebP. Max 5MB per file."})]})}),n.length>0&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[n.map((w,B)=>t.jsxs("div",{draggable:!0,onDragStart:()=>$(B),onDragOver:T=>M(T,B),onDragEnd:A,className:`relative aspect-square rounded-xl overflow-hidden group bg-gray-100 dark:bg-gray-800 cursor-move ${u===B?"opacity-50 ring-2 ring-brand-blue":""}`,children:[t.jsx("img",{src:w.url,alt:w.caption||`Studio photo ${B+1}`,className:"w-full h-full object-cover"}),w.isCover&&t.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-lg flex items-center gap-1",children:[t.jsx(st,{size:12,className:"fill-white"})," Cover"]}),t.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[t.jsx("button",{onClick:()=>p(w),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition",title:"View",children:t.jsx(Xt,{size:18})}),!w.isCover&&t.jsx("button",{onClick:()=>z(B),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition",title:"Set as cover",children:t.jsx(st,{size:18})}),t.jsx("button",{onClick:()=>N(B),className:"p-2 bg-red-500/80 hover:bg-red-500 rounded-lg text-white transition",title:"Delete",children:t.jsx(Te,{size:18})})]}),t.jsx("div",{className:"absolute top-2 right-2 p-1 bg-black/40 rounded text-white opacity-0 group-hover:opacity-100 transition",children:t.jsx(Bs,{size:14})})]},w.id)),n.length<12&&t.jsxs("label",{className:"aspect-square rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700 hover:border-brand-blue transition cursor-pointer flex flex-col items-center justify-center text-gray-400 hover:text-brand-blue",children:[t.jsx(Qe,{size:32}),t.jsx("span",{className:"text-xs mt-1",children:"Add Photo"}),t.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:w=>k(w.target.files),disabled:d})]})]}),n.length===0&&!d&&t.jsxs("div",{className:"text-center py-8 text-gray-400",children:[t.jsx(qe,{size:48,className:"mx-auto mb-3 opacity-30"}),t.jsx("p",{children:"No photos uploaded yet"}),t.jsx("p",{className:"text-sm",children:"Add photos to attract more clients"})]}),f&&t.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>p(null),children:[t.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition",onClick:()=>p(null),children:t.jsx(ie,{size:32})}),t.jsx("img",{src:f.url,alt:f.caption||"Studio photo",className:"max-w-full max-h-[90vh] object-contain rounded-lg",onClick:w=>w.stopPropagation()}),f.caption&&t.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black/70 text-white px-6 py-3 rounded-xl",children:f.caption})]})]})}const Dt=[{id:"sunday",label:"Sunday",short:"Sun"},{id:"monday",label:"Monday",short:"Mon"},{id:"tuesday",label:"Tuesday",short:"Tue"},{id:"wednesday",label:"Wednesday",short:"Wed"},{id:"thursday",label:"Thursday",short:"Thu"},{id:"friday",label:"Friday",short:"Fri"},{id:"saturday",label:"Saturday",short:"Sat"}],$a={sunday:{closed:!0,open:"10:00",close:"18:00"},monday:{closed:!1,open:"09:00",close:"22:00"},tuesday:{closed:!1,open:"09:00",close:"22:00"},wednesday:{closed:!1,open:"09:00",close:"22:00"},thursday:{closed:!1,open:"09:00",close:"22:00"},friday:{closed:!1,open:"09:00",close:"23:00"},saturday:{closed:!1,open:"10:00",close:"23:00"}};function Ra({user:s,userData:r,onUpdate:m}){const[n,l]=y.useState((r==null?void 0:r.operatingHours)||$a),[x,b]=y.useState((r==null?void 0:r.blackoutDates)||[]),[f,p]=y.useState(!1),[u,g]=y.useState({start:"",end:"",reason:""}),[j,d]=y.useState(!1),i=async()=>{if(!U)return;p(!0);const v=I.loading("Saving availability..."),R=(s==null?void 0:s.id)||(s==null?void 0:s.uid);try{await U.from("profiles").update({operating_hours:n,blackout_dates:x,updated_at:new Date().toISOString()}).eq("id",R),I.success("Availability saved!",{id:v}),m&&m({operatingHours:n,blackoutDates:x})}catch(w){console.error("Save failed:",w),I.error("Failed to save",{id:v})}finally{p(!1)}},h=(v,R,w)=>{l(B=>({...B,[v]:{...B[v],[R]:w}}))},k=v=>{l(R=>{var w;return{...R,[v]:{...R[v],closed:!((w=R[v])!=null&&w.closed)}}})},N=v=>{const R=n[v],w=["monday","tuesday","wednesday","thursday","friday"];l(B=>{const T={...B};return w.forEach(S=>{T[S]={...R}}),T}),I.success("Copied to all weekdays")},z=()=>{if(!u.start){I.error("Start date is required");return}const v={id:Date.now().toString(),start:u.start,end:u.end||u.start,reason:u.reason||"Blocked"};b([...x,v]),g({start:"",end:"",reason:""}),d(!1)},$=v=>{b(x.filter(R=>R.id!==v))},M=v=>{if(!v)return"";const[R,w]=v.split(":"),B=parseInt(R),T=B>=12?"PM":"AM";return`${B===0?12:B>12?B-12:B}:${w} ${T}`},A=Dt.reduce((v,R)=>{const w=n[R.id];if(w!=null&&w.closed)return v;const[B,T]=((w==null?void 0:w.open)||"09:00").split(":").map(Number),[S,F]=((w==null?void 0:w.close)||"17:00").split(":").map(Number),O=B*60+T,D=S*60+F;return v+Math.max(0,(D-O)/60)},0);return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Qt,{className:"text-brand-blue",size:24}),"Availability & Hours"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Set your operating hours and manage blackout dates"})]}),t.jsxs("button",{onClick:i,disabled:f,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[f?t.jsx(fe,{className:"animate-spin",size:18}):t.jsx(Re,{size:18}),"Save Changes"]})]}),t.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold mb-1",children:"Weekly Availability"}),t.jsxs("p",{className:"text-indigo-100",children:[Dt.filter(v=>{var R;return!((R=n[v.id])!=null&&R.closed)}).length," days open • ",Math.round(A)," hours/week"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-4xl font-bold",children:Math.round(A)}),t.jsx("div",{className:"text-sm text-indigo-100",children:"hours"})]})]})}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Br,{size:18,className:"text-amber-500"}),"Operating Hours"]})}),t.jsx("div",{className:"divide-y dark:divide-gray-700",children:Dt.map(v=>{const R=n[v.id]||{closed:!1,open:"09:00",close:"17:00"};return t.jsxs("div",{className:`p-4 flex items-center gap-4 ${R.closed?"bg-gray-50 dark:bg-[#1f2128]":""}`,children:[t.jsx("div",{className:"w-28",children:t.jsx("span",{className:`font-medium ${R.closed?"text-gray-400":"dark:text-white"}`,children:v.label})}),t.jsx("button",{onClick:()=>k(v.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition ${R.closed?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}`,children:R.closed?"Closed":"Open"}),!R.closed&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"time",value:R.open||"09:00",onChange:w=>h(v.id,"open",w.target.value),className:"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),t.jsx("span",{className:"text-gray-400",children:"to"}),t.jsx("input",{type:"time",value:R.close||"17:00",onChange:w=>h(v.id,"close",w.target.value),className:"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),t.jsxs("span",{className:"text-sm text-gray-400 hidden md:inline",children:[M(R.open)," – ",M(R.close)]}),t.jsx("button",{onClick:()=>N(v.id),className:"ml-auto p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Copy to all weekdays",children:t.jsx(Ct,{size:16})})]})]},v.id)})})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Ss,{size:18,className:"text-indigo-500"}),"Blackout Dates"]}),t.jsxs("button",{onClick:()=>d(!j),className:"text-sm bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition flex items-center gap-1",children:[t.jsx(Qe,{size:16})," Add Blackout"]})]}),j&&t.jsx("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/20 border-b dark:border-gray-700",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Start Date *"}),t.jsx("input",{type:"date",value:u.start,onChange:v=>g({...u,start:v.target.value}),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"End Date"}),t.jsx("input",{type:"date",value:u.end,onChange:v=>g({...u,end:v.target.value}),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:u.start})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Reason"}),t.jsx("input",{type:"text",value:u.reason,onChange:v=>g({...u,reason:v.target.value}),placeholder:"e.g. Holiday, Maintenance",className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("button",{onClick:z,className:"flex-1 p-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition",children:"Add"}),t.jsx("button",{onClick:()=>d(!1),className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:t.jsx(ie,{size:20})})]})]})}),t.jsx("div",{className:"p-4",children:x.length===0?t.jsxs("div",{className:"text-center py-8 text-gray-400",children:[t.jsx(Ss,{size:32,className:"mx-auto mb-2 opacity-30"}),t.jsx("p",{className:"text-sm",children:"No blackout dates scheduled"}),t.jsx("p",{className:"text-xs",children:"Add dates when your studio is unavailable"})]}):t.jsx("div",{className:"space-y-2",children:x.sort((v,R)=>new Date(v.start)-new Date(R.start)).map(v=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-10 h-10 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg flex items-center justify-center",children:t.jsx($e,{className:"text-indigo-600 dark:text-indigo-400",size:18})}),t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium dark:text-white text-sm",children:[new Date(v.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),v.end!==v.start&&t.jsxs(t.Fragment,{children:[" – ",new Date(v.end).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),t.jsx("div",{className:"text-xs text-gray-500",children:v.reason})]})]}),t.jsx("button",{onClick:()=>$(v.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:t.jsx(Te,{size:16})})]},v.id))})})]}),t.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx(Vt,{className:"text-amber-600 flex-shrink-0",size:20}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"font-bold text-amber-800 dark:text-amber-300 mb-1",children:"Availability Tips"}),t.jsxs("ul",{className:"text-amber-700 dark:text-amber-400 space-y-1",children:[t.jsx("li",{children:"• Operating hours determine when clients can book sessions"}),t.jsx("li",{children:"• Use blackout dates for holidays, maintenance, or personal time"}),t.jsx("li",{children:"• Individual room availability can be set in the Rooms section"})]})]})]})})]})}function Ta({user:s,userData:r,onUpdate:m}){var i,h,k,N,z,$,M,A,v,R,w,B,T,S,F,O,D,J,ue,ye,oe;const[n,l]=y.useState({minBookingHours:((i=r==null?void 0:r.policies)==null?void 0:i.minBookingHours)??2,maxBookingHours:((h=r==null?void 0:r.policies)==null?void 0:h.maxBookingHours)??12,advanceBookingDays:((k=r==null?void 0:r.policies)==null?void 0:k.advanceBookingDays)??14,minAdvanceHours:((N=r==null?void 0:r.policies)==null?void 0:N.minAdvanceHours)??24,autoApprove:((z=r==null?void 0:r.policies)==null?void 0:z.autoApprove)??!1,cancellationPolicy:(($=r==null?void 0:r.policies)==null?void 0:$.cancellationPolicy)??"moderate",cancellationNoticeHours:((M=r==null?void 0:r.policies)==null?void 0:M.cancellationNoticeHours)??48,refundPercentage:((A=r==null?void 0:r.policies)==null?void 0:A.refundPercentage)??50,depositRequired:((v=r==null?void 0:r.policies)==null?void 0:v.depositRequired)??!0,depositPercentage:((R=r==null?void 0:r.policies)==null?void 0:R.depositPercentage)??25,peakHourMultiplier:((w=r==null?void 0:r.policies)==null?void 0:w.peakHourMultiplier)??1,peakHoursStart:((B=r==null?void 0:r.policies)==null?void 0:B.peakHoursStart)??"",peakHoursEnd:((T=r==null?void 0:r.policies)==null?void 0:T.peakHoursEnd)??"",weekendMultiplier:((S=r==null?void 0:r.policies)==null?void 0:S.weekendMultiplier)??1,houseRules:((F=r==null?void 0:r.policies)==null?void 0:F.houseRules)??"",whatToExpect:((O=r==null?void 0:r.policies)==null?void 0:O.whatToExpect)??"",whatToBring:((D=r==null?void 0:r.policies)==null?void 0:D.whatToBring)??"",parkingInstructions:((J=r==null?void 0:r.policies)==null?void 0:J.parkingInstructions)??"",requiresWaiver:((ue=r==null?void 0:r.policies)==null?void 0:ue.requiresWaiver)??!1,waiverText:((ye=r==null?void 0:r.policies)==null?void 0:ye.waiverText)??"",ageRequirement:((oe=r==null?void 0:r.policies)==null?void 0:oe.ageRequirement)??18}),[x,b]=y.useState(!1),[f,p]=y.useState("booking"),u=async()=>{if(!U)return;b(!0);const C=I.loading("Saving policies..."),V=(s==null?void 0:s.id)||(s==null?void 0:s.uid);try{await U.from("profiles").update({policies:n,updated_at:new Date().toISOString()}).eq("id",V),I.success("Policies saved!",{id:C}),m&&m({policies:n})}catch(H){console.error("Save failed:",H),I.error("Failed to save",{id:C})}finally{b(!1)}},g=(C,V)=>{l(H=>({...H,[C]:V}))},j=[{id:"flexible",label:"Flexible",description:"Full refund up to 24 hours before session",color:"green"},{id:"moderate",label:"Moderate",description:"50% refund up to 48 hours before session",color:"amber"},{id:"strict",label:"Strict",description:"No refunds within 7 days of session",color:"red"},{id:"custom",label:"Custom",description:"Set your own cancellation terms",color:"blue"}],d=({id:C,title:V,icon:H,children:Z})=>{const he=f===C;return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("button",{onClick:()=>p(he?null:C),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-[#23262f] transition",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-brand-blue/10 rounded-lg flex items-center justify-center",children:t.jsx(H,{className:"text-brand-blue",size:20})}),t.jsx("h3",{className:"font-bold dark:text-white",children:V})]}),he?t.jsx(Us,{size:20}):t.jsx(Os,{size:20})]}),he&&t.jsx("div",{className:"p-4 pt-0 border-t dark:border-gray-700",children:Z})]})};return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Ze,{className:"text-brand-blue",size:24}),"Policies & Rules"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Set booking rules, cancellation policies, and house rules"})]}),t.jsxs("button",{onClick:u,disabled:x,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[x?t.jsx(fe,{className:"animate-spin",size:18}):t.jsx(Re,{size:18}),"Save Changes"]})]}),t.jsx(d,{id:"booking",title:"Booking Rules",icon:Qt,children:t.jsxs("div",{className:"space-y-6 pt-4",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Hours"}),t.jsx("input",{type:"number",value:n.minBookingHours,onChange:C=>g("minBookingHours",parseInt(C.target.value)||1),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Max Hours"}),t.jsx("input",{type:"number",value:n.maxBookingHours,onChange:C=>g("maxBookingHours",parseInt(C.target.value)||12),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Book Ahead (Days)"}),t.jsx("input",{type:"number",value:n.advanceBookingDays,onChange:C=>g("advanceBookingDays",parseInt(C.target.value)||7),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Notice (Hrs)"}),t.jsx("input",{type:"number",value:n.minAdvanceHours,onChange:C=>g("minAdvanceHours",parseInt(C.target.value)||0),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:"Auto-Approve Bookings"}),t.jsx("div",{className:"text-sm text-gray-500",children:"Automatically confirm bookings without manual approval"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:n.autoApprove,onChange:C=>g("autoApprove",C.target.checked),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-brand-blue"})]})]})]})}),t.jsx(d,{id:"cancellation",title:"Cancellation Policy",icon:Fr,children:t.jsxs("div",{className:"space-y-4 pt-4",children:[t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:j.map(C=>t.jsxs("button",{onClick:()=>g("cancellationPolicy",C.id),className:`p-4 rounded-xl border-2 text-left transition ${n.cancellationPolicy===C.id?`border-${C.color}-500 bg-${C.color}-50 dark:bg-${C.color}-900/20`:"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[t.jsx("div",{className:`font-bold mb-1 ${n.cancellationPolicy===C.id?`text-${C.color}-700 dark:text-${C.color}-400`:"dark:text-white"}`,children:C.label}),t.jsx("div",{className:"text-xs text-gray-500",children:C.description})]},C.id))}),n.cancellationPolicy==="custom"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Notice Required (Hours)"}),t.jsx("input",{type:"number",value:n.cancellationNoticeHours,onChange:C=>g("cancellationNoticeHours",parseInt(C.target.value)||24),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Refund Percentage"}),t.jsx("input",{type:"number",value:n.refundPercentage,onChange:C=>g("refundPercentage",parseInt(C.target.value)||0),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0,max:100})]})]})]})}),t.jsx(d,{id:"pricing",title:"Pricing & Deposits",icon:St,children:t.jsxs("div",{className:"space-y-6 pt-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:"Require Deposit"}),t.jsx("div",{className:"text-sm text-gray-500",children:"Collect partial payment when booking"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:n.depositRequired,onChange:C=>g("depositRequired",C.target.checked),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue"})]})]}),n.depositRequired&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Deposit Percentage"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"range",value:n.depositPercentage,onChange:C=>g("depositPercentage",parseInt(C.target.value)),className:"flex-1",min:10,max:100,step:5}),t.jsxs("span",{className:"font-bold text-brand-blue w-14 text-right",children:[n.depositPercentage,"%"]})]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white mb-3",children:"Peak Hour Pricing"}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Peak Start"}),t.jsx("input",{type:"time",value:n.peakHoursStart,onChange:C=>g("peakHoursStart",C.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Peak End"}),t.jsx("input",{type:"time",value:n.peakHoursEnd,onChange:C=>g("peakHoursEnd",C.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Rate Multiplier"}),t.jsx("input",{type:"number",value:n.peakHourMultiplier,onChange:C=>g("peakHourMultiplier",parseFloat(C.target.value)||1),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1,max:3,step:.1})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Weekend Rate Multiplier"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("input",{type:"range",value:n.weekendMultiplier,onChange:C=>g("weekendMultiplier",parseFloat(C.target.value)),className:"flex-1",min:1,max:2,step:.1}),t.jsxs("span",{className:"font-bold dark:text-white w-16 text-right",children:[n.weekendMultiplier,"x"]})]}),n.weekendMultiplier>1&&t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Saturday & Sunday bookings will be ",Math.round((n.weekendMultiplier-1)*100),"% more"]})]})]})}),t.jsx(d,{id:"rules",title:"House Rules & Info",icon:Ze,children:t.jsxs("div",{className:"space-y-4 pt-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio Rules"}),t.jsx("textarea",{value:n.houseRules,onChange:C=>g("houseRules",C.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:4,placeholder:`• No smoking inside the studio
• Please arrive 10 minutes early
• Clean up after your session`})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"What to Expect"}),t.jsx("textarea",{value:n.whatToExpect,onChange:C=>g("whatToExpect",C.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:"Describe what clients can expect when they arrive..."})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"What to Bring"}),t.jsx("textarea",{value:n.whatToBring,onChange:C=>g("whatToBring",C.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:`• Instrument cables
• Lyrics/charts
• Reference tracks`})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Parking Instructions"}),t.jsx("textarea",{value:n.parkingInstructions,onChange:C=>g("parkingInstructions",C.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:"Describe parking situation and directions..."})]})]})]})}),t.jsx(d,{id:"legal",title:"Legal & Safety",icon:Ws,children:t.jsxs("div",{className:"space-y-4 pt-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Minimum Age Requirement"}),t.jsx("input",{type:"number",value:n.ageRequirement,onChange:C=>g("ageRequirement",parseInt(C.target.value)||0),className:"w-32 p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]}),t.jsx("p",{className:"text-sm text-gray-500 mt-6",children:n.ageRequirement>0?`Clients must be ${n.ageRequirement}+ to book`:"No age restriction"})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:"Require Liability Waiver"}),t.jsx("div",{className:"text-sm text-gray-500",children:"Clients must sign a waiver before booking"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:n.requiresWaiver,onChange:C=>g("requiresWaiver",C.target.checked),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue"})]})]}),n.requiresWaiver&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Waiver Text"}),t.jsx("textarea",{value:n.waiverText,onChange:C=>g("waiverText",C.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white font-mono text-sm",rows:6,placeholder:"Enter your liability waiver text..."})]})]})]})})]})}const Ba=async(s,r,m)=>{if(U)try{const n=s.sender_id||s.client_id,l=s.studio_owner_id||s.target_id;if(!n){console.warn("Cannot send notification: no target user ID");return}const x={user_id:n,type:"booking",actor_id:l,actor_name:s.target_name||s.studio_name||"Studio",target_type:"booking",target_id:s.id,title:`Booking ${r}`,body:`Your booking with ${s.target_name||"the studio"} has been ${r.toLowerCase()}.`,link:`/bookings/${s.id}`,read:!1,action_taken:r.toLowerCase(),created_at:new Date().toISOString()};try{const{error:b}=await U.from("notifications").insert(x);b&&console.log("Notification insert error (non-critical):",b.message)}catch(b){console.log("Notifications table not available:",b.message)}try{const b="/api",f=`Booking ${r} - ${s.target_name||"Studio"}`,p=`
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <h2>Booking ${r}</h2>
                    <p>Your booking with <strong>${s.target_name||"the studio"}</strong> has been ${r.toLowerCase()}.</p>
                    ${s.date&&s.date!=="Flexible"?`<p><strong>Date:</strong> ${new Date(s.date).toLocaleDateString()}</p>`:""}
                    ${s.offer_amount?`<p><strong>Amount:</strong> $${s.offer_amount}</p>`:""}
                    <p><a href="${window.location.origin}/bookings/${s.id}" style="background: #3B82F6; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block;">View Booking</a></p>
                </div>
            `,{data:u}=await U.from("users").select("email").eq("id",n).single();u!=null&&u.email&&await fetch(`${b}/notifications/send-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:u.email,subject:f,html:p,text:`Your booking with ${s.target_name||"the studio"} has been ${r.toLowerCase()}.`})}).catch(g=>console.log("Email send error (non-critical):",g))}catch(b){console.log("Email notification error (non-critical):",b)}try{await fetch("/api/notifications/send-push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n,title:`Booking ${r}`,body:`Your booking with ${s.target_name||"the studio"} has been ${r.toLowerCase()}.`,data:{bookingId:s.id,status:r,url:`/bookings/${s.id}`}})}).catch(f=>console.log("Push notification error (non-critical):",f))}catch(b){console.log("Push notification error (non-critical):",b)}}catch(n){console.error("Error sending notification:",n)}},Fa=async(s,r)=>{if(!U)return{hasConflict:!1,conflicts:[]};try{if(!s.date||s.date==="Flexible")return{hasConflict:!1,conflicts:[]};const m=new Date(s.date);if(isNaN(m.getTime()))return{hasConflict:!1,conflicts:[]};const{data:n,error:l}=await U.from("bookings").select("id, status, date, time, duration, sender_name").or(`studio_owner_id.eq.${r},target_id.eq.${r}`).eq("status","Confirmed").neq("id",s.id);if(l)return console.error("Error checking conflicts:",l),{hasConflict:!1,conflicts:[]};const x=(n||[]).filter(b=>{const f=Ks(b.date);if(!f||f.toDateString()!==m.toDateString())return!1;if(s.booking_start&&b.booking_start&&s.duration&&b.duration){const p=new Date(s.booking_start),u=new Date(p.getTime()+s.duration*60*60*1e3),g=new Date(b.booking_start),j=new Date(g.getTime()+b.duration*60*60*1e3);return!(u<=g||p>=j)}return!0});return{hasConflict:x.length>0,conflicts:x}}catch(m){return console.error("Error checking conflicts:",m),{hasConflict:!1,conflicts:[]}}},Pa=(s,r)=>{const n={Pending:["Confirmed","Cancelled"],Confirmed:["Completed","Cancelled"],Completed:[],Cancelled:[]}[s]||[];return{isValid:n.includes(r),allowedStatuses:n}},Ks=s=>{if(!s||s==="Flexible")return null;try{const r=new Date(s);return isNaN(r.getTime())?null:r}catch{return null}},Aa=async(s,r,m,n,l="")=>{if(U)try{const x={booking_id:s,old_status:r,new_status:m,changed_by:n,notes:l,created_at:new Date().toISOString()},{error:b}=await U.from("booking_history").insert(x);b&&console.log("Booking history table not available:",b.message)}catch(x){console.log("Booking history tracking error (non-critical):",x.message)}},La=(s,r)=>{if(!r)return{fee:0,refund:s.offer_amount||0};const m=new Date,n=Ks(s.date);if(!n)return{fee:0,refund:s.offer_amount||0};const l=(n.getTime()-m.getTime())/(1e3*60*60),x=s.offer_amount||0;let b=0,f=0;const p=r||{feeStructure:{"48+":0,"24-48":.25,"12-24":.5,"0-12":.75,past:1}};l<0?f=p.feeStructure.past||1:l<12?f=p.feeStructure["0-12"]||.75:l<24?f=p.feeStructure["12-24"]||.5:l<48?f=p.feeStructure["24-48"]||.25:f=p.feeStructure["48+"]||0,b=x*f;const u=x-b;return{fee:Math.round(b*100)/100,refund:Math.round(u*100)/100,feePercentage:f,hoursUntilBooking:Math.round(l*10)/10}},Ia=async(s,r=[24,2])=>{if(U)try{const m=new Date(s.date);if(isNaN(m.getTime())||s.date==="Flexible")return;const n=r.map(x=>{const b=new Date(m.getTime()-x*60*60*1e3);return{booking_id:s.id,user_id:s.sender_id,reminder_type:x>=24?"day_before":"hours_before",reminder_hours:x,scheduled_for:b.toISOString(),sent:!1,created_at:new Date().toISOString()}}),{error:l}=await U.from("booking_reminders").insert(n);l&&console.log("Reminder scheduling error (non-critical):",l.message)}catch(m){console.log("Reminder scheduling error (non-critical):",m.message)}};function Da({booking:s,onClose:r,onSuccess:m}){const[n,l]=y.useState("weekly"),[x,b]=y.useState(1),[f,p]=y.useState([]),[u,g]=y.useState(""),[j,d]=y.useState(""),[i,h]=y.useState(!1),k=z=>{p($=>$.includes(z)?$.filter(M=>M!==z):[...$,z].sort())},N=async z=>{if(z.preventDefault(),!s||!U)return;h(!0);const $=I.loading("Creating recurring bookings...");try{const M=new Date(s.date);if(isNaN(M.getTime()))throw new Error("Invalid booking date");let A=new Date(M);if(n==="weekly"&&f.length>0){const B=M.getDay(),T=f.find(F=>F>B)||f[0],S=T-B+(T<B?7:0);A=new Date(M.getTime()+S*24*60*60*1e3)}else n==="daily"?A=new Date(M.getTime()+x*24*60*60*1e3):n==="monthly"&&(A=new Date(M),A.setMonth(A.getMonth()+x));const v={type:n,interval:x,daysOfWeek:n==="weekly"?f:null},{data:R,error:w}=await U.from("recurring_bookings").insert({parent_booking_id:s.id,studio_id:s.studio_owner_id||s.target_id,sender_id:s.sender_id,recurrence_type:n,recurrence_pattern:v,start_date:M.toISOString().split("T")[0],end_date:u||null,next_occurrence:A.toISOString().split("T")[0],max_occurrences:j?parseInt(j):null,is_active:!0}).select().single();if(w)throw w;I.success("Recurring booking created!",{id:$}),m==null||m(),r()}catch(M){console.error("Error creating recurring booking:",M),I.error("Failed to create recurring booking: "+M.message,{id:$})}finally{h(!1)}};return t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-md w-full",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Pr,{size:18,className:"text-brand-blue"}),"Create Recurring Booking"]}),t.jsx("button",{onClick:r,children:t.jsx(ie,{size:20,className:"text-gray-500"})})]}),t.jsxs("form",{onSubmit:N,className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Repeat"}),t.jsxs("select",{value:n,onChange:z=>l(z.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[t.jsx("option",{value:"daily",children:"Daily"}),t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"monthly",children:"Monthly"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:["Every ",n==="daily"?"X days":n==="weekly"?"X weeks":"X months"]}),t.jsx("input",{type:"number",min:"1",value:x,onChange:z=>b(parseInt(z.target.value)||1),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),n==="weekly"&&t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Days of Week"}),t.jsx("div",{className:"grid grid-cols-7 gap-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((z,$)=>t.jsx("button",{type:"button",onClick:()=>k($),className:`p-2 rounded-lg text-sm font-medium transition ${f.includes($)?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:z},$))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"End Date (optional)"}),t.jsx("input",{type:"date",value:u,onChange:z=>g(z.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Max Occurrences (optional)"}),t.jsx("input",{type:"number",min:"1",value:j,onChange:z=>d(z.target.value),placeholder:"Unlimited if empty",className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:r,className:"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:i||n==="weekly"&&f.length===0,className:"flex-1 py-2.5 bg-brand-blue text-white rounded-lg font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50",children:[t.jsx(Re,{size:16}),"Create Recurring"]})]})]})]})})}function qa({booking:s,rooms:r,onClose:m,onSuccess:n}){const[l,x]=y.useState([]),[b,f]=y.useState({}),[p,u]=y.useState(!1);y.useEffect(()=>{if(s!=null&&s.booking_start&&(s!=null&&s.duration)){const i=new Date(s.booking_start),h=new Date(i.getTime()+s.duration*60*60*1e3),k={};l.forEach(N=>{k[N]={start:i.toISOString().slice(0,16),end:h.toISOString().slice(0,16)}}),f(k)}},[l,s]);const g=i=>{x(h=>h.includes(i)?h.filter(k=>k!==i):[...h,i])},j=(i,h,k)=>{f(N=>({...N,[i]:{...N[i],[h]:k}}))},d=async i=>{if(i.preventDefault(),!s||l.length===0||!U)return;u(!0);const h=I.loading("Assigning rooms...");try{const k=l.map(z=>{const $=b[z],M=$!=null&&$.start?new Date($.start):new Date(s.booking_start||s.date),A=$!=null&&$.end?new Date($.end):new Date(M.getTime()+s.duration*60*60*1e3),v=r.find(R=>R.id===z);return{booking_id:s.id,room_id:z,room_name:(v==null?void 0:v.name)||`Room ${z}`,start_time:M.toISOString(),end_time:A.toISOString()}}),{error:N}=await U.from("room_bookings").insert(k);if(N)throw N;I.success(`${l.length} room(s) assigned!`,{id:h}),n==null||n(),m()}catch(k){console.error("Error assigning rooms:",k),I.error("Failed to assign rooms: "+k.message,{id:h})}finally{u(!1)}};return t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(we,{size:18,className:"text-brand-blue"}),"Assign Rooms"]}),t.jsx("button",{onClick:m,children:t.jsx(ie,{size:20,className:"text-gray-500"})})]}),t.jsxs("form",{onSubmit:d,className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Select Rooms"}),t.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:r.map(i=>{var h,k;return t.jsxs("div",{className:`p-3 border rounded-lg cursor-pointer transition ${l.includes(i.id)?"border-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,onClick:()=>g(i.id),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white",children:i.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:["$",i.rate,"/hr • ",i.capacity," people"]})]}),t.jsx("input",{type:"checkbox",checked:l.includes(i.id),onChange:()=>g(i.id),className:"w-4 h-4 text-brand-blue"})]}),l.includes(i.id)&&t.jsxs("div",{className:"mt-3 pt-3 border-t dark:border-gray-600 grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"Start"}),t.jsx("input",{type:"datetime-local",value:((h=b[i.id])==null?void 0:h.start)||"",onChange:N=>j(i.id,"start",N.target.value),className:"w-full p-1.5 text-sm border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"End"}),t.jsx("input",{type:"datetime-local",value:((k=b[i.id])==null?void 0:k.end)||"",onChange:N=>j(i.id,"end",N.target.value),className:"w-full p-1.5 text-sm border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]})]})]},i.id)})})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:m,className:"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:p||l.length===0,className:"flex-1 py-2.5 bg-brand-blue text-white rounded-lg font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50",children:[t.jsx(Re,{size:16}),"Assign ",l.length>0?`(${l.length})`:""]})]})]})]})})}function Ua({currentDate:s=new Date,onDateChange:r,bookings:m=[],blockedDates:n=[],onDateClick:l,onBookingClick:x,view:b="month",onViewChange:f,showControls:p=!0,className:u=""}){const[g,j]=y.useState(s),[d,i]=y.useState(b),h=s||g,k=b||d,N=T=>{j(T),r&&r(T)},z=T=>{i(T),f&&f(T)},$=T=>{const S=new Date(h);k==="month"?S.setMonth(S.getMonth()+T):k==="week"?S.setDate(S.getDate()+T*7):k==="day"&&S.setDate(S.getDate()+T),N(S)},M=()=>{N(new Date)},A=T=>{const S=new Date(T),F=S.getDay(),O=S.getDate()-F;return new Date(S.setDate(O))},v=T=>{const S=A(T),F=[];for(let O=0;O<7;O++){const D=new Date(S);D.setDate(S.getDate()+O),F.push(D)}return F},R=T=>T?m.filter(S=>{if(!S.date)return!1;const F=S.date instanceof Date?S.date:new Date(S.date);return isNaN(F.getTime())?!1:F.toDateString()===T.toDateString()}):[],w=T=>T?n.filter(S=>{if(!S.date)return!1;const F=S.date instanceof Date?S.date:new Date(S.date);return isNaN(F.getTime())?!1:F.toDateString()===T.toDateString()}):[],B=()=>{if(k==="month")return h.toLocaleDateString("en-US",{month:"long",year:"numeric"});if(k==="week"){const T=v(h),S=T[0],F=T[6];return S.getMonth()===F.getMonth()?`${S.toLocaleDateString("en-US",{month:"long",day:"numeric"})} - ${F.toLocaleDateString("en-US",{day:"numeric",year:"numeric"})}`:`${S.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${F.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`}else return h.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})};return t.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden ${u}`,children:[p&&t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("div",{className:"flex bg-gray-200 dark:bg-gray-700 rounded-lg p-1",children:["month","week","day"].map(T=>t.jsx("button",{onClick:()=>z(T),className:`px-3 py-1.5 rounded-md text-sm font-medium transition capitalize ${k===T?"bg-white dark:bg-gray-600 shadow text-brand-blue dark:text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:T},T))}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>$(-1),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition",children:t.jsx(Yt,{size:20,className:"text-gray-600 dark:text-gray-300"})}),t.jsx("button",{onClick:M,className:"px-3 py-1.5 text-sm font-medium text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",children:"Today"}),t.jsx("button",{onClick:()=>$(1),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition",children:t.jsx(Ue,{size:20,className:"text-gray-600 dark:text-gray-300"})})]})]}),t.jsx("div",{className:"text-center",children:t.jsx("h3",{className:"font-bold dark:text-white text-lg",children:B()})})]}),t.jsxs("div",{className:"p-4",children:[k==="month"&&t.jsx(Oa,{date:h,bookings:m,blockedDates:n,onDateClick:l,onBookingClick:x,getDayBookings:R,getDayBlocks:w}),k==="week"&&t.jsx(Wa,{date:h,bookings:m,blockedDates:n,onDateClick:l,onBookingClick:x,getDayBookings:R,getDayBlocks:w,getWeekDates:v}),k==="day"&&t.jsx(Ha,{date:h,bookings:m,blockedDates:n,onDateClick:l,onBookingClick:x,getDayBookings:R,getDayBlocks:w})]}),t.jsx("div",{className:"px-4 pb-4",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-4 border-t dark:border-gray-700 text-xs text-gray-500",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Confirmed"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"Pending"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ke,{size:12,className:"text-red-500"}),"Blocked"]})]})})]})}function Oa({date:s,bookings:r,blockedDates:m,onDateClick:n,onBookingClick:l,getDayBookings:x,getDayBlocks:b}){const f=s.getFullYear(),p=s.getMonth(),u=new Date,g=new Date(f,p,1).getDay(),j=new Date(f,p+1,0).getDate(),d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=[];for(let h=0;h<g;h++)i.push(null);for(let h=1;h<=j;h++)i.push(h);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:d.map(h=>t.jsx("div",{className:"text-center text-sm font-bold text-gray-500 py-2",children:h},h))}),t.jsx("div",{className:"grid grid-cols-7 gap-2",children:i.map((h,k)=>{if(h===null)return t.jsx("div",{className:"aspect-square"},`empty-${k}`);const N=new Date(f,p,h),z=N<new Date(u.getFullYear(),u.getMonth(),u.getDate()),$=N.toDateString()===u.toDateString(),M=x(N),A=b(N),v=M.some(B=>(B.status||"").toLowerCase()==="confirmed"),R=M.some(B=>(B.status||"").toLowerCase()==="pending"),w=A.length>0;return t.jsxs("button",{onClick:()=>{!z&&n&&n(N),M.length>0&&l&&l(M[0],N)},disabled:z,className:`aspect-square p-1 rounded-xl flex flex-col items-center justify-center relative transition ${z?"opacity-40 cursor-not-allowed":w?"bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 hover:bg-red-200 dark:hover:bg-red-900/40":$?"bg-brand-blue text-white":v||R?"bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[t.jsx("span",{className:`text-sm font-medium ${$?"text-white":w?"text-red-700 dark:text-red-400":"dark:text-white"}`,children:h}),t.jsxs("div",{className:"flex gap-0.5 mt-0.5",children:[v&&t.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),R&&t.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),w&&t.jsx(Ke,{size:10,className:"text-red-600 dark:text-red-400"})]}),M.length>0&&!$&&t.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-brand-blue text-white text-[10px] rounded-full flex items-center justify-center font-bold",children:M.length})]},h)})})]})}function Wa({date:s,bookings:r,blockedDates:m,onDateClick:n,onBookingClick:l,getDayBookings:x,getDayBlocks:b,getWeekDates:f}){const p=f(s),u=new Date,g=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],j=[];for(let d=6;d<=23;d++)j.push(d);return t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("div",{className:"min-w-[800px]",children:[t.jsxs("div",{className:"grid grid-cols-8 gap-2 mb-2 border-b dark:border-gray-700 pb-2",children:[t.jsx("div",{className:"text-sm font-bold text-gray-500",children:"Time"}),p.map((d,i)=>{const h=d.toDateString()===u.toDateString();return t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`text-xs font-medium text-gray-400 mb-1 ${h?"text-brand-blue":""}`,children:g[d.getDay()]}),t.jsx("div",{className:`text-sm font-bold ${h?"text-brand-blue":"dark:text-white"}`,children:d.getDate()})]},i)})]}),t.jsxs("div",{className:"grid grid-cols-8 gap-2",children:[t.jsx("div",{className:"space-y-1",children:j.map(d=>t.jsxs("div",{className:"h-16 flex items-start pt-1 text-xs text-gray-400",children:[d.toString().padStart(2,"0"),":00"]},d))}),p.map((d,i)=>{const h=x(d),k=b(d),N=d.toDateString()===u.toDateString();return t.jsx("div",{className:"relative",children:j.map((z,$)=>{const M=new Date(d);M.setHours(z,0,0,0);const A=new Date(d);A.setHours(z+1,0,0,0);const v=h.filter(w=>{if(!w.startTime)return!1;const B=new Date(`${d.toDateString()} ${w.startTime}`);return B>=M&&B<A}),R=k.some(w=>(w.time_slot||w.timeSlot)==="full");return t.jsx("div",{onClick:()=>n&&n(M),className:`h-16 border-b dark:border-gray-700 cursor-pointer transition ${N?"bg-blue-50 dark:bg-blue-900/10":"hover:bg-gray-50 dark:hover:bg-gray-800"} ${R?"bg-red-50 dark:bg-red-900/20":""}`,children:v.map((w,B)=>t.jsxs("div",{onClick:T=>{T.stopPropagation(),l&&l(w,d)},className:`text-xs p-1 m-0.5 rounded cursor-pointer ${(w.status||"").toLowerCase()==="confirmed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:[w.startTime||""," ",w.clientName||"Booking"]},B))},$)})},i)})]})]})})}function Ha({date:s,bookings:r,blockedDates:m,onDateClick:n,onBookingClick:l,getDayBookings:x,getDayBlocks:b}){const f=new Date,p=s.toDateString()===f.toDateString(),u=x(s),g=b(s),j=[];for(let i=6;i<=23;i++)j.push(i);const d=y.useMemo(()=>{const i={};return u.forEach(h=>{if(!h.startTime)return;const k=parseInt(h.startTime.split(":")[0]);i[k]||(i[k]=[]),i[k].push(h)}),i},[u]);return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${p?"bg-brand-blue text-white border-brand-blue":"bg-gray-50 dark:bg-[#1f2128] border-gray-200 dark:border-gray-700"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-lg",children:s.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),t.jsxs("p",{className:`text-sm mt-1 ${p?"text-blue-100":"text-gray-500"}`,children:[u.length," booking",u.length!==1?"s":"",g.length>0&&` • ${g.length} blocked slot${g.length!==1?"s":""}`]})]}),g.length>0&&t.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400",children:[t.jsx(Ke,{size:20}),t.jsx("span",{className:"font-medium",children:"Blocked"})]})]})}),t.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[t.jsx("div",{className:"col-span-2 space-y-1",children:j.map(i=>t.jsxs("div",{className:"h-20 flex items-start pt-2 text-sm text-gray-500 font-medium",children:[i.toString().padStart(2,"0"),":00"]},i))}),t.jsx("div",{className:"col-span-10 relative",children:j.map((i,h)=>{const k=new Date(s);k.setHours(i,0,0,0),new Date(s).setHours(i+1,0,0,0);const z=d[i]||[],$=g.some(M=>{const A=M.time_slot||M.timeSlot,v=M.start_time||M.startTime,R=M.end_time||M.endTime;if(A==="full")return!0;if(A==="custom"&&v&&R){const w=parseInt(v.split(":")[0]),B=parseInt(R.split(":")[0]);return i>=w&&i<B}return!1});return t.jsx("div",{onClick:()=>n&&n(k),className:`h-20 border-b dark:border-gray-700 cursor-pointer transition relative ${p?"bg-blue-50 dark:bg-blue-900/10":"hover:bg-gray-50 dark:hover:bg-gray-800"} ${$?"bg-red-50 dark:bg-red-900/20":""}`,children:z.map((M,A)=>t.jsxs("div",{onClick:v=>{v.stopPropagation(),l&&l(M,s)},className:`absolute left-1 right-1 p-2 rounded-lg cursor-pointer shadow-sm ${(M.status||"").toLowerCase()==="confirmed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-300 dark:border-green-700":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 border border-amber-300 dark:border-amber-700"}`,style:{top:`${(parseInt((M.startTime||"00:00").split(":")[1])||0)/60*100}%`,height:`${(M.duration||1)/60*100}%`},children:[t.jsxs("div",{className:"font-medium text-sm",children:[M.startTime||""," ",M.clientName||"Booking"]}),M.roomName&&t.jsxs("div",{className:"text-xs opacity-75 flex items-center gap-1 mt-0.5",children:[t.jsx(jt,{size:10}),M.roomName]})]},A))},h)})})]}),u.length>0&&t.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-gray-700",children:[t.jsx("h4",{className:"font-bold text-sm dark:text-white mb-3",children:"All Bookings"}),t.jsx("div",{className:"space-y-2",children:u.map(i=>t.jsx("div",{onClick:()=>l&&l(i,s),className:`p-3 rounded-lg cursor-pointer transition ${(i.status||"").toLowerCase()==="confirmed"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium dark:text-white",children:[i.startTime||"TBD"," - ",i.clientName||"Unknown"]}),i.roomName&&t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5 flex items-center gap-1",children:[t.jsx(jt,{size:10}),i.roomName]})]}),t.jsx("span",{className:`text-xs px-2 py-1 rounded font-medium ${(i.status||"").toLowerCase()==="confirmed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:i.status||"Pending"})]})},i.id))})]})]})}function Va({user:s,onNavigateToChat:r}){const[m,n]=y.useState([]),[l,x]=y.useState([]),[b,f]=y.useState(!0),[p,u]=y.useState("all"),[g,j]=y.useState(""),[d,i]=y.useState(null),[h,k]=y.useState(null),[N,z]=y.useState("list"),[$,M]=y.useState("month"),[A,v]=y.useState(new Date),[R,w]=y.useState(!1),[B,T]=y.useState(null),[S,F]=y.useState(""),[O,D]=y.useState("full"),[J,ue]=y.useState("09:00"),[ye,oe]=y.useState("17:00"),[C,V]=y.useState(!1),[H,Z]=y.useState(!1),[he,Oe]=y.useState(null),[se,ee]=y.useState(null);y.useEffect(()=>{if(!(s!=null&&s.id)&&!(s!=null&&s.uid)||!U)return;const E=(s==null?void 0:s.id)||(s==null?void 0:s.uid),q=U.channel("studio-bookings").on("postgres_changes",{event:"*",schema:"public",table:"bookings",filter:`studio_owner_id=eq.${E}`},()=>{Q()}).subscribe();return Q(),()=>{U.removeChannel(q)}},[s==null?void 0:s.id,s==null?void 0:s.uid]);const Be=E=>{if(!E||E==="Flexible")return null;try{const q=new Date(E);return isNaN(q.getTime())?null:q}catch{return null}},Q=async()=>{if(!U)return;const E=(s==null?void 0:s.id)||(s==null?void 0:s.uid);f(!0);try{const{data:q,error:W}=await U.from("bookings").select("*").or(`studio_owner_id.eq.${E},target_id.eq.${E}`).order("created_at",{ascending:!1});if(W)throw W;const G=(q||[]).map(K=>{const re=Be(K.date);return{id:K.id,...K,studioOwnerId:K.studio_owner_id,clientId:K.sender_id||K.client_id,clientName:K.sender_name||K.client_name,date:re||new Date,createdAt:K.created_at?new Date(K.created_at):new Date,status:K.status||"Pending"}});n(G)}catch(q){console.error("Error fetching bookings:",q),I.error("Failed to load bookings")}finally{f(!1)}};y.useEffect(()=>{if(!(s!=null&&s.id)&&!(s!=null&&s.uid)||!U)return;const E=(s==null?void 0:s.id)||(s==null?void 0:s.uid),q=U.channel("blocked-dates").on("postgres_changes",{event:"*",schema:"public",table:"blocked_dates",filter:`studio_owner_id=eq.${E}`},()=>{_e()}).subscribe();return _e(),()=>{U.removeChannel(q)}},[s==null?void 0:s.id,s==null?void 0:s.uid]);const _e=async()=>{if(!U)return;const E=(s==null?void 0:s.id)||(s==null?void 0:s.uid);try{const{data:q,error:W}=await U.from("blocked_dates").select("*").eq("studio_owner_id",E);if(W)throw W;const G=(q||[]).map(K=>({id:K.id,...K,studioOwnerId:K.studio_owner_id,date:K.date?new Date(K.date):new Date}));G.sort((K,re)=>new Date(K.date)-new Date(re.date)),x(G)}catch(q){console.error("Error fetching blocked dates:",q),I.error("Failed to load blocked dates"),x([])}},ne=async(E,q)=>{if(!U)return;k(E);const W=I.loading("Updating booking...");try{const{data:G,error:K}=await U.from("bookings").select("*").eq("id",E).single();if(K)throw K;if(!G)throw new Error("Booking not found");const re=G.status||"Pending",Fe=Pa(re,q);if(!Fe.isValid)throw new Error(`Invalid status transition: ${re} → ${q}. Allowed transitions: ${Fe.allowedStatuses.join(", ")||"none"}`);if(q==="Confirmed"){const be=(s==null?void 0:s.id)||(s==null?void 0:s.uid),ae=await Fa({...G,id:E},be);if(ae.hasConflict){const xe=ae.conflicts.map(le=>le.sender_name||"Unknown").join(", ");throw new Error(`Time slot conflict detected. Conflicting bookings: ${xe}. Please check calendar before confirming.`)}}const ce=new Date().toISOString(),it={Confirmed:"confirmed_at",Cancelled:"cancelled_at",Completed:"completed_at",Pending:"pending_at"},Mt={status:q,updated_at:ce},Et=it[q];if(Et&&(Mt[Et]=ce),q==="Confirmed"&&G.payment_intent_id)try{const ae=await fetch("/api/stripe/capture-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentIntentId:G.payment_intent_id})});if(!ae.ok){const xe=await ae.json().catch(()=>({}));console.warn("Payment capture failed:",xe)}}catch(be){console.error("Payment capture error:",be)}if((q==="Cancelled"||q==="cancelled")&&(re==="Confirmed"||re==="confirmed")&&G.payment_intent_id)try{const{data:be}=await U.from("cancellation_policies").select("*").eq("studio_id",(s==null?void 0:s.id)||(s==null?void 0:s.uid)).eq("is_default",!0).single(),xe=La(G,be||null),le="/api",He=xe.refund,te=await fetch(`${le}/stripe/refund-payment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentIntentId:G.payment_intent_id,amount:He,reason:"requested_by_customer"})});if(te.ok){const Pe=xe.fee>0?`Booking cancelled. Cancellation fee: $${xe.fee.toFixed(2)}. Refunded: $${He.toFixed(2)}`:"Booking cancelled and refund processed";I.success(Pe,{id:W})}else{const Pe=await te.json().catch(()=>({}));console.warn("Refund failed:",Pe),I.error(xe.fee>0?`Booking cancelled. Cancellation fee: $${xe.fee.toFixed(2)}. Refund failed - please contact support.`:"Booking cancelled but refund failed. Please contact support.",{id:W})}}catch(be){console.error("Refund error:",be),I.error("Booking cancelled but refund failed. Please contact support.",{id:W})}await Aa(E,re,q,(s==null?void 0:s.id)||(s==null?void 0:s.uid),`Status changed from ${re} to ${q}`);const{error:Y}=await U.from("bookings").update(Mt).eq("id",E);if(Y)throw Y;await Ba(G,q,(s==null?void 0:s.id)||(s==null?void 0:s.uid)),(q==="Confirmed"||q==="confirmed")&&await Ia({...G,status:q},[24,2]),(q!=="Cancelled"||re!=="Confirmed")&&I.success(`Booking ${q}!`,{id:W}),await Q()}catch(G){console.error("Update failed:",G),I.error(G.message||"Failed to update booking",{id:W})}finally{k(null)}},at=async()=>{if(!B||!(s!=null&&s.id)&&!(s!=null&&s.uid)||!U)return;const E=(s==null?void 0:s.id)||(s==null?void 0:s.uid),q=I.loading("Blocking time slot...");try{const{error:W}=await U.from("blocked_dates").insert({studio_owner_id:E,date:B.toISOString(),reason:S||"Off-platform booking",time_slot:O,start_time:O==="custom"?J:null,end_time:O==="custom"?ye:null,created_at:new Date().toISOString()});if(W)throw W;I.success("Time slot blocked!",{id:q}),w(!1),F(""),D("full"),T(null),await _e()}catch(W){console.error("Error blocking date:",W),I.error(W.message||"Failed to block time slot. Please try again.",{id:q})}},ge=async E=>{if(!U)return;const q=I.loading("Removing block...");try{await U.from("blocked_dates").delete().eq("id",E),I.success("Block removed!",{id:q})}catch(W){console.error("Error unblocking date:",W),I.error("Failed to remove block",{id:q})}},lt=E=>{T(E),w(!0)},de=m.filter(E=>{var re,Fe;const q=(E.status||"").toLowerCase(),W=p.toLowerCase(),G=p==="all"||q===W,K=!g||((re=E.clientName)==null?void 0:re.toLowerCase().includes(g.toLowerCase()))||((Fe=E.roomName)==null?void 0:Fe.toLowerCase().includes(g.toLowerCase()));return G&&K}),nt=de.reduce((E,q)=>{if(!q.date)return E;const W=q.date.toDateString();return E[W]||(E[W]=[]),E[W].push(q),E},{}),We=m.filter(E=>(E.status||"").toLowerCase()==="pending").length,_t=m.filter(E=>{if(!E.date)return!1;const q=new Date().toDateString();return E.date.toDateString()===q&&(E.status||"").toLowerCase()==="confirmed"}).length,zt=m.filter(E=>E.date?(E.status||"").toLowerCase()==="confirmed"&&E.date>=new Date:!1).reduce((E,q)=>E+(q.totalPrice||q.offer_amount||0),0);return b?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ar,{className:"animate-spin text-brand-blue",size:32})}):t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx($e,{className:"text-brand-blue",size:24}),"Booking Management"]}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[m.length," total bookings • ",l.length," blocked slots"]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex",children:[t.jsx("button",{onClick:()=>z("list"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition ${N==="list"?"bg-white dark:bg-gray-700 text-brand-blue shadow-sm":"text-gray-500"}`,children:"List"}),t.jsx("button",{onClick:()=>z("calendar"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition ${N==="calendar"?"bg-white dark:bg-gray-700 text-brand-blue shadow-sm":"text-gray-500"}`,children:"Calendar"})]})})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl border border-amber-200 dark:border-amber-800",children:[t.jsx("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:We}),t.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Pending Approval"})]}),t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:_t}),t.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Today's Sessions"})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[t.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:["$",zt.toLocaleString()]}),t.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Upcoming Revenue"})]})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(Hs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),t.jsx("input",{type:"text",value:g,onChange:E=>j(E.target.value),placeholder:"Search by client or room...",className:"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsx("div",{className:"flex gap-2",children:["all","pending","confirmed","completed","cancelled"].map(E=>t.jsxs("button",{onClick:()=>u(E),className:`px-4 py-2 rounded-lg font-medium text-sm transition ${p===E?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[E.charAt(0).toUpperCase()+E.slice(1),E==="pending"&&We>0&&t.jsx("span",{className:"ml-1.5 bg-amber-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:We})]},E))})]}),N==="calendar"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx(Ua,{currentDate:A,onDateChange:v,view:$,onViewChange:M,bookings:m,blockedDates:l,onDateClick:E=>{const q=new Date;E<new Date(q.getFullYear(),q.getMonth(),q.getDate())||lt(E)},onBookingClick:(E,q)=>{i(E)},showControls:!0}),l.length>0&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-4",children:[t.jsxs("h4",{className:"font-bold text-sm dark:text-white mb-3 flex items-center gap-2",children:[t.jsx(Ke,{size:14,className:"text-red-500"}),"Blocked Time Slots"]}),t.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:l.map(E=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg border dark:border-gray-700",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium dark:text-white text-sm",children:[new Date(E.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),E.time_slot&&E.time_slot!=="full"&&t.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",E.time_slot==="custom"?`${E.start_time||""} - ${E.end_time||""}`:E.time_slot,")"]})]}),t.jsx("div",{className:"text-xs text-gray-500",children:E.reason})]}),t.jsx("button",{onClick:()=>ge(E.id),className:"p-1.5 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition",title:"Remove block",children:t.jsx(Te,{size:16})})]},E.id))})]})]}),N==="list"&&t.jsx(t.Fragment,{children:de.length===0?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center",children:[t.jsx($e,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),t.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Bookings Found"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:p!=="all"?`No ${p} bookings`:"Bookings will appear here when clients book your studio"})]}):t.jsx("div",{className:"space-y-6",children:Object.entries(nt).map(([E,q])=>t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-3 flex items-center gap-2",children:[t.jsx($e,{size:14}),new Date(E).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),t.jsxs("span",{className:"text-gray-400",children:["(",q.length,")"]})]}),t.jsx("div",{className:"space-y-3",children:q.map(W=>{const G=getStatusConfig(W.status);return t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:t.jsxs("div",{className:"p-4 flex items-center gap-4",children:[t.jsxs("div",{className:"text-center min-w-[70px]",children:[t.jsx("div",{className:"text-lg font-bold dark:text-white",children:W.startTime}),t.jsxs("div",{className:"text-xs text-gray-500",children:[W.duration,"h"]})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-bold dark:text-white truncate",children:W.clientName||"Unknown Client"}),t.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${G.bgClass}`,children:G.label})]}),t.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[W.roomName||"Main Room"," • $",W.totalPrice||0]}),W.notes&&t.jsxs("div",{className:"text-xs text-gray-400 mt-1 truncate",children:["Note: ",W.notes]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[(W.status||"").toLowerCase()==="pending"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>ne(W.id,"Confirmed"),disabled:h===W.id,className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition",title:"Approve",children:t.jsx(Lr,{size:18})}),t.jsx("button",{onClick:()=>ne(W.id,"Cancelled"),disabled:h===W.id,className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition",title:"Decline",children:t.jsx(ie,{size:18})})]}),(W.status||"").toLowerCase()==="confirmed"&&t.jsx("button",{onClick:()=>ne(W.id,"Completed"),disabled:h===W.id,className:"px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium",children:"Mark Complete"}),W.clientId&&r&&t.jsx("button",{onClick:()=>r(W.clientId),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Message Client",children:t.jsx(Ir,{size:18})}),t.jsx("button",{onClick:()=>i(W),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"View Details",children:t.jsx(Xt,{size:18})})]})]})},W.id)})})]},E))})}),R&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-md w-full",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Ke,{size:18,className:"text-red-500"}),"Block Time Slot"]}),t.jsx("button",{onClick:()=>{w(!1),T(null),F("")},children:t.jsx(ie,{size:20,className:"text-gray-500"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg text-center",children:[t.jsx("div",{className:"text-sm text-gray-500 uppercase font-bold mb-1",children:"Selected Date"}),t.jsx("div",{className:"text-lg font-bold dark:text-white",children:B==null?void 0:B.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Time Slot"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"full",label:"Full Day"},{id:"morning",label:"Morning (6AM-12PM)"},{id:"afternoon",label:"Afternoon (12PM-6PM)"},{id:"evening",label:"Evening (6PM-12AM)"}].map(E=>t.jsx("button",{onClick:()=>D(E.id),className:`p-2 text-sm rounded-lg border transition ${O===E.id?"bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400":"border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300"}`,children:E.label},E.id))}),t.jsx("button",{onClick:()=>D("custom"),className:`w-full mt-2 p-2 text-sm rounded-lg border transition ${O==="custom"?"bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400":"border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300"}`,children:"Custom Time Range"}),O==="custom"&&t.jsxs("div",{className:"flex gap-2 mt-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"Start"}),t.jsx("input",{type:"time",value:J,onChange:E=>ue(E.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"End"}),t.jsx("input",{type:"time",value:ye,onChange:E=>oe(E.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Reason (optional)"}),t.jsx("input",{type:"text",value:S,onChange:E=>F(E.target.value),placeholder:"e.g., Private session, Maintenance, Personal...",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{onClick:()=>{w(!1),T(null),F("")},className:"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Cancel"}),t.jsxs("button",{onClick:at,className:"flex-1 py-2.5 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition flex items-center justify-center gap-2",children:[t.jsx(Ke,{size:16}),"Block Time"]})]})]})]})}),d&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsx("h3",{className:"font-bold dark:text-white",children:"Booking Details"}),t.jsx("button",{onClick:()=>i(null),children:t.jsx(ie,{size:20,className:"text-gray-500"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-brand-blue/10 rounded-full flex items-center justify-center",children:t.jsx(Dr,{className:"text-brand-blue",size:24})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-bold dark:text-white",children:d.clientName}),t.jsx("div",{className:"text-sm text-gray-500",children:d.clientEmail})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Date"}),t.jsx("div",{className:"dark:text-white",children:d.date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Time"}),t.jsxs("div",{className:"dark:text-white",children:[d.startTime," (",d.duration,"h)"]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Room"}),t.jsx("div",{className:"dark:text-white",children:d.roomName})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Total"}),t.jsxs("div",{className:"dark:text-white font-bold text-green-600",children:["$",d.totalPrice||d.offer_amount||0]})]})]}),d.notes&&t.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-3 rounded-lg",children:[t.jsx("div",{className:"text-xs text-amber-600 uppercase font-bold mb-1",children:"Client Notes"}),t.jsx("div",{className:"text-amber-800 dark:text-amber-300 text-sm",children:d.notes})]}),t.jsx("div",{className:"flex gap-2 pt-2 border-t dark:border-gray-700",children:(d.status||"").toLowerCase()==="confirmed"&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>{Oe(d),V(!0)},className:"flex-1 py-2 px-3 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-900/50 transition text-sm font-medium flex items-center justify-center gap-2",children:[t.jsx(Repeat,{size:14}),"Make Recurring"]}),(userData==null?void 0:userData.rooms)&&userData.rooms.length>0&&t.jsxs("button",{onClick:()=>{ee(d),Z(!0)},className:"flex-1 py-2 px-3 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium flex items-center justify-center gap-2",children:[t.jsx(Home,{size:14}),"Assign Rooms"]})]})}),t.jsxs("div",{className:"text-xs text-gray-400 pt-2",children:["Booked ",d.createdAt&&d.createdAt instanceof Date?d.createdAt.toLocaleDateString():new Date(d.created_at||d.timestamp||Date.now()).toLocaleDateString()]})]})]})}),C&&he&&t.jsx(Da,{booking:he,onClose:()=>{V(!1),Oe(null)},onSuccess:()=>{Q()}}),H&&se&&t.jsx(qa,{booking:se,rooms:(userData==null?void 0:userData.rooms)||[],onClose:()=>{Z(!1),ee(null)},onSuccess:()=>{Q()}})]})}function Ga(s){if(!s)return"other";const r=s.toLowerCase().trim(),m={microphones:"microphones","microphones & transducers":"microphones","audio interfaces":"audio_interfaces",preamps:"preamps","preamps & channel strips":"preamps","mixing consoles":"mixing_consoles","mixers & consoles":"mixing_consoles","mixing consoles & mixers":"mixing_consoles","studio monitors":"monitors",monitors:"monitors",headphones:"headphones","outboard gear":"outboard_processing","outboard processing":"outboard_processing","effects processors":"effects_processors",converters:"converters","ad/da converters":"converters","recording devices":"recorders",recorders:"recorders","electric guitars":"electric_guitars","acoustic guitars":"acoustic_guitars","bass guitars":"bass_guitars","guitar amps":"guitar_amps","guitar & bass amplifiers":"guitar_amps","guitar effects":"guitar_effects","guitar pedals":"guitar_effects",synthesizers:"synthesizers",keyboards:"keyboards","midi controllers":"midi_controllers",pianos:"pianos","drum kits":"drum_kits","electronic drums":"electronic_drums","drum machines":"drum_machines","string instruments":"string_instruments","wind instruments":"wind_instruments","pa speakers":"pa_speakers","power amps":"power_amps","live mixers":"live_mixers","wireless systems":"wireless_systems","in ear monitors":"in_ear_monitors","stage gear":"stage_gear",turntables:"turntables","dj controllers":"dj_controllers","dj mixers":"dj_mixers",cables:"cables",patchbays:"patchbays","acoustic treatment":"acoustic_treatment","studio furniture":"studio_furniture",computers:"computers","software licenses":"software_licenses","storage drives":"storage_drives","stands & mounts":"stands_mounts","cases & bags":"cases_bags","vintage gear":"vintage_gear"};if(m[r])return m[r];for(const[l,x]of Object.entries(m))if(r.includes(l)||l.includes(r))return x;const n=wt.find(l=>l.label.toLowerCase()===r||l.label.toLowerCase().includes(r)||r.includes(l.label.toLowerCase()));return n?n.id:"other"}function Ya({user:s,userData:r,onUpdate:m}){const[n,l]=y.useState((r==null?void 0:r.studioEquipment)||[]),[x,b]=y.useState(!1),[f,p]=y.useState(""),[u,g]=y.useState("all"),[j,d]=y.useState(!1),[i,h]=y.useState(null),k=async S=>{if(!U)return;b(!0);const F=I.loading("Saving equipment..."),O=(s==null?void 0:s.id)||(s==null?void 0:s.uid);try{await U.from("profiles").update({studio_equipment:S,updated_at:new Date().toISOString()}).eq("id",O),l(S),I.success("Equipment saved!",{id:F}),m&&m({studioEquipment:S})}catch(D){console.error("Save failed:",D),I.error("Failed to save",{id:F})}finally{b(!1)}},N=async S=>{const F={...S,id:Date.now().toString(),addedAt:new Date().toISOString()};await k([...n,F]),d(!1)},z=async S=>{const F=n.map(O=>O.id===S.id?S:O);await k(F),h(null)},$=async S=>{if(!confirm("Remove this item from inventory?"))return;const F=n.filter(O=>O.id!==S);await k(F)},M=n.filter(S=>{var D,J,ue;const F=!f||((D=S.name)==null?void 0:D.toLowerCase().includes(f.toLowerCase()))||((J=S.brand)==null?void 0:J.toLowerCase().includes(f.toLowerCase()))||((ue=S.model)==null?void 0:ue.toLowerCase().includes(f.toLowerCase())),O=u==="all"||S.category===u;return F&&O}),A=M.reduce((S,F)=>{const O=F.category||"Other";return S[O]||(S[O]=[]),S[O].push(F),S},{}),v=[...new Set(n.map(S=>S.category).filter(Boolean))],R=n.length,w=n.reduce((S,F)=>S+(parseFloat(F.value)||0),0),B=S=>({microphones_and_input_transducers:qs,monitoring_and_playback:Ur,mixing_consoles_and_control:qr,outboard_signal_processing:Cs,computer_audio_and_interfaces:Cs})[S]||yt,T=S=>{const F=wt.find(O=>O.id===S);return(F==null?void 0:F.label)||S};return t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(yt,{className:"text-brand-blue",size:24}),"Equipment Inventory"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage your studio gear and equipment"})]}),t.jsxs("button",{onClick:()=>d(!0),className:"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2",children:[t.jsx(Qe,{size:18})," Add Equipment"]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:R}),t.jsx("div",{className:"text-sm text-gray-500",children:"Total Items"})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",w.toLocaleString()]}),t.jsx("div",{className:"text-sm text-gray-500",children:"Est. Value"})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:v.length}),t.jsx("div",{className:"text-sm text-gray-500",children:"Categories"})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsx("div",{className:"text-2xl font-bold text-brand-blue",children:n.filter(S=>S.featured).length}),t.jsx("div",{className:"text-sm text-gray-500",children:"Featured Items"})]})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(Hs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),t.jsx("input",{type:"text",value:f,onChange:S=>p(S.target.value),placeholder:"Search equipment...",className:"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),t.jsxs("select",{value:u,onChange:S=>g(S.target.value),className:"px-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[t.jsx("option",{value:"all",children:"All Categories"}),wt.map(S=>t.jsx("option",{value:S.id,children:S.label},S.id))]})]}),M.length===0?t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center",children:[t.jsx(yt,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),t.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Equipment Found"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:f||u!=="all"?"Try adjusting your filters":"Add your studio equipment to showcase your gear"}),t.jsx("button",{onClick:()=>d(!0),className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition",children:"Add Your First Item"})]}):t.jsx("div",{className:"space-y-6",children:Object.entries(A).map(([S,F])=>{const O=B(S);return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-[#23262f] border-b dark:border-gray-700 flex items-center gap-3",children:[t.jsx(O,{className:"text-brand-blue",size:20}),t.jsx("h3",{className:"font-bold dark:text-white",children:T(S)}),t.jsxs("span",{className:"text-sm text-gray-500",children:["(",F.length,")"]})]}),t.jsx("div",{className:"divide-y dark:divide-gray-700",children:F.map(D=>t.jsxs("div",{className:"p-4 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-[#23262f] transition",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"font-bold dark:text-white",children:[D.brand&&t.jsx("span",{className:"text-gray-500 font-medium",children:D.brand})," ",D.name||D.model]}),D.quantity&&D.quantity>1&&t.jsxs("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 px-2 py-0.5 rounded font-medium",children:["Qty: ",D.quantity]}),D.featured&&t.jsx("span",{className:"text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 px-2 py-0.5 rounded",children:"Featured"})]}),t.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[D.model&&D.name!==D.model&&t.jsx("span",{children:D.model}),D.serial&&t.jsxs("span",{className:"ml-2",children:["S/N: ",D.serial]})]}),D.notes&&t.jsx("div",{className:"text-xs text-gray-400 mt-1",children:D.notes})]}),D.value&&t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:["$",parseFloat(D.value).toLocaleString()]})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>h(D),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",children:t.jsx(Kt,{size:16})}),t.jsx("button",{onClick:()=>$(D.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:t.jsx(Te,{size:16})})]})]},D.id))})]},S)})}),(j||i)&&t.jsx(Xa,{item:i,onSave:i?z:N,onClose:()=>{d(!1),h(null)},saving:x})]})}function Xa({item:s,onSave:r,onClose:m,saving:n}){const[l,x]=y.useState(s||{name:"",brand:"",model:"",category:"",serial:"",value:"",notes:"",featured:!1,quantity:1}),b=()=>{if(!l.name&&!l.model){I.error("Name or model is required");return}r(l)},f=p=>{const u=Ga(p.category);x(g=>({...g,name:p.name||g.name,brand:p.brand||g.brand,model:p.model||g.model,category:u}))};return t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto animate-in zoom-in-95",children:[t.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsx("h3",{className:"font-bold dark:text-white",children:s?"Edit Equipment":"Add Equipment"}),t.jsx("button",{onClick:m,children:t.jsx(ie,{size:20,className:"text-gray-500"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:["Search Equipment Database",t.jsx("span",{className:"text-gray-400 font-normal ml-2",children:"(Recommended)"})]}),t.jsx(Ys,{onSelect:f,placeholder:"Search for equipment (e.g. U87, SSL, Fender Twin)...",className:"w-full"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Start typing to search from verified equipment database"})]}),t.jsxs("div",{className:"border-t dark:border-gray-700 pt-4 space-y-4",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:[t.jsx("p",{className:"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2",children:"Or enter manually:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),t.jsx("input",{value:l.brand,onChange:p=>x({...l,brand:p.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"e.g. Neumann"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model *"}),t.jsx("input",{value:l.model||l.name,onChange:p=>x({...l,model:p.target.value,name:p.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"e.g. U87"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),t.jsxs("select",{value:l.category,onChange:p=>x({...l,category:p.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[t.jsx("option",{value:"",children:"Select category..."}),wt.map(p=>t.jsx("option",{value:p.id,children:p.label},p.id))]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Quantity"}),t.jsx("input",{type:"number",min:"1",value:l.quantity||1,onChange:p=>x({...l,quantity:parseInt(p.target.value)||1}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"1"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Serial Number"}),t.jsx("input",{value:l.serial,onChange:p=>x({...l,serial:p.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"Optional"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Value ($)"}),t.jsx("input",{type:"number",value:l.value,onChange:p=>x({...l,value:p.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"Estimated value"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Notes"}),t.jsx("textarea",{value:l.notes,onChange:p=>x({...l,notes:p.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:2,placeholder:"Additional details..."})]}),t.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-[#1f2128] rounded-xl cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:l.featured,onChange:p=>x({...l,featured:p.target.checked}),className:"w-4 h-4 text-brand-blue rounded"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium dark:text-white text-sm",children:"Featured Equipment"}),t.jsx("div",{className:"text-xs text-gray-500",children:"Highlight this item on your studio profile"})]})]})]})]}),t.jsxs("div",{className:"p-4 border-t dark:border-gray-700 flex justify-end gap-3",children:[t.jsx("button",{onClick:m,className:"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl font-medium",children:"Cancel"}),t.jsxs("button",{onClick:b,disabled:n,className:"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[n?t.jsx(fe,{className:"animate-spin",size:18}):t.jsx(Re,{size:18}),s?"Update":"Add Item"]})]})]})})}const Ka=Hr({studioName:me().min(3,"Studio name is required"),address:me().min(5,"Address is required"),city:me().optional(),state:me().optional(),zip:me().optional(),lat:_s().optional(),lng:_s().optional(),studioDescription:me().max(1e3).optional(),email:me().email().optional().or(zs("")),phoneCell:me().optional(),phoneLand:me().optional(),website:me().url().optional().or(zs("")),hours:me().optional(),amenities:Kr(me()).optional(),hideAddress:Xr().optional()});function Za({user:s,userData:r,onUpdate:m}){const[n,l]=y.useState(!1),{register:x,control:b,handleSubmit:f,watch:p,setValue:u,formState:{errors:g,isDirty:j}}=Or({resolver:Wr(Ka),defaultValues:{studioName:(r==null?void 0:r.studioName)||(r==null?void 0:r.profileName)||"",address:(r==null?void 0:r.address)||"",city:(r==null?void 0:r.city)||"",state:(r==null?void 0:r.state)||"",zip:(r==null?void 0:r.zip)||"",lat:r==null?void 0:r.lat,lng:r==null?void 0:r.lng,studioDescription:(r==null?void 0:r.studioDescription)||"",email:(r==null?void 0:r.email)||"",phoneCell:(r==null?void 0:r.phoneCell)||"",phoneLand:(r==null?void 0:r.phoneLand)||"",website:(r==null?void 0:r.website)||"",hours:(r==null?void 0:r.hours)||"",amenities:(r==null?void 0:r.amenities)||[],hideAddress:(r==null?void 0:r.hideAddress)||!1}}),d=p("amenities"),i=p("hideAddress"),h=z=>{const $=d||[];$.includes(z)?u("amenities",$.filter(M=>M!==z),{shouldDirty:!0}):u("amenities",[...$,z],{shouldDirty:!0})},k=async z=>{if(!U)return;l(!0);const $=I.loading("Saving settings...");try{const M=(s==null?void 0:s.id)||(s==null?void 0:s.uid);if(await U.from("profiles").update({studio_name:z.studioName,profile_name:z.studioName,address:z.address,city:z.city,state:z.state,zip:z.zip,lat:z.lat,lng:z.lng,studio_description:z.studioDescription,email:z.email,phone_cell:z.phoneCell,phone_land:z.phoneLand,website:z.website,hours:z.hours,amenities:z.amenities,hide_address:z.hideAddress,is_studio:!0,updated_at:new Date().toISOString()}).eq("id",M),error)throw error;I.success("Settings saved!",{id:$}),m&&m(z)}catch(M){console.error("Save failed",M),I.error("Failed to save settings.",{id:$})}finally{l(!1)}},N=z=>`w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none ${z?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200"}`;return t.jsxs("form",{onSubmit:f(k),className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Vs,{className:"text-brand-blue",size:24}),"Studio Settings"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Basic information and contact details"})]}),t.jsxs("button",{type:"submit",disabled:n||!j,className:`px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 transition ${n||!j?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600"}`,children:[n?t.jsx(fe,{className:"animate-spin",size:18}):t.jsx(Re,{size:18}),"Save Changes"]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(we,{size:18,className:"text-brand-blue"}),"General Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio Name *"}),t.jsx("input",{...x("studioName"),className:N(g.studioName),placeholder:"Your Studio Name"}),g.studioName&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.studioName.message})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Description"}),t.jsx("textarea",{...x("studioDescription"),rows:3,className:N(g.studioDescription),placeholder:"Describe your studio, the vibe, and what makes it special..."})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(jt,{size:18,className:"text-brand-blue"}),"Location"]}),t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800 mb-4",children:t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",...x("hideAddress"),className:"w-5 h-5 mt-0.5 text-brand-blue rounded"}),t.jsxs("div",{children:[t.jsxs("div",{className:"font-bold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[t.jsx(Ws,{size:16,className:"text-brand-blue"}),"Private Home Studio Mode"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your exact address will be hidden from the public map. It will only be revealed after you approve a booking request."})]})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(Vr,{control:b,name:"address",render:({field:{onChange:z,value:$}})=>{var M;return t.jsx(aa,{label:"Street Address",value:$||"",onChange:z,onSelect:A=>{A.lat&&u("lat",A.lat),A.lng&&u("lng",A.lng),A.city&&u("city",A.city,{shouldDirty:!0}),A.state&&u("state",A.state,{shouldDirty:!0}),A.zip&&u("zip",A.zip,{shouldDirty:!0})},placeholder:"Start typing your address...",error:(M=g.address)==null?void 0:M.message,required:!0})}}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"City"}),t.jsx("input",{...x("city"),className:N(),placeholder:"City"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"State"}),t.jsx("input",{...x("state"),className:N(),placeholder:"State"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"ZIP"}),t.jsx("input",{...x("zip"),className:N(),placeholder:"ZIP Code"})]})]})]}),i&&t.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-amber-600 dark:text-amber-400",children:[t.jsx(Ds,{size:16}),t.jsx("span",{children:"Address will be hidden until booking approval"})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(Gr,{size:18,className:"text-brand-blue"}),"Contact Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Email"}),t.jsx("input",{...x("email"),type:"email",className:N(g.email),placeholder:"studio@email.com"}),g.email&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.email.message})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Website"}),t.jsx("input",{...x("website"),className:N(g.website),placeholder:"https://yourstudio.com"}),g.website&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.website.message})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Cell Phone"}),t.jsx("input",{...x("phoneCell"),className:N(),placeholder:"(555) 123-4567"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Landline"}),t.jsx("input",{...x("phoneLand"),className:N(),placeholder:"(555) 123-4567"})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hours of Operation"}),t.jsx("input",{...x("hours"),className:N(),placeholder:"e.g. Mon-Fri 9AM-10PM, Sat-Sun 10AM-8PM"})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[t.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(Yr,{size:18,className:"text-brand-blue"}),"Amenities"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:la.map(z=>t.jsx("button",{type:"button",onClick:()=>h(z),className:`px-3 py-2 rounded-lg text-sm font-medium transition-all border ${d!=null&&d.includes(z)?"bg-brand-blue text-white border-brand-blue shadow-md":"bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:z},z))})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs("button",{type:"submit",disabled:n||!j,className:`px-8 py-3 rounded-xl font-bold text-lg flex items-center gap-2 transition shadow-lg ${n||!j?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"}`,children:[n?t.jsx(fe,{className:"animate-spin",size:20}):t.jsx(Re,{size:20}),"Save Settings"]})})]})}const Rs=[{id:"overview",label:"Overview",icon:we,description:"Dashboard & quick stats"},{id:"rooms",label:"Rooms",icon:Ot,description:"Manage studio rooms"},{id:"equipment",label:"Equipment",icon:yt,description:"Equipment inventory"},{id:"gallery",label:"Gallery",icon:qe,description:"Photo gallery"},{id:"availability",label:"Hours",icon:Qt,description:"Operating hours"},{id:"policies",label:"Policies",icon:Ze,description:"Rules & pricing"},{id:"bookings",label:"Bookings",icon:$e,description:"Manage bookings"},{id:"settings",label:"Settings",icon:Vs,description:"Studio info"}];function Qa({user:s,userData:r}){const[m,n]=y.useState("overview"),[l,x]=y.useState({pendingBookings:0,recentBookings:[],totalRevenue:0}),[b,f]=y.useState(r);y.useEffect(()=>{(async()=>{if(!(s!=null&&s.id)&&!(s!=null&&s.uid)||!U)return;const i=s.id||s.uid;try{const{data:h,error:k}=await U.from("bookings").select("*").or(`target_id.eq.${i},studio_owner_id.eq.${i}`).order("date",{ascending:!0});if(k)throw k;const N=h.filter(M=>M.status==="Pending").length,z=h.filter(M=>new Date(M.date)>=new Date).sort((M,A)=>new Date(M.date)-new Date(A.date)).slice(0,5),$=h.filter(M=>M.status==="Completed").reduce((M,A)=>M+(A.offer_amount||0),0);x({pendingBookings:N,recentBookings:z,totalRevenue:$})}catch(h){console.error("Error fetching stats:",h)}})()},[s==null?void 0:s.id,s==null?void 0:s.uid]);const p=d=>{f(i=>({...i,...d}))},u=d=>{n(d)},g=()=>{const d={user:s,userData:b,onUpdate:p};switch(m){case"overview":return t.jsx(Es,{...d,stats:l,onNavigate:u});case"rooms":return t.jsx(za,{...d});case"equipment":return t.jsx(Ya,{...d});case"gallery":return t.jsx(Ea,{...d});case"availability":return t.jsx(Ra,{...d});case"policies":return t.jsx(Ta,{...d});case"bookings":return t.jsx(Va,{...d,userData:b});case"settings":return t.jsx(Za,{...d});default:return t.jsx(Es,{...d,stats:l,onNavigate:u})}},j=Rs.find(d=>d.id===m);return t.jsxs("div",{className:"max-w-7xl mx-auto pb-20",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2",children:[t.jsx(Jt,{size:14}),t.jsx("span",{children:"Business Center"}),t.jsx(Ue,{size:14}),t.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:"Studio Manager"})]}),t.jsxs("h1",{className:"text-3xl font-bold dark:text-white flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white",children:t.jsx(we,{size:24})}),(b==null?void 0:b.studioName)||(b==null?void 0:b.profileName)||"Studio Manager"]})]}),t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 mb-6 overflow-hidden",children:t.jsx("div",{className:"flex overflow-x-auto scrollbar-hide",children:Rs.map(d=>{const i=d.icon,h=m===d.id,k=d.id==="bookings"&&l.pendingBookings>0;return t.jsxs("button",{onClick:()=>n(d.id),className:`flex items-center gap-2 px-5 py-4 text-sm font-medium whitespace-nowrap transition-all border-b-2 relative ${h?"border-brand-blue text-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[t.jsx(i,{size:18}),d.label,k&&t.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:l.pendingBookings})]},d.id)})})}),t.jsx("div",{className:"md:hidden mb-4 px-1",children:t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:j==null?void 0:j.description})}),t.jsx("div",{className:"min-h-[50vh]",children:g()})]})}const Ja=({data:s,setData:r})=>t.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4",children:[t.jsx("h3",{className:"text-lg font-bold dark:text-white mb-4",children:"Release Essentials"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Title"}),t.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:s.title,onChange:m=>r({...s,title:m.target.value}),placeholder:"e.g. Dark Side of the Moon"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Artist"}),t.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:s.primaryArtist,onChange:m=>r({...s,primaryArtist:m.target.value}),placeholder:"e.g. Pink Floyd"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Type"}),t.jsx("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:s.type,onChange:m=>r({...s,type:m.target.value}),children:na.map(m=>t.jsx("option",{value:m.id,children:m.label},m.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Genre"}),t.jsxs("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:s.genre,onChange:m=>r({...s,genre:m.target.value}),children:[t.jsx("option",{value:"",children:"Select Genre..."}),ia.map(m=>t.jsx("option",{value:m,children:m},m))]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Date"}),t.jsx("input",{type:"date",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:s.releaseDate,onChange:m=>r({...s,releaseDate:m.target.value})}),t.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Standard: 2 weeks out. Express: 48hrs."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Label Name"}),t.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:s.labelName,onChange:m=>r({...s,labelName:m.target.value}),placeholder:"Optional (Default: Independent)"})]})]})]}),el=({data:s,setData:r,user:m})=>{const{uploadMedia:n,uploading:l}=ts(),[x,b]=y.useState(s.artworkUrl||null),[f,p]=y.useState(""),u=async g=>{const j=g.target.files[0];if(!j)return;const d=new Image;d.src=URL.createObjectURL(j),d.onload=async()=>{if(d.width<3e3||d.height<3e3){p("Error: Image must be at least 3000 x 3000 pixels.");return}d.width!==d.height?p("Warning: Image should be a perfect square (1:1 ratio)."):p("");const i=await n(j,`distribution/${m.uid}/artwork`);i!=null&&i.url&&(b(i.url),r({...s,artworkUrl:i.url}))}};return t.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 animate-in slide-in-from-right-4",children:[t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Cover Art"}),t.jsx("p",{className:"text-sm text-gray-500",children:"3000 x 3000 px • JPG or PNG • No Blurry Text"})]}),t.jsxs("div",{className:"relative group w-64 h-64 bg-gray-100 dark:bg-[#1f2128] rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center overflow-hidden",children:[x?t.jsx("img",{src:x,className:"w-full h-full object-cover"}):t.jsxs("div",{className:"text-gray-400 flex flex-col items-center",children:[t.jsx(qe,{size:48,className:"mb-2"}),t.jsx("span",{className:"text-xs font-bold",children:"Click to Upload"})]}),t.jsxs("label",{className:"absolute inset-0 cursor-pointer bg-black/0 hover:bg-black/20 transition flex items-center justify-center",children:[t.jsx("input",{type:"file",className:"hidden",accept:"image/png, image/jpeg",onChange:u,disabled:l}),l&&t.jsx(fe,{className:"animate-spin text-white",size:32})]})]}),f&&t.jsxs("div",{className:"text-red-500 text-sm font-bold flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[t.jsx(Vt,{size:16})," ",f]})]})},tl=({data:s,setData:r,user:m})=>{var p,u;const{uploadMedia:n,uploading:l}=ts(),x=async g=>{if(!g.name.toLowerCase().endsWith(".wav")){alert("Only .WAV files are accepted for distribution.");return}const j={id:Date.now(),title:g.name.replace(".wav",""),fileUrl:"",status:"uploading",isExplicit:!1,isInstrumental:!1},d=[...s.tracks||[],j];r({...s,tracks:d});try{const i=await n(g,`distribution/${m.uid}/audio_vault`);if(i!=null&&i.url){const h=d.map(k=>k.id===j.id?{...k,fileUrl:i.url,status:"ready",duration:0}:k);r({...s,tracks:h})}}catch(i){console.error("Track upload failed",i),alert("Upload failed.")}},b=g=>{r({...s,tracks:s.tracks.filter(j=>j.id!==g)})},f=(g,j,d)=>{r({...s,tracks:s.tracks.map(i=>i.id===g?{...i,[j]:d}:i)})};return t.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[t.jsxs("div",{className:"flex justify-between items-end",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Audio"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Stereo WAV files only (16-bit / 44.1kHz minimum)"})]}),t.jsxs("label",{className:"bg-brand-blue hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs cursor-pointer flex items-center gap-2 transition",children:[t.jsx(Zt,{size:14})," Add Track",t.jsx("input",{type:"file",className:"hidden",accept:".wav",onChange:g=>x(g.target.files[0]),disabled:l})]})]}),t.jsxs("div",{className:"space-y-3",children:[((p=s.tracks)==null?void 0:p.length)===0&&t.jsx("div",{className:"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400",children:"No tracks added yet."}),(u=s.tracks)==null?void 0:u.map((g,j)=>t.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 flex flex-col gap-3",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded text-gray-500 font-mono text-xs",children:["#",j+1]}),t.jsx("div",{className:"font-bold dark:text-white text-sm",children:g.status==="uploading"?t.jsxs("span",{className:"flex items-center gap-2 text-brand-blue",children:[t.jsx(fe,{className:"animate-spin",size:14})," Uploading..."]}):g.title})]}),t.jsx("button",{onClick:()=>b(g.id),className:"text-gray-400 hover:text-red-500",children:t.jsx(ie,{size:16})})]}),g.status==="ready"&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[t.jsx("input",{className:"col-span-2 p-2 text-xs border rounded bg-transparent dark:border-gray-600 dark:text-white",placeholder:"Track Title",value:g.title,onChange:d=>f(g.id,"title",d.target.value)}),t.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:g.isExplicit,onChange:d=>f(g.id,"isExplicit",d.target.checked)})," Explicit"]}),t.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:g.isInstrumental,onChange:d=>f(g.id,"isInstrumental",d.target.checked)})," Instrumental"]})]})]},g.id))]})]})},sl=({data:s,setData:r})=>{var l;const m=x=>{const b=s.stores||[],f=b.includes(x)?b.filter(p=>p!==x):[...b,x];r({...s,stores:f})},n=()=>{var x;((x=s.stores)==null?void 0:x.length)===tt.length?r({...s,stores:[]}):r({...s,stores:tt.map(b=>b.id)})};return t.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Select Stores"}),t.jsx("button",{onClick:n,className:"text-xs font-bold text-brand-blue hover:underline",children:((l=s.stores)==null?void 0:l.length)===tt.length?"Deselect All":"Select All"})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:tt.map(x=>{var f;const b=(f=s.stores)==null?void 0:f.includes(x.id);return t.jsxs("div",{onClick:()=>m(x.id),className:`p-3 rounded-xl border flex items-center gap-3 cursor-pointer transition-all ${b?"bg-blue-50 border-brand-blue dark:bg-blue-900/20":"bg-white dark:bg-[#1f2128] dark:border-gray-700 hover:border-gray-300"}`,children:[t.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${b?"bg-brand-blue border-brand-blue":"border-gray-400"}`,children:b&&t.jsx(Gt,{size:12,className:"text-white"})}),t.jsx("span",{className:`text-sm font-bold ${b?"text-brand-blue dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:x.name})]},x.id)})}),t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/10 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800 text-sm text-yellow-800 dark:text-yellow-200 flex items-start gap-3",children:[t.jsx(Zr,{size:18,className:"mt-0.5 shrink-0"}),t.jsx("p",{children:"Deliveries usually take 2-5 days for Spotify/Apple, and up to 2 weeks for other stores. Please plan your release date accordingly."})]})]})};function rl({user:s,userData:r,initialData:m,onCancel:n,onSuccess:l}){const[x,b]=y.useState(1),[f,p]=y.useState(!1),[u,g]=y.useState(m||{title:"",primaryArtist:r&&`${r.firstName||""} ${r.lastName||""}`.trim()||"Artist",type:"single",genre:"",releaseDate:"",labelName:"",artworkUrl:"",tracks:[],stores:tt.map(i=>i.id),status:"Draft"}),j=()=>x===1?u.title&&u.primaryArtist&&u.genre&&u.releaseDate:x===2?!!u.artworkUrl:x===3?u.tracks.length>0&&u.tracks.every(i=>i.status==="ready"):x===4?u.stores.length>0:!0,d=async()=>{if(!U)return;p(!0);const i=(s==null?void 0:s.id)||(s==null?void 0:s.uid);try{const h={uploader_id:i,title:u.title,primary_artist:u.primaryArtist,type:u.type,genre:u.genre,release_date:u.releaseDate,label_name:u.labelName||null,artwork_url:u.artworkUrl||null,tracks:u.tracks||[],updated_at:new Date().toISOString(),status:"Processing"};m!=null&&m.id?await U.from("distribution_releases").update(h).eq("id",m.id).eq("uploader_id",i):await U.from("distribution_releases").insert({...h,created_at:new Date().toISOString()}),alert("Release submitted successfully! It is now in the review queue."),l()}catch(h){console.error("Submission error:",h),alert("Failed to submit release.")}p(!1)};return t.jsxs("div",{className:"max-w-4xl mx-auto bg-white dark:bg-[#2c2e36] rounded-2xl shadow-xl overflow-hidden border dark:border-gray-700 min-h-[600px] flex flex-col",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-6 border-b dark:border-gray-700 flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-extrabold dark:text-white",children:"New Release"}),t.jsxs("p",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mt-1",children:["Step ",x," of 4"]})]}),t.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white",children:t.jsx(ie,{})})]}),t.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700 w-full",children:t.jsx("div",{className:"h-full bg-brand-blue transition-all duration-300",style:{width:`${x/4*100}%`}})}),t.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[x===1&&t.jsx(Ja,{data:u,setData:g}),x===2&&t.jsx(el,{data:u,setData:g,user:s}),x===3&&t.jsx(tl,{data:u,setData:g,user:s}),x===4&&t.jsx(sl,{data:u,setData:g})]}),t.jsxs("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[x>1?t.jsxs("button",{onClick:()=>b(x-1),className:"flex items-center gap-2 text-gray-500 font-bold hover:text-gray-800 dark:hover:text-white transition",children:[t.jsx(Yt,{size:18})," Back"]}):t.jsx("div",{}),x<4?t.jsxs("button",{onClick:()=>b(x+1),disabled:!j(),className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-600 transition",children:["Next Step ",t.jsx(Ue,{size:18})]}):t.jsx("button",{onClick:d,disabled:f||!j(),className:"bg-green-600 text-white px-8 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 hover:bg-green-700 transition shadow-lg",children:f?t.jsx(fe,{className:"animate-spin"}):"Submit Release"})]})]})}function al({user:s,userData:r}){const[m,n]=y.useState("list"),[l,x]=y.useState([]),[b,f]=y.useState(!0),[p,u]=y.useState(null);y.useEffect(()=>{if(!(s!=null&&s.id)&&!(s!=null&&s.uid)||!U)return;const i=(s==null?void 0:s.id)||(s==null?void 0:s.uid),h=U.channel("distribution-releases").on("postgres_changes",{event:"*",schema:"public",table:"distribution_releases",filter:`uploader_id=eq.${i}`},k=>{g()}).subscribe();return g(),()=>{U.removeChannel(h)}},[s==null?void 0:s.id,s==null?void 0:s.uid]);const g=async()=>{if(!U)return;const i=(s==null?void 0:s.id)||(s==null?void 0:s.uid);f(!0);try{const{data:h,error:k}=await U.from("distribution_releases").select("*").eq("uploader_id",i).order("updated_at",{ascending:!1});if(k)throw k;x((h||[]).map(N=>({id:N.id,...N,uploaderId:N.uploader_id,updatedAt:N.updated_at,createdAt:N.created_at})))}catch(h){console.error("Error loading releases:",h)}f(!1)},j=async(i,h)=>{if(!(!confirm(`Are you sure you want to delete "${h}"? This cannot be undone if already distributed.`)||!U))try{await U.from("distribution_releases").delete().eq("id",i)}catch(k){console.error(k),alert("Failed to delete release.")}},d=i=>{if(i.status!=="Draft"&&i.status!=="Action Needed")return alert("Cannot edit a release that is currently processing or live. Contact support for takedowns.");u(i),n("create")};return m==="create"?t.jsx(rl,{user:s,userData:r,initialData:p,onCancel:()=>{n("list"),u(null)},onSuccess:()=>{n("list"),u(null)}}):t.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[t.jsx(Gs,{className:"text-brand-blue"})," Distribution Portal"]}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your catalog across Spotify, Apple Music, and 150+ stores."})]}),t.jsxs("button",{onClick:()=>n("create"),className:"bg-brand-blue text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 shadow-lg hover:shadow-blue-500/20",children:[t.jsx(Qe,{size:20})," New Release"]})]}),t.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 overflow-hidden min-h-[400px]",children:b?t.jsx("div",{className:"p-12 text-center text-gray-500",children:"Loading catalog..."}):l.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[t.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4",children:t.jsx(es,{size:48,className:"text-gray-400"})}),t.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"No Releases Yet"}),t.jsx("p",{className:"text-gray-500 max-w-sm mt-2 mb-6",children:"Start your journey by uploading your first single, EP, or album to the world."}),t.jsx("button",{onClick:()=>n("create"),className:"text-brand-blue font-bold hover:underline",children:"Create First Release"})]}):t.jsx("div",{className:"divide-y dark:divide-gray-700",children:l.map(i=>{var h;return t.jsxs("div",{className:"p-5 hover:bg-gray-50 dark:hover:bg-white/5 transition flex flex-col md:flex-row md:items-center justify-between gap-4 group",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"h-16 w-16 bg-gray-200 dark:bg-black rounded-lg shadow-sm overflow-hidden shrink-0 border dark:border-gray-700",children:i.artworkUrl?t.jsx("img",{src:i.artworkUrl,alt:"Art",className:"h-full w-full object-cover"}):t.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:t.jsx(Qr,{size:20})})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide border ${i.status==="Live"?"bg-green-100 text-green-700 border-green-200":i.status==="Processing"?"bg-blue-100 text-blue-700 border-blue-200":i.status==="Action Needed"?"bg-red-100 text-red-700 border-red-200":"bg-gray-100 text-gray-600 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600"}`,children:i.status}),t.jsx("span",{className:"text-xs text-gray-400 uppercase font-bold",children:i.type})]}),t.jsx("h4",{className:"font-bold text-lg dark:text-white leading-tight",children:i.title||"Untitled Release"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[i.primaryArtist," • ",((h=i.tracks)==null?void 0:h.length)||0," Tracks"]})]})]}),t.jsxs("div",{className:"flex items-center gap-4 pl-4 md:pl-0 border-l md:border-l-0 dark:border-gray-700",children:[t.jsxs("div",{className:"text-right hidden md:block mr-4",children:[t.jsx("div",{className:"text-xs text-gray-400 uppercase font-bold",children:"Release Date"}),t.jsx("div",{className:"text-sm font-medium dark:text-gray-200",children:i.releaseDate?new Date(i.releaseDate).toLocaleDateString():"TBD"})]}),t.jsx("button",{onClick:()=>d(i),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit / View Details",children:t.jsx(Kt,{size:18})}),(i.status==="Draft"||i.status==="Action Needed")&&t.jsx("button",{onClick:()=>j(i.id,i.title),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete Release",children:t.jsx(Te,{size:18})})]})]},i.id)})})})]})}function ll({data:s,onNavigate:r}){const m=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0),n=l=>new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(l||0);return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Label Overview"}),t.jsxs("button",{onClick:()=>r&&r("roster"),className:"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1",children:["View Details ",t.jsx(Ue,{size:16})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 mb-2",children:t.jsx(Nt,{className:"text-blue-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(s==null?void 0:s.total_artists)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Artists"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 mb-2",children:t.jsx(es,{className:"text-purple-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(s==null?void 0:s.active_releases)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Releases"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2",children:t.jsx(St,{className:"text-green-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:m(s==null?void 0:s.total_revenue)}),t.jsx("div",{className:"text-xs text-gray-500",children:"Revenue"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-orange-50 dark:bg-orange-900/20 mb-2",children:t.jsx(Jr,{className:"text-orange-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:n(s==null?void 0:s.total_streams)}),t.jsx("div",{className:"text-xs text-gray-500",children:"Streams"})]})]})]})}function nl({data:s,onNavigate:r}){return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Studio Overview"}),t.jsxs("button",{onClick:()=>r&&r("studio"),className:"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1",children:["View Details ",t.jsx(Ue,{size:16})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 mb-2",children:t.jsx(we,{className:"text-blue-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(s==null?void 0:s.total_rooms)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Rooms"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-yellow-50 dark:bg-yellow-900/20 mb-2",children:t.jsx($e,{className:"text-yellow-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(s==null?void 0:s.pending_bookings)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Pending"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2",children:t.jsx(Gt,{className:"text-green-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(s==null?void 0:s.completed_bookings)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Completed"})]})]})]})}function il({data:s,onNavigate:r}){return t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Distribution Overview"}),t.jsxs("button",{onClick:()=>r&&r("distribution"),className:"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1",children:["View Details ",t.jsx(Ue,{size:16})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 mb-2",children:t.jsx(es,{className:"text-purple-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(s==null?void 0:s.total_releases)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Total"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2",children:t.jsx(ea,{className:"text-green-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(s==null?void 0:s.live_releases)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Live"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex p-3 rounded-xl bg-gray-50 dark:bg-gray-900/20 mb-2",children:t.jsx(Ze,{className:"text-gray-600",size:24})}),t.jsx("div",{className:"text-2xl font-bold dark:text-white",children:(s==null?void 0:s.draft_releases)||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Drafts"})]})]})]})}function ol({user:s,userData:r,setActiveTab:m}){var d,i,h;const[n,l]=y.useState({}),[x,b]=y.useState(!0),f=(d=r==null?void 0:r.accountTypes)==null?void 0:d.includes("Studio"),p=(i=r==null?void 0:r.accountTypes)==null?void 0:i.some(k=>["Label","Agent"].includes(k)),u=(h=r==null?void 0:r.accountTypes)==null?void 0:h.some(k=>["Talent","Producer","Engineer"].includes(k)),g=f||p||u;y.useEffect(()=>{(async()=>{const N=(s==null?void 0:s.id)||(s==null?void 0:s.uid);if(!N){b(!1);return}b(!0);const z={};try{if(p){const $=await da(N);z.label=($==null?void 0:$[0])||{}}if(f){const $=await ca(N);z.studio=($==null?void 0:$[0])||{}}if(g){const $=await xa(N);z.distribution=($==null?void 0:$[0])||{}}l(z)}catch($){console.error("Error fetching business metrics:",$)}finally{b(!1)}})()},[s==null?void 0:s.id,s==null?void 0:s.uid,p,f,g]);const j=[{id:"studio",title:"Studio Settings",description:"Configure your studio rooms, rates, and amenities",icon:"Home",color:"blue",show:f},{id:"distribution",title:"New Release",description:"Distribute your music to 150+ streaming platforms",icon:"Globe",color:"green",show:g},{id:"roster",title:"Manage Roster",description:"Sign artists and manage your label roster",icon:"Users",color:"purple",show:p}].filter(k=>k.show);return x?t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue"})}):t.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[t.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-8 text-white relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),t.jsxs("div",{className:"relative z-10",children:[t.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Business Center"}),t.jsx("p",{className:"text-indigo-100 max-w-xl",children:"Manage your studio operations, distribute music, and grow your roster — all in one place."})]})]}),p&&t.jsx(ll,{data:n.label,onNavigate:m}),f&&t.jsx(nl,{data:n.studio,onNavigate:m}),g&&t.jsx(il,{data:n.distribution,onNavigate:m}),j.length>0&&t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(ta,{size:20,className:"text-gray-400"}),"Quick Actions"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:j.map(k=>t.jsxs("button",{onClick:()=>m(k.id),className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all text-left group hover:border-brand-blue dark:hover:border-brand-blue",children:[t.jsx("h3",{className:"font-bold dark:text-white mb-1 flex items-center gap-2",children:k.title}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:k.description})]},k.id))})]}),j.length===0&&!p&&!f&&!g&&t.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center",children:[t.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(Jt,{size:32,className:"text-gray-400"})}),t.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"No Business Features Enabled"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Upgrade your account to access studio management, music distribution, and label features."}),t.jsx("p",{className:"text-sm text-gray-400",children:'Update your profile to add "Studio", "Talent", "Label", or "Agent" account types.'})]})]})}function kl({user:s,userData:r}){var g,j,d;const[m,n]=y.useState("overview"),l=(g=r==null?void 0:r.accountTypes)==null?void 0:g.includes("Studio"),x=(j=r==null?void 0:r.accountTypes)==null?void 0:j.some(i=>["Label","Agent"].includes(i)),b=(d=r==null?void 0:r.accountTypes)==null?void 0:d.some(i=>["Talent","Producer","Engineer"].includes(i)),p=[{id:"overview",label:"Overview",icon:Jt,iconSize:18,available:!0},{id:"studio",label:"Studio Ops",icon:we,iconSize:18,available:l,description:"Manage rooms, rates & amenities"},{id:"distribution",label:"Distribution",icon:Gs,iconSize:18,available:l||x||b,description:"Release music to streaming platforms"},{id:"roster",label:"Label Manager",icon:Nt,iconSize:18,available:x,description:"Manage your signed artists"}].filter(i=>i.available),u=()=>{switch(m){case"studio":return t.jsx(Qa,{user:s,userData:r});case"distribution":return t.jsx(al,{user:s,userData:r});case"roster":return t.jsx(oa,{user:s,userData:r});case"overview":default:return t.jsx(ol,{user:s,userData:r,setActiveTab:n})}};return t.jsxs("div",{className:"max-w-7xl mx-auto pb-20",children:[t.jsx("div",{className:"mb-6 bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-1.5 flex flex-wrap gap-1 shadow-sm sticky top-0 z-10",children:p.map(i=>{const h=i.icon;return t.jsxs("button",{onClick:()=>n(i.id),className:`
                                flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all
                                ${m===i.id?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}
                            `,children:[t.jsx(h,{size:i.iconSize}),t.jsx("span",{className:"hidden sm:inline",children:i.label})]},i.id)})}),u()]})}export{kl as default};
