import{r as o,bY as G,j as e,a as B,bZ as J,ap as Q,g as V,W as X,ao as H,L as M,N as D,t as ee,aq as L,ar as P,a0 as se,b_ as te,c as le,ak as K,b$ as C,c0 as ae,c1 as ie,c2 as S,c3 as ne,c4 as W}from"./vendor-M-mhr7Zm.js";import{s as U}from"./chat-Wu-U_tWR.js";import{u as re}from"./edu-CtXdl24B.js";import oe from"./SettingsTab-j0oXlEO1.js";import{PROFILE_SCHEMAS as Z}from"./config-yUl3KxdD.js";import{M as de,N as ce}from"./Inputs-CwjYZ5ZL.js";import{E as me}from"./EquipmentAutocomplete-DRIl8Sr2.js";import"./vendor-framer-1_AFqeeG.js";import"./index-TFlOXW0C.js";import"./useEquipmentDatabase-DM1VkO2W.js";const xe=ie({firstName:S().min(2,"First name too short"),lastName:S().min(2,"Last name too short"),displayName:S().optional(),bio:S().max(500,"Bio exceeds 500 characters").optional(),zip:S().regex(/^\d{5}$/,"Invalid ZIP code").optional().or(W("")),hourlyRate:ne().min(0,"Rate cannot be negative").optional(),website:S().url("Invalid URL").optional().or(W(""))}),be=(i,s,r)=>r?r.substring(0,2).toUpperCase():(((i==null?void 0:i[0])||"")+((s==null?void 0:s[0])||"")).toUpperCase()||"U";function Se({user:i,userData:s,subProfiles:r={},handleLogout:d,openPublicProfile:_}){const[n,$]=o.useState("details"),[c,z]=o.useState("Main"),[f,O]=o.useState(!1),{uploading:x}=re(),[w,j]=o.useState(!1),[y,v]=o.useState((s==null?void 0:s.useLegalNameOnly)||!1),[u,m]=o.useState((s==null?void 0:s.useUserNameOnly)||!1);o.useEffect(()=>{v((s==null?void 0:s.useLegalNameOnly)||!1),m((s==null?void 0:s.useUserNameOnly)||!1)},[s]);const I=()=>{const t=!y;v(t),t&&m(!1)},E=()=>{const t=!u;m(t),t&&v(!1)},{register:h,handleSubmit:R,formState:{errors:N,isDirty:l}}=G({resolver:ae(xe),defaultValues:{firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",displayName:(s==null?void 0:s.displayName)||"",bio:(s==null?void 0:s.bio)||"",zip:(s==null?void 0:s.zip)||"",hourlyRate:(s==null?void 0:s.hourlyRate)||0,website:(s==null?void 0:s.website)||""}}),b=async t=>{O(!0);const A=C.loading("Saving main profile...");try{let p=`${t.firstName} ${t.lastName}`;y?p=`${t.firstName} ${t.lastName}`:u&&t.displayName?p=t.displayName:t.displayName&&(p=`${t.firstName} "${t.displayName}" ${t.lastName}`);const T=[t.firstName.toLowerCase(),t.lastName.toLowerCase(),(t.displayName||"").toLowerCase(),p.toLowerCase()].filter(Boolean),Y=(i==null?void 0:i.id)||(i==null?void 0:i.uid);if(!U)throw new Error("Database unavailable");const{error:q}=await U.from("profiles").update({first_name:t.firstName,last_name:t.lastName,display_name:t.displayName||null,bio:t.bio||null,zip:t.zip||null,hourly_rate:t.hourlyRate||null,website:t.website||null,use_legal_name_only:y,use_user_name_only:u,effective_display_name:p,search_terms:T,updated_at:new Date().toISOString()}).eq("id",Y);if(q)throw q;C.success("Profile Updated & Synced!",{id:A})}catch(p){console.error("Update failed",p);const T=(p==null?void 0:p.message)||"Failed to update profile.";C.error(T,{id:A})}finally{O(!1)}},a=async t=>{t.target.files[0]},k=async t=>{t.target.files[0]},F=async t=>{},g=t=>ee("w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none",t?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-700");return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("h1",{className:"text-3xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(B,{className:"text-brand-blue"})," ",n==="details"?"Edit Profile":"Account Settings"]}),e.jsxs("div",{className:"flex gap-3 self-end",children:[e.jsxs("button",{onClick:()=>_((i==null?void 0:i.id)||(i==null?void 0:i.uid)),className:"bg-gray-900 dark:bg-white text-white dark:text-black px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 hover:opacity-90 transition shadow-lg",children:[e.jsx(J,{size:16})," View Public Profile"]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex gap-1",children:[e.jsx("button",{onClick:()=>$("details"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${n==="details"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"Edit Details"}),e.jsxs("button",{onClick:()=>$("settings"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all flex items-center gap-1 ${n==="settings"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:[e.jsx(Q,{size:14})," Settings"]})]})]})]}),n==="details"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-2",children:[e.jsx("div",{className:"font-bold text-xs text-gray-500 uppercase tracking-wider mb-2 px-1",children:"Profiles"}),e.jsxs("button",{onClick:()=>z("Main"),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${c==="Main"?"bg-brand-blue text-white shadow-md":"bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{size:16})," ",e.jsx("span",{className:"font-bold text-sm",children:"Main Profile"})]}),c==="Main"&&e.jsx(V,{size:16})]}),((s==null?void 0:s.accountTypes)||[]).map(t=>Z[t]?e.jsxs("button",{onClick:()=>z(t),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${c===t?"bg-brand-blue text-white shadow-md":"bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{size:16})," ",e.jsx("span",{className:"font-bold text-sm",children:t})]}),c===t&&e.jsx(V,{size:16})]},t):null)]}),e.jsx("div",{className:"lg:col-span-3",children:c==="Main"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"md:col-span-1 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Profile Photo"}),e.jsxs("div",{className:"relative group w-full aspect-square rounded-full overflow-hidden bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-700 shadow-md",children:[s!=null&&s.photoURL?e.jsx("img",{src:s.photoURL,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gradient-to-tr from-brand-blue to-purple-500 text-white font-bold text-4xl",children:be(s==null?void 0:s.firstName,s==null?void 0:s.lastName,s==null?void 0:s.displayName)}),e.jsxs("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity",children:[e.jsxs("span",{className:"text-white font-bold text-sm flex items-center gap-1",children:[e.jsx(H,{size:16})," Change"]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:a,disabled:x})]}),x&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(M,{className:"animate-spin text-white"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Cover Banner"}),e.jsxs("div",{className:"relative group w-full aspect-[3/1] rounded-xl overflow-hidden bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-700 shadow-sm",children:[s!=null&&s.bannerURL?e.jsx("img",{src:s.bannerURL,alt:"Banner",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx(D,{size:24})}),e.jsxs("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity",children:[e.jsxs("span",{className:"text-white font-bold text-xs flex items-center gap-1",children:[e.jsx(H,{size:14})," Upload Cover"]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:k,disabled:w})]}),w&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(M,{className:"animate-spin text-white"})})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl text-xs text-blue-800 dark:text-blue-200",children:[e.jsx("p",{className:"font-bold mb-1",children:"Pro Tip:"}),"High-quality profile photos & banners increase booking rates by 40%."]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("form",{onSubmit:R(b),className:"space-y-6 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"First Name (Legal)"}),e.jsx("input",{...h("firstName"),className:g(N.firstName)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Last Name (Legal)"}),e.jsx("input",{...h("lastName"),className:g(N.lastName)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"User Name (Display Name)"}),e.jsx("input",{...h("displayName"),className:g(N.displayName),placeholder:"e.g. SeshMaster"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-1",children:"Display Name Preferences"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Legal Name Only"}),e.jsx("button",{type:"button",onClick:I,className:"text-brand-blue",children:y?e.jsx(L,{size:28}):e.jsx(P,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use User Name Only"}),e.jsx("button",{type:"button",onClick:E,className:"text-brand-blue",children:u?e.jsx(L,{size:28}):e.jsx(P,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2",children:["Preview: ",e.jsx("strong",{className:"text-brand-blue",children:y?`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"Not Set":u?(s==null?void 0:s.displayName)||"Not Set":`${(s==null?void 0:s.firstName)||""} "${(s==null?void 0:s.displayName)||"User"}" ${(s==null?void 0:s.lastName)||""}`.trim()||"Not Set"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Bio / About"}),e.jsx("textarea",{...h("bio"),rows:"4",className:g(N.bio),placeholder:"Tell us about your musical journey..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(se,{size:12})," ZIP Code"]}),e.jsx("input",{...h("zip"),className:g(N.zip)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(te,{size:12})," Hourly Rate ($)"]}),e.jsx("input",{type:"number",...h("hourlyRate",{valueAsNumber:!0}),className:g(N.hourlyRate)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Website"}),e.jsx("input",{...h("website"),className:g(N.website),placeholder:"https://..."})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700 flex justify-end",children:e.jsx("button",{type:"button",onClick:R(b),disabled:f,className:le("px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg",f?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-105"),children:f?e.jsx(M,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:20})," Save Changes"]})})})]})})]}):e.jsx(ge,{user:i,userData:s,role:c,initialData:r[c]||{},schema:Z[c]||[]})})]}):e.jsx("div",{className:"animate-in fade-in slide-in-from-right-2",children:e.jsx(oe,{user:i,userData:s,handleLogout:d,onUpdate:F})})]})}function ge({user:i,userData:s,role:r,initialData:d,schema:_}){const[n,$]=o.useState(d),[c,z]=o.useState(!1),[f,O]=o.useState(d.followMainProfile??!0),[x,w]=o.useState(d.useLegalNameOnly??!1),[j,y]=o.useState(d.useUserNameOnly??!1),[v,u]=o.useState(d.syncStudioOps??!1);o.useEffect(()=>{$(d||{}),O(d.followMainProfile??!0),w(d.useLegalNameOnly??!1),y(d.useUserNameOnly??!1),u(d.syncStudioOps??!1)},[d]);const m=(l,b)=>$(a=>({...a,[l]:b})),I=()=>{w(!x),x||y(!1)},E=()=>{y(!j),j||w(!1)},h=async l=>{l.preventDefault(),z(!0);const b=C.loading(`Saving ${r} profile...`);try{let a="";f?a=(s==null?void 0:s.effectiveDisplayName)||(s?`${s.firstName||""} ${s.lastName||""}`.trim():""):x?a=s?`${s.firstName||""} ${s.lastName||""}`.trim():"":j?a=(s==null?void 0:s.displayName)||(s?`${s.firstName||""} ${s.lastName||""}`.trim():""):a=n.profileName||`${s.firstName} ${s.lastName}`;const k=(i==null?void 0:i.id)||(i==null?void 0:i.uid);if(!U)throw new Error("Database unavailable");const F={...n,followMainProfile:f,useLegalNameOnly:x,useUserNameOnly:j,syncStudioOps:v,displayName:a},{error:g}=await U.from("sub_profiles").upsert({user_id:k,role:r,...F},{onConflict:"user_id,role"});if(g)throw g;if(s.activeProfileRole===r){const{error:t}=await U.from("profiles").update({display_name:a,effective_display_name:a,search_terms:[a.toLowerCase()],updated_at:new Date().toISOString()}).eq("id",k);if(t)throw t}if(r==="Studio"&&v){const{error:t}=await U.from("profiles").update({studio_name:a,updated_at:new Date().toISOString()}).eq("id",k);if(t)throw t}C.success(`${r} Profile Saved!`,{id:b})}catch(a){console.error(a);const k=(a==null?void 0:a.message)||"Failed to save.";C.error(k,{id:b})}finally{z(!1)}};if(_.length===0)return e.jsx("div",{className:"p-10 text-center text-gray-500",children:"No configuration available for this role."});const R=n.talentSubRole||"",N=_.filter(l=>l.key==="profileName"||l.key==="useRealName"?!1:l.showFor&&Array.isArray(l.showFor)?l.showFor.includes(R):!0);return e.jsxs("form",{onSubmit:h,className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white border-b dark:border-gray-700 pb-2",children:[r," Identity & Details"]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-1",children:"Identity Settings"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Follow Main Profile Name"}),e.jsxs("div",{className:"text-xs text-gray-500",children:['Use "',s.effectiveDisplayName||`${s.firstName} ${s.lastName}`,'"']})]}),e.jsx("button",{type:"button",onClick:()=>O(!f),className:"text-brand-blue",children:f?e.jsx(L,{size:28}):e.jsx(P,{size:28,className:"text-gray-400"})})]}),!f&&e.jsxs("div",{className:"space-y-3 animate-in slide-in-from-top-1 pt-3 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Legal Name Only"}),e.jsx("button",{type:"button",onClick:I,className:"text-brand-blue",children:x?e.jsx(L,{size:28}):e.jsx(P,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Main User Name Only"}),e.jsx("button",{type:"button",onClick:E,className:"text-brand-blue",children:j?e.jsx(L,{size:28}):e.jsx(P,{size:28,className:"text-gray-400"})})]}),!x&&!j&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("label",{className:"text-xs font-bold text-brand-blue uppercase mb-1 block",children:[r," Name"]}),e.jsx("input",{type:"text",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none font-bold",placeholder:`e.g. ${r==="Studio"?"Sound City":"The Weeknd"}`,value:n.profileName||"",onChange:l=>m("profileName",l.target.value)}),r==="Studio"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:l=>u(l.target.checked),className:"rounded text-brand-blue focus:ring-brand-blue"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Force "Studio Ops" to use this name'})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2",children:["Preview: ",e.jsx("strong",{className:"text-brand-blue",children:x?`${s.firstName} ${s.lastName}`:j?s.displayName||"Not Set":n.profileName||"Not Set"})]})]})]}),N.map(l=>{var b;return l.isToggle?null:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:l.label}),l.type==="textarea"?e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",rows:4,value:n[l.key]||"",onChange:a=>m(l.key,a.target.value)}):l.type==="select"?e.jsx("select",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",value:n[l.key]||"",onChange:a=>m(l.key,a.target.value),children:(b=l.options)==null?void 0:b.map(a=>e.jsx("option",{value:a,children:a},a))}):l.type==="multi_select"?e.jsx(de,{label:"",fieldKey:l.key,options:l.data||l.options||[],initialValues:n[l.key]||[],onChange:m}):l.type==="nested_select"?e.jsx(ce,{label:"",fieldKey:l.key,data:l.data,initialValues:n[l.key]||[],onChange:m}):l.key==="equipment"?e.jsx(me,{multi:!0,value:n[l.key]||"",onChange:a=>m(l.key,a),placeholder:"Add gear..."}):e.jsx("input",{type:l.type==="number"?"number":"text",className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",value:n[l.key]||"",onChange:a=>m(l.key,a.target.value)})]},l.key)}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700 flex justify-end",children:e.jsx("button",{type:"submit",disabled:c,className:"px-8 py-3 rounded-xl font-bold bg-brand-blue text-white hover:bg-blue-600 flex items-center gap-2 transition shadow-lg disabled:opacity-50",children:c?e.jsx(M,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:20})," Save ",r," Profile"]})})})]})}export{Se as default};
