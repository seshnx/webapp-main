{"version":3,"file":"useMarketplace-VvJPAWav.js","sources":["../../src/hooks/useMarketplace.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n  getGearListings,\r\n  getGearListingById,\r\n  createGearListing,\r\n  updateGearListingStatus,\r\n  getGearOrders,\r\n  createGearOrder,\r\n  updateGearOrderStatus,\r\n  getGearOffers,\r\n  createGearOffer,\r\n  respondToGearOffer,\r\n  getSafeExchangeTransactions,\r\n  getSafeExchangeTransactionById,\r\n  createSafeExchangeTransaction,\r\n  updateSafeExchangeTransaction,\r\n  addTransactionPhoto,\r\n  getMarketplaceItems,\r\n  getMarketplaceItemById,\r\n  createMarketplaceItemSeshFx,\r\n  getUserLibrary,\r\n  addToUserLibrary,\r\n  checkItemOwnership,\r\n  getDistributionReleases,\r\n  getDistributionReleaseById,\r\n  createDistributionRelease,\r\n  updateDistributionRelease,\r\n  deleteDistributionRelease\r\n} from '../config/neonQueries';\r\n\r\n// Polling interval for real-time updates (milliseconds)\r\nconst POLL_INTERVAL = 30000;\r\n\r\n// Helper hook for polling\r\nfunction usePolling(fetchFn, deps, enabled = true) {\r\n  const [data, setData] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const fetchData = useCallback(async () => {\r\n    if (!enabled) return;\r\n    setLoading(true);\r\n    try {\r\n      const result = await fetchFn();\r\n      setData(result);\r\n    } catch (error) {\r\n      console.error('Polling error:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [fetchFn, enabled]);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n    if (!enabled) return;\r\n\r\n    const interval = setInterval(fetchData, POLL_INTERVAL);\r\n    return () => clearInterval(interval);\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [enabled, ...deps]); // Remove fetchData from deps to prevent infinite loop\r\n\r\n  return { data, loading, refresh: fetchData };\r\n}\r\n\r\n// =====================================================\r\n// GEAR EXCHANGE HOOKS\r\n// =====================================================\r\n\r\n/**\r\n * Hook for fetching gear listings with polling\r\n *\r\n * @param {object} options - Query options\r\n * @returns {object} { data, loading, refresh }\r\n *\r\n * @example\r\n * const { data: listings, loading, refresh } = useGearListings({ limit: 20, status: 'active' });\r\n */\r\nexport function useGearListings({ limit = 50, status } = {}) {\r\n  return usePolling(() => getGearListings({ limit, status }), [limit, status]);\r\n}\r\n\r\n/**\r\n * Hook for fetching a single gear listing\r\n *\r\n * @param {string} listingId - Listing ID\r\n * @returns {object} { listing, loading }\r\n *\r\n * @example\r\n * const { listing, loading } = useGearListing('listing-123');\r\n */\r\nexport function useGearListing(listingId) {\r\n  const [listing, setListing] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!listingId) return;\r\n\r\n    const fetchListing = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const data = await getGearListingById(listingId);\r\n        setListing(data);\r\n      } catch (error) {\r\n        console.error('Error fetching listing:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchListing();\r\n  }, [listingId]);\r\n\r\n  return { listing, loading };\r\n}\r\n\r\n/**\r\n * Hook for fetching gear orders with polling\r\n *\r\n * @param {string} userId - User ID\r\n * @param {string} status - Optional status filter\r\n * @returns {object} { data, loading, refresh }\r\n *\r\n * @example\r\n * const { data: orders, loading } = useGearOrders(userId, 'pending');\r\n */\r\nexport function useGearOrders(userId, status) {\r\n  return usePolling(() => getGearOrders({ userId, status }), [userId, status], !!userId);\r\n}\r\n\r\n/**\r\n * Hook for fetching gear offers with polling\r\n *\r\n * @param {object} options - Query options\r\n * @returns {object} { data, loading, refresh }\r\n *\r\n * @example\r\n * const { data: offers, loading } = useGearOffers({ listingId: 'listing-123' });\r\n */\r\nexport function useGearOffers({ listingId, userId }) {\r\n  return usePolling(() => getGearOffers({ listingId, userId }), [listingId, userId], !!(listingId || userId));\r\n}\r\n\r\n// =====================================================\r\n// SAFE EXCHANGE HOOKS\r\n// =====================================================\r\n\r\n/**\r\n * Hook for fetching safe exchange transactions with polling\r\n *\r\n * @param {string} userId - User ID\r\n * @param {string} status - Optional status filter\r\n * @returns {object} { data, loading, refresh }\r\n *\r\n * @example\r\n * const { data: transactions, loading } = useSafeExchangeTransactions(userId);\r\n */\r\nexport function useSafeExchangeTransactions(userId, status) {\r\n  return usePolling(() => getSafeExchangeTransactions({ userId, status }), [userId, status], !!userId);\r\n}\r\n\r\n/**\r\n * Hook for fetching a single safe exchange transaction\r\n *\r\n * @param {string} transactionId - Transaction ID\r\n * @returns {object} { transaction, loading }\r\n *\r\n * @example\r\n * const { transaction, loading } = useSafeExchangeTransaction('txn-123');\r\n */\r\nexport function useSafeExchangeTransaction(transactionId) {\r\n  const [transaction, setTransaction] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!transactionId) return;\r\n\r\n    const fetchTransaction = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const data = await getSafeExchangeTransactionById(transactionId);\r\n        setTransaction(data);\r\n      } catch (error) {\r\n        console.error('Error fetching transaction:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchTransaction();\r\n  }, [transactionId]);\r\n\r\n  return { transaction, loading };\r\n}\r\n\r\n// =====================================================\r\n// MARKETPLACE ITEMS (SeshFx) HOOKS\r\n// =====================================================\r\n\r\n/**\r\n * Hook for fetching marketplace items with polling\r\n *\r\n * @param {object} options - Query options\r\n * @returns {object} { data, loading, refresh }\r\n *\r\n * @example\r\n * const { data: items, loading } = useMarketplaceItems({ type: 'Presets' });\r\n */\r\nexport function useMarketplaceItems({ type } = {}) {\r\n  return usePolling(() => getMarketplaceItems({ type }), [type]);\r\n}\r\n\r\n/**\r\n * Hook for fetching a single marketplace item\r\n *\r\n * @param {string} itemId - Item ID\r\n * @returns {object} { item, loading }\r\n *\r\n * @example\r\n * const { item, loading } = useMarketplaceItem('item-123');\r\n */\r\nexport function useMarketplaceItem(itemId) {\r\n  const [item, setItem] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!itemId) return;\r\n\r\n    const fetchItem = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const data = await getMarketplaceItemById(itemId);\r\n        setItem(data);\r\n      } catch (error) {\r\n        console.error('Error fetching marketplace item:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchItem();\r\n  }, [itemId]);\r\n\r\n  return { item, loading };\r\n}\r\n\r\n/**\r\n * Hook for fetching user library with polling\r\n *\r\n * @param {string} userId - User ID\r\n * @returns {object} { data, loading, refresh }\r\n *\r\n * @example\r\n * const { data: library, loading } = useUserLibrary(userId);\r\n */\r\nexport function useUserLibrary(userId) {\r\n  return usePolling(() => getUserLibrary(userId), [userId], !!userId);\r\n}\r\n\r\n/**\r\n * Hook for checking item ownership\r\n *\r\n * @param {string} userId - User ID\r\n * @param {string} itemId - Item ID\r\n * @returns {boolean} isOwned\r\n *\r\n * @example\r\n * const isOwned = useItemOwnership(userId, itemId);\r\n */\r\nexport function useItemOwnership(userId, itemId) {\r\n  const [isOwned, setIsOwned] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!userId || !itemId) return;\r\n\r\n    const checkOwnership = async () => {\r\n      try {\r\n        const owned = await checkItemOwnership(userId, itemId);\r\n        setIsOwned(owned);\r\n      } catch (error) {\r\n        console.error('Error checking ownership:', error);\r\n      }\r\n    };\r\n\r\n    checkOwnership();\r\n  }, [userId, itemId]);\r\n\r\n  return isOwned;\r\n}\r\n\r\n// =====================================================\r\n// DISTRIBUTION HOOKS\r\n// =====================================================\r\n\r\n/**\r\n * Hook for fetching distribution releases with polling\r\n *\r\n * @param {string} userId - User ID\r\n * @returns {object} { data, loading, refresh }\r\n *\r\n * @example\r\n * const { data: releases, loading } = useDistributionReleases(userId);\r\n */\r\nexport function useDistributionReleases(userId) {\r\n  return usePolling(() => getDistributionReleases(userId), [userId], !!userId);\r\n}\r\n\r\n/**\r\n * Hook for fetching a single distribution release\r\n *\r\n * @param {string} releaseId - Release ID\r\n * @returns {object} { release, loading }\r\n *\r\n * @example\r\n * const { release, loading } = useDistributionRelease('release-123');\r\n */\r\nexport function useDistributionRelease(releaseId) {\r\n  const [release, setRelease] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!releaseId) return;\r\n\r\n    const fetchRelease = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const data = await getDistributionReleaseById(releaseId);\r\n        setRelease(data);\r\n      } catch (error) {\r\n        console.error('Error fetching release:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchRelease();\r\n  }, [releaseId]);\r\n\r\n  return { release, loading };\r\n}\r\n\r\n// =====================================================\r\n// MUTATION HOOKS\r\n// =====================================================\r\n\r\n/**\r\n * Hook for marketplace mutation functions\r\n * Returns all the mutation functions for creating, updating, and deleting marketplace data\r\n *\r\n * @returns {object} Mutation functions\r\n *\r\n * @example\r\n * const { createListing, updateListingStatus, createOrder } = useMarketplaceMutations();\r\n * await createListing({ seller_id: userId, title: 'My Gear', price: 100, ... });\r\n */\r\nexport function useMarketplaceMutations() {\r\n  return {\r\n    // Gear mutations\r\n    createListing: createGearListing,\r\n    updateListingStatus: updateGearListingStatus,\r\n    createOrder: createGearOrder,\r\n    updateOrderStatus: updateGearOrderStatus,\r\n    createOffer: createGearOffer,\r\n    respondToOffer: respondToGearOffer,\r\n\r\n    // Safe exchange mutations\r\n    createTransaction: createSafeExchangeTransaction,\r\n    updateTransaction: updateSafeExchangeTransaction,\r\n    addPhoto: addTransactionPhoto,\r\n\r\n    // SeshFx mutations\r\n    createMarketplaceItem: createMarketplaceItemSeshFx,\r\n    purchaseItem: addToUserLibrary,\r\n\r\n    // Distribution mutations\r\n    createRelease: createDistributionRelease,\r\n    updateRelease: updateDistributionRelease,\r\n    deleteRelease: deleteDistributionRelease,\r\n  };\r\n}\r\n"],"names":["POLL_INTERVAL","usePolling","fetchFn","deps","enabled","data","setData","useState","loading","setLoading","fetchData","useCallback","result","error","useEffect","interval","useGearListings","limit","status","getGearListings","useGearOrders","userId","getGearOrders","useSafeExchangeTransactions","getSafeExchangeTransactions","useSafeExchangeTransaction","transactionId","transaction","setTransaction","getSafeExchangeTransactionById","useMarketplaceItems","type","getMarketplaceItems","useUserLibrary","getUserLibrary","useDistributionReleases","getDistributionReleases","useMarketplaceMutations","createGearListing","updateGearListingStatus","createGearOrder","updateGearOrderStatus","createGearOffer","respondToGearOffer","createSafeExchangeTransaction","updateSafeExchangeTransaction","addTransactionPhoto","createMarketplaceItemSeshFx","addToUserLibrary","createDistributionRelease","updateDistributionRelease","deleteDistributionRelease"],"mappings":"+uBA+BA,MAAMA,EAAgB,IAGtB,SAASC,EAAWC,EAASC,EAAMC,EAAU,GAAM,CACjD,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAS,CAAA,CAAE,EAC7B,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EAErCG,EAAYC,EAAAA,YAAY,SAAY,CACxC,GAAKP,EACL,CAAAK,EAAW,EAAI,EACf,GAAI,CACF,MAAMG,EAAS,MAAMV,IACrBI,EAAQM,CAAM,CAChB,OAASC,EAAO,CACd,QAAQ,MAAM,iBAAkBA,CAAK,CACvC,QAAC,CACCJ,EAAW,EAAK,CAClB,EACF,EAAG,CAACP,EAASE,CAAO,CAAC,EAErBU,OAAAA,EAAAA,UAAU,IAAM,CAEd,GADAJ,IACI,CAACN,EAAS,OAEd,MAAMW,EAAW,YAAYL,EAAWV,CAAa,EACrD,MAAO,IAAM,cAAce,CAAQ,CAErC,EAAG,CAACX,EAAS,GAAGD,CAAI,CAAC,EAEd,CAAE,KAAAE,EAAM,QAAAG,EAAS,QAASE,CAAS,CAC5C,CAeO,SAASM,EAAgB,CAAE,MAAAC,EAAQ,GAAI,OAAAC,CAAM,EAAK,CAAA,EAAI,CAC3D,OAAOjB,EAAW,IAAMkB,EAAgB,CAAE,MAAAF,EAAO,OAAAC,CAAM,CAAE,EAAG,CAACD,EAAOC,CAAM,CAAC,CAC7E,CA8CO,SAASE,EAAcC,EAAQH,EAAQ,CAC5C,OAAOjB,EAAW,IAAMqB,EAAc,CAAE,OAAAD,EAAQ,OAAAH,CAAM,CAAE,EAAG,CAACG,EAAQH,CAAM,EAAG,CAAC,CAACG,CAAM,CACvF,CA6BO,SAASE,EAA4BF,EAAQH,EAAQ,CAC1D,OAAOjB,EAAW,IAAMuB,EAA4B,CAAE,OAAAH,EAAQ,OAAAH,CAAM,CAAE,EAAG,CAACG,EAAQH,CAAM,EAAG,CAAC,CAACG,CAAM,CACrG,CAWO,SAASI,EAA2BC,EAAe,CACxD,KAAM,CAACC,EAAaC,CAAc,EAAIrB,EAAAA,SAAS,IAAI,EAC7C,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EAE3CO,OAAAA,EAAAA,UAAU,IAAM,CACd,GAAI,CAACY,EAAe,QAEK,SAAY,CACnCjB,EAAW,EAAI,EACf,GAAI,CACF,MAAMJ,EAAO,MAAMwB,EAA+BH,CAAa,EAC/DE,EAAevB,CAAI,CACrB,OAASQ,EAAO,CACd,QAAQ,MAAM,8BAA+BA,CAAK,CACpD,QAAC,CACCJ,EAAW,EAAK,CAClB,CACF,IAGF,EAAG,CAACiB,CAAa,CAAC,EAEX,CAAE,YAAAC,EAAa,QAAAnB,EACxB,CAeO,SAASsB,EAAoB,CAAE,KAAAC,CAAI,EAAK,GAAI,CACjD,OAAO9B,EAAW,IAAM+B,EAAoB,CAAE,KAAAD,CAAI,CAAE,EAAG,CAACA,CAAI,CAAC,CAC/D,CA6CO,SAASE,EAAeZ,EAAQ,CACrC,OAAOpB,EAAW,IAAMiC,EAAeb,CAAM,EAAG,CAACA,CAAM,EAAG,CAAC,CAACA,CAAM,CACpE,CA8CO,SAASc,EAAwBd,EAAQ,CAC9C,OAAOpB,EAAW,IAAMmC,EAAwBf,CAAM,EAAG,CAACA,CAAM,EAAG,CAAC,CAACA,CAAM,CAC7E,CAkDO,SAASgB,GAA0B,CACxC,MAAO,CAEL,cAAeC,EACf,oBAAqBC,EACrB,YAAaC,EACb,kBAAmBC,EACnB,YAAaC,EACb,eAAgBC,EAGhB,kBAAmBC,EACnB,kBAAmBC,EACnB,SAAUC,EAGV,sBAAuBC,EACvB,aAAcC,EAGd,cAAeC,EACf,cAAeC,EACf,cAAeC,CACnB,CACA"}