var ir=Object.defineProperty;var or=(t,s,l)=>s in t?ir(t,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[s]=l;var cs=(t,s,l)=>or(t,typeof s!="symbol"?s+"":s,l);import{j as e,z as dr,Z as wt,T as _e,X as pe,aO as fa,aP as cr,aQ as xr,aR as Te,aS as ya,a4 as St,r,aT as gr,aU as mr,ad as Cs,aV as kt,aW as dt,aX as zs,aY as Rt,a as qe,aZ as Es,a_ as ja,a$ as Ct,b0 as Re,b1 as Rs,ak as bt,b2 as ps,W as rt,b3 as va,A as Na,b4 as ur,U as Fe,h as Ie,aa as Wt,$ as gt,ab as br,a3 as ka,a9 as Pe,F as Pt,b5 as hr,g as Ke,J as Ut,an as st,m as Ge,L as oe,a0 as Le,b6 as wa,a2 as Zs,S as Be,a8 as Vt,b7 as et,b8 as pr,b9 as fs,ai as ht,aj as Je,ba as $e,O as lt,x as ve,e as Sa,bb as Oe,bc as ss,bd as fr,be as ys,bf as js,bg as At,bh as Ca,bi as yr,a5 as as,s as Ps,bj as jr,bk as vr,bl as za,q as Nr,y as As,bm as kr,bn as wr,Y as Gt,w as Sr,bo as Cr,bp as X,v as zr,N as Lt,V as Ls,bq as $s,br as Er,a6 as Ea,bs as Rr,bt as Yt,bu as Pr,P as nt,M as Zt,bv as Ar,bw as Lr,H as $r,bx as Tr,by as Ts,bz as Kt,bA as Ee,bB as Is,t as Ra,c as Pa,bC as Ms,bD as Aa,ag as Tt,af as tt,Q as rs,bE as Ir,a7 as La,bF as pt,R as Fs,a1 as Ks,bG as $a,bH as ct,K as Os,al as vt,am as Nt,bI as Ta,bJ as Ye,bK as Xs,bL as Bs,D as Ia,bM as Mr,B as It,bN as Fr,bO as Or,bP as Br,bQ as vs,bR as _r,bS as qr,bT as Ma,bU as Hr,bV as zt,bW as Wr,bX as Qs,bY as Ur,bZ as Vr,b_ as Gr,b$ as Yr,c0 as Xt,c1 as Zr,c2 as Kr,c3 as Xr,c4 as Js,c5 as Qr,c6 as Jr,c7 as Dr,c8 as el,c9 as tl,ca as sl,cb as al,cc as rl,cd as ze,ce as ot,cf as ll,cg as nl,ch as il,ci as ol,cj as dl,ck as cl}from"./vendor-SbfkNbzm.js";import{E as le,q as ye,N as Ze,M as Ae,I as fe,C as Q,G as be,P as Qt,K as we,J as ue,Q as _s,k as Xe,w as Ce,R as xl,S as gl,T as ml,U as ul,O as ft,V as xt,W as bl,X as De,D as yt,Y as hl,j as ls,r as Ds,Z as pl,h as fl,_ as yl,$ as Ot,a0 as jl,a1 as vl,a2 as Nl,a3 as kl,a4 as wl,H as ea,a as Sl,d as Cl,a5 as zl}from"./vendor-firebase-DA8kksl2.js";import{U as mt,g as te,d as O,b as jt,a as re,i as Ns,c as Fa,u as it,e as El,C as Rl,f as Pl,h as Al,s as ta,j as sa,k as Ll}from"./chat-7Ks4_14U.js";import{A as Ve,m as ce}from"./vendor-framer-CcBD3fpK.js";import{u as $l,A as Jt,f as ns,a as Tl,b as Oa,P as Dt,c as Il,I as Ml,G as Fl,d as xs,S as Ol,e as Bl,g as ie,h as aa,E as ut,H as es,i as _l,j as ql,k as ts,T as Ba,l as Hl,D as Et,R as Wl,m as Ul,n as Vl,o as Gl,p as Yl,q as Zl,r as Kl,s as Xl}from"./edu-aTyBNMxT.js";import{M as _a,T as qa,C as Ht,u as Ha,L as Wa,i as Ql,a as Jl,b as Dl,P as en}from"./vendor-maps-CENmlCIA.js";import{w as tn}from"./vendor-audio-Bu2lAtPy.js";import"./vendor-stripe-OXK3Micb.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))n(d);new MutationObserver(d=>{for(const o of d)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function l(d){const o={};return d.integrity&&(o.integrity=d.integrity),d.referrerPolicy&&(o.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?o.credentials="include":d.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(d){if(d.ep)return;d.ep=!0;const o=l(d);fetch(d.href,o)}})();const Ua="/assets/SeshNx-PNG%20cCropped%20white%20text-BvB6QJif.png",Va="/assets/SeshNx-PNG%20cCropped-mikqxod_.png",sn=({type:t})=>{const s={size:14},l={follow:e.jsx(St,{...s}),like:e.jsx(ya,{...s}),comment:e.jsx(Te,{...s}),mention:e.jsx(xr,{...s}),reply:e.jsx(cr,{...s}),save:e.jsx(fa,{...s})},n={follow:"bg-brand-blue/10 text-brand-blue dark:bg-brand-blue/20",like:"bg-red-100 text-red-500 dark:bg-red-900/30 dark:text-red-400",comment:"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400",mention:"bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400",reply:"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400",save:"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400"};return e.jsx("div",{className:`p-1.5 rounded-full ${n[t]||"bg-gray-100 text-gray-500"}`,children:l[t]||e.jsx(wt,{size:14})})},an=t=>{if(!t)return"";const s=t.toMillis?new Date(t.toMillis()):new Date(t),n=new Date-s,d=Math.floor(n/6e4),o=Math.floor(d/60),a=Math.floor(o/24);return d<1?"Just now":d<60?`${d}m`:o<24?`${o}h`:a<7?`${a}d`:s.toLocaleDateString()},rn=({notification:t,onMarkAsRead:s,onDelete:l,onUserClick:n,onPostClick:d})=>{const o=()=>{t.read||s(t.id),t.type==="follow"&&n?n(t.fromUserId):t.postId&&d&&d(t.postId)};return e.jsxs(ce.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},className:`
                p-3 cursor-pointer border-b dark:border-gray-700 last:border-0 
                flex gap-3 items-start group transition-colors
                ${t.read?"hover:bg-gray-50 dark:hover:bg-gray-800":"bg-blue-50/50 dark:bg-blue-900/10 hover:bg-blue-50 dark:hover:bg-blue-900/20"}
            `,onClick:o,children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx(mt,{src:t.fromUserPhoto,name:t.fromUserName,size:"sm"}),e.jsx("div",{className:"absolute -bottom-1 -right-1",children:e.jsx(sn,{type:t.type})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("p",{className:"text-sm dark:text-gray-200 leading-snug",children:[e.jsx("span",{className:"font-bold hover:text-brand-blue transition-colors",children:t.fromUserName})," ",e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.message})]}),e.jsx("span",{className:"text-[10px] text-gray-400 whitespace-nowrap shrink-0",children:an(t.timestamp)})]}),t.postPreview&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1 line-clamp-1 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded",children:['"',t.postPreview,'"']}),!t.read&&e.jsx("div",{className:"w-2 h-2 bg-brand-blue rounded-full absolute right-3 top-1/2 -translate-y-1/2"})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),l(t.id)},className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-all text-gray-400 hover:text-red-500 shrink-0",children:e.jsx(pe,{size:14})})]})};function ln({notifications:t,unreadCount:s,loading:l,onMarkAsRead:n,onMarkAllAsRead:d,onDeleteNotification:o,onClearAll:a,onUserClick:b,onPostClick:x,onClose:g}){return e.jsxs("div",{className:"absolute right-0 top-full mt-3 w-80 sm:w-96 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-2xl z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"p-3 px-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm",children:"Notifications"}),s>0&&e.jsx("span",{className:"text-xs bg-brand-blue text-white px-2 py-0.5 rounded-full font-bold animate-pulse",children:s})]}),s>0&&e.jsxs("button",{onClick:d,className:"text-xs text-brand-blue hover:text-blue-700 font-medium flex items-center gap-1 transition",children:[e.jsx(dr,{size:14}),"Mark all read"]})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto custom-scrollbar",children:l?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-brand-blue border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading..."})]}):t.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-3",children:e.jsx(wt,{size:24,className:"opacity-30"})}),e.jsx("p",{className:"text-sm font-medium dark:text-gray-400",children:"All caught up!"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"No new notifications"})]}):e.jsx(Ve,{mode:"popLayout",children:t.map(m=>e.jsx(rn,{notification:m,onMarkAsRead:n,onDelete:o,onUserClick:b,onPostClick:x},m.id))})}),t.length>0&&e.jsxs("div",{className:"p-2 bg-gray-50 dark:bg-[#23262f] border-t dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("button",{onClick:a,className:"text-xs text-gray-400 hover:text-red-500 font-medium flex items-center gap-1 transition px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(_e,{size:12}),"Clear all"]}),e.jsx("button",{onClick:g,className:"text-xs text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Close"})]})]})}function nn({count:t}){return t===0?null:e.jsx(ce.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-0.5 -right-0.5 min-w-[18px] h-[18px] bg-red-500 rounded-full text-[10px] text-white font-bold flex items-center justify-center border-2 border-white dark:border-dark-card",children:t>99?"99+":t})}function Ga(t,s=50){const[l,n]=r.useState([]),[d,o]=r.useState(0),[a,b]=r.useState(!0);r.useEffect(()=>{if(!t){b(!1);return}const i=le(O,te(t).notifications),p=ye(i,Ae("timestamp","desc"),Ze(s)),c=fe(p,y=>{const N=y.docs.map(j=>({id:j.id,...j.data()}));n(N),o(N.filter(j=>!j.read).length),b(!1)},y=>{console.error("Notifications listener error:",y),b(!1)});return()=>c()},[t,s]);const x=r.useCallback(async i=>{if(t)try{const p=Q(O,te(t).notifications,i);await be(p,{read:!0})}catch(p){console.error("Mark as read error:",p)}},[t]),g=r.useCallback(async()=>{if(!(!t||d===0))try{const i=Qt(O);l.filter(c=>!c.read).forEach(c=>{const y=Q(O,te(t).notifications,c.id);i.update(y,{read:!0})}),await i.commit()}catch(i){console.error("Mark all as read error:",i)}},[t,l,d]),m=r.useCallback(async i=>{if(t)try{const p=Q(O,te(t).notifications,i);await be(p,{deleted:!0})}catch(p){console.error("Delete notification error:",p)}},[t]),u=r.useCallback(async()=>{if(t)try{const i=Qt(O);l.forEach(p=>{const c=Q(O,te(t).notifications,p.id);i.update(c,{deleted:!0})}),await i.commit()}catch(i){console.error("Clear all error:",i)}},[t,l]);return{notifications:l.filter(i=>!i.deleted),unreadCount:d,loading:a,markAsRead:x,markAllAsRead:g,deleteNotification:m,clearAll:u}}async function Ya({targetUserId:t,type:s,fromUserId:l,fromUserName:n,fromUserPhoto:d,postId:o=null,postPreview:a=null,commentId:b=null,message:x}){if(!(!t||t===l))try{await we(le(O,te(t).notifications),{type:s,fromUserId:l,fromUserName:n,fromUserPhoto:d||null,postId:o,postPreview:a,commentId:b,message:x,read:!1,timestamp:ue()})}catch(g){console.error("Create notification error:",g)}}function on({user:t,userData:s,subProfiles:l,darkMode:n,toggleTheme:d,activeTab:o,setActiveTab:a,onMenuClick:b,onRoleSwitch:x,openPublicProfile:g}){var L;const[m,u]=r.useState(!1),[i,p]=r.useState(!1),[c,y]=r.useState(!1),N=r.useRef(null),j=r.useRef(null),{notifications:k,unreadCount:E,loading:C,markAsRead:h,markAllAsRead:f,deleteNotification:R,clearAll:z}=Ga(t==null?void 0:t.uid),I=(s==null?void 0:s.activeProfileRole)||((L=s==null?void 0:s.accountTypes)==null?void 0:L[0])||"User",S=(s==null?void 0:s.accountTypes)||[],w=["Student","Instructor","Intern","Admin"],v=S.some(W=>w.includes(W)),$=o.startsWith("edu"),B=W=>{if(!W||W==="Main"||W==="Fan"||W==="User")return(s==null?void 0:s.effectiveDisplayName)||(s==null?void 0:s.firstName)||"User";const Z=l==null?void 0:l[W];return(Z==null?void 0:Z.displayName)||(s==null?void 0:s.effectiveDisplayName)||(s==null?void 0:s.firstName)||"User"},M=B(I),T=()=>{a(I==="Student"?"edu-student":I==="Intern"?"edu-intern":"edu-overview")};r.useEffect(()=>{{y(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{y(!0)})});const W=setTimeout(()=>y(!1),600);return()=>clearTimeout(W)}},[I]),r.useEffect(()=>{function W(Z){N.current&&!N.current.contains(Z.target)&&u(!1),j.current&&!j.current.contains(Z.target)&&p(!1)}return document.addEventListener("mousedown",W),()=>document.removeEventListener("mousedown",W)},[N,j]);const P=W=>{u(!1),g&&g(W)},A=W=>{u(!1),a("feed")},F=W=>{x&&x(W),p(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed top-0 bottom-0 w-full pointer-events-none z-[9999] 
          bg-gradient-to-r from-transparent via-white/30 dark:via-white/10 to-transparent
          ${c?"left-[-100%] transition-all duration-500 ease-out":"left-[100%] transition-none duration-0"}
        `}),e.jsxs("nav",{className:"h-16 bg-white dark:bg-dark-card border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 shrink-0 z-20 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:b,className:"p-2 -ml-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 lg:hidden",children:e.jsx(gr,{size:24})}),e.jsx("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>a("dashboard"),children:e.jsx("img",{src:n?Ua:Va,alt:"SeshNx Logo",className:"h-8 w-auto object-contain transition-opacity duration-300"})})]}),e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[v&&e.jsxs("div",{className:"hidden md:flex items-center bg-gray-100 dark:bg-gray-800 rounded-lg p-1 border dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>a("dashboard"),className:`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${$?"text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200":"bg-white dark:bg-gray-600 shadow-sm text-brand-blue dark:text-white"}`,children:[e.jsx(mr,{size:14})," Studio"]}),e.jsxs("button",{onClick:T,className:`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${$?"bg-white dark:bg-gray-600 shadow-sm text-indigo-600 dark:text-white":"text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200"}`,children:[e.jsx(Cs,{size:14})," Education"]})]}),S.length>1&&e.jsxs("div",{className:"relative hidden sm:flex items-center gap-3",ref:j,children:[e.jsxs("button",{onClick:()=>p(!i),className:"group flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs font-bold transition border border-gray-200 dark:border-gray-700",children:[e.jsx(kt,{size:12,className:`text-brand-blue shrink-0 transition-transform ${c?"rotate-180 duration-500":""}`}),e.jsx("span",{children:I}),e.jsx(dt,{size:12,className:`shrink-0 transition-transform ${i?"rotate-180":""}`})]}),e.jsxs("div",{className:"flex flex-col leading-tight",children:[e.jsx("span",{className:"text-[10px] text-gray-500 font-medium",children:"Posting as"}),e.jsx("span",{className:"text-xs font-bold dark:text-white truncate max-w-[150px]",children:M})]}),i&&e.jsxs("div",{className:"absolute left-0 top-full mt-2 w-56 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-xl z-50 overflow-hidden animate-in fade-in slide-in-from-top-1 duration-200",children:[e.jsx("div",{className:"p-2 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wider pl-2",children:"Switch Profile Context"})}),e.jsx("div",{className:"p-1",children:S.map(W=>{const Z=B(W);return e.jsxs("button",{onClick:()=>F(W),className:`w-full text-left px-3 py-2 rounded-lg text-sm font-medium transition flex items-center justify-between ${I===W?"bg-blue-50 dark:bg-blue-900/20 text-brand-blue":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:Z}),e.jsx("span",{className:"text-[10px] opacity-70 font-normal uppercase",children:W})]}),I===W&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-blue"})]},W)})})]})]}),e.jsx("button",{onClick:d,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300",children:n?e.jsx(zs,{size:20}):e.jsx(Rt,{size:20})}),e.jsxs("div",{className:"relative",ref:N,children:[e.jsxs("button",{className:`relative p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition ${m?"bg-gray-100 dark:bg-gray-800 text-brand-blue":""}`,onClick:()=>u(!m),children:[e.jsx(wt,{size:20}),e.jsx(nn,{count:E})]}),m&&e.jsx(ln,{notifications:k,unreadCount:E,loading:C,onMarkAsRead:h,onMarkAllAsRead:f,onDeleteNotification:R,onClearAll:z,onUserClick:P,onPostClick:A,onClose:()=>u(!1)})]}),e.jsx(mt,{src:s==null?void 0:s.photoURL,name:M,size:"sm",className:"border-2 border-transparent hover:border-brand-blue transition",onClick:()=>a("profile")})]})]})]})}function dn({userData:t,activeTab:s,setActiveTab:l,sidebarOpen:n,setSidebarOpen:d,handleLogout:o}){var c,y,N;const{isStudent:a,isStaff:b}=$l(),x=[{id:"dashboard",icon:e.jsx(qe,{size:18}),label:"Dashboard"},{id:"feed",icon:e.jsx(Es,{size:18}),label:"SocialNx"},{id:"marketplace",icon:e.jsx(ja,{size:18}),label:"Marketplace"},{id:"tech",icon:e.jsx(Ct,{size:18}),label:"Tech Services"},{id:"bookings",icon:e.jsx(Re,{size:18}),label:"Bookings"},{id:"messages",icon:e.jsx(Te,{size:18}),label:"Messages"},{id:"payments",icon:e.jsx(Rs,{size:18}),label:"Billing"},{id:"profile",icon:e.jsx(bt,{size:18}),label:"Profile"}],g=(c=t==null?void 0:t.accountTypes)==null?void 0:c.includes("Intern");if(a||g||b||(y=t==null?void 0:t.accountTypes)!=null&&y.includes("student")){const j=x.findIndex(C=>C.id==="payments");let k="EDU Panel";g?k="Internship":b&&(k="School Admin");let E="edu-overview";g?E="edu-intern":a&&(E="edu-student"),x.splice(j,0,{id:E,icon:e.jsx(Cs,{size:18}),label:k,highlight:!0})}const m=(N=t==null?void 0:t.accountTypes)==null?void 0:N.some(j=>["Studio","Label","Agent","Artist","Producer","Engineer","DJ"].includes(j)),u=o||(()=>_s(jt)),i=j=>{l(j);const k=window.innerWidth<1024;d&&(k||n)&&d(!1)},p=({isMobile:j})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 py-4 overflow-y-auto scrollbar-hide",children:[j&&e.jsxs("div",{className:"px-4 mb-6 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase",children:"Menu"}),e.jsx("button",{onClick:()=>d(!1),className:"p-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors",children:e.jsx(pe,{size:20})})]}),e.jsx("nav",{className:"space-y-1 px-2",children:x.map(k=>e.jsxs("button",{onClick:()=>i(k.id),className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition
                ${s===k.id?"bg-blue-50 text-brand-blue dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}
                ${k.highlight?"text-amber-600 dark:text-amber-500":""}
                `,children:[k.icon,k.label]},k.id))}),e.jsxs("div",{className:"mt-auto px-2 pt-4 space-y-1",children:[e.jsxs("button",{onClick:()=>i("legal"),className:`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium w-full transition ${s==="legal"?"bg-blue-50 text-brand-blue dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx(ps,{size:18}),"Legal Center"]}),m&&e.jsxs("button",{onClick:()=>i("business-center"),className:`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium w-full transition ${s==="business-center"?"bg-indigo-50 text-indigo-600 dark:bg-indigo-900/20 dark:text-indigo-400":"text-indigo-600 dark:text-indigo-400 hover:bg-indigo-50 dark:hover:bg-indigo-900/10"}`,children:[e.jsx(rt,{size:18}),"Business Center"]})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 shrink-0 bg-white dark:bg-[#1f2128]",children:e.jsxs("button",{onClick:u,className:"flex items-center gap-2 text-red-500 text-sm font-medium hover:opacity-80 px-2 w-full py-2 rounded hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors",children:[e.jsx(va,{size:16})," Sign Out"]})})]});return e.jsxs(e.Fragment,{children:[e.jsx("aside",{className:"hidden lg:flex w-64 bg-white dark:bg-[#1f2128] border-r border-gray-200 dark:border-gray-700 flex-col h-full shrink-0 relative z-30",children:e.jsx(p,{isMobile:!1})}),e.jsx("div",{className:`fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] transition-opacity duration-300 lg:hidden ${n?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:()=>d(!1)}),e.jsx("aside",{className:`fixed inset-y-0 left-0 z-[10000] w-72 bg-white dark:bg-[#1f2128] shadow-2xl transform transition-transform duration-300 cubic-bezier(0.4, 0, 0.2, 1) flex flex-col h-full lg:hidden ${n?"translate-x-0":"-translate-x-full"}`,children:e.jsx(p,{isMobile:!0})})]})}function cn({activeTab:t,setActiveTab:s,sidebarOpen:l,setSidebarOpen:n,isGlobalAdmin:d}){const o=[{id:"edu-overview",icon:ur,label:"Overview"},{id:"edu-roster",icon:Fe,label:"Student Roster"},{id:"edu-hours",icon:Ie,label:"Internship Hours"},{id:"edu-instructors",icon:St,label:"Staff Management"},{id:"edu-roles",icon:Wt,label:"Role Permissions"},{id:"edu-resources",icon:gt,label:"Resource Rules"},{id:"edu-news",icon:br,label:"Announcements"},{id:"edu-partners",icon:rt,label:"Partnerships"},{id:"edu-evaluations",icon:Cs,label:"Grading & Evals"},{id:"edu-cohorts",icon:Fe,label:"Cohorts"},{id:"edu-audit",icon:ka,label:"Audit Logs"},{id:"edu-settings",icon:bt,label:"School Settings"}],a=x=>{s(x),n&&n(!1)},b=()=>e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>s("dashboard"),className:"flex items-center gap-2 text-xs font-bold text-gray-500 hover:text-brand-blue transition mb-4",children:[e.jsx(Na,{size:14})," Back to Studio"]}),e.jsx("h2",{className:"text-lg font-extrabold dark:text-white tracking-tight px-1",children:"EDU Control"})]}),e.jsx("div",{className:"flex-1 py-4 overflow-y-auto custom-scrollbar px-3 space-y-1",children:o.map(x=>e.jsxs("button",{onClick:()=>a(x.id),className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors
                        ${t===x.id?"bg-indigo-50 text-indigo-600 dark:bg-indigo-900/20 dark:text-indigo-300":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}
                        `,children:[e.jsx(x.icon,{size:18}),x.label]},x.id))}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 shrink-0 bg-gray-50 dark:bg-[#23262f]",children:e.jsxs("div",{className:"flex items-center gap-3 px-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center text-indigo-700 dark:text-indigo-300 font-bold text-xs",children:"EA"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold dark:text-white truncate",children:"EDU Admin"}),e.jsx("p",{className:"text-[10px] text-gray-500 truncate",children:"School Management"})]}),e.jsx("button",{onClick:()=>_s(jt),className:"text-gray-400 hover:text-red-500",children:e.jsx(va,{size:16})})]})})]});return e.jsxs(e.Fragment,{children:[e.jsx("aside",{className:"hidden lg:flex w-64 bg-white dark:bg-[#1f2128] border-r border-gray-200 dark:border-gray-700 flex-col h-full shrink-0 relative z-30",children:e.jsx(b,{})}),e.jsx("div",{className:`fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] transition-opacity duration-300 lg:hidden ${l?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:()=>n(!1)}),e.jsx("aside",{className:`fixed inset-y-0 left-0 z-[10000] w-72 bg-white dark:bg-[#1f2128] shadow-2xl transform transition-transform duration-300 cubic-bezier(0.4, 0, 0.2, 1) flex flex-col h-full lg:hidden ${l?"translate-x-0":"-translate-x-full"}`,children:e.jsx(b,{})})]})}function Za({isEmbedded:t=!1}){const[s,l]=r.useState("tos"),n=[{id:"tos",label:"Terms of Service",icon:Pt},{id:"privacy",label:"Privacy Policy",icon:gt},{id:"cookies",label:"Cookie Policy",icon:hr},{id:"dmca",label:"DMCA & Copyright",icon:Pe}];return e.jsxs("div",{className:`flex flex-col md:flex-row bg-white dark:bg-[#1f2128] h-full ${t?"":"max-w-6xl mx-auto rounded-2xl shadow-xl border dark:border-gray-700 overflow-hidden my-8 min-h-[600px]"}`,children:[e.jsxs("div",{className:"w-full md:w-72 bg-gray-50 dark:bg-[#23262f] border-r dark:border-gray-700 flex flex-col shrink-0",children:[!t&&e.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:e.jsxs("h2",{className:"text-2xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(Pe,{className:"text-brand-blue"})," Legal Center"]})}),e.jsx("div",{className:"p-4 space-y-1 overflow-y-auto flex-1",children:n.map(d=>e.jsxs("button",{onClick:()=>l(d.id),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all duration-200 group text-left
                            ${s===d.id?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm border border-gray-200 dark:border-gray-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-200/50 dark:hover:bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d.icon,{size:18,className:s===d.id?"text-brand-blue":"text-gray-400 group-hover:text-gray-500"}),e.jsx("span",{className:"font-bold text-sm",children:d.label})]}),s===d.id&&e.jsx(Ke,{size:16,className:"text-brand-blue"})]},d.id))}),e.jsxs("div",{className:"p-6 bg-blue-50 dark:bg-blue-900/10 border-t border-blue-100 dark:border-blue-800/30",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-400 font-bold text-xs mb-2",children:[e.jsx(Ut,{size:14})," US Compliance Standard"]}),e.jsx("p",{className:"text-[10px] text-blue-600 dark:text-blue-300 leading-relaxed opacity-80",children:"Documents compliant with CCPA, DMCA, and federal payment regulations."})]})]}),e.jsx("div",{className:"flex-1 bg-white dark:bg-[#1f2128] relative overflow-hidden flex flex-col",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-6 md:p-12 custom-scrollbar",children:e.jsxs("div",{className:"max-w-3xl mx-auto animate-in fade-in slide-in-from-bottom-2 duration-300",children:[s==="tos"&&e.jsx(xn,{}),s==="privacy"&&e.jsx(gn,{}),s==="cookies"&&e.jsx(mn,{}),s==="dmca"&&e.jsx(un,{}),e.jsx("div",{className:"mt-20 pt-8 border-t dark:border-gray-800",children:e.jsx("p",{className:"text-xs text-gray-400 text-center font-medium",children:"Last updated: November 29, 2025 • SeshNx Legal Department"})})]})})})]})}const is=({children:t})=>e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-gray-900 dark:text-white mb-8 tracking-tight",children:t}),Ue=({title:t,children:s})=>e.jsxs("div",{className:"mb-10",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:t}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300 leading-7 text-sm md:text-base space-y-4",children:s})]}),$t=({items:t})=>e.jsx("ul",{className:"space-y-2 mt-2",children:t.map((s,l)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-2 w-1.5 h-1.5 rounded-full bg-brand-blue shrink-0"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:s}})]},l))}),xn=()=>e.jsxs(e.Fragment,{children:[e.jsx(is,{children:"Terms of Service"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 leading-relaxed",children:"Welcome to SeshNx. By accessing or using our platform, you agree to be bound by these Terms of Service. Please read them carefully."}),e.jsx(Ue,{title:"1. Platform Services",children:e.jsx("p",{children:'SeshNx provides a marketplace and collaboration tool for music professionals ("Creatives") and educational institutions ("Schools"). We facilitate bookings, payments, and content sharing but are not a party to the actual service contracts between users.'})}),e.jsx(Ue,{title:"2. User Accounts",children:e.jsx("p",{children:"You are responsible for maintaining the confidentiality of your account credentials. You must be at least 13 years old to use SeshNx. Users under 18 require parental consent or School authorization to participate in educational programs."})}),e.jsxs(Ue,{title:"3. Payments & Fees",children:[e.jsxs("p",{children:["Payments are processed securely via Stripe. By using our payment features, you agree to the ",e.jsx("a",{href:"https://stripe.com/connect-account/legal",target:"_blank",rel:"noreferrer",className:"text-brand-blue hover:underline font-bold",children:"Stripe Connected Account Agreement"}),"."]}),e.jsx("p",{children:"SeshNx charges a platform fee on transactions (ranging from 0% to 20% depending on your subscription tier), which is automatically deducted at the time of payout."})]}),e.jsx(Ue,{title:"4. User Generated Content",children:e.jsx("p",{children:"You retain full ownership of the content you upload (audio, images, text). By uploading, you grant SeshNx a non-exclusive, worldwide license to display, transcode, and distribute your content strictly for the purpose of operating the service."})}),e.jsxs(Ue,{title:"5. Prohibited Conduct",children:[e.jsx("p",{children:"You agree not to use SeshNx for:"}),e.jsx($t,{items:["Harassment, hate speech, or bullying.","Distribution of malware or unauthorized automated scraping.","Fraudulent transactions or money laundering.","Copyright infringement or uploading content you do not own."]}),e.jsx("p",{className:"mt-2",children:"We reserve the right to suspend or ban accounts violating these rules without prior notice."})]})]}),gn=()=>e.jsxs(e.Fragment,{children:[e.jsx(is,{children:"Privacy Policy"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 leading-relaxed",children:"Your privacy is critical to us. This policy explains how we collect, use, and share your data in compliance with US and international standards."}),e.jsx(Ue,{title:"1. Information We Collect",children:e.jsx($t,{items:["<strong>Account Data:</strong> Name, email, password (hashed), and profile bio.","<strong>Financial Data:</strong> Bank account and tax info (processed and stored securely via Stripe; SeshNx does not store full credit card numbers).","<strong>Usage Data:</strong> Location (for studio search), IP address, and browser type.","<strong>Content:</strong> Direct messages, audio files, and images you upload."]})}),e.jsx(Ue,{title:"2. How We Use Information",children:e.jsx("p",{children:"We use your data to: provide and personalize services, process payments, verify student enrollment with partner schools, improve platform performance, and comply with legal obligations."})}),e.jsxs(Ue,{title:"3. Data Sharing",children:[e.jsx("p",{children:"We do not sell your personal data. We only share data with:"}),e.jsx($t,{items:["<strong>Service Providers:</strong> Google (Hosting/Auth), Stripe (Payments).","<strong>Educational Institutions:</strong> If you link a student account, your School Administrators can view your internship activity logs.","<strong>Legal Authorities:</strong> When required by valid legal process or subpoena."]})]}),e.jsx(Ue,{title:"4. CCPA / California Rights",children:e.jsxs("p",{children:["California residents have the right to request access to or deletion of their personal data. Please contact ",e.jsx("strong",{children:"legal@seshnx.com"})," to exercise these rights."]})})]}),mn=()=>e.jsxs(e.Fragment,{children:[e.jsx(is,{children:"Cookie Policy"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 leading-relaxed",children:"SeshNx uses cookies to enhance your experience. By using our site, you consent to our use of cookies."}),e.jsx(Ue,{title:"Types of Cookies We Use",children:e.jsx($t,{items:["<strong>Essential Cookies:</strong> Required for login authentication (e.g., Firebase Auth tokens). The site cannot function without these.","<strong>Functional Cookies:</strong> Remember your preferences, such as Dark Mode settings and Sidebar state.","<strong>Analytics Cookies:</strong> Help us understand how you use the site to improve features. These are aggregated and anonymous."]})}),e.jsx(Ue,{title:"Managing Cookies",children:e.jsx("p",{children:"You can control or delete cookies through your browser settings. However, please note that disabling Essential Cookies will prevent you from logging in to SeshNx."})})]}),un=()=>e.jsxs(e.Fragment,{children:[e.jsx(is,{children:"DMCA & Copyright"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 leading-relaxed",children:"SeshNx respects the intellectual property rights of others and complies with the Digital Millennium Copyright Act (DMCA)."}),e.jsxs(Ue,{title:"Reporting Infringement",children:[e.jsxs("p",{children:["If you believe your copyrighted work has been infringed on SeshNx, please send a notice to our Designated Agent at ",e.jsx("strong",{children:"legal@seshnx.com"})," including:"]}),e.jsx($t,{items:["Identification of the copyrighted work claimed to have been infringed.","Identification of the infringing material (URL or Post ID).","Your contact information (Email, Phone).","A statement of good faith belief that the use is unauthorized.","A statement, under penalty of perjury, that the information is accurate and you are the copyright owner."]})]}),e.jsx(Ue,{title:"Counter-Notices",children:e.jsx("p",{children:"If your content was removed by mistake, you may file a counter-notice. We may restore the content within 10-14 business days if the complainant does not file a court action against you."})})]});function bn({onImagesLoaded:t}){const[s,l]=r.useState([]),[n,d]=r.useState(0),[o,a]=r.useState(!0),[b,x]=r.useState(!1),[g,m]=r.useState({x:0,y:0,startX:0,startY:0}),u=r.useRef(null);if(r.useEffect(()=>{(async()=>{var C;try{const h=ye(le(O,`artifacts/${re}/auth_backgrounds`),Ae("order","asc"),Ze(20)),f=await Xe(h);if(f.empty)l([{id:"1",url:"https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1920&q=80",order:0},{id:"2",url:"https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=1920&q=80",order:1},{id:"3",url:"https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=1920&q=80",order:2},{id:"4",url:"https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1920&q=80",order:3}]);else{const R=f.docs.map(z=>({id:z.id,url:z.data().url,order:z.data().order||0}));l(R)}}catch(h){(C=h.message)!=null&&C.includes("BLOCKED_BY_CLIENT")||h.code==="unavailable"?console.warn("Firestore request blocked by browser extension. Using fallback images."):console.error("Error loading background images:",h),l([{id:"1",url:"https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1920&q=80",order:0},{id:"2",url:"https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=1920&q=80",order:1},{id:"3",url:"https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=1920&q=80",order:2}])}finally{a(!1)}})()},[]),r.useEffect(()=>{if(s.length===0)return;const E=[{startX:0,startY:0,endX:100,endY:0},{startX:100,startY:0,endX:0,endY:0},{startX:0,startY:0,endX:0,endY:100},{startX:0,startY:100,endX:0,endY:0},{startX:0,startY:0,endX:100,endY:100},{startX:100,startY:0,endX:0,endY:100},{startX:0,startY:100,endX:100,endY:0},{startX:100,startY:100,endX:0,endY:0}],C=E[Math.floor(Math.random()*E.length)];m(C)},[n,s.length]),r.useEffect(()=>{if(s.length===0||o)return;const E=3e4;return u.current=setInterval(()=>{d(C=>{let h;do h=Math.floor(Math.random()*s.length);while(h===C&&s.length>1);return h})},E),()=>{u.current&&clearInterval(u.current)}},[s.length,o]),r.useEffect(()=>{if(!o&&s.length>0&&!b){const E=new Image;E.onload=()=>{x(!0),t&&t(!0)},E.onerror=()=>{x(!0),t&&t(!0)},E.src=s[0].url}},[o,s,b,t]),o||s.length===0)return null;const i=s[n],p=2.2,c=40,y=(E,C)=>{const h=E===0?"0%":E===100?`-${c}%`:`-${c/2}%`,f=C===0?"0%":C===100?`-${c}%`:`-${c/2}%`;return`scale(${p}) translate(${h}, ${f}) translateZ(0)`},N=y(g.startX,g.startY),j=y(g.endX,g.endY),k=`pan-${g.startX}-${g.startY}-${g.endX}-${g.endY}`;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes ${k} {
          0% {
            transform: ${N};
          }
          100% {
            transform: ${j};
          }
        }
      `}),e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",style:{zIndex:-1},children:[e.jsxs("div",{className:"absolute inset-0 background-pan-container",style:{willChange:"opacity",transform:"translateZ(0)"},children:[e.jsx("div",{className:"absolute inset-0 background-pan-image",style:{backgroundImage:`url(${i.url})`,backgroundSize:"cover",backgroundPosition:"center",animation:`${k} 30s linear forwards`,willChange:"transform",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"translateZ(0)"}}),e.jsx("div",{className:"absolute inset-0",style:{background:"radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.4) 70%, rgba(0,0,0,0.7) 100%)",pointerEvents:"none"}}),e.jsx("div",{className:"absolute inset-0",style:{backdropFilter:"blur(1px)",WebkitBackdropFilter:"blur(1px)",opacity:.15,pointerEvents:"none"}})]},i.id),e.jsx("div",{className:"absolute inset-0 bg-black/20 pointer-events-none"})]})]})}const hn=["Student","Instructor","Intern","Admin"];function pn({lat:t,lng:s}){const l=Ha();return r.useEffect(()=>{l.setView([t,s],11)},[t,s,l]),null}function fn({zip:t}){const[s,l]=r.useState({center:[34.0522,-118.2437],userCount:0,densityColor:"gray",locationName:"",regionLabel:"",isValid:!1,loading:!1});return r.useEffect(()=>{if(!t||t.length<5)return;const d=setTimeout(async()=>{l(a=>({...a,loading:!0}));const o=await ns(t);if(o){const{count:a,density:b,label:x}=await Tl(t);l({center:[o.lat,o.lng],userCount:a,densityColor:b,locationName:o.cityState,regionLabel:x,isValid:!0,loading:!1})}else l(a=>({...a,loading:!1}))},800);return()=>clearTimeout(d)},[t]),e.jsxs("div",{className:"w-full h-36 rounded-xl overflow-hidden relative border dark:border-gray-600 shadow-inner animate-in fade-in duration-500 bg-gray-100 dark:bg-[#1f2128]",children:[e.jsxs(_a,{center:s.center,zoom:11,scrollWheelZoom:!1,zoomControl:!1,className:"h-full w-full",style:{background:"transparent"},children:[e.jsx(qa,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'© <a href="https://carto.com/attributions">CARTO</a>'}),e.jsx(pn,{lat:s.center[0],lng:s.center[1]}),s.isValid&&e.jsxs(e.Fragment,{children:[e.jsx(Ht,{center:s.center,radius:8e3,pathOptions:{color:s.densityColor,fillColor:s.densityColor,fillOpacity:.05,stroke:!1}}),e.jsx(Ht,{center:s.center,radius:4e3,pathOptions:{color:s.densityColor,fillColor:s.densityColor,fillOpacity:.15,stroke:!1}}),e.jsx(Ht,{center:s.center,radius:400,pathOptions:{color:"white",fillColor:s.densityColor,fillOpacity:.9,weight:2}})]})]}),e.jsxs("div",{className:"absolute bottom-3 right-3 bg-white/95 dark:bg-black/85 backdrop-blur-md p-2.5 rounded-xl shadow-lg z-[400] border border-gray-100 dark:border-gray-700 flex flex-col items-end min-w-[120px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${s.loading?"animate-ping":""} shadow-sm`,style:{backgroundColor:s.isValid?s.densityColor:"gray"}}),e.jsx("div",{className:"text-xs font-extrabold text-gray-700 dark:text-gray-100 leading-none",children:s.loading?"Scanning...":s.isValid?`${s.userCount} Nearby`:"Enter Zip"})]}),s.isValid&&!s.loading&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wider",children:s.regionLabel}),e.jsx("span",{className:"text-[9px] text-gray-400 font-normal truncate max-w-[140px]",children:s.locationName})]})]})]})}function ra({darkMode:t,toggleTheme:s,user:l,onSuccess:n}){const[d,o]=r.useState(1),[a,b]=r.useState("login"),[x,g]=r.useState(!1),[m,u]=r.useState(!1),[i,p]=r.useState({email:"",password:"",firstName:"",lastName:"",zip:"",roles:[]}),[c,y]=r.useState(""),[N,j]=r.useState(!1),[k,E]=r.useState("auto"),[C,h]=r.useState(!1),[f,R]=r.useState(!1),z=r.useRef(null),[I,S]=r.useState(!1),[w,v]=r.useState(""),[$,B]=r.useState([]),[M,T]=r.useState(null),[P,A]=r.useState(""),[F,L]=r.useState(""),[W,Z]=r.useState(""),[D,Y]=r.useState(null),[q,J]=r.useState(null),ee=Jt.filter(H=>!hn.includes(H)),ne=()=>a==="signup"?"Create your Account":a==="forgot"?"Password Recovery":a==="onboarding"?"Finalize Setup":null;r.useEffect(()=>{if(l){b("onboarding"),o(1);const H=l.displayName?l.displayName.split(" "):["User",""];p(V=>({...V,email:l.email,firstName:H[0]||"",lastName:H.slice(1).join(" ")||""})),u(!1)}else b("login"),o(1),p({email:"",password:"",firstName:"",lastName:"",zip:"",roles:[]})},[l]);const[me,_]=r.useState({hasUpper:!1,hasLower:!1,hasNumber:!1,isLength:!1});r.useEffect(()=>{const H=i.password;_({hasUpper:/[A-Z]/.test(H),hasLower:/[a-z]/.test(H),hasNumber:/[0-9]/.test(H),isLength:H.length>=6})},[i.password]);const ae=Object.values(me).every(Boolean);r.useEffect(()=>{if(!z.current)return;const H=new ResizeObserver(()=>{if(z.current){const V=z.current.scrollHeight+80;V>200&&E(`${V}px`)}});return H.observe(z.current),()=>H.disconnect()},[d,a,c,N,i.zip,I,$,D]),r.useEffect(()=>{y("")},[d]);const de=async()=>{if(!i.email||!i.password)return y("Please fill in all fields.");u(!0);try{await xl(jt,i.email,i.password)}catch{y("Invalid email or password."),u(!1)}},G=async()=>{y(""),u(!0);try{const H=new gl;H.setCustomParameters({prompt:"select_account"}),await ml(jt,H)}catch(H){console.error("Google Sign-In Error:",H),y(H.message),u(!1)}},he=async()=>{if(a==="signup"&&!ae)return y("Password requirements not met.");u(!0);try{let H;a==="onboarding"&&l?H=l.uid:H=(await ul(jt,i.email,i.password)).user.uid;let V=i.roles.length>0?i.roles:["Fan"];if(q&&!V.includes("Student")&&V.push("Student"),q){await ft(q.ref);const ke=q.data();await xt(Q(O,`schools/${M.id}/students`,H),{...ke,uid:H,email:i.email,status:"Active"})}const xe={firstName:i.firstName,lastName:i.lastName,zip:i.zip,accountTypes:V,activeProfileRole:V[0],schoolId:(M==null?void 0:M.id)||null,studentId:P||null,createdAt:ue(),email:i.email,photoURL:(l==null?void 0:l.photoURL)||null};await Promise.all([xt(Q(O,te(H).userProfile),xe,{merge:!0}),xt(Q(O,te(H).userPublicProfile),{...xe,uid:H,searchTerms:[i.firstName.toLowerCase(),i.lastName.toLowerCase(),i.zip,...V.map(ke=>ke.toLowerCase())]},{merge:!0}),xt(Q(O,te(H).userWallet),{balance:0,createdAt:ue()},{merge:!0})]),n&&n()}catch(H){y(H.message.replace("Firebase: ","").replace("auth/","")),u(!1)}},se=async()=>{if(!i.email)return y("Enter email address.");u(!0);try{await bl(jt,i.email),j(!0),y("")}catch(H){y(H.message)}u(!1)},je=()=>{if(!navigator.geolocation)return y("Geolocation not supported.");h(!0),navigator.geolocation.getCurrentPosition(async H=>{try{const xe=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${H.coords.latitude}&lon=${H.coords.longitude}`)).json();xe.address.postcode?p(ke=>({...ke,zip:xe.address.postcode.split("-")[0]})):y("Could not determine Zip Code.")}catch{y("Failed to find location.")}h(!1)},()=>{y("Location permission denied."),h(!1)})};r.useEffect(()=>{if(w.length<2){B([]);return}const H=setTimeout(async()=>{const V=ye(le(O,"schools"),Ce("name",">=",w),Ce("name","<=",w+"")),xe=await Xe(V);B(xe.docs.map(ke=>({id:ke.id,...ke.data()})))},300);return()=>clearTimeout(H)},[w]);const Ne=async()=>{if(!M||!P||!F)return y("All fields required.");u(!0);try{const H=ye(le(O,`schools/${M.id}/students`),Ce("studentId","==",P)),V=await Xe(H);if(V.empty){y("Student ID not found in this school's roster."),u(!1);return}const xe=V.docs[0].data();if(xe.email.toLowerCase()!==F.toLowerCase()){y("Email provided does not match the student record."),u(!1);return}p(os=>({...os,firstName:xe.firstName||xe.displayName.split(" ")[0],lastName:xe.lastName||xe.displayName.split(" ").slice(1).join(" ")}));const ke=Math.floor(1e5+Math.random()*9e5).toString();console.log("MOCK AUTH CODE SENT:",ke),Y(ke),J(V.docs[0]),alert(`Code sent to ${F}. (Dev: ${ke})`),u(!1)}catch(H){console.error(H),y("Verification failed."),u(!1)}},ge=()=>{W===D?(p(H=>({...H,roles:[...H.roles,"Student"]})),o(5)):y("Invalid authorization code.")},U=(H,V)=>{H.key==="Enter"&&V()},K=({met:H,text:V})=>e.jsxs("div",{className:`flex items-center gap-1.5 text-xs transition-colors ${H?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"}`,children:[H?e.jsx(Ge,{size:12,strokeWidth:3}):e.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-300 dark:border-gray-600"}),V]});return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 transition-colors duration-500 relative overflow-hidden",children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:0},children:e.jsx(bn,{onImagesLoaded:g})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-900 dark:to-black transition-opacity duration-1000",style:{zIndex:0,opacity:x?0:1,pointerEvents:x?"none":"auto"}}),e.jsx("div",{className:"absolute top-6 right-6 z-20",children:e.jsx("button",{onClick:s,className:"p-3 rounded-full bg-white/80 dark:bg-black/50 backdrop-blur-md border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:scale-110 transition-transform shadow-sm",children:t?e.jsx(zs,{size:20}):e.jsx(Rt,{size:20})})}),e.jsx("div",{className:"bg-white/95 dark:bg-dark-card/95 dark:border dark:border-gray-700 rounded-3xl shadow-2xl w-full max-w-md relative overflow-hidden transition-[height] duration-500 z-10 backdrop-blur-md",style:{height:k,minHeight:"500px"},children:e.jsxs("div",{ref:z,className:"pt-12 px-8 pb-8",children:[e.jsxs("div",{className:"relative w-full h-48 mb-6 flex justify-center shrink-0",children:[e.jsx("div",{className:`absolute transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)] ${a==="signup"||a==="onboarding"?"top-0 scale-90":"top-8 scale-100"} z-0`,children:e.jsx("div",{className:`w-96 h-40 ${a==="signup"||a==="onboarding"?"":"animate-float"}`,children:e.jsx("img",{src:t?Ua:Va,alt:"SeshNx",className:"w-full h-full object-contain drop-shadow-md"})})}),e.jsx("div",{className:"absolute bottom-2 w-full text-center z-10 pointer-events-none",children:ne()&&e.jsx("p",{className:"text-sm font-bold text-gray-500 dark:text-gray-300 uppercase tracking-wider animate-pulse transition-opacity duration-300",children:ne()})})]}),c&&e.jsxs("div",{className:"absolute top-4 left-0 right-0 mx-8 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-300 p-3 rounded-xl text-sm flex items-center gap-2 animate-in fade-in slide-in-from-top-2 z-30 border border-red-100 dark:border-red-800/30",children:[e.jsx(st,{size:16}),e.jsx("span",{className:"capitalize font-medium",children:c})]}),N&&e.jsxs("div",{className:"absolute top-4 left-0 right-0 mx-8 bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-300 p-3 rounded-xl text-sm flex items-center gap-2 animate-in fade-in slide-in-from-top-2 z-30 border border-green-100 dark:border-green-800/30",children:[e.jsx(Ge,{size:16}),e.jsx("span",{children:"Check your email."})]}),e.jsxs("div",{className:"animate-in fade-in slide-in-from-right-4 duration-500 fill-mode-forwards",children:[a==="login"&&e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all",placeholder:"Email Address",type:"email",value:i.email,onChange:H=>p({...i,email:H.target.value}),onKeyDown:H=>U(H,de),disabled:m}),e.jsx("input",{className:"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all",type:"password",placeholder:"Password",value:i.password,onChange:H=>p({...i,password:H.target.value}),onKeyDown:H=>U(H,de),disabled:m})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>b("forgot"),className:"text-xs text-gray-500 hover:text-brand-blue font-medium transition-colors",children:"Forgot Password?"})}),e.jsx("button",{className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 transition-all shadow-lg flex justify-center disabled:opacity-70",onClick:de,disabled:m,children:m?e.jsx(oe,{className:"animate-spin"}):"Sign In"}),e.jsxs("button",{onClick:G,className:"w-full bg-white dark:bg-transparent border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white py-3.5 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-800 transition-all flex justify-center items-center gap-2",disabled:m,children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Continue with Google"]}),e.jsxs("div",{className:"relative py-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white dark:bg-dark-card text-gray-500",children:"or"})})]}),e.jsx("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400 cursor-pointer hover:text-brand-blue font-medium transition-colors pt-2",onClick:()=>b("signup"),children:"New here? Create an Account"})]}),a==="forgot"&&e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center mb-2",children:"Enter your email to receive reset instructions."}),e.jsx("input",{className:"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all",placeholder:"Email Address",type:"email",value:i.email,onChange:H=>p({...i,email:H.target.value}),onKeyDown:H=>U(H,se),disabled:m||N}),e.jsx("button",{className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 transition-all flex justify-center items-center gap-2 disabled:opacity-50",onClick:se,disabled:m||N,children:m?e.jsx(oe,{className:"animate-spin"}):N?"Sent!":"Send Reset Link"}),e.jsx("button",{className:"w-full text-gray-500 text-sm hover:text-gray-800 dark:hover:text-gray-200 mt-2",onClick:()=>b("login"),children:"Back to Login"})]}),(a==="signup"||a==="onboarding")&&e.jsxs("div",{className:"w-full",children:[d===1&&e.jsx("div",{className:"space-y-4 animate-in fade-in slide-in-from-right-8 duration-500",children:a==="signup"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all",placeholder:"Email Address",type:"email",value:i.email,onChange:H=>p({...i,email:H.target.value}),disabled:m}),e.jsx("input",{className:`w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border ${!ae&&i.password?"border-red-300 focus:ring-red-200":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"} rounded-xl focus:ring-2 outline-none dark:text-white transition-all`,type:"password",placeholder:"Create Password",value:i.password,onChange:H=>p({...i,password:H.target.value}),disabled:m})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 pl-1",children:[e.jsx(K,{met:me.hasUpper,text:"Uppercase Letter"}),e.jsx(K,{met:me.hasLower,text:"Lowercase Letter"}),e.jsx(K,{met:me.hasNumber,text:"Number (0-9)"}),e.jsx(K,{met:me.isLength,text:"6+ Characters"})]})}),e.jsx("button",{className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 transition-all shadow-lg flex justify-center disabled:opacity-50",onClick:()=>{if(!i.email)return y("Email required");if(!ae)return y("Fix password issues");o(2)},disabled:m||!ae||!i.email,children:"Continue"}),e.jsxs("button",{onClick:G,className:"w-full bg-white dark:bg-transparent border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white py-3.5 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-800 transition-all flex justify-center items-center gap-2",disabled:m,children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Continue with Google"]}),e.jsxs("div",{className:"relative py-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white dark:bg-dark-card text-gray-500",children:"or"})})]}),e.jsx("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400 cursor-pointer hover:text-brand-blue font-medium transition-colors pt-2",onClick:()=>b("login"),children:"Already have an account? Log In"})]}):e.jsxs("div",{className:"space-y-6 text-center",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-gray-100 dark:bg-gray-800 p-1 border-2 border-brand-blue shadow-lg overflow-hidden",children:l!=null&&l.photoURL?e.jsx("img",{src:l.photoURL,alt:"Profile",className:"w-full h-full object-cover rounded-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-brand-blue",children:e.jsx(qe,{size:40})})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold dark:text-white",children:["Welcome, ",i.firstName,"!"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm mt-1",children:"Let's finish setting up your creative profile."})]}),e.jsx("button",{className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 transition-all shadow-lg flex justify-center",onClick:()=>o(2),children:"Let's Go"})]})}),d===2&&e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{className:"w-1/2 p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white",placeholder:"First Name",value:i.firstName,onChange:H=>p({...i,firstName:H.target.value}),autoFocus:!0}),e.jsx("input",{className:"w-1/2 p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white",placeholder:"Last Name",value:i.lastName,onChange:H=>p({...i,lastName:H.target.value})})]}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{className:"w-full p-3.5 pl-10 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-brand-blue outline-none dark:text-white",placeholder:"Zip Code",maxLength:5,value:i.zip,onChange:H=>p({...i,zip:H.target.value.replace(/\D/g,"")})}),e.jsx(Le,{className:"absolute left-3 top-3.5 text-gray-400",size:18})]}),e.jsx("button",{onClick:je,className:"p-3.5 bg-gray-50 dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 text-brand-blue transition-colors",children:C?e.jsx(oe,{size:20,className:"animate-spin"}):e.jsx(wa,{size:20})})]}),e.jsx(fn,{zip:i.zip}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-3 rounded-xl border dark:border-gray-700 flex items-center gap-3 cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-[#2a2d36]",onClick:()=>S(!I),children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center transition-colors ${I?"bg-brand-blue border-brand-blue":"border-gray-400"}`,children:I&&e.jsx(Ge,{size:12,className:"text-white",strokeWidth:3})}),e.jsx("span",{className:"text-sm font-bold dark:text-white flex-1",children:"Are you a student?"}),e.jsx(Zs,{size:18,className:I?"text-brand-blue":"text-gray-400"})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsxs("button",{className:`text-gray-500 flex items-center gap-1 text-sm font-medium ${a==="onboarding"?"opacity-0 pointer-events-none":""}`,onClick:()=>o(1),children:[e.jsx(Na,{size:16})," Back"]}),e.jsx("button",{className:"bg-gray-900 dark:bg-white dark:text-black text-white px-6 py-2.5 rounded-xl font-bold transition-transform active:scale-95",onClick:()=>{i.firstName&&i.zip?o(I?3:5):y("Info required")},children:"Next Step"})]})]}),d===3&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg mb-2",children:"Find your School"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Search for your institution to link your enrollment."})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",placeholder:"Search School Name...",value:w,onChange:H=>v(H.target.value),autoFocus:!0}),$.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-xl max-h-48 overflow-y-auto p-1",children:$.map(H=>e.jsxs("div",{onClick:()=>{T(H),o(4)},className:"p-3 hover:bg-gray-50 dark:hover:bg-white/10 cursor-pointer rounded-lg flex items-center gap-3 transition",children:[e.jsx("div",{className:"h-8 w-8 bg-gray-200 dark:bg-gray-700 rounded flex items-center justify-center text-gray-500",children:e.jsx(Zs,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white text-sm",children:H.name}),e.jsx("div",{className:"text-xs text-gray-500",children:H.city||"Location N/A"})]})]},H.id))})]}),e.jsx("button",{className:"w-full text-gray-400 text-sm hover:text-gray-600",onClick:()=>o(2),children:"Back"})]}),d===4&&M&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:M.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Verify your enrollment"})]}),D?e.jsxs("div",{className:"space-y-4 text-center animate-in fade-in",children:[e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-3 rounded-lg border border-green-100 dark:border-green-800",children:e.jsxs("p",{className:"text-xs text-green-700 dark:text-green-400",children:["Code sent to ",F]})}),e.jsxs("div",{className:"relative",children:[e.jsx(Wt,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white text-center font-mono tracking-widest text-lg",placeholder:"000000",maxLength:6,value:W,onChange:H=>Z(H.target.value)})]}),e.jsx("button",{onClick:ge,className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 transition",children:"Confirm Code"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Student ID Number",value:P,onChange:H=>A(H.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Vt,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"School Email Address",value:F,onChange:H=>L(H.target.value)})]}),e.jsx("button",{onClick:Ne,disabled:m,className:"w-full bg-brand-blue text-white py-3 rounded-xl font-bold hover:bg-blue-600 transition",children:m?"Verifying...":"Verify & Send Code"})]}),e.jsx("button",{className:"w-full text-gray-400 text-sm hover:text-gray-600",onClick:()=>o(3),children:"Change School"})]}),d===5&&e.jsxs("div",{className:"space-y-5 animate-in fade-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-bold dark:text-white",children:"Select Additional Roles"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"You can change these later."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5 h-auto",children:ee.map(H=>e.jsxs("div",{onClick:()=>{const V=i.roles.includes(H)?i.roles.filter(xe=>xe!==H):[...i.roles,H];p({...i,roles:V})},className:`relative p-3 border-2 rounded-xl cursor-pointer text-sm font-bold text-center transition-colors duration-200 select-none ${i.roles.includes(H)?"bg-blue-50 border-brand-blue text-brand-blue dark:bg-blue-900/20 dark:border-blue-500 dark:text-blue-300 shadow-sm":"bg-white border-gray-100 text-gray-500 hover:border-gray-300 dark:bg-[#1f2128] dark:border-gray-700 dark:text-gray-400"}`,children:[H,i.roles.includes(H)&&e.jsx("div",{className:"absolute top-1 right-1 text-brand-blue",children:e.jsx(Ge,{size:10,strokeWidth:4})})]},H))}),e.jsxs("p",{className:"text-[10px] text-gray-400 text-center px-4 leading-tight",children:["By completing setup, you agree to our ",e.jsx("button",{onClick:()=>R(!0),className:"underline hover:text-brand-blue mx-1",children:"Terms of Service"})," and ",e.jsx("button",{onClick:()=>R(!0),className:"underline hover:text-brand-blue mx-1",children:"Privacy Policy"}),"."]}),e.jsx("button",{className:"w-full bg-green-600 text-white py-3.5 rounded-xl font-bold mt-2 hover:bg-green-700 transition-colors flex justify-center items-center gap-2 disabled:opacity-50",onClick:he,disabled:m,children:m?e.jsx(oe,{className:"animate-spin"}):"Complete Setup"}),e.jsx("button",{className:"w-full text-gray-400 text-xs hover:text-gray-600 transition-colors",onClick:()=>o(2),children:"Back to Personal Info"})]})]})]},a)]})}),e.jsx("div",{className:"absolute bottom-6 z-20",children:e.jsxs("button",{onClick:()=>R(!0),className:"text-xs text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 transition-colors flex items-center gap-2 opacity-80 hover:opacity-100 backdrop-blur-sm px-3 py-1.5 rounded-full",children:[e.jsx(ps,{size:14})," Legal Center & Terms"]})}),f&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col border border-gray-200 dark:border-gray-700 relative animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(ps,{size:20,className:"text-brand-blue"})," Legal Center"]}),e.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(pe,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto relative",children:e.jsx(Za,{isEmbedded:!0})})]})})]})}function yn({rating:t=0,setRating:s,interactive:l=!1,size:n=16}){const[d,o]=r.useState(0);return e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(a=>e.jsx(et,{size:n,className:`transition-colors ${l?"cursor-pointer":""} ${(l&&d||t)>=a?"fill-yellow-400 text-yellow-400":"text-gray-300 dark:text-gray-600"}`,fill:(l&&d||t)>=a?"currentColor":"none",onMouseEnter:()=>l&&o(a),onMouseLeave:()=>l&&o(0),onClick:()=>l&&s(a)},a))})}function Ka(t,s){const[l,n]=r.useState([]),[d,o]=r.useState([]),[a,b]=r.useState({followersCount:0,followingCount:0}),[x,g]=r.useState(!0);r.useEffect(()=>{if(!t){g(!1);return}const N=le(O,te(t).following),j=le(O,te(t).followers),k=Q(O,te(t).socialStats),E=fe(ye(N,Ae("timestamp","desc")),f=>{const R=f.docs.map(z=>({odId:z.id,...z.data()}));n(R)},f=>console.error("Following listener error:",f)),C=fe(ye(j,Ae("timestamp","desc")),f=>{const R=f.docs.map(z=>({odId:z.id,...z.data()}));o(R)},f=>console.error("Followers listener error:",f)),h=fe(k,f=>{f.exists()&&b(f.data()),g(!1)});return()=>{E(),C(),h()}},[t]);const m=r.useCallback(N=>l.some(j=>j.odId===N),[l]),u=r.useCallback(async(N,j)=>{if(!t||!N||t===N)return;const k=Qt(O),E=Q(O,te(t).following,N);k.set(E,{displayName:(j==null?void 0:j.displayName)||(j==null?void 0:j.firstName)||"User",photoURL:(j==null?void 0:j.photoURL)||null,role:(j==null?void 0:j.activeProfileRole)||"User",timestamp:ue()});const C=Q(O,te(N).followers,t);k.set(C,{displayName:(s==null?void 0:s.displayName)||`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"User",photoURL:(s==null?void 0:s.photoURL)||null,role:(s==null?void 0:s.activeProfileRole)||"User",timestamp:ue()});const h=Q(O,te(t).socialStats);k.set(h,{followingCount:De(1)},{merge:!0});const f=Q(O,te(N).socialStats);k.set(f,{followersCount:De(1)},{merge:!0});const R=Q(le(O,te(N).notifications));k.set(R,{type:"follow",fromUserId:t,fromUserName:(s==null?void 0:s.displayName)||`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"Someone",fromUserPhoto:(s==null?void 0:s.photoURL)||null,message:"started following you",read:!1,timestamp:ue()});try{return await k.commit(),{success:!0}}catch(z){return console.error("Follow error:",z),{success:!1,error:z}}},[t,s]),i=r.useCallback(async N=>{if(!t||!N)return;const j=Qt(O),k=Q(O,te(t).following,N);j.delete(k);const E=Q(O,te(N).followers,t);j.delete(E);const C=Q(O,te(t).socialStats);j.set(C,{followingCount:De(-1)},{merge:!0});const h=Q(O,te(N).socialStats);j.set(h,{followersCount:De(-1)},{merge:!0});try{return await j.commit(),{success:!0}}catch(f){return console.error("Unfollow error:",f),{success:!1,error:f}}},[t]),p=r.useCallback(async(N,j)=>m(N)?i(N):u(N,j),[m,u,i]),c=r.useCallback(async N=>{try{const j=await yt(Q(O,te(N).socialStats));return j.exists()?j.data():{followersCount:0,followingCount:0}}catch(j){return console.error("Get stats error:",j),{followersCount:0,followingCount:0}}},[]),y=r.useCallback(()=>l.map(N=>N.odId),[l]);return{following:l,followers:d,stats:a,loading:x,isFollowing:m,followUser:u,unfollowUser:i,toggleFollow:p,getUserStats:c,getFollowingIds:y}}function jn(t){const[s,l]=r.useState({followersCount:0,followingCount:0}),[n,d]=r.useState(!0);return r.useEffect(()=>{if(!t){d(!1);return}const o=Q(O,te(t).socialStats),a=fe(o,b=>{b.exists()&&l(b.data()),d(!1)});return()=>a()},[t]),{stats:s,loading:n}}function qs({isFollowing:t,onToggle:s,size:l="md",variant:n="default",disabled:d=!1,showIcon:o=!0,className:a=""}){const[b,x]=r.useState(!1),[g,m]=r.useState(!1),u=async k=>{if(k.stopPropagation(),!(d||b)){x(!0);try{await s()}catch(E){console.error("Follow toggle error:",E)}x(!1)}},i={sm:"px-3 py-1 text-xs",md:"px-4 py-1.5 text-sm",lg:"px-6 py-2 text-base"},p={sm:12,md:14,lg:16},c=()=>t?n==="outline"||n==="minimal"?g?"border-red-300 text-red-500 hover:bg-red-50 dark:border-red-800 dark:hover:bg-red-900/20":"border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300":g?"bg-red-500 text-white hover:bg-red-600":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200":n==="outline"?"border-brand-blue text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20":n==="minimal"?"text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20":"bg-brand-blue text-white hover:bg-blue-600",y=`
        font-semibold rounded-full transition-all duration-200 
        flex items-center justify-center gap-1.5
        disabled:opacity-50 disabled:cursor-not-allowed
        ${n==="outline"?"border-2 bg-transparent":""}
        ${n==="minimal"?"bg-transparent":""}
        ${i[l]}
        ${c()}
        ${a}
    `,N=()=>b?e.jsx(oe,{className:"animate-spin",size:p[l]}):t?g?e.jsx(pr,{size:p[l]}):e.jsx(fs,{size:p[l]}):e.jsx(St,{size:p[l]}),j=()=>t?g?"Unfollow":"Following":"Follow";return e.jsx(ce.button,{whileHover:{scale:d?1:1.02},whileTap:{scale:d?1:.98},className:y,onClick:u,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),disabled:d||b,children:e.jsx(Ve,{mode:"wait",children:e.jsxs(ce.span,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},transition:{duration:.15},className:"flex items-center gap-1.5",children:[o&&N(),e.jsx("span",{children:j()})]},`${t}-${g}`)})})}const Qe={FOLLOWERS:"followers",FOLLOWING:"following"};function vn({userId:t,userName:s,initialTab:l=Qe.FOLLOWERS,currentUser:n,currentUserData:d,isFollowing:o,toggleFollow:a,onClose:b,openPublicProfile:x}){const[g,m]=r.useState(l),[u,i]=r.useState([]),[p,c]=r.useState([]),[y,N]=r.useState(!0),[j,k]=r.useState("");r.useEffect(()=>{if(!t)return;N(!0);const z=le(O,te(t).followers),I=ye(z,Ae("timestamp","desc"),Ze(100)),S=fe(I,w=>{const v=w.docs.map($=>({odId:$.id,userId:$.id,...$.data()}));i(v),N(!1)},w=>{console.error("Followers fetch error:",w),N(!1)});return()=>S()},[t]),r.useEffect(()=>{if(!t)return;const z=le(O,te(t).following),I=ye(z,Ae("timestamp","desc"),Ze(100)),S=fe(I,w=>{const v=w.docs.map($=>({odId:$.id,userId:$.id,...$.data()}));c(v)},w=>{console.error("Following fetch error:",w)});return()=>S()},[t]);const E=g===Qe.FOLLOWERS?u:p,C=j.trim()?E.filter(z=>{var I;return(I=z.displayName)==null?void 0:I.toLowerCase().includes(j.toLowerCase())}):E,h=t===(n==null?void 0:n.uid),f=z=>{x&&(x(z),b())},R=async z=>{a&&await a(z.userId,{displayName:z.displayName,photoURL:z.photoURL,role:z.role})};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs(ce.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:s||"User"}),e.jsx("button",{onClick:b,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(pe,{size:20})})]}),e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-xl p-1",children:[e.jsxs("button",{onClick:()=>m(Qe.FOLLOWERS),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-all ${g===Qe.FOLLOWERS?"bg-white dark:bg-gray-700 shadow-sm text-brand-blue":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:[e.jsx(Fe,{size:16}),e.jsx("span",{children:"Followers"}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${g===Qe.FOLLOWERS?"bg-brand-blue/10 text-brand-blue":"bg-gray-200 dark:bg-gray-600"}`,children:u.length})]}),e.jsxs("button",{onClick:()=>m(Qe.FOLLOWING),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-all ${g===Qe.FOLLOWING?"bg-white dark:bg-gray-700 shadow-sm text-brand-blue":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:[e.jsx(fs,{size:16}),e.jsx("span",{children:"Following"}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${g===Qe.FOLLOWING?"bg-brand-blue/10 text-brand-blue":"bg-gray-200 dark:bg-gray-600"}`,children:p.length})]})]})]}),E.length>5&&e.jsx("div",{className:"px-4 py-3 border-b dark:border-gray-700 shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Be,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search...",value:j,onChange:z=>k(z.target.value),className:"w-full pl-9 pr-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white transition"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:y?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(oe,{className:"animate-spin text-brand-blue mb-2",size:28}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading..."})]}):C.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4",children:g===Qe.FOLLOWERS?e.jsx(Fe,{size:24,className:"text-gray-400"}):e.jsx(fs,{size:24,className:"text-gray-400"})}),e.jsx("p",{className:"text-gray-500 text-center",children:j?`No results for "${j}"`:g===Qe.FOLLOWERS?h?"You don't have any followers yet":"No followers yet":h?"You're not following anyone yet":"Not following anyone yet"}),!j&&g===Qe.FOLLOWING&&h&&e.jsx("p",{className:"text-xs text-gray-400 mt-2 text-center",children:"Find artists and creators to follow in the feed!"})]}):e.jsx(Ve,{mode:"popLayout",children:C.map((z,I)=>e.jsx(Nn,{user:z,index:I,currentUserId:n==null?void 0:n.uid,isFollowingUser:o==null?void 0:o(z.userId),onToggleFollow:()=>R(z),onUserClick:()=>f(z.userId)},z.userId))})})]})})}function Nn({user:t,index:s,currentUserId:l,isFollowingUser:n,onToggleFollow:d,onUserClick:o}){const a=t.userId===l;return e.jsxs(ce.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:-10},transition:{delay:s*.03},className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition border-b dark:border-gray-700/50 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 cursor-pointer",onClick:o,children:[e.jsx(mt,{src:t.photoURL,name:t.displayName,size:"md"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm dark:text-white truncate hover:text-brand-blue transition",children:t.displayName}),t.role&&e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.role})]})]}),!a&&e.jsx(qs,{isFollowing:n,onToggle:d,size:"sm",variant:"outline"}),a&&e.jsx("span",{className:"text-xs text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded-full",children:"You"})]})}function kn({followersCount:t=0,followingCount:s=0,onFollowersClick:l,onFollowingClick:n,size:d="md"}){const o={sm:"text-xs gap-3",md:"text-sm gap-4",lg:"text-base gap-5"},a={sm:"text-sm",md:"text-base",lg:"text-lg"};return e.jsxs("div",{className:`flex items-center ${o[d]}`,children:[e.jsxs("button",{onClick:l,className:"flex items-center gap-1 hover:text-brand-blue transition group",children:[e.jsx("span",{className:`font-bold dark:text-white group-hover:text-brand-blue ${a[d]}`,children:t.toLocaleString()}),e.jsx("span",{className:"text-gray-500",children:t===1?"Follower":"Followers"})]}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"•"}),e.jsxs("button",{onClick:n,className:"flex items-center gap-1 hover:text-brand-blue transition group",children:[e.jsx("span",{className:`font-bold dark:text-white group-hover:text-brand-blue ${a[d]}`,children:s.toLocaleString()}),e.jsx("span",{className:"text-gray-500",children:"Following"})]})]})}function wn({userId:t,currentUser:s,currentUserData:l,onClose:n,onMessage:d}){var S,w,v,$,B;const[o,a]=r.useState(null),[b,x]=r.useState(!0),[g,m]=r.useState(null),[u,i]=r.useState(!1),[p,c]=r.useState(!1),[y,N]=r.useState("followers"),j=(s==null?void 0:s.uid)===t,{uploadImage:k}=Oa(),{isFollowing:E,toggleFollow:C}=Ka(s==null?void 0:s.uid,l),{stats:h}=jn(t),f=(M="followers")=>{N(M),c(!0)},R=async()=>{try{const M=Q(O,te(t).userPublicProfile),T=await yt(M);if(T.exists())a(T.data());else{const P=Q(O,te(t).userProfile),A=await yt(P);A.exists()?a(A.data()):m("Profile not found or is private.")}}catch(M){console.error("Failed to load profile:",M),m("Unable to load profile. Please try again later.")}finally{x(!1)}};r.useEffect(()=>{t&&R()},[t]);const z=async M=>{const T=M.target.files[0];if(!(!T||!j)){i(!0);try{const P=await k(T,`artifacts/${t}/images/banners`);P&&(await be(Q(O,te(t).userPublicProfile),{bannerURL:P}),a(A=>({...A,bannerURL:P})))}catch(P){console.error("Banner upload failed:",P),alert("Failed to upload banner.")}i(!1)}};if(!t)return null;const I=()=>e.jsxs("div",{className:"p-8 flex flex-col items-center space-y-6 animate-pulse",children:[e.jsx("div",{className:"h-40 w-full bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-28 w-28 bg-gray-300 dark:bg-gray-600 rounded-full -mt-20 border-4 border-white dark:border-dark-card"}),e.jsx("div",{className:"h-6 w-1/2 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 w-1/3 bg-gray-200 dark:bg-gray-700 rounded"})]});return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] border border-gray-200 dark:border-gray-700",onClick:M=>M.stopPropagation(),children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 z-30 p-2 bg-black/30 hover:bg-black/50 text-white rounded-full transition-colors backdrop-blur-md",children:e.jsx(pe,{size:20})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative",children:b?e.jsx(I,{}):g||!o?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-12 text-gray-500",children:[e.jsx(ht,{size:48,className:"text-yellow-500 mb-4 opacity-80"}),e.jsx("h3",{className:"text-xl font-bold dark:text-gray-200 mb-2",children:"Profile Unavailable"}),e.jsx("p",{className:"text-sm text-center max-w-xs",children:g||"This user's profile information could not be retrieved."}),e.jsx("button",{onClick:n,className:"mt-6 px-6 py-2 bg-gray-200 dark:bg-gray-700 rounded-full font-bold text-sm hover:bg-gray-300 transition",children:"Close"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-48 relative bg-gray-800 group",children:[o.bannerURL?e.jsx("img",{src:o.bannerURL,alt:"Cover",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-r from-brand-blue to-purple-600",children:e.jsx("div",{className:"absolute inset-0 opacity-30 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"})}),j&&e.jsxs("label",{className:"absolute top-4 left-4 cursor-pointer bg-black/40 hover:bg-black/60 text-white px-3 py-1.5 rounded-lg text-xs font-bold backdrop-blur-md transition-all flex items-center gap-2 border border-white/10",children:[u?e.jsx(oe,{size:14,className:"animate-spin"}):e.jsx(Je,{size:14}),u?"Uploading...":"Edit Cover",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:z,disabled:u})]}),e.jsxs("div",{className:"absolute bottom-4 right-6 flex gap-3 opacity-90",children:[o.rate>0&&e.jsxs("span",{className:"bg-black/60 backdrop-blur-md text-white text-xs font-bold px-3 py-1 rounded-full border border-white/10 flex items-center gap-1 shadow-sm",children:[e.jsx($e,{size:12})," $",o.rate,"/hr"]}),o.city&&e.jsxs("span",{className:"bg-black/60 backdrop-blur-md text-white text-xs font-bold px-3 py-1 rounded-full border border-white/10 flex items-center gap-1 shadow-sm",children:[e.jsx(Le,{size:12})," ",o.city,", ",o.state]})]})]}),e.jsxs("div",{className:"px-8 pb-8 relative",children:[e.jsxs("div",{className:"flex justify-between items-end -mt-14 mb-6",children:[e.jsx("div",{className:"relative z-10 group",children:e.jsx("div",{className:"h-32 w-32 rounded-full border-[5px] border-white dark:border-[#1f2128] bg-gray-200 dark:bg-gray-700 overflow-hidden shadow-xl",children:o.photoURL?e.jsx("img",{src:o.photoURL,alt:"Profile",className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400",children:e.jsx(qe,{size:48})})})}),s&&!j&&e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(qs,{isFollowing:E(t),onToggle:()=>{var M;return C(t,{displayName:`${o.firstName||""} ${o.lastName||""}`.trim(),photoURL:o.photoURL,role:((M=o.accountTypes)==null?void 0:M[0])||"User"})},size:"md"}),e.jsxs("button",{onClick:()=>d(t,`${o.firstName} ${o.lastName}`),className:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 px-5 py-2.5 rounded-xl font-bold text-sm hover:bg-gray-200 dark:hover:bg-gray-700 transition flex items-center gap-2 border dark:border-gray-700",children:[e.jsx(Te,{size:18})," Message"]})]}),j&&e.jsx("div",{className:"mb-2 px-3 py-1.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-bold rounded-lg border border-green-200 dark:border-green-800",children:"Public View Mode"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-extrabold dark:text-white flex items-center gap-2 mb-2",children:[o.firstName||"User"," ",o.lastName||"",o.isVerified&&e.jsx(Pe,{size:22,className:"text-blue-500 fill-blue-500 text-white"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-gray-500 dark:text-gray-400 font-medium mb-4",children:(o.accountTypes||["Creative"]).map((M,T)=>e.jsx("span",{className:"flex items-center gap-1 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full text-xs font-bold",children:M},T))}),e.jsx(kn,{followersCount:h.followersCount||0,followingCount:h.followingCount||0,onFollowersClick:()=>f("followers"),onFollowingClick:()=>f("following"),size:"md"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 py-6 border-y dark:border-gray-800 mb-8",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:"Rating"}),e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-1",children:[e.jsx("span",{className:"text-xl font-bold dark:text-white",children:o.rating||"New"}),o.rating>0&&e.jsx(yn,{rating:o.rating,size:14})]})]}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:"Experience"}),e.jsxs("div",{className:"text-xl font-bold dark:text-white",children:[o.yearsExp||"1+"," ",e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Yrs"})]})]}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:"Response"}),e.jsxs("div",{className:"text-xl font-bold dark:text-white",children:["~1 ",e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Hr"})]})]}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:"Bookings"}),e.jsx("div",{className:"text-xl font-bold dark:text-white",children:o.completedJobs||0})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(qe,{size:14})," About"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-[#252830] p-5 rounded-xl border dark:border-gray-800",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed text-sm whitespace-pre-line",children:o.bio||"No biography provided yet."})})]}),(((S=o.genres)==null?void 0:S.length)>0||((w=o.instruments)==null?void 0:w.length)>0)&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(lt,{size:14})," Sound Profile"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(v=o.genres)==null?void 0:v.map(M=>e.jsx("span",{className:"px-3 py-1.5 bg-purple-50 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300 rounded-lg text-xs font-bold border border-purple-100 dark:border-purple-800",children:M},M)),($=o.instruments)==null?void 0:$.map(M=>e.jsx("span",{className:"px-3 py-1.5 bg-blue-50 dark:bg-blue-900/20 text-brand-blue dark:text-blue-300 rounded-lg text-xs font-bold border border-blue-100 dark:border-blue-800",children:M},M))]})]}),((B=o.equipmentList)==null?void 0:B.length)>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(rt,{size:14})," Select Gear"]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#252830] rounded-xl p-4 border dark:border-gray-800",children:[e.jsx("ul",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-600 dark:text-gray-400",children:o.equipmentList.slice(0,10).map((M,T)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ve,{size:14,className:"text-brand-blue shrink-0 mt-0.5"}),e.jsx("span",{className:"truncate",children:M})]},T))}),o.equipmentList.length>10&&e.jsx("div",{className:"mt-3 pt-3 border-t dark:border-gray-700 text-center",children:e.jsxs("span",{className:"text-xs text-gray-400 font-medium italic",children:["+",o.equipmentList.length-10," more items available"]})})]})]})]})]})})]}),p&&e.jsx(vn,{userId:t,userName:`${(o==null?void 0:o.firstName)||""} ${(o==null?void 0:o.lastName)||""}`.trim()||"User",initialTab:y,currentUser:s,currentUserData:l,isFollowing:E,toggleFollow:C,onClose:()=>c(!1),openPublicProfile:M=>{c(!1)}})]})}const Sn=()=>{const t=new Date().getHours();return t<12?{text:"Good morning",emoji:"☀️"}:t<17?{text:"Good afternoon",emoji:"🌤️"}:t<21?{text:"Good evening",emoji:"🌅"}:{text:"Good night",emoji:"🌙"}},Cn=({value:t,duration:s=1e3})=>{const[l,n]=r.useState(0);return r.useEffect(()=>{let d;const o=a=>{d||(d=a);const b=Math.min((a-d)/s,1);n(Math.floor(b*t)),b<1&&requestAnimationFrame(o)};requestAnimationFrame(o)},[t,s]),e.jsx("span",{children:l.toLocaleString()})},Bt=({title:t,value:s,icon:l,gradient:n,onClick:d,trend:o,trendUp:a})=>e.jsxs(ce.div,{whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},onClick:d,className:`relative p-5 rounded-[1.25rem] cursor-pointer overflow-hidden group ${n}`,children:[e.jsxs("div",{className:"absolute inset-0 opacity-30",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/20 rounded-full blur-2xl transform translate-x-16 -translate-y-16 group-hover:scale-150 transition-transform duration-700"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full blur-xl transform -translate-x-8 translate-y-8"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"p-2.5 bg-white/20 backdrop-blur-sm rounded-xl",children:l}),o&&e.jsxs("div",{className:`flex items-center gap-1 text-xs font-bold ${a?"text-green-300":"text-red-300"}`,children:[e.jsx(vr,{size:14,className:a?"":"rotate-90"}),o]})]}),e.jsx("div",{className:"text-3xl font-black text-white mb-1",children:e.jsx(Cn,{value:s})}),e.jsx("div",{className:"text-white/80 text-sm font-medium",children:t})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),gs=({icon:t,label:s,description:l,onClick:n,color:d})=>e.jsx(ce.button,{whileHover:{scale:1.01,x:4},whileTap:{scale:.99},onClick:n,className:"w-full text-left px-4 py-3.5 rounded-xl border dark:border-gray-700/50 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-[#1f2128] hover:shadow-lg dark:hover:shadow-black/20 transition-all duration-300 group",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2.5 rounded-xl ${d} group-hover:scale-110 transition-transform duration-300`,children:t}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-semibold dark:text-white block",children:s}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:l})]}),e.jsx(At,{size:16,className:"text-gray-400 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-300"})]})}),zn=({notification:t,onClick:s,formatTime:l})=>{const n=a=>{switch(a){case"follow":return{icon:e.jsx(Fe,{size:14}),color:"bg-blue-500"};case"like":return{icon:e.jsx(ya,{size:14}),color:"bg-red-500"};case"comment":return{icon:e.jsx(Te,{size:14}),color:"bg-green-500"};case"mention":return{icon:e.jsx(za,{size:14}),color:"bg-purple-500"};case"booking":return{icon:e.jsx(Re,{size:14}),color:"bg-amber-500"};default:return{icon:e.jsx(wt,{size:14}),color:"bg-gray-500"}}},{icon:d,color:o}=n(t.type);return e.jsx(ce.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},whileHover:{x:4,backgroundColor:"rgba(59, 130, 246, 0.05)"},onClick:s,className:`p-4 cursor-pointer transition-colors duration-200 ${t.read?"":"bg-gradient-to-r from-blue-50/50 to-transparent dark:from-blue-900/10"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`${o} p-2 rounded-full text-white shrink-0`,children:d}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm dark:text-gray-200",children:[e.jsx("span",{className:"font-semibold",children:t.fromUserName})," ",e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.message})]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(Ie,{size:10}),l(t.timestamp)]})]}),!t.read&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse shrink-0 mt-2"})]})})};function En({user:t,userData:s,setActiveTab:l,bookingCount:n=0,subProfiles:d={},tokenBalance:o=0}){var I,S;const[a,b]=r.useState([]),[x,g]=r.useState(null),m=Sn(),{notifications:u,unreadCount:i}=Ga(t==null?void 0:t.uid),p=(I=s==null?void 0:s.accountTypes)==null?void 0:I.includes("Studio"),c=((S=d==null?void 0:d.Studio)==null?void 0:S.rooms)||[],y=(s==null?void 0:s.profileViews)||0,N=(s==null?void 0:s.accountTypes)||[];let j=0,k=0;N.forEach(w=>{const v=(d==null?void 0:d[w])||{},$=Dt[w]||[];if($.length===0)return;const B=$.filter(T=>!T.isToggle&&T.type!=="list").length||1,M=$.filter(T=>!T.isToggle&&T.type!=="list"&&v[T.key]&&v[T.key].length).length;j+=M/B,k++});const E=k>0?Math.round(j/k*100):100,C=E<60,h=r.useMemo(()=>Ns(),[]),f=r.useMemo(()=>t!=null&&t.uid&&h?{userId:t.uid}:"skip",[t==null?void 0:t.uid,h]),R=Sa(Fa.conversations.getConversations,f);r.useEffect(()=>{if(!R){b([]);return}const w=R.map(v=>({uid:v.otherUserId||v.chatId,name:v.chatName||"Unknown",lastMessage:v.lastMessage||"",timestamp:v.lastMessageTime||0,isMe:v.lastSenderId===t.uid,photo:v.chatPhoto})).sort((v,$)=>$.timestamp-v.timestamp).slice(0,4);b(w)},[R,t==null?void 0:t.uid]),r.useEffect(()=>{const w=ye(le(O,`artifacts/${re}/public/data/market_items`),Ae("timestamp","desc"),Ze(1)),v=fe(w,$=>{$.empty||g({id:$.docs[0].id,...$.docs[0].data()})});return()=>v()},[]);const z=w=>{if(!w)return"Just now";let v;if(typeof w.toMillis=="function")v=new Date(w.toMillis());else if(typeof w=="number")v=new Date(w);else if(w instanceof Date)v=w;else return"Just now";if(isNaN(v.getTime()))return"Just now";const B=new Date-v,M=Math.floor(B/6e4),T=Math.floor(M/60);return M<1?"Just now":M<60?`${M}m ago`:T<24?`${T}h ago`:v.toLocaleDateString()};return e.jsxs("div",{className:"min-h-screen pb-24 px-4 md:px-6 pt-4 md:pt-6",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-3xl md:rounded-[2rem] shadow-2xl max-w-7xl mx-auto",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-blue via-purple-600 to-pink-500 opacity-90"}),e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse"}),e.jsx("div",{className:"absolute top-0 right-1/4 w-96 h-96 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute bottom-0 left-1/3 w-96 h-96 bg-pink-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse",style:{animationDelay:"2s"}})]}),e.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px)",backgroundSize:"50px 50px"}}),e.jsxs("div",{className:"relative z-10 px-5 md:px-8 py-8 md:py-12",children:[e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"flex flex-col md:flex-row justify-between md:items-end gap-6 mb-10",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:m.emoji}),e.jsx("span",{className:"text-white/80 text-lg font-medium",children:m.text})]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-black text-white tracking-tight",children:(s==null?void 0:s.firstName)||"Creator"}),e.jsx("p",{className:"text-white/60 mt-2 text-lg",children:"Your creative command center"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ce.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-md border border-white/20 px-5 py-2.5 rounded-full flex items-center gap-2 text-white",children:[e.jsx(Ie,{size:16,className:"text-white/70"}),e.jsx("span",{className:"text-sm font-medium",children:new Date().toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})})]}),e.jsxs(ce.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>l("feed"),className:"relative bg-white text-gray-900 px-5 py-2.5 rounded-full font-bold text-sm flex items-center gap-2 shadow-lg hover:shadow-xl transition-shadow",children:[e.jsx(wt,{size:16}),i>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center animate-bounce",children:i})]})]})]}),e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Bt,{title:"SeshFx Balance",value:o,icon:e.jsx(Oe,{size:20,className:"text-white",fill:"currentColor"}),gradient:"bg-gradient-to-br from-amber-500/90 to-orange-600/90 backdrop-blur-sm",onClick:()=>l("payments"),trend:"+12%",trendUp:!0}),e.jsx(Bt,{title:"Pending Bookings",value:n,icon:e.jsx(Re,{size:20,className:"text-white"}),gradient:"bg-gradient-to-br from-blue-500/90 to-indigo-600/90 backdrop-blur-sm",onClick:()=>l("bookings")}),e.jsx(Bt,{title:"Active Chats",value:a.length,icon:e.jsx(Te,{size:20,className:"text-white"}),gradient:"bg-gradient-to-br from-emerald-500/90 to-teal-600/90 backdrop-blur-sm",onClick:()=>l("messages")}),e.jsx(Bt,{title:"Profile Views",value:y,icon:e.jsx(ss,{size:20,className:"text-white"}),gradient:"bg-gradient-to-br from-pink-500/90 to-rose-600/90 backdrop-blur-sm",onClick:()=>l("profile"),trend:"+8%",trendUp:!0})]})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto mt-6 md:mt-8 relative z-20",children:[e.jsx(Ve,{children:C&&e.jsxs(ce.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-6 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border border-amber-200 dark:border-amber-800/50 rounded-[1.25rem] p-5 flex flex-col md:flex-row items-start md:items-center justify-between gap-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-400 to-orange-500 p-3 rounded-xl text-white shadow-lg",children:e.jsx(fr,{size:24})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-amber-800 dark:text-amber-300 flex items-center gap-2",children:["Complete Your Profile",e.jsxs("span",{className:"text-sm font-normal bg-amber-200 dark:bg-amber-800 px-2 py-0.5 rounded-full",children:[E,"%"]})]}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400",children:"A complete profile increases your visibility and booking chances"})]})]}),e.jsxs(ce.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>l("profile"),className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-bold px-6 py-2.5 rounded-xl transition shadow-lg flex items-center gap-2",children:[e.jsx(ys,{size:16}),"Complete Now"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-[#1f2128] rounded-[1.25rem] border dark:border-gray-800 overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-800 flex justify-between items-center bg-gradient-to-r from-gray-50 to-white dark:from-[#23262f] dark:to-[#1f2128]",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(ka,{size:16,className:"text-blue-600 dark:text-blue-400"})}),"Activity Feed"]}),i>0&&e.jsxs("span",{className:"bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs px-3 py-1 rounded-full font-bold animate-pulse shadow-lg",children:[i," New"]})]}),e.jsx("div",{className:"divide-y dark:divide-gray-800",children:!u||u.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700 rounded-[1.25rem] flex items-center justify-center mx-auto mb-4",children:e.jsx(ys,{size:28,className:"text-gray-400"})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"All caught up!"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"No new notifications"})]}):u.slice(0,5).map((w,v)=>e.jsx(zn,{notification:w,onClick:()=>l("feed"),formatTime:z},w.id||v))}),(u==null?void 0:u.length)>5&&e.jsx("div",{className:"p-4 border-t dark:border-gray-800 bg-gray-50 dark:bg-[#1a1c23]",children:e.jsx("button",{onClick:()=>l("feed"),className:"w-full text-center text-sm text-brand-blue font-semibold hover:underline",children:"View All Activity →"})})]}),p&&e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white dark:bg-[#1f2128] rounded-[1.25rem] border dark:border-gray-800 overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-800 flex justify-between items-center bg-gradient-to-r from-purple-50 to-white dark:from-purple-900/10 dark:to-[#1f2128]",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(js,{size:16,className:"text-purple-600 dark:text-purple-400"})}),"Studio Status"]}),e.jsxs("button",{onClick:()=>l("studio-ops"),className:"text-sm text-purple-600 dark:text-purple-400 hover:underline flex items-center gap-1 font-medium",children:["Manage ",e.jsx(At,{size:14})]})]}),e.jsx("div",{className:"p-5",children:c.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-[#1a1c23]",children:[e.jsx(Ca,{size:32,className:"mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-gray-500 mb-3",children:"No rooms configured yet"}),e.jsx("button",{onClick:()=>l("studio-ops"),className:"text-purple-600 font-bold hover:underline",children:"+ Add Your First Room"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:c.map((w,v)=>{var $;return e.jsxs(ce.div,{whileHover:{scale:1.02},className:"bg-gradient-to-br from-gray-50 to-gray-100 dark:from-[#1a1c23] dark:to-[#23262f] p-4 rounded-xl border dark:border-gray-700/50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-bold dark:text-white",children:w.name}),e.jsxs("span",{className:`text-xs px-2.5 py-1 rounded-full font-bold flex items-center gap-1 ${w.active?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400"}`,children:[w.active?e.jsx(ve,{size:10}):e.jsx(ht,{size:10}),w.active?"Active":"Maint."]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:[(($=w.equipment)==null?void 0:$.length)||0," items"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"font-bold text-green-600 dark:text-green-400",children:["$",w.rate,"/hr"]})]})]},v)})})})]}),e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white dark:bg-[#1f2128] rounded-[1.25rem] border dark:border-gray-800 overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-800 flex justify-between items-center bg-gradient-to-r from-emerald-50 to-white dark:from-emerald-900/10 dark:to-[#1f2128]",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg",children:e.jsx(Te,{size:16,className:"text-emerald-600 dark:text-emerald-400"})}),"Recent Messages"]}),e.jsx("button",{onClick:()=>l("messages"),className:"text-sm text-emerald-600 dark:text-emerald-400 hover:underline font-medium",children:"View All"})]}),e.jsx("div",{className:"p-4 space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx(Te,{size:32,className:"mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Start a conversation!"})]}):a.map((w,v)=>{var $;return e.jsxs(ce.div,{whileHover:{x:4,backgroundColor:"rgba(16, 185, 129, 0.05)"},onClick:()=>l("messages"),className:"flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all",children:[e.jsxs("div",{className:"relative",children:[w.photo?e.jsx("img",{src:w.photo,className:"h-10 w-10 rounded-full object-cover"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-white font-bold",children:(($=w.name)==null?void 0:$.charAt(0))||"?"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white dark:border-[#1f2128] rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[e.jsx("span",{className:"font-semibold dark:text-white truncate",children:w.name||"Unknown User"}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0 ml-2",children:new Date(w.timestamp).toLocaleDateString()})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:[w.isMe&&e.jsx("span",{className:"text-gray-400",children:"You: "}),w.lastMessage]})]})]},w.uid+v)})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-[#1f2128] rounded-[1.25rem] border dark:border-gray-800 p-5 shadow-xl",children:[e.jsxs("h3",{className:"font-bold mb-4 dark:text-white flex items-center gap-2",children:[e.jsx(yr,{size:18,className:"text-orange-500"}),"Quick Actions"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(gs,{icon:e.jsx(as,{size:18,className:"text-blue-600"}),label:"Create Post",description:"Share with your network",onClick:()=>l("feed"),color:"bg-blue-100 dark:bg-blue-900/30"}),e.jsx(gs,{icon:e.jsx(Be,{size:18,className:"text-purple-600"}),label:"Find Talent",description:"Discover collaborators",onClick:()=>l("bookings"),color:"bg-purple-100 dark:bg-purple-900/30"}),e.jsx(gs,{icon:e.jsx(ja,{size:18,className:"text-amber-600"}),label:"Marketplace",description:"Buy & sell gear",onClick:()=>l("marketplace"),color:"bg-amber-100 dark:bg-amber-900/30"})]})]}),e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"relative rounded-[1.25rem] overflow-hidden shadow-xl",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-violet-600 via-purple-600 to-fuchsia-600"}),e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-pink-500/20 rounded-full blur-2xl animate-pulse",style:{animationDelay:"1s"}})]}),e.jsxs("div",{className:"relative z-10 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"bg-white/20 backdrop-blur-sm p-2 rounded-lg",children:e.jsx(Oe,{size:18,className:"text-yellow-300",fill:"currentColor"})}),e.jsx("span",{className:"text-xs font-bold text-yellow-300 uppercase tracking-wider",children:"Trending on SeshFx"})]}),x?e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-black text-xl text-white mb-1 truncate",children:x.title}),e.jsxs("p",{className:"text-white/60 text-sm mb-4",children:["by ",x.author," • ",x.price," Tokens"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-black text-xl text-white mb-1",children:"Discover New Sounds"}),e.jsx("p",{className:"text-white/60 text-sm mb-4",children:"Fresh beats & presets daily"})]}),e.jsxs(ce.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>l("seshfx"),className:"w-full bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all",children:[e.jsx(Ps,{size:16,fill:"currentColor"}),"Visit Store"]})]})]}),e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white dark:bg-[#1f2128] rounded-[1.25rem] border dark:border-gray-800 p-5 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(jr,{size:18,className:"text-amber-500"}),"Profile Health"]}),e.jsxs("span",{className:`text-sm font-bold ${E>=80?"text-green-500":E>=50?"text-amber-500":"text-red-500"}`,children:[E,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-5 p-4 bg-gray-50 dark:bg-[#1a1c23] rounded-xl",children:[e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsxs("svg",{className:"w-16 h-16 transform -rotate-90",children:[e.jsx("circle",{cx:"32",cy:"32",r:"28",stroke:"currentColor",strokeWidth:"6",fill:"none",className:"text-gray-200 dark:text-gray-700"}),e.jsx("circle",{cx:"32",cy:"32",r:"28",stroke:"currentColor",strokeWidth:"6",fill:"none",strokeDasharray:`${E*1.76} 176`,className:E>=80?"text-green-500":E>=50?"text-amber-500":"text-red-500",strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(et,{size:20,className:E>=80?"text-green-500":E>=50?"text-amber-500":"text-red-500",fill:"currentColor"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:E>=80?"Looking Great!":E>=50?"Almost There!":"Needs Work"}),e.jsx("div",{className:"text-xs text-gray-500",children:E<100?"Complete your profile to boost visibility":"Your profile is fully complete"})]})]}),e.jsx("div",{className:"space-y-3",children:((s==null?void 0:s.accountTypes)||[]).map(w=>{const v=(d==null?void 0:d[w])||{},$=Dt[w]||[];if($.length===0)return null;const B=$.filter(P=>!P.isToggle&&P.type!=="list").length||1,M=$.filter(P=>!P.isToggle&&P.type!=="list"&&v[P.key]&&v[P.key].length).length,T=Math.round(M/B*100);return e.jsxs(ce.div,{whileHover:{scale:1.01},onClick:()=>l("profile"),className:"p-3 rounded-xl bg-gray-50 dark:bg-[#1a1c23] cursor-pointer hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium dark:text-gray-300",children:w}),e.jsxs("span",{className:`text-xs font-bold ${T>=80?"text-green-500":T>=50?"text-amber-500":"text-red-500"}`,children:[T,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx(ce.div,{initial:{width:0},animate:{width:`${T}%`},transition:{duration:1,delay:.5},className:`h-full rounded-full ${T>=80?"bg-gradient-to-r from-green-400 to-emerald-500":T>=50?"bg-gradient-to-r from-amber-400 to-orange-500":"bg-gradient-to-r from-red-400 to-rose-500"}`})})]},w)})})]})]})]})]})]})}const Rn="/assets/Fevicon-TMLO4Pj9.png";function ks({audioUrl:t,fileName:s="Audio Track",previewMode:l=!1}){const n=r.useRef(null),d=r.useRef(null),o=r.useRef(null),a=r.useRef(null),b=r.useRef(null),x=r.useRef(null),g=r.useRef(Math.random().toString(36).substr(2,9)),m=r.useRef(null),u=r.useRef(null),i=r.useRef(null),[p,c]=r.useState(!1),[y,N]=r.useState(!1),[j,k]=r.useState(!1),[E,C]=r.useState(!1),[h,f]=r.useState(document.documentElement.classList.contains("dark")),R=r.useRef(h),z={dark:{star:"rgba(255, 255, 255, 0.5)",special:"#3D84ED",wave:"rgba(255, 255, 255, 0.3)"},light:{star:"rgba(0, 0, 0, 0.5)",special:"#2563EB",wave:"rgba(0, 0, 0, 0.2)"}},I=400,S=120,w=80,v=r.useRef({stars:[],avg:0,width:0,height:0,cx:0,cy:0});r.useEffect(()=>{const P=new MutationObserver(A=>{A.forEach(F=>{if(F.attributeName==="class"){const L=document.documentElement.classList.contains("dark");f(L),R.current=L,b.current&&b.current.setOptions({waveColor:L?z.dark.wave:z.light.wave})}})});return P.observe(document.documentElement,{attributes:!0}),()=>P.disconnect()},[]),r.useEffect(()=>{if(!o.current||!a.current)return;const P=h?z.dark:z.light;b.current=tn.create({container:a.current,waveColor:P.wave,progressColor:"#3D84ED",cursorColor:"#3D84ED",barWidth:4,barGap:3,barRadius:3,height:100,responsive:!0,normalize:!0,backend:"MediaElement",media:o.current,minPxPerSec:50,fillParent:!0,interact:!l,cursorWidth:2,barAlign:"bottom"});const A=F=>{F.detail.id!==g.current&&b.current&&b.current.isPlaying()&&b.current.pause()};return window.addEventListener("seshnx-audio-play",A),b.current.on("ready",()=>N(!0)),b.current.on("play",()=>{c(!0),window.dispatchEvent(new CustomEvent("seshnx-audio-play",{detail:{id:g.current}}))}),b.current.on("pause",()=>c(!1)),b.current.on("finish",()=>{c(!1),cancelAnimationFrame(x.current)}),()=>{window.removeEventListener("seshnx-audio-play",A),b.current&&b.current.destroy(),cancelAnimationFrame(x.current)}},[t,l]),r.useEffect(()=>{const P=()=>{if(n.current&&d.current){const{clientWidth:A,clientHeight:F}=n.current;d.current.width=A,d.current.height=F,v.current.width=A,v.current.height=F,v.current.cx=A/2,v.current.cy=F/2,$()}};return window.addEventListener("resize",P),P(),()=>{window.removeEventListener("resize",P),m.current&&m.current.state!=="closed"&&m.current.close()}},[]);const $=()=>{v.current.stars=[];for(let P=0;P<I;P++)v.current.stars.push({x:Math.random()*v.current.width-v.current.cx,y:Math.random()*v.current.height-v.current.cy,z:Math.random()*v.current.width})},B=()=>{if(!(E||j||!o.current))try{const P=window.AudioContext||window.webkitAudioContext;m.current=new P,u.current=m.current.createAnalyser(),u.current.fftSize=2048,i.current=m.current.createMediaElementSource(o.current),i.current.connect(u.current),u.current.connect(m.current.destination),C(!0)}catch(P){console.warn("Audio Context Error:",P)}},M=async P=>{var A;P.stopPropagation(),E||B(),((A=m.current)==null?void 0:A.state)==="suspended"&&await m.current.resume(),b.current&&b.current.playPause(),p||T()},T=()=>{if(!d.current)return;const P=d.current.getContext("2d"),{width:A,height:F,cx:L,cy:W,stars:Z}=v.current;let D=0;if(u.current){const J=u.current.frequencyBinCount,ee=new Uint8Array(J);u.current.getByteFrequencyData(ee);let ne=0;for(let me=0;me<ee.length;me++)ne+=ee[me];D=ne/ee.length}v.current.avg=D,P.clearRect(0,0,A,F);const Y=R.current?z.dark:z.light,q=D>w?D/10:D/30+.5;Z.forEach(J=>{J.z-=q,J.z<=0&&(J.z=A,J.x=Math.random()*A-L,J.y=Math.random()*F-W);const ee=J.x/J.z*A+L,ne=J.y/J.z*F+W,me=(1-J.z/A)*2.5;ee>=0&&ee<=A&&ne>=0&&ne<=F&&(P.fillStyle=D>S?Y.special:Y.star,P.globalAlpha=1-J.z/A,P.beginPath(),P.arc(ee,ne,me,0,Math.PI*2),P.fill(),P.globalAlpha=1)}),b.current&&b.current.isPlaying()&&(x.current=requestAnimationFrame(T))};return e.jsxs("div",{ref:n,className:"relative w-full h-32 rounded-xl overflow-hidden group bg-transparent transition-colors",children:[e.jsx("canvas",{ref:d,className:"w-full h-full absolute inset-0 z-0 pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 z-20 flex flex-col justify-end pointer-events-none",children:e.jsx("div",{ref:a,className:"w-full pointer-events-auto opacity-80 hover:opacity-100 transition-opacity"})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-3 z-30 flex justify-between items-start pointer-events-none",children:[e.jsxs("div",{className:"flex items-center gap-2 text-black dark:text-white/90",children:[e.jsx(lt,{size:16,className:"text-brand-blue"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[200px] shadow-sm",children:s}),l&&e.jsxs("span",{className:"text-[10px] bg-yellow-500 text-black px-2 rounded font-bold flex items-center gap-1",children:[e.jsx(gt,{size:8})," PREVIEW"]})]}),j&&e.jsxs("div",{className:"bg-red-500/80 text-white text-[10px] px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(st,{size:10})," Visuals Disabled"]})]}),e.jsx("div",{className:"absolute bottom-2 left-2 z-30 opacity-50 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.jsx("img",{src:Rn,alt:"SeshNx",className:"w-5 h-5 object-contain"})}),e.jsx("div",{className:`absolute inset-0 z-40 flex items-center justify-center transition-opacity duration-300 pointer-events-none
                ${p?"opacity-0 group-hover:opacity-100 bg-white/20 dark:bg-black/20":"opacity-100 bg-white/10 dark:bg-black/10"}`,children:y?e.jsx("button",{onClick:M,className:"w-14 h-14 bg-white/80 dark:bg-black/40 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/40 text-brand-blue shadow-lg hover:scale-110 transition-transform pointer-events-auto",children:p?e.jsx(Nr,{fill:"currentColor",className:"ml-0.5",size:24}):e.jsx(Ps,{fill:"currentColor",className:"ml-1",size:24})}):e.jsx(oe,{className:"animate-spin text-brand-blue",size:32})}),e.jsx("audio",{ref:o,src:t,crossOrigin:"anonymous",onError:()=>k(!0)})]})}function Pn({post:t,currentUser:s,currentUserData:l,blockedUsers:n,onCountChange:d}){const[o,a]=r.useState([]),[b,x]=r.useState(""),[g,m]=r.useState(!1);r.useEffect(()=>{const p=ye(le(O,`artifacts/${re}/public/data/posts/${t.id}/replies`),Ae("timestamp","asc")),c=fe(p,y=>{const j=y.docs.map(k=>({id:k.id,...k.data()})).filter(k=>!(n!=null&&n.includes(k.userId)));a(j),d(j.length)});return()=>c()},[t.id]);const u=async p=>{var y;if(p.preventDefault(),!b.trim()||!(s!=null&&s.uid))return;m(!0);const c=(l==null?void 0:l.effectiveDisplayName)||(l==null?void 0:l.firstName)||(s==null?void 0:s.displayName)||"User";try{await we(le(O,`artifacts/${re}/public/data/posts/${t.id}/replies`),{text:b,userId:s.uid,displayName:c,userPhoto:(l==null?void 0:l.photoURL)||null,timestamp:ue()}),t.userId!==s.uid&&Ya({targetUserId:t.userId,type:"comment",fromUserId:s.uid,fromUserName:c,fromUserPhoto:l==null?void 0:l.photoURL,postId:t.id,postPreview:(y=t.text)==null?void 0:y.substring(0,50),message:"commented on your post"}),x("")}catch(N){console.error(N)}m(!1)},i=async p=>{if(window.confirm("Delete comment?"))try{await ft(Q(O,`artifacts/${re}/public/data/posts/${t.id}/replies`,p))}catch(c){console.error("Delete comment error:",c)}};return e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] border-t dark:border-gray-700 p-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-4 mb-4 max-h-80 overflow-y-auto custom-scrollbar pr-2",children:[o.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-2",children:"No comments yet. Be the first!"}),o.map(p=>e.jsxs("div",{className:"group flex gap-3 text-sm",children:[e.jsx(mt,{src:p.userPhoto,name:p.displayName,size:"xs",className:"shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card border dark:border-gray-700 p-3 rounded-2xl rounded-tl-none inline-block max-w-full",children:[e.jsxs("div",{className:"flex justify-between items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-bold dark:text-white text-xs truncate",children:p.displayName}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0",children:p.timestamp?new Date(p.timestamp.toMillis()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"..."})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 break-words",children:p.text})]}),e.jsxs("div",{className:"flex gap-3 mt-1 ml-2",children:[e.jsx("button",{className:"text-[10px] font-bold text-gray-500 hover:text-brand-blue transition",children:"Reply"}),p.userId===(s==null?void 0:s.uid)&&e.jsx("button",{onClick:()=>i(p.id),className:"text-[10px] font-bold text-gray-400 hover:text-red-500 transition",children:"Delete"})]})]})]},p.id))]}),e.jsxs("form",{onSubmit:u,className:"flex gap-2",children:[e.jsx(mt,{src:l==null?void 0:l.photoURL,name:(l==null?void 0:l.firstName)||"You",size:"xs",className:"shrink-0 hidden sm:block"}),e.jsx("input",{className:"flex-1 bg-white dark:bg-dark-card border dark:border-gray-600 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition",placeholder:"Write a comment...",value:b,onChange:p=>x(p.target.value)}),e.jsx("button",{type:"submit",disabled:!b.trim()||g,className:"bg-brand-blue text-white p-2 rounded-full hover:bg-blue-600 disabled:opacity-50 transition shadow-sm",children:e.jsx(As,{size:16,className:g?"animate-pulse":""})})]})]})}const An=["👍","❤️","😂","😮","😢","🔥"],Ln=t=>t?t.split(/(\s+)/).map((s,l)=>s.match(/^#\w+/)?e.jsx("span",{className:"text-brand-blue font-bold cursor-pointer hover:underline",children:s},l):s.match(/^@\w+/)?e.jsx("span",{className:"text-purple-600 font-bold cursor-pointer hover:underline",children:s},l):s):null,$n={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},exit:{opacity:0,scale:.95,transition:{duration:.2}}};function Tn({post:t,currentUser:s,currentUserData:l,openPublicProfile:n,onReport:d,isFollowingAuthor:o,onToggleFollow:a}){var T,P,A;const[b,x]=r.useState(!1),[g,m]=r.useState(t.commentCount||0),[u,i]=r.useState(!1),[p,c]=r.useState(!1),[y,N]=r.useState(!1),[j,k]=r.useState(!1),[E,C]=r.useState(!1),h=r.useRef(null),f=r.useRef(null),R=t.userId===(s==null?void 0:s.uid),z=(T=t.reactions)==null?void 0:T[s==null?void 0:s.uid],I=t.reactions?Object.values(t.reactions).reduce((F,L)=>(F[L]=(F[L]||0)+1,F),{}):{},S=Object.values(I).reduce((F,L)=>F+L,0);r.useEffect(()=>{if(!(s!=null&&s.uid))return;(async()=>{try{const L=Q(O,te(s.uid).savedPosts,t.id),W=await yt(L);i(W.exists())}catch(L){console.error("Error checking saved status:",L)}})()},[s==null?void 0:s.uid,t.id]),r.useEffect(()=>{const F=L=>{h.current&&!h.current.contains(L.target)&&c(!1),f.current&&!f.current.contains(L.target)&&N(!1)};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[]);const w=async F=>{var W;if(c(!1),!(s!=null&&s.uid))return;const L=Q(O,`artifacts/${re}/public/data/posts/${t.id}`);try{const Z={},D=!!z;z===F?(Z[`reactions.${s.uid}`]=hl(),Z.reactionCount=De(-1)):(Z[`reactions.${s.uid}`]=F,z||(Z.reactionCount=De(1)),!D&&!R&&Ya({targetUserId:t.userId,type:"like",fromUserId:s.uid,fromUserName:(l==null?void 0:l.effectiveDisplayName)||(l==null?void 0:l.firstName)||"Someone",fromUserPhoto:l==null?void 0:l.photoURL,postId:t.id,postPreview:(W=t.text)==null?void 0:W.substring(0,50),message:`reacted ${F} to your post`})),await be(L,Z)}catch(Z){console.error("Reaction failed",Z),X.error("Couldn't add reaction")}},v=async()=>{var F,L;if(!(!(s!=null&&s.uid)||E)){C(!0);try{const W=Q(O,te(s.uid).savedPosts,t.id),Z=Q(O,`artifacts/${re}/public/data/posts/${t.id}`);u?(await ft(W),await be(Z,{saveCount:De(-1)}),i(!1),X.success("Removed from saved")):(await xt(W,{postId:t.id,authorId:t.userId,authorName:t.displayName,preview:((F=t.text)==null?void 0:F.substring(0,100))||"Media post",savedAt:new Date,hasMedia:!!((L=t.attachments)!=null&&L.length||t.imageUrl||t.audioUrl)}),await be(Z,{saveCount:De(1)}),i(!0),X.success("Post saved!"))}catch(W){console.error("Save failed",W),X.error("Couldn't save post")}C(!1)}},$=async()=>{var L;const F=`${window.location.origin}/post/${t.id}`;if(navigator.share)try{await navigator.share({title:`Post by ${t.displayName}`,text:((L=t.text)==null?void 0:L.substring(0,100))||"Check out this post",url:F})}catch(W){W.name!=="AbortError"&&B(F)}else B(F)},B=F=>{navigator.clipboard.writeText(F),k(!0),X.success("Link copied to clipboard!"),setTimeout(()=>k(!1),2e3)},M=async()=>{if(R&&window.confirm("Are you sure you want to delete this post?"))try{const F=Q(O,`artifacts/${re}/public/data/posts/${t.id}`);await ft(F),X.success("Post deleted")}catch(F){console.error("Delete failed:",F),X.error("Couldn't delete post")}};return e.jsxs(ce.div,{variants:$n,initial:"hidden",animate:"show",exit:"exit",layout:!0,className:"bg-white dark:bg-dark-card border dark:border-gray-700 rounded-xl overflow-visible shadow-sm mb-4 relative",children:[e.jsxs("div",{className:"p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden cursor-pointer shrink-0",onClick:()=>n(t.userId),children:t.authorPhoto?e.jsx("img",{src:t.authorPhoto,className:"h-full w-full object-cover",alt:"avatar"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-tr from-brand-blue to-purple-500 flex items-center justify-center text-white font-bold",children:((P=t.displayName)==null?void 0:P[0])||e.jsx(qe,{size:16})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm hover:underline decoration-brand-blue cursor-pointer truncate",onClick:()=>n(t.userId),children:t.displayName}),!R&&a&&!o&&e.jsx("button",{onClick:F=>{F.stopPropagation(),a()},className:"text-xs font-bold text-brand-blue hover:text-blue-700 transition shrink-0",children:"• Follow"})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"truncate",children:t.role}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"shrink-0",children:t.timestamp?new Date(t.timestamp.toMillis?t.timestamp.toMillis():t.timestamp).toLocaleDateString():"Just now"})]})]})]}),e.jsxs("div",{className:"relative",ref:f,children:[e.jsx("button",{className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>N(!y),children:e.jsx(kr,{size:20})}),e.jsx(Ve,{children:y&&e.jsxs(ce.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden z-50",children:[e.jsxs("button",{onClick:()=>{B(`${window.location.origin}/post/${t.id}`),N(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(wr,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Copy link"})]}),!R&&e.jsxs(e.Fragment,{children:[a&&e.jsxs("button",{onClick:()=>{a(),N(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(St,{size:16,className:"text-gray-400"}),e.jsxs("span",{className:"dark:text-gray-200",children:[o?"Unfollow":"Follow"," ",(A=t.displayName)==null?void 0:A.split(" ")[0]]})]}),e.jsxs("button",{onClick:()=>{d(),N(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(Gt,{size:16}),e.jsx("span",{children:"Report post"})]})]}),R&&e.jsxs("button",{onClick:()=>{M(),N(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(_e,{size:16}),e.jsx("span",{children:"Delete post"})]})]})})]})]}),e.jsxs("div",{className:"px-4 pb-2",children:[t.text&&e.jsx("p",{className:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap text-sm leading-relaxed mb-3",children:Ln(t.text)}),t.attachments&&t.attachments.length>0&&e.jsx("div",{className:`grid gap-2 mb-3 ${t.attachments.length>1?"grid-cols-2":"grid-cols-1"}`,children:t.attachments.map((F,L)=>e.jsxs("div",{className:"rounded-lg overflow-hidden bg-transparent relative",children:[F.type==="image"&&e.jsx("img",{src:F.url,className:"w-full h-full object-cover max-h-96",alt:"content"}),F.type==="video"&&e.jsx("video",{src:F.url,controls:!0,className:"w-full h-full max-h-96 bg-black"}),F.type==="audio"&&e.jsx("div",{className:"w-full",children:e.jsx(ks,{audioUrl:F.url,fileName:F.name||"Audio Track"})})]},L))}),t.audioUrl&&!t.attachments&&e.jsx("div",{className:"rounded-lg overflow-hidden bg-transparent mb-3",children:e.jsx(ks,{audioUrl:t.audioUrl,fileName:t.audioName||"Track"})}),t.imageUrl&&!t.attachments&&e.jsx("img",{src:t.imageUrl,className:"rounded-lg w-full mb-3 border dark:border-gray-700",alt:"legacy content"})]}),(S>0||t.saveCount>0)&&e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:Object.entries(I).map(([F,L])=>e.jsxs(ce.div,{initial:{scale:0},animate:{scale:1},className:`text-xs px-2 py-1 rounded-full border flex items-center gap-1 ${z===F?"bg-blue-50 border-blue-200 dark:bg-blue-900/30 dark:border-blue-800":"bg-gray-50 border-gray-100 dark:bg-gray-800 dark:border-gray-700"} dark:text-gray-300`,children:[e.jsx("span",{children:F}),e.jsx("span",{className:"font-bold",children:L})]},F))}),t.saveCount>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[t.saveCount," save",t.saveCount!==1?"s":""]})]}),e.jsxs("div",{className:"px-4 py-3 border-t dark:border-gray-700 flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(ce.button,{whileTap:{scale:.9},onClick:()=>c(!p),className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg ${z?"text-blue-600 bg-blue-50 dark:bg-blue-900/20":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[z?e.jsx("span",{className:"text-lg",children:z}):e.jsx(Sr,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:z?"Reacted":"React"})]}),e.jsx(Ve,{children:p&&e.jsx(ce.div,{ref:h,initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},className:"absolute bottom-full left-0 mb-2 bg-white dark:bg-gray-800 shadow-xl rounded-full p-2 flex gap-1 sm:gap-2 z-50 border dark:border-gray-600 origin-bottom-left",children:An.map(F=>e.jsx(ce.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:L=>{L.stopPropagation(),w(F)},className:`text-xl p-1 sm:p-1.5 rounded-full ${z===F?"bg-blue-100 dark:bg-blue-900":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:F},F))})})]}),e.jsxs(ce.button,{whileTap:{scale:.95},onClick:()=>x(!b),className:"flex items-center gap-1.5 sm:gap-2 text-sm font-medium text-gray-500 hover:text-brand-blue transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx(Te,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:g>0?g:"Comment"}),g>0&&e.jsx("span",{className:"sm:hidden",children:g})]}),e.jsxs(ce.button,{whileTap:{scale:.95},onClick:$,className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 ${j?"text-green-500":"text-gray-500 hover:text-green-500"}`,children:[j?e.jsx(Ge,{size:18}):e.jsx(Cr,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:j?"Copied!":"Share"})]})]}),e.jsx(ce.button,{whileTap:{scale:.8},onClick:v,disabled:E,className:`${u?"text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"} transition p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full disabled:opacity-50`,title:u?"Remove from saved":"Save post",children:e.jsx(fa,{size:18,fill:u?"currentColor":"none"})})]}),e.jsx(Ve,{children:b&&e.jsx(ce.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx(Pn,{post:t,currentUser:s,currentUserData:l,blockedUsers:[],onCountChange:m})})})]})}function Xa({text:t,onRemove:s}){return e.jsxs("span",{className:"flex items-center gap-1 bg-gray-100 dark:bg-gray-700 text-sm px-2 py-1 rounded-full text-gray-700 dark:text-gray-300",children:[t,e.jsx(pe,{size:12,className:"cursor-pointer hover:text-red-500",onClick:s})]})}function Hs({label:t,fieldKey:s,options:l,initialValues:n,onChange:d}){const[o,a]=r.useState(""),[b,x]=r.useState(n||[]);r.useEffect(()=>{x(n||[])},[n]);const g=()=>{if(o&&!b.includes(o)){const u=[...b,o];x(u),d(s,u),a("")}},m=u=>{const i=b.filter(p=>p!==u);x(i),d(s,i)};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:t}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("select",{className:"flex-1 p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:o,onChange:u=>a(u.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),l.map(u=>e.jsx("option",{value:u,children:u},u))]}),e.jsx("button",{type:"button",onClick:g,className:"bg-brand-blue text-white px-3 rounded-lg text-sm",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(u=>e.jsx(Xa,{text:u,onRemove:()=>m(u)},u))})]})}function In({label:t,fieldKey:s,data:l,initialValues:n,onChange:d}){const[o,a]=r.useState(""),[b,x]=r.useState(""),[g,m]=r.useState(n||[]);r.useEffect(()=>{m(n||[])},[n]);const u=l[o]||[],i=()=>{const c=o&&b?`${o} - ${b}`:"";if(c&&!g.includes(c)){const y=[...g,c];m(y),d(s,y),x("")}},p=c=>{const y=g.filter(N=>N!==c);m(y),d(s,y)};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:t}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("select",{className:"w-1/3 p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:o,onChange:c=>{a(c.target.value),x("")},children:[e.jsx("option",{value:"",children:"Category..."}),Object.keys(l).map(c=>e.jsx("option",{value:c,children:c},c))]}),e.jsxs("select",{className:"w-1/3 p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:b,onChange:c=>x(c.target.value),disabled:!o,children:[e.jsx("option",{value:"",children:"Select..."}),u.map(c=>e.jsx("option",{value:c,children:c},c))]}),e.jsx("button",{type:"button",onClick:i,className:"bg-brand-blue text-white px-3 rounded-lg text-sm",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(c=>e.jsx(Xa,{text:c,onRemove:()=>p(c)},c))})]})}function Mn({user:t,userData:s,onPost:l}){const[n,d]=r.useState(""),[o,a]=r.useState([]),[b,x]=r.useState(!1),[g,m]=r.useState([]),[u,i]=r.useState(null),[p,c]=r.useState(!1),{uploadMedia:y}=it(),N=(E,C)=>{if(E.target.files&&E.target.files[0]){const h=E.target.files[0],f=URL.createObjectURL(h);a([...o,{file:h,type:C,previewUrl:f}])}},j=E=>{a(o.filter((C,h)=>h!==E))},k=async()=>{if(!(!n.trim()&&o.length===0)){c(!0);try{const E=await Promise.all(o.map(async f=>{const R=f.type==="video"?"postVideos":f.type==="audio"?"postAudio":"postImages",z=`artifacts/${t.uid}/${R}`,I=await y(f.file,z);return I?{...I,type:f.type}:null}));let C=null;if(u){const f=await y(u,`artifacts/${t.uid}/postPresets`);C=f==null?void 0:f.url}const h={text:n,attachments:E.filter(f=>f!==null),seshFx:b&&(g.length>0||C)?{plugins:g,presetUrl:C,presetName:u?u.name:null}:null};await l(h),d(""),a([]),x(!1),m([]),i(null)}catch(E){console.error("Error creating post:",E),alert("Failed to create post. Please try again.")}finally{c(!1)}}};return e.jsx("div",{className:"bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-gray-700 shadow-sm mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden shrink-0",children:s!=null&&s.photoURL?e.jsx("img",{src:s.photoURL,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-brand-blue"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{className:"w-full bg-transparent outline-none text-gray-900 dark:text-white placeholder-gray-500 min-h-[80px] resize-none",placeholder:"What's creating sound today? (#tags @mentions)",value:n,onChange:E=>d(E.target.value)}),o.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:o.map((E,C)=>e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black/5 border dark:border-gray-600 aspect-video group flex items-center justify-center",children:[E.type==="image"&&e.jsx("img",{src:E.previewUrl,className:"h-full w-full object-cover"}),E.type==="video"&&e.jsx("video",{src:E.previewUrl,className:"h-full w-full object-cover"}),E.type==="audio"&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-brand-blue bg-gray-100 dark:bg-gray-800 w-full h-full",children:[e.jsx(lt,{size:32}),e.jsx("span",{className:"text-xs text-gray-500 mt-2 truncate max-w-[90%] px-2",children:E.file.name})]}),e.jsx("button",{onClick:()=>j(C),className:"absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-red-500",children:e.jsx(pe,{size:12})})]},C))}),b&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-3 border border-blue-100 dark:border-blue-800/50 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue uppercase",children:"SeshFx Data"}),e.jsx("button",{onClick:()=>x(!1),children:e.jsx(pe,{size:14,className:"text-gray-400 hover:text-brand-blue"})})]}),e.jsx(Hs,{label:"",options:Il,initialValues:g,onChange:(E,C)=>m(C)}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(zr,{size:14,className:"text-gray-400"}),e.jsx("input",{type:"file",className:"text-xs text-gray-500 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:bg-white dark:file:bg-gray-700 dark:file:text-white",onChange:E=>i(E.target.files[0])})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-brand-blue cursor-pointer transition",title:"Add Image",children:[e.jsx(Lt,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:E=>N(E,"image")})]}),e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-green-500 cursor-pointer transition",title:"Add Video",children:[e.jsx(Ls,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:E=>N(E,"video")})]}),e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-purple-500 cursor-pointer transition",title:"Add Audio Track",children:[e.jsx(lt,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"audio/*",onChange:E=>N(E,"audio")})]}),e.jsx("button",{onClick:()=>x(!b),className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition ${b?"bg-blue-50 dark:bg-blue-900/20 text-brand-blue":"text-gray-400"}`,title:"Add Plugin Data",children:e.jsx($s,{size:20})})]}),e.jsx("button",{onClick:k,disabled:p||!n&&o.length===0,className:"bg-brand-blue text-white px-5 py-1.5 rounded-full font-bold text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition",children:p?e.jsx(oe,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:["Post ",e.jsx(As,{size:14})]})})]})]})]})})}const la=["Spam or commercial solicitation","Harassment or bullying","Hate speech","Nudity or sexual activity","Violence or dangerous organizations","Copyright / Intellectual Property Violation","Scam or fraud","Other"],Fn=async({contentId:t,contentType:s,contentSummary:l,reporterId:n,reporterName:d,reason:o,description:a="",schoolId:b=null,isFacultyAction:x=!1})=>{try{if(await we(le(O,`artifacts/${re}/moderation_queue`),{type:"Report",status:"Open",priority:x?"High":"Normal",targetId:t,targetType:s,targetSummary:l||"No preview available",reporterId:n,reporterName:d,reason:o,description:a,schoolId:b,timestamp:ue()}),x&&(s==="post"||s==="comment")){const g=s==="post"?`artifacts/${re}/public/data/posts`:`artifacts/${re}/public/data/comments`;await be(Q(O,g,t),{visibility:"Hidden",moderationStatus:"Flagged",flaggedBy:n,flaggedAt:ue()})}return{success:!0}}catch(g){return console.error("Reporting failed:",g),{success:!1,error:g}}};function Qa({user:t,target:s,onClose:l}){const[n,d]=r.useState(la[0]),[o,a]=r.useState(""),[b,x]=r.useState(!1),[g,m]=r.useState(!1),u=async()=>{if(!(!n||!(t!=null&&t.uid))){x(!0);try{(await Fn({contentId:s.id,contentType:s.type,contentSummary:s.summary,reporterId:t.uid,reporterName:t.displayName||"Anonymous User",reason:n,description:o})).success?(m(!0),setTimeout(l,2e3)):alert("Failed to submit report. Please try again.")}catch(i){console.error("Submission error:",i),alert("An unexpected error occurred during submission.")}x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-lg animate-in fade-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h3",{className:"font-bold text-xl dark:text-white flex items-center gap-2 text-red-500",children:[e.jsx(ht,{size:24})," Report Violation"]}),e.jsx("button",{onClick:l,className:"text-gray-500 hover:text-gray-800 dark:text-gray-400 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:e.jsx(pe,{size:20})})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:["You are reporting a violation regarding: ",e.jsx("strong",{className:"font-bold",children:s.summary})," (",s.type,")"]}),g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Gt,{size:48,className:"text-green-500 mx-auto mb-4"}),e.jsx("h4",{className:"font-bold text-lg dark:text-white",children:"Report Submitted!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Thank you for helping keep the community safe. We will review this shortly."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Reason for Report"}),e.jsx("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:n,onChange:i=>d(i.target.value),children:la.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Additional Details (Optional)"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm resize-none",rows:"3",placeholder:"Provide any further context or relevant details.",value:o,onChange:i=>a(i.target.value)})]}),e.jsx("button",{onClick:u,disabled:b,className:"w-full bg-red-600 text-white py-3 rounded-xl font-bold hover:bg-red-700 transition disabled:opacity-50 flex items-center justify-center gap-2 shadow-md",children:b?e.jsx(oe,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(Gt,{size:18})," Submit Report"]})})]})]})})})}const He={FOR_YOU:"for_you",FOLLOWING:"following"};function On({user:t,userData:s,openPublicProfile:l}){const[n,d]=r.useState([]),[o,a]=r.useState(!0),[b,x]=r.useState(null),[g,m]=r.useState(He.FOR_YOU),[u,i]=r.useState([]),[p,c]=r.useState(!1),{following:y,stats:N,loading:j,isFollowing:k,toggleFollow:E,getFollowingIds:C}=Ka(t==null?void 0:t.uid,s),h=r.useMemo(()=>C(),[y]);r.useEffect(()=>{g===He.FOLLOWING&&h.length===0&&(t!=null&&t.uid)&&f()},[g,h.length,t==null?void 0:t.uid]);const f=async()=>{c(!0);try{const S=ye(le(O,`artifacts/${re}/public/data/posts`),Ae("timestamp","desc"),Ze(20)),w=await Xe(S),v=new Map;w.docs.forEach($=>{const B=$.data();B.userId!==(t==null?void 0:t.uid)&&!v.has(B.userId)&&v.set(B.userId,{userId:B.userId,displayName:B.displayName,photoURL:B.authorPhoto,role:B.role})}),i(Array.from(v.values()).slice(0,5))}catch(S){console.error("Error loading suggestions:",S)}c(!1)};r.useEffect(()=>{a(!0);const S=`artifacts/${re}/public/data/posts`;let w;g===He.FOLLOWING&&h.length>0?w=ye(le(O,S),Ae("timestamp","desc"),Ze(50)):w=ye(le(O,S),Ae("timestamp","desc"),Ze(20));const v=fe(w,$=>{let B=$.docs.map(M=>({id:M.id,...M.data()}));g===He.FOLLOWING&&h.length>0&&(B=B.filter(M=>h.includes(M.userId)||M.userId===(t==null?void 0:t.uid))),d(B),a(!1)},$=>{console.error("Feed error:",$),a(!1)});return()=>v()},[g,h,t==null?void 0:t.uid]);const R=async S=>{if(t)try{await we(le(O,`artifacts/${re}/public/data/posts`),{...S,userId:t.uid,displayName:(s==null?void 0:s.effectiveDisplayName)||`${(s==null?void 0:s.firstName)||"User"} ${(s==null?void 0:s.lastName)||""}`.trim(),authorPhoto:(s==null?void 0:s.photoURL)||null,role:(s==null?void 0:s.activeProfileRole)||"User",timestamp:ue(),reactions:{},reactionCount:0,commentCount:0,saveCount:0,visibility:"Public"})}catch(w){console.error("Failed to post:",w),alert("Could not post update. Please try again.")}},z={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},I=({suggestedUser:S})=>e.jsxs(ce.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 hover:border-brand-blue/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1 min-w-0",onClick:()=>l==null?void 0:l(S.userId),children:[e.jsx(mt,{src:S.photoURL,name:S.displayName,size:"md"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate hover:text-brand-blue transition",children:S.displayName}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:S.role})]})]}),e.jsx(qs,{isFollowing:k(S.userId),onToggle:()=>E(S.userId,S),size:"sm",variant:"default"})]});return e.jsxs("div",{className:"max-w-2xl mx-auto pb-20",children:[e.jsx(Mn,{user:t,userData:s,onPost:R}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("button",{onClick:()=>m(He.FOR_YOU),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${g===He.FOR_YOU?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(Er,{size:16}),e.jsx("span",{children:"For You"})]}),e.jsxs("button",{onClick:()=>m(He.FOLLOWING),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${g===He.FOLLOWING?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(Fe,{size:16}),e.jsx("span",{children:"Following"}),N.followingCount>0&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${g===He.FOLLOWING?"bg-white/20":"bg-gray-200 dark:bg-gray-700"}`,children:N.followingCount})]})]}),o||j?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(oe,{className:"animate-spin text-brand-blue",size:32})}):e.jsxs(e.Fragment,{children:[g===He.FOLLOWING&&h.length===0&&e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-6 border border-blue-100 dark:border-blue-800/30",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-brand-blue/10 flex items-center justify-center",children:e.jsx(St,{size:28,className:"text-brand-blue"})}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Start following creators"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-sm mx-auto",children:"Follow artists, engineers, and studios to see their posts in your Following feed."})]}),p?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(oe,{className:"animate-spin text-brand-blue",size:24})}):u.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Suggested for you"}),u.map(S=>e.jsx(I,{suggestedUser:S},S.userId))]})]}),e.jsxs(ce.div,{variants:z,initial:"hidden",animate:"show",className:"space-y-4",children:[e.jsx(Ve,{mode:"popLayout",children:n.map(S=>e.jsx(Tn,{post:S,currentUser:t,currentUserData:s,openPublicProfile:l||(()=>{}),onReport:()=>x(S),isFollowingAuthor:k(S.userId),onToggleFollow:()=>E(S.userId,{displayName:S.displayName,photoURL:S.authorPhoto,role:S.role})},S.id))}),n.length===0&&g===He.FOR_YOU&&e.jsxs(ce.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(kt,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsx("p",{children:"No posts yet. Be the first to share something!"})]}),n.length===0&&g===He.FOLLOWING&&h.length>0&&e.jsxs(ce.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(Fe,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsx("p",{children:"No recent posts from people you follow."}),e.jsx("button",{onClick:()=>m(He.FOR_YOU),className:"mt-3 text-brand-blue hover:underline text-sm font-medium",children:"Browse For You feed →"})]})]})]}),b&&e.jsx(Qa,{user:t,target:{id:b.id,type:"Post",summary:b.text?b.text.substring(0,50):"Media Post"},onClose:()=>x(null)})]})}function Ja({initialZip:t="",onLocationChange:s,showMap:l=!1,label:n="Location"}){const[d,o]=r.useState(t),[a,b]=r.useState(""),[x,g]=r.useState(!1),[m,u]=r.useState(null);r.useEffect(()=>{t&&t!==d&&(o(t),i(t))},[t]);const i=async c=>{const y=c.replace(/\D/g,"").slice(0,5);if(o(y),y.length===5){g(!0);const N=await ns(y);N?(b(N.cityState),u({lat:N.lat,lng:N.lng}),s({zip:y,...N})):(b("Unknown Location"),s({zip:y,valid:!1})),g(!1)}else b("")},p=()=>{if(!navigator.geolocation)return alert("Geolocation not supported");g(!0),navigator.geolocation.getCurrentPosition(async c=>{const{latitude:y,longitude:N}=c.coords;try{const E=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${y}&lon=${N}`)).json()).address.postcode;if(E){const C=E.split("-")[0];o(C),i(C)}else u({lat:y,lng:N}),b("Current Location"),s({lat:y,lng:N,name:"Current Location",valid:!0})}catch(j){console.error(j),alert("Failed to determine location.")}g(!1)},c=>{console.warn(c),alert("Location access denied."),g(!1)})};return e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:n}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{className:"w-full pl-9 p-2.5 bg-white dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all text-sm",placeholder:"Zip Code",maxLength:5,value:d,onChange:c=>i(c.target.value)}),e.jsx(Le,{className:`absolute left-3 top-3 text-gray-400 ${x?"animate-pulse":""}`,size:16})]}),e.jsx("button",{onClick:p,disabled:x,className:"p-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-brand-blue transition-colors",title:"Use my location",children:x?e.jsx(oe,{size:18,className:"animate-spin"}):e.jsx(wa,{size:18})})]}),a&&e.jsxs("div",{className:"mt-1.5 text-xs font-medium text-gray-500 dark:text-gray-400 flex items-center gap-1 animate-in fade-in",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),a]})]})}let Bn=Wa.icon({iconUrl:Jl,shadowUrl:Ql,iconSize:[25,41],iconAnchor:[12,41]});Wa.Marker.prototype.options.icon=Bn;function _n({center:t,zoom:s}){const l=Ha();return r.useEffect(()=>{l.setView(t,s)},[t,s,l]),null}function Da({locations:t=[],center:s=[34.0522,-118.2437],zoom:l=10,height:n="400px",drawRadius:d=!1,radiusMiles:o=0}){const a=t.filter(x=>x.lat&&x.lng&&(!x.hideAddress||x.forceReveal)),b=o*1609.34;return e.jsx("div",{className:"rounded-xl overflow-hidden shadow-inner border dark:border-gray-700 relative z-0",style:{height:n,width:"100%"},children:e.jsxs(_a,{center:s,zoom:l,style:{height:"100%",width:"100%"},scrollWheelZoom:!1,children:[e.jsx(qa,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(_n,{center:s,zoom:l}),d&&o>0&&e.jsx(Ht,{center:s,pathOptions:{fillColor:"#3D84ED",color:"#3D84ED",fillOpacity:.2},radius:b}),a.map(x=>e.jsx(Dl,{position:[x.lat,x.lng],children:e.jsx(en,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{className:"block mb-1",children:x.name}),e.jsx("span",{className:"text-xs text-gray-500",children:x.address||"Location Hidden"})]})})},x.id))]})})}function na(t,s,l,n){const o=(l-t)*(Math.PI/180),a=(n-s)*(Math.PI/180),b=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*(Math.PI/180))*Math.cos(l*(Math.PI/180))*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)))*.621371}function qn({userData:t,sessionParams:s,setSessionParams:l,onNext:n}){var p,c;const[d,o]=r.useState(1),[a,b]=r.useState(!1),[x,g]=r.useState([]),m=y=>{y.preventDefault(),o(2),u()},u=async()=>{b(!0);try{const y=ye(ls(O,"public_profile"),Ce("accountTypes","array-contains","Studio")),k=(await Xe(y)).docs.map(E=>({id:E.ref.parent.parent.id,...E.data()})).filter(E=>!E.location||!s.location?!1:na(s.location.lat,s.location.lng,E.location.lat,E.location.lng)<=s.radius).map(E=>({...E,distance:na(s.location.lat,s.location.lng,E.location.lat,E.location.lng)})).sort((E,C)=>E.distance-C.distance);g(k)}catch(y){console.error("Studio fetch error:",y)}b(!1)},i=y=>{l(N=>({...N,venue:y})),n()};return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 shadow-sm overflow-hidden min-h-[600px]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"bg-brand-blue text-white w-8 h-8 rounded-full flex items-center justify-center text-sm",children:d}),d===1?"Session Logistics":"Select Studio"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 ml-10",children:d===1?"Define the when and where.":`Found ${x.length} studios within range.`})]}),d===1&&e.jsxs("form",{onSubmit:m,className:"p-8 space-y-6 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:[e.jsx(Re,{size:14,className:"inline mr-1"})," Date"]}),e.jsx("input",{type:"date",required:!0,className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white outline-none focus:ring-2 focus:ring-brand-blue",value:s.date,onChange:y=>l({...s,date:y.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:[e.jsx(Ie,{size:14,className:"inline mr-1"})," Start Time"]}),e.jsx("input",{type:"time",required:!0,className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white outline-none focus:ring-2 focus:ring-brand-blue",value:s.time,onChange:y=>l({...s,time:y.target.value})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ja,{initialZip:t==null?void 0:t.zip,label:"Center Location",onLocationChange:y=>l({...s,location:y})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Max Distance"}),e.jsxs("span",{className:"text-xs font-bold text-brand-blue",children:[s.radius," miles"]})]}),e.jsx("input",{type:"range",min:"5",max:"100",step:"5",value:s.radius,onChange:y=>l({...s,radius:parseInt(y.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:[e.jsx(st,{size:14,className:"inline mr-1"})," Urgency"]}),e.jsx("div",{className:"flex gap-2",children:["Low","Normal","High"].map(y=>e.jsx("button",{type:"button",onClick:()=>l({...s,urgency:y}),className:`flex-1 py-2 rounded-lg text-sm font-bold border transition ${s.urgency===y?"bg-brand-blue text-white border-brand-blue":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:y},y))})]})]}),e.jsx("div",{className:"pt-6",children:e.jsxs("button",{type:"submit",className:"w-full bg-brand-blue text-white py-4 rounded-xl font-bold shadow-lg hover:bg-blue-600 transition flex justify-center items-center gap-2",children:["Find Studios ",e.jsx(Ke,{size:20})]})})]}),d===2&&e.jsx("div",{className:"flex flex-col h-[600px]",children:a?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[e.jsx(oe,{className:"animate-spin text-brand-blue mb-4",size:40}),e.jsx("p",{className:"text-gray-500",children:"Scouting locations..."})]}):e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-1/2 overflow-y-auto p-4 space-y-3",children:[e.jsx("button",{onClick:()=>o(1),className:"text-xs text-gray-500 hover:text-brand-blue mb-2 flex items-center gap-1",children:"← Change Filters"}),e.jsxs("div",{onClick:()=>i({id:"remote",name:"Remote / TBD",address:"No physical location set"}),className:"p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer text-center",children:[e.jsx("h4",{className:"font-bold text-gray-600 dark:text-gray-300",children:"No Studio Needed / Remote"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Skip venue selection"})]}),x.map(y=>e.jsxs("div",{onClick:()=>i(y),className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 hover:border-brand-blue dark:hover:border-blue-500 cursor-pointer transition shadow-sm group",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-bold dark:text-white group-hover:text-brand-blue",children:y.name||"Studio"}),e.jsxs("span",{className:"text-xs font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-600 dark:text-gray-300",children:["$",y.rate,"/hr"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1",children:[e.jsx(Le,{size:10})," ",y.distance.toFixed(1)," miles away"]}),e.jsx("div",{className:"flex gap-1 mt-2",children:(y.equipmentList||[]).slice(0,3).map(N=>e.jsx("span",{className:"text-[10px] bg-blue-50 dark:bg-blue-900/20 text-blue-600 px-1.5 py-0.5 rounded",children:N},N))})]},y.id))]}),e.jsx("div",{className:"hidden md:block w-1/2 h-full border-l dark:border-gray-700 relative",children:e.jsx(Da,{locations:x,center:[(p=s.location)==null?void 0:p.lat,(c=s.location)==null?void 0:c.lng],height:"100%",drawRadius:!0,radiusMiles:s.radius})})]})})]})}const Hn=[{value:"All",label:"All Profiles",icon:ys},{value:"Musician",label:"Musician",icon:lt},{value:"Producer",label:"Producer",icon:Ca},{value:"Engineer",label:"Audio Engineer",icon:js},{value:"DJ",label:"DJ",icon:Zt},{value:"Vocalist",label:"Vocalist",icon:Zt},{value:"Guitarist",label:"Guitarist",icon:Ar},{value:"Pianist",label:"Pianist/Keys",icon:Lr},{value:"Studio",label:"Studio",icon:js}],Wn=[{value:"All",label:"Any Experience"},{value:"beginner",label:"Beginner (0-2 yrs)"},{value:"intermediate",label:"Intermediate (2-5 yrs)"},{value:"advanced",label:"Advanced (5-10 yrs)"},{value:"expert",label:"Expert (10+ yrs)"}],ws=t=>{var b,x;const s=((x=(b=t.lastActive)==null?void 0:b.toDate)==null?void 0:x.call(b))||t.lastActive;if(!s)return{status:"unknown",label:"Unknown",color:"gray"};const n=new Date-new Date(s),d=Math.floor(n/6e4),o=Math.floor(d/60),a=Math.floor(o/24);return d<5?{status:"online",label:"Online now",color:"green"}:d<60?{status:"recent",label:`Active ${d}m ago`,color:"green"}:o<24?{status:"today",label:`Active ${o}h ago`,color:"yellow"}:a<7?{status:"week",label:`Active ${a}d ago`,color:"orange"}:{status:"inactive",label:"Inactive",color:"gray"}},Un=({rating:t,reviewCount:s})=>!t&&!s?null:e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(et,{size:12,className:"text-yellow-500 fill-yellow-500"}),e.jsx("span",{className:"font-bold text-yellow-600 dark:text-yellow-400",children:(t==null?void 0:t.toFixed(1))||"—"}),s>0&&e.jsxs("span",{className:"text-gray-400",children:["(",s,")"]})]}),Vn=({profile:t})=>{const s=ws(t),l={green:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",yellow:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",orange:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",gray:"bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400"};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-bold ${l[s.color]}`,children:[s.status==="online"&&e.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),s.label]})};function ia({user:t,userData:s,openPublicProfile:l,onAddToCart:n,sessionCartIds:d=[],onBook:o,mode:a="direct"}){const[b,x]=r.useState(""),[g,m]=r.useState([]),[u,i]=r.useState(!1),[p,c]=r.useState("list"),[y,N]=r.useState(!0),[j,k]=r.useState(!1),[E,C]=r.useState("relevance"),[h,f]=r.useState({role:"All",minRate:0,maxRate:500,experience:"All",verified:!1,availableNow:!1,hasPortfolio:!1,location:"",radius:50,genres:[],skills:[]}),R=[h.role!=="All",h.minRate>0,h.maxRate<500,h.experience!=="All",h.verified,h.availableNow,h.hasPortfolio,h.location,h.genres.length>0,h.skills.length>0].filter(Boolean).length,z=async()=>{i(!0);try{const w=ls(O,te().publicProfileCollectionGroup),v=[];h.role!=="All"&&v.push(Ce("accountTypes","array-contains",h.role)),v.push(Ze(100));const $=ye(w,...v);let M=(await Xe($)).docs.map(T=>{const P=T.data();return{id:P.uid||T.ref.parent.parent.id,...P}}).filter(T=>T.id!==t.uid);if(b){const T=b.toLowerCase();M=M.filter(P=>{var A,F,L,W,Z,D,Y;return((A=P.firstName)==null?void 0:A.toLowerCase().includes(T))||((F=P.lastName)==null?void 0:F.toLowerCase().includes(T))||((L=P.profileName)==null?void 0:L.toLowerCase().includes(T))||((W=P.bio)==null?void 0:W.toLowerCase().includes(T))||((Z=P.skills)==null?void 0:Z.some(q=>q.toLowerCase().includes(T)))||((D=P.genres)==null?void 0:D.some(q=>q.toLowerCase().includes(T)))||((Y=P.searchTerms)==null?void 0:Y.includes(T))})}switch((h.minRate>0||h.maxRate<500)&&(M=M.filter(T=>{const P=T.rate||0;return P>=h.minRate&&P<=h.maxRate})),h.experience!=="All"&&(M=M.filter(T=>{const P=T.yearsExperience||0;switch(h.experience){case"beginner":return P<=2;case"intermediate":return P>2&&P<=5;case"advanced":return P>5&&P<=10;case"expert":return P>10;default:return!0}})),h.verified&&(M=M.filter(T=>T.verified===!0)),h.availableNow&&(M=M.filter(T=>{const P=ws(T);return P.status==="online"||P.status==="recent"})),h.hasPortfolio&&(M=M.filter(T=>T.portfolio&&T.portfolio.length>0||T.audioSamples&&T.audioSamples.length>0||T.spotifyUrl||T.soundcloudUrl)),E){case"rating":M.sort((T,P)=>(P.rating||0)-(T.rating||0));break;case"rate_low":M.sort((T,P)=>(T.rate||0)-(P.rate||0));break;case"rate_high":M.sort((T,P)=>(P.rate||0)-(T.rate||0));break;case"recent":M.sort((T,P)=>{var L,W,Z,D;const A=((W=(L=T.lastActive)==null?void 0:L.toDate)==null?void 0:W.call(L))||T.lastActive||0,F=((D=(Z=P.lastActive)==null?void 0:Z.toDate)==null?void 0:D.call(Z))||P.lastActive||0;return new Date(F)-new Date(A)});break;default:M.sort((T,P)=>T.verified&&!P.verified?-1:!T.verified&&P.verified?1:(P.rating||0)-(T.rating||0))}m(M)}catch(w){console.error("Search failed:",w)}i(!1)};r.useEffect(()=>{z()},[]);const I=()=>{f({role:"All",minRate:0,maxRate:500,experience:"All",verified:!1,availableNow:!1,hasPortfolio:!1,location:"",radius:50,genres:[],skills:[]})},S=()=>e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Profile Type"}),e.jsx("select",{className:"w-full p-2.5 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:h.role,onChange:w=>f({...h,role:w.target.value}),children:Hn.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:["Hourly Rate: $",h.minRate," - $",h.maxRate]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"range",min:"0",max:"500",step:"10",value:h.minRate,onChange:w=>f({...h,minRate:Math.min(parseInt(w.target.value),h.maxRate-10)}),className:"flex-1 accent-brand-blue"}),e.jsx("input",{type:"range",min:"0",max:"500",step:"10",value:h.maxRate,onChange:w=>f({...h,maxRate:Math.max(parseInt(w.target.value),h.minRate+10)}),className:"flex-1 accent-brand-blue"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"$0"}),e.jsx("span",{children:"$500+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Experience Level"}),e.jsx("select",{className:"w-full p-2.5 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:h.experience,onChange:w=>f({...h,experience:w.target.value}),children:Wn.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Quick Filters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 transition",children:[e.jsx("input",{type:"checkbox",checked:h.availableNow,onChange:w=>f({...h,availableNow:w.target.checked}),className:"w-4 h-4 text-brand-blue rounded"}),e.jsx(Oe,{size:14,className:"text-green-500"}),e.jsx("span",{className:"text-sm dark:text-white",children:"Available Now"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 transition",children:[e.jsx("input",{type:"checkbox",checked:h.verified,onChange:w=>f({...h,verified:w.target.checked}),className:"w-4 h-4 text-brand-blue rounded"}),e.jsx(Yt,{size:14,className:"text-blue-500"}),e.jsx("span",{className:"text-sm dark:text-white",children:"Verified Only"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 transition",children:[e.jsx("input",{type:"checkbox",checked:h.hasPortfolio,onChange:w=>f({...h,hasPortfolio:w.target.checked}),className:"w-4 h-4 text-brand-blue rounded"}),e.jsx(lt,{size:14,className:"text-purple-500"}),e.jsx("span",{className:"text-sm dark:text-white",children:"Has Portfolio"})]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("button",{onClick:z,className:"w-full bg-brand-blue text-white py-2.5 rounded-lg text-sm font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2",children:[e.jsx(Be,{size:16}),"Search"]}),R>0&&e.jsxs("button",{onClick:I,className:"w-full text-gray-500 dark:text-gray-400 py-2 rounded-lg text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800 transition",children:["Clear Filters (",R,")"]})]})]});return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 h-full",children:[e.jsx("div",{className:"hidden lg:block lg:col-span-3 space-y-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm h-fit sticky top-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ea,{size:18})," Filters",R>0&&e.jsx("span",{className:"bg-brand-blue text-white text-xs px-2 py-0.5 rounded-full",children:R})]})}),e.jsx(S,{})]})}),e.jsx(Ve,{children:j&&e.jsx(ce.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 lg:hidden",onClick:()=>k(!1),children:e.jsxs(ce.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"tween"},className:"absolute right-0 top-0 bottom-0 w-80 bg-white dark:bg-[#2c2e36] p-5 overflow-y-auto",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold dark:text-white text-lg",children:"Filters"}),e.jsx("button",{onClick:()=>k(!1),children:e.jsx(pe,{size:24,className:"text-gray-500"})})]}),e.jsx(S,{})]})})}),e.jsxs("div",{className:"lg:col-span-9 space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-3 rounded-xl border dark:border-gray-700 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{className:"w-full pl-10 pr-4 p-2.5 bg-gray-50 dark:bg-[#1f2128] border-transparent focus:bg-white dark:focus:bg-black focus:border-brand-blue border rounded-lg dark:text-white transition-all outline-none",placeholder:"Search by name, skill, genre...",value:b,onChange:w=>x(w.target.value),onKeyDown:w=>w.key==="Enter"&&z()})]}),e.jsxs("button",{onClick:()=>k(!0),className:"lg:hidden p-2.5 bg-gray-100 dark:bg-gray-800 rounded-lg relative",children:[e.jsx(Rr,{size:20,className:"text-gray-600 dark:text-gray-300"}),R>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-brand-blue text-white text-xs rounded-full flex items-center justify-center font-bold",children:R})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Sort by:"}),e.jsxs("select",{value:E,onChange:w=>{C(w.target.value),z()},className:"text-sm border-0 bg-transparent dark:text-white font-medium focus:ring-0 cursor-pointer",children:[e.jsx("option",{value:"relevance",children:"Relevance"}),e.jsx("option",{value:"rating",children:"Highest Rated"}),e.jsx("option",{value:"rate_low",children:"Price: Low to High"}),e.jsx("option",{value:"rate_high",children:"Price: High to Low"}),e.jsx("option",{value:"recent",children:"Recently Active"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[g.length," result",g.length!==1?"s":""]})]})]}),e.jsx("div",{className:"min-h-[400px]",children:u?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-blue border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("span",{children:"Searching talent..."})]}):g.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.map(w=>{var B,M,T,P;const v=d.includes(w.id),$=ws(w);return e.jsxs(ce.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`bg-white dark:bg-[#2c2e36] p-4 rounded-xl border flex flex-col transition ${v?"border-brand-blue ring-1 ring-brand-blue bg-blue-50 dark:bg-blue-900/10":"dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsxs("div",{className:"relative cursor-pointer",onClick:()=>l(w.id,w.firstName),children:[w.photoURL?e.jsx("img",{src:w.photoURL,alt:w.firstName,className:"h-12 w-12 rounded-full object-cover"}):e.jsx("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-brand-blue to-purple-500 flex items-center justify-center text-white font-bold",children:(B=w.firstName)==null?void 0:B[0]}),$.status==="online"&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white dark:border-[#2c2e36] rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white truncate cursor-pointer hover:text-brand-blue transition",onClick:()=>l(w.id,w.firstName),children:w.profileName||`${w.firstName} ${w.lastName}`}),w.verified&&e.jsx(Yt,{size:16,className:"text-blue-500 shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mt-0.5",children:[e.jsx("span",{className:"text-xs text-gray-500",children:((M=w.accountTypes)==null?void 0:M[0])||"Artist"}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"•"}),e.jsxs("span",{className:"text-xs font-bold text-green-600 dark:text-green-400",children:["$",w.rate||"?","/hr"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 flex-wrap",children:[e.jsx(Un,{rating:w.rating,reviewCount:w.reviewCount}),e.jsx(Vn,{profile:w}),w.yearsExperience&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Pr,{size:12}),w.yearsExperience,"+ yrs"]})]}),w.bio&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2 mb-3",children:w.bio}),(((T=w.skills)==null?void 0:T.length)>0||((P=w.genres)==null?void 0:P.length)>0)&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:[...(w.genres||[]).slice(0,2),...(w.skills||[]).slice(0,2)].map((A,F)=>e.jsx("span",{className:"text-[10px] px-2 py-0.5 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded-full",children:A},F))}),(w.city||w.state)&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400 mb-3",children:[e.jsx(Le,{size:12}),[w.city,w.state].filter(Boolean).join(", ")]}),a==="planner"&&e.jsx("button",{onClick:()=>!v&&n(w),disabled:v,className:`mt-auto w-full py-2.5 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition ${v?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 cursor-default":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-white hover:bg-brand-blue hover:text-white"}`,children:v?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{size:14})," Added to Session"]}):e.jsxs(e.Fragment,{children:[e.jsx(nt,{size:14})," Add to Session"]})}),a==="direct"&&e.jsxs("button",{onClick:()=>o(w),className:"mt-auto w-full py-2.5 rounded-lg text-xs font-bold bg-brand-blue text-white hover:bg-blue-600 transition flex items-center justify-center gap-2",children:[e.jsx(Re,{size:14})," Book Now"]})]},w.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(Be,{size:48,className:"mb-4 opacity-30"}),e.jsx("p",{className:"font-medium mb-2",children:"No results found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your filters or search terms"}),R>0&&e.jsx("button",{onClick:I,className:"mt-4 text-brand-blue font-medium text-sm hover:underline",children:"Clear all filters"})]})})]})]})}function Gn({user:t,userData:s,broadcast:l,onClose:n}){const[d,o]=r.useState(Math.floor(l.offerAmount/(l.duration||1))),[a,b]=r.useState(""),[x,g]=r.useState(!1),m=d*(l.duration||1),u=l.offerAmount,i=m>u,p=async()=>{if(!d||!a)return alert("Please enter a rate and a message.");if(i)return alert("Your bid exceeds the client's budget.");g(!0);try{const c={type:"Bid",broadcastId:l.id,targetId:l.senderId,targetName:l.senderName,senderId:t.uid,senderName:`${s.firstName} ${s.lastName}`,serviceType:`Bid: ${l.serviceType||"Session"}`,offerAmount:m,ratePerHour:parseInt(d),message:a,status:"Pending",date:"Flexible",timestamp:ue()};await we(le(O,`artifacts/${re}/public/data/bookings`),c),alert("Bid submitted successfully! The client has been notified."),n()}catch(c){console.error("Error submitting bid:",c),alert("Failed to submit bid.")}g(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Place Your Bid"}),e.jsx("button",{onClick:n,children:e.jsx(pe,{size:20,className:"text-gray-500 hover:text-white"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 uppercase mb-1",children:"Client's Budget"}),e.jsxs("div",{className:"text-2xl font-extrabold dark:text-white",children:["$",u," ",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["Total (",l.duration," hrs)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-500 mb-2",children:"Your Hourly Rate ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{size:16,className:"absolute left-3 top-3.5 text-gray-400"}),e.jsx("input",{type:"number",className:`w-full pl-8 p-3 border rounded-xl font-bold text-lg outline-none dark:bg-[#1f2128] dark:text-white ${i?"border-red-500 focus:ring-red-500":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"}`,value:d,onChange:c=>o(c.target.value)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Total Bid:"}),e.jsxs("span",{className:`font-bold ${i?"text-red-500":"text-green-600"}`,children:["$",m]})]}),i&&e.jsxs("div",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(st,{size:12})," Bid exceeds budget. Consider lowering your rate."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-500 mb-2",children:"Message to Client"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl text-sm dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none resize-none",rows:"3",placeholder:"Introduce yourself and your gear...",value:a,onChange:c=>b(c.target.value)})]}),e.jsx("button",{onClick:p,disabled:x||i,className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold shadow-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:shadow-none",children:x?e.jsx(oe,{className:"animate-spin"}):"Submit Proposal"})]})]})})}function oa(t,s,l,n){var d=6371,o=_t(l-t),a=_t(n-s),b=Math.sin(o/2)*Math.sin(o/2)+Math.cos(_t(t))*Math.cos(_t(l))*Math.sin(a/2)*Math.sin(a/2),x=2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b));return d*x*.621371}function _t(t){return t*(Math.PI/180)}function Yn({user:t,userData:s,onBid:l}){const[n,d]=r.useState([]),[o,a]=r.useState([]),[b,x]=r.useState(null),[g,m]=r.useState(null),[u,i]=r.useState(50);r.useEffect(()=>{(async()=>{if(s!=null&&s.zip){const y=await ns(s.zip);y&&m({lat:y.lat,lng:y.lng})}else navigator.geolocation&&navigator.geolocation.getCurrentPosition(y=>m({lat:y.coords.latitude,lng:y.coords.longitude}))})()},[s]),r.useEffect(()=>{const c=ye(le(O,`artifacts/${re}/public/data/bookings`),Ce("type","==","Broadcast"),Ce("status","==","Broadcasting"),Ae("timestamp","desc")),y=fe(c,N=>{d(N.docs.map(j=>({id:j.id,...j.data()})))});return()=>y()},[]),r.useEffect(()=>{if(!g){a(n);return}const c=n.filter(y=>!y.location||!y.location.lat||!y.location.lng?!0:oa(g.lat,g.lng,y.location.lat,y.location.lng)<=u).map(y=>{const N=y.location?oa(g.lat,g.lng,y.location.lat,y.location.lng):null;return{...y,distance:N}}).sort((y,N)=>(y.distance||9999)-(N.distance||9999));a(c)},[n,g,u]);const p=async c=>{if(window.confirm("Cancel this broadcast? This will remove it from the board."))try{await be(Q(O,`artifacts/${re}/public/data/bookings`,c),{status:"Cancelled"})}catch(y){console.error(y),alert("Failed to cancel.")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-end gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"text-yellow-500",size:20})," Open Sessions"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Live opportunities near you."})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[e.jsx(Le,{size:14,className:"ml-2 text-gray-500"}),e.jsxs("select",{className:"bg-transparent text-sm font-bold text-gray-700 dark:text-gray-300 p-1 outline-none cursor-pointer",value:u,onChange:c=>i(Number(c.target.value)),children:[e.jsx("option",{value:10,children:"Within 10 mi"}),e.jsx("option",{value:25,children:"Within 25 mi"}),e.jsx("option",{value:50,children:"Within 50 mi"}),e.jsx("option",{value:100,children:"Within 100 mi"}),e.jsx("option",{value:5e3,children:"Anywhere"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.length===0?e.jsx("div",{className:"col-span-full text-center py-12 bg-white dark:bg-[#2c2e36] rounded-xl border border-dashed dark:border-gray-700 text-gray-500",children:"No open sessions found."}):o.map(c=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all group relative overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 right-0 bg-brand-blue text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg",children:["BUDGET: $",c.offerAmount||"N/A"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 flex justify-between",children:[e.jsx("span",{children:c.serviceType}),typeof c.distance=="number"&&e.jsxs("span",{className:"text-brand-blue flex items-center gap-1",children:[e.jsx(Le,{size:10})," ",c.distance.toFixed(1)," mi"]})]}),e.jsx("h4",{className:"text-lg font-bold dark:text-white truncate pr-16",children:c.targetName||"Session Request"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-300 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{size:14})," ",c.senderName]}),c.date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{size:14})," ",c.date==="Flexible"?"Flexible":new Date(c.date).toLocaleDateString()]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:c.requirements&&c.requirements.slice(0,3).map((y,N)=>e.jsx("span",{className:"text-[10px] bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-600 dark:text-gray-300 border dark:border-gray-600",children:y.value},N))}),e.jsx("div",{className:"flex gap-2",children:c.senderId===t.uid?e.jsxs("button",{onClick:()=>p(c.id),className:"w-full bg-red-100 text-red-600 py-2.5 rounded-lg font-bold text-sm hover:bg-red-200 transition flex items-center justify-center gap-2",children:[e.jsx(_e,{size:16})," Cancel"]}):e.jsxs("button",{onClick:()=>x(c),className:"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-2.5 rounded-lg font-bold text-sm hover:opacity-90 transition flex justify-center items-center gap-2",children:["View & Bid ",e.jsx(Ke,{size:16})]})})]},c.id))}),b&&e.jsx(Gn,{user:t,userData:s,broadcast:b,onClose:()=>x(null)})]})}const da=[{id:"computer_audio_and_interfaces",label:"Computer Audio & Interfaces"},{id:"microphones_and_input_transducers",label:"Microphones"},{id:"mixing_consoles_and_control",label:"Mixing Consoles"},{id:"monitoring_and_playback",label:"Monitoring & Playback"},{id:"outboard_signal_processing",label:"Outboard Gear"}],er=()=>{const[t,s]=r.useState({}),[l,n]=r.useState(!0);return r.useEffect(()=>{(async()=>{n(!0);const o={};try{const a=`artifacts/${re}/public/data/equipment_database`;await Promise.all(da.map(async b=>{const x=Q(O,a,b.id),g=le(x,"items"),m=await Xe(g),u={};m.forEach(i=>{u[i.id]=i.data()}),o[b.id]=u})),s(o)}catch(a){console.error("Failed to load equipment database:",a)}n(!1)})()},[]),{loading:l,data:t,categories:da}};function Zn({user:t,userData:s,onBack:l,onSuccess:n}){const{loading:d,data:o,categories:a}=er(),[b,x]=r.useState(2),g=[5,10,15,25,50,100,250,500],m=g[b],[u,i]=r.useState({lat:34.0522,lng:-118.2437,name:"Default"});r.useEffect(()=>{(async()=>{if(s!=null&&s.zip){const ae=await ns(s.zip);if(ae){i({lat:ae.lat,lng:ae.lng,name:ae.cityState});return}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(ae=>{i({lat:ae.coords.latitude,lng:ae.coords.longitude,name:"Current Location"})})})()},[s]);const p=_=>{_.lat&&_.lng&&i({lat:_.lat,lng:_.lng,name:_.cityState||"Selected Location"})},[c,y]=r.useState("Musician"),[N,j]=r.useState("Play"),[k,E]=r.useState(""),[C,h]=r.useState(""),[f,R]=r.useState(""),[z,I]=r.useState(""),[S,w]=r.useState(""),[v,$]=r.useState(""),[B,M]=r.useState(""),[T,P]=r.useState("Any"),[A,F]=r.useState("Flat Rate"),[L,W]=r.useState([{id:Date.now(),type:"General",value:""}]),Z=Jt.filter(_=>_!=="Technician"),D=_=>{switch(_){case"Musician":return["Play","Compose","Improvise"];case"Engineer":return["Mix","Master","Record","Edit"];case"Producer":return["Produce","Remix","Arrange"];case"Studio":return["Host Session","Rent Gear"];default:return["Work"]}},Y=()=>W([...L,{id:Date.now(),type:"Gear",value:"",gearSelection:{}}]),q=_=>{L.length!==1&&W(L.filter(ae=>ae.id!==_))},J=(_,ae,de)=>W(L.map(G=>G.id===_?{...G,[ae]:de}:G)),ee=(_,ae,de)=>{W(L.map(G=>{if(G.id!==_)return G;const he={...G.gearSelection,[ae]:de};return ae==="category"&&(delete he.subCategory,delete he.type,delete he.item),ae==="subCategory"&&(delete he.type,delete he.item),ae==="type"&&delete he.item,{...G,gearSelection:he,value:de}}))},ne=async()=>{if(!f||!C)return alert("Please complete the request sentence.");if(c==="Musician"&&N==="Play"&&!k)return alert("Please select an instrument.");const _=L.filter(de=>de.value.trim()!=="");let ae=`${c} - ${N}`;k&&(ae+=` ${k}`);try{await we(le(O,`artifacts/${re}/public/data/bookings`),{senderId:t.uid,senderName:"Broadcast Request",targetId:"BROADCAST",targetName:f,role:c,action:N,instrument:k||null,genre:C,serviceType:ae,date:z||"Flexible",time:S||"Flexible",offerAmount:v?parseInt(v):null,references:B,experienceLevel:T,paymentType:A,requirements:_,message:_.map(de=>`[${de.type}] ${de.value}`).join(`
`),range:m,status:"Broadcasting",type:"Broadcast",location:{lat:u.lat,lng:u.lng},timestamp:ue()}),alert(`Broadcast sent to ${c}s within ${m} miles!`),n()}catch(de){console.error(de),alert("Failed to send broadcast.")}},me=[{label:"Gear / Equipment",value:"Gear",icon:bt},{label:"Technique / Skill",value:"Technique",icon:Oe},{label:"Feel / Vibe",value:"Vibe",icon:lt},{label:"Logistics",value:"Logistics",icon:Ie},{label:"General Note",value:"General",icon:Tr}];return e.jsxs("div",{className:"max-w-5xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-lg text-brand-blue",children:e.jsx(Le,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold dark:text-white",children:"Broadcast Builder"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Reach professionals in your area."})]})]}),e.jsx("button",{onClick:l,className:"text-sm font-medium text-gray-500 hover:text-brand-blue transition",children:"Cancel & Exit"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"lg:col-span-4 space-y-5",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-5 rounded-2xl border dark:border-gray-700",children:[e.jsx(Ja,{initialZip:s==null?void 0:s.zip,onLocationChange:p,label:"Broadcast Center"}),e.jsxs("div",{className:"mt-4 flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-extrabold text-gray-400 uppercase tracking-wider",children:"Range"}),e.jsxs("span",{className:"bg-brand-blue text-white text-xs font-bold px-2 py-1 rounded-md",children:[m," Miles"]})]}),e.jsx("div",{className:"mb-5 rounded-xl overflow-hidden border dark:border-gray-600 shadow-md relative h-48",children:e.jsx(Da,{center:[u.lat,u.lng],zoom:9,height:"100%",drawRadius:!0,radiusMiles:m})}),e.jsx("input",{type:"range",min:"0",max:g.length-1,value:b,onChange:_=>x(parseInt(_.target.value)),className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-brand-blue"})]})}),e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl border-2 border-blue-100 dark:border-gray-700 shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-brand-blue"}),e.jsx("label",{className:"text-xs font-extrabold text-brand-blue uppercase tracking-widest mb-4 block",children:"Step 1: Core Request"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-lg md:text-xl text-gray-700 dark:text-gray-200 leading-relaxed font-medium",children:[e.jsx("span",{children:"I need a"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("select",{value:c,onChange:_=>{y(_.target.value),j(D(_.target.value)[0])},className:"appearance-none bg-blue-50 dark:bg-gray-700 text-blue-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-blue-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-blue-100 dark:hover:bg-gray-600 transition",children:Z.map(_=>e.jsx("option",{value:_,children:_},_))}),e.jsx(dt,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-blue-500 dark:text-gray-400 pointer-events-none",size:16})]}),e.jsx("span",{children:"that can"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("select",{value:N,onChange:_=>j(_.target.value),className:"appearance-none bg-purple-50 dark:bg-gray-700 text-purple-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-purple-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-purple-100 dark:hover:bg-gray-600 transition",children:D(c).map(_=>e.jsx("option",{value:_,children:_},_))}),e.jsx(dt,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-purple-500 dark:text-gray-400 pointer-events-none",size:16})]}),(N==="Play"||N==="Improvise")&&e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("select",{value:k,onChange:_=>E(_.target.value),className:"appearance-none bg-green-50 dark:bg-gray-700 text-green-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-green-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-green-100 dark:hover:bg-gray-600 transition",children:[e.jsx("option",{value:"",children:"(Select Instrument)"}),Object.entries(Ml).map(([_,ae])=>e.jsx("optgroup",{label:_,children:ae.map(de=>e.jsx("option",{value:de,children:de},de))},_))]}),e.jsx(dt,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-green-500 dark:text-gray-400 pointer-events-none",size:16})]}),e.jsx("span",{children:"for a song in the"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("select",{value:C,onChange:_=>h(_.target.value),className:"appearance-none bg-orange-50 dark:bg-gray-700 text-orange-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-orange-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-orange-100 dark:hover:bg-gray-600 transition",children:[e.jsx("option",{value:"",children:"(Select Genre)"}),Fl.map(_=>e.jsx("option",{value:_,children:_},_))]}),e.jsx(dt,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-orange-500 dark:text-gray-400 pointer-events-none",size:16})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase mb-2 block",children:"Project Title"}),e.jsx("input",{className:"w-full bg-gray-50 dark:bg-black/20 border-none rounded-lg p-3 text-gray-700 dark:text-gray-200 font-medium placeholder-gray-400 focus:ring-2 focus:ring-brand-blue",placeholder:"e.g. Summer Hit Single - Drum Tracking",value:f,onChange:_=>R(_.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-5 rounded-xl border dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Logistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Date"}),e.jsx("input",{type:"date",className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:z,onChange:_=>I(_.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Time"}),e.jsx("input",{type:"time",className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:S,onChange:_=>w(_.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Budget ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute left-3 top-2.5 text-green-500",size:14}),e.jsx("input",{type:"number",className:"w-full pl-8 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm font-bold",placeholder:"Flexible",value:v,onChange:_=>$(_.target.value)})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-5 rounded-xl border dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Project Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Payment Type"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:A,onChange:_=>F(_.target.value),children:[e.jsx("option",{children:"Flat Rate"}),e.jsx("option",{children:"Hourly"}),e.jsx("option",{children:"Royalty Split"}),e.jsx("option",{children:"Trade / Barter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Experience Required"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:T,onChange:_=>P(_.target.value),children:[e.jsx("option",{children:"Any"}),e.jsx("option",{children:"Intermediate"}),e.jsx("option",{children:"Pro / Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Reference Link"}),e.jsxs("div",{className:"relative",children:[e.jsx($r,{className:"absolute left-3 top-2.5 text-gray-400",size:14}),e.jsx("input",{className:"w-full pl-8 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Spotify / SoundCloud...",value:B,onChange:_=>M(_.target.value)})]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsx("label",{className:"text-xs font-extrabold text-brand-blue uppercase tracking-widest",children:"Step 2: Specific Needs"}),e.jsxs("button",{onClick:Y,className:"text-xs bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-white px-3 py-1.5 rounded-full font-bold flex items-center gap-1 transition",children:[e.jsx(nt,{size:14})," Add Condition"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:L.map(_=>{var ae,de,G,he,se,je,Ne;return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 bg-gray-50 dark:bg-black/20 p-3 rounded-xl border dark:border-gray-700 animate-in slide-in-from-bottom-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 min-w-[140px]",children:e.jsx("select",{className:"w-full p-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2c2e36] dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:_.type,onChange:ge=>J(_.id,"type",ge.target.value),children:me.map(ge=>e.jsx("option",{value:ge.value,children:ge.label},ge.value))})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[_.type==="Gear"&&!d?e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsxs("select",{className:"w-full p-2 text-xs border rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:((ae=_.gearSelection)==null?void 0:ae.category)||"",onChange:ge=>ee(_.id,"category",ge.target.value),children:[e.jsx("option",{value:"",children:"Select Category..."}),a.map(ge=>e.jsx("option",{value:ge.id,children:ge.label},ge.id))]}),((de=_.gearSelection)==null?void 0:de.category)&&o[_.gearSelection.category]&&e.jsxs("select",{className:"w-full p-2 text-xs border rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:((G=_.gearSelection)==null?void 0:G.subCategory)||"",onChange:ge=>ee(_.id,"subCategory",ge.target.value),children:[e.jsx("option",{value:"",children:"Select Type..."}),Object.keys(o[_.gearSelection.category]).map(ge=>e.jsx("option",{value:ge,children:ge.replace(/_/g," ")},ge))]}),((he=_.gearSelection)==null?void 0:he.subCategory)&&e.jsxs("select",{className:"w-full p-2 text-xs border rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:((se=_.gearSelection)==null?void 0:se.type)||"",onChange:ge=>ee(_.id,"type",ge.target.value),children:[e.jsx("option",{value:"",children:"Select Subtype..."}),Object.keys(o[_.gearSelection.category][_.gearSelection.subCategory]).map(ge=>e.jsx("option",{value:ge,children:ge.replace(/_/g," ")},ge))]}),((je=_.gearSelection)==null?void 0:je.type)&&e.jsxs("select",{className:"w-full p-2 text-sm font-bold border-l-4 border-brand-blue rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white shadow-sm",value:((Ne=_.gearSelection)==null?void 0:Ne.item)||"",onChange:ge=>ee(_.id,"item",ge.target.value),children:[e.jsx("option",{value:"",children:"Select Specific Item..."}),o[_.gearSelection.category][_.gearSelection.subCategory][_.gearSelection.type].map(ge=>e.jsx("option",{value:ge,children:ge},ge))]})]}):e.jsx("input",{className:"w-full p-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2c2e36] dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-brand-blue",placeholder:"Describe requirement...",value:_.value,onChange:ge=>J(_.id,"value",ge.target.value)}),e.jsx("button",{onClick:()=>q(_.id),className:"text-gray-400 hover:text-red-500 px-2",children:e.jsx(_e,{size:18})})]})]},_.id)})}),e.jsx("div",{className:"h-6 w-0.5 bg-gray-200 dark:bg-gray-700 mx-auto my-2"}),e.jsxs("button",{className:"w-full bg-gradient-to-r from-brand-blue to-blue-600 text-white py-4 rounded-xl font-bold shadow-lg hover:scale-[1.01] transition-all text-lg flex items-center justify-center gap-2",onClick:ne,children:[e.jsx(Oe,{fill:"currentColor",size:20})," Broadcast Opportunity"]})]})]})]})]})}function Kn({user:t,userData:s,target:l,onClose:n}){var y;const[d,o]=r.useState(!1),[a,b]=r.useState([]),[x,g]=r.useState("me"),m=(y=s==null?void 0:s.accountTypes)==null?void 0:y.some(N=>["Label","Agent"].includes(N)),[u,i]=r.useState({date:"",time:"",duration:2,serviceType:"Session",offerAmount:l.rate?l.rate*2:100,message:""});r.useEffect(()=>{m&&(async()=>{try{const k=(await Xe(le(O,te(t.uid).labelRoster(t.uid)))).docs.map(E=>({id:E.id,...E.data()}));b(k)}catch(j){console.error("Roster fetch error",j)}})()},[m,t.uid]);const p=N=>{const j=N.target.value,k=j===""?"":parseInt(j);i(E=>({...E,duration:k,offerAmount:k&&l.rate?l.rate*k:E.offerAmount}))},c=async()=>{if(!u.date||!u.time||!u.message)return alert("Please fill in all required fields.");if(!u.duration||u.duration<=0)return alert("Duration must be at least 1 hour.");o(!0);try{const N=new Date(`${u.date}T${u.time}`);let j={senderId:t.uid,senderName:`${s.firstName} ${s.lastName}`,onBehalfOf:null};if(x!=="me"){const k=a.find(E=>E.artistId===x);k&&(j.senderName=`${s.firstName} (for ${k.name})`,j.onBehalfOf={id:k.artistId,name:k.name,photo:k.photoURL})}await we(le(O,`artifacts/${re}/public/data/bookings`),{...j,targetId:l.id,targetName:l.firstName?`${l.firstName} ${l.lastName}`:l.name,serviceType:u.serviceType,date:u.date,time:u.time,duration:Number(u.duration),offerAmount:Number(u.offerAmount),message:u.message,status:"Pending",timestamp:ue(),bookingStart:N,type:"Direct"}),alert("Booking request sent successfully!"),n()}catch(N){console.error("Booking failed:",N),alert("Failed to send booking request.")}o(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-in fade-in zoom-in-95",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Book Session"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["with ",e.jsx("span",{className:"text-brand-blue font-bold",children:l.firstName||l.name})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition text-gray-500 dark:text-gray-400",children:e.jsx(pe,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto space-y-5",children:[m&&a.length>0&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-3 rounded-xl border border-purple-100 dark:border-purple-800",children:[e.jsxs("label",{className:"text-xs font-bold text-purple-700 dark:text-purple-300 uppercase mb-1 flex items-center gap-1",children:[e.jsx(rt,{size:12})," Booking On Behalf Of:"]}),e.jsxs("select",{className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-purple-800/50 dark:text-white text-sm font-bold",value:x,onChange:N=>g(N.target.value),children:[e.jsxs("option",{value:"me",children:["Myself (",s.firstName,")"]}),a.map(N=>e.jsxs("option",{value:N.artistId,children:["Artist: ",N.name]},N.artistId))]})]}),l.rate&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl border border-blue-100 dark:border-blue-800 flex items-center gap-2 text-xs text-blue-700 dark:text-blue-300",children:[e.jsx(st,{size:14}),e.jsxs("span",{children:["Standard Rate: ",e.jsxs("strong",{children:["$",l.rate,"/hr"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{type:"date",className:"w-full pl-10 p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:u.date,onChange:N=>i({...u,date:N.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Start Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{type:"time",className:"w-full pl-10 p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:u.time,onChange:N=>i({...u,time:N.target.value})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Duration (Hrs)"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm font-bold",value:u.duration,onChange:p})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Total Offer ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute left-3 top-2.5 text-green-500",size:16}),e.jsx("input",{type:"number",className:"w-full pl-9 p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm font-bold text-green-600",value:u.offerAmount,onChange:N=>i({...u,offerAmount:N.target.value})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Type"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:u.serviceType,onChange:N=>i({...u,serviceType:N.target.value}),children:[e.jsx("option",{children:"Session"}),e.jsx("option",{children:"Lesson"}),e.jsx("option",{children:"Consultation"}),e.jsx("option",{children:"Mixing/Mastering"}),e.jsx("option",{children:"Rehearsal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Message / Requirements"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm min-h-[100px] resize-none",placeholder:"Describe what you need...",value:u.message,onChange:N=>i({...u,message:N.target.value})})]})]}),e.jsx("div",{className:"p-5 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("button",{onClick:c,disabled:d,className:"w-full bg-brand-blue text-white py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 shadow-lg disabled:opacity-50",children:d?e.jsx(oe,{className:"animate-spin"}):"Send Request"})})]})})}const Xn=Ts({sessionName:Ee().min(3,"Session name must be at least 3 chars"),date:Ee().optional(),time:Ee().optional(),duration:Kt().min(1).max(24)});function Qn({user:t,userData:s,cart:l,onRemoveFromCart:n,onClose:d,onComplete:o}){const[a,b]=r.useState(!1),{register:x,handleSubmit:g,watch:m,formState:{errors:u,isValid:i}}=Is({resolver:Ms(Xn),defaultValues:{sessionName:`${s.lastName} Session`,duration:4,date:"",time:""},mode:"onChange"}),p=m("duration")||0,c=()=>{let f=0;const R=parseInt(p)||0,z=l.map(v=>{const $=v.rate||0,B=$*R;return f+=B,{...v,itemTotal:B,hourlyRate:$}}),I=l.length>=3,S=I?f*.1:0,w=f-S;return{subtotal:f,discountAmount:S,finalTotal:w,lineItems:z,shouldDiscount:I}},{subtotal:y,discountAmount:N,finalTotal:j,lineItems:k,shouldDiscount:E}=c(),C=async f=>{b(!0);const R=X.loading("Initializing Session...");try{let z=null;const I=`session_${Date.now()}`,S=k.map(w=>{var v;return we(le(O,`artifacts/${re}/public/data/bookings`),{groupId:I,sessionName:f.sessionName,senderId:t.uid,senderName:`${s.firstName} ${s.lastName}`,targetId:w.id,targetName:`${w.firstName} ${w.lastName}`,serviceType:((v=w.accountTypes)==null?void 0:v[0])||"Session",date:f.date||"Flexible",time:f.time||"Flexible",duration:f.duration,offerAmount:w.itemTotal*(E?.9:1),status:"Pending",paymentIntentId:z,timestamp:ue(),type:"GroupSession"})});await Promise.all(S),X.success("Session Created!",{id:R}),o()}catch(z){console.error("Booking Error:",z),X.error("Failed: "+z.message,{id:R})}finally{b(!1)}},h=f=>Ra("w-full p-2 border rounded-lg dark:bg-black/20 dark:text-white transition-colors focus:ring-2 focus:ring-brand-blue outline-none",f?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-600");return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-in fade-in",children:e.jsxs("form",{onSubmit:g(C),className:"bg-white dark:bg-[#2c2e36] w-full max-w-2xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] rounded-t-2xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(Fe,{className:"text-brand-blue"})," Session Builder"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[l.length," Members Selected"]})]}),e.jsx("button",{type:"button",onClick:d,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(pe,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Session Name"}),e.jsx("input",{...x("sessionName"),className:h(u.sessionName),placeholder:"e.g. My Album Recording"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date (Optional)"}),e.jsx("input",{type:"date",...x("date"),className:h(u.date)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time (Optional)"}),e.jsx("input",{type:"time",...x("time"),className:h(u.time)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Duration (Hours)"}),e.jsx("input",{type:"number",...x("duration",{valueAsNumber:!0}),className:h(u.duration)})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-bold dark:text-white mb-3",children:"Session Roster"}),e.jsxs("div",{className:"space-y-2",children:[l.map(f=>{var R;return e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-[#2c2e36] p-2 rounded-lg border dark:border-gray-600 shadow-sm animate-in slide-in-from-right-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold",children:f.firstName[0]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-bold dark:text-white",children:[f.firstName," ",f.lastName]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(R=f.accountTypes)==null?void 0:R[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-mono",children:["$",f.rate,"/hr"]}),e.jsx("button",{type:"button",onClick:()=>n(f.id),className:"text-red-400 hover:text-red-600 transition-colors",children:e.jsx(_e,{size:14})})]})]},f.id)}),l.length===0&&e.jsx("div",{className:"text-center text-xs text-gray-400 py-4 italic",children:"No members added yet."})]})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx($e,{size:20})," Cost Breakdown"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-800 transition-all",children:[e.jsx("div",{className:"space-y-2 mb-4 text-sm",children:k.map(f=>e.jsxs("div",{className:"flex justify-between text-blue-900 dark:text-blue-100",children:[e.jsxs("span",{children:[f.firstName," (",f.accountTypes[0],") x ",p,"hrs"]}),e.jsxs("span",{className:"font-mono",children:["$",f.itemTotal.toFixed(2)]})]},f.id))}),e.jsxs("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-blue-800 dark:text-blue-300 font-bold",children:"Subtotal"}),e.jsxs("span",{className:"text-blue-800 dark:text-blue-300 font-bold font-mono",children:["$",y.toFixed(2)]})]}),E&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400 font-bold mt-2 animate-in slide-in-from-right-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Oe,{size:14,fill:"currentColor"})," Bundle Discount (10%)"]}),e.jsxs("span",{className:"font-mono",children:["-$",N.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-2xl font-black dark:text-white",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{className:"font-mono",children:["$",j.toFixed(2)]})]})]})]})]}),e.jsx("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] rounded-b-2xl",children:e.jsx("button",{type:"submit",disabled:a||l.length===0||!i,className:Pa("w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg flex items-center justify-center gap-2",a||l.length===0||!i?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"),children:a?e.jsx(oe,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:20})," Confirm & Book"]})})})]})})}const ms=[{id:"Pending",label:"Created",icon:Re},{id:"Confirmed",label:"Deposit",icon:$e},{id:"En Route",label:"En Route",icon:Aa},{id:"In Progress",label:"Started",icon:za},{id:"Completed",label:"Done",icon:ve}];function Jn({booking:t,user:s,onClose:l}){var p;const[n,d]=r.useState(t.status),[o,a]=r.useState(!1),b=s.uid===t.targetId,x=s.uid===t.senderId,m=(c=>{const y=ms.findIndex(N=>N.id===c);return y===-1?0:y})(n),u=async c=>{a(!0);try{await be(Q(O,`artifacts/${re}/public/data/bookings`,t.id),{status:c,[`statusTimestamps.${c}`]:ue()}),d(c),X.success(`Session ${c}`)}catch(y){console.error("Update failed:",y),X.error("Failed to update status")}a(!1)},i=m/(ms.length-1)*100;return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[90] p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-3xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:["Session Details ",e.jsxs("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded-full font-medium",children:["#",t.id.slice(-6).toUpperCase()]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["With ",x?t.targetName:t.senderName]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(pe,{size:20})})]}),e.jsxs("div",{className:"overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"relative pt-4 pb-8 px-4",children:[e.jsx("div",{className:"absolute top-8 left-0 w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full -z-10"}),e.jsx("div",{className:"absolute top-8 left-0 h-1.5 bg-brand-blue rounded-full -z-10 transition-all duration-700 ease-in-out",style:{width:`${i}%`}}),e.jsx("div",{className:"flex justify-between",children:ms.map((c,y)=>{const N=y<=m,j=y===m;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`
                                                w-10 h-10 rounded-full flex items-center justify-center border-4 transition-all duration-500
                                                ${N?"bg-brand-blue border-white dark:border-[#2c2e36] text-white":"bg-gray-200 dark:bg-gray-700 border-white dark:border-[#2c2e36] text-gray-400"}
                                                ${j?"scale-125 shadow-lg ring-4 ring-blue-100 dark:ring-blue-900/50":""}
                                            `,children:e.jsx(c.icon,{size:j?18:16,fill:N?"currentColor":"none"})}),e.jsx("span",{className:`text-xs font-bold uppercase tracking-wider transition-colors ${N?"text-brand-blue":"text-gray-400"}`,children:c.label})]},c.id)})})]}),b&&n!=="Completed"&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-blue-800 dark:text-blue-300",children:"Update Session Status"}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Keep the client informed."})]}),e.jsxs("div",{className:"flex gap-2",children:[n==="Pending"&&e.jsx("button",{onClick:()=>u("Confirmed"),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-green-700 transition shadow-sm",children:"Accept & Confirm"}),n==="Confirmed"&&e.jsxs("button",{onClick:()=>u("En Route"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-blue-700 transition shadow-sm flex items-center gap-1",children:[e.jsx(Aa,{size:14})," I'm En Route"]}),n==="En Route"&&e.jsxs("button",{onClick:()=>u("In Progress"),className:"bg-purple-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-purple-700 transition shadow-sm flex items-center gap-1",children:[e.jsx(Ps,{size:14})," Start Session"]}),n==="In Progress"&&e.jsxs("button",{onClick:()=>u("Completed"),className:"bg-gray-900 dark:bg-white dark:text-black text-white px-4 py-2 rounded-lg font-bold text-xs hover:opacity-90 transition shadow-sm flex items-center gap-1",children:[e.jsx(ve,{size:14})," Complete Session"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase border-b dark:border-gray-700 pb-2",children:"Logistics"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(Re,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Date"}),e.jsx("div",{className:"dark:text-white font-medium",children:t.date})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(Ie,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Time"}),e.jsxs("div",{className:"dark:text-white font-medium",children:[t.time," (",t.duration," hrs)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(Le,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Location"}),e.jsx("div",{className:"dark:text-white font-medium",children:((p=t.venue)==null?void 0:p.name)||"Remote / TBD"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase border-b dark:border-gray-700 pb-2",children:"Financials"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx($e,{size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Total Value"}),e.jsxs("div",{className:"dark:text-white font-mono font-bold text-lg",children:["$",t.offerAmount]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(Pt,{size:20,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Agreement"}),e.jsx("div",{className:"text-brand-blue text-xs font-bold cursor-pointer hover:underline",children:"View Contract"})]})]})]})]}),t.message&&e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Notes"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 italic",children:['"',t.message,'"']})]})]})]})})}function Dn({user:t,userData:s,openPublicProfile:l}){var F;const[n,d]=r.useState("search"),[o,a]=r.useState("list"),[b,x]=r.useState("outgoing"),[g,m]=r.useState([]),[u,i]=r.useState([]),[p,c]=r.useState(!0),[y,N]=r.useState("wizard"),[j,k]=r.useState(!1),[E,C]=r.useState({date:"",time:"",location:null,radius:25,urgency:"Normal",venue:null}),[h,f]=r.useState([]),[R,z]=r.useState(!1),[I,S]=r.useState(null),[w,v]=r.useState(null);r.useEffect(()=>{if(!(t!=null&&t.uid))return;c(!0);const L=ye(le(O,`artifacts/${re}/public/data/bookings`),Ce("senderId","==",t.uid)),W=ye(le(O,`artifacts/${re}/public/data/bookings`),Ce("targetId","==",t.uid)),Z=fe(L,Y=>{i(Y.docs.map(q=>({id:q.id,...q.data()}))),c(!1)}),D=fe(W,Y=>{m(Y.docs.map(q=>({id:q.id,...q.data()}))),c(!1)});return()=>{Z(),D()}},[t==null?void 0:t.uid]);const $=L=>{S(L),z(!0)},B=()=>N("talent"),M=L=>{if(h.find(W=>W.id===L.id))return X.error("Already added.");f([...h,L]),X.success("Added to Session")},T=L=>f(h.filter(W=>W.id!==L)),P=()=>{k(!1),N("wizard"),f([]),C({date:"",time:"",location:null,radius:25,urgency:"Normal",venue:null}),d("requests")},A=(L,W)=>L.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400 border-2 border-dashed dark:border-gray-700 rounded-2xl",children:[e.jsx(Re,{size:48,className:"mb-4 opacity-20"}),e.jsxs("p",{children:["No ",W==="outgoing"?"outgoing":"incoming"," bookings found."]})]}):e.jsx("div",{className:"grid gap-4",children:L.map(Z=>{var D,Y;return e.jsx("div",{onClick:()=>v(Z),className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm hover:border-brand-blue transition group cursor-pointer",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-lg font-bold",children:W==="outgoing"?(D=Z.targetName)==null?void 0:D[0]:(Y=Z.senderName)==null?void 0:Y[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:W==="outgoing"?Z.targetName:Z.senderName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-xs",children:Z.serviceType||"Session"}),Z.date&&e.jsxs("span",{children:["• ",Z.date]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide inline-block mb-1 ${Z.status==="Pending"?"bg-yellow-100 text-yellow-700":Z.status==="Confirmed"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:Z.status}),e.jsxs("div",{className:"font-mono font-bold dark:text-white",children:["$",Z.offerAmount]})]})]})},Z.id)})});return e.jsxs("div",{className:"max-w-7xl mx-auto relative min-h-screen pb-20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-end mb-6 border-b dark:border-gray-700 gap-4",children:[e.jsxs("div",{className:"flex gap-6 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>d("broadcasts"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${n==="broadcasts"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Oe,{size:16})," Open Jobs"]}),e.jsxs("button",{onClick:()=>d("search"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${n==="search"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Be,{size:16})," Talent Search"]})]}),e.jsxs("div",{className:"flex gap-6 w-full sm:w-auto justify-end",children:[e.jsxs("button",{onClick:()=>d("planner"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${n==="planner"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Re,{size:16})," Session Planner"]}),e.jsxs("button",{onClick:()=>d("requests"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${n==="requests"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Ie,{size:16})," My Bookings"]})]})]}),e.jsxs("div",{className:"tab-content-wrapper",children:[n==="broadcasts"&&e.jsx("div",{className:"tab-content",children:o==="create_broadcast"?e.jsx(Zn,{user:t,userData:s,onBack:()=>a("list"),onSuccess:()=>a("list")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>a("create_broadcast"),className:"bg-brand-blue text-white px-4 py-2 rounded-lg font-bold text-sm shadow-lg hover:bg-blue-600 transition flex items-center gap-2",children:[e.jsx(Oe,{size:16})," New Broadcast"]})}),e.jsx(Yn,{user:t,userData:s})]})},"broadcasts"),n==="search"&&e.jsx("div",{className:"tab-content",children:e.jsx(ia,{user:t,userData:s,openPublicProfile:l,onBook:$,mode:"direct"})},"search"),n==="requests"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Booking Management"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Track your sessions and requests."})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex",children:[e.jsx("button",{onClick:()=>x("outgoing"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${b==="outgoing"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"I Booked"}),e.jsx("button",{onClick:()=>x("incoming"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${b==="incoming"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"Booked Me"})]})]}),b==="outgoing"?A(u,"outgoing"):A(g,"incoming")]},"requests"),n==="planner"&&e.jsxs("div",{className:"tab-content",children:[y==="wizard"&&e.jsx(qn,{userData:s,sessionParams:E,setSessionParams:C,onNext:B}),y==="talent"&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 mb-6 flex justify-between items-center shadow-lg sticky top-4 z-40",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Re,{size:18,className:"text-brand-blue"})," ",E.date||"Flexible Date"," @ ",((F=E.venue)==null?void 0:F.name)||"Remote"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[h.length," talent added"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N("wizard"),className:"text-xs font-bold text-gray-500 hover:text-gray-900 dark:hover:text-white px-3 py-2",children:"Back"}),e.jsxs("button",{onClick:()=>k(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-green-700 shadow flex items-center gap-2",children:[e.jsx(ve,{size:16})," Review Session"]})]})]}),e.jsx(ia,{user:t,userData:s,openPublicProfile:l,onAddToCart:M,sessionCartIds:h.map(L=>L.id),mode:"planner"})]})]},"planner")]}),e.jsxs(e.Fragment,{children:[R&&I&&e.jsx(Kn,{user:t,userData:s,target:I,allInstruments:[],onClose:()=>z(!1)}),j&&e.jsx(Qn,{user:t,userData:s,cart:[...E.venue&&E.venue.id!=="remote"?[{...E.venue,accountTypes:["Studio"]}]:[],...h],onRemoveFromCart:T,onClose:()=>k(!1),onComplete:P}),w&&e.jsx(Jn,{booking:w,user:t,onClose:()=>v(null)})]})]})}const ei=[{id:"guitar_electric",label:"Electric Guitar"},{id:"guitar_acoustic",label:"Acoustic Guitar"},{id:"amp_head",label:"Amplifier Head"},{id:"amp_combo",label:"Combo Amp"},{id:"keyboard",label:"Keyboard/Synth"},{id:"rack_unit",label:"Rack Gear (1U/2U)"},{id:"pedal",label:"Pedal/Stompbox"}],tr=({type:t,view:s,onClick:l,markers:n=[]})=>{var g;const d=()=>n.map((m,u)=>e.jsxs("g",{transform:`translate(${m.x}, ${m.y})`,children:[e.jsx("circle",{r:"6",fill:"#ef4444",stroke:"white",strokeWidth:"2",className:"drop-shadow-md"}),e.jsx("text",{y:"-10",textAnchor:"middle",fill:"#ef4444",fontSize:"10",fontWeight:"bold",children:u+1})]},u)),o={width:"100%",height:"400",viewBox:"0 0 300 400",className:"w-full h-full cursor-crosshair touch-none select-none",onClick:m=>{const u=m.target.getBoundingClientRect(),i=(m.clientX-u.left)*(300/u.width),p=(m.clientY-u.top)*(400/u.height);l(i,p)}},a={guitar_electric:{front:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2",strokeDasharray:"5,5"})},amp_combo:{front:e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsxs("g",{children:[e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2"}),e.jsx("rect",{x:"70",y:"200",width:"160",height:"80",fill:"#9ca3af",opacity:"0.5"})]})}},b=()=>e.jsx("rect",{x:"50",y:"50",width:"200",height:"300",rx:"10",fill:"#f3f4f6",stroke:"#9ca3af",strokeWidth:"2",strokeDasharray:"4"}),x=((g=a[t])==null?void 0:g[s])||e.jsx(b,{});return e.jsxs("svg",{...o,children:[x,d()]})};function ti({initialData:t,onSave:s,onCancel:l,type:n}){const[d,o]=r.useState((t==null?void 0:t.gearType)||"guitar_electric"),[a,b]=r.useState("front"),[x,g]=r.useState((t==null?void 0:t.markers)||[]),[m,u]=r.useState((t==null?void 0:t.notes)||""),[i,p]=r.useState((t==null?void 0:t.photos)||[]),[c,y]=r.useState(null),[N,j]=r.useState(""),{uploadMedia:k,uploading:E}=it(),C=(R,z)=>{const I={x:R,y:z,view:a,id:Date.now(),label:""};g([...x,I]),y(I),j("")},h=()=>{c&&(g(x.map(R=>R.id===c.id?{...R,label:N}:R)),y(null))},f=async R=>{const z=R.target.files[0];if(!z)return;const I=await k(z,`inspections/${Date.now()}`);I&&p(S=>[...S,I])};return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden flex flex-col h-[80vh]",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(st,{className:n==="Pre"?"text-orange-500":"text-green-500",size:20})," ",n,"-Inspection Report"]}),e.jsx("button",{onClick:l,children:e.jsx(pe,{className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-black/40 relative flex flex-col items-center justify-center p-4",children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[e.jsx("select",{className:"p-2 rounded-lg border dark:border-gray-600 bg-white dark:bg-[#1f2128] text-sm font-bold dark:text-white shadow-sm",value:d,onChange:R=>o(R.target.value),children:ei.map(R=>e.jsx("option",{value:R.id,children:R.label},R.id))}),e.jsx("div",{className:"flex bg-white dark:bg-[#1f2128] rounded-lg border dark:border-gray-600 p-1 shadow-sm",children:["front","back","sides"].map(R=>e.jsx("button",{onClick:()=>b(R),className:`px-3 py-1 text-xs font-bold rounded-md capitalize ${a===R?"bg-brand-blue text-white":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:R},R))})]}),e.jsxs("div",{className:"w-full max-w-md h-full aspect-[3/4] bg-white dark:bg-[#1f2128] rounded-xl shadow-inner border dark:border-gray-700 relative",children:[e.jsx(tr,{type:d,view:a,markers:x.filter(R=>R.view===a),onClick:C}),c&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 bg-white dark:bg-[#2c2e36] p-4 rounded-xl shadow-2xl border border-brand-blue z-20 animate-in zoom-in-95",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 mb-2",children:"Identify Issue"}),e.jsx("input",{autoFocus:!0,className:"w-full p-2 border rounded mb-2 text-sm dark:bg-black/20 dark:text-white",placeholder:"e.g. Scratch",value:N,onChange:R=>j(R.target.value),onKeyDown:R=>R.key==="Enter"&&h()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{g(x.filter(R=>R.id!==c.id)),y(null)},className:"flex-1 bg-red-100 text-red-600 py-1 rounded text-xs font-bold",children:"Delete"}),e.jsx("button",{onClick:h,className:"flex-1 bg-brand-blue text-white py-1 rounded text-xs font-bold",children:"Save"})]})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Damage Log"}),e.jsx("div",{className:"space-y-2",children:x.map((R,z)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-black/20 rounded border dark:border-gray-700",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-red-500 text-white flex items-center justify-center text-xs font-bold shrink-0",children:z+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:R.label||"Unlabeled"}),e.jsxs("div",{className:"text-[10px] text-gray-500 uppercase",children:[R.view," View"]})]}),e.jsx("button",{onClick:()=>g(x.filter(I=>I.id!==R.id)),children:e.jsx(pe,{size:14,className:"text-gray-400 hover:text-red-500"})})]},z))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Notes"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg text-sm dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Overall condition...",value:m,onChange:R=>u(R.target.value)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Evidence Photos"}),e.jsxs("label",{className:"cursor-pointer text-brand-blue hover:text-blue-600",children:[e.jsx(Tt,{size:16}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:f,disabled:E})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:i.map((R,z)=>e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden border dark:border-gray-600 relative group",children:[e.jsx("img",{src:R.url,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>p(i.filter((I,S)=>S!==z)),className:"absolute top-1 right-1 bg-red-500 text-white p-0.5 rounded opacity-0 group-hover:opacity-100 transition",children:e.jsx(pe,{size:12})})]},z))})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:()=>s({gearType:d,markers:x,notes:m,photos:i,timestamp:new Date().toISOString()}),className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(tt,{size:18})," Finalize Report"]})})]})]})]})}const qt=(t,s,l,n)=>{const o=t*Math.PI/180,a=l*Math.PI/180,b=(l-t)*Math.PI/180,x=(n-s)*Math.PI/180,g=Math.sin(b/2)*Math.sin(b/2)+Math.cos(o)*Math.cos(a)*Math.sin(x/2)*Math.sin(x/2);return 6371e3*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))};function si(t,s){const[l,n]=r.useState(null),[d,o]=r.useState(null),[a,b]=r.useState(!1),[x,g]=r.useState(null),[m,u]=r.useState([]),[i,p]=r.useState(null),[c,y]=r.useState(null),[N,j]=r.useState(!1),[k,E]=r.useState(!0),[C,h]=r.useState(null),f=r.useRef(Date.now());r.useEffect(()=>{(async()=>{try{const M=le(O,`artifacts/${re}/public/data/safe_zones`),T=await Xe(M);T.empty?u([]):u(T.docs.map(P=>({id:P.id,...P.data()})))}catch(M){console.error("Failed to load safe zones:",M)}})()},[]);const R=r.useCallback(()=>{if(!navigator.geolocation){o("Geolocation is not supported by your browser"),E(!1);return}const B={enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3},M=A=>{const{latitude:F,longitude:L,accuracy:W}=A.coords;n({lat:F,lng:L,accuracy:W,timestamp:Date.now()}),o(null),E(!1),f.current=Date.now()},T=A=>{let F;switch(A.code){case A.PERMISSION_DENIED:F="Location permission denied. Please enable location access.";break;case A.POSITION_UNAVAILABLE:F="Location information unavailable.";break;case A.TIMEOUT:F="Location request timed out.";break;default:F="An unknown error occurred getting location."}o(F),E(!1)},P=navigator.geolocation.watchPosition(M,T,B);return h(P),()=>{P&&navigator.geolocation.clearWatch(P)}},[]),z=r.useCallback(()=>{C&&(navigator.geolocation.clearWatch(C),h(null))},[C]);r.useEffect(()=>{if(!l||m.length===0){b(!1);return}let B=null,M=1/0,T=!1;for(const P of m){if(!P.lat||!P.lng)continue;const A=qt(l.lat,l.lng,P.lat,P.lng);A<M&&(M=A,B={...P,distance:A}),A<=Bl&&(T=!0)}g(B),b(T)},[l,m]),r.useEffect(()=>{if(!l||!i){y(null),j(!1);return}const B=qt(l.lat,l.lng,i.lat,i.lng);y(B),j(B<=xs)},[l,i]);const I=r.useCallback(B=>{p(B)},[]),S=r.useCallback(async()=>{if(!l)return[];try{const B=["police","fire_station","bank","library","townhall"],M=[];for(const T of B)try{const P=await fetch(`https://nominatim.openstreetmap.org/search?q=${T}&format=json&lat=${l.lat}&lon=${l.lng}&bounded=1&viewbox=${l.lng-.1},${l.lat+.1},${l.lng+.1},${l.lat-.1}&limit=5`,{headers:{"User-Agent":"SeshNx-SafeExchange/1.0"}});if(P.ok){const A=await P.json();for(const F of A){const L=qt(l.lat,l.lng,parseFloat(F.lat),parseFloat(F.lon)),W=Ol.find(Z=>T.includes(Z.id.split("_")[0]));M.push({id:`osm_${F.place_id}`,name:F.display_name.split(",")[0],address:F.display_name,lat:parseFloat(F.lat),lng:parseFloat(F.lon),distance:L,type:(W==null?void 0:W.id)||"public_building",typeLabel:(W==null?void 0:W.label)||"Public Building",priority:(W==null?void 0:W.priority)||10})}}}catch(P){console.warn(`Failed to fetch ${T}:`,P)}return M.sort((T,P)=>T.priority!==P.priority?T.priority-P.priority:T.distance-P.distance),M.slice(0,10)}catch(B){return console.error("Failed to find nearby safe zones:",B),[]}},[l]),w=r.useCallback(async B=>{try{const M=le(O,`artifacts/${re}/public/data/safe_zones`);return(await we(M,{...B,createdAt:ue(),verified:!1})).id}catch(M){throw console.error("Failed to create safe zone:",M),M}},[]),v=r.useCallback(()=>!l||!x?{verified:!1,message:"Unable to verify location"}:a?{verified:!0,zone:x,message:`Arrived at ${x.name}`,timestamp:Date.now()}:{verified:!1,message:`Not within safe zone. ${Math.round(x.distance)}m from ${x.name}`,nearestZone:x},[l,x,a]),$=r.useCallback(()=>!l||!i?{verified:!1,message:"Unable to verify proximity - waiting for other party location"}:N?{verified:!0,distance:c,message:`Both parties are within ${xs}m`,timestamp:Date.now()}:{verified:!1,distance:c,message:`Other party is ${Math.round(c)}m away. Must be within ${xs}m to proceed.`},[l,i,N,c]);return{currentPosition:l,locationError:d,loading:k,isInSafeZone:a,nearestSafeZone:x,safeZones:m,otherPartyPosition:i,proximityToOther:c,isWithinProximity:N,startWatching:R,stopWatching:z,findNearbySafeZones:S,createSafeZone:w,updateOtherPartyPosition:I,verifyArrival:v,verifyProximity:$,calculateDistance:qt}}function ca({mode:t="capture",role:s="seller",listingPhotos:l=[],sellerDeparturePhotos:n=[],itemDescription:d="",onPhotosSubmitted:o,onVerificationComplete:a,requiredPhotoCount:b=3,userId:x}){const[g,m]=r.useState([]),[u,i]=r.useState(0),[p,c]=r.useState(!1),[y,N]=r.useState(0),[j,k]=r.useState(null),[E,C]=r.useState(""),[h,f]=r.useState(!1),[R,z]=r.useState(!1),I=r.useRef(null),S=r.useRef(null),w=r.useRef(null),{uploadMedia:v,uploading:$}=it(),B=r.useCallback(async()=>{try{const D=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});I.current&&(I.current.srcObject=D,w.current=D,f(!0))}catch(D){console.error("Failed to access camera:",D),alert("Unable to access camera. Please check permissions.")}},[]),M=r.useCallback(()=>{w.current&&(w.current.getTracks().forEach(D=>D.stop()),w.current=null),f(!1)},[]),T=r.useCallback(async()=>{if(!I.current||!S.current)return;const D=I.current,Y=S.current;Y.width=D.videoWidth,Y.height=D.videoHeight,Y.getContext("2d").drawImage(D,0,0),Y.toBlob(async J=>{if(J)try{const ee=new File([J],`verification_${Date.now()}.jpg`,{type:"image/jpeg"}),ne=await v(ee,`safe_exchange/${x}/verification`);ne!=null&&ne.url&&m(me=>[...me,{url:ne.url,timestamp:Date.now(),type:s==="seller"?"departure":"inspection"}])}catch(ee){console.error("Failed to upload photo:",ee)}},"image/jpeg",.9)},[v,x,s]),P=async D=>{const Y=D.target.files[0];if(Y)try{const q=await v(Y,`safe_exchange/${x}/verification`);q!=null&&q.url&&m(J=>[...J,{url:q.url,timestamp:Date.now(),type:s==="seller"?"departure":"inspection"}])}catch(q){console.error("Failed to upload photo:",q)}},A=D=>{m(Y=>Y.filter((q,J)=>J!==D)),u>=g.length-1&&i(Math.max(0,g.length-2))},F=async()=>{if(g.length<b){alert(`Please capture at least ${b} photos.`);return}z(!0);try{await(o==null?void 0:o(g,E))}finally{z(!1),M()}},L=async D=>{k(D),z(!0);try{await(a==null?void 0:a({result:D,notes:E,buyerPhotos:g,timestamp:Date.now()}))}finally{z(!1)}},W=()=>{var D;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 p-6 rounded-xl text-white",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:s==="seller"?"📦 Pre-Departure Photos":"🔍 Inspection Photos"}),e.jsx("p",{className:"text-sm opacity-90",children:s==="seller"?"Take clear photos of the item before leaving for the exchange. These will be shown to the buyer for verification.":"Take photos of the item as received. Compare with seller's photos to verify condition."})]}),e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:h?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:I,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:S,className:"hidden"}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-4",children:[e.jsx("button",{onClick:M,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full backdrop-blur-sm transition",children:e.jsx(pe,{className:"text-white",size:24})}),e.jsx("button",{onClick:T,disabled:$,className:"p-5 bg-white rounded-full shadow-lg hover:scale-110 transition disabled:opacity-50",children:e.jsx(Je,{className:$?"animate-pulse text-orange-500":"text-gray-900",size:32})}),e.jsx("button",{className:"p-3 bg-white/20 rounded-full opacity-0 pointer-events-none",children:e.jsx(pe,{size:24})})]})]}):g.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:(D=g[u])==null?void 0:D.url,alt:`Photo ${u+1}`,className:"w-full h-full object-contain"}),g.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i(Math.max(0,u-1)),className:"absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full hover:bg-black/70",disabled:u===0,children:e.jsx(rs,{className:"text-white"})}),e.jsx("button",{onClick:()=>i(Math.min(g.length-1,u+1)),className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full hover:bg-black/70",disabled:u===g.length-1,children:e.jsx(Ke,{className:"text-white"})})]}),e.jsxs("div",{className:"absolute top-4 right-4 bg-black/60 text-white text-sm px-3 py-1 rounded-full",children:[u+1," / ",g.length]}),e.jsx("button",{onClick:()=>A(u),className:"absolute top-4 left-4 p-2 bg-red-600 rounded-full hover:bg-red-700",children:e.jsx(pe,{className:"text-white",size:16})})]}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(Je,{size:64,className:"mb-4 opacity-30"}),e.jsx("p",{children:"No photos captured yet"})]})}),g.length>0&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[g.map((Y,q)=>e.jsx("button",{onClick:()=>i(q),className:`relative shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition ${q===u?"border-orange-500 ring-2 ring-orange-500/30":"border-transparent hover:border-gray-400"}`,children:e.jsx("img",{src:Y.url,alt:"",className:"w-full h-full object-cover"})},q)),g.length<10&&e.jsx("button",{onClick:B,className:"shrink-0 w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center hover:border-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition",children:e.jsx(Je,{className:"text-gray-400",size:20})})]}),e.jsx("div",{className:"flex gap-3",children:!h&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:B,className:"flex-1 bg-gray-900 dark:bg-white dark:text-black text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition",children:[e.jsx(Je,{size:20})," Open Camera"]}),e.jsxs("label",{className:"flex-1 bg-gray-100 dark:bg-gray-800 py-3 rounded-xl font-bold flex items-center justify-center gap-2 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition",children:[e.jsx(Tt,{size:20})," Upload Photo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:P})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:E,onChange:Y=>C(Y.target.value),placeholder:s==="seller"?"Any notes about current condition...":"Note any concerns or observations...",className:"w-full p-3 border rounded-xl dark:bg-gray-800 dark:border-gray-600 dark:text-white resize-none",rows:3})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-bold dark:text-white",children:["Photos: ",g.length," / ",b," required"]}),g.length>=b&&e.jsx(ve,{className:"text-green-500",size:20})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${Math.min(100,g.length/b*100)}%`}})})]}),e.jsx("button",{onClick:F,disabled:g.length<b||R,className:"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-700 transition shadow-lg",children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{size:20})," Submit Photos"]})})]})},Z=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-6 rounded-xl text-white",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"🔍 Verify Item Condition"}),e.jsx("p",{className:"text-sm opacity-90",children:"Compare the seller's pre-departure photos with the item in front of you. Does it match the listing description?"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Seller's Photo (",y+1,"/",n.length,")"]}),e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-square",children:n[y]?e.jsx("img",{src:n[y].url,alt:"Seller's photo",className:"w-full h-full object-contain"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No photo available"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Original Listing (",y+1,"/",l.length,")"]}),e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-square",children:l[y]?e.jsx("img",{src:l[y],alt:"Listing photo",className:"w-full h-full object-contain"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No photo available"})})]})]}),e.jsx("div",{className:"flex justify-center gap-2",children:Array.from({length:Math.max(n.length,l.length)}).map((D,Y)=>e.jsx("button",{onClick:()=>N(Y),className:`w-3 h-3 rounded-full transition ${Y===y?"bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},Y))}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white mb-2",children:"📋 Listing Description"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:d||"No description provided"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-bold dark:text-white text-center",children:"Does the item match the photos and description?"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>L("match"),disabled:R,className:"p-4 bg-green-100 dark:bg-green-900/30 border-2 border-green-500 rounded-xl flex flex-col items-center gap-2 hover:bg-green-200 dark:hover:bg-green-900/50 transition",children:[e.jsx(ve,{className:"text-green-600",size:32}),e.jsx("span",{className:"font-bold text-green-700 dark:text-green-400",children:"Yes, Matches"})]}),e.jsxs("button",{onClick:()=>L("unsure"),disabled:R,className:"p-4 bg-yellow-100 dark:bg-yellow-900/30 border-2 border-yellow-500 rounded-xl flex flex-col items-center gap-2 hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition",children:[e.jsx(Ir,{className:"text-yellow-600",size:32}),e.jsx("span",{className:"font-bold text-yellow-700 dark:text-yellow-400",children:"Unsure"})]}),e.jsxs("button",{onClick:()=>L("mismatch"),disabled:R,className:"p-4 bg-red-100 dark:bg-red-900/30 border-2 border-red-500 rounded-xl flex flex-col items-center gap-2 hover:bg-red-200 dark:hover:bg-red-900/50 transition",children:[e.jsx(La,{className:"text-red-600",size:32}),e.jsx("span",{className:"font-bold text-red-700 dark:text-red-400",children:"No, Different"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Describe Any Concerns"}),e.jsx("textarea",{value:E,onChange:D=>C(D.target.value),placeholder:"Note any differences, damage, or concerns...",className:"w-full p-3 border rounded-xl dark:bg-gray-800 dark:border-gray-600 dark:text-white resize-none",rows:3})]})]});return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[t==="capture"&&W(),t==="compare"&&Z()]})}function ai({transactionId:t,user:s,userData:l,onClose:n,onComplete:d,onMessage:o}){var me,_,ae,de,G,he;const[a,b]=r.useState(null),[x,g]=r.useState(!0),[m,u]=r.useState(!1),[i,p]=r.useState(null),[c,y]=r.useState(""),[N,j]=r.useState(""),[k,E]=r.useState(!1),[C,h]=r.useState([]),[f,R]=r.useState(null),z=(a==null?void 0:a.sellerId)===(s==null?void 0:s.uid),I=(a==null?void 0:a.buyerId)===(s==null?void 0:s.uid),S=z?"seller":"buyer",{currentPosition:w,isInSafeZone:v,nearestSafeZone:$,isWithinProximity:B,startWatching:M,findNearbySafeZones:T}=si(t,s==null?void 0:s.uid);r.useEffect(()=>{if(!t)return;const se=Q(O,`artifacts/${re}/public/data/safe_exchange_transactions`,t),je=fe(se,Ne=>{Ne.exists()&&b({id:Ne.id,...Ne.data()}),g(!1)});return()=>je()},[t]),r.useEffect(()=>{if(!a||!w)return;(async()=>{try{const je=Q(O,`artifacts/${re}/public/data/safe_exchange_transactions`,t);await be(je,{[`${S}Location`]:{lat:w.lat,lng:w.lng,updatedAt:Date.now()}})}catch(je){console.error("Failed to update position:",je)}})()},[w,a,t,S]),r.useEffect(()=>{k&&w&&T().then(se=>h(se))},[k,w,T]);const P=r.useCallback(async(se,je={})=>{if(t){u(!0);try{const Ne=Q(O,`artifacts/${re}/public/data/safe_exchange_transactions`,t);await be(Ne,{status:se,[`statusHistory.${se}`]:{timestamp:Date.now(),userId:s.uid},...je,updatedAt:ue()}),await A(se)}catch(Ne){console.error("Failed to update status:",Ne),alert("Failed to update transaction. Please try again.")}u(!1)}},[t,s==null?void 0:s.uid]),A=async se=>{const je=z?a.buyerId:a.sellerId,Ne=le(O,te(je).notifications),ge={[ie.MEETUP_SCHEDULED]:`Meetup scheduled for ${a.meetupDate} at ${a.meetupTime}`,[ie.SELLER_EN_ROUTE]:"Seller is on their way to the exchange location",[ie.BUYER_EN_ROUTE]:"Buyer is on their way to the exchange location",[ie.AT_SAFE_ZONE]:`${z?"Seller":"Buyer"} has arrived at the safe zone`,[ie.SELLER_PHOTOS_UPLOADED]:"Seller has uploaded pre-departure photos",[ie.BUYER_APPROVED]:"Buyer has approved the exchange",[ie.SELLER_APPROVED]:"Seller has approved the exchange",[ie.COMPLETED]:"🎉 Exchange completed! Funds have been released.",[ie.DISPUTED]:"⚠️ A dispute has been raised on the transaction"};await we(Ne,{type:"safe_exchange",transactionId:t,message:ge[se]||`Transaction status updated: ${se}`,itemTitle:a.itemTitle,read:!1,createdAt:ue()})},F=async()=>{if(!i||!c||!N){alert("Please select a safe zone and set a date/time.");return}await P(ie.MEETUP_SCHEDULED,{meetupLocation:i,meetupDate:c,meetupTime:N}),E(!1)},L=()=>{R("seller_depart"),M()},W=async(se,je)=>{await P(ie.SELLER_PHOTOS_UPLOADED,{sellerDeparturePhotos:se,sellerDepartureNotes:je}),R(null),await P(ie.SELLER_EN_ROUTE)},Z=()=>{M(),P(ie.BUYER_EN_ROUTE)},D=async se=>{await P(ie.BUYER_PHOTOS_UPLOADED,{buyerInspectionResult:se.result,buyerInspectionPhotos:se.buyerPhotos,buyerInspectionNotes:se.notes}),se.result==="mismatch"?await P(ie.DISPUTED):await P(ie.PENDING_DUAL_APPROVAL),R(null)},Y=async()=>{const se=z?"sellerApproved":"buyerApproved",je=z?ie.SELLER_APPROVED:ie.BUYER_APPROVED;await P(je,{[se]:!0,[`${se}At`]:Date.now()}),(z?a.buyerApproved:a.sellerApproved)&&await q()},q=async()=>{await P(ie.COMPLETED,{completedAt:ue()}),await be(Q(O,`artifacts/${re}/public/data/safe_exchange_transactions`,t),{fundsReleased:!0,fundsReleasedAt:ue()}),d==null||d()},J=async()=>{confirm("Are you sure you want to cancel this transaction? This may affect your seller rating.")&&(await P(ie.CANCELLED,{cancelledBy:s.uid,cancelledAt:ue()}),n==null||n())},ee=async se=>{await P(ie.DISPUTED,{disputeReason:se,disputeRaisedBy:s.uid,disputeRaisedAt:ue()})},ne=()=>({[ie.INTENT_CREATED]:0,[ie.HOLD_PLACED]:1,[ie.SELLER_NOTIFIED]:1,[ie.MEETUP_SCHEDULED]:2,[ie.SELLER_EN_ROUTE]:3,[ie.SELLER_PHOTOS_UPLOADED]:3,[ie.BUYER_EN_ROUTE]:4,[ie.AT_SAFE_ZONE]:4,[ie.BUYER_INSPECTING]:5,[ie.BUYER_PHOTOS_UPLOADED]:5,[ie.PENDING_DUAL_APPROVAL]:6,[ie.SELLER_APPROVED]:6,[ie.BUYER_APPROVED]:6,[ie.COMPLETED]:7})[a==null?void 0:a.status]||0;return x?e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[80]",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-8 rounded-2xl flex flex-col items-center gap-4",children:[e.jsx(oe,{className:"animate-spin text-orange-500",size:48}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading transaction..."})]})}):f==="seller_depart"?e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[80] overflow-y-auto",children:e.jsx("div",{className:"min-h-screen p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsxs("button",{onClick:()=>R(null),className:"mb-4 text-white flex items-center gap-2 hover:underline",children:[e.jsx(pe,{size:20})," Cancel"]}),e.jsx(ca,{mode:"capture",role:"seller",listingPhotos:a.itemPhotos||[],itemDescription:a.itemDescription,onPhotosSubmitted:W,requiredPhotoCount:3,userId:s.uid})]})})}):f==="buyer_inspect"?e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[80] overflow-y-auto",children:e.jsx("div",{className:"min-h-screen p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsxs("button",{onClick:()=>R(null),className:"mb-4 text-white flex items-center gap-2 hover:underline",children:[e.jsx(pe,{size:20})," Cancel"]}),e.jsx(ca,{mode:"compare",role:"buyer",listingPhotos:a.itemPhotos||[],sellerDeparturePhotos:a.sellerDeparturePhotos||[],itemDescription:a.itemDescription,onVerificationComplete:D,requiredPhotoCount:2,userId:s.uid})]})})}):e.jsxs("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden my-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 p-6 text-white relative overflow-hidden",children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition",children:e.jsx(pe,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 text-orange-200 text-xs font-bold uppercase tracking-widest mb-2",children:[e.jsx(Pe,{size:14})," Safe Exchange"]}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:a==null?void 0:a.itemTitle}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{size:16})," $",(me=a==null?void 0:a.price)==null?void 0:me.toLocaleString(),(a==null?void 0:a.serviceFee)&&e.jsxs("span",{className:"text-orange-200 text-xs ml-1",children:["(+$",a.serviceFee.toFixed(2)," fee)"]})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pt,{size:16})," ",a==null?void 0:a.itemBrand]})]}),e.jsx(Pe,{size:150,className:"absolute -right-10 -bottom-10 text-white opacity-10 rotate-12"})]}),e.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Transaction Progress"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${(a==null?void 0:a.status)===ie.COMPLETED?"bg-green-100 text-green-700":(a==null?void 0:a.status)===ie.DISPUTED?"bg-red-100 text-red-700":"bg-orange-100 text-orange-700"}`,children:(_=a==null?void 0:a.status)==null?void 0:_.replace(/_/g," ").toUpperCase()})]}),e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto pb-2",children:aa.map((se,je)=>{const Ne=ne(),ge=je<Ne,U=je===Ne;return e.jsxs(Fs.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center shrink-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${ge?"bg-green-500 text-white":U?"bg-orange-500 text-white animate-pulse":"bg-gray-200 dark:bg-gray-700 text-gray-500"}`,children:ge?e.jsx(Ge,{size:16}):je+1}),e.jsx("span",{className:`text-[10px] mt-1 whitespace-nowrap ${U?"font-bold text-orange-600":"text-gray-500"}`,children:se.label})]}),je<aa.length-1&&e.jsx("div",{className:`flex-1 h-1 min-w-[20px] rounded ${ge?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}`})]},se.key)})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500 rounded-full",children:e.jsx(gt,{className:"text-white",size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-green-800 dark:text-green-300",children:"Escrow Protected"}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:I?e.jsxs(e.Fragment,{children:["$",((ae=a==null?void 0:a.buyerTotal)==null?void 0:ae.toFixed(2))||((de=a==null?void 0:a.price)==null?void 0:de.toLocaleString())," held securely",(a==null?void 0:a.serviceFee)&&e.jsxs("span",{className:"text-green-500 text-xs",children:[" (includes $",a.serviceFee.toFixed(2)," service fee)"]})]}):e.jsxs(e.Fragment,{children:["You'll receive $",((G=a==null?void 0:a.sellerPayout)==null?void 0:G.toFixed(2))||((he=a==null?void 0:a.price)==null?void 0:he.toLocaleString())," on completion",(a==null?void 0:a.serviceFee)&&e.jsxs("span",{className:"text-green-500 text-xs",children:[" (after $",a.serviceFee.toFixed(2)," service fee)"]})]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-xl border ${z?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"dark:border-gray-700"}`,children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:["Seller ",z&&"(You)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(mt,{src:a==null?void 0:a.sellerPhoto,name:a==null?void 0:a.sellerName,size:"md"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:a==null?void 0:a.sellerName}),(a==null?void 0:a.sellerApproved)&&e.jsxs("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(ve,{size:12})," Approved"]})]})]})]}),e.jsxs("div",{className:`p-4 rounded-xl border ${I?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"dark:border-gray-700"}`,children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:["Buyer ",I&&"(You)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(mt,{src:a==null?void 0:a.buyerPhoto,name:a==null?void 0:a.buyerName,size:"md"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:a==null?void 0:a.buyerName}),(a==null?void 0:a.buyerApproved)&&e.jsxs("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(ve,{size:12})," Approved"]})]})]})]})]}),(a==null?void 0:a.meetupLocation)&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 flex items-center gap-2 mb-3",children:[e.jsx(Le,{size:18})," Exchange Location"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300",children:[e.jsx(Pe,{size:16}),e.jsx("span",{className:"font-bold",children:a.meetupLocation.name}),e.jsx("span",{className:"bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs px-2 py-0.5 rounded",children:a.meetupLocation.typeLabel})]}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:a.meetupLocation.address}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Re,{size:14})," ",a.meetupDate]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ie,{size:14})," ",a.meetupTime]})]})]})]}),w&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl",children:[e.jsxs("h4",{className:"font-bold dark:text-white text-sm mb-3 flex items-center gap-2",children:[e.jsx(Ks,{size:16,className:"text-blue-500"})," Live Location"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Your Position:"}),e.jsxs("div",{className:"flex items-center gap-1 font-mono text-xs dark:text-white",children:[w.lat.toFixed(6),", ",w.lng.toFixed(6)]})]}),$&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Safe Zone:"}),e.jsx("div",{className:"flex items-center gap-1",children:v?e.jsxs("span",{className:"text-green-600 font-bold flex items-center gap-1",children:[e.jsx(ve,{size:14})," In Zone"]}):e.jsxs("span",{className:"text-orange-600",children:[Math.round($.distance),"m away"]})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[z&&(a==null?void 0:a.status)===ie.SELLER_NOTIFIED&&e.jsxs("button",{onClick:()=>E(!0),className:"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-orange-700 transition",children:[e.jsx(Re,{size:20})," Schedule Safe Exchange"]}),z&&(a==null?void 0:a.status)===ie.MEETUP_SCHEDULED&&e.jsxs("button",{onClick:L,className:"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-orange-700 transition",children:[e.jsx(Je,{size:20})," Take Pre-Departure Photos"]}),I&&(a==null?void 0:a.status)===ie.SELLER_PHOTOS_UPLOADED&&e.jsxs("button",{onClick:Z,className:"w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition",children:[e.jsx(Ks,{size:20})," I'm On My Way"]}),I&&((a==null?void 0:a.status)===ie.BUYER_EN_ROUTE||(a==null?void 0:a.status)===ie.AT_SAFE_ZONE)&&v&&B&&e.jsxs("button",{onClick:()=>R("buyer_inspect"),className:"w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition",children:[e.jsx(Je,{size:20})," Start Item Inspection"]}),(a==null?void 0:a.status)===ie.PENDING_DUAL_APPROVAL&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800",children:[e.jsx("h4",{className:"font-bold text-yellow-800 dark:text-yellow-300 mb-2",children:"Final Approval Required"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:"Both parties must approve to release funds."})]}),(z&&!a.sellerApproved||I&&!a.buyerApproved)&&e.jsx("button",{onClick:Y,disabled:m,className:"w-full bg-green-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-green-700 transition disabled:opacity-50",children:m?e.jsx(oe,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:20})," Approve & Release Funds"]})}),(z&&a.sellerApproved||I&&a.buyerApproved)&&e.jsxs("div",{className:"text-center text-green-600 font-bold py-4",children:[e.jsx(ve,{className:"inline mr-2"}),"You have approved. Waiting for other party..."]})]}),(a==null?void 0:a.status)===ie.COMPLETED&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-6 rounded-xl border border-green-200 dark:border-green-800 text-center",children:[e.jsx(ve,{className:"text-green-500 mx-auto mb-4",size:48}),e.jsx("h4",{className:"text-xl font-bold text-green-700 dark:text-green-300 mb-2",children:"Exchange Completed!"}),e.jsx("p",{className:"text-green-600 dark:text-green-400",children:z?"Funds have been released to your account.":"Thank you for your purchase!"})]}),(a==null?void 0:a.status)===ie.DISPUTED&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-6 rounded-xl border border-red-200 dark:border-red-800 text-center",children:[e.jsx(ht,{className:"text-red-500 mx-auto mb-4",size:48}),e.jsx("h4",{className:"text-xl font-bold text-red-700 dark:text-red-300 mb-2",children:"Dispute Raised"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-4",children:"Our support team will review this transaction."}),e.jsx("button",{className:"bg-red-600 text-white px-6 py-2 rounded-lg font-bold",children:"Contact Support"})]}),(a==null?void 0:a.status)!==ie.COMPLETED&&e.jsxs("button",{onClick:()=>o==null?void 0:o(z?a.buyerId:a.sellerId),className:"w-full border-2 border-gray-300 dark:border-gray-600 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-800 transition dark:text-white",children:[e.jsx(Te,{size:18})," Message ",z?"Buyer":"Seller"]})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex justify-between",children:(a==null?void 0:a.status)!==ie.COMPLETED&&(a==null?void 0:a.status)!==ie.CANCELLED&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:J,className:"text-red-600 font-bold text-sm hover:underline",children:"Cancel Transaction"}),(a==null?void 0:a.status)!==ie.DISPUTED&&e.jsx("button",{onClick:()=>ee("Item not as described"),className:"text-orange-600 font-bold text-sm hover:underline",children:"Raise Dispute"})]})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[75] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 w-full max-w-lg rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Select Safe Exchange Zone"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Choose a verified safe location for the exchange"})]}),e.jsx("div",{className:"p-4 max-h-[400px] overflow-y-auto space-y-2",children:C.length>0?C.map(se=>e.jsx("button",{onClick:()=>p(se),className:`w-full p-4 rounded-xl border text-left transition ${(i==null?void 0:i.id)===se.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-400"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${(i==null?void 0:i.id)===se.id?"bg-orange-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:e.jsx(Pe,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold dark:text-white",children:se.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:se.address}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded",children:se.typeLabel}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(se.distance/1e3).toFixed(1)," km away"]})]})]}),(i==null?void 0:i.id)===se.id&&e.jsx(ve,{className:"text-orange-500",size:20})]})},se.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Le,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Loading nearby safe zones..."})]})}),i&&e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date"}),e.jsx("input",{type:"date",value:c,onChange:se=>y(se.target.value),min:new Date().toISOString().split("T")[0],className:"w-full p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time"}),e.jsx("input",{type:"time",value:N,onChange:se=>j(se.target.value),className:"w-full p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]})]}),e.jsx("button",{onClick:F,disabled:!c||!N||m,className:"w-full bg-orange-600 text-white py-3 rounded-xl font-bold disabled:opacity-50 hover:bg-orange-700 transition",children:m?"Scheduling...":"Confirm & Notify Buyer"})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:()=>E(!1),className:"w-full text-gray-500 font-bold hover:text-gray-700 dark:hover:text-gray-300",children:"Cancel"})})]})})]})}const ri=["Mint","Excellent","Good","Fair","Non-Functioning"],Se={PENDING:"pending",CONFIRMED:"confirmed",SHIPPED:"shipped",DELIVERED:"delivered",COMPLETED:"completed",CANCELLED:"cancelled",REFUNDED:"refunded"},us={[Se.PENDING]:{label:"Pending",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",icon:Ie},[Se.CONFIRMED]:{label:"Confirmed",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:ve},[Se.SHIPPED]:{label:"Shipped",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400",icon:ct},[Se.DELIVERED]:{label:"Delivered",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:pt},[Se.COMPLETED]:{label:"Completed",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:ve},[Se.CANCELLED]:{label:"Cancelled",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",icon:pe},[Se.REFUNDED]:{label:"Refunded",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400",icon:Ta}},xa=.02,Ss=t=>{const s=parseFloat(t)||0,l=Math.round(s*xa*100)/100,n=Math.round((s+l)*100)/100,d=Math.round((s-l)*100)/100;return{itemPrice:s,serviceFee:l,serviceFeeRate:xa,buyerTotal:n,sellerPayout:d}},sr=({rating:t,reviewCount:s,size:l="sm"})=>{if(!t&&!s)return null;const d={sm:{star:12,text:"text-xs"},md:{star:14,text:"text-sm"},lg:{star:16,text:"text-base"}}[l];return e.jsxs("div",{className:`flex items-center gap-1 ${d.text}`,children:[e.jsx(et,{size:d.star,className:"text-yellow-500 fill-yellow-500"}),e.jsx("span",{className:"font-bold text-yellow-600 dark:text-yellow-400",children:(t==null?void 0:t.toFixed(1))||"—"}),s>0&&e.jsxs("span",{className:"text-gray-400",children:["(",s," sale",s!==1?"s":"",")"]})]})},li=({status:t})=>{const s={pending:{label:"Pending",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"},accepted:{label:"Accepted",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},declined:{label:"Declined",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},countered:{label:"Countered",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},expired:{label:"Expired",color:"bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400"}},l=s[t]||s.pending;return e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${l.color}`,children:l.label})},ar=t=>t>=es;function ni({user:t,userData:s,setActiveTab:l,openChat:n}){const[d,o]=r.useState("browse"),[a,b]=r.useState([]),[x,g]=r.useState("All"),[m,u]=r.useState(""),[i,p]=r.useState(null),[c,y]=r.useState(null),[N,j]=r.useState([]),[k,E]=r.useState([]),[C,h]=r.useState(null);r.useEffect(()=>{const v=ye(le(O,te(t.uid).gearListings),Ae("timestamp","desc")),$=fe(v,B=>{b(B.docs.map(M=>({id:M.id,...M.data()})))});return()=>$()},[t.uid]),r.useEffect(()=>{if(!(t!=null&&t.uid))return;const v=ye(le(O,`artifacts/${re}/public/data/safe_exchange_transactions`),Ce("buyerId","==",t.uid)),$=ye(le(O,`artifacts/${re}/public/data/safe_exchange_transactions`),Ce("sellerId","==",t.uid)),B=fe(v,T=>{j(P=>{const A=T.docs.map(L=>({id:L.id,...L.data(),role:"buyer"})),F=P.filter(L=>L.role==="seller");return[...A,...F]})}),M=fe($,T=>{j(P=>{const A=T.docs.map(L=>({id:L.id,...L.data(),role:"seller"}));return[...P.filter(L=>L.role==="buyer"),...A]})});return()=>{B(),M()}},[t==null?void 0:t.uid]),r.useEffect(()=>{if(!(t!=null&&t.uid))return;const v=ye(le(O,`artifacts/${re}/public/data/gear_orders`),Ce("buyerId","==",t.uid)),$=ye(le(O,`artifacts/${re}/public/data/gear_orders`),Ce("sellerId","==",t.uid)),B=fe(v,T=>{E(P=>{const A=T.docs.map(L=>({id:L.id,...L.data(),role:"buyer"})),F=P.filter(L=>L.role==="seller");return[...A,...F].sort((L,W)=>{var Z,D,Y,q;return(((D=(Z=W.createdAt)==null?void 0:Z.toMillis)==null?void 0:D.call(Z))||0)-(((q=(Y=L.createdAt)==null?void 0:Y.toMillis)==null?void 0:q.call(Y))||0)})})}),M=fe($,T=>{E(P=>{const A=T.docs.map(L=>({id:L.id,...L.data(),role:"seller"}));return[...P.filter(L=>L.role==="buyer"),...A].sort((L,W)=>{var Z,D,Y,q;return(((D=(Z=W.createdAt)==null?void 0:Z.toMillis)==null?void 0:D.call(Z))||0)-(((q=(Y=L.createdAt)==null?void 0:Y.toMillis)==null?void 0:q.call(Y))||0)})})});return()=>{B(),M()}},[t==null?void 0:t.uid]);const f=async v=>{const $=Ss(v.price);try{const B=await we(le(O,`artifacts/${re}/public/data/safe_exchange_transactions`),{listingId:v.id,itemTitle:v.title,itemBrand:v.brand,itemDescription:v.description||"",itemPhotos:v.images||[],itemCondition:v.condition,price:v.price,itemPrice:$.itemPrice,serviceFee:$.serviceFee,serviceFeeRate:$.serviceFeeRate,buyerTotal:$.buyerTotal,sellerPayout:$.sellerPayout,sellerId:v.sellerId,sellerName:v.sellerName,sellerPhoto:v.sellerPhoto,buyerId:t.uid,buyerName:`${s.firstName} ${s.lastName}`,buyerPhoto:s.photoURL||null,status:ie.INTENT_CREATED,statusHistory:{[ie.INTENT_CREATED]:{timestamp:Date.now(),userId:t.uid}},escrowAmount:$.buyerTotal,escrowStatus:"pending",sellerApproved:!1,buyerApproved:!1,createdAt:ue(),updatedAt:ue()});await be(B,{status:ie.HOLD_PLACED,[`statusHistory.${ie.HOLD_PLACED}`]:{timestamp:Date.now(),userId:t.uid},escrowStatus:"held"}),await be(B,{status:ie.SELLER_NOTIFIED,[`statusHistory.${ie.SELLER_NOTIFIED}`]:{timestamp:Date.now(),userId:t.uid}}),await we(le(O,te(v.sellerId).notifications),{type:"safe_exchange_intent",transactionId:B.id,message:`${s.firstName} wants to purchase your ${v.title} - You'll receive $${$.sellerPayout.toFixed(2)}`,buyerName:`${s.firstName} ${s.lastName}`,itemTitle:v.title,price:v.price,sellerPayout:$.sellerPayout,serviceFee:$.serviceFee,read:!1,createdAt:ue()}),y(B.id),p(null)}catch(B){console.error("Failed to create safe exchange:",B),alert("Failed to initiate purchase. Please try again.")}},R=async(v,$)=>{const B=X.loading("Processing your order..."),M=Ss(v.price);try{const T=await we(le(O,`artifacts/${re}/public/data/gear_orders`),{listingId:v.id,itemTitle:v.title,itemBrand:v.brand,itemDescription:v.description||"",itemPhotos:v.images||[],itemCondition:v.condition,price:v.price,itemPrice:M.itemPrice,serviceFee:M.serviceFee,serviceFeeRate:M.serviceFeeRate,buyerTotal:M.buyerTotal,sellerPayout:M.sellerPayout,sellerId:v.sellerId,sellerName:v.sellerName,sellerPhoto:v.sellerPhoto,buyerId:t.uid,buyerName:`${s.firstName} ${s.lastName}`,buyerPhoto:s.photoURL||null,fulfillmentMethod:$.method,shippingAddress:$.method==="shipping"?$.address:null,buyerPhone:$.phone||null,buyerNotes:$.notes||"",trackingNumber:null,trackingCarrier:null,status:Se.PENDING,statusHistory:[{status:Se.PENDING,timestamp:Date.now(),note:"Order placed by buyer"}],paymentStatus:"pending",paymentIntentId:null,createdAt:ue(),updatedAt:ue()});return await we(le(O,te(v.sellerId).notifications),{type:"gear_order",orderId:T.id,listingId:v.id,message:`${s.firstName} purchased your ${v.title} - You'll receive $${M.sellerPayout.toFixed(2)}`,buyerName:`${s.firstName} ${s.lastName}`,itemTitle:v.title,price:v.price,sellerPayout:M.sellerPayout,serviceFee:M.serviceFee,fulfillmentMethod:$.method,read:!1,createdAt:ue()}),await be(Q(O,te(v.sellerId).gearListings,v.id),{status:"Pending Sale",pendingOrderId:T.id,updatedAt:ue()}),X.success("Order placed successfully!",{id:B}),p(null),o("orders"),T.id}catch(T){return console.error("Failed to create order:",T),X.error("Failed to place order. Please try again.",{id:B}),null}},z=async(v,$,B=null)=>{const M=X.loading("Updating order...");try{const T=Q(O,`artifacts/${re}/public/data/gear_orders`,v),P=await yt(T);if(!P.exists()){X.error("Order not found",{id:M});return}const A=P.data(),F=A.statusHistory||[],L={status:$,statusHistory:[...F,{status:$,timestamp:Date.now(),note:`Status updated to ${$}`}],updatedAt:ue()};B&&(L.trackingNumber=B.trackingNumber,L.trackingCarrier=B.carrier),await be(T,L);const W=$===Se.SHIPPED?`Your order "${A.itemTitle}" has been shipped!`:`Your order "${A.itemTitle}" status updated to ${$}`;await we(le(O,te(A.buyerId).notifications),{type:"order_update",orderId:v,message:W,itemTitle:A.itemTitle,newStatus:$,trackingNumber:(B==null?void 0:B.trackingNumber)||null,read:!1,createdAt:ue()}),$===Se.COMPLETED&&await be(Q(O,te(A.sellerId).gearListings,A.listingId),{status:"Sold",updatedAt:ue()}),X.success("Order updated!",{id:M})}catch(T){console.error("Failed to update order:",T),X.error("Failed to update order",{id:M})}},I=k.filter(v=>v.status!==Se.COMPLETED&&v.status!==Se.CANCELLED&&v.status!==Se.REFUNDED),S=a.filter(v=>(x==="All"||v.category===x)&&(v.title.toLowerCase().includes(m.toLowerCase())||v.brand.toLowerCase().includes(m.toLowerCase()))),w=N.filter(v=>v.status!==ie.COMPLETED&&v.status!==ie.CANCELLED);return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 animate-in fade-in",children:[c&&e.jsx(ai,{transactionId:c,user:t,userData:s,onClose:()=>y(null),onComplete:()=>{y(null)},onMessage:v=>{n==null||n(v)}}),d==="browse"&&e.jsxs(e.Fragment,{children:[w.length>0&&e.jsxs("div",{className:"mb-6 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Pe,{className:"text-orange-600",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-orange-800 dark:text-orange-300",children:"Active Safe Exchanges"}),e.jsxs("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:["You have ",w.length," pending transaction",w.length>1?"s":""]})]})]}),e.jsx("div",{className:"space-y-2",children:w.map(v=>e.jsxs("button",{onClick:()=>y(v.id),className:"w-full flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${v.role==="buyer"?"bg-blue-100 text-blue-600":"bg-green-100 text-green-600"}`,children:v.role==="buyer"?e.jsx(Rs,{size:16}):e.jsx($e,{size:16})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:v.itemTitle}),e.jsxs("div",{className:"text-xs text-gray-500",children:[v.role==="buyer"?"Buying":"Selling"," • $",v.price]})]})]}),e.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-bold",children:v.status.replace(/_/g," ")})]},v.id))})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ct,{className:"text-orange-500"})," Gear Exchange"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Buy and sell verified studio equipment."})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(Be,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2c2e36] text-sm dark:text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Search gear...",value:m,onChange:v=>u(v.target.value)})]}),e.jsxs("button",{onClick:()=>o("orders"),className:"relative bg-white dark:bg-[#2c2e36] border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 transition",children:[e.jsx($a,{size:16})," Orders",I.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center",children:I.length})]}),e.jsxs("button",{onClick:()=>o("create"),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 shadow-lg transition",children:[e.jsx(nt,{size:16})," Sell Gear"]})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2",children:[e.jsx("button",{onClick:()=>g("All"),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${x==="All"?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:"All Gear"}),ut.map(v=>e.jsx("button",{onClick:()=>g(v.id),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${x===v.id?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:v.label},v.id))]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:S.map(v=>{var B;const $=ar(v.price);return e.jsxs("div",{onClick:()=>p(v),className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-xl transition cursor-pointer group flex flex-col",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 dark:bg-black/40 relative flex items-center justify-center overflow-hidden",children:[(B=v.images)!=null&&B[0]?e.jsx("img",{src:v.images[0],className:"w-full h-full object-cover group-hover:scale-105 transition duration-500"}):e.jsx(Je,{size:32,className:"text-gray-400"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur-md",children:["$",v.price]}),$&&e.jsxs("div",{className:"absolute top-2 left-2 bg-orange-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(Pe,{size:10})," Safe Exchange"]}),v.conditionReport&&e.jsxs("div",{className:"absolute bottom-2 left-2 bg-green-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(ve,{size:10})," Inspected"]}),v.acceptsOffers&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-blue-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(Te,{size:10})," Offers"]})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-400 uppercase mb-1",children:v.brand}),e.jsx("h4",{className:"font-bold dark:text-white text-sm mb-1 line-clamp-1",children:v.title}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[v.condition," Condition"]}),v.sellerRating&&e.jsx("div",{className:"mb-2",children:e.jsx(sr,{rating:v.sellerRating,reviewCount:v.sellerSalesCount,size:"sm"})}),e.jsxs("div",{className:"mt-auto pt-3 border-t dark:border-gray-700 flex justify-between items-center text-xs text-gray-400",children:[e.jsx("span",{className:"flex items-center gap-1",children:$?e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:10})," Local Pickup"]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{size:10})," ",v.location||"Ships"]})}),v.sellerVerified&&e.jsx(Yt,{size:14,className:"text-blue-500"})]})]})]},v.id)})})]}),d==="create"&&e.jsx(ii,{user:t,userData:s,onCancel:()=>o("browse"),onSuccess:()=>o("browse")}),d==="orders"&&e.jsx(di,{orders:k,user:t,userData:s,onBack:()=>o("browse"),onUpdateStatus:z,openChat:n}),i&&e.jsx(oi,{item:i,onClose:()=>p(null),currentUser:t,currentUserData:s,onSafeExchangePurchase:f,onStandardPurchase:R})]})}function ii({user:t,userData:s,onCancel:l,onSuccess:n}){const[d,o]=r.useState(1),[a,b]=r.useState({title:"",brand:"",category:ut[0].id,condition:"Good",price:"",description:"",location:s.city||"",weight:"",length:"",width:"",height:"",acceptsOffers:!0,minimumOffer:""}),[x,g]=r.useState([]),[m,u]=r.useState(null),[i,p]=r.useState(!1),{uploadMedia:c,uploading:y}=it(),N=async k=>{const E=k.target.files[0];if(!E)return;const C=await c(E,`gear/${t.uid}`);C!=null&&C.url&&g([...x,C.url])},j=async()=>{if(!a.title||!a.price)return alert("Title and Price required.");p(!0);try{await we(le(O,te(t.uid).gearListings),{...a,price:parseInt(a.price),minimumOffer:a.minimumOffer?parseInt(a.minimumOffer):null,images:x,conditionReport:m,sellerId:t.uid,sellerName:`${s.firstName} ${s.lastName}`,sellerPhoto:s.photoURL||null,sellerRating:s.sellerRating||null,sellerSalesCount:s.sellerSalesCount||0,sellerVerified:s.verified||!1,sellerResponseTime:s.avgResponseTime||null,timestamp:ue(),status:"Active"}),X.success("Listing posted!"),n()}catch(k){console.error(k),X.error("Failed to post listing.")}p(!1)};return d==="inspection"?e.jsx("div",{className:"h-[600px]",children:e.jsx(ti,{type:"Pre",onSave:k=>{u(k),o(1)},onCancel:()=>o(1)})}):e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border dark:border-gray-700 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"List Gear for Sale"}),e.jsx("button",{onClick:l,children:e.jsx(pe,{className:"text-gray-400"})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:a.brand,onChange:k=>b({...a,brand:k.target.value}),placeholder:"e.g. Fender"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model / Title"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:a.title,onChange:k=>b({...a,title:k.target.value}),placeholder:"e.g. Stratocaster"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:a.category,onChange:k=>b({...a,category:k.target.value}),children:ut.map(k=>e.jsx("option",{value:k.id,children:k.label},k.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Condition"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:a.condition,onChange:k=>b({...a,condition:k.target.value}),children:ri.map(k=>e.jsx("option",{value:k,children:k},k))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Price ($)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",value:a.price,onChange:k=>b({...a,price:k.target.value})}),a.price&&parseInt(a.price)>=es&&e.jsx("div",{className:"mt-3 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Pe,{className:"text-orange-500 shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-300 text-sm",children:"Safe Exchange Required"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-orange-400 mt-1",children:["Items priced at $",es,"+ require in-person exchange at a verified safe location (police station, bank, etc.). Buyers will initiate a Safe Exchange with payment held in escrow until both parties approve."]}),e.jsxs("ul",{className:"text-xs text-orange-600 dark:text-orange-400 mt-2 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(Os,{size:10})," No shipping available for high-value items"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(Je,{size:10})," You must upload pre-departure photos"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(Le,{size:10})," GPS verification at exchange location"]})]})]})]})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-400 text-sm flex items-center gap-2",children:[e.jsx(Te,{size:16}),"Accept Offers"]}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300 mt-1",children:"Allow buyers to negotiate on price"})]}),e.jsx("button",{type:"button",onClick:()=>b({...a,acceptsOffers:!a.acceptsOffers}),className:"p-1",children:a.acceptsOffers?e.jsx(vt,{size:32,className:"text-blue-600"}):e.jsx(Nt,{size:32,className:"text-gray-400"})})]}),a.acceptsOffers&&a.price&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 dark:border-blue-800",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Minimum Acceptable Offer (Optional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",placeholder:`e.g., ${Math.round(parseInt(a.price)*.8)}`,value:a.minimumOffer,onChange:k=>b({...a,minimumOffer:k.target.value}),className:"flex-1 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm"}),e.jsx("span",{className:"text-sm text-gray-500",children:a.minimumOffer&&a.price?`(${Math.round(parseInt(a.minimumOffer)/parseInt(a.price)*100)}%)`:""})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:'Offers below this will be flagged as "Low Offer" to buyers'})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Weight (lb)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"lbs",value:a.weight,onChange:k=>b({...a,weight:k.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"L (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Len",value:a.length,onChange:k=>b({...a,length:k.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"W (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Wid",value:a.width,onChange:k=>b({...a,width:k.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"H (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Hgt",value:a.height,onChange:k=>b({...a,height:k.target.value})})]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-1",children:"Tech Inspection Report"}),e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-300",children:m?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{size:12})," Report Attached (",m.markers.length," points)"]}):"Mark scratches, dents, or issues on a diagram to build trust."})]}),e.jsx("button",{onClick:()=>o("inspection"),className:`text-xs font-bold px-3 py-2 rounded-lg border transition ${m?"bg-white text-green-600 border-green-200":"bg-orange-100 text-orange-700 border-orange-200 hover:bg-orange-200"}`,children:m?"Edit Report":"Create Report"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Photos"}),e.jsxs("div",{className:"flex gap-2",children:[x.map((k,E)=>e.jsx("img",{src:k,className:"w-16 h-16 rounded-lg object-cover border dark:border-gray-600"},E)),e.jsxs("label",{className:"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",children:[y?e.jsx(oe,{className:"animate-spin text-gray-400"}):e.jsx(nt,{className:"text-gray-400"}),e.jsx("input",{type:"file",className:"hidden",onChange:N,disabled:y})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"Cancel"}),e.jsx("button",{onClick:j,disabled:i||y,className:"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg flex items-center justify-center gap-2",children:i?e.jsx(oe,{className:"animate-spin"}):"Post Listing"})]})]})]})}function oi({item:t,onClose:s,currentUser:l,currentUserData:n,onSafeExchangePurchase:d,onStandardPurchase:o}){var L,W,Z,D;const[a,b]=r.useState(!1),[x,g]=r.useState(!1),[m,u]=r.useState(!1),[i,p]=r.useState(!1),[c,y]=r.useState(""),[N,j]=r.useState(""),[k,E]=r.useState(!1),[C,h]=r.useState([]),[f,R]=r.useState(!0),[z,I]=r.useState(1),[S,w]=r.useState("shipping"),[v,$]=r.useState({street:((L=n==null?void 0:n.address)==null?void 0:L.street)||"",city:(n==null?void 0:n.city)||"",state:(n==null?void 0:n.state)||"",zip:(n==null?void 0:n.zip)||"",phone:(n==null?void 0:n.phone)||"",notes:""}),B=ar(t.price);r.useEffect(()=>{if(!t.id||!(l!=null&&l.uid)){R(!1);return}const Y=le(O,`artifacts/${re}/public/data/gear_offers`),q=ye(Y,Ce("listingId","==",t.id),Ce("buyerId","==",l.uid),Ae("createdAt","desc")),J=fe(q,ee=>{const ne=ee.docs.map(me=>{var _,ae;return{id:me.id,...me.data(),createdAt:((ae=(_=me.data().createdAt)==null?void 0:_.toDate)==null?void 0:ae.call(_))||new Date}});h(ne),R(!1)},ee=>{console.error("Error fetching offers:",ee),R(!1)});return()=>J()},[t.id,l==null?void 0:l.uid]);const M=async()=>{B?(g(!0),await d(t),g(!1)):(p(!0),I(1))},T=async()=>{g(!0);const Y={method:S,address:S==="shipping"?{street:v.street,city:v.city,state:v.state,zip:v.zip}:null,phone:v.phone,notes:v.notes};await o(t,Y)&&(p(!1),s()),g(!1)},P=()=>S==="shipping"?v.street&&v.city&&v.state&&v.zip:!0,A=async()=>{if(!c||parseFloat(c)<=0){X.error("Please enter a valid offer amount");return}const Y=parseFloat(c);if(Y>=t.price){X.error("Offer must be less than the asking price");return}E(!0);const q=X.loading("Submitting offer...");try{const J=await we(le(O,`artifacts/${re}/public/data/gear_offers`),{listingId:t.id,itemTitle:t.title,itemBrand:t.brand,askingPrice:t.price,offerAmount:Y,message:N,buyerId:l.uid,buyerName:`${n.firstName} ${n.lastName}`,buyerPhoto:n.photoURL||null,sellerId:t.sellerId,sellerName:t.sellerName,status:"pending",createdAt:ue(),expiresAt:new Date(Date.now()+1728e5)});await we(le(O,te(t.sellerId).notifications),{type:"gear_offer",offerId:J.id,listingId:t.id,message:`${n.firstName} made an offer of $${Y} on your ${t.title}`,buyerName:`${n.firstName} ${n.lastName}`,itemTitle:t.title,offerAmount:Y,askingPrice:t.price,read:!1,createdAt:ue()}),X.success("Offer submitted!",{id:q}),u(!1),y(""),j("")}catch(J){console.error("Failed to submit offer:",J),X.error("Failed to submit offer",{id:q})}E(!1)},F=Y=>Math.round(Y/t.price*100);return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-4xl h-[90vh] rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden border dark:border-gray-700",children:[e.jsxs("div",{className:"md:w-1/2 bg-black relative flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 relative",children:[a&&t.conditionReport?e.jsxs("div",{className:"w-full h-full bg-white rounded-xl overflow-hidden",children:[e.jsx(tr,{type:t.conditionReport.gearType,view:"front",markers:t.conditionReport.markers,onClick:()=>{}}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/80 text-white px-3 py-1 rounded-full text-xs",children:"Inspection View"})]}):(W=t.images)!=null&&W[0]?e.jsx("img",{src:t.images[0],className:"max-h-full max-w-full object-contain"}):e.jsx(Je,{size:48,className:"text-gray-600"}),e.jsx("button",{onClick:s,className:"absolute top-4 left-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70",children:e.jsx(pe,{size:20})}),B&&e.jsxs("div",{className:"absolute top-4 right-4 bg-orange-500 text-white px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1.5 shadow-lg",children:[e.jsx(Pe,{size:14})," Safe Exchange Required"]})]}),t.conditionReport&&e.jsxs("div",{className:"p-4 bg-[#1f2128] border-t border-gray-800 flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>b(!1),className:`px-4 py-2 rounded text-xs font-bold ${a?"bg-gray-800 text-gray-400":"bg-orange-600 text-white"}`,children:"Photos"}),e.jsxs("button",{onClick:()=>b(!0),className:`px-4 py-2 rounded text-xs font-bold flex items-center gap-1 ${a?"bg-orange-600 text-white":"bg-gray-800 text-gray-400"}`,children:[e.jsx(ht,{size:12})," Condition Map"]})]})]}),e.jsxs("div",{className:"md:w-1/2 p-8 overflow-y-auto bg-white dark:bg-[#2c2e36]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-bold text-gray-400 uppercase tracking-wider mb-1",children:t.brand}),e.jsx("h2",{className:"text-3xl font-extrabold dark:text-white mb-2",children:t.title}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["$",t.price]}),e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-1 rounded text-xs font-bold",children:t.condition}),t.acceptsOffers&&e.jsxs("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-1 rounded text-xs font-bold flex items-center gap-1",children:[e.jsx(Te,{size:12})," Open to Offers"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[B&&e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-500 rounded-lg",children:e.jsx(Pe,{className:"text-white",size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-300 mb-1",children:"Safe Exchange Protection"}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-400 mb-3",children:["High-value items ($",es,"+) require in-person exchange at a verified safe location."]}),e.jsxs("ul",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(gt,{size:12})," Payment held in escrow until exchange"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(Le,{size:12})," Meet at police station or safe zone"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(Je,{size:12})," Photo verification required"]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(ve,{size:12})," Both parties must approve"]})]})]})]})}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.sellerPhoto?e.jsx("img",{src:t.sellerPhoto,className:"w-12 h-12 rounded-full bg-gray-300 object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-lg",children:(Z=t.sellerName)==null?void 0:Z[0]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold dark:text-white",children:t.sellerName}),t.sellerVerified&&e.jsx(Yt,{size:16,className:"text-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx(sr,{rating:t.sellerRating,reviewCount:t.sellerSalesCount,size:"md"}),t.sellerResponseTime&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Ie,{size:12}),"Responds in ",t.sellerResponseTime]})]})]})]})}),C.length>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm mb-3 flex items-center gap-2",children:[e.jsx(Te,{size:16}),"Your Offers"]}),e.jsx("div",{className:"space-y-2",children:C.map(Y=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold dark:text-white",children:["$",Y.offerAmount]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",F(Y.offerAmount),"% of asking)"]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:Y.createdAt.toLocaleDateString()})]}),e.jsx(li,{status:Y.status})]},Y.id))})]}),e.jsxs("div",{className:`p-3 rounded-xl border ${B?"bg-orange-50 dark:bg-orange-900/10 border-orange-200 dark:border-orange-800":"bg-green-50 dark:bg-green-900/10 border-green-200 dark:border-green-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:B?e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"text-orange-600",size:18}),e.jsx("span",{className:"font-bold text-orange-700 dark:text-orange-400",children:"Local Pickup Only"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"text-green-600",size:18}),e.jsx("span",{className:"font-bold text-green-700 dark:text-green-400",children:"Shipping Available"})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:B?"You will coordinate a meetup at a verified safe exchange zone":t.location||"Contact seller for shipping details"})]}),((D=t.conditionReport)==null?void 0:D.notes)&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800/50",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-2 flex items-center gap-2",children:[e.jsx(Ct,{size:16})," Tech Notes"]}),e.jsxs("p",{className:"text-sm text-orange-900 dark:text-orange-200 italic",children:['"',t.conditionReport.notes,'"']})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm uppercase",children:"Description"}),e.jsx("p",{children:t.description||"No description provided."})]})]}),m&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm mb-3 flex items-center gap-2",children:[e.jsx(Te,{size:16}),"Make an Offer"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Your Offer ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"number",value:c,onChange:Y=>y(Y.target.value),placeholder:`Asking: $${t.price}`,className:"w-full pl-9 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),c&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[F(parseFloat(c)),"% of asking price",parseFloat(c)<t.price*.7&&e.jsx("span",{className:"text-amber-600 ml-1",children:"(Low offer)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Message (Optional)"}),e.jsx("textarea",{value:N,onChange:Y=>j(Y.target.value),placeholder:"Add a message to the seller...",rows:2,className:"w-full p-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 py-2 text-gray-600 dark:text-gray-400 font-medium hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:k||!c,className:"flex-1 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:k?e.jsx(oe,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:[e.jsx(As,{size:16})," Submit Offer"]})})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[e.jsx(Ie,{size:10}),"Offers expire after 48 hours if not responded to"]})]})]}),e.jsx(Ve,{children:i&&e.jsxs(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mt-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-5 rounded-xl border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-bold text-green-800 dark:text-green-300 flex items-center gap-2",children:[e.jsx(Xs,{size:18}),"Checkout"]}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(pe,{size:18})})]}),e.jsx("div",{className:"flex items-center gap-2 mb-6",children:[1,2,3].map(Y=>e.jsxs(Fs.Fragment,{children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all ${z>=Y?"bg-green-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-500"}`,children:z>Y?e.jsx(ve,{size:16}):Y}),Y<3&&e.jsx("div",{className:`flex-1 h-1 rounded ${z>Y?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}`})]},Y))}),z===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"How would you like to receive this item?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>w("shipping"),className:`p-4 rounded-xl border-2 transition-all ${S==="shipping"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx(ct,{size:24,className:S==="shipping"?"text-green-600 mx-auto mb-2":"text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Ship to Me"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Delivered to your door"})]}),e.jsxs("button",{onClick:()=>w("pickup"),className:`p-4 rounded-xl border-2 transition-all ${S==="pickup"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx(Ye,{size:24,className:S==="pickup"?"text-green-600 mx-auto mb-2":"text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Local Pickup"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Meet the seller"})]})]}),e.jsxs("button",{onClick:()=>I(2),className:"w-full py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition flex items-center justify-center gap-2",children:["Continue ",e.jsx(At,{size:16})]})]}),z===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:S==="shipping"?"Enter your shipping address":"Add your contact details"}),S==="shipping"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Street Address",value:v.street,onChange:Y=>$({...v,street:Y.target.value}),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{type:"text",placeholder:"City",value:v.city,onChange:Y=>$({...v,city:Y.target.value}),className:"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsx("input",{type:"text",placeholder:"State",value:v.state,onChange:Y=>$({...v,state:Y.target.value}),className:"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsx("input",{type:"text",placeholder:"ZIP",value:v.zip,onChange:Y=>$({...v,zip:Y.target.value}),className:"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]})]}),e.jsx("input",{type:"tel",placeholder:"Phone Number",value:v.phone,onChange:Y=>$({...v,phone:Y.target.value}),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"}),e.jsx("textarea",{placeholder:"Notes for seller (optional)",value:v.notes,onChange:Y=>$({...v,notes:Y.target.value}),rows:2,className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white resize-none"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>I(1),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:"Back"}),e.jsxs("button",{onClick:()=>I(3),disabled:!P(),className:"flex-1 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:["Review Order ",e.jsx(At,{size:16})]})]})]}),z===3&&(()=>{var q;const Y=Ss(t.price);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h5",{className:"font-bold text-sm dark:text-white mb-3",children:"Order Summary"}),e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b dark:border-gray-700",children:[((q=t.images)==null?void 0:q[0])&&e.jsx("img",{src:t.images[0],className:"w-16 h-16 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold dark:text-white",children:t.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.brand," • ",t.condition]})]})]}),e.jsxs("div",{className:"pt-3 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Item Price"}),e.jsxs("span",{className:"dark:text-white",children:["$",Y.itemPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:["Service Fee",e.jsx("span",{className:"text-[10px] text-gray-400",children:"(2%)"})]}),e.jsxs("span",{className:"dark:text-white",children:["$",Y.serviceFee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Fulfillment"}),e.jsx("span",{className:"dark:text-white capitalize",children:S})]}),S==="shipping"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Ship to"}),e.jsxs("span",{className:"dark:text-white text-right text-xs",children:[v.city,", ",v.state," ",v.zip]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t dark:border-gray-700 font-bold",children:[e.jsx("span",{className:"dark:text-white",children:"Total"}),e.jsxs("span",{className:"text-green-600",children:["$",Y.buyerTotal.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Pe,{size:14,className:"shrink-0 mt-0.5"}),e.jsx("span",{children:"Your purchase is protected by SeshNx Buyer Protection. If there's an issue with your order, we've got your back."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>I(2),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:"Back"}),e.jsx("button",{onClick:T,disabled:x,className:"flex-1 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-xl hover:from-green-700 hover:to-emerald-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:x?e.jsx(oe,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(Rs,{size:18})," Place Order"]})})]})]})})()]})}),!i&&e.jsxs("div",{className:"mt-8 pt-6 border-t dark:border-gray-700",children:[t.sellerId===l.uid?e.jsx("button",{className:"w-full bg-gray-100 dark:bg-gray-700 text-gray-500 font-bold py-3 rounded-xl cursor-not-allowed",children:"You own this listing"}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:M,disabled:x,className:`w-full font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed ${B?"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white":"bg-orange-600 hover:bg-orange-700 text-white"}`,children:x?e.jsx(oe,{className:"animate-spin",size:20}):B?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{size:20})," Initiate Safe Exchange"]}):e.jsxs(e.Fragment,{children:[e.jsx(Xs,{size:20})," Buy Now - $",t.price]})}),!m&&t.acceptsOffers!==!1&&e.jsxs("button",{onClick:()=>u(!0),className:"w-full py-3 border-2 border-blue-500 text-blue-600 dark:text-blue-400 font-bold rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 transition flex items-center justify-center gap-2",children:[e.jsx(Te,{size:18}),"Make an Offer"]})]}),e.jsx("p",{className:"text-center text-[10px] text-gray-400 mt-3 flex items-center justify-center gap-1",children:B?e.jsxs(e.Fragment,{children:[e.jsx(gt,{size:10})," Funds held in escrow • GPS verified exchange • Dual approval release"]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:10})," Purchases covered by SeshNx Buyer Protection"]})})]})]})]})})}function di({orders:t,user:s,userData:l,onBack:n,onUpdateStatus:d,openChat:o}){const[a,b]=r.useState(null),[x,g]=r.useState(!1),[m,u]=r.useState(""),[i,p]=r.useState("usps"),[c,y]=r.useState("all"),N=[{id:"usps",label:"USPS"},{id:"ups",label:"UPS"},{id:"fedex",label:"FedEx"},{id:"dhl",label:"DHL"},{id:"other",label:"Other"}],j=t.filter(h=>c==="buying"?h.role==="buyer":c==="selling"?h.role==="seller":!0),k=async()=>{if(!m){X.error("Please enter a tracking number");return}await d(a.id,Se.SHIPPED,{trackingNumber:m,carrier:i}),g(!1),u(""),b(null)},E=async h=>{await d(h.id,Se.COMPLETED)},C=h=>{const f=us[h];if(f){const R=f.icon;return e.jsx(R,{size:16})}return e.jsx(Ie,{size:16})};return e.jsxs("div",{className:"animate-in fade-in",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition",children:e.jsx(Ke,{className:"rotate-180 text-gray-500",size:20})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ta,{className:"text-orange-500"})," My Orders"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Track your purchases and sales"})]})]})}),e.jsx("div",{className:"flex gap-2 mb-6",children:[{id:"all",label:"All Orders"},{id:"buying",label:"Buying"},{id:"selling",label:"Selling"}].map(h=>e.jsx("button",{onClick:()=>y(h.id),className:`px-4 py-2 rounded-lg text-sm font-bold transition ${c===h.id?"bg-orange-600 text-white shadow":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:h.label},h.id))}),j.length===0?e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700",children:[e.jsx($a,{size:48,className:"mx-auto text-gray-300 dark:text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No orders yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:c==="buying"?"You haven't purchased anything yet":c==="selling"?"You haven't received any orders yet":"Start shopping or selling to see your orders here"}),e.jsx("button",{onClick:n,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700 transition",children:"Browse Gear"})]}):e.jsx("div",{className:"space-y-4",children:j.map(h=>{var I,S,w,v,$,B,M,T,P,A;const f=us[h.status]||us[Se.PENDING],R=h.role==="seller",z=h.role==="buyer";return e.jsx(ce.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg bg-gray-100 dark:bg-gray-800 overflow-hidden shrink-0",children:(I=h.itemPhotos)!=null&&I[0]?e.jsx("img",{src:h.itemPhotos[0],className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(pt,{className:"text-gray-400",size:24})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white truncate",children:h.itemTitle}),e.jsx("p",{className:"text-sm text-gray-500",children:h.itemBrand})]}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1.5 ${f.color}`,children:[C(h.status),f.label]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm flex-wrap",children:[z?e.jsxs("span",{className:"font-bold text-green-600",children:["$",((S=h.buyerTotal)==null?void 0:S.toFixed(2))||h.price,h.serviceFee&&e.jsxs("span",{className:"text-[10px] text-gray-400 font-normal ml-1",children:["(incl. $",(w=h.serviceFee)==null?void 0:w.toFixed(2)," fee)"]})]}):e.jsxs("span",{className:"font-bold text-green-600",children:["$",((v=h.sellerPayout)==null?void 0:v.toFixed(2))||h.price,h.serviceFee&&e.jsxs("span",{className:"text-[10px] text-gray-400 font-normal ml-1",children:["(after $",($=h.serviceFee)==null?void 0:$.toFixed(2)," fee)"]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${z?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"}`,children:z?"Purchasing":"Selling"}),e.jsx("span",{className:"text-gray-400 text-xs",children:((M=(B=h.createdAt)==null?void 0:B.toDate)==null?void 0:M.call(B).toLocaleDateString())||"Recently"})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:h.fulfillmentMethod==="shipping"?e.jsxs(e.Fragment,{children:[e.jsx(ct,{size:12}),e.jsxs("span",{children:["Shipping to ",(T=h.shippingAddress)==null?void 0:T.city,", ",(P=h.shippingAddress)==null?void 0:P.state]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{size:12}),e.jsx("span",{children:"Local Pickup"})]})}),h.trackingNumber&&e.jsx("div",{className:"mt-2 p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-xs",children:e.jsxs("span",{className:"text-purple-700 dark:text-purple-400 font-bold",children:["Tracking: ",(A=h.trackingCarrier)==null?void 0:A.toUpperCase()," - ",h.trackingNumber]})})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t dark:border-gray-700",children:[R&&h.status===Se.PENDING&&e.jsxs("button",{onClick:()=>d(h.id,Se.CONFIRMED),className:"flex-1 py-2 bg-blue-600 text-white text-sm font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2",children:[e.jsx(ve,{size:16})," Confirm Order"]}),R&&h.status===Se.CONFIRMED&&h.fulfillmentMethod==="shipping"&&e.jsxs("button",{onClick:()=>{b(h),g(!0)},className:"flex-1 py-2 bg-purple-600 text-white text-sm font-bold rounded-lg hover:bg-purple-700 transition flex items-center justify-center gap-2",children:[e.jsx(ct,{size:16})," Mark as Shipped"]}),R&&h.status===Se.CONFIRMED&&h.fulfillmentMethod==="pickup"&&e.jsxs("button",{onClick:()=>d(h.id,Se.COMPLETED),className:"flex-1 py-2 bg-green-600 text-white text-sm font-bold rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2",children:[e.jsx(ve,{size:16})," Mark as Picked Up"]}),z&&(h.status===Se.SHIPPED||h.status===Se.DELIVERED)&&e.jsxs("button",{onClick:()=>E(h),className:"flex-1 py-2 bg-green-600 text-white text-sm font-bold rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2",children:[e.jsx(ve,{size:16})," Confirm Receipt"]}),e.jsxs("button",{onClick:()=>o==null?void 0:o(z?h.sellerId:h.buyerId),className:"px-4 py-2 border border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 text-sm font-bold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition flex items-center gap-2",children:[e.jsx(Te,{size:16}),"Contact ",z?"Seller":"Buyer"]})]})]})},h.id)})}),e.jsx(Ve,{children:x&&a&&e.jsx(ce.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",onClick:()=>g(!1),children:e.jsxs(ce.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:h=>h.stopPropagation(),className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-6 w-full max-w-md shadow-2xl",children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ct,{className:"text-purple-600"})," Add Shipping Info"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Carrier"}),e.jsx("select",{value:i,onChange:h=>p(h.target.value),className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:N.map(h=>e.jsx("option",{value:h.id,children:h.label},h.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Tracking Number"}),e.jsx("input",{type:"text",value:m,onChange:h=>u(h.target.value),placeholder:"Enter tracking number",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300",children:[e.jsx(Os,{size:12,className:"inline mr-1"}),"The buyer will be notified with the tracking information"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(!1),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:"Cancel"}),e.jsxs("button",{onClick:k,className:"flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition flex items-center justify-center gap-2",children:[e.jsx(ct,{size:16})," Confirm Shipment"]})]})]})]})})})]})}function ci({user:t,userData:s,tokenBalance:l,refreshWallet:n}){const[d,o]=r.useState([]),[a,b]=r.useState("All"),[x,g]=r.useState(""),[m,u]=r.useState(new Set),[i,p]=r.useState(!1),[c,y]=r.useState(null),[N,j]=r.useState(null);r.useEffect(()=>{if(!(t!=null&&t.uid))return;const C=ye(le(O,te(t.uid).marketplaceItems),Ae("timestamp","desc")),h=fe(C,f=>{o(f.docs.map(R=>({id:R.id,...R.data()})))});return()=>h()},[t.uid]),r.useEffect(()=>{if(!(t!=null&&t.uid))return;const C=le(O,te(t.uid).userLibrary),h=fe(C,f=>{u(new Set(f.docs.map(R=>R.data().itemId)))});return()=>h()},[t==null?void 0:t.uid]);const k=async C=>{if(l<C.price){alert("Insufficient tokens! Please top up.");return}if(window.confirm(`Purchase ${C.title} for ${C.price} Tokens?`))try{const h=Q(O,te(t.uid).userWallet);await be(h,{balance:De(-C.price)}),await we(le(O,te(t.uid).userLibrary),{itemId:C.id,title:C.title,type:C.type,pricePaid:C.price,purchaseDate:ue(),downloadUrl:C.downloadUrl}),n&&n(),alert("Purchased successfully!")}catch(h){console.error(h),alert("Transaction failed.")}},E=d.filter(C=>(a==="All"||C.type===a)&&C.title.toLowerCase().includes(x.toLowerCase()));return e.jsxs("div",{className:"pb-32",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 md:pb-0 scrollbar-hide",children:["All","Presets","Samples","Beats"].map(C=>e.jsx("button",{onClick:()=>b(C),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-all ${a===C?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300"}`,children:C},C))}),e.jsxs("div",{className:"ml-auto flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(Be,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card text-sm dark:text-white focus:outline-none",placeholder:"Search...",value:x,onChange:C=>g(C.target.value)})]}),e.jsxs("button",{onClick:()=>p(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-green-700",children:[e.jsx(Tt,{size:16})," Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:E.map(C=>{const h=m.has(C.id);return e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition flex flex-col group",children:[e.jsxs("div",{className:"aspect-square relative bg-gray-100 dark:bg-gray-800 flex items-center justify-center cursor-pointer",onClick:()=>y(C),children:[C.type==="Presets"?e.jsx($s,{size:40,className:"text-gray-400"}):e.jsx(Bs,{size:40,className:"text-gray-400"}),h&&e.jsxs("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded flex items-center gap-1",children:[e.jsx(ve,{size:8})," OWNED"]})]}),e.jsxs("div",{className:"p-3 flex flex-col flex-1",children:[e.jsx("div",{className:"text-[10px] font-bold text-brand-blue uppercase mb-1",children:C.type}),e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate mb-1",title:C.title,children:C.title}),e.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[e.jsxs("span",{className:"text-xs font-bold text-yellow-600 dark:text-yellow-400 flex items-center gap-1",children:[e.jsx(Oe,{size:10,fill:"currentColor"})," ",C.price]}),!h&&e.jsx("button",{onClick:()=>k(C),className:"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1 rounded text-[10px] font-bold hover:opacity-80",children:"Buy"})]})]})]},C.id)})}),i&&e.jsx(xi,{user:t,userData:s,onClose:()=>p(!1)}),c&&e.jsx(gi,{item:c,isOwned:m.has(c.id),user:t,onClose:()=>y(null),onBuy:()=>k(c),onDownload:()=>handleDownload(c),onReport:()=>j({id:c.id,type:"market_item",summary:c.title})}),N&&e.jsx(Qa,{user:t,target:N,onClose:()=>j(null)})]})}function xi({user:t,userData:s,onClose:l}){const[n,d]=r.useState({title:"",price:"",type:"Presets",tags:"",description:""}),[o,a]=r.useState(null),[b,x]=r.useState(""),{uploadMedia:g,uploading:m}=it(),u=async()=>{if(!n.title||!n.price||!o)return alert("Title, Price, and Audio File are required.");try{x("Uploading Audio Asset...");const i=await g(o,te(t.uid).marketAssets);x("Listing Item..."),await we(le(O,te(t.uid).marketplaceItems),{...n,price:parseInt(n.price),tags:n.tags.split(",").map(p=>p.trim()).filter(p=>p),author:`${s.firstName} ${s.lastName}`,authorId:t.uid,downloadUrl:i,timestamp:ue()}),x("Success!"),setTimeout(l,1e3)}catch(i){console.error(i),x("Error listing item."),alert("Failed to submit item to market. Check console.")}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Creator Studio"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"List a new sound for sale"})]}),e.jsx("button",{onClick:l,children:e.jsx(pe,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Title"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:n.title,onChange:i=>d({...n,title:i.target.value}),placeholder:"e.g. Midnight Lofi"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Type"}),e.jsxs("select",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:n.type,onChange:i=>d({...n,type:i.target.value}),children:[e.jsx("option",{children:"Presets"}),e.jsx("option",{children:"Samples"}),e.jsx("option",{children:"Beats"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Price (TK)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:n.price,onChange:i=>d({...n,price:i.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:"3",value:n.description,onChange:i=>d({...n,description:i.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Tags (Comma Separated)"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:n.tags,onChange:i=>d({...n,tags:i.target.value}),placeholder:"lofi, hiphop, boom-bap"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-2 border-dashed dark:border-gray-600 rounded-xl p-6 text-center hover:bg-gray-50 dark:hover:bg-gray-800 transition relative bg-blue-50/50 dark:bg-blue-900/10 h-full flex flex-col justify-center items-center",children:[e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"audio/*",onChange:i=>a(i.target.files[0])}),e.jsx(lt,{size:48,className:"mx-auto text-blue-500 mb-2"}),e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:o?o.name:"Upload Audio File (Product Asset)"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"MP3/WAV (Max 50MB)"}),o&&e.jsx("div",{className:"mt-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Selected"})]})})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:u,disabled:m||!n.title||!n.price||!o,className:"w-full bg-brand-blue text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50",children:m?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"animate-spin"})," ",b]}):"List Item for Sale"})})]})})}function gi({item:t,isOwned:s,onClose:l,onBuy:n,onDownload:d,onReport:o}){return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-2xl overflow-hidden w-full max-w-4xl shadow-2xl flex flex-col md:flex-row h-[80vh] md:h-[600px]",children:[e.jsxs("div",{className:"md:w-5/12 bg-gray-100 dark:bg-black/40 relative p-8 flex flex-col justify-center items-center text-center",children:[e.jsx("div",{className:"w-64 h-64 bg-gradient-to-br from-brand-blue to-purple-600 rounded-lg shadow-2xl mb-6 flex items-center justify-center text-white",children:t.type==="Presets"?e.jsx($s,{size:80}):e.jsx(Bs,{size:80})}),e.jsx("h2",{className:"text-2xl font-bold dark:text-white mb-2",children:t.title}),e.jsxs("div",{className:"text-brand-blue font-medium mb-6",children:["by ",t.author]}),t.downloadUrl&&e.jsx("div",{className:"w-full",children:e.jsx(ks,{audioUrl:t.downloadUrl,fileName:"Preview Track",previewMode:!s})})]}),e.jsxs("div",{className:"md:w-7/12 p-8 overflow-y-auto flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded uppercase tracking-wide",children:t.type}),e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white mt-2",children:t.title})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:o,className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-gray-400 hover:text-red-500 rounded-full transition",title:"Report Violation",children:e.jsx(Gt,{size:20})}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(pe,{size:20})})]})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300 mb-8",children:[e.jsx("p",{children:t.description||"No description provided by the creator."}),!s&&e.jsxs("div",{className:"mt-4 bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded text-yellow-800 dark:text-yellow-200 text-xs flex items-center gap-2",children:[e.jsx(Info,{size:14})," Audio preview is truncated to 15 seconds. Purchase to unlock full track."]})]}),e.jsx("div",{className:"mt-auto",children:s?e.jsxs("button",{onClick:d,className:"w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx(Ia,{size:24})," Download Now"]}):e.jsxs("button",{onClick:n,className:"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx("span",{children:"Buy for"}),e.jsxs("span",{className:"bg-yellow-400 text-black px-2 py-0.5 rounded text-sm flex items-center gap-1",children:[e.jsx(Oe,{size:12,fill:"black"})," ",t.price]})]})})]})]})})}function mi({user:t,userData:s,tokenBalance:l}){const[n,d]=Mr(),o=n.get("tab")||"gear",[a,b]=r.useState(o);r.useEffect(()=>{const m=n.get("tab");m&&(m==="gear"||m==="fx")&&b(m)},[n]);const x=m=>{b(m),d(m==="gear"?{}:{tab:m})},g=[{id:"gear",label:"Gear Exchange"},{id:"fx",label:"SeshFX Store"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:"Marketplace"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-1 rounded-lg border dark:border-gray-700 flex gap-1",children:g.map(m=>e.jsx("button",{onClick:()=>x(m.id),className:`px-4 py-2 text-sm font-bold rounded-md transition-all ${a===m.id?"bg-brand-blue text-white shadow-md":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:m.label},m.id))})]}),e.jsxs("div",{className:"tab-content-wrapper",children:[a==="gear"&&e.jsx("div",{className:"tab-content",children:e.jsx(ni,{user:t,userData:s})},"gear"),a==="fx"&&e.jsx("div",{className:"tab-content",children:e.jsx(ci,{user:t,tokenBalance:l})},"fx")]})]})}function ui({user:t,userData:s,openPublicProfile:l,pendingChatTarget:n,clearPendingChatTarget:d}){const[o,a]=r.useState(null),[b,x]=r.useState(!1);El(t==null?void 0:t.uid),r.useEffect(()=>{if(n&&(t!=null&&t.uid)){const p=[t.uid,n.uid].sort().join("_");a({id:p,uid:n.uid,name:n.name,type:"direct"}),d==null||d()}},[n,t==null?void 0:t.uid,d]);const g=Ns(),m=r.useMemo(()=>t!=null&&t.uid&&g?{userId:t.uid}:"skip",[t==null?void 0:t.uid,g]),u=Sa(Fa.conversations.getConversations,m),i=r.useMemo(()=>u?u.map(p=>({id:p.chatId,uid:p.otherUserId||p.chatId,name:p.chatName||"Unknown",n:p.chatName||"Unknown",photo:p.chatPhoto||"",type:p.chatType||"direct",lm:p.lastMessage||"",lmt:p.lastMessageTime||0,ls:p.lastSenderId||"",uc:p.unreadCount||0})).sort((p,c)=>(c.lmt||0)-(p.lmt||0)):[],[u]);return r.useEffect(()=>{Ns()||console.warn("Convex is not available. Chat functionality is disabled.")},[]),e.jsxs("div",{className:"flex h-[calc(100vh-100px)] bg-white dark:bg-[#1f2128] rounded-2xl overflow-hidden border dark:border-gray-800 shadow-xl",children:[e.jsx(ce.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`w-full md:w-80 border-r dark:border-gray-800 flex flex-col ${o?"hidden md:flex":"flex"}`,children:e.jsx(Rl,{user:t,userData:s,conversations:i,activeChat:o,onSelectChat:a})}),e.jsxs("div",{className:`flex-1 flex flex-col relative ${o?"flex":"hidden md:flex"}`,children:[e.jsx(Pl,{activeChat:o,user:t,userData:s,conversations:i,onBack:()=>a(null),toggleDetails:()=>x(!b),openPublicProfile:l}),e.jsx(Ve,{children:b&&o&&e.jsx(ce.div,{initial:{width:0,opacity:0},animate:{width:300,opacity:1},exit:{width:0,opacity:0},className:"border-l dark:border-gray-800 bg-gray-50 dark:bg-[#23262f] overflow-hidden relative z-20",children:e.jsx(Al,{activeChat:o,currentUser:s,onClose:()=>x(!1)})})})]})]})}function ga({userData:t,stats:s,onNavigate:l}){var i;const[n,d]=r.useState(new Date),o=(t==null?void 0:t.studioName)||(t==null?void 0:t.profileName)||"My Studio",a=(t==null?void 0:t.rooms)||[],b=(t==null?void 0:t.amenities)||[],x=a.reduce((p,c)=>p+(c.capacity||0),0),g=a.length>0?Math.round(a.reduce((p,c)=>p+(c.rate||0),0)/a.length):0,m=[{label:"Active Rooms",value:a.length,icon:e.jsx(Ye,{size:20}),color:"blue",onClick:()=>l("rooms")},{label:"Total Capacity",value:`${x} ppl`,icon:e.jsx(Fe,{size:20}),color:"green"},{label:"Avg. Rate",value:`$${g}/hr`,icon:e.jsx($e,{size:20}),color:"purple"},{label:"Amenities",value:b.length,icon:e.jsx(et,{size:20}),color:"amber"}],u=(s==null?void 0:s.pendingBookings)||0;return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-8 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm",children:e.jsx(Ye,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:o}),e.jsxs("p",{className:"text-blue-100 text-sm flex items-center gap-1",children:[e.jsx(Le,{size:14}),t!=null&&t.city&&(t!=null&&t.state)?`${t.city}, ${t.state}`:"Location not set"]})]})]}),(t==null?void 0:t.studioDescription)&&e.jsx("p",{className:"text-blue-100 text-sm mt-4 max-w-2xl line-clamp-2",children:t.studioDescription})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:m.map((p,c)=>e.jsxs("button",{onClick:p.onClick,className:`bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm text-left transition-all ${p.onClick?"hover:shadow-md hover:border-brand-blue cursor-pointer":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-lg bg-${p.color}-100 dark:bg-${p.color}-900/20 flex items-center justify-center text-${p.color}-600 dark:text-${p.color}-400 mb-3`,children:p.icon}),e.jsx("div",{className:"text-2xl font-bold dark:text-white",children:p.value}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase font-medium tracking-wide",children:p.label})]},c))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(st,{size:18,className:"text-amber-500"}),"Pending Actions"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[u>0?e.jsxs("button",{onClick:()=>l("bookings"),className:"w-full flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30 transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Re,{className:"text-amber-600",size:18}),e.jsxs("span",{className:"text-sm font-medium dark:text-amber-300",children:[u," Pending Booking",u>1?"s":""]})]}),e.jsx("span",{className:"text-xs text-amber-600 font-bold",children:"Review →"})]}):e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx(ve,{className:"text-green-600",size:18}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"All caught up!"})]}),!(t!=null&&t.studioDescription)&&e.jsxs("button",{onClick:()=>l("settings"),className:"w-full flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Add studio description"}),e.jsx("span",{className:"text-xs text-blue-600 font-bold",children:"Setup →"})]}),a.length===0&&e.jsxs("button",{onClick:()=>l("rooms"),className:"w-full flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Add your first room"}),e.jsx("span",{className:"text-xs text-purple-600 font-bold",children:"Add →"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ye,{size:18,className:"text-brand-blue"}),"Rooms"]}),e.jsx("button",{onClick:()=>l("rooms"),className:"text-xs text-brand-blue font-bold hover:underline",children:"Manage →"})]}),e.jsx("div",{className:"p-4",children:a.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Ye,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No rooms configured yet"})]}):e.jsxs("div",{className:"space-y-2",children:[a.slice(0,4).map((p,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white text-sm",children:p.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[p.capacity," people • ",p.equipment?p.equipment.split(",").length:0," gear items"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-bold text-green-600 dark:text-green-400",children:["$",p.rate,"/hr"]})})]},c)),a.length>4&&e.jsxs("p",{className:"text-xs text-center text-gray-400 pt-2",children:["+",a.length-4," more rooms"]})]})})]})]}),b.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(et,{size:18,className:"text-amber-500"}),"Studio Amenities"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map((p,c)=>e.jsx("span",{className:"px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:p},c))})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Re,{size:18,className:"text-brand-blue"}),"Booking Calendar"]}),e.jsx("button",{onClick:()=>l("bookings"),className:"text-xs text-brand-blue font-bold hover:underline",children:"View All →"})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>d(new Date(n.getFullYear(),n.getMonth()-1,1)),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:e.jsx(rs,{size:18,className:"text-gray-500"})}),e.jsx("span",{className:"font-bold dark:text-white",children:n.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>d(new Date(n.getFullYear(),n.getMonth()+1,1)),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:e.jsx(Ke,{size:18,className:"text-gray-500"})})]}),e.jsx(bi,{currentDate:n,bookings:(s==null?void 0:s.recentBookings)||[],onNavigate:l}),((i=s==null?void 0:s.recentBookings)==null?void 0:i.length)>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-gray-700",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Upcoming Sessions"}),e.jsx("div",{className:"space-y-2",children:s.recentBookings.slice(0,3).map((p,c)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium dark:text-white",children:p.clientName||"Client"}),e.jsx("span",{className:"text-gray-500 ml-2",children:new Date(p.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p.status==="confirmed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:p.status||"pending"})]},c))})]})]})]})]})}function bi({currentDate:t,bookings:s,onNavigate:l}){const n=t.getFullYear(),d=t.getMonth(),o=new Date,a=new Date(n,d,1).getDay(),b=new Date(n,d+1,0).getDate(),x=[];for(let i=0;i<a;i++)x.push(null);for(let i=1;i<=b;i++)x.push(i);const g=i=>i?s.filter(p=>{const c=new Date(p.date);return c.getDate()===i&&c.getMonth()===d&&c.getFullYear()===n}):[],m=i=>i===o.getDate()&&d===o.getMonth()&&n===o.getFullYear(),u=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:u.map(i=>e.jsx("div",{className:"text-center text-xs font-bold text-gray-400 py-1",children:i},i))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:x.map((i,p)=>{const c=g(i),y=c.length>0,N=c.some(k=>k.status==="confirmed"),j=c.some(k=>k.status==="pending");return e.jsxs("button",{onClick:()=>i&&y&&l("bookings"),disabled:!i,className:`aspect-square flex flex-col items-center justify-center rounded-lg text-sm relative transition ${i?m(i)?"bg-brand-blue text-white font-bold":y?"bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 cursor-pointer":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700":""}`,children:[i,y&&!m(i)&&e.jsxs("div",{className:"flex gap-0.5 mt-0.5",children:[N&&e.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),j&&e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"})]})]},p)})}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Confirmed"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"Pending"]})]})]})}const hi=()=>{const{data:t,loading:s}=er(),[l,n]=r.useState([]),d=r.useMemo(()=>{if(s||!t)return[];let a=[];try{Object.keys(t).forEach(b=>{const x=t[b];x&&Object.entries(x).forEach(([g,m])=>{if(!m||typeof m!="object")return;const u=m.brand||m.searchTokens&&m.searchTokens[0]||"Unknown",i=m.name||m.searchTokens&&m.searchTokens[1]||"Unknown Item",p=m.searchTokens||[],c=[i,u,...p].join(" ").toLowerCase();a.push({id:g,name:i,brand:u,category:m.category||b,subCategory:m.subCategory||"General",searchString:c,original:m})})})}catch(b){console.warn("Error processing equipment data:",b)}return a},[t,s]);return{searchEquipment:a=>{if(!a||a.trim().length<1){n([]);return}const b=a.toLowerCase().trim().split(/\s+/),x=d.filter(g=>b.every(m=>g.searchString.includes(m))).slice(0,50);n(x)},results:l,loading:s}};function Ws({onSelect:t,placeholder:s="Search for gear (e.g. U87, SSL)...",className:l="",value:n,onChange:d,multi:o=!1}){const{searchEquipment:a,results:b,loading:x}=hi(),[g,m]=r.useState(""),[u,i]=r.useState(!1),p=r.useRef(null),c=n!==void 0?n:g;r.useEffect(()=>{function j(k){p.current&&!p.current.contains(k.target)&&i(!1)}return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[p]);const y=j=>{const k=j.target.value;d?d(k):m(k);const E=o?k.split(",").pop().trim():k;E.length>=2?(a(E),i(!0)):i(!1)},N=j=>{const k=j.brand!=="Various"&&j.brand!=="Unknown"?`${j.brand} ${j.name}`:j.name;if(o){const E=c.split(",");E.pop();const h=[...E.map(f=>f.trim()).filter(Boolean),k].join(", ")+", ";d?d(h):m(h)}else t&&t({...j,fullName:k}),d?d(k):m(k);i(!1)};return e.jsxs("div",{ref:p,className:`relative ${l}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-8 p-3 text-sm border rounded-xl bg-white dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none transition-all",placeholder:s,value:c,onChange:y,onFocus:j=>y(j)}),c&&e.jsx("button",{type:"button",onClick:()=>{d?d(""):m(""),i(!1)},className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:e.jsx(pe,{size:16})})]}),u&&b.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-60 overflow-y-auto animate-in fade-in slide-in-from-top-2",children:e.jsx("div",{className:"py-1",children:b.map(j=>{var k;return e.jsxs("button",{type:"button",onClick:()=>N(j),className:"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group",children:[e.jsx("div",{className:"font-bold text-sm dark:text-white group-hover:text-brand-blue transition-colors",children:j.name}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1.5 mt-0.5",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:j.brand}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600"}),e.jsx("span",{className:"opacity-75",children:(k=j.subCategory)==null?void 0:k.replace(/_/g," ")})]})]},j.id)})})}),u&&x&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2",children:[e.jsx(oe,{className:"animate-spin",size:16})," Searching database..."]})]})}const We=10,pi=(t,s,l,n,d,o)=>{const a=t-l,b=s-n,x=d-l,g=o-n,m=a*x+b*g,u=x*x+g*g;let i=-1;u!==0&&(i=m/u);let p,c;i<0?(p=l,c=n):i>1?(p=d,c=o):(p=l+i*x,c=n+i*g);const y=t-p,N=s-c;return Math.sqrt(y*y+N*N)};function fi({rooms:t,walls:s,structures:l,onRoomClick:n,onLayoutChange:d,onWallsChange:o,onStructuresChange:a}){var ge;const b=r.useRef(null),[x,g]=r.useState(!1),[m,u]=r.useState(!1),[i,p]=r.useState({x:0,y:0}),[c,y]=r.useState(null),[N,j]=r.useState(null),[k,E]=r.useState(null),[C,h]=r.useState(null),[f,R]=r.useState(s||[]),[z,I]=r.useState(l||[]),[S,w]=r.useState(null),[v,$]=r.useState("select"),[B,M]=r.useState(null),T=800,P=600;r.useEffect(()=>{R(s||[])},[s]),r.useEffect(()=>{I(l||[])},[l]);const A=U=>{const K=b.current.getBoundingClientRect();let H=U.clientX,V=U.clientY;U.touches&&U.touches.length>0&&(H=U.touches[0].clientX,V=U.touches[0].clientY);const xe=H-K.left,ke=V-K.top;return{x:Math.round(xe/We)*We,y:Math.round(ke/We)*We}},F=U=>{R(U),o(U)},L=U=>{I(U),a(U)},W=r.useCallback(()=>{if(N){const U=z.filter(K=>K.id!==N);L(U),j(null)}else if(k){const U=f.filter(K=>K.id!==k);F(U),E(null)}},[N,k,z,f]),Z=r.useCallback(()=>{if(N){const U=z.find(K=>K.id===N);U&&w({type:"structure",data:U})}else if(k){const U=f.find(K=>K.id===k);U&&w({type:"wall",data:U})}},[N,k,z,f]),D=r.useCallback(()=>{if(!S)return;const U=20;if(S.type==="structure"){const K={...S.data,id:`struct_${Date.now()}`,layout:{...S.data.layout,x:S.data.layout.x+U,y:S.data.layout.y+U}};L([...z,K]),j(K.id)}else if(S.type==="wall"){const K={...S.data,id:`wall_${Date.now()}`,x1:S.data.x1+U,y1:S.data.y1+U,x2:S.data.x2+U,y2:S.data.y2+U};F([...f,K]),E(K.id)}},[S,z,f]),Y=r.useCallback(()=>{Z(),W()},[Z,W]);r.useEffect(()=>{const U=K=>{(K.key==="Delete"||K.key==="Backspace")&&W(),(K.ctrlKey||K.metaKey)&&K.key==="c"&&(K.preventDefault(),Z()),(K.ctrlKey||K.metaKey)&&K.key==="v"&&(K.preventDefault(),D()),(K.ctrlKey||K.metaKey)&&K.key==="x"&&(K.preventDefault(),Y())};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)},[W,Z,D,Y]);const q=r.useCallback((U,K)=>{if(v!=="select")return;U.preventDefault(),U.stopPropagation();const{x:H,y:V}=A(U);y(K.id),j(null),E(null),g(!0),u(!1),p({x:H-K.layout.x,y:V-K.layout.y})},[v]),J=r.useCallback((U,K,H)=>{U.preventDefault(),U.stopPropagation(),y(K.id),j(null),E(null),g(!1),u(H)},[]),ee=()=>{const U={id:`struct_${Date.now()}`,label:"Lobby / Area",layout:{x:100,y:100,width:150,height:100,color:"#94a3b8"}};L([...z,U]),$("select")},ne=r.useCallback((U,K)=>{if(v!=="select")return;U.preventDefault(),U.stopPropagation();const{x:H,y:V}=A(U);j(K.id),y(null),E(null),g(!0),u(!1),p({x:H-K.layout.x,y:V-K.layout.y})},[v]),me=r.useCallback((U,K,H)=>{U.preventDefault(),U.stopPropagation(),j(K.id),y(null),E(null),g(!1),u(H)},[]),_=r.useCallback((U,K,H)=>{v==="select"&&(U.preventDefault(),U.stopPropagation(),h({id:K,point:H}),y(null),j(null),E(K))},[v]),ae=(U,K)=>{v==="select"&&(U.stopPropagation(),E(K),y(null),j(null))},de=r.useCallback(U=>{if(!b.current)return;const{x:K,y:H}=A(U);if(v==="wall"&&B){const V={id:"preview",x1:B.x,y1:B.y,x2:K,y2:H};R(xe=>[...xe.filter(ke=>ke.id!=="preview"),V]);return}if(C){R(V=>V.map(xe=>xe.id!==C.id?xe:C.point==="start"?{...xe,x1:K,y1:H}:{...xe,x2:K,y2:H}));return}if(x){const V={x:K-i.x,y:H-i.y};if(c){const xe=t.find(ke=>ke.id===c);xe&&d(c,{...xe.layout,...V})}else N&&I(xe=>xe.map(ke=>ke.id===N?{...ke,layout:{...ke.layout,...V}}:ke))}if(m==="br")if(c){const V=t.find(xe=>xe.id===c);if(V){const xe={width:Math.max(We,K-V.layout.x),height:Math.max(We,H-V.layout.y)};d(c,{...V.layout,...xe})}}else N&&I(V=>V.map(xe=>xe.id!==N?xe:{...xe,layout:{...xe.layout,width:Math.max(We,K-xe.layout.x),height:Math.max(We,H-xe.layout.y)}}))},[c,N,x,m,C,i,t,d,v,B]),G=r.useCallback(()=>{(x||m)&&N&&a(z),C&&o(f),g(!1),u(!1),h(null)},[x,m,C,N,z,f,a,o]),he=r.useCallback(U=>{if(v!=="wall"){!x&&!m&&(y(null),j(null),E(null));return}U.stopPropagation();const{x:K,y:H}=A(U);if(!B)M({x:K,y:H});else{const V={id:`wall_${Date.now()}`,x1:B.x,y1:B.y,x2:K,y2:H,stroke:"#52525B",strokeWidth:5},xe=[...f.filter(ke=>ke.id!=="preview"),V];F(xe),M(null)}},[v,B,x,m,f]),se=U=>{$(U),M(null),U==="structure"?ee():R(K=>K.filter(H=>H.id!=="preview"))};r.useEffect(()=>(document.addEventListener("mousemove",de),document.addEventListener("mouseup",G),document.addEventListener("touchmove",de),document.addEventListener("touchend",G),()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",G),document.removeEventListener("touchmove",de),document.removeEventListener("touchend",G)}),[de,G]);const je=({wall:U})=>{const K=U.id==="preview",H=k===U.id;return e.jsxs("g",{onClick:V=>ae(V,U.id),cursor:"pointer",children:[e.jsx("line",{x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,stroke:"transparent",strokeWidth:"15"}),e.jsx("line",{x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,stroke:K?"#ef4444":H?"#3D84ED":U.stroke,strokeWidth:U.strokeWidth,strokeLinecap:"round",opacity:K?.7:1}),!K&&e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:U.x1,cy:U.y1,r:6,fill:"white",stroke:"#52525B",strokeWidth:"2",className:"cursor-move hover:fill-brand-blue",onMouseDown:V=>_(V,U.id,"start")}),e.jsx("circle",{cx:U.x2,cy:U.y2,r:6,fill:"white",stroke:"#52525B",strokeWidth:"2",className:"cursor-move hover:fill-brand-blue",onMouseDown:V=>_(V,U.id,"end")})]})]})},Ne=({data:U,isStructure:K=!1,onClick:H})=>{const{layout:V,name:xe,rate:ke,label:os}=U,Us=K?N===U.id:c===U.id,Mt=(Me,nr)=>f.some(Ft=>pi(Me,nr,Ft.x1,Ft.y1,Ft.x2,Ft.y2)<12),ds=Mt(V.x,V.y),Vs=Mt(V.x+V.width,V.y),Gs=Mt(V.x+V.width,V.y+V.height),Ys=Mt(V.x,V.y+V.height),at=8,lr=[`M ${V.x+(ds?0:at)} ${V.y}`,`L ${V.x+V.width-(Vs?0:at)} ${V.y}`,`Q ${V.x+V.width} ${V.y} ${V.x+V.width} ${V.y+(Vs?0:at)}`,`L ${V.x+V.width} ${V.y+V.height-(Gs?0:at)}`,`Q ${V.x+V.width} ${V.y+V.height} ${V.x+V.width-(Gs?0:at)} ${V.y+V.height}`,`L ${V.x+(Ys?0:at)} ${V.y+V.height}`,`Q ${V.x} ${V.y+V.height} ${V.x} ${V.y+V.height-(Ys?0:at)}`,`L ${V.x} ${V.y+(ds?0:at)}`,`Q ${V.x} ${V.y} ${V.x+(ds?0:at)} ${V.y}`,"Z"].join(" ");return e.jsxs("g",{onClick:Me=>{Me.stopPropagation(),H(U)},cursor:"pointer",style:{filter:Us?`drop-shadow(0 0 5px ${V.color})`:"none"},pointerEvents:v!=="select"?"none":"auto",children:[e.jsx("path",{d:lr,fill:V.color,opacity:K?"0.5":"0.8",stroke:V.color,strokeWidth:"4",strokeDasharray:K?"5,5":"0",onMouseDown:Me=>K?ne(Me,U):q(Me,U),onTouchStart:Me=>K?ne(Me,U):q(Me,U),style:{cursor:m?"default":"grab"}}),e.jsxs("text",{x:V.x+V.width/2,y:V.y+V.height/2,fill:"white",textAnchor:"middle",dominantBaseline:"middle",style:{pointerEvents:"none",userSelect:"none"},children:[e.jsx("tspan",{x:V.x+V.width/2,dy:"-0.5em",fontWeight:"bold",fontSize:"14",children:K?os||"Area":xe}),!K&&ke&&e.jsxs("tspan",{x:V.x+V.width/2,dy:"1.2em",fontSize:"12",children:["$",ke,"/hr"]})]}),Us&&e.jsx("rect",{x:V.x+V.width-10,y:V.y+V.height-10,width:"20",height:"20",fill:"white",stroke:"black",strokeWidth:"2",rx:"4",cursor:"nwse-resize",onMouseDown:Me=>K?me(Me,U,"br"):J(Me,U,"br"),onTouchStart:Me=>K?me(Me,U,"br"):J(Me,U,"br")})]})};return e.jsxs("div",{className:"flex flex-col h-[650px]",children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36] rounded-t-xl",children:[e.jsxs("div",{className:"flex gap-4 text-sm text-gray-500 font-medium",children:[e.jsxs("button",{onClick:Z,disabled:!N&&!k,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[e.jsx(It,{size:14})," Copy"]}),e.jsxs("button",{onClick:D,disabled:!S,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[e.jsx(Fr,{size:14})," Paste"]}),e.jsxs("button",{onClick:Y,disabled:!N&&!k,className:"hover:text-brand-blue disabled:opacity-50 flex items-center gap-1",children:[e.jsx(Or,{size:14})," Cut"]}),e.jsxs("button",{onClick:W,disabled:!N&&!k,className:"hover:text-red-500 disabled:opacity-50 flex items-center gap-1",children:[e.jsx(_e,{size:14})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${v==="structure"?"bg-purple-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200"}`,onClick:()=>se("structure"),children:[e.jsx(Br,{size:16})," Add Lobby / Area"]}),e.jsxs("button",{className:`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${v==="wall"?"bg-red-500 text-white shadow-lg":"bg-brand-blue text-white hover:bg-blue-600"}`,onClick:()=>se(v==="wall"?"select":"wall"),children:[e.jsx(Oe,{size:16})," ",v==="wall"?B?"Finish Wall":"Drawing Mode":"Add Wall"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto bg-gray-50 dark:bg-[#1f2128] rounded-b-xl border-x border-b dark:border-gray-700 relative",style:{cursor:v==="wall"?"crosshair":"default"},tabIndex:0,onKeyDown:U=>{},children:[e.jsxs("svg",{ref:b,width:T,height:P,className:"w-full h-full shadow-inner focus:outline-none",viewBox:`0 0 ${T} ${P}`,onMouseMove:de,onMouseUp:G,onTouchMove:de,onTouchEnd:G,onClick:he,children:[e.jsx("pattern",{id:"smallGrid",width:We,height:We,patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:`M ${We} 0 L 0 0 0 ${We}`,fill:"none",stroke:"#e5e7eb",strokeWidth:"0.5"})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#smallGrid)"}),z.map(U=>e.jsx(Ne,{data:U,isStructure:!0,onClick:()=>j(U.id)},U.id)),t.map(U=>e.jsx(Ne,{data:U,onClick:K=>n(t.findIndex(H=>H.id===K.id))},U.id)),f.map(U=>e.jsx(je,{wall:U},U.id)),e.jsxs("text",{x:"10",y:"20",fontSize:"10",fill:"#9CA3AF",children:["Grid: ",We,"px | ",f.length," Walls"]})]}),N&&e.jsxs("div",{className:"absolute bottom-4 right-4 bg-white dark:bg-dark-card p-2 rounded shadow border dark:border-gray-600 text-xs flex gap-2",children:[e.jsx("input",{className:"bg-transparent border-b border-gray-300 focus:border-blue-500 outline-none dark:text-white",value:(ge=z.find(U=>U.id===N))==null?void 0:ge.label,onChange:U=>{const K=U.target.value;I(H=>H.map(xe=>xe.id===N?{...xe,label:K}:xe))},onBlur:()=>L(z)}),e.jsx("button",{onClick:W,className:"text-red-500 hover:bg-red-50 rounded p-1",children:e.jsx(_e,{size:14})})]})]})]})}function yi({user:t,userData:s,onUpdate:l}){const[n,d]=r.useState((s==null?void 0:s.rooms)||[]),[o,a]=r.useState((s==null?void 0:s.floorplanWalls)||[]),[b,x]=r.useState((s==null?void 0:s.floorplanStructures)||[]),[g,m]=r.useState(null),[u,i]=r.useState(!1),[p,c]=r.useState(!1),[y,N]=r.useState(null),[j,k]=r.useState("list"),E={name:"",description:"",rate:50,capacity:4,equipment:"",amenities:[],minBookingHours:1,active:!0,color:"#3B82F6"},C=async(P,A=o,F=b)=>{c(!0);const L=X.loading("Saving rooms...");try{const W=Q(O,`artifacts/${re}/users/${t.uid}/profiles/main`);await be(W,{rooms:P,floorplanWalls:A,floorplanStructures:F}),d(P),a(A),x(F),X.success("Rooms saved!",{id:L}),l&&l({rooms:P,floorplanWalls:A,floorplanStructures:F})}catch(W){console.error("Save failed:",W),X.error("Failed to save",{id:L})}finally{c(!1)}},h=(P,A)=>{const F=n.map(L=>L.id===P?{...L,layout:A}:L);d(F)},f=async P=>{a(P);try{const A=Q(O,`artifacts/${re}/users/${t.uid}/profiles/main`);await be(A,{floorplanWalls:P})}catch(A){console.error("Error saving walls:",A)}},R=async P=>{x(P);try{const A=Q(O,`artifacts/${re}/users/${t.uid}/profiles/main`);await be(A,{floorplanStructures:P})}catch(A){console.error("Error saving structures:",A)}},z=P=>{P>=0&&P<n.length&&S(P)},I=()=>{m({...E,name:`Room ${n.length+1}`}),i(!0)},S=P=>{m({...n[P]}),i(!1),N(P)},w=async()=>{if(!g.name.trim()){X.error("Room name is required");return}let P;u?P=[...n,g]:P=n.map((A,F)=>F===y?g:A),await C(P),m(null),i(!1),N(null)},v=async P=>{if(!confirm(`Delete "${n[P].name}"? This cannot be undone.`))return;const A=n.filter((F,L)=>L!==P);await C(A)},$=async P=>{const A={...n[P],name:`${n[P].name} (Copy)`},F=[...n,A];await C(F)},B=()=>{m(null),i(!1),N(null)},M=["Isolation Booth","Live Room","Control Room","Lounge Area","Private Bathroom","Natural Light","Blackout Curtains","Video Feed","Climate Control","Sound Lock"],T=n.map((P,A)=>({...P,id:P.id||`room_${A}`,layout:P.layout||{x:50+A%3*200,y:50+Math.floor(A/3)*150,width:180,height:120,color:P.color||"#3B82F6"}}));return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(vs,{className:"text-brand-blue",size:24}),"Room Management"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Configure your studio rooms, rates, and equipment"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>k("list"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${j==="list"?"bg-white dark:bg-gray-700 shadow text-brand-blue":"text-gray-600 dark:text-gray-400"}`,children:[e.jsx(_r,{size:16})," List"]}),e.jsxs("button",{onClick:()=>k("floorplan"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${j==="floorplan"?"bg-white dark:bg-gray-700 shadow text-brand-blue":"text-gray-600 dark:text-gray-400"}`,children:[e.jsx(qr,{size:16})," Floorplan"]})]}),e.jsxs("button",{onClick:I,disabled:u||g,className:"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[e.jsx(nt,{size:18})," Add Room"]})]})]}),u&&g&&e.jsx(ma,{room:g,setRoom:m,onSave:w,onCancel:B,saving:p,isNew:!0,roomAmenities:M}),j==="floorplan"&&!u&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsx(fi,{rooms:T,walls:o,structures:b,onRoomClick:z,onLayoutChange:h,onWallsChange:f,onStructuresChange:R}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-[#23262f] border-t dark:border-gray-700 text-xs text-gray-500",children:[e.jsx("strong",{children:"Tips:"})," Click a room to edit • Drag to reposition • Use corner handles to resize • Add walls to define boundaries"]})]}),j==="list"&&e.jsx("div",{className:"space-y-4",children:n.length===0&&!u?e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center",children:[e.jsx(vs,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Rooms Yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-sm mx-auto",children:"Add your first room to start accepting bookings"}),e.jsx("button",{onClick:I,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition",children:"Add Your First Room"})]}):n.map((P,A)=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-[#23262f] transition",onClick:()=>N(y===A?null:A),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:P.color||"#3B82F6"},children:P.name.charAt(0)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:P.name}),P.active===!1&&e.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-0.5 rounded",children:"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{size:14}),"$",P.rate,"/hr"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fe,{size:14}),P.capacity," people"]}),P.equipment&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Zt,{size:14}),P.equipment.split(",").length," items"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:F=>{F.stopPropagation(),$(A)},className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Duplicate",children:e.jsx(It,{size:16})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),S(A)},className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit",children:e.jsx(as,{size:16})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),v(A)},className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete",children:e.jsx(_e,{size:16})}),y===A?e.jsx(Ma,{size:20}):e.jsx(dt,{size:20})]})]}),y===A&&g&&e.jsx("div",{className:"border-t dark:border-gray-700",children:e.jsx(ma,{room:g,setRoom:m,onSave:w,onCancel:B,saving:p,isNew:!1,roomAmenities:M})}),y===A&&!g&&e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#1f2128]",children:[P.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:P.description}),P.equipment&&e.jsx("div",{className:"flex flex-wrap gap-2",children:P.equipment.split(",").map((F,L)=>e.jsx("span",{className:"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded",children:F.trim()},L))})]})]},A))})]})}function ma({room:t,setRoom:s,onSave:l,onCancel:n,saving:d,isNew:o,roomAmenities:a}){const b=x=>{const g=t.amenities||[];g.includes(x)?s({...t,amenities:g.filter(m=>m!==x)}):s({...t,amenities:[...g,x]})};return e.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-[#1f2128] space-y-5",children:[o&&e.jsx("h3",{className:"font-bold dark:text-white text-lg mb-4",children:"Add New Room"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Room Name *"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:t.name,onChange:x=>s({...t,name:x.target.value}),placeholder:"e.g. Studio A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Room Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",className:"w-12 h-12 rounded-lg border dark:border-gray-600 cursor-pointer",value:t.color||"#3B82F6",onChange:x=>s({...t,color:x.target.value})}),e.jsx("input",{className:"flex-1 p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:t.color||"#3B82F6",onChange:x=>s({...t,color:x.target.value}),placeholder:"#3B82F6"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",rows:2,value:t.description||"",onChange:x=>s({...t,description:x.target.value}),placeholder:"Describe this room, its vibe, and what makes it special..."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hourly Rate ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:t.rate,onChange:x=>s({...t,rate:parseInt(x.target.value)||0}),min:0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Capacity"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:t.capacity,onChange:x=>s({...t,capacity:parseInt(x.target.value)||1}),min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Hours"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:t.minBookingHours||1,onChange:x=>s({...t,minBookingHours:parseInt(x.target.value)||1}),min:1})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl cursor-pointer w-full",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-brand-blue",checked:t.active!==!1,onChange:x=>s({...t,active:x.target.checked})}),e.jsx("span",{className:"text-sm font-medium dark:text-white",children:"Active"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Equipment"}),e.jsx(Ws,{value:t.equipment||"",onChange:x=>s({...t,equipment:x}),placeholder:"Search and add equipment...",multi:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Room Features"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(x=>e.jsx("button",{type:"button",onClick:()=>b(x),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all border ${(t.amenities||[]).includes(x)?"bg-brand-blue text-white border-brand-blue":"bg-white dark:bg-[#2c2e36] text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-brand-blue"}`,children:x},x))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{onClick:n,className:"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl font-medium transition",children:"Cancel"}),e.jsxs("button",{onClick:l,disabled:d,className:"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[d?e.jsx(oe,{className:"animate-spin",size:18}):e.jsx(tt,{size:18}),o?"Add Room":"Save Changes"]})]})]})}function ji({user:t,userData:s,onUpdate:l}){const[n,d]=r.useState((s==null?void 0:s.studioPhotos)||[]),[o,a]=r.useState(!1),[b,x]=r.useState(0),[g,m]=r.useState(null),[u,i]=r.useState(null),p=r.useCallback(async f=>{try{const R=Q(O,`artifacts/${re}/users/${t.uid}/profiles/main`);return await be(R,{studioPhotos:f}),d(f),l&&l({studioPhotos:f}),!0}catch(R){return console.error("Save failed:",R),X.error("Failed to save photos"),!1}},[t.uid,l]),c=r.useCallback(async f=>{if(!f||f.length===0)return;const R=12;if(n.length>=R){X.error(`Maximum ${R} photos allowed`);return}a(!0);const z=X.loading("Uploading photos..."),I=[];for(const S of Array.from(f).slice(0,R-n.length)){if(!S.type.startsWith("image/")){X.error(`${S.name} is not an image`);continue}if(S.size>5*1024*1024){X.error(`${S.name} is too large (max 5MB)`);continue}try{const w=Date.now(),v=`${w}_${S.name.replace(/[^a-zA-Z0-9.]/g,"_")}`,$=Ds(ta,`studios/${t.uid}/gallery/${v}`),B=pl($,S);await new Promise((M,T)=>{B.on("state_changed",P=>{const A=P.bytesTransferred/P.totalBytes*100;x(A)},P=>T(P),async()=>{const P=await fl(B.snapshot.ref);I.push({id:w.toString(),url:P,path:$.fullPath,filename:v,caption:"",isCover:n.length===0&&I.length===0,uploadedAt:new Date().toISOString()}),M()})})}catch(w){console.error("Upload error:",w),X.error(`Failed to upload ${S.name}`)}}I.length>0?await p([...n,...I])&&X.success(`${I.length} photo(s) uploaded!`,{id:z}):X.dismiss(z),a(!1),x(0)},[n,t.uid,p]),y=async f=>{const R=n[f];if(!confirm("Delete this photo?"))return;const z=X.loading("Deleting...");try{if(R.path){const S=Ds(ta,R.path);await yl(S).catch(()=>{})}let I=n.filter((S,w)=>w!==f);R.isCover&&I.length>0&&(I=I.map((S,w)=>({...S,isCover:w===0}))),await p(I),X.success("Photo deleted",{id:z})}catch(I){console.error("Delete error:",I),X.error("Failed to delete photo",{id:z})}},N=async f=>{const R=n.map((z,I)=>({...z,isCover:I===f}));await p(R),X.success("Cover photo updated")},j=f=>{i(f)},k=(f,R)=>{if(f.preventDefault(),u===null||u===R)return;const z=[...n],[I]=z.splice(u,1);z.splice(R,0,I),d(z),i(R)},E=async()=>{u!==null&&(await p(n),i(null))},C=f=>{var z;f.preventDefault();const R=(z=f.dataTransfer)==null?void 0:z.files;R&&c(R)},h=n.find(f=>f.isCover)||n[0];return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Lt,{className:"text-brand-blue",size:24}),"Photo Gallery"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Showcase your studio with up to 12 photos"})]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.length,"/12 photos"]})]}),h&&e.jsxs("div",{className:"relative rounded-xl overflow-hidden aspect-video bg-gray-100 dark:bg-gray-800 group",children:[e.jsx("img",{src:h.url,alt:"Cover",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"absolute bottom-4 left-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(et,{size:16,className:"fill-yellow-400 text-yellow-400"}),"Cover Photo"]})})})]}),e.jsx("div",{className:`border-2 border-dashed rounded-xl p-8 text-center transition-all ${o?"border-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-brand-blue hover:bg-blue-50/50 dark:hover:bg-blue-900/10"}`,onDrop:C,onDragOver:f=>f.preventDefault(),children:o?e.jsxs("div",{className:"space-y-3",children:[e.jsx(oe,{className:"mx-auto animate-spin text-brand-blue",size:40}),e.jsx("div",{className:"w-full max-w-xs mx-auto bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-brand-blue h-2 rounded-full transition-all duration-300",style:{width:`${b}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Uploading... ",Math.round(b),"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Tt,{className:"mx-auto text-gray-400 mb-3",size:40}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Drag & drop images here, or"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-brand-blue font-bold hover:underline",children:"browse files"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:f=>c(f.target.files),disabled:o})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"JPG, PNG or WebP. Max 5MB per file."})]})}),n.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[n.map((f,R)=>e.jsxs("div",{draggable:!0,onDragStart:()=>j(R),onDragOver:z=>k(z,R),onDragEnd:E,className:`relative aspect-square rounded-xl overflow-hidden group bg-gray-100 dark:bg-gray-800 cursor-move ${u===R?"opacity-50 ring-2 ring-brand-blue":""}`,children:[e.jsx("img",{src:f.url,alt:f.caption||`Studio photo ${R+1}`,className:"w-full h-full object-cover"}),f.isCover&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-lg flex items-center gap-1",children:[e.jsx(et,{size:12,className:"fill-white"})," Cover"]}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>m(f),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition",title:"View",children:e.jsx(ss,{size:18})}),!f.isCover&&e.jsx("button",{onClick:()=>N(R),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition",title:"Set as cover",children:e.jsx(et,{size:18})}),e.jsx("button",{onClick:()=>y(R),className:"p-2 bg-red-500/80 hover:bg-red-500 rounded-lg text-white transition",title:"Delete",children:e.jsx(_e,{size:18})})]}),e.jsx("div",{className:"absolute top-2 right-2 p-1 bg-black/40 rounded text-white opacity-0 group-hover:opacity-100 transition",children:e.jsx(Hr,{size:14})})]},f.id)),n.length<12&&e.jsxs("label",{className:"aspect-square rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700 hover:border-brand-blue transition cursor-pointer flex flex-col items-center justify-center text-gray-400 hover:text-brand-blue",children:[e.jsx(nt,{size:32}),e.jsx("span",{className:"text-xs mt-1",children:"Add Photo"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:f=>c(f.target.files),disabled:o})]})]}),n.length===0&&!o&&e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(Lt,{size:48,className:"mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"No photos uploaded yet"}),e.jsx("p",{className:"text-sm",children:"Add photos to attract more clients"})]}),g&&e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>m(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition",onClick:()=>m(null),children:e.jsx(pe,{size:32})}),e.jsx("img",{src:g.url,alt:g.caption||"Studio photo",className:"max-w-full max-h-[90vh] object-contain rounded-lg",onClick:f=>f.stopPropagation()}),g.caption&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black/70 text-white px-6 py-3 rounded-xl",children:g.caption})]})]})}const bs=[{id:"sunday",label:"Sunday",short:"Sun"},{id:"monday",label:"Monday",short:"Mon"},{id:"tuesday",label:"Tuesday",short:"Tue"},{id:"wednesday",label:"Wednesday",short:"Wed"},{id:"thursday",label:"Thursday",short:"Thu"},{id:"friday",label:"Friday",short:"Fri"},{id:"saturday",label:"Saturday",short:"Sat"}],vi={sunday:{closed:!0,open:"10:00",close:"18:00"},monday:{closed:!1,open:"09:00",close:"22:00"},tuesday:{closed:!1,open:"09:00",close:"22:00"},wednesday:{closed:!1,open:"09:00",close:"22:00"},thursday:{closed:!1,open:"09:00",close:"22:00"},friday:{closed:!1,open:"09:00",close:"23:00"},saturday:{closed:!1,open:"10:00",close:"23:00"}};function Ni({user:t,userData:s,onUpdate:l}){const[n,d]=r.useState((s==null?void 0:s.operatingHours)||vi),[o,a]=r.useState((s==null?void 0:s.blackoutDates)||[]),[b,x]=r.useState(!1),[g,m]=r.useState({start:"",end:"",reason:""}),[u,i]=r.useState(!1),p=async()=>{x(!0);const h=X.loading("Saving availability...");try{const f=Q(O,`artifacts/${re}/users/${t.uid}/profiles/main`);await be(f,{operatingHours:n,blackoutDates:o}),X.success("Availability saved!",{id:h}),l&&l({operatingHours:n,blackoutDates:o})}catch(f){console.error("Save failed:",f),X.error("Failed to save",{id:h})}finally{x(!1)}},c=(h,f,R)=>{d(z=>({...z,[h]:{...z[h],[f]:R}}))},y=h=>{d(f=>{var R;return{...f,[h]:{...f[h],closed:!((R=f[h])!=null&&R.closed)}}})},N=h=>{const f=n[h],R=["monday","tuesday","wednesday","thursday","friday"];d(z=>{const I={...z};return R.forEach(S=>{I[S]={...f}}),I}),X.success("Copied to all weekdays")},j=()=>{if(!g.start){X.error("Start date is required");return}const h={id:Date.now().toString(),start:g.start,end:g.end||g.start,reason:g.reason||"Blocked"};a([...o,h]),m({start:"",end:"",reason:""}),i(!1)},k=h=>{a(o.filter(f=>f.id!==h))},E=h=>{if(!h)return"";const[f,R]=h.split(":"),z=parseInt(f),I=z>=12?"PM":"AM";return`${z===0?12:z>12?z-12:z}:${R} ${I}`},C=bs.reduce((h,f)=>{const R=n[f.id];if(R!=null&&R.closed)return h;const[z,I]=((R==null?void 0:R.open)||"09:00").split(":").map(Number),[S,w]=((R==null?void 0:R.close)||"17:00").split(":").map(Number),v=z*60+I,$=S*60+w;return h+Math.max(0,($-v)/60)},0);return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ie,{className:"text-brand-blue",size:24}),"Availability & Hours"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Set your operating hours and manage blackout dates"})]}),e.jsxs("button",{onClick:p,disabled:b,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[b?e.jsx(oe,{className:"animate-spin",size:18}):e.jsx(tt,{size:18}),"Save Changes"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-1",children:"Weekly Availability"}),e.jsxs("p",{className:"text-indigo-100",children:[bs.filter(h=>{var f;return!((f=n[h.id])!=null&&f.closed)}).length," days open • ",Math.round(C)," hours/week"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold",children:Math.round(C)}),e.jsx("div",{className:"text-sm text-indigo-100",children:"hours"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(zs,{size:18,className:"text-amber-500"}),"Operating Hours"]})}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:bs.map(h=>{const f=n[h.id]||{closed:!1,open:"09:00",close:"17:00"};return e.jsxs("div",{className:`p-4 flex items-center gap-4 ${f.closed?"bg-gray-50 dark:bg-[#1f2128]":""}`,children:[e.jsx("div",{className:"w-28",children:e.jsx("span",{className:`font-medium ${f.closed?"text-gray-400":"dark:text-white"}`,children:h.label})}),e.jsx("button",{onClick:()=>y(h.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition ${f.closed?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}`,children:f.closed?"Closed":"Open"}),!f.closed&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"time",value:f.open||"09:00",onChange:R=>c(h.id,"open",R.target.value),className:"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"}),e.jsx("span",{className:"text-gray-400",children:"to"}),e.jsx("input",{type:"time",value:f.close||"17:00",onChange:R=>c(h.id,"close",R.target.value),className:"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),e.jsxs("span",{className:"text-sm text-gray-400 hidden md:inline",children:[E(f.open)," – ",E(f.close)]}),e.jsx("button",{onClick:()=>N(h.id),className:"ml-auto p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Copy to all weekdays",children:e.jsx(It,{size:16})})]})]},h.id)})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Rt,{size:18,className:"text-indigo-500"}),"Blackout Dates"]}),e.jsxs("button",{onClick:()=>i(!u),className:"text-sm bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition flex items-center gap-1",children:[e.jsx(nt,{size:16})," Add Blackout"]})]}),u&&e.jsx("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/20 border-b dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Start Date *"}),e.jsx("input",{type:"date",value:g.start,onChange:h=>m({...g,start:h.target.value}),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"End Date"}),e.jsx("input",{type:"date",value:g.end,onChange:h=>m({...g,end:h.target.value}),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:g.start})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Reason"}),e.jsx("input",{type:"text",value:g.reason,onChange:h=>m({...g,reason:h.target.value}),placeholder:"e.g. Holiday, Maintenance",className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{onClick:j,className:"flex-1 p-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition",children:"Add"}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(pe,{size:20})})]})]})}),e.jsx("div",{className:"p-4",children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(Rt,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No blackout dates scheduled"}),e.jsx("p",{className:"text-xs",children:"Add dates when your studio is unavailable"})]}):e.jsx("div",{className:"space-y-2",children:o.sort((h,f)=>new Date(h.start)-new Date(f.start)).map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Re,{className:"text-indigo-600 dark:text-indigo-400",size:18})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium dark:text-white text-sm",children:[new Date(h.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),h.end!==h.start&&e.jsxs(e.Fragment,{children:[" – ",new Date(h.end).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:h.reason})]})]}),e.jsx("button",{onClick:()=>k(h.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:e.jsx(_e,{size:16})})]},h.id))})})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(st,{className:"text-amber-600 flex-shrink-0",size:20}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-bold text-amber-800 dark:text-amber-300 mb-1",children:"Availability Tips"}),e.jsxs("ul",{className:"text-amber-700 dark:text-amber-400 space-y-1",children:[e.jsx("li",{children:"• Operating hours determine when clients can book sessions"}),e.jsx("li",{children:"• Use blackout dates for holidays, maintenance, or personal time"}),e.jsx("li",{children:"• Individual room availability can be set in the Rooms section"})]})]})]})})]})}function ki({user:t,userData:s,onUpdate:l}){var p,c,y,N,j,k,E,C,h,f,R,z,I,S,w,v,$,B,M,T,P;const[n,d]=r.useState({minBookingHours:((p=s==null?void 0:s.policies)==null?void 0:p.minBookingHours)??2,maxBookingHours:((c=s==null?void 0:s.policies)==null?void 0:c.maxBookingHours)??12,advanceBookingDays:((y=s==null?void 0:s.policies)==null?void 0:y.advanceBookingDays)??14,minAdvanceHours:((N=s==null?void 0:s.policies)==null?void 0:N.minAdvanceHours)??24,autoApprove:((j=s==null?void 0:s.policies)==null?void 0:j.autoApprove)??!1,cancellationPolicy:((k=s==null?void 0:s.policies)==null?void 0:k.cancellationPolicy)??"moderate",cancellationNoticeHours:((E=s==null?void 0:s.policies)==null?void 0:E.cancellationNoticeHours)??48,refundPercentage:((C=s==null?void 0:s.policies)==null?void 0:C.refundPercentage)??50,depositRequired:((h=s==null?void 0:s.policies)==null?void 0:h.depositRequired)??!0,depositPercentage:((f=s==null?void 0:s.policies)==null?void 0:f.depositPercentage)??25,peakHourMultiplier:((R=s==null?void 0:s.policies)==null?void 0:R.peakHourMultiplier)??1,peakHoursStart:((z=s==null?void 0:s.policies)==null?void 0:z.peakHoursStart)??"",peakHoursEnd:((I=s==null?void 0:s.policies)==null?void 0:I.peakHoursEnd)??"",weekendMultiplier:((S=s==null?void 0:s.policies)==null?void 0:S.weekendMultiplier)??1,houseRules:((w=s==null?void 0:s.policies)==null?void 0:w.houseRules)??"",whatToExpect:((v=s==null?void 0:s.policies)==null?void 0:v.whatToExpect)??"",whatToBring:(($=s==null?void 0:s.policies)==null?void 0:$.whatToBring)??"",parkingInstructions:((B=s==null?void 0:s.policies)==null?void 0:B.parkingInstructions)??"",requiresWaiver:((M=s==null?void 0:s.policies)==null?void 0:M.requiresWaiver)??!1,waiverText:((T=s==null?void 0:s.policies)==null?void 0:T.waiverText)??"",ageRequirement:((P=s==null?void 0:s.policies)==null?void 0:P.ageRequirement)??18}),[o,a]=r.useState(!1),[b,x]=r.useState("booking"),g=async()=>{a(!0);const A=X.loading("Saving policies...");try{const F=Q(O,`artifacts/${re}/users/${t.uid}/profiles/main`);await be(F,{policies:n}),X.success("Policies saved!",{id:A}),l&&l({policies:n})}catch(F){console.error("Save failed:",F),X.error("Failed to save",{id:A})}finally{a(!1)}},m=(A,F)=>{d(L=>({...L,[A]:F}))},u=[{id:"flexible",label:"Flexible",description:"Full refund up to 24 hours before session",color:"green"},{id:"moderate",label:"Moderate",description:"50% refund up to 48 hours before session",color:"amber"},{id:"strict",label:"Strict",description:"No refunds within 7 days of session",color:"red"},{id:"custom",label:"Custom",description:"Set your own cancellation terms",color:"blue"}],i=({id:A,title:F,icon:L,children:W})=>{const Z=b===A;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>x(Z?null:A),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-[#23262f] transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-blue/10 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"text-brand-blue",size:20})}),e.jsx("h3",{className:"font-bold dark:text-white",children:F})]}),Z?e.jsx(Ma,{size:20}):e.jsx(dt,{size:20})]}),Z&&e.jsx("div",{className:"p-4 pt-0 border-t dark:border-gray-700",children:W})]})};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Pt,{className:"text-brand-blue",size:24}),"Policies & Rules"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Set booking rules, cancellation policies, and house rules"})]}),e.jsxs("button",{onClick:g,disabled:o,className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[o?e.jsx(oe,{className:"animate-spin",size:18}):e.jsx(tt,{size:18}),"Save Changes"]})]}),e.jsx(i,{id:"booking",title:"Booking Rules",icon:Ie,children:e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Hours"}),e.jsx("input",{type:"number",value:n.minBookingHours,onChange:A=>m("minBookingHours",parseInt(A.target.value)||1),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Max Hours"}),e.jsx("input",{type:"number",value:n.maxBookingHours,onChange:A=>m("maxBookingHours",parseInt(A.target.value)||12),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Book Ahead (Days)"}),e.jsx("input",{type:"number",value:n.advanceBookingDays,onChange:A=>m("advanceBookingDays",parseInt(A.target.value)||7),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Min Notice (Hrs)"}),e.jsx("input",{type:"number",value:n.minAdvanceHours,onChange:A=>m("minAdvanceHours",parseInt(A.target.value)||0),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Auto-Approve Bookings"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Automatically confirm bookings without manual approval"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.autoApprove,onChange:A=>m("autoApprove",A.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-brand-blue"})]})]})]})}),e.jsx(i,{id:"cancellation",title:"Cancellation Policy",icon:ht,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:u.map(A=>e.jsxs("button",{onClick:()=>m("cancellationPolicy",A.id),className:`p-4 rounded-xl border-2 text-left transition ${n.cancellationPolicy===A.id?`border-${A.color}-500 bg-${A.color}-50 dark:bg-${A.color}-900/20`:"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx("div",{className:`font-bold mb-1 ${n.cancellationPolicy===A.id?`text-${A.color}-700 dark:text-${A.color}-400`:"dark:text-white"}`,children:A.label}),e.jsx("div",{className:"text-xs text-gray-500",children:A.description})]},A.id))}),n.cancellationPolicy==="custom"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Notice Required (Hours)"}),e.jsx("input",{type:"number",value:n.cancellationNoticeHours,onChange:A=>m("cancellationNoticeHours",parseInt(A.target.value)||24),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Refund Percentage"}),e.jsx("input",{type:"number",value:n.refundPercentage,onChange:A=>m("refundPercentage",parseInt(A.target.value)||0),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0,max:100})]})]})]})}),e.jsx(i,{id:"pricing",title:"Pricing & Deposits",icon:$e,children:e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Require Deposit"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Collect partial payment when booking"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.depositRequired,onChange:A=>m("depositRequired",A.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue"})]})]}),n.depositRequired&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Deposit Percentage"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",value:n.depositPercentage,onChange:A=>m("depositPercentage",parseInt(A.target.value)),className:"flex-1",min:10,max:100,step:5}),e.jsxs("span",{className:"font-bold text-brand-blue w-14 text-right",children:[n.depositPercentage,"%"]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white mb-3",children:"Peak Hour Pricing"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Peak Start"}),e.jsx("input",{type:"time",value:n.peakHoursStart,onChange:A=>m("peakHoursStart",A.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Peak End"}),e.jsx("input",{type:"time",value:n.peakHoursEnd,onChange:A=>m("peakHoursEnd",A.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Rate Multiplier"}),e.jsx("input",{type:"number",value:n.peakHourMultiplier,onChange:A=>m("peakHourMultiplier",parseFloat(A.target.value)||1),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:1,max:3,step:.1})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Weekend Rate Multiplier"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",value:n.weekendMultiplier,onChange:A=>m("weekendMultiplier",parseFloat(A.target.value)),className:"flex-1",min:1,max:2,step:.1}),e.jsxs("span",{className:"font-bold dark:text-white w-16 text-right",children:[n.weekendMultiplier,"x"]})]}),n.weekendMultiplier>1&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Saturday & Sunday bookings will be ",Math.round((n.weekendMultiplier-1)*100),"% more"]})]})]})}),e.jsx(i,{id:"rules",title:"House Rules & Info",icon:Pt,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio Rules"}),e.jsx("textarea",{value:n.houseRules,onChange:A=>m("houseRules",A.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:4,placeholder:`• No smoking inside the studio
• Please arrive 10 minutes early
• Clean up after your session`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"What to Expect"}),e.jsx("textarea",{value:n.whatToExpect,onChange:A=>m("whatToExpect",A.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:"Describe what clients can expect when they arrive..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"What to Bring"}),e.jsx("textarea",{value:n.whatToBring,onChange:A=>m("whatToBring",A.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:`• Instrument cables
• Lyrics/charts
• Reference tracks`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Parking Instructions"}),e.jsx("textarea",{value:n.parkingInstructions,onChange:A=>m("parkingInstructions",A.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:3,placeholder:"Describe parking situation and directions..."})]})]})]})}),e.jsx(i,{id:"legal",title:"Legal & Safety",icon:Pe,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Minimum Age Requirement"}),e.jsx("input",{type:"number",value:n.ageRequirement,onChange:A=>m("ageRequirement",parseInt(A.target.value)||0),className:"w-32 p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",min:0})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-6",children:n.ageRequirement>0?`Clients must be ${n.ageRequirement}+ to book`:"No age restriction"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Require Liability Waiver"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Clients must sign a waiver before booking"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.requiresWaiver,onChange:A=>m("requiresWaiver",A.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue"})]})]}),n.requiresWaiver&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Waiver Text"}),e.jsx("textarea",{value:n.waiverText,onChange:A=>m("waiverText",A.target.value),className:"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white font-mono text-sm",rows:6,placeholder:"Enter your liability waiver text..."})]})]})]})})]})}const ua={pending:{label:"Pending",color:"amber",icon:Wr,bgClass:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"},confirmed:{label:"Confirmed",color:"green",icon:ve,bgClass:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"},cancelled:{label:"Cancelled",color:"red",icon:La,bgClass:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"},completed:{label:"Completed",color:"blue",icon:Ge,bgClass:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400"}};function wi({user:t,onNavigateToChat:s}){const[l,n]=r.useState([]),[d,o]=r.useState([]),[a,b]=r.useState(!0),[x,g]=r.useState("all"),[m,u]=r.useState(""),[i,p]=r.useState(null),[c,y]=r.useState(null),[N,j]=r.useState("list"),[k,E]=r.useState(new Date),[C,h]=r.useState(!1),[f,R]=r.useState(null),[z,I]=r.useState(""),[S,w]=r.useState("full"),[v,$]=r.useState("09:00"),[B,M]=r.useState("17:00");r.useEffect(()=>{if(!(t!=null&&t.uid))return;const q=le(O,`artifacts/${re}/bookings`),J=ye(q,Ce("studioOwnerId","==",t.uid),Ae("createdAt","desc")),ee=fe(J,ne=>{const me=ne.docs.map(_=>{var ae,de,G,he;return{id:_.id,..._.data(),date:((de=(ae=_.data().date)==null?void 0:ae.toDate)==null?void 0:de.call(ae))||new Date(_.data().date),createdAt:((he=(G=_.data().createdAt)==null?void 0:G.toDate)==null?void 0:he.call(G))||new Date}});n(me),b(!1)},ne=>{console.error("Error fetching bookings:",ne),b(!1)});return()=>ee()},[t==null?void 0:t.uid]),r.useEffect(()=>{if(!(t!=null&&t.uid))return;const q=le(O,`artifacts/${re}/blockedDates`),J=ye(q,Ce("studioOwnerId","==",t.uid)),ee=fe(J,ne=>{const me=ne.docs.map(_=>{var ae,de;return{id:_.id,..._.data(),date:((de=(ae=_.data().date)==null?void 0:ae.toDate)==null?void 0:de.call(ae))||new Date(_.data().date)}});me.sort((_,ae)=>new Date(_.date)-new Date(ae.date)),o(me)},ne=>{console.error("Error fetching blocked dates:",ne),o([])});return()=>ee()},[t==null?void 0:t.uid]);const T=async(q,J)=>{y(q);const ee=X.loading("Updating booking...");try{const ne=Q(O,`artifacts/${re}/bookings/${q}`);await be(ne,{status:J,updatedAt:Ot.now(),[`${J}At`]:Ot.now()}),X.success(`Booking ${J}!`,{id:ee})}catch(ne){console.error("Update failed:",ne),X.error("Failed to update booking",{id:ee})}finally{y(null)}},P=async()=>{if(!f||!(t!=null&&t.uid))return;const q=X.loading("Blocking time slot...");try{const J=le(O,`artifacts/${re}/blockedDates`);await we(J,{studioOwnerId:t.uid,date:Ot.fromDate(f),reason:z||"Off-platform booking",timeSlot:S,startTime:S==="custom"?v:null,endTime:S==="custom"?B:null,createdAt:Ot.now()}),X.success("Time slot blocked!",{id:q}),h(!1),I(""),w("full"),R(null)}catch(J){console.error("Error blocking date:",J),X.error("Failed to block time slot",{id:q})}},A=async q=>{const J=X.loading("Removing block...");try{await ft(Q(O,`artifacts/${re}/blockedDates/${q}`)),X.success("Block removed!",{id:J})}catch(ee){console.error("Error unblocking date:",ee),X.error("Failed to remove block",{id:J})}},F=q=>{R(q),h(!0)},L=l.filter(q=>{var ne,me;const J=x==="all"||q.status===x,ee=!m||((ne=q.clientName)==null?void 0:ne.toLowerCase().includes(m.toLowerCase()))||((me=q.roomName)==null?void 0:me.toLowerCase().includes(m.toLowerCase()));return J&&ee}),W=L.reduce((q,J)=>{const ee=J.date.toDateString();return q[ee]||(q[ee]=[]),q[ee].push(J),q},{}),Z=l.filter(q=>q.status==="pending").length,D=l.filter(q=>{const J=new Date().toDateString();return q.date.toDateString()===J&&q.status==="confirmed"}).length,Y=l.filter(q=>q.status==="confirmed"&&q.date>=new Date).reduce((q,J)=>q+(J.totalPrice||0),0);return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(kt,{className:"animate-spin text-brand-blue",size:32})}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Re,{className:"text-brand-blue",size:24}),"Booking Management"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[l.length," total bookings • ",d.length," blocked slots"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex",children:[e.jsx("button",{onClick:()=>j("list"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition ${N==="list"?"bg-white dark:bg-gray-700 text-brand-blue shadow-sm":"text-gray-500"}`,children:"List"}),e.jsx("button",{onClick:()=>j("calendar"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition ${N==="calendar"?"bg-white dark:bg-gray-700 text-brand-blue shadow-sm":"text-gray-500"}`,children:"Calendar"})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl border border-amber-200 dark:border-amber-800",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:Z}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Pending Approval"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:D}),e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Today's Sessions"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:["$",Y.toLocaleString()]}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Upcoming Revenue"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",value:m,onChange:q=>u(q.target.value),placeholder:"Search by client or room...",className:"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","confirmed","completed","cancelled"].map(q=>e.jsxs("button",{onClick:()=>g(q),className:`px-4 py-2 rounded-lg font-medium text-sm transition ${x===q?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[q.charAt(0).toUpperCase()+q.slice(1),q==="pending"&&Z>0&&e.jsx("span",{className:"ml-1.5 bg-amber-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:Z})]},q))})]}),N==="calendar"&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[e.jsx("button",{onClick:()=>E(new Date(k.getFullYear(),k.getMonth()-1,1)),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition",children:e.jsx(rs,{size:20,className:"text-gray-600 dark:text-gray-300"})}),e.jsx("h3",{className:"font-bold dark:text-white text-lg",children:k.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>E(new Date(k.getFullYear(),k.getMonth()+1,1)),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition",children:e.jsx(Ke,{size:20,className:"text-gray-600 dark:text-gray-300"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(q=>e.jsx("div",{className:"text-center text-sm font-bold text-gray-500 py-2",children:q},q))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:(()=>{const q=k.getFullYear(),J=k.getMonth(),ee=new Date(q,J,1).getDay(),ne=new Date(q,J+1,0).getDate(),me=new Date,_=[];for(let ae=0;ae<ee;ae++)_.push(e.jsx("div",{className:"aspect-square"},`empty-${ae}`));for(let ae=1;ae<=ne;ae++){const de=new Date(q,J,ae),G=de<new Date(me.getFullYear(),me.getMonth(),me.getDate()),he=de.toDateString()===me.toDateString(),se=l.filter(K=>new Date(K.date).toDateString()===de.toDateString()),je=d.filter(K=>new Date(K.date).toDateString()===de.toDateString()),Ne=se.some(K=>K.status==="confirmed"),ge=se.some(K=>K.status==="pending"),U=je.length>0;_.push(e.jsxs("button",{onClick:()=>!G&&F(de),disabled:G,className:`aspect-square p-1 rounded-xl flex flex-col items-center justify-center relative transition ${G?"opacity-40 cursor-not-allowed":U?"bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 hover:bg-red-200 dark:hover:bg-red-900/40":he?"bg-brand-blue text-white":Ne||ge?"bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx("span",{className:`text-sm font-medium ${he?"text-white":U?"text-red-700 dark:text-red-400":"dark:text-white"}`,children:ae}),e.jsxs("div",{className:"flex gap-0.5 mt-0.5",children:[Ne&&e.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),ge&&e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),U&&e.jsx(zt,{size:10,className:"text-red-600 dark:text-red-400"})]}),se.length>0&&!he&&e.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-brand-blue text-white text-[10px] rounded-full flex items-center justify-center font-bold",children:se.length})]},ae))}return _})()}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-4 pt-4 border-t dark:border-gray-700 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Confirmed"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"Pending"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(zt,{size:12,className:"text-red-500"}),"Blocked"]}),e.jsx("div",{className:"ml-auto text-gray-400",children:"Click a date to block off-platform bookings"})]})]}),d.length>0&&e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("h4",{className:"font-bold text-sm dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(zt,{size:14,className:"text-red-500"}),"Blocked Time Slots"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:d.map(q=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-[#2c2e36] rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium dark:text-white text-sm",children:[new Date(q.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),q.timeSlot!=="full"&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",q.timeSlot==="custom"?`${q.startTime} - ${q.endTime}`:q.timeSlot,")"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:q.reason})]}),e.jsx("button",{onClick:()=>A(q.id),className:"p-1.5 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition",title:"Remove block",children:e.jsx(_e,{size:16})})]},q.id))})]})]}),N==="list"&&e.jsx(e.Fragment,{children:L.length===0?e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center",children:[e.jsx(Re,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Bookings Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:x!=="all"?`No ${x} bookings`:"Bookings will appear here when clients book your studio"})]}):e.jsx("div",{className:"space-y-6",children:Object.entries(W).map(([q,J])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-3 flex items-center gap-2",children:[e.jsx(Re,{size:14}),new Date(q).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),e.jsxs("span",{className:"text-gray-400",children:["(",J.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:J.map(ee=>{const ne=ua[ee.status]||ua.pending;return e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsxs("div",{className:"text-center min-w-[70px]",children:[e.jsx("div",{className:"text-lg font-bold dark:text-white",children:ee.startTime}),e.jsxs("div",{className:"text-xs text-gray-500",children:[ee.duration,"h"]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold dark:text-white truncate",children:ee.clientName||"Unknown Client"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${ne.bgClass}`,children:ne.label})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[ee.roomName||"Main Room"," • $",ee.totalPrice||0]}),ee.notes&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1 truncate",children:["Note: ",ee.notes]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ee.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>T(ee.id,"confirmed"),disabled:c===ee.id,className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition",title:"Approve",children:e.jsx(Ge,{size:18})}),e.jsx("button",{onClick:()=>T(ee.id,"cancelled"),disabled:c===ee.id,className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition",title:"Decline",children:e.jsx(pe,{size:18})})]}),ee.status==="confirmed"&&e.jsx("button",{onClick:()=>T(ee.id,"completed"),disabled:c===ee.id,className:"px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium",children:"Mark Complete"}),ee.clientId&&s&&e.jsx("button",{onClick:()=>s(ee.clientId),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Message Client",children:e.jsx(Es,{size:18})}),e.jsx("button",{onClick:()=>p(ee),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"View Details",children:e.jsx(ss,{size:18})})]})]})},ee.id)})})]},q))})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(zt,{size:18,className:"text-red-500"}),"Block Time Slot"]}),e.jsx("button",{onClick:()=>{h(!1),R(null),I("")},children:e.jsx(pe,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-sm text-gray-500 uppercase font-bold mb-1",children:"Selected Date"}),e.jsx("div",{className:"text-lg font-bold dark:text-white",children:f==null?void 0:f.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Time Slot"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"full",label:"Full Day"},{id:"morning",label:"Morning (6AM-12PM)"},{id:"afternoon",label:"Afternoon (12PM-6PM)"},{id:"evening",label:"Evening (6PM-12AM)"}].map(q=>e.jsx("button",{onClick:()=>w(q.id),className:`p-2 text-sm rounded-lg border transition ${S===q.id?"bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400":"border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300"}`,children:q.label},q.id))}),e.jsx("button",{onClick:()=>w("custom"),className:`w-full mt-2 p-2 text-sm rounded-lg border transition ${S==="custom"?"bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400":"border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300"}`,children:"Custom Time Range"}),S==="custom"&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"Start"}),e.jsx("input",{type:"time",value:v,onChange:q=>$(q.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"End"}),e.jsx("input",{type:"time",value:B,onChange:q=>M(q.target.value),className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold dark:text-white mb-2 block",children:"Reason (optional)"}),e.jsx("input",{type:"text",value:z,onChange:q=>I(q.target.value),placeholder:"e.g., Private session, Maintenance, Personal...",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{h(!1),R(null),I("")},className:"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsxs("button",{onClick:P,className:"flex-1 py-2.5 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition flex items-center justify-center gap-2",children:[e.jsx(zt,{size:16}),"Block Time"]})]})]})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Booking Details"}),e.jsx("button",{onClick:()=>p(null),children:e.jsx(pe,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-blue/10 rounded-full flex items-center justify-center",children:e.jsx(qe,{className:"text-brand-blue",size:24})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white",children:i.clientName}),e.jsx("div",{className:"text-sm text-gray-500",children:i.clientEmail})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Date"}),e.jsx("div",{className:"dark:text-white",children:i.date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Time"}),e.jsxs("div",{className:"dark:text-white",children:[i.startTime," (",i.duration,"h)"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Room"}),e.jsx("div",{className:"dark:text-white",children:i.roomName})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Total"}),e.jsxs("div",{className:"dark:text-white font-bold text-green-600",children:["$",i.totalPrice]})]})]}),i.notes&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-amber-600 uppercase font-bold mb-1",children:"Client Notes"}),e.jsx("div",{className:"text-amber-800 dark:text-amber-300 text-sm",children:i.notes})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Booked ",i.createdAt.toLocaleDateString()]})]})]})})]})}function Si({user:t,userData:s,onUpdate:l}){const[n,d]=r.useState((s==null?void 0:s.studioEquipment)||[]),[o,a]=r.useState(!1),[b,x]=r.useState(""),[g,m]=r.useState("all"),[u,i]=r.useState(!1),[p,c]=r.useState(null),y=async S=>{a(!0);const w=X.loading("Saving equipment...");try{const v=Q(O,`artifacts/${re}/users/${t.uid}/profiles/main`);await be(v,{studioEquipment:S}),d(S),X.success("Equipment saved!",{id:w}),l&&l({studioEquipment:S})}catch(v){console.error("Save failed:",v),X.error("Failed to save",{id:w})}finally{a(!1)}},N=async S=>{const w={...S,id:Date.now().toString(),addedAt:new Date().toISOString()};await y([...n,w]),i(!1)},j=async S=>{const w=n.map(v=>v.id===S.id?S:v);await y(w),c(null)},k=async S=>{if(!confirm("Remove this item from inventory?"))return;const w=n.filter(v=>v.id!==S);await y(w)},E=n.filter(S=>{var $,B,M;const w=!b||(($=S.name)==null?void 0:$.toLowerCase().includes(b.toLowerCase()))||((B=S.brand)==null?void 0:B.toLowerCase().includes(b.toLowerCase()))||((M=S.model)==null?void 0:M.toLowerCase().includes(b.toLowerCase())),v=g==="all"||S.category===g;return w&&v}),C=E.reduce((S,w)=>{const v=w.category||"Other";return S[v]||(S[v]=[]),S[v].push(w),S},{}),h=[...new Set(n.map(S=>S.category).filter(Boolean))],f=n.length,R=n.reduce((S,w)=>S+(parseFloat(w.value)||0),0),z=S=>({microphones_and_input_transducers:Zt,monitoring_and_playback:Vr,mixing_consoles_and_control:Ur,outboard_signal_processing:Qs,computer_audio_and_interfaces:Qs})[S]||pt,I=S=>{const w=ut.find(v=>v.id===S);return(w==null?void 0:w.label)||S};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(pt,{className:"text-brand-blue",size:24}),"Equipment Inventory"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage your studio gear and equipment"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2",children:[e.jsx(nt,{size:18})," Add Equipment"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold dark:text-white",children:f}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Items"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",R.toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Est. Value"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold dark:text-white",children:h.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Categories"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-brand-blue",children:n.filter(S=>S.featured).length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Featured Items"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",value:b,onChange:S=>x(S.target.value),placeholder:"Search equipment...",className:"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white"})]}),e.jsxs("select",{value:g,onChange:S=>m(S.target.value),className:"px-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Categories"}),ut.map(S=>e.jsx("option",{value:S.id,children:S.label},S.id))]})]}),E.length===0?e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center",children:[e.jsx(pt,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"No Equipment Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:b||g!=="all"?"Try adjusting your filters":"Add your studio equipment to showcase your gear"}),e.jsx("button",{onClick:()=>i(!0),className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition",children:"Add Your First Item"})]}):e.jsx("div",{className:"space-y-6",children:Object.entries(C).map(([S,w])=>{const v=z(S);return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-[#23262f] border-b dark:border-gray-700 flex items-center gap-3",children:[e.jsx(v,{className:"text-brand-blue",size:20}),e.jsx("h3",{className:"font-bold dark:text-white",children:I(S)}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",w.length,")"]})]}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:w.map($=>e.jsxs("div",{className:"p-4 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-[#23262f] transition",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold dark:text-white",children:[$.brand&&e.jsx("span",{className:"text-gray-500 font-medium",children:$.brand})," ",$.name||$.model]}),$.featured&&e.jsx("span",{className:"text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 px-2 py-0.5 rounded",children:"Featured"})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[$.model&&$.name!==$.model&&e.jsx("span",{children:$.model}),$.serial&&e.jsxs("span",{className:"ml-2",children:["S/N: ",$.serial]})]}),$.notes&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:$.notes})]}),$.value&&e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:["$",parseFloat($.value).toLocaleString()]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>c($),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",children:e.jsx(as,{size:16})}),e.jsx("button",{onClick:()=>k($.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:e.jsx(_e,{size:16})})]})]},$.id))})]},S)})}),(u||p)&&e.jsx(Ci,{item:p,onSave:p?j:N,onClose:()=>{i(!1),c(null)},saving:o})]})}function Ci({item:t,onSave:s,onClose:l,saving:n}){const[d,o]=r.useState(t||{name:"",brand:"",model:"",category:"",serial:"",value:"",notes:"",featured:!1}),a=()=>{if(!d.name&&!d.model){X.error("Name or model is required");return}s(d)},b=x=>{o(g=>({...g,name:x.name||g.name,brand:x.brand||g.brand,model:x.model||g.model,category:x.category||g.category}))};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:t?"Edit Equipment":"Add Equipment"}),e.jsx("button",{onClick:l,children:e.jsx(pe,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Quick Search"}),e.jsx(Ws,{onSelect:b,placeholder:"Search for equipment..."})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{value:d.brand,onChange:x=>o({...d,brand:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"e.g. Neumann"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model *"}),e.jsx("input",{value:d.model||d.name,onChange:x=>o({...d,model:x.target.value,name:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"e.g. U87"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsxs("select",{value:d.category,onChange:x=>o({...d,category:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select category..."}),ut.map(x=>e.jsx("option",{value:x.id,children:x.label},x.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Serial Number"}),e.jsx("input",{value:d.serial,onChange:x=>o({...d,serial:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Value ($)"}),e.jsx("input",{type:"number",value:d.value,onChange:x=>o({...d,value:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",placeholder:"Estimated value"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Notes"}),e.jsx("textarea",{value:d.notes,onChange:x=>o({...d,notes:x.target.value}),className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:2,placeholder:"Additional details..."})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-[#1f2128] rounded-xl cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.featured,onChange:x=>o({...d,featured:x.target.checked}),className:"w-4 h-4 text-brand-blue rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white text-sm",children:"Featured Equipment"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Highlight this item on your studio profile"})]})]})]})]}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:l,className:"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl font-medium",children:"Cancel"}),e.jsxs("button",{onClick:a,disabled:n,className:"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50",children:[n?e.jsx(oe,{className:"animate-spin",size:18}):e.jsx(tt,{size:18}),t?"Update":"Add Item"]})]})]})})}const zi=Ts({studioName:Ee().min(3,"Studio name is required"),address:Ee().min(5,"Address is required"),city:Ee().optional(),state:Ee().optional(),zip:Ee().optional(),lat:Kt().optional(),lng:Kt().optional(),studioDescription:Ee().max(1e3).optional(),email:Ee().email().optional().or(Xt("")),phoneCell:Ee().optional(),phoneLand:Ee().optional(),website:Ee().url().optional().or(Xt("")),hours:Ee().optional(),amenities:Yr(Ee()).optional(),hideAddress:Gr().optional()});function Ei({user:t,userData:s,onUpdate:l}){const[n,d]=r.useState(!1),{register:o,control:a,handleSubmit:b,watch:x,setValue:g,formState:{errors:m,isDirty:u}}=Is({resolver:Ms(zi),defaultValues:{studioName:(s==null?void 0:s.studioName)||(s==null?void 0:s.profileName)||"",address:(s==null?void 0:s.address)||"",city:(s==null?void 0:s.city)||"",state:(s==null?void 0:s.state)||"",zip:(s==null?void 0:s.zip)||"",lat:s==null?void 0:s.lat,lng:s==null?void 0:s.lng,studioDescription:(s==null?void 0:s.studioDescription)||"",email:(s==null?void 0:s.email)||"",phoneCell:(s==null?void 0:s.phoneCell)||"",phoneLand:(s==null?void 0:s.phoneLand)||"",website:(s==null?void 0:s.website)||"",hours:(s==null?void 0:s.hours)||"",amenities:(s==null?void 0:s.amenities)||[],hideAddress:(s==null?void 0:s.hideAddress)||!1}}),i=x("amenities"),p=x("hideAddress"),c=j=>{const k=i||[];k.includes(j)?g("amenities",k.filter(E=>E!==j),{shouldDirty:!0}):g("amenities",[...k,j],{shouldDirty:!0})},y=async j=>{d(!0);const k=X.loading("Saving settings...");try{const E=Q(O,`artifacts/${re}/users/${t.uid}/profiles/main`);await be(E,{studioName:j.studioName,profileName:j.studioName,address:j.address,city:j.city,state:j.state,zip:j.zip,lat:j.lat,lng:j.lng,studioDescription:j.studioDescription,email:j.email,phoneCell:j.phoneCell,phoneLand:j.phoneLand,website:j.website,hours:j.hours,amenities:j.amenities,hideAddress:j.hideAddress,isStudio:!0}),X.success("Settings saved!",{id:k}),l&&l(j)}catch(E){console.error("Save failed",E),X.error("Failed to save settings.",{id:k})}finally{d(!1)}},N=j=>`w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none ${j?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200"}`;return e.jsxs("form",{onSubmit:b(y),className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(bt,{className:"text-brand-blue",size:24}),"Studio Settings"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Basic information and contact details"})]}),e.jsxs("button",{type:"submit",disabled:n||!u,className:`px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 transition ${n||!u?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600"}`,children:[n?e.jsx(oe,{className:"animate-spin",size:18}):e.jsx(tt,{size:18}),"Save Changes"]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ye,{size:18,className:"text-brand-blue"}),"General Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio Name *"}),e.jsx("input",{...o("studioName"),className:N(m.studioName),placeholder:"Your Studio Name"}),m.studioName&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.studioName.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Description"}),e.jsx("textarea",{...o("studioDescription"),rows:3,className:N(m.studioDescription),placeholder:"Describe your studio, the vibe, and what makes it special..."})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Le,{size:18,className:"text-brand-blue"}),"Location"]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800 mb-4",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...o("hideAddress"),className:"w-5 h-5 mt-0.5 text-brand-blue rounded"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(Pe,{size:16,className:"text-brand-blue"}),"Private Home Studio Mode"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your exact address will be hidden from the public map. It will only be revealed after you approve a booking request."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Zr,{control:a,name:"address",render:({field:{onChange:j,value:k}})=>{var E;return e.jsx(_l,{label:"Street Address",value:k||"",onChange:j,onSelect:C=>{C.lat&&g("lat",C.lat),C.lng&&g("lng",C.lng),C.city&&g("city",C.city,{shouldDirty:!0}),C.state&&g("state",C.state,{shouldDirty:!0}),C.zip&&g("zip",C.zip,{shouldDirty:!0})},placeholder:"Start typing your address...",error:(E=m.address)==null?void 0:E.message,required:!0})}}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"City"}),e.jsx("input",{...o("city"),className:N(),placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"State"}),e.jsx("input",{...o("state"),className:N(),placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"ZIP"}),e.jsx("input",{...o("zip"),className:N(),placeholder:"ZIP Code"})]})]})]}),p&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-amber-600 dark:text-amber-400",children:[e.jsx(Kr,{size:16}),e.jsx("span",{children:"Address will be hidden until booking approval"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Vt,{size:18,className:"text-brand-blue"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Email"}),e.jsx("input",{...o("email"),type:"email",className:N(m.email),placeholder:"studio@email.com"}),m.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Website"}),e.jsx("input",{...o("website"),className:N(m.website),placeholder:"https://yourstudio.com"}),m.website&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.website.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Cell Phone"}),e.jsx("input",{...o("phoneCell"),className:N(),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Landline"}),e.jsx("input",{...o("phoneLand"),className:N(),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hours of Operation"}),e.jsx("input",{...o("hours"),className:N(),placeholder:"e.g. Mon-Fri 9AM-10PM, Sat-Sun 10AM-8PM"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Xr,{size:18,className:"text-brand-blue"}),"Amenities"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ql.map(j=>e.jsx("button",{type:"button",onClick:()=>c(j),className:`px-3 py-2 rounded-lg text-sm font-medium transition-all border ${i!=null&&i.includes(j)?"bg-brand-blue text-white border-brand-blue shadow-md":"bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:j},j))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:n||!u,className:`px-8 py-3 rounded-xl font-bold text-lg flex items-center gap-2 transition shadow-lg ${n||!u?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"}`,children:[n?e.jsx(oe,{className:"animate-spin",size:20}):e.jsx(tt,{size:20}),"Save Settings"]})})]})}const ba=[{id:"overview",label:"Overview",icon:Ye,description:"Dashboard & quick stats"},{id:"rooms",label:"Rooms",icon:vs,description:"Manage studio rooms"},{id:"equipment",label:"Equipment",icon:pt,description:"Equipment inventory"},{id:"gallery",label:"Gallery",icon:Lt,description:"Photo gallery"},{id:"availability",label:"Hours",icon:Ie,description:"Operating hours"},{id:"policies",label:"Policies",icon:Pt,description:"Rules & pricing"},{id:"bookings",label:"Bookings",icon:Re,description:"Manage bookings"},{id:"settings",label:"Settings",icon:bt,description:"Studio info"}];function Ri({user:t,userData:s}){const[l,n]=r.useState("overview"),[d,o]=r.useState({pendingBookings:0,recentBookings:[],totalRevenue:0}),[a,b]=r.useState(s);r.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const p=le(O,`artifacts/${re}/bookings`),c=ye(p,Ce("studioOwnerId","==",t.uid)),N=(await Xe(c)).docs.map(C=>{var h,f;return{id:C.id,...C.data(),date:((f=(h=C.data().date)==null?void 0:h.toDate)==null?void 0:f.call(h))||new Date(C.data().date)}}),j=N.filter(C=>C.status==="pending").length,k=N.filter(C=>C.date>=new Date).sort((C,h)=>C.date-h.date).slice(0,5),E=N.filter(C=>C.status==="completed").reduce((C,h)=>C+(h.totalPrice||0),0);o({pendingBookings:j,recentBookings:k,totalRevenue:E})}catch(p){console.error("Error fetching stats:",p)}})()},[t==null?void 0:t.uid]);const x=i=>{b(p=>({...p,...i}))},g=i=>{n(i)},m=()=>{const i={user:t,userData:a,onUpdate:x};switch(l){case"overview":return e.jsx(ga,{...i,stats:d,onNavigate:g});case"rooms":return e.jsx(yi,{...i});case"equipment":return e.jsx(Si,{...i});case"gallery":return e.jsx(ji,{...i});case"availability":return e.jsx(Ni,{...i});case"policies":return e.jsx(ki,{...i});case"bookings":return e.jsx(wi,{...i});case"settings":return e.jsx(Ei,{...i});default:return e.jsx(ga,{...i,stats:d,onNavigate:g})}},u=ba.find(i=>i.id===l);return e.jsxs("div",{className:"max-w-7xl mx-auto pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx(rt,{size:14}),e.jsx("span",{children:"Business Center"}),e.jsx(Ke,{size:14}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:"Studio Manager"})]}),e.jsxs("h1",{className:"text-3xl font-bold dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white",children:e.jsx(Ye,{size:24})}),(a==null?void 0:a.studioName)||(a==null?void 0:a.profileName)||"Studio Manager"]})]}),e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 mb-6 overflow-hidden",children:e.jsx("div",{className:"flex overflow-x-auto scrollbar-hide",children:ba.map(i=>{const p=i.icon,c=l===i.id,y=i.id==="bookings"&&d.pendingBookings>0;return e.jsxs("button",{onClick:()=>n(i.id),className:`flex items-center gap-2 px-5 py-4 text-sm font-medium whitespace-nowrap transition-all border-b-2 relative ${c?"border-brand-blue text-brand-blue bg-blue-50 dark:bg-blue-900/20":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx(p,{size:18}),i.label,y&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:d.pendingBookings})]},i.id)})})}),e.jsx("div",{className:"md:hidden mb-4 px-1",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:u==null?void 0:u.description})}),e.jsx("div",{className:"min-h-[50vh]",children:m()})]})}const Pi=["Student","Instructor","Intern","Admin"];function rr({user:t,userData:s,onUpdate:l,onRoleSwitch:n}){var J,ee,ne,me,_,ae,de;const[d,o]=r.useState(s.settings||{notifications:{email:!0,push:!0,marketing:!1},privacy:{publicProfile:!0,showLocation:!0,hideProfile:!1},theme:"system",social:{mutedUsers:[],blockedUsers:[]},messenger:{mutedThreads:[],blockedContacts:[]},preferences:{seeAllProfiles:!1}}),[a,b]=r.useState(s.accountTypes||[]),[x,g]=r.useState(s.preferredRole||a[0]),[m,u]=r.useState(s.activeProfileRole||a[0]),[i,p]=r.useState(!1),[c,y]=r.useState(!1),[N,j]=r.useState(!1),[k,E]=r.useState(""),[C,h]=r.useState(!1),[f,R]=r.useState(!1),[z,I]=r.useState(null),[S,w]=r.useState({newEmail:"",newPassword:"",currentPassword:""}),[v,$]=r.useState(!1),[B,M]=r.useState(!1);r.useEffect(()=>{s.activeProfileRole&&u(s.activeProfileRole)},[s.activeProfileRole]);const T=(G,he)=>{o(se=>{var Ne;const je={...se,[G]:{...se[G],[he]:!((Ne=se[G])!=null&&Ne[he])}};return l(je),je})},P=G=>{o(he=>{const se={...he,theme:G};return l(se),se})},A=async()=>{if(a.length===0)return alert("You must have at least one role.");p(!0);try{await be(Q(O,te(t.uid).userProfile),{accountTypes:a,preferredRole:x,activeProfileRole:m}),m!==s.activeProfileRole&&n&&n(m);for(const G of a){const he=Q(O,te(t.uid).userSubProfile(G));(await yt(he)).exists()||await xt(he,{useRealName:!0,useGlobalName:!0})}alert("Roles & Preferences updated!")}catch(G){console.error(G),alert("Failed to update.")}p(!1)},F=G=>{b(he=>he.includes(G)?he.filter(se=>se!==G):[...he,G])},L=G=>{I(G),w({newEmail:"",newPassword:"",currentPassword:""}),R(!0)},W=async()=>{if(!S.currentPassword)return alert("Current password is required to verify your identity.");$(!0);try{const G=jl.credential(t.email,S.currentPassword);if(await vl(t,G),z==="email"){if(!S.newEmail)throw new Error("New email address is required.");await Nl(t,S.newEmail),await be(Q(O,te(t.uid).userProfile),{email:S.newEmail}),alert("Email updated successfully.")}else if(z==="password"){if(S.newPassword.length<6)throw new Error("Password must be at least 6 characters.");await kl(t,S.newPassword),alert("Password updated successfully.")}R(!1),w({newEmail:"",newPassword:"",currentPassword:""})}catch(G){console.error("Security Update Error:",G),G.code==="auth/wrong-password"?alert("Incorrect current password."):G.code==="auth/email-already-in-use"?alert("This email is already associated with another account."):alert("Failed to update: "+G.message)}$(!1)},Z=async()=>{y(!0);try{throw new Error("Data export functionality is temporarily unavailable. Firebase Functions service is not configured.")}catch(G){console.error(G),alert("Failed to export data. Please try again later.")}y(!1)},D=async()=>{if(k==="DELETE"){j(!0);try{await wl(t)}catch(G){console.error("Deletion Error:",G),G.code==="auth/requires-recent-login"?alert("For security, please log out and log back in before deleting your account."):alert("Failed to delete account: "+G.message),j(!1)}}},Y=({title:G,items:he,type:se,icon:je})=>e.jsxs("div",{className:"mt-4 border-t dark:border-gray-700 pt-4",children:[e.jsxs("h5",{className:"text-sm font-bold dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(je,{size:14})," ",G]}),he&&he.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:he.map((Ne,ge)=>e.jsxs("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded flex items-center gap-1 text-gray-600 dark:text-gray-300",children:[Ne.substring(0,8),"... ",e.jsx(pe,{size:10,className:"cursor-pointer hover:text-red-500"})]},ge))}):e.jsxs("p",{className:"text-xs text-gray-400 italic",children:["No active ",se,"."]})]}),q=B?[...new Set([...Jt,...Pi])]:Jt;return e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-300 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Fe,{size:18,className:"text-purple-500"})," Roles & Workflow"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block",children:"Active Account Types"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-yellow-50 dark:bg-yellow-900/10 px-2 py-1 rounded border border-yellow-200 dark:border-yellow-800",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:G=>M(G.target.checked),className:"rounded text-yellow-600 focus:ring-yellow-500"}),e.jsx("span",{className:"text-[10px] font-bold text-yellow-700 dark:text-yellow-400",children:"Unlock All Roles"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:q.map(G=>e.jsx("button",{onClick:()=>F(G),className:`px-3 py-1.5 rounded-full text-xs font-bold transition border ${a.includes(G)?"bg-purple-100 border-purple-200 text-purple-700 dark:bg-purple-900/30 dark:border-purple-700 dark:text-purple-300":"bg-gray-50 border-gray-200 text-gray-500 dark:bg-transparent dark:border-gray-600 dark:text-gray-400"}`,children:G},G))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(et,{size:12})," Preferred Profile"]}),e.jsx("select",{className:"w-full p-2 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:x,onChange:G=>g(G.target.value),children:a.map(G=>e.jsx("option",{value:G,children:G},G))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(kt,{size:12})," Active Workflow Context"]}),e.jsx("select",{className:"w-full p-2 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:m,onChange:G=>u(G.target.value),children:a.map(G=>e.jsx("option",{value:G,children:G},G))})]})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 p-2 rounded transition border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ea,{size:16,className:"text-brand-blue"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-200",children:"See All (Unfiltered View)"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Show all content types regardless of active workflow."})]})]}),e.jsxs("div",{className:`w-10 h-5 rounded-full p-0.5 flex transition-colors ${(J=d.preferences)!=null&&J.seeAllProfiles?"bg-brand-blue justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:[e.jsx("input",{type:"checkbox",className:"hidden",checked:((ee=d.preferences)==null?void 0:ee.seeAllProfiles)||!1,onChange:()=>T("preferences","seeAllProfiles")}),e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:A,disabled:i,className:"w-full bg-purple-600 text-white px-4 py-2.5 rounded-lg font-bold hover:bg-purple-700 disabled:opacity-50 flex items-center justify-center gap-2 shadow-md transition",children:[i?e.jsx(oe,{className:"animate-spin",size:16}):e.jsx(kt,{size:16})," Save Workflow Settings"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Pe,{size:18,className:"text-blue-500"})," Account Security"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400",children:e.jsx(Vt,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Email Address"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]})]}),e.jsx("button",{onClick:()=>L("email"),className:"text-xs font-bold bg-white dark:bg-gray-700 border dark:border-gray-600 px-3 py-1.5 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition",children:"Change Email"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400",children:e.jsx(Wt,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Password"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Last changed: Never (or unknown)"})]})]}),e.jsx("button",{onClick:()=>L("password"),className:"text-xs font-bold bg-white dark:bg-gray-700 border dark:border-gray-600 px-3 py-1.5 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition",children:"Change Password"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(bt,{size:18,className:"text-gray-500"})," Content & Safety"]}),e.jsx(Y,{title:"Blocked Users",items:(ne=d.social)==null?void 0:ne.blockedUsers,type:"blocks",icon:Js}),e.jsx(Y,{title:"Muted Threads",items:(me=d.messenger)==null?void 0:me.mutedThreads,type:"mutes",icon:Es})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(wt,{size:18,className:"text-brand-blue"})," Notification Preferences"]}),e.jsx("div",{className:"space-y-3",children:Object.entries({email:"Email Notifications",push:"Push Notifications",marketing:"Marketing & Updates"}).map(([G,he])=>{var se;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-300",children:he}),e.jsx("div",{onClick:()=>T("notifications",G),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(se=d.notifications)!=null&&se[G]?"bg-brand-blue justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]},G)})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Pe,{size:18,className:"text-green-500"})," Privacy & Visibility"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Public Profile Visibility"})]}),e.jsx("div",{onClick:()=>T("privacy","publicProfile"),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(_=d.privacy)!=null&&_.publicProfile?"bg-green-500 justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Show Location on Map"})]}),e.jsx("div",{onClick:()=>T("privacy","showLocation"),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(ae=d.privacy)!=null&&ae.showLocation?"bg-green-500 justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Js,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Hide Profile Completely"})]}),e.jsx("div",{onClick:()=>T("privacy","hideProfile"),className:`w-10 h-5 rounded-full p-0.5 flex cursor-pointer transition-colors ${(de=d.privacy)!=null&&de.hideProfile?"bg-brand-blue justify-end":"bg-gray-300 dark:bg-gray-600 justify-start"}`,children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full shadow-sm"})})]}),e.jsx("div",{className:"pt-4 mt-2 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-bold dark:text-white",children:"Your Data"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Download a copy of your personal data (GDPR/CCPA)."})]}),e.jsxs("button",{onClick:Z,disabled:c,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs font-bold text-gray-700 dark:text-gray-200 transition",children:[c?e.jsx(oe,{size:14,className:"animate-spin"}):e.jsx(Ia,{size:14}),"Download Data"]})]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Rt,{size:18,className:"text-purple-500"})," Appearance"]}),e.jsx("div",{className:"flex bg-gray-100 dark:bg-black/20 p-1 rounded-lg",children:["light","dark","system"].map(G=>e.jsx("button",{onClick:()=>P(G),className:`flex-1 py-2 text-xs font-bold rounded-md capitalize transition-all ${d.theme===G?"bg-white dark:bg-gray-700 shadow-sm text-brand-blue":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:G},G))})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 p-6 rounded-xl border border-red-100 dark:border-red-800/30 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-lg text-red-600 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(gt,{size:18})," Danger Zone"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:"Deleting your account is permanent. This action will trigger the data cleanup process, removing your profile, posts, and messages."}),C?e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border border-red-200 dark:border-red-900 shadow-lg animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("h4",{className:"font-bold text-red-600 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(ht,{size:16})," Confirm Deletion"]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["Type ",e.jsx("strong",{children:"DELETE"})," below to confirm. This cannot be undone."]}),e.jsx("input",{type:"text",className:"w-full p-2 border border-red-300 dark:border-red-900 rounded mb-3 text-sm focus:ring-2 focus:ring-red-500 outline-none dark:bg-black/20 dark:text-white",placeholder:"Type DELETE",value:k,onChange:G=>E(G.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:D,disabled:k!=="DELETE"||N,className:"flex-1 bg-red-600 text-white py-2 rounded font-bold text-xs hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:N?e.jsx(oe,{className:"animate-spin",size:14}):"Confirm Delete"}),e.jsx("button",{onClick:()=>{h(!1),E("")},className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-xs hover:opacity-80",children:"Cancel"})]})]}):e.jsx("button",{onClick:()=>h(!0),className:"bg-red-100 hover:bg-red-200 dark:bg-red-900/40 dark:hover:bg-red-900/60 text-red-700 dark:text-red-300 px-4 py-2 rounded-lg text-sm font-bold transition",children:"Delete Account"})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 shadow-2xl animate-in zoom-in-95 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white flex items-center gap-2",children:[z==="email"?e.jsx(Vt,{size:20}):e.jsx(Wt,{size:20}),"Update ",z==="email"?"Email":"Password"]}),e.jsx("button",{onClick:()=>R(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-white",children:e.jsx(pe,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Current Password (Required)"}),e.jsx("input",{type:"password",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Verify your identity",value:S.currentPassword,onChange:G=>w({...S,currentPassword:G.target.value})})]}),z==="email"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"New Email Address"}),e.jsx("input",{type:"email",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"name@example.com",value:S.newEmail,onChange:G=>w({...S,newEmail:G.target.value})})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"New Password"}),e.jsx("input",{type:"password",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Min 6 characters",value:S.newPassword,onChange:G=>w({...S,newPassword:G.target.value})})]}),e.jsxs("button",{onClick:W,disabled:v,className:"w-full bg-blue-600 text-white py-2.5 rounded-lg font-bold hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2 shadow-lg mt-2",children:[v?e.jsx(oe,{className:"animate-spin",size:18}):e.jsx(ve,{size:18}),"Confirm Update"]})]})]})})]})}const Ai=Ts({firstName:Ee().min(2,"First name too short"),lastName:Ee().min(2,"Last name too short"),displayName:Ee().optional(),bio:Ee().max(500,"Bio exceeds 500 characters").optional(),zip:Ee().regex(/^\d{5}$/,"Invalid ZIP code").optional().or(Xt("")),hourlyRate:Kt().min(0,"Rate cannot be negative").optional(),website:Ee().url("Invalid URL").optional().or(Xt(""))}),Li=(t,s,l)=>l?l.substring(0,2).toUpperCase():(((t==null?void 0:t[0])||"")+((s==null?void 0:s[0])||"")).toUpperCase()||"U";function $i({user:t,userData:s,subProfiles:l={},handleLogout:n}){const[d,o]=r.useState("details"),[a,b]=r.useState("Main"),[x,g]=r.useState(!1),{uploadImage:m,uploading:u}=Oa(),[i,p]=r.useState((s==null?void 0:s.useLegalNameOnly)||!1),[c,y]=r.useState((s==null?void 0:s.useUserNameOnly)||!1);r.useEffect(()=>{p((s==null?void 0:s.useLegalNameOnly)||!1),y((s==null?void 0:s.useUserNameOnly)||!1)},[s]);const N=()=>{const S=!i;p(S),S&&y(!1)},j=()=>{const S=!c;y(S),S&&p(!1)},{register:k,handleSubmit:E,formState:{errors:C,isDirty:h}}=Is({resolver:Ms(Ai),defaultValues:{firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",displayName:(s==null?void 0:s.displayName)||"",bio:(s==null?void 0:s.bio)||"",zip:(s==null?void 0:s.zip)||"",hourlyRate:(s==null?void 0:s.hourlyRate)||0,website:(s==null?void 0:s.website)||""}}),f=async S=>{g(!0);const w=X.loading("Saving main profile...");try{let v=`${S.firstName} ${S.lastName}`;i?v=`${S.firstName} ${S.lastName}`:c&&S.displayName?v=S.displayName:S.displayName&&(v=`${S.firstName} "${S.displayName}" ${S.lastName}`);const $=Q(O,te(t.uid).userProfile);await be($,{...S,useLegalNameOnly:i,useUserNameOnly:c,effectiveDisplayName:v,searchTerms:[S.firstName.toLowerCase(),S.lastName.toLowerCase(),(S.displayName||"").toLowerCase(),v.toLowerCase()].filter(Boolean)}),X.success("Main Profile Updated!",{id:w})}catch(v){console.error("Update failed",v),X.error("Failed to update profile.",{id:w})}finally{g(!1)}},R=async S=>{const w=S.target.files[0];if(!w)return;const v=X.loading("Uploading photo...");try{const $=await m(w,`users/${t.uid}/avatars`),B=Q(O,te(t.uid).userProfile);await be(B,{photoURL:$}),X.success("Photo uploaded!",{id:v})}catch($){console.error($),X.error("Photo upload failed",{id:v})}},z=async S=>{try{const w=Q(O,te(t.uid).userProfile);await be(w,{settings:S}),X.success("Settings saved.")}catch(w){console.error("Settings save failed",w),X.error("Failed to save settings.")}},I=S=>Ra("w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none",S?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-700");return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("h1",{className:"text-3xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(qe,{className:"text-brand-blue"})," ",d==="details"?"Edit Profile":"Account Settings"]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex gap-1 self-start md:self-auto",children:[e.jsx("button",{onClick:()=>o("details"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${d==="details"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"Edit Details"}),e.jsxs("button",{onClick:()=>o("settings"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all flex items-center gap-1 ${d==="settings"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:[e.jsx(bt,{size:14})," Settings"]})]})]}),d==="details"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-2",children:[e.jsx("div",{className:"font-bold text-xs text-gray-500 uppercase tracking-wider mb-2 px-1",children:"Profiles"}),e.jsxs("button",{onClick:()=>b("Main"),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${a==="Main"?"bg-brand-blue text-white shadow-md":"bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{size:16})," ",e.jsx("span",{className:"font-bold text-sm",children:"Main Profile"})]}),a==="Main"&&e.jsx(Ke,{size:16})]}),((s==null?void 0:s.accountTypes)||[]).map(S=>Dt[S]?e.jsxs("button",{onClick:()=>b(S),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${a===S?"bg-brand-blue text-white shadow-md":"bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{size:16})," ",e.jsx("span",{className:"font-bold text-sm",children:S})]}),a===S&&e.jsx(Ke,{size:16})]},S):null)]}),e.jsx("div",{className:"lg:col-span-3",children:a==="Main"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsxs("div",{className:"relative group w-full aspect-square rounded-full overflow-hidden bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-700 shadow-md",children:[s!=null&&s.photoURL?e.jsx("img",{src:s.photoURL,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gradient-to-tr from-brand-blue to-purple-500 text-white font-bold text-4xl",children:Li(s==null?void 0:s.firstName,s==null?void 0:s.lastName,s==null?void 0:s.displayName)}),e.jsxs("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity",children:[e.jsx("span",{className:"text-white font-bold text-sm",children:"Change Photo"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:R,disabled:u})]}),u&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(oe,{className:"animate-spin text-white"})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl text-xs text-blue-800 dark:text-blue-200",children:[e.jsx("p",{className:"font-bold mb-1",children:"Pro Tip:"}),"High-quality profile photos increase booking rates by 40%."]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("form",{onSubmit:E(f),className:"space-y-6 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"First Name (Legal)"}),e.jsx("input",{...k("firstName"),className:I(C.firstName)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Last Name (Legal)"}),e.jsx("input",{...k("lastName"),className:I(C.lastName)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"User Name (Display Name)"}),e.jsx("input",{...k("displayName"),className:I(C.displayName),placeholder:"e.g. SeshMaster"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-1",children:"Display Name Preferences"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Legal Name Only"}),e.jsx("button",{type:"button",onClick:N,className:"text-brand-blue",children:i?e.jsx(vt,{size:28}):e.jsx(Nt,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use User Name Only"}),e.jsx("button",{type:"button",onClick:j,className:"text-brand-blue",children:c?e.jsx(vt,{size:28}):e.jsx(Nt,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2",children:["Preview: ",e.jsx("strong",{className:"text-brand-blue",children:i?`${s.firstName} ${s.lastName}`:c?s.displayName||"Not Set":`${s.firstName} "${s.displayName||"User"}" ${s.lastName}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Bio / About"}),e.jsx("textarea",{...k("bio"),rows:"4",className:I(C.bio),placeholder:"Tell us about your musical journey..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(Le,{size:12})," ZIP Code"]}),e.jsx("input",{...k("zip"),className:I(C.zip)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx($e,{size:12})," Hourly Rate ($)"]}),e.jsx("input",{type:"number",...k("hourlyRate",{valueAsNumber:!0}),className:I(C.hourlyRate)})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700 flex justify-end",children:e.jsx("button",{type:"button",onClick:E(f),disabled:x,className:Pa("px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg",x?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-105"),children:x?e.jsx(oe,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{size:20})," Save Changes"]})})})]})})]}):e.jsx(Ti,{user:t,userData:s,role:a,initialData:l[a]||{},schema:Dt[a]||[]})})]}):e.jsx("div",{className:"animate-in fade-in slide-in-from-right-2",children:e.jsx(rr,{user:t,userData:s,handleLogout:n,onUpdate:z})})]})}function Ti({user:t,userData:s,role:l,initialData:n,schema:d}){const[o,a]=r.useState(n),[b,x]=r.useState(!1),[g,m]=r.useState(n.followMainProfile??!0),[u,i]=r.useState(n.useLegalNameOnly??!1),[p,c]=r.useState(n.useUserNameOnly??!1),[y,N]=r.useState(n.syncStudioOps??!1);r.useEffect(()=>{a(n||{}),m(n.followMainProfile??!0),i(n.useLegalNameOnly??!1),c(n.useUserNameOnly??!1),N(n.syncStudioOps??!1)},[n]);const j=(f,R)=>a(z=>({...z,[f]:R})),k=()=>{i(!u),u||c(!1)},E=()=>{c(!p),p||i(!1)},C=async f=>{f.preventDefault(),x(!0);const R=X.loading(`Saving ${l} profile...`);try{let z="";g?z=s.effectiveDisplayName||`${s.firstName} ${s.lastName}`:u?z=`${s.firstName} ${s.lastName}`:p?z=s.displayName||`${s.firstName} ${s.lastName}`:z=o.profileName||`${s.firstName} ${s.lastName}`;const I={...o,followMainProfile:g,useLegalNameOnly:u,useUserNameOnly:p,syncStudioOps:y,displayName:z},S=Q(O,te(t.uid).userSubProfile(l));if(await xt(S,I,{merge:!0}),s.activeProfileRole===l){const w=Q(O,te(t.uid).userPublicProfile);await be(w,{displayName:z,searchTerms:[z.toLowerCase()]})}if(l==="Studio"&&y){const w=Q(O,te(t.uid).userProfile);await be(w,{studioName:z})}X.success(`${l} Profile Saved!`,{id:R})}catch(z){console.error(z),X.error("Failed to save.",{id:R})}finally{x(!1)}};if(d.length===0)return e.jsx("div",{className:"p-10 text-center text-gray-500",children:"No configuration available for this role."});const h=d.filter(f=>f.key!=="profileName"&&f.key!=="useRealName");return e.jsxs("form",{onSubmit:C,className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white border-b dark:border-gray-700 pb-2",children:[l," Identity & Details"]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-1",children:"Identity Settings"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Follow Main Profile Name"}),e.jsxs("div",{className:"text-xs text-gray-500",children:['Use "',s.effectiveDisplayName||`${s.firstName} ${s.lastName}`,'"']})]}),e.jsx("button",{type:"button",onClick:()=>m(!g),className:"text-brand-blue",children:g?e.jsx(vt,{size:28}):e.jsx(Nt,{size:28,className:"text-gray-400"})})]}),!g&&e.jsxs("div",{className:"space-y-3 animate-in slide-in-from-top-1 pt-3 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Legal Name Only"}),e.jsx("button",{type:"button",onClick:k,className:"text-brand-blue",children:u?e.jsx(vt,{size:28}):e.jsx(Nt,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Main User Name Only"}),e.jsx("button",{type:"button",onClick:E,className:"text-brand-blue",children:p?e.jsx(vt,{size:28}):e.jsx(Nt,{size:28,className:"text-gray-400"})})]}),!u&&!p&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("label",{className:"text-xs font-bold text-brand-blue uppercase mb-1 block",children:[l," Name"]}),e.jsx("input",{type:"text",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none font-bold",placeholder:`e.g. ${l==="Studio"?"Sound City":"The Weeknd"}`,value:o.profileName||"",onChange:f=>j("profileName",f.target.value)}),l==="Studio"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:f=>N(f.target.checked),className:"rounded text-brand-blue focus:ring-brand-blue"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Force "Studio Ops" to use this name'})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2",children:["Preview: ",e.jsx("strong",{className:"text-brand-blue",children:u?`${s.firstName} ${s.lastName}`:p?s.displayName||"Not Set":o.profileName||"Not Set"})]})]})]}),h.map(f=>{var R;return f.isToggle?null:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:f.label}),f.type==="textarea"?e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",rows:4,value:o[f.key]||"",onChange:z=>j(f.key,z.target.value)}):f.type==="select"?e.jsx("select",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",value:o[f.key]||"",onChange:z=>j(f.key,z.target.value),children:(R=f.options)==null?void 0:R.map(z=>e.jsx("option",{value:z,children:z},z))}):f.type==="multi_select"?e.jsx(Hs,{label:"",fieldKey:f.key,options:f.data||f.options||[],initialValues:o[f.key]||[],onChange:j}):f.type==="nested_select"?e.jsx(In,{label:"",fieldKey:f.key,data:f.data,initialValues:o[f.key]||[],onChange:j}):f.key==="equipment"?e.jsx(Ws,{multi:!0,value:o[f.key]||"",onChange:z=>j(f.key,z),placeholder:"Add gear..."}):e.jsx("input",{type:f.type==="number"?"number":"text",className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",value:o[f.key]||"",onChange:z=>j(f.key,z.target.value)})]},f.key)}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700 flex justify-end",children:e.jsx("button",{type:"submit",disabled:b,className:"px-8 py-3 rounded-xl font-bold bg-brand-blue text-white hover:bg-blue-600 flex items-center gap-2 transition shadow-lg disabled:opacity-50",children:b?e.jsx(oe,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{size:20})," Save ",l," Profile"]})})})]})}function Ii({user:t}){const[s,l]=r.useState([]),[n,d]=r.useState("All");return r.useEffect(()=>{const o=ye(le(O,`artifacts/${re}/public/data/service_requests`),Ae("timestamp","desc"),Ze(50)),a=fe(o,b=>l(b.docs.map(x=>({id:x.id,...x.data()}))));return()=>a()},[]),e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2",children:[e.jsx("button",{onClick:()=>d("All"),className:`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap border transition ${n==="All"?"bg-orange-500 text-white border-orange-600":"bg-white dark:bg-dark-card border-gray-200 dark:border-gray-700 dark:text-gray-300"}`,children:"All Jobs"}),ts.map(o=>e.jsx("button",{onClick:()=>d(o.label),className:`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap border transition ${n===o.label?"bg-orange-500 text-white border-orange-600":"bg-white dark:bg-dark-card border-gray-200 dark:border-gray-700 dark:text-gray-300"}`,children:o.label},o.id))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.filter(o=>n==="All"||o.category===n).map(o=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 hover:border-orange-400 transition shadow-sm group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20 px-2 py-0.5 rounded",children:o.category}),o.budget&&e.jsxs("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:["$",o.budget]})]}),e.jsx("h3",{className:"font-bold text-lg dark:text-white mb-1",children:o.topic}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-4",children:o.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 border-t dark:border-gray-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{size:12})," ",o.userName]}),o.userId!==t.uid&&e.jsxs("button",{className:"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1.5 rounded font-bold hover:opacity-80 flex items-center gap-1",children:[e.jsx(Te,{size:12})," Message"]})]})]},o.id)),s.length===0&&e.jsx("div",{className:"col-span-full text-center py-12 text-gray-400",children:"No active requests."})]})]})}function Mi({user:t,userData:s,target:l,onClose:n}){const[d,o]=r.useState(!1),[a,b]=r.useState({serviceCategory:"Repair",equipmentName:"",issueDescription:"",logistics:"Drop-off",preferredDate:"",budgetCap:""}),[x,g]=r.useState([]),{uploadMedia:m,uploading:u}=it(),i=async c=>{const y=c.target.files[0];if(!y)return;const N=await m(y,`tech_requests/${t.uid}`);N&&g(j=>[...j,N])},p=async()=>{if(!a.equipmentName||!a.issueDescription)return alert("Please describe the equipment and the issue.");o(!0);try{await we(le(O,`artifacts/${re}/public/data/bookings`),{senderId:t.uid,senderName:`${s.firstName} ${s.lastName}`,targetId:l.id,targetName:l.firstName?`${l.firstName} ${l.lastName}`:l.name,type:"TechRequest",serviceType:a.serviceCategory,equipment:a.equipmentName,description:a.issueDescription,logistics:a.logistics,budgetCap:a.budgetCap,status:"Pending",date:a.preferredDate||"Flexible",message:`[${a.serviceCategory}] ${a.equipmentName}: ${a.issueDescription}`,attachments:x,timestamp:ue()}),alert("Service request sent!"),n()}catch{alert("Failed to send.")}o(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-in fade-in zoom-in-95",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(Ct,{size:18,className:"text-orange-500"})," Service Request"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Hiring ",e.jsxs("span",{className:"font-bold text-orange-600 dark:text-orange-400",children:[l.firstName," ",l.lastName]})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(pe,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Type"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:a.serviceCategory,onChange:c=>b({...a,serviceCategory:c.target.value}),children:ts.map(c=>e.jsx("option",{value:c.label,children:c.label},c.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Logistics"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:a.logistics,onChange:c=>b({...a,logistics:c.target.value}),children:[e.jsx("option",{value:"Drop-off",children:"I will drop it off"}),e.jsx("option",{value:"On-site",children:"Tech comes to me"}),e.jsx("option",{value:"Ship",children:"I will ship it"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Equipment"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"e.g. Fender Twin Reverb",value:a.equipmentName,onChange:c=>b({...a,equipmentName:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Issue Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px] text-sm",placeholder:"Describe symptoms...",value:a.issueDescription,onChange:c=>b({...a,issueDescription:c.target.value})})]}),e.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-brand-blue hover:text-blue-600 font-bold mb-3",children:[e.jsx(Ls,{size:16})," Add Video/Photo ",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,video/*",onChange:i,disabled:u})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:x.map((c,y)=>e.jsx("div",{className:"h-12 w-12 bg-black rounded border dark:border-gray-600 overflow-hidden",children:e.jsx("img",{src:c.url,className:"h-full w-full object-cover"})},y))})]})]}),e.jsx("div",{className:"p-5 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("button",{onClick:p,disabled:d||u,className:"w-full bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg",children:d?e.jsx(oe,{className:"animate-spin mx-auto"}):"Submit Request"})})]})})}function Fi({user:t,userData:s,openPublicProfile:l}){const[n,d]=r.useState([]),[o,a]=r.useState(!1),[b,x]=r.useState(""),[g,m]=r.useState(""),[u,i]=r.useState(null),p=async()=>{a(!0);try{const c=[Ce("accountTypes","array-contains","Technician"),Ze(20)];b&&c.push(Ce("searchTerms","array-contains",b.toLowerCase()));const y=ye(ls(O,"public_profile"),...c);let j=(await Xe(y)).docs.map(k=>({id:k.ref.parent.parent.id,...k.data()})).filter(k=>k.id!==t.uid);g&&(j=j.filter(k=>k.subRoles&&k.subRoles.includes(g))),d(j)}catch(c){console.error(c)}a(!1)};return r.useEffect(()=>{p()},[g]),e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Be,{className:"absolute left-4 top-3.5 text-gray-400",size:18}),e.jsx("input",{className:"w-full pl-12 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-orange-500 dark:text-white",placeholder:"Search technicians...",value:b,onChange:c=>x(c.target.value),onKeyDown:c=>c.key==="Enter"&&p()})]}),e.jsx("div",{className:"md:w-1/3",children:e.jsxs("select",{className:"w-full p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-orange-500 dark:text-white cursor-pointer",value:g,onChange:c=>m(c.target.value),children:[e.jsx("option",{value:"",children:"All Specialties"}),Ba.map(c=>e.jsx("option",{value:c,children:c},c))]})})]}),o?e.jsx("div",{className:"text-center py-12",children:e.jsx(oe,{className:"animate-spin mx-auto text-orange-500"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(c=>{var y,N,j;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm hover:shadow-lg transition group",children:[e.jsx("div",{className:"h-24 bg-gradient-to-r from-slate-700 to-slate-600 relative",children:e.jsx("div",{className:"absolute -bottom-8 left-6",children:e.jsx("div",{className:"h-16 w-16 rounded-full border-4 border-white dark:border-[#2c2e36] bg-gray-200 overflow-hidden",children:c.photoURL?e.jsx("img",{src:c.photoURL,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:e.jsx(qe,{})})})})}),e.jsxs("div",{className:"pt-10 px-6 pb-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white text-lg",children:[c.firstName," ",c.lastName]}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 font-bold mb-2 flex items-center gap-1",children:[e.jsx(rt,{size:12})," ",((y=c.subRoles)==null?void 0:y[0])||"Technician"]})]}),c.rate>0&&e.jsxs("div",{className:"text-sm font-bold dark:text-gray-300 border border-gray-200 dark:border-gray-600 px-2 py-1 rounded-lg",children:["$",c.rate,"/hr"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:(N=c.subRoles)==null?void 0:N.slice(0,3).map(k=>e.jsx("span",{className:"text-[10px] bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-200 px-2 py-0.5 rounded border border-orange-200 dark:border-orange-800",children:k},k))}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-4 h-6 overflow-hidden",children:(((j=c.skills)==null?void 0:j.split(","))||[]).slice(0,3).map((k,E)=>e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 pr-2 border-r border-gray-300 dark:border-gray-600 last:border-0",children:k.trim()},E))}),e.jsxs("div",{className:"flex gap-2 mt-auto",children:[e.jsx("button",{onClick:()=>l(c.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 rounded-lg text-xs font-bold transition",children:"Profile"}),e.jsxs("button",{onClick:()=>i(c),className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white py-2 rounded-lg text-xs font-bold transition shadow-sm flex items-center justify-center gap-1",children:[e.jsx(Ct,{size:14})," Request"]})]})]})]},c.id)})}),u&&e.jsx(Mi,{user:t,userData:s,target:u,onClose:()=>i(null)})]})}function Oi({user:t,userData:s,onSuccess:l,onCancel:n}){const[d,o]=r.useState(ts[0].label),[a,b]=r.useState(""),[x,g]=r.useState("Normal"),[m,u]=r.useState(""),[i,p]=r.useState(""),[c,y]=r.useState(!1),[N,j]=r.useState(null),{uploadMedia:k,uploading:E}=it(),C=async f=>{const R=f.target.files[0];if(!R)return;const z=await k(R,`service_requests/${t.uid}`);z&&j(z)},h=async()=>{if(!a||!i)return alert("Please complete the request.");y(!0);try{await we(le(O,`artifacts/${re}/public/data/service_requests`),{topic:`${d} for ${a}`,category:d,equipment:a,urgency:x,budget:m?parseInt(m):null,description:i,userId:t.uid,userName:`${s.firstName} ${s.lastName}`,status:"Open",timestamp:ue(),attachment:N||null}),alert("Tech Request Broadcasted!"),l()}catch(f){console.error(f),alert("Failed.")}y(!1)};return e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border border-orange-200 dark:border-gray-700 shadow-xl animate-in zoom-in-95",children:[e.jsxs("h2",{className:"text-2xl font-extrabold dark:text-white mb-6 flex items-center gap-2 text-orange-600",children:[e.jsx(Oe,{})," Broadcast Tech Need"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-6 bg-orange-50 dark:bg-gray-800 rounded-xl border border-orange-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-lg font-medium text-gray-700 dark:text-gray-200",children:[e.jsx("span",{children:"I need"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:d,onChange:f=>o(f.target.value),className:"appearance-none bg-white dark:bg-gray-700 border border-orange-300 dark:border-orange-700 rounded-lg py-1 pl-3 pr-8 font-bold text-orange-700 dark:text-white focus:outline-none",children:ts.map(f=>e.jsx("option",{value:f.label,children:f.label},f.id))}),e.jsx(dt,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-orange-500 dark:text-white pointer-events-none"})]}),e.jsx("span",{children:"for my"}),e.jsx("input",{className:"bg-transparent border-b-2 border-orange-300 dark:border-orange-700 text-center w-40 font-bold focus:outline-none focus:border-orange-500 dark:text-white",placeholder:"Equipment Name",value:a,onChange:f=>b(f.target.value)})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Urgency"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:x,onChange:f=>g(f.target.value),children:[e.jsx("option",{children:"Normal"}),e.jsx("option",{children:"High (Session Blocked)"}),e.jsx("option",{children:"Emergency (24h)"}),e.jsx("option",{children:"Flexible"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Est. Budget ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Optional",value:m,onChange:f=>u(f.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Details"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Describe the issue, specific model, symptoms...",value:i,onChange:f=>p(f.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Visual Reference"}),!N&&!E&&e.jsxs("label",{className:"flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition text-gray-500",children:[e.jsx(Ls,{size:20}),e.jsx("span",{className:"text-sm font-bold",children:"Upload Video or Image"}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*,image/*",onChange:C})]}),N&&e.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden border dark:border-gray-700 bg-black",children:[N.type==="video"?e.jsx("video",{src:N.url,controls:!0,className:"w-full h-48 object-contain"}):e.jsx("img",{src:N.url,className:"w-full h-48 object-contain"}),e.jsx("button",{onClick:()=>j(null),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(pe,{size:14})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:n,className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:c||E,className:"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:c?e.jsx(oe,{className:"animate-spin"}):"Broadcast Now"})]})]})]})}function Bi({user:t,isTech:s}){const[l,n]=r.useState("feed"),[d,o]=r.useState([]),[a,b]=r.useState(!0);r.useEffect(()=>{const g=ye(le(O,te(t.uid).equipmentSubmissions),Ce("status","==","pending"),Ae("timestamp","desc"),Ze(20)),m=fe(g,u=>{o(u.docs.map(i=>({id:i.id,...i.data()}))),b(!1)});return()=>m()},[t.uid]);const x=async(g,m,u)=>{var i,p,c,y,N,j;if(!s)return alert("Only verified Technicians can vote on gear accuracy.");try{const k=Q(O,te(t.uid).equipmentSubmissions,g),E=`votes.${m}`;await be(k,{[E]:ea(t.uid)});const C=3,h=3,f=(((p=(i=u.votes)==null?void 0:i.yes)==null?void 0:p.length)||0)+(m==="yes"?1:0),R=(((y=(c=u.votes)==null?void 0:c.fake)==null?void 0:y.length)||0)+(m==="fake"?1:0),z=(((j=(N=u.votes)==null?void 0:N.duplicate)==null?void 0:j.length)||0)+(m==="duplicate"?1:0);if(f>=C){const I=Q(O,`artifacts/${re}/public/data/equipment_database/${u.category}/items`,u.model.replace(/\s+/g,"_"));await xt(I,{name:u.model,brand:u.brand,category:u.category,subCategory:u.subCategory,specs:u.specs,verifiedBy:ea(t.uid),addedBy:u.submittedBy,addedAt:ue()}),await be(k,{status:"approved"}),await be(Q(O,te(u.submittedBy).userWallet),{balance:De(50)}),await be(Q(O,te(t.uid).userWallet),{balance:De(5)}),alert("Consensus reached! Item approved and rewards distributed.")}else(R>=h||z>=h)&&await be(k,{status:"rejected"})}catch(k){console.error("Voting failed:",k)}};return e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Qr,{className:"text-orange-500"})," Gear Knowledge Base"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Crowdsourced equipment specs verified by pros."})]}),e.jsxs("div",{className:"flex gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>n("feed"),className:`px-4 py-2 rounded-md text-xs font-bold transition ${l==="feed"?"bg-white dark:bg-gray-600 shadow text-orange-600 dark:text-orange-400":"text-gray-500"}`,children:"The Bench (Queue)"}),e.jsx("button",{onClick:()=>n("submit"),className:`px-4 py-2 rounded-md text-xs font-bold transition ${l==="submit"?"bg-white dark:bg-gray-600 shadow text-orange-600 dark:text-orange-400":"text-gray-500"}`,children:"Submit New Gear"})]})]}),l==="feed"&&e.jsx("div",{className:"grid grid-cols-1 gap-4",children:a?e.jsx("div",{className:"p-10 text-center",children:e.jsx(oe,{className:"animate-spin mx-auto"})}):d.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl",children:[e.jsx(ve,{size:48,className:"mx-auto text-green-500 mb-2 opacity-50"}),e.jsx("p",{className:"text-gray-500",children:"The bench is clear. No pending submissions."})]}):d.map(g=>{var m,u,i,p,c,y,N,j,k,E,C,h,f;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-500",children:g.brand}),e.jsx("span",{className:"text-[10px] font-bold uppercase bg-blue-50 dark:bg-blue-900/20 text-blue-600 px-2 py-0.5 rounded",children:(m=g.category)==null?void 0:m.replace(/_/g," ")})]}),e.jsx("h4",{className:"text-lg font-extrabold dark:text-white mb-2",children:g.model}),e.jsx("div",{className:"bg-gray-50 dark:bg-black/20 p-3 rounded-lg text-sm text-gray-600 dark:text-gray-300 mb-2 border dark:border-gray-700",children:g.specs}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(qe,{size:12})," Submitted by ",g.submitterName||"Unknown"," • 50 TK Reward Pending"]})]}),e.jsxs("div",{className:"w-full md:w-48 flex flex-col justify-center gap-2 border-l dark:border-gray-700 pl-0 md:pl-6",children:[e.jsxs("button",{onClick:()=>x(g.id,"yes",g),disabled:(i=(u=g.votes)==null?void 0:u.yes)==null?void 0:i.includes(t.uid),className:"w-full py-2 bg-green-100 dark:bg-green-900/20 hover:bg-green-200 text-green-700 dark:text-green-400 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(Jr,{size:14})," Yes (",((c=(p=g.votes)==null?void 0:p.yes)==null?void 0:c.length)||0,")"]}),e.jsxs("button",{onClick:()=>x(g.id,"fake",g),disabled:(N=(y=g.votes)==null?void 0:y.fake)==null?void 0:N.includes(t.uid),className:"w-full py-2 bg-red-100 dark:bg-red-900/20 hover:bg-red-200 text-red-700 dark:text-red-400 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(Dr,{size:14})," Fake (",((k=(j=g.votes)==null?void 0:j.fake)==null?void 0:k.length)||0,")"]}),e.jsxs("button",{onClick:()=>x(g.id,"duplicate",g),disabled:(C=(E=g.votes)==null?void 0:E.duplicate)==null?void 0:C.includes(t.uid),className:"w-full py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 text-gray-600 dark:text-gray-300 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(It,{size:14})," Dup (",((f=(h=g.votes)==null?void 0:h.duplicate)==null?void 0:f.length)||0,")"]})]})]},g.id)})}),l==="submit"&&e.jsx(_i,{user:t,userData,onSuccess:()=>n("feed")})]})}function _i({user:t,userData:s,onSuccess:l}){const[n,d]=r.useState({brand:"",model:"",category:ut[0].id,subCategory:"",specs:""}),[o,a]=r.useState(!1),b=async()=>{if(!n.brand||!n.model||!n.specs)return alert("All fields required.");a(!0);try{await we(le(O,te(t.uid).equipmentSubmissions),{...n,submittedBy:t.uid,submitterName:`${s.firstName} ${s.lastName}`,status:"pending",timestamp:ue(),votes:{yes:[],fake:[],duplicate:[]}}),alert("Submission Received! You'll earn 50 TK once verified."),l()}catch(x){console.error(x),alert("Submission failed.")}a(!1)};return e.jsxs("div",{className:"max-w-xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border border-orange-200 dark:border-gray-700 shadow-lg",children:[e.jsx("h4",{className:"font-bold text-lg dark:text-white mb-4",children:"Submit New Equipment"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsx("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:n.category,onChange:x=>d({...n,category:x.target.value}),children:ut.map(x=>e.jsx("option",{value:x.id,children:x.label},x.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Sub-Category"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. Compressor",value:n.subCategory,onChange:x=>d({...n,subCategory:x.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. Neve",value:n.brand,onChange:x=>d({...n,brand:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. 1073LB",value:n.model,onChange:x=>d({...n,model:x.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Specs / Description"}),e.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm h-24",placeholder:"Brief technical specs...",value:n.specs,onChange:x=>d({...n,specs:x.target.value})})]}),e.jsx("button",{onClick:b,disabled:o,className:"w-full bg-orange-600 text-white py-2.5 rounded-lg font-bold hover:bg-orange-700 flex items-center justify-center gap-2",children:o?e.jsx(oe,{className:"animate-spin"}):"Submit for Verification"})]})]})}function qi({user:t}){const[s,l]=r.useState({skills:"",rate:"",serviceRadius:"",subRoles:[]}),[n,d]=r.useState(!0);r.useEffect(()=>{yt(Q(O,te(t.uid).userSubProfile("Technician"))).then(a=>{a.exists()&&l(a.data()),d(!1)})},[t.uid]);const o=async()=>{try{await be(Q(O,te(t.uid).userSubProfile("Technician")),s);const a=[...s.skills?s.skills.toLowerCase().split(",").map(b=>b.trim()):[],...s.subRoles?s.subRoles.map(b=>b.toLowerCase()):[]];await be(Q(O,te(t.uid).userPublicProfile),{rate:parseInt(s.rate)||0,subRoles:s.subRoles||[],searchTerms:a}),alert("Tech Profile Updated Successfully")}catch{alert("Update failed")}};return n?e.jsx("div",{className:"p-10 text-center",children:e.jsx(oe,{className:"animate-spin mx-auto"})}):e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm animate-in fade-in",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white mb-6 border-b dark:border-gray-700 pb-2",children:"Your Technician Settings"}),e.jsxs("div",{className:"space-y-5",children:[e.jsx(Hs,{label:"Primary Specialties",fieldKey:"subRoles",options:Ba,initialValues:s.subRoles,onChange:(a,b)=>l(x=>({...x,[a]:b}))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Detailed Skills (Comma Separated)"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:s.skills||"",onChange:a=>l({...s,skills:a.target.value}),placeholder:"e.g. SSL 4000 Maintenance, Tube Bias..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hourly Rate ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:s.rate||"",onChange:a=>l({...s,rate:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Radius (Miles)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:s.serviceRadius||"",onChange:a=>l({...s,serviceRadius:a.target.value})})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:o,className:"w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(tt,{size:18})," Save Changes"]})})]})]})}function Hi({user:t,userData:s,openPublicProfile:l}){var a;const[n,d]=r.useState("board"),o=(a=s==null?void 0:s.accountTypes)==null?void 0:a.includes("Technician");return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-900 to-slate-900 p-8 rounded-2xl text-white shadow-xl relative overflow-hidden flex flex-col md:flex-row justify-between items-end",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-400 font-bold uppercase tracking-widest text-xs mb-2",children:[e.jsx(Ct,{size:14})," SeshNx Technical"]}),e.jsx("h1",{className:"text-3xl font-extrabold mb-2",children:"Studio Tech Services"}),e.jsx("p",{className:"text-slate-300 max-w-lg",children:"Hire professionals for equipment repair, studio wiring, and acoustic calibration."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 relative z-10 mt-4 md:mt-0",children:[e.jsx("button",{onClick:()=>d("board"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${n==="board"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Job Board"}),e.jsx("button",{onClick:()=>d("directory"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${n==="directory"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Find a Tech"}),e.jsx("button",{onClick:()=>d("broadcast"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${n==="broadcast"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Post Request"}),e.jsx("button",{onClick:()=>d("database"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${n==="database"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Gear DB"}),o&&e.jsx("button",{onClick:()=>d("profile"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${n==="profile"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Tech Portal"})]}),e.jsx(bt,{size:200,className:"absolute -right-10 -top-10 text-white opacity-5 rotate-12 pointer-events-none"})]}),e.jsxs("div",{className:"min-h-[400px]",children:[n==="board"&&e.jsx(Ii,{user:t}),n==="directory"&&e.jsx(Fi,{user:t,userData:s,openPublicProfile:l}),n==="broadcast"&&e.jsx(Oi,{user:t,userData:s,onSuccess:()=>d("board"),onCancel:()=>d("board")}),n==="database"&&e.jsx(Bi,{user:t,isTech:o}),n==="profile"&&o&&e.jsx(qi,{user:t})]})]})}const Wi=()=>{const[t,s]=r.useState({tierData:null,tokenPackages:null}),[l,n]=r.useState(!0),{DEFAULT_TIER_DATA:d,FALLBACK_TOKEN_PACKAGES:o}=r.useMemo(()=>({DEFAULT_TIER_DATA:{FREE:{name:"Free",price:0,feeMultiplier:1.2,features:["1 Broadcast Request / month","Cannot list on SeshFx Market"],limits:{broadcastsPerMonth:1,sessionsPerWeek:2,canListMarket:!1,monthlyTokens:0}},BASIC:{name:"Basic",price:4.99,feeMultiplier:1.1,features:["3 Broadcast Requests / month","10 Booked Sessions / week","Can list on SeshFx Market (5 items)"],limits:{broadcastsPerMonth:3,sessionsPerWeek:10,canListMarket:!0,monthlyTokens:25}},PRO:{name:"Pro Creative",price:14.99,feeMultiplier:1.02,features:["15 Broadcast Requests / month","Unlimited Booked Sessions","Profile Search Boost"],limits:{broadcastsPerMonth:15,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}},STUDIO:{name:"Studio Business",price:29.99,feeMultiplier:1,features:["Studio Manager Component Access","Unlimited Broadcast Requests","0% Session Fees"],limits:{broadcastsPerMonth:999,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}}},FALLBACK_TOKEN_PACKAGES:[{id:"pack_small",tokens:100,price:4.99,label:"Starter Stash"},{id:"pack_medium",tokens:550,price:19.99,label:"Producer Pack",highlight:!0},{id:"pack_large",tokens:1200,price:39.99,label:"Studio Vault"}]}),[]);r.useEffect(()=>{const b=Q(O,"artifacts",re,"public","config","subscriptions","tier_config"),x=fe(b,u=>{let i=u.exists()?u.data():{};const p=Object.keys(d).reduce((c,y)=>(c[y]={...d[y],...i[y]},c),{});s(c=>({...c,tierData:p}))}),g=Q(O,"artifacts",re,"public","config","subscriptions","token_packages"),m=fe(g,u=>{let i=u.exists()?Object.values(u.data()):o;(!Array.isArray(i)||i.length===0)&&(i=o),s(p=>({...p,tokenPackages:i}))});return n(!1),()=>{x(),m()}},[d,o]);const a=b=>{var g,m;const x=((g=t.tierData)==null?void 0:g[b])||((m=t.tierData)==null?void 0:m.FREE);return x?x.feeMultiplier:d.FREE.feeMultiplier};return{tierData:t.tierData||d,tokenPackages:t.tokenPackages||o,loading:l,getFeeMultiplier:a}},Ui=async t=>{throw t<=0?new Error("No funds available to cash out."):new Error("Payout functionality is temporarily unavailable. Firebase Functions service is not configured.")};function Vi({user:t,userData:s}){var E;const[l,n]=r.useState("store"),[d,o]=r.useState({balance:0,escrowBalance:0,payoutBalance:0}),[a,b]=r.useState(!1),{tierData:x,tokenPackages:g,loading:m}=Wi(),u=(s==null?void 0:s.currentTier)||Hl.FREE,i=(E=s==null?void 0:s.accountTypes)==null?void 0:E.some(C=>["Artist","Musician","Producer","Engineer","Studio","Composer","Technician","Label","Agent"].includes(C));r.useEffect(()=>{if(!(t!=null&&t.uid))return;const C=fe(Q(O,te(t.uid).userWallet),h=>{if(h.exists()){const f=h.data();o({balance:f.balance||0,escrowBalance:f.escrowBalance||0,payoutBalance:f.payoutBalance||0})}});return()=>C()},[t.uid]);const p=async(C,h="payment")=>{b(!0);try{throw new Error("Checkout functionality is temporarily unavailable. Firebase Functions service is not configured.")}catch(f){console.error("Checkout Error:",f),alert(`Checkout failed: ${f.message}`)}finally{b(!1)}},c=C=>{if(!C.stripePriceId)return alert("Configuration Error: This package is missing a Stripe Price ID.");p(C.stripePriceId,"payment")},y=C=>{if(!C.stripePriceId)return alert("Configuration Error: This plan is missing a Stripe Price ID.");p(C.stripePriceId,"subscription")},N=async()=>{if(i){if(d.payoutBalance<=0)return alert("No funds available for cash out.");if(window.confirm(`Cash out $${d.payoutBalance.toFixed(2)} to your connected account?`)){b(!0);try{await Ui(d.payoutBalance),alert("Cash out initiated! Funds should arrive in your bank account shortly.")}catch(C){alert(C.message)}finally{b(!1)}}}},j=Object.values(x).sort((C,h)=>C.id===u?-1:h.id===u?1:C.price-h.price),k=C=>{const h=(C-1)*100;return h>0?`+${h.toFixed(0)}% Service Fee`:h===0?"0% Service Fee":`-${Math.abs(h).toFixed(0)}% Fee (Discount)`};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 pb-24",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx($e,{size:32,className:"text-green-500"})," My Wallet"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage tokens, subscriptions, and earnings."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-500/10 rounded-full",children:e.jsx(Oe,{fill:"currentColor",className:"text-yellow-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Spending Tokens"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:[d.balance.toLocaleString()," TK"]})]})]}),i&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-full",children:e.jsx($e,{className:"text-green-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Available USD"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:["$",d.payoutBalance.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 border-b dark:border-gray-700 mb-8 overflow-x-auto",children:[e.jsx("button",{onClick:()=>n("store"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${l==="store"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Token Store"}),e.jsx("button",{onClick:()=>n("plans"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${l==="plans"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Membership Plans"}),i&&e.jsx("button",{onClick:()=>n("earnings"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${l==="earnings"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Earnings & Escrow"})]}),l==="store"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-blue to-purple-600 rounded-2xl p-8 text-white shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10 max-w-lg",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Power Up Your Creativity"}),e.jsx("p",{className:"opacity-90 mb-6",children:"Use tokens to buy beats, presets, booking requests, and more on the SeshFx Marketplace."})]}),e.jsx(Oe,{size:200,className:"absolute -right-10 -bottom-20 text-white opacity-10 rotate-12 pointer-events-none"})]}),m?e.jsx("div",{className:"text-center py-20",children:e.jsx(oe,{className:"animate-spin text-brand-blue mx-auto",size:32})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:g.map(C=>e.jsxs("div",{className:`relative bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border transition-all duration-200 hover:-translate-y-1 hover:shadow-xl ${C.highlight?"border-yellow-500 ring-2 ring-yellow-500/20":"dark:border-gray-700"}`,children:[C.highlight&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-yellow-500 text-black text-[10px] font-extrabold px-3 py-1 rounded-full tracking-wide shadow-sm",children:"BEST VALUE"}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-widest mb-2",children:C.label}),e.jsxs("div",{className:"text-5xl font-extrabold dark:text-white flex items-center justify-center gap-1",children:[C.tokens,e.jsx("span",{className:"text-lg font-medium text-gray-400",children:"TK"})]})]}),e.jsx("button",{onClick:()=>c(C),disabled:a,className:`w-full py-3 rounded-xl font-bold flex justify-center items-center gap-2 transition-all ${C.highlight?"bg-yellow-500 text-black hover:bg-yellow-400":"bg-gray-900 dark:bg-white text-white dark:text-black hover:opacity-90"}`,children:a?e.jsx(oe,{className:"animate-spin",size:18}):`Buy for $${C.price}`})]},C.id))})]}),l==="plans"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"text-center max-w-2xl mx-auto mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold dark:text-white mb-2",children:"Upgrade Your Workflow"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Unlock lower fees, unlimited bookings, and premium visibility."})]}),m?e.jsx("div",{className:"text-center py-10",children:e.jsx(oe,{className:"animate-spin text-brand-blue mx-auto",size:24})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:j.map(C=>{const h=C.id===u;return e.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border flex flex-col ${h?"border-brand-blue ring-1 ring-brand-blue":"dark:border-gray-700"} shadow-sm`,children:[h&&e.jsxs("div",{className:"text-xs font-bold text-brand-blue uppercase tracking-wide mb-2 flex items-center gap-1",children:[e.jsx(et,{size:12,fill:"currentColor"})," Current Plan"]}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:C.name}),e.jsxs("div",{className:"text-3xl font-extrabold mb-6 dark:text-white",children:["$",C.price,e.jsx("span",{className:"text-sm font-normal text-gray-500",children:"/mo"})]}),e.jsxs("div",{className:"space-y-3 mb-8 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-gray-700 dark:text-gray-200",children:[e.jsx($e,{size:16,className:C.feeMultiplier<=1?"text-green-500":"text-gray-400"}),k(C.feeMultiplier)]}),C.features.map((f,R)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx(Ge,{size:14,className:"text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:f})]},R))]}),e.jsx("button",{onClick:()=>y(C),className:`w-full py-2.5 rounded-lg font-bold text-sm transition-colors mt-auto ${h?"bg-gray-100 dark:bg-gray-700 text-gray-400 cursor-default":"bg-brand-blue text-white hover:bg-blue-600 shadow-lg shadow-blue-500/20"}`,disabled:h||a,children:h?"Active":a?e.jsx(oe,{className:"animate-spin mx-auto"}):"Upgrade"})]},C.id)})})]}),l==="earnings"&&i&&e.jsx("div",{className:"space-y-6 animate-in fade-in duration-300",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg",children:e.jsx(gt,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Escrow Balance"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Funds held for active sessions"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold dark:text-white mb-4",children:["$",d.escrowBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("div",{className:"text-xs bg-orange-50 dark:bg-orange-900/10 text-orange-700 dark:text-orange-300 p-3 rounded-lg flex items-start gap-2",children:[e.jsx(st,{size:14,className:"mt-0.5 shrink-0"}),' Funds are released to "Available" 24 hours after a session is successfully completed.']})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border border-green-500/30 shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg",children:e.jsx($e,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Available for Payout"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Cleared funds ready to transfer"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold text-green-600 dark:text-green-400 mb-6",children:["$",d.payoutBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx("button",{onClick:N,disabled:a||d.payoutBalance<=0,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-green-500/30 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:shadow-none",children:a?e.jsx(oe,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:["Cash Out Now ",e.jsx(At,{size:20})]})}),e.jsx("div",{className:"text-[10px] text-center text-gray-400 mt-3",children:"Transfers handled securely via Stripe Connect."})]})]})})]})}function Gi({user:t}){const[s,l]=r.useState([]),[n,d]=r.useState(""),[o,a]=r.useState([]),[b,x]=r.useState(!1),[g,m]=r.useState("list");r.useEffect(()=>{if(!(t!=null&&t.uid))return;const c=le(O,te(t.uid).labelRoster(t.uid)),y=fe(c,N=>{l(N.docs.map(j=>({id:j.id,...j.data()})))});return()=>y()},[t==null?void 0:t.uid]);const u=async()=>{if(!(n.length<3)){x(!0);try{const c=ye(ls(O,"public_profile"),Ce("searchTerms","array-contains",n.toLowerCase())),N=(await Xe(c)).docs.map(j=>({id:j.ref.parent.parent.id,...j.data()})).filter(j=>j.id!==t.uid&&!s.some(k=>k.artistId===j.id));a(N)}catch(c){console.error("Search failed:",c)}x(!1)}},i=async c=>{try{await we(le(O,te(t.uid).labelRoster(t.uid)),{artistId:c.id,name:`${c.firstName} ${c.lastName}`,email:c.email||"N/A",photoURL:c.photoURL||null,signedAt:ue(),status:"Active"}),alert(`Signed ${c.firstName} to roster!`),d(""),a([]),m("list")}catch(y){console.error("Signing failed:",y),alert("Failed to add artist.")}},p=async(c,y)=>{if(confirm(`Release ${y} from your roster?`))try{await ft(Q(O,te(t.uid).labelRoster(t.uid),c))}catch(N){console.error(N)}};return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-in fade-in pb-20",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Pe,{className:"text-purple-600"})," Label Management"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your artist roster and bookings."})]}),e.jsx("button",{onClick:()=>m(g==="list"?"search":"list"),className:"bg-purple-600 text-white px-5 py-2.5 rounded-xl font-bold hover:bg-purple-700 transition flex items-center gap-2",children:g==="list"?e.jsxs(e.Fragment,{children:[e.jsx(St,{size:18})," Sign Artist"]}):"Back to Roster"})]}),g==="search"&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm animate-in slide-in-from-top-4",children:[e.jsx("h3",{className:"font-bold dark:text-white mb-4",children:"Find Talent"}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Be,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsx("input",{className:"w-full pl-10 p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-purple-500 outline-none",placeholder:"Search by name...",value:n,onChange:c=>d(c.target.value),onKeyDown:c=>c.key==="Enter"&&u()})]}),e.jsx("button",{onClick:u,disabled:b,className:"bg-gray-900 dark:bg-white dark:text-black text-white px-6 rounded-xl font-bold",children:b?"...":"Search"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[o.map(c=>{var y;return e.jsxs("div",{className:"p-4 border dark:border-gray-700 rounded-xl flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:c.photoURL?e.jsx("img",{src:c.photoURL,className:"h-full w-full object-cover"}):e.jsx(qe,{className:"m-2 text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold dark:text-white text-sm",children:[c.firstName," ",c.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:((y=c.accountTypes)==null?void 0:y[0])||"User"})]})]}),e.jsx("button",{onClick:()=>i(c),className:"text-xs bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 px-3 py-1.5 rounded-lg font-bold hover:bg-purple-200",children:"Sign"})]},c.id)}),o.length===0&&n&&!b&&e.jsx("div",{className:"col-span-full text-center text-gray-500 text-sm",children:"No artists found."})]})]}),g==="list"&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-[#23262f] border-b dark:border-gray-700 flex justify-between items-center",children:e.jsxs("span",{className:"font-bold text-sm text-gray-500 uppercase tracking-wide",children:["Current Roster (",s.length,")"]})}),s.length===0?e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx(Fe,{size:48,className:"mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No artists signed yet."})]}):e.jsx("div",{className:"divide-y dark:divide-gray-700",children:s.map(c=>{var y;return e.jsxs("div",{className:"p-5 hover:bg-gray-50 dark:hover:bg-white/5 transition flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center text-indigo-600 font-bold text-lg overflow-hidden",children:c.photoURL?e.jsx("img",{src:c.photoURL,className:"h-full w-full object-cover"}):c.name[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:c.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Signed: ",(y=c.signedAt)!=null&&y.toDate?c.signedAt.toDate().toLocaleDateString():"Recent"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 px-2 py-1 rounded text-xs font-bold",children:c.status}),e.jsx("button",{onClick:()=>p(c.id,c.name),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Release Artist",children:e.jsx(_e,{size:18})})]})]},c.id)})})]})]})}const Yi=({data:t,setData:s})=>e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-4",children:"Release Essentials"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Title"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.title,onChange:l=>s({...t,title:l.target.value}),placeholder:"e.g. Dark Side of the Moon"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Artist"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.primaryArtist,onChange:l=>s({...t,primaryArtist:l.target.value}),placeholder:"e.g. Pink Floyd"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Type"}),e.jsx("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.type,onChange:l=>s({...t,type:l.target.value}),children:Wl.map(l=>e.jsx("option",{value:l.id,children:l.label},l.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Genre"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.genre,onChange:l=>s({...t,genre:l.target.value}),children:[e.jsx("option",{value:"",children:"Select Genre..."}),Ul.map(l=>e.jsx("option",{value:l,children:l},l))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Date"}),e.jsx("input",{type:"date",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.releaseDate,onChange:l=>s({...t,releaseDate:l.target.value})}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Standard: 2 weeks out. Express: 48hrs."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Label Name"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.labelName,onChange:l=>s({...t,labelName:l.target.value}),placeholder:"Optional (Default: Independent)"})]})]})]}),Zi=({data:t,setData:s,user:l})=>{const{uploadMedia:n,uploading:d}=it(),[o,a]=r.useState(t.artworkUrl||null),[b,x]=r.useState(""),g=async m=>{const u=m.target.files[0];if(!u)return;const i=new Image;i.src=URL.createObjectURL(u),i.onload=async()=>{if(i.width<3e3||i.height<3e3){x("Error: Image must be at least 3000 x 3000 pixels.");return}i.width!==i.height?x("Warning: Image should be a perfect square (1:1 ratio)."):x("");const p=await n(u,`distribution/${l.uid}/artwork`);p!=null&&p.url&&(a(p.url),s({...t,artworkUrl:p.url}))}};return e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 animate-in slide-in-from-right-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Cover Art"}),e.jsx("p",{className:"text-sm text-gray-500",children:"3000 x 3000 px • JPG or PNG • No Blurry Text"})]}),e.jsxs("div",{className:"relative group w-64 h-64 bg-gray-100 dark:bg-[#1f2128] rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center overflow-hidden",children:[o?e.jsx("img",{src:o,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"text-gray-400 flex flex-col items-center",children:[e.jsx(Lt,{size:48,className:"mb-2"}),e.jsx("span",{className:"text-xs font-bold",children:"Click to Upload"})]}),e.jsxs("label",{className:"absolute inset-0 cursor-pointer bg-black/0 hover:bg-black/20 transition flex items-center justify-center",children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/png, image/jpeg",onChange:g,disabled:d}),d&&e.jsx(oe,{className:"animate-spin text-white",size:32})]})]}),b&&e.jsxs("div",{className:"text-red-500 text-sm font-bold flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[e.jsx(st,{size:16})," ",b]})]})},Ki=({data:t,setData:s,user:l})=>{var x,g;const{uploadMedia:n,uploading:d}=it(),o=async m=>{if(!m.name.toLowerCase().endsWith(".wav")){alert("Only .WAV files are accepted for distribution.");return}const u={id:Date.now(),title:m.name.replace(".wav",""),fileUrl:"",status:"uploading",isExplicit:!1,isInstrumental:!1},i=[...t.tracks||[],u];s({...t,tracks:i});try{const p=await n(m,`distribution/${l.uid}/audio_vault`);if(p!=null&&p.url){const c=i.map(y=>y.id===u.id?{...y,fileUrl:p.url,status:"ready",duration:0}:y);s({...t,tracks:c})}}catch(p){console.error("Track upload failed",p),alert("Upload failed.")}},a=m=>{s({...t,tracks:t.tracks.filter(u=>u.id!==m)})},b=(m,u,i)=>{s({...t,tracks:t.tracks.map(p=>p.id===m?{...p,[u]:i}:p)})};return e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Audio"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Stereo WAV files only (16-bit / 44.1kHz minimum)"})]}),e.jsxs("label",{className:"bg-brand-blue hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs cursor-pointer flex items-center gap-2 transition",children:[e.jsx(Tt,{size:14})," Add Track",e.jsx("input",{type:"file",className:"hidden",accept:".wav",onChange:m=>o(m.target.files[0]),disabled:d})]})]}),e.jsxs("div",{className:"space-y-3",children:[((x=t.tracks)==null?void 0:x.length)===0&&e.jsx("div",{className:"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400",children:"No tracks added yet."}),(g=t.tracks)==null?void 0:g.map((m,u)=>e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded text-gray-500 font-mono text-xs",children:["#",u+1]}),e.jsx("div",{className:"font-bold dark:text-white text-sm",children:m.status==="uploading"?e.jsxs("span",{className:"flex items-center gap-2 text-brand-blue",children:[e.jsx(oe,{className:"animate-spin",size:14})," Uploading..."]}):m.title})]}),e.jsx("button",{onClick:()=>a(m.id),className:"text-gray-400 hover:text-red-500",children:e.jsx(pe,{size:16})})]}),m.status==="ready"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("input",{className:"col-span-2 p-2 text-xs border rounded bg-transparent dark:border-gray-600 dark:text-white",placeholder:"Track Title",value:m.title,onChange:i=>b(m.id,"title",i.target.value)}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.isExplicit,onChange:i=>b(m.id,"isExplicit",i.target.checked)})," Explicit"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.isInstrumental,onChange:i=>b(m.id,"isInstrumental",i.target.checked)})," Instrumental"]})]})]},m.id))]})]})},Xi=({data:t,setData:s})=>{var d;const l=o=>{const a=t.stores||[],b=a.includes(o)?a.filter(x=>x!==o):[...a,o];s({...t,stores:b})},n=()=>{var o;((o=t.stores)==null?void 0:o.length)===Et.length?s({...t,stores:[]}):s({...t,stores:Et.map(a=>a.id)})};return e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Select Stores"}),e.jsx("button",{onClick:n,className:"text-xs font-bold text-brand-blue hover:underline",children:((d=t.stores)==null?void 0:d.length)===Et.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Et.map(o=>{var b;const a=(b=t.stores)==null?void 0:b.includes(o.id);return e.jsxs("div",{onClick:()=>l(o.id),className:`p-3 rounded-xl border flex items-center gap-3 cursor-pointer transition-all ${a?"bg-blue-50 border-brand-blue dark:bg-blue-900/20":"bg-white dark:bg-[#1f2128] dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${a?"bg-brand-blue border-brand-blue":"border-gray-400"}`,children:a&&e.jsx(ve,{size:12,className:"text-white"})}),e.jsx("span",{className:`text-sm font-bold ${a?"text-brand-blue dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:o.name})]},o.id)})}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/10 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800 text-sm text-yellow-800 dark:text-yellow-200 flex items-start gap-3",children:[e.jsx(Os,{size:18,className:"mt-0.5 shrink-0"}),e.jsx("p",{children:"Deliveries usually take 2-5 days for Spotify/Apple, and up to 2 weeks for other stores. Please plan your release date accordingly."})]})]})};function Qi({user:t,userData:s,initialData:l,onCancel:n,onSuccess:d}){const[o,a]=r.useState(1),[b,x]=r.useState(!1),[g,m]=r.useState(l||{title:"",primaryArtist:`${s.firstName} ${s.lastName}`,type:"single",genre:"",releaseDate:"",labelName:"",artworkUrl:"",tracks:[],stores:Et.map(p=>p.id),status:"Draft"}),u=()=>o===1?g.title&&g.primaryArtist&&g.genre&&g.releaseDate:o===2?!!g.artworkUrl:o===3?g.tracks.length>0&&g.tracks.every(p=>p.status==="ready"):o===4?g.stores.length>0:!0,i=async()=>{x(!0);try{const p={...g,uploaderId:t.uid,updatedAt:ue(),status:"Processing"};l!=null&&l.id?await be(Q(O,te(t.uid).distributionReleases,l.id),p):await we(le(O,te(t.uid).distributionReleases),{...p,createdAt:ue()}),alert("Release submitted successfully! It is now in the review queue."),d()}catch(p){console.error("Submission error:",p),alert("Failed to submit release.")}x(!1)};return e.jsxs("div",{className:"max-w-4xl mx-auto bg-white dark:bg-[#2c2e36] rounded-2xl shadow-xl overflow-hidden border dark:border-gray-700 min-h-[600px] flex flex-col",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-6 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-extrabold dark:text-white",children:"New Release"}),e.jsxs("p",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mt-1",children:["Step ",o," of 4"]})]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white",children:e.jsx(pe,{})})]}),e.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700 w-full",children:e.jsx("div",{className:"h-full bg-brand-blue transition-all duration-300",style:{width:`${o/4*100}%`}})}),e.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[o===1&&e.jsx(Yi,{data:g,setData:m}),o===2&&e.jsx(Zi,{data:g,setData:m,user:t}),o===3&&e.jsx(Ki,{data:g,setData:m,user:t}),o===4&&e.jsx(Xi,{data:g,setData:m})]}),e.jsxs("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[o>1?e.jsxs("button",{onClick:()=>a(o-1),className:"flex items-center gap-2 text-gray-500 font-bold hover:text-gray-800 dark:hover:text-white transition",children:[e.jsx(rs,{size:18})," Back"]}):e.jsx("div",{}),o<4?e.jsxs("button",{onClick:()=>a(o+1),disabled:!u(),className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-600 transition",children:["Next Step ",e.jsx(Ke,{size:18})]}):e.jsx("button",{onClick:i,disabled:b||!u(),className:"bg-green-600 text-white px-8 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 hover:bg-green-700 transition shadow-lg",children:b?e.jsx(oe,{className:"animate-spin"}):"Submit Release"})]})]})}function Ji({user:t,userData:s}){const[l,n]=r.useState("list"),[d,o]=r.useState([]),[a,b]=r.useState(!0),[x,g]=r.useState(null);r.useEffect(()=>{if(!(t!=null&&t.uid))return;const i=ye(le(O,te(t.uid).distributionReleases),Ce("uploaderId","==",t.uid),Ae("updatedAt","desc")),p=fe(i,c=>{o(c.docs.map(y=>({id:y.id,...y.data()}))),b(!1)});return()=>p()},[t==null?void 0:t.uid]);const m=async(i,p)=>{if(confirm(`Are you sure you want to delete "${p}"? This cannot be undone if already distributed.`))try{await ft(Q(O,te(t.uid).distributionReleases,i))}catch(c){console.error(c),alert("Failed to delete release.")}},u=i=>{if(i.status!=="Draft"&&i.status!=="Action Needed")return alert("Cannot edit a release that is currently processing or live. Contact support for takedowns.");g(i),n("create")};return l==="create"?e.jsx(Qi,{user:t,userData:s,initialData:x,onCancel:()=>{n("list"),g(null)},onSuccess:()=>{n("list"),g(null)}}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ut,{className:"text-brand-blue"})," Distribution Portal"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your catalog across Spotify, Apple Music, and 150+ stores."})]}),e.jsxs("button",{onClick:()=>n("create"),className:"bg-brand-blue text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 shadow-lg hover:shadow-blue-500/20",children:[e.jsx(nt,{size:20})," New Release"]})]}),e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 overflow-hidden min-h-[400px]",children:a?e.jsx("div",{className:"p-12 text-center text-gray-500",children:"Loading catalog..."}):d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4",children:e.jsx(Bs,{size:48,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"No Releases Yet"}),e.jsx("p",{className:"text-gray-500 max-w-sm mt-2 mb-6",children:"Start your journey by uploading your first single, EP, or album to the world."}),e.jsx("button",{onClick:()=>n("create"),className:"text-brand-blue font-bold hover:underline",children:"Create First Release"})]}):e.jsx("div",{className:"divide-y dark:divide-gray-700",children:d.map(i=>{var p;return e.jsxs("div",{className:"p-5 hover:bg-gray-50 dark:hover:bg-white/5 transition flex flex-col md:flex-row md:items-center justify-between gap-4 group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 bg-gray-200 dark:bg-black rounded-lg shadow-sm overflow-hidden shrink-0 border dark:border-gray-700",children:i.artworkUrl?e.jsx("img",{src:i.artworkUrl,alt:"Art",className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:e.jsx(lt,{size:20})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide border ${i.status==="Live"?"bg-green-100 text-green-700 border-green-200":i.status==="Processing"?"bg-blue-100 text-blue-700 border-blue-200":i.status==="Action Needed"?"bg-red-100 text-red-700 border-red-200":"bg-gray-100 text-gray-600 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600"}`,children:i.status}),e.jsx("span",{className:"text-xs text-gray-400 uppercase font-bold",children:i.type})]}),e.jsx("h4",{className:"font-bold text-lg dark:text-white leading-tight",children:i.title||"Untitled Release"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[i.primaryArtist," • ",((p=i.tracks)==null?void 0:p.length)||0," Tracks"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pl-4 md:pl-0 border-l md:border-l-0 dark:border-gray-700",children:[e.jsxs("div",{className:"text-right hidden md:block mr-4",children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase font-bold",children:"Release Date"}),e.jsx("div",{className:"text-sm font-medium dark:text-gray-200",children:i.releaseDate?new Date(i.releaseDate).toLocaleDateString():"TBD"})]}),e.jsx("button",{onClick:()=>u(i),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit / View Details",children:e.jsx(as,{size:18})}),(i.status==="Draft"||i.status==="Action Needed")&&e.jsx("button",{onClick:()=>m(i.id,i.title),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete Release",children:e.jsx(_e,{size:18})})]})]},i.id)})})})]})}function Di({user:t,userData:s}){var i,p,c,y,N;const[l,n]=r.useState("overview"),d=(i=s==null?void 0:s.accountTypes)==null?void 0:i.includes("Studio"),o=(p=s==null?void 0:s.accountTypes)==null?void 0:p.some(j=>["Label","Agent"].includes(j)),a=(c=s==null?void 0:s.accountTypes)==null?void 0:c.some(j=>["Artist","Producer","Engineer","DJ"].includes(j)),b=d||o||a,x=[{id:"overview",label:"Overview",icon:e.jsx(rt,{size:18}),available:!0},{id:"studio",label:"Studio Ops",icon:e.jsx(Ye,{size:18}),available:d,description:"Manage rooms, rates & amenities"},{id:"distribution",label:"Distribution",icon:e.jsx(Ut,{size:18}),available:b,description:"Release music to streaming platforms"},{id:"roster",label:"Artist Roster",icon:e.jsx(Fe,{size:18}),available:o,description:"Manage your signed artists"}].filter(j=>j.available),g=[{label:"Account Type",value:((y=s==null?void 0:s.accountTypes)==null?void 0:y.join(", "))||"User",icon:e.jsx(el,{size:16})},{label:"Studio Rooms",value:((N=s==null?void 0:s.rooms)==null?void 0:N.length)||0,icon:e.jsx(Ye,{size:16}),show:d},{label:"Releases",value:"—",icon:e.jsx(tl,{size:16}),show:b},{label:"Roster Artists",value:"—",icon:e.jsx(Fe,{size:16}),show:o}].filter(j=>j.show!==!1),m=[{id:"studio",title:"Studio Settings",description:"Configure your studio rooms, rates, and amenities",icon:e.jsx(Ye,{className:"text-blue-500"}),color:"blue",show:d},{id:"distribution",title:"New Release",description:"Distribute your music to 150+ streaming platforms",icon:e.jsx(Ut,{className:"text-green-500"}),color:"green",show:b},{id:"roster",title:"Manage Roster",description:"Sign artists and manage your label roster",icon:e.jsx(Fe,{className:"text-purple-500"}),color:"purple",show:o}].filter(j=>j.show),u=()=>{switch(l){case"studio":return e.jsx(Ri,{user:t,userData:s});case"distribution":return e.jsx(Ji,{user:t,userData:s});case"roster":return e.jsx(Gi,{user:t,userData:s});case"overview":default:return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-8 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Business Center"}),e.jsx("p",{className:"text-indigo-100 max-w-xl",children:"Manage your studio operations, distribute music, and grow your roster — all in one place."})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:g.map((j,k)=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-2",children:[j.icon,e.jsx("span",{className:"text-xs font-bold uppercase tracking-wide",children:j.label})]}),e.jsx("div",{className:"text-2xl font-bold dark:text-white",children:j.value})]},k))}),m.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(sl,{size:20,className:"text-gray-400"}),"Quick Actions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:m.map(j=>e.jsxs("button",{onClick:()=>n(j.id),className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all text-left group hover:border-brand-blue dark:hover:border-brand-blue",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-${j.color}-50 dark:bg-${j.color}-900/20 flex items-center justify-center mb-4`,children:j.icon}),e.jsxs("h3",{className:"font-bold dark:text-white mb-1 flex items-center gap-2",children:[j.title,e.jsx(Ke,{size:16,className:"text-gray-400 group-hover:text-brand-blue group-hover:translate-x-1 transition-all"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:j.description})]},j.id))})]}),m.length===0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(rt,{size:32,className:"text-gray-400"})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"No Business Features Enabled"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Upgrade your account to access studio management, music distribution, and label features."}),e.jsx("p",{className:"text-sm text-gray-400",children:'Update your profile to add "Studio", "Artist", "Label", or "Agent" account types.'})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] rounded-xl p-6 border dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(al,{size:18,className:"text-brand-blue"}),"Coming Soon"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-blue"}),"Advanced Analytics Dashboard"]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-blue"}),"Royalty Management & Splits"]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-blue"}),"Contract Templates"]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-blue"}),"Multi-Artist Collaboration Tools"]})]})]})]})}};return e.jsxs("div",{className:"max-w-7xl mx-auto pb-20",children:[e.jsx("div",{className:"mb-6 bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-1.5 flex flex-wrap gap-1 shadow-sm sticky top-0 z-10",children:x.map(j=>e.jsxs("button",{onClick:()=>n(j.id),className:`
                            flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all
                            ${l===j.id?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}
                        `,children:[j.icon,e.jsx("span",{className:"hidden sm:inline",children:j.label})]},j.id))}),u()]})}function ha({user:t,userData:s}){var n;switch(((n=s==null?void 0:s.accountTypes)==null?void 0:n.find(d=>["Admin","Instructor","Intern"].includes(d)))||"Student"){case"Admin":return e.jsx(Kl,{user:t,userData:s},`admin-${t==null?void 0:t.uid}`);case"Instructor":return e.jsx(Zl,{user:t,userData:s},`staff-${t==null?void 0:t.uid}`);case"Intern":return e.jsx(Yl,{user:t,userData:s},`intern-${t==null?void 0:t.uid}`);default:return e.jsx(Gl,{user:t,userData:s},`student-${t==null?void 0:t.uid}`)}}function eo({user:t,userData:s,subProfiles:l,tokenBalance:n,setActiveTab:d,handleLogout:o,openPublicProfile:a,pendingChatTarget:b,clearPendingChatTarget:x}){return e.jsxs(rl,{children:[e.jsx(ze,{path:"/",element:e.jsx(En,{user:t,userData:s,subProfiles:l,setActiveTab:d,tokenBalance:n})}),e.jsx(ze,{path:"/dashboard",element:e.jsx(ot,{to:"/",replace:!0})}),e.jsx(ze,{path:"/home",element:e.jsx(ot,{to:"/",replace:!0})}),e.jsx(ze,{path:"/feed",element:e.jsx(On,{user:t,userData:s,openPublicProfile:a})}),e.jsx(ze,{path:"/social",element:e.jsx(ot,{to:"/feed",replace:!0})}),e.jsx(ze,{path:"/bookings",element:e.jsx(Dn,{user:t,userData:s,openPublicProfile:a})}),e.jsx(ze,{path:"/find-talent",element:e.jsx(ot,{to:"/bookings",replace:!0})}),e.jsx(ze,{path:"/marketplace",element:e.jsx(mi,{user:t,userData:s,tokenBalance:n})}),e.jsx(ze,{path:"/messages",element:e.jsx(ui,{user:t,userData:s,openPublicProfile:a,pendingChatTarget:b,clearPendingChatTarget:x})}),e.jsx(ze,{path:"/tech",element:e.jsx(Hi,{user:t,userData:s})}),e.jsx(ze,{path:"/business-center",element:e.jsx(Di,{user:t,userData:s})}),e.jsx(ze,{path:"/studio-ops",element:e.jsx(ot,{to:"/business-center",replace:!0})}),e.jsx(ze,{path:"/studio-manager",element:e.jsx(ot,{to:"/business-center",replace:!0})}),e.jsx(ze,{path:"/label-manager",element:e.jsx(ot,{to:"/business-center",replace:!0})}),e.jsx(ze,{path:"/payments",element:e.jsx(Vi,{user:t,userData:s})}),e.jsx(ze,{path:"/profile",element:e.jsx($i,{user:t,userData:s,subProfiles:l,handleLogout:o})}),e.jsx(ze,{path:"/settings",element:e.jsx(rr,{user:t,userData:s,handleLogout:o})}),e.jsx(ze,{path:"/legal",element:e.jsx(Za,{})}),e.jsx(ze,{path:"/edu",element:e.jsx(ha,{user:t,userData:s})}),e.jsx(ze,{path:"/edu/enroll",element:e.jsx(Vl,{user:t,userData:s})}),e.jsx(ze,{path:"/edu/:view",element:e.jsx(ha,{user:t,userData:s})}),e.jsx(ze,{path:"*",element:e.jsx(ot,{to:"/",replace:!0})})]})}function to({children:t,className:s=""}){return e.jsx("div",{className:`module-fade-in ${s}`,children:t})}let hs=null,pa=!1;const so=async()=>hs!==null?hs:(pa||(pa=!0,hs=!1),null),ao=(t,s={},l={})=>{const n={message:(t==null?void 0:t.message)||"Unknown error",stack:t==null?void 0:t.stack,name:t==null?void 0:t.name,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...s,context:l};so().then(d=>{d&&d.captureException&&d.captureException(t,{extra:n,tags:{component:l.component||"Unknown",errorBoundary:l.errorBoundary||"None"},contexts:{custom:l}})}).catch(()=>{});try{const d=JSON.parse(localStorage.getItem("seshnx_errors")||"[]");d.unshift(n),d.splice(10),localStorage.setItem("seshnx_errors",JSON.stringify(d))}catch{}return n};class ro extends Fs.Component{constructor(l){super(l);cs(this,"handleReset",()=>{if(this.setState({hasError:!1,error:null,errorInfo:null,errorId:null,copied:!1}),this.props.onReset)this.props.onReset();else{const l=window.location.pathname;l!=="/"&&l!=="/dashboard"?window.location.href="/?tab=dashboard":window.location.reload()}});cs(this,"handleCopyError",async()=>{var n,d,o;const l=`
Error ID: ${this.state.errorId}
Message: ${((n=this.state.error)==null?void 0:n.message)||"Unknown error"}
Stack: ${((d=this.state.error)==null?void 0:d.stack)||"No stack trace"}
Component Stack: ${((o=this.state.errorInfo)==null?void 0:o.componentStack)||"No component stack"}
URL: ${window.location.href}
User Agent: ${navigator.userAgent}
Timestamp: ${new Date().toISOString()}
    `.trim();try{await navigator.clipboard.writeText(l),this.setState({copied:!0}),setTimeout(()=>this.setState({copied:!1}),2e3)}catch(a){console.error("Failed to copy error:",a)}});this.state={hasError:!1,error:null,errorInfo:null,meme:"Unexpected signal chain failure.",errorId:null,copied:!1}}static getDerivedStateFromError(l){return{hasError:!0,error:l,errorId:`ERR-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}componentDidCatch(l,n){const d={componentStack:n.componentStack,errorBoundary:this.props.name||"Default",props:this.props.context||{}},o=ao(l,n,d);this.setState({errorInfo:{...n,errorId:this.state.errorId||o.timestamp}})}componentDidMount(){const l=["CoreAudio Overload detected.","The plugin crashed the session.","Buffer underrun exception.","Who deleted the master fader?","Sample rate mismatch: Reality is 44.1k, we are 48k.","The drummer kicked the power cable.","Ilok license not found.","Fatal Error: Not enough headroom.","The mix bus is clipping... hard.","Phantom power failure."];this.setState({meme:l[Math.floor(Math.random()*l.length)]})}render(){var l,n;return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-[#1f2128] flex flex-col items-center justify-center p-4 text-center text-white font-sans",children:e.jsxs("div",{className:"bg-[#2c2e36] border border-red-500/30 p-8 rounded-2xl shadow-2xl max-w-lg w-full relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-32 h-32 bg-red-500/20 blur-[50px] rounded-full pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mb-6 text-red-500",children:e.jsx(ht,{size:32,strokeWidth:2})}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Session Crashed"}),e.jsxs("p",{className:"text-xl text-[#3D84ED] font-medium mb-6 italic",children:['"',this.state.meme,'"']}),e.jsxs("div",{className:"bg-[#1f2128] p-4 rounded-lg w-full mb-6 text-left border border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider",children:"Error Details"}),e.jsx("button",{onClick:this.handleCopyError,className:"text-xs text-gray-400 hover:text-white flex items-center gap-1 transition-colors",title:"Copy error details",children:this.state.copied?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{size:12}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(It,{size:12}),"Copy"]})})]}),e.jsxs("div",{className:"space-y-2",children:[this.state.errorId&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Error ID: "}),e.jsx("code",{className:"text-xs text-blue-400 font-mono",children:this.state.errorId})]}),e.jsx("code",{className:"text-sm text-red-400 font-mono break-words block",children:((l=this.state.error)==null?void 0:l.message)||"Unknown error occurred"}),((n=this.state.error)==null?void 0:n.stack)&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs text-gray-500 cursor-pointer hover:text-gray-400",children:"Stack Trace"}),e.jsx("pre",{className:"text-xs text-gray-400 font-mono mt-2 overflow-auto max-h-32",children:this.state.error.stack})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2",children:"Go Back"}),e.jsxs("button",{onClick:this.handleReset,className:"flex-1 bg-[#3D84ED] hover:bg-blue-600 text-white py-3 px-4 rounded-xl font-bold transition-all shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2",children:[e.jsx(kt,{size:18}),"Reload App"]})]})]})]})}):this.props.children}}function lo(){var T,P,A,F;const[t,s]=r.useState(null),[l,n]=r.useState(null),[d,o]=r.useState({}),[a,b]=r.useState(!0),x=ll(),g=nl(),u=(()=>{const L=g.pathname;return L==="/"||L==="/dashboard"||L==="/home"?"dashboard":L==="/feed"||L==="/social"?"feed":L==="/bookings"||L==="/find-talent"?"bookings":L.startsWith("/edu")?L==="/edu/enroll"?"edu-enroll":"edu-overview":L.substring(1)||"dashboard"})(),i=L=>{const W={dashboard:"/",home:"/",feed:"/feed",social:"/feed",bookings:"/bookings","find-talent":"/bookings",marketplace:"/marketplace",seshfx:"/marketplace?tab=fx",messages:"/messages",tech:"/tech","business-center":"/business-center","studio-ops":"/business-center","studio-manager":"/business-center","label-manager":"/business-center",payments:"/payments",profile:"/profile",settings:"/settings",legal:"/legal","edu-enroll":"/edu/enroll","edu-overview":"/edu"};if(L.startsWith("edu-"))x(L==="edu-enroll"?"/edu/enroll":`/edu/${L.replace("edu-","")}`);else{const Z=W[L]||"/";x(Z)}},[p,c]=r.useState(!1),[y,N]=r.useState(null),[j,k]=r.useState(0),[E,C]=r.useState(null),[h,f]=r.useState(()=>typeof window<"u"?localStorage.getItem("theme")==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches:!1);r.useEffect(()=>{h?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},[h]);const R=()=>f(!h),z=Sl(sa),I=Cl(sa);r.useEffect(()=>{const L=zl(z,async W=>{if(b(!0),W){s(W);const Z=Q(I,`artifacts/${re}/users/${W.uid}/profiles/main`),D=fe(Z,ne=>{ne.exists()?n(ne.data()):n(null)}),Y=Q(I,`artifacts/${re}/users/${W.uid}/wallet/account`),q=fe(Y,ne=>{ne.exists()&&k(ne.data().balance||0)}),J=le(I,`artifacts/${re}/users/${W.uid}/profiles`),ee=fe(J,ne=>{const me={};ne.forEach(_=>{_.id!=="main"&&(me[_.id]=_.data())}),o(me)});return b(!1),()=>{D(),q(),ee()}}else s(null),n(null),o({}),b(!1)});return()=>L()},[]);const S=r.useCallback(()=>_s(z),[z]);r.useEffect(()=>{if(!t)return;const L=30*60*1e3,W=15*60*1e3,Z="seshnx_last_active";localStorage.getItem(Z)||localStorage.setItem(Z,Date.now().toString());const D=()=>{localStorage.setItem(Z,Date.now().toString())},Y=()=>{const _=parseInt(localStorage.getItem(Z)||"0",10),de=Date.now()-_,G=document.hidden?W:L;de>G&&(console.log(`User inactive for ${(de/6e4).toFixed(1)}m (Limit: ${G/6e4}m). Logging out...`),S())},q=["mousedown","mousemove","keydown","scroll","touchstart","click"];let J=0;const ee=()=>{const _=Date.now();_-J>5e3&&(D(),J=_)},ne=()=>{if(!document.hidden){const _=parseInt(localStorage.getItem(Z)||"0",10);Date.now()-_>W?(console.log("Returned after background timeout (>15m). Logging out..."),S()):D()}};q.forEach(_=>window.addEventListener(_,ee)),document.addEventListener("visibilitychange",ne);const me=setInterval(Y,60*1e3);return()=>{q.forEach(_=>window.removeEventListener(_,ee)),document.removeEventListener("visibilitychange",ne),clearInterval(me)}},[t,S]);const w=(L,W)=>N({uid:L,name:W}),v=async L=>{if(t)try{const W=Q(I,`artifacts/${re}/users/${t.uid}/profiles/main`);await be(W,{activeProfileRole:L})}catch(W){console.error("Role switch failed:",W)}};if(a)return e.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]",children:e.jsx(oe,{className:"animate-spin text-brand-blue",size:48})});if(!t)return e.jsx(ra,{darkMode:h,toggleTheme:R});if(t&&!l)return e.jsx(ra,{user:t,isNewUser:!0,darkMode:h,toggleTheme:R});const B=u.startsWith("edu-")&&(((T=l==null?void 0:l.accountTypes)==null?void 0:T.includes("Admin"))||((P=l==null?void 0:l.accountTypes)==null?void 0:P.includes("Instructor")));return e.jsx(Xl,{user:t,userData:l,children:e.jsxs("div",{className:"flex h-screen flex-col bg-gray-50 dark:bg-[#1a1d21] overflow-hidden selection:bg-brand-blue selection:text-white",children:[e.jsx(il,{position:"bottom-right",toastOptions:{style:{background:"#333",color:"#fff"},success:{style:{background:"green"},iconTheme:{primary:"white",secondary:"green"}},error:{style:{background:"red"}}}}),e.jsx(on,{user:t,userData:l,subProfiles:d,onMenuClick:()=>c(!p),setActiveTab:i,activeTab:u,tokenBalance:j,darkMode:h,toggleTheme:R,onRoleSwitch:v,openPublicProfile:w}),e.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[e.jsx("div",{className:`fixed inset-y-0 left-0 z-50 w-64 transform transition-transform duration-300 ease-in-out md:relative md:translate-x-0 ${p?"translate-x-0 shadow-2xl":"-translate-x-full"} bg-white dark:bg-[#23262f] border-r dark:border-gray-800`,children:B?e.jsx(cn,{activeTab:u,setActiveTab:i,sidebarOpen:p,setSidebarOpen:c,isStaff:(A=l.accountTypes)==null?void 0:A.includes("Instructor"),isAdmin:(F=l.accountTypes)==null?void 0:F.includes("Admin")}):e.jsx(dn,{activeTab:u,setActiveTab:i,sidebarOpen:p,setSidebarOpen:c,userData:l,handleLogout:S})}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 scroll-smooth",id:"main-scroll",children:e.jsx(to,{className:"max-w-7xl mx-auto",children:e.jsx(eo,{user:t,userData:l,subProfiles:d,tokenBalance:j,setActiveTab:i,handleLogout:S,openPublicProfile:w,pendingChatTarget:E,clearPendingChatTarget:()=>C(null)})},g.pathname)})]}),e.jsx(Ve,{children:y&&e.jsx(wn,{userId:y.uid,currentUser:t,currentUserData:l,onClose:()=>N(null),onMessage:(L,W)=>{N(null),C({uid:L,name:W}),i("messages")}})})]})})}ol.createRoot(document.getElementById("root")).render(e.jsx(ro,{name:"Root",children:e.jsx(dl,{client:Ll,children:e.jsx(cl,{children:e.jsx(lo,{})})})}));const no=()=>{const t=document.getElementById("loading-fallback");t&&(t.classList.add("fade-out"),setTimeout(()=>{t&&t.parentNode&&t.parentNode.removeChild(t),document.body.style.overflow="auto"},400))};setTimeout(no,600);
