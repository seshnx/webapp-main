import{r as d,j as e,a0 as D,X as ve,L as le,a1 as $e,a2 as Y,S as se,h as ae,x as ue,U as Ne,W as ge,a3 as we,J as Se,a4 as Ce,H as ze,a5 as Me,T as q,a6 as Fe,D as Oe,a7 as Ue,a8 as Ae,a9 as re,P as J,m as Be,aa as De,$ as Ee,ab as Ge,y as He,a as Re,ac as pe,E as Ve,g as We,ad as de,ae as Ye,af as Le,ag as qe,F as Pe,ah as Je,ai as Ke,aj as Xe,ak as Qe,al as be,am as ye,an as Ze}from"./vendor-WZj-fqSa.js";import{D as Q,C as P,I as et,q as M,E as R,w as G,k as T,G as z,J as B,K as O,F as _e,r as tt,u as st,h as at,H as Te,L as rt,M as V,N as xe,O as K,j as it}from"./vendor-firebase-DsB9F8mz.js";import{d as v,g as te,a as lt,s as fe,S as ne}from"./chat-3-DLBka2.js";const Bt=["Talent","Engineer","Producer","Composer","Studio","Technician","Fan","Student","Instructor","Label","Agent"],nt=["Singer","Singer-Songwriter","Lyricist","Rapper","Guitarist","Bassist","Drummer","Keyboardist","Pianist","Violinist","Cellist","Saxophonist","Trumpeter","DJ","Beatmaker","Multi-Instrumentalist","Session Musician","Vocalist","Backup Singer","Band"],ot=["Soprano","Mezzo-Soprano","Alto","Countertenor","Tenor","Baritone","Bass","Not Applicable"],dt=["Pop","R&B/Soul","Rock","Jazz","Classical/Opera","Musical Theatre","Gospel","Country","Hip Hop/Rap","Electronic/EDM","Folk/Acoustic","Metal/Screaming","Reggae","Latin","World Music"],ct=["Beginner (0-2 years)","Intermediate (2-5 years)","Advanced (5-10 years)","Professional (10+ years)","Session Veteran (20+ years)"],ut=["Club/Dance","Hip Hop","House","Techno","Drum & Bass","Dubstep","Trance","EDM/Festival","Open Format","Wedding/Corporate","Turntablism/Scratch","Radio"],gt=["Hip Hop/Trap","Pop","R&B","Electronic/EDM","Rock/Alternative","Country","Jazz","Classical/Orchestral","Film/TV Scoring","Lo-Fi/Ambient","Latin/Reggaeton","Gospel/Christian"],xt=["Tracking/Recording","Mixing","Mastering","Live Sound/FOH","Monitor Engineering","Broadcast/Podcast","Dolby Atmos/Spatial","Restoration/Forensic","Sound Design","ADR/Dialogue"],Dt={general:["Session","Lesson","Consultation","Rehearsal","Collaboration"],talent:["Vocal Recording","Feature Verse","Background Vocals","Vocal Topline","Live Performance","Session Work","Demo Recording"],instrumentalist:["Session Recording","Live Gig","Tour Support","Recording Session","Overdubs","Arrangement"],dj:["Club Set","Private Event","Festival Set","Radio Mix","Corporate Event","Wedding"],production:["Beat Production","Full Production","Co-Production","Remix","Arrangement","Sound Design","Composition"],engineering:["Mixing","Mastering","Tracking","Editing","Tuning/Comping","Stem Mixing","Atmos Mix"],studio:["Studio Rental","Equipment Rental","Recording Session","Mixing Session","Rehearsal Space"],composer:["Original Score","Arrangement","Orchestration","Library Music","Jingle/Commercial","Songwriting"]},je=["Singer","Singer-Songwriter","Vocalist","Backup Singer","Rapper"],Z=["Guitarist","Bassist","Drummer","Keyboardist","Pianist","Violinist","Cellist","Saxophonist","Trumpeter","Multi-Instrumentalist","Session Musician"],oe=["DJ","Beatmaker"],Gt=s=>{var a;if(!s)return"User";const t=s.activeProfileRole||((a=s.accountTypes)==null?void 0:a[0]);return t==="Talent"&&s.talentSubRole?s.talentSubRole:t||"User"},Ht={FREE:"FREE"},Vt=["Xfer Serum","NI Massive","Sylenth1","FabFilter Pro-Q 3","Valhalla VintageVerb","RC-20 Retro Color","Omnisphere","Kontakt","Auto-Tune","Soundtoys Decapitator","Waves CLA-2A","SerumFX","Vital","Diva"],Wt=[{id:"single",label:"Single",maxTracks:1},{id:"ep",label:"EP",maxTracks:6},{id:"album",label:"Album",maxTracks:100}],Yt=[{id:"spotify",name:"Spotify",icon:"spotify"},{id:"apple",name:"Apple Music",icon:"apple"},{id:"tiktok",name:"TikTok / Resso",icon:"music"},{id:"instagram",name:"Instagram & Facebook",icon:"instagram"},{id:"youtube",name:"YouTube Music",icon:"youtube"},{id:"amazon",name:"Amazon Music",icon:"shopping-cart"},{id:"tidal",name:"Tidal",icon:"music"},{id:"deezer",name:"Deezer",icon:"music"},{id:"soundcloud",name:"SoundCloud",icon:"cloud"}],qt=["Alternative","Blues","Children's Music","Christian & Gospel","Classical","Comedy","Country","Dance","Electronic","Fitness & Workout","Folk","Hip Hop/Rap","Holiday","Indie Pop","Instrumental","Jazz","K-Pop","Latin","Metal","New Age","Pop","R&B/Soul","Reggae","Rock","Singer/Songwriter","Soundtrack","Spoken Word","World"],ce=[{id:"manage_roster",label:"Manage Roster",description:"Add, remove, or edit student details."},{id:"manage_enrollment",label:"Admissions",description:"Process applications and handle intake."},{id:"approve_hours",label:"Approve Hours",description:"Verify and approve internship time logs."},{id:"manage_partners",label:"Manage Partners",description:"Add or edit approved internship studios."},{id:"grade_students",label:"Grading",description:"Submit technical and soft-skill evaluations."},{id:"post_announcements",label:"Announcements",description:"Post news to the student dashboard."},{id:"manage_resources",label:"Resource Rules",description:"Set quotas and booking restrictions."},{id:"manage_staff",label:"Manage Staff",description:"Add new instructors and assign roles."},{id:"view_audit",label:"View Audit Logs",description:"See history of administrative actions."},{id:"edit_settings",label:"School Settings",description:"Change school name, address, and branding."}],ke={Vocals:["Soprano","Tenor","Baritone","Bass","Falsetto","Rapping","Beatboxing","Growling"],Guitars:["Electric Guitar","Acoustic Guitar","Bass Guitar","Classical/Nylon","12-String Acoustic","Upright Bass"],Percussion:["Drum Kit","Electronic Drums","Congas","Bongos","Djembe","Cajon","Timbales","Tabla","Marimba","Vibraphone"],Keys:["Grand Piano","Upright Piano","Electric Piano","Clavinet","Hammond Organ","Pipe Organ","Synthesizer","MIDI Controller","Accordion"],Strings:["Violin","Viola","Cello","Double Bass","Harp","Banjo","Mandolin","Ukulele","Sitar","Oud"],Wind:["Flute","Clarinet","Oboe","Bassoon","Saxophone","Trumpet","Trombone","French Horn","Tuba","Harmonica","Didgeridoo","Bagpipes"]},ee=["Rock","Alternative","Indie","Metal","Punk","Pop","Electronic","House","Techno","Dubstep","Hip Hop","Rap","Trap","R&B","Soul","Funk","Jazz","Blues","Country","Folk","Americana","Bluegrass","Classical","Reggae","Latin","World","Experimental"],mt=["Wi-Fi","Kitchen","Lounge","Private Parking","Shower","Sleep/Lodging","Accessibility Ramps","Video Feed","Loading Dock","Isolation Booth","Live Room","Grand Piano","Tape Machine"],W=[{key:"useRealName",label:"Use Primary Name?",type:"checkbox",isToggle:!0},{key:"profileName",label:"Profile/Stage Name",type:"text"}],Jt={Talent:[{key:"talentSubRole",label:"What best describes you?",type:"select",options:["",...nt],isSubRole:!0},{key:"profileName",label:"Artist / Stage Name",type:"text"},{key:"bio",label:"Biography",type:"textarea"},{key:"vocalRange",label:"Vocal Range",type:"select",options:["",...ot],showFor:je},{key:"vocalStyles",label:"Vocal Styles",type:"multi_select",data:dt,showFor:je},{key:"demoReelUrl",label:"Demo Reel / Sample Link",type:"text",placeholder:"YouTube, SoundCloud, or Spotify link"},{key:"primaryInstrument",label:"Primary Instrument",type:"text",showFor:Z},{key:"playingExperience",label:"Playing Experience",type:"select",options:["",...ct],showFor:Z},{key:"canReadMusic",label:"Sight Reading Ability",type:"select",options:["","None","Lead Sheets/Charts","Standard Notation","Expert/Classically Trained"],showFor:Z},{key:"ownGear",label:"Own Professional Gear?",type:"select",options:["","Yes - Full Rig","Yes - Basic Setup","No - Need Backline"],showFor:Z},{key:"djStyles",label:"DJ Styles",type:"multi_select",data:ut,showFor:oe},{key:"djSetup",label:"DJ Setup",type:"select",options:["","CDJs/XDJs","Turntables","Controller","Hybrid","All of the Above"],showFor:oe},{key:"canProvidePa",label:"Can Provide PA/Sound?",type:"select",options:["","Yes - Full System","Yes - Basic Setup","No"],showFor:oe},{key:"instruments",label:"Instruments & Skills",type:"nested_select",data:ke},{key:"genres",label:"Primary Genres",type:"multi_select",data:ee},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Available for Work","Busy - Limited Availability","Not Available","On Tour"]},{key:"rates",label:"Booking/Feature Rate ($)",type:"number"},{key:"sessionRate",label:"Session Rate ($/hr)",type:"number"},{key:"dayRate",label:"Day Rate ($)",type:"number"},{key:"travelDist",label:"Max Travel (mi)",type:"number"},{key:"gearHighlights",label:"Key Gear (Instruments, Amps, etc.)",type:"textarea"},{key:"readingSkill",label:"Sight Reading",type:"select",options:["None","Charts/Lead Sheets","Standard Notation","Expert"]},{key:"remoteWork",label:"Remote Recording Capable?",type:"select",options:["Yes","No"]},{key:"website",label:"Official Website",type:"text"},{key:"label",label:"Record Label (Optional)",type:"text"},{key:"touring",label:"Currently Touring?",type:"select",options:["Yes","No"]}],Label:[{key:"profileName",label:"Label Name",type:"text"},{key:"bio",label:"Label Description / Mission",type:"textarea"},{key:"genres",label:"Focus Genres",type:"multi_select",data:ee},{key:"website",label:"Website",type:"text"},{key:"acceptingDemos",label:"Accepting Demos?",type:"select",options:["Yes","No"]}],Agent:[...W,{key:"agencyName",label:"Agency Name",type:"text"},{key:"rosterSize",label:"Roster Size",type:"number"},{key:"territory",label:"Territory Focus",type:"text"}],Fan:[{key:"bio",label:"About Me",type:"textarea"},{key:"genres",label:"Favorite Genres",type:"multi_select",data:ee},{key:"lookingFor",label:"Interested In",type:"multi_select",data:["Discovering Music","Booking Talent","Learning"]}],Studio:[...W,{key:"profileName",label:"Studio Name",type:"text"},{key:"bio",label:"Description",type:"textarea"},{key:"address",label:"Address",type:"text"},{key:"hours",label:"Hours of Operation",type:"text"},{key:"dimensions",label:"Live Room Dimensions",type:"text"},{key:"parking",label:"Parking Situation",type:"text"},{key:"amenities",label:"Amenities",type:"multi_select",data:mt},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Open - Accepting Bookings","Limited Availability","Fully Booked","Closed for Maintenance"]},{key:"hourlyRate",label:"Hourly Rate ($)",type:"number"},{key:"dayRate",label:"Day Rate ($)",type:"number"},{key:"virtualTourUrl",label:"Virtual Tour Link",type:"text",placeholder:"YouTube or 360° tour URL"},{key:"gearList",label:"Equipment List URL",type:"text"}],Engineer:[...W,{key:"bio",label:"Bio",type:"textarea"},{key:"skills",label:"Specialties",type:"multi_select",data:xt},{key:"daw",label:"DAWs",type:"multi_select",data:["Pro Tools","Logic Pro","Ableton","FL Studio","Cubase","Reaper","Studio One","Luna"]},{key:"outboard",label:"Favorite Outboard Gear",type:"textarea"},{key:"credits",label:"Selected Credits",type:"textarea"},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Available for Work","Busy - Limited Availability","Not Available","On Location"]},{key:"hourlyRate",label:"Hourly Rate ($)",type:"number"},{key:"projectRate",label:"Per-Song/Project Rate ($)",type:"number"},{key:"sampleWorkUrl",label:"Sample Work / Reel Link",type:"text",placeholder:"SoundCloud, YouTube, or portfolio URL"},{key:"remoteWork",label:"Remote Mixing Available?",type:"select",options:["Yes","No"]},{key:"hasStudio",label:"Has Own Studio?",type:"select",options:["Yes - Commercial","Yes - Home Studio","No - Freelance Only"]}],Producer:[...W,{key:"bio",label:"Bio",type:"textarea"},{key:"genres",label:"Genres",type:"multi_select",data:ee},{key:"productionStyles",label:"Production Styles",type:"multi_select",data:gt},{key:"daw",label:"Primary DAW",type:"select",options:["Pro Tools","Logic Pro","Ableton","FL Studio","Cubase","Studio One","Reason","Bitwig"]},{key:"credits",label:"Discography / Credits",type:"textarea"},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Available for Work","Busy - Limited Availability","Not Available","In Studio"]},{key:"beatLeasePrice",label:"Beat Lease Price ($)",type:"number"},{key:"exclusivePrice",label:"Exclusive Beat Price ($)",type:"number"},{key:"customBeatPrice",label:"Custom Production Rate ($)",type:"number"},{key:"sampleWorkUrl",label:"Beat Catalog / Portfolio Link",type:"text",placeholder:"BeatStars, YouTube, or website URL"},{key:"acceptsCollabs",label:"Open to Collaborations?",type:"select",options:["Yes","Paid Only","No"]}],Composer:[...W,{key:"bio",label:"Bio",type:"textarea"},{key:"compType",label:"Type",type:"multi_select",options:["Film/TV","Game Audio","Pop/Songwriting","Classical/Orchestral","Library Music","Jingles"]},{key:"instruments",label:"Primary Instruments",type:"nested_select",data:ke},{key:"libraries",label:"Key Sample Libraries",type:"textarea"},{key:"credits",label:"Credits",type:"textarea"},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Available for Work","Busy - Limited Availability","Not Available","On Project"]},{key:"projectRate",label:"Project Rate ($/minute of music)",type:"number"},{key:"reelUrl",label:"Demo Reel / Portfolio Link",type:"text",placeholder:"Vimeo, YouTube, or portfolio URL"},{key:"canOrchestrate",label:"Orchestration Services?",type:"select",options:["Yes","No"]},{key:"turnaroundTime",label:"Typical Turnaround",type:"select",options:["24-48 hours","3-5 days","1-2 weeks","Project Dependent"]}],Technician:[...W,{key:"bio",label:"Bio",type:"textarea"},{key:"skills",label:"Skills",type:"textarea"}]},Kt=[{id:"repair",label:"Equipment Repair"},{id:"wiring",label:"Studio Wiring/Install"},{id:"acoustics",label:"Acoustic Calibration"},{id:"computer",label:"DAW/Computer Support"},{id:"mods",label:"Custom Mods"}],Xt=["Luthier (Guitar/Bass)","Drum Tech","Amp Tech (Tube)","Amp Tech (Solid State)","Studio Electrician","Acoustician","Piano Tuner/Tech","Synth/Keyboard Tech","Computer/IT Systems","Soldering/Cabling","Console Maintenance","Live Sound Tech"],Qt=[{id:"audio_interfaces",label:"Audio Interfaces"},{id:"microphones",label:"Microphones"},{id:"preamps",label:"Preamps & Channel Strips"},{id:"mixing_consoles",label:"Mixing Consoles & Mixers"},{id:"monitors",label:"Studio Monitors & Speakers"},{id:"headphones",label:"Headphones & IEMs"},{id:"outboard_processing",label:"Outboard Gear (Compressors, EQs)"},{id:"effects_processors",label:"Effects Processors & Reverbs"},{id:"converters",label:"AD/DA Converters & Clocks"},{id:"electric_guitars",label:"Electric Guitars"},{id:"acoustic_guitars",label:"Acoustic Guitars"},{id:"bass_guitars",label:"Bass Guitars"},{id:"guitar_amps",label:"Guitar & Bass Amplifiers"},{id:"guitar_effects",label:"Guitar Pedals & Effects"},{id:"guitar_accessories",label:"Guitar Accessories (Cases, Straps, Strings)"},{id:"synthesizers",label:"Synthesizers"},{id:"keyboards",label:"Keyboards & Workstations"},{id:"midi_controllers",label:"MIDI Controllers"},{id:"pianos",label:"Pianos (Digital & Acoustic)"},{id:"organs",label:"Organs"},{id:"drum_kits",label:"Drum Kits (Acoustic)"},{id:"electronic_drums",label:"Electronic Drums & Pads"},{id:"cymbals",label:"Cymbals"},{id:"percussion",label:"Percussion & Hand Drums"},{id:"drum_machines",label:"Drum Machines & Samplers"},{id:"string_instruments",label:"String Instruments (Violin, Cello, etc.)"},{id:"wind_instruments",label:"Wind & Brass Instruments"},{id:"world_instruments",label:"World & Ethnic Instruments"},{id:"pa_speakers",label:"PA Speakers & Subwoofers"},{id:"power_amps",label:"Power Amplifiers"},{id:"live_mixers",label:"Live Sound Mixers"},{id:"wireless_systems",label:"Wireless Microphone Systems"},{id:"in_ear_monitors",label:"In-Ear Monitor Systems"},{id:"stage_gear",label:"Stage Gear (DI Boxes, Snakes, Stands)"},{id:"turntables",label:"Turntables & DJ Decks"},{id:"dj_controllers",label:"DJ Controllers"},{id:"dj_mixers",label:"DJ Mixers"},{id:"cdj_media_players",label:"CDJs & Media Players"},{id:"recorders",label:"Recorders (Field, Multitrack)"},{id:"tape_machines",label:"Tape Machines & Reel-to-Reel"},{id:"studio_furniture",label:"Studio Furniture & Desks"},{id:"acoustic_treatment",label:"Acoustic Treatment & Panels"},{id:"isolation",label:"Isolation Booths & Shields"},{id:"cables",label:"Cables & Connectors"},{id:"patchbays",label:"Patchbays & Routing"},{id:"stage_lighting",label:"Stage Lighting"},{id:"video_gear",label:"Video & Streaming Gear"},{id:"computers",label:"Computers & Laptops (Music Production)"},{id:"software_licenses",label:"Software & Plugin Licenses"},{id:"storage_drives",label:"Storage & Hard Drives"},{id:"stands_mounts",label:"Stands & Mounts"},{id:"cases_bags",label:"Cases, Bags & Road Cases"},{id:"power_conditioning",label:"Power Conditioners & UPS"},{id:"parts_components",label:"Parts & Components"},{id:"vintage_gear",label:"Vintage & Collectible Gear"},{id:"other",label:"Other"}],Zt=500,es={INTENT_CREATED:"intent_created",HOLD_PLACED:"hold_placed",SELLER_NOTIFIED:"seller_notified",MEETUP_SCHEDULED:"meetup_scheduled",SELLER_EN_ROUTE:"seller_en_route",BUYER_EN_ROUTE:"buyer_en_route",AT_SAFE_ZONE:"at_safe_zone",SELLER_PHOTOS_UPLOADED:"seller_photos_uploaded",BUYER_INSPECTING:"buyer_inspecting",BUYER_PHOTOS_UPLOADED:"buyer_photos_uploaded",PENDING_DUAL_APPROVAL:"pending_dual_approval",SELLER_APPROVED:"seller_approved",BUYER_APPROVED:"buyer_approved",COMPLETED:"completed",DISPUTED:"disputed",CANCELLED:"cancelled"},ts=[{key:"intent",label:"Purchase Intent",description:"Buyer initiates purchase"},{key:"hold",label:"Payment Hold",description:"Card hold placed in escrow"},{key:"schedule",label:"Schedule Meetup",description:"Coordinate exchange date/location"},{key:"seller_depart",label:"Seller Departs",description:"Seller uploads pre-departure photos"},{key:"arrive",label:"Safe Zone Arrival",description:"Both parties arrive at safe location"},{key:"inspect",label:"Buyer Inspection",description:"Buyer verifies item condition"},{key:"approve",label:"Dual Approval",description:"Both parties confirm exchange"},{key:"complete",label:"Complete",description:"Funds released to seller"}],ss=100,as=50,rs=[{id:"police_station",label:"Police Station",icon:"shield",priority:1},{id:"fire_station",label:"Fire Station",icon:"flame",priority:2},{id:"bank",label:"Bank Lobby",icon:"landmark",priority:3},{id:"post_office",label:"Post Office",icon:"mail",priority:4},{id:"city_hall",label:"City Hall / Gov Building",icon:"building",priority:5},{id:"library",label:"Public Library",icon:"book",priority:6},{id:"mall_security",label:"Mall Security Office",icon:"store",priority:7}],Ie=d.createContext();function ie(){return d.useContext(Ie)}function is({children:s,user:t,userData:a}){var m;const[l,n]=d.useState(null),[h,x]=d.useState(null),[o,u]=d.useState(null),[r,i]=d.useState([]),[c,y]=d.useState(null),[f,b]=d.useState(!0);d.useEffect(()=>{if(!t||!(a!=null&&a.schoolId)){b(!1);return}Q(P(v,"schools",a.schoolId)).then(A=>{A.exists()&&n(A.data())}).catch(A=>console.error("Error fetching school data:",A)),(async()=>{var A,S,j,E;try{if((A=a.accountTypes)!=null&&A.includes("Student")||(S=a.accountTypes)!=null&&S.includes("Intern")){const _=te(t.uid).studentRecord(a.schoolId,t.uid);et(P(v,_),async I=>{if(I.exists()){const F=I.data();if(x(F),F.internshipStudioId){const U=await Q(P(v,`schools/${a.schoolId}/partners/${F.internshipStudioId}`));if(U.exists())y(U.data());else{const k=await Q(P(v,"studios",F.internshipStudioId));k.exists()&&y(k.data())}}}})}if((j=a.accountTypes)!=null&&j.includes("Instructor")||(E=a.accountTypes)!=null&&E.includes("Admin")){const _=M(R(v,`schools/${a.schoolId}/staff`),G("uid","==",t.uid)),I=await T(_);if(!I.empty){const F=I.docs[0].data();if(u(F),F.roleId){const U=await Q(P(v,`schools/${a.schoolId}/roles/${F.roleId}`));U.exists()&&i(U.data().permissions||[])}else a.accountTypes.includes("Admin")&&i(["ALL"])}}}catch(_){console.error("Error setting up school context:",_)}finally{b(!1)}})()},[t,a]);const p=async(C,A="remote")=>{if(!(!h||!a.schoolId))try{const S=R(v,`schools/${a.schoolId}/internship_logs`),j=await O(S,{studentId:t.uid,studentName:a.displayName||"Unknown",checkIn:B(),checkOut:null,location:C||"Unknown",type:A,status:"active",description:""}),E=te(t.uid).studentRecord(a.schoolId,t.uid);await z(P(v,E),{activeSessionId:j.id,isClockedIn:!0})}catch(S){throw console.error("Check-in failed:",S),S}},N=async C=>{if(!(!(h!=null&&h.activeSessionId)||!a.schoolId))try{const A=`schools/${a.schoolId}/internship_logs/${h.activeSessionId}`;await z(P(v,A),{checkOut:B(),status:"pending_approval",description:C||"No description"});const S=te(t.uid).studentRecord(a.schoolId,t.uid);await z(P(v,S),{activeSessionId:null,isClockedIn:!1})}catch(A){throw console.error("Check-out failed:",A),A}},g={schoolId:a==null?void 0:a.schoolId,schoolData:l,studentProfile:h,staffProfile:o,myPermissions:r,internshipStudio:c,isStudent:!!h,isStaff:!!o||((m=a==null?void 0:a.accountTypes)==null?void 0:m.includes("Admin")),checkIn:p,checkOut:N,loading:f};return e.jsx(Ie.Provider,{value:g,children:s})}const ls=async s=>{if(!s||s.length<5)return null;try{const t=await fetch(`https://api.zippopotam.us/us/${s}`);if(!t.ok)return null;const l=(await t.json()).places[0];return{lat:parseFloat(l.latitude),lng:parseFloat(l.longitude),name:l["place name"],state:l["state abbreviation"],cityState:`${l["place name"]}, ${l["state abbreviation"]}`}}catch(t){return console.warn("Geocoding failed:",t),null}},ht=async(s,t)=>{if(!s||!t)return null;try{const a=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s}&lon=${t}`);if(!a.ok)return null;const n=(await a.json()).address,h=n.city||n.town||n.village||n.hamlet||"Unknown Location",x=n.state||"",o=n.postcode||"";return{city:h,state:x,zip:o,displayName:`${h}, ${x} ${o}`.trim()}}catch(a){return console.warn("Reverse geocoding failed:",a),null}},ns=async s=>{if(!s||s.length<3)return{count:0,density:"#6B7280",label:"Scanning..."};try{const t=s.substring(0,3),a=t+"",l=R(v,"artifacts",lt,"public","data","profiles"),n=M(l,G("zip",">=",t),G("zip","<=",a)),x=(await _e(n)).data().count;let o="#3D84ED",u="Quiet Area";return x>25&&(o="#10B981",u="Active Area"),x>100&&(o="#F59E0B",u="Buzzing"),x>500&&(o="#EF4444",u="Hotspot"),{count:x,density:o,label:u}}catch(t){return console.warn("Regional stats failed:",t),{count:0,density:"#9CA3AF",label:"Unknown Region"}}},pt=async(s,t={})=>{if(!s||s.trim().length<3)return[];const{countryCode:a="us",limit:l=5,addressDetails:n=!0}=t;try{const h=new URLSearchParams({q:s,format:"json",addressdetails:n?"1":"0",limit:l.toString(),countrycodes:a}),x=await fetch(`https://nominatim.openstreetmap.org/search?${h}`,{headers:{Accept:"application/json"}});return x.ok?(await x.json()).map(u=>{const r=u.address||{};return{id:u.place_id,displayName:u.display_name,shortName:bt(u),lat:parseFloat(u.lat),lng:parseFloat(u.lon),type:u.type,category:u.category,address:{houseNumber:r.house_number||"",street:r.road||r.street||"",city:r.city||r.town||r.village||r.hamlet||"",state:r.state||"",stateCode:me(r.state),zip:r.postcode||"",country:r.country||"",countryCode:r.country_code||""},formattedAddress:yt(r)}}):(console.warn("Address search failed:",x.status),[])}catch(h){return console.warn("Address search error:",h),[]}};function bt(s){const t=s.address||{},a=[];t.house_number&&t.road?a.push(`${t.house_number} ${t.road}`):t.road&&a.push(t.road);const l=t.city||t.town||t.village||t.hamlet;l&&a.push(l);const n=me(t.state);return n&&a.push(n),a.join(", ")||s.display_name.split(",").slice(0,3).join(",")}function yt(s){const t=[];s.house_number&&s.road?t.push(`${s.house_number} ${s.road}`):s.road&&t.push(s.road);const a=s.city||s.town||s.village||"",l=me(s.state),n=s.postcode||"",h=[a,l].filter(Boolean).join(", ");return h&&t.push(n?`${h} ${n}`:h),t.join(", ")}function me(s){if(!s)return"";const t={alabama:"AL",alaska:"AK",arizona:"AZ",arkansas:"AR",california:"CA",colorado:"CO",connecticut:"CT",delaware:"DE",florida:"FL",georgia:"GA",hawaii:"HI",idaho:"ID",illinois:"IL",indiana:"IN",iowa:"IA",kansas:"KS",kentucky:"KY",louisiana:"LA",maine:"ME",maryland:"MD",massachusetts:"MA",michigan:"MI",minnesota:"MN",mississippi:"MS",missouri:"MO",montana:"MT",nebraska:"NE",nevada:"NV","new hampshire":"NH","new jersey":"NJ","new mexico":"NM","new york":"NY","north carolina":"NC","north dakota":"ND",ohio:"OH",oklahoma:"OK",oregon:"OR",pennsylvania:"PA","rhode island":"RI","south carolina":"SC","south dakota":"SD",tennessee:"TN",texas:"TX",utah:"UT",vermont:"VT",virginia:"VA",washington:"WA","west virginia":"WV",wisconsin:"WI",wyoming:"WY","district of columbia":"DC"};return s.length===2?s.toUpperCase():t[s.toLowerCase()]||s}const ft=()=>{const[s,t]=d.useState(!1),[a,l]=d.useState(null);return{uploadImage:async(h,x)=>{if(!h)return null;if(!fe)return l("Firebase Storage is not configured. Please set VITE_FIREBASE_STORAGE_BUCKET in your environment variables."),console.error("Firebase Storage is not available. storageBucket is missing from Firebase config."),null;t(!0),l(null);try{const u=`${Date.now()}_${h.name}`,r=`${x}/${u}`,i=tt(fe,r),c=await st(i,h),y=await at(c.ref);return t(!1),y}catch(o){return console.error("Upload failed:",o),l(o),t(!1),null}},uploading:s,error:a}};function jt(s={}){const{debounceMs:t=300,countryCode:a="us",limit:l=5}=s,[n,h]=d.useState([]),[x,o]=d.useState(!1),[u,r]=d.useState(null),i=d.useRef(null),c=d.useRef(""),y=d.useRef(0),f=d.useCallback(async p=>{const N=(p==null?void 0:p.trim())||"";if(i.current&&clearTimeout(i.current),N.length<3){h([]),o(!1),r(null);return}N!==c.current&&(o(!0),r(null),i.current=setTimeout(async()=>{const g=++y.current;c.current=N;try{const m=await pt(N,{countryCode:a,limit:l,addressDetails:!0});g===y.current&&(h(m),o(!1))}catch(m){g===y.current&&(r(m.message||"Address search failed"),h([]),o(!1))}},t))},[t,a,l]),b=d.useCallback(()=>{h([]),r(null),c.current=""},[]);return{search:f,results:n,loading:x,error:u,clearResults:b}}function kt({onSelect:s,value:t,onChange:a,placeholder:l="Start typing an address...",className:n="",label:h="Address",required:x=!1,showGeolocation:o=!0,countryCode:u="us",error:r}){const{search:i,results:c,loading:y,error:f,clearResults:b}=jt({countryCode:u,debounceMs:350,limit:6}),[p,N]=d.useState(""),[g,m]=d.useState(!1),[C,A]=d.useState(!1),S=d.useRef(null),j=d.useRef(null),E=t!==void 0?t:p;d.useEffect(()=>{function w(L){S.current&&!S.current.contains(L.target)&&m(!1)}return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[]);const _=w=>{const L=w.target.value;a?a(L):N(L),L.trim().length>=3?(i(L),m(!0)):(m(!1),b())},I=w=>{const L={displayName:w.displayName,shortName:w.shortName,formattedAddress:w.formattedAddress,lat:w.lat,lng:w.lng,...w.address},$=w.formattedAddress||w.shortName||w.displayName;a?a($):N($),s&&s(L),m(!1),b()},F=async()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}A(!0),navigator.geolocation.getCurrentPosition(async w=>{const{latitude:L,longitude:$}=w.coords;try{const H=await ht(L,$);if(H){const X=H.displayName;a?a(X):N(X),s&&s({displayName:X,formattedAddress:X,lat:L,lng:$,city:H.city,state:H.state,zip:H.zip})}}catch(H){console.error("Reverse geocode failed:",H)}A(!1)},w=>{console.warn("Geolocation error:",w),alert("Unable to get your location. Please enter address manually."),A(!1)},{enableHighAccuracy:!0,timeout:1e4})},U=()=>{var w;a?a(""):N(""),b(),m(!1),(w=j.current)==null||w.focus()},k=r||f;return e.jsxs("div",{ref:S,className:`relative ${n}`,children:[h&&e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:[h,x&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(D,{className:`absolute left-3 top-3 ${y?"text-brand-blue animate-pulse":"text-gray-400"}`,size:16}),e.jsx("input",{ref:j,type:"text",className:`
                            w-full pl-9 pr-8 p-2.5 text-sm
                            bg-white dark:bg-[#1f2128] 
                            border ${k?"border-red-400 focus:ring-red-200":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"}
                            rounded-lg focus:ring-2 outline-none 
                            dark:text-white transition-all
                        `,placeholder:l,value:E,onChange:_,onFocus:()=>{c.length>0&&m(!0)},autoComplete:"off"}),E&&!y&&e.jsx("button",{type:"button",onClick:U,className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",children:e.jsx(ve,{size:16})}),y&&e.jsx(le,{className:"absolute right-3 top-3 text-brand-blue animate-spin",size:16})]}),o&&e.jsx("button",{type:"button",onClick:F,disabled:C,className:"p-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-brand-blue transition-colors disabled:opacity-50",title:"Use my current location",children:C?e.jsx(le,{size:18,className:"animate-spin"}):e.jsx($e,{size:18})})]}),k&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r||f}),g&&c.length>0&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-72 overflow-y-auto animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsx("div",{className:"py-1",children:c.map(w=>{var L;return e.jsx("button",{type:"button",onClick:()=>I(w),className:"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{size:16,className:"text-gray-400 group-hover:text-brand-blue transition-colors mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm dark:text-white group-hover:text-brand-blue transition-colors truncate",children:w.shortName||w.formattedAddress}),w.displayName!==w.shortName&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5",children:w.displayName}),((L=w.address)==null?void 0:L.zip)&&e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:["ZIP: ",w.address.zip]})]})]})},w.id)})}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-t dark:border-gray-700 text-[10px] text-gray-400 text-center",children:"Powered by OpenStreetMap"})]}),g&&y&&c.length===0&&E.length>=3&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2",children:[e.jsx(le,{className:"animate-spin",size:16}),e.jsx("span",{className:"text-sm",children:"Searching addresses..."})]}),g&&!y&&c.length===0&&E.length>=3&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 text-sm",children:"No addresses found. Try a different search."})]})}function os({user:s,userData:t}){const{schoolData:a,studentProfile:l}=ie(),[n,h]=d.useState(""),[x,o]=d.useState([]),[u,r]=d.useState(!1),i=(t==null?void 0:t.internshipCities)||[],c=async()=>{const p=n.trim();if(p&&i.length<3)try{await z(P(v,"users",s.uid),{internshipCities:Te(p)}),h("")}catch(N){console.error("Error adding interest:",N)}},y=async p=>{try{await z(P(v,"users",s.uid),{internshipCities:rt(p)})}catch(N){console.error("Error removing interest:",N)}};d.useEffect(()=>{t!=null&&t.programComplete&&f()},[t==null?void 0:t.programComplete,i]);const f=async()=>{r(!0);try{const p=M(R(v,"studios"),G("allowInternship","==",!0));let g=(await T(p)).docs.map(m=>({id:m.id,...m.data()}));i.length>0&&(g=g.filter(m=>i.some(C=>{var A,S;return((A=m.city)==null?void 0:A.toLowerCase().includes(C.toLowerCase()))||((S=m.zipCode)==null?void 0:S.includes(C))}))),o(g)}catch(p){console.error("Error fetching studios:",p)}finally{r(!1)}},b=((l==null?void 0:l.hoursLogged)||0)/((a==null?void 0:a.requiredHours)||100);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2",children:a!=null&&a.logoURL?e.jsx("img",{src:a.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(Y,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight mb-1",children:(a==null?void 0:a.name)||"Student Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Student Portal"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["ID: ",(t==null?void 0:t.studentId)||"N/A"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Cohort: ",(l==null?void 0:l.cohort)||"General"]})]})]}),e.jsxs("div",{className:"w-full md:w-64 bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"dark:text-gray-300",children:"Progress"}),e.jsxs("span",{className:"text-indigo-600",children:[Math.round(b*100),"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:"h-full bg-indigo-600",style:{width:`${Math.min(100,b*100)}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 text-right",children:[(l==null?void 0:l.hoursLogged)||0," / ",(a==null?void 0:a.requiredHours)||100," Hours"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(D,{size:20,className:"text-indigo-500"})," Internship Locations"]}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Add up to 3 target locations (City, Zip, or County) to find matched studios."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(p=>e.jsxs("span",{className:"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300 text-sm font-medium px-3 py-1 rounded-full flex items-center gap-1",children:[p,e.jsx("button",{onClick:()=>y(p),className:"ml-1 hover:text-indigo-800",children:"×"})]},p))}),i.length<3&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter City or Zip Code",value:n,onChange:p=>h(p.target.value),onKeyDown:p=>p.key==="Enter"&&c(),className:"flex-1 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none"}),e.jsx("button",{onClick:c,disabled:!n.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg font-bold disabled:opacity-50",children:"Add"})]})]}),(t==null?void 0:t.programComplete)&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(se,{size:20,className:"text-indigo-500"})," Available Studios"]}),u?e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(ae,{className:"animate-spin",size:16})," Searching..."]}):x.length>0?e.jsx("div",{className:"space-y-3",children:x.map(p=>e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold dark:text-white text-lg",children:p.name}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(D,{size:12})," ",p.city,", ",p.state]})]}),e.jsx("button",{className:"text-indigo-600 font-bold text-sm hover:underline",children:"View Details"})]},p.id))}):e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(ue,{size:16})," No studios found matching your criteria yet."]})]})]})}const he=(s,t="export")=>{if(!s||!s.length){console.warn("No data to export.");return}const a=new Set;s.forEach(u=>Object.keys(u).forEach(r=>a.add(r)));const l=Array.from(a),n=[];n.push(l.join(",")),s.forEach(u=>{const r=l.map(i=>{const c=u[i];return c&&typeof c=="object"?c.toMillis?`"${new Date(c.toMillis()).toLocaleString()}"`:`"${JSON.stringify(c).replace(/"/g,'""')}"`:`"${(""+(c??"")).replace(/"/g,'""')}"`});n.push(r.join(","))});const h=new Blob([n.join(`
`)],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(h),o=document.createElement("a");o.href=x,o.setAttribute("download",`${t}_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o)};function vt({schoolId:s,schoolData:t}){const[a,l]=d.useState({students:0,interns:0,pending:0}),[n,h]=d.useState([]),[x,o]=d.useState(!0);return d.useEffect(()=>{s&&(async()=>{o(!0);try{const r=await _e(R(v,`schools/${s}/students`)),c=(await T(R(v,`schools/${s}/students`))).docs.filter(p=>p.data().internshipStudioId).length,f=(await T(R(v,`schools/${s}/internship_logs`))).docs.filter(p=>p.data().status==="pending_approval").length;l({students:r.data().count,interns:c,pending:f});const b=await T(M(R(v,`schools/${s}/audit_logs`),V("timestamp","desc"),xe(5)));h(b.docs.map(p=>({id:p.id,...p.data()})))}catch(r){console.error("Overview load failed:",r)}o(!1)})()},[s]),x?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Overview..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ne,{title:"Total Students",value:a.students,icon:e.jsx(Ne,{className:"text-white"}),bg:"bg-gradient-to-br from-indigo-500 to-blue-600",text:"text-white"}),e.jsx(ne,{title:"Active Internships",value:a.interns,icon:e.jsx(ge,{className:"text-white"}),bg:"bg-gradient-to-br from-purple-500 to-pink-600",text:"text-white"}),e.jsx(ne,{title:"Pending Approvals",value:a.pending,icon:e.jsx(ae,{className:"text-white"}),bg:"bg-gradient-to-br from-yellow-500 to-orange-600",text:"text-white"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-4 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(we,{size:18,className:"text-gray-400"})," Recent Activity"]}),e.jsx("div",{className:"space-y-3",children:n.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No recent activity recorded."}):n.map(u=>{var r;return e.jsxs("div",{className:"text-xs border-b dark:border-gray-700 pb-2 last:border-0",children:[e.jsxs("div",{className:"flex justify-between font-bold dark:text-gray-200",children:[e.jsx("span",{children:u.action}),e.jsx("span",{className:"text-gray-500 font-normal",children:(r=u.timestamp)!=null&&r.toDate?u.timestamp.toDate().toLocaleTimeString():""})]}),e.jsxs("div",{className:"text-gray-500 mt-0.5",children:[u.details," ",e.jsxs("span",{className:"opacity-70",children:["— ",u.adminName]})]})]},u.id)})})]}),e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center text-center bg-white dark:bg-black/20 shadow-sm",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center shadow-lg mb-4 overflow-hidden border-4 border-white dark:border-gray-700",children:t!=null&&t.logoURL?e.jsx("img",{src:t.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(Y,{size:40,className:"text-indigo-500"})}),e.jsx("h2",{className:"text-2xl font-extrabold dark:text-white mb-1",children:(t==null?void 0:t.name)||"School Name"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:(t==null?void 0:t.address)||"No Address Set"}),(t==null?void 0:t.website)&&e.jsxs("a",{href:t.website,target:"_blank",rel:"noreferrer",className:"text-xs font-bold text-indigo-600 bg-indigo-50 dark:bg-indigo-900/20 px-3 py-1.5 rounded-full hover:bg-indigo-100 transition flex items-center gap-1",children:[e.jsx(Se,{size:12})," Visit Website"]})]})]})]})}function Nt({schoolId:s,logAction:t}){const[a,l]=d.useState([]),[n,h]=d.useState([]),[x,o]=d.useState(!0),[u,r]=d.useState(""),[i,c]=d.useState(!1),[y,f]=d.useState(!1),[b,p]=d.useState(null),[N,g]=d.useState(!1),[m,C]=d.useState({firstName:"",lastName:"",email:"",studentId:"",cohort:"",status:"Enrolled"}),[A,S]=d.useState("");d.useEffect(()=>{(async()=>{o(!0);try{const w=await T(R(v,`schools/${s}/students`));l(w.docs.map($=>({id:$.id,...$.data()})));const L=await T(R(v,`schools/${s}/partners`));h(L.docs.map($=>({id:$.id,...$.data()})))}catch(w){console.error("Roster load failed:",w)}o(!1)})()},[s]);const j=()=>{C({firstName:"",lastName:"",email:"",studentId:"",cohort:"",status:"Enrolled"}),g(!1),p(null),c(!0)},E=k=>{var w,L;C({firstName:((w=k.displayName)==null?void 0:w.split(" ")[0])||"",lastName:((L=k.displayName)==null?void 0:L.split(" ").slice(1).join(" "))||"",email:k.email||"",studentId:k.studentId||"",cohort:k.cohort||"",status:k.status||"Enrolled"}),g(!0),p(k),c(!0)},_=async()=>{const k=`${m.firstName} ${m.lastName}`.trim();if(!k||!m.email)return alert("Name and Email required.");try{if(N&&b)await z(P(v,`schools/${s}/students/${b.id}`),{...m,displayName:k}),l(w=>w.map(L=>L.id===b.id?{...L,...m,displayName:k}:L)),await t("Edit Student",`Updated ${k}`);else{const w=await O(R(v,`schools/${s}/students`),{...m,displayName:k,hoursLogged:0,createdAt:B()});l(L=>[...L,{id:w.id,...m,displayName:k,hoursLogged:0}]),await t("Add Student",`Added ${k}`)}c(!1)}catch(w){console.error("Save student failed:",w),alert("Failed to save student.")}},I=async(k,w)=>{if(confirm(`Remove ${w} from the roster? This does not delete their user account.`))try{await K(P(v,`schools/${s}/students/${k}`)),l(L=>L.filter($=>$.id!==k)),await t("Remove Student",`Removed ${w}`)}catch(L){console.error("Delete failed:",L)}},F=async()=>{if(!(!b||!A))try{await z(P(v,`schools/${s}/students/${b.id}`),{internshipStudioId:A}),l(k=>k.map(w=>w.id===b.id?{...w,internshipStudioId:A}:w)),f(!1),S(""),alert(`Assigned ${b.displayName} to studio.`),await t("Assign Internship",`Assigned ${b.displayName}`)}catch(k){console.error("Assignment failed:",k)}},U=a.filter(k=>{var w,L;return((w=k.displayName)==null?void 0:w.toLowerCase().includes(u.toLowerCase()))||((L=k.studentId)==null?void 0:L.includes(u))});return x?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roster..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(se,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Search by Name or ID...",value:u,onChange:k=>r(k.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he(a,"student_roster"),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-bold text-xs",children:"Export CSV"}),e.jsxs("button",{onClick:j,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-indigo-700",children:[e.jsx(Ce,{size:16})," Add Student"]})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3",children:"ID"}),e.jsx("th",{className:"p-3",children:"Cohort"}),e.jsx("th",{className:"p-3",children:"Internship"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:U.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-6 text-center text-gray-500",children:"No students found."})}):U.map(k=>e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsx("td",{className:"p-3 font-bold dark:text-white",children:k.displayName}),e.jsx("td",{className:"p-3 text-gray-500",children:k.studentId||"--"}),e.jsx("td",{className:"p-3",children:k.cohort||"General"}),e.jsx("td",{className:"p-3 text-gray-500",children:k.internshipStudioId?e.jsxs("span",{className:"flex items-center gap-1 text-green-600 font-medium text-xs bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded w-fit",children:[e.jsx(ge,{size:12})," Assigned"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"Pending"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>{p(k),f(!0)},className:"p-1.5 bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-300 rounded hover:bg-indigo-100",title:"Assign Internship",children:e.jsx(ze,{size:14})}),e.jsx("button",{onClick:()=>E(k),className:"p-1.5 bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded hover:bg-gray-200",title:"Edit Details",children:e.jsx(Me,{size:14})}),e.jsx("button",{onClick:()=>I(k.id,k.displayName),className:"p-1.5 bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-100",title:"Remove Student",children:e.jsx(q,{size:14})})]})})]},k.id))})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:N?"Edit Student":"Add New Student"}),e.jsx("button",{onClick:()=>c(!1),children:e.jsx(ve,{className:"text-gray-400 hover:text-red-500"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"First Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.firstName,onChange:k=>C({...m,firstName:k.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Last Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.lastName,onChange:k=>C({...m,lastName:k.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Email Address"}),e.jsx("input",{type:"email",className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.email,onChange:k=>C({...m,email:k.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Student ID"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.studentId,onChange:k=>C({...m,studentId:k.target.value}),placeholder:"e.g. S123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Cohort"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.cohort,onChange:k=>C({...m,cohort:k.target.value}),placeholder:"Fall 2024"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Enrollment Status"}),e.jsxs("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.status,onChange:k=>C({...m,status:k.target.value}),children:[e.jsx("option",{value:"Enrolled",children:"Enrolled"}),e.jsx("option",{value:"Graduated",children:"Graduated"}),e.jsx("option",{value:"Dropped",children:"Dropped"}),e.jsx("option",{value:"Leave",children:"On Leave"})]})]}),e.jsx("button",{onClick:_,className:"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 mt-2",children:N?"Update Student":"Create Student Record"})]})}),y&&b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-sm rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Assign Internship"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Select a partner studio for ",e.jsx("strong",{children:b.displayName}),"."]}),e.jsxs("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:A,onChange:k=>S(k.target.value),children:[e.jsx("option",{value:"",children:"Select Studio..."}),n.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(!1),className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm",children:"Cancel"}),e.jsx("button",{onClick:F,disabled:!A,className:"flex-1 bg-indigo-600 text-white py-2 rounded font-bold disabled:opacity-50",children:"Confirm"})]})]})})]})}const wt=(s,t)=>{if(!s||!t)return 0;const a=s.toMillis?s.toMillis():new Date(s).getTime(),n=(t.toMillis?t.toMillis():new Date(t).getTime())-a;return Math.max(0,Math.floor(n/6e4))},St=s=>{const t=Math.floor(s/60),a=Math.floor(s%60);return`${t}h ${a>0?`${a}m`:""}`};function Ct({schoolId:s}){const[t,a]=d.useState([]),[l,n]=d.useState(!0),[h,x]=d.useState("all");d.useEffect(()=>{s&&(async()=>{n(!0);try{let i=M(R(v,`schools/${s}/internship_logs`),V("checkIn","desc"),xe(100));const y=(await T(i)).docs.map(f=>{const b=f.data(),p=wt(b.checkIn,b.checkOut);return{id:f.id,...b,duration:p}});a(y)}catch(i){console.error("Error fetching logs:",i)}n(!1)})()},[s]);const o=async(r,i)=>{try{await z(P(v,`schools/${s}/internship_logs/${r}`),{status:i}),a(c=>c.map(y=>y.id===r?{...y,status:i}:y))}catch(c){console.error("Error updating log:",c),alert("Failed to update log status.")}},u=h==="all"?t:t.filter(r=>r.status===h);return l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Internship Hours..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{size:16,className:"text-gray-500"}),e.jsxs("select",{className:"bg-white dark:bg-[#1f2128] border dark:border-gray-600 text-sm rounded-md p-1.5 outline-none dark:text-white",value:h,onChange:r=>x(r.target.value),children:[e.jsx("option",{value:"all",children:"All Activity"}),e.jsx("option",{value:"pending_approval",children:"Pending Approval"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"active",children:"Active (Clocked In)"})]})]}),e.jsxs("button",{onClick:()=>he(u,"internship_hours"),className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(Oe,{size:14})," Export CSV"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Date"}),e.jsx("th",{className:"p-3",children:"Student"}),e.jsx("th",{className:"p-3",children:"Activity / Description"}),e.jsx("th",{className:"p-3",children:"Duration"}),e.jsx("th",{className:"p-3",children:"Status"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:"No logs found matching criteria."})}):u.map(r=>{var i,c;return e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[e.jsx("div",{className:"font-medium",children:(i=r.checkIn)!=null&&i.toDate?r.checkIn.toDate().toLocaleDateString():"N/A"}),e.jsx("div",{className:"text-[10px] text-gray-400",children:(c=r.checkIn)!=null&&c.toDate?r.checkIn.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:r.studentName}),e.jsxs("td",{className:"p-3 max-w-xs",children:[e.jsxs("span",{className:"block text-[10px] uppercase font-bold text-gray-400 mb-0.5",children:[r.type," • ",r.location]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 truncate block",title:r.description,children:r.description||e.jsx("span",{className:"italic opacity-50",children:"No description provided"})})]}),e.jsx("td",{className:"p-3 font-mono font-bold text-indigo-600 dark:text-indigo-400",children:r.checkOut?St(r.duration):e.jsx("span",{className:"animate-pulse text-green-500",children:"Active..."})}),e.jsx("td",{className:"p-3",children:e.jsx(At,{status:r.status})}),e.jsx("td",{className:"p-3 text-right",children:r.status==="pending_approval"&&e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx("button",{onClick:()=>o(r.id,"approved"),className:"p-1.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded hover:bg-green-200 transition",title:"Approve",children:e.jsx(ue,{size:16})}),e.jsx("button",{onClick:()=>o(r.id,"rejected"),className:"p-1.5 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-200 transition",title:"Reject",children:e.jsx(Ue,{size:16})})]})})]},r.id)})})]})})]})}function At({status:s}){const t={approved:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",rejected:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",pending_approval:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",active:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 animate-pulse"},a={approved:"Approved",rejected:"Rejected",pending_approval:"Pending",active:"In Progress"};return e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-[10px] uppercase font-bold tracking-wide ${t[s]||"bg-gray-100 text-gray-500"}`,children:a[s]||s})}function Et({schoolId:s,logAction:t}){const[a,l]=d.useState([]),[n,h]=d.useState([]),[x,o]=d.useState(!0),[u,r]=d.useState(""),[i,c]=d.useState("");d.useEffect(()=>{(async()=>{o(!0);try{const b=await T(R(v,`schools/${s}/staff`));l(b.docs.map(N=>({id:N.id,...N.data()})));const p=await T(R(v,`schools/${s}/roles`));h(p.docs.map(N=>({id:N.id,...N.data()})))}catch(b){console.error("Staff load failed:",b)}o(!1)})()},[s]);const y=async()=>{if(!u||!i)return alert("Email and Role are required.");try{const f=M(it(v,"public_profile"),G("email","==",u)),b=await T(f);if(b.empty)return alert("User not found. They must sign up for SeshNx first.");const p=b.docs[0],N=p.data(),g=p.ref.parent.parent.id,m=n.find(S=>S.id===i),C={uid:g,email:N.email,name:`${N.firstName} ${N.lastName}`,roleId:i,roleName:(m==null?void 0:m.name)||"Unknown",addedAt:B()};await O(R(v,`schools/${s}/staff`),C);const A=te(g).userProfile;await z(P(v,A),{schoolId:s,accountTypes:Te("Instructor")}),l(S=>[...S,C]),r(""),alert(`${N.firstName} added as ${m==null?void 0:m.name}.`),await t("Add Staff",`Added ${N.email} as ${m==null?void 0:m.name}`)}catch(f){console.error("Add staff error:",f),alert("Failed to add staff member. Check console.")}};return x?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Staff..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ce,{size:18,className:"text-indigo-600"})," Add New Staff Member"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ae,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"User Email Address",value:u,onChange:f=>r(f.target.value)})]}),e.jsxs("div",{className:"relative min-w-[200px]",children:[e.jsx(re,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsxs("select",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white appearance-none",value:i,onChange:f=>c(f.target.value),children:[e.jsx("option",{value:"",children:"Select Role..."}),n.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]})]}),e.jsx("button",{onClick:y,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 transition shadow-md",children:"Add Staff"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["* The user must already have a SeshNx account. This will grant them ",e.jsx("strong",{children:"Instructor"})," access to this school."]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("span",{className:"font-bold text-sm dark:text-gray-200",children:"Authorized Personnel"}),e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded-full font-bold",children:[a.length," Active"]})]}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:a.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No staff members found."}):a.map(f=>e.jsxs("div",{className:"p-4 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-sm",children:f.name?f.name.charAt(0):"?"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white text-sm",children:f.name}),e.jsx("div",{className:"text-xs text-gray-500",children:f.email})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs font-bold border dark:border-gray-600",children:f.roleName})})]},f.id))})]})]})}function Rt({schoolId:s,logAction:t}){const[a,l]=d.useState([]),[n,h]=d.useState(!0),[x,o]=d.useState(!1),[u,r]=d.useState({name:"",color:"#3b82f6",permissions:[]}),[i,c]=d.useState(!1);d.useEffect(()=>{s&&(async()=>{h(!0);try{const m=await T(R(v,`schools/${s}/roles`));l(m.docs.map(C=>({id:C.id,...C.data()})))}catch(m){console.error("Error loading roles:",m)}h(!1)})()},[s]);const y=async()=>{if(u.name){c(!0);try{const g=await O(R(v,`schools/${s}/roles`),u);l(m=>[...m,{id:g.id,...u}]),await t("Create Role",`Created role: ${u.name}`),r({name:"",color:"#3b82f6",permissions:[]}),o(!1)}catch(g){console.error("Create role failed:",g),alert("Failed to create role.")}c(!1)}},f=async(g,m)=>{if(confirm(`Delete role "${m}"? Staff assigned to this role will lose their permissions.`))try{await K(P(v,`schools/${s}/roles/${g}`)),l(C=>C.filter(A=>A.id!==g)),await t("Delete Role",`Deleted role: ${m}`)}catch(C){console.error("Delete role failed:",C)}},b=async(g,m)=>{l(C=>C.map(A=>A.id===g?{...A,permissions:m}:A));try{await z(P(v,`schools/${s}/roles/${g}`),{permissions:m})}catch(C){console.error("Update perms failed:",C)}},p=g=>{r(m=>({...m,permissions:m.permissions.includes(g)?m.permissions.filter(C=>C!==g):[...m.permissions,g]}))},N=(g,m)=>{const C=g.permissions||[],A=C.includes(m)?C.filter(S=>S!==m):[...C,m];b(g.id,A)};return n?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roles..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("button",{onClick:()=>o(!0),className:"w-full py-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-500 font-bold hover:bg-gray-50 dark:hover:bg-white/5 transition flex items-center justify-center gap-2",children:[e.jsx(J,{size:20})," Create New Role"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(g=>{var m;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-start bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:g.color}}),g.name]}),e.jsxs("span",{className:"text-[10px] text-gray-400 uppercase tracking-wider font-bold",children:[((m=g.permissions)==null?void 0:m.length)||0," Permissions"]})]}),e.jsx("button",{onClick:()=>f(g.id,g.name),className:"text-gray-400 hover:text-red-500 transition p-1",title:"Delete Role",children:e.jsx(q,{size:16})})]}),e.jsx("div",{className:"p-2 flex-1 overflow-y-auto max-h-[300px] custom-scrollbar",children:e.jsx("div",{className:"space-y-0.5",children:ce.map(C=>{var S;const A=(S=g.permissions)==null?void 0:S.includes(C.id);return e.jsxs("label",{className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition ${A?"bg-indigo-50 dark:bg-indigo-900/20":"hover:bg-gray-50 dark:hover:bg-white/5"}`,children:[e.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center ${A?"bg-indigo-600 border-indigo-600":"border-gray-400"}`,children:A&&e.jsx(Be,{size:10,className:"text-white",strokeWidth:4})}),e.jsx("input",{type:"checkbox",className:"hidden",checked:A,onChange:()=>N(g,C.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-xs font-bold ${A?"text-indigo-700 dark:text-indigo-300":"text-gray-600 dark:text-gray-400"}`,children:C.label}),e.jsx("div",{className:"text-[10px] text-gray-400 leading-tight",children:C.description})]})]},C.id)})})})]},g.id)})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-xl p-6 space-y-4 max-h-[90vh] overflow-y-auto animate-in zoom-in-95 shadow-2xl",children:[e.jsxs("h3",{className:"font-bold text-xl dark:text-white flex items-center gap-2",children:[e.jsx(De,{className:"text-indigo-600"})," Create New Role"]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Role Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g. Academic Advisor",value:u.name,onChange:g=>r({...u,name:g.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Color"}),e.jsx("div",{className:"flex items-center border rounded dark:border-gray-600 p-1 dark:bg-black/20",children:e.jsx("input",{type:"color",className:"h-8 w-8 rounded cursor-pointer border-none bg-transparent",value:u.color,onChange:g=>r({...u,color:g.target.value})})})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Assign Initial Permissions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:ce.map(g=>e.jsxs("label",{className:`flex items-start gap-2 p-2 border rounded cursor-pointer transition ${u.permissions.includes(g.id)?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"checkbox",className:"mt-1",checked:u.permissions.includes(g.id),onChange:()=>p(g.id)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-gray-200",children:g.label}),e.jsx("div",{className:"text-[10px] text-gray-500 leading-tight",children:g.description})]})]},g.id))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm",children:"Cancel"}),e.jsx("button",{onClick:y,disabled:i,className:"flex-1 bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700 disabled:opacity-50",children:i?"Saving...":"Create Role"})]})]})})]})}function Lt({schoolId:s,logAction:t}){const[a,l]=d.useState([]),[n,h]=d.useState(!0),[x,o]=d.useState({resource:"",limit:4,unit:"hours/week",role:"Student"});d.useEffect(()=>{s&&(async()=>{h(!0);try{const c=await T(R(v,`schools/${s}/rules`));l(c.docs.map(y=>({id:y.id,...y.data()})))}catch(c){console.error("Error loading rules:",c)}h(!1)})()},[s]);const u=async()=>{if(!x.resource)return alert("Resource name required.");try{const c={id:(await O(R(v,`schools/${s}/rules`),x)).id,...x};l(y=>[...y,c]),await t("Add Resource Rule",`Set ${x.limit} ${x.unit} limit for ${x.resource}`),o({resource:"",limit:4,unit:"hours/week",role:"Student"})}catch(i){console.error("Add rule failed:",i)}},r=async(i,c)=>{if(confirm("Delete this rule?"))try{await K(P(v,`schools/${s}/rules/${i}`)),l(y=>y.filter(f=>f.id!==i)),await t("Delete Rule",`Removed rule for ${c}`)}catch(y){console.error("Delete failed:",y)}};return n?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Rules..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ee,{size:18,className:"text-indigo-600"})," Add Restriction / Quota"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Resource Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g. Studio A, SSL Room",value:x.resource,onChange:i=>o({...x,resource:i.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Limit"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",className:"w-20 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:x.limit,onChange:i=>o({...x,limit:i.target.value})}),e.jsxs("select",{className:"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:x.unit,onChange:i=>o({...x,unit:i.target.value}),children:[e.jsx("option",{value:"hours/week",children:"Hrs/Wk"}),e.jsx("option",{value:"hours/term",children:"Hrs/Term"}),e.jsx("option",{value:"bookings/week",children:"Bookings/Wk"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:u,className:"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2",children:[e.jsx(J,{size:18})," Add Rule"]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Applies To Role"}),e.jsxs("select",{className:"w-full md:w-1/2 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:x.role,onChange:i=>o({...x,role:i.target.value}),children:[e.jsx("option",{value:"Student",children:"All Students"}),e.jsx("option",{value:"Senior",children:"Seniors Only"}),e.jsx("option",{value:"Junior",children:"Juniors Only"}),e.jsx("option",{value:"Probation",children:"Probationary"})]})]})]}),e.jsx("div",{className:"space-y-3",children:a.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No active restrictions. Students have default access."}):a.map(i=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 flex justify-between items-center shadow-sm hover:shadow-md transition",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:i.resource}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300 mt-1",children:[e.jsxs("span",{className:"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 px-2 py-0.5 rounded text-xs font-bold border border-indigo-100 dark:border-indigo-800",children:[i.limit," ",i.unit]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{children:["Applies to: ",e.jsx("strong",{children:i.role})]})]})]}),e.jsx("button",{onClick:()=>r(i.id,i.resource),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:e.jsx(q,{size:18})})]},i.id))})]})}function Pt({schoolId:s,logAction:t,user:a,userData:l}){const[n,h]=d.useState([]),[x,o]=d.useState(!0),[u,r]=d.useState(!1),[i,c]=d.useState({title:"",message:"",target:"All"});d.useEffect(()=>{s&&(async()=>{o(!0);try{const p=M(R(v,`schools/${s}/announcements`),V("createdAt","desc")),N=await T(p);h(N.docs.map(g=>({id:g.id,...g.data()})))}catch(p){console.error("Error loading announcements:",p)}o(!1)})()},[s]);const y=async()=>{if(!i.title.trim()||!i.message.trim())return alert("Title and Message required.");r(!0);try{const b={...i,schoolId:s,authorId:a.uid,authorName:l.displayName||"School Admin",authorRole:l.activeProfileRole||"Admin",createdAt:B()},p=await O(R(v,`schools/${s}/announcements`),b);h(N=>[{id:p.id,...b,createdAt:new Date},...N]),await t("Post Announcement",`Posted: ${i.title}`),c({title:"",message:"",target:"All"})}catch(b){console.error("Post failed:",b),alert("Failed to post announcement.")}r(!1)},f=async b=>{if(confirm("Delete this announcement?"))try{await K(P(v,`schools/${s}/announcements/${b}`)),h(p=>p.filter(N=>N.id!==b)),await t("Delete Announcement","Removed a post")}catch(p){console.error("Delete failed:",p)}};return x?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading News..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ge,{size:18,className:"text-indigo-600"})," Post New Announcement"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"Headline / Title",value:i.title,onChange:b=>c({...i,title:b.target.value})})}),e.jsx("div",{className:"sm:w-1/4",children:e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white cursor-pointer",value:i.target,onChange:b=>c({...i,target:b.target.value}),children:[e.jsx("option",{value:"All",children:"Everyone"}),e.jsx("option",{value:"Student",children:"Students Only"}),e.jsx("option",{value:"Instructor",children:"Staff Only"})]})})]}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Write your message here...",value:i.message,onChange:b=>c({...i,message:b.target.value})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:y,disabled:u||!i.title,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition",children:u?"Posting...":e.jsxs(e.Fragment,{children:[e.jsx(He,{size:16})," Post Announcement"]})})})]})]}),e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsx("div",{className:"text-center text-gray-500 py-10 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No announcements yet."}):n.map(b=>{var p;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm relative group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold dark:text-white",children:b.title}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Re,{size:12})," ",b.authorName]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[b.target==="All"?e.jsx(Ne,{size:12}):e.jsx(re,{size:12}),b.target]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:(p=b.createdAt)!=null&&p.toDate?b.createdAt.toDate().toLocaleDateString():"Just now"})]})]}),e.jsx("button",{onClick:()=>f(b.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition opacity-0 group-hover:opacity-100",title:"Delete Post",children:e.jsx(q,{size:16})})]}),e.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed bg-gray-50 dark:bg-black/20 p-3 rounded-lg",children:b.message})]},b.id)})})]})}function _t({schoolId:s,logAction:t}){const[a,l]=d.useState([]),[n,h]=d.useState(!0),[x,o]=d.useState({name:"",address:"",website:"",contactEmail:""});d.useEffect(()=>{s&&(async()=>{h(!0);try{const c=M(R(v,`schools/${s}/partners`),V("name")),y=await T(c);l(y.docs.map(f=>({id:f.id,...f.data()})))}catch(c){console.error("Error loading partners:",c)}h(!1)})()},[s]);const u=async()=>{if(!x.name)return alert("Partner Name is required.");try{const i={...x,status:"Approved"},c=await O(R(v,`schools/${s}/partners`),i);l(y=>[...y,{id:c.id,...i}]),await t("Add Partner",`Added studio: ${x.name}`),o({name:"",address:"",website:"",contactEmail:""})}catch(i){console.error("Add partner failed:",i),alert("Failed to add partner.")}},r=async(i,c)=>{if(confirm(`Remove ${c} from approved partners?`))try{await K(P(v,`schools/${s}/partners/${i}`)),l(y=>y.filter(f=>f.id!==i)),await t("Remove Partner",`Removed: ${c}`)}catch(y){console.error("Delete failed:",y)}};return n?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Partners..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ge,{size:18,className:"text-indigo-600"})," Add Approved Partner"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio / Company Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"e.g. Sound City Studios",value:x.name,onChange:i=>o({...x,name:i.target.value})})]}),e.jsx("div",{children:e.jsx(kt,{label:"Address",value:x.address,onChange:i=>o({...x,address:i}),onSelect:i=>{o({...x,address:i.formattedAddress||i.displayName})},placeholder:"123 Main St...",showGeolocation:!1})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Contact Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{size:14,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-9 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"manager@studio.com",value:x.contactEmail,onChange:i=>o({...x,contactEmail:i.target.value})})]})]})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsxs("button",{onClick:u,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center gap-2 shadow-md transition",children:[e.jsx(J,{size:18})," Add Partner"]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.length===0?e.jsx("div",{className:"col-span-full text-center py-10 text-gray-500 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No partners added yet."}):a.map(i=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition group relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg truncate pr-8",children:i.name}),e.jsx("button",{onClick:()=>r(i.id,i.name),className:"text-gray-400 hover:text-red-500 absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition",children:e.jsx(q,{size:16})})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-300",children:[i.address&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(D,{size:14,className:"mt-0.5 text-indigo-500 shrink-0"}),e.jsx("span",{className:"truncate",children:i.address})]}),i.contactEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{size:14,className:"text-green-500 shrink-0"}),e.jsx("a",{href:`mailto:${i.contactEmail}`,className:"hover:underline truncate",children:i.contactEmail})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t dark:border-gray-700 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase text-green-600 bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded border border-green-200 dark:border-green-800",children:"Approved"}),i.website&&e.jsx("a",{href:i.website,target:"_blank",rel:"noreferrer",className:"text-gray-400 hover:text-indigo-500",children:e.jsx(Ve,{size:14})})]})]},i.id))})]})}function Tt({schoolId:s,logAction:t,graderName:a}){const[l,n]=d.useState([]),[h,x]=d.useState(!0),[o,u]=d.useState(""),[r,i]=d.useState(null),[c,y]=d.useState([]),[f,b]=d.useState(!1),[p,N]=d.useState(!1),[g,m]=d.useState({technical:5,softSkills:5,notes:""});d.useEffect(()=>{s&&(async()=>{x(!0);try{const E=M(R(v,`schools/${s}/students`),V("displayName")),_=await T(E);n(_.docs.map(I=>({id:I.id,...I.data()})))}catch(E){console.error("Error loading students:",E)}x(!1)})()},[s]),d.useEffect(()=>{if(!r)return;(async()=>{b(!0);try{const E=M(R(v,`schools/${s}/students/${r.id}/evaluations`),V("date","desc")),_=await T(E);y(_.docs.map(I=>({id:I.id,...I.data()})))}catch(E){console.error("Error loading history:",E)}b(!1)})(),N(!1),m({technical:5,softSkills:5,notes:""})},[r,s]);const C=async()=>{if(r)try{const j={...g,evaluator:a||"Instructor",date:B()},E=await O(R(v,`schools/${s}/students/${r.id}/evaluations`),j);y(_=>[{id:E.id,...j,date:new Date},..._]),await t("Grade Student",`Graded ${r.displayName}: Tech(${g.technical}) Soft(${g.softSkills})`),N(!1),alert("Evaluation submitted successfully.")}catch(j){console.error("Grading failed:",j),alert("Failed to save evaluation.")}},A=l.filter(j=>{var E,_;return((E=j.displayName)==null?void 0:E.toLowerCase().includes(o.toLowerCase()))||((_=j.studentId)==null?void 0:_.toLowerCase().includes(o.toLowerCase()))}),S=j=>j>=8?"text-green-500":j>=5?"text-yellow-500":"text-red-500";return h?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roster..."}):e.jsxs("div",{className:"flex flex-col md:flex-row h-[600px] border dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-[#2c2e36] animate-in fade-in shadow-sm",children:[e.jsxs("div",{className:"w-full md:w-1/3 border-r dark:border-gray-700 flex flex-col bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Search Students...",value:o,onChange:j=>u(j.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:A.map(j=>e.jsxs("div",{onClick:()=>i(j),className:`p-3 px-4 cursor-pointer flex justify-between items-center transition border-b dark:border-gray-700/50 last:border-0
                                ${(r==null?void 0:r.id)===j.id?"bg-white dark:bg-[#2c2e36] border-l-4 border-l-indigo-600 shadow-sm":"hover:bg-gray-100 dark:hover:bg-gray-700"}
                            `,children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-bold text-sm ${(r==null?void 0:r.id)===j.id?"text-indigo-700 dark:text-white":"dark:text-gray-300"}`,children:j.displayName}),e.jsxs("div",{className:"text-xs text-gray-500",children:[j.cohort||"General"," • ",j.hoursLogged||0," hrs"]})]}),(r==null?void 0:r.id)===j.id&&e.jsx(We,{size:16,className:"text-indigo-500"})]},j.id))})]}),e.jsx("div",{className:"flex-1 flex flex-col relative",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-700 dark:text-indigo-300 font-bold",children:r.displayName[0]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold dark:text-white",children:r.displayName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",r.studentId||"N/A"]})]})]}),p?e.jsxs("button",{onClick:()=>N(!1),className:"text-gray-500 hover:text-gray-700 dark:hover:text-white flex items-center gap-2 text-sm font-bold",children:[e.jsx(Ye,{size:16})," View History"]}):e.jsxs("button",{onClick:()=>N(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(J,{size:16})," New Evaluation"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-white dark:bg-[#2c2e36]",children:[p&&e.jsxs("div",{className:"max-w-lg mx-auto space-y-6 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-lg border border-indigo-100 dark:border-indigo-800/50 mb-6",children:[e.jsx("h4",{className:"font-bold text-indigo-800 dark:text-indigo-300 mb-1",children:"New Assessment"}),e.jsxs("p",{className:"text-xs text-indigo-600 dark:text-indigo-400",children:["Rating performance for ",new Date().toLocaleDateString(),"."]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300",children:"Technical Proficiency"}),e.jsxs("span",{className:`font-bold ${S(g.technical)}`,children:[g.technical,"/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"1",className:"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",value:g.technical,onChange:j=>m({...g,technical:parseInt(j.target.value)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Knowledge of equipment, software, and signal flow."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300",children:"Soft Skills / Professionalism"}),e.jsxs("span",{className:`font-bold ${S(g.softSkills)}`,children:[g.softSkills,"/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"1",className:"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",value:g.softSkills,onChange:j=>m({...g,softSkills:parseInt(j.target.value)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Punctuality, attitude, communication, and client handling."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300 block mb-2",children:"Instructor Notes"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Detailed feedback...",value:g.notes,onChange:j=>m({...g,notes:j.target.value})})]}),e.jsxs("button",{onClick:C,className:"w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(Le,{size:18})," Submit Evaluation"]})]})]}),!p&&e.jsx("div",{className:"space-y-4",children:f?e.jsx("p",{className:"text-center text-gray-500",children:"Loading history..."}):c.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed dark:border-gray-700 rounded-xl",children:[e.jsx(de,{size:32,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No evaluations recorded yet."}),e.jsx("button",{onClick:()=>N(!0),className:"text-indigo-500 font-bold text-sm mt-2 hover:underline",children:"Start first evaluation"})]}):c.map(j=>{var E;return e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-4 hover:shadow-md transition bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mb-1",children:(E=j.date)!=null&&E.toDate?j.date.toDate().toLocaleDateString():"Unknown Date"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium dark:text-gray-200",children:j.evaluator})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600",children:[e.jsx("div",{className:`font-bold ${S(j.technical)}`,children:j.technical}),e.jsx("div",{className:"text-[9px] text-gray-400 uppercase",children:"Tech"})]}),e.jsxs("div",{className:"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600",children:[e.jsx("div",{className:`font-bold ${S(j.softSkills)}`,children:j.softSkills}),e.jsx("div",{className:"text-[9px] text-gray-400 uppercase",children:"Soft"})]})]})]}),j.notes&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 border-t dark:border-gray-700 pt-3 mt-2",children:['"',j.notes,'"']})]},j.id)})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(de,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"Select a student to view history or submit grades."})]})})]})}function It({schoolId:s,logAction:t}){const[a,l]=d.useState(""),[n,h]=d.useState(!1),x=async()=>{var c;if(!a.trim())return alert("Please paste CSV data first.");h(!0);const u=a.trim().split(`
`);let r=0,i=0;try{for(let y of u){const f=y.split(",");if(f.length>=3){const b=f[0].trim(),p=f[1].trim(),N=f[2].trim(),g=((c=f[3])==null?void 0:c.trim())||"General",m=`${p} ${N}`;b&&p?(await O(R(v,`schools/${s}/students`),{email:b,displayName:m,firstName:p,lastName:N,cohort:g,studentId:"",status:"Enrolled",hoursLogged:0,createdAt:B()}),r++):i++}else i++}await t("Batch Import",`Imported ${r} students. (${i} skipped)`),alert(`Import complete! Added ${r} students.`),l("")}catch(y){console.error("Import failed:",y),alert("Batch import encountered an error.")}h(!1)},o=async()=>{prompt("Type 'ROLLOVER' to confirm. This will archive current internship logs for all students.")==="ROLLOVER"&&(alert("Rollover process initiated. (This is a placeholder for the Cloud Function trigger)."),await t("Term Rollover","Initiated term archival"))};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(qe,{size:18,className:"text-indigo-600"})," Batch Import Students"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-4 border border-blue-100 dark:border-blue-800 text-xs text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Format:"})," ",e.jsx("code",{children:"email, first_name, last_name, cohort"}),e.jsx("br",{}),"Example: ",e.jsx("code",{children:"student@test.edu, John, Doe, Fall 2024"})]}),e.jsx("textarea",{className:"w-full h-40 p-3 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono resize-y focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"Paste CSV data here...",value:a,onChange:u=>l(u.target.value),disabled:n}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:x,disabled:n||!a,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition",children:n?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(Pe,{size:16})," Import Students"]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Je,{size:18,className:"text-orange-500"})," Term Management"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-gray-200 mb-1",children:"End of Term Rollover"}),e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Use this tool at the end of a semester or cohort period. It will:"}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 mt-2 space-y-1 ml-1",children:[e.jsx("li",{children:"Archive all active internship logs."}),e.jsx("li",{children:'Reset "Current Hours" counters (preserving Total Lifetime Hours).'}),e.jsx("li",{children:'Mark graduating students as "Alumni" (optional).'})]})]}),e.jsx("div",{className:"w-full md:w-auto",children:e.jsxs("button",{onClick:o,className:"w-full md:w-auto bg-red-50 hover:bg-red-100 dark:bg-red-900/20 dark:hover:bg-red-900/40 text-red-600 dark:text-red-400 px-4 py-3 rounded-lg font-bold text-xs flex items-center justify-center gap-2 border border-red-200 dark:border-red-800 transition",children:[e.jsx(Ke,{size:16})," Execute Rollover"]})})]})]})]})}function $t({schoolId:s}){const[t,a]=d.useState([]),[l,n]=d.useState(!0),[h,x]=d.useState(50);d.useEffect(()=>{s&&(async()=>{n(!0);try{const r=M(R(v,`schools/${s}/audit_logs`),V("timestamp","desc"),xe(h)),i=await T(r);a(i.docs.map(c=>({id:c.id,...c.data()})))}catch(r){console.error("Error loading audit logs:",r)}n(!1)})()},[s,h]);const o=u=>u.includes("Delete")||u.includes("Remove")?"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400":u.includes("Create")||u.includes("Add")?"text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400":u.includes("Update")||u.includes("Edit")?"text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 bg-gray-100 dark:bg-gray-700 dark:text-gray-300";return l&&t.length===0?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Audit Trail..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(we,{size:16}),e.jsxs("span",{children:["Showing last ",e.jsx("strong",{children:t.length})," actions"]})]}),e.jsxs("button",{onClick:()=>he(t,"audit_logs"),className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(Pe,{size:14})," Export Log"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Timestamp"}),e.jsx("th",{className:"p-3",children:"Admin / Staff"}),e.jsx("th",{className:"p-3",children:"Action Type"}),e.jsx("th",{className:"p-3",children:"Details"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-gray-500",children:"No audit history found."})}):t.map(u=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-gray-500 whitespace-nowrap flex items-center gap-2",children:[e.jsx(ae,{size:14,className:"opacity-50"}),(r=u.timestamp)!=null&&r.toDate?u.timestamp.toDate().toLocaleString():"N/A"]}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:14,className:"text-indigo-500"}),u.adminName||"System"]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider ${o(u.action)}`,children:u.action})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-300 font-mono text-xs",children:u.details})]},u.id)})})]})}),t.length>=h&&e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{onClick:()=>x(u=>u+50),className:"text-xs font-bold text-indigo-600 hover:underline",children:"Load Older Logs"})})]})}function zt({schoolId:s,initialData:t,logAction:a,refreshMeta:l}){const[n,h]=d.useState(t||{}),{uploadImage:x,uploading:o}=ft();d.useEffect(()=>{t&&h(t)},[t]);const u=async()=>{try{await z(P(v,"schools",s),n),alert("School settings updated successfully."),l&&l(n),await a("Update Settings","Updated school configuration")}catch(c){console.error("Update failed:",c),alert("Failed to update school settings.")}},r=async c=>{const y=c.target.files[0];if(!(!y||!s))try{const f=await x(y,`schools/${s}/images/logo`);f&&(await z(P(v,"schools",s),{logoURL:f}),h(b=>({...b,logoURL:f})),l&&l({...n,logoURL:f}),await a("Update Logo","Uploaded new school logo"))}catch(f){console.error("Logo upload failed",f),alert("Failed to upload logo.")}},i=c=>{h(y=>({...y,[c]:!y[c]}))};return!n.name&&!t?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Settings..."}):e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("section",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"h-32 w-32 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300 dark:border-gray-600",children:[n.logoURL?e.jsx("img",{src:n.logoURL,className:"h-full w-full object-contain",alt:"Logo"}):e.jsx(Y,{size:40,className:"text-gray-400"}),o&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white text-xs",children:"Uploading..."})]}),e.jsxs("label",{className:"absolute bottom-2 right-2 bg-indigo-600 p-2 rounded-full text-white cursor-pointer shadow-lg hover:bg-indigo-700 transition",children:[e.jsx(Xe,{size:14}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:r,disabled:o})]})]}),e.jsxs("div",{className:"flex-1 w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"School Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:n.name||"",onChange:c=>h({...n,name:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Primary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",className:"h-10 w-10 p-0 border-0 rounded cursor-pointer",value:n.primaryColor||"#4f46e5",onChange:c=>h({...n,primaryColor:c.target.value})}),e.jsx("input",{className:"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono",value:n.primaryColor||"",onChange:c=>h({...n,primaryColor:c.target.value})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:n.address||"",onChange:c=>h({...n,address:c.target.value})})]})]})]})]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Website"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:n.website||"",onChange:c=>h({...n,website:c.target.value}),placeholder:"https://"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Contact Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:n.contactEmail||"",onChange:c=>h({...n,contactEmail:c.target.value}),placeholder:"admin@school.edu"})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2",children:[e.jsx(de,{size:18,className:"text-indigo-600"})," Academic Structure"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Cohort Mode"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:n.cohortMode||"Semester",onChange:c=>h({...n,cohortMode:c.target.value}),children:[e.jsx("option",{value:"Semester",children:"Semester Based"}),e.jsx("option",{value:"Trimester",children:"Trimester"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Rolling",children:"Rolling"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Grading Scale"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:n.gradingScale||"1-10",onChange:c=>h({...n,gradingScale:c.target.value}),children:[e.jsx("option",{value:"1-10",children:"Numeric (1-10)"}),e.jsx("option",{value:"Pass/Fail",children:"Pass/Fail"}),e.jsx("option",{value:"Letter",children:"Letter Grades"})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2",children:[e.jsx(Qe,{size:18,className:"text-indigo-600"})," Operational Rules"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Strict Geofencing"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Require GPS location match for clock-in"})]}),e.jsx("button",{onClick:()=>i("geofencing"),children:n.geofencing?e.jsx(be,{size:24,className:"text-indigo-600"}):e.jsx(ye,{size:24,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Supervisor Approval"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Require partner studio sign-off on hours"})]}),e.jsx("button",{onClick:()=>i("requireApproval"),children:n.requireApproval?e.jsx(be,{size:24,className:"text-indigo-600"}):e.jsx(ye,{size:24,className:"text-gray-400"})})]})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:u,className:"w-full sm:w-auto bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(Le,{size:18})," Save Configuration"]})})]})}function Mt({user:s,userData:t,allowedTabs:a,staffTitle:l,currentView:n}){var A;const{schoolId:h}=ie(),x=n?n.replace("edu-",""):a?a[0]:"overview",[o,u]=d.useState(h||null),[r,i]=d.useState(null),[c,y]=d.useState([]),[f,b]=d.useState(!1),[p,N]=d.useState({name:"",address:"",primaryColor:"#4f46e5"}),g=(A=t==null?void 0:t.accountTypes)==null?void 0:A.includes("Admin");d.useEffect(()=>{g&&(async()=>{try{const E=(await T(R(v,"schools"))).docs.map(_=>({id:_.id,..._.data()}));y(E),!o&&!h&&E.length>0&&u(E[0].id)}catch(j){console.error("Error fetching schools list:",j)}})()},[g,o]),d.useEffect(()=>{if(!o)return;(async()=>{try{const j=M(R(v,"schools"),G("__name__","==",o)),E=await T(j);E.empty||i(E.docs[0].data())}catch(j){console.error("Error loading school meta:",j)}})()},[o]);const m=async(S,j)=>{if(o)try{await O(R(v,`schools/${o}/audit_logs`),{action:S,details:j,adminId:s.uid,adminName:`${t.firstName} ${t.lastName}`,timestamp:B()})}catch(E){console.error("Failed to log action:",E)}},C=async()=>{if(p.name)try{const S=await O(R(v,"schools"),{...p,createdAt:B(),requiredHours:100});await O(R(v,`schools/${S.id}/roles`),{name:"Admin",color:"#dc2626",permissions:ce.map(j=>j.id)}),y(j=>[...j,{id:S.id,...p}]),u(S.id),b(!1),N({name:"",address:"",primaryColor:"#4f46e5"})}catch(S){console.error("Error creating school:",S),alert("Failed to create school.")}};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6 relative overflow-hidden",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2 z-10",children:r!=null&&r.logoURL?e.jsx("img",{src:r.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(Y,{size:40,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left z-10",children:[e.jsxs("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight flex items-center justify-center md:justify-start gap-3",children:[(r==null?void 0:r.name)||"Select School",g&&!l&&e.jsxs("div",{className:"relative group",children:[e.jsx("select",{className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",value:o||"",onChange:S=>u(S.target.value),children:c.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 border-none rounded-lg text-sm font-bold p-1 px-2 flex items-center gap-1 pointer-events-none group-hover:bg-gray-200 dark:group-hover:bg-gray-600 transition",children:[e.jsx("span",{children:"Switch"})," ",e.jsx(re,{size:10})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400 mt-1",children:[l?e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:[l," Dashboard"]}):e.jsx("span",{className:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Global Admin Mode"}),(r==null?void 0:r.address)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{size:12})," ",r.address]})]})]})]}),g&&e.jsx("div",{className:"z-10",children:e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 transition shadow-md",children:[e.jsx(J,{size:16})," New School"]})}),e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-indigo-600/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"})]}),e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 min-h-[400px] p-4",children:o?e.jsxs(e.Fragment,{children:[x==="overview"&&e.jsx(vt,{schoolId:o,schoolData:r}),x==="roster"&&e.jsx(Nt,{schoolId:o,logAction:m}),x==="hours"&&e.jsx(Ct,{schoolId:o}),x==="instructors"&&e.jsx(Et,{schoolId:o,logAction:m}),x==="roles"&&e.jsx(Rt,{schoolId:o,logAction:m}),x==="resources"&&e.jsx(Lt,{schoolId:o,logAction:m}),x==="news"&&e.jsx(Pt,{schoolId:o,logAction:m,user:s,userData:t}),x==="partners"&&e.jsx(_t,{schoolId:o,logAction:m}),x==="evaluations"&&e.jsx(Tt,{schoolId:o,logAction:m,graderName:t.displayName}),x==="cohorts"&&e.jsx(It,{schoolId:o,logAction:m}),x==="audit"&&e.jsx($t,{schoolId:o}),x==="settings"&&e.jsx(zt,{schoolId:o,initialData:r,logAction:m,refreshMeta:S=>i(j=>({...j,...S}))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-gray-500",children:[e.jsx(Y,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"Please select or create a school to manage."})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Create School"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"School Name",value:p.name,onChange:S=>N({...p,name:S.target.value})}),e.jsx("button",{onClick:C,className:"w-full bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700",children:"Create"}),e.jsx("button",{onClick:()=>b(!1),className:"w-full text-gray-500 text-sm hover:underline",children:"Cancel"})]})})]})}function ds({user:s,userData:t,currentView:a}){const{myPermissions:l,staffProfile:n}=ie(),h={manage_roster:"roster",manage_enrollment:"cohorts",approve_hours:"hours",manage_partners:"partners",grade_students:"evaluations",post_announcements:"news",manage_resources:"resources",manage_staff:"instructors",view_audit:"audit",edit_settings:"settings"},x=l.includes("ALL")?Object.values(h):l.map(o=>h[o]).filter(Boolean);return x.length===0&&!l.includes("ALL")?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-gray-500",children:[e.jsx(Ee,{size:48,className:"mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-bold",children:"Access Restricted"}),e.jsx("p",{children:"You are listed as staff but have no assigned permissions."})]}):e.jsx(Mt,{user:s,userData:t,allowedTabs:x,staffTitle:n==null?void 0:n.roleName,currentView:a})}function cs({user:s,userData:t}){const{schoolData:a,studentProfile:l,internshipStudio:n,checkIn:h,checkOut:x}=ie(),[o,u]=d.useState(""),[r,i]=d.useState(!1),c=async()=>{i(!0);try{l!=null&&l.isClockedIn?(await x(o),u("")):await h((n==null?void 0:n.name)||"Remote Internship","studio")}catch(f){console.error(f)}i(!1)};if(!l)return e.jsx("div",{className:"p-8 text-center",children:"Loading student profile..."});const y=Math.min(100,(l.hoursLogged||0)/((a==null?void 0:a.requiredHours)||100)*100);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"h-20 w-20 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-1",children:a!=null&&a.logoURL?e.jsx("img",{src:a.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(Y,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight mb-1",children:(a==null?void 0:a.name)||"Internship Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Active Intern"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Cohort: ",l.cohort]})]})]}),e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("div",{className:"text-3xl font-black dark:text-white text-indigo-600",children:l.hoursLogged||0}),e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider",children:"Total Hours"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-gradient-to-br from-indigo-900 to-slate-900 text-white p-8 rounded-2xl relative overflow-hidden shadow-lg border border-indigo-800/50",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-xs font-bold uppercase tracking-widest opacity-60 mb-2",children:"Assigned Studio Location"}),e.jsx("h2",{className:"text-3xl font-extrabold mb-4 tracking-tight",children:(n==null?void 0:n.name)||"Pending Assignment"}),n?e.jsxs("div",{className:"space-y-3 text-sm opacity-90",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(D,{size:18,className:"text-indigo-400"})," ",n.address||"Address not listed"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ue,{size:18,className:"text-green-400"})," Status: Active Placement"]})]}):e.jsxs("div",{className:"bg-white/10 p-4 rounded-xl flex items-start gap-3 border border-white/10",children:[e.jsx(Ze,{className:"text-yellow-400 shrink-0 mt-0.5",size:20}),e.jsx("p",{className:"text-sm leading-relaxed",children:"You haven't been assigned an internship location yet. Please contact your school coordinator to get placed."})]})]}),e.jsx("div",{className:"absolute -right-12 -bottom-12 w-64 h-64 bg-indigo-600/20 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ae,{className:l.isClockedIn?"text-green-500 animate-pulse":"text-gray-400"}),l.isClockedIn?"Currently Working":"Time Clock"]}),l.isClockedIn&&e.jsx("textarea",{className:"w-full p-3 text-sm border rounded-xl mb-4 dark:bg-black/20 dark:border-gray-600 dark:text-white resize-none focus:ring-2 focus:ring-indigo-500 outline-none",rows:"4",placeholder:"Describe your tasks for this session...",value:o,onChange:f=>u(f.target.value)})]}),e.jsx("button",{onClick:c,disabled:r||!n&&!l.isClockedIn,className:`w-full py-3.5 rounded-xl font-bold text-white transition shadow-lg transform active:scale-95 ${r?"bg-gray-400":l.isClockedIn?"bg-red-500 hover:bg-red-600 shadow-red-500/30":"bg-green-600 hover:bg-green-700 shadow-green-600/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none"}`,children:r?"Processing...":l.isClockedIn?"Clock Out":"Clock In"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"dark:text-white",children:"Completion Progress"}),e.jsxs("span",{className:"text-indigo-600",children:[Math.round(y),"%"]})]}),e.jsx("div",{className:"w-full h-4 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-1000 ease-out",style:{width:`${y}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-center",children:[l.hoursLogged," / ",(a==null?void 0:a.requiredHours)||100," Hours Required"]})]})]})}function us({user:s,onComplete:t,onSkip:a}){const[l,n]=d.useState(""),[h,x]=d.useState([]),[o,u]=d.useState(null),[r,i]=d.useState(""),[c,y]=d.useState(""),[f,b]=d.useState(!1),p=async g=>{if(g.length<3){x([]);return}const m=M(R(v,"schools"),G("name",">=",g),G("name","<=",g+"")),C=await T(m);x(C.docs.map(A=>({id:A.id,...A.data()})))},N=async()=>{if(!o||!r){y("Please select a school and enter your ID.");return}y(""),b(!0);try{await z(P(v,"users",s.uid),{schoolId:o.id,studentId:r,accountTypes:["user","student"]}),t()}catch(g){console.error("Enrollment error:",g),y("Enrollment failed. Please try again.")}finally{b(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Student Enrollment"}),e.jsx("p",{className:"text-gray-500",children:"Search for your school and enter your student ID to link your account."}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search for your school...",value:l,onChange:g=>{n(g.target.value),p(g.target.value)},className:"w-full pl-10 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white"}),e.jsx(se,{className:"absolute left-3 top-3 text-gray-400",size:16})]}),l.length>0&&h.length>0&&e.jsx("div",{className:"border rounded-lg max-h-40 overflow-y-auto dark:border-gray-700 bg-white dark:bg-gray-800",children:h.map(g=>e.jsxs("div",{className:`p-3 cursor-pointer hover:bg-indigo-50 dark:hover:bg-gray-700/50 ${(o==null?void 0:o.id)===g.id?"bg-indigo-100 dark:bg-indigo-900/50":""}`,onClick:()=>{u(g),n(g.name),x([])},children:[e.jsx("div",{className:"font-medium dark:text-white",children:g.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[g.city,", ",g.state]})]},g.id))}),o&&e.jsxs("div",{className:"space-y-4 pt-4 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("p",{className:"text-sm font-bold dark:text-white",children:["Selected: ",e.jsx("span",{className:"text-indigo-600",children:o.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Student ID Number"}),e.jsx("input",{type:"text",value:r,onChange:g=>i(g.target.value),className:"w-full p-2 border rounded-lg mt-1 dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g., SESH00123"})]}),c&&e.jsx("p",{className:"text-red-500 text-sm",children:c}),e.jsx("button",{onClick:N,disabled:f||!r,className:"w-full bg-indigo-600 text-white p-2 rounded-lg font-bold hover:bg-indigo-700 transition disabled:opacity-50",children:f?"Verifying...":"Link Student Account"})]}),e.jsx("button",{onClick:a,className:"w-full text-sm text-gray-500 hover:text-indigo-600 mt-2",children:"Skip enrollment for now"})]})}export{Bt as A,cs as B,ds as C,oe as D,xt as E,Mt as F,ee as G,Zt as H,Z as I,is as J,Jt as P,Wt as R,Dt as S,nt as T,je as V,ns as a,ft as b,Vt as c,ot as d,dt as e,ls as f,Gt as g,ut as h,gt as i,ke as j,as as k,rs as l,ss as m,es as n,ts as o,Qt as p,kt as q,mt as r,Kt as s,Xt as t,ie as u,Ht as v,Yt as w,qt as x,us as y,os as z};
