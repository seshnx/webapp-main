import{r as m,j as e,z as Ne,cU as Le,cV as Me,a9 as ke,Z as Te,T as Ee,x as Ve,c9 as Ae,g as $e,cW as Ye,cE as Ge,ce as X,L as ge,Q as le,X as ye,w as We,O as Be,V as He,cX as Je,v as Ue,a as Xe,cN as Ze,cY as qe,a3 as Qe,cZ as Ke,U as fe,S as Pe,bP as pe}from"./vendor-mIyI6DiM.js";import{k as De,l as es,m as be,n as ss,o as ts,p as je,r as as,s as we,t as ns,v as rs,i as is,w as ce,h as os,x as ds,y as ls}from"./index-BCKV8ync.js";import{S as ve,R as cs}from"./ReportModal-MivBJc5d.js";import{c as Ie}from"./useNotifications-42Kdrv6W.js";import{U as oe,b as gs}from"./chat-P1NCmzAv.js";import{m as k,A as D}from"./vendor-framer-_HoVf1_M.js";import{a as xs}from"./useVercelUpload-DnObj6TS.js";import{POPULAR_PLUGINS_LIST as ms}from"./config-VNvva2Pv.js";import{M as hs}from"./Inputs-DvD9MlMc.js";import{F as Se,u as xe}from"./FollowButton-CXf-Lq9F.js";import"./edu-V9buPGJB.js";import"./vendor-audio-CY3oQc7h.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="3fd17115-5be0-4f21-9380-fcb5d57adfc8",s._sentryDebugIdIdentifier="sentry-dbid-3fd17115-5be0-4f21-9380-fcb5d57adfc8")})()}catch{}function us({post:s,currentUser:t,currentUserData:a,blockedUsers:h,onCountChange:g}){const[l,r]=m.useState([]),[i,n]=m.useState(""),[F,y]=m.useState(!1);m.useEffect(()=>{if(!s.id)return;I();const c=setInterval(I,3e4);return()=>{clearInterval(c)}},[s.id,h]);const I=async()=>{try{const c=await De(s.id);if(c){const w=c.filter(S=>!(h!=null&&h.includes(S.user_id)));r(w),g(w.length)}}catch(c){console.error("Comments fetch error:",c)}},O=async c=>{var V;c.preventDefault();const w=(t==null?void 0:t.id)||(t==null?void 0:t.uid);if(!i.trim()||!w)return;y(!0);const S=(a==null?void 0:a.effectiveDisplayName)||(a==null?void 0:a.firstName)||(t==null?void 0:t.displayName)||"User";try{const b=i.trim();if(!b){alert("Please enter a comment"),y(!1);return}await es({post_id:s.id,user_id:w,content:b}),await be(s.id,1),await I(),s.userId!==w&&Ie({targetUserId:s.userId,type:"comment",fromUserId:w,fromUserName:S,fromUserPhoto:a==null?void 0:a.photoURL,postId:s.id,postPreview:(V=s.text)==null?void 0:V.substring(0,50),message:"commented on your post"}),n(""),y(!1)}catch(b){console.error("Comment submission error:",b),alert(`Failed to post comment: ${b.message||"Unknown error"}`),y(!1)}},E=async c=>{if(window.confirm("Delete comment?"))try{await ss(c),await be(s.id,-1),await I()}catch(w){console.error("Delete comment error:",w)}};return e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] border-t dark:border-gray-700 p-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-4 mb-4 max-h-80 overflow-y-auto custom-scrollbar pr-2",children:[l.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-2",children:"No comments yet. Be the first!"}),l.map(c=>e.jsxs("div",{className:"group flex gap-3 text-sm",children:[e.jsx(oe,{src:c.userPhoto,name:c.displayName,size:"xs",className:"shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card border dark:border-gray-700 p-3 rounded-2xl rounded-tl-none inline-block max-w-full",children:[e.jsxs("div",{className:"flex justify-between items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-bold dark:text-white text-xs truncate",children:c.displayName}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0",children:c.timestamp?new Date(c.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Just now"})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 break-words",children:c.text})]}),e.jsxs("div",{className:"flex gap-3 mt-1 ml-2",children:[e.jsx("button",{className:"text-[10px] font-bold text-gray-500 hover:text-brand-blue transition",children:"Reply"}),c.userId===(t==null?void 0:t.uid)&&e.jsx("button",{onClick:()=>E(c.id),className:"text-[10px] font-bold text-gray-400 hover:text-red-500 transition",children:"Delete"})]})]})]},c.id))]}),e.jsxs("form",{onSubmit:O,className:"flex gap-2",children:[e.jsx(oe,{src:a==null?void 0:a.photoURL,name:(a==null?void 0:a.firstName)||"You",size:"xs",className:"shrink-0 hidden sm:block"}),e.jsx("input",{className:"flex-1 bg-white dark:bg-dark-card border dark:border-gray-600 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition",placeholder:"Write a comment...",value:i,onChange:c=>n(c.target.value)}),e.jsx("button",{type:"submit",disabled:!i.trim()||F,className:"bg-brand-blue text-white p-2 rounded-full hover:bg-blue-600 disabled:opacity-50 transition shadow-sm",children:e.jsx(Ne,{size:16,className:F?"animate-pulse":""})})]})]})}const ys=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"],fs=s=>s?s.split(/(\s+)/).map((t,a)=>t.match(/^#\w+/)?e.jsx("span",{className:"text-brand-blue font-bold cursor-pointer hover:underline",children:t},a):t.match(/^@\w+/)?e.jsx("span",{className:"text-purple-600 font-bold cursor-pointer hover:underline",children:t},a):t):null,ps={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},exit:{opacity:0,scale:.95,transition:{duration:.2}}};function bs({post:s,currentUser:t,currentUserData:a,openPublicProfile:h,onReport:g,onDelete:l,isFollowingAuthor:r,onToggleFollow:i,autoPlayVideos:n=!1}){var te,ae;const[F,y]=m.useState(!1),[I,O]=m.useState(s.commentCount||0),[E,c]=m.useState(!1),[w,S]=m.useState(!1),[V,b]=m.useState(!1),[L,ee]=m.useState(!1),[Q,Z]=m.useState(!1),H=m.useRef(null),U=m.useRef(null),R=(t==null?void 0:t.id)||(t==null?void 0:t.uid),$=s.userId===R,o=(te=s.reactions)==null?void 0:te[R],N=s.reactions?Object.values(s.reactions).reduce((d,p)=>(d[p]=(d[p]||0)+1,d),{}):{},f=Object.values(N).reduce((d,p)=>d+p,0);m.useEffect(()=>{if(!R)return;(async()=>{try{const p=await ts(R,s.id);c(p)}catch(p){console.error("Error checking saved status:",p),c(!1)}})()},[R,s.id]),m.useEffect(()=>{const d=p=>{H.current&&!H.current.contains(p.target)&&S(!1),U.current&&!U.current.contains(p.target)&&b(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const A=async d=>{var p;if(S(!1),!!R)try{const G=!!o,ne=s.reactions||{};if(o===d){const x={...ne};delete x[R],await je(s.id,{reactions:x,reaction_count:Math.max((s.reactionCount||0)-1,0)})}else{const x={...ne,[R]:d},W=o?0:1;await je(s.id,{reactions:x,reaction_count:(s.reactionCount||0)+W}),!G&&!$&&Ie({targetUserId:s.userId,type:"like",fromUserId:R,fromUserName:(a==null?void 0:a.effectiveDisplayName)||(a==null?void 0:a.firstName)||"Someone",fromUserPhoto:a==null?void 0:a.photoURL,postId:s.id,postPreview:(p=s.text)==null?void 0:p.substring(0,50),message:`reacted ${d} to your post`})}}catch(G){console.error("Reaction failed",G),X.error("Couldn't add reaction")}},q=async()=>{var d,p;if(!(!R||Q)){Z(!0);try{E?(await as(R,s.id),await we(s.id,-1),c(!1),X.success("Removed from saved")):(await ns(R,s.id,{author_id:s.userId,author_name:s.displayName,preview:((d=s.text)==null?void 0:d.substring(0,100))||"Media post",has_media:!!((p=s.attachments)!=null&&p.length||s.imageUrl||s.audioUrl)}),await we(s.id,1),c(!0),X.success("Post saved!"))}catch(G){console.error("Save failed",G),X.error("Couldn't save post")}Z(!1)}},se=async()=>{var p;const d=`${window.location.origin}/post/${s.id}`;if(navigator.share)try{await navigator.share({title:`Post by ${s.displayName}`,text:((p=s.text)==null?void 0:p.substring(0,100))||"Check out this post",url:d})}catch(G){G.name!=="AbortError"&&M(d)}else M(d)},M=d=>{navigator.clipboard.writeText(d),ee(!0),X.success("Link copied to clipboard!"),setTimeout(()=>ee(!1),2e3)},K=async()=>{if($&&window.confirm("Are you sure you want to delete this post?"))try{if(!await rs(s.id)){X.error("Couldn't delete post - permission denied");return}X.success("Post deleted"),l&&l(s.id)}catch(d){console.error("Delete failed:",d),X.error("Couldn't delete post")}};return e.jsxs(k.div,{variants:ps,initial:"hidden",animate:"show",exit:"exit",layout:!0,className:"bg-white dark:bg-dark-card border dark:border-gray-700 rounded-xl overflow-visible shadow-sm mb-4 relative",children:[e.jsxs("div",{className:"p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"cursor-pointer shrink-0",onClick:()=>s.userId&&h(s.userId),role:"button",tabIndex:0,"aria-label":`View ${s.displayName||"user"}'s profile`,children:e.jsx(oe,{src:s.authorPhoto,name:s.displayName,size:"md"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm hover:underline decoration-brand-blue cursor-pointer truncate",onClick:()=>s.userId&&h(s.userId),children:s.displayName||"Unknown User"}),!$&&i&&!r&&e.jsx("button",{onClick:d=>{d.stopPropagation(),i()},className:"text-xs font-bold text-brand-blue hover:text-blue-700 transition shrink-0",children:"â€¢ Follow"})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"truncate",children:s.role}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"shrink-0",children:s.timestamp||s.created_at?new Date(s.timestamp||s.created_at).toLocaleDateString():"Just now"})]})]})]}),e.jsxs("div",{className:"relative",ref:U,children:[e.jsx("button",{className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>b(!V),children:e.jsx(Le,{size:20})}),e.jsx(D,{children:V&&e.jsxs(k.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden z-50",children:[e.jsxs("button",{onClick:()=>{M(`${window.location.origin}/post/${s.id}`),b(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(Me,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Copy link"})]}),!$&&e.jsxs(e.Fragment,{children:[i&&e.jsxs("button",{onClick:()=>{i(),b(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(ke,{size:16,className:"text-gray-400"}),e.jsxs("span",{className:"dark:text-gray-200",children:[r?"Unfollow":"Follow"," ",(ae=s.displayName)==null?void 0:ae.split(" ")[0]]})]}),e.jsxs("button",{onClick:()=>{g(),b(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(Te,{size:16}),e.jsx("span",{children:"Report post"})]})]}),$&&e.jsxs("button",{onClick:()=>{K(),b(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(Ee,{size:16}),e.jsx("span",{children:"Delete post"})]})]})})]})]}),e.jsxs("div",{className:"px-4 pb-2",children:[s.text&&e.jsx("p",{className:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap text-sm leading-relaxed mb-3",children:fs(s.text)}),s.attachments&&s.attachments.length>0&&e.jsx("div",{className:`grid gap-2 mb-3 ${s.attachments.length>1?"grid-cols-2":"grid-cols-1"}`,children:s.attachments.map((d,p)=>e.jsxs("div",{className:"rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 relative",children:[d.type==="image"&&e.jsx("img",{src:d.url,className:"w-full h-auto object-contain rounded-lg",alt:"content",style:{maxHeight:"600px"}}),d.type==="video"&&e.jsx("video",{src:d.url,controls:!0,className:"w-full h-auto object-contain bg-black rounded-lg",style:{maxHeight:"600px"},autoPlay:n,playsInline:!0,muted:n,preload:"metadata"}),d.type==="audio"&&e.jsx("div",{className:"w-full",children:e.jsx(ve,{audioUrl:d.url,fileName:d.name||"Audio Track"})})]},p))}),s.audioUrl&&!s.attachments&&e.jsx("div",{className:"rounded-lg overflow-hidden bg-transparent mb-3",children:e.jsx(ve,{audioUrl:s.audioUrl,fileName:s.audioName||"Track"})}),s.imageUrl&&!s.attachments&&e.jsx("div",{className:"rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 mb-3",children:e.jsx("img",{src:s.imageUrl,className:"w-full h-auto object-contain rounded-lg",alt:"legacy content",style:{maxHeight:"600px"}})})]}),(f>0||s.saveCount>0)&&e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:Object.entries(N).map(([d,p])=>e.jsxs(k.div,{initial:{scale:0},animate:{scale:1},className:`text-xs px-2 py-1 rounded-full border flex items-center gap-1 ${o===d?"bg-blue-50 border-blue-200 dark:bg-blue-900/30 dark:border-blue-800":"bg-gray-50 border-gray-100 dark:bg-gray-800 dark:border-gray-700"} dark:text-gray-300`,children:[e.jsx("span",{children:d}),e.jsx("span",{className:"font-bold",children:p})]},d))}),s.saveCount>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[s.saveCount," save",s.saveCount!==1?"s":""]})]}),e.jsxs("div",{className:"px-4 py-3 border-t dark:border-gray-700 flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(k.button,{whileTap:{scale:.9},onClick:()=>S(!w),className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg ${o?"text-blue-600 bg-blue-50 dark:bg-blue-900/20":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[o?e.jsx("span",{className:"text-lg",children:o}):e.jsx(Ve,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:o?"Reacted":"React"})]}),e.jsx(D,{children:w&&e.jsx(k.div,{ref:H,initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},className:"absolute bottom-full left-0 mb-2 bg-white dark:bg-gray-800 shadow-xl rounded-full p-2 flex gap-1 sm:gap-2 z-50 border dark:border-gray-600 origin-bottom-left",children:ys.map(d=>e.jsx(k.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:p=>{p.stopPropagation(),A(d)},className:`text-xl p-1 sm:p-1.5 rounded-full ${o===d?"bg-blue-100 dark:bg-blue-900":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:d},d))})})]}),e.jsxs(k.button,{whileTap:{scale:.95},onClick:()=>y(!F),className:"flex items-center gap-1.5 sm:gap-2 text-sm font-medium text-gray-500 hover:text-brand-blue transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx(Ae,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:I>0?I:"Comment"}),I>0&&e.jsx("span",{className:"sm:hidden",children:I})]}),e.jsxs(k.button,{whileTap:{scale:.95},onClick:se,className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 ${L?"text-green-500":"text-gray-500 hover:text-green-500"}`,children:[L?e.jsx($e,{size:18}):e.jsx(Ye,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:L?"Copied!":"Share"})]})]}),e.jsx(k.button,{whileTap:{scale:.8},onClick:q,disabled:Q,className:`${E?"text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"} transition p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full disabled:opacity-50`,title:E?"Remove from saved":"Save post",children:e.jsx(Ge,{size:18,fill:E?"currentColor":"none"})})]}),e.jsx(D,{children:F&&e.jsx(k.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx(us,{post:s,currentUser:t,currentUserData:a,blockedUsers:[],onCountChange:O})})})]})}function js({user:s,userData:t,subProfiles:a={},onPost:h}){var $;const[g,l]=m.useState(""),[r,i]=m.useState([]),[n,F]=m.useState(!1),[y,I]=m.useState([]),[O,E]=m.useState(null),[c,w]=m.useState(!1),[S,V]=m.useState({current:0,total:0,percent:0}),b=(t==null?void 0:t.activeProfileRole)||(($=t==null?void 0:t.accountTypes)==null?void 0:$[0])||"Fan",L=(a==null?void 0:a[b])||{},Q=(o=>{var N;if(o==="User"||o==="Fan")return o;if(o==="Talent"){const f=a==null?void 0:a.Talent,A=((N=f==null?void 0:f.profile_data)==null?void 0:N.talentSubRole)||(f==null?void 0:f.talentSubRole);if(A&&A!=="")return A}return o})(b),{uploadMedia:Z}=xs("post-media"),H=(o,N)=>{if(o.target.files&&o.target.files[0]){const f=o.target.files[0],A=URL.createObjectURL(f);i([...r,{file:f,type:N,previewUrl:A}])}},U=o=>{i(r.filter((N,f)=>f!==o))},R=async()=>{if(!(!g.trim()&&r.length===0)){w(!0);try{const o=r.length+(O?1:0);let N=0;const f=()=>{N++,V({current:N,total:o,percent:Math.round(N/o*100)})};V({current:0,total:o,percent:0});const A=[];for(const M of r){const K=await Z(M.file);K&&A.push({url:K.url,type:M.type}),f()}let q=null;if(O){const M=await Z(O);q=M==null?void 0:M.url,f()}const se={text:g,attachments:A.filter(M=>M!==null),seshFx:n&&(y.length>0||q)?{plugins:y,presetUrl:q,presetName:O?O.name:null}:null};await h(se),l(""),i([]),F(!1),I([]),E(null),V({current:0,total:0,percent:0})}catch(o){console.error("Error creating post:",o),alert("Failed to create post. Please try again.")}finally{w(!1)}}};return e.jsxs("div",{className:"bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-gray-700 shadow-sm mb-6",children:[e.jsx(D,{children:c&&S.total>0&&e.jsx(k.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4 overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-4 border border-blue-100 dark:border-blue-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"relative",children:e.jsx(ge,{className:"animate-spin text-brand-blue",size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white",children:"Getting Post Ready..."}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Uploading ",S.current," of ",S.total," files"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 overflow-hidden",children:e.jsx(k.div,{className:"h-full bg-gradient-to-r from-brand-blue to-purple-500 rounded-full",initial:{width:0},animate:{width:`${S.percent}%`},transition:{duration:.3,ease:"easeOut"}})}),e.jsx("div",{className:"flex justify-end mt-1",children:e.jsxs("span",{className:"text-xs font-semibold text-brand-blue",children:[S.percent,"%"]})})]})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden shrink-0",children:L!=null&&L.photo_url||t!=null&&t.photoURL?e.jsx("img",{src:(L==null?void 0:L.photo_url)||(t==null?void 0:t.photoURL),className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-brand-blue"})}),b!=="Fan"&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-brand-blue text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full border-2 border-white dark:border-[#2c2e36]",children:Q})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{className:"w-full bg-transparent outline-none text-gray-900 dark:text-white placeholder-gray-500 min-h-[80px] resize-none",placeholder:"What's creating sound today? (#tags @mentions)",value:g,onChange:o=>l(o.target.value),disabled:c}),r.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:r.map((o,N)=>e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black/5 border dark:border-gray-600 aspect-video group flex items-center justify-center",children:[o.type==="image"&&e.jsx("img",{src:o.previewUrl,className:"h-full w-full object-cover"}),o.type==="video"&&e.jsx("video",{src:o.previewUrl,className:"h-full w-full object-cover"}),o.type==="audio"&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-brand-blue bg-gray-100 dark:bg-gray-800 w-full h-full",children:[e.jsx(le,{size:32}),e.jsx("span",{className:"text-xs text-gray-500 mt-2 truncate max-w-[90%] px-2",children:o.file.name})]}),!c&&e.jsx("button",{onClick:()=>U(N),className:"absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-red-500",children:e.jsx(ye,{size:12})})]},N))}),n&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-3 border border-blue-100 dark:border-blue-800/50 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue uppercase",children:"SeshFx Data"}),e.jsx("button",{onClick:()=>F(!1),children:e.jsx(ye,{size:14,className:"text-gray-400 hover:text-brand-blue"})})]}),e.jsx(hs,{label:"",options:ms,initialValues:y,onChange:(o,N)=>I(N)}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(We,{size:14,className:"text-gray-400"}),e.jsx("input",{type:"file",className:"text-xs text-gray-500 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:bg-white dark:file:bg-gray-700 dark:file:text-white",onChange:o=>E(o.target.files[0])})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("label",{className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-brand-blue cursor-pointer transition ${c?"opacity-50 pointer-events-none":""}`,title:"Add Image",children:[e.jsx(Be,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:o=>H(o,"image"),disabled:c})]}),e.jsxs("label",{className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-green-500 cursor-pointer transition ${c?"opacity-50 pointer-events-none":""}`,title:"Add Video",children:[e.jsx(He,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:o=>H(o,"video"),disabled:c})]}),e.jsxs("label",{className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-purple-500 cursor-pointer transition ${c?"opacity-50 pointer-events-none":""}`,title:"Add Audio Track",children:[e.jsx(le,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"audio/*",onChange:o=>H(o,"audio"),disabled:c})]}),e.jsx("button",{onClick:()=>F(!n),disabled:c,className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition ${n?"bg-blue-50 dark:bg-blue-900/20 text-brand-blue":"text-gray-400"} ${c?"opacity-50":""}`,title:"Add Plugin Data",children:e.jsx(Je,{size:20})})]}),e.jsx("button",{onClick:R,disabled:c||!g&&r.length===0,className:"bg-brand-blue text-white px-5 py-1.5 rounded-full font-bold text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition",children:c?e.jsx(ge,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Post"})," ",e.jsx(Ne,{size:14})]})})]})]})]})]})}function _({title:s,description:t,items:a,loading:h,emptyMessage:g,onSeeMore:l,renderItem:r,gridCols:i="grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}){return h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:s}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t})]}),e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(ge,{className:"animate-spin text-indigo-600",size:32})})]}):!a||a.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:s}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t})]}),e.jsx("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:g||"No items found."})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:s}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t})]}),l&&e.jsx("button",{onClick:l,className:"text-sm text-indigo-600 dark:text-indigo-400 font-semibold hover:underline",children:"See More â†’"})]}),e.jsx("div",{className:`grid ${i} gap-4`,children:a.map((n,F)=>e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:F*.05},children:r?r(n,F):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:JSON.stringify(n)})},n.id||F))})]})}function z({item:s,type:t,onFollow:a,onViewProfile:h,onPlay:g,isFollowing:l,currentUser:r}){const i=()=>t==="sound"?s.text||"Audio Post":s.displayName||s.name||s.title||"Unknown",n=()=>t==="sound"?s.displayName||"Unknown Artist":t==="artist"||t==="producer"?s.role||s.activeProfileRole||"User":t==="studio"?s.address||s.city||"Location not specified":t==="school"?s.address||"Location not specified":null;return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-all",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"shrink-0",children:t==="sound"?e.jsx("div",{className:"w-12 h-12 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center",children:e.jsx(le,{size:24,className:"text-indigo-600 dark:text-indigo-400"})}):e.jsx(oe,{src:s.photoURL||s.logoURL,name:i(),size:"md"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold dark:text-white truncate cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition",onClick:h,children:i()}),n()&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate mt-0.5",children:n()}),t==="studio"&&s.amenities&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:s.amenities.slice(0,2).join(", ")}),t==="school"&&s.programs&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[s.programs.length," program",s.programs.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[t==="sound"&&g&&e.jsx("button",{onClick:g,className:"p-2 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition",title:"Play",children:e.jsx(Ue,{size:16,fill:"currentColor"})}),(t==="artist"||t==="producer")&&a&&e.jsx(Se,{isFollowing:l,onToggle:a,size:"sm"})]})]}),(s.followerCount||s.enrollmentCount)&&e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500 dark:text-gray-400",children:[s.followerCount!==void 0&&e.jsxs("span",{children:[s.followerCount," followers"]}),s.enrollmentCount!==void 0&&e.jsxs("span",{children:[s.enrollmentCount," enrolled"]})]})]})]})})}function de(s,t){const[a,h]=m.useState(!1),[g,l]=m.useState([]),[r,i]=m.useState([]),[n,F]=m.useState([]),[y,I]=m.useState([]),[O,E]=m.useState([]),[c,w]=m.useState([]);return m.useEffect(()=>{const S=(s==null?void 0:s.id)||(s==null?void 0:s.uid);if(!S)return;(async()=>{try{const b=await is(S);w(b||[])}catch(b){console.error("Error loading following:",b)}})()},[s==null?void 0:s.id,s==null?void 0:s.uid]),{loading:a,sounds:g,artists:r,producers:n,studios:y,schools:O,following:c,refresh:()=>{},filterBy:()=>{}}}function ws({user:s,userData:t,openPublicProfile:a,onFollow:h}){const{loading:g,recommendations:l}=de(s),r=(l==null?void 0:l.sounds)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(_,{title:"Trending Sounds",description:"Most popular audio content right now",items:r.trending||[],loading:g,emptyMessage:"No trending sounds found.",renderItem:i=>e.jsx(z,{item:i,type:"sound",onViewProfile:()=>a==null?void 0:a(i.userId),onPlay:()=>{console.log("Play sound:",i.id)}})}),e.jsx(_,{title:"New Releases",description:"Recently posted audio content",items:r.recent||[],loading:g,emptyMessage:"No new sounds found.",renderItem:i=>e.jsx(z,{item:i,type:"sound",onViewProfile:()=>a==null?void 0:a(i.userId),onPlay:()=>{console.log("Play sound:",i.id)}})}),r.personalized&&r.personalized.length>0&&e.jsx(_,{title:"Recommended for You",description:"Based on your activity",items:r.personalized||[],loading:g,emptyMessage:"No recommendations yet.",renderItem:i=>e.jsx(z,{item:i,type:"sound",onViewProfile:()=>a==null?void 0:a(i.userId),onPlay:()=>{console.log("Play sound:",i.id)}})})]})}function vs({user:s,userData:t,openPublicProfile:a}){const{loading:h,recommendations:g}=de(s),{isFollowing:l,toggleFollow:r}=xe(s==null?void 0:s.uid),i=(g==null?void 0:g.artists)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(_,{title:"Trending Artists",description:"Most popular artists right now",items:i.trending||[],loading:h,emptyMessage:"No trending artists found.",renderItem:n=>e.jsx(z,{item:n,type:"artist",onViewProfile:()=>a==null?void 0:a(n.userId||n.id),onFollow:()=>r(n.userId||n.id,n),isFollowing:l(n.userId||n.id)})}),e.jsx(_,{title:"New Artists",description:"Recently joined artists",items:i.recent||[],loading:h,emptyMessage:"No new artists found.",renderItem:n=>e.jsx(z,{item:n,type:"artist",onViewProfile:()=>a==null?void 0:a(n.userId||n.id),onFollow:()=>r(n.userId||n.id,n),isFollowing:l(n.userId||n.id)})}),i.personalized&&i.personalized.length>0&&e.jsx(_,{title:"Recommended for You",description:"Based on artists you follow",items:i.personalized||[],loading:h,emptyMessage:"No recommendations yet.",renderItem:n=>e.jsx(z,{item:n,type:"artist",onViewProfile:()=>a==null?void 0:a(n.userId||n.id),onFollow:()=>r(n.userId||n.id,n),isFollowing:l(n.userId||n.id)})})]})}function Ns({user:s,userData:t,openPublicProfile:a}){const{loading:h,recommendations:g}=de(s),{isFollowing:l,toggleFollow:r}=xe(s==null?void 0:s.uid),i=(g==null?void 0:g.producers)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(_,{title:"Trending Producers",description:"Most popular producers right now",items:i.trending||[],loading:h,emptyMessage:"No trending producers found.",renderItem:n=>e.jsx(z,{item:n,type:"producer",onViewProfile:()=>a==null?void 0:a(n.userId||n.id),onFollow:()=>r(n.userId||n.id,n),isFollowing:l(n.userId||n.id)})}),e.jsx(_,{title:"New Producers",description:"Recently joined producers",items:i.recent||[],loading:h,emptyMessage:"No new producers found.",renderItem:n=>e.jsx(z,{item:n,type:"producer",onViewProfile:()=>a==null?void 0:a(n.userId||n.id),onFollow:()=>r(n.userId||n.id,n),isFollowing:l(n.userId||n.id)})}),i.personalized&&i.personalized.length>0&&e.jsx(_,{title:"Recommended for You",description:"Based on producers you follow",items:i.personalized||[],loading:h,emptyMessage:"No recommendations yet.",renderItem:n=>e.jsx(z,{item:n,type:"producer",onViewProfile:()=>a==null?void 0:a(n.userId||n.id),onFollow:()=>r(n.userId||n.id,n),isFollowing:l(n.userId||n.id)})})]})}function ks({user:s,userData:t,openPublicProfile:a}){const{loading:h,recommendations:g}=de(s),l=(g==null?void 0:g.studios)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(_,{title:"Trending Studios",description:"Most popular studios right now",items:l.trending||[],loading:h,emptyMessage:"No trending studios found.",renderItem:r=>e.jsx(z,{item:r,type:"studio",onViewProfile:()=>a==null?void 0:a(r.userId||r.id)})}),e.jsx(_,{title:"New Studios",description:"Recently added studios",items:l.recent||[],loading:h,emptyMessage:"No new studios found.",renderItem:r=>e.jsx(z,{item:r,type:"studio",onViewProfile:()=>a==null?void 0:a(r.userId||r.id)})}),l.personalized&&l.personalized.length>0&&e.jsx(_,{title:"Recommended for You",description:"Based on your location and interests",items:l.personalized||[],loading:h,emptyMessage:"No recommendations yet.",renderItem:r=>e.jsx(z,{item:r,type:"studio",onViewProfile:()=>a==null?void 0:a(r.userId||r.id)})})]})}function Is({user:s,userData:t}){const{loading:a,recommendations:h}=de(s),g=(h==null?void 0:h.schools)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(_,{title:"Featured Schools",description:"Top music education programs",items:g.trending||[],loading:a,emptyMessage:"No featured schools found.",renderItem:l=>e.jsx(z,{item:l,type:"school",onViewProfile:()=>{console.log("View school:",l.id)}})}),e.jsx(_,{title:"New Schools",description:"Recently added schools",items:g.recent||[],loading:a,emptyMessage:"No new schools found.",renderItem:l=>e.jsx(z,{item:l,type:"school",onViewProfile:()=>{console.log("View school:",l.id)}})}),g.personalized&&g.personalized.length>0&&e.jsx(_,{title:"Recommended for You",description:"Based on your location and interests",items:g.personalized||[],loading:a,emptyMessage:"No recommendations yet.",renderItem:l=>e.jsx(z,{item:l,type:"school",onViewProfile:()=>{console.log("View school:",l.id)}})})]})}const Ss=[{id:"sounds",label:"Sounds",icon:le},{id:"artists",label:"Artists",icon:Xe},{id:"producers",label:"Producers",icon:Ze},{id:"studios",label:"Studios",icon:qe},{id:"schools",label:"Schools",icon:Qe}];function Cs({user:s,userData:t,openPublicProfile:a}){const[h,g]=m.useState("sounds"),l=()=>{switch(h){case"sounds":return e.jsx(ws,{user:s,userData:t,openPublicProfile:a});case"artists":return e.jsx(vs,{user:s,userData:t,openPublicProfile:a});case"producers":return e.jsx(Ns,{user:s,userData:t,openPublicProfile:a});case"studios":return e.jsx(ks,{user:s,userData:t,openPublicProfile:a});case"schools":return e.jsx(Is,{user:s,userData:t});default:return null}};return e.jsxs("div",{className:"max-w-6xl mx-auto pb-20",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm overflow-x-auto",children:Ss.map(r=>{const i=r.icon;return e.jsxs("button",{onClick:()=>g(r.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all whitespace-nowrap ${h===r.id?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(i,{size:16}),e.jsx("span",{children:r.label})]},r.id)})}),e.jsx("div",{className:"mt-6",children:l()})]})}const v={FOR_YOU:"for_you",FOLLOWING:"following",DISCOVER:"discover"};function Gs({user:s,userData:t,subProfiles:a={},openPublicProfile:h}){var te,ae,d,p,G,ne;const[g,l]=m.useState([]),[r,i]=m.useState(!0),[n,F]=m.useState(null),[y,I]=m.useState(v.FOR_YOU),[O,E]=m.useState([]),[c,w]=m.useState(!1),[S,V]=m.useState(!1),{t:b}=gs(),L=((ae=(te=t==null?void 0:t.settings)==null?void 0:te.social)==null?void 0:ae.feedAlgorithm)||"recommended",ee=((p=(d=t==null?void 0:t.settings)==null?void 0:d.social)==null?void 0:p.autoPlayVideos)!==!1,Q=((ne=(G=t==null?void 0:t.settings)==null?void 0:G.social)==null?void 0:ne.showSuggestedAccounts)!==!1,Z=(s==null?void 0:s.id)||(s==null?void 0:s.uid),{following:H,stats:U,loading:R,isFollowing:$,toggleFollow:o,getFollowingIds:N}=xe(Z),f=m.useMemo(()=>N(),[H]);m.useEffect(()=>{const x=(s==null?void 0:s.id)||(s==null?void 0:s.uid);y===v.FOLLOWING&&f.length===0&&x&&A()},[y,f.length,s==null?void 0:s.id,s==null?void 0:s.uid]);const A=async()=>{w(!0);try{if(!(s!=null&&s.id)&&!(s!=null&&s.uid))return;const x=s.id||s.uid,C=(await ce({limit:20})).filter(j=>j.user_id!==x),B=[...new Set(C.map(j=>j.user_id))];let T={};B.length>0&&(await os(B)).forEach(Y=>{T[Y.user_id]=Y.avatar_url||Y.photo_url});const u=new Map;C.forEach(j=>{u.has(j.user_id)||u.set(j.user_id,{userId:j.user_id,displayName:j.display_name,photoURL:T[j.user_id]||null,role:j.role})}),E(Array.from(u.values()).slice(0,5))}catch(x){console.error("Error loading suggestions:",x)}w(!1)},q=()=>{const x=Array.from({length:3});return e.jsxs("div",{className:"space-y-4 p-fluid",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] rounded-2xl border border-gray-200 dark:border-gray-700 p-4 animate-pulse",children:[e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded-xl w-48 mb-3"}),e.jsx("div",{className:"h-14 bg-gray-100 dark:bg-gray-800 rounded-xl w-full mb-2"})]}),x.map((W,C)=>e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] rounded-2xl border border-gray-200 dark:border-gray-700 p-4 animate-pulse space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3.5 w-32 bg-gray-200 dark:bg-gray-700 rounded-full mb-2"}),e.jsx("div",{className:"h-3 w-20 bg-gray-100 dark:bg-gray-800 rounded-full"})]})]}),e.jsx("div",{className:"h-3 w-5/6 bg-gray-100 dark:bg-gray-800 rounded-full"}),e.jsx("div",{className:"h-3 w-2/3 bg-gray-100 dark:bg-gray-800 rounded-full"}),e.jsx("div",{className:"h-48 bg-gray-100 dark:bg-gray-800 rounded-xl"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsx("div",{className:"h-3 w-12 bg-gray-200 dark:bg-gray-700 rounded-full"})]})]},C))]})};m.useEffect(()=>{i(!0),(async()=>{try{const C=y===v.FOLLOWING&&f.length>0?50:20;let T=(await ce({limit:C})).map(u=>({id:u.id,...u,userId:u.user_id,displayName:u.display_name||u.username||(u.first_name&&u.last_name?`${u.first_name} ${u.last_name}`:null)||u.first_name||u.last_name||"Unknown User",authorPhoto:u.photo_url||u.profile_photo_url,username:u.username,text:u.content,attachments:u.media,timestamp:u.created_at,commentCount:u.comment_count||0,reactionCount:u.reaction_count||0,saveCount:u.save_count||0}));if(y===v.FOR_YOU&&(L==="following"?f.length>0?T=T.filter(u=>f.includes(u.userId)):T=[]:L==="chronological"||T.sort((u,j)=>{const Y=(u.reactionCount||0)*2+(u.commentCount||0)*3+(u.saveCount||0);return(j.reactionCount||0)*2+(j.commentCount||0)*3+(j.saveCount||0)-Y})),y===v.FOLLOWING&&f.length>0){const u=(s==null?void 0:s.id)||(s==null?void 0:s.uid);T=T.filter(j=>f.includes(j.userId)||j.userId===u)}l(T),i(!1)}catch(C){console.error("Feed error:",C),i(!1)}})();const W=setInterval(async()=>{try{const C=await ce({limit:10}),B=(s==null?void 0:s.id)||(s==null?void 0:s.uid);C.some(u=>{const j=!C.find(re=>re.id===u.id),Y=u.user_id!==B;return y===v.FOLLOWING&&f.length>0?j&&Y&&f.includes(u.user_id):y===v.FOR_YOU?j&&Y:!1})&&V(!0)}catch(C){console.error("Polling error:",C)}},3e4);return()=>{clearInterval(W)}},[y,f,L,s==null?void 0:s.id,s==null?void 0:s.uid]);const se=async x=>{var W,C,B,T,u,j,Y,re,me,he;if(s)try{const ie=s.id||s.uid,ue=(t==null?void 0:t.activeProfileRole)||((W=t==null?void 0:t.accountTypes)==null?void 0:W[0])||"Fan",P=(a==null?void 0:a[ue])||{},Ce=(P==null?void 0:P.display_name)||(t==null?void 0:t.effectiveDisplayName)||`${(t==null?void 0:t.firstName)||""} ${(t==null?void 0:t.lastName)||""}`.trim()||null,Fe=(P==null?void 0:P.photo_url)||(t==null?void 0:t.photoURL)||(s==null?void 0:s.imageUrl)||null,Re=s.username||((C=s.publicMetadata)==null?void 0:C.username)||`${s.firstName||""}${s.lastName?" "+s.lastName:""}`.trim()||((B=s.email)==null?void 0:B.split("@")[0])||null;await ds(ie,{id:ie,email:((T=s.primaryEmailAddress)==null?void 0:T.emailAddress)||s.email||((j=(u=s.emailAddresses)==null?void 0:u[0])==null?void 0:j.emailAddress),first_name:s.firstName||null,last_name:s.lastName||null,username:Re,profile_photo_url:s.imageUrl||s.profileImageUrl||null,account_types:((Y=s.publicMetadata)==null?void 0:Y.account_types)||["Fan"],active_role:((re=s.publicMetadata)==null?void 0:re.active_role)||"Fan"});const _e=(x.attachments||[]).map(J=>({type:J.type,url:J.url,thumbnail:J.thumbnail||null,name:J.name||null,isGif:J.isGif||!1})),ze=(((me=x.text)==null?void 0:me.match(/@(\w+)/g))||[]).map(J=>J.substring(1)),Oe=(((he=x.text)==null?void 0:he.match(/#(\w+)/g))||[]).map(J=>J.substring(1));await ls({user_id:ie,content:x.text||null,media:_e,mentions:ze,hashtags:Oe,visibility:"public",display_name:Ce,author_photo:Fe,posted_as_role:ue})}catch(ie){console.error("Failed to post:",ie),alert("Could not post update. Please try again.")}},M={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},K=({suggestedUser:x})=>e.jsxs(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 hover:border-brand-blue/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1 min-w-0",onClick:()=>h==null?void 0:h(x.userId),children:[e.jsx(oe,{src:x.photoURL,name:x.displayName,size:"md"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate hover:text-brand-blue transition",children:x.displayName}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:x.role})]})]}),e.jsx(Se,{isFollowing:$(x.userId),onToggle:()=>o(x.userId,x),size:"sm",variant:"default"})]});return e.jsxs("div",{className:"max-w-2xl mx-auto pb-20",children:[e.jsx(js,{user:s,userData:t,subProfiles:a,onPost:se}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("button",{onClick:()=>I(v.FOR_YOU),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${y===v.FOR_YOU?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(Ke,{size:16}),e.jsx("span",{children:b("forYou")})]}),e.jsxs("button",{onClick:()=>I(v.FOLLOWING),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${y===v.FOLLOWING?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(fe,{size:16}),e.jsx("span",{children:b("following")}),U.followingCount>0&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${y===v.FOLLOWING?"bg-white/20":"bg-gray-200 dark:bg-gray-700"}`,children:U.followingCount})]}),e.jsxs("button",{onClick:()=>I(v.DISCOVER),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${y===v.DISCOVER?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(Pe,{size:16}),e.jsx("span",{children:b("discover")})]})]}),e.jsx(D,{children:S&&y!==v.DISCOVER&&e.jsx(k.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-4",children:e.jsxs("button",{onClick:()=>window.location.reload(),className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-gradient-to-r from-brand-blue to-blue-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all",children:[e.jsx(pe,{size:18}),e.jsx("span",{children:"There Are New Posts."}),e.jsx("span",{className:"underline underline-offset-2",children:"Refresh?"})]})})}),y===v.DISCOVER?e.jsx(Cs,{user:s,userData:t,openPublicProfile:h}):r||R?q():e.jsxs(e.Fragment,{children:[y===v.FOLLOWING&&f.length===0&&e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-6 border border-blue-100 dark:border-blue-800/30",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-brand-blue/10 flex items-center justify-center",children:e.jsx(ke,{size:28,className:"text-brand-blue"})}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Start following creators"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-sm mx-auto",children:"Follow artists, engineers, and studios to see their posts in your Following feed."})]}),Q&&e.jsx(e.Fragment,{children:c?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Suggested for you"}),[1,2,3].map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded-lg"})]},x))]}):O.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Suggested for you"}),O.map(x=>e.jsx(K,{suggestedUser:x},x.userId))]})})]}),e.jsxs(k.div,{variants:M,initial:"hidden",animate:"show",className:"space-y-4",children:[e.jsx(D,{mode:"popLayout",children:g.map(x=>e.jsx(bs,{post:x,currentUser:s,currentUserData:t,openPublicProfile:h||(()=>{}),onReport:()=>F(x),onDelete:W=>l(C=>C.filter(B=>B.id!==W)),isFollowingAuthor:$(x.userId),onToggleFollow:()=>o(x.userId,{displayName:x.displayName,photoURL:x.authorPhoto,role:x.role}),autoPlayVideos:ee},x.id))}),g.length===0&&y===v.FOR_YOU&&e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(pe,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsxs("p",{children:[b("noPosts"),". ",b("beFirst")]})]}),g.length===0&&y===v.FOLLOWING&&f.length>0&&e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(fe,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsxs("p",{children:[b("noPostsFollowing"),"."]}),e.jsx("button",{onClick:()=>I(v.FOR_YOU),className:"mt-3 text-brand-blue hover:underline text-sm font-medium",children:b("browseForYou")})]})]})]}),n&&e.jsx(cs,{user:s,target:{id:n.id,type:"Post",summary:n.text?n.text.substring(0,50):"Media Post"},onClose:()=>F(null)})]})}export{Gs as default};
