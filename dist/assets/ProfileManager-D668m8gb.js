import{r as c,bg as J,j as e,a as q,ae as W,b as B,J as Y,L as A,t as G,af as R,ag as M,Y as Q,b5 as X,c as D,a9 as K,bh as ee,bd as b,bi as se,bk as P,bj as te,bt as H}from"./vendor-DTDDt3fP.js";import{A as C,E as T,T as ae}from"./vendor-firebase-C38qHjbM.js";import{d as $,g as O}from"./chat-BCnoKXi-.js";import{a as le,P as _}from"./edu-Bzk_yg6o.js";import re from"./SettingsTab-NbbZQNWV.js";import{M as ie,N as ne}from"./Inputs-CuyMtJZQ.js";import{E as oe}from"./EquipmentAutocomplete-CagN4z5F.js";import"./vendor-convex-DiXsReyd.js";import"./vendor-framer-CzAUfL-F.js";import"./useEquipmentDatabase-vs4GZ1qU.js";const de=se({firstName:P().min(2,"First name too short"),lastName:P().min(2,"Last name too short"),displayName:P().optional(),bio:P().max(500,"Bio exceeds 500 characters").optional(),zip:P().regex(/^\d{5}$/,"Invalid ZIP code").optional().or(H("")),hourlyRate:te().min(0,"Rate cannot be negative").optional(),website:P().url("Invalid URL").optional().or(H(""))}),ce=(i,s,r)=>r?r.substring(0,2).toUpperCase():(((i==null?void 0:i[0])||"")+((s==null?void 0:s[0])||"")).toUpperCase()||"U";function ve({user:i,userData:s,subProfiles:r={},handleLogout:n}){const[w,o]=c.useState("details"),[m,L]=c.useState("Main"),[U,u]=c.useState(!1),{uploadImage:F,uploading:g}=le(),[f,x]=c.useState((s==null?void 0:s.useLegalNameOnly)||!1),[y,S]=c.useState((s==null?void 0:s.useUserNameOnly)||!1);c.useEffect(()=>{x((s==null?void 0:s.useLegalNameOnly)||!1),S((s==null?void 0:s.useUserNameOnly)||!1)},[s]);const I=()=>{const a=!f;x(a),a&&S(!1)},h=()=>{const a=!y;S(a),a&&x(!1)},{register:j,handleSubmit:E,formState:{errors:v,isDirty:V}}=J({resolver:ee(de),defaultValues:{firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",displayName:(s==null?void 0:s.displayName)||"",bio:(s==null?void 0:s.bio)||"",zip:(s==null?void 0:s.zip)||"",hourlyRate:(s==null?void 0:s.hourlyRate)||0,website:(s==null?void 0:s.website)||""}}),t=async a=>{u(!0);const d=b.loading("Saving main profile...");try{let p=`${a.firstName} ${a.lastName}`;f?p=`${a.firstName} ${a.lastName}`:y&&a.displayName?p=a.displayName:a.displayName&&(p=`${a.firstName} "${a.displayName}" ${a.lastName}`);const z=C($,O(i.uid).userProfile);await T(z,{...a,useLegalNameOnly:f,useUserNameOnly:y,effectiveDisplayName:p,searchTerms:[a.firstName.toLowerCase(),a.lastName.toLowerCase(),(a.displayName||"").toLowerCase(),p.toLowerCase()].filter(Boolean)}),b.success("Main Profile Updated!",{id:d})}catch(p){console.error("Update failed",p),b.error("Failed to update profile.",{id:d})}finally{u(!1)}},N=async a=>{const d=a.target.files[0];if(!d)return;const p=b.loading("Uploading photo...");try{const z=await F(d,`users/${i.uid}/avatars`),Z=C($,O(i.uid).userProfile);await T(Z,{photoURL:z}),b.success("Photo uploaded!",{id:p})}catch(z){console.error(z),b.error("Photo upload failed",{id:p})}},l=async a=>{try{const d=C($,O(i.uid).userProfile);await T(d,{settings:a}),b.success("Settings saved.")}catch(d){console.error("Settings save failed",d),b.error("Failed to save settings.")}},k=a=>G("w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none",a?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-700");return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("h1",{className:"text-3xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(q,{className:"text-brand-blue"})," ",w==="details"?"Edit Profile":"Account Settings"]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex gap-1 self-start md:self-auto",children:[e.jsx("button",{onClick:()=>o("details"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${w==="details"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"Edit Details"}),e.jsxs("button",{onClick:()=>o("settings"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all flex items-center gap-1 ${w==="settings"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:[e.jsx(W,{size:14})," Settings"]})]})]}),w==="details"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-2",children:[e.jsx("div",{className:"font-bold text-xs text-gray-500 uppercase tracking-wider mb-2 px-1",children:"Profiles"}),e.jsxs("button",{onClick:()=>L("Main"),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${m==="Main"?"bg-brand-blue text-white shadow-md":"bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{size:16})," ",e.jsx("span",{className:"font-bold text-sm",children:"Main Profile"})]}),m==="Main"&&e.jsx(B,{size:16})]}),((s==null?void 0:s.accountTypes)||[]).map(a=>_[a]?e.jsxs("button",{onClick:()=>L(a),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${m===a?"bg-brand-blue text-white shadow-md":"bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:16})," ",e.jsx("span",{className:"font-bold text-sm",children:a})]}),m===a&&e.jsx(B,{size:16})]},a):null)]}),e.jsx("div",{className:"lg:col-span-3",children:m==="Main"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsxs("div",{className:"relative group w-full aspect-square rounded-full overflow-hidden bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-700 shadow-md",children:[s!=null&&s.photoURL?e.jsx("img",{src:s.photoURL,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gradient-to-tr from-brand-blue to-purple-500 text-white font-bold text-4xl",children:ce(s==null?void 0:s.firstName,s==null?void 0:s.lastName,s==null?void 0:s.displayName)}),e.jsxs("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity",children:[e.jsx("span",{className:"text-white font-bold text-sm",children:"Change Photo"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:N,disabled:g})]}),g&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(A,{className:"animate-spin text-white"})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl text-xs text-blue-800 dark:text-blue-200",children:[e.jsx("p",{className:"font-bold mb-1",children:"Pro Tip:"}),"High-quality profile photos increase booking rates by 40%."]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("form",{onSubmit:E(t),className:"space-y-6 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"First Name (Legal)"}),e.jsx("input",{...j("firstName"),className:k(v.firstName)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Last Name (Legal)"}),e.jsx("input",{...j("lastName"),className:k(v.lastName)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"User Name (Display Name)"}),e.jsx("input",{...j("displayName"),className:k(v.displayName),placeholder:"e.g. SeshMaster"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-1",children:"Display Name Preferences"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Legal Name Only"}),e.jsx("button",{type:"button",onClick:I,className:"text-brand-blue",children:f?e.jsx(R,{size:28}):e.jsx(M,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use User Name Only"}),e.jsx("button",{type:"button",onClick:h,className:"text-brand-blue",children:y?e.jsx(R,{size:28}):e.jsx(M,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2",children:["Preview: ",e.jsx("strong",{className:"text-brand-blue",children:f?`${s.firstName} ${s.lastName}`:y?s.displayName||"Not Set":`${s.firstName} "${s.displayName||"User"}" ${s.lastName}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Bio / About"}),e.jsx("textarea",{...j("bio"),rows:"4",className:k(v.bio),placeholder:"Tell us about your musical journey..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(Q,{size:12})," ZIP Code"]}),e.jsx("input",{...j("zip"),className:k(v.zip)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(X,{size:12})," Hourly Rate ($)"]}),e.jsx("input",{type:"number",...j("hourlyRate",{valueAsNumber:!0}),className:k(v.hourlyRate)})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700 flex justify-end",children:e.jsx("button",{type:"button",onClick:E(t),disabled:U,className:D("px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg",U?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-105"),children:U?e.jsx(A,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:20})," Save Changes"]})})})]})})]}):e.jsx(me,{user:i,userData:s,role:m,initialData:r[m]||{},schema:_[m]||[]})})]}):e.jsx("div",{className:"animate-in fade-in slide-in-from-right-2",children:e.jsx(re,{user:i,userData:s,handleLogout:n,onUpdate:l})})]})}function me({user:i,userData:s,role:r,initialData:n,schema:w}){const[o,m]=c.useState(n),[L,U]=c.useState(!1),[u,F]=c.useState(n.followMainProfile??!0),[g,f]=c.useState(n.useLegalNameOnly??!1),[x,y]=c.useState(n.useUserNameOnly??!1),[S,I]=c.useState(n.syncStudioOps??!1);c.useEffect(()=>{m(n||{}),F(n.followMainProfile??!0),f(n.useLegalNameOnly??!1),y(n.useUserNameOnly??!1),I(n.syncStudioOps??!1)},[n]);const h=(t,N)=>m(l=>({...l,[t]:N})),j=()=>{f(!g),g||y(!1)},E=()=>{y(!x),x||f(!1)},v=async t=>{t.preventDefault(),U(!0);const N=b.loading(`Saving ${r} profile...`);try{let l="";u?l=s.effectiveDisplayName||`${s.firstName} ${s.lastName}`:g?l=`${s.firstName} ${s.lastName}`:x?l=s.displayName||`${s.firstName} ${s.lastName}`:l=o.profileName||`${s.firstName} ${s.lastName}`;const k={...o,followMainProfile:u,useLegalNameOnly:g,useUserNameOnly:x,syncStudioOps:S,displayName:l},a=C($,O(i.uid).userSubProfile(r));if(await ae(a,k,{merge:!0}),s.activeProfileRole===r){const d=C($,O(i.uid).userPublicProfile);await T(d,{displayName:l,searchTerms:[l.toLowerCase()]})}if(r==="Studio"&&S){const d=C($,O(i.uid).userProfile);await T(d,{studioName:l})}b.success(`${r} Profile Saved!`,{id:N})}catch(l){console.error(l),b.error("Failed to save.",{id:N})}finally{U(!1)}};if(w.length===0)return e.jsx("div",{className:"p-10 text-center text-gray-500",children:"No configuration available for this role."});const V=w.filter(t=>t.key!=="profileName"&&t.key!=="useRealName");return e.jsxs("form",{onSubmit:v,className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white border-b dark:border-gray-700 pb-2",children:[r," Identity & Details"]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-4 rounded-xl border dark:border-gray-600 space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-1",children:"Identity Settings"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:"Follow Main Profile Name"}),e.jsxs("div",{className:"text-xs text-gray-500",children:['Use "',s.effectiveDisplayName||`${s.firstName} ${s.lastName}`,'"']})]}),e.jsx("button",{type:"button",onClick:()=>F(!u),className:"text-brand-blue",children:u?e.jsx(R,{size:28}):e.jsx(M,{size:28,className:"text-gray-400"})})]}),!u&&e.jsxs("div",{className:"space-y-3 animate-in slide-in-from-top-1 pt-3 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Legal Name Only"}),e.jsx("button",{type:"button",onClick:j,className:"text-brand-blue",children:g?e.jsx(R,{size:28}):e.jsx(M,{size:28,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm dark:text-gray-200",children:"Use Main User Name Only"}),e.jsx("button",{type:"button",onClick:E,className:"text-brand-blue",children:x?e.jsx(R,{size:28}):e.jsx(M,{size:28,className:"text-gray-400"})})]}),!g&&!x&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("label",{className:"text-xs font-bold text-brand-blue uppercase mb-1 block",children:[r," Name"]}),e.jsx("input",{type:"text",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none font-bold",placeholder:`e.g. ${r==="Studio"?"Sound City":"The Weeknd"}`,value:o.profileName||"",onChange:t=>h("profileName",t.target.value)}),r==="Studio"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:t=>I(t.target.checked),className:"rounded text-brand-blue focus:ring-brand-blue"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Force "Studio Ops" to use this name'})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic mt-2 border-t dark:border-gray-700 pt-2",children:["Preview: ",e.jsx("strong",{className:"text-brand-blue",children:g?`${s.firstName} ${s.lastName}`:x?s.displayName||"Not Set":o.profileName||"Not Set"})]})]})]}),V.map(t=>{var N;return t.isToggle?null:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:t.label}),t.type==="textarea"?e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",rows:4,value:o[t.key]||"",onChange:l=>h(t.key,l.target.value)}):t.type==="select"?e.jsx("select",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",value:o[t.key]||"",onChange:l=>h(t.key,l.target.value),children:(N=t.options)==null?void 0:N.map(l=>e.jsx("option",{value:l,children:l},l))}):t.type==="multi_select"?e.jsx(ie,{label:"",fieldKey:t.key,options:t.data||t.options||[],initialValues:o[t.key]||[],onChange:h}):t.type==="nested_select"?e.jsx(ne,{label:"",fieldKey:t.key,data:t.data,initialValues:o[t.key]||[],onChange:h}):t.key==="equipment"?e.jsx(oe,{multi:!0,value:o[t.key]||"",onChange:l=>h(t.key,l),placeholder:"Add gear..."}):e.jsx("input",{type:t.type==="number"?"number":"text",className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:text-white dark:border-gray-600 focus:ring-2 focus:ring-brand-blue outline-none",value:o[t.key]||"",onChange:l=>h(t.key,l.target.value)})]},t.key)}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700 flex justify-end",children:e.jsx("button",{type:"submit",disabled:L,className:"px-8 py-3 rounded-xl font-bold bg-brand-blue text-white hover:bg-blue-600 flex items-center gap-2 transition shadow-lg disabled:opacity-50",children:L?e.jsx(A,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:20})," Save ",r," Profile"]})})})]})}export{ve as default};
