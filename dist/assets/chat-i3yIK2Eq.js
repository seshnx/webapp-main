import{t as Xe,c as Ie,j as e,U as pe,a as Ze,b as ct,d as dt,C as ut,r as l,u as ae,e as Ne,f as Ue,T as Fe,P as Me,A as et,X as J,L as fe,g as tt,S as Se,h as De,i as xt,k as mt,V as Re,l as st,m as ve,n as at,o as rt,F as ft,p as gt,I as ht,q as bt,M as pt,s as yt,v as jt,R as wt,E as Nt,w as Be,x as vt,y as kt,z as ke,D as Pe,B as St,G as Le,H as Rt,J as $t,K as Mt,N as Oe,O as Ee,Q as zt,W as Ve,Y as qe,Z as At,_ as It,$ as Ft}from"./vendor-DyN93z3-.js";import{g as Lt,i as Et,a as Tt,b as Gt,p as _t,c as Ct,d as Dt,e as Pt,f as Ut,r as Bt,u as Ot,h as Vt,q as Te,w as de,j as He,k as We,l as qt,m as ie,s as Ht,n as Wt,o as ye,t as Qt,v as Yt,x as Jt,y as Kt,z as Xt,A as Zt,B as es,C as Qe,D as ts,E as ss,F as as,G as rs,H as ns}from"./vendor-firebase-C2C9Qtcb.js";import{m as U,A as me}from"./vendor-framer-D4Wnt9qz.js";const ue={apiKey:"AIzaSyCmGxvXX2D11Jo3NZlD0jO1vQpskaG0sCU",authDomain:"seshnx-db.firebaseapp.com",databaseURL:"https://seshnx-db-default-rtdb.firebaseio.com",projectId:"seshnx-db",storageBucket:"seshnx-db.firebasestorage.app",messagingSenderId:"718084970004",appId:"1:718084970004:web:d68ba48c5eb493af9db901",measurementId:"G-7SP53NK9FM"};ue.databaseURL||(ue.databaseURL="https://seshnx-db-default-rtdb.firebaseio.com");let Ge=null;try{Ge=Lt()}catch{Ge=null}const ge=Ge||Et(ue),Ts=Tt(ge);let _e;try{_e=Gt(ge,{localCache:_t({tabManager:Ct()})})}catch{_e=Dt(ge)}const be=_e;let Ce=null,nt=null;const ls=()=>{const t=ue.databaseURL;if(!t||t.trim()==="")return null;try{return Ut(ge)||null}catch{return null}};nt=ls();if(ue.storageBucket&&ue.storageBucket.trim()!=="")try{Ce=Pt(ge)}catch{Ce=null}const Ye=Ce,Q=nt,T=ue.projectId,is=t=>({userProfile:`artifacts/${T}/users/${t}/profiles/main`,userSubProfile:s=>`artifacts/${T}/users/${t}/profiles/${s}`,userPublicProfile:`artifacts/${T}/users/${t}/public_profile/main`,publicProfileCollectionGroup:"public_profile",publicFeed:`artifacts/${T}/public/data/posts`,serviceRequests:`artifacts/${T}/public/data/service_requests`,messages:`artifacts/${T}/public/data/direct_messages`,marketplaceItems:`artifacts/${T}/public/data/market_items`,userLibrary:`artifacts/${T}/users/${t}/library`,marketAssets:`artifacts/${T}/users/${t}/assets/market`,userWallet:`artifacts/${T}/users/${t}/wallet/account`,profileImages:`artifacts/${T}/users/${t}/images/profile`,equipmentSubmissions:`artifacts/${T}/public/data/equipment_submissions`,studentRecord:(s,a)=>`schools/${s}/students/${a}`,distributionReleases:`artifacts/${T}/distribution/${t}/releases`,royaltyReports:`artifacts/${T}/distribution/${t}/royalty_reports`,distributionStats:`artifacts/${T}/distribution/${t}/stats/main`,labelRoster:s=>`artifacts/${T}/labels/${s}/roster`,labelInvites:s=>`artifacts/${T}/labels/${s}/invites`,gearListings:`artifacts/${T}/public/data/gear_listings`,followers:`artifacts/${T}/users/${t}/followers`,following:`artifacts/${T}/users/${t}/following`,socialStats:`artifacts/${T}/users/${t}/stats/social`,notifications:`artifacts/${T}/users/${t}/notifications`,savedPosts:`artifacts/${T}/users/${t}/savedPosts`}),os=t=>{if(!t)return"";const s=t.trim().split(" ");return s.length>=2?(s[0][0]+s[1][0]).toUpperCase():t.substring(0,2).toUpperCase()};function he({src:t,name:s,size:a="md",className:r,onClick:o,status:n,isGroup:b=!1,square:m=!1}){const x=Xe(Ie("relative overflow-hidden flex items-center justify-center shrink-0 bg-gray-200 dark:bg-gray-700 border border-transparent transition-all select-none",m?"rounded-xl":"rounded-full",{xs:"h-6 w-6 text-[10px]",sm:"h-8 w-8 text-xs",md:"h-10 w-10 text-sm",lg:"h-12 w-12 text-base",xl:"h-14 w-14 text-lg","2xl":"h-24 w-24 text-2xl","3xl":"h-32 w-32 text-4xl"}[a],o&&"cursor-pointer hover:opacity-90",r));return e.jsxs("div",{className:x,onClick:o,children:[t?e.jsx("img",{src:t,alt:s||"Avatar",className:"h-full w-full object-cover",onError:w=>w.target.style.display="none"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gradient-to-br from-brand-blue to-purple-600 text-white font-bold",children:b?e.jsx(pe,{className:"w-1/2 h-1/2"}):s?os(s):e.jsx(Ze,{className:"w-1/2 h-1/2"})}),n&&e.jsx("span",{className:Ie("absolute bottom-0 right-0 rounded-full border-2 border-white dark:border-gray-900",n==="online"?"bg-green-500":"bg-gray-400",a==="xs"||a==="sm"?"h-2 w-2":"h-3.5 w-3.5")})]})}const Y=dt;ct();const cs=void 0,ds="https://placeholder.convex.cloud",Gs=new ut(ds),re=()=>!!cs;function ze({title:t,value:s,icon:a,sub:r,bg:o="bg-white dark:bg-[#2c2e36]",text:n="text-gray-900 dark:text-white"}){return e.jsxs("div",{className:`${o} p-5 rounded-xl border border-gray-100 dark:border-gray-700 shadow-sm flex flex-col justify-between h-28`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-medium ${n==="text-white"?"text-blue-100":"text-gray-500"}`,children:t}),e.jsx("div",{className:`text-2xl font-extrabold ${n}`,children:s})]}),e.jsx("div",{className:"opacity-80",children:a})]}),r&&e.jsx("div",{className:"text-xs mt-auto opacity-75",children:r})]})}const us=()=>{const[t,s]=l.useState(!1),[a,r]=l.useState(null);return{uploadMedia:async(n,b)=>{if(!n)return null;if(!Ye)return r("Firebase Storage is not configured. Please set VITE_FIREBASE_STORAGE_BUCKET in your environment variables."),console.error("Firebase Storage is not available. storageBucket is missing from Firebase config."),null;s(!0),r(null);try{const p=`${Date.now()}_${n.name.replace(/[^a-zA-Z0-9.]/g,"_")}`,x=`${b}/${p}`,w=Bt(Ye,x),k=await Ot(w,n),u=await Vt(k.ref);return s(!1),{url:u,type:n.type.startsWith("video/")?"video":n.type.startsWith("audio/")?"audio":"image",name:n.name}}catch(m){return console.error("Upload failed:",m),r(m),s(!1),null}},uploading:t,error:a}};function _s(t){const s=l.useRef(!1),a=ae(Y.presence.updatePresence);l.useEffect(()=>{if(!t||!re())return;a({userId:t,online:!0,lastSeen:Date.now()}).then(()=>{s.current=!0}).catch(o=>{console.error("Presence online error:",o)});const r=setInterval(()=>{s.current&&a({userId:t,online:!0,lastSeen:Date.now()}).catch(console.error)},3e4);return()=>{clearInterval(r),s.current&&(a({userId:t,online:!1,lastSeen:Date.now()}).catch(console.error),s.current=!1)}},[t])}function lt(t){const s=re(),a=l.useMemo(()=>t&&s?{userId:t}:"skip",[t,s]),r=Ne(Y.presence.getPresence,a);return r?{online:r.online===!0,lastSeen:r.lastSeen,loading:!1}:{online:!1,lastSeen:null,loading:!re()}}function xs(t){if(!t)return"Never";const s=t,r=Date.now()-s,o=Math.floor(r/6e4),n=Math.floor(o/60),b=Math.floor(n/24);return o<1?"Just now":o<60?`${o}m ago`:n<24?`${n}h ago`:b<7?`${b}d ago`:new Date(s).toLocaleDateString()}function it({online:t,lastSeen:s,showText:a=!1,size:r="sm"}){const o={xs:"w-1.5 h-1.5",sm:"w-2 h-2",md:"w-2.5 h-2.5"},n={xs:"text-[10px]",sm:"text-xs",md:"text-sm"};return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:`${o[r]} ${t?"fill-green-500 text-green-500":"fill-gray-400 text-gray-400"}`}),t&&e.jsx("div",{className:"absolute inset-0 animate-ping",children:e.jsx(Ue,{className:`${o[r]} fill-green-500 opacity-75`})})]}),a&&e.jsx("span",{className:`${n[r]} ${t?"text-green-500":"text-gray-400"} font-medium`,children:t?"Online":xs(s)})]})}function ms({conversation:t,activeChat:s,currentUserId:a,onSelect:r,onDelete:o}){const n=t.type==="direct"?t.uid||(t.id.includes("_")?t.id.split("_").find(p=>p!==a):null):null,{online:b,lastSeen:m}=lt(n||"");return e.jsxs("div",{onClick:()=>r(t),className:`group relative flex gap-3 p-4 cursor-pointer transition border-b dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-white/5 ${(s==null?void 0:s.id)===t.id?"bg-blue-50 dark:bg-blue-900/10 border-l-4 border-l-brand-blue":""}`,children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx(he,{src:t.photo,name:t.n,size:"lg",isGroup:t.type==="group"}),t.type==="direct"&&n&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5",children:e.jsx(it,{online:b,lastSeen:m,size:"xs"})}),t.uc>0&&e.jsx("div",{className:"absolute -top-1 -right-1 h-5 w-5 bg-brand-blue text-white text-[10px] font-bold flex items-center justify-center rounded-full border-2 border-white dark:border-[#2c2e36]",children:t.uc>99?"99+":t.uc})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h4",{className:`text-sm truncate ${t.uc>0?"font-extrabold text-gray-900 dark:text-white":"font-bold text-gray-700 dark:text-gray-300"}`,children:t.n}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0 ml-2",children:t.lmt?new Date(t.lmt).toLocaleDateString():""})]}),e.jsxs("p",{className:`text-xs truncate ${t.uc>0?"text-gray-800 dark:text-gray-200 font-medium":"text-gray-500"}`,children:[t.ls===a?"You: ":"",t.lm]})]}),e.jsx("button",{onClick:p=>{p.stopPropagation(),o==null||o(t.id)},className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white dark:bg-gray-800 shadow-md rounded-full text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all z-10",children:e.jsx(Fe,{size:16})})]})}function Cs({user:t,conversations:s=[],activeChat:a,onSelectChat:r}){const[o,n]=l.useState(!1),[b,m]=l.useState(!1),[p,x]=l.useState("direct"),[w,k]=l.useState(!1),[u,h]=l.useState(""),[i,c]=l.useState([]),[j,S]=l.useState(""),[d,v]=l.useState([]),N=async y=>{S(y);const M=y.trim();if(M.length>1){const P=M.toLowerCase(),W=P.charAt(0).toUpperCase()+P.slice(1),X=Te(He(be,"public_profile"),de("firstName",">=",W),de("firstName","<=",W+"ï£¿")),K=Te(He(be,"public_profile"),de("lastName",">=",W),de("lastName","<=",W+"ï£¿"));try{const[L,te]=await Promise.all([We(X),We(K)]),se=new Map,Z=ne=>{const ee=ne.ref.parent.parent.id;ee!==t.uid&&se.set(ee,{id:ee,...ne.data()})};L.forEach(Z),te.forEach(Z),v(Array.from(se.values()))}catch(L){console.error("Search error:",L),v([])}}else v([])},$=y=>{if(p==="direct"){const M=[t.uid,y.id].sort().join("_");r({id:M,uid:y.id,name:`${y.firstName} ${y.lastName}`,type:"direct"}),E()}else p==="add_member"&&(i.find(M=>M.id===y.id)||c(M=>[...M,y]),E())},E=()=>{n(!1),S(""),v([])},D=()=>{h(""),c([]),m(!0)},_=()=>{x("add_member"),n(!0)},A=async()=>{if(!u||i.length===0)return alert("Name and members required.");if(!Q){alert("Chat functionality is not available. Realtime Database is not configured.");return}k(!0);try{const M=qt(ie(Q,"chats")).key,P=Ht(),W=[t.uid,...i.map(L=>L.id)],X={meta:{name:u,createdBy:t.uid,createdAt:P},members:{}};W.forEach(L=>X.members[L]=!0),await Wt(ie(Q,`chats/${M}`),X);const K={};W.forEach(L=>{K[`conversations/${L}/${M}`]={uid:M,n:u,type:"group",lmt:P,lm:"Group created",ls:t.uid,uc:L===t.uid?0:1}}),await ye(ie(Q),K),m(!1),r({id:M,name:u,type:"group"})}catch(y){console.error("Group creation failed",y),alert("Group creation failed: "+y.message)}finally{k(!1)}},B=async(y,M)=>{if(window.confirm("Delete this conversation?")){if(!Q){alert("Chat functionality is not available. Realtime Database is not configured.");return}try{await Qt(ie(Q,`conversations/${t.uid}/${M}`)),(a==null?void 0:a.id)===M&&r(null)}catch(P){console.error(P)}}};return e.jsxs("div",{className:"flex flex-col h-full relative overflow-hidden bg-white dark:bg-[#1f2128]",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsx("h2",{className:"font-extrabold text-lg dark:text-white tracking-tight",children:"Messages"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:D,className:"p-2 bg-white dark:bg-gray-700 rounded-full shadow-sm hover:text-brand-blue transition",title:"New Group",children:e.jsx(pe,{size:18})}),e.jsx("button",{onClick:()=>{x("direct"),n(!0)},className:"p-2 bg-white dark:bg-gray-700 rounded-full shadow-sm hover:text-brand-blue transition",title:"New Chat",children:e.jsx(Me,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:s.map(y=>e.jsx(ms,{conversation:y,activeChat:a,currentUserId:t.uid,onSelect:r,onDelete:M=>{window.confirm("Delete this conversation?")&&B({},M)}},y.id))}),b&&e.jsxs("div",{className:"absolute inset-0 bg-white dark:bg-[#1f2128] z-20 flex flex-col animate-in slide-in-from-right-10 duration-200",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center gap-3 bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("button",{onClick:()=>m(!1),className:"hover:bg-gray-200 dark:hover:bg-gray-700 p-1 rounded-full",children:e.jsx(et,{size:20})}),e.jsx("h3",{className:"font-bold dark:text-white",children:"New Group"})]}),e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"1. Group Name"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",placeholder:"Enter group name...",value:u,onChange:y=>h(y.target.value),autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["2. Members (",i.length,")"]}),e.jsxs("button",{onClick:_,className:"text-xs font-bold text-brand-blue flex items-center gap-1 hover:underline",children:[e.jsx(Me,{size:14})," Add Member"]})]}),e.jsx("div",{className:"space-y-2",children:i.length===0?e.jsx("div",{className:"text-center py-8 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400 text-sm",children:"No members selected"}):i.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-white/5 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{src:y.photoURL,name:y.firstName,size:"sm"}),e.jsxs("span",{className:"text-sm font-bold dark:text-white",children:[y.firstName," ",y.lastName]})]}),e.jsx("button",{onClick:()=>c(M=>M.filter(P=>P.id!==y.id)),className:"text-gray-400 hover:text-red-500",children:e.jsx(J,{size:16})})]},y.id))})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:A,disabled:!u||i.length===0||w,className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-lg flex justify-center items-center gap-2",children:w?e.jsx(fe,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:["Create Group ",e.jsx(tt,{size:18})]})})})]}),o&&e.jsxs("div",{className:"absolute inset-0 bg-white dark:bg-[#1f2128] z-30 flex flex-col animate-in fade-in duration-200",children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700 flex items-center gap-2 bg-white dark:bg-[#1f2128]",children:[e.jsx(Se,{size:18,className:"text-gray-400 ml-2"}),e.jsx("input",{autoFocus:!0,className:"flex-1 p-2 bg-transparent outline-none dark:text-white placeholder-gray-400",placeholder:"Search...",value:j,onChange:y=>N(y.target.value)}),e.jsx("button",{onClick:E,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",children:e.jsx(J,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[d.length===0&&j.length>1&&e.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No users found."}),d.map(y=>{const M=p==="add_member"&&i.find(P=>P.id===y.id);return e.jsxs("div",{onClick:()=>$(y),className:`flex items-center gap-3 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl cursor-pointer transition mb-1 ${M?"opacity-50 pointer-events-none":""}`,children:[e.jsx(he,{src:y.photoURL,name:y.firstName,size:"md"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-bold dark:text-white",children:[y.firstName," ",y.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:y.role||"User"})]}),p==="add_member"&&e.jsx(Me,{size:18,className:"text-brand-blue"})]},y.id)})]})]})]})}const je={Recent:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥","ðŸŽ‰","ðŸ‘"],Smileys:["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ¤£","ðŸ˜‚","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Š","ðŸ˜‡","ðŸ¥°","ðŸ˜","ðŸ¤©","ðŸ˜˜","ðŸ˜—","ðŸ˜š","ðŸ˜™","ðŸ˜‹","ðŸ˜›","ðŸ˜œ","ðŸ¤ª","ðŸ˜","ðŸ¤‘","ðŸ¤—","ðŸ¤­","ðŸ¤«","ðŸ¤”","ðŸ¤","ðŸ¤¨","ðŸ˜","ðŸ˜‘","ðŸ˜¶","ðŸ˜","ðŸ˜’","ðŸ™„","ðŸ˜¬","ðŸ¤¥","ðŸ˜Œ","ðŸ˜”","ðŸ˜ª","ðŸ¤¤","ðŸ˜´","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤¢","ðŸ¤®"],Gestures:["ðŸ‘‹","ðŸ¤š","ðŸ–ï¸","âœ‹","ðŸ––","ðŸ‘Œ","ðŸ¤Œ","ðŸ¤","âœŒï¸","ðŸ¤ž","ðŸ¤Ÿ","ðŸ¤˜","ðŸ¤™","ðŸ‘ˆ","ðŸ‘‰","ðŸ‘†","ðŸ–•","ðŸ‘‡","â˜ï¸","ðŸ‘","ðŸ‘Ž","âœŠ","ðŸ‘Š","ðŸ¤›","ðŸ¤œ","ðŸ‘","ðŸ™Œ","ðŸ‘","ðŸ¤²","ðŸ¤","ðŸ™"],Hearts:["â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’”","â¤ï¸â€ðŸ”¥","â¤ï¸â€ðŸ©¹","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’Ÿ"],Objects:["ðŸ’Ž","ðŸ””","ðŸ”•","ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸ“»","ðŸŽ·","ðŸŽº","ðŸŽ¸","ðŸŽ¹","ðŸŽ®","ðŸ•¹ï¸","ðŸŽ¯","ðŸŽ²","ðŸŽ³","ðŸŽ´","ðŸƒ","ðŸ€„","ðŸŽ°","ðŸ“±","ðŸ“ž","â˜Žï¸","ðŸ“Ÿ","ðŸ“ ","ðŸ’»","ðŸ–¥ï¸","ðŸ–¨ï¸","âŒ¨ï¸","ðŸ–±ï¸","ðŸ–²ï¸","ðŸ•¹ï¸","ðŸ—œï¸","ðŸ’¾","ðŸ’¿","ðŸ“€"],Flags:["ðŸ³ï¸","ðŸ´","ðŸ","ðŸš©","ðŸ³ï¸â€ðŸŒˆ","ðŸ³ï¸â€âš§ï¸","ðŸ‡ºðŸ‡¸","ðŸ‡¬ðŸ‡§","ðŸ‡¨ðŸ‡¦","ðŸ‡¦ðŸ‡º","ðŸ‡«ðŸ‡·","ðŸ‡©ðŸ‡ª","ðŸ‡®ðŸ‡¹","ðŸ‡ªðŸ‡¸","ðŸ‡¯ðŸ‡µ","ðŸ‡°ðŸ‡·","ðŸ‡¨ðŸ‡³","ðŸ‡®ðŸ‡³","ðŸ‡§ðŸ‡·","ðŸ‡²ðŸ‡½"],Music:["ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸ“»","ðŸŽ·","ðŸŽº","ðŸŽ¸","ðŸŽ¹","ðŸ¥","ðŸª˜","ðŸŽ»","ðŸŽª","ðŸŽ­","ðŸŽ¨","ðŸŽ¬","ðŸŽ¤","ðŸŽ§","ðŸŽ¼","ðŸŽ¹"],Reactions:["ðŸ‘","ðŸ‘Ž","â¤ï¸","ðŸ”¥","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ‘","ðŸ™Œ","ðŸ¤","ðŸ¤—","ðŸ¤”","ðŸ¤¦","ðŸ¤·","ðŸ™","ðŸ‘€","ðŸ’ª","ðŸ¤˜","âœŒï¸","ðŸ¤ž"]},fs=Object.values(je).flat();function gs({onSelect:t,onClose:s,position:a="bottom"}){const[r,o]=l.useState("Recent"),[n,b]=l.useState(""),[m,p]=l.useState(()=>{const u=localStorage.getItem("recentEmojis");return u?JSON.parse(u):je.Recent}),x=l.useMemo(()=>n.trim()?fs.filter(u=>u.includes(n)||n.includes(u)):r==="Recent"?m:je[r]||[],[n,r,m]),w=u=>{const h=[u,...m.filter(i=>i!==u)].slice(0,8);p(h),localStorage.setItem("recentEmojis",JSON.stringify(h)),t(u),s&&s()},k=Object.keys(je);return e.jsxs(U.div,{initial:{opacity:0,scale:.95,y:a==="bottom"?-10:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},className:`
                absolute ${a==="bottom"?"bottom-full mb-2":"top-full mt-2"} 
                left-0
                w-[340px] bg-white dark:bg-gray-800 
                rounded-2xl shadow-2xl border dark:border-gray-700
                z-50 overflow-hidden
            `,children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(Se,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search emojis...",value:n,onChange:u=>b(u.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white"}),n&&e.jsx("button",{onClick:()=>b(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(J,{size:16})})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide",children:k.map(u=>e.jsxs("button",{onClick:()=>o(u),className:`
                                px-3 py-1.5 rounded-lg text-xs font-semibold whitespace-nowrap transition
                                ${r===u?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}
                            `,children:[u==="Recent"?e.jsx(De,{size:12,className:"inline mr-1"}):null,u]},u))})]}),e.jsx("div",{className:"h-[280px] overflow-y-auto custom-scrollbar p-3",children:x.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"text-sm",children:"No emojis found"})}):e.jsx("div",{className:"grid grid-cols-8 gap-1",children:x.map((u,h)=>e.jsx(U.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:()=>w(u),className:"w-10 h-10 flex items-center justify-center text-xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:u},`${u}-${h}`))})})]})}const Je="demo_key",Ke="https://api.giphy.com/v1/gifs";function hs({onSelect:t,onClose:s,position:a="bottom"}){const[r,o]=l.useState(""),[n,b]=l.useState([]),[m,p]=l.useState([]),[x,w]=l.useState(!1),[k,u]=l.useState("trending"),h=l.useRef(null);l.useEffect(()=>{i()},[]),l.useEffect(()=>(r.trim()?(u("search"),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{c(r)},500)):(u("trending"),b([])),()=>{h.current&&clearTimeout(h.current)}),[r]);const i=async()=>{w(!0);try{const v=await(await fetch(`${Ke}/trending?api_key=${Je}&limit=24&rating=g`)).json();v.data&&p(v.data)}catch(d){console.error("Giphy trending error:",d)}w(!1)},c=async d=>{if(d.trim()){w(!0);try{const N=await(await fetch(`${Ke}/search?api_key=${Je}&q=${encodeURIComponent(d)}&limit=24&rating=g`)).json();N.data&&b(N.data)}catch(v){console.error("Giphy search error:",v)}w(!1)}},j=d=>{t==null||t({url:d.images.fixed_height.url||d.images.original.url,previewUrl:d.images.preview_gif.url||d.images.fixed_height_small.url,width:d.images.fixed_height.width,height:d.images.fixed_height.height,title:d.title||"GIF"}),s&&s()},S=k==="trending"?m:n;return e.jsxs(U.div,{initial:{opacity:0,scale:.95,y:a==="bottom"?-10:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},className:`
                absolute ${a==="bottom"?"bottom-full mb-2":"top-full mt-2"} 
                left-0
                w-[380px] bg-white dark:bg-gray-800 
                rounded-2xl shadow-2xl border dark:border-gray-700
                z-50 overflow-hidden
            `,children:[e.jsx("div",{className:"p-3 border-b dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(Se,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search GIFs...",value:r,onChange:d=>o(d.target.value),className:"w-full pl-9 pr-10 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white"}),r&&e.jsx("button",{onClick:()=>o(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(J,{size:16})})]})}),e.jsx("div",{className:"h-[320px] overflow-y-auto custom-scrollbar p-3",children:x?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx(fe,{className:"animate-spin text-brand-blue mb-2",size:24}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading GIFs..."})]}):S.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(xt,{size:32,className:"mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:k==="search"?"No GIFs found. Try a different search.":"Loading trending GIFs..."})]}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:S.map(d=>e.jsxs(U.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>j(d),className:"relative aspect-square rounded-lg overflow-hidden cursor-pointer bg-gray-100 dark:bg-gray-700 group",children:[e.jsx("img",{src:d.images.fixed_height_small.url||d.images.preview_gif.url,alt:d.title,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"})]},d.id))})}),e.jsx("div",{className:"p-2 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-center",children:e.jsxs("p",{className:"text-[10px] text-gray-400",children:["Powered by ",e.jsx("span",{className:"font-bold",children:"GIPHY"})]})})]})}function bs({onRecorded:t,onClose:s,maxDuration:a=60}){const[r,o]=l.useState(!1),[n,b]=l.useState(null),[m,p]=l.useState(0),[x,w]=l.useState(null),[k,u]=l.useState(null),h=l.useRef(null),i=l.useRef(null),c=l.useRef(null),j=l.useRef([]),S=l.useRef(null);l.useEffect(()=>(d(),()=>{v()}),[]);const d=async()=>{try{const A=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!0});i.current=A,h.current&&(h.current.srcObject=A),w(!0),u(null)}catch(A){console.error("Permission error:",A),w(!1),u("Camera/microphone access denied")}},v=()=>{i.current&&(i.current.getTracks().forEach(A=>A.stop()),i.current=null),S.current&&clearInterval(S.current)},N=async()=>{if(!i.current){await d();return}try{j.current=[];const A={mimeType:"video/webm;codecs=vp9,opus",videoBitsPerSecond:25e5};c.current=new MediaRecorder(i.current,A),c.current.ondataavailable=B=>{B.data.size>0&&j.current.push(B.data)},c.current.onstop=()=>{const B=new Blob(j.current,{type:"video/webm"});b(B),o(!1),p(0),S.current&&clearInterval(S.current)},c.current.start(),o(!0),p(0),S.current=setInterval(()=>{p(B=>{const y=B+1;return y>=a&&$(),y})},1e3)}catch(A){console.error("Recording error:",A),u("Failed to start recording")}},$=()=>{c.current&&r&&c.current.stop()},E=()=>{b(null),p(0),o(!1)},D=()=>{if(n){const A=new File([n],`video_${Date.now()}.webm`,{type:"video/webm"});t==null||t(A),v(),s==null||s()}},_=A=>{const B=Math.floor(A/60),y=A%60;return`${B}:${y.toString().padStart(2,"0")}`};return!x&&x!==null?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsx(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-6 max-w-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx(mt,{size:48,className:"text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Camera Access Required"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Please allow camera and microphone access to record video messages."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-200 transition",children:"Cancel"}),e.jsx("button",{onClick:d,className:"flex-1 px-4 py-2 bg-brand-blue text-white rounded-lg text-sm font-semibold hover:bg-blue-600 transition",children:"Allow Access"})]})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-[80]",children:e.jsxs(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative w-full max-w-2xl aspect-video bg-black rounded-2xl overflow-hidden",children:[e.jsx("video",{ref:h,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),r&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-bold",children:_(m)})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent",children:e.jsx("div",{className:"flex items-center justify-center gap-4",children:n?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:E,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(J,{size:24})}),e.jsx("button",{onClick:D,className:"p-4 bg-green-500 hover:bg-green-600 rounded-full text-white transition shadow-lg",children:e.jsx(ve,{size:28})}),e.jsx("div",{className:"w-12"})," "]}):e.jsx(e.Fragment,{children:r?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:E,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(J,{size:24})}),e.jsx("button",{onClick:$,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full text-white transition shadow-lg animate-pulse",children:e.jsx(st,{size:28})}),e.jsx("div",{className:"w-12"})," "]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(J,{size:24})}),e.jsx("button",{onClick:N,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full text-white transition shadow-lg",children:e.jsx(Re,{size:28})}),e.jsx("div",{className:"w-12"})," "]})})})}),k&&e.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-4 py-2 rounded-lg text-sm",children:k})]})})}function ps({activeChatId:t,uid:s,onSend:a,replyingTo:r,editingMessage:o,onCancelReply:n,typingUsers:b=[]}){const[m,p]=l.useState(""),[x,w]=l.useState(null),[k,u]=l.useState(!1),[h,i]=l.useState(!1),[c,j]=l.useState(!1),[S,d]=l.useState(!1),[v,N]=l.useState(!1),$=l.useRef(null),E=l.useRef(null),D=l.useRef(null),_=l.useRef(null),A=l.useRef([]),B=l.useRef(null),y=l.useRef(null),{uploadMedia:M,uploading:P}=us();l.useEffect(()=>{var f;o&&(p(o.b||""),(f=D.current)==null||f.focus())},[o]),l.useEffect(()=>{var f;r&&((f=D.current)==null||f.focus())},[r]),l.useEffect(()=>{const f=R=>{B.current&&!B.current.contains(R.target)&&j(!1),y.current&&!y.current.contains(R.target)&&d(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]);const W=async f=>{try{const q=await(await fetch(f.url)).blob(),ce=new File([q],`gif_${Date.now()}.gif`,{type:"image/gif"}),xe=await M(ce,`chat_media/${t}`);if(xe){const $e={url:xe.url,type:"image",name:f.title||"GIF",gif:!0};a("",$e)}}catch(R){console.error("GIF upload error:",R),alert("Failed to send GIF")}d(!1)},X=async f=>{try{const R=await M(f,`chat_media/${t}`);if(R){const q={url:R.url,type:"video",name:f.name};a("",q)}}catch(R){console.error("Video upload error:",R),alert("Failed to send video")}N(!1)},K=f=>{p(f.target.value),t&&s&&Q&&(ye(ie(Q,`chats/${t}/typing`),{[s]:!0}),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{Q&&ye(ie(Q,`chats/${t}/typing`),{[s]:!1})},2e3))},L=f=>{const R=D.current;if(R){const q=R.selectionStart,ce=R.selectionEnd,xe=m.substring(0,q)+f+m.substring(ce);p(xe),setTimeout(()=>{R.selectionStart=R.selectionEnd=q+f.length,R.focus()},0)}else p(q=>q+f)},te=async()=>{try{const f=await navigator.mediaDevices.getUserMedia({audio:!0});_.current=new MediaRecorder(f),A.current=[],_.current.ondataavailable=R=>A.current.push(R.data),_.current.onstop=()=>{const R=new Blob(A.current,{type:"audio/mp3"}),q=new File([R],`voice_note_${Date.now()}.mp3`,{type:"audio/mp3"});w({file:q,type:"audio",previewUrl:URL.createObjectURL(R)}),f.getTracks().forEach(ce=>ce.stop())},_.current.start(),u(!0)}catch{alert("Microphone access denied.")}},se=()=>{_.current&&_.current.stop(),u(!1)},Z=f=>{f.preventDefault(),f.stopPropagation(),f.type==="dragenter"||f.type==="dragover"?i(!0):i(!1)},ne=f=>{f.preventDefault(),f.stopPropagation(),i(!1),f.dataTransfer.files&&f.dataTransfer.files[0]&&ee(f.dataTransfer.files[0])},ee=f=>{const R=f.type.startsWith("image/")?"image":f.type.startsWith("video/")?"video":f.type.startsWith("audio/")?"audio":"file";w({file:f,type:R,previewUrl:URL.createObjectURL(f)})},F=async f=>{if(f.preventDefault(),!m.trim()&&!x||P)return;let R=null;if(x){const q=await M(x.file,`chat_media/${t}`);q&&(R={url:q.url,type:q.type,name:q.name})}a(m,R),p(""),w(null),t&&s&&Q&&ye(ie(Q,`chats/${t}/typing`),{[s]:!1})},V=()=>{o&&p(""),n==null||n()},oe=()=>{var f,R;return o?((f=o.b)==null?void 0:f.substring(0,50))||"Message":r?((R=r.b)==null?void 0:R.substring(0,50))||"Media":""};return e.jsxs("div",{className:`p-3 bg-white dark:bg-[#2c2e36] border-t dark:border-gray-700 shrink-0 transition-colors ${h?"bg-blue-50 dark:bg-blue-900/20 border-blue-400":""}`,onDragEnter:Z,onDragLeave:Z,onDragOver:Z,onDrop:ne,children:[e.jsx(me,{children:b.length>0&&e.jsxs(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-2 px-2 flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsxs("span",{className:"text-xs text-gray-400 italic",children:[b.length>1?"Multiple people are":"Someone is"," typing..."]})]})}),e.jsx(me,{children:(r||o)&&e.jsxs(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-between items-center bg-gray-100 dark:bg-gray-800 p-2.5 px-4 rounded-xl border-l-4 border-brand-blue mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[o?e.jsx(at,{size:16,className:"text-brand-blue shrink-0"}):e.jsx(rt,{size:16,className:"text-brand-blue shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue block",children:o?"Editing Message":`Replying to ${(r==null?void 0:r.n)||"User"}`}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate block",children:oe()})]})]}),e.jsx("button",{onClick:V,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(J,{size:16,className:"text-gray-400 hover:text-red-500"})})]})}),e.jsx(me,{children:x&&e.jsxs(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"flex items-center gap-3 p-3 bg-gray-100 dark:bg-gray-800 rounded-xl mb-2 border dark:border-gray-700",children:[x.type==="image"?e.jsx("img",{src:x.previewUrl,className:"h-14 w-14 object-cover rounded-lg"}):x.type==="video"?e.jsx("video",{src:x.previewUrl,className:"h-14 w-14 object-cover rounded-lg"}):e.jsx("div",{className:"h-14 w-14 bg-purple-100 dark:bg-purple-900/30 text-purple-600 flex items-center justify-center rounded-lg",children:e.jsx(ft,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-bold dark:text-white truncate",children:x.file.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(x.file.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:()=>w(null),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(J,{size:18,className:"text-gray-400 hover:text-red-500"})})]})}),e.jsxs("form",{onSubmit:F,className:"flex items-end gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",ref:E,className:"hidden",accept:"image/*,audio/*,video/*,.pdf,.doc,.docx,.txt,.zip",onChange:f=>ee(f.target.files[0])}),e.jsx("button",{type:"button",onClick:()=>{var f;return(f=E.current)==null?void 0:f.click()},className:"p-2.5 text-gray-500 hover:text-brand-blue hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition shrink-0",title:"Attach file",children:e.jsx(gt,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-1 border-r dark:border-gray-700 pr-2",children:[e.jsx("button",{type:"button",onClick:()=>{N(!0),j(!1),d(!1)},className:"p-2 text-gray-500 hover:text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition",title:"Record video",children:e.jsx(Re,{size:18})}),e.jsxs("button",{type:"button",onClick:()=>{d(!S),j(!1)},className:"p-2 text-gray-500 hover:text-purple-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition relative",title:"GIF",ref:y,children:[e.jsx(ht,{size:18}),S&&e.jsx(hs,{onSelect:W,onClose:()=>d(!1),position:"bottom"})]})]}),e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-[#1f2128] rounded-2xl border dark:border-gray-700 focus-within:ring-2 focus-within:ring-brand-blue transition-all flex items-end relative",children:[e.jsx("textarea",{ref:D,className:"w-full bg-transparent p-3 max-h-32 min-h-[44px] text-sm resize-none outline-none dark:text-white custom-scrollbar pr-20",placeholder:o?"Update message...":h?"Drop files here...":"Type a message...",value:m,onChange:K,onKeyDown:f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),F(f))},rows:1}),e.jsxs("div",{className:"absolute right-2 bottom-1.5 flex items-center gap-1",children:[e.jsxs("div",{className:"relative",ref:B,children:[e.jsx("button",{type:"button",onClick:()=>{j(!c),d(!1)},className:`p-1.5 rounded-full transition ${c?"bg-brand-blue/20 text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,title:"Emoji",children:e.jsx(bt,{size:18})}),e.jsx(me,{children:c&&e.jsx(gs,{onSelect:L,onClose:()=>j(!1),position:"bottom"})})]}),e.jsx("button",{type:"button",onClick:k?se:te,className:`p-1.5 rounded-full transition ${k?"bg-red-500 text-white animate-pulse":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,children:k?e.jsx(st,{size:18}):e.jsx(pt,{size:18})})]})]}),e.jsx("button",{type:"submit",disabled:!m.trim()&&!x||P,className:`p-2.5 text-white rounded-full shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all shrink-0 ${o?"bg-green-600 hover:bg-green-700":"bg-brand-blue hover:bg-blue-600"}`,children:P?e.jsx(fe,{size:20,className:"animate-spin"}):o?e.jsx(yt,{size:20}):e.jsx(jt,{size:20})})]}),v&&e.jsx(bs,{onRecorded:X,onClose:()=>N(!1),maxDuration:60})]})}function ys(...t){return Xe(Ie(t))}const we=wt.forwardRef(({className:t,variant:s="default",size:a="default",...r},o)=>{const n={default:"bg-blue-600 text-white hover:bg-blue-700 shadow-sm",destructive:"bg-red-500 text-white hover:bg-red-600 shadow-sm",outline:"border border-gray-200 bg-transparent hover:bg-gray-100 text-gray-900",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200",ghost:"hover:bg-gray-100 hover:text-gray-900 text-gray-600",link:"text-blue-600 underline-offset-4 hover:underline"},b={default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"};return e.jsx("button",{ref:o,className:ys("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:pointer-events-none disabled:opacity-50",n[s],b[a],t),...r})});we.displayName="Button";function js({url:t,isOpen:s,onClose:a,previewData:r}){if(!s||!t)return null;const o=new URL(t).pathname;let n="Content";o.startsWith("/profile/")?n="User Profile":o.startsWith("/session/")?n="Session Details":o.startsWith("/studio/")&&(n="Studio Listing");const b=(r==null?void 0:r.title)||`${n} Preview`;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black bg-opacity-70 backdrop-blur-sm",onClick:a,children:e.jsxs("div",{className:"bg-gray-900 rounded-xl shadow-2xl w-full max-w-2xl h-3/4 max-h-[800px] flex flex-col transform transition-all duration-300 scale-100 opacity-100",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-800 rounded-t-xl sticky top-0",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate max-w-[80%]",children:b}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:e.jsx(we,{variant:"ghost",size:"icon",className:"text-blue-400 hover:text-blue-300",children:e.jsx(Nt,{className:"w-5 h-5"})})}),e.jsx(we,{onClick:a,variant:"ghost",size:"icon",className:"text-white hover:bg-gray-700",children:e.jsx(J,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-y-auto custom-scrollbar text-gray-400 flex flex-col items-center justify-center text-center",children:[e.jsx("p",{className:"mb-4 text-lg font-medium text-white",children:"Embedded Content Simulation"}),e.jsx("p",{className:"mb-2",children:"This is where the actual SeshNx content (e.g., profile card, session details) would be rendered, based on the URL:"}),e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline break-all p-2 bg-gray-700 rounded-lg text-sm",children:t}),e.jsx("p",{className:"mt-4 text-sm",children:'In a real implementation, you would use a dedicated component (e.g., `ProfileCard id="..."`) here instead of an iframe to display the content securely and natively.'})]}),e.jsx("div",{className:"p-3 border-t border-gray-700 bg-gray-800 rounded-b-xl flex justify-end",children:e.jsx(we,{onClick:a,variant:"secondary",children:"Done"})})]})})}function ws({status:t="sent",size:s=12,className:a=""}){const r={sending:{icon:De,color:"text-gray-400",animate:!0},sent:{icon:ve,color:"text-gray-400",animate:!1},delivered:{icon:Be,color:"text-gray-400",animate:!1},read:{icon:Be,color:"text-brand-blue",animate:!1}},o=r[t]||r.sent,n=o.icon;return e.jsx(U.div,{animate:o.animate?{rotate:[0,360]}:{},transition:o.animate?{duration:2,repeat:1/0,ease:"linear"}:{},className:`inline-flex items-center ${o.color} ${a}`,children:e.jsx(n,{size:s,className:t==="read"?"fill-current":""})})}function Ns({audioUrl:t,color:s="brand-blue",height:a=40}){const r=l.useRef(null),o=l.useRef(null),n=l.useRef(null),b=l.useRef(null),m=l.useRef(null),[p,x]=l.useState(!1);l.useEffect(()=>{if(!t||!r.current)return;const u=r.current,h=u.getContext("2d"),i=new Audio(t);o.current=i,u.width=u.offsetWidth,u.height=a;const c=new(window.AudioContext||window.webkitAudioContext),j=c.createAnalyser(),S=c.createMediaElementSource(i);j.fftSize=256,S.connect(j),j.connect(c.destination),b.current=c,m.current=j;const d=j.frequencyBinCount,v=new Uint8Array(d),N=()=>{if(i.paused){w(h,u.width,u.height);return}n.current=requestAnimationFrame(N),j.getByteFrequencyData(v),h.clearRect(0,0,u.width,u.height);const $=u.width/d*2;let E=0;for(let D=0;D<d;D++){const _=v[D]/255*u.height,A=h.createLinearGradient(0,0,0,u.height);A.addColorStop(0,"#3b82f6"),A.addColorStop(1,"#8b5cf6"),h.fillStyle=A,h.fillRect(E,u.height-_,$-1,_),E+=$}};return i.addEventListener("play",()=>{x(!0),N()}),i.addEventListener("pause",()=>{x(!1),n.current&&cancelAnimationFrame(n.current),w(h,u.width,u.height)}),i.addEventListener("ended",()=>{x(!1),n.current&&cancelAnimationFrame(n.current),w(h,u.width,u.height)}),w(h,u.width,u.height),()=>{var $;n.current&&cancelAnimationFrame(n.current),i.pause(),($=b.current)==null||$.close()}},[t,a,p]);const w=(u,h,i)=>{u.clearRect(0,0,h,i),u.fillStyle="#3b82f6";const c=50,j=h/c,S=2;for(let d=0;d<c;d++){const v=Math.random()*i*.3+i*.1,N=d*j;u.fillRect(N,i-v,j-S,v)}},k=()=>{o.current&&(p?o.current.pause():o.current.play())};return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:k,className:"w-10 h-10 flex items-center justify-center bg-brand-blue text-white rounded-full hover:bg-blue-600 transition shrink-0",children:p?e.jsx(vt,{size:16}):e.jsx(kt,{size:16,className:"ml-0.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("canvas",{ref:r,className:"w-full rounded",style:{height:`${a}px`}}),e.jsx("audio",{ref:o,src:t})]})]})}const vs=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"];function ks({message:t,isCurrentUser:s,previousMessage:a,currentUserId:r,chatId:o,linkPreviewData:n,messageStatus:b="sent",onReaction:m,onReply:p,onEdit:x,onDelete:w,onForward:k,onSeshNxLinkClick:u,onUserClick:h}){var ee;const[i,c]=l.useState(!1),[j,S]=l.useState(!1),[d,v]=l.useState(!1),N=l.useRef(null),$=l.useRef(null),E=!a||a.s!==t.s,D=a&&new Date(t.t).toDateString()===new Date(a.t).toDateString(),_=t.t||Date.now(),A=(a==null?void 0:a.t)||0,B=a&&_-A>3e5,y=!D||!a,M=E||B,P=!s&&E,W=new Date(t.t||Date.now());l.useEffect(()=>{const F=V=>{N.current&&!N.current.contains(V.target)&&(c(!1),S(!1))};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[]);const X=()=>{navigator.clipboard.writeText(t.b||""),v(!0),setTimeout(()=>v(!1),2e3),c(!1)},K=F=>{m==null||m(t.id,F),S(!1),c(!1)},L=t.reactions?Object.entries(t.reactions).reduce((F,[V,oe])=>{const f=typeof oe=="object"?Object.keys(oe).length:0;return f>0&&(F[V]=f),F},{}):{},te=Object.keys(L).length>0,se=t.reactions?(ee=Object.entries(t.reactions).find(([F,V])=>typeof V=="object"&&V[r]))==null?void 0:ee[0]:null,Z=s?"bg-brand-blue text-white rounded-br-sm":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-sm";if(t.deleted||t.deletedForAll)return e.jsx("div",{className:`flex ${s?"justify-end":"justify-start"} ${E?"mt-3":"mt-0.5"}`,children:e.jsx("div",{className:"px-4 py-2 rounded-2xl bg-gray-100 dark:bg-gray-800 text-gray-400 italic text-sm",children:"ðŸš« This message was deleted"})});if(t.deletedFor&&t.deletedFor[r])return null;const ne=()=>{var V;if(!n)return null;const F=(V=n.url)==null?void 0:V.includes("seshnx.net");return e.jsx("div",{className:"mt-2 block border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden bg-white dark:bg-gray-800 max-w-[280px]",children:F?e.jsxs("button",{onClick:()=>u==null?void 0:u(n),className:"w-full text-left",children:[n.image&&e.jsx("div",{className:"h-28 w-full bg-cover bg-center",style:{backgroundImage:`url(${n.image})`}}),e.jsxs("div",{className:"p-2",children:[e.jsxs("p",{className:"font-semibold text-xs text-brand-blue truncate flex items-center",children:[e.jsx(Rt,{className:"w-3 h-3 mr-1"}),n.title||"SeshNx Link"]}),n.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 line-clamp-2",children:n.description})]})]}):e.jsxs("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",children:[n.image&&e.jsx("div",{className:"h-28 w-full bg-cover bg-center",style:{backgroundImage:`url(${n.image})`}}),e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"font-semibold text-xs text-brand-blue truncate",children:n.title||n.url}),n.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 line-clamp-2",children:n.description}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-1 flex items-center",children:[e.jsx($t,{className:"w-2.5 h-2.5 mr-1"}),new URL(n.url).hostname]})]})]})})};return e.jsxs(e.Fragment,{children:[y&&e.jsx("div",{className:"text-center my-4",children:e.jsx("span",{className:"text-[10px] text-gray-400 dark:text-gray-500 font-bold uppercase tracking-wider bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full",children:W.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("div",{className:`group flex items-end gap-2 ${s?"flex-row-reverse":"flex-row"} ${E?"mt-3":"mt-0.5"}`,ref:$,children:[!s&&e.jsx("div",{className:"w-8 shrink-0",children:P&&e.jsx(he,{src:t.photo,name:t.n,size:"xs",className:"cursor-pointer",onClick:()=>h==null?void 0:h(t.s)})}),e.jsxs("div",{className:`relative max-w-[75%] ${s?"items-end":"items-start"}`,children:[!s&&E&&t.n&&e.jsx("p",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 mb-1 ml-1",children:t.n}),t.replyTo&&e.jsxs("div",{className:`mb-1 px-3 py-1.5 rounded-lg text-xs border-l-2 border-brand-blue ${s?"bg-blue-400/30 text-blue-100":"bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300"}`,children:[e.jsx("p",{className:"font-bold text-[10px] mb-0.5",children:t.replyTo.sender}),e.jsx("p",{className:"truncate opacity-80",children:t.replyTo.text})]}),e.jsxs("div",{className:`relative px-3 py-2 rounded-2xl shadow-sm ${Z} cursor-pointer transition-all hover:shadow-md`,onClick:()=>c(!i),children:[t.media&&e.jsxs("div",{className:"mb-2",children:[t.media.type==="image"&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[t.media.gif&&e.jsx("span",{className:"absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full font-bold",children:"GIF"}),e.jsx("img",{src:t.media.url,alt:"Shared",className:"max-w-full h-auto rounded-lg max-h-60 object-cover"})]}),t.media.type==="video"&&e.jsx("video",{controls:!0,src:t.media.url,className:"max-w-full h-auto rounded-lg max-h-60"}),t.media.type==="audio"&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 max-w-[280px]",children:e.jsx(Ns,{audioUrl:t.media.url,height:50})}),t.media.type==="file"&&e.jsxs("a",{href:t.media.url,target:"_blank",rel:"noopener noreferrer",download:t.media.name,className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center shrink-0",children:e.jsx(ke,{size:20,className:"text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold dark:text-white truncate",children:t.media.name||"File"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click to download"})]}),e.jsx(Pe,{size:18,className:"text-gray-400 group-hover:text-brand-blue transition shrink-0"})]})]}),t.b&&e.jsx("p",{className:"text-sm break-words whitespace-pre-wrap leading-relaxed",children:t.b}),t.b&&ne(),t.edited&&e.jsx("span",{className:`text-[9px] ${s?"text-blue-200":"text-gray-400"} ml-1`,children:"(edited)"})]}),te&&e.jsx("div",{className:`flex flex-wrap gap-1 mt-1 ${s?"justify-end":"justify-start"}`,children:Object.entries(L).map(([F,V])=>e.jsxs(U.button,{initial:{scale:0},animate:{scale:1},onClick:()=>K(F),className:`flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-xs border transition-all ${se===F?"bg-brand-blue/20 border-brand-blue text-brand-blue":"bg-gray-100 dark:bg-gray-700 border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{children:F}),e.jsx("span",{className:"text-[10px] font-bold",children:V})]},F))}),M&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 ${s?"justify-end":"justify-start"}`,children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:W.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}),s&&e.jsx(ws,{status:b,size:10,className:"ml-0.5"})]}),e.jsx(me,{children:i&&e.jsxs(U.div,{ref:N,initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},className:`absolute z-50 ${s?"right-0":"left-0"} bottom-full mb-2 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden min-w-[180px]`,children:[e.jsx("div",{className:"flex justify-center gap-1 p-2 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:vs.map(F=>e.jsx(U.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:()=>K(F),className:`text-lg p-1 rounded-full transition ${se===F?"bg-brand-blue/20":"hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:F},F))}),e.jsxs("div",{className:"p-1",children:[e.jsxs("button",{onClick:()=>{p==null||p(t),c(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(rt,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Reply"})]}),e.jsxs("button",{onClick:X,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(St,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:d?"Copied!":"Copy"})]}),e.jsxs("button",{onClick:()=>{k==null||k(t),c(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(Le,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Forward"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{x==null||x(t),c(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(at,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Edit"})]}),e.jsxs("button",{onClick:()=>{w==null||w(t,"everyone"),c(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition text-red-500",children:[e.jsx(Fe,{size:16}),e.jsx("span",{children:"Delete for Everyone"})]})]}),e.jsxs("button",{onClick:()=>{w==null||w(t,"me"),c(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition text-gray-500",children:[e.jsx(Fe,{size:16}),e.jsx("span",{children:"Delete for Me"})]})]})]})})]}),s&&e.jsx("div",{className:"w-8 shrink-0"})]})]})}function Ss({message:t,conversations:s,currentUserId:a,onForward:r,onClose:o}){const[n,b]=l.useState(""),[m,p]=l.useState([]),[x,w]=l.useState(!1),k=n.trim()?s.filter(c=>{var j;return(j=c.n)==null?void 0:j.toLowerCase().includes(n.toLowerCase())}):s,u=c=>{p(j=>j.includes(c)?j.filter(S=>S!==c):[...j,c])},h=async()=>{if(m.length!==0){w(!0);try{await r(t,m),o()}catch(c){console.error("Forward error:",c),alert("Failed to forward message")}w(!1)}},i=()=>{var c;return t.media?t.media.type==="image"?"ðŸ“· Image":t.media.type==="video"?"ðŸŽ¥ Video":t.media.type==="audio"?"ðŸŽµ Audio":"ðŸ“Ž File":((c=t.b)==null?void 0:c.substring(0,100))||"Message"};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsxs(U.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Le,{className:"text-brand-blue",size:20}),e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Forward Message"})]}),e.jsx("button",{onClick:o,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(J,{size:20})})]}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-800 border-b dark:border-gray-700 shrink-0",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Forwarding:"}),e.jsx("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:e.jsx("p",{className:"text-sm dark:text-gray-200 line-clamp-2",children:i()})})]}),e.jsx("div",{className:"px-4 py-3 border-b dark:border-gray-700 shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Se,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:n,onChange:c=>b(c.target.value),className:"w-full pl-9 pr-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white transition"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:k.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No conversations found"})}):k.map(c=>{const j=m.includes(c.id);return e.jsxs(U.div,{whileTap:{scale:.98},onClick:()=>u(c.id),className:`
                                        flex items-center gap-3 p-4 cursor-pointer transition
                                        border-b dark:border-gray-700/50
                                        ${j?"bg-brand-blue/10 dark:bg-brand-blue/20":"hover:bg-gray-50 dark:hover:bg-gray-800"}
                                    `,children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{src:c.photo,name:c.n,size:"md",isGroup:c.type==="group"}),j&&e.jsx(U.div,{initial:{scale:0},animate:{scale:1},className:"absolute -bottom-1 -right-1 w-5 h-5 bg-brand-blue rounded-full flex items-center justify-center",children:e.jsx(ve,{size:12,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm dark:text-white truncate",children:c.n}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:c.type==="group"?"Group":"Direct message"})]}),e.jsx("div",{className:`
                                        w-5 h-5 rounded-full border-2 transition
                                        ${j?"border-brand-blue bg-brand-blue":"border-gray-300 dark:border-gray-600"}
                                    `,children:j&&e.jsx(ve,{size:12,className:"text-white m-auto"})})]},c.id)})}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[m.length," conversation",m.length!==1?"s":""," selected"]}),m.length>0&&e.jsx("button",{onClick:()=>p([]),className:"text-xs text-brand-blue hover:underline",children:"Clear all"})]}),e.jsx("button",{onClick:h,disabled:m.length===0||x,className:"w-full bg-brand-blue text-white py-3 rounded-xl font-bold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"animate-spin",size:18}),"Forwarding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:18}),"Forward"]})})]})]})})}function Rs(t,s){var h;const a=l.useMemo(()=>re(),[]),r=l.useMemo(()=>t&&s&&a?{chatId:t}:"skip",[t,s,a]),o=Ne(Y.readReceipts.getReadReceipts,r),n=ae(Y.readReceipts.markAsRead),b=ae(Y.readReceipts.markMultipleAsRead),m=l.useMemo(()=>{if(!o)return{};const i={};return o.forEach(c=>{i[c.userId]?c.readAt>i[c.userId].readAt&&(i[c.userId]={lastReadMessageId:c.messageId,readAt:c.readAt}):i[c.userId]={lastReadMessageId:c.messageId,readAt:c.readAt}}),i},[o]),p=((h=m[s])==null?void 0:h.lastReadMessageId)||null,x=l.useCallback(async i=>{if(!(!t||!s||!i||!re()||!n||!b))try{const c=Array.isArray(i)?i:[i];c.length===1?await n({chatId:t,messageId:c[0],userId:s}):await b({chatId:t,messageIds:c,userId:s})}catch(c){console.error("Mark as read error:",c)}},[t,s,n,b]),w=l.useCallback((i,c,j=null)=>{if(!i||!c)return!1;const S=m[c];if(!S||!S.lastReadMessageId)return!1;const d=S.lastReadMessageId;if(d===i)return!0;if(j&&Array.isArray(j)){const v=j.find($=>$.id===i),N=j.find($=>$.id===d);if(v&&N&&v.t&&N.t)return v.t<=N.t}return d>=i},[m]),k=l.useCallback(i=>{var c;return((c=m[i])==null?void 0:c.lastReadMessageId)||null},[m]),u=l.useCallback(i=>p===i||p&&p>=i,[p]);return{readReceipts:m,myLastRead:p,markAsRead:x,isMessageRead:w,getLastReadMessage:k,hasCurrentUserRead:u}}const Ae=new Map,$s=5*60*1e3;async function Ms(t){const s=t.match(/(https?:\/\/[^\s]+)/);if(!s)return null;const a=s[0],r=Ae.get(a);if(r&&Date.now()-r.timestamp<$s)return r.data;try{const n=Yt(ge),m=await Jt(n,"getLinkPreview")({url:a});if(m.data)return Ae.set(a,{data:m.data,timestamp:Date.now()}),m.data}catch(n){console.warn("Firebase getLinkPreview unavailable, using fallback:",n.message)}const o=await zs(a);return Ae.set(a,{data:o,timestamp:Date.now()}),o}async function zs(t){const s={url:t,title:null,description:null,image:null,siteName:null};try{const a=new URL(t),r=a.hostname.toLowerCase();if(r.includes("youtube.com")||r.includes("youtu.be")){let o=null;r.includes("youtu.be")?o=a.pathname.slice(1):o=a.searchParams.get("v"),s.siteName="YouTube",s.title="YouTube Video",s.description="Watch this video on YouTube",o&&(s.image=`https://img.youtube.com/vi/${o}/mqdefault.jpg`)}else if(r.includes("spotify.com"))s.siteName="Spotify",s.title="Spotify Content",s.description="Listen on Spotify",s.image="https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_RGB_Green.png";else if(r.includes("soundcloud.com"))s.siteName="SoundCloud",s.title="SoundCloud Track",s.description="Listen on SoundCloud",s.image="https://soundcloud.com/press/assets/press-kit/soundcloud-logo.png";else if(r.includes("github.com")){const o=a.pathname.split("/").filter(n=>n);s.siteName="GitHub",s.title=o.length>=2?`${o[0]}/${o[1]}`:"GitHub Repository",s.description="View on GitHub",o.length>=2&&(s.image=`https://opengraph.githubassets.com/1/${o[0]}/${o[1]}`)}else if(r.includes("twitter.com")||r.includes("x.com"))s.siteName="X (Twitter)",s.title="Tweet",s.description="View on X";else if(r.includes("instagram.com"))s.siteName="Instagram",s.title="Instagram Post",s.description="View on Instagram";else if(r.includes("seshnx.net")||r.includes("seshnx.com"))s.siteName="SeshNx",s.title="SeshNx Link",s.description="View on SeshNx platform",s.image="https://seshnx.net/pwa-512x512.png";else if(r.includes("linkedin.com"))s.siteName="LinkedIn",s.title="LinkedIn Post",s.description="View on LinkedIn";else if(r.includes("music.apple.com"))s.siteName="Apple Music",s.title="Apple Music",s.description="Listen on Apple Music";else if(r.includes("tiktok.com"))s.siteName="TikTok",s.title="TikTok Video",s.description="Watch on TikTok";else if(r.includes("vimeo.com"))s.siteName="Vimeo",s.title="Vimeo Video",s.description="Watch on Vimeo";else if(r.includes("bandcamp.com")){const o=r.split(".")[0];s.siteName="Bandcamp",s.title=o!=="bandcamp"?`${o} on Bandcamp`:"Bandcamp",s.description="Listen on Bandcamp"}else s.siteName=r.replace("www.",""),s.title=r.replace("www.",""),s.description=`Visit ${r}`;return s}catch(a){return console.warn("Link preview parsing error:",a),{url:t,title:t,description:null,image:null}}}function Ds({user:t,userData:s,activeChat:a,conversations:r,onBack:o,toggleDetails:n,openPublicProfile:b}){const[m,p]=l.useState({}),[x,w]=l.useState({isOpen:!1,url:"",previewData:null}),[k,u]=l.useState(null),[h,i]=l.useState(null),[c,j]=l.useState(null),S=l.useRef(null),d=a==null?void 0:a.id,v=(a==null?void 0:a.name)||(a==null?void 0:a.n)||"Unknown User",N=l.useMemo(()=>(a==null?void 0:a.type)==="group"?null:a!=null&&a.uid?a.uid:d&&d.includes("_")?d.split("_").find(z=>z!==(t==null?void 0:t.uid)):null,[a,d,t==null?void 0:t.uid]),{online:$,lastSeen:E,loading:D}=lt(N),{markAsRead:_,hasCurrentUserRead:A,isMessageRead:B}=Rs(d,t==null?void 0:t.uid),y=re(),M=l.useMemo(()=>d&&y?{chatId:d,limit:100}:"skip",[d,y]),P=l.useMemo(()=>d&&y&&(a==null?void 0:a.type)==="group"?{chatId:d}:"skip",[d,y,a==null?void 0:a.type]),W=Ne(Y.conversations.getChatMembers,P),X=l.useMemo(()=>W?W.map(g=>g.userId):[],[W]),K=Ne(Y.messages.getMessages,M),L=l.useMemo(()=>K?K.map(g=>({id:g._id,b:g.content||"",s:g.senderId,n:g.senderName,photo:g.senderPhoto||"",t:g.timestamp,edited:g.edited||!1,editedAt:g.editedAt,deleted:g.deleted||!1,deletedForAll:g.deletedForAll||!1,media:g.media,replyTo:g.replyTo,reactions:g.reactions||{}})):[],[K]),te=ae(Y.messages.sendMessage),se=ae(Y.messages.editMessage),Z=ae(Y.messages.deleteMessage),ne=ae(Y.messages.addReaction),ee=ae(Y.messages.removeReaction),F=ae(Y.conversations.updateConversation),V=ae(Y.conversations.updateUnreadCount);l.useEffect(()=>{S.current&&L.length>0&&S.current.scrollIntoView({behavior:"smooth"})},[L]);const oe=l.useRef(0);l.useEffect(()=>{if(d&&(t!=null&&t.uid)&&L.length>0){const g=L.map(C=>C.id),z=g.length;z!==oe.current&&(oe.current=z,_(g))}},[d,t==null?void 0:t.uid,L.length,_]),l.useEffect(()=>{L.forEach(g=>{if(g.b){const z=g.b.match(/(https?:\/\/[^\s]+)/);if(z){const C=z[0];m[g.id]||Ms(C).then(H=>p(G=>({...G,[g.id]:H}))).catch(H=>console.error(H))}}})},[L]);const f=async(g,z)=>{var C,H;if(!(!d||!(t!=null&&t.uid)||!re()))try{const G=L.find(O=>O.id===g);if(!G)return;((H=(C=G.reactions)==null?void 0:C[z])==null?void 0:H.includes(t.uid))?await ee({messageId:g,userId:t.uid,emoji:z}):await ne({messageId:g,userId:t.uid,emoji:z})}catch(G){console.error("Reaction error:",G)}},R=async(g,z)=>{if(!re()||!te||!F){alert("Chat functionality is not available. Convex is not configured.");return}const C=g.b||"",H=g.media||null;for(const G of z)try{await te({chatId:G,senderId:t.uid,senderName:s.firstName||"User",senderPhoto:s.photoURL||void 0,content:`ç«Šï½ª Forwarded: ${C}`,media:H||void 0});const I=r==null?void 0:r.find(le=>le.id===G),O=C||(H?`Forwarded ${H.type}`:"Forwarded message");await F({userId:t.uid,chatId:G,lastMessage:`ç«Šï½ª ${O}`,lastMessageTime:Date.now(),lastSenderId:t.uid,chatName:(I==null?void 0:I.name)||(I==null?void 0:I.n),chatPhoto:(I==null?void 0:I.photo)||"",chatType:(I==null?void 0:I.type)||"direct",otherUserId:I==null?void 0:I.uid})}catch(I){console.error("Forward error for chat:",G,I)}},q=async(g,z)=>{var H;if(!d||!(g!=null&&g.trim())&&!z||!re()||!te||!se||!F||!V)return;let C=g?g.trim():"";if(C.length===0&&z&&(C=z.type==="image"?"ðŸ“· Image":z.type==="video"?"ðŸŽ¥ Video":z.type==="audio"?"ðŸŽµ Audio":"ðŸ“Ž File"),h)try{await se({messageId:h.id,content:C,senderId:t.uid}),i(null);return}catch(G){console.error("Edit error:",G);return}try{await te({chatId:d,senderId:t.uid,senderName:s.firstName||"User",senderPhoto:s.photoURL||void 0,content:C||void 0,media:z||void 0,replyTo:k?{messageId:k.id,text:((H=k.b)==null?void 0:H.substring(0,100))||"Media",sender:k.n||"User"}:void 0});const G=C||(z?`Sent ${z.type}`:"Message");let I=[],O=a.uid;!O&&a.type!=="group"&&d&&d.includes("_")&&(O=d.split("_").find(ot=>ot!==t.uid)),a.type==="group"?I=X.length>0?[...new Set([t.uid,...X])]:[t.uid]:O?I=[t.uid,O]:I=[t.uid];for(const le of I)await F({userId:le,chatId:d,lastMessage:G,lastMessageTime:Date.now(),lastSenderId:t.uid,chatName:a.type==="group"?v:a.name||a.n,chatPhoto:a.photo||"",chatType:a.type||"direct",otherUserId:a.type==="direct"?le===t.uid?O:t.uid:void 0}),le===t.uid?await V({userId:le,chatId:d,setTo:0}):await V({userId:le,chatId:d,increment:1});u(null)}catch(G){console.error("Send message error:",G)}},ce=async(g,z=!1)=>{if(!(!d||!(t!=null&&t.uid)||!re()||!Z))try{await Z({messageId:g,senderId:t.uid,forEveryone:z})}catch(C){console.error("Delete error:",C)}},xe=l.useMemo(()=>{var g;return e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-800 bg-white dark:bg-[#1f2128]",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("button",{onClick:o,className:"md:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(et,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 cursor-pointer",onClick:()=>b==null?void 0:b(N?{uid:N}:null),children:[e.jsx(he,{src:(a==null?void 0:a.photo)||((g=a==null?void 0:a.n)==null?void 0:g.photo)||"",name:v,size:"md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:v}),(a==null?void 0:a.type)!=="group"&&e.jsx(it,{online:$,lastSeen:E,loading:D})]}),(a==null?void 0:a.type)!=="group"&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:$?"Online":E?`Last seen ${$e(E)}`:"Offline"})]})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(Mt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})},[a,v,$,E,D,N,o,n,b]),$e=g=>{if(!g)return"Never";const z=g,H=Date.now()-z,G=Math.floor(H/6e4),I=Math.floor(G/60),O=Math.floor(I/24);return G<1?"Just now":G<60?`${G}m ago`:I<24?`${I}h ago`:O<7?`${O}d ago`:new Date(z).toLocaleDateString()};return!a||!d?e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#1f2128] items-center justify-center text-gray-400",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(pe,{size:64,className:"text-gray-200 dark:text-gray-700 mb-2"})}),e.jsx("p",{children:"Select a conversation to start chatting"})]}):e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#1f2128]",children:[xe,e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide",children:[L.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{children:"No messages yet. Start the conversation!"})}):L.map((g,z)=>{const C=z>0?L[z-1]:null,H=g.s===(t==null?void 0:t.uid),G=B(g.id),I=A(g.id);return e.jsx(ks,{message:g,isCurrentUser:H,previousMessage:C,currentUserId:t==null?void 0:t.uid,chatId:d,linkPreviewData:m[g.id],messageStatus:G?"read":I?"delivered":"sent",onReaction:O=>f(g.id,O),onReply:()=>u(g),onEdit:()=>i(g),onDelete:O=>ce(g.id,O),onForward:()=>j(g),onSeshNxLinkClick:O=>w({isOpen:!0,url:O,previewData:null}),onUserClick:()=>b==null?void 0:b({uid:g.s})},g.id)}),e.jsx("div",{ref:S})]}),e.jsx(ps,{onSend:q,replyingTo:k,editingMessage:h,onCancelReply:()=>u(null),onCancelEdit:()=>i(null)}),c&&e.jsx(Ss,{message:c,conversations:r,onClose:()=>j(null),onForward:R}),x.isOpen&&e.jsx(js,{url:x.url,previewData:x.previewData,onClose:()=>w({isOpen:!1,url:"",previewData:null})})]})}function As({chatId:t,onClose:s,onMediaSelect:a}){const[r,o]=l.useState([]),[n,b]=l.useState(!0),[m,p]=l.useState(null),[x,w]=l.useState("all");l.useEffect(()=>{if(!t||!Q)return;const i=Kt(ie(Q,`messages/${t}`),Zt("t"),Xt(500)),c=es(i,j=>{const S=j.val();if(S){const v=Object.entries(S).map(([N,$])=>({id:N,...$})).filter(N=>N.media&&!N.deleted&&!N.deletedForAll).map(N=>({id:N.id,...N.media,messageId:N.id,timestamp:N.t,sender:N.n})).sort((N,$)=>(N.timestamp||0)-($.timestamp||0));o(v)}else o([]);b(!1)});return()=>c()},[t,Q]);const k=x==="all"?r:r.filter(i=>x==="images"?i.type==="image":x==="videos"?i.type==="video":x==="audio"?i.type==="audio":x==="files"?i.type==="file":!0),u=i=>{p(i),a&&a(i)},h=i=>{const c=document.createElement("a");c.href=i.url,c.download=i.name||"download",c.target="_blank",document.body.appendChild(c),c.click(),document.body.removeChild(c)};return e.jsxs("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:[e.jsxs(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between shrink-0",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Media Gallery"}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(J,{size:20})})]}),e.jsx("div",{className:"p-3 border-b dark:border-gray-700 flex gap-2 overflow-x-auto scrollbar-hide shrink-0",children:[{key:"all",label:"All",icon:null},{key:"images",label:"Images",icon:Oe},{key:"videos",label:"Videos",icon:Re},{key:"audio",label:"Audio",icon:Ee},{key:"files",label:"Files",icon:ke}].map(i=>e.jsxs("button",{onClick:()=>w(i.key),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold whitespace-nowrap transition ${x===i.key?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200"}`,children:[i.icon&&e.jsx(i.icon,{size:16}),i.label,e.jsxs("span",{className:"text-xs opacity-70",children:["(",k.filter(c=>i.key==="all"||c.type===i.key).length,")"]})]},i.key))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4",children:n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-blue border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading media..."})]}):k.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(Oe,{size:48,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No media found"})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3",children:k.map(i=>e.jsxs(U.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>u(i),className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 cursor-pointer group",children:[i.type==="image"?e.jsx("img",{src:i.url,alt:"Media",className:"w-full h-full object-cover"}):i.type==="video"?e.jsx("video",{src:i.url,className:"w-full h-full object-cover"}):i.type==="audio"?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-purple-100 dark:bg-purple-900/30",children:e.jsx(Ee,{size:32,className:"text-purple-600 dark:text-purple-400"})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-100 dark:bg-blue-900/30",children:e.jsx(ke,{size:32,className:"text-blue-600 dark:text-blue-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition flex items-center justify-center",children:e.jsx(Pe,{size:20,className:"text-white opacity-0 group-hover:opacity-100 transition"})})]},i.id))})})]}),e.jsx(me,{children:m&&e.jsx(Is,{media:m,onClose:()=>p(null),onDownload:h})})]})}function Is({media:t,onClose:s,onDownload:a}){const[r,o]=l.useState([]),[n,b]=l.useState(0);l.useEffect(()=>{o([t]),b(0)},[t]);const m=()=>{n<r.length-1&&b(n+1)},p=()=>{n>0&&b(n-1)},x=r[n]||t;return e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/95 z-[90] flex items-center justify-center",onClick:s,children:e.jsxs("div",{className:"relative max-w-7xl max-h-[90vh] w-full h-full flex items-center justify-center p-4",onClick:w=>w.stopPropagation(),children:[e.jsx("button",{onClick:s,className:"absolute top-4 right-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70 transition z-10",children:e.jsx(J,{size:24})}),x.type==="image"&&e.jsx("img",{src:x.url,alt:"Media",className:"max-w-full max-h-full object-contain rounded-lg"}),x.type==="video"&&e.jsx("video",{src:x.url,controls:!0,className:"max-w-full max-h-full rounded-lg",autoPlay:!0}),x.type==="audio"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md",children:[e.jsx("div",{className:"w-32 h-32 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(Ee,{size:48,className:"text-purple-600 dark:text-purple-400"})}),e.jsx("audio",{src:x.url,controls:!0,className:"w-full",autoPlay:!0}),e.jsx("p",{className:"text-center mt-4 text-sm text-gray-500",children:x.name})]}),x.type==="file"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md text-center",children:[e.jsx(ke,{size:64,className:"text-blue-600 dark:text-blue-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-bold dark:text-white mb-2",children:x.name}),e.jsx("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block mt-4 px-6 py-2 bg-brand-blue text-white rounded-lg hover:bg-blue-600 transition",children:"Open File"})]}),r.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,disabled:n===0,className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 transition",children:e.jsx(zt,{size:24})}),e.jsx("button",{onClick:m,disabled:n===r.length-1,className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 transition",children:e.jsx(tt,{size:24})})]}),e.jsx("button",{onClick:()=>a(x),className:"absolute bottom-4 left-1/2 -translate-x-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 transition",children:e.jsx(Pe,{size:20})})]})})}function Ps({activeChat:t,onClose:s,currentUser:a}){const[r,o]=l.useState([]),[n,b]=l.useState({sessions:0,rating:0,responseTime:"N/A"}),[m,p]=l.useState(!0),[x,w]=l.useState(!1),[k,u]=l.useState(!1),h=t.type==="group",i=t.uid,c=t.name||t.n||"Unknown";l.useEffect(()=>{const d=async()=>{p(!0);try{if(o([]),!h&&i){const v=Qe(be,`artifacts/${T}/users/${i}/public_profile/main`),N=await ts(v),$=N.exists()?N.data():{},E=ss(be,`artifacts/${T}/public/data/bookings`),D=Te(E,de("senderId","==",a.uid||""),de("targetId","==",i),de("status","==","Completed")),_=await as(D);b({sessions:_.data().count,rating:$.rating||"New",responseTime:$.responseTime||"~1hr"})}}catch(v){console.error("Failed to load details:",v)}p(!1)};t!=null&&t.id&&d()},[t.id,i,h,a==null?void 0:a.uid]);const j=async()=>{if(!(h||!i||!a)&&confirm(`Are you sure you want to block ${c}?`)){w(!0);try{const d=Qe(be,is(a.uid).userProfile);await rs(d,{"settings.social.blockedUsers":ns(i)}),alert("User blocked."),s()}catch(d){console.error("Block failed:",d),alert("Failed to block user.")}w(!1)}},S=()=>{alert("Please use the report option on their profile page for full moderation tools.")};return e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full md:w-80 bg-gray-800 shadow-xl z-20 flex flex-col transition-transform duration-300 ease-in-out border-l border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Details"}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-full transition duration-150","aria-label":"Close details",children:e.jsx(J,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 flex flex-col items-center border-b border-gray-700 bg-gray-800",children:[e.jsxs("div",{className:"relative w-24 h-24 rounded-full overflow-hidden mb-4 bg-gray-700 flex items-center justify-center shadow-lg border-4 border-gray-600",children:[e.jsx("img",{src:t.photo,className:"w-full h-full object-cover",onError:d=>d.target.src="",alt:c}),!t.photo&&(h?e.jsx(pe,{className:"w-10 h-10 text-gray-500"}):e.jsx(Ze,{className:"w-10 h-10 text-gray-500"}))]}),e.jsx("h4",{className:"text-xl font-bold text-white text-center leading-tight",children:c}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2 flex items-center px-3 py-1 bg-gray-700 rounded-full",children:[h?e.jsx(pe,{className:"w-3 h-3 mr-1"}):e.jsx(Ve,{className:"w-3 h-3 mr-1"}),h?"Group Chat":t.role||"Creative"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[!h&&e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3 tracking-wider",children:"Performance"}),m?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(fe,{className:"animate-spin text-brand-blue"})}):e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(ze,{title:"Sessions",value:n.sessions,icon:Ve,color:"text-blue-400"}),e.jsx(ze,{title:"Rating",value:n.rating,icon:qe,color:"text-yellow-400"}),e.jsx(ze,{title:"Reply Time",value:n.responseTime,icon:De,color:"text-green-400"})]})]}),e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Shared Media"}),e.jsx("button",{onClick:()=>u(!0),className:"text-xs text-brand-blue hover:underline font-medium",children:"View All"})]}),r.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-2",children:r.slice(0,6).map((d,v)=>e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-700 cursor-pointer hover:opacity-80 transition",children:[d.type==="image"&&e.jsx("img",{src:d.url,className:"w-full h-full object-cover",alt:"Media"}),d.type==="video"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Re,{size:20,className:"text-gray-400"})})]},v))}):e.jsx("p",{className:"text-xs text-gray-500 text-center py-4",children:"No shared media yet"})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition",children:[e.jsx(At,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{children:"Mute Notifications"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition",children:[e.jsx(It,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Media Gallery"})]}),!h&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:j,disabled:x,className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-red-400 hover:bg-red-900/20 hover:text-red-300 rounded-lg transition disabled:opacity-50",children:[x?e.jsx(fe,{className:"w-4 h-4 animate-spin"}):e.jsx(Ft,{className:"w-4 h-4"}),e.jsx("span",{children:"Block User"})]}),e.jsxs("button",{onClick:S,className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-red-400 hover:bg-red-900/20 hover:text-red-300 rounded-lg transition",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:"Report User"})]})]})]})]}),k&&e.jsx(As,{chatId:t.id,onClose:()=>u(!1)})]})}export{Cs as C,ze as S,he as U,Ts as a,T as b,Y as c,be as d,_s as e,Ds as f,is as g,Ps as h,re as i,ge as j,Gs as k,Ye as s,us as u};
