{"version":3,"file":"LocationPicker-BQ-moHv-.js","sources":["../../src/components/shared/LocationPicker.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { MapPin, Crosshair, Loader2 } from 'lucide-react';\r\nimport { fetchZipLocation } from '../../utils/geocode';\r\n\r\nexport default function LocationPicker({ \r\n    initialZip = '', \r\n    onLocationChange, \r\n    showMap = false, // Optional: Show mini-map or just inputs\r\n    label = \"Location\"\r\n}) {\r\n    const [zip, setZip] = useState(initialZip);\r\n    const [locationName, setLocationName] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [coords, setCoords] = useState(null);\r\n\r\n    // Sync internal state if prop changes\r\n    useEffect(() => {\r\n        if (initialZip && initialZip !== zip) {\r\n            setZip(initialZip);\r\n            handleZipChange(initialZip);\r\n        }\r\n    }, [initialZip]);\r\n\r\n    const handleZipChange = async (val) => {\r\n        const cleanZip = val.replace(/\\D/g, '').slice(0, 5);\r\n        setZip(cleanZip);\r\n\r\n        if (cleanZip.length === 5) {\r\n            setLoading(true);\r\n            const loc = await fetchZipLocation(cleanZip);\r\n            if (loc) {\r\n                setLocationName(loc.cityState);\r\n                setCoords({ lat: loc.lat, lng: loc.lng });\r\n                onLocationChange({ zip: cleanZip, ...loc });\r\n            } else {\r\n                setLocationName('Unknown Location');\r\n                onLocationChange({ zip: cleanZip, valid: false });\r\n            }\r\n            setLoading(false);\r\n        } else {\r\n            setLocationName('');\r\n        }\r\n    };\r\n\r\n    const handleUseCurrentLocation = () => {\r\n        if (!navigator.geolocation) return alert(\"Geolocation not supported\");\r\n        \r\n        setLoading(true);\r\n        navigator.geolocation.getCurrentPosition(async (pos) => {\r\n            const { latitude, longitude } = pos.coords;\r\n            try {\r\n                // Reverse Geocode to get Zip\r\n                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);\r\n                const data = await res.json();\r\n                const foundZip = data.address.postcode;\r\n                \r\n                if (foundZip) {\r\n                    const cleanZip = foundZip.split('-')[0]; // Handle 90210-1234 format\r\n                    setZip(cleanZip);\r\n                    // Trigger the standard lookup with the found zip to standardize data flow\r\n                    handleZipChange(cleanZip); \r\n                } else {\r\n                    // Fallback if no zip found but coords are valid\r\n                    setCoords({ lat: latitude, lng: longitude });\r\n                    setLocationName(\"Current Location\");\r\n                    onLocationChange({ lat: latitude, lng: longitude, name: \"Current Location\", valid: true });\r\n                }\r\n            } catch (e) {\r\n                console.error(e);\r\n                alert(\"Failed to determine location.\");\r\n            }\r\n            setLoading(false);\r\n        }, (err) => {\r\n            console.warn(err);\r\n            alert(\"Location access denied.\");\r\n            setLoading(false);\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full\">\r\n            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">{label}</label>\r\n            <div className=\"relative flex gap-2\">\r\n                <div className=\"relative flex-1\">\r\n                    <input \r\n                        className=\"w-full pl-9 p-2.5 bg-white dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all text-sm\" \r\n                        placeholder=\"Zip Code\" \r\n                        maxLength={5} \r\n                        value={zip} \r\n                        onChange={e => handleZipChange(e.target.value)} \r\n                    />\r\n                    <MapPin className={`absolute left-3 top-3 text-gray-400 ${loading ? 'animate-pulse' : ''}`} size={16} />\r\n                </div>\r\n                <button \r\n                    onClick={handleUseCurrentLocation}\r\n                    disabled={loading}\r\n                    className=\"p-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-brand-blue transition-colors\"\r\n                    title=\"Use my location\"\r\n                >\r\n                    {loading ? <Loader2 size={18} className=\"animate-spin\" /> : <Crosshair size={18} />}\r\n                </button>\r\n            </div>\r\n            {locationName && (\r\n                <div className=\"mt-1.5 text-xs font-medium text-gray-500 dark:text-gray-400 flex items-center gap-1 animate-in fade-in\">\r\n                    <span className=\"w-1.5 h-1.5 rounded-full bg-green-500\"></span>\r\n                    {locationName}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":["LocationPicker","initialZip","onLocationChange","showMap","label","zip","setZip","useState","locationName","setLocationName","loading","setLoading","coords","setCoords","useEffect","handleZipChange","val","cleanZip","loc","fetchZipLocation","handleUseCurrentLocation","pos","latitude","longitude","foundZip","e","err","jsxs","jsx","MapPin","Loader2","Crosshair"],"mappings":"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"}