import{r as i,j as e,X as B,c5 as _,a6 as S,L as C,ce as I,a1 as N,b as z,i as L,T as M,h as T}from"./vendor-Dl7DtIXW.js";import{s as g}from"./chat-BYF7Vx2D.js";import{f as E}from"./edu-BMUxkX2v.js";import"./vendor-framer-CUELlS5e.js";import"./config-DGZTEYpI.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new a.Error().stack;n&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[n]="23e6e8dc-b876-4381-892f-0e3620d1854b",a._sentryDebugIdIdentifier="sentry-dbid-23e6e8dc-b876-4381-892f-0e3620d1854b")})()}catch{}function F({user:a,userData:n,broadcast:r,onClose:c}){const[x,m]=i.useState(Math.floor((r.offer_amount||r.offerAmount)/(r.duration||1))),[o,u]=i.useState(""),[f,d]=i.useState(!1),b=x*(r.duration||1),p=r.offer_amount||r.offerAmount,h=b>p,v=async()=>{if(!x||!o)return alert("Please enter a rate and a message.");if(h)return alert("Your bid exceeds the client's budget.");if(!g){alert("Database unavailable.");return}d(!0);try{const t=(a==null?void 0:a.id)||(a==null?void 0:a.uid),{error:s}=await g.from("bookings").insert({type:"Bid",broadcast_id:r.id,target_id:r.sender_id||r.senderId,target_name:r.sender_name||r.senderName,sender_id:t,sender_name:n&&`${n.firstName||""} ${n.lastName||""}`.trim()||"User",service_type:`Bid: ${r.service_type||r.serviceType||"Session"}`,offer_amount:b,rate_per_hour:parseInt(x),message:o,status:"Pending",date:"Flexible",timestamp:new Date().toISOString()});if(s)throw s;alert("Bid submitted successfully! The client has been notified."),c()}catch(t){console.error("Error submitting bid:",t),alert("Failed to submit bid: "+(t.message||"Unknown error"))}d(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Place Your Bid"}),e.jsx("button",{onClick:c,children:e.jsx(B,{size:20,className:"text-gray-500 hover:text-white"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 uppercase mb-1",children:"Client's Budget"}),e.jsxs("div",{className:"text-2xl font-extrabold dark:text-white",children:["$",p," ",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["Total (",r.duration," hrs)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-500 mb-2",children:"Your Hourly Rate ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{size:16,className:"absolute left-3 top-3.5 text-gray-400"}),e.jsx("input",{type:"number",className:`w-full pl-8 p-3 border rounded-xl font-bold text-lg outline-none dark:bg-[#1f2128] dark:text-white ${h?"border-red-500 focus:ring-red-500":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"}`,value:x,onChange:t=>m(t.target.value)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Total Bid:"}),e.jsxs("span",{className:`font-bold ${h?"text-red-500":"text-green-600"}`,children:["$",b]})]}),h&&e.jsxs("div",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(S,{size:12})," Bid exceeds budget. Consider lowering your rate."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-500 mb-2",children:"Message to Client"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl text-sm dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none resize-none",rows:"3",placeholder:"Introduce yourself and your gear...",value:o,onChange:t=>u(t.target.value)})]}),e.jsx("button",{onClick:v,disabled:f||h,className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold shadow-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:shadow-none",children:f?e.jsx(C,{className:"animate-spin"}):"Submit Proposal"})]})]})})}function k(a,n,r,c){var x=6371,m=j(r-a),o=j(c-n),u=Math.sin(m/2)*Math.sin(m/2)+Math.cos(j(a))*Math.cos(j(r))*Math.sin(o/2)*Math.sin(o/2),f=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return x*f*.621371}function j(a){return a*(Math.PI/180)}function U({user:a,userData:n,onBid:r}){const[c,x]=i.useState([]),[m,o]=i.useState([]),[u,f]=i.useState(null),[d,b]=i.useState(null),[p,h]=i.useState(50);i.useEffect(()=>{(async()=>{if(n!=null&&n.zip){const s=await E(n.zip);s&&b({lat:s.lat,lng:s.lng})}else navigator.geolocation&&navigator.geolocation.getCurrentPosition(s=>b({lat:s.coords.latitude,lng:s.coords.longitude}))})()},[n]),i.useEffect(()=>{if(!g)return;const t=async()=>{try{const{data:l,error:w}=await g.from("bookings").select("*").eq("type","Broadcast").eq("status","Broadcasting").order("created_at",{ascending:!1});if(w)throw w;x((l||[]).map(y=>({id:y.id,...y,senderId:y.sender_id,targetId:y.target_id,timestamp:y.created_at})))}catch(l){console.error("Error loading broadcasts:",l)}};t();const s=g.channel("broadcasts").on("postgres_changes",{event:"*",schema:"public",table:"bookings",filter:"type=eq.Broadcast"},()=>{t()}).subscribe();return()=>{g.removeChannel(s)}},[]),i.useEffect(()=>{if(!d){o(c);return}const t=c.filter(s=>!s.location||!s.location.lat||!s.location.lng?!0:k(d.lat,d.lng,s.location.lat,s.location.lng)<=p).map(s=>{const l=s.location?k(d.lat,d.lng,s.location.lat,s.location.lng):null;return{...s,distance:l}}).sort((s,l)=>(s.distance||9999)-(l.distance||9999));o(t)},[c,d,p]);const v=async t=>{if(window.confirm("Cancel this broadcast? This will remove it from the board.")&&g)try{const{error:s}=await g.from("bookings").update({status:"Cancelled",updated_at:new Date().toISOString()}).eq("id",t);if(s)throw s}catch(s){console.error(s),alert("Failed to cancel.")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-end gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(I,{className:"text-yellow-500",size:20})," Open Sessions"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Live opportunities near you."})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[e.jsx(N,{size:14,className:"ml-2 text-gray-500"}),e.jsxs("select",{className:"bg-transparent text-sm font-bold text-gray-700 dark:text-gray-300 p-1 outline-none cursor-pointer",value:p,onChange:t=>h(Number(t.target.value)),children:[e.jsx("option",{value:10,children:"Within 10 mi"}),e.jsx("option",{value:25,children:"Within 25 mi"}),e.jsx("option",{value:50,children:"Within 50 mi"}),e.jsx("option",{value:100,children:"Within 100 mi"}),e.jsx("option",{value:5e3,children:"Anywhere"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.length===0?e.jsx("div",{className:"col-span-full text-center py-12 bg-white dark:bg-[#2c2e36] rounded-xl border border-dashed dark:border-gray-700 text-gray-500",children:"No open sessions found."}):m.map(t=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all group relative overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 right-0 bg-brand-blue text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg",children:["BUDGET: $",t.offerAmount||"N/A"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 flex justify-between",children:[e.jsx("span",{children:t.serviceType}),typeof t.distance=="number"&&e.jsxs("span",{className:"text-brand-blue flex items-center gap-1",children:[e.jsx(N,{size:10})," ",t.distance.toFixed(1)," mi"]})]}),e.jsx("h4",{className:"text-lg font-bold dark:text-white truncate pr-16",children:t.targetName||"Session Request"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-300 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{size:14})," ",t.senderName]}),t.date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{size:14})," ",t.date==="Flexible"?"Flexible":new Date(t.date).toLocaleDateString()]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:t.requirements&&t.requirements.slice(0,3).map((s,l)=>e.jsx("span",{className:"text-[10px] bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-600 dark:text-gray-300 border dark:border-gray-600",children:s.value},l))}),e.jsx("div",{className:"flex gap-2",children:t.sender_id===((a==null?void 0:a.id)||(a==null?void 0:a.uid))?e.jsxs("button",{onClick:()=>v(t.id),className:"w-full bg-red-100 text-red-600 py-2.5 rounded-lg font-bold text-sm hover:bg-red-200 transition flex items-center justify-center gap-2",children:[e.jsx(M,{size:16})," Cancel"]}):e.jsxs("button",{onClick:()=>f(t),className:"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-2.5 rounded-lg font-bold text-sm hover:opacity-90 transition flex justify-center items-center gap-2",children:["View & Bid ",e.jsx(T,{size:16})]})})]},t.id))}),u&&e.jsx(F,{user:a,userData:n,broadcast:u,onClose:()=>f(null)})]})}export{U as default};
