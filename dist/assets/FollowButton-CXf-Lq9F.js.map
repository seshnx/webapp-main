{"version":3,"file":"FollowButton-CXf-Lq9F.js","sources":["../../src/hooks/useFollowSystem.js","../../src/components/social/FollowButton.jsx"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { getFollowing, getFollowers, followUser as followUserQuery, unfollowUser as unfollowUserQuery, getFollowingCount, getFollowersCount, getProfilesByIds } from '../config/neonQueries';\r\n\r\n/**\r\n * Hook for managing the social follow system (Neon Version)\r\n * @param {string} currentUserId - The authenticated user's ID\r\n */\r\nexport function useFollowSystem(currentUserId) {\r\n    const [following, setFollowing] = useState([]); // List of profiles current user follows\r\n    const [followers, setFollowers] = useState([]); // List of profiles following current user\r\n    const [stats, setStats] = useState({ followersCount: 0, followingCount: 0 });\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Fetch Helper: Get detailed profiles for a list of IDs\r\n    const fetchProfiles = async (userIds) => {\r\n        if (!userIds || userIds.length === 0) return [];\r\n\r\n        try {\r\n            const profiles = await getProfilesByIds(userIds);\r\n\r\n            return profiles.map(p => ({\r\n                odId: p.user_id || p.id, // Keeping odId for compatibility\r\n                userId: p.user_id || p.id,\r\n                displayName: p.display_name || `${p.first_name || ''} ${p.last_name || ''}`.trim(),\r\n                photoURL: p.avatar_url || p.photo_url,\r\n                role: p.active_role || p.role\r\n            }));\r\n        } catch (error) {\r\n            console.error(\"Error fetching profiles:\", error);\r\n            return [];\r\n        }\r\n    };\r\n\r\n    const loadData = useCallback(async () => {\r\n        if (!currentUserId) return;\r\n\r\n        try {\r\n            // 1. Get IDs of who I follow\r\n            const followingIds = await getFollowing(currentUserId);\r\n            const followingProfiles = await fetchProfiles(followingIds);\r\n            setFollowing(followingProfiles);\r\n\r\n            // 2. Get IDs of who follows me\r\n            const followerIds = await getFollowers(currentUserId);\r\n            const followerProfiles = await fetchProfiles(followerIds);\r\n            setFollowers(followerProfiles);\r\n\r\n            // 3. Stats\r\n            setStats({\r\n                followingCount: followingIds.length,\r\n                followersCount: followerIds.length\r\n            });\r\n\r\n            setLoading(false);\r\n        } catch (err) {\r\n            console.error(\"Error loading follow data:\", err);\r\n            setLoading(false);\r\n        }\r\n    }, [currentUserId]);\r\n\r\n    // Initial Load & Polling\r\n    useEffect(() => {\r\n        loadData();\r\n\r\n        if (!currentUserId) return;\r\n\r\n        // Set up polling to check for follow changes (every 30 seconds)\r\n        const pollInterval = setInterval(() => {\r\n            loadData();\r\n        }, 30000);\r\n\r\n        return () => {\r\n            clearInterval(pollInterval);\r\n        };\r\n    }, [currentUserId, loadData]);\r\n\r\n    const isFollowing = useCallback((targetUserId) => {\r\n        return following.some(f => f.odId === targetUserId);\r\n    }, [following]);\r\n\r\n    const followUser = useCallback(async (targetUserId) => {\r\n        if (!currentUserId || !targetUserId || currentUserId === targetUserId) return;\r\n\r\n        try {\r\n            await followUserQuery(currentUserId, targetUserId);\r\n\r\n            // Optimistic update\r\n            loadData();\r\n            return { success: true };\r\n        } catch (error) {\r\n            console.error('Follow error:', error);\r\n            return { success: false, error };\r\n        }\r\n    }, [currentUserId, loadData]);\r\n\r\n    const unfollowUser = useCallback(async (targetUserId) => {\r\n        if (!currentUserId || !targetUserId) return;\r\n\r\n        try {\r\n            await unfollowUserQuery(currentUserId, targetUserId);\r\n\r\n            // Optimistic update\r\n            loadData();\r\n            return { success: true };\r\n        } catch (error) {\r\n            console.error('Unfollow error:', error);\r\n            return { success: false, error };\r\n        }\r\n    }, [currentUserId, loadData]);\r\n\r\n    const toggleFollow = useCallback(async (targetUserId) => {\r\n        if (isFollowing(targetUserId)) {\r\n            return unfollowUser(targetUserId);\r\n        } else {\r\n            return followUser(targetUserId);\r\n        }\r\n    }, [isFollowing, followUser, unfollowUser]);\r\n\r\n    const getFollowingIds = useCallback(() => {\r\n        return following.map(f => f.odId);\r\n    }, [following]);\r\n\r\n    return {\r\n        following,\r\n        followers,\r\n        stats,\r\n        loading,\r\n        isFollowing,\r\n        followUser,\r\n        unfollowUser,\r\n        toggleFollow,\r\n        getFollowingIds\r\n    };\r\n}\r\n\r\n/**\r\n * Hook for fetching social stats for a specific user (read-only)\r\n */\r\nexport function useUserSocialStats(userId) {\r\n    const [stats, setStats] = useState({ followersCount: 0, followingCount: 0 });\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!userId) {\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const fetchStats = async () => {\r\n            try {\r\n                const [followers, following] = await Promise.all([\r\n                    getFollowersCount(userId),\r\n                    getFollowingCount(userId)\r\n                ]);\r\n\r\n                setStats({\r\n                    followersCount: followers,\r\n                    followingCount: following\r\n                });\r\n                setLoading(false);\r\n            } catch (error) {\r\n                console.error(\"Error fetching social stats:\", error);\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchStats();\r\n    }, [userId]);\r\n\r\n    return { stats, loading };\r\n}\r\n","import React, { useState } from 'react';\r\nimport { UserPlus, UserMinus, Loader2, UserCheck } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\n/**\r\n * Reusable Follow/Unfollow button component\r\n * @param {boolean} isFollowing - Whether current user follows target\r\n * @param {function} onToggle - Callback to toggle follow state\r\n * @param {string} size - 'sm' | 'md' | 'lg'\r\n * @param {string} variant - 'default' | 'outline' | 'minimal'\r\n * @param {boolean} disabled - Disable button (e.g., if viewing own profile)\r\n */\r\nexport default function FollowButton({ \r\n    isFollowing, \r\n    onToggle, \r\n    size = 'md', \r\n    variant = 'default',\r\n    disabled = false,\r\n    showIcon = true,\r\n    className = ''\r\n}) {\r\n    const [loading, setLoading] = useState(false);\r\n    const [isHovering, setIsHovering] = useState(false);\r\n\r\n    const handleClick = async (e) => {\r\n        e.stopPropagation();\r\n        if (disabled || loading) return;\r\n        \r\n        setLoading(true);\r\n        try {\r\n            await onToggle();\r\n        } catch (error) {\r\n            console.error('Follow toggle error:', error);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    // Size variants\r\n    const sizeClasses = {\r\n        sm: 'px-3 py-1 text-xs',\r\n        md: 'px-4 py-1.5 text-sm',\r\n        lg: 'px-6 py-2 text-base'\r\n    };\r\n\r\n    const iconSizes = {\r\n        sm: 12,\r\n        md: 14,\r\n        lg: 16\r\n    };\r\n\r\n    // Style variants\r\n    const getVariantClasses = () => {\r\n        if (isFollowing) {\r\n            // Following state - show unfollow on hover\r\n            if (variant === 'outline' || variant === 'minimal') {\r\n                return isHovering\r\n                    ? 'border-red-300 text-red-500 hover:bg-red-50 dark:border-red-800 dark:hover:bg-red-900/20'\r\n                    : 'border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300';\r\n            }\r\n            return isHovering\r\n                ? 'bg-red-500 text-white hover:bg-red-600'\r\n                : 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200';\r\n        } else {\r\n            // Not following - show follow\r\n            if (variant === 'outline') {\r\n                return 'border-brand-blue text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20';\r\n            }\r\n            if (variant === 'minimal') {\r\n                return 'text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20';\r\n            }\r\n            return 'bg-brand-blue text-white hover:bg-blue-600';\r\n        }\r\n    };\r\n\r\n    const baseClasses = `\r\n        font-semibold rounded-full transition-all duration-200 \r\n        flex items-center justify-center gap-1.5\r\n        disabled:opacity-50 disabled:cursor-not-allowed\r\n        ${variant === 'outline' ? 'border-2 bg-transparent' : ''}\r\n        ${variant === 'minimal' ? 'bg-transparent' : ''}\r\n        ${sizeClasses[size]}\r\n        ${getVariantClasses()}\r\n        ${className}\r\n    `;\r\n\r\n    const getIcon = () => {\r\n        if (loading) return <Loader2 className=\"animate-spin\" size={iconSizes[size]} />;\r\n        if (isFollowing) {\r\n            return isHovering \r\n                ? <UserMinus size={iconSizes[size]} />\r\n                : <UserCheck size={iconSizes[size]} />;\r\n        }\r\n        return <UserPlus size={iconSizes[size]} />;\r\n    };\r\n\r\n    const getText = () => {\r\n        if (isFollowing) {\r\n            return isHovering ? 'Unfollow' : 'Following';\r\n        }\r\n        return 'Follow';\r\n    };\r\n\r\n    return (\r\n        <motion.button\r\n            whileHover={{ scale: disabled ? 1 : 1.02 }}\r\n            whileTap={{ scale: disabled ? 1 : 0.98 }}\r\n            className={baseClasses}\r\n            onClick={handleClick}\r\n            onMouseEnter={() => setIsHovering(true)}\r\n            onMouseLeave={() => setIsHovering(false)}\r\n            disabled={disabled || loading}\r\n        >\r\n            <AnimatePresence mode=\"wait\">\r\n                <motion.span\r\n                    key={`${isFollowing}-${isHovering}`}\r\n                    initial={{ opacity: 0, y: -5 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    exit={{ opacity: 0, y: 5 }}\r\n                    transition={{ duration: 0.15 }}\r\n                    className=\"flex items-center gap-1.5\"\r\n                >\r\n                    {showIcon && getIcon()}\r\n                    <span>{getText()}</span>\r\n                </motion.span>\r\n            </AnimatePresence>\r\n        </motion.button>\r\n    );\r\n}\r\n\r\n/**\r\n * Compact follow button for use in lists/cards\r\n */\r\nexport function FollowButtonCompact({ isFollowing, onToggle, disabled }) {\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleClick = async (e) => {\r\n        e.stopPropagation();\r\n        if (disabled || loading) return;\r\n        setLoading(true);\r\n        try {\r\n            await onToggle();\r\n        } catch (error) {\r\n            console.error('Follow toggle error:', error);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    return (\r\n        <motion.button\r\n            whileTap={{ scale: 0.9 }}\r\n            onClick={handleClick}\r\n            disabled={disabled || loading}\r\n            className={`\r\n                p-2 rounded-full transition-all\r\n                ${isFollowing \r\n                    ? 'bg-gray-100 text-gray-600 hover:bg-red-50 hover:text-red-500 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-red-900/20' \r\n                    : 'bg-brand-blue text-white hover:bg-blue-600'\r\n                }\r\n                disabled:opacity-50\r\n            `}\r\n            title={isFollowing ? 'Unfollow' : 'Follow'}\r\n        >\r\n            {loading ? (\r\n                <Loader2 className=\"animate-spin\" size={16} />\r\n            ) : isFollowing ? (\r\n                <UserCheck size={16} />\r\n            ) : (\r\n                <UserPlus size={16} />\r\n            )}\r\n        </motion.button>\r\n    );\r\n}\r\n\r\n"],"names":["useFollowSystem","currentUserId","following","setFollowing","useState","followers","setFollowers","stats","setStats","loading","setLoading","fetchProfiles","userIds","getProfilesByIds","p","error","loadData","useCallback","followingIds","getFollowing","followingProfiles","followerIds","getFollowers","followerProfiles","err","useEffect","pollInterval","isFollowing","targetUserId","f","followUser","followUserQuery","unfollowUser","unfollowUserQuery","toggleFollow","getFollowingIds","useUserSocialStats","userId","getFollowersCount","getFollowingCount","FollowButton","onToggle","size","variant","disabled","showIcon","className","isHovering","setIsHovering","handleClick","e","sizeClasses","iconSizes","getVariantClasses","baseClasses","getIcon","jsx","Loader2","UserMinus","UserCheck","UserPlus","getText","motion","AnimatePresence","jsxs"],"mappings":"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"}