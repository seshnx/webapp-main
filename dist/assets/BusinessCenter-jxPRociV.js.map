{"version":3,"mappings":"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","names":["StudioOverview","userData","stats","onNavigate","currentDate","setCurrentDate","useState","studioName","rooms","amenities","totalCapacity","sum","r","avgRate","quickStats","jsx","Home","Users","DollarSign","Star","pendingBookings","jsxs","MapPin","stat","i","AlertCircle","Calendar","CheckCircle","room","amenity","ChevronLeft","ChevronRight","MiniCalendar","_a","booking","bookings","year","month","today","firstDay","daysInMonth","days","getDayBookings","day","b","bookingDate","isToday","dayNames","dayBookings","hasBookings","hasConfirmed","hasPending","Panorama360Viewer","imageUrl","onClose","title","viewerRef","useRef","containerRef","isFullscreen","setIsFullscreen","React","useEffect","__vitePreload","n","pannellumModule","viewer","error","e","toggleFullscreen","handleFullscreenChange","Minimize2","Maximize2","X","FloorplanTools","activeTool","setActiveTool","onUndo","onRedo","canUndo","canRedo","onZoomIn","onZoomOut","onFitToView","onExportSVG","onExportPNG","onExportPDF","showGrid","toggleGrid","measurementUnit","setMeasurementUnit","scale","setScale","onBackgroundImageUpload","onAddRoomTemplate","tools","Move","Square","Box","DoorOpen","RectangleHorizontal","Ruler","Type","Circle","Triangle","RotateCw","t","tool","Icon","ZoomIn","ZoomOut","Grid","FileText","ImageIcon","calculateDistance","x1","y1","x2","y2","calculateArea","width","height","area","calculatePerimeter","perimeter","snapToGrid","x","y","gridSize","snapToObject","objects","threshold","snapped","minDist","obj","objX","objY","_b","objW","_c","objH","_d","point","dist","formatMeasurement","pixels","unit","value","exportSVG","svgElement","svgString","svgBlob","url","exportPNG","canvas","ctx","img","resolve","reject","blob","generateId","prefix","FloorplanPropertyPanel","selectedItem","onUpdate","isRoom","isStructure","isWall","isDoor","isWindow","isFurniture","layout","handleUpdate","updates","FloorplanContextMenu","onAction","canCopy","canPaste","canCut","canDelete","canRotate","canFlip","isLocked","menuItems","Copy","Clipboard","Scissors","Trash2","FlipHorizontal","FlipVertical","Unlock","Lock","BringToFront","SendToBack","Fragment","item","index","FloorplanLayerPanel","layers","onLayerToggle","onLayerLock","layerList","Layers","layer","layerData","Eye","EyeOff","DoorComponent","door","isSelected","onClick","onMouseDown","rotation","subType","direction","centerX","centerY","arcRadius","WindowComponent","window","FurnitureComponent","furniture","useUndoRedo","initialState","maxHistory","state","setState","historyRef","historyIndexRef","setStateWithHistory","useCallback","newState","undo","redo","clearHistory","SNAP_GRID","getDistanceToLineSegment","px","py","A","B","C","D","dot","len_sq","param","xx","yy","dx","dy","FloorplanEditor","propWalls","propStructures","onRoomClick","onLayoutChange","onWallsChange","onStructuresChange","svgRef","isDragging","setIsDragging","isResizing","setIsResizing","cursorOffset","setCursorOffset","isPanning","setIsPanning","panOffset","setPanOffset","activeRoomId","setActiveRoomId","activeStructureId","setActiveStructureId","activeWallId","setActiveWallId","activeDoorId","setActiveDoorId","activeWindowId","setActiveWindowId","activeFurnitureId","setActiveFurnitureId","selectedItems","setSelectedItems","draggingWallHandle","setDraggingWallHandle","viewing360Room","setViewing360Room","contextMenu","setContextMenu","showPropertyPanel","setShowPropertyPanel","walls","setWalls","structures","setStructures","doors","setDoors","windows","setWindows","setFurniture","textLabels","setTextLabels","measurements","setMeasurements","backgroundImage","setBackgroundImage","clipboard","setClipboard","customShapes","setCustomShapes","setLayers","roomTemplates","setRoomTemplates","wallStartPoint","setWallStartPoint","measureStartPoint","setMeasureStartPoint","currentMeasurement","setCurrentMeasurement","zoom","setZoom","viewBox","setViewBox","setShowGrid","setGridSize","snapToObjects","setSnapToObjects","floorplanState","setHistoryState","getCoords","applyZoom","rect","clientX","clientY","allObjects","w","commitWalls","newWalls","saveToHistory","commitStructures","newStructures","commitDoors","newDoors","commitWindows","newWindows","commitFurniture","newFurniture","handleDelete","newStructs","s","d","handleCopy","handlePaste","offset","newStruct","newWall","handleCut","handleKeyDown","handleZoomIn","handleZoomOut","handleFitToView","startDragRoom","startResizeRoom","startPan","stopPan","addStructure","startDragStructure","struct","startResizeStructure","startDragWallHandle","wallId","selectWall","handleMouseMove","previewWall","prev","newPos","f","newLayout","minSize","distance","deltaX","deltaY","stopInteraction","handleCanvasClick","newMeasurement","newDoor","newWindow","newLabel","newCircle","toast","handleExportSVG","a","handleExportPNG","handleExportPDF","handleBackgroundImageUpload","file","reader","event","setTool","addRoom","template","baseRoom","newRoom","WallSegment","wall","isPreview","LayoutShape","data","name","rate","label","isActive","checkCornerLocked","cx","cy","tlSharp","trSharp","brSharp","blSharp","pathD","getSelectedItem","handlePropertyUpdate","updated","handleLayerToggle","layerKey","handleLayerLock","handleContextMenuAction","action","currentRotation","BoxSelect","Zap","rm","_e","_f","_g","_h","shape","p","_i","measure","_j","_k","StudioRooms","user","useLanguage","setRooms","editingRoom","setEditingRoom","isAdding","setIsAdding","saving","setSaving","expandedRoom","setExpandedRoom","viewMode","setViewMode","emptyRoom","handleSave","updatedRooms","updatedWalls","updatedStructures","toastId","userId","response","result","handleLayoutChange","roomId","handleWallsChange","handleStructuresChange","handleRoomClick","roomIndex","handleEditRoom","handleAddRoom","handleSaveRoom","handleDeleteRoom","_","handleDuplicateRoom","roomToCopy","handleCancelEdit","ROOM_AMENITIES","roomsWithLayout","LayoutGrid","List","Map","Plus","RoomEditor","Mic","Edit2","ChevronUp","ChevronDown","setRoom","onSave","onCancel","isNew","roomAmenities","uploadImage","uploading","useImageUpload","show360Viewer","setShow360Viewer","fileInputRef","handleAmenityToggle","current","handle360ImageUpload","path","handleRemove360Image","RoomEquipmentManager","equipment","Loader2","Upload","Save","onChange","setSelectedItem","quantity","setQuantity","handleAddEquipment","newEquipment","handleRemoveEquipment","handleUpdateQuantity","newQuantity","EquipmentAutocomplete","StudioGallery","photos","setPhotos","uploadProgress","setUploadProgress","selectedPhoto","setSelectedPhoto","draggingIndex","setDraggingIndex","uploadMedia","useMediaUpload","savePhotos","updatedPhotos","handleUpload","files","maxPhotos","newPhotos","timestamp","photoIndex","photo","handleSetCover","handleDragStart","handleDragOver","reorderedPhotos","draggedPhoto","handleDragEnd","handleFileDrop","coverPhoto","Image","DAYS_OF_WEEK","DEFAULT_HOURS","StudioAvailability","hours","setHours","blackoutDates","setBlackoutDates","newBlackout","setNewBlackout","showAddBlackout","setShowAddBlackout","updateDayHours","dayId","field","toggleDayClosed","copyToAllWeekdays","sourceHours","weekdays","newHours","addBlackoutDate","blackout","removeBlackoutDate","id","formatTime","time","h","m","hour","ampm","totalWeeklyHours","total","dayHours","openH","openM","closeH","closeM","openMinutes","closeMinutes","Clock","Sun","Moon","StudioPolicies","policies","setPolicies","_l","_m","_n","_o","_p","_q","_r","_s","_t","_u","expandedSection","setExpandedSection","updatePolicy","key","CANCELLATION_POLICIES","Section","children","isExpanded","AlertTriangle","policy","Shield","RecurringBookingModal","onSuccess","recurrenceType","setRecurrenceType","interval","setInterval","daysOfWeek","setDaysOfWeek","endDate","setEndDate","maxOccurrences","setMaxOccurrences","loading","setLoading","handleDayToggle","handleSubmit","nextOccurrence","currentDay","nextDay","daysToAdd","recurrencePattern","neonQuery","Repeat","MultiRoomBookingModal","selectedRooms","setSelectedRooms","roomTimeSlots","setRoomTimeSlots","start","end","initialSlots","handleRoomToggle","handleTimeChange","roomBookings","slot","startTime","endTime","rb","UnifiedCalendar","onDateChange","blockedDates","onDateClick","onBookingClick","view","onViewChange","showControls","className","localDate","setLocalDate","localView","setLocalView","displayDate","displayView","handleDateChange","newDate","handleViewChange","newView","navigateDate","goToToday","getWeekStart","date","diff","getWeekDates","weekStart","week","getDayBlocks","blockDate","formatDateRange","v","MonthView","WeekView","DayView","Ban","dayDate","isPast","dayBlocks","isBlocked","weekDates","timeSlots","dayIndex","hourIndex","slotStart","slotEnd","slotBookings","bookingTime","block","bi","bookingsByHour","useMemo","grouped","timeSlot","blockStart","blockEnd","BookingTemplates","onCreateBooking","templates","setTemplates","showAddModal","setShowAddModal","showEditModal","setShowEditModal","selectedTemplate","setSelectedTemplate","formData","setFormData","fetchTemplates","handleCreateTemplate","resetForm","handleUpdateTemplate","handleDeleteTemplate","templateId","handleToggleActive","handleUseTemplate","openEditModal","formatCurrency","amount","Sparkles","Check","TemplateFormModal","mode","onSubmit","errors","setErrors","validate","newErrors","BookingWaitlist","waitlistEntries","setWaitlistEntries","filterStatus","setFilterStatus","fetchWaitlist","handleNotifyClient","entryId","entry","handleRemoveEntry","getStatusBadge","statusConfig","Bell","XCircle","config","getPriorityBadge","priority","formatDate","dateString","filteredEntries","BookingPayments","bookingId","payments","setPayments","selectedPayment","setSelectedPayment","fetchPayments","handleCreatePayment","handleUpdatePayment","handleDeletePayment","paymentId","payment","handleConfirmPayment","getPaymentTypeBadge","type","typeConfig","totals","acc","bookingTotal","remainingBalance","CreditCard","PaymentFormModal","CalendarSync","syncStatus","setSyncStatus","syncing","setSyncing","showSettings","setShowSettings","syncResult","setSyncResult","settings","setSettings","fetchSyncStatus","handleConnect","accessToken","handleDisconnect","handleSync","syncedToGoogle","syncedFromGoogle","conflicts","message","handleSaveSettings","formatLastSynced","diffMs","diffMins","RefreshCw","Settings","Link","Unlink","conflict","StudioBookings","onNavigateToChat","activeTab","setActiveTab","setBookings","setBlockedDates","filter","setFilter","searchTerm","setSearchTerm","selectedBooking","setSelectedBooking","updating","setUpdating","calendarView","setCalendarView","showBlockModal","setShowBlockModal","selectedDate","setSelectedDate","blockReason","setBlockReason","blockTimeSlot","setBlockTimeSlot","customStartTime","setCustomStartTime","customEndTime","setCustomEndTime","showRecurringModal","setShowRecurringModal","showMultiRoomModal","setShowMultiRoomModal","selectedBookingForRecurring","setSelectedBookingForRecurring","selectedBookingForRooms","setSelectedBookingForRooms","loadBookings","loadBlockedDates","handleUpdateStatus","newStatus","handleBlockDate","handleUnblockDate","blockedId","openBlockModal","filteredBookings","bookingStatus","matchesFilter","matchesSearch","groupedBookings","groups","dateKey","pendingCount","todayBookings","upcomingRevenue","CalendarIcon","Search","status","dateBookings","MessageSquare","User","mapCategoryToId","dbCategory","categoryLower","categoryMap","matched","EQUIP_CATEGORIES","cat","StudioEquipment","setEquipment","categoryFilter","setCategoryFilter","editingItem","setEditingItem","updatedEquipment","handleAddItem","newItem","itemWithId","handleUpdateItem","updatedItem","handleDeleteItem","itemId","filteredEquipment","matchesCategory","groupedEquipment","categories","totalItems","totalValue","getCategoryIcon","category","Speaker","Monitor","Server","Package","getCategoryLabel","categoryId","c","items","CategoryIcon","EquipmentModal","handleAutocompleteSelect","selected","mappedCategory","settingsSchema","z.object","z.string","z.number","z.literal","z.array","z.boolean","StudioSettings","register","control","watch","setValue","isDirty","useForm","zodResolver","watchedAmenities","watchHideAddress","toggleAmenity","inputClass","Controller","AddressAutocomplete","addressData","Mail","Wifi","AMENITIES_DATA","ClientDetailsModal","client","studioId","isEditing","setIsEditing","isAddingNew","setIsAddingNew","searchMode","setSearchMode","searchResults","setSearchResults","searching","setSearching","handleSearchPlatformUsers","handleSelectPlatformUser","UserPlus","CLIENT_TYPES","Edit3","Phone","Building","tag","StudioClients","clients","setClients","filteredClients","setFilteredClients","filterType","setFilterType","showClientModal","setShowClientModal","selectedClient","setSelectedClient","modalMode","setModalMode","fetchClients","filtered","term","handleAddClient","handleEditClient","handleDeleteClient","clientId","handleClientUpdate","updatedClient","getClientTypeColor","clientType","StudioStaff","staff","setStaff","filteredStaff","setFilteredStaff","filterRole","setFilterRole","selectedStaff","setSelectedStaff","fetchStaff","member","handleAddStaff","newStaff","handleEditStaff","updatedStaff","handleDeleteStaff","staffId","getRoleBadgeColor","role","getStatusBadgeColor","Briefcase","STAFF_ROLES","UserCheck","skill","StudioAnalytics","TrendingUp","TABS","StudioManager","setStats","localUserData","setLocalUserData","fetchStats","pending","recent","revenue","handleNavigate","tabId","renderContent","commonProps","activeTabInfo","tab","hasBadge","Step1Metadata","setData","RELEASE_TYPES","DDEX_GENRES","g","Step2Artwork","preview","setPreview","validationMsg","setValidationMsg","handleFile","res","Step3Tracks","addTrack","newTrack","updatedTracks","finalTracks","removeTrack","updateTrackMeta","val","track","idx","Step4Stores","toggleStore","storeId","toggleAll","DISTRIBUTION_STORES","store","Info","ReleaseBuilder","initialData","step","setStep","submitting","setSubmitting","isStepValid","handleFinalSubmit","payload","DistributionManager","rawReleases","useDistributionReleases","deleteRelease","useMarketplaceMutations","setView","editingRelease","setEditingRelease","releases","releaseId","handleEdit","release","Globe","Disc","Music","LabelOverviewCard","formatNumber","Activity","StudioOverviewCard","DistributionOverviewCard","Play","BusinessOverview","metrics","setMetrics","isStudio","isLabel","isArtist","hasDistribution","results","labelData","getLabelMetrics","studioData","getStudioMetrics","distData","getDistributionMetrics","quickActions","Settings2","BusinessCenter","location","useLocation","navigate","useNavigate","getTabFromPath","parts","currentPath","tabFromPath","tabs","LabelDashboard","IconComponent"],"ignoreList":[],"sources":["../../src/components/studio/StudioOverview.jsx","../../src/components/studio/Panorama360Viewer.jsx","../../src/components/studio/FloorplanTools.jsx","../../src/utils/floorplanUtils.js","../../src/components/studio/FloorplanPropertyPanel.jsx","../../src/components/studio/FloorplanContextMenu.jsx","../../src/components/studio/FloorplanLayerPanel.jsx","../../src/components/studio/DoorComponent.jsx","../../src/components/studio/WindowComponent.jsx","../../src/components/studio/FurnitureComponent.jsx","../../src/hooks/useUndoRedo.js","../../src/components/studio/FloorplanEditor.jsx","../../src/components/studio/StudioRooms.jsx","../../src/components/studio/StudioGallery.jsx","../../src/components/studio/StudioAvailability.jsx","../../src/components/studio/StudioPolicies.jsx","../../src/components/studio/RecurringBookingModal.jsx","../../src/components/studio/MultiRoomBookingModal.jsx","../../src/components/shared/UnifiedCalendar.jsx","../../src/components/studio/bookings/BookingTemplates.jsx","../../src/components/studio/bookings/BookingWaitlist.jsx","../../src/components/studio/bookings/BookingPayments.jsx","../../src/components/studio/bookings/CalendarSync.jsx","../../src/components/studio/StudioBookings.jsx","../../src/components/studio/StudioEquipment.jsx","../../src/components/studio/StudioSettings.jsx","../../src/components/studio/clients/ClientDetailsModal.jsx","../../src/components/studio/StudioClients.jsx","../../src/components/studio/StudioStaff.jsx","../../src/components/studio/StudioAnalytics.jsx","../../src/components/StudioManager.jsx","../../src/components/distribution/ReleaseBuilder.jsx","../../src/components/marketplace/DistributionManager.jsx","../../src/components/business/LabelOverviewCard.jsx","../../src/components/business/StudioOverviewCard.jsx","../../src/components/business/DistributionOverviewCard.jsx","../../src/components/business/BusinessOverview.jsx","../../src/components/BusinessCenter.jsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { \r\n    Home, MapPin, DollarSign, Users, Calendar, \r\n    AlertCircle, CheckCircle, Star, ChevronLeft, ChevronRight\r\n} from 'lucide-react';\r\n\r\n/**\r\n * StudioOverview - Dashboard view for studio stats and quick actions\r\n */\r\nexport default function StudioOverview({ userData, stats, onNavigate }) {\r\n    const [currentDate, setCurrentDate] = useState(new Date());\r\n    const studioName = userData?.studioName || userData?.profileName || 'My Studio';\r\n    const rooms = userData?.rooms || [];\r\n    const amenities = userData?.amenities || [];\r\n    \r\n    // Calculate stats\r\n    const totalCapacity = rooms.reduce((sum, r) => sum + (r.capacity || 0), 0);\r\n    const avgRate = rooms.length > 0 \r\n        ? Math.round(rooms.reduce((sum, r) => sum + (r.rate || 0), 0) / rooms.length) \r\n        : 0;\r\n\r\n    const quickStats = [\r\n        { \r\n            label: 'Active Rooms', \r\n            value: rooms.length, \r\n            icon: <Home size={20} />, \r\n            color: 'blue',\r\n            onClick: () => onNavigate('rooms')\r\n        },\r\n        { \r\n            label: 'Total Capacity', \r\n            value: `${totalCapacity} ppl`, \r\n            icon: <Users size={20} />, \r\n            color: 'green' \r\n        },\r\n        { \r\n            label: 'Avg. Rate', \r\n            value: `$${avgRate}/hr`, \r\n            icon: <DollarSign size={20} />, \r\n            color: 'purple' \r\n        },\r\n        { \r\n            label: 'Amenities', \r\n            value: amenities.length, \r\n            icon: <Star size={20} />, \r\n            color: 'amber' \r\n        },\r\n    ];\r\n\r\n    const pendingBookings = stats?.pendingBookings || 0;\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Studio Header */}\r\n            <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-8 text-white relative overflow-hidden\">\r\n                <div className=\"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10\"></div>\r\n                <div className=\"relative z-10\">\r\n                    <div className=\"flex items-center gap-3 mb-2\">\r\n                        <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm\">\r\n                            <Home size={24} />\r\n                        </div>\r\n                        <div>\r\n                            <h1 className=\"text-2xl font-bold\">{studioName}</h1>\r\n                            <p className=\"text-blue-100 text-sm flex items-center gap-1\">\r\n                                <MapPin size={14} />\r\n                                {userData?.city && userData?.state \r\n                                    ? `${userData.city}, ${userData.state}` \r\n                                    : 'Location not set'}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                    {userData?.studioDescription && (\r\n                        <p className=\"text-blue-100 text-sm mt-4 max-w-2xl line-clamp-2\">\r\n                            {userData.studioDescription}\r\n                        </p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Quick Stats */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                {quickStats.map((stat, i) => (\r\n                    <button\r\n                        key={i}\r\n                        onClick={stat.onClick}\r\n                        className={`bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm text-left transition-all ${stat.onClick ? 'hover:shadow-md hover:border-brand-blue cursor-pointer' : ''}`}\r\n                    >\r\n                        <div className={`w-10 h-10 rounded-lg bg-${stat.color}-100 dark:bg-${stat.color}-900/20 flex items-center justify-center text-${stat.color}-600 dark:text-${stat.color}-400 mb-3`}>\r\n                            {stat.icon}\r\n                        </div>\r\n                        <div className=\"text-2xl font-bold dark:text-white\">{stat.value}</div>\r\n                        <div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase font-medium tracking-wide\">\r\n                            {stat.label}\r\n                        </div>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Alerts & Actions */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                {/* Pending Actions */}\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                    <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]\">\r\n                        <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                            <AlertCircle size={18} className=\"text-amber-500\" />\r\n                            Pending Actions\r\n                        </h3>\r\n                    </div>\r\n                    <div className=\"p-4 space-y-3\">\r\n                        {pendingBookings > 0 ? (\r\n                            <button \r\n                                onClick={() => onNavigate('bookings')}\r\n                                className=\"w-full flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30 transition\"\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <Calendar className=\"text-amber-600\" size={18} />\r\n                                    <span className=\"text-sm font-medium dark:text-amber-300\">\r\n                                        {pendingBookings} Pending Booking{pendingBookings > 1 ? 's' : ''}\r\n                                    </span>\r\n                                </div>\r\n                                <span className=\"text-xs text-amber-600 font-bold\">Review </span>\r\n                            </button>\r\n                        ) : (\r\n                            <div className=\"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\">\r\n                                <CheckCircle className=\"text-green-600\" size={18} />\r\n                                <span className=\"text-sm text-green-700 dark:text-green-300\">All caught up!</span>\r\n                            </div>\r\n                        )}\r\n\r\n                        {!userData?.studioDescription && (\r\n                            <button \r\n                                onClick={() => onNavigate('settings')}\r\n                                className=\"w-full flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition\"\r\n                            >\r\n                                <span className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">Add studio description</span>\r\n                                <span className=\"text-xs text-blue-600 font-bold\">Setup </span>\r\n                            </button>\r\n                        )}\r\n\r\n                        {rooms.length === 0 && (\r\n                            <button \r\n                                onClick={() => onNavigate('rooms')}\r\n                                className=\"w-full flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition\"\r\n                            >\r\n                                <span className=\"text-sm font-medium text-purple-700 dark:text-purple-300\">Add your first room</span>\r\n                                <span className=\"text-xs text-purple-600 font-bold\">Add </span>\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Room Summary */}\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                    <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center\">\r\n                        <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                            <Home size={18} className=\"text-brand-blue\" />\r\n                            Rooms\r\n                        </h3>\r\n                        <button \r\n                            onClick={() => onNavigate('rooms')}\r\n                            className=\"text-xs text-brand-blue font-bold hover:underline\"\r\n                        >\r\n                            Manage \r\n                        </button>\r\n                    </div>\r\n                    <div className=\"p-4\">\r\n                        {rooms.length === 0 ? (\r\n                            <div className=\"text-center py-6 text-gray-500\">\r\n                                <Home size={32} className=\"mx-auto mb-2 opacity-30\" />\r\n                                <p className=\"text-sm\">No rooms configured yet</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-2\">\r\n                                {rooms.slice(0, 4).map((room, i) => (\r\n                                    <div \r\n                                        key={i}\r\n                                        className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg\"\r\n                                    >\r\n                                        <div>\r\n                                            <div className=\"font-medium dark:text-white text-sm\">{room.name}</div>\r\n                                            <div className=\"text-xs text-gray-500\">\r\n                                                {room.capacity} people  {room.equipment ? room.equipment.split(',').length : 0} gear items\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"text-right\">\r\n                                            <div className=\"font-bold text-green-600 dark:text-green-400\">${room.rate}/hr</div>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                                {rooms.length > 4 && (\r\n                                    <p className=\"text-xs text-center text-gray-400 pt-2\">\r\n                                        +{rooms.length - 4} more rooms\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Amenities Preview */}\r\n            {amenities.length > 0 && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5\">\r\n                    <h3 className=\"font-bold dark:text-white mb-3 flex items-center gap-2\">\r\n                        <Star size={18} className=\"text-amber-500\" />\r\n                        Studio Amenities\r\n                    </h3>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                        {amenities.map((amenity, i) => (\r\n                            <span \r\n                                key={i}\r\n                                className=\"px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium\"\r\n                            >\r\n                                {amenity}\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Calendar Preview */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Calendar size={18} className=\"text-brand-blue\" />\r\n                        Booking Calendar\r\n                    </h3>\r\n                    <button \r\n                        onClick={() => onNavigate('bookings')}\r\n                        className=\"text-xs text-brand-blue font-bold hover:underline\"\r\n                    >\r\n                        View All \r\n                    </button>\r\n                </div>\r\n                <div className=\"p-4\">\r\n                    {/* Month Navigation */}\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <button \r\n                            onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1))}\r\n                            className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                        >\r\n                            <ChevronLeft size={18} className=\"text-gray-500\" />\r\n                        </button>\r\n                        <span className=\"font-bold dark:text-white\">\r\n                            {currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}\r\n                        </span>\r\n                        <button \r\n                            onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1))}\r\n                            className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                        >\r\n                            <ChevronRight size={18} className=\"text-gray-500\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Calendar Grid */}\r\n                    <MiniCalendar \r\n                        currentDate={currentDate} \r\n                        bookings={stats?.recentBookings || []} \r\n                        onNavigate={onNavigate}\r\n                    />\r\n\r\n                    {/* Upcoming Bookings */}\r\n                    {stats?.recentBookings?.length > 0 && (\r\n                        <div className=\"mt-4 pt-4 border-t dark:border-gray-700\">\r\n                            <div className=\"text-xs font-bold text-gray-500 uppercase mb-2\">Upcoming Sessions</div>\r\n                            <div className=\"space-y-2\">\r\n                                {stats.recentBookings.slice(0, 3).map((booking, i) => (\r\n                                    <div \r\n                                        key={i}\r\n                                        className=\"flex items-center justify-between p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg text-sm\"\r\n                                    >\r\n                                        <div>\r\n                                            <span className=\"font-medium dark:text-white\">{booking.clientName || 'Client'}</span>\r\n                                            <span className=\"text-gray-500 ml-2\">\r\n                                                {new Date(booking.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n                                            </span>\r\n                                        </div>\r\n                                        <span className={`text-xs px-2 py-0.5 rounded-full ${\r\n                                            booking.status === 'confirmed' \r\n                                                ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400' \r\n                                                : 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400'\r\n                                        }`}>\r\n                                            {booking.status || 'pending'}\r\n                                        </span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// Mini Calendar Component\r\nfunction MiniCalendar({ currentDate, bookings, onNavigate }) {\r\n    const year = currentDate.getFullYear();\r\n    const month = currentDate.getMonth();\r\n    const today = new Date();\r\n    \r\n    // Get first day of month and number of days\r\n    const firstDay = new Date(year, month, 1).getDay();\r\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\r\n    \r\n    // Create calendar days array\r\n    const days = [];\r\n    for (let i = 0; i < firstDay; i++) {\r\n        days.push(null);\r\n    }\r\n    for (let i = 1; i <= daysInMonth; i++) {\r\n        days.push(i);\r\n    }\r\n    \r\n    // Check if a day has bookings\r\n    const getDayBookings = (day) => {\r\n        if (!day) return [];\r\n        const dayDate = new Date(year, month, day);\r\n        return bookings.filter(b => {\r\n            const bookingDate = new Date(b.date);\r\n            return bookingDate.getDate() === day && \r\n                   bookingDate.getMonth() === month && \r\n                   bookingDate.getFullYear() === year;\r\n        });\r\n    };\r\n    \r\n    const isToday = (day) => {\r\n        return day === today.getDate() && \r\n               month === today.getMonth() && \r\n               year === today.getFullYear();\r\n    };\r\n    \r\n    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\n    \r\n    return (\r\n        <div>\r\n            {/* Day Headers */}\r\n            <div className=\"grid grid-cols-7 gap-1 mb-2\">\r\n                {dayNames.map(day => (\r\n                    <div key={day} className=\"text-center text-xs font-bold text-gray-400 py-1\">\r\n                        {day}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            \r\n            {/* Calendar Days */}\r\n            <div className=\"grid grid-cols-7 gap-1\">\r\n                {days.map((day, i) => {\r\n                    const dayBookings = getDayBookings(day);\r\n                    const hasBookings = dayBookings.length > 0;\r\n                    const hasConfirmed = dayBookings.some(b => b.status === 'confirmed');\r\n                    const hasPending = dayBookings.some(b => b.status === 'pending');\r\n                    \r\n                    return (\r\n                        <button\r\n                            key={i}\r\n                            onClick={() => day && hasBookings && onNavigate('bookings')}\r\n                            disabled={!day}\r\n                            className={`aspect-square flex flex-col items-center justify-center rounded-lg text-sm relative transition ${\r\n                                !day ? '' :\r\n                                isToday(day) ? 'bg-brand-blue text-white font-bold' :\r\n                                hasBookings ? 'bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 cursor-pointer' :\r\n                                'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                            }`}\r\n                        >\r\n                            {day}\r\n                            {hasBookings && !isToday(day) && (\r\n                                <div className=\"flex gap-0.5 mt-0.5\">\r\n                                    {hasConfirmed && <span className=\"w-1.5 h-1.5 bg-green-500 rounded-full\"></span>}\r\n                                    {hasPending && <span className=\"w-1.5 h-1.5 bg-amber-500 rounded-full\"></span>}\r\n                                </div>\r\n                            )}\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n            \r\n            {/* Legend */}\r\n            <div className=\"flex items-center gap-4 mt-3 text-xs text-gray-500\">\r\n                <div className=\"flex items-center gap-1\">\r\n                    <span className=\"w-2 h-2 bg-green-500 rounded-full\"></span>\r\n                    Confirmed\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                    <span className=\"w-2 h-2 bg-amber-500 rounded-full\"></span>\r\n                    Pending\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useEffect, useRef } from 'react';\r\nimport { X, Maximize2, Minimize2 } from 'lucide-react';\r\n\r\n/**\r\n * Panorama360Viewer - 360-degree image viewer component using Pannellum\r\n * Supports both equirectangular and cubemap formats\r\n */\r\nexport default function Panorama360Viewer({ imageUrl, onClose, title = '360 View' }) {\r\n    const viewerRef = useRef(null);\r\n    const containerRef = useRef(null);\r\n    const [isFullscreen, setIsFullscreen] = React.useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!imageUrl || !containerRef.current) return;\r\n\r\n        // Dynamically import pannellum\r\n        Promise.all([\r\n            import('pannellum'),\r\n            import('pannellum/build/pannellum.css')\r\n        ]).then(([pannellumModule]) => {\r\n            // Pannellum exports as default\r\n            const pannellum = pannellumModule.default || pannellumModule;\r\n            \r\n            // Initialize Pannellum viewer\r\n            const viewer = pannellum.viewer(containerRef.current, {\r\n                type: 'equirectangular',\r\n                panorama: imageUrl,\r\n                autoLoad: true,\r\n                autoRotate: 0,\r\n                compass: true,\r\n                showControls: true,\r\n                keyboardZoom: true,\r\n                mouseZoom: true,\r\n                hfov: 100,\r\n                minHfov: 50,\r\n                maxHfov: 120,\r\n            });\r\n\r\n            viewerRef.current = viewer;\r\n        }).catch((error) => {\r\n            console.error('Failed to load pannellum:', error);\r\n        });\r\n\r\n        return () => {\r\n            if (viewerRef.current) {\r\n                try {\r\n                    viewerRef.current.destroy();\r\n                } catch (e) {\r\n                    console.error('Error destroying viewer:', e);\r\n                }\r\n            }\r\n        };\r\n    }, [imageUrl]);\r\n\r\n    const toggleFullscreen = () => {\r\n        if (!containerRef.current) return;\r\n\r\n        if (!isFullscreen) {\r\n            if (containerRef.current.requestFullscreen) {\r\n                containerRef.current.requestFullscreen();\r\n            } else if (containerRef.current.webkitRequestFullscreen) {\r\n                containerRef.current.webkitRequestFullscreen();\r\n            } else if (containerRef.current.mozRequestFullScreen) {\r\n                containerRef.current.mozRequestFullScreen();\r\n            } else if (containerRef.current.msRequestFullscreen) {\r\n                containerRef.current.msRequestFullscreen();\r\n            }\r\n        } else {\r\n            if (document.exitFullscreen) {\r\n                document.exitFullscreen();\r\n            } else if (document.webkitExitFullscreen) {\r\n                document.webkitExitFullscreen();\r\n            } else if (document.mozCancelFullScreen) {\r\n                document.mozCancelFullScreen();\r\n            } else if (document.msExitFullscreen) {\r\n                document.msExitFullscreen();\r\n            }\r\n        }\r\n        setIsFullscreen(!isFullscreen);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const handleFullscreenChange = () => {\r\n            setIsFullscreen(!!document.fullscreenElement);\r\n        };\r\n\r\n        document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n        document.addEventListener('mozfullscreenchange', handleFullscreenChange);\r\n        document.addEventListener('MSFullscreenChange', handleFullscreenChange);\r\n\r\n        return () => {\r\n            document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n            document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n            document.removeEventListener('mozfullscreenchange', handleFullscreenChange);\r\n            document.removeEventListener('MSFullscreenChange', handleFullscreenChange);\r\n        };\r\n    }, []);\r\n\r\n    if (!imageUrl) {\r\n        return (\r\n            <div className=\"w-full h-64 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center\">\r\n                <p className=\"text-gray-500 dark:text-gray-400\">No 360 image available</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"relative w-full rounded-lg overflow-hidden border dark:border-gray-700 bg-black\">\r\n            {/* Header Controls */}\r\n            <div className=\"absolute top-0 left-0 right-0 z-10 bg-gradient-to-b from-black/70 to-transparent p-3 flex justify-between items-center\">\r\n                <h3 className=\"text-white font-semibold text-sm\">{title}</h3>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button\r\n                        onClick={toggleFullscreen}\r\n                        className=\"p-2 bg-black/50 hover:bg-black/70 rounded-lg text-white transition\"\r\n                        title={isFullscreen ? 'Exit Fullscreen' : 'Fullscreen'}\r\n                    >\r\n                        {isFullscreen ? <Minimize2 size={18} /> : <Maximize2 size={18} />}\r\n                    </button>\r\n                    {onClose && (\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-2 bg-black/50 hover:bg-black/70 rounded-lg text-white transition\"\r\n                            title=\"Close\"\r\n                        >\r\n                            <X size={18} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Pannellum Container */}\r\n            <div\r\n                ref={containerRef}\r\n                className=\"w-full h-96\"\r\n                style={{ minHeight: '400px' }}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport {\r\n    Move, Square, Circle, Triangle, Type, Ruler, DoorOpen, RectangleHorizontal,\r\n    Box, RotateCw, FlipHorizontal, FlipVertical, ZoomIn, ZoomOut,\r\n    Maximize2, Download, FileText, Image as ImageIcon, Layers,\r\n    Grid, Lock, Unlock, AlignLeft, AlignCenter, AlignRight\r\n} from 'lucide-react';\r\n\r\n/**\r\n * FloorplanTools - Toolbar component for floor plan editor\r\n */\r\nexport default function FloorplanTools({\r\n    activeTool,\r\n    setActiveTool,\r\n    onUndo,\r\n    onRedo,\r\n    canUndo,\r\n    canRedo,\r\n    onZoomIn,\r\n    onZoomOut,\r\n    onFitToView,\r\n    onExportSVG,\r\n    onExportPNG,\r\n    onExportPDF,\r\n    showGrid,\r\n    toggleGrid,\r\n    measurementUnit,\r\n    setMeasurementUnit,\r\n    scale,\r\n    setScale,\r\n    onBackgroundImageUpload,\r\n    onAddRoomTemplate\r\n}) {\r\n    const tools = [\r\n        { id: 'select', icon: Move, label: 'Select', group: 'basic' },\r\n        { id: 'wall', icon: Square, label: 'Wall', group: 'basic' },\r\n        { id: 'room', icon: Square, label: 'Room', group: 'basic' },\r\n        { id: 'structure', icon: Box, label: 'Area', group: 'basic' },\r\n        { id: 'door', icon: DoorOpen, label: 'Door', group: 'elements' },\r\n        { id: 'window', icon: RectangleHorizontal, label: 'Window', group: 'elements' },\r\n        { id: 'furniture', icon: Box, label: 'Furniture', group: 'elements' },\r\n        { id: 'measure', icon: Ruler, label: 'Measure', group: 'tools' },\r\n        { id: 'text', icon: Type, label: 'Text', group: 'tools' },\r\n        { id: 'circle', icon: Circle, label: 'Circle', group: 'shapes' },\r\n        { id: 'polygon', icon: Triangle, label: 'Polygon', group: 'shapes' },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"flex flex-col gap-2 p-2 bg-white dark:bg-[#2c2e36] border-r dark:border-gray-700\">\r\n            {/* Undo/Redo */}\r\n            <div className=\"flex gap-1 pb-2 border-b dark:border-gray-700\">\r\n                <button\r\n                    onClick={onUndo}\r\n                    disabled={!canUndo}\r\n                    className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50\"\r\n                    title=\"Undo (Ctrl+Z)\"\r\n                >\r\n                    <RotateCw size={18} className=\"rotate-180\" />\r\n                </button>\r\n                <button\r\n                    onClick={onRedo}\r\n                    disabled={!canRedo}\r\n                    className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50\"\r\n                    title=\"Redo (Ctrl+Shift+Z)\"\r\n                >\r\n                    <RotateCw size={18} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Basic Tools */}\r\n            <div className=\"space-y-1\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Basic</div>\r\n                {tools.filter(t => t.group === 'basic').map(tool => {\r\n                    const Icon = tool.icon;\r\n                    return (\r\n                        <button\r\n                            key={tool.id}\r\n                            onClick={() => setActiveTool(tool.id)}\r\n                            className={`w-full p-2 rounded flex items-center gap-2 text-sm transition ${\r\n                                activeTool === tool.id\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                            }`}\r\n                            title={tool.label}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"text-xs\">{tool.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n                {/* Room Templates */}\r\n                <div className=\"pt-2 border-t dark:border-gray-700\">\r\n                    <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Templates</div>\r\n                    <div className=\"space-y-1\">\r\n                        <button\r\n                            onClick={() => {\r\n                                // Add room from template\r\n                                if (onAddRoomTemplate) {\r\n                                    onAddRoomTemplate({ name: 'Control Room', width: 200, height: 150, color: '#3B82F6' });\r\n                                }\r\n                            }}\r\n                            className=\"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                        >\r\n                            Control Room\r\n                        </button>\r\n                        <button\r\n                            onClick={() => {\r\n                                if (onAddRoomTemplate) {\r\n                                    onAddRoomTemplate({ name: 'Live Room', width: 300, height: 250, color: '#10B981' });\r\n                                }\r\n                            }}\r\n                            className=\"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                        >\r\n                            Live Room\r\n                        </button>\r\n                        <button\r\n                            onClick={() => {\r\n                                if (onAddRoomTemplate) {\r\n                                    onAddRoomTemplate({ name: 'Isolation Booth', width: 120, height: 120, color: '#F59E0B' });\r\n                                }\r\n                            }}\r\n                            className=\"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                        >\r\n                            Isolation Booth\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Elements */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Elements</div>\r\n                {tools.filter(t => t.group === 'elements').map(tool => {\r\n                    const Icon = tool.icon;\r\n                    return (\r\n                        <button\r\n                            key={tool.id}\r\n                            onClick={() => setActiveTool(tool.id)}\r\n                            className={`w-full p-2 rounded flex items-center gap-2 text-sm transition ${\r\n                                activeTool === tool.id\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                            }`}\r\n                            title={tool.label}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"text-xs\">{tool.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Tools */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Tools</div>\r\n                {tools.filter(t => t.group === 'tools').map(tool => {\r\n                    const Icon = tool.icon;\r\n                    return (\r\n                        <button\r\n                            key={tool.id}\r\n                            onClick={() => setActiveTool(tool.id)}\r\n                            className={`w-full p-2 rounded flex items-center gap-2 text-sm transition ${\r\n                                activeTool === tool.id\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                            }`}\r\n                            title={tool.label}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"text-xs\">{tool.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Shapes */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Shapes</div>\r\n                {tools.filter(t => t.group === 'shapes').map(tool => {\r\n                    const Icon = tool.icon;\r\n                    return (\r\n                        <button\r\n                            key={tool.id}\r\n                            onClick={() => setActiveTool(tool.id)}\r\n                            className={`w-full p-2 rounded flex items-center gap-2 text-sm transition ${\r\n                                activeTool === tool.id\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                            }`}\r\n                            title={tool.label}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"text-xs\">{tool.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Zoom Controls */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">View</div>\r\n                <button\r\n                    onClick={onZoomIn}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                    title=\"Zoom In\"\r\n                >\r\n                    <ZoomIn size={16} />\r\n                </button>\r\n                <button\r\n                    onClick={onZoomOut}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                    title=\"Zoom Out\"\r\n                >\r\n                    <ZoomOut size={16} />\r\n                </button>\r\n                <button\r\n                    onClick={onFitToView}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                    title=\"Fit to View\"\r\n                >\r\n                    <Maximize2 size={16} />\r\n                </button>\r\n                <button\r\n                    onClick={toggleGrid}\r\n                    className={`w-full p-2 rounded flex items-center gap-2 text-sm ${\r\n                        showGrid\r\n                            ? 'bg-brand-blue text-white'\r\n                            : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                    }`}\r\n                    title=\"Toggle Grid\"\r\n                >\r\n                    <Grid size={16} />\r\n                    <span className=\"text-xs\">Grid</span>\r\n                </button>\r\n            </div>\r\n\r\n            {/* Export */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Export</div>\r\n                <button\r\n                    onClick={onExportSVG}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2\"\r\n                    title=\"Export SVG\"\r\n                >\r\n                    <FileText size={16} />\r\n                    <span className=\"text-xs\">SVG</span>\r\n                </button>\r\n                <button\r\n                    onClick={onExportPNG}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2\"\r\n                    title=\"Export PNG\"\r\n                >\r\n                    <ImageIcon size={16} />\r\n                    <span className=\"text-xs\">PNG</span>\r\n                </button>\r\n                <button\r\n                    onClick={onExportPDF}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2\"\r\n                    title=\"Export PDF\"\r\n                >\r\n                    <FileText size={16} />\r\n                    <span className=\"text-xs\">PDF</span>\r\n                </button>\r\n            </div>\r\n\r\n            {/* Background Image */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Background</div>\r\n                <label className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2 cursor-pointer\">\r\n                    <ImageIcon size={16} />\r\n                    <span className=\"text-xs\">Import Image</span>\r\n                    <input\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        onChange={(e) => {\r\n                            const file = e.target.files?.[0];\r\n                            if (file) {\r\n                                // This will be handled by parent\r\n                                if (onBackgroundImageUpload) {\r\n                                    onBackgroundImageUpload(e);\r\n                                }\r\n                            }\r\n                        }}\r\n                        className=\"hidden\"\r\n                    />\r\n                </label>\r\n            </div>\r\n\r\n            {/* Scale Settings */}\r\n            <div className=\"pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1 mb-2\">Scale</div>\r\n                <select\r\n                    value={scale}\r\n                    onChange={(e) => setScale(Number(e.target.value))}\r\n                    className=\"w-full p-1.5 text-xs rounded border dark:border-gray-600 dark:bg-[#1f2128] dark:text-white\"\r\n                >\r\n                    <option value={10}>1px = 1ft</option>\r\n                    <option value={20}>1px = 0.5ft</option>\r\n                    <option value={5}>1px = 2ft</option>\r\n                </select>\r\n                <select\r\n                    value={measurementUnit}\r\n                    onChange={(e) => setMeasurementUnit(e.target.value)}\r\n                    className=\"w-full p-1.5 text-xs rounded border dark:border-gray-600 dark:bg-[#1f2128] dark:text-white mt-2\"\r\n                >\r\n                    <option value=\"ft\">Feet</option>\r\n                    <option value=\"m\">Meters</option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","/**\r\n * Floorplan utility functions for calculations and geometry\r\n */\r\n\r\n// Calculate distance between two points\r\nexport const calculateDistance = (x1, y1, x2, y2) => {\r\n    return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\r\n};\r\n\r\n// Calculate area of a rectangle\r\nexport const calculateArea = (width, height, scale = 1) => {\r\n    const area = (width * height) / (scale * scale);\r\n    return {\r\n        sqft: area,\r\n        sqm: area * 0.092903,\r\n        display: `${area.toFixed(1)} sq ft (${(area * 0.092903).toFixed(1)} m)`\r\n    };\r\n};\r\n\r\n// Calculate perimeter\r\nexport const calculatePerimeter = (width, height, scale = 1) => {\r\n    const perimeter = (2 * (width + height)) / scale;\r\n    return {\r\n        feet: perimeter,\r\n        meters: perimeter * 0.3048,\r\n        display: `${perimeter.toFixed(1)} ft (${(perimeter * 0.3048).toFixed(1)} m)`\r\n    };\r\n};\r\n\r\n// Convert pixels to real-world units\r\nexport const pixelsToFeet = (pixels, scale = 1) => {\r\n    return pixels / scale;\r\n};\r\n\r\n// Convert real-world units to pixels\r\nexport const feetToPixels = (feet, scale = 1) => {\r\n    return feet * scale;\r\n};\r\n\r\n// Check if point is inside rectangle\r\nexport const pointInRect = (px, py, rx, ry, rw, rh) => {\r\n    return px >= rx && px <= rx + rw && py >= ry && py <= ry + rh;\r\n};\r\n\r\n// Check if two rectangles overlap\r\nexport const rectsOverlap = (r1, r2) => {\r\n    return !(r1.x + r1.width < r2.x || r2.x + r2.width < r1.x ||\r\n             r1.y + r1.height < r2.y || r2.y + r2.height < r1.y);\r\n};\r\n\r\n// Get rectangle center\r\nexport const getRectCenter = (x, y, width, height) => {\r\n    return {\r\n        x: x + width / 2,\r\n        y: y + height / 2\r\n    };\r\n};\r\n\r\n// Rotate point around center\r\nexport const rotatePoint = (px, py, cx, cy, angle) => {\r\n    const rad = (angle * Math.PI) / 180;\r\n    const cos = Math.cos(rad);\r\n    const sin = Math.sin(rad);\r\n    const dx = px - cx;\r\n    const dy = py - cy;\r\n    return {\r\n        x: cx + dx * cos - dy * sin,\r\n        y: cy + dx * sin + dy * cos\r\n    };\r\n};\r\n\r\n// Get bounding box of rotated rectangle\r\nexport const getRotatedBounds = (x, y, width, height, angle) => {\r\n    const corners = [\r\n        { x: x, y: y },\r\n        { x: x + width, y: y },\r\n        { x: x + width, y: y + height },\r\n        { x: x, y: y + height }\r\n    ];\r\n    \r\n    const center = getRectCenter(x, y, width, height);\r\n    const rotated = corners.map(c => rotatePoint(c.x, c.y, center.x, center.y, angle));\r\n    \r\n    const xs = rotated.map(p => p.x);\r\n    const ys = rotated.map(p => p.y);\r\n    \r\n    return {\r\n        x: Math.min(...xs),\r\n        y: Math.min(...ys),\r\n        width: Math.max(...xs) - Math.min(...xs),\r\n        height: Math.max(...ys) - Math.min(...ys)\r\n    };\r\n};\r\n\r\n// Snap point to grid\r\nexport const snapToGrid = (x, y, gridSize) => {\r\n    return {\r\n        x: Math.round(x / gridSize) * gridSize,\r\n        y: Math.round(y / gridSize) * gridSize\r\n    };\r\n};\r\n\r\n// Snap to nearest object\r\nexport const snapToObject = (x, y, objects, threshold = 10) => {\r\n    let snapped = { x, y };\r\n    let minDist = threshold;\r\n    \r\n    objects.forEach(obj => {\r\n        const objX = obj.layout?.x || obj.x || 0;\r\n        const objY = obj.layout?.y || obj.y || 0;\r\n        const objW = obj.layout?.width || obj.width || 0;\r\n        const objH = obj.layout?.height || obj.height || 0;\r\n        \r\n        // Check corners and edges\r\n        const points = [\r\n            { x: objX, y: objY }, // top-left\r\n            { x: objX + objW, y: objY }, // top-right\r\n            { x: objX + objW, y: objY + objH }, // bottom-right\r\n            { x: objX, y: objY + objH }, // bottom-left\r\n            { x: objX + objW / 2, y: objY }, // top-center\r\n            { x: objX + objW, y: objY + objH / 2 }, // right-center\r\n            { x: objX + objW / 2, y: objY + objH }, // bottom-center\r\n            { x: objX, y: objY + objH / 2 }, // left-center\r\n        ];\r\n        \r\n        points.forEach(point => {\r\n            const dist = calculateDistance(x, y, point.x, point.y);\r\n            if (dist < minDist) {\r\n                minDist = dist;\r\n                snapped = point;\r\n            }\r\n        });\r\n    });\r\n    \r\n    return snapped;\r\n};\r\n\r\n// Format measurement for display\r\nexport const formatMeasurement = (pixels, scale = 1, unit = 'ft') => {\r\n    const value = pixels / scale;\r\n    if (unit === 'ft') {\r\n        return `${value.toFixed(1)} ft`;\r\n    } else if (unit === 'm') {\r\n        return `${(value * 0.3048).toFixed(2)} m`;\r\n    }\r\n    return `${value.toFixed(1)}`;\r\n};\r\n\r\n// Export SVG to string\r\nexport const exportSVG = (svgElement, width, height) => {\r\n    const serializer = new XMLSerializer();\r\n    const svgString = serializer.serializeToString(svgElement);\r\n    \r\n    const svgBlob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });\r\n    const url = URL.createObjectURL(svgBlob);\r\n    \r\n    return { svgString, url, blob: svgBlob };\r\n};\r\n\r\n// Export to PNG\r\nexport const exportPNG = async (svgElement, width, height, scale = 2) => {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = width * scale;\r\n    canvas.height = height * scale;\r\n    const ctx = canvas.getContext('2d');\r\n    \r\n    const svgString = new XMLSerializer().serializeToString(svgElement);\r\n    const img = new Image();\r\n    const svgBlob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });\r\n    const url = URL.createObjectURL(svgBlob);\r\n    \r\n    return new Promise((resolve, reject) => {\r\n        img.onload = () => {\r\n            ctx.fillStyle = 'white';\r\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\r\n            canvas.toBlob((blob) => {\r\n                URL.revokeObjectURL(url);\r\n                resolve(blob);\r\n            }, 'image/png');\r\n        };\r\n        img.onerror = reject;\r\n        img.src = url;\r\n    });\r\n};\r\n\r\n// Generate room ID\r\nexport const generateId = (prefix = 'item') => {\r\n    return `${prefix}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n};\r\n\r\n","import React from 'react';\r\nimport { X, RotateCw, FlipHorizontal, FlipVertical } from 'lucide-react';\r\nimport { calculateArea, calculatePerimeter, formatMeasurement } from '../../utils/floorplanUtils';\r\n\r\n/**\r\n * PropertyPanel - Displays and edits properties of selected objects\r\n */\r\nexport default function FloorplanPropertyPanel({\r\n    selectedItem,\r\n    onClose,\r\n    onUpdate,\r\n    scale = 10,\r\n    unit = 'ft'\r\n}) {\r\n    if (!selectedItem) return null;\r\n\r\n    const isRoom = selectedItem.layout && selectedItem.name;\r\n    const isStructure = selectedItem.layout && selectedItem.label;\r\n    const isWall = selectedItem.x1 !== undefined;\r\n    const isDoor = selectedItem.type === 'door';\r\n    const isWindow = selectedItem.type === 'window';\r\n    const isFurniture = selectedItem.type === 'furniture';\r\n\r\n    const layout = selectedItem.layout || {};\r\n    const area = layout.width && layout.height ? calculateArea(layout.width, layout.height, scale) : null;\r\n    const perimeter = layout.width && layout.height ? calculatePerimeter(layout.width, layout.height, scale) : null;\r\n\r\n    const handleUpdate = (updates) => {\r\n        onUpdate({ ...selectedItem, ...updates });\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-64 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 p-4 overflow-y-auto\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n                <h3 className=\"font-bold text-sm dark:text-white\">Properties</h3>\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\r\n                >\r\n                    <X size={16} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Room Properties */}\r\n            {isRoom && (\r\n                <div className=\"space-y-3\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Name</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={selectedItem.name || ''}\r\n                            onChange={(e) => handleUpdate({ name: e.target.value })}\r\n                            className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Position</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.x || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, x: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                placeholder=\"X\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.y || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, y: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                placeholder=\"Y\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Size</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <div>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={Math.round(layout.width || 0)}\r\n                                    onChange={(e) => handleUpdate({ layout: { ...layout, width: Number(e.target.value) } })}\r\n                                    className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                    placeholder=\"Width\"\r\n                                />\r\n                                <span className=\"text-xs text-gray-500\">{formatMeasurement(layout.width || 0, scale, unit)}</span>\r\n                            </div>\r\n                            <div>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={Math.round(layout.height || 0)}\r\n                                    onChange={(e) => handleUpdate({ layout: { ...layout, height: Number(e.target.value) } })}\r\n                                    className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                    placeholder=\"Height\"\r\n                                />\r\n                                <span className=\"text-xs text-gray-500\">{formatMeasurement(layout.height || 0, scale, unit)}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    {area && (\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Area</label>\r\n                            <div className=\"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm\">\r\n                                {area.display}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    {perimeter && (\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Perimeter</label>\r\n                            <div className=\"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm\">\r\n                                {perimeter.display}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Color</label>\r\n                        <input\r\n                            type=\"color\"\r\n                            value={layout.color || '#3B82F6'}\r\n                            onChange={(e) => handleUpdate({ layout: { ...layout, color: e.target.value } })}\r\n                            className=\"w-full h-10 border rounded cursor-pointer\"\r\n                        />\r\n                    </div>\r\n                    {selectedItem.rotation !== undefined && (\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Rotation</label>\r\n                            <div className=\"flex gap-2\">\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={selectedItem.rotation || 0}\r\n                                    onChange={(e) => handleUpdate({ rotation: Number(e.target.value) })}\r\n                                    className=\"flex-1 p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                    min=\"0\"\r\n                                    max=\"360\"\r\n                                />\r\n                                <button\r\n                                    onClick={() => handleUpdate({ rotation: ((selectedItem.rotation || 0) + 90) % 360 })}\r\n                                    className=\"p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-700\"\r\n                                    title=\"Rotate 90\"\r\n                                >\r\n                                    <RotateCw size={16} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Structure Properties */}\r\n            {isStructure && (\r\n                <div className=\"space-y-3\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Label</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={selectedItem.label || ''}\r\n                            onChange={(e) => handleUpdate({ label: e.target.value })}\r\n                            className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Position</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.x || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, x: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.y || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, y: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Size</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.width || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, width: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.height || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, height: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Wall Properties */}\r\n            {isWall && (\r\n                <div className=\"space-y-3\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Start Point</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.x1 || 0)}\r\n                                onChange={(e) => handleUpdate({ x1: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.y1 || 0)}\r\n                                onChange={(e) => handleUpdate({ y1: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">End Point</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.x2 || 0)}\r\n                                onChange={(e) => handleUpdate({ x2: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.y2 || 0)}\r\n                                onChange={(e) => handleUpdate({ y2: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Length</label>\r\n                        <div className=\"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm\">\r\n                            {formatMeasurement(\r\n                                Math.sqrt(Math.pow((selectedItem.x2 || 0) - (selectedItem.x1 || 0), 2) + \r\n                                         Math.pow((selectedItem.y2 || 0) - (selectedItem.y1 || 0), 2)),\r\n                                scale,\r\n                                unit\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Thickness</label>\r\n                        <input\r\n                            type=\"number\"\r\n                            value={selectedItem.strokeWidth || 5}\r\n                            onChange={(e) => handleUpdate({ strokeWidth: Number(e.target.value) })}\r\n                            className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            min=\"1\"\r\n                            max=\"20\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Color</label>\r\n                        <input\r\n                            type=\"color\"\r\n                            value={selectedItem.stroke || '#52525B'}\r\n                            onChange={(e) => handleUpdate({ stroke: e.target.value })}\r\n                            className=\"w-full h-10 border rounded cursor-pointer\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Door/Window/Furniture Properties */}\r\n            {(isDoor || isWindow || isFurniture) && (\r\n                <div className=\"space-y-3\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Type</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={selectedItem.subType || ''}\r\n                            onChange={(e) => handleUpdate({ subType: e.target.value })}\r\n                            className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            placeholder={isDoor ? 'Single, Double, Sliding...' : isWindow ? 'Standard, Bay...' : 'Chair, Table...'}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Position</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.x || 0)}\r\n                                onChange={(e) => handleUpdate({ x: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.y || 0)}\r\n                                onChange={(e) => handleUpdate({ y: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    {selectedItem.rotation !== undefined && (\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Rotation</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={selectedItem.rotation || 0}\r\n                                onChange={(e) => handleUpdate({ rotation: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                min=\"0\"\r\n                                max=\"360\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport { Copy, Clipboard, Scissors, Trash2, RotateCw, FlipHorizontal, FlipVertical, Lock, Unlock, BringToFront, SendToBack } from 'lucide-react';\r\n\r\n/**\r\n * ContextMenu - Right-click context menu for floor plan objects\r\n */\r\nexport default function FloorplanContextMenu({ x, y, onClose, onAction, canCopy, canPaste, canCut, canDelete, canRotate, canFlip, isLocked }) {\r\n    if (!x || !y) return null;\r\n\r\n    const menuItems = [\r\n        { id: 'copy', label: 'Copy', icon: Copy, disabled: !canCopy, shortcut: 'Ctrl+C' },\r\n        { id: 'paste', label: 'Paste', icon: Clipboard, disabled: !canPaste, shortcut: 'Ctrl+V' },\r\n        { id: 'cut', label: 'Cut', icon: Scissors, disabled: !canCut, shortcut: 'Ctrl+X' },\r\n        { id: 'separator1' },\r\n        { id: 'delete', label: 'Delete', icon: Trash2, disabled: !canDelete, shortcut: 'Del' },\r\n        { id: 'separator2' },\r\n        { id: 'rotate', label: 'Rotate 90', icon: RotateCw, disabled: !canRotate },\r\n        { id: 'flipH', label: 'Flip Horizontal', icon: FlipHorizontal, disabled: !canFlip },\r\n        { id: 'flipV', label: 'Flip Vertical', icon: FlipVertical, disabled: !canFlip },\r\n        { id: 'separator3' },\r\n        { id: 'lock', label: isLocked ? 'Unlock' : 'Lock', icon: isLocked ? Unlock : Lock },\r\n        { id: 'separator4' },\r\n        { id: 'bringToFront', label: 'Bring to Front', icon: BringToFront },\r\n        { id: 'sendToBack', label: 'Send to Back', icon: SendToBack },\r\n    ];\r\n\r\n    return (\r\n        <>\r\n            <div\r\n                className=\"fixed inset-0 z-50\"\r\n                onClick={onClose}\r\n            />\r\n            <div\r\n                className=\"fixed z-50 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-lg shadow-lg py-1 min-w-[180px]\"\r\n                style={{ left: `${x}px`, top: `${y}px` }}\r\n            >\r\n                {menuItems.map((item, index) => {\r\n                    if (item.id.startsWith('separator')) {\r\n                        return <div key={index} className=\"border-t dark:border-gray-700 my-1\" />;\r\n                    }\r\n\r\n                    const Icon = item.icon;\r\n                    return (\r\n                        <button\r\n                            key={item.id}\r\n                            onClick={() => {\r\n                                onAction(item.id);\r\n                                onClose();\r\n                            }}\r\n                            disabled={item.disabled}\r\n                            className=\"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 dark:text-white\"\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"flex-1\">{item.label}</span>\r\n                            {item.shortcut && (\r\n                                <span className=\"text-xs text-gray-500\">{item.shortcut}</span>\r\n                            )}\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport { Eye, EyeOff, Lock, Unlock, Layers } from 'lucide-react';\r\n\r\n/**\r\n * FloorplanLayerPanel - Layer visibility and lock management\r\n */\r\nexport default function FloorplanLayerPanel({ layers, onLayerToggle, onLayerLock }) {\r\n    const layerList = [\r\n        { key: 'structures', label: 'Structures', icon: Layers },\r\n        { key: 'rooms', label: 'Rooms', icon: Layers },\r\n        { key: 'walls', label: 'Walls', icon: Layers },\r\n        { key: 'doors', label: 'Doors', icon: Layers },\r\n        { key: 'windows', label: 'Windows', icon: Layers },\r\n        { key: 'furniture', label: 'Furniture', icon: Layers },\r\n        { key: 'text', label: 'Text Labels', icon: Layers },\r\n        { key: 'measurements', label: 'Measurements', icon: Layers },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"w-48 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 p-3\">\r\n            <h3 className=\"font-bold text-sm dark:text-white mb-3 flex items-center gap-2\">\r\n                <Layers size={16} />\r\n                Layers\r\n            </h3>\r\n            <div className=\"space-y-1\">\r\n                {layerList.map(layer => {\r\n                    const layerData = layers[layer.key] || { visible: true, locked: false };\r\n                    const Icon = layer.icon;\r\n                    return (\r\n                        <div\r\n                            key={layer.key}\r\n                            className=\"flex items-center justify-between p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\r\n                        >\r\n                            <div className=\"flex items-center gap-2 flex-1\">\r\n                                <button\r\n                                    onClick={() => onLayerToggle(layer.key)}\r\n                                    className=\"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300\"\r\n                                >\r\n                                    {layerData.visible ? <Eye size={16} /> : <EyeOff size={16} />}\r\n                                </button>\r\n                                <span className=\"text-xs dark:text-white\">{layer.label}</span>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => onLayerLock(layer.key)}\r\n                                className=\"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300\"\r\n                            >\r\n                                {layerData.locked ? <Lock size={14} /> : <Unlock size={14} />}\r\n                            </button>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport { DoorOpen } from 'lucide-react';\r\nimport { rotatePoint } from '../../utils/floorplanUtils';\r\n\r\n/**\r\n * DoorComponent - Renders a door on the floor plan\r\n */\r\nexport default function DoorComponent({ door, isSelected, onClick, onMouseDown }) {\r\n    const { x, y, width = 30, height = 60, rotation = 0, subType = 'single', direction = 'left' } = door;\r\n    \r\n    const centerX = x + width / 2;\r\n    const centerY = y + height / 2;\r\n\r\n    // Door arc path (swinging door)\r\n    const arcRadius = width;\r\n    const arcStart = direction === 'left' ? 180 : 0;\r\n    const arcEnd = direction === 'left' ? 90 : 270;\r\n\r\n    // Rotate points if needed\r\n    const getRotatedPoint = (px, py) => {\r\n        if (rotation === 0) return { x: px, y: py };\r\n        return rotatePoint(px, py, centerX, centerY, rotation);\r\n    };\r\n\r\n    const topLeft = getRotatedPoint(x, y);\r\n    const topRight = getRotatedPoint(x + width, y);\r\n    const bottomLeft = getRotatedPoint(x, y + height);\r\n    const bottomRight = getRotatedPoint(x + width, y + height);\r\n\r\n    return (\r\n        <g\r\n            onClick={onClick}\r\n            onMouseDown={onMouseDown}\r\n            cursor=\"pointer\"\r\n            style={{ filter: isSelected ? 'drop-shadow(0 0 3px #3D84ED)' : 'none' }}\r\n        >\r\n            {/* Door frame */}\r\n            <rect\r\n                x={x}\r\n                y={y}\r\n                width={width}\r\n                height={height}\r\n                fill=\"none\"\r\n                stroke={isSelected ? '#3D84ED' : '#8B5CF6'}\r\n                strokeWidth={isSelected ? 3 : 2}\r\n                rx={2}\r\n            />\r\n            \r\n            {/* Door panel */}\r\n            <rect\r\n                x={x + 2}\r\n                y={y + 2}\r\n                width={width - 4}\r\n                height={height - 4}\r\n                fill=\"#F3F4F6\"\r\n                stroke=\"#8B5CF6\"\r\n                strokeWidth={1}\r\n            />\r\n            \r\n            {/* Door swing arc */}\r\n            <path\r\n                d={`M ${centerX} ${centerY} A ${arcRadius} ${arcRadius} 0 0 1 ${direction === 'left' ? x : x + width} ${y}`}\r\n                fill=\"none\"\r\n                stroke=\"#8B5CF6\"\r\n                strokeWidth={1}\r\n                strokeDasharray=\"3,3\"\r\n                opacity=\"0.5\"\r\n            />\r\n            \r\n            {/* Door handle */}\r\n            <circle\r\n                cx={direction === 'left' ? x + width - 8 : x + 8}\r\n                cy={y + height / 2}\r\n                r={3}\r\n                fill=\"#8B5CF6\"\r\n            />\r\n            \r\n            {/* Selection indicator */}\r\n            {isSelected && (\r\n                <rect\r\n                    x={x - 4}\r\n                    y={y - 4}\r\n                    width={width + 8}\r\n                    height={height + 8}\r\n                    fill=\"none\"\r\n                    stroke=\"#3D84ED\"\r\n                    strokeWidth={2}\r\n                    strokeDasharray=\"5,5\"\r\n                />\r\n            )}\r\n        </g>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\n\r\n/**\r\n * WindowComponent - Renders a window on the floor plan\r\n */\r\nexport default function WindowComponent({ window, isSelected, onClick, onMouseDown }) {\r\n    const { x, y, width = 40, height = 60, rotation = 0, subType = 'standard' } = window;\r\n    \r\n    return (\r\n        <g\r\n            onClick={onClick}\r\n            onMouseDown={onMouseDown}\r\n            cursor=\"pointer\"\r\n            style={{ filter: isSelected ? 'drop-shadow(0 0 3px #3D84ED)' : 'none' }}\r\n        >\r\n            {/* Window frame */}\r\n            <rect\r\n                x={x}\r\n                y={y}\r\n                width={width}\r\n                height={height}\r\n                fill=\"#E0F2FE\"\r\n                stroke={isSelected ? '#3D84ED' : '#0EA5E9'}\r\n                strokeWidth={isSelected ? 3 : 2}\r\n                rx={2}\r\n                opacity=\"0.7\"\r\n            />\r\n            \r\n            {/* Window panes */}\r\n            <line\r\n                x1={x + width / 2}\r\n                y1={y}\r\n                x2={x + width / 2}\r\n                y2={y + height}\r\n                stroke=\"#0EA5E9\"\r\n                strokeWidth={1}\r\n            />\r\n            <line\r\n                x1={x}\r\n                y1={y + height / 2}\r\n                x2={x + width}\r\n                y2={y + height / 2}\r\n                stroke=\"#0EA5E9\"\r\n                strokeWidth={1}\r\n            />\r\n            \r\n            {/* Selection indicator */}\r\n            {isSelected && (\r\n                <rect\r\n                    x={x - 4}\r\n                    y={y - 4}\r\n                    width={width + 8}\r\n                    height={height + 8}\r\n                    fill=\"none\"\r\n                    stroke=\"#3D84ED\"\r\n                    strokeWidth={2}\r\n                    strokeDasharray=\"5,5\"\r\n                />\r\n            )}\r\n        </g>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport { Box, RectangleHorizontal, Square, Circle } from 'lucide-react';\r\n\r\n/**\r\n * FurnitureComponent - Renders furniture on the floor plan\r\n */\r\nexport default function FurnitureComponent({ furniture, isSelected, onClick, onMouseDown }) {\r\n    const { x, y, width = 40, height = 40, rotation = 0, subType = 'box' } = furniture;\r\n    \r\n    const icons = {\r\n        box: Box,\r\n        sofa: RectangleHorizontal,\r\n        chair: Square,\r\n        table: Circle,\r\n        bed: RectangleHorizontal,\r\n    };\r\n    \r\n    const Icon = icons[subType] || Box;\r\n    const centerX = x + width / 2;\r\n    const centerY = y + height / 2;\r\n\r\n    return (\r\n        <g\r\n            onClick={onClick}\r\n            onMouseDown={onMouseDown}\r\n            cursor=\"pointer\"\r\n            transform={`translate(${centerX}, ${centerY}) rotate(${rotation}) translate(${-centerX}, ${-centerY})`}\r\n            style={{ filter: isSelected ? 'drop-shadow(0 0 3px #3D84ED)' : 'none' }}\r\n        >\r\n            {/* Furniture shape */}\r\n            <rect\r\n                x={x}\r\n                y={y}\r\n                width={width}\r\n                height={height}\r\n                fill=\"#FEF3C7\"\r\n                stroke={isSelected ? '#3D84ED' : '#F59E0B'}\r\n                strokeWidth={isSelected ? 3 : 2}\r\n                rx={4}\r\n            />\r\n            \r\n            {/* Icon */}\r\n            <foreignObject x={x + width / 2 - 12} y={y + height / 2 - 12} width={24} height={24}>\r\n                <div className=\"flex items-center justify-center w-full h-full\">\r\n                    <Icon size={20} className=\"text-amber-600\" />\r\n                </div>\r\n            </foreignObject>\r\n            \r\n            {/* Selection indicator */}\r\n            {isSelected && (\r\n                <rect\r\n                    x={x - 4}\r\n                    y={y - 4}\r\n                    width={width + 8}\r\n                    height={height + 8}\r\n                    fill=\"none\"\r\n                    stroke=\"#3D84ED\"\r\n                    strokeWidth={2}\r\n                    strokeDasharray=\"5,5\"\r\n                />\r\n            )}\r\n        </g>\r\n    );\r\n}\r\n\r\n","import { useState, useCallback, useRef } from 'react';\r\n\r\n/**\r\n * Custom hook for undo/redo functionality\r\n * @param {*} initialState - Initial state value\r\n * @param {number} maxHistory - Maximum number of history entries (default: 50)\r\n * @returns {Object} - { state, setState, undo, redo, canUndo, canRedo, clearHistory }\r\n */\r\nexport function useUndoRedo(initialState, maxHistory = 50) {\r\n    const [state, setState] = useState(initialState);\r\n    const historyRef = useRef([initialState]);\r\n    const historyIndexRef = useRef(0);\r\n\r\n    const setStateWithHistory = useCallback((newState) => {\r\n        // If we're not at the end of history, remove future states\r\n        if (historyIndexRef.current < historyRef.current.length - 1) {\r\n            historyRef.current = historyRef.current.slice(0, historyIndexRef.current + 1);\r\n        }\r\n\r\n        // Add new state to history\r\n        historyRef.current.push(newState);\r\n\r\n        // Limit history size\r\n        if (historyRef.current.length > maxHistory) {\r\n            historyRef.current.shift();\r\n        } else {\r\n            historyIndexRef.current++;\r\n        }\r\n\r\n        setState(newState);\r\n    }, [maxHistory]);\r\n\r\n    const undo = useCallback(() => {\r\n        if (historyIndexRef.current > 0) {\r\n            historyIndexRef.current--;\r\n            setState(historyRef.current[historyIndexRef.current]);\r\n        }\r\n    }, []);\r\n\r\n    const redo = useCallback(() => {\r\n        if (historyIndexRef.current < historyRef.current.length - 1) {\r\n            historyIndexRef.current++;\r\n            setState(historyRef.current[historyIndexRef.current]);\r\n        }\r\n    }, []);\r\n\r\n    const canUndo = historyIndexRef.current > 0;\r\n    const canRedo = historyIndexRef.current < historyRef.current.length - 1;\r\n\r\n    const clearHistory = useCallback(() => {\r\n        historyRef.current = [state];\r\n        historyIndexRef.current = 0;\r\n    }, [state]);\r\n\r\n    return {\r\n        state,\r\n        setState: setStateWithHistory,\r\n        undo,\r\n        redo,\r\n        canUndo,\r\n        canRedo,\r\n        clearHistory\r\n    };\r\n}\r\n\r\n","import React, { useState, useRef, useCallback, useEffect } from 'react';\nimport { Edit, Move, Trash2, Plus, CornerUpLeft, CornerDownRight, Zap, BoxSelect, GripHorizontal, Copy, Clipboard, Scissors, Image as ImageIcon, RotateCw, FlipHorizontal, FlipVertical, ZoomIn, ZoomOut, Maximize2, Ruler, Type, Circle, Triangle } from 'lucide-react';\nimport Panorama360Viewer from './Panorama360Viewer';\nimport FloorplanTools from './FloorplanTools';\nimport FloorplanPropertyPanel from './FloorplanPropertyPanel';\nimport FloorplanContextMenu from './FloorplanContextMenu';\nimport FloorplanLayerPanel from './FloorplanLayerPanel';\nimport DoorComponent from './DoorComponent';\nimport WindowComponent from './WindowComponent';\nimport FurnitureComponent from './FurnitureComponent';\nimport { useUndoRedo } from '../../hooks/useUndoRedo';\nimport { calculateDistance, calculateArea, calculatePerimeter, formatMeasurement, exportSVG, exportPNG, snapToGrid, snapToObject, generateId } from '../../utils/floorplanUtils';\nimport toast from 'react-hot-toast';\n\nconst SNAP_GRID = 10; // Snap movement to 10px grid\n\n// --- GEOMETRY HELPERS ---\n\n// Calculate distance from point (px,py) to line segment (x1,y1)-(x2,y2)\nconst getDistanceToLineSegment = (px, py, x1, y1, x2, y2) => {\n    const A = px - x1;\n    const B = py - y1;\n    const C = x2 - x1;\n    const D = y2 - y1;\n  \n    const dot = A * C + B * D;\n    const len_sq = C * C + D * D;\n    let param = -1;\n    \n    if (len_sq !== 0) param = dot / len_sq;\n  \n    let xx, yy;\n  \n    if (param < 0) {\n      xx = x1;\n      yy = y1;\n    } else if (param > 1) {\n      xx = x2;\n      yy = y2;\n    } else {\n      xx = x1 + param * C;\n      yy = y1 + param * D;\n    }\n  \n    const dx = px - xx;\n    const dy = py - yy;\n    return Math.sqrt(dx * dx + dy * dy);\n};\n\n/**\n * FloorplanEditor component for editing studio room layout via interactive SVG.\n */\nexport default function FloorplanEditor({ rooms, walls: propWalls, structures: propStructures, onRoomClick, onLayoutChange, onWallsChange, onStructuresChange }) {\n    const svgRef = useRef(null);\n    const containerRef = useRef(null);\n    \n    // --- INTERACTION STATE ---\n    const [isDragging, setIsDragging] = useState(false);\n    const [isResizing, setIsResizing] = useState(false); // 'br', 'bl', 'tr', 'tl', 't', 'r', 'b', 'l'\n    const [cursorOffset, setCursorOffset] = useState({ x: 0, y: 0 });\n    const [isPanning, setIsPanning] = useState(false);\n    const [panOffset, setPanOffset] = useState({ x: 0, y: 0 });\n\n    // Selection State\n    const [activeRoomId, setActiveRoomId] = useState(null);\n    const [activeStructureId, setActiveStructureId] = useState(null);\n    const [activeWallId, setActiveWallId] = useState(null);\n    const [activeDoorId, setActiveDoorId] = useState(null);\n    const [activeWindowId, setActiveWindowId] = useState(null);\n    const [activeFurnitureId, setActiveFurnitureId] = useState(null);\n    const [selectedItems, setSelectedItems] = useState(new Set()); // Multi-select\n    const [draggingWallHandle, setDraggingWallHandle] = useState(null);\n    const [viewing360Room, setViewing360Room] = useState(null);\n    const [contextMenu, setContextMenu] = useState(null); // { x, y }\n    const [showPropertyPanel, setShowPropertyPanel] = useState(false);\n    \n    // --- DATA STATE ---\n    const [walls, setWalls] = useState(propWalls || []); \n    const [structures, setStructures] = useState(propStructures || []); \n    const [doors, setDoors] = useState([]);\n    const [windows, setWindows] = useState([]);\n    const [furniture, setFurniture] = useState([]);\n    const [textLabels, setTextLabels] = useState([]);\n    const [measurements, setMeasurements] = useState([]);\n    const [backgroundImage, setBackgroundImage] = useState(null);\n    const [clipboard, setClipboard] = useState(null); \n    const [customShapes, setCustomShapes] = useState([]); // circles, polygons, etc.\n    const [layers, setLayers] = useState({\n        structures: { visible: true, locked: false },\n        rooms: { visible: true, locked: false },\n        walls: { visible: true, locked: false },\n        doors: { visible: true, locked: false },\n        windows: { visible: true, locked: false },\n        furniture: { visible: true, locked: false },\n        text: { visible: true, locked: false },\n        measurements: { visible: true, locked: false }\n    });\n    const [roomTemplates, setRoomTemplates] = useState([\n        { name: 'Control Room', width: 200, height: 150, color: '#3B82F6' },\n        { name: 'Live Room', width: 300, height: 250, color: '#10B981' },\n        { name: 'Isolation Booth', width: 120, height: 120, color: '#F59E0B' },\n        { name: 'Lounge', width: 250, height: 200, color: '#8B5CF6' }\n    ]);\n    \n    // --- TOOLS STATE ---\n    const [activeTool, setActiveTool] = useState('select');\n    const [wallStartPoint, setWallStartPoint] = useState(null);\n    const [measureStartPoint, setMeasureStartPoint] = useState(null);\n    const [currentMeasurement, setCurrentMeasurement] = useState(null);\n    \n    // --- VIEW STATE ---\n    const [zoom, setZoom] = useState(1);\n    const [viewBox, setViewBox] = useState({ x: 0, y: 0, width: 800, height: 600 });\n    const [showGrid, setShowGrid] = useState(true);\n    const [gridSize, setGridSize] = useState(SNAP_GRID);\n    const [scale, setScale] = useState(10); // pixels per foot\n    const [measurementUnit, setMeasurementUnit] = useState('ft');\n    const [snapToObjects, setSnapToObjects] = useState(true);\n    \n    // --- UNDO/REDO ---\n    const floorplanState = {\n        walls,\n        structures,\n        doors,\n        windows,\n        furniture,\n        textLabels\n    };\n    const { state: historyState, setState: setHistoryState, undo, redo, canUndo, canRedo } = useUndoRedo(floorplanState);\n\n    const width = 800;\n    const height = 600;\n\n    // Sync props to state when they change externally (e.g. initial load)\n    useEffect(() => { setWalls(propWalls || []); }, [propWalls]);\n    useEffect(() => { setStructures(propStructures || []); }, [propStructures]);\n\n    // Utility function to get position relative to the SVG container\n    const getCoords = (e, applyZoom = true) => {\n        if (!svgRef.current) return { x: 0, y: 0 };\n        \n        const rect = svgRef.current.getBoundingClientRect();\n        let clientX = e.clientX;\n        let clientY = e.clientY;\n\n        if (e.touches && e.touches.length > 0) {\n            clientX = e.touches[0].clientX;\n            clientY = e.touches[0].clientY;\n        }\n\n        let x = (clientX - rect.left) / (applyZoom ? zoom : 1) - panOffset.x;\n        let y = (clientY - rect.top) / (applyZoom ? zoom : 1) - panOffset.y;\n        \n        // Snap to grid\n        const snapped = snapToGrid(x, y, gridSize);\n        \n        // Snap to objects if enabled\n        if (snapToObjects && activeTool === 'select') {\n            const allObjects = [...rooms, ...structures, ...walls.map(w => ({ x: w.x1, y: w.y1, width: w.x2 - w.x1, height: w.y2 - w.y1 }))];\n            return snapToObject(snapped.x, snapped.y, allObjects, 10);\n        }\n        \n        return snapped;\n    };\n\n    // --- PERSISTENCE HELPERS ---\n    const commitWalls = (newWalls, saveToHistory = true) => {\n        setWalls(newWalls);\n        onWallsChange(newWalls);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, walls: newWalls });\n        }\n    };\n\n    const commitStructures = (newStructures, saveToHistory = true) => {\n        setStructures(newStructures);\n        onStructuresChange(newStructures);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, structures: newStructures });\n        }\n    };\n\n    const commitDoors = (newDoors, saveToHistory = true) => {\n        setDoors(newDoors);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, doors: newDoors });\n        }\n    };\n\n    const commitWindows = (newWindows, saveToHistory = true) => {\n        setWindows(newWindows);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, windows: newWindows });\n        }\n    };\n\n    const commitFurniture = (newFurniture, saveToHistory = true) => {\n        setFurniture(newFurniture);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, furniture: newFurniture });\n        }\n    };\n\n    // --- CLIPBOARD & EDITING ACTIONS ---\n\n    const handleDelete = useCallback(() => {\n        if (activeStructureId) {\n            const newStructs = structures.filter(s => s.id !== activeStructureId);\n            commitStructures(newStructs);\n            setActiveStructureId(null);\n            setShowPropertyPanel(false);\n        } else if (activeWallId) {\n            const newWalls = walls.filter(w => w.id !== activeWallId);\n            commitWalls(newWalls);\n            setActiveWallId(null);\n            setShowPropertyPanel(false);\n        } else if (activeDoorId) {\n            const newDoors = doors.filter(d => d.id !== activeDoorId);\n            commitDoors(newDoors);\n            setActiveDoorId(null);\n            setShowPropertyPanel(false);\n        } else if (activeWindowId) {\n            const newWindows = windows.filter(w => w.id !== activeWindowId);\n            commitWindows(newWindows);\n            setActiveWindowId(null);\n            setShowPropertyPanel(false);\n        } else if (activeFurnitureId) {\n            const newFurniture = furniture.filter(f => f.id !== activeFurnitureId);\n            commitFurniture(newFurniture);\n            setActiveFurnitureId(null);\n            setShowPropertyPanel(false);\n        } else if (activeRoomId) {\n            // Room deletion handled by parent\n            setActiveRoomId(null);\n            setShowPropertyPanel(false);\n        }\n    }, [activeStructureId, activeWallId, activeDoorId, activeWindowId, activeFurnitureId, activeRoomId, structures, walls, doors, windows, furniture]);\n\n    const handleCopy = useCallback(() => {\n        if (activeStructureId) {\n            const item = structures.find(s => s.id === activeStructureId);\n            if (item) setClipboard({ type: 'structure', data: item });\n        } else if (activeWallId) {\n            const item = walls.find(w => w.id === activeWallId);\n            if (item) setClipboard({ type: 'wall', data: item });\n        }\n    }, [activeStructureId, activeWallId, structures, walls]);\n\n    const handlePaste = useCallback(() => {\n        if (!clipboard) return;\n\n        const offset = 20; // Visual offset for pasted item\n\n        if (clipboard.type === 'structure') {\n            const newStruct = {\n                ...clipboard.data,\n                id: `struct_${Date.now()}`,\n                layout: {\n                    ...clipboard.data.layout,\n                    x: clipboard.data.layout.x + offset,\n                    y: clipboard.data.layout.y + offset\n                }\n            };\n            commitStructures([...structures, newStruct]);\n            setActiveStructureId(newStruct.id);\n        } else if (clipboard.type === 'wall') {\n            const newWall = {\n                ...clipboard.data,\n                id: `wall_${Date.now()}`,\n                x1: clipboard.data.x1 + offset,\n                y1: clipboard.data.y1 + offset,\n                x2: clipboard.data.x2 + offset,\n                y2: clipboard.data.y2 + offset\n            };\n            commitWalls([...walls, newWall]);\n            setActiveWallId(newWall.id);\n        }\n    }, [clipboard, structures, walls]);\n\n    const handleCut = useCallback(() => {\n        handleCopy();\n        handleDelete();\n    }, [handleCopy, handleDelete]);\n\n    // Keyboard Shortcuts Listener\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            // Undo/Redo\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n                e.preventDefault();\n                undo();\n                return;\n            }\n            if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {\n                e.preventDefault();\n                redo();\n                return;\n            }\n            \n            // Delete\n            if (e.key === 'Delete' || e.key === 'Backspace') {\n                handleDelete();\n            }\n            // Copy (Ctrl+C / Cmd+C)\n            if ((e.ctrlKey || e.metaKey) && e.key === 'c') {\n                e.preventDefault();\n                handleCopy();\n            }\n            // Paste (Ctrl+V / Cmd+V)\n            if ((e.ctrlKey || e.metaKey) && e.key === 'v') {\n                e.preventDefault();\n                handlePaste();\n            }\n            // Cut (Ctrl+X / Cmd+X)\n            if ((e.ctrlKey || e.metaKey) && e.key === 'x') {\n                e.preventDefault();\n                handleCut();\n            }\n            // Zoom\n            if ((e.ctrlKey || e.metaKey) && e.key === '=') {\n                e.preventDefault();\n                handleZoomIn();\n            }\n            if ((e.ctrlKey || e.metaKey) && e.key === '-') {\n                e.preventDefault();\n                handleZoomOut();\n            }\n            if ((e.ctrlKey || e.metaKey) && e.key === '0') {\n                e.preventDefault();\n                handleFitToView();\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [handleDelete, handleCopy, handlePaste, handleCut, undo, redo]);\n\n\n    // --- ROOM HANDLERS ---\n    \n    const startDragRoom = useCallback((e, room) => {\n        if (activeTool !== 'select') return;\n        e.preventDefault();\n        e.stopPropagation();\n        \n        const { x, y } = getCoords(e);\n        \n        setActiveRoomId(room.id);\n        setActiveStructureId(null);\n        setActiveWallId(null);\n        setIsDragging(true);\n        setIsResizing(false);\n        setCursorOffset({\n            x: x - room.layout.x,\n            y: y - room.layout.y,\n        });\n    }, [activeTool]);\n\n    const startResizeRoom = useCallback((e, room, direction) => {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        setActiveRoomId(room.id);\n        setActiveStructureId(null);\n        setActiveWallId(null);\n        setActiveDoorId(null);\n        setActiveWindowId(null);\n        setActiveFurnitureId(null);\n        setIsDragging(false);\n        setIsResizing(direction);\n    }, []);\n\n    const startPan = useCallback((e) => {\n        if (activeTool === 'select' && (e.button === 1 || e.ctrlKey || e.metaKey || e.space)) {\n            e.preventDefault();\n            setIsPanning({ startX: e.clientX, startY: e.clientY });\n        }\n    }, [activeTool]);\n\n    const stopPan = useCallback(() => {\n        setIsPanning(false);\n    }, []);\n\n    // --- STRUCTURE HANDLERS (Visual Only Rooms) ---\n\n    const addStructure = () => {\n        const newStruct = {\n            id: `struct_${Date.now()}`,\n            label: 'Lobby / Area',\n            layout: { x: 100, y: 100, width: 150, height: 100, color: '#94a3b8' } // Slate 400\n        };\n        commitStructures([...structures, newStruct]);\n        setActiveTool('select'); // Reset tool\n    };\n\n    const startDragStructure = useCallback((e, struct) => {\n        if (activeTool !== 'select') return;\n        e.preventDefault();\n        e.stopPropagation();\n        \n        const { x, y } = getCoords(e);\n        \n        setActiveStructureId(struct.id);\n        setActiveRoomId(null); // Deselect rooms\n        setActiveWallId(null);\n        setIsDragging(true);\n        setIsResizing(false);\n        setCursorOffset({\n            x: x - struct.layout.x,\n            y: y - struct.layout.y,\n        });\n    }, [activeTool]);\n\n    const startResizeStructure = useCallback((e, struct, direction) => {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        setActiveStructureId(struct.id);\n        setActiveRoomId(null);\n        setActiveWallId(null);\n        setIsDragging(false);\n        setIsResizing(direction);\n    }, []);\n\n    // --- WALL HANDLERS ---\n\n    const startDragWallHandle = useCallback((e, wallId, point) => {\n        if (activeTool !== 'select') return;\n        e.preventDefault();\n        e.stopPropagation();\n        setDraggingWallHandle({ id: wallId, point });\n        setActiveRoomId(null);\n        setActiveStructureId(null);\n        setActiveWallId(wallId);\n    }, [activeTool]);\n\n    const selectWall = (e, wallId) => {\n        if (activeTool !== 'select') return;\n        e.stopPropagation();\n        setActiveWallId(wallId);\n        setActiveRoomId(null);\n        setActiveStructureId(null);\n    };\n\n    // --- GLOBAL MOVE HANDLER ---\n\n    const handleMouseMove = useCallback((e) => {\n        if (!svgRef.current) return;\n        const { x, y } = getCoords(e); // Snapped coords\n        \n        // 1. WALL DRAWING PREVIEW\n        if (activeTool === 'wall' && wallStartPoint) {\n            const previewWall = { \n                id: 'preview', \n                x1: wallStartPoint.x, y1: wallStartPoint.y, \n                x2: x, y2: y \n            };\n            // Just local state for preview, don't commit\n            setWalls(prev => [...prev.filter(w => w.id !== 'preview'), previewWall]);\n            return;\n        }\n\n        // 2. WALL EDITING (Moving Endpoints)\n        if (draggingWallHandle) {\n            // Update local state while dragging for smoothness\n            setWalls(prev => prev.map(w => {\n                if (w.id !== draggingWallHandle.id) return w;\n                return draggingWallHandle.point === 'start' \n                    ? { ...w, x1: x, y1: y } \n                    : { ...w, x2: x, y2: y };\n            }));\n            return;\n        }\n\n        // 3. DRAGGING (Room, Structure, Door, Window, Furniture)\n        if (isDragging) {\n            const newPos = { x: x - cursorOffset.x, y: y - cursorOffset.y };\n            \n            if (activeRoomId) {\n                const room = rooms.find(r => r.id === activeRoomId);\n                if (room) onLayoutChange(activeRoomId, { ...room.layout, ...newPos });\n            } else if (activeStructureId) {\n                setStructures(prev => prev.map(s => s.id === activeStructureId ? { ...s, layout: { ...s.layout, ...newPos } } : s));\n            } else if (activeDoorId) {\n                setDoors(prev => prev.map(d => d.id === activeDoorId ? { ...d, x: newPos.x, y: newPos.y } : d));\n            } else if (activeWindowId) {\n                setWindows(prev => prev.map(w => w.id === activeWindowId ? { ...w, x: newPos.x, y: newPos.y } : w));\n            } else if (activeFurnitureId) {\n                setFurniture(prev => prev.map(f => f.id === activeFurnitureId ? { ...f, x: newPos.x, y: newPos.y } : f));\n            }\n        }\n        \n        // 4. RESIZING (Room or Structure) - Multi-handle support\n        if (isResizing) {\n            if (activeRoomId) {\n                const room = rooms.find(r => r.id === activeRoomId);\n                if (room) {\n                    let newLayout = { ...room.layout };\n                    const minSize = SNAP_GRID;\n                    \n                    if (isResizing === 'br') {\n                        newLayout.width = Math.max(minSize, x - room.layout.x);\n                        newLayout.height = Math.max(minSize, y - room.layout.y);\n                    } else if (isResizing === 'bl') {\n                        newLayout.width = Math.max(minSize, room.layout.x + room.layout.width - x);\n                        newLayout.height = Math.max(minSize, y - room.layout.y);\n                        newLayout.x = Math.min(x, room.layout.x + room.layout.width - minSize);\n                    } else if (isResizing === 'tr') {\n                        newLayout.width = Math.max(minSize, x - room.layout.x);\n                        newLayout.height = Math.max(minSize, room.layout.y + room.layout.height - y);\n                        newLayout.y = Math.min(y, room.layout.y + room.layout.height - minSize);\n                    } else if (isResizing === 'tl') {\n                        newLayout.width = Math.max(minSize, room.layout.x + room.layout.width - x);\n                        newLayout.height = Math.max(minSize, room.layout.y + room.layout.height - y);\n                        newLayout.x = Math.min(x, room.layout.x + room.layout.width - minSize);\n                        newLayout.y = Math.min(y, room.layout.y + room.layout.height - minSize);\n                    } else if (isResizing === 't') {\n                        newLayout.height = Math.max(minSize, room.layout.y + room.layout.height - y);\n                        newLayout.y = Math.min(y, room.layout.y + room.layout.height - minSize);\n                    } else if (isResizing === 'r') {\n                        newLayout.width = Math.max(minSize, x - room.layout.x);\n                    } else if (isResizing === 'b') {\n                        newLayout.height = Math.max(minSize, y - room.layout.y);\n                    } else if (isResizing === 'l') {\n                        newLayout.width = Math.max(minSize, room.layout.x + room.layout.width - x);\n                        newLayout.x = Math.min(x, room.layout.x + room.layout.width - minSize);\n                    }\n                    \n                    onLayoutChange(activeRoomId, newLayout);\n                }\n            } else if (activeStructureId) {\n                const struct = structures.find(s => s.id === activeStructureId);\n                if (struct) {\n                    let newLayout = { ...struct.layout };\n                    const minSize = SNAP_GRID;\n                    \n                    if (isResizing === 'br') {\n                        newLayout.width = Math.max(minSize, x - struct.layout.x);\n                        newLayout.height = Math.max(minSize, y - struct.layout.y);\n                    } else if (isResizing === 'bl') {\n                        newLayout.width = Math.max(minSize, struct.layout.x + struct.layout.width - x);\n                        newLayout.height = Math.max(minSize, y - struct.layout.y);\n                        newLayout.x = Math.min(x, struct.layout.x + struct.layout.width - minSize);\n                    } else if (isResizing === 'tr') {\n                        newLayout.width = Math.max(minSize, x - struct.layout.x);\n                        newLayout.height = Math.max(minSize, struct.layout.y + struct.layout.height - y);\n                        newLayout.y = Math.min(y, struct.layout.y + struct.layout.height - minSize);\n                    } else if (isResizing === 'tl') {\n                        newLayout.width = Math.max(minSize, struct.layout.x + struct.layout.width - x);\n                        newLayout.height = Math.max(minSize, struct.layout.y + struct.layout.height - y);\n                        newLayout.x = Math.min(x, struct.layout.x + struct.layout.width - minSize);\n                        newLayout.y = Math.min(y, struct.layout.y + struct.layout.height - minSize);\n                    } else if (isResizing === 't') {\n                        newLayout.height = Math.max(minSize, struct.layout.y + struct.layout.height - y);\n                        newLayout.y = Math.min(y, struct.layout.y + struct.layout.height - minSize);\n                    } else if (isResizing === 'r') {\n                        newLayout.width = Math.max(minSize, x - struct.layout.x);\n                    } else if (isResizing === 'b') {\n                        newLayout.height = Math.max(minSize, y - struct.layout.y);\n                    } else if (isResizing === 'l') {\n                        newLayout.width = Math.max(minSize, struct.layout.x + struct.layout.width - x);\n                        newLayout.x = Math.min(x, struct.layout.x + struct.layout.width - minSize);\n                    }\n                    \n                    setStructures(prev => prev.map(s => s.id === activeStructureId ? { ...s, layout: newLayout } : s));\n                }\n            }\n        }\n\n        // 5. MEASUREMENT TOOL\n        if (activeTool === 'measure' && measureStartPoint) {\n            const distance = calculateDistance(measureStartPoint.x, measureStartPoint.y, x, y);\n            setCurrentMeasurement({\n                x1: measureStartPoint.x,\n                y1: measureStartPoint.y,\n                x2: x,\n                y2: y,\n                distance: formatMeasurement(distance, scale, measurementUnit)\n            });\n        }\n\n        // 6. PAN\n        if (isPanning && (e.buttons === 1 || e.touches)) {\n            const deltaX = e.movementX || (e.touches ? e.touches[0].clientX - (isPanning.startX || 0) : 0);\n            const deltaY = e.movementY || (e.touches ? e.touches[0].clientY - (isPanning.startY || 0) : 0);\n            setPanOffset(prev => ({\n                x: prev.x + deltaX / zoom,\n                y: prev.y + deltaY / zoom\n            }));\n            if (e.touches) {\n                setIsPanning({ ...isPanning, startX: e.touches[0].clientX, startY: e.touches[0].clientY });\n            }\n        }\n        \n    }, [activeRoomId, activeStructureId, isDragging, isResizing, draggingWallHandle, cursorOffset, rooms, onLayoutChange, activeTool, wallStartPoint]);\n\n    const stopInteraction = useCallback(() => {\n        // Commit changes on mouse up\n        if (isDragging || isResizing) {\n            if (activeStructureId) {\n                onStructuresChange(structures); \n                setHistoryState({ ...floorplanState, structures });\n            } else if (activeDoorId) {\n                commitDoors(doors);\n            } else if (activeWindowId) {\n                commitWindows(windows);\n            } else if (activeFurnitureId) {\n                commitFurniture(furniture);\n            }\n        }\n        if (draggingWallHandle) {\n            onWallsChange(walls);\n            setHistoryState({ ...floorplanState, walls });\n        }\n\n        setIsDragging(false);\n        setIsResizing(false);\n        setDraggingWallHandle(null);\n    }, [isDragging, isResizing, draggingWallHandle, activeStructureId, activeDoorId, activeWindowId, activeFurnitureId, structures, walls, doors, windows, furniture, onStructuresChange, onWallsChange, floorplanState, setHistoryState]);\n    \n    // --- CANVAS CLICK HANDLER ---\n    const handleCanvasClick = useCallback((e) => {\n        if (isDragging || isResizing || isPanning) return;\n        \n        const { x, y } = getCoords(e);\n\n        // WALL TOOL\n        if (activeTool === 'wall') {\n            e.stopPropagation();\n        if (!wallStartPoint) {\n            setWallStartPoint({ x, y });\n        } else {\n            const newWall = {\n                    id: generateId('wall'),\n                x1: wallStartPoint.x, y1: wallStartPoint.y,\n                x2: x, y2: y,\n                stroke: '#52525B', strokeWidth: 5\n            };\n                commitWalls([...walls.filter(w => w.id !== 'preview'), newWall]);\n                setWallStartPoint(null);\n            }\n            return;\n        }\n\n        // MEASUREMENT TOOL\n        if (activeTool === 'measure') {\n            e.stopPropagation();\n            if (!measureStartPoint) {\n                setMeasureStartPoint({ x, y });\n            } else {\n                const distance = calculateDistance(measureStartPoint.x, measureStartPoint.y, x, y);\n                const newMeasurement = {\n                    id: generateId('measure'),\n                    x1: measureStartPoint.x,\n                    y1: measureStartPoint.y,\n                    x2: x,\n                    y2: y,\n                    distance: formatMeasurement(distance, scale, measurementUnit)\n                };\n                setMeasurements(prev => [...prev, newMeasurement]);\n                setMeasureStartPoint(null);\n                setCurrentMeasurement(null);\n            }\n            return;\n        }\n\n        // DOOR TOOL\n        if (activeTool === 'door') {\n            e.stopPropagation();\n            const newDoor = {\n                id: generateId('door'),\n                type: 'door',\n                x: x - 15,\n                y: y - 30,\n                width: 30,\n                height: 60,\n                subType: 'single',\n                direction: 'left'\n            };\n            commitDoors([...doors, newDoor]);\n            setActiveDoorId(newDoor.id);\n            return;\n        }\n\n        // WINDOW TOOL\n        if (activeTool === 'window') {\n            e.stopPropagation();\n            const newWindow = {\n                id: generateId('window'),\n                type: 'window',\n                x: x - 20,\n                y: y - 30,\n                width: 40,\n                height: 60,\n                subType: 'standard'\n            };\n            commitWindows([...windows, newWindow]);\n            setActiveWindowId(newWindow.id);\n            return;\n        }\n\n        // FURNITURE TOOL\n        if (activeTool === 'furniture') {\n            e.stopPropagation();\n            const newFurniture = {\n                id: generateId('furniture'),\n                type: 'furniture',\n                x: x - 20,\n                y: y - 20,\n                width: 40,\n                height: 40,\n                subType: 'box',\n                rotation: 0\n            };\n            commitFurniture([...furniture, newFurniture]);\n            setActiveFurnitureId(newFurniture.id);\n            return;\n        }\n\n        // TEXT TOOL\n        if (activeTool === 'text') {\n            e.stopPropagation();\n            const newLabel = {\n                id: generateId('text'),\n                type: 'text',\n                x: x,\n                y: y,\n                text: 'Label',\n                fontSize: 14,\n                color: '#000000'\n            };\n            setTextLabels(prev => [...prev, newLabel]);\n            return;\n        }\n\n        // CIRCLE TOOL\n        if (activeTool === 'circle') {\n            e.stopPropagation();\n            const newCircle = {\n                id: generateId('circle'),\n                type: 'circle',\n                cx: x,\n                cy: y,\n                r: 30,\n                fill: '#3B82F6',\n                stroke: '#1E40AF',\n                strokeWidth: 2\n            };\n            setCustomShapes(prev => [...prev, newCircle]);\n            return;\n        }\n\n        // POLYGON TOOL (simplified - click to add points, double-click to finish)\n        if (activeTool === 'polygon') {\n            e.stopPropagation();\n            // Polygon creation would need state to track points\n            toast.info('Polygon tool: Click points, double-click to finish');\n            return;\n        }\n\n        // Deselect if clicking empty space\n        if (activeTool === 'select') {\n            if (!e.ctrlKey && !e.metaKey) {\n                setActiveRoomId(null);\n                setActiveStructureId(null);\n                setActiveWallId(null);\n                setActiveDoorId(null);\n                setActiveWindowId(null);\n                setActiveFurnitureId(null);\n                setSelectedItems(new Set());\n                setShowPropertyPanel(false);\n            }\n        }\n    }, [activeTool, wallStartPoint, measureStartPoint, isDragging, isResizing, isPanning, walls, doors, windows, furniture, scale, measurementUnit]);\n\n    // --- ZOOM HANDLERS ---\n    const handleZoomIn = () => {\n        setZoom(prev => Math.min(prev * 1.2, 5));\n    };\n\n    const handleZoomOut = () => {\n        setZoom(prev => Math.max(prev / 1.2, 0.1));\n    };\n\n    const handleFitToView = () => {\n        setZoom(1);\n        setPanOffset({ x: 0, y: 0 });\n    };\n\n    // --- EXPORT HANDLERS ---\n    const handleExportSVG = () => {\n        if (!svgRef.current) return;\n        const { svgString, blob } = exportSVG(svgRef.current, width, height);\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'floorplan.svg';\n        a.click();\n        URL.revokeObjectURL(url);\n        toast.success('Floor plan exported as SVG');\n    };\n\n    const handleExportPNG = async () => {\n        if (!svgRef.current) return;\n        try {\n            const blob = await exportPNG(svgRef.current, width, height, 2);\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'floorplan.png';\n            a.click();\n            URL.revokeObjectURL(url);\n            toast.success('Floor plan exported as PNG');\n        } catch (error) {\n            console.error('Export failed:', error);\n            toast.error('Failed to export PNG');\n        }\n    };\n\n    const handleExportPDF = async () => {\n        // PDF export requires jsPDF library - placeholder for now\n        toast.error('PDF export coming soon');\n    };\n\n    // --- BACKGROUND IMAGE IMPORT ---\n    const handleBackgroundImageUpload = (e) => {\n        const file = e.target.files?.[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = (event) => {\n            setBackgroundImage(event.target.result);\n            toast.success('Background image loaded');\n        };\n        reader.readAsDataURL(file);\n    };\n\n    // --- TEXT LABEL HANDLERS ---\n    const handleTextLabelUpdate = (labelId, updates) => {\n        setTextLabels(prev => prev.map(l => l.id === labelId ? { ...l, ...updates } : l));\n    };\n\n    // --- CUSTOM SHAPES ---\n    const addCircle = (x, y) => {\n        const newCircle = {\n            id: generateId('circle'),\n            type: 'circle',\n            cx: x,\n            cy: y,\n            r: 30,\n            fill: '#3B82F6',\n            stroke: '#1E40AF',\n            strokeWidth: 2\n        };\n        // Add to a shapes array (would need to be added to state)\n        toast.success('Circle added');\n    };\n\n    const addPolygon = (points) => {\n        const newPolygon = {\n            id: generateId('polygon'),\n            type: 'polygon',\n            points: points,\n            fill: '#3B82F6',\n            stroke: '#1E40AF',\n            strokeWidth: 2\n        };\n        // Add to shapes array\n        toast.success('Polygon added');\n    };\n\n    // --- TOOLBAR HANDLERS ---\n    const setTool = (tool) => {\n        setActiveTool(tool);\n        setWallStartPoint(null);\n        setMeasureStartPoint(null);\n        setCurrentMeasurement(null);\n        if (tool === 'structure') addStructure();\n        else if (tool === 'room') addRoom();\n        else if (tool === 'door') {\n            // Door placement will be handled on click\n        } else if (tool === 'window') {\n            // Window placement will be handled on click\n        } else if (tool === 'furniture') {\n            // Furniture placement will be handled on click\n        } else {\n            setWalls(prev => prev.filter(w => w.id !== 'preview')); // Clean preview\n        }\n    };\n\n    const addRoom = (template = null) => {\n        const baseRoom = template || {\n            name: `Room ${rooms.length + 1}`,\n            width: 150,\n            height: 120,\n            color: '#3B82F6'\n        };\n        \n        const newRoom = {\n            id: generateId('room'),\n            name: baseRoom.name,\n            layout: { \n                x: 100, \n                y: 100, \n                width: baseRoom.width, \n                height: baseRoom.height, \n                color: baseRoom.color \n            }\n        };\n        const updatedRooms = [...rooms, newRoom];\n        onLayoutChange(newRoom.id, newRoom.layout);\n        setHistoryState({ ...floorplanState });\n    };\n\n    // Collision detection\n    const checkCollision = (newItem, existingItems) => {\n        return existingItems.some(item => {\n            const itemRect = item.layout || { x: item.x, y: item.y, width: item.width, height: item.height };\n            const newRect = newItem.layout || { x: newItem.x, y: newItem.y, width: newItem.width, height: newItem.height };\n            \n            return !(newRect.x + newRect.width < itemRect.x ||\n                     itemRect.x + itemRect.width < newRect.x ||\n                     newRect.y + newRect.height < itemRect.y ||\n                     itemRect.y + itemRect.height < newRect.y);\n        });\n    };\n\n    // Auto-align helper\n    const autoAlign = (item, allItems, threshold = 10) => {\n        const itemRect = item.layout || { x: item.x, y: item.y, width: item.width, height: item.height };\n        let aligned = { ...itemRect };\n\n        allItems.forEach(other => {\n            if (other.id === item.id) return;\n            const otherRect = other.layout || { x: other.x, y: other.y, width: other.width, height: other.height };\n\n            // Align to top\n            if (Math.abs(itemRect.y - otherRect.y) < threshold) {\n                aligned.y = otherRect.y;\n            }\n            // Align to bottom\n            if (Math.abs((itemRect.y + itemRect.height) - (otherRect.y + otherRect.height)) < threshold) {\n                aligned.y = (otherRect.y + otherRect.height) - itemRect.height;\n            }\n            // Align to left\n            if (Math.abs(itemRect.x - otherRect.x) < threshold) {\n                aligned.x = otherRect.x;\n            }\n            // Align to right\n            if (Math.abs((itemRect.x + itemRect.width) - (otherRect.x + otherRect.width)) < threshold) {\n                aligned.x = (otherRect.x + otherRect.width) - itemRect.width;\n            }\n        });\n\n        return aligned;\n    };\n    \n    // Attach global listeners\n    useEffect(() => {\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', stopInteraction);\n        document.addEventListener('touchmove', handleMouseMove);\n        document.addEventListener('touchend', stopInteraction);\n        \n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', stopInteraction);\n            document.removeEventListener('touchmove', handleMouseMove);\n            document.removeEventListener('touchend', stopInteraction);\n        };\n    }, [handleMouseMove, stopInteraction]);\n\n    // --- RENDER SUB-COMPONENTS ---\n    \n    const WallSegment = ({ wall }) => {\n        const isPreview = wall.id === 'preview';\n        const isSelected = activeWallId === wall.id;\n        return (\n            <g onClick={(e) => selectWall(e, wall.id)} cursor=\"pointer\">\n                {/* Invisible hit area for easier selection */}\n                <line\n                    x1={wall.x1} y1={wall.y1} x2={wall.x2} y2={wall.y2}\n                    stroke=\"transparent\"\n                    strokeWidth=\"15\"\n                />\n                <line\n                    x1={wall.x1} y1={wall.y1} x2={wall.x2} y2={wall.y2}\n                    stroke={isPreview ? '#ef4444' : (isSelected ? '#3D84ED' : wall.stroke)}\n                    strokeWidth={wall.strokeWidth}\n                    strokeLinecap=\"round\"\n                    opacity={isPreview ? 0.7 : 1}\n                />\n                {!isPreview && (\n                    <>\n                        {/* Start Handle */}\n                        <circle \n                            cx={wall.x1} cy={wall.y1} r={6} \n                            fill=\"white\" stroke=\"#52525B\" strokeWidth=\"2\" \n                            className=\"cursor-move hover:fill-brand-blue\"\n                            onMouseDown={(e) => startDragWallHandle(e, wall.id, 'start')}\n                        />\n                        {/* End Handle */}\n                        <circle \n                            cx={wall.x2} cy={wall.y2} r={6} \n                            fill=\"white\" stroke=\"#52525B\" strokeWidth=\"2\" \n                            className=\"cursor-move hover:fill-brand-blue\"\n                            onMouseDown={(e) => startDragWallHandle(e, wall.id, 'end')}\n                        />\n                    </>\n                )}\n            </g>\n        );\n    };\n\n    // Generic Shape Renderer (Used for Rooms and Structures)\n    const LayoutShape = ({ data, isStructure = false, onClick }) => {\n        const { layout, name, rate, label } = data;\n        const isActive = isStructure ? activeStructureId === data.id : activeRoomId === data.id;\n        \n        // Calculate area for display\n        const area = layout.width && layout.height ? calculateArea(layout.width, layout.height, scale) : null;\n        \n        // Determine rounding based on wall locking\n        const checkCornerLocked = (cx, cy) => {\n            const THRESHOLD = 12; \n            return walls.some(w => getDistanceToLineSegment(cx, cy, w.x1, w.y1, w.x2, w.y2) < THRESHOLD);\n        };\n\n        const tlSharp = checkCornerLocked(layout.x, layout.y);\n        const trSharp = checkCornerLocked(layout.x + layout.width, layout.y);\n        const brSharp = checkCornerLocked(layout.x + layout.width, layout.y + layout.height);\n        const blSharp = checkCornerLocked(layout.x, layout.y + layout.height);\n\n        const r = 8; \n        const pathD = [\n            `M ${layout.x + (tlSharp?0:r)} ${layout.y}`,\n            `L ${layout.x + layout.width - (trSharp?0:r)} ${layout.y}`,\n            `Q ${layout.x + layout.width} ${layout.y} ${layout.x + layout.width} ${layout.y + (trSharp?0:r)}`,\n            `L ${layout.x + layout.width} ${layout.y + layout.height - (brSharp?0:r)}`,\n            `Q ${layout.x + layout.width} ${layout.y + layout.height} ${layout.x + layout.width - (brSharp?0:r)} ${layout.y + layout.height}`,\n            `L ${layout.x + (blSharp?0:r)} ${layout.y + layout.height}`,\n            `Q ${layout.x} ${layout.y + layout.height} ${layout.x} ${layout.y + layout.height - (blSharp?0:r)}`,\n            `L ${layout.x} ${layout.y + (tlSharp?0:r)}`,\n            `Q ${layout.x} ${layout.y} ${layout.x + (tlSharp?0:r)} ${layout.y}`,\n            `Z`\n        ].join(' ');\n\n        return (\n            <g \n                onClick={(e) => { \n                    e.stopPropagation(); \n                    onClick(data, e); \n                }} \n                cursor=\"pointer\" \n                style={{ filter: isActive ? `drop-shadow(0 0 5px ${layout.color})` : 'none' }}\n                pointerEvents={activeTool !== 'select' ? 'none' : 'auto'}\n            >\n                <path \n                    d={pathD}\n                    fill={layout.color} \n                    opacity={isStructure ? \"0.5\" : \"0.8\"} \n                    stroke={layout.color}\n                    strokeWidth=\"4\"\n                    strokeDasharray={isStructure ? \"5,5\" : \"0\"}\n                    onMouseDown={(e) => isStructure ? startDragStructure(e, data) : startDragRoom(e, data)}\n                    onTouchStart={(e) => isStructure ? startDragStructure(e, data) : startDragRoom(e, data)}\n                    style={{ cursor: isResizing ? 'default' : 'grab' }}\n                />\n                \n                <text \n                    x={layout.x + layout.width / 2}\n                    y={layout.y + layout.height / 2}\n                    fill=\"white\"\n                    textAnchor=\"middle\"\n                    dominantBaseline=\"middle\"\n                    style={{ pointerEvents: 'none', userSelect: 'none' }}\n                >\n                    <tspan x={layout.x + layout.width / 2} dy=\"-0.5em\" fontWeight=\"bold\" fontSize=\"14\">\n                        {isStructure ? (label || 'Area') : name}\n                    </tspan>\n                    {!isStructure && rate && (\n                        <tspan x={layout.x + layout.width / 2} dy=\"1.2em\" fontSize=\"12\">\n                            ${rate}/hr\n                        </tspan>\n                    )}\n                    {area && (\n                        <tspan x={layout.x + layout.width / 2} dy=\"1.2em\" fontSize=\"10\" opacity=\"0.8\">\n                            {area.sqft.toFixed(0)} sq ft\n                        </tspan>\n                    )}\n                </text>\n                \n                {/* 360 Image Indicator */}\n                {!isStructure && data.panorama360Url && (\n                    <g transform={`translate(${layout.x + layout.width - 20}, ${layout.y + 5})`}>\n                        <circle cx=\"0\" cy=\"0\" r=\"8\" fill=\"#10B981\" opacity=\"0.9\" />\n                        <text x=\"0\" y=\"3\" fontSize=\"8\" fill=\"white\" textAnchor=\"middle\" style={{ pointerEvents: 'none' }}>360</text>\n                    </g>\n                )}\n                \n                {/* Multi-handle Resize Handles */}\n                {isActive && (\n                    <>\n                        {/* Corner Handles */}\n                        <rect x={layout.x - 5} y={layout.y - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"nwse-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'tl') : startResizeRoom(e, data, 'tl')} />\n                        <rect x={layout.x + layout.width - 5} y={layout.y - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"nesw-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'tr') : startResizeRoom(e, data, 'tr')} />\n                        <rect x={layout.x + layout.width - 5} y={layout.y + layout.height - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"nwse-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'br') : startResizeRoom(e, data, 'br')} />\n                        <rect x={layout.x - 5} y={layout.y + layout.height - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"nesw-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'bl') : startResizeRoom(e, data, 'bl')} />\n                        \n                        {/* Edge Handles */}\n                        <rect x={layout.x + layout.width / 2 - 5} y={layout.y - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"ns-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 't') : startResizeRoom(e, data, 't')} />\n                        <rect x={layout.x + layout.width - 5} y={layout.y + layout.height / 2 - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"ew-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'r') : startResizeRoom(e, data, 'r')} />\n                        <rect x={layout.x + layout.width / 2 - 5} y={layout.y + layout.height - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"ns-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'b') : startResizeRoom(e, data, 'b')} />\n                        <rect x={layout.x - 5} y={layout.y + layout.height / 2 - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"ew-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'l') : startResizeRoom(e, data, 'l')} />\n                    </>\n                )}\n            </g>\n        );\n    };\n\n    // Get selected item for property panel\n    const getSelectedItem = () => {\n        if (activeRoomId) return rooms.find(r => r.id === activeRoomId);\n        if (activeStructureId) return structures.find(s => s.id === activeStructureId);\n        if (activeWallId) return walls.find(w => w.id === activeWallId);\n        if (activeDoorId) return doors.find(d => d.id === activeDoorId);\n        if (activeWindowId) return windows.find(w => w.id === activeWindowId);\n        if (activeFurnitureId) return furniture.find(f => f.id === activeFurnitureId);\n        return null;\n    };\n\n    const handlePropertyUpdate = (updates) => {\n        const item = getSelectedItem();\n        if (!item) return;\n\n        if (activeRoomId) {\n            const updated = { ...item, ...updates };\n            onLayoutChange(activeRoomId, updated.layout || item.layout);\n        } else if (activeStructureId) {\n            commitStructures(structures.map(s => s.id === activeStructureId ? { ...s, ...updates } : s));\n        } else if (activeWallId) {\n            commitWalls(walls.map(w => w.id === activeWallId ? { ...w, ...updates } : w));\n        } else if (activeDoorId) {\n            commitDoors(doors.map(d => d.id === activeDoorId ? { ...d, ...updates } : d));\n        } else if (activeWindowId) {\n            commitWindows(windows.map(w => w.id === activeWindowId ? { ...w, ...updates } : w));\n        } else if (activeFurnitureId) {\n            commitFurniture(furniture.map(f => f.id === activeFurnitureId ? { ...f, ...updates } : f));\n        }\n    };\n\n    const handleLayerToggle = (layerKey) => {\n        setLayers(prev => ({\n            ...prev,\n            [layerKey]: { ...prev[layerKey], visible: !prev[layerKey]?.visible }\n        }));\n    };\n\n    const handleLayerLock = (layerKey) => {\n        setLayers(prev => ({\n            ...prev,\n            [layerKey]: { ...prev[layerKey], locked: !prev[layerKey]?.locked }\n        }));\n    };\n\n    const handleContextMenuAction = (action) => {\n        const item = getSelectedItem();\n        if (!item) return;\n\n        switch (action) {\n            case 'copy':\n                handleCopy();\n                break;\n            case 'paste':\n                handlePaste();\n                break;\n            case 'cut':\n                handleCut();\n                break;\n            case 'delete':\n                handleDelete();\n                break;\n            case 'rotate':\n                if (item.layout || item.x !== undefined) {\n                    const currentRotation = item.rotation || 0;\n                    handlePropertyUpdate({ rotation: (currentRotation + 90) % 360 });\n                }\n                break;\n            case 'flipH':\n                // Flip horizontal logic\n                break;\n            case 'flipV':\n                // Flip vertical logic\n                break;\n            default:\n                break;\n        }\n    };\n\n    return (\n        <div className=\"flex h-[650px]\">\n            {/* Tools Sidebar */}\n            <FloorplanTools\n                activeTool={activeTool}\n                setActiveTool={setTool}\n                onUndo={undo}\n                onRedo={redo}\n                canUndo={canUndo}\n                canRedo={canRedo}\n                onZoomIn={handleZoomIn}\n                onZoomOut={handleZoomOut}\n                onFitToView={handleFitToView}\n                onExportSVG={handleExportSVG}\n                onExportPNG={handleExportPNG}\n                onExportPDF={handleExportPDF}\n                showGrid={showGrid}\n                toggleGrid={() => setShowGrid(!showGrid)}\n                measurementUnit={measurementUnit}\n                setMeasurementUnit={setMeasurementUnit}\n                scale={scale}\n                setScale={setScale}\n                onBackgroundImageUpload={handleBackgroundImageUpload}\n                onAddRoomTemplate={(template) => addRoom(template)}\n            />\n\n            <div className=\"flex flex-col flex-1\">\n            {/* Control Bar */}\n            <div className='p-3 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36] rounded-t-xl'>\n                <div className='flex gap-4 text-sm text-gray-500 font-medium'>\n                        <button onClick={handleCopy} disabled={!activeStructureId && !activeWallId && !activeDoorId && !activeWindowId && !activeFurnitureId} className='hover:text-brand-blue disabled:opacity-50 flex items-center gap-1'><Copy size={14}/> Copy</button>\n                    <button onClick={handlePaste} disabled={!clipboard} className='hover:text-brand-blue disabled:opacity-50 flex items-center gap-1'><Clipboard size={14}/> Paste</button>\n                        <button onClick={handleCut} disabled={!activeStructureId && !activeWallId && !activeDoorId && !activeWindowId && !activeFurnitureId} className='hover:text-brand-blue disabled:opacity-50 flex items-center gap-1'><Scissors size={14}/> Cut</button>\n                        <button onClick={handleDelete} disabled={!activeStructureId && !activeWallId && !activeDoorId && !activeWindowId && !activeFurnitureId} className='hover:text-red-500 disabled:opacity-50 flex items-center gap-1'><Trash2 size={14}/> Delete</button>\n                </div>\n                \n                    <div className=\"flex gap-2 items-center\">\n                        <span className=\"text-xs text-gray-500\">Zoom: {(zoom * 100).toFixed(0)}%</span>\n                    <button \n                        className={`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${activeTool === 'structure' ? 'bg-purple-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200'}`}\n                        onClick={() => setTool('structure')}\n                    >\n                            <BoxSelect size={16}/> Add Area\n                    </button>\n                    <button \n                        className={`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${activeTool === 'wall' ? 'bg-red-500 text-white shadow-lg' : 'bg-brand-blue text-white hover:bg-blue-600'}`}\n                        onClick={() => setTool(activeTool === 'wall' ? 'select' : 'wall')}\n                    >\n                            <Zap size={16}/> {activeTool === 'wall' ? (wallStartPoint ? 'Finish' : 'Wall') : 'Add Wall'}\n                    </button>\n                </div>\n            </div>\n            \n            {/* SVG Canvas */}\n            <div \n                    ref={containerRef}\n                    className=\"flex-1 overflow-hidden bg-gray-50 dark:bg-[#1f2128] rounded-b-xl border-x border-b dark:border-gray-700 relative\"\n                    style={{ cursor: activeTool === 'wall' || activeTool === 'measure' ? 'crosshair' : isPanning ? 'grabbing' : 'default' }}\n                    tabIndex={0}\n                    onMouseDown={startPan}\n                    onMouseUp={stopPan}\n                    onMouseLeave={stopPan}\n                    onContextMenu={(e) => {\n                        e.preventDefault();\n                        const item = getSelectedItem();\n                        if (item) {\n                            setContextMenu({ x: e.clientX, y: e.clientY });\n                        }\n                }}\n            >\n                <svg \n                    ref={svgRef}\n                    width={width} height={height} \n                    className=\"w-full h-full shadow-inner focus:outline-none\"\n                    viewBox={`${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`}\n                    style={{ transform: `scale(${zoom})`, transformOrigin: 'top left' }}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={(e) => { stopInteraction(); stopPan(); }}\n                    onTouchMove={handleMouseMove}\n                    onTouchEnd={(e) => { stopInteraction(); stopPan(); }}\n                    onClick={handleCanvasClick}\n                >\n                    {/* Background Image */}\n                    {backgroundImage && (\n                        <image\n                            href={backgroundImage}\n                            x={0}\n                            y={0}\n                            width={width}\n                            height={height}\n                            opacity=\"0.3\"\n                        />\n                    )}\n\n                    {/* Grid */}\n                    {showGrid && (\n                        <>\n                            <pattern id=\"smallGrid\" width={gridSize} height={gridSize} patternUnits=\"userSpaceOnUse\">\n                                <path d={`M ${gridSize} 0 L 0 0 0 ${gridSize}`} fill=\"none\" stroke=\"#e5e7eb\" strokeWidth=\"0.5\"/>\n                    </pattern>\n                    <rect width=\"100%\" height=\"100%\" fill=\"url(#smallGrid)\" />\n                        </>\n                    )}\n                    \n                    {/* Layer 1: Structures (Lobbies) */}\n                    {layers.structures?.visible !== false && structures.map((struct) => (\n                        <LayoutShape \n                            key={struct.id} \n                            data={struct} \n                            isStructure={true} \n                            onClick={(s) => {\n                                setActiveStructureId(s.id);\n                                setShowPropertyPanel(true);\n                                setActiveRoomId(null);\n                                setActiveWallId(null);\n                                setActiveDoorId(null);\n                                setActiveWindowId(null);\n                                setActiveFurnitureId(null);\n                            }} \n                        />\n                    ))}\n\n                    {/* Layer 2: Functional Rooms */}\n                    {layers.rooms?.visible !== false && rooms.map((room) => (\n                        <LayoutShape \n                            key={room.id} \n                            data={room} \n                            onClick={(r) => {\n                                if (r.panorama360Url && (e?.ctrlKey || e?.metaKey)) {\n                                    setViewing360Room(r);\n                                } else {\n                                    setActiveRoomId(r.id);\n                                    setShowPropertyPanel(true);\n                                    setActiveStructureId(null);\n                                    setActiveWallId(null);\n                                    setActiveDoorId(null);\n                                    setActiveWindowId(null);\n                                    setActiveFurnitureId(null);\n                                    onRoomClick(rooms.findIndex(rm => rm.id === r.id));\n                                }\n                            }} \n                        />\n                    ))}\n                    \n                    {/* Layer 3: Walls */}\n                    {layers.walls?.visible !== false && walls.map((wall) => (\n                        <WallSegment key={wall.id} wall={wall} />\n                    ))}\n\n                    {/* Layer 4: Doors */}\n                    {layers.doors?.visible !== false && doors.map((door) => (\n                        <DoorComponent\n                            key={door.id}\n                            door={door}\n                            isSelected={activeDoorId === door.id}\n                            onClick={() => {\n                                setActiveDoorId(door.id);\n                                setShowPropertyPanel(true);\n                                setActiveRoomId(null);\n                                setActiveStructureId(null);\n                                setActiveWallId(null);\n                                setActiveWindowId(null);\n                                setActiveFurnitureId(null);\n                            }}\n                            onMouseDown={(e) => {\n                                if (activeTool === 'select') {\n                                    e.preventDefault();\n                                    setActiveDoorId(door.id);\n                                    setIsDragging(true);\n                                    const { x, y } = getCoords(e);\n                                    setCursorOffset({ x: x - door.x, y: y - door.y });\n                                }\n                            }}\n                        />\n                    ))}\n\n                    {/* Layer 5: Windows */}\n                    {layers.windows?.visible !== false && windows.map((window) => (\n                        <WindowComponent\n                            key={window.id}\n                            window={window}\n                            isSelected={activeWindowId === window.id}\n                            onClick={() => {\n                                setActiveWindowId(window.id);\n                                setShowPropertyPanel(true);\n                                setActiveRoomId(null);\n                                setActiveStructureId(null);\n                                setActiveWallId(null);\n                                setActiveDoorId(null);\n                                setActiveFurnitureId(null);\n                            }}\n                            onMouseDown={(e) => {\n                                if (activeTool === 'select') {\n                                    e.preventDefault();\n                                    setActiveWindowId(window.id);\n                                    setIsDragging(true);\n                                    const { x, y } = getCoords(e);\n                                    setCursorOffset({ x: x - window.x, y: y - window.y });\n                                }\n                            }}\n                        />\n                    ))}\n\n                    {/* Layer 6: Furniture */}\n                    {layers.furniture?.visible !== false && furniture.map((item) => (\n                        <FurnitureComponent\n                            key={item.id}\n                            furniture={item}\n                            isSelected={activeFurnitureId === item.id}\n                            onClick={() => {\n                                setActiveFurnitureId(item.id);\n                                setShowPropertyPanel(true);\n                                setActiveRoomId(null);\n                                setActiveStructureId(null);\n                                setActiveWallId(null);\n                                setActiveDoorId(null);\n                                setActiveWindowId(null);\n                            }}\n                            onMouseDown={(e) => {\n                                if (activeTool === 'select') {\n                                    e.preventDefault();\n                                    setActiveFurnitureId(item.id);\n                                    setIsDragging(true);\n                                    const { x, y } = getCoords(e);\n                                    setCursorOffset({ x: x - item.x, y: y - item.y });\n                                }\n                            }}\n                        />\n                    ))}\n\n                    {/* Layer 7: Text Labels */}\n                    {layers.text?.visible !== false && textLabels.map((label) => (\n                        <g key={label.id}>\n                            <text\n                                x={label.x}\n                                y={label.y}\n                                fontSize={label.fontSize || 14}\n                                fill={label.color || \"#000\"}\n                                fontWeight={label.bold ? \"bold\" : \"normal\"}\n                                className=\"cursor-pointer\"\n                                onClick={() => {\n                                    // Edit text label - could open property panel\n                                }}\n                            >\n                                {label.text}\n                            </text>\n                            {label.selected && (\n                                <rect\n                                    x={label.x - 5}\n                                    y={label.y - label.fontSize - 5}\n                                    width={label.text.length * (label.fontSize * 0.6) + 10}\n                                    height={label.fontSize + 10}\n                                    fill=\"none\"\n                                    stroke=\"#3D84ED\"\n                                    strokeWidth={2}\n                                    strokeDasharray=\"5,5\"\n                                />\n                            )}\n                        </g>\n                    ))}\n\n                    {/* Layer 8: Custom Shapes */}\n                    {layers.shapes?.visible !== false && customShapes.map((shape) => {\n                        if (shape.type === 'circle') {\n                            return (\n                                <circle\n                                    key={shape.id}\n                                    cx={shape.cx}\n                                    cy={shape.cy}\n                                    r={shape.r}\n                                    fill={shape.fill}\n                                    stroke={shape.stroke}\n                                    strokeWidth={shape.strokeWidth}\n                                    className=\"cursor-pointer\"\n                                    onClick={() => {\n                                        // Select shape\n                                    }}\n                                />\n                            );\n                        } else if (shape.type === 'polygon') {\n                            return (\n                                <polygon\n                                    key={shape.id}\n                                    points={shape.points.map(p => `${p.x},${p.y}`).join(' ')}\n                                    fill={shape.fill}\n                                    stroke={shape.stroke}\n                                    strokeWidth={shape.strokeWidth}\n                                    className=\"cursor-pointer\"\n                                />\n                            );\n                        }\n                        return null;\n                    })}\n\n                    {/* Layer 9: Measurements */}\n                    {layers.measurements?.visible !== false && measurements.map((measure) => (\n                        <g key={measure.id}>\n                            <line\n                                x1={measure.x1}\n                                y1={measure.y1}\n                                x2={measure.x2}\n                                y2={measure.y2}\n                                stroke=\"#3D84ED\"\n                                strokeWidth={2}\n                                strokeDasharray=\"5,5\"\n                            />\n                            <circle cx={measure.x1} cy={measure.y1} r={4} fill=\"#3D84ED\" />\n                            <circle cx={measure.x2} cy={measure.y2} r={4} fill=\"#3D84ED\" />\n                            <text\n                                x={(measure.x1 + measure.x2) / 2}\n                                y={(measure.y1 + measure.y2) / 2 - 5}\n                                fontSize=\"12\"\n                                fill=\"#3D84ED\"\n                                textAnchor=\"middle\"\n                                className=\"pointer-events-none\"\n                            >\n                                {measure.distance}\n                            </text>\n                        </g>\n                    ))}\n\n                    {/* Current Measurement Preview */}\n                    {currentMeasurement && (\n                        <g>\n                            <line\n                                x1={currentMeasurement.x1}\n                                y1={currentMeasurement.y1}\n                                x2={currentMeasurement.x2}\n                                y2={currentMeasurement.y2}\n                                stroke=\"#3D84ED\"\n                                strokeWidth={2}\n                                strokeDasharray=\"5,5\"\n                            />\n                            <circle cx={currentMeasurement.x1} cy={currentMeasurement.y1} r={4} fill=\"#3D84ED\" />\n                            <circle cx={currentMeasurement.x2} cy={currentMeasurement.y2} r={4} fill=\"#3D84ED\" />\n                            <text\n                                x={(currentMeasurement.x1 + currentMeasurement.x2) / 2}\n                                y={(currentMeasurement.y1 + currentMeasurement.y2) / 2 - 5}\n                                fontSize=\"12\"\n                                fill=\"#3D84ED\"\n                                textAnchor=\"middle\"\n                                className=\"pointer-events-none\"\n                            >\n                                {currentMeasurement.distance}\n                            </text>\n                        </g>\n                    )}\n\n                    {/* Info Overlay */}\n                    <g className=\"pointer-events-none\">\n                        <text x=\"10\" y=\"20\" fontSize=\"10\" fill=\"#9CA3AF\">Grid: {gridSize}px | {walls.length} Walls | {rooms.length} Rooms</text>\n                        <text x=\"10\" y=\"35\" fontSize=\"10\" fill=\"#9CA3AF\">Ctrl+Click room with 360 icon to view | Space+Drag to pan</text>\n                        {activeRoomId && (() => {\n                            const room = rooms.find(r => r.id === activeRoomId);\n                            if (room && room.layout) {\n                                const area = calculateArea(room.layout.width, room.layout.height, scale);\n                                return (\n                                    <text x=\"10\" y=\"50\" fontSize=\"10\" fill=\"#9CA3AF\">\n                                        Area: {area.display}\n                                    </text>\n                                );\n                            }\n                            return null;\n                        })()}\n                    </g>\n                </svg>\n                </div>\n                \n                {/* 360 Viewer Modal */}\n                {viewing360Room && (\n                    <div className=\"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-4\">\n                        <div className=\"w-full max-w-4xl\">\n                            <Panorama360Viewer \n                                imageUrl={viewing360Room.panorama360Url}\n                                title={viewing360Room.name || 'Room View'}\n                                onClose={() => setViewing360Room(null)}\n                            />\n                        </div>\n                    </div>\n                )}\n                \n                {/* Context Menu */}\n                {contextMenu && (\n                    <FloorplanContextMenu\n                        x={contextMenu.x}\n                        y={contextMenu.y}\n                        onClose={() => setContextMenu(null)}\n                        onAction={handleContextMenuAction}\n                        canCopy={!!getSelectedItem()}\n                        canPaste={!!clipboard}\n                        canCut={!!getSelectedItem()}\n                        canDelete={!!getSelectedItem()}\n                        canRotate={!!getSelectedItem()?.layout}\n                        canFlip={!!getSelectedItem()?.layout}\n                        isLocked={false}\n                    />\n                )}\n\n                {/* Property Panel */}\n                {showPropertyPanel && getSelectedItem() && (\n                    <FloorplanPropertyPanel\n                        selectedItem={getSelectedItem()}\n                        onClose={() => setShowPropertyPanel(false)}\n                        onUpdate={handlePropertyUpdate}\n                        scale={scale}\n                        unit={measurementUnit}\n                    />\n                )}\n\n                {/* Layer Panel */}\n                <FloorplanLayerPanel\n                    layers={layers}\n                    onLayerToggle={handleLayerToggle}\n                    onLayerLock={handleLayerLock}\n                />\n            </div>\n        </div>\n    );\n}\n","import React, { useState, useRef } from 'react';\r\nimport { \r\n    Plus, Edit2, Trash2, Users, DollarSign, Mic, \r\n    LayoutGrid, Save, Loader2, ChevronDown, ChevronUp,\r\n    Copy, Map, List\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport { useLanguage } from '../../contexts/LanguageContext';\r\nimport EquipmentAutocomplete from '../shared/EquipmentAutocomplete';\r\nimport FloorplanEditor from './FloorplanEditor';\r\nimport Panorama360Viewer from './Panorama360Viewer';\r\nimport { useImageUpload } from '../../hooks/useImageUpload';\r\nimport { Image as ImageIcon, Upload, X } from 'lucide-react';\r\n\r\n/**\r\n * StudioRooms - Complete room management interface\r\n */\r\nexport default function StudioRooms({ user, userData, onUpdate }) {\r\n    const { t } = useLanguage();\r\n    const [rooms, setRooms] = useState(userData?.rooms || []);\r\n    const [walls, setWalls] = useState(userData?.floorplanWalls || []);\r\n    const [structures, setStructures] = useState(userData?.floorplanStructures || []);\r\n    const [editingRoom, setEditingRoom] = useState(null);\r\n    const [isAdding, setIsAdding] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n    const [expandedRoom, setExpandedRoom] = useState(null);\r\n    const [viewMode, setViewMode] = useState('list'); // 'list' or 'floorplan'\r\n\r\n    const emptyRoom = {\r\n        name: '',\r\n        description: '',\r\n        rate: 50,\r\n        capacity: 4,\r\n        equipment: [], // Array of {name, brand, model, quantity}\r\n        amenities: [],\r\n        minBookingHours: 1,\r\n        active: true,\r\n        color: '#3B82F6',\r\n        panorama360Url: null // 360-degree image URL\r\n    };\r\n\r\n    const handleSave = async (updatedRooms, updatedWalls = walls, updatedStructures = structures) => {\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving rooms...');\r\n        const userId = userData?.id || user?.id || user?.uid;\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/profiles/${userId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    rooms: updatedRooms,\r\n                    floorplanWalls: updatedWalls,\r\n                    floorplanStructures: updatedStructures\r\n                })\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(result.error || 'Failed to save');\r\n            }\r\n\r\n            setRooms(updatedRooms);\r\n            setWalls(updatedWalls);\r\n            setStructures(updatedStructures);\r\n            toast.success('Rooms saved!', { id: toastId });\r\n            if (onUpdate) onUpdate({ rooms: updatedRooms, floorplanWalls: updatedWalls, floorplanStructures: updatedStructures });\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save', { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    // Floorplan handlers\r\n    const handleLayoutChange = (roomId, newLayout) => {\r\n        const updatedRooms = rooms.map(r => \r\n            r.id === roomId ? { ...r, layout: newLayout } : r\r\n        );\r\n        setRooms(updatedRooms);\r\n    };\r\n\r\n    const handleWallsChange = async (newWalls) => {\r\n        setWalls(newWalls);\r\n        const userId = userData?.id || user?.id || user?.uid;\r\n        // Auto-save walls\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/profiles/${userId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ floorplanWalls: newWalls })\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const error = await response.json();\r\n                throw new Error(error.error || 'Failed to save walls');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error saving walls:', error);\r\n        }\r\n    };\r\n\r\n    const handleStructuresChange = async (newStructures) => {\r\n        setStructures(newStructures);\r\n        const userId = userData?.id || user?.id || user?.uid;\r\n        // Auto-save structures\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/profiles/${userId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ floorplanStructures: newStructures })\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const error = await response.json();\r\n                throw new Error(error.error || 'Failed to save structures');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error saving structures:', error);\r\n        }\r\n    };\r\n\r\n    const handleRoomClick = (roomIndex) => {\r\n        if (roomIndex >= 0 && roomIndex < rooms.length) {\r\n            handleEditRoom(roomIndex);\r\n        }\r\n    };\r\n\r\n    const handleAddRoom = () => {\r\n        setEditingRoom({ ...emptyRoom, name: `Room ${rooms.length + 1}` });\r\n        setIsAdding(true);\r\n    };\r\n\r\n    const handleEditRoom = (index) => {\r\n        setEditingRoom({ ...rooms[index] });\r\n        setIsAdding(false);\r\n        setExpandedRoom(index);\r\n    };\r\n\r\n    const handleSaveRoom = async () => {\r\n        if (!editingRoom.name.trim()) {\r\n            toast.error('Room name is required');\r\n            return;\r\n        }\r\n\r\n        let updatedRooms;\r\n        if (isAdding) {\r\n            updatedRooms = [...rooms, editingRoom];\r\n        } else {\r\n            updatedRooms = rooms.map((r, i) => i === expandedRoom ? editingRoom : r);\r\n        }\r\n\r\n        await handleSave(updatedRooms);\r\n        setEditingRoom(null);\r\n        setIsAdding(false);\r\n        setExpandedRoom(null);\r\n    };\r\n\r\n    const handleDeleteRoom = async (index) => {\r\n        if (!confirm(`Delete \"${rooms[index].name}\"? This cannot be undone.`)) return;\r\n        \r\n        const updatedRooms = rooms.filter((_, i) => i !== index);\r\n        await handleSave(updatedRooms);\r\n    };\r\n\r\n    const handleDuplicateRoom = async (index) => {\r\n        const roomToCopy = { ...rooms[index], name: `${rooms[index].name} (Copy)` };\r\n        const updatedRooms = [...rooms, roomToCopy];\r\n        await handleSave(updatedRooms);\r\n    };\r\n\r\n    const handleCancelEdit = () => {\r\n        setEditingRoom(null);\r\n        setIsAdding(false);\r\n        setExpandedRoom(null);\r\n    };\r\n\r\n    const ROOM_AMENITIES = [\r\n        'Isolation Booth', 'Live Room', 'Control Room', 'Lounge Area',\r\n        'Private Bathroom', 'Natural Light', 'Blackout Curtains', \r\n        'Video Feed', 'Climate Control', 'Sound Lock'\r\n    ];\r\n\r\n    // Prepare rooms with layout for floorplan\r\n    const roomsWithLayout = rooms.map((room, index) => ({\r\n        ...room,\r\n        id: room.id || `room_${index}`,\r\n        layout: room.layout || {\r\n            x: 50 + (index % 3) * 200,\r\n            y: 50 + Math.floor(index / 3) * 150,\r\n            width: 180,\r\n            height: 120,\r\n            color: room.color || '#3B82F6'\r\n        }\r\n    }));\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <LayoutGrid className=\"text-brand-blue\" size={24} />\r\n                        Room Management\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Configure your studio rooms, rates, and equipment\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    {/* View Toggle */}\r\n                    <div className=\"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1\">\r\n                        <button\r\n                            onClick={() => setViewMode('list')}\r\n                            className={`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${\r\n                                viewMode === 'list' \r\n                                    ? 'bg-white dark:bg-gray-700 shadow text-brand-blue' \r\n                                    : 'text-gray-600 dark:text-gray-400'\r\n                            }`}\r\n                        >\r\n                            <List size={16} /> List\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setViewMode('floorplan')}\r\n                            className={`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${\r\n                                viewMode === 'floorplan' \r\n                                    ? 'bg-white dark:bg-gray-700 shadow text-brand-blue' \r\n                                    : 'text-gray-600 dark:text-gray-400'\r\n                            }`}\r\n                        >\r\n                            <Map size={16} /> Floorplan\r\n                        </button>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleAddRoom}\r\n                        disabled={isAdding || editingRoom}\r\n                        className=\"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                    >\r\n                        <Plus size={18} /> Add Room\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Add New Room Form */}\r\n            {isAdding && editingRoom && (\r\n                                    <RoomEditor\r\n                                        room={editingRoom}\r\n                                        setRoom={setEditingRoom}\r\n                                        onSave={handleSaveRoom}\r\n                                        onCancel={handleCancelEdit}\r\n                                        saving={saving}\r\n                                        isNew={true}\r\n                                        roomAmenities={ROOM_AMENITIES}\r\n                                        user={user}\r\n                                    />\r\n            )}\r\n\r\n            {/* Floorplan View */}\r\n            {viewMode === 'floorplan' && !isAdding && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                    <FloorplanEditor\r\n                        rooms={roomsWithLayout}\r\n                        walls={walls}\r\n                        structures={structures}\r\n                        onRoomClick={handleRoomClick}\r\n                        onLayoutChange={handleLayoutChange}\r\n                        onWallsChange={handleWallsChange}\r\n                        onStructuresChange={handleStructuresChange}\r\n                    />\r\n                    <div className=\"p-3 bg-gray-50 dark:bg-[#23262f] border-t dark:border-gray-700 text-xs text-gray-500\">\r\n                        <strong>Tips:</strong> Click a room to edit  Drag to reposition  Use corner handles to resize  Add walls to define boundaries\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Room List */}\r\n            {viewMode === 'list' && (\r\n            <div className=\"space-y-4\">\r\n                {rooms.length === 0 && !isAdding ? (\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center\">\r\n                        <LayoutGrid size={48} className=\"mx-auto mb-4 text-gray-300 dark:text-gray-600\" />\r\n                        <h3 className=\"text-lg font-bold dark:text-white mb-2\">No Rooms Yet</h3>\r\n                        <p className=\"text-gray-500 dark:text-gray-400 mb-4 max-w-sm mx-auto\">\r\n                            Add your first room to start accepting bookings\r\n                        </p>\r\n                        <button\r\n                            onClick={handleAddRoom}\r\n                            className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition\"\r\n                        >\r\n                            Add Your First Room\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    rooms.map((room, index) => (\r\n                        <div key={index} className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm\">\r\n                            {/* Room Header */}\r\n                            <div \r\n                                className=\"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-[#23262f] transition\"\r\n                                onClick={() => setExpandedRoom(expandedRoom === index ? null : index)}\r\n                            >\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div \r\n                                        className=\"w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg\"\r\n                                        style={{ backgroundColor: room.color || '#3B82F6' }}\r\n                                    >\r\n                                        {room.name.charAt(0)}\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <h3 className=\"font-bold dark:text-white\">{room.name}</h3>\r\n                                            {room.active === false && (\r\n                                                <span className=\"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-0.5 rounded\">\r\n                                                    Inactive\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                                            <span className=\"flex items-center gap-1\">\r\n                                                <DollarSign size={14} />\r\n                                                ${room.rate}/hr\r\n                                            </span>\r\n                                            <span className=\"flex items-center gap-1\">\r\n                                                <Users size={14} />\r\n                                                {room.capacity} people\r\n                                            </span>\r\n                                            {room.equipment && (\r\n                                                <span className=\"flex items-center gap-1\">\r\n                                                    <Mic size={14} />\r\n                                                    {Array.isArray(room.equipment) \r\n                                                        ? room.equipment.reduce((sum, item) => sum + (item.quantity || 1), 0)\r\n                                                        : room.equipment.split(',').length} items\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); handleDuplicateRoom(index); }}\r\n                                        className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                        title=\"Duplicate\"\r\n                                    >\r\n                                        <Copy size={16} />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); handleEditRoom(index); }}\r\n                                        className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                        title=\"Edit\"\r\n                                    >\r\n                                        <Edit2 size={16} />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); handleDeleteRoom(index); }}\r\n                                        className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                        title=\"Delete\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                    {expandedRoom === index ? <ChevronUp size={20} /> : <ChevronDown size={20} />}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Expanded Edit Form */}\r\n                            {expandedRoom === index && editingRoom && (\r\n                                <div className=\"border-t dark:border-gray-700\">\r\n                                    <RoomEditor\r\n                                        room={editingRoom}\r\n                                        setRoom={setEditingRoom}\r\n                                        onSave={handleSaveRoom}\r\n                                        onCancel={handleCancelEdit}\r\n                                        saving={saving}\r\n                                        isNew={false}\r\n                                        roomAmenities={ROOM_AMENITIES}\r\n                                        user={user}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Collapsed Preview */}\r\n                            {expandedRoom === index && !editingRoom && (\r\n                                <div className=\"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#1f2128]\">\r\n                                    {room.description && (\r\n                                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3\">{room.description}</p>\r\n                                    )}\r\n                                    {room.equipment && (\r\n                                        <div className=\"flex flex-wrap gap-2\">\r\n                                            {Array.isArray(room.equipment) \r\n                                                ? room.equipment.map((item, i) => (\r\n                                                    <span key={i} className=\"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded\">\r\n                                                        {item.brand && `${item.brand} `}{item.name || item.model}\r\n                                                        {(item.quantity && item.quantity > 1) && ` (${item.quantity})`}\r\n                                                    </span>\r\n                                                ))\r\n                                                : room.equipment.split(',').map((item, i) => (\r\n                                                    <span key={i} className=\"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded\">\r\n                                                        {item.trim()}\r\n                                                    </span>\r\n                                                ))\r\n                                            }\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * RoomEditor - Form for editing room details\r\n */\r\nfunction RoomEditor({ room, setRoom, onSave, onCancel, saving, isNew, roomAmenities, user }) {\r\n    const { uploadImage, uploading } = useImageUpload();\r\n    const [show360Viewer, setShow360Viewer] = useState(false);\r\n    const fileInputRef = useRef(null);\r\n\r\n    const handleAmenityToggle = (amenity) => {\r\n        const current = room.amenities || [];\r\n        if (current.includes(amenity)) {\r\n            setRoom({ ...room, amenities: current.filter(a => a !== amenity) });\r\n        } else {\r\n            setRoom({ ...room, amenities: [...current, amenity] });\r\n        }\r\n    };\r\n\r\n    const handle360ImageUpload = async (e) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        // Validate file type (equirectangular 360 images)\r\n        const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n        if (!validTypes.includes(file.type)) {\r\n            toast.error('Please upload a JPEG or PNG image');\r\n            return;\r\n        }\r\n\r\n        // Validate file size (max 20MB for 360 images)\r\n        if (file.size > 20 * 1024 * 1024) {\r\n            toast.error('Image size must be less than 20MB');\r\n            return;\r\n        }\r\n\r\n        const userId = user?.id || user?.uid || 'temp';\r\n        const path = `studio-rooms/${userId}/360-images`;\r\n        \r\n        const toastId = toast.loading('Uploading 360 image...');\r\n        \r\n        try {\r\n            const url = await uploadImage(file, path);\r\n            if (url) {\r\n                setRoom({ ...room, panorama360Url: url });\r\n                toast.success('360 image uploaded successfully!', { id: toastId });\r\n            } else {\r\n                toast.error('Upload failed', { id: toastId });\r\n            }\r\n        } catch (error) {\r\n            console.error('360 image upload error:', error);\r\n            toast.error('Failed to upload image', { id: toastId });\r\n        }\r\n    };\r\n\r\n    const handleRemove360Image = () => {\r\n        setRoom({ ...room, panorama360Url: null });\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-6 bg-gray-50 dark:bg-[#1f2128] space-y-5\">\r\n            {isNew && (\r\n                <h3 className=\"font-bold dark:text-white text-lg mb-4\">Add New Room</h3>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Room Name *</label>\r\n                    <input\r\n                        className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                        value={room.name}\r\n                        onChange={e => setRoom({ ...room, name: e.target.value })}\r\n                        placeholder=\"e.g. Studio A\"\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Room Color</label>\r\n                    <div className=\"flex gap-2\">\r\n                        <input\r\n                            type=\"color\"\r\n                            className=\"w-12 h-12 rounded-lg border dark:border-gray-600 cursor-pointer\"\r\n                            value={room.color || '#3B82F6'}\r\n                            onChange={e => setRoom({ ...room, color: e.target.value })}\r\n                        />\r\n                        <input\r\n                            className=\"flex-1 p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white\"\r\n                            value={room.color || '#3B82F6'}\r\n                            onChange={e => setRoom({ ...room, color: e.target.value })}\r\n                            placeholder=\"#3B82F6\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Description</label>\r\n                <textarea\r\n                    className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                    rows={2}\r\n                    value={room.description || ''}\r\n                    onChange={e => setRoom({ ...room, description: e.target.value })}\r\n                    placeholder=\"Describe this room, its vibe, and what makes it special...\"\r\n                />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Hourly Rate ($)</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                        value={room.rate}\r\n                        onChange={e => setRoom({ ...room, rate: parseInt(e.target.value) || 0 })}\r\n                        min={0}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Capacity</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                        value={room.capacity}\r\n                        onChange={e => setRoom({ ...room, capacity: parseInt(e.target.value) || 1 })}\r\n                        min={1}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Min Hours</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                        value={room.minBookingHours || 1}\r\n                        onChange={e => setRoom({ ...room, minBookingHours: parseInt(e.target.value) || 1 })}\r\n                        min={1}\r\n                    />\r\n                </div>\r\n                <div className=\"flex items-end\">\r\n                    <label className=\"flex items-center gap-2 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl cursor-pointer w-full\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            className=\"w-4 h-4 text-brand-blue\"\r\n                            checked={room.active !== false}\r\n                            onChange={e => setRoom({ ...room, active: e.target.checked })}\r\n                        />\r\n                        <span className=\"text-sm font-medium dark:text-white\">Active</span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Equipment</label>\r\n                <RoomEquipmentManager\r\n                    equipment={Array.isArray(room.equipment) ? room.equipment : (room.equipment ? room.equipment.split(',').map(item => ({\r\n                        name: item.trim(),\r\n                        brand: '',\r\n                        model: '',\r\n                        quantity: 1\r\n                    })) : [])}\r\n                    onChange={(equipment) => setRoom({ ...room, equipment })}\r\n                />\r\n            </div>\r\n\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-2 block\">Room Features</label>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    {roomAmenities.map(amenity => (\r\n                        <button\r\n                            key={amenity}\r\n                            type=\"button\"\r\n                            onClick={() => handleAmenityToggle(amenity)}\r\n                            className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all border ${\r\n                                (room.amenities || []).includes(amenity)\r\n                                    ? 'bg-brand-blue text-white border-brand-blue'\r\n                                    : 'bg-white dark:bg-[#2c2e36] text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-brand-blue'\r\n                            }`}\r\n                        >\r\n                            {amenity}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* 360 Image Section */}\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-2 block\">360 Panorama Image</label>\r\n                <div className=\"space-y-3\">\r\n                    {room.panorama360Url ? (\r\n                        <div className=\"relative\">\r\n                            <Panorama360Viewer \r\n                                imageUrl={room.panorama360Url} \r\n                                title={room.name || 'Room View'}\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleRemove360Image}\r\n                                className=\"absolute top-3 right-3 p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg shadow-lg transition z-20\"\r\n                                title=\"Remove 360 image\"\r\n                            >\r\n                                <X size={18} />\r\n                            </button>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"border-2 border-dashed dark:border-gray-600 rounded-xl p-8 text-center bg-white dark:bg-[#2c2e36]\">\r\n                            <ImageIcon size={48} className=\"mx-auto mb-3 text-gray-400\" />\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\r\n                                Upload a 360 equirectangular panorama image\r\n                            </p>\r\n                            <input\r\n                                ref={fileInputRef}\r\n                                type=\"file\"\r\n                                accept=\"image/jpeg,image/jpg,image/png\"\r\n                                onChange={handle360ImageUpload}\r\n                                className=\"hidden\"\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                disabled={uploading}\r\n                                className=\"px-4 py-2 bg-brand-blue text-white rounded-lg font-medium hover:bg-blue-600 transition flex items-center gap-2 mx-auto disabled:opacity-50\"\r\n                            >\r\n                                {uploading ? (\r\n                                    <>\r\n                                        <Loader2 className=\"animate-spin\" size={18} />\r\n                                        Uploading...\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <Upload size={18} />\r\n                                        Upload 360 Image\r\n                                    </>\r\n                                )}\r\n                            </button>\r\n                            <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-2\">\r\n                                Supports JPEG/PNG  Max 20MB  Equirectangular format recommended\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex justify-end gap-3 pt-4 border-t dark:border-gray-700\">\r\n                <button\r\n                    onClick={onCancel}\r\n                    className=\"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl font-medium transition\"\r\n                >\r\n                    Cancel\r\n                </button>\r\n                <button\r\n                    onClick={onSave}\r\n                    disabled={saving}\r\n                    className=\"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                    {isNew ? 'Add Room' : 'Save Changes'}\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * RoomEquipmentManager - Component for managing room equipment with quantity\r\n */\r\nfunction RoomEquipmentManager({ equipment, onChange }) {\r\n    const [selectedItem, setSelectedItem] = useState(null);\r\n    const [quantity, setQuantity] = useState(1);\r\n\r\n    const handleAddEquipment = (item) => {\r\n        if (!item || !item.name) return;\r\n        \r\n        const newEquipment = {\r\n            name: item.name,\r\n            brand: item.brand || '',\r\n            model: item.model || item.name,\r\n            quantity: quantity || 1\r\n        };\r\n        \r\n        onChange([...(equipment || []), newEquipment]);\r\n        setSelectedItem(null);\r\n        setQuantity(1);\r\n    };\r\n\r\n    const handleRemoveEquipment = (index) => {\r\n        const updated = equipment.filter((_, i) => i !== index);\r\n        onChange(updated);\r\n    };\r\n\r\n    const handleUpdateQuantity = (index, newQuantity) => {\r\n        const updated = equipment.map((item, i) => \r\n            i === index ? { ...item, quantity: Math.max(1, parseInt(newQuantity) || 1) } : item\r\n        );\r\n        onChange(updated);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-3\">\r\n            <div className=\"flex gap-2\">\r\n                <div className=\"flex-1\">\r\n                    <EquipmentAutocomplete\r\n                        onSelect={(item) => {\r\n                            setSelectedItem(item);\r\n                            setQuantity(1);\r\n                        }}\r\n                        placeholder=\"Search and add equipment...\"\r\n                    />\r\n                </div>\r\n                {selectedItem && (\r\n                    <>\r\n                        <input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            value={quantity}\r\n                            onChange={(e) => setQuantity(parseInt(e.target.value) || 1)}\r\n                            className=\"w-20 p-2 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white text-sm\"\r\n                            placeholder=\"Qty\"\r\n                        />\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => handleAddEquipment(selectedItem)}\r\n                            className=\"px-4 py-2 bg-brand-blue text-white rounded-xl font-medium hover:bg-blue-600 transition flex items-center gap-1\"\r\n                        >\r\n                            <Plus size={16} /> Add\r\n                        </button>\r\n                    </>\r\n                )}\r\n            </div>\r\n            \r\n            {equipment && equipment.length > 0 && (\r\n                <div className=\"space-y-2\">\r\n                    {equipment.map((item, index) => (\r\n                        <div key={index} className=\"flex items-center gap-2 p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg border dark:border-gray-700\">\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <div className=\"font-medium text-sm dark:text-white\">\r\n                                    {item.brand && <span className=\"text-gray-500\">{item.brand} </span>}\r\n                                    {item.name || item.model}\r\n                                </div>\r\n                            </div>\r\n                            <input\r\n                                type=\"number\"\r\n                                min=\"1\"\r\n                                value={item.quantity || 1}\r\n                                onChange={(e) => handleUpdateQuantity(index, e.target.value)}\r\n                                className=\"w-16 p-1.5 border rounded-lg dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white text-sm text-center\"\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => handleRemoveEquipment(index)}\r\n                                className=\"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                            >\r\n                                <X size={16} />\r\n                            </button>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import { useState, useCallback } from 'react';\r\nimport { \r\n    Image, Upload, Trash2, Star, \r\n    Loader2, X, Plus, Eye, Move\r\n} from 'lucide-react';\r\nimport { useMediaUpload } from '../../hooks/useMediaUpload';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * StudioGallery - Photo gallery management for studio\r\n */\r\nexport default function StudioGallery({ user, userData, onUpdate }) {\r\n    const [photos, setPhotos] = useState(userData?.studioPhotos || []);\r\n    const [uploadProgress, setUploadProgress] = useState(0);\r\n    const [selectedPhoto, setSelectedPhoto] = useState(null);\r\n    const [draggingIndex, setDraggingIndex] = useState(null);\r\n    const { uploadMedia, uploading } = useMediaUpload();\r\n    const userId = user?.id || user?.uid;\r\n\r\n    const savePhotos = useCallback(async (updatedPhotos) => {\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/profiles/${userId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ studioPhotos: updatedPhotos })\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(result.error || 'Failed to save');\r\n            }\r\n\r\n            setPhotos(updatedPhotos);\r\n            if (onUpdate) onUpdate({ studioPhotos: updatedPhotos });\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save photos');\r\n            return false;\r\n        }\r\n    }, [userId, onUpdate]);\r\n\r\n    const handleUpload = useCallback(async (files) => {\r\n        if (!files || files.length === 0) return;\r\n        \r\n        const maxPhotos = 12;\r\n        if (photos.length >= maxPhotos) {\r\n            toast.error(`Maximum ${maxPhotos} photos allowed`);\r\n            return;\r\n        }\r\n\r\n        const toastId = toast.loading('Uploading photos...');\r\n        \r\n        const newPhotos = [];\r\n        \r\n        for (const file of Array.from(files).slice(0, maxPhotos - photos.length)) {\r\n            // Validate file\r\n            if (!file.type.startsWith('image/')) {\r\n                toast.error(`${file.name} is not an image`);\r\n                continue;\r\n            }\r\n            if (file.size > 5 * 1024 * 1024) {\r\n                toast.error(`${file.name} is too large (max 5MB)`);\r\n                continue;\r\n            }\r\n\r\n            try {\r\n                const timestamp = Date.now();\r\n                const result = await uploadMedia(file, `studio/gallery/${userId}`);\r\n                \r\n                if (result?.url) {\r\n                    newPhotos.push({\r\n                        id: timestamp.toString(),\r\n                        url: result.url,\r\n                        path: result.storageRef || `studio/gallery/${userId}/${timestamp}_${file.name}`,\r\n                        filename: file.name,\r\n                        caption: '',\r\n                        isCover: photos.length === 0 && newPhotos.length === 0, // First photo is cover\r\n                        uploadedAt: new Date().toISOString()\r\n                    });\r\n                }\r\n            } catch (error) {\r\n                console.error('Upload error:', error);\r\n                toast.error(`Failed to upload ${file.name}`);\r\n            }\r\n        }\r\n\r\n        if (newPhotos.length > 0) {\r\n            const success = await savePhotos([...photos, ...newPhotos]);\r\n            if (success) {\r\n                toast.success(`${newPhotos.length} photo(s) uploaded!`, { id: toastId });\r\n            }\r\n        } else {\r\n            toast.dismiss(toastId);\r\n        }\r\n        \r\n        setUploadProgress(0);\r\n    }, [photos, userId, savePhotos, uploadMedia]);\r\n\r\n    const handleDelete = async (photoIndex) => {\r\n        const photo = photos[photoIndex];\r\n        if (!confirm('Delete this photo?')) return;\r\n        \r\n        const toastId = toast.loading('Deleting...');\r\n        \r\n        try {\r\n            // Note: File deletion from MinIO storage should be handled by backend API\r\n            // For now, we just remove it from the database\r\n            \r\n            // Update photos array\r\n            let updatedPhotos = photos.filter((_, i) => i !== photoIndex);\r\n            \r\n            // If we deleted the cover photo, make the first remaining photo the cover\r\n            if (photo.isCover && updatedPhotos.length > 0) {\r\n                updatedPhotos = updatedPhotos.map((p, i) => ({ ...p, isCover: i === 0 }));\r\n            }\r\n            \r\n            await savePhotos(updatedPhotos);\r\n            toast.success('Photo deleted', { id: toastId });\r\n        } catch (error) {\r\n            console.error('Delete error:', error);\r\n            toast.error('Failed to delete photo', { id: toastId });\r\n        }\r\n    };\r\n\r\n    const handleSetCover = async (photoIndex) => {\r\n        const updatedPhotos = photos.map((p, i) => ({ ...p, isCover: i === photoIndex }));\r\n        await savePhotos(updatedPhotos);\r\n        toast.success('Cover photo updated');\r\n    };\r\n\r\n    // Caption editing can be added as a future enhancement\r\n    // const handleUpdateCaption = async (photoIndex, caption) => { ... }\r\n\r\n    const handleDragStart = (index) => {\r\n        setDraggingIndex(index);\r\n    };\r\n\r\n    const handleDragOver = (e, index) => {\r\n        e.preventDefault();\r\n        if (draggingIndex === null || draggingIndex === index) return;\r\n        \r\n        const reorderedPhotos = [...photos];\r\n        const [draggedPhoto] = reorderedPhotos.splice(draggingIndex, 1);\r\n        reorderedPhotos.splice(index, 0, draggedPhoto);\r\n        \r\n        setPhotos(reorderedPhotos);\r\n        setDraggingIndex(index);\r\n    };\r\n\r\n    const handleDragEnd = async () => {\r\n        if (draggingIndex !== null) {\r\n            await savePhotos(photos);\r\n            setDraggingIndex(null);\r\n        }\r\n    };\r\n\r\n    const handleFileDrop = (e) => {\r\n        e.preventDefault();\r\n        const files = e.dataTransfer?.files;\r\n        if (files) handleUpload(files);\r\n    };\r\n\r\n    const coverPhoto = photos.find(p => p.isCover) || photos[0];\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Image className=\"text-brand-blue\" size={24} />\r\n                        Photo Gallery\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Showcase your studio with up to 12 photos\r\n                    </p>\r\n                </div>\r\n                <span className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                    {photos.length}/12 photos\r\n                </span>\r\n            </div>\r\n\r\n            {/* Cover Photo Preview */}\r\n            {coverPhoto && (\r\n                <div className=\"relative rounded-xl overflow-hidden aspect-video bg-gray-100 dark:bg-gray-800 group\">\r\n                    <img\r\n                        src={coverPhoto.url}\r\n                        alt=\"Cover\"\r\n                        className=\"w-full h-full object-cover\"\r\n                    />\r\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                        <div className=\"absolute bottom-4 left-4 text-white\">\r\n                            <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n                                <Star size={16} className=\"fill-yellow-400 text-yellow-400\" />\r\n                                Cover Photo\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Upload Area */}\r\n            <div\r\n                className={`border-2 border-dashed rounded-xl p-8 text-center transition-all ${\r\n                    uploading \r\n                        ? 'border-brand-blue bg-blue-50 dark:bg-blue-900/20' \r\n                        : 'border-gray-200 dark:border-gray-700 hover:border-brand-blue hover:bg-blue-50/50 dark:hover:bg-blue-900/10'\r\n                }`}\r\n                onDrop={handleFileDrop}\r\n                onDragOver={(e) => e.preventDefault()}\r\n            >\r\n                {uploading ? (\r\n                    <div className=\"space-y-3\">\r\n                        <Loader2 className=\"mx-auto animate-spin text-brand-blue\" size={40} />\r\n                        <div className=\"w-full max-w-xs mx-auto bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                            <div \r\n                                className=\"bg-brand-blue h-2 rounded-full transition-all duration-300\"\r\n                                style={{ width: `${uploadProgress}%` }}\r\n                            />\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500\">Uploading... {Math.round(uploadProgress)}%</p>\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        <Upload className=\"mx-auto text-gray-400 mb-3\" size={40} />\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mb-2\">\r\n                            Drag & drop images here, or\r\n                        </p>\r\n                        <label className=\"cursor-pointer\">\r\n                            <span className=\"text-brand-blue font-bold hover:underline\">browse files</span>\r\n                            <input\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                multiple\r\n                                className=\"hidden\"\r\n                                onChange={(e) => handleUpload(e.target.files)}\r\n                                disabled={uploading}\r\n                            />\r\n                        </label>\r\n                        <p className=\"text-xs text-gray-400 mt-2\">\r\n                            JPG, PNG or WebP. Max 5MB per file.\r\n                        </p>\r\n                    </>\r\n                )}\r\n            </div>\r\n\r\n            {/* Photo Grid */}\r\n            {photos.length > 0 && (\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n                    {photos.map((photo, index) => (\r\n                        <div\r\n                            key={photo.id}\r\n                            draggable\r\n                            onDragStart={() => handleDragStart(index)}\r\n                            onDragOver={(e) => handleDragOver(e, index)}\r\n                            onDragEnd={handleDragEnd}\r\n                            className={`relative aspect-square rounded-xl overflow-hidden group bg-gray-100 dark:bg-gray-800 cursor-move ${\r\n                                draggingIndex === index ? 'opacity-50 ring-2 ring-brand-blue' : ''\r\n                            }`}\r\n                        >\r\n                            <img\r\n                                src={photo.url}\r\n                                alt={photo.caption || `Studio photo ${index + 1}`}\r\n                                className=\"w-full h-full object-cover\"\r\n                            />\r\n                            \r\n                            {/* Cover badge */}\r\n                            {photo.isCover && (\r\n                                <div className=\"absolute top-2 left-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-lg flex items-center gap-1\">\r\n                                    <Star size={12} className=\"fill-white\" /> Cover\r\n                                </div>\r\n                            )}\r\n                            \r\n                            {/* Hover overlay */}\r\n                            <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2\">\r\n                                <button\r\n                                    onClick={() => setSelectedPhoto(photo)}\r\n                                    className=\"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition\"\r\n                                    title=\"View\"\r\n                                >\r\n                                    <Eye size={18} />\r\n                                </button>\r\n                                {!photo.isCover && (\r\n                                    <button\r\n                                        onClick={() => handleSetCover(index)}\r\n                                        className=\"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition\"\r\n                                        title=\"Set as cover\"\r\n                                    >\r\n                                        <Star size={18} />\r\n                                    </button>\r\n                                )}\r\n                                <button\r\n                                    onClick={() => handleDelete(index)}\r\n                                    className=\"p-2 bg-red-500/80 hover:bg-red-500 rounded-lg text-white transition\"\r\n                                    title=\"Delete\"\r\n                                >\r\n                                    <Trash2 size={18} />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Drag handle */}\r\n                            <div className=\"absolute top-2 right-2 p-1 bg-black/40 rounded text-white opacity-0 group-hover:opacity-100 transition\">\r\n                                <Move size={14} />\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n\r\n                    {/* Add more button */}\r\n                    {photos.length < 12 && (\r\n                        <label className=\"aspect-square rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700 hover:border-brand-blue transition cursor-pointer flex flex-col items-center justify-center text-gray-400 hover:text-brand-blue\">\r\n                            <Plus size={32} />\r\n                            <span className=\"text-xs mt-1\">Add Photo</span>\r\n                            <input\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                multiple\r\n                                className=\"hidden\"\r\n                                onChange={(e) => handleUpload(e.target.files)}\r\n                                disabled={uploading}\r\n                            />\r\n                        </label>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Empty state */}\r\n            {photos.length === 0 && !uploading && (\r\n                <div className=\"text-center py-8 text-gray-400\">\r\n                    <Image size={48} className=\"mx-auto mb-3 opacity-30\" />\r\n                    <p>No photos uploaded yet</p>\r\n                    <p className=\"text-sm\">Add photos to attract more clients</p>\r\n                </div>\r\n            )}\r\n\r\n            {/* Photo Lightbox */}\r\n            {selectedPhoto && (\r\n                <div \r\n                    className=\"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4\"\r\n                    onClick={() => setSelectedPhoto(null)}\r\n                >\r\n                    <button \r\n                        className=\"absolute top-4 right-4 text-white hover:text-gray-300 transition\"\r\n                        onClick={() => setSelectedPhoto(null)}\r\n                    >\r\n                        <X size={32} />\r\n                    </button>\r\n                    <img\r\n                        src={selectedPhoto.url}\r\n                        alt={selectedPhoto.caption || 'Studio photo'}\r\n                        className=\"max-w-full max-h-[90vh] object-contain rounded-lg\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                    />\r\n                    {selectedPhoto.caption && (\r\n                        <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black/70 text-white px-6 py-3 rounded-xl\">\r\n                            {selectedPhoto.caption}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import { useState } from 'react';\r\nimport { \r\n    Clock, Calendar, Save, Loader2, Plus, Trash2, \r\n    Moon, Sun, AlertCircle, X, Copy\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst DAYS_OF_WEEK = [\r\n    { id: 'sunday', label: 'Sunday', short: 'Sun' },\r\n    { id: 'monday', label: 'Monday', short: 'Mon' },\r\n    { id: 'tuesday', label: 'Tuesday', short: 'Tue' },\r\n    { id: 'wednesday', label: 'Wednesday', short: 'Wed' },\r\n    { id: 'thursday', label: 'Thursday', short: 'Thu' },\r\n    { id: 'friday', label: 'Friday', short: 'Fri' },\r\n    { id: 'saturday', label: 'Saturday', short: 'Sat' },\r\n];\r\n\r\nconst DEFAULT_HOURS = {\r\n    sunday: { closed: true, open: '10:00', close: '18:00' },\r\n    monday: { closed: false, open: '09:00', close: '22:00' },\r\n    tuesday: { closed: false, open: '09:00', close: '22:00' },\r\n    wednesday: { closed: false, open: '09:00', close: '22:00' },\r\n    thursday: { closed: false, open: '09:00', close: '22:00' },\r\n    friday: { closed: false, open: '09:00', close: '23:00' },\r\n    saturday: { closed: false, open: '10:00', close: '23:00' },\r\n};\r\n\r\n/**\r\n * StudioAvailability - Operating hours and blackout dates management\r\n */\r\nexport default function StudioAvailability({ user, userData, onUpdate }) {\r\n    const [hours, setHours] = useState(userData?.operatingHours || DEFAULT_HOURS);\r\n    const [blackoutDates, setBlackoutDates] = useState(userData?.blackoutDates || []);\r\n    const [saving, setSaving] = useState(false);\r\n    const [newBlackout, setNewBlackout] = useState({ start: '', end: '', reason: '' });\r\n    const [showAddBlackout, setShowAddBlackout] = useState(false);\r\n\r\n    const handleSave = async () => {\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving availability...');\r\n        const userId = userData?.id || user?.id || user?.uid;\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/profiles/${userId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    operatingHours: hours,\r\n                    blackoutDates: blackoutDates\r\n                })\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(result.error || 'Failed to save');\r\n            }\r\n\r\n            toast.success('Availability saved!', { id: toastId });\r\n            if (onUpdate) onUpdate({ operatingHours: hours, blackoutDates });\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save', { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const updateDayHours = (dayId, field, value) => {\r\n        setHours(prev => ({\r\n            ...prev,\r\n            [dayId]: { ...prev[dayId], [field]: value }\r\n        }));\r\n    };\r\n\r\n    const toggleDayClosed = (dayId) => {\r\n        setHours(prev => ({\r\n            ...prev,\r\n            [dayId]: { ...prev[dayId], closed: !prev[dayId]?.closed }\r\n        }));\r\n    };\r\n\r\n    const copyToAllWeekdays = (dayId) => {\r\n        const sourceHours = hours[dayId];\r\n        const weekdays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];\r\n        \r\n        setHours(prev => {\r\n            const newHours = { ...prev };\r\n            weekdays.forEach(day => {\r\n                newHours[day] = { ...sourceHours };\r\n            });\r\n            return newHours;\r\n        });\r\n        toast.success('Copied to all weekdays');\r\n    };\r\n\r\n    const addBlackoutDate = () => {\r\n        if (!newBlackout.start) {\r\n            toast.error('Start date is required');\r\n            return;\r\n        }\r\n        \r\n        const blackout = {\r\n            id: Date.now().toString(),\r\n            start: newBlackout.start,\r\n            end: newBlackout.end || newBlackout.start,\r\n            reason: newBlackout.reason || 'Blocked'\r\n        };\r\n        \r\n        setBlackoutDates([...blackoutDates, blackout]);\r\n        setNewBlackout({ start: '', end: '', reason: '' });\r\n        setShowAddBlackout(false);\r\n    };\r\n\r\n    const removeBlackoutDate = (id) => {\r\n        setBlackoutDates(blackoutDates.filter(b => b.id !== id));\r\n    };\r\n\r\n    const formatTime = (time) => {\r\n        if (!time) return '';\r\n        const [h, m] = time.split(':');\r\n        const hour = parseInt(h);\r\n        const ampm = hour >= 12 ? 'PM' : 'AM';\r\n        const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;\r\n        return `${displayHour}:${m} ${ampm}`;\r\n    };\r\n\r\n    // Calculate total weekly hours\r\n    const totalWeeklyHours = DAYS_OF_WEEK.reduce((total, day) => {\r\n        const dayHours = hours[day.id];\r\n        if (dayHours?.closed) return total;\r\n        \r\n        const [openH, openM] = (dayHours?.open || '09:00').split(':').map(Number);\r\n        const [closeH, closeM] = (dayHours?.close || '17:00').split(':').map(Number);\r\n        const openMinutes = openH * 60 + openM;\r\n        const closeMinutes = closeH * 60 + closeM;\r\n        \r\n        return total + Math.max(0, (closeMinutes - openMinutes) / 60);\r\n    }, 0);\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Clock className=\"text-brand-blue\" size={24} />\r\n                        Availability & Hours\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Set your operating hours and manage blackout dates\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={handleSave}\r\n                    disabled={saving}\r\n                    className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                    Save Changes\r\n                </button>\r\n            </div>\r\n\r\n            {/* Weekly Summary */}\r\n            <div className=\"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h3 className=\"text-lg font-bold mb-1\">Weekly Availability</h3>\r\n                        <p className=\"text-indigo-100\">\r\n                            {DAYS_OF_WEEK.filter(d => !hours[d.id]?.closed).length} days open  {Math.round(totalWeeklyHours)} hours/week\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                        <div className=\"text-4xl font-bold\">{Math.round(totalWeeklyHours)}</div>\r\n                        <div className=\"text-sm text-indigo-100\">hours</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Operating Hours */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Sun size={18} className=\"text-amber-500\" />\r\n                        Operating Hours\r\n                    </h3>\r\n                </div>\r\n                <div className=\"divide-y dark:divide-gray-700\">\r\n                    {DAYS_OF_WEEK.map(day => {\r\n                        const dayHours = hours[day.id] || { closed: false, open: '09:00', close: '17:00' };\r\n                        \r\n                        return (\r\n                            <div \r\n                                key={day.id}\r\n                                className={`p-4 flex items-center gap-4 ${dayHours.closed ? 'bg-gray-50 dark:bg-[#1f2128]' : ''}`}\r\n                            >\r\n                                <div className=\"w-28\">\r\n                                    <span className={`font-medium ${dayHours.closed ? 'text-gray-400' : 'dark:text-white'}`}>\r\n                                        {day.label}\r\n                                    </span>\r\n                                </div>\r\n                                \r\n                                <button\r\n                                    onClick={() => toggleDayClosed(day.id)}\r\n                                    className={`px-3 py-1.5 rounded-lg text-sm font-medium transition ${\r\n                                        dayHours.closed \r\n                                            ? 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400' \r\n                                            : 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                                    }`}\r\n                                >\r\n                                    {dayHours.closed ? 'Closed' : 'Open'}\r\n                                </button>\r\n\r\n                                {!dayHours.closed && (\r\n                                    <>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <input\r\n                                                type=\"time\"\r\n                                                value={dayHours.open || '09:00'}\r\n                                                onChange={(e) => updateDayHours(day.id, 'open', e.target.value)}\r\n                                                className=\"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                            />\r\n                                            <span className=\"text-gray-400\">to</span>\r\n                                            <input\r\n                                                type=\"time\"\r\n                                                value={dayHours.close || '17:00'}\r\n                                                onChange={(e) => updateDayHours(day.id, 'close', e.target.value)}\r\n                                                className=\"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                            />\r\n                                        </div>\r\n                                        \r\n                                        <span className=\"text-sm text-gray-400 hidden md:inline\">\r\n                                            {formatTime(dayHours.open)}  {formatTime(dayHours.close)}\r\n                                        </span>\r\n                                        \r\n                                        <button\r\n                                            onClick={() => copyToAllWeekdays(day.id)}\r\n                                            className=\"ml-auto p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                            title=\"Copy to all weekdays\"\r\n                                        >\r\n                                            <Copy size={16} />\r\n                                        </button>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Blackout Dates */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Moon size={18} className=\"text-indigo-500\" />\r\n                        Blackout Dates\r\n                    </h3>\r\n                    <button\r\n                        onClick={() => setShowAddBlackout(!showAddBlackout)}\r\n                        className=\"text-sm bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition flex items-center gap-1\"\r\n                    >\r\n                        <Plus size={16} /> Add Blackout\r\n                    </button>\r\n                </div>\r\n                \r\n                {/* Add Blackout Form */}\r\n                {showAddBlackout && (\r\n                    <div className=\"p-4 bg-indigo-50 dark:bg-indigo-900/20 border-b dark:border-gray-700\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Start Date *</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={newBlackout.start}\r\n                                    onChange={(e) => setNewBlackout({ ...newBlackout, start: e.target.value })}\r\n                                    className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">End Date</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={newBlackout.end}\r\n                                    onChange={(e) => setNewBlackout({ ...newBlackout, end: e.target.value })}\r\n                                    className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    min={newBlackout.start}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Reason</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={newBlackout.reason}\r\n                                    onChange={(e) => setNewBlackout({ ...newBlackout, reason: e.target.value })}\r\n                                    placeholder=\"e.g. Holiday, Maintenance\"\r\n                                    className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"flex items-end gap-2\">\r\n                                <button\r\n                                    onClick={addBlackoutDate}\r\n                                    className=\"flex-1 p-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition\"\r\n                                >\r\n                                    Add\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setShowAddBlackout(false)}\r\n                                    className=\"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                                >\r\n                                    <X size={20} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Blackout List */}\r\n                <div className=\"p-4\">\r\n                    {blackoutDates.length === 0 ? (\r\n                        <div className=\"text-center py-8 text-gray-400\">\r\n                            <Moon size={32} className=\"mx-auto mb-2 opacity-30\" />\r\n                            <p className=\"text-sm\">No blackout dates scheduled</p>\r\n                            <p className=\"text-xs\">Add dates when your studio is unavailable</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-2\">\r\n                            {blackoutDates.sort((a, b) => new Date(a.start) - new Date(b.start)).map(blackout => (\r\n                                <div \r\n                                    key={blackout.id}\r\n                                    className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"w-10 h-10 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg flex items-center justify-center\">\r\n                                            <Calendar className=\"text-indigo-600 dark:text-indigo-400\" size={18} />\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"font-medium dark:text-white text-sm\">\r\n                                                {new Date(blackout.start).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}\r\n                                                {blackout.end !== blackout.start && (\r\n                                                    <>  {new Date(blackout.end).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</>\r\n                                                )}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-gray-500\">{blackout.reason}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => removeBlackoutDate(blackout.id)}\r\n                                        className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tips */}\r\n            <div className=\"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4\">\r\n                <div className=\"flex gap-3\">\r\n                    <AlertCircle className=\"text-amber-600 flex-shrink-0\" size={20} />\r\n                    <div className=\"text-sm\">\r\n                        <p className=\"font-bold text-amber-800 dark:text-amber-300 mb-1\">Availability Tips</p>\r\n                        <ul className=\"text-amber-700 dark:text-amber-400 space-y-1\">\r\n                            <li> Operating hours determine when clients can book sessions</li>\r\n                            <li> Use blackout dates for holidays, maintenance, or personal time</li>\r\n                            <li> Individual room availability can be set in the Rooms section</li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import { useState } from 'react';\r\nimport { \r\n    FileText, Save, Loader2, DollarSign, Clock, AlertTriangle,\r\n    Shield, ChevronDown, ChevronUp\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * StudioPolicies - Booking rules, pricing policies, and house rules\r\n */\r\nexport default function StudioPolicies({ user, userData, onUpdate }) {\r\n    const [policies, setPolicies] = useState({\r\n        // Booking Rules\r\n        minBookingHours: userData?.policies?.minBookingHours ?? 2,\r\n        maxBookingHours: userData?.policies?.maxBookingHours ?? 12,\r\n        advanceBookingDays: userData?.policies?.advanceBookingDays ?? 14,\r\n        minAdvanceHours: userData?.policies?.minAdvanceHours ?? 24,\r\n        autoApprove: userData?.policies?.autoApprove ?? false,\r\n        \r\n        // Cancellation Policy\r\n        cancellationPolicy: userData?.policies?.cancellationPolicy ?? 'moderate',\r\n        cancellationNoticeHours: userData?.policies?.cancellationNoticeHours ?? 48,\r\n        refundPercentage: userData?.policies?.refundPercentage ?? 50,\r\n        \r\n        // Pricing\r\n        depositRequired: userData?.policies?.depositRequired ?? true,\r\n        depositPercentage: userData?.policies?.depositPercentage ?? 25,\r\n        peakHourMultiplier: userData?.policies?.peakHourMultiplier ?? 1.0,\r\n        peakHoursStart: userData?.policies?.peakHoursStart ?? '',\r\n        peakHoursEnd: userData?.policies?.peakHoursEnd ?? '',\r\n        weekendMultiplier: userData?.policies?.weekendMultiplier ?? 1.0,\r\n        \r\n        // House Rules\r\n        houseRules: userData?.policies?.houseRules ?? '',\r\n        whatToExpect: userData?.policies?.whatToExpect ?? '',\r\n        whatToBring: userData?.policies?.whatToBring ?? '',\r\n        parkingInstructions: userData?.policies?.parkingInstructions ?? '',\r\n        \r\n        // Safety & Legal\r\n        requiresWaiver: userData?.policies?.requiresWaiver ?? false,\r\n        waiverText: userData?.policies?.waiverText ?? '',\r\n        ageRequirement: userData?.policies?.ageRequirement ?? 18,\r\n    });\r\n\r\n    const [saving, setSaving] = useState(false);\r\n    const [expandedSection, setExpandedSection] = useState('booking');\r\n\r\n    const handleSave = async () => {\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving policies...');\r\n        const userId = userData?.id || user?.id || user?.uid;\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/profiles/${userId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ policies })\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(result.error || 'Failed to save');\r\n            }\r\n\r\n            toast.success('Policies saved!', { id: toastId });\r\n            if (onUpdate) onUpdate({ policies });\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save', { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const updatePolicy = (key, value) => {\r\n        setPolicies(prev => ({ ...prev, [key]: value }));\r\n    };\r\n\r\n    const CANCELLATION_POLICIES = [\r\n        { id: 'flexible', label: 'Flexible', description: 'Full refund up to 24 hours before session', color: 'green' },\r\n        { id: 'moderate', label: 'Moderate', description: '50% refund up to 48 hours before session', color: 'amber' },\r\n        { id: 'strict', label: 'Strict', description: 'No refunds within 7 days of session', color: 'red' },\r\n        { id: 'custom', label: 'Custom', description: 'Set your own cancellation terms', color: 'blue' },\r\n    ];\r\n\r\n    const Section = ({ id, title, icon: Icon, children }) => {\r\n        const isExpanded = expandedSection === id;\r\n        return (\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                <button\r\n                    onClick={() => setExpandedSection(isExpanded ? null : id)}\r\n                    className=\"w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-[#23262f] transition\"\r\n                >\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 bg-brand-blue/10 rounded-lg flex items-center justify-center\">\r\n                            <Icon className=\"text-brand-blue\" size={20} />\r\n                        </div>\r\n                        <h3 className=\"font-bold dark:text-white\">{title}</h3>\r\n                    </div>\r\n                    {isExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}\r\n                </button>\r\n                {isExpanded && (\r\n                    <div className=\"p-4 pt-0 border-t dark:border-gray-700\">\r\n                        {children}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <FileText className=\"text-brand-blue\" size={24} />\r\n                        Policies & Rules\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Set booking rules, cancellation policies, and house rules\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={handleSave}\r\n                    disabled={saving}\r\n                    className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                    Save Changes\r\n                </button>\r\n            </div>\r\n\r\n            {/* Booking Rules */}\r\n            <Section id=\"booking\" title=\"Booking Rules\" icon={Clock}>\r\n                <div className=\"space-y-6 pt-4\">\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Min Hours</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.minBookingHours}\r\n                                onChange={(e) => updatePolicy('minBookingHours', parseInt(e.target.value) || 1)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={1}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Max Hours</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.maxBookingHours}\r\n                                onChange={(e) => updatePolicy('maxBookingHours', parseInt(e.target.value) || 12)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={1}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Book Ahead (Days)</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.advanceBookingDays}\r\n                                onChange={(e) => updatePolicy('advanceBookingDays', parseInt(e.target.value) || 7)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={1}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Min Notice (Hrs)</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.minAdvanceHours}\r\n                                onChange={(e) => updatePolicy('minAdvanceHours', parseInt(e.target.value) || 0)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={0}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl flex items-center justify-between\">\r\n                        <div>\r\n                            <div className=\"font-medium dark:text-white\">Auto-Approve Bookings</div>\r\n                            <div className=\"text-sm text-gray-500\">Automatically confirm bookings without manual approval</div>\r\n                        </div>\r\n                        <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                checked={policies.autoApprove}\r\n                                onChange={(e) => updatePolicy('autoApprove', e.target.checked)}\r\n                                className=\"sr-only peer\"\r\n                            />\r\n                            <div className=\"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-brand-blue\"></div>\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n            </Section>\r\n\r\n            {/* Cancellation Policy */}\r\n            <Section id=\"cancellation\" title=\"Cancellation Policy\" icon={AlertTriangle}>\r\n                <div className=\"space-y-4 pt-4\">\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                        {CANCELLATION_POLICIES.map(policy => (\r\n                            <button\r\n                                key={policy.id}\r\n                                onClick={() => updatePolicy('cancellationPolicy', policy.id)}\r\n                                className={`p-4 rounded-xl border-2 text-left transition ${\r\n                                    policies.cancellationPolicy === policy.id\r\n                                        ? `border-${policy.color}-500 bg-${policy.color}-50 dark:bg-${policy.color}-900/20`\r\n                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\r\n                                }`}\r\n                            >\r\n                                <div className={`font-bold mb-1 ${policies.cancellationPolicy === policy.id ? `text-${policy.color}-700 dark:text-${policy.color}-400` : 'dark:text-white'}`}>\r\n                                    {policy.label}\r\n                                </div>\r\n                                <div className=\"text-xs text-gray-500\">{policy.description}</div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {policies.cancellationPolicy === 'custom' && (\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Notice Required (Hours)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={policies.cancellationNoticeHours}\r\n                                    onChange={(e) => updatePolicy('cancellationNoticeHours', parseInt(e.target.value) || 24)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    min={0}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Refund Percentage</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={policies.refundPercentage}\r\n                                    onChange={(e) => updatePolicy('refundPercentage', parseInt(e.target.value) || 0)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    min={0}\r\n                                    max={100}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </Section>\r\n\r\n            {/* Pricing */}\r\n            <Section id=\"pricing\" title=\"Pricing & Deposits\" icon={DollarSign}>\r\n                <div className=\"space-y-6 pt-4\">\r\n                    {/* Deposit */}\r\n                    <div className=\"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <div>\r\n                                <div className=\"font-medium dark:text-white\">Require Deposit</div>\r\n                                <div className=\"text-sm text-gray-500\">Collect partial payment when booking</div>\r\n                            </div>\r\n                            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={policies.depositRequired}\r\n                                    onChange={(e) => updatePolicy('depositRequired', e.target.checked)}\r\n                                    className=\"sr-only peer\"\r\n                                />\r\n                                <div className=\"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue\"></div>\r\n                            </label>\r\n                        </div>\r\n                        {policies.depositRequired && (\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Deposit Percentage</label>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <input\r\n                                        type=\"range\"\r\n                                        value={policies.depositPercentage}\r\n                                        onChange={(e) => updatePolicy('depositPercentage', parseInt(e.target.value))}\r\n                                        className=\"flex-1\"\r\n                                        min={10}\r\n                                        max={100}\r\n                                        step={5}\r\n                                    />\r\n                                    <span className=\"font-bold text-brand-blue w-14 text-right\">{policies.depositPercentage}%</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Peak Pricing */}\r\n                    <div>\r\n                        <div className=\"font-medium dark:text-white mb-3\">Peak Hour Pricing</div>\r\n                        <div className=\"grid grid-cols-3 gap-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Peak Start</label>\r\n                                <input\r\n                                    type=\"time\"\r\n                                    value={policies.peakHoursStart}\r\n                                    onChange={(e) => updatePolicy('peakHoursStart', e.target.value)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Peak End</label>\r\n                                <input\r\n                                    type=\"time\"\r\n                                    value={policies.peakHoursEnd}\r\n                                    onChange={(e) => updatePolicy('peakHoursEnd', e.target.value)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Rate Multiplier</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={policies.peakHourMultiplier}\r\n                                    onChange={(e) => updatePolicy('peakHourMultiplier', parseFloat(e.target.value) || 1)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    min={1}\r\n                                    max={3}\r\n                                    step={0.1}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Weekend Pricing */}\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Weekend Rate Multiplier</label>\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <input\r\n                                type=\"range\"\r\n                                value={policies.weekendMultiplier}\r\n                                onChange={(e) => updatePolicy('weekendMultiplier', parseFloat(e.target.value))}\r\n                                className=\"flex-1\"\r\n                                min={1}\r\n                                max={2}\r\n                                step={0.1}\r\n                            />\r\n                            <span className=\"font-bold dark:text-white w-16 text-right\">{policies.weekendMultiplier}x</span>\r\n                        </div>\r\n                        {policies.weekendMultiplier > 1 && (\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                                Saturday & Sunday bookings will be {Math.round((policies.weekendMultiplier - 1) * 100)}% more\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </Section>\r\n\r\n            {/* House Rules */}\r\n            <Section id=\"rules\" title=\"House Rules & Info\" icon={FileText}>\r\n                <div className=\"space-y-4 pt-4\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Studio Rules</label>\r\n                        <textarea\r\n                            value={policies.houseRules}\r\n                            onChange={(e) => updatePolicy('houseRules', e.target.value)}\r\n                            className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                            rows={4}\r\n                            placeholder=\" No smoking inside the studio&#10; Please arrive 10 minutes early&#10; Clean up after your session\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">What to Expect</label>\r\n                        <textarea\r\n                            value={policies.whatToExpect}\r\n                            onChange={(e) => updatePolicy('whatToExpect', e.target.value)}\r\n                            className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                            rows={3}\r\n                            placeholder=\"Describe what clients can expect when they arrive...\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">What to Bring</label>\r\n                            <textarea\r\n                                value={policies.whatToBring}\r\n                                onChange={(e) => updatePolicy('whatToBring', e.target.value)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                rows={3}\r\n                                placeholder=\" Instrument cables&#10; Lyrics/charts&#10; Reference tracks\"\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Parking Instructions</label>\r\n                            <textarea\r\n                                value={policies.parkingInstructions}\r\n                                onChange={(e) => updatePolicy('parkingInstructions', e.target.value)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                rows={3}\r\n                                placeholder=\"Describe parking situation and directions...\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </Section>\r\n\r\n            {/* Legal */}\r\n            <Section id=\"legal\" title=\"Legal & Safety\" icon={Shield}>\r\n                <div className=\"space-y-4 pt-4\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Minimum Age Requirement</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.ageRequirement}\r\n                                onChange={(e) => updatePolicy('ageRequirement', parseInt(e.target.value) || 0)}\r\n                                className=\"w-32 p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={0}\r\n                            />\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500 mt-6\">\r\n                            {policies.ageRequirement > 0 \r\n                                ? `Clients must be ${policies.ageRequirement}+ to book`\r\n                                : 'No age restriction'}\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <div>\r\n                                <div className=\"font-medium dark:text-white\">Require Liability Waiver</div>\r\n                                <div className=\"text-sm text-gray-500\">Clients must sign a waiver before booking</div>\r\n                            </div>\r\n                            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={policies.requiresWaiver}\r\n                                    onChange={(e) => updatePolicy('requiresWaiver', e.target.checked)}\r\n                                    className=\"sr-only peer\"\r\n                                />\r\n                                <div className=\"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue\"></div>\r\n                            </label>\r\n                        </div>\r\n                        {policies.requiresWaiver && (\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Waiver Text</label>\r\n                                <textarea\r\n                                    value={policies.waiverText}\r\n                                    onChange={(e) => updatePolicy('waiverText', e.target.value)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white font-mono text-sm\"\r\n                                    rows={6}\r\n                                    placeholder=\"Enter your liability waiver text...\"\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </Section>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Calendar, Repeat, X, Save } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport { query as neonQuery } from '../../config/neon.js';\r\n\r\n/**\r\n * RecurringBookingModal - Create recurring bookings\r\n */\r\nexport default function RecurringBookingModal({ booking, onClose, onSuccess }) {\r\n    const [recurrenceType, setRecurrenceType] = useState('weekly');\r\n    const [interval, setInterval] = useState(1); // Every X weeks/days/months\r\n    const [daysOfWeek, setDaysOfWeek] = useState([]); // For weekly: [1,3,5] = Mon, Wed, Fri\r\n    const [endDate, setEndDate] = useState('');\r\n    const [maxOccurrences, setMaxOccurrences] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleDayToggle = (day) => {\r\n        setDaysOfWeek(prev => \r\n            prev.includes(day) \r\n                ? prev.filter(d => d !== day)\r\n                : [...prev, day].sort()\r\n        );\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!booking) return;\r\n\r\n        setLoading(true);\r\n        const toastId = toast.loading('Creating recurring bookings...');\r\n\r\n        try {\r\n            const bookingDate = new Date(booking.date);\r\n            if (isNaN(bookingDate.getTime())) {\r\n                throw new Error('Invalid booking date');\r\n            }\r\n\r\n            // Calculate next occurrence\r\n            let nextOccurrence = new Date(bookingDate);\r\n            if (recurrenceType === 'weekly' && daysOfWeek.length > 0) {\r\n                // Find next matching day of week\r\n                const currentDay = bookingDate.getDay();\r\n                const nextDay = daysOfWeek.find(d => d > currentDay) || daysOfWeek[0];\r\n                const daysToAdd = nextDay - currentDay + (nextDay < currentDay ? 7 : 0);\r\n                nextOccurrence = new Date(bookingDate.getTime() + (daysToAdd * 24 * 60 * 60 * 1000));\r\n            } else if (recurrenceType === 'daily') {\r\n                nextOccurrence = new Date(bookingDate.getTime() + (interval * 24 * 60 * 60 * 1000));\r\n            } else if (recurrenceType === 'monthly') {\r\n                nextOccurrence = new Date(bookingDate);\r\n                nextOccurrence.setMonth(nextOccurrence.getMonth() + interval);\r\n            }\r\n\r\n            const recurrencePattern = {\r\n                type: recurrenceType,\r\n                interval,\r\n                daysOfWeek: recurrenceType === 'weekly' ? daysOfWeek : null,\r\n            };\r\n\r\n            // Create recurring booking record using Neon\r\n            const result = await neonQuery(`\r\n                INSERT INTO recurring_bookings (\r\n                    parent_booking_id, studio_id, sender_id,\r\n                    recurrence_type, recurrence_pattern,\r\n                    start_date, end_date, next_occurrence,\r\n                    max_occurrences, is_active\r\n                ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)\r\n                RETURNING *\r\n            `, [\r\n                booking.id,\r\n                booking.studio_owner_id || booking.target_id,\r\n                booking.sender_id,\r\n                recurrenceType,\r\n                JSON.stringify(recurrencePattern),\r\n                bookingDate.toISOString().split('T')[0],\r\n                endDate || null,\r\n                nextOccurrence.toISOString().split('T')[0],\r\n                maxOccurrences ? parseInt(maxOccurrences) : null,\r\n                true\r\n            ]);\r\n\r\n            if (!result || result.length === 0) {\r\n                throw new Error('Failed to create recurring booking');\r\n            }\r\n\r\n            toast.success('Recurring booking created!', { id: toastId });\r\n            onSuccess?.();\r\n            onClose();\r\n        } catch (error) {\r\n            console.error('Error creating recurring booking:', error);\r\n            toast.error('Failed to create recurring booking: ' + error.message, { id: toastId });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-md w-full\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Repeat size={18} className=\"text-brand-blue\" />\r\n                        Create Recurring Booking\r\n                    </h3>\r\n                    <button onClick={onClose}>\r\n                        <X size={20} className=\"text-gray-500\" />\r\n                    </button>\r\n                </div>\r\n                <form onSubmit={handleSubmit} className=\"p-4 space-y-4\">\r\n                    {/* Recurrence Type */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">Repeat</label>\r\n                        <select\r\n                            value={recurrenceType}\r\n                            onChange={(e) => setRecurrenceType(e.target.value)}\r\n                            className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                        >\r\n                            <option value=\"daily\">Daily</option>\r\n                            <option value=\"weekly\">Weekly</option>\r\n                            <option value=\"monthly\">Monthly</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    {/* Interval */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">\r\n                            Every {recurrenceType === 'daily' ? 'X days' : recurrenceType === 'weekly' ? 'X weeks' : 'X months'}\r\n                        </label>\r\n                        <input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            value={interval}\r\n                            onChange={(e) => setInterval(parseInt(e.target.value) || 1)}\r\n                            className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Days of Week (for weekly) */}\r\n                    {recurrenceType === 'weekly' && (\r\n                        <div>\r\n                            <label className=\"text-sm font-bold dark:text-white mb-2 block\">Days of Week</label>\r\n                            <div className=\"grid grid-cols-7 gap-2\">\r\n                                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day, index) => (\r\n                                    <button\r\n                                        key={index}\r\n                                        type=\"button\"\r\n                                        onClick={() => handleDayToggle(index)}\r\n                                        className={`p-2 rounded-lg text-sm font-medium transition ${\r\n                                            daysOfWeek.includes(index)\r\n                                                ? 'bg-brand-blue text-white'\r\n                                                : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                        }`}\r\n                                    >\r\n                                        {day}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* End Date */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">End Date (optional)</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            value={endDate}\r\n                            onChange={(e) => setEndDate(e.target.value)}\r\n                            className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Max Occurrences */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">Max Occurrences (optional)</label>\r\n                        <input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            value={maxOccurrences}\r\n                            onChange={(e) => setMaxOccurrences(e.target.value)}\r\n                            placeholder=\"Unlimited if empty\"\r\n                            className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex gap-3 pt-2\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading || (recurrenceType === 'weekly' && daysOfWeek.length === 0)}\r\n                            className=\"flex-1 py-2.5 bg-brand-blue text-white rounded-lg font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                        >\r\n                            <Save size={16} />\r\n                            Create Recurring\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Home, Plus, X, Save } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport { query as neonQuery } from '../../config/neon.js';\r\n\r\n/**\r\n * MultiRoomBookingModal - Assign booking to multiple rooms\r\n */\r\nexport default function MultiRoomBookingModal({ booking, rooms, onClose, onSuccess }) {\r\n    const [selectedRooms, setSelectedRooms] = useState([]);\r\n    const [roomTimeSlots, setRoomTimeSlots] = useState({}); // { roomId: { start, end } }\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // Initialize with booking's time if available\r\n        if (booking?.booking_start && booking?.duration) {\r\n            const start = new Date(booking.booking_start);\r\n            const end = new Date(start.getTime() + (booking.duration * 60 * 60 * 1000));\r\n            \r\n            const initialSlots = {};\r\n            selectedRooms.forEach(roomId => {\r\n                initialSlots[roomId] = {\r\n                    start: start.toISOString().slice(0, 16), // YYYY-MM-DDTHH:mm format\r\n                    end: end.toISOString().slice(0, 16)\r\n                };\r\n            });\r\n            setRoomTimeSlots(initialSlots);\r\n        }\r\n    }, [selectedRooms, booking]);\r\n\r\n    const handleRoomToggle = (roomId) => {\r\n        setSelectedRooms(prev => \r\n            prev.includes(roomId)\r\n                ? prev.filter(id => id !== roomId)\r\n                : [...prev, roomId]\r\n        );\r\n    };\r\n\r\n    const handleTimeChange = (roomId, field, value) => {\r\n        setRoomTimeSlots(prev => ({\r\n            ...prev,\r\n            [roomId]: {\r\n                ...prev[roomId],\r\n                [field]: value\r\n            }\r\n        }));\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!booking || selectedRooms.length === 0) return;\r\n\r\n        setLoading(true);\r\n        const toastId = toast.loading('Assigning rooms...');\r\n\r\n        try {\r\n            // Create room booking records\r\n            const roomBookings = selectedRooms.map(roomId => {\r\n                const slot = roomTimeSlots[roomId];\r\n                const startTime = slot?.start ? new Date(slot.start) : new Date(booking.booking_start || booking.date);\r\n                const endTime = slot?.end ? new Date(slot.end) : new Date(startTime.getTime() + (booking.duration * 60 * 60 * 1000));\r\n\r\n                const room = rooms.find(r => r.id === roomId);\r\n                return {\r\n                    booking_id: booking.id,\r\n                    room_id: roomId,\r\n                    room_name: room?.name || `Room ${roomId}`,\r\n                    start_time: startTime.toISOString(),\r\n                    end_time: endTime.toISOString()\r\n                };\r\n            });\r\n\r\n            // Insert room bookings using Neon\r\n            await Promise.all(\r\n                roomBookings.map(rb =>\r\n                    neonQuery(`\r\n                        INSERT INTO room_bookings (\r\n                            booking_id, room_id, room_name, start_time, end_time\r\n                        ) VALUES ($1, $2, $3, $4, $5)\r\n                    `, [\r\n                        rb.booking_id,\r\n                        rb.room_id,\r\n                        rb.room_name,\r\n                        rb.start_time,\r\n                        rb.end_time\r\n                    ])\r\n                )\r\n            );\r\n\r\n            toast.success(`${selectedRooms.length} room(s) assigned!`, { id: toastId });\r\n            onSuccess?.();\r\n            onClose();\r\n        } catch (error) {\r\n            console.error('Error assigning rooms:', error);\r\n            toast.error('Failed to assign rooms: ' + error.message, { id: toastId });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Home size={18} className=\"text-brand-blue\" />\r\n                        Assign Rooms\r\n                    </h3>\r\n                    <button onClick={onClose}>\r\n                        <X size={20} className=\"text-gray-500\" />\r\n                    </button>\r\n                </div>\r\n                <form onSubmit={handleSubmit} className=\"p-4 space-y-4\">\r\n                    {/* Room Selection */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">Select Rooms</label>\r\n                        <div className=\"space-y-2 max-h-48 overflow-y-auto\">\r\n                            {rooms.map(room => (\r\n                                <div\r\n                                    key={room.id}\r\n                                    className={`p-3 border rounded-lg cursor-pointer transition ${\r\n                                        selectedRooms.includes(room.id)\r\n                                            ? 'border-brand-blue bg-blue-50 dark:bg-blue-900/20'\r\n                                            : 'border-gray-200 dark:border-gray-600 hover:border-gray-300'\r\n                                    }`}\r\n                                    onClick={() => handleRoomToggle(room.id)}\r\n                                >\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div>\r\n                                            <div className=\"font-medium dark:text-white\">{room.name}</div>\r\n                                            <div className=\"text-xs text-gray-500\">\r\n                                                ${room.rate}/hr  {room.capacity} people\r\n                                            </div>\r\n                                        </div>\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={selectedRooms.includes(room.id)}\r\n                                            onChange={() => handleRoomToggle(room.id)}\r\n                                            className=\"w-4 h-4 text-brand-blue\"\r\n                                        />\r\n                                    </div>\r\n                                    \r\n                                    {/* Time Slot (if selected) */}\r\n                                    {selectedRooms.includes(room.id) && (\r\n                                        <div className=\"mt-3 pt-3 border-t dark:border-gray-600 grid grid-cols-2 gap-2\">\r\n                                            <div>\r\n                                                <label className=\"text-xs text-gray-500 mb-1 block\">Start</label>\r\n                                                <input\r\n                                                    type=\"datetime-local\"\r\n                                                    value={roomTimeSlots[room.id]?.start || ''}\r\n                                                    onChange={(e) => handleTimeChange(room.id, 'start', e.target.value)}\r\n                                                    className=\"w-full p-1.5 text-sm border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"text-xs text-gray-500 mb-1 block\">End</label>\r\n                                                <input\r\n                                                    type=\"datetime-local\"\r\n                                                    value={roomTimeSlots[room.id]?.end || ''}\r\n                                                    onChange={(e) => handleTimeChange(room.id, 'end', e.target.value)}\r\n                                                    className=\"w-full p-1.5 text-sm border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex gap-3 pt-2\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading || selectedRooms.length === 0}\r\n                            className=\"flex-1 py-2.5 bg-brand-blue text-white rounded-lg font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                        >\r\n                            <Save size={16} />\r\n                            Assign {selectedRooms.length > 0 ? `(${selectedRooms.length})` : ''}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useMemo } from 'react';\r\nimport { \r\n    ChevronLeft, ChevronRight, Calendar as CalendarIcon,\r\n    Ban, Clock, MapPin\r\n} from 'lucide-react';\r\n\r\n/**\r\n * UnifiedCalendar - A single calendar component with day/week/month views\r\n * Based on Studio Manager calendar design\r\n * \r\n * @param {Object} props\r\n * @param {Date} props.currentDate - Current date to display\r\n * @param {Function} props.onDateChange - Callback when date changes\r\n * @param {Array} props.bookings - Array of booking objects with date, status, etc.\r\n * @param {Array} props.blockedDates - Array of blocked date objects\r\n * @param {Function} props.onDateClick - Callback when a date is clicked\r\n * @param {Function} props.onBookingClick - Callback when a booking is clicked\r\n * @param {string} props.view - 'month' | 'week' | 'day'\r\n * @param {Function} props.onViewChange - Callback when view changes\r\n * @param {boolean} props.showControls - Show view toggle and navigation (default: true)\r\n * @param {string} props.className - Additional CSS classes\r\n */\r\nexport default function UnifiedCalendar({\r\n    currentDate = new Date(),\r\n    onDateChange,\r\n    bookings = [],\r\n    blockedDates = [],\r\n    onDateClick,\r\n    onBookingClick,\r\n    view = 'month',\r\n    onViewChange,\r\n    showControls = true,\r\n    className = ''\r\n}) {\r\n    const [localDate, setLocalDate] = useState(currentDate);\r\n    const [localView, setLocalView] = useState(view);\r\n\r\n    // Use local state if no controlled props\r\n    const displayDate = currentDate || localDate;\r\n    const displayView = view || localView;\r\n\r\n    const handleDateChange = (newDate) => {\r\n        setLocalDate(newDate);\r\n        if (onDateChange) onDateChange(newDate);\r\n    };\r\n\r\n    const handleViewChange = (newView) => {\r\n        setLocalView(newView);\r\n        if (onViewChange) onViewChange(newView);\r\n    };\r\n\r\n    // Navigation\r\n    const navigateDate = (direction) => {\r\n        const newDate = new Date(displayDate);\r\n        \r\n        if (displayView === 'month') {\r\n            newDate.setMonth(newDate.getMonth() + direction);\r\n        } else if (displayView === 'week') {\r\n            newDate.setDate(newDate.getDate() + (direction * 7));\r\n        } else if (displayView === 'day') {\r\n            newDate.setDate(newDate.getDate() + direction);\r\n        }\r\n        \r\n        handleDateChange(newDate);\r\n    };\r\n\r\n    const goToToday = () => {\r\n        handleDateChange(new Date());\r\n    };\r\n\r\n    // Get week start (Sunday)\r\n    const getWeekStart = (date) => {\r\n        const d = new Date(date);\r\n        const day = d.getDay();\r\n        const diff = d.getDate() - day;\r\n        return new Date(d.setDate(diff));\r\n    };\r\n\r\n    // Get week dates\r\n    const getWeekDates = (date) => {\r\n        const weekStart = getWeekStart(date);\r\n        const week = [];\r\n        for (let i = 0; i < 7; i++) {\r\n            const day = new Date(weekStart);\r\n            day.setDate(weekStart.getDate() + i);\r\n            week.push(day);\r\n        }\r\n        return week;\r\n    };\r\n\r\n    // Get bookings for a specific date\r\n    const getDayBookings = (date) => {\r\n        if (!date) return [];\r\n        return bookings.filter(b => {\r\n            if (!b.date) return false;\r\n            const bookingDate = b.date instanceof Date ? b.date : new Date(b.date);\r\n            if (isNaN(bookingDate.getTime())) return false;\r\n            return bookingDate.toDateString() === date.toDateString();\r\n        });\r\n    };\r\n\r\n    // Get blocks for a specific date\r\n    const getDayBlocks = (date) => {\r\n        if (!date) return [];\r\n        return blockedDates.filter(b => {\r\n            if (!b.date) return false;\r\n            const blockDate = b.date instanceof Date ? b.date : new Date(b.date);\r\n            if (isNaN(blockDate.getTime())) return false;\r\n            return blockDate.toDateString() === date.toDateString();\r\n        });\r\n    };\r\n\r\n    // Format date for display\r\n    const formatDateRange = () => {\r\n        if (displayView === 'month') {\r\n            return displayDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });\r\n        } else if (displayView === 'week') {\r\n            const week = getWeekDates(displayDate);\r\n            const start = week[0];\r\n            const end = week[6];\r\n            if (start.getMonth() === end.getMonth()) {\r\n                return `${start.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })} - ${end.toLocaleDateString('en-US', { day: 'numeric', year: 'numeric' })}`;\r\n            } else {\r\n                return `${start.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${end.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;\r\n            }\r\n        } else {\r\n            return displayDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={`bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden ${className}`}>\r\n            {/* Header Controls */}\r\n            {showControls && (\r\n                <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        {/* View Toggle */}\r\n                        <div className=\"flex bg-gray-200 dark:bg-gray-700 rounded-lg p-1\">\r\n                            {['month', 'week', 'day'].map(v => (\r\n                                <button\r\n                                    key={v}\r\n                                    onClick={() => handleViewChange(v)}\r\n                                    className={`px-3 py-1.5 rounded-md text-sm font-medium transition capitalize ${\r\n                                        displayView === v\r\n                                            ? 'bg-white dark:bg-gray-600 shadow text-brand-blue dark:text-white'\r\n                                            : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'\r\n                                    }`}\r\n                                >\r\n                                    {v}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Date Navigation */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                                onClick={() => navigateDate(-1)}\r\n                                className=\"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition\"\r\n                            >\r\n                                <ChevronLeft size={20} className=\"text-gray-600 dark:text-gray-300\" />\r\n                            </button>\r\n                            <button\r\n                                onClick={goToToday}\r\n                                className=\"px-3 py-1.5 text-sm font-medium text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                            >\r\n                                Today\r\n                            </button>\r\n                            <button\r\n                                onClick={() => navigateDate(1)}\r\n                                className=\"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition\"\r\n                            >\r\n                                <ChevronRight size={20} className=\"text-gray-600 dark:text-gray-300\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Date Range Display */}\r\n                    <div className=\"text-center\">\r\n                        <h3 className=\"font-bold dark:text-white text-lg\">\r\n                            {formatDateRange()}\r\n                        </h3>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Calendar Content */}\r\n            <div className=\"p-4\">\r\n                {displayView === 'month' && (\r\n                    <MonthView\r\n                        date={displayDate}\r\n                        bookings={bookings}\r\n                        blockedDates={blockedDates}\r\n                        onDateClick={onDateClick}\r\n                        onBookingClick={onBookingClick}\r\n                        getDayBookings={getDayBookings}\r\n                        getDayBlocks={getDayBlocks}\r\n                    />\r\n                )}\r\n\r\n                {displayView === 'week' && (\r\n                    <WeekView\r\n                        date={displayDate}\r\n                        bookings={bookings}\r\n                        blockedDates={blockedDates}\r\n                        onDateClick={onDateClick}\r\n                        onBookingClick={onBookingClick}\r\n                        getDayBookings={getDayBookings}\r\n                        getDayBlocks={getDayBlocks}\r\n                        getWeekDates={getWeekDates}\r\n                    />\r\n                )}\r\n\r\n                {displayView === 'day' && (\r\n                    <DayView\r\n                        date={displayDate}\r\n                        bookings={bookings}\r\n                        blockedDates={blockedDates}\r\n                        onDateClick={onDateClick}\r\n                        onBookingClick={onBookingClick}\r\n                        getDayBookings={getDayBookings}\r\n                        getDayBlocks={getDayBlocks}\r\n                    />\r\n                )}\r\n            </div>\r\n\r\n            {/* Legend */}\r\n            <div className=\"px-4 pb-4\">\r\n                <div className=\"flex flex-wrap items-center gap-4 pt-4 border-t dark:border-gray-700 text-xs text-gray-500\">\r\n                    <div className=\"flex items-center gap-1\">\r\n                        <span className=\"w-2 h-2 bg-green-500 rounded-full\"></span>\r\n                        Confirmed\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                        <span className=\"w-2 h-2 bg-amber-500 rounded-full\"></span>\r\n                        Pending\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                        <Ban size={12} className=\"text-red-500\" />\r\n                        Blocked\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Month View Component\r\n */\r\nfunction MonthView({ date, bookings, blockedDates, onDateClick, onBookingClick, getDayBookings, getDayBlocks }) {\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const today = new Date();\r\n    const firstDay = new Date(year, month, 1).getDay();\r\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\r\n    \r\n    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\n    \r\n    const days = [];\r\n    for (let i = 0; i < firstDay; i++) {\r\n        days.push(null);\r\n    }\r\n    for (let day = 1; day <= daysInMonth; day++) {\r\n        days.push(day);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {/* Day Headers */}\r\n            <div className=\"grid grid-cols-7 gap-2 mb-2\">\r\n                {dayNames.map(day => (\r\n                    <div key={day} className=\"text-center text-sm font-bold text-gray-500 py-2\">\r\n                        {day}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            \r\n            {/* Calendar Grid */}\r\n            <div className=\"grid grid-cols-7 gap-2\">\r\n                {days.map((day, i) => {\r\n                    if (day === null) {\r\n                        return <div key={`empty-${i}`} className=\"aspect-square\"></div>;\r\n                    }\r\n\r\n                    const dayDate = new Date(year, month, day);\r\n                    const isPast = dayDate < new Date(today.getFullYear(), today.getMonth(), today.getDate());\r\n                    const isToday = dayDate.toDateString() === today.toDateString();\r\n                    const dayBookings = getDayBookings(dayDate);\r\n                    const dayBlocks = getDayBlocks(dayDate);\r\n                    \r\n                    const hasConfirmed = dayBookings.some(b => (b.status || '').toLowerCase() === 'confirmed');\r\n                    const hasPending = dayBookings.some(b => (b.status || '').toLowerCase() === 'pending');\r\n                    const isBlocked = dayBlocks.length > 0;\r\n\r\n                    return (\r\n                        <button\r\n                            key={day}\r\n                            onClick={() => {\r\n                                if (!isPast && onDateClick) onDateClick(dayDate);\r\n                                if (dayBookings.length > 0 && onBookingClick) {\r\n                                    onBookingClick(dayBookings[0], dayDate);\r\n                                }\r\n                            }}\r\n                            disabled={isPast}\r\n                            className={`aspect-square p-1 rounded-xl flex flex-col items-center justify-center relative transition ${\r\n                                isPast ? 'opacity-40 cursor-not-allowed' :\r\n                                isBlocked ? 'bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 hover:bg-red-200 dark:hover:bg-red-900/40' :\r\n                                isToday ? 'bg-brand-blue text-white' :\r\n                                hasConfirmed || hasPending ? 'bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30' :\r\n                                'hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                            }`}\r\n                        >\r\n                            <span className={`text-sm font-medium ${\r\n                                isToday ? 'text-white' : \r\n                                isBlocked ? 'text-red-700 dark:text-red-400' :\r\n                                'dark:text-white'\r\n                            }`}>\r\n                                {day}\r\n                            </span>\r\n                            \r\n                            {/* Indicators */}\r\n                            <div className=\"flex gap-0.5 mt-0.5\">\r\n                                {hasConfirmed && <span className=\"w-1.5 h-1.5 bg-green-500 rounded-full\"></span>}\r\n                                {hasPending && <span className=\"w-1.5 h-1.5 bg-amber-500 rounded-full\"></span>}\r\n                                {isBlocked && <Ban size={10} className=\"text-red-600 dark:text-red-400\" />}\r\n                            </div>\r\n                            \r\n                            {/* Booking count badge */}\r\n                            {dayBookings.length > 0 && !isToday && (\r\n                                <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-brand-blue text-white text-[10px] rounded-full flex items-center justify-center font-bold\">\r\n                                    {dayBookings.length}\r\n                                </span>\r\n                            )}\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\n/**\r\n * Week View Component\r\n */\r\nfunction WeekView({ date, bookings, blockedDates, onDateClick, onBookingClick, getDayBookings, getDayBlocks, getWeekDates }) {\r\n    const weekDates = getWeekDates(date);\r\n    const today = new Date();\r\n    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\n    \r\n    // Time slots for the day (6 AM to 11 PM)\r\n    const timeSlots = [];\r\n    for (let hour = 6; hour <= 23; hour++) {\r\n        timeSlots.push(hour);\r\n    }\r\n\r\n    return (\r\n        <div className=\"overflow-x-auto\">\r\n            <div className=\"min-w-[800px]\">\r\n                {/* Day Headers */}\r\n                <div className=\"grid grid-cols-8 gap-2 mb-2 border-b dark:border-gray-700 pb-2\">\r\n                    <div className=\"text-sm font-bold text-gray-500\">Time</div>\r\n                    {weekDates.map((dayDate, i) => {\r\n                        const isToday = dayDate.toDateString() === today.toDateString();\r\n                        return (\r\n                            <div key={i} className=\"text-center\">\r\n                                <div className={`text-xs font-medium text-gray-400 mb-1 ${isToday ? 'text-brand-blue' : ''}`}>\r\n                                    {dayNames[dayDate.getDay()]}\r\n                                </div>\r\n                                <div className={`text-sm font-bold ${isToday ? 'text-brand-blue' : 'dark:text-white'}`}>\r\n                                    {dayDate.getDate()}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {/* Time Grid */}\r\n                <div className=\"grid grid-cols-8 gap-2\">\r\n                    {/* Time Column */}\r\n                    <div className=\"space-y-1\">\r\n                        {timeSlots.map(hour => (\r\n                            <div key={hour} className=\"h-16 flex items-start pt-1 text-xs text-gray-400\">\r\n                                {hour.toString().padStart(2, '0')}:00\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Day Columns */}\r\n                    {weekDates.map((dayDate, dayIndex) => {\r\n                        const dayBookings = getDayBookings(dayDate);\r\n                        const dayBlocks = getDayBlocks(dayDate);\r\n                        const isToday = dayDate.toDateString() === today.toDateString();\r\n\r\n                        return (\r\n                            <div key={dayIndex} className=\"relative\">\r\n                                {timeSlots.map((hour, hourIndex) => {\r\n                                    const slotStart = new Date(dayDate);\r\n                                    slotStart.setHours(hour, 0, 0, 0);\r\n                                    const slotEnd = new Date(dayDate);\r\n                                    slotEnd.setHours(hour + 1, 0, 0, 0);\r\n\r\n                                    // Find bookings in this time slot\r\n                                    const slotBookings = dayBookings.filter(b => {\r\n                                        if (!b.startTime) return false;\r\n                                        const bookingTime = new Date(`${dayDate.toDateString()} ${b.startTime}`);\r\n                                        return bookingTime >= slotStart && bookingTime < slotEnd;\r\n                                    });\r\n\r\n                                    // Check if this slot is blocked\r\n                                    const isBlocked = dayBlocks.some(block => {\r\n                                        const timeSlot = block.time_slot || block.timeSlot;\r\n                                        if (timeSlot === 'full') return true;\r\n                                        // Add more logic for time slot matching if needed\r\n                                        return false;\r\n                                    });\r\n\r\n                                    return (\r\n                                        <div\r\n                                            key={hourIndex}\r\n                                            onClick={() => onDateClick && onDateClick(slotStart)}\r\n                                            className={`h-16 border-b dark:border-gray-700 cursor-pointer transition ${\r\n                                                isToday ? 'bg-blue-50 dark:bg-blue-900/10' :\r\n                                                'hover:bg-gray-50 dark:hover:bg-gray-800'\r\n                                            } ${isBlocked ? 'bg-red-50 dark:bg-red-900/20' : ''}`}\r\n                                        >\r\n                                            {slotBookings.map((booking, bi) => (\r\n                                                <div\r\n                                                    key={bi}\r\n                                                    onClick={(e) => {\r\n                                                        e.stopPropagation();\r\n                                                        if (onBookingClick) onBookingClick(booking, dayDate);\r\n                                                    }}\r\n                                                    className={`text-xs p-1 m-0.5 rounded cursor-pointer ${\r\n                                                        (booking.status || '').toLowerCase() === 'confirmed'\r\n                                                            ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                                                            : 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400'\r\n                                                    }`}\r\n                                                >\r\n                                                    {booking.startTime || ''} {booking.clientName || 'Booking'}\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Day View Component\r\n */\r\nfunction DayView({ date, bookings, blockedDates, onDateClick, onBookingClick, getDayBookings, getDayBlocks }) {\r\n    const today = new Date();\r\n    const isToday = date.toDateString() === today.toDateString();\r\n    \r\n    const dayBookings = getDayBookings(date);\r\n    const dayBlocks = getDayBlocks(date);\r\n    \r\n    // Time slots for the day (6 AM to 11 PM)\r\n    const timeSlots = [];\r\n    for (let hour = 6; hour <= 23; hour++) {\r\n        timeSlots.push(hour);\r\n    }\r\n\r\n    // Group bookings by hour\r\n    const bookingsByHour = useMemo(() => {\r\n        const grouped = {};\r\n        dayBookings.forEach(booking => {\r\n            if (!booking.startTime) return;\r\n            const hour = parseInt(booking.startTime.split(':')[0]);\r\n            if (!grouped[hour]) grouped[hour] = [];\r\n            grouped[hour].push(booking);\r\n        });\r\n        return grouped;\r\n    }, [dayBookings]);\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* Day Header */}\r\n            <div className={`p-4 rounded-lg border-2 ${\r\n                isToday \r\n                    ? 'bg-brand-blue text-white border-brand-blue' \r\n                    : 'bg-gray-50 dark:bg-[#1f2128] border-gray-200 dark:border-gray-700'\r\n            }`}>\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h3 className=\"font-bold text-lg\">\r\n                            {date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}\r\n                        </h3>\r\n                        <p className={`text-sm mt-1 ${isToday ? 'text-blue-100' : 'text-gray-500'}`}>\r\n                            {dayBookings.length} booking{dayBookings.length !== 1 ? 's' : ''}\r\n                            {dayBlocks.length > 0 && `  ${dayBlocks.length} blocked slot${dayBlocks.length !== 1 ? 's' : ''}`}\r\n                        </p>\r\n                    </div>\r\n                    {dayBlocks.length > 0 && (\r\n                        <div className=\"flex items-center gap-2 text-red-600 dark:text-red-400\">\r\n                            <Ban size={20} />\r\n                            <span className=\"font-medium\">Blocked</span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Time Schedule */}\r\n            <div className=\"grid grid-cols-12 gap-2\">\r\n                {/* Time Column */}\r\n                <div className=\"col-span-2 space-y-1\">\r\n                    {timeSlots.map(hour => (\r\n                        <div key={hour} className=\"h-20 flex items-start pt-2 text-sm text-gray-500 font-medium\">\r\n                            {hour.toString().padStart(2, '0')}:00\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Schedule Column */}\r\n                <div className=\"col-span-10 relative\">\r\n                    {timeSlots.map((hour, hourIndex) => {\r\n                        const slotStart = new Date(date);\r\n                        slotStart.setHours(hour, 0, 0, 0);\r\n                        const slotEnd = new Date(date);\r\n                        slotEnd.setHours(hour + 1, 0, 0, 0);\r\n\r\n                        const slotBookings = bookingsByHour[hour] || [];\r\n                        const isBlocked = dayBlocks.some(block => {\r\n                            const timeSlot = block.time_slot || block.timeSlot;\r\n                            const startTime = block.start_time || block.startTime;\r\n                            const endTime = block.end_time || block.endTime;\r\n                            \r\n                            if (timeSlot === 'full') return true;\r\n                            // Check if this hour falls within blocked time slot\r\n                            if (timeSlot === 'custom' && startTime && endTime) {\r\n                                const blockStart = parseInt(startTime.split(':')[0]);\r\n                                const blockEnd = parseInt(endTime.split(':')[0]);\r\n                                return hour >= blockStart && hour < blockEnd;\r\n                            }\r\n                            return false;\r\n                        });\r\n\r\n                        return (\r\n                            <div\r\n                                key={hourIndex}\r\n                                onClick={() => onDateClick && onDateClick(slotStart)}\r\n                                className={`h-20 border-b dark:border-gray-700 cursor-pointer transition relative ${\r\n                                    isToday ? 'bg-blue-50 dark:bg-blue-900/10' :\r\n                                    'hover:bg-gray-50 dark:hover:bg-gray-800'\r\n                                } ${isBlocked ? 'bg-red-50 dark:bg-red-900/20' : ''}`}\r\n                            >\r\n                                {slotBookings.map((booking, bi) => (\r\n                                    <div\r\n                                        key={bi}\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            if (onBookingClick) onBookingClick(booking, date);\r\n                                        }}\r\n                                        className={`absolute left-1 right-1 p-2 rounded-lg cursor-pointer shadow-sm ${\r\n                                            (booking.status || '').toLowerCase() === 'confirmed'\r\n                                                ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-300 dark:border-green-700'\r\n                                                : 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 border border-amber-300 dark:border-amber-700'\r\n                                        }`}\r\n                                        style={{\r\n                                            top: `${((parseInt((booking.startTime || '00:00').split(':')[1]) || 0) / 60) * 100}%`,\r\n                                            height: `${((booking.duration || 1) / 60) * 100}%`\r\n                                        }}\r\n                                    >\r\n                                        <div className=\"font-medium text-sm\">\r\n                                            {booking.startTime || ''} {booking.clientName || 'Booking'}\r\n                                        </div>\r\n                                        {booking.roomName && (\r\n                                            <div className=\"text-xs opacity-75 flex items-center gap-1 mt-0.5\">\r\n                                                <MapPin size={10} />\r\n                                                {booking.roomName}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Bookings List (Alternative View) */}\r\n            {dayBookings.length > 0 && (\r\n                <div className=\"mt-4 pt-4 border-t dark:border-gray-700\">\r\n                    <h4 className=\"font-bold text-sm dark:text-white mb-3\">All Bookings</h4>\r\n                    <div className=\"space-y-2\">\r\n                        {dayBookings.map(booking => (\r\n                            <div\r\n                                key={booking.id}\r\n                                onClick={() => onBookingClick && onBookingClick(booking, date)}\r\n                                className={`p-3 rounded-lg cursor-pointer transition ${\r\n                                    (booking.status || '').toLowerCase() === 'confirmed'\r\n                                        ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800'\r\n                                        : 'bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800'\r\n                                }`}\r\n                            >\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div>\r\n                                        <div className=\"font-medium dark:text-white\">\r\n                                            {booking.startTime || 'TBD'} - {booking.clientName || 'Unknown'}\r\n                                        </div>\r\n                                        {booking.roomName && (\r\n                                            <div className=\"text-xs text-gray-500 mt-0.5 flex items-center gap-1\">\r\n                                                <MapPin size={10} />\r\n                                                {booking.roomName}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                    <span className={`text-xs px-2 py-1 rounded font-medium ${\r\n                                        (booking.status || '').toLowerCase() === 'confirmed'\r\n                                            ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                                            : 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400'\r\n                                    }`}>\r\n                                        {booking.status || 'Pending'}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Copy, Plus, Edit2, Trash2, X, Clock, DollarSign, Package, Check, Sparkles } from 'lucide-react';\r\n\r\n/**\r\n * BookingTemplates - Manage and use booking templates\r\n * Phase 2: Advanced booking features\r\n */\r\nexport default function BookingTemplates({ user, userData, onCreateBooking }) {\r\n    const [templates, setTemplates] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [showEditModal, setShowEditModal] = useState(false);\r\n    const [selectedTemplate, setSelectedTemplate] = useState(null);\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        description: '',\r\n        durationHours: 2,\r\n        basePrice: 100,\r\n        rooms: [],\r\n        equipmentPackages: [],\r\n        addOnServices: [],\r\n        isActive: true\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchTemplates();\r\n    }, []);\r\n\r\n    const fetchTemplates = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/booking-templates?studioId=${userData?.id}`);\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setTemplates(data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching templates:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleCreateTemplate = async (e) => {\r\n        e.preventDefault();\r\n\r\n        try {\r\n            const response = await fetch('/api/studio-ops/booking-templates', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    ...formData,\r\n                    studioId: userData?.id\r\n                })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setTemplates([...templates, data.data]);\r\n                setShowAddModal(false);\r\n                resetForm();\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to create template'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error creating template:', error);\r\n            alert('Failed to create template. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleUpdateTemplate = async (e) => {\r\n        e.preventDefault();\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/booking-templates/${selectedTemplate.id}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(formData)\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setTemplates(templates.map(t => t.id === selectedTemplate.id ? data.data : t));\r\n                setShowEditModal(false);\r\n                setSelectedTemplate(null);\r\n                resetForm();\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to update template'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error updating template:', error);\r\n            alert('Failed to update template. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleDeleteTemplate = async (templateId) => {\r\n        const template = templates.find(t => t.id === templateId);\r\n\r\n        if (template.usage_count > 0) {\r\n            alert(`This template has been used ${template.usage_count} time(s). Please deactivate it instead of deleting.`);\r\n            return;\r\n        }\r\n\r\n        if (!confirm(`Are you sure you want to delete \"${template.name}\"?`)) return;\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/booking-templates/${templateId}`, {\r\n                method: 'DELETE'\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setTemplates(templates.filter(t => t.id !== templateId));\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to delete template'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error deleting template:', error);\r\n            alert('Failed to delete template. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleToggleActive = async (template) => {\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/booking-templates/${template.id}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ isActive: !template.is_active })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setTemplates(templates.map(t => t.id === template.id ? data.data : t));\r\n            }\r\n        } catch (error) {\r\n            console.error('Error toggling template:', error);\r\n        }\r\n    };\r\n\r\n    const handleUseTemplate = async (template) => {\r\n        if (onCreateBooking) {\r\n            onCreateBooking(template);\r\n        } else {\r\n            // Default: create booking from template\r\n            try {\r\n                const response = await fetch(`/api/studio-ops/booking-templates/${template.id}/use`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                        studioId: userData?.id,\r\n                        clientId: null, // Will need to be filled\r\n                        date: new Date().toISOString().split('T')[0],\r\n                        startTime: '10:00'\r\n                    })\r\n                });\r\n\r\n                const data = await response.json();\r\n\r\n                if (data.success) {\r\n                    alert(`Booking created from \"${template.name}\" template!`);\r\n                } else {\r\n                    alert(`Error: ${data.error || 'Failed to create booking'}`);\r\n                }\r\n            } catch (error) {\r\n                console.error('Error using template:', error);\r\n            }\r\n        }\r\n    };\r\n\r\n    const openEditModal = (template) => {\r\n        setSelectedTemplate(template);\r\n        setFormData({\r\n            name: template.name,\r\n            description: template.description || '',\r\n            durationHours: template.duration_hours,\r\n            basePrice: template.base_price,\r\n            rooms: template.rooms || [],\r\n            equipmentPackages: template.equipment_packages || [],\r\n            addOnServices: template.add_on_services || [],\r\n            isActive: template.is_active\r\n        });\r\n        setShowEditModal(true);\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            name: '',\r\n            description: '',\r\n            durationHours: 2,\r\n            basePrice: 100,\r\n            rooms: [],\r\n            equipmentPackages: [],\r\n            addOnServices: [],\r\n            isActive: true\r\n        });\r\n    };\r\n\r\n    const formatCurrency = (amount) => {\r\n        return new Intl.NumberFormat('en-US', {\r\n            style: 'currency',\r\n            currency: 'USD'\r\n        }).format(amount);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center text-white\">\r\n                                <Sparkles size={20} />\r\n                            </div>\r\n                            Booking Templates\r\n                        </h2>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\r\n                            Create reusable booking packages for quick scheduling\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => setShowAddModal(true)}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors\"\r\n                    >\r\n                        <Plus size={18} />\r\n                        New Template\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Templates List */}\r\n            {loading ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                    Loading templates...\r\n                </div>\r\n            ) : templates.length === 0 ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                    <div className=\"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                        <Copy size={32} className=\"text-gray-400\" />\r\n                    </div>\r\n                    <p className=\"font-semibold mb-2\">No booking templates yet</p>\r\n                    <p className=\"text-sm\">Create templates to speed up your booking process</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                    {templates.map((template) => (\r\n                        <div\r\n                            key={template.id}\r\n                            className={`bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5 transition-all ${\r\n                                !template.is_active ? 'opacity-60' : ''\r\n                            }`}\r\n                        >\r\n                            {/* Header */}\r\n                            <div className=\"flex items-start justify-between mb-3\">\r\n                                <div className=\"flex-1\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <h3 className=\"text-lg font-semibold dark:text-white\">{template.name}</h3>\r\n                                        {!template.is_active && (\r\n                                            <span className=\"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded\">\r\n                                                Inactive\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                    {template.description && (\r\n                                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2\">\r\n                                            {template.description}\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => handleToggleActive(template)}\r\n                                    className={`p-2 rounded-lg transition-colors ${\r\n                                        template.is_active\r\n                                            ? 'text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20'\r\n                                            : 'text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                                    }`}\r\n                                    title={template.is_active ? 'Active' : 'Inactive'}\r\n                                >\r\n                                    <Check size={18} />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Details */}\r\n                            <div className=\"space-y-2 mb-4\">\r\n                                <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                                    <Clock size={16} />\r\n                                    {template.duration_hours} hour{template.duration_hours !== 1 ? 's' : ''}\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2 text-sm font-semibold text-green-600 dark:text-green-400\">\r\n                                    <DollarSign size={16} />\r\n                                    {formatCurrency(template.base_price)}\r\n                                </div>\r\n                                {template.usage_count > 0 && (\r\n                                    <div className=\"text-xs text-gray-500 dark:text-gray-500\">\r\n                                        Used {template.usage_count} time{template.usage_count !== 1 ? 's' : ''}\r\n                                    </div>\r\n                                )}\r\n                                {(template.rooms?.length > 0 || template.equipment_packages?.length > 0 || template.add_on_services?.length > 0) && (\r\n                                    <div className=\"text-xs text-gray-500 dark:text-gray-500\">\r\n                                        {template.rooms?.length > 0 && `${template.rooms.length} room(s)`}\r\n                                        {template.rooms?.length > 0 && template.equipment_packages?.length > 0 && '  '}\r\n                                        {template.equipment_packages?.length > 0 && `${template.equipment_packages.length} equipment package(s)`}\r\n                                        {(template.rooms?.length > 0 || template.equipment_packages?.length > 0) && template.add_on_services?.length > 0 && '  '}\r\n                                        {template.add_on_services?.length > 0 && `${template.add_on_services.length} add-on(s)`}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Actions */}\r\n                            <div className=\"flex items-center gap-2 pt-3 border-t dark:border-gray-700\">\r\n                                <button\r\n                                    onClick={() => handleUseTemplate(template)}\r\n                                    className=\"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm transition-colors\"\r\n                                >\r\n                                    <Copy size={16} />\r\n                                    Use\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => openEditModal(template)}\r\n                                    className=\"p-2 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors\"\r\n                                    title=\"Edit template\"\r\n                                >\r\n                                    <Edit2 size={16} />\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => handleDeleteTemplate(template.id)}\r\n                                    className=\"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors\"\r\n                                    title=\"Delete template\"\r\n                                >\r\n                                    <Trash2 size={16} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Add Template Modal */}\r\n            {showAddModal && (\r\n                <TemplateFormModal\r\n                    mode=\"add\"\r\n                    formData={formData}\r\n                    setFormData={setFormData}\r\n                    onSubmit={handleCreateTemplate}\r\n                    onClose={() => {\r\n                        setShowAddModal(false);\r\n                        resetForm();\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            {/* Edit Template Modal */}\r\n            {showEditModal && selectedTemplate && (\r\n                <TemplateFormModal\r\n                    mode=\"edit\"\r\n                    formData={formData}\r\n                    setFormData={setFormData}\r\n                    onSubmit={handleUpdateTemplate}\r\n                    onClose={() => {\r\n                        setShowEditModal(false);\r\n                        setSelectedTemplate(null);\r\n                        resetForm();\r\n                    }}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Template Form Modal Component\r\n */\r\nfunction TemplateFormModal({ mode, formData, setFormData, onSubmit, onClose }) {\r\n    const [errors, setErrors] = useState({});\r\n\r\n    const validate = () => {\r\n        const newErrors = {};\r\n\r\n        if (!formData.name.trim()) {\r\n            newErrors.name = 'Name is required';\r\n        }\r\n        if (!formData.durationHours || formData.durationHours <= 0) {\r\n            newErrors.durationHours = 'Duration must be greater than 0';\r\n        }\r\n        if (!formData.basePrice || formData.basePrice < 0) {\r\n            newErrors.basePrice = 'Price must be 0 or greater';\r\n        }\r\n\r\n        setErrors(newErrors);\r\n        return Object.keys(newErrors).length === 0;\r\n    };\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n        if (validate()) {\r\n            onSubmit(e);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b dark:border-gray-700 flex items-center justify-between\">\r\n                    <h3 className=\"text-xl font-bold dark:text-white\">\r\n                        {mode === 'add' ? 'Create Booking Template' : 'Edit Booking Template'}\r\n                    </h3>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors\"\r\n                    >\r\n                        <X size={20} className=\"dark:text-gray-400\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Form */}\r\n                <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Template Name *\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.name}\r\n                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                            className={`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-orange-500 ${\r\n                                errors.name ? 'border-red-500' : 'dark:border-gray-600'\r\n                            }`}\r\n                            placeholder=\"e.g., 4-Hour Recording Session\"\r\n                        />\r\n                        {errors.name && <p className=\"text-sm text-red-600 mt-1\">{errors.name}</p>}\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Description\r\n                        </label>\r\n                        <textarea\r\n                            rows=\"2\"\r\n                            value={formData.description}\r\n                            onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                            className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-orange-500\"\r\n                            placeholder=\"Brief description of this template\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                Duration (hours) *\r\n                            </label>\r\n                            <input\r\n                                type=\"number\"\r\n                                step=\"0.5\"\r\n                                min=\"0.5\"\r\n                                value={formData.durationHours}\r\n                                onChange={(e) => setFormData({ ...formData, durationHours: parseFloat(e.target.value) })}\r\n                                className={`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-orange-500 ${\r\n                                    errors.durationHours ? 'border-red-500' : 'dark:border-gray-600'\r\n                                }`}\r\n                            />\r\n                            {errors.durationHours && <p className=\"text-sm text-red-600 mt-1\">{errors.durationHours}</p>}\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                Base Price ($) *\r\n                            </label>\r\n                            <input\r\n                                type=\"number\"\r\n                                step=\"0.01\"\r\n                                min=\"0\"\r\n                                value={formData.basePrice}\r\n                                onChange={(e) => setFormData({ ...formData, basePrice: parseFloat(e.target.value) })}\r\n                                className={`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-orange-500 ${\r\n                                    errors.basePrice ? 'border-red-500' : 'dark:border-gray-600'\r\n                                }`}\r\n                            />\r\n                            {errors.basePrice && <p className=\"text-sm text-red-600 mt-1\">{errors.basePrice}</p>}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-3 pt-4 border-t dark:border-gray-700\">\r\n                        <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                checked={formData.isActive}\r\n                                onChange={(e) => setFormData({ ...formData, isActive: e.target.checked })}\r\n                                className=\"w-4 h-4 text-orange-600 rounded focus:ring-orange-500\"\r\n                            />\r\n                            <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                                Active template\r\n                            </span>\r\n                        </label>\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-3 pt-4\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            className=\"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors\"\r\n                        >\r\n                            {mode === 'add' ? 'Create Template' : 'Save Changes'}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Users, Clock, Calendar, Bell, Check, X, XCircle, AlertCircle, Star, Trash2 } from 'lucide-react';\r\n\r\n/**\r\n * BookingWaitlist - Manage waitlist entries and notify clients\r\n * Phase 2: Advanced booking features\r\n */\r\nexport default function BookingWaitlist({ user, userData }) {\r\n    const [waitlistEntries, setWaitlistEntries] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filterStatus, setFilterStatus] = useState('all');\r\n\r\n    useEffect(() => {\r\n        fetchWaitlist();\r\n    }, []);\r\n\r\n    const fetchWaitlist = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/waitlist?studioId=${userData?.id}`);\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setWaitlistEntries(data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching waitlist:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleNotifyClient = async (entryId) => {\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/waitlist/${entryId}/notify`, {\r\n                method: 'POST'\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                // Update entry status\r\n                setWaitlistEntries(waitlistEntries.map(entry =>\r\n                    entry.id === entryId ? { ...entry, status: 'notified' } : entry\r\n                ));\r\n                alert('Client notified successfully! They have 24 hours to respond.');\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to notify client'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error notifying client:', error);\r\n            alert('Failed to notify client. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleRemoveEntry = async (entryId) => {\r\n        if (!confirm('Remove this entry from the waitlist?')) return;\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/waitlist/${entryId}`, {\r\n                method: 'DELETE'\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setWaitlistEntries(waitlistEntries.filter(entry => entry.id !== entryId));\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to remove entry'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error removing entry:', error);\r\n            alert('Failed to remove entry. Please try again.');\r\n        }\r\n    };\r\n\r\n    const getStatusBadge = (entry) => {\r\n        const statusConfig = {\r\n            pending: {\r\n                label: 'Pending',\r\n                color: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400',\r\n                icon: Clock\r\n            },\r\n            notified: {\r\n                label: 'Awaiting Response',\r\n                color: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',\r\n                icon: Bell\r\n            },\r\n            accepted: {\r\n                label: 'Accepted',\r\n                color: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',\r\n                icon: Check\r\n            },\r\n            cancelled: {\r\n                label: 'Cancelled',\r\n                color: 'bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400',\r\n                icon: XCircle\r\n            },\r\n            expired: {\r\n                label: 'Expired',\r\n                color: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400',\r\n                icon: XCircle\r\n            }\r\n        };\r\n\r\n        const config = statusConfig[entry.status] || statusConfig.pending;\r\n        const Icon = config.icon;\r\n\r\n        return (\r\n            <span className={`inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full ${config.color}`}>\r\n                <Icon size={12} />\r\n                {config.label}\r\n            </span>\r\n        );\r\n    };\r\n\r\n    const getPriorityBadge = (priority) => {\r\n        if (priority >= 80) {\r\n            return (\r\n                <span className=\"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\">\r\n                    <Star size={10} className=\"fill-current\" />\r\n                    High Priority\r\n                </span>\r\n            );\r\n        } else if (priority >= 50) {\r\n            return (\r\n                <span className=\"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400\">\r\n                    Medium\r\n                </span>\r\n            );\r\n        }\r\n        return (\r\n            <span className=\"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400\">\r\n                Normal\r\n            </span>\r\n        );\r\n    };\r\n\r\n    const formatDate = (dateString) => {\r\n        if (!dateString) return 'N/A';\r\n        return new Date(dateString).toLocaleDateString('en-US', {\r\n            weekday: 'short',\r\n            month: 'short',\r\n            day: 'numeric',\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n        });\r\n    };\r\n\r\n    const filteredEntries = filterStatus === 'all'\r\n        ? waitlistEntries\r\n        : waitlistEntries.filter(entry => entry.status === filterStatus);\r\n\r\n    const stats = {\r\n        total: waitlistEntries.length,\r\n        pending: waitlistEntries.filter(e => e.status === 'pending').length,\r\n        notified: waitlistEntries.filter(e => e.status === 'notified').length,\r\n        expired: waitlistEntries.filter(e => e.status === 'expired').length\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white\">\r\n                                <Users size={20} />\r\n                            </div>\r\n                            Booking Waitlist\r\n                        </h2>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\r\n                            Manage waitlist entries and notify clients of availability\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Stats */}\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                    <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold dark:text-white\">{stats.total}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Entries</div>\r\n                    </div>\r\n                    <div className=\"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">{stats.pending}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Pending</div>\r\n                    </div>\r\n                    <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{stats.notified}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Awaiting Response</div>\r\n                    </div>\r\n                    <div className=\"bg-red-50 dark:bg-red-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">{stats.expired}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Expired</div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Filter */}\r\n                <div className=\"mt-4 flex gap-2\">\r\n                    <button\r\n                        onClick={() => setFilterStatus('all')}\r\n                        className={`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${\r\n                            filterStatus === 'all'\r\n                                ? 'bg-gray-800 text-white'\r\n                                : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'\r\n                        }`}\r\n                    >\r\n                        All ({stats.total})\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setFilterStatus('pending')}\r\n                        className={`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${\r\n                            filterStatus === 'pending'\r\n                                ? 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400'\r\n                                : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'\r\n                        }`}\r\n                    >\r\n                        Pending ({stats.pending})\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setFilterStatus('notified')}\r\n                        className={`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${\r\n                            filterStatus === 'notified'\r\n                                ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400'\r\n                                : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'\r\n                        }`}\r\n                    >\r\n                        Notified ({stats.notified})\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Waitlist Entries */}\r\n            {loading ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                    Loading waitlist entries...\r\n                </div>\r\n            ) : filteredEntries.length === 0 ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                    <AlertCircle size={48} className=\"mx-auto mb-4 text-gray-400\" />\r\n                    <p className=\"font-semibold mb-2\">No waitlist entries found</p>\r\n                    <p className=\"text-sm\">\r\n                        {filterStatus !== 'all' ? 'Try a different filter' : 'Waitlist is currently empty'}\r\n                    </p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-3\">\r\n                    {filteredEntries.map((entry) => (\r\n                        <div\r\n                            key={entry.id}\r\n                            className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5 hover:shadow-md transition-shadow\"\r\n                        >\r\n                            <div className=\"flex items-start justify-between\">\r\n                                <div className=\"flex-1\">\r\n                                    {/* Client Info */}\r\n                                    <div className=\"flex items-center gap-3 mb-3\">\r\n                                        <h3 className=\"text-lg font-semibold dark:text-white\">\r\n                                            {entry.client_name || 'Unknown Client'}\r\n                                        </h3>\r\n                                        {getPriorityBadge(entry.priority)}\r\n                                        {getStatusBadge(entry)}\r\n                                    </div>\r\n\r\n                                    {/* Details */}\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                                        {entry.client_email && (\r\n                                            <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                                <span className=\"font-medium\">Email:</span> {entry.client_email}\r\n                                            </div>\r\n                                        )}\r\n                                        {entry.client_phone && (\r\n                                            <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                                <span className=\"font-medium\">Phone:</span> {entry.client_phone}\r\n                                            </div>\r\n                                        )}\r\n                                        <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                            <span className=\"font-medium\">Requested:</span> {formatDate(entry.requested_date)}\r\n                                        </div>\r\n                                        {entry.room_name && (\r\n                                            <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                                <span className=\"font-medium\">Room:</span> {entry.room_name}\r\n                                            </div>\r\n                                        )}\r\n                                        {entry.booking_type && (\r\n                                            <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                                <span className=\"font-medium\">Type:</span> {entry.booking_type}\r\n                                            </div>\r\n                                        )}\r\n                                        {entry.expires_at && (\r\n                                            <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                                <span className=\"font-medium\">Expires:</span> {formatDate(entry.expires_at)}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Actions */}\r\n                                <div className=\"flex items-center gap-2 ml-4\">\r\n                                    {entry.status === 'pending' && (\r\n                                        <button\r\n                                            onClick={() => handleNotifyClient(entry.id)}\r\n                                            className=\"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm transition-colors\"\r\n                                        >\r\n                                            <Bell size={16} />\r\n                                            Notify\r\n                                        </button>\r\n                                    )}\r\n                                    {entry.status === 'notified' && (\r\n                                        <div className=\"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 px-3 py-2 rounded-lg\">\r\n                                            Awaiting response\r\n                                        </div>\r\n                                    )}\r\n                                    <button\r\n                                        onClick={() => handleRemoveEntry(entry.id)}\r\n                                        className=\"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors\"\r\n                                        title=\"Remove from waitlist\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Booking Info (if exists) */}\r\n                            {entry.booking_date && (\r\n                                <div className=\"mt-3 pt-3 border-t dark:border-gray-700\">\r\n                                    <div className=\"text-xs text-gray-500 dark:text-gray-500 mb-1\">\r\n                                        Originally requested booking:\r\n                                    </div>\r\n                                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                        {entry.booking_date} at {entry.booking_start_time}\r\n                                        {entry.booking_end_time && ` - ${entry.booking_end_time}`}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { CreditCard, DollarSign, Plus, Edit2, Trash2, Check, Clock, AlertCircle, X, Calendar } from 'lucide-react';\r\n\r\n/**\r\n * BookingPayments - Manage payments, deposits, and partial payments\r\n * Phase 2: Advanced booking features\r\n */\r\nexport default function BookingPayments({ user, userData, bookingId }) {\r\n    const [payments, setPayments] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [showEditModal, setShowEditModal] = useState(false);\r\n    const [selectedPayment, setSelectedPayment] = useState(null);\r\n    const [formData, setFormData] = useState({\r\n        paymentType: 'deposit',\r\n        amount: 100,\r\n        dueDate: '',\r\n        paymentIntentId: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchPayments();\r\n    }, [bookingId]);\r\n\r\n    const fetchPayments = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const url = bookingId\r\n                ? `/api/studio-ops/booking-payments?bookingId=${bookingId}`\r\n                : `/api/studio-ops/booking-payments?studioId=${userData?.id}`;\r\n\r\n            const response = await fetch(url);\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setPayments(data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching payments:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleCreatePayment = async (e) => {\r\n        e.preventDefault();\r\n\r\n        try {\r\n            const response = await fetch('/api/studio-ops/booking-payments', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    bookingId,\r\n                    paymentType: formData.paymentType,\r\n                    amount: formData.amount,\r\n                    dueDate: formData.dueDate || null,\r\n                    paymentIntentId: formData.paymentIntentId || null\r\n                })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setPayments([...payments, data.data]);\r\n                setShowAddModal(false);\r\n                resetForm();\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to create payment'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error creating payment:', error);\r\n            alert('Failed to create payment. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleUpdatePayment = async (e) => {\r\n        e.preventDefault();\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/booking-payments/${selectedPayment.id}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(formData)\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setPayments(payments.map(p => p.id === selectedPayment.id ? data.data : p));\r\n                setShowEditModal(false);\r\n                setSelectedPayment(null);\r\n                resetForm();\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to update payment'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error updating payment:', error);\r\n            alert('Failed to update payment. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleDeletePayment = async (paymentId) => {\r\n        const payment = payments.find(p => p.id === paymentId);\r\n\r\n        if (payment.status === 'completed') {\r\n            alert('Cannot delete completed payments. Please create a refund instead.');\r\n            return;\r\n        }\r\n\r\n        if (!confirm(`Are you sure you want to delete this ${payment.payment_type} payment of $${payment.amount}?`)) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/booking-payments/${paymentId}`, {\r\n                method: 'DELETE'\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setPayments(payments.filter(p => p.id !== paymentId));\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to delete payment'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error deleting payment:', error);\r\n            alert('Failed to delete payment. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleConfirmPayment = async (paymentId) => {\r\n        if (!confirm('Mark this payment as received? This will update payment records and booking status.')) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/booking-payments/${paymentId}/confirm`, {\r\n                method: 'POST'\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setPayments(payments.map(p => p.id === paymentId ? data.data.payment : p));\r\n                alert(data.message);\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to confirm payment'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error confirming payment:', error);\r\n            alert('Failed to confirm payment. Please try again.');\r\n        }\r\n    };\r\n\r\n    const openEditModal = (payment) => {\r\n        setSelectedPayment(payment);\r\n        setFormData({\r\n            paymentType: payment.payment_type,\r\n            amount: parseFloat(payment.amount),\r\n            dueDate: payment.due_date ? payment.due_date.split('T')[0] : '',\r\n            paymentIntentId: payment.payment_intent_id || ''\r\n        });\r\n        setShowEditModal(true);\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            paymentType: 'deposit',\r\n            amount: 100,\r\n            dueDate: '',\r\n            paymentIntentId: ''\r\n        });\r\n    };\r\n\r\n    const getStatusBadge = (payment) => {\r\n        const statusConfig = {\r\n            pending: {\r\n                label: 'Pending',\r\n                color: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400',\r\n                icon: Clock\r\n            },\r\n            processing: {\r\n                label: 'Processing',\r\n                color: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',\r\n                icon: Clock\r\n            },\r\n            completed: {\r\n                label: 'Paid',\r\n                color: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',\r\n                icon: Check\r\n            },\r\n            failed: {\r\n                label: 'Failed',\r\n                color: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400',\r\n                icon: X\r\n            },\r\n            refunded: {\r\n                label: 'Refunded',\r\n                color: 'bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400',\r\n                icon: X\r\n            }\r\n        };\r\n\r\n        const config = statusConfig[payment.status] || statusConfig.pending;\r\n        const Icon = config.icon;\r\n\r\n        return (\r\n            <span className={`inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full ${config.color}`}>\r\n                <Icon size={12} />\r\n                {config.label}\r\n            </span>\r\n        );\r\n    };\r\n\r\n    const getPaymentTypeBadge = (type) => {\r\n        const typeConfig = {\r\n            deposit: {\r\n                label: 'Deposit',\r\n                color: 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400'\r\n            },\r\n            partial: {\r\n                label: 'Partial',\r\n                color: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400'\r\n            },\r\n            full: {\r\n                label: 'Full Payment',\r\n                color: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'\r\n            },\r\n            refund: {\r\n                label: 'Refund',\r\n                color: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'\r\n            }\r\n        };\r\n\r\n        const config = typeConfig[type] || typeConfig.partial;\r\n\r\n        return (\r\n            <span className={`inline-flex items-center px-2 py-0.5 text-xs font-medium rounded ${config.color}`}>\r\n                {config.label}\r\n            </span>\r\n        );\r\n    };\r\n\r\n    const formatCurrency = (amount) => {\r\n        return new Intl.NumberFormat('en-US', {\r\n            style: 'currency',\r\n            currency: 'USD'\r\n        }).format(amount);\r\n    };\r\n\r\n    const formatDate = (dateString) => {\r\n        if (!dateString) return 'No due date';\r\n        return new Date(dateString).toLocaleDateString('en-US', {\r\n            month: 'short',\r\n            day: 'numeric',\r\n            year: 'numeric'\r\n        });\r\n    };\r\n\r\n    // Calculate totals\r\n    const totals = payments.reduce((acc, payment) => {\r\n        const amount = parseFloat(payment.amount || 0);\r\n        acc.total += amount;\r\n        if (payment.status === 'completed') {\r\n            acc.paid += amount;\r\n        } else if (payment.status === 'pending' || payment.status === 'processing') {\r\n            acc.pending += amount;\r\n        }\r\n        return acc;\r\n    }, { total: 0, paid: 0, pending: 0 });\r\n\r\n    const bookingTotal = payments[0]?.booking_total || 0;\r\n    const remainingBalance = Math.max(0, bookingTotal - totals.paid);\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center text-white\">\r\n                                <CreditCard size={20} />\r\n                            </div>\r\n                            Booking Payments\r\n                        </h2>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\r\n                            Manage deposits, partial payments, and refunds\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => setShowAddModal(true)}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors\"\r\n                    >\r\n                        <Plus size={18} />\r\n                        Add Payment\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Stats */}\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                    <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold dark:text-white\">{formatCurrency(bookingTotal)}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Booking Total</div>\r\n                    </div>\r\n                    <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{formatCurrency(totals.paid)}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Paid</div>\r\n                    </div>\r\n                    <div className=\"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">{formatCurrency(totals.pending)}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Pending</div>\r\n                    </div>\r\n                    <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{formatCurrency(remainingBalance)}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Remaining</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Payments List */}\r\n            {loading ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                    Loading payments...\r\n                </div>\r\n            ) : payments.length === 0 ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                    <CreditCard size={48} className=\"mx-auto mb-4 text-gray-400\" />\r\n                    <p className=\"font-semibold mb-2\">No payments found</p>\r\n                    <p className=\"text-sm\">Add a payment to get started</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-3\">\r\n                    {payments.map((payment) => (\r\n                        <div\r\n                            key={payment.id}\r\n                            className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5 hover:shadow-md transition-shadow\"\r\n                        >\r\n                            <div className=\"flex items-start justify-between\">\r\n                                <div className=\"flex-1\">\r\n                                    {/* Payment Info */}\r\n                                    <div className=\"flex items-center gap-3 mb-3\">\r\n                                        <h3 className=\"text-lg font-semibold dark:text-white flex items-center gap-2\">\r\n                                            <DollarSign size={20} className=\"text-green-600\" />\r\n                                            {formatCurrency(payment.amount)}\r\n                                        </h3>\r\n                                        {getPaymentTypeBadge(payment.payment_type)}\r\n                                        {getStatusBadge(payment)}\r\n                                    </div>\r\n\r\n                                    {/* Details */}\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                                        <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                            <span className=\"font-medium\">Due Date:</span> {formatDate(payment.due_date)}\r\n                                        </div>\r\n                                        {payment.paid_at && (\r\n                                            <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                                <span className=\"font-medium\">Paid On:</span> {formatDate(payment.paid_at)}\r\n                                            </div>\r\n                                        )}\r\n                                        {payment.client_name && (\r\n                                            <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                                <span className=\"font-medium\">Client:</span> {payment.client_name}\r\n                                            </div>\r\n                                        )}\r\n                                        {payment.booking_date && (\r\n                                            <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                                <span className=\"font-medium\">Booking:</span> {payment.booking_date} at {payment.booking_start_time}\r\n                                            </div>\r\n                                        )}\r\n                                        {payment.payment_intent_id && (\r\n                                            <div className=\"text-gray-600 dark:text-gray-400\">\r\n                                                <span className=\"font-medium\">Stripe Intent:</span> {payment.payment_intent_id}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Actions */}\r\n                                <div className=\"flex items-center gap-2 ml-4\">\r\n                                    {payment.status === 'pending' && (\r\n                                        <button\r\n                                            onClick={() => handleConfirmPayment(payment.id)}\r\n                                            className=\"flex items-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm transition-colors\"\r\n                                        >\r\n                                            <Check size={16} />\r\n                                            Confirm\r\n                                        </button>\r\n                                    )}\r\n                                    <button\r\n                                        onClick={() => openEditModal(payment)}\r\n                                        className=\"p-2 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors\"\r\n                                        title=\"Edit payment\"\r\n                                    >\r\n                                        <Edit2 size={16} />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDeletePayment(payment.id)}\r\n                                        className=\"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors\"\r\n                                        title=\"Delete payment\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Add Payment Modal */}\r\n            {showAddModal && (\r\n                <PaymentFormModal\r\n                    mode=\"add\"\r\n                    formData={formData}\r\n                    setFormData={setFormData}\r\n                    onSubmit={handleCreatePayment}\r\n                    onClose={() => {\r\n                        setShowAddModal(false);\r\n                        resetForm();\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            {/* Edit Payment Modal */}\r\n            {showEditModal && selectedPayment && (\r\n                <PaymentFormModal\r\n                    mode=\"edit\"\r\n                    formData={formData}\r\n                    setFormData={setFormData}\r\n                    onSubmit={handleUpdatePayment}\r\n                    onClose={() => {\r\n                        setShowEditModal(false);\r\n                        setSelectedPayment(null);\r\n                        resetForm();\r\n                    }}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Payment Form Modal Component\r\n */\r\nfunction PaymentFormModal({ mode, formData, setFormData, onSubmit, onClose }) {\r\n    const [errors, setErrors] = useState({});\r\n\r\n    const validate = () => {\r\n        const newErrors = {};\r\n\r\n        if (!formData.paymentType) {\r\n            newErrors.paymentType = 'Payment type is required';\r\n        }\r\n        if (!formData.amount || formData.amount <= 0) {\r\n            newErrors.amount = 'Amount must be greater than 0';\r\n        }\r\n\r\n        setErrors(newErrors);\r\n        return Object.keys(newErrors).length === 0;\r\n    };\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n        if (validate()) {\r\n            onSubmit(e);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-md w-full max-h-[90vh] overflow-y-auto\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b dark:border-gray-700 flex items-center justify-between\">\r\n                    <h3 className=\"text-xl font-bold dark:text-white\">\r\n                        {mode === 'add' ? 'Add Payment' : 'Edit Payment'}\r\n                    </h3>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors\"\r\n                    >\r\n                        <X size={20} className=\"dark:text-gray-400\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Form */}\r\n                <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Payment Type *\r\n                        </label>\r\n                        <select\r\n                            value={formData.paymentType}\r\n                            onChange={(e) => setFormData({ ...formData, paymentType: e.target.value })}\r\n                            className={`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-green-500 ${\r\n                                errors.paymentType ? 'border-red-500' : 'dark:border-gray-600'\r\n                            }`}\r\n                        >\r\n                            <option value=\"deposit\">Deposit</option>\r\n                            <option value=\"partial\">Partial Payment</option>\r\n                            <option value=\"full\">Full Payment</option>\r\n                            <option value=\"refund\">Refund</option>\r\n                        </select>\r\n                        {errors.paymentType && <p className=\"text-sm text-red-600 mt-1\">{errors.paymentType}</p>}\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Amount ($) *\r\n                        </label>\r\n                        <input\r\n                            type=\"number\"\r\n                            step=\"0.01\"\r\n                            min=\"0\"\r\n                            value={formData.amount}\r\n                            onChange={(e) => setFormData({ ...formData, amount: parseFloat(e.target.value) })}\r\n                            className={`w-full px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-green-500 ${\r\n                                errors.amount ? 'border-red-500' : 'dark:border-gray-600'\r\n                            }`}\r\n                        />\r\n                        {errors.amount && <p className=\"text-sm text-red-600 mt-1\">{errors.amount}</p>}\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Due Date\r\n                        </label>\r\n                        <input\r\n                            type=\"date\"\r\n                            value={formData.dueDate}\r\n                            onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}\r\n                            className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-green-500\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                            Stripe Payment Intent ID\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.paymentIntentId}\r\n                            onChange={(e) => setFormData({ ...formData, paymentIntentId: e.target.value })}\r\n                            className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-green-500\"\r\n                            placeholder=\"pi_...\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-3 pt-4\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            className=\"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors\"\r\n                        >\r\n                            {mode === 'add' ? 'Add Payment' : 'Save Changes'}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Calendar, Link, Unlink, RefreshCw, Check, AlertCircle, Settings, Clock, RotateCw } from 'lucide-react';\r\n\r\n/**\r\n * CalendarSync - Google Calendar two-way sync management\r\n * Phase 2: Advanced booking features\r\n *\r\n * Features:\r\n * - Connect/disconnect Google Calendar\r\n * - Two-way synchronization\r\n * - Sync status and settings\r\n * - Conflict detection\r\n */\r\nexport default function CalendarSync({ user, userData }) {\r\n    const [syncStatus, setSyncStatus] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [syncing, setSyncing] = useState(false);\r\n    const [showSettings, setShowSettings] = useState(false);\r\n    const [syncResult, setSyncResult] = useState(null);\r\n    const [settings, setSettings] = useState({\r\n        bidirectionalSync: true,\r\n        syncInterval: 15,\r\n        autoSync: true,\r\n        syncConfirmedOnly: false\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchSyncStatus();\r\n    }, []);\r\n\r\n    const fetchSyncStatus = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/calendar-sync/status?studioId=${userData?.id}`);\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setSyncStatus(data.data);\r\n                if (data.data.syncSettings) {\r\n                    setSettings(data.data.syncSettings);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching sync status:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleConnect = async () => {\r\n        // For this implementation, we'll use a simple prompt for the access token\r\n        // In production, you'd use a proper OAuth flow\r\n        const accessToken = prompt('Enter your Google Calendar access token:\\n\\nNote: In production, this would be handled through a proper OAuth flow with a \"Connect Google Calendar\" button.');\r\n\r\n        if (!accessToken) return;\r\n\r\n        try {\r\n            const response = await fetch('/api/studio-ops/calendar-sync/connect', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    studioId: userData?.id,\r\n                    accessToken\r\n                })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setSyncStatus({\r\n                    ...syncStatus,\r\n                    isConnected: true,\r\n                    calendarName: data.data.calendarName,\r\n                    calendarId: data.data.calendarId\r\n                });\r\n                alert('Google Calendar connected successfully!');\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to connect Google Calendar'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error connecting Google Calendar:', error);\r\n            alert('Failed to connect Google Calendar. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleDisconnect = async () => {\r\n        if (!confirm('Are you sure you want to disconnect Google Calendar? This will stop syncing your bookings.')) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('/api/studio-ops/calendar-sync/disconnect', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    studioId: userData?.id\r\n                })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setSyncStatus({\r\n                    ...syncStatus,\r\n                    isConnected: false\r\n                });\r\n                alert('Google Calendar disconnected successfully.');\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to disconnect Google Calendar'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error disconnecting Google Calendar:', error);\r\n            alert('Failed to disconnect Google Calendar. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleSync = async (direction = 'both') => {\r\n        setSyncing(true);\r\n        setSyncResult(null);\r\n\r\n        try {\r\n            const response = await fetch('/api/studio-ops/calendar-sync/sync', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    studioId: userData?.id,\r\n                    direction\r\n                })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setSyncResult(data.data);\r\n                await fetchSyncStatus(); // Refresh status\r\n\r\n                const { syncedToGoogle, syncedFromGoogle, conflicts } = data.data;\r\n                let message = `Sync completed!\\n`;\r\n                message += ` ${syncedToGoogle} bookings synced to Google Calendar\\n`;\r\n                message += ` ${syncedFromGoogle} events synced from Google Calendar`;\r\n\r\n                if (conflicts.length > 0) {\r\n                    message += `\\n\\n ${conflicts.length} conflict(s) detected`;\r\n                }\r\n\r\n                alert(message);\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to sync with Google Calendar'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error syncing with Google Calendar:', error);\r\n            alert('Failed to sync with Google Calendar. Please try again.');\r\n        } finally {\r\n            setSyncing(false);\r\n        }\r\n    };\r\n\r\n    const handleSaveSettings = async () => {\r\n        // In a full implementation, you'd save these to the database\r\n        alert('Settings saved! (Feature not fully implemented)');\r\n        setShowSettings(false);\r\n    };\r\n\r\n    const formatLastSynced = (dateString) => {\r\n        if (!dateString) return 'Never';\r\n        const date = new Date(dateString);\r\n        const now = new Date();\r\n        const diffMs = now - date;\r\n        const diffMins = Math.floor(diffMs / 60000);\r\n\r\n        if (diffMins < 1) return 'Just now';\r\n        if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;\r\n        if (diffMins < 1440) return `${Math.floor(diffMins / 60)} hour${Math.floor(diffMins / 60) > 1 ? 's' : ''} ago`;\r\n        return date.toLocaleDateString();\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                <RefreshCw className=\"animate-spin mx-auto mb-4\" size={32} />\r\n                <p>Loading calendar sync status...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white\">\r\n                                <Calendar size={20} />\r\n                            </div>\r\n                            Google Calendar Sync\r\n                        </h2>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\r\n                            Two-way synchronization between your bookings and Google Calendar\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        {syncStatus?.isConnected && (\r\n                            <button\r\n                                onClick={() => setShowSettings(!showSettings)}\r\n                                className=\"flex items-center gap-2 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\r\n                            >\r\n                                <Settings size={18} />\r\n                                Settings\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Connection Status */}\r\n                <div className={`p-4 rounded-lg border ${\r\n                    syncStatus?.isConnected\r\n                        ? 'bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800'\r\n                        : 'bg-gray-50 border-gray-200 dark:bg-gray-800 dark:border-gray-700'\r\n                }`}>\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {syncStatus?.isConnected ? (\r\n                                <Check className=\"text-green-600 dark:text-green-400\" size={24} />\r\n                            ) : (\r\n                                <Link className=\"text-gray-400 dark:text-gray-500\" size={24} />\r\n                            )}\r\n                            <div>\r\n                                <div className=\"font-semibold dark:text-white\">\r\n                                    {syncStatus?.isConnected ? 'Connected' : 'Not Connected'}\r\n                                </div>\r\n                                {syncStatus?.isConnected && (\r\n                                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                        {syncStatus.calendarName || syncStatus.calendarId}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <div className=\"text-sm text-gray-600 dark:text-gray-400\">Last Synced</div>\r\n                            <div className=\"font-medium dark:text-white\">\r\n                                {formatLastSynced(syncStatus?.lastSyncedAt)}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Actions */}\r\n                <div className=\"flex items-center gap-3 mt-4\">\r\n                    {!syncStatus?.isConnected ? (\r\n                        <button\r\n                            onClick={handleConnect}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors\"\r\n                        >\r\n                            <Link size={18} />\r\n                            Connect Google Calendar\r\n                        </button>\r\n                    ) : (\r\n                        <>\r\n                            <button\r\n                                onClick={() => handleSync('both')}\r\n                                disabled={syncing}\r\n                                className=\"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors\"\r\n                            >\r\n                                {syncing ? (\r\n                                    <RefreshCw className=\"animate-spin\" size={18} />\r\n                                ) : (\r\n                                    <RotateCw size={18} />\r\n                                )}\r\n                                {syncing ? 'Syncing...' : 'Sync Now'}\r\n                            </button>\r\n                            <button\r\n                                onClick={() => handleSync('to-google')}\r\n                                disabled={syncing}\r\n                                className=\"flex items-center gap-2 px-4 py-2 border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:bg-gray-100 dark:disabled:bg-gray-800 rounded-lg dark:text-gray-300 transition-colors\"\r\n                            >\r\n                                Upload to Google\r\n                            </button>\r\n                            <button\r\n                                onClick={() => handleSync('from-google')}\r\n                                disabled={syncing}\r\n                                className=\"flex items-center gap-2 px-4 py-2 border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:bg-gray-100 dark:disabled:bg-gray-800 rounded-lg dark:text-gray-300 transition-colors\"\r\n                            >\r\n                                Download from Google\r\n                            </button>\r\n                            <button\r\n                                onClick={handleDisconnect}\r\n                                className=\"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\r\n                            >\r\n                                <Unlink size={18} />\r\n                                Disconnect\r\n                            </button>\r\n                        </>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Sync Settings */}\r\n            {showSettings && syncStatus?.isConnected && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6\">\r\n                    <h3 className=\"text-lg font-semibold dark:text-white mb-4 flex items-center gap-2\">\r\n                        <Settings size={18} />\r\n                        Sync Settings\r\n                    </h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <div className=\"font-medium dark:text-white\">Bidirectional Sync</div>\r\n                                <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                    Sync changes both ways between SeshNx and Google Calendar\r\n                                </div>\r\n                            </div>\r\n                            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={settings.bidirectionalSync}\r\n                                    onChange={(e) => setSettings({ ...settings, bidirectionalSync: e.target.checked })}\r\n                                    className=\"sr-only peer\"\r\n                                />\r\n                                <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n                            </label>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <div className=\"font-medium dark:text-white\">Auto Sync</div>\r\n                                <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                    Automatically sync when bookings are created or modified\r\n                                </div>\r\n                            </div>\r\n                            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={settings.autoSync}\r\n                                    onChange={(e) => setSettings({ ...settings, autoSync: e.target.checked })}\r\n                                    className=\"sr-only peer\"\r\n                                />\r\n                                <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n                            </label>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <div className=\"font-medium dark:text-white\">Sync Confirmed Bookings Only</div>\r\n                                <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                    Only sync bookings that have been confirmed (skip pending)\r\n                                </div>\r\n                            </div>\r\n                            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={settings.syncConfirmedOnly}\r\n                                    onChange={(e) => setSettings({ ...settings, syncConfirmedOnly: e.target.checked })}\r\n                                    className=\"sr-only peer\"\r\n                                />\r\n                                <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n                            </label>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                Sync Interval (minutes)\r\n                            </label>\r\n                            <input\r\n                                type=\"number\"\r\n                                min=\"1\"\r\n                                max=\"60\"\r\n                                value={settings.syncInterval}\r\n                                onChange={(e) => setSettings({ ...settings, syncInterval: parseInt(e.target.value) })}\r\n                                className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-3 pt-4\">\r\n                            <button\r\n                                onClick={handleSaveSettings}\r\n                                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors\"\r\n                            >\r\n                                Save Settings\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setShowSettings(false)}\r\n                                className=\"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Sync Results */}\r\n            {syncResult && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6\">\r\n                    <h3 className=\"text-lg font-semibold dark:text-white mb-4 flex items-center gap-2\">\r\n                        <Clock size={18} />\r\n                        Sync Results\r\n                    </h3>\r\n                    <div className=\"grid grid-cols-2 gap-4 mb-4\">\r\n                        <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4\">\r\n                            <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\r\n                                {syncResult.syncedToGoogle}\r\n                            </div>\r\n                            <div className=\"text-sm text-gray-600 dark:text-gray-400\">Synced to Google Calendar</div>\r\n                        </div>\r\n                        <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4\">\r\n                            <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\r\n                                {syncResult.syncedFromGoogle}\r\n                            </div>\r\n                            <div className=\"text-sm text-gray-600 dark:text-gray-400\">Synced from Google Calendar</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Conflicts */}\r\n                    {syncResult.conflicts && syncResult.conflicts.length > 0 && (\r\n                        <div className=\"mt-4\">\r\n                            <div className=\"flex items-center gap-2 mb-3\">\r\n                                <AlertCircle className=\"text-yellow-600 dark:text-yellow-400\" size={20} />\r\n                                <h4 className=\"font-semibold dark:text-white\">Conflicts Detected</h4>\r\n                                <span className=\"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400 rounded-full\">\r\n                                    {syncResult.conflicts.length}\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                {syncResult.conflicts.map((conflict, index) => (\r\n                                    <div\r\n                                        key={index}\r\n                                        className=\"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800\"\r\n                                    >\r\n                                        <div className=\"text-sm font-medium dark:text-white\">{conflict.message}</div>\r\n                                        {conflict.bookingTime && (\r\n                                            <div className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\r\n                                                Booking: {conflict.bookingTime} vs Google: {conflict.googleEventTime}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Errors */}\r\n                    {syncResult.errors && syncResult.errors.length > 0 && (\r\n                        <div className=\"mt-4\">\r\n                            <div className=\"flex items-center gap-2 mb-3\">\r\n                                <AlertCircle className=\"text-red-600 dark:text-red-400\" size={20} />\r\n                                <h4 className=\"font-semibold dark:text-white\">Errors</h4>\r\n                                <span className=\"px-2 py-0.5 text-xs bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-full\">\r\n                                    {syncResult.errors.length}\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                {syncResult.errors.map((error, index) => (\r\n                                    <div\r\n                                        key={index}\r\n                                        className=\"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800\"\r\n                                    >\r\n                                        <div className=\"text-sm font-medium dark:text-white\">{error.message}</div>\r\n                                        {error.bookingId && (\r\n                                            <div className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\r\n                                                Booking ID: {error.bookingId}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Info Card */}\r\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 p-6\">\r\n                <div className=\"flex items-start gap-3\">\r\n                    <AlertCircle className=\"text-blue-600 dark:text-blue-400 flex-shrink-0 mt-1\" size={20} />\r\n                    <div>\r\n                        <h4 className=\"font-semibold dark:text-white mb-2\">How Google Calendar Sync Works</h4>\r\n                        <ul className=\"text-sm text-gray-700 dark:text-gray-300 space-y-1\">\r\n                            <li> <strong>Two-way sync:</strong> Changes in SeshNx sync to Google, and Google events are checked for conflicts</li>\r\n                            <li> <strong>Conflict detection:</strong> Warnings appear when Google Calendar events overlap with existing bookings</li>\r\n                            <li> <strong>Automatic updates:</strong> When enabled, bookings automatically update in Google Calendar when modified</li>\r\n                            <li> <strong>Event tracking:</strong> Each booking tracks its Google Calendar event ID for accurate synchronization</li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport {\r\n    Calendar, User, Check, X, MessageSquare,\r\n    Search, RefreshCw, ChevronLeft, ChevronRight,\r\n    CheckCircle, XCircle, Clock3, Eye, Ban, Trash2,\r\n    Sparkles, Users, CreditCard, Calendar as CalendarIcon\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport RecurringBookingModal from './RecurringBookingModal';\r\nimport MultiRoomBookingModal from './MultiRoomBookingModal';\r\nimport UnifiedCalendar from '../shared/UnifiedCalendar';\r\nimport BookingTemplates from './bookings/BookingTemplates';\r\nimport BookingWaitlist from './bookings/BookingWaitlist';\r\nimport BookingPayments from './bookings/BookingPayments';\r\nimport CalendarSync from './bookings/CalendarSync';\r\n\r\nconst STATUS_CONFIG = {\r\n    pending: { \r\n        label: 'Pending', \r\n        color: 'amber', \r\n        icon: Clock3,\r\n        bgClass: 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400'\r\n    },\r\n    confirmed: { \r\n        label: 'Confirmed', \r\n        color: 'green', \r\n        icon: CheckCircle,\r\n        bgClass: 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n    },\r\n    cancelled: { \r\n        label: 'Cancelled', \r\n        color: 'red', \r\n        icon: XCircle,\r\n        bgClass: 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400'\r\n    },\r\n    completed: { \r\n        label: 'Completed', \r\n        color: 'blue', \r\n        icon: Check,\r\n        bgClass: 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\r\n    },\r\n};\r\n\r\n/**\r\n * StudioBookings - Manage incoming bookings for the studio\r\n * Phase 2: Includes templates, waitlist, payments, and calendar sync\r\n */\r\nexport default function StudioBookings({ user, userData, onNavigateToChat }) {\r\n    const [activeTab, setActiveTab] = useState('bookings'); // 'bookings', 'templates', 'waitlist', 'payments', 'calendar-sync'\r\n    const [bookings, setBookings] = useState([]);\r\n    const [blockedDates, setBlockedDates] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filter, setFilter] = useState('all');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedBooking, setSelectedBooking] = useState(null);\r\n    const [updating, setUpdating] = useState(null);\r\n    const [viewMode, setViewMode] = useState('list'); // 'list' or 'calendar'\r\n    const [calendarView, setCalendarView] = useState('month'); // 'month', 'week', 'day'\r\n    const [currentDate, setCurrentDate] = useState(new Date());\r\n    const [showBlockModal, setShowBlockModal] = useState(false);\r\n    const [selectedDate, setSelectedDate] = useState(null);\r\n    const [blockReason, setBlockReason] = useState('');\r\n    const [blockTimeSlot, setBlockTimeSlot] = useState('full'); // 'full', 'morning', 'afternoon', 'evening', 'custom'\r\n    const [customStartTime, setCustomStartTime] = useState('09:00');\r\n    const [customEndTime, setCustomEndTime] = useState('17:00');\r\n    const [showRecurringModal, setShowRecurringModal] = useState(false);\r\n    const [showMultiRoomModal, setShowMultiRoomModal] = useState(false);\r\n    const [selectedBookingForRecurring, setSelectedBookingForRecurring] = useState(null);\r\n    const [selectedBookingForRooms, setSelectedBookingForRooms] = useState(null);\r\n\r\n    // Fetch bookings from Neon API\r\n    useEffect(() => {\r\n        if (!userData?.id) return;\r\n\r\n        loadBookings();\r\n\r\n        // Poll for updates every 30 seconds (replace with Convex real-time later)\r\n        const interval = setInterval(() => {\r\n            loadBookings();\r\n        }, 30000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [userData?.id]);\r\n\r\n    // Helper function to safely parse booking dates\r\n    const parseBookingDate = (dateValue) => {\r\n        if (!dateValue || dateValue === 'Flexible') return null;\r\n        try {\r\n            const parsed = new Date(dateValue);\r\n            return isNaN(parsed.getTime()) ? null : parsed;\r\n        } catch {\r\n            return null;\r\n        }\r\n    };\r\n\r\n    const loadBookings = async () => {\r\n        if (!userData?.id) return;\r\n        setLoading(true);\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/bookings?studioId=${userData?.id}`);\r\n\r\n            if (!response.ok) {\r\n                throw new Error('Failed to fetch bookings');\r\n            }\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setBookings(data.data || []);\r\n            } else {\r\n                throw new Error(data.error || 'Failed to load bookings');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching bookings:', error);\r\n            toast.error('Failed to load bookings');\r\n            setBookings([]);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Fetch blocked dates\r\n    useEffect(() => {\r\n        if (!userData?.id) return;\r\n\r\n        loadBlockedDates();\r\n\r\n        // Poll for updates every 30 seconds\r\n        const interval = setInterval(() => {\r\n            loadBlockedDates();\r\n        }, 30000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [userData?.id]);\r\n\r\n    const loadBlockedDates = async () => {\r\n        if (!userData?.id) return;\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/blocked-dates?studioId=${userData?.id}`);\r\n\r\n            if (!response.ok) {\r\n                throw new Error('Failed to fetch blocked dates');\r\n            }\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setBlockedDates(data.data || []);\r\n            } else {\r\n                throw new Error(data.error || 'Failed to load blocked dates');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching blocked dates:', error);\r\n            toast.error('Failed to load blocked dates');\r\n            setBlockedDates([]);\r\n        }\r\n    };\r\n\r\n    const handleUpdateStatus = async (bookingId, newStatus) => {\r\n        setUpdating(bookingId);\r\n        const toastId = toast.loading(`Updating booking...`);\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/bookings/${bookingId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ status: newStatus })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok || !data.success) {\r\n                throw new Error(data.error || 'Failed to update booking');\r\n            }\r\n\r\n            toast.success(`Booking ${newStatus}!`, { id: toastId });\r\n\r\n            // Reload bookings to reflect changes\r\n            await loadBookings();\r\n        } catch (error) {\r\n            console.error('Update failed:', error);\r\n            toast.error(error.message || 'Failed to update booking', { id: toastId });\r\n        } finally {\r\n            setUpdating(null);\r\n        }\r\n    };\r\n\r\n    // Handle blocking a date (off-platform booking)\r\n    const handleBlockDate = async () => {\r\n        if (!selectedDate || !userData?.id) return;\r\n\r\n        const toastId = toast.loading('Blocking time slot...');\r\n\r\n        try {\r\n            const response = await fetch('/api/studio-ops/blocked-dates', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    studioId: userData?.id,\r\n                    date: selectedDate.toISOString(),\r\n                    reason: blockReason || 'Off-platform booking',\r\n                    timeSlot: blockTimeSlot,\r\n                    startTime: blockTimeSlot === 'custom' ? customStartTime : null,\r\n                    endTime: blockTimeSlot === 'custom' ? customEndTime : null\r\n                })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok || !data.success) {\r\n                throw new Error(data.error || 'Failed to block time slot');\r\n            }\r\n\r\n            toast.success('Time slot blocked!', { id: toastId });\r\n            setShowBlockModal(false);\r\n            setBlockReason('');\r\n            setBlockTimeSlot('full');\r\n            setSelectedDate(null);\r\n            await loadBlockedDates();\r\n        } catch (error) {\r\n            console.error('Error blocking date:', error);\r\n            toast.error(error.message || 'Failed to block time slot. Please try again.', { id: toastId });\r\n        }\r\n    };\r\n\r\n    // Handle unblocking a date\r\n    const handleUnblockDate = async (blockedId) => {\r\n        const toastId = toast.loading('Removing block...');\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/blocked-dates/${blockedId}`, {\r\n                method: 'DELETE'\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok || !data.success) {\r\n                throw new Error(data.error || 'Failed to remove block');\r\n            }\r\n\r\n            toast.success('Block removed!', { id: toastId });\r\n            await loadBlockedDates();\r\n        } catch (error) {\r\n            console.error('Error unblocking date:', error);\r\n            toast.error('Failed to remove block', { id: toastId });\r\n        }\r\n    };\r\n\r\n    // Open block modal for a specific date\r\n    const openBlockModal = (date) => {\r\n        setSelectedDate(date);\r\n        setShowBlockModal(true);\r\n    };\r\n\r\n    // Filter and search bookings\r\n    const filteredBookings = bookings.filter(booking => {\r\n        const bookingStatus = (booking.status || '').toLowerCase();\r\n        const filterStatus = filter.toLowerCase();\r\n        const matchesFilter = filter === 'all' || bookingStatus === filterStatus;\r\n        const matchesSearch = !searchTerm || \r\n            booking.clientName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            booking.roomName?.toLowerCase().includes(searchTerm.toLowerCase());\r\n        return matchesFilter && matchesSearch;\r\n    });\r\n\r\n    // Group bookings by date\r\n    const groupedBookings = filteredBookings.reduce((groups, booking) => {\r\n        if (!booking.date) return groups; // Skip bookings without valid dates\r\n        const dateKey = booking.date.toDateString();\r\n        if (!groups[dateKey]) groups[dateKey] = [];\r\n        groups[dateKey].push(booking);\r\n        return groups;\r\n    }, {});\r\n\r\n    // Stats\r\n    const pendingCount = bookings.filter(b => (b.status || '').toLowerCase() === 'pending').length;\r\n    const todayBookings = bookings.filter(b => {\r\n        if (!b.date) return false;\r\n        const today = new Date().toDateString();\r\n        return b.date.toDateString() === today && (b.status || '').toLowerCase() === 'confirmed';\r\n    }).length;\r\n    const upcomingRevenue = bookings\r\n        .filter(b => {\r\n            if (!b.date) return false;\r\n            return (b.status || '').toLowerCase() === 'confirmed' && b.date >= new Date();\r\n        })\r\n        .reduce((sum, b) => sum + (b.totalPrice || b.offer_amount || 0), 0);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <RefreshCw className=\"animate-spin text-brand-blue\" size={32} />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <CalendarIcon className=\"text-brand-blue\" size={24} />\r\n                        Booking Management\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        {bookings.length} total bookings  {blockedDates.length} blocked slots\r\n                    </p>\r\n                </div>\r\n\r\n                {/* View Mode Toggle - Only show on bookings tab */}\r\n                {activeTab === 'bookings' && (\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex\">\r\n                            <button\r\n                                onClick={() => setViewMode('list')}\r\n                                className={`px-3 py-1.5 text-sm font-medium rounded-md transition ${\r\n                                    viewMode === 'list'\r\n                                        ? 'bg-white dark:bg-gray-700 text-brand-blue shadow-sm'\r\n                                        : 'text-gray-500'\r\n                                }`}\r\n                            >\r\n                                List\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setViewMode('calendar')}\r\n                                className={`px-3 py-1.5 text-sm font-medium rounded-md transition ${\r\n                                    viewMode === 'calendar'\r\n                                        ? 'bg-white dark:bg-gray-700 text-brand-blue shadow-sm'\r\n                                        : 'text-gray-500'\r\n                                }`}\r\n                            >\r\n                                Calendar\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Phase 2 Feature Tabs */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-2 flex flex-wrap gap-2\">\r\n                <button\r\n                    onClick={() => setActiveTab('bookings')}\r\n                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${\r\n                        activeTab === 'bookings'\r\n                            ? 'bg-brand-blue text-white'\r\n                            : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                >\r\n                    <CalendarIcon size={16} />\r\n                    Bookings\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('templates')}\r\n                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${\r\n                        activeTab === 'templates'\r\n                            ? 'bg-orange-600 text-white'\r\n                            : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                >\r\n                    <Sparkles size={16} />\r\n                    Templates\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('waitlist')}\r\n                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${\r\n                        activeTab === 'waitlist'\r\n                            ? 'bg-blue-600 text-white'\r\n                            : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                >\r\n                    <Users size={16} />\r\n                    Waitlist\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('payments')}\r\n                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${\r\n                        activeTab === 'payments'\r\n                            ? 'bg-green-600 text-white'\r\n                            : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                >\r\n                    <CreditCard size={16} />\r\n                    Payments\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('calendar-sync')}\r\n                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition ${\r\n                        activeTab === 'calendar-sync'\r\n                            ? 'bg-indigo-600 text-white'\r\n                            : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                >\r\n                    <CalendarIcon size={16} />\r\n                    Calendar Sync\r\n                </button>\r\n            </div>\r\n\r\n            {/* Render Active Tab Content */}\r\n            {activeTab === 'bookings' && (\r\n                <>\r\n\r\n            {/* Stats Cards */}\r\n            <div className=\"grid grid-cols-3 gap-4\">\r\n                <div className=\"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl border border-amber-200 dark:border-amber-800\">\r\n                    <div className=\"text-2xl font-bold text-amber-600 dark:text-amber-400\">{pendingCount}</div>\r\n                    <div className=\"text-sm text-amber-700 dark:text-amber-300\">Pending Approval</div>\r\n                </div>\r\n                <div className=\"bg-green-50 dark:bg-green-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800\">\r\n                    <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{todayBookings}</div>\r\n                    <div className=\"text-sm text-green-700 dark:text-green-300\">Today&apos;s Sessions</div>\r\n                </div>\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800\">\r\n                    <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">${upcomingRevenue.toLocaleString()}</div>\r\n                    <div className=\"text-sm text-blue-700 dark:text-blue-300\">Upcoming Revenue</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                <div className=\"relative flex-1\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        placeholder=\"Search by client or room...\"\r\n                        className=\"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                    />\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    {['all', 'pending', 'confirmed', 'completed', 'cancelled'].map(status => (\r\n                        <button\r\n                            key={status}\r\n                            onClick={() => setFilter(status)}\r\n                            className={`px-4 py-2 rounded-lg font-medium text-sm transition ${\r\n                                filter === status\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                            }`}\r\n                        >\r\n                            {status.charAt(0).toUpperCase() + status.slice(1)}\r\n                            {status === 'pending' && pendingCount > 0 && (\r\n                                <span className=\"ml-1.5 bg-amber-500 text-white text-xs px-1.5 py-0.5 rounded-full\">\r\n                                    {pendingCount}\r\n                                </span>\r\n                            )}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Calendar View */}\r\n            {viewMode === 'calendar' && (\r\n                <div className=\"space-y-4\">\r\n                    <UnifiedCalendar\r\n                        currentDate={currentDate}\r\n                        onDateChange={setCurrentDate}\r\n                        view={calendarView}\r\n                        onViewChange={setCalendarView}\r\n                        bookings={bookings}\r\n                        blockedDates={blockedDates}\r\n                        onDateClick={(date) => {\r\n                            const today = new Date();\r\n                            const isPast = date < new Date(today.getFullYear(), today.getMonth(), today.getDate());\r\n                            if (!isPast) {\r\n                                openBlockModal(date);\r\n                            }\r\n                        }}\r\n                        onBookingClick={(booking, date) => {\r\n                            setSelectedBooking(booking);\r\n                        }}\r\n                        showControls={true}\r\n                    />\r\n                    \r\n                    {/* Blocked Dates List */}\r\n                    {blockedDates.length > 0 && (\r\n                        <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-4\">\r\n                            <h4 className=\"font-bold text-sm dark:text-white mb-3 flex items-center gap-2\">\r\n                                <Ban size={14} className=\"text-red-500\" />\r\n                                Blocked Time Slots\r\n                            </h4>\r\n                            <div className=\"space-y-2 max-h-48 overflow-y-auto\">\r\n                                {blockedDates.map(block => (\r\n                                    <div \r\n                                        key={block.id}\r\n                                        className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg border dark:border-gray-700\"\r\n                                    >\r\n                                        <div>\r\n                                            <div className=\"font-medium dark:text-white text-sm\">\r\n                                                {new Date(block.date).toLocaleDateString('en-US', { \r\n                                                    weekday: 'short', \r\n                                                    month: 'short', \r\n                                                    day: 'numeric' \r\n                                                })}\r\n                                                {block.time_slot && block.time_slot !== 'full' && (\r\n                                                    <span className=\"ml-2 text-xs text-gray-500\">\r\n                                                        ({block.time_slot === 'custom' \r\n                                                            ? `${block.start_time || ''} - ${block.end_time || ''}` \r\n                                                            : block.time_slot})\r\n                                                    </span>\r\n                                                )}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-gray-500\">{block.reason}</div>\r\n                                        </div>\r\n                                        <button\r\n                                            onClick={() => handleUnblockDate(block.id)}\r\n                                            className=\"p-1.5 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition\"\r\n                                            title=\"Remove block\"\r\n                                        >\r\n                                            <Trash2 size={16} />\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Bookings List */}\r\n            {viewMode === 'list' && (\r\n                <>\r\n                {filteredBookings.length === 0 ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center\">\r\n                    <Calendar size={48} className=\"mx-auto mb-4 text-gray-300 dark:text-gray-600\" />\r\n                    <h3 className=\"text-lg font-bold dark:text-white mb-2\">No Bookings Found</h3>\r\n                    <p className=\"text-gray-500 dark:text-gray-400\">\r\n                        {filter !== 'all' ? `No ${filter} bookings` : 'Bookings will appear here when clients book your studio'}\r\n                    </p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-6\">\r\n                    {Object.entries(groupedBookings).map(([dateKey, dateBookings]) => (\r\n                        <div key={dateKey}>\r\n                            <h3 className=\"text-sm font-bold text-gray-500 uppercase mb-3 flex items-center gap-2\">\r\n                                <Calendar size={14} />\r\n                                {new Date(dateKey).toLocaleDateString('en-US', { \r\n                                    weekday: 'long', \r\n                                    month: 'long', \r\n                                    day: 'numeric' \r\n                                })}\r\n                                <span className=\"text-gray-400\">({dateBookings.length})</span>\r\n                            </h3>\r\n                            <div className=\"space-y-3\">\r\n                                {dateBookings.map(booking => {\r\n                                    const statusConfig = getStatusConfig(booking.status);\r\n                                    \r\n                                    return (\r\n                                        <div \r\n                                            key={booking.id}\r\n                                            className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\"\r\n                                        >\r\n                                            <div className=\"p-4 flex items-center gap-4\">\r\n                                                {/* Time */}\r\n                                                <div className=\"text-center min-w-[70px]\">\r\n                                                    <div className=\"text-lg font-bold dark:text-white\">\r\n                                                        {booking.startTime}\r\n                                                    </div>\r\n                                                    <div className=\"text-xs text-gray-500\">\r\n                                                        {booking.duration}h\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                {/* Details */}\r\n                                                <div className=\"flex-1 min-w-0\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <span className=\"font-bold dark:text-white truncate\">\r\n                                                            {booking.clientName || 'Unknown Client'}\r\n                                                        </span>\r\n                                                        <span className={`text-xs px-2 py-0.5 rounded-full ${statusConfig.bgClass}`}>\r\n                                                            {statusConfig.label}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <div className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                                                        {booking.roomName || 'Main Room'}  ${booking.totalPrice || 0}\r\n                                                    </div>\r\n                                                    {booking.notes && (\r\n                                                        <div className=\"text-xs text-gray-400 mt-1 truncate\">\r\n                                                            Note: {booking.notes}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n\r\n                                                {/* Actions */}\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    {(booking.status || '').toLowerCase() === 'pending' && (\r\n                                                        <>\r\n                                                            <button\r\n                                                                onClick={() => handleUpdateStatus(booking.id, 'Confirmed')}\r\n                                                                disabled={updating === booking.id}\r\n                                                                className=\"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition\"\r\n                                                                title=\"Approve\"\r\n                                                            >\r\n                                                                <Check size={18} />\r\n                                                            </button>\r\n                                                            <button\r\n                                                                onClick={() => handleUpdateStatus(booking.id, 'Cancelled')}\r\n                                                                disabled={updating === booking.id}\r\n                                                                className=\"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition\"\r\n                                                                title=\"Decline\"\r\n                                                            >\r\n                                                                <X size={18} />\r\n                                                            </button>\r\n                                                        </>\r\n                                                    )}\r\n                                                    {(booking.status || '').toLowerCase() === 'confirmed' && (\r\n                                                        <button\r\n                                                            onClick={() => handleUpdateStatus(booking.id, 'Completed')}\r\n                                                            disabled={updating === booking.id}\r\n                                                            className=\"px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium\"\r\n                                                        >\r\n                                                            Mark Complete\r\n                                                        </button>\r\n                                                    )}\r\n                                                    {booking.clientId && onNavigateToChat && (\r\n                                                        <button\r\n                                                            onClick={() => onNavigateToChat(booking.clientId)}\r\n                                                            className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                                            title=\"Message Client\"\r\n                                                        >\r\n                                                            <MessageSquare size={18} />\r\n                                                        </button>\r\n                                                    )}\r\n                                                    <button\r\n                                                        onClick={() => setSelectedBooking(booking)}\r\n                                                        className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                                                        title=\"View Details\"\r\n                                                    >\r\n                                                        <Eye size={18} />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n                </>\r\n            )}\r\n\r\n            {/* Block Date Modal */}\r\n            {showBlockModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-md w-full\">\r\n                        <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                            <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                                <Ban size={18} className=\"text-red-500\" />\r\n                                Block Time Slot\r\n                            </h3>\r\n                            <button onClick={() => {\r\n                                setShowBlockModal(false);\r\n                                setSelectedDate(null);\r\n                                setBlockReason('');\r\n                            }}>\r\n                                <X size={20} className=\"text-gray-500\" />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"p-4 space-y-4\">\r\n                            {/* Selected Date */}\r\n                            <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg text-center\">\r\n                                <div className=\"text-sm text-gray-500 uppercase font-bold mb-1\">Selected Date</div>\r\n                                <div className=\"text-lg font-bold dark:text-white\">\r\n                                    {selectedDate?.toLocaleDateString('en-US', { \r\n                                        weekday: 'long', \r\n                                        month: 'long', \r\n                                        day: 'numeric',\r\n                                        year: 'numeric'\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Time Slot Selection */}\r\n                            <div>\r\n                                <label className=\"text-sm font-bold dark:text-white mb-2 block\">Time Slot</label>\r\n                                <div className=\"grid grid-cols-2 gap-2\">\r\n                                    {[\r\n                                        { id: 'full', label: 'Full Day' },\r\n                                        { id: 'morning', label: 'Morning (6AM-12PM)' },\r\n                                        { id: 'afternoon', label: 'Afternoon (12PM-6PM)' },\r\n                                        { id: 'evening', label: 'Evening (6PM-12AM)' },\r\n                                    ].map(slot => (\r\n                                        <button\r\n                                            key={slot.id}\r\n                                            onClick={() => setBlockTimeSlot(slot.id)}\r\n                                            className={`p-2 text-sm rounded-lg border transition ${\r\n                                                blockTimeSlot === slot.id\r\n                                                    ? 'bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400'\r\n                                                    : 'border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300'\r\n                                            }`}\r\n                                        >\r\n                                            {slot.label}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => setBlockTimeSlot('custom')}\r\n                                    className={`w-full mt-2 p-2 text-sm rounded-lg border transition ${\r\n                                        blockTimeSlot === 'custom'\r\n                                            ? 'bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400'\r\n                                            : 'border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300'\r\n                                    }`}\r\n                                >\r\n                                    Custom Time Range\r\n                                </button>\r\n\r\n                                {blockTimeSlot === 'custom' && (\r\n                                    <div className=\"flex gap-2 mt-2\">\r\n                                        <div className=\"flex-1\">\r\n                                            <label className=\"text-xs text-gray-500 mb-1 block\">Start</label>\r\n                                            <input\r\n                                                type=\"time\"\r\n                                                value={customStartTime}\r\n                                                onChange={(e) => setCustomStartTime(e.target.value)}\r\n                                                className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"flex-1\">\r\n                                            <label className=\"text-xs text-gray-500 mb-1 block\">End</label>\r\n                                            <input\r\n                                                type=\"time\"\r\n                                                value={customEndTime}\r\n                                                onChange={(e) => setCustomEndTime(e.target.value)}\r\n                                                className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Reason */}\r\n                            <div>\r\n                                <label className=\"text-sm font-bold dark:text-white mb-2 block\">Reason (optional)</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={blockReason}\r\n                                    onChange={(e) => setBlockReason(e.target.value)}\r\n                                    placeholder=\"e.g., Private session, Maintenance, Personal...\"\r\n                                    className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Actions */}\r\n                            <div className=\"flex gap-3 pt-2\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        setShowBlockModal(false);\r\n                                        setSelectedDate(null);\r\n                                        setBlockReason('');\r\n                                    }}\r\n                                    className=\"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleBlockDate}\r\n                                    className=\"flex-1 py-2.5 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition flex items-center justify-center gap-2\"\r\n                                >\r\n                                    <Ban size={16} />\r\n                                    Block Time\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Booking Detail Modal */}\r\n            {selectedBooking && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\r\n                        <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                            <h3 className=\"font-bold dark:text-white\">Booking Details</h3>\r\n                            <button onClick={() => setSelectedBooking(null)}>\r\n                                <X size={20} className=\"text-gray-500\" />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"p-4 space-y-4\">\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className=\"w-12 h-12 bg-brand-blue/10 rounded-full flex items-center justify-center\">\r\n                                    <User className=\"text-brand-blue\" size={24} />\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"font-bold dark:text-white\">{selectedBooking.clientName}</div>\r\n                                    <div className=\"text-sm text-gray-500\">{selectedBooking.clientEmail}</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-gray-500 uppercase font-bold mb-1\">Date</div>\r\n                                    <div className=\"dark:text-white\">\r\n                                        {selectedBooking.date.toLocaleDateString('en-US', { \r\n                                            weekday: 'short', \r\n                                            month: 'short', \r\n                                            day: 'numeric' \r\n                                        })}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-gray-500 uppercase font-bold mb-1\">Time</div>\r\n                                    <div className=\"dark:text-white\">\r\n                                        {selectedBooking.startTime} ({selectedBooking.duration}h)\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-gray-500 uppercase font-bold mb-1\">Room</div>\r\n                                    <div className=\"dark:text-white\">{selectedBooking.roomName}</div>\r\n                                </div>\r\n                                <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-gray-500 uppercase font-bold mb-1\">Total</div>\r\n                                    <div className=\"dark:text-white font-bold text-green-600\">\r\n                                        ${selectedBooking.totalPrice || selectedBooking.offer_amount || 0}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {selectedBooking.notes && (\r\n                                <div className=\"bg-amber-50 dark:bg-amber-900/20 p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-amber-600 uppercase font-bold mb-1\">Client Notes</div>\r\n                                    <div className=\"text-amber-800 dark:text-amber-300 text-sm\">{selectedBooking.notes}</div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Action Buttons */}\r\n                            <div className=\"flex gap-2 pt-2 border-t dark:border-gray-700\">\r\n                                {((selectedBooking.status || '').toLowerCase() === 'confirmed') && (\r\n                                    <>\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                setSelectedBookingForRecurring(selectedBooking);\r\n                                                setShowRecurringModal(true);\r\n                                            }}\r\n                                            className=\"flex-1 py-2 px-3 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-900/50 transition text-sm font-medium flex items-center justify-center gap-2\"\r\n                                        >\r\n                                            <Repeat size={14} />\r\n                                            Make Recurring\r\n                                        </button>\r\n                                        {userData?.rooms && userData.rooms.length > 0 && (\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    setSelectedBookingForRooms(selectedBooking);\r\n                                                    setShowMultiRoomModal(true);\r\n                                                }}\r\n                                                className=\"flex-1 py-2 px-3 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium flex items-center justify-center gap-2\"\r\n                                            >\r\n                                                <Home size={14} />\r\n                                                Assign Rooms\r\n                                            </button>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"text-xs text-gray-400 pt-2\">\r\n                                Booked {selectedBooking.createdAt && selectedBooking.createdAt instanceof Date\r\n                                    ? selectedBooking.createdAt.toLocaleDateString()\r\n                                    : new Date(selectedBooking.created_at || selectedBooking.timestamp || Date.now()).toLocaleDateString()}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Recurring Booking Modal */}\r\n            {showRecurringModal && selectedBookingForRecurring && (\r\n                <RecurringBookingModal\r\n                    booking={selectedBookingForRecurring}\r\n                    onClose={() => {\r\n                        setShowRecurringModal(false);\r\n                        setSelectedBookingForRecurring(null);\r\n                    }}\r\n                    onSuccess={() => {\r\n                        loadBookings();\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            {/* Multi-Room Booking Modal */}\r\n            {showMultiRoomModal && selectedBookingForRooms && (\r\n                <MultiRoomBookingModal\r\n                    booking={selectedBookingForRooms}\r\n                    rooms={userData?.rooms || []}\r\n                    onClose={() => {\r\n                        setShowMultiRoomModal(false);\r\n                        setSelectedBookingForRooms(null);\r\n                    }}\r\n                    onSuccess={() => {\r\n                        loadBookings();\r\n                    }}\r\n                />\r\n            )}\r\n                </>\r\n            )}\r\n\r\n            {/* Templates Tab */}\r\n            {activeTab === 'templates' && (\r\n                <BookingTemplates user={user} userData={userData} />\r\n            )}\r\n\r\n            {/* Waitlist Tab */}\r\n            {activeTab === 'waitlist' && (\r\n                <BookingWaitlist user={user} userData={userData} />\r\n            )}\r\n\r\n            {/* Payments Tab */}\r\n            {activeTab === 'payments' && (\r\n                <BookingPayments user={user} userData={userData} />\r\n            )}\r\n\r\n            {/* Calendar Sync Tab */}\r\n            {activeTab === 'calendar-sync' && (\r\n                <CalendarSync user={user} userData={userData} />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import { useState } from 'react';\r\nimport { \r\n    Mic, Speaker, Monitor, Server, Plus, Search, \r\n    Trash2, Edit2, Save, Loader2, X, \r\n    Package\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport EquipmentAutocomplete from '../shared/EquipmentAutocomplete';\r\nimport { EQUIP_CATEGORIES } from '../../config/constants';\r\n\r\n/**\r\n * Map database category names to EQUIP_CATEGORIES IDs\r\n */\r\nfunction mapCategoryToId(dbCategory) {\r\n    if (!dbCategory) return 'other';\r\n    \r\n    const categoryLower = dbCategory.toLowerCase().trim();\r\n    \r\n    // Direct mappings from database category names to EQUIP_CATEGORIES IDs\r\n    const categoryMap = {\r\n        // Recording & Production\r\n        'microphones': 'microphones',\r\n        'microphones & transducers': 'microphones',\r\n        'audio interfaces': 'audio_interfaces',\r\n        'preamps': 'preamps',\r\n        'preamps & channel strips': 'preamps',\r\n        'mixing consoles': 'mixing_consoles',\r\n        'mixers & consoles': 'mixing_consoles',\r\n        'mixing consoles & mixers': 'mixing_consoles',\r\n        'studio monitors': 'monitors',\r\n        'monitors': 'monitors',\r\n        'headphones': 'headphones',\r\n        'outboard gear': 'outboard_processing',\r\n        'outboard processing': 'outboard_processing',\r\n        'effects processors': 'effects_processors',\r\n        'converters': 'converters',\r\n        'ad/da converters': 'converters',\r\n        'recording devices': 'recorders',\r\n        'recorders': 'recorders',\r\n        \r\n        // Instruments\r\n        'electric guitars': 'electric_guitars',\r\n        'acoustic guitars': 'acoustic_guitars',\r\n        'bass guitars': 'bass_guitars',\r\n        'guitar amps': 'guitar_amps',\r\n        'guitar & bass amplifiers': 'guitar_amps',\r\n        'guitar effects': 'guitar_effects',\r\n        'guitar pedals': 'guitar_effects',\r\n        'synthesizers': 'synthesizers',\r\n        'keyboards': 'keyboards',\r\n        'midi controllers': 'midi_controllers',\r\n        'pianos': 'pianos',\r\n        'drum kits': 'drum_kits',\r\n        'electronic drums': 'electronic_drums',\r\n        'drum machines': 'drum_machines',\r\n        'string instruments': 'string_instruments',\r\n        'wind instruments': 'wind_instruments',\r\n        \r\n        // Live Sound\r\n        'pa speakers': 'pa_speakers',\r\n        'power amps': 'power_amps',\r\n        'live mixers': 'live_mixers',\r\n        'wireless systems': 'wireless_systems',\r\n        'in ear monitors': 'in_ear_monitors',\r\n        'stage gear': 'stage_gear',\r\n        \r\n        // DJ\r\n        'turntables': 'turntables',\r\n        'dj controllers': 'dj_controllers',\r\n        'dj mixers': 'dj_mixers',\r\n        \r\n        // Other\r\n        'cables': 'cables',\r\n        'patchbays': 'patchbays',\r\n        'acoustic treatment': 'acoustic_treatment',\r\n        'studio furniture': 'studio_furniture',\r\n        'computers': 'computers',\r\n        'software licenses': 'software_licenses',\r\n        'storage drives': 'storage_drives',\r\n        'stands & mounts': 'stands_mounts',\r\n        'cases & bags': 'cases_bags',\r\n        'vintage gear': 'vintage_gear'\r\n    };\r\n    \r\n    // Try exact match first\r\n    if (categoryMap[categoryLower]) {\r\n        return categoryMap[categoryLower];\r\n    }\r\n    \r\n    // Try partial matches\r\n    for (const [key, value] of Object.entries(categoryMap)) {\r\n        if (categoryLower.includes(key) || key.includes(categoryLower)) {\r\n            return value;\r\n        }\r\n    }\r\n    \r\n    // Try to find by label match in EQUIP_CATEGORIES\r\n    const matched = EQUIP_CATEGORIES.find(cat => \r\n        cat.label.toLowerCase() === categoryLower ||\r\n        cat.label.toLowerCase().includes(categoryLower) ||\r\n        categoryLower.includes(cat.label.toLowerCase())\r\n    );\r\n    \r\n    if (matched) {\r\n        return matched.id;\r\n    }\r\n    \r\n    // Default to 'other' if no match found\r\n    return 'other';\r\n}\r\n\r\n/**\r\n * StudioEquipment - Full equipment inventory management\r\n */\r\nexport default function StudioEquipment({ user, userData, onUpdate }) {\r\n    const [equipment, setEquipment] = useState(userData?.studioEquipment || []);\r\n    const [saving, setSaving] = useState(false);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [categoryFilter, setCategoryFilter] = useState('all');\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [editingItem, setEditingItem] = useState(null);\r\n\r\n    const handleSave = async (updatedEquipment) => {\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving equipment...');\r\n        const userId = userData?.id || user?.id || user?.uid;\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/profiles/${userId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ studioEquipment: updatedEquipment })\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(result.error || 'Failed to save');\r\n            }\r\n\r\n            setEquipment(updatedEquipment);\r\n            toast.success('Equipment saved!', { id: toastId });\r\n            if (onUpdate) onUpdate({ studioEquipment: updatedEquipment });\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save', { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleAddItem = async (newItem) => {\r\n        const itemWithId = {\r\n            ...newItem,\r\n            id: Date.now().toString(),\r\n            addedAt: new Date().toISOString()\r\n        };\r\n        await handleSave([...equipment, itemWithId]);\r\n        setShowAddModal(false);\r\n    };\r\n\r\n    const handleUpdateItem = async (updatedItem) => {\r\n        const updatedEquipment = equipment.map(item => \r\n            item.id === updatedItem.id ? updatedItem : item\r\n        );\r\n        await handleSave(updatedEquipment);\r\n        setEditingItem(null);\r\n    };\r\n\r\n    const handleDeleteItem = async (itemId) => {\r\n        if (!confirm('Remove this item from inventory?')) return;\r\n        const updatedEquipment = equipment.filter(item => item.id !== itemId);\r\n        await handleSave(updatedEquipment);\r\n    };\r\n\r\n    // Filter equipment\r\n    const filteredEquipment = equipment.filter(item => {\r\n        const matchesSearch = !searchTerm || \r\n            item.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            item.brand?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            item.model?.toLowerCase().includes(searchTerm.toLowerCase());\r\n        const matchesCategory = categoryFilter === 'all' || item.category === categoryFilter;\r\n        return matchesSearch && matchesCategory;\r\n    });\r\n\r\n    // Group by category\r\n    const groupedEquipment = filteredEquipment.reduce((groups, item) => {\r\n        const cat = item.category || 'Other';\r\n        if (!groups[cat]) groups[cat] = [];\r\n        groups[cat].push(item);\r\n        return groups;\r\n    }, {});\r\n\r\n    // Get unique categories\r\n    const categories = [...new Set(equipment.map(item => item.category).filter(Boolean))];\r\n\r\n    // Stats\r\n    const totalItems = equipment.length;\r\n    const totalValue = equipment.reduce((sum, item) => sum + (parseFloat(item.value) || 0), 0);\r\n\r\n    const getCategoryIcon = (category) => {\r\n        const iconMap = {\r\n            'microphones_and_input_transducers': Mic,\r\n            'monitoring_and_playback': Speaker,\r\n            'mixing_consoles_and_control': Monitor,\r\n            'outboard_signal_processing': Server,\r\n            'computer_audio_and_interfaces': Server,\r\n        };\r\n        return iconMap[category] || Package;\r\n    };\r\n\r\n    const getCategoryLabel = (categoryId) => {\r\n        const cat = EQUIP_CATEGORIES.find(c => c.id === categoryId);\r\n        return cat?.label || categoryId;\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Package className=\"text-brand-blue\" size={24} />\r\n                        Equipment Inventory\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Manage your studio gear and equipment\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={() => setShowAddModal(true)}\r\n                    className=\"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2\"\r\n                >\r\n                    <Plus size={18} /> Add Equipment\r\n                </button>\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                    <div className=\"text-2xl font-bold dark:text-white\">{totalItems}</div>\r\n                    <div className=\"text-sm text-gray-500\">Total Items</div>\r\n                </div>\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                    <div className=\"text-2xl font-bold text-green-600\">${totalValue.toLocaleString()}</div>\r\n                    <div className=\"text-sm text-gray-500\">Est. Value</div>\r\n                </div>\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                    <div className=\"text-2xl font-bold dark:text-white\">{categories.length}</div>\r\n                    <div className=\"text-sm text-gray-500\">Categories</div>\r\n                </div>\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                    <div className=\"text-2xl font-bold text-brand-blue\">\r\n                        {equipment.filter(e => e.featured).length}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-500\">Featured Items</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                <div className=\"relative flex-1\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        placeholder=\"Search equipment...\"\r\n                        className=\"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                    />\r\n                </div>\r\n                <select\r\n                    value={categoryFilter}\r\n                    onChange={(e) => setCategoryFilter(e.target.value)}\r\n                    className=\"px-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                >\r\n                    <option value=\"all\">All Categories</option>\r\n                    {EQUIP_CATEGORIES.map(cat => (\r\n                        <option key={cat.id} value={cat.id}>{cat.label}</option>\r\n                    ))}\r\n                </select>\r\n            </div>\r\n\r\n            {/* Equipment List */}\r\n            {filteredEquipment.length === 0 ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center\">\r\n                    <Package size={48} className=\"mx-auto mb-4 text-gray-300 dark:text-gray-600\" />\r\n                    <h3 className=\"text-lg font-bold dark:text-white mb-2\">No Equipment Found</h3>\r\n                    <p className=\"text-gray-500 dark:text-gray-400 mb-4\">\r\n                        {searchTerm || categoryFilter !== 'all' \r\n                            ? 'Try adjusting your filters'\r\n                            : 'Add your studio equipment to showcase your gear'}\r\n                    </p>\r\n                    <button\r\n                        onClick={() => setShowAddModal(true)}\r\n                        className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition\"\r\n                    >\r\n                        Add Your First Item\r\n                    </button>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-6\">\r\n                    {Object.entries(groupedEquipment).map(([category, items]) => {\r\n                        const CategoryIcon = getCategoryIcon(category);\r\n                        return (\r\n                            <div key={category} className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                                <div className=\"p-4 bg-gray-50 dark:bg-[#23262f] border-b dark:border-gray-700 flex items-center gap-3\">\r\n                                    <CategoryIcon className=\"text-brand-blue\" size={20} />\r\n                                    <h3 className=\"font-bold dark:text-white\">{getCategoryLabel(category)}</h3>\r\n                                    <span className=\"text-sm text-gray-500\">({items.length})</span>\r\n                                </div>\r\n                                <div className=\"divide-y dark:divide-gray-700\">\r\n                                    {items.map(item => (\r\n                                        <div \r\n                                            key={item.id}\r\n                                            className=\"p-4 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-[#23262f] transition\"\r\n                                        >\r\n                                            {/* Item Info */}\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <span className=\"font-bold dark:text-white\">\r\n                                                        {item.brand && <span className=\"text-gray-500 font-medium\">{item.brand}</span>} {item.name || item.model}\r\n                                                    </span>\r\n                                                    {(item.quantity && item.quantity > 1) && (\r\n                                                        <span className=\"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 px-2 py-0.5 rounded font-medium\">\r\n                                                            Qty: {item.quantity}\r\n                                                        </span>\r\n                                                    )}\r\n                                                    {item.featured && (\r\n                                                        <span className=\"text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 px-2 py-0.5 rounded\">\r\n                                                            Featured\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                                <div className=\"text-sm text-gray-500 dark:text-gray-400 mt-0.5\">\r\n                                                    {item.model && item.name !== item.model && <span>{item.model}</span>}\r\n                                                    {item.serial && <span className=\"ml-2\">S/N: {item.serial}</span>}\r\n                                                </div>\r\n                                                {item.notes && (\r\n                                                    <div className=\"text-xs text-gray-400 mt-1\">{item.notes}</div>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {/* Value */}\r\n                                            {item.value && (\r\n                                                <div className=\"text-right\">\r\n                                                    <div className=\"text-sm font-bold text-green-600 dark:text-green-400\">\r\n                                                        ${parseFloat(item.value).toLocaleString()}\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n\r\n                                            {/* Actions */}\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <button\r\n                                                    onClick={() => setEditingItem(item)}\r\n                                                    className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                                >\r\n                                                    <Edit2 size={16} />\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => handleDeleteItem(item.id)}\r\n                                                    className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                                >\r\n                                                    <Trash2 size={16} />\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            )}\r\n\r\n            {/* Add/Edit Modal */}\r\n            {(showAddModal || editingItem) && (\r\n                <EquipmentModal\r\n                    item={editingItem}\r\n                    onSave={editingItem ? handleUpdateItem : handleAddItem}\r\n                    onClose={() => { setShowAddModal(false); setEditingItem(null); }}\r\n                    saving={saving}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Equipment Add/Edit Modal\r\n */\r\nfunction EquipmentModal({ item, onSave, onClose, saving }) {\r\n    const [formData, setFormData] = useState(item || {\r\n        name: '',\r\n        brand: '',\r\n        model: '',\r\n        category: '',\r\n        serial: '',\r\n        value: '',\r\n        notes: '',\r\n        featured: false,\r\n        quantity: 1\r\n    });\r\n\r\n    const handleSubmit = () => {\r\n        if (!formData.name && !formData.model) {\r\n            toast.error('Name or model is required');\r\n            return;\r\n        }\r\n        onSave(formData);\r\n    };\r\n\r\n    const handleAutocompleteSelect = (selected) => {\r\n        // Map database category to EQUIP_CATEGORIES ID\r\n        const mappedCategory = mapCategoryToId(selected.category);\r\n        \r\n        setFormData(prev => ({\r\n            ...prev,\r\n            name: selected.name || prev.name,\r\n            brand: selected.brand || prev.brand,\r\n            model: selected.model || prev.model,\r\n            category: mappedCategory // Use mapped category ID\r\n        }));\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto animate-in zoom-in-95\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white\">\r\n                        {item ? 'Edit Equipment' : 'Add Equipment'}\r\n                    </h3>\r\n                    <button onClick={onClose}>\r\n                        <X size={20} className=\"text-gray-500\" />\r\n                    </button>\r\n                </div>\r\n                <div className=\"p-4 space-y-4\">\r\n                    {/* Primary: Equipment Search */}\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">\r\n                            Search Equipment Database\r\n                            <span className=\"text-gray-400 font-normal ml-2\">(Recommended)</span>\r\n                        </label>\r\n                        <EquipmentAutocomplete\r\n                            onSelect={handleAutocompleteSelect}\r\n                            placeholder=\"Search for equipment (e.g. U87, SSL, Fender Twin)...\"\r\n                            className=\"w-full\"\r\n                        />\r\n                        <p className=\"text-xs text-gray-400 mt-1\">\r\n                            Start typing to search from verified equipment database\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"border-t dark:border-gray-700 pt-4 space-y-4\">\r\n                        <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3\">\r\n                            <p className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2\">\r\n                                Or enter manually:\r\n                            </p>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Brand</label>\r\n                                <input\r\n                                    value={formData.brand}\r\n                                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"e.g. Neumann\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Model *</label>\r\n                                <input\r\n                                    value={formData.model || formData.name}\r\n                                    onChange={(e) => setFormData({ ...formData, model: e.target.value, name: e.target.value })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"e.g. U87\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Category</label>\r\n                            <select\r\n                                value={formData.category}\r\n                                onChange={(e) => setFormData({ ...formData, category: e.target.value })}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                            >\r\n                                <option value=\"\">Select category...</option>\r\n                                {EQUIP_CATEGORIES.map(cat => (\r\n                                    <option key={cat.id} value={cat.id}>{cat.label}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-3 gap-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Quantity</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    min=\"1\"\r\n                                    value={formData.quantity || 1}\r\n                                    onChange={(e) => setFormData({ ...formData, quantity: parseInt(e.target.value) || 1 })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"1\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Serial Number</label>\r\n                                <input\r\n                                    value={formData.serial}\r\n                                    onChange={(e) => setFormData({ ...formData, serial: e.target.value })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"Optional\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Value ($)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.value}\r\n                                    onChange={(e) => setFormData({ ...formData, value: e.target.value })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"Estimated value\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Notes</label>\r\n                            <textarea\r\n                                value={formData.notes}\r\n                                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                rows={2}\r\n                                placeholder=\"Additional details...\"\r\n                            />\r\n                        </div>\r\n\r\n                        <label className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-[#1f2128] rounded-xl cursor-pointer\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                checked={formData.featured}\r\n                                onChange={(e) => setFormData({ ...formData, featured: e.target.checked })}\r\n                                className=\"w-4 h-4 text-brand-blue rounded\"\r\n                            />\r\n                            <div>\r\n                                <div className=\"font-medium dark:text-white text-sm\">Featured Equipment</div>\r\n                                <div className=\"text-xs text-gray-500\">Highlight this item on your studio profile</div>\r\n                            </div>\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n                <div className=\"p-4 border-t dark:border-gray-700 flex justify-end gap-3\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl font-medium\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button\r\n                        onClick={handleSubmit}\r\n                        disabled={saving}\r\n                        className=\"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                    >\r\n                        {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                        {item ? 'Update' : 'Add Item'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import { useState } from 'react';\r\nimport { \r\n    Settings, Save, Loader2, Home, MapPin, Mail,\r\n    Wifi, Shield, EyeOff\r\n} from 'lucide-react';\r\nimport { useForm, Controller } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport * as z from 'zod';\r\nimport toast from 'react-hot-toast';\r\nimport AddressAutocomplete from '../shared/AddressAutocomplete';\r\nimport { AMENITIES_DATA } from '../../config/constants';\r\n\r\nconst settingsSchema = z.object({\r\n    studioName: z.string().min(3, \"Studio name is required\"),\r\n    address: z.string().min(5, \"Address is required\"),\r\n    city: z.string().optional(),\r\n    state: z.string().optional(),\r\n    zip: z.string().optional(),\r\n    lat: z.number().optional(),\r\n    lng: z.number().optional(),\r\n    studioDescription: z.string().max(1000).optional(),\r\n    email: z.string().email().optional().or(z.literal('')),\r\n    phoneCell: z.string().optional(),\r\n    phoneLand: z.string().optional(),\r\n    website: z.string().url().optional().or(z.literal('')),\r\n    hours: z.string().optional(),\r\n    amenities: z.array(z.string()).optional(),\r\n    hideAddress: z.boolean().optional(),\r\n});\r\n\r\n/**\r\n * StudioSettings - Basic studio information and contact settings\r\n */\r\nexport default function StudioSettings({ user, userData, onUpdate }) {\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    const {\r\n        register,\r\n        control,\r\n        handleSubmit,\r\n        watch,\r\n        setValue,\r\n        formState: { errors, isDirty }\r\n    } = useForm({\r\n        resolver: zodResolver(settingsSchema),\r\n        defaultValues: {\r\n            studioName: userData?.studioName || userData?.profileName || '',\r\n            address: userData?.address || '',\r\n            city: userData?.city || '',\r\n            state: userData?.state || '',\r\n            zip: userData?.zip || '',\r\n            lat: userData?.lat,\r\n            lng: userData?.lng,\r\n            studioDescription: userData?.studioDescription || '',\r\n            email: userData?.email || '',\r\n            phoneCell: userData?.phoneCell || '',\r\n            phoneLand: userData?.phoneLand || '',\r\n            website: userData?.website || '',\r\n            hours: userData?.hours || '',\r\n            amenities: userData?.amenities || [],\r\n            hideAddress: userData?.hideAddress || false,\r\n        }\r\n    });\r\n\r\n    const watchedAmenities = watch(\"amenities\");\r\n    const watchHideAddress = watch(\"hideAddress\");\r\n\r\n    const toggleAmenity = (amenity) => {\r\n        const current = watchedAmenities || [];\r\n        if (current.includes(amenity)) {\r\n            setValue('amenities', current.filter(a => a !== amenity), { shouldDirty: true });\r\n        } else {\r\n            setValue('amenities', [...current, amenity], { shouldDirty: true });\r\n        }\r\n    };\r\n\r\n    const onSubmit = async (data) => {\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving settings...');\r\n        const userId = userData?.id || user?.id || user?.uid;\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/profiles/${userId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    studioName: data.studioName,\r\n                    profileName: data.studioName,\r\n                    address: data.address,\r\n                    city: data.city,\r\n                    state: data.state,\r\n                    zip: data.zip,\r\n                    lat: data.lat,\r\n                    lng: data.lng,\r\n                    studioDescription: data.studioDescription,\r\n                    email: data.email,\r\n                    phoneCell: data.phoneCell,\r\n                    phoneLand: data.phoneLand,\r\n                    website: data.website,\r\n                    hours: data.hours,\r\n                    amenities: data.amenities,\r\n                    hideAddress: data.hideAddress\r\n                })\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(result.error || 'Failed to save');\r\n            }\r\n\r\n            toast.success(\"Settings saved!\", { id: toastId });\r\n            if (onUpdate) onUpdate(data);\r\n        } catch (error) {\r\n            console.error(\"Save failed\", error);\r\n            toast.error(\"Failed to save settings.\", { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const inputClass = (error) => `w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none ${error ? 'border-red-500 bg-red-50 dark:bg-red-900/10' : 'border-gray-200'}`;\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Settings className=\"text-brand-blue\" size={24} />\r\n                        Studio Settings\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Basic information and contact details\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={saving || !isDirty}\r\n                    className={`px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 transition ${\r\n                        saving || !isDirty\r\n                            ? 'bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed'\r\n                            : 'bg-brand-blue text-white hover:bg-blue-600'\r\n                    }`}\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                    Save Changes\r\n                </button>\r\n            </div>\r\n\r\n            {/* Basic Info */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Home size={18} className=\"text-brand-blue\" />\r\n                    General Information\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"md:col-span-2\">\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Studio Name *</label>\r\n                        <input {...register(\"studioName\")} className={inputClass(errors.studioName)} placeholder=\"Your Studio Name\" />\r\n                        {errors.studioName && <p className=\"text-red-500 text-xs mt-1\">{errors.studioName.message}</p>}\r\n                    </div>\r\n                    <div className=\"md:col-span-2\">\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Description</label>\r\n                        <textarea \r\n                            {...register(\"studioDescription\")} \r\n                            rows={3} \r\n                            className={inputClass(errors.studioDescription)} \r\n                            placeholder=\"Describe your studio, the vibe, and what makes it special...\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Location */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <MapPin size={18} className=\"text-brand-blue\" />\r\n                    Location\r\n                </h3>\r\n                \r\n                {/* Privacy Toggle */}\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800 mb-4\">\r\n                    <label className=\"flex items-start gap-3 cursor-pointer\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            {...register(\"hideAddress\")}\r\n                            className=\"w-5 h-5 mt-0.5 text-brand-blue rounded\"\r\n                        />\r\n                        <div>\r\n                            <div className=\"font-bold text-gray-700 dark:text-gray-200 flex items-center gap-2\">\r\n                                <Shield size={16} className=\"text-brand-blue\" />\r\n                                Private Home Studio Mode\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                                Your exact address will be hidden from the public map. It will only be revealed after you approve a booking request.\r\n                            </p>\r\n                        </div>\r\n                    </label>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                    <Controller\r\n                        control={control}\r\n                        name=\"address\"\r\n                        render={({ field: { onChange, value } }) => (\r\n                            <AddressAutocomplete\r\n                                label=\"Street Address\"\r\n                                value={value || ''}\r\n                                onChange={onChange}\r\n                                onSelect={(addressData) => {\r\n                                    if (addressData.lat) setValue('lat', addressData.lat);\r\n                                    if (addressData.lng) setValue('lng', addressData.lng);\r\n                                    if (addressData.city) setValue('city', addressData.city, { shouldDirty: true });\r\n                                    if (addressData.state) setValue('state', addressData.state, { shouldDirty: true });\r\n                                    if (addressData.zip) setValue('zip', addressData.zip, { shouldDirty: true });\r\n                                }}\r\n                                placeholder=\"Start typing your address...\"\r\n                                error={errors.address?.message}\r\n                                required\r\n                            />\r\n                        )}\r\n                    />\r\n                    <div className=\"grid grid-cols-3 gap-4\">\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">City</label>\r\n                            <input {...register(\"city\")} className={inputClass()} placeholder=\"City\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">State</label>\r\n                            <input {...register(\"state\")} className={inputClass()} placeholder=\"State\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">ZIP</label>\r\n                            <input {...register(\"zip\")} className={inputClass()} placeholder=\"ZIP Code\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {watchHideAddress && (\r\n                    <div className=\"mt-4 flex items-center gap-2 text-sm text-amber-600 dark:text-amber-400\">\r\n                        <EyeOff size={16} />\r\n                        <span>Address will be hidden until booking approval</span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Contact */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Mail size={18} className=\"text-brand-blue\" />\r\n                    Contact Information\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Email</label>\r\n                        <input {...register(\"email\")} type=\"email\" className={inputClass(errors.email)} placeholder=\"studio@email.com\" />\r\n                        {errors.email && <p className=\"text-red-500 text-xs mt-1\">{errors.email.message}</p>}\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Website</label>\r\n                        <input {...register(\"website\")} className={inputClass(errors.website)} placeholder=\"https://yourstudio.com\" />\r\n                        {errors.website && <p className=\"text-red-500 text-xs mt-1\">{errors.website.message}</p>}\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Cell Phone</label>\r\n                        <input {...register(\"phoneCell\")} className={inputClass()} placeholder=\"(555) 123-4567\" />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Landline</label>\r\n                        <input {...register(\"phoneLand\")} className={inputClass()} placeholder=\"(555) 123-4567\" />\r\n                    </div>\r\n                    <div className=\"md:col-span-2\">\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Hours of Operation</label>\r\n                        <input {...register(\"hours\")} className={inputClass()} placeholder=\"e.g. Mon-Fri 9AM-10PM, Sat-Sun 10AM-8PM\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Amenities */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Wifi size={18} className=\"text-brand-blue\" />\r\n                    Amenities\r\n                </h3>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    {AMENITIES_DATA.map(amenity => (\r\n                        <button\r\n                            key={amenity}\r\n                            type=\"button\"\r\n                            onClick={() => toggleAmenity(amenity)}\r\n                            className={`px-3 py-2 rounded-lg text-sm font-medium transition-all border ${\r\n                                watchedAmenities?.includes(amenity)\r\n                                    ? \"bg-brand-blue text-white border-brand-blue shadow-md\"\r\n                                    : \"bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700\"\r\n                            }`}\r\n                        >\r\n                            {amenity}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Save Button (Bottom) */}\r\n            <div className=\"flex justify-end\">\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={saving || !isDirty}\r\n                    className={`px-8 py-3 rounded-xl font-bold text-lg flex items-center gap-2 transition shadow-lg ${\r\n                        saving || !isDirty\r\n                            ? 'bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed'\r\n                            : 'bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]'\r\n                    }`}\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={20} /> : <Save size={20} />}\r\n                    Save Settings\r\n                </button>\r\n            </div>\r\n        </form>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { X, User, Mail, Phone, Building, Tag, Calendar, DollarSign, Edit3, Save, XCircle, Search, Plus, UserPlus, Users } from 'lucide-react';\r\nimport { CLIENT_TYPES } from '../../../config/constants';\r\n\r\n/**\r\n * ClientDetailsModal - View and edit client details\r\n * Features:\r\n * - View full client profile\r\n * - Edit client information\r\n * - Search platform users to add as clients\r\n * - Add off-platform clients\r\n */\r\nexport default function ClientDetailsModal({ client, onClose, onUpdate, studioId, mode = 'view' }) {\r\n    const [isEditing, setIsEditing] = useState(mode === 'edit');\r\n    const [isAddingNew, setIsAddingNew] = useState(mode === 'add');\r\n    const [searchMode, setSearchMode] = useState('off-platform'); // 'platform' or 'off-platform'\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [searchResults, setSearchResults] = useState([]);\r\n    const [searching, setSearching] = useState(false);\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        email: '',\r\n        phone: '',\r\n        company: '',\r\n        client_type: 'regular',\r\n        notes: '',\r\n        client_id: null\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (client && !isAddingNew) {\r\n            setFormData({\r\n                name: client.name || '',\r\n                email: client.email || '',\r\n                phone: client.phone || '',\r\n                company: client.company || '',\r\n                client_type: client.client_type || 'regular',\r\n                notes: client.notes || '',\r\n                client_id: client.client_id || null\r\n            });\r\n        }\r\n    }, [client, isAddingNew]);\r\n\r\n    const handleSearchPlatformUsers = async () => {\r\n        if (!searchTerm.trim() || searching) return;\r\n\r\n        setSearching(true);\r\n        try {\r\n            const response = await fetch(\r\n                `/api/studio-ops/clients/search-users?search=${encodeURIComponent(searchTerm)}&studioId=${studioId}&limit=10`\r\n            );\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                setSearchResults(data.data);\r\n            } else {\r\n                console.error('Search failed:', data.error);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error searching users:', error);\r\n        } finally {\r\n            setSearching(false);\r\n        }\r\n    };\r\n\r\n    const handleSelectPlatformUser = (user) => {\r\n        setFormData({\r\n            ...formData,\r\n            name: user.display_name || user.profile_name || user.username,\r\n            email: user.email,\r\n            client_id: user.user_id,\r\n            company: ''\r\n        });\r\n        setSearchResults([]);\r\n        setSearchTerm('');\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        try {\r\n            const url = isAddingNew\r\n                ? '/api/studio-ops/clients'\r\n                : `/api/studio-ops/clients/${client.id}`;\r\n\r\n            const method = isAddingNew ? 'POST' : 'PUT';\r\n\r\n            const response = await fetch(url, {\r\n                method,\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    ...formData,\r\n                    studioId,\r\n                    clientType: formData.client_type\r\n                })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success) {\r\n                onUpdate(data.data);\r\n                onClose();\r\n            } else {\r\n                alert(`Error: ${data.error || 'Failed to save client'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error saving client:', error);\r\n            alert('Failed to save client. Please try again.');\r\n        }\r\n    };\r\n\r\n    const formatCurrency = (amount) => {\r\n        return new Intl.NumberFormat('en-US', {\r\n            style: 'currency',\r\n            currency: 'USD'\r\n        }).format(amount || 0);\r\n    };\r\n\r\n    if (isAddingNew) {\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n                    {/* Header */}\r\n                    <div className=\"p-6 border-b dark:border-gray-700 flex items-center justify-between\">\r\n                        <div>\r\n                            <h3 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                                <UserPlus size={20} />\r\n                                Add New Client\r\n                            </h3>\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                                Choose how to add this client\r\n                            </p>\r\n                        </div>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors\"\r\n                        >\r\n                            <X size={20} className=\"dark:text-gray-400\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Client Type Selection */}\r\n                    <div className=\"p-6 border-b dark:border-gray-700\">\r\n                        <div className=\"flex gap-4 mb-4\">\r\n                            <button\r\n                                onClick={() => setSearchMode('off-platform')}\r\n                                className={`flex-1 p-4 rounded-lg border-2 transition-all ${\r\n                                    searchMode === 'off-platform'\r\n                                        ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/20'\r\n                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\r\n                                }`}\r\n                            >\r\n                                <UserPlus className=\"mx-auto mb-2\" size={24} />\r\n                                <div className=\"font-semibold dark:text-white\">Off-Platform Client</div>\r\n                                <div className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\r\n                                    Client not registered on SeshNx\r\n                                </div>\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={() => setSearchMode('platform')}\r\n                                className={`flex-1 p-4 rounded-lg border-2 transition-all ${\r\n                                    searchMode === 'platform'\r\n                                        ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/20'\r\n                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\r\n                                }`}\r\n                            >\r\n                                <Users className=\"mx-auto mb-2\" size={24} />\r\n                                <div className=\"font-semibold dark:text-white\">Platform User</div>\r\n                                <div className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\r\n                                    Search for existing SeshNx users\r\n                                </div>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Platform User Search */}\r\n                    {searchMode === 'platform' && (\r\n                        <div className=\"p-6 border-b dark:border-gray-700\">\r\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                                Search Platform Users\r\n                            </label>\r\n                            <div className=\"flex gap-2\">\r\n                                <div className=\"flex-1 relative\">\r\n                                    <Search size={18} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Search by username, email, or name...\"\r\n                                        value={searchTerm}\r\n                                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                                        onKeyPress={(e) => e.key === 'Enter' && handleSearchPlatformUsers()}\r\n                                        className=\"w-full pl-10 pr-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                    />\r\n                                </div>\r\n                                <button\r\n                                    onClick={handleSearchPlatformUsers}\r\n                                    disabled={searching || !searchTerm.trim()}\r\n                                    className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg transition-colors\"\r\n                                >\r\n                                    {searching ? 'Searching...' : 'Search'}\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Search Results */}\r\n                            {searchResults.length > 0 && (\r\n                                <div className=\"mt-4 max-h-60 overflow-y-auto\">\r\n                                    <div className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">\r\n                                        Found {searchResults.length} user{searchResults.length !== 1 ? 's' : ''}\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        {searchResults.map((user) => (\r\n                                            <button\r\n                                                key={user.user_id}\r\n                                                onClick={() => handleSelectPlatformUser(user)}\r\n                                                className=\"w-full p-3 text-left bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors flex items-center gap-3\"\r\n                                            >\r\n                                                {user.photo_url ? (\r\n                                                    <img\r\n                                                        src={user.photo_url}\r\n                                                        alt={user.display_name}\r\n                                                        className=\"w-10 h-10 rounded-full object-cover\"\r\n                                                    />\r\n                                                ) : (\r\n                                                    <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white font-semibold\">\r\n                                                        {(user.display_name || user.username || '?').charAt(0).toUpperCase()}\r\n                                                    </div>\r\n                                                )}\r\n                                                <div className=\"flex-1 min-w-0\">\r\n                                                    <div className=\"font-semibold dark:text-white truncate\">\r\n                                                        {user.display_name || user.profile_name || user.username}\r\n                                                    </div>\r\n                                                    <div className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">\r\n                                                        {user.email}\r\n                                                    </div>\r\n                                                </div>\r\n                                                <Plus size={18} className=\"text-purple-600 dark:text-purple-400 flex-shrink-0\" />\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Client Form */}\r\n                    <div className=\"p-6\">\r\n                        <div className=\"space-y-4\">\r\n                            {searchMode === 'platform' && formData.client_id && (\r\n                                <div className=\"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-center gap-2\">\r\n                                    <User size={18} className=\"text-green-600 dark:text-green-400\" />\r\n                                    <span className=\"text-sm text-green-700 dark:text-green-300\">\r\n                                        Platform user selected: <strong>{formData.name}</strong>\r\n                                    </span>\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            setFormData({ ...formData, client_id: null, name: '', email: '' });\r\n                                        }}\r\n                                        className=\"ml-auto\"\r\n                                    >\r\n                                        <XCircle size={16} className=\"text-green-600 dark:text-green-400\" />\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Name *\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    required\r\n                                    value={formData.name}\r\n                                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                                    disabled={searchMode === 'platform' && !!formData.client_id}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:cursor-not-allowed\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Email\r\n                                </label>\r\n                                <input\r\n                                    type=\"email\"\r\n                                    value={formData.email}\r\n                                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                                    disabled={searchMode === 'platform' && !!formData.client_id}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:cursor-not-allowed\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Phone\r\n                                </label>\r\n                                <input\r\n                                    type=\"tel\"\r\n                                    value={formData.phone}\r\n                                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Company\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={formData.company}\r\n                                    onChange={(e) => setFormData({ ...formData, company: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Client Type *\r\n                                </label>\r\n                                <select\r\n                                    required\r\n                                    value={formData.client_type}\r\n                                    onChange={(e) => setFormData({ ...formData, client_type: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                >\r\n                                    {CLIENT_TYPES.map(type => (\r\n                                        <option key={type.id} value={type.id}>{type.label}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Notes\r\n                                </label>\r\n                                <textarea\r\n                                    rows=\"3\"\r\n                                    value={formData.notes}\r\n                                    onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-3 mt-6\">\r\n                            <button\r\n                                onClick={onClose}\r\n                                className=\"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleSave}\r\n                                disabled={!formData.name}\r\n                                className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Plus size={18} />\r\n                                Add Client\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // View/Edit Mode\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b dark:border-gray-700 flex items-center justify-between\">\r\n                    <div>\r\n                        <h3 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                            <User size={20} />\r\n                            {isEditing ? 'Edit Client' : 'Client Details'}\r\n                        </h3>\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                            {isEditing ? 'Update client information' : 'View full client profile'}\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        {!isEditing && (\r\n                            <button\r\n                                onClick={() => setIsEditing(true)}\r\n                                className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors\"\r\n                                title=\"Edit client\"\r\n                            >\r\n                                <Edit3 size={18} className=\"dark:text-gray-400\" />\r\n                            </button>\r\n                        )}\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors\"\r\n                        >\r\n                            <X size={20} className=\"dark:text-gray-400\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"p-6 space-y-6\">\r\n                    {/* Client Type Badge */}\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {client?.client_id && (\r\n                                <div className=\"flex items-center gap-2 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full text-sm\">\r\n                                    <Users size={14} />\r\n                                    Platform User\r\n                                </div>\r\n                            )}\r\n                            <span className={`px-3 py-1 text-sm font-medium rounded-full ${\r\n                                client?.client_type === 'vip' ? 'bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400' :\r\n                                client?.client_type === 'regular' ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400' :\r\n                                client?.client_type === 'prospect' ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400' :\r\n                                'bg-gray-100 dark:bg-gray-900/30 text-gray-600 dark:text-gray-400'\r\n                            }`}>\r\n                                {CLIENT_TYPES.find(t => t.id === client?.client_type)?.label || 'Unknown'}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Edit Form */}\r\n                    {isEditing ? (\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Name *\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    required\r\n                                    value={formData.name}\r\n                                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Email\r\n                                </label>\r\n                                <input\r\n                                    type=\"email\"\r\n                                    value={formData.email}\r\n                                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Phone\r\n                                </label>\r\n                                <input\r\n                                    type=\"tel\"\r\n                                    value={formData.phone}\r\n                                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Company\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={formData.company}\r\n                                    onChange={(e) => setFormData({ ...formData, company: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Client Type *\r\n                                </label>\r\n                                <select\r\n                                    required\r\n                                    value={formData.client_type}\r\n                                    onChange={(e) => setFormData({ ...formData, client_type: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                >\r\n                                    {CLIENT_TYPES.map(type => (\r\n                                        <option key={type.id} value={type.id}>{type.label}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Notes\r\n                                </label>\r\n                                <textarea\r\n                                    rows=\"3\"\r\n                                    value={formData.notes}\r\n                                    onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-3 pt-4\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        setIsEditing(false);\r\n                                        if (client) {\r\n                                            setFormData({\r\n                                                name: client.name || '',\r\n                                                email: client.email || '',\r\n                                                phone: client.phone || '',\r\n                                                company: client.company || '',\r\n                                                client_type: client.client_type || 'regular',\r\n                                                notes: client.notes || '',\r\n                                                client_id: client.client_id || null\r\n                                            });\r\n                                        }\r\n                                    }}\r\n                                    className=\"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleSave}\r\n                                    className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors flex items-center justify-center gap-2\"\r\n                                >\r\n                                    <Save size={18} />\r\n                                    Save Changes\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        // View Mode\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                <div className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                                    <Mail size={18} className=\"text-gray-600 dark:text-gray-400\" />\r\n                                    <div className=\"min-w-0\">\r\n                                        <div className=\"text-xs text-gray-600 dark:text-gray-400\">Email</div>\r\n                                        <div className=\"font-medium dark:text-white truncate\">{client?.email || 'Not provided'}</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                                    <Phone size={18} className=\"text-gray-600 dark:text-gray-400\" />\r\n                                    <div className=\"min-w-0\">\r\n                                        <div className=\"text-xs text-gray-600 dark:text-gray-400\">Phone</div>\r\n                                        <div className=\"font-medium dark:text-white\">{client?.phone || 'Not provided'}</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                                    <Building size={18} className=\"text-gray-600 dark:text-gray-400\" />\r\n                                    <div className=\"min-w-0\">\r\n                                        <div className=\"text-xs text-gray-600 dark:text-gray-400\">Company</div>\r\n                                        <div className=\"font-medium dark:text-white truncate\">{client?.company || 'Not provided'}</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                                    <Calendar size={18} className=\"text-gray-600 dark:text-gray-400\" />\r\n                                    <div className=\"min-w-0\">\r\n                                        <div className=\"text-xs text-gray-600 dark:text-gray-400\">Client Since</div>\r\n                                        <div className=\"font-medium dark:text-white\">\r\n                                            {client?.created_at ? new Date(client.created_at).toLocaleDateString() : 'N/A'}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {client?.notes && (\r\n                                <div className=\"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                                    <div className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">Notes</div>\r\n                                    <div className=\"text-sm dark:text-white\">{client.notes}</div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Stats */}\r\n                            <div className=\"grid grid-cols-3 gap-4\">\r\n                                <div className=\"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-center\">\r\n                                    <div className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">{client?.total_bookings || 0}</div>\r\n                                    <div className=\"text-xs text-gray-600 dark:text-gray-400\">Total Bookings</div>\r\n                                </div>\r\n                                <div className=\"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-center\">\r\n                                    <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{formatCurrency(client?.total_spent)}</div>\r\n                                    <div className=\"text-xs text-gray-600 dark:text-gray-400\">Lifetime Value</div>\r\n                                </div>\r\n                                <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-center\">\r\n                                    <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\r\n                                        {client?.first_booking_date\r\n                                            ? new Date(client.first_booking_date).toLocaleDateString()\r\n                                            : 'N/A'}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-gray-600 dark:text-gray-400\">First Booking</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {client?.tags && client.tags.length > 0 && (\r\n                                <div>\r\n                                    <div className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">Tags</div>\r\n                                    <div className=\"flex flex-wrap gap-2\">\r\n                                        {client.tags.map((tag, index) => (\r\n                                            <span key={index} className=\"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded\">\r\n                                                {tag}\r\n                                            </span>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Users, Plus, Search, Mail, Phone, Building, Tag, DollarSign, Calendar, Edit2, Trash2, X } from 'lucide-react';\r\nimport { CLIENT_TYPES } from '../../config/constants';\r\nimport ClientDetailsModal from './clients/ClientDetailsModal';\r\n\r\n/**\r\n * StudioClients - Client database and CRM management\r\n * Phase 1: Full CRUD functionality with search, filter, add, edit, delete\r\n */\r\nexport default function StudioClients({ user, userData }) {\r\n    const [clients, setClients] = useState([]);\r\n    const [filteredClients, setFilteredClients] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [filterType, setFilterType] = useState('all');\r\n    const [showClientModal, setShowClientModal] = useState(false);\r\n    const [selectedClient, setSelectedClient] = useState(null);\r\n    const [modalMode, setModalMode] = useState('view'); // 'view', 'edit', 'add'\r\n\r\n    // Fetch clients on mount\r\n    useEffect(() => {\r\n        fetchClients();\r\n    }, []);\r\n\r\n    // Filter clients based on search and type\r\n    useEffect(() => {\r\n        let filtered = clients;\r\n\r\n        // Filter by type\r\n        if (filterType !== 'all') {\r\n            filtered = filtered.filter(client => client.client_type === filterType);\r\n        }\r\n\r\n        // Filter by search term\r\n        if (searchTerm) {\r\n            const term = searchTerm.toLowerCase();\r\n            filtered = filtered.filter(client =>\r\n                client.name?.toLowerCase().includes(term) ||\r\n                client.email?.toLowerCase().includes(term) ||\r\n                client.company?.toLowerCase().includes(term)\r\n            );\r\n        }\r\n\r\n        setFilteredClients(filtered);\r\n    }, [clients, searchTerm, filterType]);\r\n\r\n    const fetchClients = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // TODO: Replace with actual API call\r\n            // const response = await fetch(`/api/studio-ops/clients?studioId=${userData?.id}`);\r\n            // const data = await response.json();\r\n\r\n            // Mock data for now\r\n            const mockClients = [\r\n                {\r\n                    id: '1',\r\n                    name: 'John Doe',\r\n                    email: 'john@example.com',\r\n                    phone: '555-0101',\r\n                    company: 'Doe Productions',\r\n                    client_type: 'vip',\r\n                    tags: ['recording', 'mixing'],\r\n                    notes: 'Regular weekly sessions',\r\n                    total_bookings: 24,\r\n                    total_spent: 12000,\r\n                    first_booking_date: '2024-01-15',\r\n                    last_booking_date: '2025-01-10',\r\n                    created_at: '2024-01-15T10:00:00Z'\r\n                },\r\n                {\r\n                    id: '2',\r\n                    name: 'Jane Smith',\r\n                    email: 'jane@example.com',\r\n                    phone: '555-0102',\r\n                    company: 'Smith Music LLC',\r\n                    client_type: 'regular',\r\n                    tags: ['recording'],\r\n                    notes: 'Prefers morning sessions',\r\n                    total_bookings: 8,\r\n                    total_spent: 3200,\r\n                    first_booking_date: '2024-06-01',\r\n                    last_booking_date: '2024-12-20',\r\n                    created_at: '2024-06-01T14:30:00Z'\r\n                },\r\n                {\r\n                    id: '3',\r\n                    name: 'Bob Johnson',\r\n                    email: 'bob@potential.com',\r\n                    phone: '555-0103',\r\n                    company: null,\r\n                    client_type: 'prospect',\r\n                    tags: ['inquiry'],\r\n                    notes: 'Interested in booking for February',\r\n                    total_bookings: 0,\r\n                    total_spent: 0,\r\n                    first_booking_date: null,\r\n                    last_booking_date: null,\r\n                    created_at: '2025-01-05T09:00:00Z'\r\n                }\r\n            ];\r\n\r\n            setClients(mockClients);\r\n        } catch (error) {\r\n            console.error('Error fetching clients:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleAddClient = () => {\r\n        setSelectedClient(null);\r\n        setModalMode('add');\r\n        setShowClientModal(true);\r\n    };\r\n\r\n    const handleEditClient = (client) => {\r\n        setSelectedClient(client);\r\n        setModalMode('edit');\r\n        setShowClientModal(true);\r\n    };\r\n\r\n    const handleViewClient = (client) => {\r\n        setSelectedClient(client);\r\n        setModalMode('view');\r\n        setShowClientModal(true);\r\n    };\r\n\r\n    const handleDeleteClient = async (clientId) => {\r\n        if (!confirm('Are you sure you want to delete this client?')) return;\r\n\r\n        try {\r\n            const response = await fetch(`/api/studio-ops/clients/${clientId}`, {\r\n                method: 'DELETE'\r\n            });\r\n\r\n            if (response.ok) {\r\n                setClients(clients.filter(client => client.id !== clientId));\r\n            } else {\r\n                const data = await response.json();\r\n                alert(`Error: ${data.error || 'Failed to delete client'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error deleting client:', error);\r\n            // Fallback to mock deletion\r\n            setClients(clients.filter(client => client.id !== clientId));\r\n        }\r\n    };\r\n\r\n    const handleClientUpdate = (updatedClient) => {\r\n        if (modalMode === 'add') {\r\n            setClients([...clients, updatedClient]);\r\n        } else if (modalMode === 'edit') {\r\n            setClients(clients.map(client =>\r\n                client.id === updatedClient.id ? updatedClient : client\r\n            ));\r\n        }\r\n        setShowClientModal(false);\r\n        setSelectedClient(null);\r\n    };\r\n\r\n    const getClientTypeColor = (type) => {\r\n        const clientType = CLIENT_TYPES.find(t => t.id === type);\r\n        return clientType?.color || 'gray';\r\n    };\r\n\r\n    const formatCurrency = (amount) => {\r\n        return new Intl.NumberFormat('en-US', {\r\n            style: 'currency',\r\n            currency: 'USD'\r\n        }).format(amount);\r\n    };\r\n\r\n    const stats = {\r\n        total: clients.length,\r\n        vip: clients.filter(c => c.client_type === 'vip').length,\r\n        regular: clients.filter(c => c.client_type === 'regular').length,\r\n        prospect: clients.filter(c => c.client_type === 'prospect').length,\r\n        totalRevenue: clients.reduce((sum, c) => sum + (c.total_spent || 0), 0)\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center text-white\">\r\n                                <Users size={20} />\r\n                            </div>\r\n                            Client Database\r\n                        </h2>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\r\n                            Manage your client relationships and track bookings\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleAddClient}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors\"\r\n                    >\r\n                        <Plus size={18} />\r\n                        Add Client\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Stats Cards */}\r\n                <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n                    <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold dark:text-white\">{stats.total}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Clients</div>\r\n                    </div>\r\n                    <div className=\"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">{stats.vip}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">VIP</div>\r\n                    </div>\r\n                    <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{stats.regular}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Regular</div>\r\n                    </div>\r\n                    <div className=\"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">{stats.prospect}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Prospects</div>\r\n                    </div>\r\n                    <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{formatCurrency(stats.totalRevenue)}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Revenue</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Search and Filter */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-4\">\r\n                <div className=\"flex flex-col md:flex-row gap-4\">\r\n                    {/* Search */}\r\n                    <div className=\"flex-1 relative\">\r\n                        <Search size={18} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search clients by name, email, or company...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Filter */}\r\n                    <select\r\n                        value={filterType}\r\n                        onChange={(e) => setFilterType(e.target.value)}\r\n                        className=\"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n                    >\r\n                        <option value=\"all\">All Types</option>\r\n                        {CLIENT_TYPES.map(type => (\r\n                            <option key={type.id} value={type.id}>{type.label}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Client List */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                {loading ? (\r\n                    <div className=\"p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                        Loading clients...\r\n                    </div>\r\n                ) : filteredClients.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                        {searchTerm || filterType !== 'all' ? 'No clients match your search' : 'No clients yet. Add your first client to get started.'}\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y dark:divide-gray-700\">\r\n                        {filteredClients.map((client) => (\r\n                            <div key={client.id} className=\"p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center gap-3 mb-2\">\r\n                                            <h3 className=\"text-lg font-semibold dark:text-white\">{client.name}</h3>\r\n                                            <span className={`px-2 py-1 text-xs font-medium rounded-full bg-${getClientTypeColor(client.client_type)}-100 dark:bg-${getClientTypeColor(client.client_type)}-900/30 text-${getClientTypeColor(client.client_type)}-600 dark:text-${getClientTypeColor(client.client_type)}-400`}>\r\n                                                {CLIENT_TYPES.find(t => t.id === client.client_type)?.label || 'Unknown'}\r\n                                            </span>\r\n                                        </div>\r\n\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                                            {client.email && (\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Mail size={14} />\r\n                                                    {client.email}\r\n                                                </div>\r\n                                            )}\r\n                                            {client.phone && (\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Phone size={14} />\r\n                                                    {client.phone}\r\n                                                </div>\r\n                                            )}\r\n                                            {client.company && (\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Building size={14} />\r\n                                                    {client.company}\r\n                                                </div>\r\n                                            )}\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <Calendar size={14} />\r\n                                                {client.total_bookings} booking{client.total_bookings !== 1 ? 's' : ''}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {client.notes && (\r\n                                            <p className=\"mt-2 text-sm text-gray-500 dark:text-gray-500 line-clamp-1\">\r\n                                                {client.notes}\r\n                                            </p>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    <div className=\"flex items-center gap-2 ml-4\">\r\n                                        <div className=\"text-right mr-4\">\r\n                                            <div className=\"text-lg font-semibold text-green-600 dark:text-green-400\">\r\n                                                {formatCurrency(client.total_spent)}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-gray-500 dark:text-gray-400\">Lifetime value</div>\r\n                                        </div>\r\n                                        <button\r\n                                            onClick={() => handleEditClient(client)}\r\n                                            className=\"p-2 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors\"\r\n                                            title=\"Edit client\"\r\n                                        >\r\n                                            <Edit2 size={16} />\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => handleDeleteClient(client.id)}\r\n                                            className=\"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors\"\r\n                                            title=\"Delete client\"\r\n                                        >\r\n                                            <Trash2 size={16} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Client Details Modal */}\r\n            {showClientModal && (\r\n                <ClientDetailsModal\r\n                    client={selectedClient}\r\n                    onClose={() => {\r\n                        setShowClientModal(false);\r\n                        setSelectedClient(null);\r\n                    }}\r\n                    onUpdate={handleClientUpdate}\r\n                    studioId={userData?.id}\r\n                    mode={modalMode}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Briefcase, Plus, Search, Mail, Phone, DollarSign, Calendar, Edit2, Trash2, X, Clock, UserCheck } from 'lucide-react';\r\nimport { STAFF_ROLES } from '../../config/constants';\r\n\r\n/**\r\n * StudioStaff - Staff management and scheduling\r\n * Phase 1: Full CRUD functionality with search, filter, add, edit, delete\r\n */\r\nexport default function StudioStaff({ user, userData }) {\r\n    const [staff, setStaff] = useState([]);\r\n    const [filteredStaff, setFilteredStaff] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [filterRole, setFilterRole] = useState('all');\r\n    const [filterStatus, setFilterStatus] = useState('all');\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [showEditModal, setShowEditModal] = useState(false);\r\n    const [selectedStaff, setSelectedStaff] = useState(null);\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        email: '',\r\n        phone: '',\r\n        role: 'assistant',\r\n        pay_rate_type: 'hourly',\r\n        pay_rate: '',\r\n        skills: [],\r\n        status: 'active',\r\n        hire_date: ''\r\n    });\r\n\r\n    // Fetch staff on mount\r\n    useEffect(() => {\r\n        fetchStaff();\r\n    }, []);\r\n\r\n    // Filter staff based on search and filters\r\n    useEffect(() => {\r\n        let filtered = staff;\r\n\r\n        // Filter by role\r\n        if (filterRole !== 'all') {\r\n            filtered = filtered.filter(member => member.role === filterRole);\r\n        }\r\n\r\n        // Filter by status\r\n        if (filterStatus !== 'all') {\r\n            filtered = filtered.filter(member => member.status === filterStatus);\r\n        }\r\n\r\n        // Filter by search term\r\n        if (searchTerm) {\r\n            const term = searchTerm.toLowerCase();\r\n            filtered = filtered.filter(member =>\r\n                member.name?.toLowerCase().includes(term) ||\r\n                member.email?.toLowerCase().includes(term) ||\r\n                member.role?.toLowerCase().includes(term)\r\n            );\r\n        }\r\n\r\n        setFilteredStaff(filtered);\r\n    }, [staff, searchTerm, filterRole, filterStatus]);\r\n\r\n    const fetchStaff = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // TODO: Replace with actual API call\r\n            // const response = await fetch(`/api/studio-ops/staff?studioId=${userData?.id}`);\r\n            // const data = await response.json();\r\n\r\n            // Mock data for now\r\n            const mockStaff = [\r\n                {\r\n                    id: '1',\r\n                    name: 'Mike Chen',\r\n                    email: 'mike@studio.com',\r\n                    phone: '555-0201',\r\n                    role: 'engineer',\r\n                    pay_rate_type: 'hourly',\r\n                    pay_rate: 75,\r\n                    skills: ['mixing', 'mastering', 'pro-tools'],\r\n                    status: 'active',\r\n                    hire_date: '2023-06-15',\r\n                    total_shifts: 156,\r\n                    hours_worked: 1248,\r\n                    total_earnings: 93600,\r\n                    created_at: '2023-06-15T09:00:00Z'\r\n                },\r\n                {\r\n                    id: '2',\r\n                    name: 'Sarah Williams',\r\n                    email: 'sarah@studio.com',\r\n                    phone: '555-0202',\r\n                    role: 'assistant',\r\n                    pay_rate_type: 'hourly',\r\n                    pay_rate: 25,\r\n                    skills: ['setup', 'teardown', 'equipment'],\r\n                    status: 'active',\r\n                    hire_date: '2024-01-10',\r\n                    total_shifts: 89,\r\n                    hours_worked: 356,\r\n                    total_earnings: 8900,\r\n                    created_at: '2024-01-10T14:00:00Z'\r\n                },\r\n                {\r\n                    id: '3',\r\n                    name: 'Alex Johnson',\r\n                    email: 'alex@studio.com',\r\n                    phone: '555-0203',\r\n                    role: 'producer',\r\n                    pay_rate_type: 'per_session',\r\n                    pay_rate: 200,\r\n                    skills: ['production', 'songwriting', 'arrangement'],\r\n                    status: 'active',\r\n                    hire_date: '2023-09-01',\r\n                    total_shifts: 45,\r\n                    hours_worked: 180,\r\n                    total_earnings: 9000,\r\n                    created_at: '2023-09-01T10:30:00Z'\r\n                },\r\n                {\r\n                    id: '4',\r\n                    name: 'Jordan Lee',\r\n                    email: 'jordan@studio.com',\r\n                    phone: '555-0204',\r\n                    role: 'intern',\r\n                    pay_rate_type: 'hourly',\r\n                    pay_rate: 15,\r\n                    skills: ['assistant', 'learning'],\r\n                    status: 'active',\r\n                    hire_date: '2025-01-05',\r\n                    total_shifts: 12,\r\n                    hours_worked: 48,\r\n                    total_earnings: 720,\r\n                    created_at: '2025-01-05T11:00:00Z'\r\n                }\r\n            ];\r\n\r\n            setStaff(mockStaff);\r\n        } catch (error) {\r\n            console.error('Error fetching staff:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleAddStaff = async (e) => {\r\n        e.preventDefault();\r\n\r\n        try {\r\n            // TODO: Replace with actual API call\r\n            // const response = await fetch('/api/studio-ops/staff', {\r\n            //     method: 'POST',\r\n            //     headers: { 'Content-Type': 'application/json' },\r\n            //     body: JSON.stringify({\r\n            //         ...formData,\r\n            //         studio_id: userData?.id,\r\n            //         pay_rate: parseFloat(formData.pay_rate)\r\n            //     })\r\n            // });\r\n\r\n            const newStaff = {\r\n                id: Date.now().toString(),\r\n                ...formData,\r\n                studio_id: userData?.id,\r\n                pay_rate: parseFloat(formData.pay_rate),\r\n                total_shifts: 0,\r\n                hours_worked: 0,\r\n                total_earnings: 0,\r\n                created_at: new Date().toISOString()\r\n            };\r\n\r\n            setStaff([...staff, newStaff]);\r\n            setShowAddModal(false);\r\n            resetForm();\r\n        } catch (error) {\r\n            console.error('Error adding staff:', error);\r\n        }\r\n    };\r\n\r\n    const handleEditStaff = async (e) => {\r\n        e.preventDefault();\r\n\r\n        try {\r\n            // TODO: Replace with actual API call\r\n            // const response = await fetch(`/api/studio-ops/staff/${selectedStaff.id}`, {\r\n            //     method: 'PUT',\r\n            //     headers: { 'Content-Type': 'application/json' },\r\n            //     body: JSON.stringify({\r\n            //         ...formData,\r\n            //         pay_rate: parseFloat(formData.pay_rate)\r\n            //     })\r\n            // });\r\n\r\n            const updatedStaff = staff.map(member =>\r\n                member.id === selectedStaff.id\r\n                    ? { ...member, ...formData, pay_rate: parseFloat(formData.pay_rate) }\r\n                    : member\r\n            );\r\n\r\n            setStaff(updatedStaff);\r\n            setShowEditModal(false);\r\n            setSelectedStaff(null);\r\n            resetForm();\r\n        } catch (error) {\r\n            console.error('Error updating staff:', error);\r\n        }\r\n    };\r\n\r\n    const handleDeleteStaff = async (staffId) => {\r\n        if (!confirm('Are you sure you want to remove this staff member?')) return;\r\n\r\n        try {\r\n            // TODO: Replace with actual API call\r\n            // await fetch(`/api/studio-ops/staff/${staffId}`, {\r\n            //     method: 'DELETE'\r\n            // });\r\n\r\n            setStaff(staff.filter(member => member.id !== staffId));\r\n        } catch (error) {\r\n            console.error('Error deleting staff:', error);\r\n        }\r\n    };\r\n\r\n    const openEditModal = (member) => {\r\n        setSelectedStaff(member);\r\n        setFormData({\r\n            name: member.name || '',\r\n            email: member.email || '',\r\n            phone: member.phone || '',\r\n            role: member.role || 'assistant',\r\n            pay_rate_type: member.pay_rate_type || 'hourly',\r\n            pay_rate: member.pay_rate?.toString() || '',\r\n            skills: member.skills || [],\r\n            status: member.status || 'active',\r\n            hire_date: member.hire_date || ''\r\n        });\r\n        setShowEditModal(true);\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            name: '',\r\n            email: '',\r\n            phone: '',\r\n            role: 'assistant',\r\n            pay_rate_type: 'hourly',\r\n            pay_rate: '',\r\n            skills: [],\r\n            status: 'active',\r\n            hire_date: ''\r\n        });\r\n    };\r\n\r\n    const formatCurrency = (amount) => {\r\n        return new Intl.NumberFormat('en-US', {\r\n            style: 'currency',\r\n            currency: 'USD'\r\n        }).format(amount);\r\n    };\r\n\r\n    const getRoleBadgeColor = (role) => {\r\n        const colors = {\r\n            engineer: 'bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400',\r\n            assistant: 'bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400',\r\n            manager: 'bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400',\r\n            intern: 'bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400',\r\n            technician: 'bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400',\r\n            producer: 'bg-pink-100 text-pink-600 dark:bg-pink-900/30 dark:text-pink-400'\r\n        };\r\n        return colors[role] || 'bg-gray-100 text-gray-600 dark:bg-gray-900/30 dark:text-gray-400';\r\n    };\r\n\r\n    const getStatusBadgeColor = (status) => {\r\n        const colors = {\r\n            active: 'bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400',\r\n            inactive: 'bg-gray-100 text-gray-600 dark:bg-gray-900/30 dark:text-gray-400',\r\n            on_leave: 'bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400'\r\n        };\r\n        return colors[status] || 'bg-gray-100 text-gray-600 dark:bg-gray-900/30 dark:text-gray-400';\r\n    };\r\n\r\n    const stats = {\r\n        total: staff.length,\r\n        active: staff.filter(s => s.status === 'active').length,\r\n        onLeave: staff.filter(s => s.status === 'on_leave').length,\r\n        totalShifts: staff.reduce((sum, s) => sum + (s.total_shifts || 0), 0),\r\n        totalHours: staff.reduce((sum, s) => sum + (s.hours_worked || 0), 0),\r\n        totalPayroll: staff.reduce((sum, s) => sum + (s.total_earnings || 0), 0)\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-6\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg flex items-center justify-center text-white\">\r\n                                <Briefcase size={20} />\r\n                            </div>\r\n                            Staff Management\r\n                        </h2>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\r\n                            Manage your team, schedule shifts, and track performance\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => setShowAddModal(true)}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors\"\r\n                    >\r\n                        <Plus size={18} />\r\n                        Add Staff\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Stats Cards */}\r\n                <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n                    <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold dark:text-white\">{stats.total}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Staff</div>\r\n                    </div>\r\n                    <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{stats.active}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Active</div>\r\n                    </div>\r\n                    <div className=\"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">{stats.onLeave}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">On Leave</div>\r\n                    </div>\r\n                    <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{stats.totalShifts}</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Shifts</div>\r\n                    </div>\r\n                    <div className=\"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4\">\r\n                        <div className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">{stats.totalHours}h</div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Hours Worked</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Search and Filter */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-4\">\r\n                <div className=\"flex flex-col md:flex-row gap-4\">\r\n                    {/* Search */}\r\n                    <div className=\"flex-1 relative\">\r\n                        <Search size={18} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search staff by name, email, or role...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Role Filter */}\r\n                    <select\r\n                        value={filterRole}\r\n                        onChange={(e) => setFilterRole(e.target.value)}\r\n                        className=\"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    >\r\n                        <option value=\"all\">All Roles</option>\r\n                        {STAFF_ROLES.map(role => (\r\n                            <option key={role.id} value={role.id}>{role.label}</option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    {/* Status Filter */}\r\n                    <select\r\n                        value={filterStatus}\r\n                        onChange={(e) => setFilterStatus(e.target.value)}\r\n                        className=\"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    >\r\n                        <option value=\"all\">All Status</option>\r\n                        <option value=\"active\">Active</option>\r\n                        <option value=\"inactive\">Inactive</option>\r\n                        <option value=\"on_leave\">On Leave</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Staff List */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                {loading ? (\r\n                    <div className=\"p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                        Loading staff...\r\n                    </div>\r\n                ) : filteredStaff.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-gray-600 dark:text-gray-400\">\r\n                        {searchTerm || filterRole !== 'all' || filterStatus !== 'all' ? 'No staff members match your search' : 'No staff members yet. Add your first team member to get started.'}\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y dark:divide-gray-700\">\r\n                        {filteredStaff.map((member) => (\r\n                            <div key={member.id} className=\"p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center gap-3 mb-2\">\r\n                                            <h3 className=\"text-lg font-semibold dark:text-white\">{member.name}</h3>\r\n                                            <span className={`px-2 py-1 text-xs font-medium rounded-full ${getRoleBadgeColor(member.role)}`}>\r\n                                                {STAFF_ROLES.find(r => r.id === member.role)?.label || 'Unknown'}\r\n                                            </span>\r\n                                            <span className={`px-2 py-1 text-xs font-medium rounded-full ${getStatusBadgeColor(member.status)}`}>\r\n                                                {member.status === 'on_leave' ? 'On Leave' : member.status}\r\n                                            </span>\r\n                                        </div>\r\n\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                                            {member.email && (\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Mail size={14} />\r\n                                                    {member.email}\r\n                                                </div>\r\n                                            )}\r\n                                            {member.phone && (\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Phone size={14} />\r\n                                                    {member.phone}\r\n                                                </div>\r\n                                            )}\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <DollarSign size={14} />\r\n                                                {member.pay_rate_type === 'hourly' && '$'}\r\n                                                {member.pay_rate}\r\n                                                {member.pay_rate_type === 'hourly' && '/hr'}\r\n                                                {member.pay_rate_type === 'per_session' && '/session'}\r\n                                                {member.pay_rate_type === 'percentage' && '%'}\r\n                                                {member.pay_rate_type === 'salary' && '/yr'}\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <UserCheck size={14} />\r\n                                                Hired {new Date(member.hire_date).toLocaleDateString()}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {member.skills && member.skills.length > 0 && (\r\n                                            <div className=\"mt-2 flex flex-wrap gap-1\">\r\n                                                {member.skills.map((skill, index) => (\r\n                                                    <span key={index} className=\"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded\">\r\n                                                        {skill}\r\n                                                    </span>\r\n                                                ))}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    <div className=\"flex items-center gap-2 ml-4\">\r\n                                        <div className=\"text-right mr-4\">\r\n                                            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                                {member.total_shifts} shifts  {member.hours_worked}h\r\n                                            </div>\r\n                                            <div className=\"text-sm font-semibold text-green-600 dark:text-green-400\">\r\n                                                {formatCurrency(member.total_earnings)}\r\n                                            </div>\r\n                                        </div>\r\n                                        <button\r\n                                            onClick={() => openEditModal(member)}\r\n                                            className=\"p-2 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors\"\r\n                                            title=\"Edit staff\"\r\n                                        >\r\n                                            <Edit2 size={16} />\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => handleDeleteStaff(member.id)}\r\n                                            className=\"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors\"\r\n                                            title=\"Remove staff\"\r\n                                        >\r\n                                            <Trash2 size={16} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Add Staff Modal */}\r\n            {showAddModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-md w-full max-h-[90vh] overflow-y-auto\">\r\n                        <div className=\"p-6 border-b dark:border-gray-700 flex items-center justify-between\">\r\n                            <h3 className=\"text-xl font-bold dark:text-white\">Add Staff Member</h3>\r\n                            <button\r\n                                onClick={() => {\r\n                                    setShowAddModal(false);\r\n                                    resetForm();\r\n                                }}\r\n                                className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors\"\r\n                            >\r\n                                <X size={20} className=\"dark:text-gray-400\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <form onSubmit={handleAddStaff} className=\"p-6 space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Name *\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    required\r\n                                    value={formData.name}\r\n                                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Email\r\n                                </label>\r\n                                <input\r\n                                    type=\"email\"\r\n                                    value={formData.email}\r\n                                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Phone\r\n                                </label>\r\n                                <input\r\n                                    type=\"tel\"\r\n                                    value={formData.phone}\r\n                                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                        Role *\r\n                                    </label>\r\n                                    <select\r\n                                        required\r\n                                        value={formData.role}\r\n                                        onChange={(e) => setFormData({ ...formData, role: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        {STAFF_ROLES.map(role => (\r\n                                            <option key={role.id} value={role.id}>{role.label}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                        Status *\r\n                                    </label>\r\n                                    <select\r\n                                        required\r\n                                        value={formData.status}\r\n                                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        <option value=\"active\">Active</option>\r\n                                        <option value=\"inactive\">Inactive</option>\r\n                                        <option value=\"on_leave\">On Leave</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                        Pay Rate Type *\r\n                                    </label>\r\n                                    <select\r\n                                        required\r\n                                        value={formData.pay_rate_type}\r\n                                        onChange={(e) => setFormData({ ...formData, pay_rate_type: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        <option value=\"hourly\">Hourly</option>\r\n                                        <option value=\"per_session\">Per Session</option>\r\n                                        <option value=\"percentage\">Percentage</option>\r\n                                        <option value=\"salary\">Salary</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                        Pay Rate *\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        step=\"0.01\"\r\n                                        required\r\n                                        value={formData.pay_rate}\r\n                                        onChange={(e) => setFormData({ ...formData, pay_rate: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Hire Date\r\n                                </label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={formData.hire_date}\r\n                                    onChange={(e) => setFormData({ ...formData, hire_date: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-3 pt-4\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => {\r\n                                        setShowAddModal(false);\r\n                                        resetForm();\r\n                                    }}\r\n                                    className=\"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors\"\r\n                                >\r\n                                    Add Staff\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Edit Staff Modal */}\r\n            {showEditModal && selectedStaff && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 max-w-md w-full max-h-[90vh] overflow-y-auto\">\r\n                        <div className=\"p-6 border-b dark:border-gray-700 flex items-center justify-between\">\r\n                            <h3 className=\"text-xl font-bold dark:text-white\">Edit Staff Member</h3>\r\n                            <button\r\n                                onClick={() => {\r\n                                    setShowEditModal(false);\r\n                                    setSelectedStaff(null);\r\n                                    resetForm();\r\n                                }}\r\n                                className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors\"\r\n                            >\r\n                                <X size={20} className=\"dark:text-gray-400\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <form onSubmit={handleEditStaff} className=\"p-6 space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Name *\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    required\r\n                                    value={formData.name}\r\n                                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Email\r\n                                </label>\r\n                                <input\r\n                                    type=\"email\"\r\n                                    value={formData.email}\r\n                                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Phone\r\n                                </label>\r\n                                <input\r\n                                    type=\"tel\"\r\n                                    value={formData.phone}\r\n                                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                        Role *\r\n                                    </label>\r\n                                    <select\r\n                                        required\r\n                                        value={formData.role}\r\n                                        onChange={(e) => setFormData({ ...formData, role: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        {STAFF_ROLES.map(role => (\r\n                                            <option key={role.id} value={role.id}>{role.label}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                        Status *\r\n                                    </label>\r\n                                    <select\r\n                                        required\r\n                                        value={formData.status}\r\n                                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        <option value=\"active\">Active</option>\r\n                                        <option value=\"inactive\">Inactive</option>\r\n                                        <option value=\"on_leave\">On Leave</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                        Pay Rate Type *\r\n                                    </label>\r\n                                    <select\r\n                                        required\r\n                                        value={formData.pay_rate_type}\r\n                                        onChange={(e) => setFormData({ ...formData, pay_rate_type: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        <option value=\"hourly\">Hourly</option>\r\n                                        <option value=\"per_session\">Per Session</option>\r\n                                        <option value=\"percentage\">Percentage</option>\r\n                                        <option value=\"salary\">Salary</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                        Pay Rate *\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        step=\"0.01\"\r\n                                        required\r\n                                        value={formData.pay_rate}\r\n                                        onChange={(e) => setFormData({ ...formData, pay_rate: e.target.value })}\r\n                                        className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                                    Hire Date\r\n                                </label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={formData.hire_date}\r\n                                    onChange={(e) => setFormData({ ...formData, hire_date: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-3 pt-4\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => {\r\n                                        setShowEditModal(false);\r\n                                        setSelectedStaff(null);\r\n                                        resetForm();\r\n                                    }}\r\n                                    className=\"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors\"\r\n                                >\r\n                                    Save Changes\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React from 'react';\r\nimport { TrendingUp } from 'lucide-react';\r\n\r\n/**\r\n * StudioAnalytics - Business insights and reporting\r\n * Phase 1: Basic placeholder - will be expanded with full analytics dashboard\r\n */\r\nexport default function StudioAnalytics({ user, userData }) {\r\n    return (\r\n        <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-8\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center text-white\">\r\n                            <TrendingUp size={20} />\r\n                        </div>\r\n                        Analytics Dashboard\r\n                    </h2>\r\n                    <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\r\n                        Track revenue, utilization, client insights, and business performance\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Coming Soon Content */}\r\n            <div className=\"text-center py-12\">\r\n                <div className=\"w-24 h-24 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                    <TrendingUp size={48} className=\"text-green-600 dark:text-green-400\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-semibold dark:text-white mb-2\">Analytics Dashboard Coming Soon</h3>\r\n                <p className=\"text-gray-600 dark:text-gray-400 max-w-md mx-auto\">\r\n                    This module will include revenue tracking, room utilization, client lifetime value,\r\n                    performance metrics, and custom reports.\r\n                </p>\r\n\r\n                {/* Feature Preview */}\r\n                <div className=\"mt-8 grid grid-cols-1 md:grid-cols-3 gap-4 max-w-3xl mx-auto\">\r\n                    <div className=\"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                        <div className=\"text-2xl mb-2\"></div>\r\n                        <h4 className=\"font-semibold dark:text-white\">Revenue Dashboard</h4>\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">Income trends & forecasts</p>\r\n                    </div>\r\n                    <div className=\"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                        <div className=\"text-2xl mb-2\"></div>\r\n                        <h4 className=\"font-semibold dark:text-white\">Utilization Report</h4>\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">Room usage statistics</p>\r\n                    </div>\r\n                    <div className=\"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                        <div className=\"text-2xl mb-2\"></div>\r\n                        <h4 className=\"font-semibold dark:text-white\">Client Insights</h4>\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">CLV & engagement analysis</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport {\r\n    Home, LayoutGrid, Image, Clock, FileText, Calendar,\r\n    Package, Settings, ChevronRight, Briefcase, Users, TrendingUp\r\n} from 'lucide-react';\r\n// Import sub-components\r\nimport StudioOverview from './studio/StudioOverview';\r\nimport StudioRooms from './studio/StudioRooms';\r\nimport StudioGallery from './studio/StudioGallery';\r\nimport StudioAvailability from './studio/StudioAvailability';\r\nimport StudioPolicies from './studio/StudioPolicies';\r\nimport StudioBookings from './studio/StudioBookings';\r\nimport StudioEquipment from './studio/StudioEquipment';\r\nimport StudioSettings from './studio/StudioSettings';\r\nimport StudioClients from './studio/StudioClients';\r\nimport StudioStaff from './studio/StudioStaff';\r\nimport StudioAnalytics from './studio/StudioAnalytics';\r\n\r\nconst TABS = [\r\n    { id: 'overview', label: 'Overview', icon: Home, description: 'Dashboard & quick stats' },\r\n    { id: 'rooms', label: 'Rooms', icon: LayoutGrid, description: 'Manage studio rooms' },\r\n    { id: 'equipment', label: 'Equipment', icon: Package, description: 'Equipment inventory' },\r\n    { id: 'gallery', label: 'Gallery', icon: Image, description: 'Photo gallery' },\r\n    { id: 'availability', label: 'Hours', icon: Clock, description: 'Operating hours' },\r\n    { id: 'policies', label: 'Policies', icon: FileText, description: 'Rules & pricing' },\r\n    { id: 'bookings', label: 'Bookings', icon: Calendar, description: 'Manage bookings' },\r\n    { id: 'clients', label: 'Clients', icon: Users, description: 'Client database & CRM' },\r\n    { id: 'staff', label: 'Staff', icon: Briefcase, description: 'Staff management & scheduling' },\r\n    { id: 'analytics', label: 'Analytics', icon: TrendingUp, description: 'Business insights & reports' },\r\n    { id: 'settings', label: 'Settings', icon: Settings, description: 'Studio info' },\r\n];\r\n\r\n/**\r\n * StudioManager - Complete studio management interface with tabbed navigation\r\n */\r\nexport default function StudioManager({ user, userData }) {\r\n    const [activeTab, setActiveTab] = useState('overview');\r\n    const [stats, setStats] = useState({\r\n        pendingBookings: 0,\r\n        recentBookings: [],\r\n        totalRevenue: 0\r\n    });\r\n    const [localUserData, setLocalUserData] = useState(userData);\r\n\r\n    // Fetch booking stats\r\n    useEffect(() => {\r\n        const fetchStats = async () => {\r\n            if (!user?.id && !user?.uid) return;\r\n            const userId = userData?.id || user?.id || user?.uid;\r\n\r\n            try {\r\n                // Fetch bookings where user is the studio owner\r\n                const response = await fetch(`/api/studio-ops/bookings?studioId=${userId}`);\r\n                const result = await response.json();\r\n\r\n                if (!response.ok) {\r\n                    throw new Error(result.error || 'Failed to fetch stats');\r\n                }\r\n\r\n                const bookings = result.data || [];\r\n\r\n                const pending = bookings.filter(b => b.status === 'Pending').length;\r\n                const recent = bookings\r\n                    .filter(b => {\r\n                        const bookingDate = new Date(b.date);\r\n                        return bookingDate >= new Date();\r\n                    })\r\n                    .sort((a, b) => new Date(a.date) - new Date(b.date))\r\n                    .slice(0, 5);\r\n                const revenue = bookings\r\n                    .filter(b => b.status === 'Completed')\r\n                    .reduce((sum, b) => sum + (b.totalPrice || b.offer_amount || 0), 0);\r\n\r\n                setStats({\r\n                    pendingBookings: pending,\r\n                    recentBookings: recent,\r\n                    totalRevenue: revenue\r\n                });\r\n            } catch (error) {\r\n                console.error('Error fetching stats:', error);\r\n            }\r\n        };\r\n\r\n        fetchStats();\r\n\r\n        // Refresh stats every 30 seconds\r\n        const interval = setInterval(fetchStats, 30000);\r\n        return () => clearInterval(interval);\r\n    }, [userData?.id, user?.id, user?.uid]);\r\n\r\n    // Handle updates from child components\r\n    const handleUpdate = (updates) => {\r\n        setLocalUserData(prev => ({ ...prev, ...updates }));\r\n    };\r\n\r\n    // Handle navigation from overview\r\n    const handleNavigate = (tabId) => {\r\n        setActiveTab(tabId);\r\n    };\r\n\r\n    const renderContent = () => {\r\n        const commonProps = {\r\n            user,\r\n            userData: localUserData,\r\n            onUpdate: handleUpdate\r\n        };\r\n\r\n        switch (activeTab) {\r\n            case 'overview':\r\n                return <StudioOverview {...commonProps} stats={stats} onNavigate={handleNavigate} />;\r\n            case 'rooms':\r\n                return <StudioRooms {...commonProps} />;\r\n            case 'equipment':\r\n                return <StudioEquipment {...commonProps} />;\r\n            case 'gallery':\r\n                return <StudioGallery {...commonProps} />;\r\n            case 'availability':\r\n                return <StudioAvailability {...commonProps} />;\r\n            case 'policies':\r\n                return <StudioPolicies {...commonProps} />;\r\n            case 'bookings':\r\n                return <StudioBookings {...commonProps} userData={localUserData} />;\r\n            case 'clients':\r\n                return <StudioClients {...commonProps} />;\r\n            case 'staff':\r\n                return <StudioStaff {...commonProps} />;\r\n            case 'analytics':\r\n                return <StudioAnalytics {...commonProps} />;\r\n            case 'settings':\r\n                return <StudioSettings {...commonProps} />;\r\n            default:\r\n                return <StudioOverview {...commonProps} stats={stats} onNavigate={handleNavigate} />;\r\n        }\r\n    };\r\n\r\n    const activeTabInfo = TABS.find(t => t.id === activeTab);\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto pb-20\">\r\n            {/* Header */}\r\n            <div className=\"mb-6\">\r\n                <div className=\"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2\">\r\n                    <Briefcase size={14} />\r\n                    <span>Business Center</span>\r\n                    <ChevronRight size={14} />\r\n                    <span className=\"text-gray-700 dark:text-gray-200\">Studio Manager</span>\r\n                </div>\r\n                <h1 className=\"text-3xl font-bold dark:text-white flex items-center gap-3\">\r\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white\">\r\n                        <Home size={24} />\r\n                    </div>\r\n                    {localUserData?.studioName || localUserData?.profileName || 'Studio Manager'}\r\n                </h1>\r\n            </div>\r\n\r\n            {/* Tab Navigation */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 mb-6 overflow-hidden\">\r\n                <div className=\"flex overflow-x-auto scrollbar-hide\">\r\n                    {TABS.map((tab) => {\r\n                        const Icon = tab.icon;\r\n                        const isActive = activeTab === tab.id;\r\n                        const hasBadge = tab.id === 'bookings' && stats.pendingBookings > 0;\r\n                        \r\n                        return (\r\n                            <button\r\n                                key={tab.id}\r\n                                onClick={() => setActiveTab(tab.id)}\r\n                                className={`flex items-center gap-2 px-5 py-4 text-sm font-medium whitespace-nowrap transition-all border-b-2 relative ${\r\n                                    isActive\r\n                                        ? 'border-brand-blue text-brand-blue bg-blue-50 dark:bg-blue-900/20'\r\n                                        : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800'\r\n                                }`}\r\n                            >\r\n                                <Icon size={18} />\r\n                                {tab.label}\r\n                                {hasBadge && (\r\n                                    <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold\">\r\n                                        {stats.pendingBookings}\r\n                                    </span>\r\n                                )}\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tab Description (Mobile) */}\r\n            <div className=\"md:hidden mb-4 px-1\">\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                    {activeTabInfo?.description}\r\n                </p>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"min-h-[50vh]\">\r\n                {renderContent()}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport { \r\n    ChevronRight, ChevronLeft, Upload, Music, Image as ImageIcon, \r\n    CheckCircle, AlertCircle, Loader2, Info, X, Calendar \r\n} from 'lucide-react';\r\nimport { useMediaUpload } from '../../hooks/useMediaUpload';\r\nimport { DDEX_GENRES, DISTRIBUTION_STORES, RELEASE_TYPES } from '../../config/constants';\r\n\r\n// --- SUB-COMPONENTS FOR STEPS ---\r\n\r\nconst Step1Metadata = ({ data, setData }) => (\r\n    <div className=\"space-y-4 animate-in slide-in-from-right-4\">\r\n        <h3 className=\"text-lg font-bold dark:text-white mb-4\">Release Essentials</h3>\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Release Title</label>\r\n                <input className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.title} onChange={e => setData({...data, title: e.target.value})} placeholder=\"e.g. Dark Side of the Moon\"/>\r\n            </div>\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Primary Artist</label>\r\n                <input className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.primaryArtist} onChange={e => setData({...data, primaryArtist: e.target.value})} placeholder=\"e.g. Pink Floyd\"/>\r\n            </div>\r\n        </div>\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Release Type</label>\r\n                <select className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.type} onChange={e => setData({...data, type: e.target.value})}>\r\n                    {RELEASE_TYPES.map(t => <option key={t.id} value={t.id}>{t.label}</option>)}\r\n                </select>\r\n            </div>\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Primary Genre</label>\r\n                <select className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.genre} onChange={e => setData({...data, genre: e.target.value})}>\r\n                    <option value=\"\">Select Genre...</option>\r\n                    {DDEX_GENRES.map(g => <option key={g} value={g}>{g}</option>)}\r\n                </select>\r\n            </div>\r\n        </div>\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Release Date</label>\r\n                <input type=\"date\" className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.releaseDate} onChange={e => setData({...data, releaseDate: e.target.value})} />\r\n                <p className=\"text-[10px] text-gray-400 mt-1\">Standard: 2 weeks out. Express: 48hrs.</p>\r\n            </div>\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Label Name</label>\r\n                <input className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.labelName} onChange={e => setData({...data, labelName: e.target.value})} placeholder=\"Optional (Default: Independent)\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst Step2Artwork = ({ data, setData, user }) => {\r\n    const { uploadMedia: uploadImage, uploading } = useMediaUpload(); \r\n    const [preview, setPreview] = useState(data.artworkUrl || null);\r\n    const [validationMsg, setValidationMsg] = useState('');\r\n\r\n    const handleFile = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        // Client-side Validation (3000px check)\r\n        const img = new Image();\r\n        img.src = URL.createObjectURL(file);\r\n        img.onload = async () => {\r\n            if (img.width < 3000 || img.height < 3000) {\r\n                setValidationMsg(\"Error: Image must be at least 3000 x 3000 pixels.\");\r\n                return;\r\n            }\r\n            if (img.width !== img.height) {\r\n                setValidationMsg(\"Warning: Image should be a perfect square (1:1 ratio).\");\r\n            } else {\r\n                setValidationMsg(\"\");\r\n            }\r\n\r\n            // Proceed to upload\r\n            const res = await uploadImage(file, `distribution/${user.uid}/artwork`);\r\n            if (res?.url) {\r\n                setPreview(res.url);\r\n                setData({ ...data, artworkUrl: res.url });\r\n            }\r\n        };\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center justify-center space-y-6 animate-in slide-in-from-right-4\">\r\n            <div className=\"text-center space-y-2\">\r\n                <h3 className=\"text-lg font-bold dark:text-white\">Upload Cover Art</h3>\r\n                <p className=\"text-sm text-gray-500\">3000 x 3000 px  JPG or PNG  No Blurry Text</p>\r\n            </div>\r\n\r\n            <div className=\"relative group w-64 h-64 bg-gray-100 dark:bg-[#1f2128] rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center overflow-hidden\">\r\n                {preview ? (\r\n                    <img src={preview} className=\"w-full h-full object-cover\" />\r\n                ) : (\r\n                    <div className=\"text-gray-400 flex flex-col items-center\">\r\n                        <ImageIcon size={48} className=\"mb-2\"/>\r\n                        <span className=\"text-xs font-bold\">Click to Upload</span>\r\n                    </div>\r\n                )}\r\n                \r\n                <label className=\"absolute inset-0 cursor-pointer bg-black/0 hover:bg-black/20 transition flex items-center justify-center\">\r\n                    <input type=\"file\" className=\"hidden\" accept=\"image/png, image/jpeg\" onChange={handleFile} disabled={uploading}/>\r\n                    {uploading && <Loader2 className=\"animate-spin text-white\" size={32}/>}\r\n                </label>\r\n            </div>\r\n\r\n            {validationMsg && (\r\n                <div className=\"text-red-500 text-sm font-bold flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg\">\r\n                    <AlertCircle size={16}/> {validationMsg}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst Step3Tracks = ({ data, setData, user }) => {\r\n    const { uploadMedia, uploading } = useMediaUpload();\r\n    \r\n    const addTrack = async (file) => {\r\n        if (!file.name.toLowerCase().endsWith('.wav')) {\r\n            alert(\"Only .WAV files are accepted for distribution.\");\r\n            return;\r\n        }\r\n\r\n        const newTrack = {\r\n            id: Date.now(),\r\n            title: file.name.replace('.wav', ''),\r\n            fileUrl: '', // Will be filled after upload\r\n            status: 'uploading',\r\n            isExplicit: false,\r\n            isInstrumental: false\r\n        };\r\n\r\n        // Optimistic UI\r\n        const updatedTracks = [...(data.tracks || []), newTrack];\r\n        setData({ ...data, tracks: updatedTracks });\r\n\r\n        // Start Upload\r\n        try {\r\n            // Upload to a private \"Vault\" path\r\n            const res = await uploadMedia(file, `distribution/${user.uid}/audio_vault`);\r\n            if (res?.url) {\r\n                const finalTracks = updatedTracks.map(t => \r\n                    t.id === newTrack.id ? { ...t, fileUrl: res.url, status: 'ready', duration: 0 } : t\r\n                );\r\n                setData({ ...data, tracks: finalTracks });\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Track upload failed\", e);\r\n            alert(\"Upload failed.\");\r\n        }\r\n    };\r\n\r\n    const removeTrack = (id) => {\r\n        setData({ ...data, tracks: data.tracks.filter(t => t.id !== id) });\r\n    };\r\n\r\n    const updateTrackMeta = (id, field, val) => {\r\n        setData({\r\n            ...data,\r\n            tracks: data.tracks.map(t => t.id === id ? { ...t, [field]: val } : t)\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in slide-in-from-right-4\">\r\n            <div className=\"flex justify-between items-end\">\r\n                <div>\r\n                    <h3 className=\"text-lg font-bold dark:text-white\">Upload Audio</h3>\r\n                    <p className=\"text-sm text-gray-500\">Stereo WAV files only (16-bit / 44.1kHz minimum)</p>\r\n                </div>\r\n                <label className=\"bg-brand-blue hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs cursor-pointer flex items-center gap-2 transition\">\r\n                    <Upload size={14}/> Add Track\r\n                    <input type=\"file\" className=\"hidden\" accept=\".wav\" onChange={e => addTrack(e.target.files[0])} disabled={uploading}/>\r\n                </label>\r\n            </div>\r\n\r\n            <div className=\"space-y-3\">\r\n                {data.tracks?.length === 0 && (\r\n                    <div className=\"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400\">\r\n                        No tracks added yet.\r\n                    </div>\r\n                )}\r\n                \r\n                {data.tracks?.map((track, idx) => (\r\n                    <div key={track.id} className=\"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 flex flex-col gap-3\">\r\n                        <div className=\"flex justify-between items-center\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"bg-gray-100 dark:bg-gray-800 p-2 rounded text-gray-500 font-mono text-xs\">\r\n                                    #{idx + 1}\r\n                                </div>\r\n                                <div className=\"font-bold dark:text-white text-sm\">\r\n                                    {track.status === 'uploading' ? <span className=\"flex items-center gap-2 text-brand-blue\"><Loader2 className=\"animate-spin\" size={14}/> Uploading...</span> : track.title}\r\n                                </div>\r\n                            </div>\r\n                            <button onClick={() => removeTrack(track.id)} className=\"text-gray-400 hover:text-red-500\"><X size={16}/></button>\r\n                        </div>\r\n                        \r\n                        {track.status === 'ready' && (\r\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                                <input \r\n                                    className=\"col-span-2 p-2 text-xs border rounded bg-transparent dark:border-gray-600 dark:text-white\" \r\n                                    placeholder=\"Track Title\" \r\n                                    value={track.title} \r\n                                    onChange={e => updateTrackMeta(track.id, 'title', e.target.value)}\r\n                                />\r\n                                <label className=\"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer\">\r\n                                    <input type=\"checkbox\" checked={track.isExplicit} onChange={e => updateTrackMeta(track.id, 'isExplicit', e.target.checked)}/> Explicit\r\n                                </label>\r\n                                <label className=\"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer\">\r\n                                    <input type=\"checkbox\" checked={track.isInstrumental} onChange={e => updateTrackMeta(track.id, 'isInstrumental', e.target.checked)}/> Instrumental\r\n                                </label>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst Step4Stores = ({ data, setData }) => {\r\n    const toggleStore = (storeId) => {\r\n        const current = data.stores || [];\r\n        const updated = current.includes(storeId) \r\n            ? current.filter(s => s !== storeId) \r\n            : [...current, storeId];\r\n        setData({ ...data, stores: updated });\r\n    };\r\n\r\n    const toggleAll = () => {\r\n        if (data.stores?.length === DISTRIBUTION_STORES.length) setData({ ...data, stores: [] });\r\n        else setData({ ...data, stores: DISTRIBUTION_STORES.map(s => s.id) });\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in slide-in-from-right-4\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <h3 className=\"text-lg font-bold dark:text-white\">Select Stores</h3>\r\n                <button onClick={toggleAll} className=\"text-xs font-bold text-brand-blue hover:underline\">\r\n                    {data.stores?.length === DISTRIBUTION_STORES.length ? 'Deselect All' : 'Select All'}\r\n                </button>\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\r\n                {DISTRIBUTION_STORES.map(store => {\r\n                    const isSelected = data.stores?.includes(store.id);\r\n                    return (\r\n                        <div \r\n                            key={store.id} \r\n                            onClick={() => toggleStore(store.id)}\r\n                            className={`p-3 rounded-xl border flex items-center gap-3 cursor-pointer transition-all ${isSelected ? 'bg-blue-50 border-brand-blue dark:bg-blue-900/20' : 'bg-white dark:bg-[#1f2128] dark:border-gray-700 hover:border-gray-300'}`}\r\n                        >\r\n                            <div className={`w-5 h-5 rounded-full border flex items-center justify-center ${isSelected ? 'bg-brand-blue border-brand-blue' : 'border-gray-400'}`}>\r\n                                {isSelected && <CheckCircle size={12} className=\"text-white\"/>}\r\n                            </div>\r\n                            <span className={`text-sm font-bold ${isSelected ? 'text-brand-blue dark:text-white' : 'text-gray-600 dark:text-gray-400'}`}>{store.name}</span>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n            \r\n            <div className=\"bg-yellow-50 dark:bg-yellow-900/10 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800 text-sm text-yellow-800 dark:text-yellow-200 flex items-start gap-3\">\r\n                <Info size={18} className=\"mt-0.5 shrink-0\"/>\r\n                <p>Deliveries usually take 2-5 days for Spotify/Apple, and up to 2 weeks for other stores. Please plan your release date accordingly.</p>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- MAIN WIZARD COMPONENT ---\r\n\r\nexport default function ReleaseBuilder({ user, userData, initialData, onCancel, onSuccess }) {\r\n    const [step, setStep] = useState(1);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    \r\n    // Initial State Template\r\n    const [formData, setFormData] = useState(initialData || {\r\n        title: '',\r\n        primaryArtist: userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() || 'Artist' : 'Artist', // Default to user\r\n        type: 'single',\r\n        genre: '',\r\n        releaseDate: '',\r\n        labelName: '',\r\n        artworkUrl: '',\r\n        tracks: [],\r\n        stores: DISTRIBUTION_STORES.map(s => s.id), // Default all selected\r\n        status: 'Draft'\r\n    });\r\n\r\n    const isStepValid = () => {\r\n        if (step === 1) return formData.title && formData.primaryArtist && formData.genre && formData.releaseDate;\r\n        if (step === 2) return !!formData.artworkUrl;\r\n        if (step === 3) return formData.tracks.length > 0 && formData.tracks.every(t => t.status === 'ready');\r\n        if (step === 4) return formData.stores.length > 0;\r\n        return true;\r\n    };\r\n\r\n    const handleFinalSubmit = async () => {\r\n        if (!supabase) return;\r\n        setSubmitting(true);\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const payload = {\r\n                uploader_id: userId,\r\n                title: formData.title,\r\n                primary_artist: formData.primaryArtist,\r\n                type: formData.type,\r\n                genre: formData.genre,\r\n                release_date: formData.releaseDate,\r\n                label_name: formData.labelName || null,\r\n                artwork_url: formData.artworkUrl || null,\r\n                tracks: formData.tracks || [],\r\n                updated_at: new Date().toISOString(),\r\n                status: 'Processing' // Move to processing queue\r\n            };\r\n\r\n            if (initialData?.id) {\r\n                // Update existing\r\n                await supabase\r\n                    .from('distribution_releases')\r\n                    .update(payload)\r\n                    .eq('id', initialData.id)\r\n                    .eq('uploader_id', userId);\r\n            } else {\r\n                // Create new\r\n                await supabase\r\n                    .from('distribution_releases')\r\n                    .insert({\r\n                        ...payload,\r\n                        created_at: new Date().toISOString()\r\n                    });\r\n            }\r\n            \r\n            alert(\"Release submitted successfully! It is now in the review queue.\");\r\n            onSuccess();\r\n        } catch (e) {\r\n            console.error(\"Submission error:\", e);\r\n            alert(\"Failed to submit release.\");\r\n        }\r\n        setSubmitting(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-4xl mx-auto bg-white dark:bg-[#2c2e36] rounded-2xl shadow-xl overflow-hidden border dark:border-gray-700 min-h-[600px] flex flex-col\">\r\n            {/* Header */}\r\n            <div className=\"bg-gray-50 dark:bg-[#23262f] p-6 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-extrabold dark:text-white\">New Release</h2>\r\n                    <p className=\"text-xs text-gray-500 uppercase font-bold tracking-wider mt-1\">Step {step} of 4</p>\r\n                </div>\r\n                <button onClick={onCancel} className=\"text-gray-400 hover:text-gray-600 dark:hover:text-white\"><X/></button>\r\n            </div>\r\n\r\n            {/* Progress Bar */}\r\n            <div className=\"h-1 bg-gray-200 dark:bg-gray-700 w-full\">\r\n                <div className=\"h-full bg-brand-blue transition-all duration-300\" style={{ width: `${(step / 4) * 100}%` }}></div>\r\n            </div>\r\n\r\n            {/* Body */}\r\n            <div className=\"flex-1 p-8 overflow-y-auto\">\r\n                {step === 1 && <Step1Metadata data={formData} setData={setFormData} />}\r\n                {step === 2 && <Step2Artwork data={formData} setData={setFormData} user={user} />}\r\n                {step === 3 && <Step3Tracks data={formData} setData={setFormData} user={user} />}\r\n                {step === 4 && <Step4Stores data={formData} setData={setFormData} />}\r\n            </div>\r\n\r\n            {/* Footer Controls */}\r\n            <div className=\"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center\">\r\n                {step > 1 ? (\r\n                    <button onClick={() => setStep(step - 1)} className=\"flex items-center gap-2 text-gray-500 font-bold hover:text-gray-800 dark:hover:text-white transition\">\r\n                        <ChevronLeft size={18}/> Back\r\n                    </button>\r\n                ) : <div></div>}\r\n\r\n                {step < 4 ? (\r\n                    <button \r\n                        onClick={() => setStep(step + 1)} \r\n                        disabled={!isStepValid()}\r\n                        className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-600 transition\"\r\n                    >\r\n                        Next Step <ChevronRight size={18}/>\r\n                    </button>\r\n                ) : (\r\n                    <button \r\n                        onClick={handleFinalSubmit} \r\n                        disabled={submitting || !isStepValid()}\r\n                        className=\"bg-green-600 text-white px-8 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 hover:bg-green-700 transition shadow-lg\"\r\n                    >\r\n                        {submitting ? <Loader2 className=\"animate-spin\"/> : \"Submit Release\"}\r\n                    </button>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Plus, Disc, Globe, AlertCircle, CheckCircle, Clock, Edit2, Trash2, X, Music } from 'lucide-react';\r\nimport { useDistributionReleases, useMarketplaceMutations } from '../../hooks/useMarketplace';\r\nimport ReleaseBuilder from '../distribution/ReleaseBuilder';\r\n\r\nexport default function DistributionManager({ user, userData }) {\r\n    const userId = user?.id || user?.uid;\r\n\r\n    // Fetch distribution releases with polling\r\n    const { data: rawReleases, loading } = useDistributionReleases(userId);\r\n\r\n    // Mutation functions\r\n    const { deleteRelease } = useMarketplaceMutations();\r\n\r\n    const [view, setView] = useState('list'); // 'list' or 'create'\r\n    const [editingRelease, setEditingRelease] = useState(null);\r\n\r\n    // Transform raw releases\r\n    const releases = (rawReleases || []).map(r => ({\r\n        id: r.id,\r\n        ...r,\r\n        uploaderId: r.uploader_id,\r\n        updatedAt: r.updated_at,\r\n        createdAt: r.created_at\r\n    }));\r\n\r\n    const handleDelete = async (releaseId, title) => {\r\n        if (!confirm(`Are you sure you want to delete \"${title}\"? This cannot be undone if already distributed.`)) return;\r\n        try {\r\n            await deleteRelease(releaseId);\r\n        } catch (e) {\r\n            console.error(e);\r\n            alert(\"Failed to delete release.\");\r\n        }\r\n    };\r\n\r\n    const handleEdit = (release) => {\r\n        if (release.status !== 'Draft' && release.status !== 'Action Needed') {\r\n            return alert(\"Cannot edit a release that is currently processing or live. Contact support for takedowns.\");\r\n        }\r\n        setEditingRelease(release);\r\n        setView('create');\r\n    };\r\n\r\n    // --- RENDER ---\r\n\r\n    if (view === 'create') {\r\n        return (\r\n            <ReleaseBuilder \r\n                user={user} \r\n                userData={userData} \r\n                initialData={editingRelease}\r\n                onCancel={() => { setView('list'); setEditingRelease(null); }} \r\n                onSuccess={() => { setView('list'); setEditingRelease(null); }}\r\n            />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-end gap-4 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Globe className=\"text-brand-blue\" /> Distribution Portal\r\n                    </h2>\r\n                    <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Manage your catalog across Spotify, Apple Music, and 150+ stores.\r\n                    </p>\r\n                </div>\r\n                <button \r\n                    onClick={() => setView('create')} \r\n                    className=\"bg-brand-blue text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 shadow-lg hover:shadow-blue-500/20\"\r\n                >\r\n                    <Plus size={20} /> New Release\r\n                </button>\r\n            </div>\r\n\r\n            {/* Release List */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 overflow-hidden min-h-[400px]\">\r\n                {loading ? (\r\n                    <div className=\"p-12 text-center text-gray-500\">Loading catalog...</div>\r\n                ) : releases.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 text-center\">\r\n                        <div className=\"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4\">\r\n                            <Disc size={48} className=\"text-gray-400\" />\r\n                        </div>\r\n                        <h3 className=\"text-lg font-bold dark:text-white\">No Releases Yet</h3>\r\n                        <p className=\"text-gray-500 max-w-sm mt-2 mb-6\">Start your journey by uploading your first single, EP, or album to the world.</p>\r\n                        <button onClick={() => setView('create')} className=\"text-brand-blue font-bold hover:underline\">\r\n                            Create First Release\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y dark:divide-gray-700\">\r\n                        {releases.map(release => (\r\n                            <div key={release.id} className=\"p-5 hover:bg-gray-50 dark:hover:bg-white/5 transition flex flex-col md:flex-row md:items-center justify-between gap-4 group\">\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    {/* Artwork Thumbnail */}\r\n                                    <div className=\"h-16 w-16 bg-gray-200 dark:bg-black rounded-lg shadow-sm overflow-hidden shrink-0 border dark:border-gray-700\">\r\n                                        {release.artworkUrl ? (\r\n                                            <img src={release.artworkUrl} alt=\"Art\" className=\"h-full w-full object-cover\" />\r\n                                        ) : (\r\n                                            <div className=\"h-full w-full flex items-center justify-center text-gray-400\"><Music size={20}/></div>\r\n                                        )}\r\n                                    </div>\r\n                                    \r\n                                    {/* Meta */}\r\n                                    <div>\r\n                                        <div className=\"flex items-center gap-2 mb-1\">\r\n                                            <span className={`text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide border ${\r\n                                                release.status === 'Live' ? 'bg-green-100 text-green-700 border-green-200' :\r\n                                                release.status === 'Processing' ? 'bg-blue-100 text-blue-700 border-blue-200' :\r\n                                                release.status === 'Action Needed' ? 'bg-red-100 text-red-700 border-red-200' :\r\n                                                'bg-gray-100 text-gray-600 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600'\r\n                                            }`}>\r\n                                                {release.status}\r\n                                            </span>\r\n                                            <span className=\"text-xs text-gray-400 uppercase font-bold\">{release.type}</span>\r\n                                        </div>\r\n                                        <h4 className=\"font-bold text-lg dark:text-white leading-tight\">{release.title || 'Untitled Release'}</h4>\r\n                                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                                            {release.primaryArtist}  {release.tracks?.length || 0} Tracks\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Actions */}\r\n                                <div className=\"flex items-center gap-4 pl-4 md:pl-0 border-l md:border-l-0 dark:border-gray-700\">\r\n                                    <div className=\"text-right hidden md:block mr-4\">\r\n                                        <div className=\"text-xs text-gray-400 uppercase font-bold\">Release Date</div>\r\n                                        <div className=\"text-sm font-medium dark:text-gray-200\">\r\n                                            {release.releaseDate ? new Date(release.releaseDate).toLocaleDateString() : 'TBD'}\r\n                                        </div>\r\n                                    </div>\r\n                                    \r\n                                    <button \r\n                                        onClick={() => handleEdit(release)}\r\n                                        className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                        title=\"Edit / View Details\"\r\n                                    >\r\n                                        <Edit2 size={18}/>\r\n                                    </button>\r\n                                    \r\n                                    {(release.status === 'Draft' || release.status === 'Action Needed') && (\r\n                                        <button \r\n                                            onClick={() => handleDelete(release.id, release.title)}\r\n                                            className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                            title=\"Delete Release\"\r\n                                        >\r\n                                            <Trash2 size={18}/>\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React from 'react';\r\nimport { Users, Disc, DollarSign, Activity, ChevronRight } from 'lucide-react';\r\n\r\n/**\r\n * LabelOverviewCard - Displays label metrics in the Business Overview\r\n *\r\n * Shows:\r\n * - Total Artists\r\n * - Active Releases\r\n * - Total Revenue\r\n * - Total Streams\r\n */\r\nexport default function LabelOverviewCard({ data, onNavigate }) {\r\n  const formatCurrency = (value) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD',\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 0,\r\n    }).format(value || 0);\r\n  };\r\n\r\n  const formatNumber = (value) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      notation: 'compact',\r\n      maximumFractionDigits: 1,\r\n    }).format(value || 0);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-xl font-bold dark:text-white\">Label Overview</h2>\r\n        <button\r\n          onClick={() => onNavigate && onNavigate('roster')}\r\n          className=\"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1\"\r\n        >\r\n          View Details <ChevronRight size={16} />\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 mb-2\">\r\n            <Users className=\"text-blue-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.total_artists || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Artists</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 mb-2\">\r\n            <Disc className=\"text-purple-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.active_releases || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Releases</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2\">\r\n            <DollarSign className=\"text-green-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{formatCurrency(data?.total_revenue)}</div>\r\n          <div className=\"text-xs text-gray-500\">Revenue</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-orange-50 dark:bg-orange-900/20 mb-2\">\r\n            <Activity className=\"text-orange-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{formatNumber(data?.total_streams)}</div>\r\n          <div className=\"text-xs text-gray-500\">Streams</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Home, Calendar, CheckCircle, ChevronRight } from 'lucide-react';\r\n\r\n/**\r\n * StudioOverviewCard - Displays studio metrics in the Business Overview\r\n *\r\n * Shows:\r\n * - Total Rooms\r\n * - Pending Bookings\r\n * - Completed Bookings\r\n */\r\nexport default function StudioOverviewCard({ data, onNavigate }) {\r\n  return (\r\n    <div className=\"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-xl font-bold dark:text-white\">Studio Overview</h2>\r\n        <button\r\n          onClick={() => onNavigate && onNavigate('studio')}\r\n          className=\"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1\"\r\n        >\r\n          View Details <ChevronRight size={16} />\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-3 gap-4\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 mb-2\">\r\n            <Home className=\"text-blue-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.total_rooms || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Rooms</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-yellow-50 dark:bg-yellow-900/20 mb-2\">\r\n            <Calendar className=\"text-yellow-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.pending_bookings || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Pending</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2\">\r\n            <CheckCircle className=\"text-green-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.completed_bookings || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Completed</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Disc, Play, FileText, ChevronRight } from 'lucide-react';\r\n\r\n/**\r\n * DistributionOverviewCard - Displays distribution metrics in the Business Overview\r\n *\r\n * Shows:\r\n * - Total Releases\r\n * - Live Releases\r\n * - Draft Releases\r\n */\r\nexport default function DistributionOverviewCard({ data, onNavigate }) {\r\n  return (\r\n    <div className=\"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-xl font-bold dark:text-white\">Distribution Overview</h2>\r\n        <button\r\n          onClick={() => onNavigate && onNavigate('distribution')}\r\n          className=\"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1\"\r\n        >\r\n          View Details <ChevronRight size={16} />\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-3 gap-4\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 mb-2\">\r\n            <Disc className=\"text-purple-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.total_releases || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Total</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2\">\r\n            <Play className=\"text-green-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.live_releases || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Live</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-gray-50 dark:bg-gray-900/20 mb-2\">\r\n            <FileText className=\"text-gray-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.draft_releases || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Drafts</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { getLabelMetrics, getStudioMetrics, getDistributionMetrics } from '../../config/neonQueries';\r\nimport LabelOverviewCard from './LabelOverviewCard';\r\nimport StudioOverviewCard from './StudioOverviewCard';\r\nimport DistributionOverviewCard from './DistributionOverviewCard';\r\nimport { Briefcase, Settings2 } from 'lucide-react';\r\n\r\n/**\r\n * BusinessOverview - Enhanced overview with real-time metrics for each business type\r\n *\r\n * Displays sectioned metrics for:\r\n * - Label operations (artists, releases, revenue, streams)\r\n * - Studio operations (rooms, bookings)\r\n * - Distribution (releases)\r\n */\r\nexport default function BusinessOverview({ user, userData, setActiveTab }) {\r\n  const [metrics, setMetrics] = useState({});\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Determine which features the user has access to\r\n  const isStudio = userData?.accountTypes?.includes('Studio');\r\n  const isLabel = userData?.accountTypes?.some(t => ['Label', 'Agent'].includes(t));\r\n  const isArtist = userData?.accountTypes?.some(t => ['Talent', 'Producer', 'Engineer'].includes(t));\r\n  const hasDistribution = isStudio || isLabel || isArtist;\r\n\r\n  useEffect(() => {\r\n    const fetchMetrics = async () => {\r\n      const userId = user?.id || user?.uid;\r\n      if (!userId) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      const results = {};\r\n\r\n      try {\r\n        // Fetch metrics based on account types\r\n        if (isLabel) {\r\n          const labelData = await getLabelMetrics(userId);\r\n          results.label = labelData?.[0] || {};\r\n        }\r\n\r\n        if (isStudio) {\r\n          const studioData = await getStudioMetrics(userId);\r\n          results.studio = studioData?.[0] || {};\r\n        }\r\n\r\n        if (hasDistribution) {\r\n          const distData = await getDistributionMetrics(userId);\r\n          results.distribution = distData?.[0] || {};\r\n        }\r\n\r\n        setMetrics(results);\r\n      } catch (error) {\r\n        console.error('Error fetching business metrics:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchMetrics();\r\n  }, [user?.id, user?.uid, isLabel, isStudio, hasDistribution]);\r\n\r\n  // Quick actions based on roles\r\n  const quickActions = [\r\n    {\r\n      id: 'studio',\r\n      title: 'Studio Settings',\r\n      description: 'Configure your studio rooms, rates, and amenities',\r\n      icon: 'Home',\r\n      color: 'blue',\r\n      show: isStudio\r\n    },\r\n    {\r\n      id: 'distribution',\r\n      title: 'New Release',\r\n      description: 'Distribute your music to 150+ streaming platforms',\r\n      icon: 'Globe',\r\n      color: 'green',\r\n      show: hasDistribution\r\n    },\r\n    {\r\n      id: 'roster',\r\n      title: 'Manage Roster',\r\n      description: 'Sign artists and manage your label roster',\r\n      icon: 'Users',\r\n      color: 'purple',\r\n      show: isLabel\r\n    },\r\n  ].filter(a => a.show);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center p-12\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 animate-in fade-in\">\r\n      {/* Welcome Header */}\r\n      <div className=\"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-8 text-white relative overflow-hidden\">\r\n        <div className=\"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10\"></div>\r\n        <div className=\"relative z-10\">\r\n          <h1 className=\"text-3xl font-bold mb-2\">Business Center</h1>\r\n          <p className=\"text-indigo-100 max-w-xl\">\r\n            Manage your studio operations, distribute music, and grow your roster  all in one place.\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Sectioned Metrics */}\r\n      {isLabel && (\r\n        <LabelOverviewCard data={metrics.label} onNavigate={setActiveTab} />\r\n      )}\r\n\r\n      {isStudio && (\r\n        <StudioOverviewCard data={metrics.studio} onNavigate={setActiveTab} />\r\n      )}\r\n\r\n      {hasDistribution && (\r\n        <DistributionOverviewCard data={metrics.distribution} onNavigate={setActiveTab} />\r\n      )}\r\n\r\n      {/* Quick Actions */}\r\n      {quickActions.length > 0 && (\r\n        <div>\r\n          <h2 className=\"text-lg font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n            <Settings2 size={20} className=\"text-gray-400\" />\r\n            Quick Actions\r\n          </h2>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            {quickActions.map(action => (\r\n              <button\r\n                key={action.id}\r\n                onClick={() => setActiveTab(action.id)}\r\n                className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all text-left group hover:border-brand-blue dark:hover:border-brand-blue\"\r\n              >\r\n                <h3 className=\"font-bold dark:text-white mb-1 flex items-center gap-2\">\r\n                  {action.title}\r\n                </h3>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                  {action.description}\r\n                </p>\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* No Business Features Message */}\r\n      {quickActions.length === 0 && !isLabel && !isStudio && !hasDistribution && (\r\n        <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center\">\r\n          <div className=\"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n            <Briefcase size={32} className=\"text-gray-400\" />\r\n          </div>\r\n          <h3 className=\"text-xl font-bold dark:text-white mb-2\">No Business Features Enabled</h3>\r\n          <p className=\"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6\">\r\n            Upgrade your account to access studio management, music distribution, and label features.\r\n          </p>\r\n          <p className=\"text-sm text-gray-400\">\r\n            Update your profile to add \"Studio\", \"Talent\", \"Label\", or \"Agent\" account types.\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport {\r\n    Briefcase, Home, Globe, Users, ChevronRight,\r\n    Building2, Music2, BarChart3, Settings2\r\n} from 'lucide-react';\r\n\r\n// Import business components\r\nimport StudioManager from './StudioManager';\r\nimport LabelDashboard from './labels/LabelDashboard';\r\nimport DistributionManager from './marketplace/DistributionManager';\r\nimport BusinessOverview from './business/BusinessOverview';\r\n\r\n/**\r\n * BusinessCenter - Consolidated hub for all business-related features\r\n *\r\n * Tabs:\r\n * 1. Overview - Real-time metrics for each business type\r\n * 2. Studio Operations - Manage studio settings, rooms, amenities\r\n * 3. Distribution - Music distribution to streaming platforms\r\n * 4. Label/Roster - Manage artist roster (for labels/agents)\r\n */\r\nexport default function BusinessCenter({ user, userData }) {\r\n    const location = useLocation();\r\n    const navigate = useNavigate();\r\n\r\n    // Get active tab from URL path\r\n    const getTabFromPath = (path) => {\r\n        const parts = path.split('/').filter(Boolean);\r\n        if (parts[0] === 'business' && parts[1]) {\r\n            return parts[1];\r\n        }\r\n        return 'overview';\r\n    };\r\n\r\n    const [activeTab, setActiveTab] = useState(() => getTabFromPath(location.pathname));\r\n\r\n    // Sync URL with active tab\r\n    useEffect(() => {\r\n        const currentPath = activeTab === 'overview' ? '/business' : `/business/${activeTab}`;\r\n        if (location.pathname !== currentPath) {\r\n            navigate(currentPath, { replace: true });\r\n        }\r\n    }, [activeTab]);\r\n\r\n    // Update tab when URL changes\r\n    useEffect(() => {\r\n        const tabFromPath = getTabFromPath(location.pathname);\r\n        if (tabFromPath !== activeTab) {\r\n            setActiveTab(tabFromPath);\r\n        }\r\n    }, [location.pathname]);\r\n\r\n    // Determine which features the user has access to\r\n    const isStudio = userData?.accountTypes?.includes('Studio');\r\n    const isLabel = userData?.accountTypes?.some(t => ['Label', 'Agent'].includes(t));\r\n    const isArtist = userData?.accountTypes?.some(t => ['Talent', 'Producer', 'Engineer'].includes(t));\r\n\r\n    // Everyone with business features gets distribution access\r\n    const hasDistribution = isStudio || isLabel || isArtist;\r\n\r\n    // Build available tabs based on user roles\r\n    const tabs = [\r\n        {\r\n            id: 'overview',\r\n            label: 'Overview',\r\n            icon: Briefcase,\r\n            iconSize: 18,\r\n            available: true\r\n        },\r\n        {\r\n            id: 'studio',\r\n            label: 'Studio Ops',\r\n            icon: Home,\r\n            iconSize: 18,\r\n            available: isStudio,\r\n            description: 'Manage rooms, rates & amenities'\r\n        },\r\n        {\r\n            id: 'distribution',\r\n            label: 'Distribution',\r\n            icon: Globe,\r\n            iconSize: 18,\r\n            available: hasDistribution,\r\n            description: 'Release music to streaming platforms'\r\n        },\r\n        {\r\n            id: 'roster',\r\n            label: 'Label Manager',\r\n            icon: Users,\r\n            iconSize: 18,\r\n            available: isLabel,\r\n            description: 'Manage your signed artists'\r\n        },\r\n    ].filter(tab => tab.available);\r\n\r\n    // Render content based on active tab\r\n    const renderContent = () => {\r\n        switch (activeTab) {\r\n            case 'studio':\r\n                return <StudioManager user={user} userData={userData} />;\r\n            case 'distribution':\r\n                return <DistributionManager user={user} userData={userData} />;\r\n            case 'roster':\r\n                return <LabelDashboard user={user} userData={userData} />;\r\n            case 'overview':\r\n            default:\r\n                return <BusinessOverview user={user} userData={userData} setActiveTab={setActiveTab} />;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto pb-20\">\r\n            {/* Tab Navigation */}\r\n            <div className=\"mb-6 bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-1.5 flex flex-wrap gap-1 shadow-sm sticky top-0 z-10\">\r\n                {tabs.map(tab => {\r\n                    const IconComponent = tab.icon;\r\n                    return (\r\n                        <button\r\n                            key={tab.id}\r\n                            onClick={() => setActiveTab(tab.id)}\r\n                            className={`\r\n                                flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all\r\n                                ${activeTab === tab.id\r\n                                    ? 'bg-brand-blue text-white shadow-md'\r\n                                    : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                                }\r\n                            `}\r\n                        >\r\n                            <IconComponent size={tab.iconSize} />\r\n                            <span className=\"hidden sm:inline\">{tab.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Content Area */}\r\n            {renderContent()}\r\n        </div>\r\n    );\r\n}\r\n"],"file":"assets/BusinessCenter-jxPRociV.js"}