import{t as tt,c as Le,j as e,U as he,a as st,b as ft,d as gt,C as ht,r as n,u as Z,e as be,f as Oe,T as Se,P as Ae,A as rt,X as Y,L as de,g as at,S as $e,h as Ue,i as bt,k as pt,V as Me,l as nt,m as Re,n as yt,o as lt,p as it,q as ot,s as ct,M as Ve,F as pe,v as jt,I as wt,w as Nt,x as vt,y as kt,R as St,E as Rt,z as qe,D as Be,B as $t,G as Ee,H as Mt,J as zt,K as Tt,N as He,O as _e,Q as At,W as We,Y as Qe,Z as It,_ as Ft,$ as Lt}from"./vendor-SbfkNbzm.js";import{g as Et,i as _t,a as Ct,b as Gt,p as Pt,c as Dt,d as Ut,e as Bt,f as Ot,r as Vt,u as qt,h as Ht,q as Ce,w as le,j as Ye,k as Je,l as Wt,m as fe,s as Qt,n as Yt,o as Jt,t as Kt,v as Xt,x as Zt,y as es,z as ts,A as ss,B as rs,C as Ke,D as as,E as ns,F as ls,G as is,H as os}from"./vendor-firebase-DA8kksl2.js";import{m as D,A as ne}from"./vendor-framer-CcBD3fpK.js";const ie={apiKey:"AIzaSyCmGxvXX2D11Jo3NZlD0jO1vQpskaG0sCU",authDomain:"seshnx-db.firebaseapp.com",databaseURL:"https://seshnx-db-default-rtdb.firebaseio.com",projectId:"seshnx-db",storageBucket:"seshnx-db.firebasestorage.app",messagingSenderId:"718084970004",appId:"1:718084970004:web:d68ba48c5eb493af9db901",measurementId:"G-7SP53NK9FM"};ie.databaseURL||(ie.databaseURL="https://seshnx-db-default-rtdb.firebaseio.com");let Ge=null;try{Ge=Et()}catch{Ge=null}const ue=Ge||_t(ie),Ds=Ct(ue);let Pe;try{Pe=Gt(ue,{localCache:Pt({tabManager:Dt()})})}catch{Pe=Ut(ue)}const ge=Pe;let De=null,dt=null;const cs=()=>{const t=ie.databaseURL;if(!t||t.trim()==="")return null;try{return Ot(ue)||null}catch{return null}};dt=cs();if(ie.storageBucket&&ie.storageBucket.trim()!=="")try{De=Bt(ue)}catch{De=null}const Xe=De,ae=dt,A=ie.projectId,ds=t=>({userProfile:`artifacts/${A}/users/${t}/profiles/main`,userSubProfile:s=>`artifacts/${A}/users/${t}/profiles/${s}`,userPublicProfile:`artifacts/${A}/users/${t}/public_profile/main`,publicProfileCollectionGroup:"public_profile",publicFeed:`artifacts/${A}/public/data/posts`,serviceRequests:`artifacts/${A}/public/data/service_requests`,messages:`artifacts/${A}/public/data/direct_messages`,marketplaceItems:`artifacts/${A}/public/data/market_items`,userLibrary:`artifacts/${A}/users/${t}/library`,marketAssets:`artifacts/${A}/users/${t}/assets/market`,userWallet:`artifacts/${A}/users/${t}/wallet/account`,profileImages:`artifacts/${A}/users/${t}/images/profile`,equipmentSubmissions:`artifacts/${A}/public/data/equipment_submissions`,studentRecord:(s,r)=>`schools/${s}/students/${r}`,distributionReleases:`artifacts/${A}/distribution/${t}/releases`,royaltyReports:`artifacts/${A}/distribution/${t}/royalty_reports`,distributionStats:`artifacts/${A}/distribution/${t}/stats/main`,labelRoster:s=>`artifacts/${A}/labels/${s}/roster`,labelInvites:s=>`artifacts/${A}/labels/${s}/invites`,gearListings:`artifacts/${A}/public/data/gear_listings`,followers:`artifacts/${A}/users/${t}/followers`,following:`artifacts/${A}/users/${t}/following`,socialStats:`artifacts/${A}/users/${t}/stats/social`,notifications:`artifacts/${A}/users/${t}/notifications`,savedPosts:`artifacts/${A}/users/${t}/savedPosts`,safeExchangeTransactions:`artifacts/${A}/public/data/safe_exchange_transactions`,userSafeExchanges:`artifacts/${A}/users/${t}/safe_exchanges`,safeZones:`artifacts/${A}/public/data/safe_zones`,escrowHolds:`artifacts/${A}/escrow/holds`,shippingTransactions:`artifacts/${A}/public/data/shipping_transactions`,userShippingTransactions:`artifacts/${A}/users/${t}/shipping_transactions`}),us=t=>{if(!t)return"";const s=t.trim().split(" ");return s.length>=2?(s[0][0]+s[1][0]).toUpperCase():t.substring(0,2).toUpperCase()};function xe({src:t,name:s,size:r="md",className:a,onClick:o,status:l,isGroup:p=!1,square:f=!1}){const g=tt(Le("relative overflow-hidden flex items-center justify-center shrink-0 bg-gray-200 dark:bg-gray-700 border border-transparent transition-all select-none",f?"rounded-xl":"rounded-full",{xs:"h-6 w-6 text-[10px]",sm:"h-8 w-8 text-xs",md:"h-10 w-10 text-sm",lg:"h-12 w-12 text-base",xl:"h-14 w-14 text-lg","2xl":"h-24 w-24 text-2xl","3xl":"h-32 w-32 text-4xl"}[r],o&&"cursor-pointer hover:opacity-90",a));return e.jsxs("div",{className:g,onClick:o,children:[t?e.jsx("img",{src:t,alt:s||"Avatar",className:"h-full w-full object-cover",onError:j=>j.target.style.display="none"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gradient-to-br from-brand-blue to-purple-600 text-white font-bold",children:p?e.jsx(he,{className:"w-1/2 h-1/2"}):s?us(s):e.jsx(st,{className:"w-1/2 h-1/2"})}),l&&e.jsx("span",{className:Le("absolute bottom-0 right-0 rounded-full border-2 border-white dark:border-gray-900",l==="online"?"bg-green-500":"bg-gray-400",r==="xs"||r==="sm"?"h-2 w-2":"h-3.5 w-3.5")})]})}const V=gt;ft();const xs=void 0,ms="https://placeholder.convex.cloud",Us=new ht(ms),te=()=>!!xs,fs=()=>{const[t,s]=n.useState(!1),[r,a]=n.useState(null);return{uploadMedia:async(l,p)=>{if(!l)return null;if(!Xe)return a("Firebase Storage is not configured. Please set VITE_FIREBASE_STORAGE_BUCKET in your environment variables."),console.error("Firebase Storage is not available. storageBucket is missing from Firebase config."),null;s(!0),a(null);try{const y=`${Date.now()}_${l.name.replace(/[^a-zA-Z0-9.]/g,"_")}`,g=`${p}/${y}`,j=Vt(Xe,g),k=await qt(j,l),c=await Ht(k.ref);return s(!1),{url:c,type:l.type.startsWith("video/")?"video":l.type.startsWith("audio/")?"audio":"image",name:l.name}}catch(f){return console.error("Upload failed:",f),a(f),s(!1),null}},uploading:t,error:r}};function Bs(t){const s=n.useRef(!1),r=Z(V.presence.updatePresence);n.useEffect(()=>{if(!t||!te())return;r({userId:t,online:!0,lastSeen:Date.now()}).then(()=>{s.current=!0}).catch(o=>{console.error("Presence online error:",o)});const a=setInterval(()=>{s.current&&r({userId:t,online:!0,lastSeen:Date.now()}).catch(console.error)},3e4);return()=>{clearInterval(a),s.current&&(r({userId:t,online:!1,lastSeen:Date.now()}).catch(console.error),s.current=!1)}},[t])}function ut(t){const s=te(),r=n.useMemo(()=>t&&s?{userId:t}:"skip",[t,s]),a=be(V.presence.getPresence,r);return a?{online:a.online===!0,lastSeen:a.lastSeen,loading:!1}:{online:!1,lastSeen:null,loading:!te()}}function gs(t){if(!t)return"Never";const s=t,a=Date.now()-s,o=Math.floor(a/6e4),l=Math.floor(o/60),p=Math.floor(l/24);return o<1?"Just now":o<60?`${o}m ago`:l<24?`${l}h ago`:p<7?`${p}d ago`:new Date(s).toLocaleDateString()}function xt({online:t,lastSeen:s,showText:r=!1,size:a="sm"}){const o={xs:"w-1.5 h-1.5",sm:"w-2 h-2",md:"w-2.5 h-2.5"},l={xs:"text-[10px]",sm:"text-xs",md:"text-sm"};return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:`${o[a]} ${t?"fill-green-500 text-green-500":"fill-gray-400 text-gray-400"}`}),t&&e.jsx("div",{className:"absolute inset-0 animate-ping",children:e.jsx(Oe,{className:`${o[a]} fill-green-500 opacity-75`})})]}),r&&e.jsx("span",{className:`${l[a]} ${t?"text-green-500":"text-gray-400"} font-medium`,children:t?"Online":gs(s)})]})}function hs({conversation:t,activeChat:s,currentUserId:r,onSelect:a,onDelete:o}){const l=t.type==="direct"?t.uid||(t.id.includes("_")?t.id.split("_").find(y=>y!==r):null):null,{online:p,lastSeen:f}=ut(l||"");return e.jsxs("div",{onClick:()=>a(t),className:`group relative flex gap-3 p-4 cursor-pointer transition border-b dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-white/5 ${(s==null?void 0:s.id)===t.id?"bg-blue-50 dark:bg-blue-900/10 border-l-4 border-l-brand-blue":""}`,children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx(xe,{src:t.photo,name:t.n,size:"lg",isGroup:t.type==="group"}),t.type==="direct"&&l&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5",children:e.jsx(xt,{online:p,lastSeen:f,size:"xs"})}),t.uc>0&&e.jsx("div",{className:"absolute -top-1 -right-1 h-5 w-5 bg-brand-blue text-white text-[10px] font-bold flex items-center justify-center rounded-full border-2 border-white dark:border-[#2c2e36]",children:t.uc>99?"99+":t.uc})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h4",{className:`text-sm truncate ${t.uc>0?"font-extrabold text-gray-900 dark:text-white":"font-bold text-gray-700 dark:text-gray-300"}`,children:t.n}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0 ml-2",children:t.lmt?new Date(t.lmt).toLocaleDateString():""})]}),e.jsxs("p",{className:`text-xs truncate ${t.uc>0?"text-gray-800 dark:text-gray-200 font-medium":"text-gray-500"}`,children:[t.ls===r?"You: ":"",t.lm]})]}),e.jsx("button",{onClick:y=>{y.stopPropagation(),o==null||o(t.id)},className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white dark:bg-gray-800 shadow-md rounded-full text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all z-10",children:e.jsx(Se,{size:16})})]})}function Os({user:t,conversations:s=[],activeChat:r,onSelectChat:a}){const[o,l]=n.useState(!1),[p,f]=n.useState(!1),[y,g]=n.useState("direct"),[j,k]=n.useState(!1),[c,m]=n.useState(""),[i,d]=n.useState([]),[N,$]=n.useState(""),[u,S]=n.useState([]),v=async w=>{$(w);const F=w.trim();if(F.length>1){const U=F.toLowerCase(),L=U.charAt(0).toUpperCase()+U.slice(1),J=Ce(Ye(ge,"public_profile"),le("firstName",">=",L),le("firstName","<=",L+"ï£¿")),K=Ce(Ye(ge,"public_profile"),le("lastName",">=",L),le("lastName","<=",L+"ï£¿"));try{const[P,q]=await Promise.all([Je(J),Je(K)]),Q=new Map,B=X=>{const ee=X.ref.parent.parent.id;ee!==t.uid&&Q.set(ee,{id:ee,...X.data()})};P.forEach(B),q.forEach(B),S(Array.from(Q.values()))}catch(P){console.error("Search error:",P),S([])}}else S([])},z=w=>{if(y==="direct"){const F=[t.uid,w.id].sort().join("_");a({id:F,uid:w.id,name:`${w.firstName} ${w.lastName}`,type:"direct"}),E()}else y==="add_member"&&(i.find(F=>F.id===w.id)||d(F=>[...F,w]),E())},E=()=>{l(!1),$(""),S([])},G=()=>{m(""),d([]),f(!0)},H=()=>{g("add_member"),l(!0)},I=async()=>{if(!c||i.length===0)return alert("Name and members required.");if(!ae){alert("Chat functionality is not available. Realtime Database is not configured.");return}k(!0);try{const F=Wt(fe(ae,"chats")).key,U=Qt(),L=[t.uid,...i.map(P=>P.id)],J={meta:{name:c,createdBy:t.uid,createdAt:U},members:{}};L.forEach(P=>J.members[P]=!0),await Yt(fe(ae,`chats/${F}`),J);const K={};L.forEach(P=>{K[`conversations/${P}/${F}`]={uid:F,n:c,type:"group",lmt:U,lm:"Group created",ls:t.uid,uc:P===t.uid?0:1}}),await Jt(fe(ae),K),f(!1),a({id:F,name:c,type:"group"})}catch(w){console.error("Group creation failed",w),alert("Group creation failed: "+w.message)}finally{k(!1)}},O=async(w,F)=>{if(window.confirm("Delete this conversation?")){if(!ae){alert("Chat functionality is not available. Realtime Database is not configured.");return}try{await Kt(fe(ae,`conversations/${t.uid}/${F}`)),(r==null?void 0:r.id)===F&&a(null)}catch(U){console.error(U)}}};return e.jsxs("div",{className:"flex flex-col h-full relative overflow-hidden bg-white dark:bg-[#1f2128]",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsx("h2",{className:"font-extrabold text-lg dark:text-white tracking-tight",children:"Messages"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:G,className:"p-2 bg-white dark:bg-gray-700 rounded-full shadow-sm hover:text-brand-blue transition",title:"New Group",children:e.jsx(he,{size:18})}),e.jsx("button",{onClick:()=>{g("direct"),l(!0)},className:"p-2 bg-white dark:bg-gray-700 rounded-full shadow-sm hover:text-brand-blue transition",title:"New Chat",children:e.jsx(Ae,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:s.map(w=>e.jsx(hs,{conversation:w,activeChat:r,currentUserId:t.uid,onSelect:a,onDelete:F=>{window.confirm("Delete this conversation?")&&O({},F)}},w.id))}),p&&e.jsxs("div",{className:"absolute inset-0 bg-white dark:bg-[#1f2128] z-20 flex flex-col animate-in slide-in-from-right-10 duration-200",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center gap-3 bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("button",{onClick:()=>f(!1),className:"hover:bg-gray-200 dark:hover:bg-gray-700 p-1 rounded-full",children:e.jsx(rt,{size:20})}),e.jsx("h3",{className:"font-bold dark:text-white",children:"New Group"})]}),e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"1. Group Name"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",placeholder:"Enter group name...",value:c,onChange:w=>m(w.target.value),autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["2. Members (",i.length,")"]}),e.jsxs("button",{onClick:H,className:"text-xs font-bold text-brand-blue flex items-center gap-1 hover:underline",children:[e.jsx(Ae,{size:14})," Add Member"]})]}),e.jsx("div",{className:"space-y-2",children:i.length===0?e.jsx("div",{className:"text-center py-8 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400 text-sm",children:"No members selected"}):i.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-white/5 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{src:w.photoURL,name:w.firstName,size:"sm"}),e.jsxs("span",{className:"text-sm font-bold dark:text-white",children:[w.firstName," ",w.lastName]})]}),e.jsx("button",{onClick:()=>d(F=>F.filter(U=>U.id!==w.id)),className:"text-gray-400 hover:text-red-500",children:e.jsx(Y,{size:16})})]},w.id))})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:I,disabled:!c||i.length===0||j,className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-lg flex justify-center items-center gap-2",children:j?e.jsx(de,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:["Create Group ",e.jsx(at,{size:18})]})})})]}),o&&e.jsxs("div",{className:"absolute inset-0 bg-white dark:bg-[#1f2128] z-30 flex flex-col animate-in fade-in duration-200",children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700 flex items-center gap-2 bg-white dark:bg-[#1f2128]",children:[e.jsx($e,{size:18,className:"text-gray-400 ml-2"}),e.jsx("input",{autoFocus:!0,className:"flex-1 p-2 bg-transparent outline-none dark:text-white placeholder-gray-400",placeholder:"Search...",value:N,onChange:w=>v(w.target.value)}),e.jsx("button",{onClick:E,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",children:e.jsx(Y,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[u.length===0&&N.length>1&&e.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No users found."}),u.map(w=>{const F=y==="add_member"&&i.find(U=>U.id===w.id);return e.jsxs("div",{onClick:()=>z(w),className:`flex items-center gap-3 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl cursor-pointer transition mb-1 ${F?"opacity-50 pointer-events-none":""}`,children:[e.jsx(xe,{src:w.photoURL,name:w.firstName,size:"md"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-bold dark:text-white",children:[w.firstName," ",w.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:w.role||"User"})]}),y==="add_member"&&e.jsx(Ae,{size:18,className:"text-brand-blue"})]},w.id)})]})]})]})}const ve={Recent:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥","ðŸŽ‰","ðŸ‘"],Smileys:["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ¤£","ðŸ˜‚","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Š","ðŸ˜‡","ðŸ¥°","ðŸ˜","ðŸ¤©","ðŸ˜˜","ðŸ˜—","ðŸ˜š","ðŸ˜™","ðŸ˜‹","ðŸ˜›","ðŸ˜œ","ðŸ¤ª","ðŸ˜","ðŸ¤‘","ðŸ¤—","ðŸ¤­","ðŸ¤«","ðŸ¤”","ðŸ¤","ðŸ¤¨","ðŸ˜","ðŸ˜‘","ðŸ˜¶","ðŸ˜","ðŸ˜’","ðŸ™„","ðŸ˜¬","ðŸ¤¥","ðŸ˜Œ","ðŸ˜”","ðŸ˜ª","ðŸ¤¤","ðŸ˜´","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤¢","ðŸ¤®"],Gestures:["ðŸ‘‹","ðŸ¤š","ðŸ–ï¸","âœ‹","ðŸ––","ðŸ‘Œ","ðŸ¤Œ","ðŸ¤","âœŒï¸","ðŸ¤ž","ðŸ¤Ÿ","ðŸ¤˜","ðŸ¤™","ðŸ‘ˆ","ðŸ‘‰","ðŸ‘†","ðŸ–•","ðŸ‘‡","â˜ï¸","ðŸ‘","ðŸ‘Ž","âœŠ","ðŸ‘Š","ðŸ¤›","ðŸ¤œ","ðŸ‘","ðŸ™Œ","ðŸ‘","ðŸ¤²","ðŸ¤","ðŸ™"],Hearts:["â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’”","â¤ï¸â€ðŸ”¥","â¤ï¸â€ðŸ©¹","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’Ÿ"],Objects:["ðŸ’Ž","ðŸ””","ðŸ”•","ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸ“»","ðŸŽ·","ðŸŽº","ðŸŽ¸","ðŸŽ¹","ðŸŽ®","ðŸ•¹ï¸","ðŸŽ¯","ðŸŽ²","ðŸŽ³","ðŸŽ´","ðŸƒ","ðŸ€„","ðŸŽ°","ðŸ“±","ðŸ“ž","â˜Žï¸","ðŸ“Ÿ","ðŸ“ ","ðŸ’»","ðŸ–¥ï¸","ðŸ–¨ï¸","âŒ¨ï¸","ðŸ–±ï¸","ðŸ–²ï¸","ðŸ•¹ï¸","ðŸ—œï¸","ðŸ’¾","ðŸ’¿","ðŸ“€"],Flags:["ðŸ³ï¸","ðŸ´","ðŸ","ðŸš©","ðŸ³ï¸â€ðŸŒˆ","ðŸ³ï¸â€âš§ï¸","ðŸ‡ºðŸ‡¸","ðŸ‡¬ðŸ‡§","ðŸ‡¨ðŸ‡¦","ðŸ‡¦ðŸ‡º","ðŸ‡«ðŸ‡·","ðŸ‡©ðŸ‡ª","ðŸ‡®ðŸ‡¹","ðŸ‡ªðŸ‡¸","ðŸ‡¯ðŸ‡µ","ðŸ‡°ðŸ‡·","ðŸ‡¨ðŸ‡³","ðŸ‡®ðŸ‡³","ðŸ‡§ðŸ‡·","ðŸ‡²ðŸ‡½"],Music:["ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸ“»","ðŸŽ·","ðŸŽº","ðŸŽ¸","ðŸŽ¹","ðŸ¥","ðŸª˜","ðŸŽ»","ðŸŽª","ðŸŽ­","ðŸŽ¨","ðŸŽ¬","ðŸŽ¤","ðŸŽ§","ðŸŽ¼","ðŸŽ¹"],Reactions:["ðŸ‘","ðŸ‘Ž","â¤ï¸","ðŸ”¥","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ‘","ðŸ™Œ","ðŸ¤","ðŸ¤—","ðŸ¤”","ðŸ¤¦","ðŸ¤·","ðŸ™","ðŸ‘€","ðŸ’ª","ðŸ¤˜","âœŒï¸","ðŸ¤ž"]},bs=Object.values(ve).flat();function ps({onSelect:t,onClose:s,position:r="bottom"}){const[a,o]=n.useState("Recent"),[l,p]=n.useState(""),[f,y]=n.useState(()=>{const c=localStorage.getItem("recentEmojis");return c?JSON.parse(c):ve.Recent}),g=n.useMemo(()=>l.trim()?bs.filter(c=>c.includes(l)||l.includes(c)):a==="Recent"?f:ve[a]||[],[l,a,f]),j=c=>{const m=[c,...f.filter(i=>i!==c)].slice(0,8);y(m),localStorage.setItem("recentEmojis",JSON.stringify(m)),t(c),s&&s()},k=Object.keys(ve);return e.jsxs(D.div,{initial:{opacity:0,scale:.95,y:r==="bottom"?-10:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},className:`
                absolute ${r==="bottom"?"bottom-full mb-2":"top-full mt-2"} 
                left-0
                w-[340px] bg-white dark:bg-gray-800 
                rounded-2xl shadow-2xl border dark:border-gray-700
                z-50 overflow-hidden
            `,children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx($e,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search emojis...",value:l,onChange:c=>p(c.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white"}),l&&e.jsx("button",{onClick:()=>p(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Y,{size:16})})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide",children:k.map(c=>e.jsxs("button",{onClick:()=>o(c),className:`
                                px-3 py-1.5 rounded-lg text-xs font-semibold whitespace-nowrap transition
                                ${a===c?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}
                            `,children:[c==="Recent"?e.jsx(Ue,{size:12,className:"inline mr-1"}):null,c]},c))})]}),e.jsx("div",{className:"h-[280px] overflow-y-auto custom-scrollbar p-3",children:g.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"text-sm",children:"No emojis found"})}):e.jsx("div",{className:"grid grid-cols-8 gap-1",children:g.map((c,m)=>e.jsx(D.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:()=>j(c),className:"w-10 h-10 flex items-center justify-center text-xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:c},`${c}-${m}`))})})]})}const Ze="demo_key",et="https://api.giphy.com/v1/gifs";function ys({onSelect:t,onClose:s,position:r="bottom"}){const[a,o]=n.useState(""),[l,p]=n.useState([]),[f,y]=n.useState([]),[g,j]=n.useState(!1),[k,c]=n.useState("trending"),m=n.useRef(null);n.useEffect(()=>{i()},[]),n.useEffect(()=>(a.trim()?(c("search"),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{d(a)},500)):(c("trending"),p([])),()=>{m.current&&clearTimeout(m.current)}),[a]);const i=async()=>{j(!0);try{const S=await(await fetch(`${et}/trending?api_key=${Ze}&limit=24&rating=g`)).json();S.data&&y(S.data)}catch(u){console.error("Giphy trending error:",u)}j(!1)},d=async u=>{if(u.trim()){j(!0);try{const v=await(await fetch(`${et}/search?api_key=${Ze}&q=${encodeURIComponent(u)}&limit=24&rating=g`)).json();v.data&&p(v.data)}catch(S){console.error("Giphy search error:",S)}j(!1)}},N=u=>{t==null||t({url:u.images.fixed_height.url||u.images.original.url,previewUrl:u.images.preview_gif.url||u.images.fixed_height_small.url,width:u.images.fixed_height.width,height:u.images.fixed_height.height,title:u.title||"GIF"}),s&&s()},$=k==="trending"?f:l;return e.jsxs(D.div,{initial:{opacity:0,scale:.95,y:r==="bottom"?-10:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},className:`
                absolute ${r==="bottom"?"bottom-full mb-2":"top-full mt-2"} 
                left-0
                w-[380px] bg-white dark:bg-gray-800 
                rounded-2xl shadow-2xl border dark:border-gray-700
                z-50 overflow-hidden
            `,children:[e.jsx("div",{className:"p-3 border-b dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx($e,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search GIFs...",value:a,onChange:u=>o(u.target.value),className:"w-full pl-9 pr-10 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white"}),a&&e.jsx("button",{onClick:()=>o(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Y,{size:16})})]})}),e.jsx("div",{className:"h-[320px] overflow-y-auto custom-scrollbar p-3",children:g?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx(de,{className:"animate-spin text-brand-blue mb-2",size:24}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading GIFs..."})]}):$.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(bt,{size:32,className:"mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:k==="search"?"No GIFs found. Try a different search.":"Loading trending GIFs..."})]}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:$.map(u=>e.jsxs(D.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>N(u),className:"relative aspect-square rounded-lg overflow-hidden cursor-pointer bg-gray-100 dark:bg-gray-700 group",children:[e.jsx("img",{src:u.images.fixed_height_small.url||u.images.preview_gif.url,alt:u.title,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"})]},u.id))})}),e.jsx("div",{className:"p-2 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-center",children:e.jsxs("p",{className:"text-[10px] text-gray-400",children:["Powered by ",e.jsx("span",{className:"font-bold",children:"GIPHY"})]})})]})}function js({onRecorded:t,onClose:s,maxDuration:r=60}){const[a,o]=n.useState(!1),[l,p]=n.useState(null),[f,y]=n.useState(0),[g,j]=n.useState(null),[k,c]=n.useState(null),m=n.useRef(null),i=n.useRef(null),d=n.useRef(null),N=n.useRef([]),$=n.useRef(null);n.useEffect(()=>(u(),()=>{S()}),[]);const u=async()=>{try{const I=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!0});i.current=I,m.current&&(m.current.srcObject=I),j(!0),c(null)}catch(I){console.error("Permission error:",I),j(!1),c("Camera/microphone access denied")}},S=()=>{i.current&&(i.current.getTracks().forEach(I=>I.stop()),i.current=null),$.current&&clearInterval($.current)},v=async()=>{if(!i.current){await u();return}try{N.current=[];const I={mimeType:"video/webm;codecs=vp9,opus",videoBitsPerSecond:25e5};d.current=new MediaRecorder(i.current,I),d.current.ondataavailable=O=>{O.data.size>0&&N.current.push(O.data)},d.current.onstop=()=>{const O=new Blob(N.current,{type:"video/webm"});p(O),o(!1),y(0),$.current&&clearInterval($.current)},d.current.start(),o(!0),y(0),$.current=setInterval(()=>{y(O=>{const w=O+1;return w>=r&&z(),w})},1e3)}catch(I){console.error("Recording error:",I),c("Failed to start recording")}},z=()=>{d.current&&a&&d.current.stop()},E=()=>{p(null),y(0),o(!1)},G=()=>{if(l){const I=new File([l],`video_${Date.now()}.webm`,{type:"video/webm"});t==null||t(I),S(),s==null||s()}},H=I=>{const O=Math.floor(I/60),w=I%60;return`${O}:${w.toString().padStart(2,"0")}`};return!g&&g!==null?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsx(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-6 max-w-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx(pt,{size:48,className:"text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Camera Access Required"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Please allow camera and microphone access to record video messages."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-200 transition",children:"Cancel"}),e.jsx("button",{onClick:u,className:"flex-1 px-4 py-2 bg-brand-blue text-white rounded-lg text-sm font-semibold hover:bg-blue-600 transition",children:"Allow Access"})]})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-[80]",children:e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative w-full max-w-2xl aspect-video bg-black rounded-2xl overflow-hidden",children:[e.jsx("video",{ref:m,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),a&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-bold",children:H(f)})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent",children:e.jsx("div",{className:"flex items-center justify-center gap-4",children:l?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:E,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(Y,{size:24})}),e.jsx("button",{onClick:G,className:"p-4 bg-green-500 hover:bg-green-600 rounded-full text-white transition shadow-lg",children:e.jsx(Re,{size:28})}),e.jsx("div",{className:"w-12"})," "]}):e.jsx(e.Fragment,{children:a?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:E,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(Y,{size:24})}),e.jsx("button",{onClick:z,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full text-white transition shadow-lg animate-pulse",children:e.jsx(nt,{size:28})}),e.jsx("div",{className:"w-12"})," "]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(Y,{size:24})}),e.jsx("button",{onClick:v,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full text-white transition shadow-lg",children:e.jsx(Me,{size:28})}),e.jsx("div",{className:"w-12"})," "]})})})}),k&&e.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-4 py-2 rounded-lg text-sm",children:k})]})})}function ws(t,s,r){const a=n.useRef(null),o=n.useRef(!1),l=te(),p=n.useMemo(()=>t&&l?{chatId:t}:"skip",[t,l]),f=be(V.presence.getTypingIndicators,p),y=Z(V.presence.updateTypingIndicator),g=Z(V.presence.clearTypingIndicator),j=n.useMemo(()=>f?f.filter(m=>m.userId!==s&&m.isTyping).map(m=>({id:m.userId,name:m.userName})):[],[f,s]),k=n.useCallback(()=>{!t||!s||!l||(o.current||(o.current=!0,y({chatId:t,userId:s,userName:r,isTyping:!0}).catch(console.error)),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{o.current&&(o.current=!1,g({chatId:t,userId:s}).catch(console.error))},3e3))},[t,s,r,l,y,g]),c=n.useCallback(()=>{!t||!s||!l||(a.current&&clearTimeout(a.current),o.current&&(o.current=!1,g({chatId:t,userId:s}).catch(console.error)))},[t,s,l,g]);return n.useEffect(()=>()=>{a.current&&clearTimeout(a.current),t&&s&&o.current&&l&&g({chatId:t,userId:s}).catch(console.error)},[t,s,l,g]),{typingUsers:j,setTyping:k,clearTyping:c}}function Ns(t){return!t||t.length===0?"":t.length===1?`${t[0].name} is typing...`:t.length===2?`${t[0].name} and ${t[1].name} are typing...`:`${t[0].name} and ${t.length-1} others are typing...`}function vs({activeChatId:t,uid:s,onSend:r,replyingTo:a,editingMessage:o,onCancelReply:l,onCancelEdit:p,typingUsers:f=[],onTyping:y,onStopTyping:g}){const[j,k]=n.useState(""),[c,m]=n.useState(null),[i,d]=n.useState(!1),[N,$]=n.useState(0),[u,S]=n.useState(!1),[v,z]=n.useState(!1),[E,G]=n.useState(!1),[H,I]=n.useState(!1),[O,w]=n.useState(!1),F=n.useRef(null),U=n.useRef(null),L=n.useRef(null),J=n.useRef([]),K=n.useRef(null),P=n.useRef(null),q=n.useRef(null),Q=n.useRef(null),{uploadMedia:B,uploading:X}=fs();n.useEffect(()=>{var x;o&&(k(o.b||""),(x=U.current)==null||x.focus())},[o]),n.useEffect(()=>{var x;a&&((x=U.current)==null||x.focus())},[a]),n.useEffect(()=>{const x=b=>{K.current&&!K.current.contains(b.target)&&z(!1),P.current&&!P.current.contains(b.target)&&G(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const ee=async x=>{try{const R=await(await fetch(x.url)).blob(),M=new File([R],`gif_${Date.now()}.gif`,{type:"image/gif"}),C=await B(M,`chat_media/${t}`);if(C){const se={url:C.url,type:"image",name:x.title||"GIF",gif:!0};r("",se)}}catch(b){console.error("GIF upload error:",b),alert("Failed to send GIF")}G(!1)},_=async x=>{try{const b=await B(x,`chat_media/${t}`);if(b){const R={url:b.url,type:"video",name:x.name};r("",R)}}catch(b){console.error("Video upload error:",b),alert("Failed to send video")}I(!1)},W=x=>{k(x.target.value),y&&x.target.value.trim()&&y()},oe=x=>{const b=U.current;if(b){const R=b.selectionStart,M=b.selectionEnd,C=j.substring(0,R)+x+j.substring(M);k(C),setTimeout(()=>{b.selectionStart=b.selectionEnd=R+x.length,b.focus()},0)}else k(R=>R+x)},re=async()=>{try{const x=await navigator.mediaDevices.getUserMedia({audio:!0});L.current=new MediaRecorder(x),J.current=[],$(0),L.current.ondataavailable=b=>J.current.push(b.data),L.current.onstop=()=>{const b=new Blob(J.current,{type:"audio/webm"}),R=new File([b],`voice_note_${Date.now()}.webm`,{type:"audio/webm"});m({file:R,type:"audio",previewUrl:URL.createObjectURL(b),duration:N}),x.getTracks().forEach(M=>M.stop()),q.current&&clearInterval(q.current)},L.current.start(),d(!0),q.current=setInterval(()=>{$(b=>b+1)},1e3)}catch{alert("Microphone access denied. Please allow microphone permissions.")}},ce=()=>{L.current&&i&&(L.current.stop(),d(!1),q.current&&clearInterval(q.current))},ye=()=>{var x;L.current&&i&&(L.current.stop(),J.current=[],d(!1),$(0),q.current&&clearInterval(q.current),(x=L.current.stream)==null||x.getTracks().forEach(b=>b.stop()))},je=x=>{const b=Math.floor(x/60),R=x%60;return`${b}:${R.toString().padStart(2,"0")}`},ze=()=>{!Q.current||!(c!=null&&c.previewUrl)||(O?(Q.current.pause(),w(!1)):(Q.current.play(),w(!0)))};n.useEffect(()=>()=>{q.current&&clearInterval(q.current),L.current&&i&&L.current.stop()},[]);const me=x=>{x.preventDefault(),x.stopPropagation(),x.type==="dragenter"||x.type==="dragover"?S(!0):S(!1)},Te=x=>{x.preventDefault(),x.stopPropagation(),S(!1),x.dataTransfer.files&&x.dataTransfer.files[0]&&we(x.dataTransfer.files[0])},we=x=>{const b=x.type.startsWith("image/")?"image":x.type.startsWith("video/")?"video":x.type.startsWith("audio/")?"audio":"file";m({file:x,type:b,previewUrl:URL.createObjectURL(x)})},Ne=async x=>{if(x.preventDefault(),!j.trim()&&!c||X)return;let b=null;if(c){const R=await B(c.file,`chat_media/${t}`);R&&(b={url:R.url,type:R.type,name:R.name,duration:c.duration})}r(j,b),k(""),m(null),w(!1),g&&g()},h=()=>{o?(k(""),p==null||p()):l==null||l()},T=()=>{var x,b;return o?((x=o.b)==null?void 0:x.substring(0,50))||"Message":a?((b=a.b)==null?void 0:b.substring(0,50))||"Media":""};return e.jsxs("div",{className:`p-3 bg-white dark:bg-[#2c2e36] border-t dark:border-gray-700 shrink-0 transition-colors ${u?"bg-blue-50 dark:bg-blue-900/20 border-blue-400":""}`,onDragEnter:me,onDragLeave:me,onDragOver:me,onDrop:Te,children:[e.jsx(ne,{children:f.length>0&&e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-2 px-2 flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-brand-blue rounded-full animate-bounce"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-brand-blue rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-brand-blue rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:Ns(f)})]})}),e.jsx(ne,{children:i&&e.jsx(D.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium text-red-700 dark:text-red-400",children:"Recording..."}),e.jsx("span",{className:"font-mono text-red-600 dark:text-red-300 text-sm",children:je(N)})]}),e.jsx("div",{className:"flex items-center gap-0.5 mx-4",children:[...Array(20)].map((x,b)=>e.jsx(D.div,{className:"w-1 bg-red-400 rounded-full",animate:{height:[8,Math.random()*20+8,8]},transition:{duration:.5,repeat:1/0,delay:b*.05}},b))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:ye,className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/40 rounded-full transition",title:"Cancel recording",children:e.jsx(Se,{size:18})}),e.jsx("button",{type:"button",onClick:ce,className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition",title:"Stop recording",children:e.jsx(yt,{size:16,fill:"white"})})]})]})})}),e.jsx(ne,{children:(a||o)&&e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-between items-center bg-gray-100 dark:bg-gray-800 p-2.5 px-4 rounded-xl border-l-4 border-brand-blue mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[o?e.jsx(lt,{size:16,className:"text-brand-blue shrink-0"}):e.jsx(it,{size:16,className:"text-brand-blue shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue block",children:o?"Editing Message":`Replying to ${(a==null?void 0:a.n)||"User"}`}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate block",children:T()})]})]}),e.jsx("button",{onClick:h,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(Y,{size:16,className:"text-gray-400 hover:text-red-500"})})]})}),e.jsx(ne,{children:c&&e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"flex items-center gap-3 p-3 bg-gray-100 dark:bg-gray-800 rounded-xl mb-2 border dark:border-gray-700",children:[c.type==="image"?e.jsx("img",{src:c.previewUrl,className:"h-14 w-14 object-cover rounded-lg"}):c.type==="video"?e.jsx("video",{src:c.previewUrl,className:"h-14 w-14 object-cover rounded-lg"}):c.type==="audio"?e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{type:"button",onClick:ze,className:"h-12 w-12 bg-purple-500 text-white flex items-center justify-center rounded-full hover:bg-purple-600 transition shrink-0",children:O?e.jsx(ot,{size:20}):e.jsx(ct,{size:20,className:"ml-0.5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{size:14,className:"text-purple-500"}),e.jsx("span",{className:"text-sm font-bold dark:text-white",children:"Voice Message"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex items-center gap-0.5 flex-1",children:[...Array(30)].map((x,b)=>e.jsx("div",{className:"w-1 bg-purple-300 dark:bg-purple-700 rounded-full",style:{height:`${Math.random()*12+4}px`}},b))}),e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:c.duration?je(c.duration):"0:00"})]})]}),e.jsx("audio",{ref:Q,src:c.previewUrl,onEnded:()=>w(!1),className:"hidden"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-14 w-14 bg-gray-200 dark:bg-gray-700 text-gray-500 flex items-center justify-center rounded-lg",children:e.jsx(pe,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-bold dark:text-white truncate",children:c.file.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(c.file.size/1024).toFixed(1)," KB"]})]})]}),e.jsx("button",{onClick:()=>{m(null),w(!1)},className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition shrink-0",children:e.jsx(Y,{size:18,className:"text-gray-400 hover:text-red-500"})})]})}),e.jsxs("form",{onSubmit:Ne,className:"flex items-end gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",ref:F,className:"hidden",accept:"image/*,audio/*,video/*,.pdf,.doc,.docx,.txt,.zip",onChange:x=>we(x.target.files[0])}),e.jsx("button",{type:"button",onClick:()=>{var x;return(x=F.current)==null?void 0:x.click()},className:"p-2.5 text-gray-500 hover:text-brand-blue hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition shrink-0",title:"Attach file",children:e.jsx(jt,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-1 border-r dark:border-gray-700 pr-2",children:[e.jsx("button",{type:"button",onClick:()=>{I(!0),z(!1),G(!1)},className:"p-2 text-gray-500 hover:text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition",title:"Record video",children:e.jsx(Me,{size:18})}),e.jsxs("button",{type:"button",onClick:()=>{G(!E),z(!1)},className:"p-2 text-gray-500 hover:text-purple-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition relative",title:"GIF",ref:P,children:[e.jsx(wt,{size:18}),E&&e.jsx(ys,{onSelect:ee,onClose:()=>G(!1),position:"bottom"})]})]}),e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-[#1f2128] rounded-2xl border dark:border-gray-700 focus-within:ring-2 focus-within:ring-brand-blue transition-all flex items-end relative",children:[e.jsx("textarea",{ref:U,className:"w-full bg-transparent p-3 max-h-32 min-h-[44px] text-sm resize-none outline-none dark:text-white custom-scrollbar pr-20",placeholder:o?"Update message...":u?"Drop files here...":"Type a message...",value:j,onChange:W,onKeyDown:x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),Ne(x))},rows:1}),e.jsxs("div",{className:"absolute right-2 bottom-1.5 flex items-center gap-1",children:[e.jsxs("div",{className:"relative",ref:K,children:[e.jsx("button",{type:"button",onClick:()=>{z(!v),G(!1)},className:`p-1.5 rounded-full transition ${v?"bg-brand-blue/20 text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,title:"Emoji",children:e.jsx(Nt,{size:18})}),e.jsx(ne,{children:v&&e.jsx(ps,{onSelect:oe,onClose:()=>z(!1),position:"bottom"})})]}),e.jsx("button",{type:"button",onClick:i?ce:re,className:`p-1.5 rounded-full transition ${i?"bg-red-500 text-white animate-pulse":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,children:i?e.jsx(nt,{size:18}):e.jsx(Ve,{size:18})})]})]}),e.jsx("button",{type:"submit",disabled:!j.trim()&&!c||X,className:`p-2.5 text-white rounded-full shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all shrink-0 ${o?"bg-green-600 hover:bg-green-700":"bg-brand-blue hover:bg-blue-600"}`,children:X?e.jsx(de,{size:20,className:"animate-spin"}):o?e.jsx(vt,{size:20}):e.jsx(kt,{size:20})})]}),H&&e.jsx(js,{onRecorded:_,onClose:()=>I(!1),maxDuration:60})]})}function ks(...t){return tt(Le(t))}const ke=St.forwardRef(({className:t,variant:s="default",size:r="default",...a},o)=>{const l={default:"bg-blue-600 text-white hover:bg-blue-700 shadow-sm",destructive:"bg-red-500 text-white hover:bg-red-600 shadow-sm",outline:"border border-gray-200 bg-transparent hover:bg-gray-100 text-gray-900",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200",ghost:"hover:bg-gray-100 hover:text-gray-900 text-gray-600",link:"text-blue-600 underline-offset-4 hover:underline"},p={default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"};return e.jsx("button",{ref:o,className:ks("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:pointer-events-none disabled:opacity-50",l[s],p[r],t),...a})});ke.displayName="Button";function Ss({url:t,isOpen:s,onClose:r,previewData:a}){if(!s||!t)return null;const o=new URL(t).pathname;let l="Content";o.startsWith("/profile/")?l="User Profile":o.startsWith("/session/")?l="Session Details":o.startsWith("/studio/")&&(l="Studio Listing");const p=(a==null?void 0:a.title)||`${l} Preview`;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black bg-opacity-70 backdrop-blur-sm",onClick:r,children:e.jsxs("div",{className:"bg-gray-900 rounded-xl shadow-2xl w-full max-w-2xl h-3/4 max-h-[800px] flex flex-col transform transition-all duration-300 scale-100 opacity-100",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-800 rounded-t-xl sticky top-0",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate max-w-[80%]",children:p}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:e.jsx(ke,{variant:"ghost",size:"icon",className:"text-blue-400 hover:text-blue-300",children:e.jsx(Rt,{className:"w-5 h-5"})})}),e.jsx(ke,{onClick:r,variant:"ghost",size:"icon",className:"text-white hover:bg-gray-700",children:e.jsx(Y,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-y-auto custom-scrollbar text-gray-400 flex flex-col items-center justify-center text-center",children:[e.jsx("p",{className:"mb-4 text-lg font-medium text-white",children:"Embedded Content Simulation"}),e.jsx("p",{className:"mb-2",children:"This is where the actual SeshNx content (e.g., profile card, session details) would be rendered, based on the URL:"}),e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline break-all p-2 bg-gray-700 rounded-lg text-sm",children:t}),e.jsx("p",{className:"mt-4 text-sm",children:'In a real implementation, you would use a dedicated component (e.g., `ProfileCard id="..."`) here instead of an iframe to display the content securely and natively.'})]}),e.jsx("div",{className:"p-3 border-t border-gray-700 bg-gray-800 rounded-b-xl flex justify-end",children:e.jsx(ke,{onClick:r,variant:"secondary",children:"Done"})})]})})}function Rs({status:t="sent",size:s=12,className:r=""}){const a={sending:{icon:Ue,color:"text-gray-400",animate:!0},sent:{icon:Re,color:"text-gray-400",animate:!1},delivered:{icon:qe,color:"text-gray-400",animate:!1},read:{icon:qe,color:"text-brand-blue",animate:!1}},o=a[t]||a.sent,l=o.icon;return e.jsx(D.div,{animate:o.animate?{rotate:[0,360]}:{},transition:o.animate?{duration:2,repeat:1/0,ease:"linear"}:{},className:`inline-flex items-center ${o.color} ${r}`,children:e.jsx(l,{size:s,className:t==="read"?"fill-current":""})})}function $s({audioUrl:t,color:s="brand-blue",height:r=40}){const a=n.useRef(null),o=n.useRef(null),l=n.useRef(null),p=n.useRef(null),f=n.useRef(null),[y,g]=n.useState(!1);n.useEffect(()=>{if(!t||!a.current)return;const c=a.current,m=c.getContext("2d"),i=new Audio(t);o.current=i,c.width=c.offsetWidth,c.height=r;const d=new(window.AudioContext||window.webkitAudioContext),N=d.createAnalyser(),$=d.createMediaElementSource(i);N.fftSize=256,$.connect(N),N.connect(d.destination),p.current=d,f.current=N;const u=N.frequencyBinCount,S=new Uint8Array(u),v=()=>{if(i.paused){j(m,c.width,c.height);return}l.current=requestAnimationFrame(v),N.getByteFrequencyData(S),m.clearRect(0,0,c.width,c.height);const z=c.width/u*2;let E=0;for(let G=0;G<u;G++){const H=S[G]/255*c.height,I=m.createLinearGradient(0,0,0,c.height);I.addColorStop(0,"#3b82f6"),I.addColorStop(1,"#8b5cf6"),m.fillStyle=I,m.fillRect(E,c.height-H,z-1,H),E+=z}};return i.addEventListener("play",()=>{g(!0),v()}),i.addEventListener("pause",()=>{g(!1),l.current&&cancelAnimationFrame(l.current),j(m,c.width,c.height)}),i.addEventListener("ended",()=>{g(!1),l.current&&cancelAnimationFrame(l.current),j(m,c.width,c.height)}),j(m,c.width,c.height),()=>{var z;l.current&&cancelAnimationFrame(l.current),i.pause(),(z=p.current)==null||z.close()}},[t,r,y]);const j=(c,m,i)=>{c.clearRect(0,0,m,i),c.fillStyle="#3b82f6";const d=50,N=m/d,$=2;for(let u=0;u<d;u++){const S=Math.random()*i*.3+i*.1,v=u*N;c.fillRect(v,i-S,N-$,S)}},k=()=>{o.current&&(y?o.current.pause():o.current.play())};return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:k,className:"w-10 h-10 flex items-center justify-center bg-brand-blue text-white rounded-full hover:bg-blue-600 transition shrink-0",children:y?e.jsx(ot,{size:16}):e.jsx(ct,{size:16,className:"ml-0.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("canvas",{ref:a,className:"w-full rounded",style:{height:`${r}px`}}),e.jsx("audio",{ref:o,src:t})]})]})}const Ms=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"];function zs({message:t,isCurrentUser:s,previousMessage:r,currentUserId:a,chatId:o,linkPreviewData:l,messageStatus:p="sent",onReaction:f,onReply:y,onEdit:g,onDelete:j,onForward:k,onSeshNxLinkClick:c,onUserClick:m}){var ee;const[i,d]=n.useState(!1),[N,$]=n.useState(!1),[u,S]=n.useState(!1),v=n.useRef(null),z=n.useRef(null),E=!r||r.s!==t.s,G=r&&new Date(t.t).toDateString()===new Date(r.t).toDateString(),H=t.t||Date.now(),I=(r==null?void 0:r.t)||0,O=r&&H-I>3e5,w=!G||!r,F=E||O,U=!s&&E,L=new Date(t.t||Date.now());n.useEffect(()=>{const _=W=>{v.current&&!v.current.contains(W.target)&&(d(!1),$(!1))};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[]);const J=()=>{navigator.clipboard.writeText(t.b||""),S(!0),setTimeout(()=>S(!1),2e3),d(!1)},K=_=>{f==null||f(t.id,_),$(!1),d(!1)},P=t.reactions?Object.entries(t.reactions).reduce((_,[W,oe])=>{const re=typeof oe=="object"?Object.keys(oe).length:0;return re>0&&(_[W]=re),_},{}):{},q=Object.keys(P).length>0,Q=t.reactions?(ee=Object.entries(t.reactions).find(([_,W])=>typeof W=="object"&&W[a]))==null?void 0:ee[0]:null,B=s?"bg-brand-blue text-white rounded-br-sm":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-sm";if(t.deleted||t.deletedForAll)return e.jsx("div",{className:`flex ${s?"justify-end":"justify-start"} ${E?"mt-3":"mt-0.5"}`,children:e.jsx("div",{className:"px-4 py-2 rounded-2xl bg-gray-100 dark:bg-gray-800 text-gray-400 italic text-sm",children:"ðŸš« This message was deleted"})});if(t.deletedFor&&t.deletedFor[a])return null;const X=()=>{var W;if(!l)return null;const _=(W=l.url)==null?void 0:W.includes("seshnx.net");return e.jsx("div",{className:"mt-2 block border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden bg-white dark:bg-gray-800 max-w-[280px]",children:_?e.jsxs("button",{onClick:()=>c==null?void 0:c(l),className:"w-full text-left",children:[l.image&&e.jsx("div",{className:"h-28 w-full bg-cover bg-center",style:{backgroundImage:`url(${l.image})`}}),e.jsxs("div",{className:"p-2",children:[e.jsxs("p",{className:"font-semibold text-xs text-brand-blue truncate flex items-center",children:[e.jsx(Mt,{className:"w-3 h-3 mr-1"}),l.title||"SeshNx Link"]}),l.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 line-clamp-2",children:l.description})]})]}):e.jsxs("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",children:[l.image&&e.jsx("div",{className:"h-28 w-full bg-cover bg-center",style:{backgroundImage:`url(${l.image})`}}),e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"font-semibold text-xs text-brand-blue truncate",children:l.title||l.url}),l.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 line-clamp-2",children:l.description}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-1 flex items-center",children:[e.jsx(zt,{className:"w-2.5 h-2.5 mr-1"}),new URL(l.url).hostname]})]})]})})};return e.jsxs(e.Fragment,{children:[w&&e.jsx("div",{className:"text-center my-4",children:e.jsx("span",{className:"text-[10px] text-gray-400 dark:text-gray-500 font-bold uppercase tracking-wider bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full",children:L.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("div",{className:`group flex items-end gap-2 ${s?"flex-row-reverse":"flex-row"} ${E?"mt-3":"mt-0.5"}`,ref:z,children:[!s&&e.jsx("div",{className:"w-8 shrink-0",children:U&&e.jsx(xe,{src:t.photo,name:t.n,size:"xs",className:"cursor-pointer",onClick:()=>m==null?void 0:m(t.s)})}),e.jsxs("div",{className:`relative max-w-[75%] ${s?"items-end":"items-start"}`,children:[!s&&E&&t.n&&e.jsx("p",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 mb-1 ml-1",children:t.n}),t.replyTo&&e.jsxs("div",{className:`mb-1 px-3 py-1.5 rounded-lg text-xs border-l-2 border-brand-blue ${s?"bg-blue-400/30 text-blue-100":"bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300"}`,children:[e.jsx("p",{className:"font-bold text-[10px] mb-0.5",children:t.replyTo.sender}),e.jsx("p",{className:"truncate opacity-80",children:t.replyTo.text})]}),e.jsxs("div",{className:`relative px-3 py-2 rounded-2xl shadow-sm ${B} cursor-pointer transition-all hover:shadow-md`,onClick:()=>d(!i),children:[t.media&&e.jsxs("div",{className:"mb-2",children:[t.media.type==="image"&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[t.media.gif&&e.jsx("span",{className:"absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full font-bold",children:"GIF"}),e.jsx("img",{src:t.media.url,alt:"Shared",className:"max-w-full h-auto rounded-lg max-h-60 object-cover"})]}),t.media.type==="video"&&e.jsx("video",{controls:!0,src:t.media.url,className:"max-w-full h-auto rounded-lg max-h-60"}),t.media.type==="audio"&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 max-w-[280px]",children:e.jsx($s,{audioUrl:t.media.url,height:50})}),t.media.type==="file"&&e.jsxs("a",{href:t.media.url,target:"_blank",rel:"noopener noreferrer",download:t.media.name,className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center shrink-0",children:e.jsx(pe,{size:20,className:"text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold dark:text-white truncate",children:t.media.name||"File"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click to download"})]}),e.jsx(Be,{size:18,className:"text-gray-400 group-hover:text-brand-blue transition shrink-0"})]})]}),t.b&&e.jsx("p",{className:"text-sm break-words whitespace-pre-wrap leading-relaxed",children:t.b}),t.b&&X(),t.edited&&e.jsx("span",{className:`text-[9px] ${s?"text-blue-200":"text-gray-400"} ml-1`,children:"(edited)"})]}),q&&e.jsx("div",{className:`flex flex-wrap gap-1 mt-1 ${s?"justify-end":"justify-start"}`,children:Object.entries(P).map(([_,W])=>e.jsxs(D.button,{initial:{scale:0},animate:{scale:1},onClick:()=>K(_),className:`flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-xs border transition-all ${Q===_?"bg-brand-blue/20 border-brand-blue text-brand-blue":"bg-gray-100 dark:bg-gray-700 border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{children:_}),e.jsx("span",{className:"text-[10px] font-bold",children:W})]},_))}),F&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 ${s?"justify-end":"justify-start"}`,children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:L.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}),s&&e.jsx(Rs,{status:p,size:10,className:"ml-0.5"})]}),e.jsx(ne,{children:i&&e.jsxs(D.div,{ref:v,initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},className:`absolute z-50 ${s?"right-0":"left-0"} bottom-full mb-2 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden min-w-[180px]`,children:[e.jsx("div",{className:"flex justify-center gap-1 p-2 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:Ms.map(_=>e.jsx(D.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:()=>K(_),className:`text-lg p-1 rounded-full transition ${Q===_?"bg-brand-blue/20":"hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:_},_))}),e.jsxs("div",{className:"p-1",children:[e.jsxs("button",{onClick:()=>{y==null||y(t),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(it,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Reply"})]}),e.jsxs("button",{onClick:J,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx($t,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:u?"Copied!":"Copy"})]}),e.jsxs("button",{onClick:()=>{k==null||k(t),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(Ee,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Forward"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{g==null||g(t),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(lt,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Edit"})]}),e.jsxs("button",{onClick:()=>{j==null||j(t,"everyone"),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition text-red-500",children:[e.jsx(Se,{size:16}),e.jsx("span",{children:"Delete for Everyone"})]})]}),e.jsxs("button",{onClick:()=>{j==null||j(t,"me"),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition text-gray-500",children:[e.jsx(Se,{size:16}),e.jsx("span",{children:"Delete for Me"})]})]})]})})]}),s&&e.jsx("div",{className:"w-8 shrink-0"})]})]})}function Ts({message:t,conversations:s,currentUserId:r,onForward:a,onClose:o}){const[l,p]=n.useState(""),[f,y]=n.useState([]),[g,j]=n.useState(!1),k=l.trim()?s.filter(d=>{var N;return(N=d.n)==null?void 0:N.toLowerCase().includes(l.toLowerCase())}):s,c=d=>{y(N=>N.includes(d)?N.filter($=>$!==d):[...N,d])},m=async()=>{if(f.length!==0){j(!0);try{await a(t,f),o()}catch(d){console.error("Forward error:",d),alert("Failed to forward message")}j(!1)}},i=()=>{var d;return t.media?t.media.type==="image"?"ðŸ“· Image":t.media.type==="video"?"ðŸŽ¥ Video":t.media.type==="audio"?"ðŸŽµ Audio":"ðŸ“Ž File":((d=t.b)==null?void 0:d.substring(0,100))||"Message"};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsxs(D.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"text-brand-blue",size:20}),e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Forward Message"})]}),e.jsx("button",{onClick:o,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(Y,{size:20})})]}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-800 border-b dark:border-gray-700 shrink-0",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Forwarding:"}),e.jsx("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:e.jsx("p",{className:"text-sm dark:text-gray-200 line-clamp-2",children:i()})})]}),e.jsx("div",{className:"px-4 py-3 border-b dark:border-gray-700 shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx($e,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:l,onChange:d=>p(d.target.value),className:"w-full pl-9 pr-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white transition"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:k.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No conversations found"})}):k.map(d=>{const N=f.includes(d.id);return e.jsxs(D.div,{whileTap:{scale:.98},onClick:()=>c(d.id),className:`
                                        flex items-center gap-3 p-4 cursor-pointer transition
                                        border-b dark:border-gray-700/50
                                        ${N?"bg-brand-blue/10 dark:bg-brand-blue/20":"hover:bg-gray-50 dark:hover:bg-gray-800"}
                                    `,children:[e.jsxs("div",{className:"relative",children:[e.jsx(xe,{src:d.photo,name:d.n,size:"md",isGroup:d.type==="group"}),N&&e.jsx(D.div,{initial:{scale:0},animate:{scale:1},className:"absolute -bottom-1 -right-1 w-5 h-5 bg-brand-blue rounded-full flex items-center justify-center",children:e.jsx(Re,{size:12,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm dark:text-white truncate",children:d.n}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:d.type==="group"?"Group":"Direct message"})]}),e.jsx("div",{className:`
                                        w-5 h-5 rounded-full border-2 transition
                                        ${N?"border-brand-blue bg-brand-blue":"border-gray-300 dark:border-gray-600"}
                                    `,children:N&&e.jsx(Re,{size:12,className:"text-white m-auto"})})]},d.id)})}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[f.length," conversation",f.length!==1?"s":""," selected"]}),f.length>0&&e.jsx("button",{onClick:()=>y([]),className:"text-xs text-brand-blue hover:underline",children:"Clear all"})]}),e.jsx("button",{onClick:m,disabled:f.length===0||g,className:"w-full bg-brand-blue text-white py-3 rounded-xl font-bold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"animate-spin",size:18}),"Forwarding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{size:18}),"Forward"]})})]})]})})}function As(t,s){var m;const r=n.useMemo(()=>te(),[]),a=n.useMemo(()=>t&&s&&r?{chatId:t}:"skip",[t,s,r]),o=be(V.readReceipts.getReadReceipts,a),l=Z(V.readReceipts.markAsRead),p=Z(V.readReceipts.markMultipleAsRead),f=n.useMemo(()=>{if(!o)return{};const i={};return o.forEach(d=>{i[d.userId]?d.readAt>i[d.userId].readAt&&(i[d.userId]={lastReadMessageId:d.messageId,readAt:d.readAt}):i[d.userId]={lastReadMessageId:d.messageId,readAt:d.readAt}}),i},[o]),y=((m=f[s])==null?void 0:m.lastReadMessageId)||null,g=n.useCallback(async i=>{if(!(!t||!s||!i||!te()||!l||!p))try{const d=Array.isArray(i)?i:[i];d.length===1?await l({chatId:t,messageId:d[0],userId:s}):await p({chatId:t,messageIds:d,userId:s})}catch(d){console.error("Mark as read error:",d)}},[t,s,l,p]),j=n.useCallback((i,d,N=null)=>{if(!i||!d)return!1;const $=f[d];if(!$||!$.lastReadMessageId)return!1;const u=$.lastReadMessageId;if(u===i)return!0;if(N&&Array.isArray(N)){const S=N.find(z=>z.id===i),v=N.find(z=>z.id===u);if(S&&v&&S.t&&v.t)return S.t<=v.t}return u>=i},[f]),k=n.useCallback(i=>{var d;return((d=f[i])==null?void 0:d.lastReadMessageId)||null},[f]),c=n.useCallback(i=>y===i||y&&y>=i,[y]);return{readReceipts:f,myLastRead:y,markAsRead:g,isMessageRead:j,getLastReadMessage:k,hasCurrentUserRead:c}}const Ie=new Map,Is=5*60*1e3;async function Fs(t){const s=t.match(/(https?:\/\/[^\s]+)/);if(!s)return null;const r=s[0],a=Ie.get(r);if(a&&Date.now()-a.timestamp<Is)return a.data;try{const l=Xt(ue),f=await Zt(l,"getLinkPreview")({url:r});if(f.data)return Ie.set(r,{data:f.data,timestamp:Date.now()}),f.data}catch(l){console.warn("Firebase getLinkPreview unavailable, using fallback:",l.message)}const o=await Ls(r);return Ie.set(r,{data:o,timestamp:Date.now()}),o}async function Ls(t){const s={url:t,title:null,description:null,image:null,siteName:null};try{const r=new URL(t),a=r.hostname.toLowerCase();if(a.includes("youtube.com")||a.includes("youtu.be")){let o=null;a.includes("youtu.be")?o=r.pathname.slice(1):o=r.searchParams.get("v"),s.siteName="YouTube",s.title="YouTube Video",s.description="Watch this video on YouTube",o&&(s.image=`https://img.youtube.com/vi/${o}/mqdefault.jpg`)}else if(a.includes("spotify.com"))s.siteName="Spotify",s.title="Spotify Content",s.description="Listen on Spotify",s.image="https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_RGB_Green.png";else if(a.includes("soundcloud.com"))s.siteName="SoundCloud",s.title="SoundCloud Track",s.description="Listen on SoundCloud",s.image="https://soundcloud.com/press/assets/press-kit/soundcloud-logo.png";else if(a.includes("github.com")){const o=r.pathname.split("/").filter(l=>l);s.siteName="GitHub",s.title=o.length>=2?`${o[0]}/${o[1]}`:"GitHub Repository",s.description="View on GitHub",o.length>=2&&(s.image=`https://opengraph.githubassets.com/1/${o[0]}/${o[1]}`)}else if(a.includes("twitter.com")||a.includes("x.com"))s.siteName="X (Twitter)",s.title="Tweet",s.description="View on X";else if(a.includes("instagram.com"))s.siteName="Instagram",s.title="Instagram Post",s.description="View on Instagram";else if(a.includes("seshnx.net")||a.includes("seshnx.com"))s.siteName="SeshNx",s.title="SeshNx Link",s.description="View on SeshNx platform",s.image="https://seshnx.net/pwa-512x512.png";else if(a.includes("linkedin.com"))s.siteName="LinkedIn",s.title="LinkedIn Post",s.description="View on LinkedIn";else if(a.includes("music.apple.com"))s.siteName="Apple Music",s.title="Apple Music",s.description="Listen on Apple Music";else if(a.includes("tiktok.com"))s.siteName="TikTok",s.title="TikTok Video",s.description="Watch on TikTok";else if(a.includes("vimeo.com"))s.siteName="Vimeo",s.title="Vimeo Video",s.description="Watch on Vimeo";else if(a.includes("bandcamp.com")){const o=a.split(".")[0];s.siteName="Bandcamp",s.title=o!=="bandcamp"?`${o} on Bandcamp`:"Bandcamp",s.description="Listen on Bandcamp"}else s.siteName=a.replace("www.",""),s.title=a.replace("www.",""),s.description=`Visit ${a}`;return s}catch(r){return console.warn("Link preview parsing error:",r),{url:t,title:t,description:null,image:null}}}function Vs({user:t,userData:s,activeChat:r,conversations:a,onBack:o,toggleDetails:l,openPublicProfile:p}){const[f,y]=n.useState({}),[g,j]=n.useState({isOpen:!1,url:"",previewData:null}),[k,c]=n.useState(null),[m,i]=n.useState(null),[d,N]=n.useState(null),$=n.useRef(null),u=r==null?void 0:r.id,S=(r==null?void 0:r.name)||(r==null?void 0:r.n)||"Unknown User",v=n.useMemo(()=>(r==null?void 0:r.type)==="group"?null:r!=null&&r.uid?r.uid:u&&u.includes("_")?u.split("_").find(T=>T!==(t==null?void 0:t.uid)):null,[r,u,t==null?void 0:t.uid]),{online:z,lastSeen:E,loading:G}=ut(v),{markAsRead:H,hasCurrentUserRead:I,isMessageRead:O}=As(u,t==null?void 0:t.uid),{typingUsers:w,setTyping:F,clearTyping:U}=ws(u,t==null?void 0:t.uid,(s==null?void 0:s.firstName)||"User"),L=te(),J=n.useMemo(()=>u&&L?{chatId:u,limit:100}:"skip",[u,L]),K=n.useMemo(()=>u&&L&&(r==null?void 0:r.type)==="group"?{chatId:u}:"skip",[u,L,r==null?void 0:r.type]),P=be(V.conversations.getChatMembers,K),q=n.useMemo(()=>P?P.map(h=>h.userId):[],[P]),Q=be(V.messages.getMessages,J),B=n.useMemo(()=>Q?Q.map(h=>({id:h._id,b:h.content||"",s:h.senderId,n:h.senderName,photo:h.senderPhoto||"",t:h.timestamp,edited:h.edited||!1,editedAt:h.editedAt,deleted:h.deleted||!1,deletedForAll:h.deletedForAll||!1,media:h.media,replyTo:h.replyTo,reactions:h.reactions||{}})):[],[Q]),X=Z(V.messages.sendMessage),ee=Z(V.messages.editMessage),_=Z(V.messages.deleteMessage),W=Z(V.messages.addReaction),oe=Z(V.messages.removeReaction),re=Z(V.conversations.updateConversation),ce=Z(V.conversations.updateUnreadCount);n.useEffect(()=>{$.current&&B.length>0&&$.current.scrollIntoView({behavior:"smooth"})},[B]);const ye=n.useRef(0);n.useEffect(()=>{if(u&&(t!=null&&t.uid)&&B.length>0){const h=B.map(x=>x.id),T=h.length;T!==ye.current&&(ye.current=T,H(h))}},[u,t==null?void 0:t.uid,B.length,H]),n.useEffect(()=>{B.forEach(h=>{if(h.b){const T=h.b.match(/(https?:\/\/[^\s]+)/);if(T){const x=T[0];f[h.id]||Fs(x).then(b=>y(R=>({...R,[h.id]:b}))).catch(b=>console.error(b))}}})},[B]);const je=async(h,T)=>{var x,b;if(!(!u||!(t!=null&&t.uid)||!te()))try{const R=B.find(C=>C.id===h);if(!R)return;((b=(x=R.reactions)==null?void 0:x[T])==null?void 0:b.includes(t.uid))?await oe({messageId:h,userId:t.uid,emoji:T}):await W({messageId:h,userId:t.uid,emoji:T})}catch(R){console.error("Reaction error:",R)}},ze=async(h,T)=>{if(!te()||!X||!re){alert("Chat functionality is not available. Convex is not configured.");return}const x=h.b||"",b=h.media||null;for(const R of T)try{await X({chatId:R,senderId:t.uid,senderName:s.firstName||"User",senderPhoto:s.photoURL||void 0,content:`ç«Šï½ª Forwarded: ${x}`,media:b||void 0});const M=a==null?void 0:a.find(se=>se.id===R),C=x||(b?`Forwarded ${b.type}`:"Forwarded message");await re({userId:t.uid,chatId:R,lastMessage:`ç«Šï½ª ${C}`,lastMessageTime:Date.now(),lastSenderId:t.uid,chatName:(M==null?void 0:M.name)||(M==null?void 0:M.n),chatPhoto:(M==null?void 0:M.photo)||"",chatType:(M==null?void 0:M.type)||"direct",otherUserId:M==null?void 0:M.uid})}catch(M){console.error("Forward error for chat:",R,M)}},me=async(h,T)=>{var b;if(!u||!(h!=null&&h.trim())&&!T||!te()||!X||!ee||!re||!ce)return;let x=h?h.trim():"";if(x.length===0&&T&&(x=T.type==="image"?"ðŸ“· Image":T.type==="video"?"ðŸŽ¥ Video":T.type==="audio"?"ðŸŽµ Audio":"ðŸ“Ž File"),m)try{await ee({messageId:m.id,content:x,senderId:t.uid}),i(null);return}catch(R){console.error("Edit error:",R);return}try{await X({chatId:u,senderId:t.uid,senderName:s.firstName||"User",senderPhoto:s.photoURL||void 0,content:x||void 0,media:T||void 0,replyTo:k?{messageId:k.id,text:((b=k.b)==null?void 0:b.substring(0,100))||"Media",sender:k.n||"User"}:void 0});const R=x||(T?`Sent ${T.type}`:"Message");let M=[],C=r.uid;!C&&r.type!=="group"&&u&&u.includes("_")&&(C=u.split("_").find(mt=>mt!==t.uid)),r.type==="group"?M=q.length>0?[...new Set([t.uid,...q])]:[t.uid]:C?M=[t.uid,C]:M=[t.uid];for(const se of M)await re({userId:se,chatId:u,lastMessage:R,lastMessageTime:Date.now(),lastSenderId:t.uid,chatName:r.type==="group"?S:r.name||r.n,chatPhoto:r.photo||"",chatType:r.type||"direct",otherUserId:r.type==="direct"?se===t.uid?C:t.uid:void 0}),se===t.uid?await ce({userId:se,chatId:u,setTo:0}):await ce({userId:se,chatId:u,increment:1});c(null)}catch(R){console.error("Send message error:",R)}},Te=async(h,T=!1)=>{if(!(!u||!(t!=null&&t.uid)||!te()||!_))try{await _({messageId:h,senderId:t.uid,forEveryone:T})}catch(x){console.error("Delete error:",x)}},we=n.useMemo(()=>{var h;return e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-800 bg-white dark:bg-[#1f2128]",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("button",{onClick:o,className:"md:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(rt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 cursor-pointer",onClick:()=>p==null?void 0:p(v?{uid:v}:null),children:[e.jsx(xe,{src:(r==null?void 0:r.photo)||((h=r==null?void 0:r.n)==null?void 0:h.photo)||"",name:S,size:"md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:S}),(r==null?void 0:r.type)!=="group"&&e.jsx(xt,{online:z,lastSeen:E,loading:G})]}),(r==null?void 0:r.type)!=="group"&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:z?"Online":E?`Last seen ${Ne(E)}`:"Offline"})]})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(Tt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})},[r,S,z,E,G,v,o,l,p]),Ne=h=>{if(!h)return"Never";const T=h,b=Date.now()-T,R=Math.floor(b/6e4),M=Math.floor(R/60),C=Math.floor(M/24);return R<1?"Just now":R<60?`${R}m ago`:M<24?`${M}h ago`:C<7?`${C}d ago`:new Date(T).toLocaleDateString()};return!r||!u?e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#1f2128] items-center justify-center text-gray-400",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(he,{size:64,className:"text-gray-200 dark:text-gray-700 mb-2"})}),e.jsx("p",{children:"Select a conversation to start chatting"})]}):e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#1f2128]",children:[we,e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide",children:[B.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{children:"No messages yet. Start the conversation!"})}):B.map((h,T)=>{const x=T>0?B[T-1]:null,b=h.s===(t==null?void 0:t.uid),R=O(h.id),M=I(h.id);return e.jsx(zs,{message:h,isCurrentUser:b,previousMessage:x,currentUserId:t==null?void 0:t.uid,chatId:u,linkPreviewData:f[h.id],messageStatus:R?"read":M?"delivered":"sent",onReaction:C=>je(h.id,C),onReply:()=>c(h),onEdit:()=>i(h),onDelete:C=>Te(h.id,C),onForward:()=>N(h),onSeshNxLinkClick:C=>j({isOpen:!0,url:C,previewData:null}),onUserClick:()=>p==null?void 0:p({uid:h.s})},h.id)}),e.jsx("div",{ref:$})]}),e.jsx(vs,{activeChatId:u,uid:t==null?void 0:t.uid,onSend:me,replyingTo:k,editingMessage:m,onCancelReply:()=>c(null),onCancelEdit:()=>i(null),typingUsers:w,onTyping:F,onStopTyping:U}),d&&e.jsx(Ts,{message:d,conversations:a,onClose:()=>N(null),onForward:ze}),g.isOpen&&e.jsx(Ss,{url:g.url,previewData:g.previewData,onClose:()=>j({isOpen:!1,url:"",previewData:null})})]})}function Fe({title:t,value:s,icon:r,sub:a,bg:o="bg-white dark:bg-[#2c2e36]",text:l="text-gray-900 dark:text-white"}){return e.jsxs("div",{className:`${o} p-5 rounded-xl border border-gray-100 dark:border-gray-700 shadow-sm flex flex-col justify-between h-28`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-medium ${l==="text-white"?"text-blue-100":"text-gray-500"}`,children:t}),e.jsx("div",{className:`text-2xl font-extrabold ${l}`,children:s})]}),e.jsx("div",{className:"opacity-80",children:r})]}),a&&e.jsx("div",{className:"text-xs mt-auto opacity-75",children:a})]})}function Es({chatId:t,onClose:s,onMediaSelect:r}){const[a,o]=n.useState([]),[l,p]=n.useState(!0),[f,y]=n.useState(null),[g,j]=n.useState("all");n.useEffect(()=>{if(!t||!ae)return;const i=es(fe(ae,`messages/${t}`),ss("t"),ts(500)),d=rs(i,N=>{const $=N.val();if($){const S=Object.entries($).map(([v,z])=>({id:v,...z})).filter(v=>v.media&&!v.deleted&&!v.deletedForAll).map(v=>({id:v.id,...v.media,messageId:v.id,timestamp:v.t,sender:v.n})).sort((v,z)=>(v.timestamp||0)-(z.timestamp||0));o(S)}else o([]);p(!1)});return()=>d()},[t,ae]);const k=g==="all"?a:a.filter(i=>g==="images"?i.type==="image":g==="videos"?i.type==="video":g==="audio"?i.type==="audio":g==="files"?i.type==="file":!0),c=i=>{y(i),r&&r(i)},m=i=>{const d=document.createElement("a");d.href=i.url,d.download=i.name||"download",d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d)};return e.jsxs("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:[e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between shrink-0",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Media Gallery"}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(Y,{size:20})})]}),e.jsx("div",{className:"p-3 border-b dark:border-gray-700 flex gap-2 overflow-x-auto scrollbar-hide shrink-0",children:[{key:"all",label:"All",icon:null},{key:"images",label:"Images",icon:He},{key:"videos",label:"Videos",icon:Me},{key:"audio",label:"Audio",icon:_e},{key:"files",label:"Files",icon:pe}].map(i=>e.jsxs("button",{onClick:()=>j(i.key),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold whitespace-nowrap transition ${g===i.key?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200"}`,children:[i.icon&&e.jsx(i.icon,{size:16}),i.label,e.jsxs("span",{className:"text-xs opacity-70",children:["(",k.filter(d=>i.key==="all"||d.type===i.key).length,")"]})]},i.key))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4",children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-blue border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading media..."})]}):k.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(He,{size:48,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No media found"})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3",children:k.map(i=>e.jsxs(D.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>c(i),className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 cursor-pointer group",children:[i.type==="image"?e.jsx("img",{src:i.url,alt:"Media",className:"w-full h-full object-cover"}):i.type==="video"?e.jsx("video",{src:i.url,className:"w-full h-full object-cover"}):i.type==="audio"?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-purple-100 dark:bg-purple-900/30",children:e.jsx(_e,{size:32,className:"text-purple-600 dark:text-purple-400"})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-100 dark:bg-blue-900/30",children:e.jsx(pe,{size:32,className:"text-blue-600 dark:text-blue-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition flex items-center justify-center",children:e.jsx(Be,{size:20,className:"text-white opacity-0 group-hover:opacity-100 transition"})})]},i.id))})})]}),e.jsx(ne,{children:f&&e.jsx(_s,{media:f,onClose:()=>y(null),onDownload:m})})]})}function _s({media:t,onClose:s,onDownload:r}){const[a,o]=n.useState([]),[l,p]=n.useState(0);n.useEffect(()=>{o([t]),p(0)},[t]);const f=()=>{l<a.length-1&&p(l+1)},y=()=>{l>0&&p(l-1)},g=a[l]||t;return e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/95 z-[90] flex items-center justify-center",onClick:s,children:e.jsxs("div",{className:"relative max-w-7xl max-h-[90vh] w-full h-full flex items-center justify-center p-4",onClick:j=>j.stopPropagation(),children:[e.jsx("button",{onClick:s,className:"absolute top-4 right-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70 transition z-10",children:e.jsx(Y,{size:24})}),g.type==="image"&&e.jsx("img",{src:g.url,alt:"Media",className:"max-w-full max-h-full object-contain rounded-lg"}),g.type==="video"&&e.jsx("video",{src:g.url,controls:!0,className:"max-w-full max-h-full rounded-lg",autoPlay:!0}),g.type==="audio"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md",children:[e.jsx("div",{className:"w-32 h-32 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(_e,{size:48,className:"text-purple-600 dark:text-purple-400"})}),e.jsx("audio",{src:g.url,controls:!0,className:"w-full",autoPlay:!0}),e.jsx("p",{className:"text-center mt-4 text-sm text-gray-500",children:g.name})]}),g.type==="file"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md text-center",children:[e.jsx(pe,{size:64,className:"text-blue-600 dark:text-blue-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-bold dark:text-white mb-2",children:g.name}),e.jsx("a",{href:g.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block mt-4 px-6 py-2 bg-brand-blue text-white rounded-lg hover:bg-blue-600 transition",children:"Open File"})]}),a.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:y,disabled:l===0,className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 transition",children:e.jsx(At,{size:24})}),e.jsx("button",{onClick:f,disabled:l===a.length-1,className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 transition",children:e.jsx(at,{size:24})})]}),e.jsx("button",{onClick:()=>r(g),className:"absolute bottom-4 left-1/2 -translate-x-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 transition",children:e.jsx(Be,{size:20})})]})})}function qs({activeChat:t,onClose:s,currentUser:r}){const[a,o]=n.useState([]),[l,p]=n.useState({sessions:0,rating:0,responseTime:"N/A"}),[f,y]=n.useState(!0),[g,j]=n.useState(!1),[k,c]=n.useState(!1),m=t.type==="group",i=t.uid,d=t.name||t.n||"Unknown";n.useEffect(()=>{const u=async()=>{y(!0);try{if(o([]),!m&&i){const S=Ke(ge,`artifacts/${A}/users/${i}/public_profile/main`),v=await as(S),z=v.exists()?v.data():{},E=ns(ge,`artifacts/${A}/public/data/bookings`),G=Ce(E,le("senderId","==",r.uid||""),le("targetId","==",i),le("status","==","Completed")),H=await ls(G);p({sessions:H.data().count,rating:z.rating||"New",responseTime:z.responseTime||"~1hr"})}}catch(S){console.error("Failed to load details:",S)}y(!1)};t!=null&&t.id&&u()},[t.id,i,m,r==null?void 0:r.uid]);const N=async()=>{if(!(m||!i||!r)&&confirm(`Are you sure you want to block ${d}?`)){j(!0);try{const u=Ke(ge,ds(r.uid).userProfile);await is(u,{"settings.social.blockedUsers":os(i)}),alert("User blocked."),s()}catch(u){console.error("Block failed:",u),alert("Failed to block user.")}j(!1)}},$=()=>{alert("Please use the report option on their profile page for full moderation tools.")};return e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full md:w-80 bg-gray-800 shadow-xl z-20 flex flex-col transition-transform duration-300 ease-in-out border-l border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Details"}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-full transition duration-150","aria-label":"Close details",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 flex flex-col items-center border-b border-gray-700 bg-gray-800",children:[e.jsxs("div",{className:"relative w-24 h-24 rounded-full overflow-hidden mb-4 bg-gray-700 flex items-center justify-center shadow-lg border-4 border-gray-600",children:[e.jsx("img",{src:t.photo,className:"w-full h-full object-cover",onError:u=>u.target.src="",alt:d}),!t.photo&&(m?e.jsx(he,{className:"w-10 h-10 text-gray-500"}):e.jsx(st,{className:"w-10 h-10 text-gray-500"}))]}),e.jsx("h4",{className:"text-xl font-bold text-white text-center leading-tight",children:d}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2 flex items-center px-3 py-1 bg-gray-700 rounded-full",children:[m?e.jsx(he,{className:"w-3 h-3 mr-1"}):e.jsx(We,{className:"w-3 h-3 mr-1"}),m?"Group Chat":t.role||"Creative"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[!m&&e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3 tracking-wider",children:"Performance"}),f?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(de,{className:"animate-spin text-brand-blue"})}):e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(Fe,{title:"Sessions",value:l.sessions,icon:We,color:"text-blue-400"}),e.jsx(Fe,{title:"Rating",value:l.rating,icon:Qe,color:"text-yellow-400"}),e.jsx(Fe,{title:"Reply Time",value:l.responseTime,icon:Ue,color:"text-green-400"})]})]}),e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Shared Media"}),e.jsx("button",{onClick:()=>c(!0),className:"text-xs text-brand-blue hover:underline font-medium",children:"View All"})]}),a.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-2",children:a.slice(0,6).map((u,S)=>e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-700 cursor-pointer hover:opacity-80 transition",children:[u.type==="image"&&e.jsx("img",{src:u.url,className:"w-full h-full object-cover",alt:"Media"}),u.type==="video"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Me,{size:20,className:"text-gray-400"})})]},S))}):e.jsx("p",{className:"text-xs text-gray-500 text-center py-4",children:"No shared media yet"})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition",children:[e.jsx(It,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{children:"Mute Notifications"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition",children:[e.jsx(Ft,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Media Gallery"})]}),!m&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:N,disabled:g,className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-red-400 hover:bg-red-900/20 hover:text-red-300 rounded-lg transition disabled:opacity-50",children:[g?e.jsx(de,{className:"w-4 h-4 animate-spin"}):e.jsx(Lt,{className:"w-4 h-4"}),e.jsx("span",{children:"Block User"})]}),e.jsxs("button",{onClick:$,className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-red-400 hover:bg-red-900/20 hover:text-red-300 rounded-lg transition",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{children:"Report User"})]})]})]})]}),k&&e.jsx(Es,{chatId:t.id,onClose:()=>c(!1)})]})}export{Os as C,Fe as S,xe as U,A as a,Ds as b,V as c,ge as d,Bs as e,Vs as f,ds as g,qs as h,te as i,ue as j,Us as k,Xe as s,fs as u};
