{"version":3,"file":"Marketplace-DurPZL7k.js","sources":["../../src/components/tech/InspectionDiagrams.jsx","../../src/components/tech/InspectionEditor.jsx","../../src/hooks/useSafeZoneVerification.js","../../src/components/marketplace/PhotoVerification.jsx","../../src/components/marketplace/SafeExchangeTransaction.jsx","../../src/components/marketplace/GearExchange.jsx","../../src/components/marketplace/SeshFxStore.jsx","../../src/components/Marketplace.jsx"],"sourcesContent":["import React from 'react';\r\n\r\nexport const DIAGRAM_TYPES = [\r\n    { id: 'guitar_electric', label: 'Electric Guitar' },\r\n    { id: 'guitar_acoustic', label: 'Acoustic Guitar' },\r\n    { id: 'amp_head', label: 'Amplifier Head' },\r\n    { id: 'amp_combo', label: 'Combo Amp' },\r\n    { id: 'keyboard', label: 'Keyboard/Synth' },\r\n    { id: 'rack_unit', label: 'Rack Gear (1U/2U)' },\r\n    { id: 'pedal', label: 'Pedal/Stompbox' }\r\n];\r\n\r\nexport const InspectionSvg = ({ type, view, onClick, markers = [] }) => {\r\n    const renderMarkers = () => markers.map((m, i) => (\r\n        <g key={i} transform={`translate(${m.x}, ${m.y})`}>\r\n            <circle r=\"6\" fill=\"#ef4444\" stroke=\"white\" strokeWidth=\"2\" className=\"drop-shadow-md\"/>\r\n            <text y=\"-10\" textAnchor=\"middle\" fill=\"#ef4444\" fontSize=\"10\" fontWeight=\"bold\">{i + 1}</text>\r\n        </g>\r\n    ));\r\n\r\n    const commonProps = {\r\n        width: \"100%\", height: \"400\", viewBox: \"0 0 300 400\", className: \"w-full h-full cursor-crosshair touch-none select-none\",\r\n        onClick: (e) => {\r\n            const rect = e.target.getBoundingClientRect();\r\n            const x = (e.clientX - rect.left) * (300 / rect.width);\r\n            const y = (e.clientY - rect.top) * (400 / rect.height);\r\n            onClick(x, y);\r\n        }\r\n    };\r\n\r\n    const paths = {\r\n        guitar_electric: {\r\n            front: <path d=\"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z\" fill=\"#e5e7eb\" stroke=\"#374151\" strokeWidth=\"2\"/>,\r\n            back: <path d=\"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z\" fill=\"#d1d5db\" stroke=\"#374151\" strokeWidth=\"2\" strokeDasharray=\"5,5\"/>,\r\n        },\r\n        amp_combo: {\r\n            front: <rect x=\"50\" y=\"50\" width=\"200\" height=\"250\" rx=\"5\" fill=\"#e5e7eb\" stroke=\"#374151\" strokeWidth=\"2\"/>,\r\n            back: <g><rect x=\"50\" y=\"50\" width=\"200\" height=\"250\" rx=\"5\" fill=\"#d1d5db\" stroke=\"#374151\" strokeWidth=\"2\"/><rect x=\"70\" y=\"200\" width=\"160\" height=\"80\" fill=\"#9ca3af\" opacity=\"0.5\"/></g>\r\n        }\r\n    };\r\n\r\n    const GenericBox = () => (<rect x=\"50\" y=\"50\" width=\"200\" height=\"300\" rx=\"10\" fill=\"#f3f4f6\" stroke=\"#9ca3af\" strokeWidth=\"2\" strokeDasharray=\"4\"/>);\r\n    const content = paths[type]?.[view] || <GenericBox />;\r\n\r\n    return (<svg {...commonProps}>{content}{renderMarkers()}</svg>);\r\n};\r\n","import React, { useState } from 'react';\r\nimport { Camera, Save, X, AlertCircle, Upload } from 'lucide-react';\r\nimport { InspectionSvg, DIAGRAM_TYPES } from './InspectionDiagrams';\r\nimport { useMediaUpload } from '../../hooks/useMediaUpload';\r\n\r\nexport default function InspectionEditor({ initialData, onSave, onCancel, type }) {\r\n    const [gearType, setGearType] = useState(initialData?.gearType || 'guitar_electric');\r\n    const [view, setView] = useState('front'); \r\n    const [markers, setMarkers] = useState(initialData?.markers || []);\r\n    const [notes, setNotes] = useState(initialData?.notes || '');\r\n    const [photos, setPhotos] = useState(initialData?.photos || []);\r\n    const [activeMarker, setActiveMarker] = useState(null); \r\n    const [markerLabel, setMarkerLabel] = useState('');\r\n    const { uploadMedia, uploading } = useMediaUpload();\r\n\r\n    const handleDiagramClick = (x, y) => {\r\n        const newMarker = { x, y, view, id: Date.now(), label: '' };\r\n        setMarkers([...markers, newMarker]);\r\n        setActiveMarker(newMarker);\r\n        setMarkerLabel('');\r\n    };\r\n\r\n    const saveMarkerLabel = () => {\r\n        if (!activeMarker) return;\r\n        setMarkers(markers.map(m => m.id === activeMarker.id ? { ...m, label: markerLabel } : m));\r\n        setActiveMarker(null);\r\n    };\r\n\r\n    const handlePhotoUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        const res = await uploadMedia(file, `inspections/${Date.now()}`);\r\n        if (res) setPhotos(prev => [...prev, res]);\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden flex flex-col h-[80vh]\">\r\n            <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]\">\r\n                <h3 className=\"font-bold dark:text-white flex items-center gap-2\"><AlertCircle className={type === 'Pre' ? 'text-orange-500' : 'text-green-500'} size={20}/> {type}-Inspection Report</h3>\r\n                <button onClick={onCancel}><X className=\"text-gray-500\"/></button>\r\n            </div>\r\n            <div className=\"flex-1 flex flex-col md:flex-row overflow-hidden\">\r\n                <div className=\"flex-1 bg-gray-100 dark:bg-black/40 relative flex flex-col items-center justify-center p-4\">\r\n                    <div className=\"absolute top-4 left-4 z-10 flex flex-col gap-2\">\r\n                        <select className=\"p-2 rounded-lg border dark:border-gray-600 bg-white dark:bg-[#1f2128] text-sm font-bold dark:text-white shadow-sm\" value={gearType} onChange={e => setGearType(e.target.value)}>{DIAGRAM_TYPES.map(t => <option key={t.id} value={t.id}>{t.label}</option>)}</select>\r\n                        <div className=\"flex bg-white dark:bg-[#1f2128] rounded-lg border dark:border-gray-600 p-1 shadow-sm\">{['front', 'back', 'sides'].map(v => (<button key={v} onClick={() => setView(v)} className={`px-3 py-1 text-xs font-bold rounded-md capitalize ${view === v ? 'bg-brand-blue text-white' : 'text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700'}`}>{v}</button>))}</div>\r\n                    </div>\r\n                    <div className=\"w-full max-w-md h-full aspect-[3/4] bg-white dark:bg-[#1f2128] rounded-xl shadow-inner border dark:border-gray-700 relative\">\r\n                        <InspectionSvg type={gearType} view={view} markers={markers.filter(m => m.view === view)} onClick={handleDiagramClick} />\r\n                        {activeMarker && (<div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 bg-white dark:bg-[#2c2e36] p-4 rounded-xl shadow-2xl border border-brand-blue z-20 animate-in zoom-in-95\"><h4 className=\"text-xs font-bold uppercase text-gray-500 mb-2\">Identify Issue</h4><input autoFocus className=\"w-full p-2 border rounded mb-2 text-sm dark:bg-black/20 dark:text-white\" placeholder=\"e.g. Scratch\" value={markerLabel} onChange={e => setMarkerLabel(e.target.value)} onKeyDown={e => e.key === 'Enter' && saveMarkerLabel()}/><div className=\"flex gap-2\"><button onClick={() => { setMarkers(markers.filter(m => m.id !== activeMarker.id)); setActiveMarker(null); }} className=\"flex-1 bg-red-100 text-red-600 py-1 rounded text-xs font-bold\">Delete</button><button onClick={saveMarkerLabel} className=\"flex-1 bg-brand-blue text-white py-1 rounded text-xs font-bold\">Save</button></div></div>)}\r\n                    </div>\r\n                </div>\r\n                <div className=\"w-full md:w-80 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 flex flex-col\">\r\n                    <div className=\"p-4 flex-1 overflow-y-auto\">\r\n                        <div className=\"mb-6\"><h4 className=\"text-xs font-bold text-gray-500 uppercase mb-2\">Damage Log</h4><div className=\"space-y-2\">{markers.map((m, i) => (<div key={i} className=\"flex items-center gap-2 p-2 bg-gray-50 dark:bg-black/20 rounded border dark:border-gray-700\"><span className=\"w-5 h-5 rounded-full bg-red-500 text-white flex items-center justify-center text-xs font-bold shrink-0\">{i+1}</span><div className=\"flex-1\"><div className=\"text-sm font-bold dark:text-white\">{m.label || 'Unlabeled'}</div><div className=\"text-[10px] text-gray-500 uppercase\">{m.view} View</div></div><button onClick={() => setMarkers(markers.filter(mk => mk.id !== m.id))}><X size={14} className=\"text-gray-400 hover:text-red-500\"/></button></div>))}</div></div>\r\n                        <div className=\"mb-6\"><label className=\"text-xs font-bold text-gray-500 uppercase mb-2 block\">Notes</label><textarea className=\"w-full p-3 border rounded-lg text-sm dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]\" placeholder=\"Overall condition...\" value={notes} onChange={e => setNotes(e.target.value)}/></div>\r\n                        <div><div className=\"flex justify-between items-center mb-2\"><label className=\"text-xs font-bold text-gray-500 uppercase\">Evidence Photos</label><label className=\"cursor-pointer text-brand-blue hover:text-blue-600\"><Upload size={16}/><input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handlePhotoUpload} disabled={uploading}/></label></div><div className=\"grid grid-cols-3 gap-2\">{photos.map((p, i) => (<div key={i} className=\"aspect-square rounded-lg overflow-hidden border dark:border-gray-600 relative group\"><img src={p.url} className=\"w-full h-full object-cover\"/><button onClick={() => setPhotos(photos.filter((_, idx) => idx !== i))} className=\"absolute top-1 right-1 bg-red-500 text-white p-0.5 rounded opacity-0 group-hover:opacity-100 transition\"><X size={12}/></button></div>))}</div></div>\r\n                    </div>\r\n                    <div className=\"p-4 border-t dark:border-gray-700\"><button onClick={() => onSave({ gearType, markers, notes, photos, timestamp: new Date().toISOString() })} className=\"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2\"><Save size={18}/> Finalize Report</button></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","// src/hooks/useSafeZoneVerification.js\r\nimport { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { supabase } from '../config/supabase';\r\nimport { \r\n    SAFE_ZONE_RADIUS_METERS, \r\n    PROXIMITY_THRESHOLD_METERS,\r\n    SAFE_ZONE_TYPES \r\n} from '../config/constants';\r\n\r\n/**\r\n * Calculate distance between two GPS coordinates using Haversine formula\r\n * @returns Distance in meters\r\n */\r\nconst calculateDistance = (lat1, lon1, lat2, lon2) => {\r\n    const R = 6371e3; // Earth's radius in meters\r\n    const œÜ1 = (lat1 * Math.PI) / 180;\r\n    const œÜ2 = (lat2 * Math.PI) / 180;\r\n    const ŒîœÜ = ((lat2 - lat1) * Math.PI) / 180;\r\n    const ŒîŒª = ((lon2 - lon1) * Math.PI) / 180;\r\n\r\n    const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +\r\n              Math.cos(œÜ1) * Math.cos(œÜ2) *\r\n              Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n    return R * c; // Distance in meters\r\n};\r\n\r\n/**\r\n * Hook for managing safe zone verification during high-value exchanges\r\n */\r\nexport function useSafeZoneVerification(transactionId, userId) {\r\n    const [currentPosition, setCurrentPosition] = useState(null);\r\n    const [locationError, setLocationError] = useState(null);\r\n    const [isInSafeZone, setIsInSafeZone] = useState(false);\r\n    const [nearestSafeZone, setNearestSafeZone] = useState(null);\r\n    const [safeZones, setSafeZones] = useState([]);\r\n    const [otherPartyPosition, setOtherPartyPosition] = useState(null);\r\n    const [proximityToOther, setProximityToOther] = useState(null);\r\n    const [isWithinProximity, setIsWithinProximity] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n    const [watchId, setWatchId] = useState(null);\r\n\r\n    const lastPositionUpdate = useRef(Date.now());\r\n\r\n    // Load safe zones from database\r\n    useEffect(() => {\r\n        const loadSafeZones = async () => {\r\n            if (!supabase) return;\r\n            \r\n            try {\r\n                const { data, error } = await supabase\r\n                    .from('safe_zones')\r\n                    .select('*');\r\n\r\n                if (error) throw error;\r\n                \r\n                setSafeZones((data || []).map(zone => ({\r\n                    id: zone.id,\r\n                    name: zone.name,\r\n                    address: zone.address,\r\n                    lat: zone.lat,\r\n                    lng: zone.lng,\r\n                    type: zone.type,\r\n                    typeLabel: zone.type_label,\r\n                    priority: zone.priority,\r\n                    verified: zone.verified\r\n                })));\r\n            } catch (error) {\r\n                console.error('Failed to load safe zones:', error);\r\n            }\r\n        };\r\n\r\n        loadSafeZones();\r\n    }, []);\r\n\r\n    // Start watching GPS position\r\n    const startWatching = useCallback(() => {\r\n        if (!navigator.geolocation) {\r\n            setLocationError('Geolocation is not supported by your browser');\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const options = {\r\n            enableHighAccuracy: true,\r\n            timeout: 10000,\r\n            maximumAge: 5000\r\n        };\r\n\r\n        const handleSuccess = (position) => {\r\n            const { latitude, longitude, accuracy } = position.coords;\r\n            \r\n            setCurrentPosition({\r\n                lat: latitude,\r\n                lng: longitude,\r\n                accuracy,\r\n                timestamp: Date.now()\r\n            });\r\n            setLocationError(null);\r\n            setLoading(false);\r\n            lastPositionUpdate.current = Date.now();\r\n        };\r\n\r\n        const handleError = (error) => {\r\n            let message;\r\n            switch (error.code) {\r\n                case error.PERMISSION_DENIED:\r\n                    message = 'Location permission denied. Please enable location access.';\r\n                    break;\r\n                case error.POSITION_UNAVAILABLE:\r\n                    message = 'Location information unavailable.';\r\n                    break;\r\n                case error.TIMEOUT:\r\n                    message = 'Location request timed out.';\r\n                    break;\r\n                default:\r\n                    message = 'An unknown error occurred getting location.';\r\n            }\r\n            setLocationError(message);\r\n            setLoading(false);\r\n        };\r\n\r\n        // Start continuous watching\r\n        const id = navigator.geolocation.watchPosition(handleSuccess, handleError, options);\r\n        setWatchId(id);\r\n\r\n        return () => {\r\n            if (id) {\r\n                navigator.geolocation.clearWatch(id);\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    // Stop watching GPS\r\n    const stopWatching = useCallback(() => {\r\n        if (watchId) {\r\n            navigator.geolocation.clearWatch(watchId);\r\n            setWatchId(null);\r\n        }\r\n    }, [watchId]);\r\n\r\n    // Check if current position is within a safe zone\r\n    useEffect(() => {\r\n        if (!currentPosition || safeZones.length === 0) {\r\n            setIsInSafeZone(false);\r\n            return;\r\n        }\r\n\r\n        let nearest = null;\r\n        let nearestDistance = Infinity;\r\n        let inZone = false;\r\n\r\n        for (const zone of safeZones) {\r\n            if (!zone.lat || !zone.lng) continue;\r\n\r\n            const distance = calculateDistance(\r\n                currentPosition.lat,\r\n                currentPosition.lng,\r\n                zone.lat,\r\n                zone.lng\r\n            );\r\n\r\n            if (distance < nearestDistance) {\r\n                nearestDistance = distance;\r\n                nearest = { ...zone, distance };\r\n            }\r\n\r\n            if (distance <= SAFE_ZONE_RADIUS_METERS) {\r\n                inZone = true;\r\n            }\r\n        }\r\n\r\n        setNearestSafeZone(nearest);\r\n        setIsInSafeZone(inZone);\r\n    }, [currentPosition, safeZones]);\r\n\r\n    // Check proximity to other party\r\n    useEffect(() => {\r\n        if (!currentPosition || !otherPartyPosition) {\r\n            setProximityToOther(null);\r\n            setIsWithinProximity(false);\r\n            return;\r\n        }\r\n\r\n        const distance = calculateDistance(\r\n            currentPosition.lat,\r\n            currentPosition.lng,\r\n            otherPartyPosition.lat,\r\n            otherPartyPosition.lng\r\n        );\r\n\r\n        setProximityToOther(distance);\r\n        setIsWithinProximity(distance <= PROXIMITY_THRESHOLD_METERS);\r\n    }, [currentPosition, otherPartyPosition]);\r\n\r\n    // Update other party's position (called from transaction listener)\r\n    const updateOtherPartyPosition = useCallback((position) => {\r\n        setOtherPartyPosition(position);\r\n    }, []);\r\n\r\n    // Find nearby safe zones using Google Places API or similar\r\n    const findNearbySafeZones = useCallback(async () => {\r\n        if (!currentPosition) return [];\r\n\r\n        try {\r\n            // Query OpenStreetMap Nominatim for nearby police stations and public buildings\r\n            const types = ['police', 'fire_station', 'bank', 'library', 'townhall'];\r\n            const results = [];\r\n\r\n            for (const type of types) {\r\n                try {\r\n                    const response = await fetch(\r\n                        `https://nominatim.openstreetmap.org/search?` +\r\n                        `q=${type}&` +\r\n                        `format=json&` +\r\n                        `lat=${currentPosition.lat}&` +\r\n                        `lon=${currentPosition.lng}&` +\r\n                        `bounded=1&` +\r\n                        `viewbox=${currentPosition.lng - 0.1},${currentPosition.lat + 0.1},${currentPosition.lng + 0.1},${currentPosition.lat - 0.1}&` +\r\n                        `limit=5`,\r\n                        { headers: { 'User-Agent': 'SeshNx-SafeExchange/1.0' } }\r\n                    );\r\n\r\n                    if (response.ok) {\r\n                        const data = await response.json();\r\n                        for (const place of data) {\r\n                            const distance = calculateDistance(\r\n                                currentPosition.lat,\r\n                                currentPosition.lng,\r\n                                parseFloat(place.lat),\r\n                                parseFloat(place.lon)\r\n                            );\r\n\r\n                            const zoneType = SAFE_ZONE_TYPES.find(z => \r\n                                type.includes(z.id.split('_')[0])\r\n                            );\r\n\r\n                            results.push({\r\n                                id: `osm_${place.place_id}`,\r\n                                name: place.display_name.split(',')[0],\r\n                                address: place.display_name,\r\n                                lat: parseFloat(place.lat),\r\n                                lng: parseFloat(place.lon),\r\n                                distance,\r\n                                type: zoneType?.id || 'public_building',\r\n                                typeLabel: zoneType?.label || 'Public Building',\r\n                                priority: zoneType?.priority || 10\r\n                            });\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    console.warn(`Failed to fetch ${type}:`, e);\r\n                }\r\n            }\r\n\r\n            // Sort by priority and distance\r\n            results.sort((a, b) => {\r\n                if (a.priority !== b.priority) return a.priority - b.priority;\r\n                return a.distance - b.distance;\r\n            });\r\n\r\n            return results.slice(0, 10);\r\n        } catch (error) {\r\n            console.error('Failed to find nearby safe zones:', error);\r\n            return [];\r\n        }\r\n    }, [currentPosition]);\r\n\r\n    // Create a new safe zone (admin function)\r\n    const createSafeZone = useCallback(async (zoneData) => {\r\n        if (!supabase) {\r\n            throw new Error('Supabase not configured');\r\n        }\r\n\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('safe_zones')\r\n                .insert({\r\n                    name: zoneData.name,\r\n                    address: zoneData.address,\r\n                    lat: zoneData.lat,\r\n                    lng: zoneData.lng,\r\n                    type: zoneData.type,\r\n                    type_label: zoneData.typeLabel,\r\n                    priority: zoneData.priority || 10,\r\n                    verified: false\r\n                })\r\n                .select('id')\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            return data.id;\r\n        } catch (error) {\r\n            console.error('Failed to create safe zone:', error);\r\n            throw error;\r\n        }\r\n    }, []);\r\n\r\n    // Verify arrival at safe zone\r\n    const verifyArrival = useCallback(() => {\r\n        if (!currentPosition || !nearestSafeZone) {\r\n            return {\r\n                verified: false,\r\n                message: 'Unable to verify location'\r\n            };\r\n        }\r\n\r\n        if (isInSafeZone) {\r\n            return {\r\n                verified: true,\r\n                zone: nearestSafeZone,\r\n                message: `Arrived at ${nearestSafeZone.name}`,\r\n                timestamp: Date.now()\r\n            };\r\n        }\r\n\r\n        return {\r\n            verified: false,\r\n            message: `Not within safe zone. ${Math.round(nearestSafeZone.distance)}m from ${nearestSafeZone.name}`,\r\n            nearestZone: nearestSafeZone\r\n        };\r\n    }, [currentPosition, nearestSafeZone, isInSafeZone]);\r\n\r\n    // Verify both parties are at the same location\r\n    const verifyProximity = useCallback(() => {\r\n        if (!currentPosition || !otherPartyPosition) {\r\n            return {\r\n                verified: false,\r\n                message: 'Unable to verify proximity - waiting for other party location'\r\n            };\r\n        }\r\n\r\n        if (isWithinProximity) {\r\n            return {\r\n                verified: true,\r\n                distance: proximityToOther,\r\n                message: `Both parties are within ${PROXIMITY_THRESHOLD_METERS}m`,\r\n                timestamp: Date.now()\r\n            };\r\n        }\r\n\r\n        return {\r\n            verified: false,\r\n            distance: proximityToOther,\r\n            message: `Other party is ${Math.round(proximityToOther)}m away. Must be within ${PROXIMITY_THRESHOLD_METERS}m to proceed.`\r\n        };\r\n    }, [currentPosition, otherPartyPosition, isWithinProximity, proximityToOther]);\r\n\r\n    return {\r\n        // State\r\n        currentPosition,\r\n        locationError,\r\n        loading,\r\n        isInSafeZone,\r\n        nearestSafeZone,\r\n        safeZones,\r\n        otherPartyPosition,\r\n        proximityToOther,\r\n        isWithinProximity,\r\n\r\n        // Actions\r\n        startWatching,\r\n        stopWatching,\r\n        findNearbySafeZones,\r\n        createSafeZone,\r\n        updateOtherPartyPosition,\r\n        verifyArrival,\r\n        verifyProximity,\r\n\r\n        // Utils\r\n        calculateDistance\r\n    };\r\n}\r\n\r\nexport default useSafeZoneVerification;\r\n","// src/components/marketplace/PhotoVerification.jsx\r\nimport React, { useState, useRef, useCallback } from 'react';\r\nimport { \r\n    Camera, Upload, Check, X, AlertTriangle, RotateCcw, \r\n    ZoomIn, ChevronLeft, ChevronRight, Maximize2, Image as ImageIcon,\r\n    CheckCircle, XCircle, HelpCircle\r\n} from 'lucide-react';\r\nimport { useMediaUpload } from '../../hooks/useMediaUpload';\r\n\r\n/**\r\n * PhotoVerification Component\r\n * Used for seller pre-departure photos and buyer inspection photos\r\n * Supports side-by-side comparison with original listing photos\r\n */\r\nexport default function PhotoVerification({\r\n    mode = 'capture', // 'capture' | 'compare' | 'review'\r\n    role = 'seller', // 'seller' | 'buyer'\r\n    listingPhotos = [],\r\n    sellerDeparturePhotos = [],\r\n    itemDescription = '',\r\n    onPhotosSubmitted,\r\n    onVerificationComplete,\r\n    requiredPhotoCount = 3,\r\n    userId\r\n}) {\r\n    const [photos, setPhotos] = useState([]);\r\n    const [activePhotoIndex, setActivePhotoIndex] = useState(0);\r\n    const [comparisonMode, setComparisonMode] = useState(false);\r\n    const [comparisonIndex, setComparisonIndex] = useState(0);\r\n    const [verificationResult, setVerificationResult] = useState(null); // null | 'match' | 'mismatch' | 'unsure'\r\n    const [notes, setNotes] = useState('');\r\n    const [showCamera, setShowCamera] = useState(false);\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    \r\n    const videoRef = useRef(null);\r\n    const canvasRef = useRef(null);\r\n    const streamRef = useRef(null);\r\n    const { uploadMedia, uploading } = useMediaUpload();\r\n\r\n    // Start camera stream\r\n    const startCamera = useCallback(async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                video: { \r\n                    facingMode: 'environment', // Prefer rear camera\r\n                    width: { ideal: 1920 },\r\n                    height: { ideal: 1080 }\r\n                }\r\n            });\r\n            \r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = stream;\r\n                streamRef.current = stream;\r\n                setShowCamera(true);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to access camera:', error);\r\n            alert('Unable to access camera. Please check permissions.');\r\n        }\r\n    }, []);\r\n\r\n    // Stop camera stream\r\n    const stopCamera = useCallback(() => {\r\n        if (streamRef.current) {\r\n            streamRef.current.getTracks().forEach(track => track.stop());\r\n            streamRef.current = null;\r\n        }\r\n        setShowCamera(false);\r\n    }, []);\r\n\r\n    // Capture photo from camera\r\n    const capturePhoto = useCallback(async () => {\r\n        if (!videoRef.current || !canvasRef.current) return;\r\n\r\n        const video = videoRef.current;\r\n        const canvas = canvasRef.current;\r\n        \r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        \r\n        const ctx = canvas.getContext('2d');\r\n        ctx.drawImage(video, 0, 0);\r\n        \r\n        // Convert to blob\r\n        canvas.toBlob(async (blob) => {\r\n            if (!blob) return;\r\n\r\n            // Upload immediately\r\n            try {\r\n                const file = new File([blob], `verification_${Date.now()}.jpg`, { type: 'image/jpeg' });\r\n                const result = await uploadMedia(file, `safe_exchange/${userId}/verification`);\r\n                \r\n                if (result?.url) {\r\n                    setPhotos(prev => [...prev, {\r\n                        url: result.url,\r\n                        timestamp: Date.now(),\r\n                        type: role === 'seller' ? 'departure' : 'inspection'\r\n                    }]);\r\n                }\r\n            } catch (error) {\r\n                console.error('Failed to upload photo:', error);\r\n            }\r\n        }, 'image/jpeg', 0.9);\r\n    }, [uploadMedia, userId, role]);\r\n\r\n    // Handle file upload (alternative to camera)\r\n    const handleFileUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        try {\r\n            const result = await uploadMedia(file, `safe_exchange/${userId}/verification`);\r\n            if (result?.url) {\r\n                setPhotos(prev => [...prev, {\r\n                    url: result.url,\r\n                    timestamp: Date.now(),\r\n                    type: role === 'seller' ? 'departure' : 'inspection'\r\n                }]);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to upload photo:', error);\r\n        }\r\n    };\r\n\r\n    // Remove a photo\r\n    const removePhoto = (index) => {\r\n        setPhotos(prev => prev.filter((_, i) => i !== index));\r\n        if (activePhotoIndex >= photos.length - 1) {\r\n            setActivePhotoIndex(Math.max(0, photos.length - 2));\r\n        }\r\n    };\r\n\r\n    // Submit photos\r\n    const handleSubmitPhotos = async () => {\r\n        if (photos.length < requiredPhotoCount) {\r\n            alert(`Please capture at least ${requiredPhotoCount} photos.`);\r\n            return;\r\n        }\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            await onPhotosSubmitted?.(photos, notes);\r\n        } finally {\r\n            setIsSubmitting(false);\r\n            stopCamera();\r\n        }\r\n    };\r\n\r\n    // Submit verification result (buyer only)\r\n    const handleVerificationSubmit = async (result) => {\r\n        setVerificationResult(result);\r\n        setIsSubmitting(true);\r\n        \r\n        try {\r\n            await onVerificationComplete?.({\r\n                result,\r\n                notes,\r\n                buyerPhotos: photos,\r\n                timestamp: Date.now()\r\n            });\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    // Render photo capture interface\r\n    const renderCaptureMode = () => (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"bg-gradient-to-r from-orange-600 to-red-600 p-6 rounded-xl text-white\">\r\n                <h3 className=\"text-xl font-bold mb-2\">\r\n                    {role === 'seller' ? 'üì¶ Pre-Departure Photos' : 'üîç Inspection Photos'}\r\n                </h3>\r\n                <p className=\"text-sm opacity-90\">\r\n                    {role === 'seller' \r\n                        ? 'Take clear photos of the item before leaving for the exchange. These will be shown to the buyer for verification.'\r\n                        : 'Take photos of the item as received. Compare with seller\\'s photos to verify condition.'}\r\n                </p>\r\n            </div>\r\n\r\n            {/* Camera / Preview Area */}\r\n            <div className=\"relative bg-black rounded-xl overflow-hidden aspect-video\">\r\n                {showCamera ? (\r\n                    <>\r\n                        <video \r\n                            ref={videoRef} \r\n                            autoPlay \r\n                            playsInline \r\n                            className=\"w-full h-full object-cover\"\r\n                        />\r\n                        <canvas ref={canvasRef} className=\"hidden\" />\r\n                        \r\n                        {/* Camera controls overlay */}\r\n                        <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-4\">\r\n                            <button \r\n                                onClick={stopCamera}\r\n                                className=\"p-3 bg-white/20 hover:bg-white/30 rounded-full backdrop-blur-sm transition\"\r\n                            >\r\n                                <X className=\"text-white\" size={24} />\r\n                            </button>\r\n                            <button \r\n                                onClick={capturePhoto}\r\n                                disabled={uploading}\r\n                                className=\"p-5 bg-white rounded-full shadow-lg hover:scale-110 transition disabled:opacity-50\"\r\n                            >\r\n                                <Camera className={uploading ? 'animate-pulse text-orange-500' : 'text-gray-900'} size={32} />\r\n                            </button>\r\n                            <button className=\"p-3 bg-white/20 rounded-full opacity-0 pointer-events-none\">\r\n                                <X size={24} />\r\n                            </button>\r\n                        </div>\r\n                    </>\r\n                ) : photos.length > 0 ? (\r\n                    <>\r\n                        <img \r\n                            src={photos[activePhotoIndex]?.url} \r\n                            alt={`Photo ${activePhotoIndex + 1}`}\r\n                            className=\"w-full h-full object-contain\"\r\n                        />\r\n                        \r\n                        {/* Navigation arrows */}\r\n                        {photos.length > 1 && (\r\n                            <>\r\n                                <button \r\n                                    onClick={() => setActivePhotoIndex(Math.max(0, activePhotoIndex - 1))}\r\n                                    className=\"absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full hover:bg-black/70\"\r\n                                    disabled={activePhotoIndex === 0}\r\n                                >\r\n                                    <ChevronLeft className=\"text-white\" />\r\n                                </button>\r\n                                <button \r\n                                    onClick={() => setActivePhotoIndex(Math.min(photos.length - 1, activePhotoIndex + 1))}\r\n                                    className=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full hover:bg-black/70\"\r\n                                    disabled={activePhotoIndex === photos.length - 1}\r\n                                >\r\n                                    <ChevronRight className=\"text-white\" />\r\n                                </button>\r\n                            </>\r\n                        )}\r\n\r\n                        {/* Photo counter */}\r\n                        <div className=\"absolute top-4 right-4 bg-black/60 text-white text-sm px-3 py-1 rounded-full\">\r\n                            {activePhotoIndex + 1} / {photos.length}\r\n                        </div>\r\n\r\n                        {/* Remove button */}\r\n                        <button \r\n                            onClick={() => removePhoto(activePhotoIndex)}\r\n                            className=\"absolute top-4 left-4 p-2 bg-red-600 rounded-full hover:bg-red-700\"\r\n                        >\r\n                            <X className=\"text-white\" size={16} />\r\n                        </button>\r\n                    </>\r\n                ) : (\r\n                    <div className=\"absolute inset-0 flex flex-col items-center justify-center text-gray-400\">\r\n                        <Camera size={64} className=\"mb-4 opacity-30\" />\r\n                        <p>No photos captured yet</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Thumbnail strip */}\r\n            {photos.length > 0 && (\r\n                <div className=\"flex gap-2 overflow-x-auto pb-2\">\r\n                    {photos.map((photo, idx) => (\r\n                        <button\r\n                            key={idx}\r\n                            onClick={() => setActivePhotoIndex(idx)}\r\n                            className={`relative shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition ${\r\n                                idx === activePhotoIndex \r\n                                    ? 'border-orange-500 ring-2 ring-orange-500/30' \r\n                                    : 'border-transparent hover:border-gray-400'\r\n                            }`}\r\n                        >\r\n                            <img src={photo.url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                        </button>\r\n                    ))}\r\n                    \r\n                    {/* Add more button */}\r\n                    {photos.length < 10 && (\r\n                        <button\r\n                            onClick={startCamera}\r\n                            className=\"shrink-0 w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center hover:border-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition\"\r\n                        >\r\n                            <Camera className=\"text-gray-400\" size={20} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Action buttons */}\r\n            <div className=\"flex gap-3\">\r\n                {!showCamera && (\r\n                    <>\r\n                        <button\r\n                            onClick={startCamera}\r\n                            className=\"flex-1 bg-gray-900 dark:bg-white dark:text-black text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition\"\r\n                        >\r\n                            <Camera size={20} /> Open Camera\r\n                        </button>\r\n                        \r\n                        <label className=\"flex-1 bg-gray-100 dark:bg-gray-800 py-3 rounded-xl font-bold flex items-center justify-center gap-2 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition\">\r\n                            <Upload size={20} /> Upload Photo\r\n                            <input \r\n                                type=\"file\" \r\n                                accept=\"image/*\" \r\n                                className=\"hidden\"\r\n                                onChange={handleFileUpload}\r\n                            />\r\n                        </label>\r\n                    </>\r\n                )}\r\n            </div>\r\n\r\n            {/* Notes field */}\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-2 block\">\r\n                    Additional Notes (Optional)\r\n                </label>\r\n                <textarea\r\n                    value={notes}\r\n                    onChange={(e) => setNotes(e.target.value)}\r\n                    placeholder={role === 'seller' \r\n                        ? 'Any notes about current condition...'\r\n                        : 'Note any concerns or observations...'}\r\n                    className=\"w-full p-3 border rounded-xl dark:bg-gray-800 dark:border-gray-600 dark:text-white resize-none\"\r\n                    rows={3}\r\n                />\r\n            </div>\r\n\r\n            {/* Progress indicator */}\r\n            <div className=\"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                    <span className=\"text-sm font-bold dark:text-white\">\r\n                        Photos: {photos.length} / {requiredPhotoCount} required\r\n                    </span>\r\n                    {photos.length >= requiredPhotoCount && (\r\n                        <CheckCircle className=\"text-green-500\" size={20} />\r\n                    )}\r\n                </div>\r\n                <div className=\"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\r\n                    <div \r\n                        className=\"h-full bg-green-500 transition-all duration-300\"\r\n                        style={{ width: `${Math.min(100, (photos.length / requiredPhotoCount) * 100)}%` }}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Submit button */}\r\n            <button\r\n                onClick={handleSubmitPhotos}\r\n                disabled={photos.length < requiredPhotoCount || isSubmitting}\r\n                className=\"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-700 transition shadow-lg\"\r\n            >\r\n                {isSubmitting ? (\r\n                    <>\r\n                        <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                        Submitting...\r\n                    </>\r\n                ) : (\r\n                    <>\r\n                        <Check size={20} /> Submit Photos\r\n                    </>\r\n                )}\r\n            </button>\r\n        </div>\r\n    );\r\n\r\n    // Render comparison mode (for buyer to compare with seller photos)\r\n    const renderCompareMode = () => (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 p-6 rounded-xl text-white\">\r\n                <h3 className=\"text-xl font-bold mb-2\">üîç Verify Item Condition</h3>\r\n                <p className=\"text-sm opacity-90\">\r\n                    Compare the seller's pre-departure photos with the item in front of you. \r\n                    Does it match the listing description?\r\n                </p>\r\n            </div>\r\n\r\n            {/* Side-by-side comparison */}\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n                {/* Seller's photo */}\r\n                <div className=\"space-y-2\">\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase\">\r\n                        Seller's Photo ({comparisonIndex + 1}/{sellerDeparturePhotos.length})\r\n                    </label>\r\n                    <div className=\"relative bg-black rounded-xl overflow-hidden aspect-square\">\r\n                        {sellerDeparturePhotos[comparisonIndex] ? (\r\n                            <img \r\n                                src={sellerDeparturePhotos[comparisonIndex].url}\r\n                                alt=\"Seller's photo\"\r\n                                className=\"w-full h-full object-contain\"\r\n                            />\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-center h-full text-gray-500\">\r\n                                No photo available\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Listing photo for reference */}\r\n                <div className=\"space-y-2\">\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase\">\r\n                        Original Listing ({comparisonIndex + 1}/{listingPhotos.length})\r\n                    </label>\r\n                    <div className=\"relative bg-black rounded-xl overflow-hidden aspect-square\">\r\n                        {listingPhotos[comparisonIndex] ? (\r\n                            <img \r\n                                src={listingPhotos[comparisonIndex]}\r\n                                alt=\"Listing photo\"\r\n                                className=\"w-full h-full object-contain\"\r\n                            />\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-center h-full text-gray-500\">\r\n                                No photo available\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Comparison navigation */}\r\n            <div className=\"flex justify-center gap-2\">\r\n                {Array.from({ length: Math.max(sellerDeparturePhotos.length, listingPhotos.length) }).map((_, idx) => (\r\n                    <button\r\n                        key={idx}\r\n                        onClick={() => setComparisonIndex(idx)}\r\n                        className={`w-3 h-3 rounded-full transition ${\r\n                            idx === comparisonIndex \r\n                                ? 'bg-blue-600' \r\n                                : 'bg-gray-300 hover:bg-gray-400'\r\n                        }`}\r\n                    />\r\n                ))}\r\n            </div>\r\n\r\n            {/* Item description reference */}\r\n            <div className=\"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl\">\r\n                <h4 className=\"font-bold text-sm dark:text-white mb-2\">üìã Listing Description</h4>\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                    {itemDescription || 'No description provided'}\r\n                </p>\r\n            </div>\r\n\r\n            {/* Verification buttons */}\r\n            <div className=\"space-y-3\">\r\n                <p className=\"text-sm font-bold dark:text-white text-center\">\r\n                    Does the item match the photos and description?\r\n                </p>\r\n                \r\n                <div className=\"grid grid-cols-3 gap-3\">\r\n                    <button\r\n                        onClick={() => handleVerificationSubmit('match')}\r\n                        disabled={isSubmitting}\r\n                        className=\"p-4 bg-green-100 dark:bg-green-900/30 border-2 border-green-500 rounded-xl flex flex-col items-center gap-2 hover:bg-green-200 dark:hover:bg-green-900/50 transition\"\r\n                    >\r\n                        <CheckCircle className=\"text-green-600\" size={32} />\r\n                        <span className=\"font-bold text-green-700 dark:text-green-400\">Yes, Matches</span>\r\n                    </button>\r\n                    \r\n                    <button\r\n                        onClick={() => handleVerificationSubmit('unsure')}\r\n                        disabled={isSubmitting}\r\n                        className=\"p-4 bg-yellow-100 dark:bg-yellow-900/30 border-2 border-yellow-500 rounded-xl flex flex-col items-center gap-2 hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition\"\r\n                    >\r\n                        <HelpCircle className=\"text-yellow-600\" size={32} />\r\n                        <span className=\"font-bold text-yellow-700 dark:text-yellow-400\">Unsure</span>\r\n                    </button>\r\n                    \r\n                    <button\r\n                        onClick={() => handleVerificationSubmit('mismatch')}\r\n                        disabled={isSubmitting}\r\n                        className=\"p-4 bg-red-100 dark:bg-red-900/30 border-2 border-red-500 rounded-xl flex flex-col items-center gap-2 hover:bg-red-200 dark:hover:bg-red-900/50 transition\"\r\n                    >\r\n                        <XCircle className=\"text-red-600\" size={32} />\r\n                        <span className=\"font-bold text-red-700 dark:text-red-400\">No, Different</span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Notes for concerns */}\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-2 block\">\r\n                    Describe Any Concerns\r\n                </label>\r\n                <textarea\r\n                    value={notes}\r\n                    onChange={(e) => setNotes(e.target.value)}\r\n                    placeholder=\"Note any differences, damage, or concerns...\"\r\n                    className=\"w-full p-3 border rounded-xl dark:bg-gray-800 dark:border-gray-600 dark:text-white resize-none\"\r\n                    rows={3}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    // Main render\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto\">\r\n            {mode === 'capture' && renderCaptureMode()}\r\n            {mode === 'compare' && renderCompareMode()}\r\n        </div>\r\n    );\r\n}\r\n","// src/components/marketplace/SafeExchangeTransaction.jsx\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { \r\n    Shield, MapPin, Camera, CheckCircle, Clock, AlertTriangle, \r\n    Navigation, Phone, MessageCircle, X, ChevronRight, User,\r\n    DollarSign, Lock, Unlock, ArrowRight, Package, Loader2,\r\n    Calendar, CreditCard, Map, Check, XCircle\r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport { \r\n    SAFE_EXCHANGE_STATUS, \r\n    SAFE_EXCHANGE_STEPS,\r\n    HIGH_VALUE_THRESHOLD \r\n} from '../../config/constants';\r\nimport { useSafeZoneVerification } from '../../hooks/useSafeZoneVerification';\r\nimport PhotoVerification from './PhotoVerification';\r\nimport UserAvatar from '../shared/UserAvatar';\r\n\r\n/**\r\n * SafeExchangeTransaction Component\r\n * Manages the complete workflow for high-value item exchanges\r\n */\r\nexport default function SafeExchangeTransaction({\r\n    transactionId,\r\n    user,\r\n    userData,\r\n    onClose,\r\n    onComplete,\r\n    onMessage // Function to open chat with other party\r\n}) {\r\n    const [transaction, setTransaction] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [actionLoading, setActionLoading] = useState(false);\r\n    const [selectedSafeZone, setSelectedSafeZone] = useState(null);\r\n    const [meetupDate, setMeetupDate] = useState('');\r\n    const [meetupTime, setMeetupTime] = useState('');\r\n    const [showZonePicker, setShowZonePicker] = useState(false);\r\n    const [nearbyZones, setNearbyZones] = useState([]);\r\n    const [photoMode, setPhotoMode] = useState(null); // 'seller_depart' | 'buyer_inspect' | null\r\n\r\n    // Get current role\r\n    const userId = user?.id || user?.uid;\r\n    const isSeller = transaction?.sellerId === userId;\r\n    const isBuyer = transaction?.buyerId === userId;\r\n    const role = isSeller ? 'seller' : 'buyer';\r\n\r\n    // GPS verification hook\r\n    const {\r\n        currentPosition,\r\n        locationError,\r\n        isInSafeZone,\r\n        nearestSafeZone,\r\n        otherPartyPosition,\r\n        proximityToOther,\r\n        isWithinProximity,\r\n        startWatching,\r\n        stopWatching,\r\n        findNearbySafeZones,\r\n        verifyArrival,\r\n        verifyProximity\r\n    } = useSafeZoneVerification(transactionId, user?.uid);\r\n\r\n    // Subscribe to transaction updates\r\n    useEffect(() => {\r\n        if (!transactionId || !supabase) return;\r\n\r\n        const channel = supabase\r\n            .channel(`safe-exchange-${transactionId}`)\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'safe_exchange_transactions',\r\n                filter: `id=eq.${transactionId}`\r\n            }, () => {\r\n                loadTransaction();\r\n            })\r\n            .subscribe();\r\n\r\n        loadTransaction();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [transactionId]);\r\n\r\n    const loadTransaction = async () => {\r\n        if (!supabase) return;\r\n        setLoading(true);\r\n        try {\r\n            const { data: transactionData, error } = await supabase\r\n                .from('safe_exchange_transactions')\r\n                .select('*')\r\n                .eq('id', transactionId)\r\n                .single();\r\n            \r\n            if (error) throw error;\r\n            \r\n            if (transactionData) {\r\n                setTransaction({\r\n                    id: transactionData.id,\r\n                    ...transactionData,\r\n                    buyerId: transactionData.buyer_id,\r\n                    sellerId: transactionData.seller_id,\r\n                    listingId: transactionData.listing_id\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading transaction:', error);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    // Update user's position in transaction\r\n    useEffect(() => {\r\n        if (!transaction || !currentPosition || !supabase) return;\r\n\r\n        const updatePosition = async () => {\r\n            try {\r\n                const locationField = role === 'seller' ? 'seller_location' : 'buyer_location';\r\n                await supabase\r\n                    .from('safe_exchange_transactions')\r\n                    .update({\r\n                        [locationField]: {\r\n                            lat: currentPosition.lat,\r\n                            lng: currentPosition.lng,\r\n                            updated_at: Date.now()\r\n                        },\r\n                        updated_at: new Date().toISOString()\r\n                    })\r\n                    .eq('id', transactionId);\r\n            } catch (error) {\r\n                console.error('Failed to update position:', error);\r\n            }\r\n        };\r\n\r\n        updatePosition();\r\n    }, [currentPosition, transaction, transactionId, role]);\r\n\r\n    // Load nearby safe zones when zone picker is opened\r\n    useEffect(() => {\r\n        if (showZonePicker && currentPosition) {\r\n            findNearbySafeZones().then(zones => setNearbyZones(zones));\r\n        }\r\n    }, [showZonePicker, currentPosition, findNearbySafeZones]);\r\n\r\n    // Update transaction status\r\n    const updateStatus = useCallback(async (newStatus, additionalData = {}) => {\r\n        if (!transactionId || !supabase) return;\r\n\r\n        setActionLoading(true);\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const statusHistory = transaction?.status_history || {};\r\n            statusHistory[newStatus] = {\r\n                timestamp: Date.now(),\r\n                userId: userId\r\n            };\r\n            \r\n            // Convert camelCase keys to snake_case for Supabase\r\n            const convertedData = Object.keys(additionalData).reduce((acc, key) => {\r\n                const snakeKey = key.replace(/([A-Z])/g, '_$1').toLowerCase();\r\n                acc[snakeKey] = additionalData[key];\r\n                return acc;\r\n            }, {});\r\n            \r\n            await supabase\r\n                .from('safe_exchange_transactions')\r\n                .update({\r\n                    status: newStatus,\r\n                    status_history: statusHistory,\r\n                    updated_at: new Date().toISOString(),\r\n                    ...convertedData\r\n                })\r\n                .eq('id', transactionId);\r\n\r\n            // Send notification to other party\r\n            await sendNotification(newStatus, additionalData);\r\n        } catch (error) {\r\n            console.error('Failed to update status:', error);\r\n            alert('Failed to update transaction. Please try again.');\r\n        }\r\n        setActionLoading(false);\r\n    }, [transactionId, transaction, user?.id, user?.uid]);\r\n\r\n    // Send notification to other party\r\n    const sendNotification = async (status, data = {}) => {\r\n        if (!supabase || !transaction) return;\r\n        const otherUserId = isSeller ? transaction.buyerId : transaction.sellerId;\r\n        \r\n        // Use data passed from updateStatus for values that may not be in React state yet\r\n        const messages = {\r\n            [SAFE_EXCHANGE_STATUS.MEETUP_SCHEDULED]: `Meetup scheduled for ${data.meetupDate || transaction.meetup_date} at ${data.meetupTime || transaction.meetup_time}`,\r\n            [SAFE_EXCHANGE_STATUS.SELLER_EN_ROUTE]: 'Seller is on their way to the exchange location',\r\n            [SAFE_EXCHANGE_STATUS.BUYER_EN_ROUTE]: 'Buyer is on their way to the exchange location',\r\n            [SAFE_EXCHANGE_STATUS.AT_SAFE_ZONE]: `${isSeller ? 'Seller' : 'Buyer'} has arrived at the safe zone`,\r\n            [SAFE_EXCHANGE_STATUS.SELLER_PHOTOS_UPLOADED]: 'Seller has uploaded pre-departure photos',\r\n            [SAFE_EXCHANGE_STATUS.BUYER_APPROVED]: 'Buyer has approved the exchange',\r\n            [SAFE_EXCHANGE_STATUS.SELLER_APPROVED]: 'Seller has approved the exchange',\r\n            [SAFE_EXCHANGE_STATUS.COMPLETED]: 'üéâ Exchange completed! Funds have been released.',\r\n            [SAFE_EXCHANGE_STATUS.DISPUTED]: '‚ö†Ô∏è A dispute has been raised on the transaction'\r\n        };\r\n\r\n        await supabase\r\n            .from('notifications')\r\n            .insert({\r\n                user_id: otherUserId,\r\n                type: 'safe_exchange',\r\n                transaction_id: transactionId,\r\n                message: messages[status] || `Transaction status updated: ${status}`,\r\n                item_title: transaction.item_title,\r\n                read: false,\r\n                created_at: new Date().toISOString()\r\n            });\r\n    };\r\n\r\n    // Schedule meetup\r\n    const scheduleMeetup = async () => {\r\n        if (!selectedSafeZone || !meetupDate || !meetupTime) {\r\n            alert('Please select a safe zone and set a date/time.');\r\n            return;\r\n        }\r\n\r\n        await updateStatus(SAFE_EXCHANGE_STATUS.MEETUP_SCHEDULED, {\r\n            meetupLocation: selectedSafeZone,\r\n            meetupDate,\r\n            meetupTime\r\n        });\r\n        setShowZonePicker(false);\r\n    };\r\n\r\n    // Handle departure (seller)\r\n    const handleSellerDepart = () => {\r\n        setPhotoMode('seller_depart');\r\n        startWatching();\r\n    };\r\n\r\n    // Handle seller photo submission\r\n    const handleSellerPhotosSubmitted = async (photos, notes) => {\r\n        await updateStatus(SAFE_EXCHANGE_STATUS.SELLER_PHOTOS_UPLOADED, {\r\n            sellerDeparturePhotos: photos,\r\n            sellerDepartureNotes: notes\r\n        });\r\n        setPhotoMode(null);\r\n        await updateStatus(SAFE_EXCHANGE_STATUS.SELLER_EN_ROUTE);\r\n    };\r\n\r\n    // Handle buyer departure\r\n    const handleBuyerDepart = () => {\r\n        startWatching();\r\n        updateStatus(SAFE_EXCHANGE_STATUS.BUYER_EN_ROUTE);\r\n    };\r\n\r\n    // Handle buyer inspection complete\r\n    const handleBuyerInspectionComplete = async (result) => {\r\n        await updateStatus(SAFE_EXCHANGE_STATUS.BUYER_PHOTOS_UPLOADED, {\r\n            buyerInspectionResult: result.result,\r\n            buyerInspectionPhotos: result.buyerPhotos,\r\n            buyerInspectionNotes: result.notes\r\n        });\r\n\r\n        if (result.result === 'mismatch') {\r\n            await updateStatus(SAFE_EXCHANGE_STATUS.DISPUTED);\r\n        } else {\r\n            await updateStatus(SAFE_EXCHANGE_STATUS.PENDING_DUAL_APPROVAL);\r\n        }\r\n        setPhotoMode(null);\r\n    };\r\n\r\n    // Handle approval\r\n    const handleApprove = async () => {\r\n        const approvalKey = isSeller ? 'sellerApproved' : 'buyerApproved';\r\n        const newStatus = isSeller \r\n            ? SAFE_EXCHANGE_STATUS.SELLER_APPROVED \r\n            : SAFE_EXCHANGE_STATUS.BUYER_APPROVED;\r\n\r\n        await updateStatus(newStatus, {\r\n            [approvalKey]: true,\r\n            [`${approvalKey}At`]: Date.now()\r\n        });\r\n\r\n        // Check if both approved\r\n        const otherApproved = isSeller ? transaction.buyerApproved : transaction.sellerApproved;\r\n        if (otherApproved) {\r\n            await completeTransaction();\r\n        }\r\n    };\r\n\r\n    // Complete transaction and release funds\r\n    const completeTransaction = async () => {\r\n        if (!supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        await updateStatus(SAFE_EXCHANGE_STATUS.COMPLETED, {\r\n            completedAt: new Date().toISOString()\r\n        });\r\n\r\n        // Release escrow funds (in production, this would call a cloud function)\r\n        // For now, we mark it as released\r\n        await supabase\r\n            .from('safe_exchange_transactions')\r\n            .update({\r\n                funds_released: true,\r\n                funds_released_at: new Date().toISOString(),\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', transactionId);\r\n\r\n        onComplete?.();\r\n    };\r\n\r\n    // Cancel transaction\r\n    const handleCancel = async () => {\r\n        if (!confirm('Are you sure you want to cancel this transaction? This may affect your seller rating.')) {\r\n            return;\r\n        }\r\n        const userId = user?.id || user?.uid;\r\n        await updateStatus(SAFE_EXCHANGE_STATUS.CANCELLED, {\r\n            cancelledBy: userId,\r\n            cancelledAt: new Date().toISOString()\r\n        });\r\n\r\n        onClose?.();\r\n    };\r\n\r\n    // Raise dispute\r\n    const handleDispute = async (reason) => {\r\n        const userId = user?.id || user?.uid;\r\n        await updateStatus(SAFE_EXCHANGE_STATUS.DISPUTED, {\r\n            disputeReason: reason,\r\n            disputeRaisedBy: userId,\r\n            disputeRaisedAt: new Date().toISOString()\r\n        });\r\n    };\r\n\r\n    // Get current step index\r\n    const getCurrentStepIndex = () => {\r\n        const statusToStep = {\r\n            [SAFE_EXCHANGE_STATUS.INTENT_CREATED]: 0,\r\n            [SAFE_EXCHANGE_STATUS.HOLD_PLACED]: 1,\r\n            [SAFE_EXCHANGE_STATUS.SELLER_NOTIFIED]: 1,\r\n            [SAFE_EXCHANGE_STATUS.MEETUP_SCHEDULED]: 2,\r\n            [SAFE_EXCHANGE_STATUS.SELLER_EN_ROUTE]: 3,\r\n            [SAFE_EXCHANGE_STATUS.SELLER_PHOTOS_UPLOADED]: 3,\r\n            [SAFE_EXCHANGE_STATUS.BUYER_EN_ROUTE]: 4,\r\n            [SAFE_EXCHANGE_STATUS.AT_SAFE_ZONE]: 4,\r\n            [SAFE_EXCHANGE_STATUS.BUYER_INSPECTING]: 5,\r\n            [SAFE_EXCHANGE_STATUS.BUYER_PHOTOS_UPLOADED]: 5,\r\n            [SAFE_EXCHANGE_STATUS.PENDING_DUAL_APPROVAL]: 6,\r\n            [SAFE_EXCHANGE_STATUS.SELLER_APPROVED]: 6,\r\n            [SAFE_EXCHANGE_STATUS.BUYER_APPROVED]: 6,\r\n            [SAFE_EXCHANGE_STATUS.COMPLETED]: 7\r\n        };\r\n        return statusToStep[transaction?.status] || 0;\r\n    };\r\n\r\n    // Render loading state\r\n    if (loading) {\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[80]\">\r\n                <div className=\"bg-white dark:bg-gray-900 p-8 rounded-2xl flex flex-col items-center gap-4\">\r\n                    <Loader2 className=\"animate-spin text-orange-500\" size={48} />\r\n                    <p className=\"text-gray-600 dark:text-gray-300\">Loading transaction...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Render photo verification mode\r\n    if (photoMode === 'seller_depart') {\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black/90 z-[80] overflow-y-auto\">\r\n                <div className=\"min-h-screen p-4\">\r\n                    <div className=\"max-w-2xl mx-auto py-8\">\r\n                        <button \r\n                            onClick={() => setPhotoMode(null)}\r\n                            className=\"mb-4 text-white flex items-center gap-2 hover:underline\"\r\n                        >\r\n                            <X size={20} /> Cancel\r\n                        </button>\r\n                        <PhotoVerification\r\n                            mode=\"capture\"\r\n                            role=\"seller\"\r\n                            listingPhotos={transaction.itemPhotos || []}\r\n                            itemDescription={transaction.itemDescription}\r\n                            onPhotosSubmitted={handleSellerPhotosSubmitted}\r\n                            requiredPhotoCount={3}\r\n                            userId={user.uid}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (photoMode === 'buyer_inspect') {\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black/90 z-[80] overflow-y-auto\">\r\n                <div className=\"min-h-screen p-4\">\r\n                    <div className=\"max-w-2xl mx-auto py-8\">\r\n                        <button \r\n                            onClick={() => setPhotoMode(null)}\r\n                            className=\"mb-4 text-white flex items-center gap-2 hover:underline\"\r\n                        >\r\n                            <X size={20} /> Cancel\r\n                        </button>\r\n                        <PhotoVerification\r\n                            mode=\"compare\"\r\n                            role=\"buyer\"\r\n                            listingPhotos={transaction.itemPhotos || []}\r\n                            sellerDeparturePhotos={transaction.sellerDeparturePhotos || []}\r\n                            itemDescription={transaction.itemDescription}\r\n                            onVerificationComplete={handleBuyerInspectionComplete}\r\n                            requiredPhotoCount={2}\r\n                            userId={user.uid}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Main transaction view\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4 overflow-y-auto\">\r\n            <div className=\"bg-white dark:bg-[#1f2128] w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden my-8\">\r\n                {/* Header */}\r\n                <div className=\"bg-gradient-to-r from-orange-600 to-red-600 p-6 text-white relative overflow-hidden\">\r\n                    <button \r\n                        onClick={onClose}\r\n                        className=\"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition\"\r\n                    >\r\n                        <X size={20} />\r\n                    </button>\r\n                    \r\n                    <div className=\"flex items-center gap-2 text-orange-200 text-xs font-bold uppercase tracking-widest mb-2\">\r\n                        <Shield size={14} /> Safe Exchange\r\n                    </div>\r\n                    <h2 className=\"text-2xl font-bold mb-1\">{transaction?.itemTitle}</h2>\r\n                    <div className=\"flex items-center gap-4 text-sm\">\r\n                        <span className=\"flex items-center gap-1\">\r\n                            <DollarSign size={16} /> ${transaction?.price?.toLocaleString()}\r\n                            {transaction?.serviceFee && (\r\n                                <span className=\"text-orange-200 text-xs ml-1\">(1% mutual service fee)</span>\r\n                            )}\r\n                        </span>\r\n                        <span className=\"flex items-center gap-1\">\r\n                            <Package size={16} /> {transaction?.itemBrand}\r\n                        </span>\r\n                    </div>\r\n                    \r\n                    <Shield size={150} className=\"absolute -right-10 -bottom-10 text-white opacity-10 rotate-12\" />\r\n                </div>\r\n\r\n                {/* Progress Tracker */}\r\n                <div className=\"p-6 border-b dark:border-gray-700\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"font-bold dark:text-white\">Transaction Progress</h3>\r\n                        <span className={`px-3 py-1 rounded-full text-xs font-bold ${\r\n                            transaction?.status === SAFE_EXCHANGE_STATUS.COMPLETED \r\n                                ? 'bg-green-100 text-green-700'\r\n                                : transaction?.status === SAFE_EXCHANGE_STATUS.DISPUTED\r\n                                ? 'bg-red-100 text-red-700'\r\n                                : 'bg-orange-100 text-orange-700'\r\n                        }`}>\r\n                            {transaction?.status?.replace(/_/g, ' ').toUpperCase()}\r\n                        </span>\r\n                    </div>\r\n\r\n                    {/* Step indicators */}\r\n                    <div className=\"flex items-center gap-1 overflow-x-auto pb-2\">\r\n                        {SAFE_EXCHANGE_STEPS.map((step, index) => {\r\n                            const currentStep = getCurrentStepIndex();\r\n                            const isComplete = index < currentStep;\r\n                            const isCurrent = index === currentStep;\r\n                            \r\n                            return (\r\n                                <React.Fragment key={step.key}>\r\n                                    <div className=\"flex flex-col items-center shrink-0\">\r\n                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\r\n                                            isComplete \r\n                                                ? 'bg-green-500 text-white' \r\n                                                : isCurrent \r\n                                                ? 'bg-orange-500 text-white animate-pulse'\r\n                                                : 'bg-gray-200 dark:bg-gray-700 text-gray-500'\r\n                                        }`}>\r\n                                            {isComplete ? <Check size={16} /> : index + 1}\r\n                                        </div>\r\n                                        <span className={`text-[10px] mt-1 whitespace-nowrap ${\r\n                                            isCurrent ? 'font-bold text-orange-600' : 'text-gray-500'\r\n                                        }`}>\r\n                                            {step.label}\r\n                                        </span>\r\n                                    </div>\r\n                                    {index < SAFE_EXCHANGE_STEPS.length - 1 && (\r\n                                        <div className={`flex-1 h-1 min-w-[20px] rounded ${\r\n                                            isComplete ? 'bg-green-500' : 'bg-gray-200 dark:bg-gray-700'\r\n                                        }`} />\r\n                                    )}\r\n                                </React.Fragment>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Main Content */}\r\n                <div className=\"p-6 space-y-6 max-h-[60vh] overflow-y-auto\">\r\n                    {/* Escrow Status */}\r\n                    <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"p-2 bg-green-500 rounded-full\">\r\n                                <Lock className=\"text-white\" size={20} />\r\n                            </div>\r\n                            <div className=\"flex-1\">\r\n                                <h4 className=\"font-bold text-green-800 dark:text-green-300\">Escrow Protected</h4>\r\n                                <p className=\"text-sm text-green-600 dark:text-green-400\">\r\n                                    {isBuyer ? (\r\n                                        <>\r\n                                            ${transaction?.buyerTotal?.toFixed(2) || transaction?.price?.toLocaleString()} held securely\r\n                                            {transaction?.serviceFee && (\r\n                                                <span className=\"text-green-500 text-xs\"> (includes 1% service fee: ${transaction.serviceFee.toFixed(2)})</span>\r\n                                            )}\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            You&apos;ll receive ${transaction?.sellerPayout?.toFixed(2) || transaction?.price?.toLocaleString()} on completion\r\n                                            {transaction?.serviceFee && (\r\n                                                <span className=\"text-green-500 text-xs\"> (after 1% service fee: ${transaction.serviceFee.toFixed(2)})</span>\r\n                                            )}\r\n                                        </>\r\n                                    )}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Parties */}\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className={`p-4 rounded-xl border ${isSeller ? 'bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800' : 'dark:border-gray-700'}`}>\r\n                            <div className=\"text-xs font-bold text-gray-500 uppercase mb-2\">\r\n                                Seller {isSeller && '(You)'}\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <UserAvatar \r\n                                    src={transaction?.sellerPhoto}\r\n                                    name={transaction?.sellerName}\r\n                                    size=\"md\"\r\n                                />\r\n                                <div>\r\n                                    <div className=\"font-bold dark:text-white\">{transaction?.sellerName}</div>\r\n                                    {transaction?.sellerApproved && (\r\n                                        <span className=\"text-xs text-green-600 flex items-center gap-1\">\r\n                                            <CheckCircle size={12} /> Approved\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className={`p-4 rounded-xl border ${isBuyer ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800' : 'dark:border-gray-700'}`}>\r\n                            <div className=\"text-xs font-bold text-gray-500 uppercase mb-2\">\r\n                                Buyer {isBuyer && '(You)'}\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <UserAvatar \r\n                                    src={transaction?.buyerPhoto}\r\n                                    name={transaction?.buyerName}\r\n                                    size=\"md\"\r\n                                />\r\n                                <div>\r\n                                    <div className=\"font-bold dark:text-white\">{transaction?.buyerName}</div>\r\n                                    {transaction?.buyerApproved && (\r\n                                        <span className=\"text-xs text-green-600 flex items-center gap-1\">\r\n                                            <CheckCircle size={12} /> Approved\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Meetup Details (if scheduled) */}\r\n                    {transaction?.meetupLocation && (\r\n                        <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800\">\r\n                            <h4 className=\"font-bold text-blue-800 dark:text-blue-300 flex items-center gap-2 mb-3\">\r\n                                <MapPin size={18} /> Exchange Location\r\n                            </h4>\r\n                            <div className=\"space-y-2 text-sm\">\r\n                                <div className=\"flex items-center gap-2 text-blue-700 dark:text-blue-300\">\r\n                                    <Shield size={16} />\r\n                                    <span className=\"font-bold\">{transaction.meetupLocation.name}</span>\r\n                                    <span className=\"bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs px-2 py-0.5 rounded\">\r\n                                        {transaction.meetupLocation.typeLabel}\r\n                                    </span>\r\n                                </div>\r\n                                <p className=\"text-blue-600 dark:text-blue-400\">{transaction.meetupLocation.address}</p>\r\n                                <div className=\"flex items-center gap-4 mt-2\">\r\n                                    <span className=\"flex items-center gap-1\">\r\n                                        <Calendar size={14} /> {transaction.meetupDate}\r\n                                    </span>\r\n                                    <span className=\"flex items-center gap-1\">\r\n                                        <Clock size={14} /> {transaction.meetupTime}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* GPS Status (when tracking) */}\r\n                    {currentPosition && (\r\n                        <div className=\"bg-gray-50 dark:bg-gray-800 p-4 rounded-xl\">\r\n                            <h4 className=\"font-bold dark:text-white text-sm mb-3 flex items-center gap-2\">\r\n                                <Navigation size={16} className=\"text-blue-500\" /> Live Location\r\n                            </h4>\r\n                            <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                                <div>\r\n                                    <span className=\"text-gray-500\">Your Position:</span>\r\n                                    <div className=\"flex items-center gap-1 font-mono text-xs dark:text-white\">\r\n                                        {currentPosition.lat.toFixed(6)}, {currentPosition.lng.toFixed(6)}\r\n                                    </div>\r\n                                </div>\r\n                                {nearestSafeZone && (\r\n                                    <div>\r\n                                        <span className=\"text-gray-500\">Safe Zone:</span>\r\n                                        <div className=\"flex items-center gap-1\">\r\n                                            {isInSafeZone ? (\r\n                                                <span className=\"text-green-600 font-bold flex items-center gap-1\">\r\n                                                    <CheckCircle size={14} /> In Zone\r\n                                                </span>\r\n                                            ) : (\r\n                                                <span className=\"text-orange-600\">\r\n                                                    {Math.round(nearestSafeZone.distance)}m away\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Action Buttons Based on Status and Role */}\r\n                    <div className=\"space-y-3\">\r\n                        {/* Seller: Schedule Meetup */}\r\n                        {isSeller && transaction?.status === SAFE_EXCHANGE_STATUS.SELLER_NOTIFIED && (\r\n                            <button\r\n                                onClick={() => setShowZonePicker(true)}\r\n                                className=\"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-orange-700 transition\"\r\n                            >\r\n                                <Calendar size={20} /> Schedule Safe Exchange\r\n                            </button>\r\n                        )}\r\n\r\n                        {/* Seller: Start Departure */}\r\n                        {isSeller && transaction?.status === SAFE_EXCHANGE_STATUS.MEETUP_SCHEDULED && (\r\n                            <button\r\n                                onClick={handleSellerDepart}\r\n                                className=\"w-full bg-orange-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-orange-700 transition\"\r\n                            >\r\n                                <Camera size={20} /> Take Pre-Departure Photos\r\n                            </button>\r\n                        )}\r\n\r\n                        {/* Buyer: Start Journey */}\r\n                        {isBuyer && transaction?.status === SAFE_EXCHANGE_STATUS.SELLER_PHOTOS_UPLOADED && (\r\n                            <button\r\n                                onClick={handleBuyerDepart}\r\n                                className=\"w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition\"\r\n                            >\r\n                                <Navigation size={20} /> I'm On My Way\r\n                            </button>\r\n                        )}\r\n\r\n                        {/* Buyer: Start Inspection */}\r\n                        {isBuyer && (transaction?.status === SAFE_EXCHANGE_STATUS.BUYER_EN_ROUTE || \r\n                                     transaction?.status === SAFE_EXCHANGE_STATUS.AT_SAFE_ZONE) && \r\n                         isInSafeZone && isWithinProximity && (\r\n                            <button\r\n                                onClick={() => setPhotoMode('buyer_inspect')}\r\n                                className=\"w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition\"\r\n                            >\r\n                                <Camera size={20} /> Start Item Inspection\r\n                            </button>\r\n                        )}\r\n\r\n                        {/* Dual Approval */}\r\n                        {transaction?.status === SAFE_EXCHANGE_STATUS.PENDING_DUAL_APPROVAL && (\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800\">\r\n                                    <h4 className=\"font-bold text-yellow-800 dark:text-yellow-300 mb-2\">\r\n                                        Final Approval Required\r\n                                    </h4>\r\n                                    <p className=\"text-sm text-yellow-700 dark:text-yellow-400\">\r\n                                        Both parties must approve to release funds.\r\n                                    </p>\r\n                                </div>\r\n\r\n                                {((isSeller && !transaction.sellerApproved) || \r\n                                  (isBuyer && !transaction.buyerApproved)) && (\r\n                                    <button\r\n                                        onClick={handleApprove}\r\n                                        disabled={actionLoading}\r\n                                        className=\"w-full bg-green-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-green-700 transition disabled:opacity-50\"\r\n                                    >\r\n                                        {actionLoading ? (\r\n                                            <Loader2 className=\"animate-spin\" />\r\n                                        ) : (\r\n                                            <>\r\n                                                <CheckCircle size={20} /> Approve & Release Funds\r\n                                            </>\r\n                                        )}\r\n                                    </button>\r\n                                )}\r\n\r\n                                {((isSeller && transaction.sellerApproved) || \r\n                                  (isBuyer && transaction.buyerApproved)) && (\r\n                                    <div className=\"text-center text-green-600 font-bold py-4\">\r\n                                        <CheckCircle className=\"inline mr-2\" />\r\n                                        You have approved. Waiting for other party...\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Completed */}\r\n                        {transaction?.status === SAFE_EXCHANGE_STATUS.COMPLETED && (\r\n                            <div className=\"bg-green-50 dark:bg-green-900/20 p-6 rounded-xl border border-green-200 dark:border-green-800 text-center\">\r\n                                <CheckCircle className=\"text-green-500 mx-auto mb-4\" size={48} />\r\n                                <h4 className=\"text-xl font-bold text-green-700 dark:text-green-300 mb-2\">\r\n                                    Exchange Completed!\r\n                                </h4>\r\n                                <p className=\"text-green-600 dark:text-green-400\">\r\n                                    {isSeller \r\n                                        ? 'Funds have been released to your account.'\r\n                                        : 'Thank you for your purchase!'}\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Disputed */}\r\n                        {transaction?.status === SAFE_EXCHANGE_STATUS.DISPUTED && (\r\n                            <div className=\"bg-red-50 dark:bg-red-900/20 p-6 rounded-xl border border-red-200 dark:border-red-800 text-center\">\r\n                                <AlertTriangle className=\"text-red-500 mx-auto mb-4\" size={48} />\r\n                                <h4 className=\"text-xl font-bold text-red-700 dark:text-red-300 mb-2\">\r\n                                    Dispute Raised\r\n                                </h4>\r\n                                <p className=\"text-red-600 dark:text-red-400 mb-4\">\r\n                                    Our support team will review this transaction.\r\n                                </p>\r\n                                <button className=\"bg-red-600 text-white px-6 py-2 rounded-lg font-bold\">\r\n                                    Contact Support\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Message Other Party */}\r\n                        {transaction?.status !== SAFE_EXCHANGE_STATUS.COMPLETED && (\r\n                            <button\r\n                                onClick={() => onMessage?.(isSeller ? transaction.buyerId : transaction.sellerId)}\r\n                                className=\"w-full border-2 border-gray-300 dark:border-gray-600 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-800 transition dark:text-white\"\r\n                            >\r\n                                <MessageCircle size={18} /> Message {isSeller ? 'Buyer' : 'Seller'}\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer Actions */}\r\n                <div className=\"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex justify-between\">\r\n                    {transaction?.status !== SAFE_EXCHANGE_STATUS.COMPLETED && \r\n                     transaction?.status !== SAFE_EXCHANGE_STATUS.CANCELLED && (\r\n                        <>\r\n                            <button\r\n                                onClick={handleCancel}\r\n                                className=\"text-red-600 font-bold text-sm hover:underline\"\r\n                            >\r\n                                Cancel Transaction\r\n                            </button>\r\n                            {transaction?.status !== SAFE_EXCHANGE_STATUS.DISPUTED && (\r\n                                <button\r\n                                    onClick={() => handleDispute('Item not as described')}\r\n                                    className=\"text-orange-600 font-bold text-sm hover:underline\"\r\n                                >\r\n                                    Raise Dispute\r\n                                </button>\r\n                            )}\r\n                        </>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Safe Zone Picker Modal */}\r\n            {showZonePicker && (\r\n                <div className=\"fixed inset-0 bg-black/70 flex items-center justify-center z-[75] p-4\">\r\n                    <div className=\"bg-white dark:bg-gray-900 w-full max-w-lg rounded-2xl overflow-hidden\">\r\n                        <div className=\"p-6 border-b dark:border-gray-700\">\r\n                            <h3 className=\"text-xl font-bold dark:text-white\">Select Safe Exchange Zone</h3>\r\n                            <p className=\"text-sm text-gray-500 mt-1\">Choose a verified safe location for the exchange</p>\r\n                        </div>\r\n\r\n                        <div className=\"p-4 max-h-[400px] overflow-y-auto space-y-2\">\r\n                            {nearbyZones.length > 0 ? (\r\n                                nearbyZones.map(zone => (\r\n                                    <button\r\n                                        key={zone.id}\r\n                                        onClick={() => setSelectedSafeZone(zone)}\r\n                                        className={`w-full p-4 rounded-xl border text-left transition ${\r\n                                            selectedSafeZone?.id === zone.id\r\n                                                ? 'border-orange-500 bg-orange-50 dark:bg-orange-900/20'\r\n                                                : 'border-gray-200 dark:border-gray-700 hover:border-gray-400'\r\n                                        }`}\r\n                                    >\r\n                                        <div className=\"flex items-start gap-3\">\r\n                                            <div className={`p-2 rounded-lg ${\r\n                                                selectedSafeZone?.id === zone.id\r\n                                                    ? 'bg-orange-500 text-white'\r\n                                                    : 'bg-gray-100 dark:bg-gray-800 text-gray-500'\r\n                                            }`}>\r\n                                                <Shield size={20} />\r\n                                            </div>\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"font-bold dark:text-white\">{zone.name}</div>\r\n                                                <div className=\"text-xs text-gray-500 truncate\">{zone.address}</div>\r\n                                                <div className=\"flex items-center gap-2 mt-1\">\r\n                                                    <span className=\"text-xs bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded\">\r\n                                                        {zone.typeLabel}\r\n                                                    </span>\r\n                                                    <span className=\"text-xs text-gray-500\">\r\n                                                        {(zone.distance / 1000).toFixed(1)} km away\r\n                                                    </span>\r\n                                                </div>\r\n                                            </div>\r\n                                            {selectedSafeZone?.id === zone.id && (\r\n                                                <CheckCircle className=\"text-orange-500\" size={20} />\r\n                                            )}\r\n                                        </div>\r\n                                    </button>\r\n                                ))\r\n                            ) : (\r\n                                <div className=\"text-center py-8 text-gray-500\">\r\n                                    <MapPin size={32} className=\"mx-auto mb-2 opacity-50\" />\r\n                                    <p>Loading nearby safe zones...</p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {selectedSafeZone && (\r\n                            <div className=\"p-4 border-t dark:border-gray-700 space-y-4\">\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div>\r\n                                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Date</label>\r\n                                        <input\r\n                                            type=\"date\"\r\n                                            value={meetupDate}\r\n                                            onChange={(e) => setMeetupDate(e.target.value)}\r\n                                            min={new Date().toISOString().split('T')[0]}\r\n                                            className=\"w-full p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white\"\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Time</label>\r\n                                        <input\r\n                                            type=\"time\"\r\n                                            value={meetupTime}\r\n                                            onChange={(e) => setMeetupTime(e.target.value)}\r\n                                            className=\"w-full p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <button\r\n                                    onClick={scheduleMeetup}\r\n                                    disabled={!meetupDate || !meetupTime || actionLoading}\r\n                                    className=\"w-full bg-orange-600 text-white py-3 rounded-xl font-bold disabled:opacity-50 hover:bg-orange-700 transition\"\r\n                                >\r\n                                    {actionLoading ? 'Scheduling...' : 'Confirm & Notify Buyer'}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"p-4 border-t dark:border-gray-700\">\r\n                            <button\r\n                                onClick={() => setShowZonePicker(false)}\r\n                                className=\"w-full text-gray-500 font-bold hover:text-gray-700 dark:hover:text-gray-300\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Search, Plus, Camera, DollarSign, X, CheckCircle, AlertTriangle, Loader2, MapPin, Wrench, Shield, Lock, Truck, CreditCard, Info, ToggleLeft, ToggleRight, Package, Star, MessageCircle, Send, Clock, ThumbsUp, ThumbsDown, BadgeCheck, ShoppingCart, ArrowRight, Home, BoxIcon, Receipt, ChevronRight } from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport { useMediaUpload } from '../../hooks/useMediaUpload';\r\nimport { EQUIP_CATEGORIES, HIGH_VALUE_THRESHOLD, SAFE_EXCHANGE_STATUS, SAFE_EXCHANGE_REQUIREMENT, FULFILLMENT_METHOD, SHIPPING_VERIFICATION_STATUS } from '../../config/constants';\r\nimport InspectionEditor from '../tech/InspectionEditor';\r\nimport { InspectionSvg } from '../tech/InspectionDiagrams';\r\nimport SafeExchangeTransaction from './SafeExchangeTransaction';\r\nimport ShippingVerification from './ShippingVerification';\r\nimport toast from 'react-hot-toast';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nconst CONDITIONS = ['Mint', 'Excellent', 'Good', 'Fair', 'Non-Functioning'];\r\n\r\n// Order status constants for standard purchases\r\nconst ORDER_STATUS = {\r\n    PENDING: 'pending',           // Order placed, awaiting seller confirmation\r\n    CONFIRMED: 'confirmed',       // Seller confirmed the order\r\n    SHIPPED: 'shipped',           // Item has been shipped\r\n    DELIVERED: 'delivered',       // Item delivered\r\n    COMPLETED: 'completed',       // Buyer confirmed receipt, transaction complete\r\n    CANCELLED: 'cancelled',       // Order cancelled\r\n    REFUNDED: 'refunded',         // Order refunded\r\n};\r\n\r\n// Order status display config\r\nconst ORDER_STATUS_CONFIG = {\r\n    [ORDER_STATUS.PENDING]: { label: 'Pending', color: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400', icon: Clock },\r\n    [ORDER_STATUS.CONFIRMED]: { label: 'Confirmed', color: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400', icon: CheckCircle },\r\n    [ORDER_STATUS.SHIPPED]: { label: 'Shipped', color: 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400', icon: Truck },\r\n    [ORDER_STATUS.DELIVERED]: { label: 'Delivered', color: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400', icon: Package },\r\n    [ORDER_STATUS.COMPLETED]: { label: 'Completed', color: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400', icon: CheckCircle },\r\n    [ORDER_STATUS.CANCELLED]: { label: 'Cancelled', color: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400', icon: X },\r\n    [ORDER_STATUS.REFUNDED]: { label: 'Refunded', color: 'bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400', icon: Receipt },\r\n};\r\n\r\n// Service fee configuration - Mutual 1% fee on both buyer and seller\r\nconst SERVICE_FEE_RATE = 0.01; // 1% service fee (applied to both parties)\r\n\r\n// Calculate service fee and totals\r\n// Buyer pays: item price + 1% fee\r\n// Seller receives: item price - 1% fee\r\nconst calculateFees = (itemPrice) => {\r\n    const price = parseFloat(itemPrice) || 0;\r\n    const serviceFee = Math.round(price * SERVICE_FEE_RATE * 100) / 100; // Round to 2 decimal places\r\n    const buyerTotal = Math.round((price + serviceFee) * 100) / 100; // Buyer pays price + 1%\r\n    const sellerPayout = Math.round((price - serviceFee) * 100) / 100; // Seller receives price - 1%\r\n    return {\r\n        itemPrice: price,\r\n        serviceFee,\r\n        serviceFeeRate: SERVICE_FEE_RATE,\r\n        buyerTotal,\r\n        sellerPayout\r\n    };\r\n};\r\n\r\n// Seller Rating Component\r\nconst SellerRating = ({ rating, reviewCount, size = 'sm' }) => {\r\n    if (!rating && !reviewCount) return null;\r\n    \r\n    const sizes = {\r\n        sm: { star: 12, text: 'text-xs' },\r\n        md: { star: 14, text: 'text-sm' },\r\n        lg: { star: 16, text: 'text-base' }\r\n    };\r\n    const s = sizes[size];\r\n    \r\n    return (\r\n        <div className={`flex items-center gap-1 ${s.text}`}>\r\n            <Star size={s.star} className=\"text-yellow-500 fill-yellow-500\" />\r\n            <span className=\"font-bold text-yellow-600 dark:text-yellow-400\">\r\n                {rating?.toFixed(1) || '‚Äî'}\r\n            </span>\r\n            {reviewCount > 0 && (\r\n                <span className=\"text-gray-400\">({reviewCount} sale{reviewCount !== 1 ? 's' : ''})</span>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// Offer Status Badge\r\nconst OfferStatusBadge = ({ status }) => {\r\n    const statusConfig = {\r\n        pending: { label: 'Pending', color: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400' },\r\n        accepted: { label: 'Accepted', color: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' },\r\n        declined: { label: 'Declined', color: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' },\r\n        countered: { label: 'Countered', color: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' },\r\n        expired: { label: 'Expired', color: 'bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400' },\r\n    };\r\n    const config = statusConfig[status] || statusConfig.pending;\r\n    \r\n    return (\r\n        <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${config.color}`}>\r\n            {config.label}\r\n        </span>\r\n    );\r\n};\r\n\r\n// Helper to check if item requires escrow (high value)\r\nconst isHighValueItem = (price) => price >= HIGH_VALUE_THRESHOLD;\r\n\r\n// Determine safe exchange requirement level\r\nconst getSafeExchangeRequirement = (price, sellerRequiresSafeExchange) => {\r\n    if (price >= HIGH_VALUE_THRESHOLD) return SAFE_EXCHANGE_REQUIREMENT.REQUIRED;\r\n    if (sellerRequiresSafeExchange) return SAFE_EXCHANGE_REQUIREMENT.SELLER_REQUIRED;\r\n    return SAFE_EXCHANGE_REQUIREMENT.OPTIONAL;\r\n};\r\n\r\nexport default function GearExchange({ user, userData, setActiveTab, openChat }) {\r\n    const [view, setView] = useState('browse'); // 'browse', 'create', 'detail', 'orders'\r\n    const [listings, setListings] = useState([]);\r\n    const [filter, setFilter] = useState('All');\r\n    const [search, setSearch] = useState('');\r\n    const [selectedItem, setSelectedItem] = useState(null);\r\n    \r\n    // Safe Exchange State\r\n    const [activeTransaction, setActiveTransaction] = useState(null);\r\n    const [userTransactions, setUserTransactions] = useState([]);\r\n    \r\n    // Standard Orders State\r\n    const [userOrders, setUserOrders] = useState([]);\r\n    const [selectedOrder, setSelectedOrder] = useState(null);\r\n\r\n    // Fetch Listings\r\n    useEffect(() => {\r\n        if (!supabase) return;\r\n        \r\n        const channel = supabase\r\n            .channel('gear-listings')\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'gear_listings'\r\n            }, () => {\r\n                loadListings();\r\n            })\r\n            .subscribe();\r\n\r\n        loadListings();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [user?.id, user?.uid]);\r\n\r\n    const loadListings = async () => {\r\n        if (!supabase) return;\r\n        try {\r\n            const { data: listingsData, error } = await supabase\r\n                .from('gear_listings')\r\n                .select('*')\r\n                .order('timestamp', { ascending: false });\r\n            \r\n            if (error) throw error;\r\n            \r\n            setListings((listingsData || []).map(l => ({\r\n                id: l.id,\r\n                ...l,\r\n                sellerId: l.seller_id,\r\n                sellerName: l.seller_name,\r\n                sellerPhoto: l.seller_photo,\r\n                sellerRating: l.seller_rating,\r\n                sellerSalesCount: l.seller_sales_count,\r\n                sellerVerified: l.seller_verified,\r\n                sellerResponseTime: l.seller_response_time,\r\n                minimumOffer: l.minimum_offer,\r\n                conditionReport: l.condition_report,\r\n                timestamp: l.timestamp\r\n            })));\r\n        } catch (error) {\r\n            console.error('Error loading listings:', error);\r\n        }\r\n    };\r\n\r\n    // Fetch user's active safe exchange transactions\r\n    useEffect(() => {\r\n        if ((!user?.id && !user?.uid) || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n\r\n        const channel = supabase\r\n            .channel('safe-exchange-transactions')\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'safe_exchange_transactions',\r\n                filter: `buyer_id=eq.${userId}`\r\n            }, () => {\r\n                loadTransactions();\r\n            })\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'safe_exchange_transactions',\r\n                filter: `seller_id=eq.${userId}`\r\n            }, () => {\r\n                loadTransactions();\r\n            })\r\n            .subscribe();\r\n\r\n        loadTransactions();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [user?.id, user?.uid]);\r\n\r\n    const loadTransactions = async () => {\r\n        if (!supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const { data: buyerTxns, error: buyerError } = await supabase\r\n                .from('safe_exchange_transactions')\r\n                .select('*')\r\n                .eq('buyer_id', userId);\r\n            \r\n            const { data: sellerTxns, error: sellerError } = await supabase\r\n                .from('safe_exchange_transactions')\r\n                .select('*')\r\n                .eq('seller_id', userId);\r\n            \r\n            if (buyerError || sellerError) throw buyerError || sellerError;\r\n            \r\n            const allTxns = [\r\n                ...(buyerTxns || []).map(t => ({\r\n                    id: t.id,\r\n                    ...t,\r\n                    buyerId: t.buyer_id,\r\n                    sellerId: t.seller_id,\r\n                    listingId: t.listing_id,\r\n                    role: 'buyer'\r\n                })),\r\n                ...(sellerTxns || []).map(t => ({\r\n                    id: t.id,\r\n                    ...t,\r\n                    buyerId: t.buyer_id,\r\n                    sellerId: t.seller_id,\r\n                    listingId: t.listing_id,\r\n                    role: 'seller'\r\n                }))\r\n            ];\r\n            \r\n            setUserTransactions(allTxns);\r\n        } catch (error) {\r\n            console.error('Error loading transactions:', error);\r\n        }\r\n    };\r\n\r\n    // Fetch user's standard orders (as buyer and seller)\r\n    useEffect(() => {\r\n        if ((!user?.id && !user?.uid) || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n\r\n        const channel = supabase\r\n            .channel('gear-orders')\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'gear_orders',\r\n                filter: `buyer_id=eq.${userId}`\r\n            }, () => {\r\n                loadOrders();\r\n            })\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'gear_orders',\r\n                filter: `seller_id=eq.${userId}`\r\n            }, () => {\r\n                loadOrders();\r\n            })\r\n            .subscribe();\r\n\r\n        loadOrders();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [user?.id, user?.uid]);\r\n\r\n    const loadOrders = async () => {\r\n        if (!supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const { data: buyerOrders, error: buyerError } = await supabase\r\n                .from('gear_orders')\r\n                .select('*')\r\n                .eq('buyer_id', userId);\r\n            \r\n            const { data: sellerOrders, error: sellerError } = await supabase\r\n                .from('gear_orders')\r\n                .select('*')\r\n                .eq('seller_id', userId);\r\n            \r\n            if (buyerError || sellerError) throw buyerError || sellerError;\r\n            \r\n            const allOrders = [\r\n                ...(buyerOrders || []).map(o => ({\r\n                    id: o.id,\r\n                    ...o,\r\n                    buyerId: o.buyer_id,\r\n                    sellerId: o.seller_id,\r\n                    listingId: o.listing_id,\r\n                    itemTitle: o.item_title,\r\n                    itemBrand: o.item_brand,\r\n                    itemDescription: o.item_description,\r\n                    itemPhotos: o.item_photos,\r\n                    itemCondition: o.item_condition,\r\n                    itemPrice: o.item_price,\r\n                    serviceFee: o.service_fee,\r\n                    serviceFeeRate: o.service_fee_rate,\r\n                    buyerTotal: o.buyer_total,\r\n                    sellerPayout: o.seller_payout,\r\n                    buyerName: o.buyer_name,\r\n                    buyerPhoto: o.buyer_photo,\r\n                    sellerName: o.seller_name,\r\n                    sellerPhoto: o.seller_photo,\r\n                    fulfillmentMethod: o.fulfillment_method,\r\n                    shippingAddress: o.shipping_address,\r\n                    shippingPhone: o.shipping_phone,\r\n                    shippingNotes: o.shipping_notes,\r\n                    statusHistory: o.status_history,\r\n                    createdAt: o.created_at,\r\n                    updatedAt: o.updated_at,\r\n                    role: 'buyer'\r\n                })),\r\n                ...(sellerOrders || []).map(o => ({\r\n                    id: o.id,\r\n                    ...o,\r\n                    buyerId: o.buyer_id,\r\n                    sellerId: o.seller_id,\r\n                    listingId: o.listing_id,\r\n                    itemTitle: o.item_title,\r\n                    itemBrand: o.item_brand,\r\n                    itemDescription: o.item_description,\r\n                    itemPhotos: o.item_photos,\r\n                    itemCondition: o.item_condition,\r\n                    itemPrice: o.item_price,\r\n                    serviceFee: o.service_fee,\r\n                    serviceFeeRate: o.service_fee_rate,\r\n                    buyerTotal: o.buyer_total,\r\n                    sellerPayout: o.seller_payout,\r\n                    buyerName: o.buyer_name,\r\n                    buyerPhoto: o.buyer_photo,\r\n                    sellerName: o.seller_name,\r\n                    sellerPhoto: o.seller_photo,\r\n                    fulfillmentMethod: o.fulfillment_method,\r\n                    shippingAddress: o.shipping_address,\r\n                    shippingPhone: o.shipping_phone,\r\n                    shippingNotes: o.shipping_notes,\r\n                    statusHistory: o.status_history,\r\n                    createdAt: o.created_at,\r\n                    updatedAt: o.updated_at,\r\n                    role: 'seller'\r\n                }))\r\n            ].sort((a, b) => {\r\n                const aTime = a.createdAt ? new Date(a.createdAt).getTime() : 0;\r\n                const bTime = b.createdAt ? new Date(b.createdAt).getTime() : 0;\r\n                return bTime - aTime;\r\n            });\r\n            \r\n            setUserOrders(allOrders);\r\n        } catch (error) {\r\n            console.error('Error loading orders:', error);\r\n        }\r\n    };\r\n\r\n    // Handle initiating a safe exchange purchase\r\n    const handleSafeExchangePurchase = async (item) => {\r\n        if (!supabase) return;\r\n        // Calculate fees\r\n        const fees = calculateFees(item.price);\r\n        const userId = user?.id || user?.uid;\r\n        const now = new Date().toISOString();\r\n        \r\n        try {\r\n            // Create the safe exchange transaction\r\n            const statusHistory = {\r\n                [SAFE_EXCHANGE_STATUS.INTENT_CREATED]: {\r\n                    timestamp: Date.now(),\r\n                    userId: userId\r\n                }\r\n            };\r\n            \r\n            const { data: transaction, error: createError } = await supabase\r\n                .from('safe_exchange_transactions')\r\n                .insert({\r\n                    listing_id: item.id,\r\n                    item_title: item.title,\r\n                    item_brand: item.brand,\r\n                    item_description: item.description || null,\r\n                    item_photos: item.images || [],\r\n                    item_condition: item.condition,\r\n                    price: item.price,\r\n                    item_price: fees.itemPrice,\r\n                    service_fee: fees.serviceFee,\r\n                    service_fee_rate: fees.serviceFeeRate,\r\n                    buyer_total: fees.buyerTotal,\r\n                    seller_payout: fees.sellerPayout,\r\n                    seller_id: item.sellerId,\r\n                    seller_name: item.sellerName,\r\n                    seller_photo: item.sellerPhoto,\r\n                    buyer_id: userId,\r\n                    buyer_name: userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() || 'Buyer' : 'Buyer',\r\n                    buyer_photo: userData.photoURL || null,\r\n                    status: SAFE_EXCHANGE_STATUS.INTENT_CREATED,\r\n                    status_history: statusHistory,\r\n                    escrow_amount: fees.buyerTotal,\r\n                    escrow_status: 'pending',\r\n                    seller_approved: false,\r\n                    buyer_approved: false,\r\n                    created_at: now,\r\n                    updated_at: now\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (createError) throw createError;\r\n\r\n            // Update transaction to hold_placed status (simulating payment hold)\r\n            statusHistory[SAFE_EXCHANGE_STATUS.HOLD_PLACED] = {\r\n                timestamp: Date.now(),\r\n                userId: userId\r\n            };\r\n            \r\n            await supabase\r\n                .from('safe_exchange_transactions')\r\n                .update({\r\n                    status: SAFE_EXCHANGE_STATUS.HOLD_PLACED,\r\n                    status_history: statusHistory,\r\n                    escrow_status: 'held',\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', transaction.id);\r\n\r\n            // Notify seller\r\n            statusHistory[SAFE_EXCHANGE_STATUS.SELLER_NOTIFIED] = {\r\n                timestamp: Date.now(),\r\n                userId: userId\r\n            };\r\n            \r\n            await supabase\r\n                .from('safe_exchange_transactions')\r\n                .update({\r\n                    status: SAFE_EXCHANGE_STATUS.SELLER_NOTIFIED,\r\n                    status_history: statusHistory,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', transaction.id);\r\n\r\n            // Send notification to seller with payout info\r\n            await supabase\r\n                .from('notifications')\r\n                .insert({\r\n                    user_id: item.sellerId,\r\n                    type: 'safe_exchange_intent',\r\n                    transaction_id: transaction.id,\r\n                    message: `${userData?.firstName || 'A user'} wants to purchase your ${item.title} - You'll receive $${fees.sellerPayout.toFixed(2)}`,\r\n                    buyer_name: userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() || 'Buyer' : 'Buyer',\r\n                    item_title: item.title,\r\n                    price: item.price,\r\n                    seller_payout: fees.sellerPayout,\r\n                    service_fee: fees.serviceFee,\r\n                    read: false,\r\n                    created_at: new Date().toISOString()\r\n                });\r\n\r\n            // Open the transaction view\r\n            setActiveTransaction(transaction.id);\r\n            setSelectedItem(null);\r\n\r\n        } catch (error) {\r\n            console.error('Failed to create safe exchange:', error);\r\n            alert('Failed to initiate purchase. Please try again.');\r\n        }\r\n    };\r\n\r\n    // Handle standard purchase for low-value items\r\n    const handleStandardPurchase = async (item, shippingDetails) => {\r\n        if (!supabase) return;\r\n        const toastId = toast.loading('Processing your order...');\r\n        \r\n        // Calculate fees\r\n        const fees = calculateFees(item.price);\r\n        const userId = user?.id || user?.uid;\r\n        const now = new Date().toISOString();\r\n        \r\n        try {\r\n            // Create the order\r\n            const { data: order, error: orderError } = await supabase\r\n                .from('gear_orders')\r\n                .insert({\r\n                    listing_id: item.id,\r\n                    item_title: item.title,\r\n                    item_brand: item.brand,\r\n                    item_description: item.description || null,\r\n                    item_photos: item.images || [],\r\n                    item_condition: item.condition,\r\n                    price: item.price,\r\n                    item_price: fees.itemPrice,\r\n                    service_fee: fees.serviceFee,\r\n                    service_fee_rate: fees.serviceFeeRate,\r\n                    buyer_total: fees.buyerTotal,\r\n                    seller_payout: fees.sellerPayout,\r\n                    seller_id: item.sellerId,\r\n                    seller_name: item.sellerName,\r\n                    seller_photo: item.sellerPhoto,\r\n                    buyer_id: userId,\r\n                    buyer_name: userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() || 'Buyer' : 'Buyer',\r\n                    buyer_photo: userData.photoURL || null,\r\n                    fulfillment_method: shippingDetails.method,\r\n                    shipping_address: shippingDetails.method === 'shipping' ? shippingDetails.address : null,\r\n                    shipping_phone: shippingDetails.phone || null,\r\n                    shipping_notes: shippingDetails.notes || null,\r\n                    tracking_number: null,\r\n                    tracking_carrier: null,\r\n                    status: ORDER_STATUS.PENDING,\r\n                    status_history: [{\r\n                        status: ORDER_STATUS.PENDING,\r\n                        timestamp: Date.now(),\r\n                        note: 'Order placed by buyer'\r\n                    }],\r\n                    payment_status: 'pending',\r\n                    payment_intent_id: null,\r\n                    created_at: now,\r\n                    updated_at: now\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (orderError) throw orderError;\r\n\r\n            // Send notification to seller with payout info\r\n            await supabase\r\n                .from('notifications')\r\n                .insert({\r\n                    user_id: item.sellerId,\r\n                    type: 'gear_order',\r\n                    order_id: order.id,\r\n                    listing_id: item.id,\r\n                    message: `${userData?.firstName || 'A user'} purchased your ${item.title} - You'll receive $${fees.sellerPayout.toFixed(2)}`,\r\n                    buyer_name: userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() || 'Buyer' : 'Buyer',\r\n                    item_title: item.title,\r\n                    price: item.price,\r\n                    seller_payout: fees.sellerPayout,\r\n                    service_fee: fees.serviceFee,\r\n                    fulfillment_method: shippingDetails.method,\r\n                    read: false,\r\n                    created_at: new Date().toISOString()\r\n                });\r\n\r\n            // Update listing status to sold/pending\r\n            await supabase\r\n                .from('gear_listings')\r\n                .update({\r\n                    status: 'Pending Sale',\r\n                    pending_order_id: order.id,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', item.id);\r\n\r\n            toast.success('Order placed successfully!', { id: toastId });\r\n            setSelectedItem(null);\r\n            setView('orders'); // Switch to orders view\r\n            \r\n            return order.id;\r\n        } catch (error) {\r\n            console.error('Failed to create order:', error);\r\n            toast.error('Failed to place order. Please try again.', { id: toastId });\r\n            return null;\r\n        }\r\n    };\r\n\r\n    // Update order status (for sellers)\r\n    const handleUpdateOrderStatus = async (orderId, newStatus, trackingInfo = null) => {\r\n        if (!supabase) return;\r\n        const toastId = toast.loading('Updating order...');\r\n        \r\n        try {\r\n            const { data: orderData, error: fetchError } = await supabase\r\n                .from('gear_orders')\r\n                .select('*')\r\n                .eq('id', orderId)\r\n                .single();\r\n            \r\n            if (fetchError || !orderData) {\r\n                toast.error('Order not found', { id: toastId });\r\n                return;\r\n            }\r\n            \r\n            const statusHistory = orderData.status_history || [];\r\n            \r\n            const updateData = {\r\n                status: newStatus,\r\n                status_history: [...statusHistory, {\r\n                    status: newStatus,\r\n                    timestamp: Date.now(),\r\n                    note: `Status updated to ${newStatus}`\r\n                }],\r\n                updated_at: new Date().toISOString()\r\n            };\r\n            \r\n            // Add tracking info if provided\r\n            if (trackingInfo) {\r\n                updateData.tracking_number = trackingInfo.trackingNumber;\r\n                updateData.tracking_carrier = trackingInfo.carrier;\r\n            }\r\n            \r\n            await supabase\r\n                .from('gear_orders')\r\n                .update(updateData)\r\n                .eq('id', orderId);\r\n            \r\n            // Send notification to buyer\r\n            const notificationMessage = newStatus === ORDER_STATUS.SHIPPED \r\n                ? `Your order \"${orderData.item_title}\" has been shipped!`\r\n                : `Your order \"${orderData.item_title}\" status updated to ${newStatus}`;\r\n                \r\n            await supabase\r\n                .from('notifications')\r\n                .insert({\r\n                    user_id: orderData.buyer_id,\r\n                    type: 'order_update',\r\n                    order_id: orderId,\r\n                    message: notificationMessage,\r\n                    item_title: orderData.item_title,\r\n                    new_status: newStatus,\r\n                    tracking_number: trackingInfo?.trackingNumber || null,\r\n                    read: false,\r\n                    created_at: new Date().toISOString()\r\n                });\r\n            \r\n            // If completed, update listing to sold\r\n            if (newStatus === ORDER_STATUS.COMPLETED) {\r\n                await supabase\r\n                    .from('gear_listings')\r\n                    .update({\r\n                        status: 'Sold',\r\n                        updated_at: new Date().toISOString()\r\n                    })\r\n                    .eq('id', orderData.listing_id);\r\n            }\r\n            \r\n            toast.success('Order updated!', { id: toastId });\r\n        } catch (error) {\r\n            console.error('Failed to update order:', error);\r\n            toast.error('Failed to update order', { id: toastId });\r\n        }\r\n    };\r\n\r\n    // Get pending orders count\r\n    const pendingOrders = userOrders.filter(o => \r\n        o.status !== ORDER_STATUS.COMPLETED && \r\n        o.status !== ORDER_STATUS.CANCELLED &&\r\n        o.status !== ORDER_STATUS.REFUNDED\r\n    );\r\n\r\n    // Filtering\r\n    const filteredListings = listings.filter(l => \r\n        (filter === 'All' || l.category === filter) &&\r\n        (l.title.toLowerCase().includes(search.toLowerCase()) || l.brand.toLowerCase().includes(search.toLowerCase()))\r\n    );\r\n\r\n    // Get active transactions that are not completed\r\n    const pendingTransactions = userTransactions.filter(t => \r\n        t.status !== SAFE_EXCHANGE_STATUS.COMPLETED && \r\n        t.status !== SAFE_EXCHANGE_STATUS.CANCELLED\r\n    );\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto pb-24 animate-in fade-in\">\r\n            {/* Active Safe Exchange Transaction Modal */}\r\n            {activeTransaction && (\r\n                <SafeExchangeTransaction\r\n                    transactionId={activeTransaction}\r\n                    user={user}\r\n                    userData={userData}\r\n                    onClose={() => setActiveTransaction(null)}\r\n                    onComplete={() => {\r\n                        setActiveTransaction(null);\r\n                        // Could trigger a refresh or show success message\r\n                    }}\r\n                    onMessage={(otherUserId) => {\r\n                        // Open chat with other party\r\n                        openChat?.(otherUserId);\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            {/* Navigation & Search Header */}\r\n            {view === 'browse' && (\r\n                <>\r\n                    {/* Pending Transactions Banner */}\r\n                    {pendingTransactions.length > 0 && (\r\n                        <div className=\"mb-6 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800\">\r\n                            <div className=\"flex items-center gap-3 mb-3\">\r\n                                <Shield className=\"text-orange-600\" size={24} />\r\n                                <div>\r\n                                    <h3 className=\"font-bold text-orange-800 dark:text-orange-300\">Active Safe Exchanges</h3>\r\n                                    <p className=\"text-sm text-orange-600 dark:text-orange-400\">\r\n                                        You have {pendingTransactions.length} pending transaction{pendingTransactions.length > 1 ? 's' : ''}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                {pendingTransactions.map(txn => (\r\n                                    <button\r\n                                        key={txn.id}\r\n                                        onClick={() => setActiveTransaction(txn.id)}\r\n                                        className=\"w-full flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg hover:shadow-md transition\"\r\n                                    >\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className={`p-2 rounded-full ${txn.role === 'buyer' ? 'bg-blue-100 text-blue-600' : 'bg-green-100 text-green-600'}`}>\r\n                                                {txn.role === 'buyer' ? <CreditCard size={16} /> : <DollarSign size={16} />}\r\n                                            </div>\r\n                                            <div className=\"text-left\">\r\n                                                <div className=\"font-bold text-sm dark:text-white\">{txn.itemTitle}</div>\r\n                                                <div className=\"text-xs text-gray-500\">\r\n                                                    {txn.role === 'buyer' ? 'Buying' : 'Selling'} ‚Ä¢ ${txn.price}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <span className=\"text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-bold\">\r\n                                            {txn.status.replace(/_/g, ' ')}\r\n                                        </span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"flex flex-col md:flex-row justify-between items-end gap-4 mb-6\">\r\n                        <div>\r\n                            <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-2\">\r\n                                <Wrench className=\"text-orange-500\" /> Gear Exchange\r\n                            </h2>\r\n                            <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\r\n                                Buy and sell verified studio equipment.\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"flex gap-2 w-full md:w-auto\">\r\n                            <div className=\"relative flex-1 md:w-64\">\r\n                                <Search className=\"absolute left-3 top-2.5 text-gray-400\" size={16}/>\r\n                                <input \r\n                                    className=\"w-full pl-9 pr-4 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2c2e36] text-sm dark:text-white focus:outline-none focus:ring-2 focus:ring-orange-500\"\r\n                                    placeholder=\"Search gear...\"\r\n                                    value={search}\r\n                                    onChange={e => setSearch(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <button \r\n                                onClick={() => setView('orders')} \r\n                                className=\"relative bg-white dark:bg-[#2c2e36] border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 transition\"\r\n                            >\r\n                                <BoxIcon size={16}/> Orders\r\n                                {pendingOrders.length > 0 && (\r\n                                    <span className=\"absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center\">\r\n                                        {pendingOrders.length}\r\n                                    </span>\r\n                                )}\r\n                            </button>\r\n                            <button \r\n                                onClick={() => setView('create')} \r\n                                className=\"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 shadow-lg transition\"\r\n                            >\r\n                                <Plus size={16}/> Sell Gear\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Category Tabs */}\r\n                    <div className=\"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2\">\r\n                        <button onClick={() => setFilter('All')} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${filter === 'All' ? 'bg-white dark:bg-white text-black shadow' : 'bg-gray-100 dark:bg-gray-800 text-gray-500'}`}>All Gear</button>\r\n                        {EQUIP_CATEGORIES.map(cat => (\r\n                            <button key={cat.id} onClick={() => setFilter(cat.id)} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${filter === cat.id ? 'bg-white dark:bg-white text-black shadow' : 'bg-gray-100 dark:bg-gray-800 text-gray-500'}`}>\r\n                                {cat.label}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Grid */}\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n                        {filteredListings.map(item => {\r\n                            const highValue = isHighValueItem(item.price);\r\n                            return (\r\n                                <div key={item.id} onClick={() => setSelectedItem(item)} className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-xl transition cursor-pointer group flex flex-col\">\r\n                                    <div className=\"aspect-square bg-gray-100 dark:bg-black/40 relative flex items-center justify-center overflow-hidden\">\r\n                                        {item.images?.[0] ? (\r\n                                            <img src={item.images[0]} className=\"w-full h-full object-cover group-hover:scale-105 transition duration-500\"/>\r\n                                        ) : (\r\n                                            <Camera size={32} className=\"text-gray-400\"/>\r\n                                        )}\r\n                                        <div className=\"absolute top-2 right-2 bg-black/60 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur-md\">\r\n                                            ${item.price}\r\n                                        </div>\r\n                                        {highValue && (\r\n                                            <div className=\"absolute top-2 left-2 bg-orange-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1\">\r\n                                                <Shield size={10}/> Safe Exchange\r\n                                            </div>\r\n                                        )}\r\n                                        {item.conditionReport && (\r\n                                            <div className=\"absolute bottom-2 left-2 bg-green-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1\">\r\n                                                <CheckCircle size={10}/> Inspected\r\n                                            </div>\r\n                                        )}\r\n                                        {item.acceptsOffers && (\r\n                                            <div className=\"absolute bottom-2 right-2 bg-blue-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1\">\r\n                                                <MessageCircle size={10}/> Offers\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"p-4 flex-1 flex flex-col\">\r\n                                        <div className=\"text-[10px] font-bold text-gray-400 uppercase mb-1\">{item.brand}</div>\r\n                                        <h4 className=\"font-bold dark:text-white text-sm mb-1 line-clamp-1\">{item.title}</h4>\r\n                                        <div className=\"text-xs text-gray-500 mb-2\">{item.condition} Condition</div>\r\n                                        \r\n                                        {/* Seller Rating */}\r\n                                        {item.sellerRating && (\r\n                                            <div className=\"mb-2\">\r\n                                                <SellerRating rating={item.sellerRating} reviewCount={item.sellerSalesCount} size=\"sm\" />\r\n                                            </div>\r\n                                        )}\r\n                                        \r\n                                        <div className=\"mt-auto pt-3 border-t dark:border-gray-700 flex justify-between items-center text-xs text-gray-400\">\r\n                                            <span className=\"flex items-center gap-1\">\r\n                                                {highValue ? (\r\n                                                    <><MapPin size={10}/> Local Pickup</>\r\n                                                ) : (\r\n                                                    <><Truck size={10}/> {item.location || 'Ships'}</>\r\n                                                )}\r\n                                            </span>\r\n                                            {item.sellerVerified && (\r\n                                                <BadgeCheck size={14} className=\"text-blue-500\" />\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </>\r\n            )}\r\n\r\n            {/* Create Listing View */}\r\n            {view === 'create' && (\r\n                <CreateListingForm \r\n                    user={user} \r\n                    userData={userData} \r\n                    onCancel={() => setView('browse')} \r\n                    onSuccess={() => setView('browse')}\r\n                />\r\n            )}\r\n\r\n            {/* Orders View */}\r\n            {view === 'orders' && (\r\n                <OrdersView \r\n                    orders={userOrders}\r\n                    user={user}\r\n                    userData={userData}\r\n                    onBack={() => setView('browse')}\r\n                    onUpdateStatus={handleUpdateOrderStatus}\r\n                    openChat={openChat}\r\n                />\r\n            )}\r\n\r\n            {/* Detail Modal */}\r\n            {selectedItem && (\r\n                <ListingDetailModal \r\n                    item={selectedItem} \r\n                    onClose={() => setSelectedItem(null)} \r\n                    currentUser={user}\r\n                    currentUserData={userData}\r\n                    onSafeExchangePurchase={handleSafeExchangePurchase}\r\n                    onStandardPurchase={handleStandardPurchase}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n// --- SUB-COMPONENT: CREATE LISTING ---\r\nfunction CreateListingForm({ user, userData, onCancel, onSuccess }) {\r\n    const [step, setStep] = useState(1);\r\n    const [form, setForm] = useState({ \r\n        title: '', brand: '', category: EQUIP_CATEGORIES[0].id, condition: 'Good', price: '', \r\n        description: '', location: userData.city || '',\r\n        weight: '', length: '', width: '', height: '', // Added dimensions\r\n        acceptsOffers: true, // Enable offers by default\r\n        minimumOffer: '' // Optional minimum offer percentage\r\n    });\r\n    const [images, setImages] = useState([]);\r\n    const [conditionReport, setConditionReport] = useState(null);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const { uploadMedia, uploading } = useMediaUpload();\r\n\r\n    const handleImageUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        const res = await uploadMedia(file, `gear/${user.uid}`);\r\n        if (res?.url) setImages([...images, res.url]);\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        if (!form.title || !form.price || !supabase) {\r\n            if (!form.title || !form.price) alert(\"Title and Price required.\");\r\n            return;\r\n        }\r\n        setSubmitting(true);\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            await supabase\r\n                .from('gear_listings')\r\n                .insert({\r\n                    title: form.title,\r\n                    brand: form.brand,\r\n                    category: form.category,\r\n                    condition: form.condition,\r\n                    price: parseInt(form.price),\r\n                    description: form.description || null,\r\n                    location: form.location || null,\r\n                    weight: form.weight || null,\r\n                    length: form.length || null,\r\n                    width: form.width || null,\r\n                    height: form.height || null,\r\n                    accepts_offers: form.acceptsOffers || false,\r\n                    minimum_offer: form.minimumOffer ? parseInt(form.minimumOffer) : null,\r\n                    images: images || [],\r\n                    condition_report: conditionReport,\r\n                    seller_id: userId,\r\n                    seller_name: userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() || 'Seller' : 'Seller',\r\n                    seller_photo: userData?.photoURL || null,\r\n                    seller_rating: userData?.sellerRating || null,\r\n                    seller_sales_count: userData?.sellerSalesCount || 0,\r\n                    seller_verified: userData?.verified || false,\r\n                    seller_response_time: userData?.avgResponseTime || null,\r\n                    timestamp: new Date().toISOString(),\r\n                    status: 'Active'\r\n                });\r\n            toast.success(\"Listing posted!\");\r\n            onSuccess();\r\n        } catch (e) {\r\n            console.error(e);\r\n            toast.error(\"Failed to post listing.\");\r\n        }\r\n        setSubmitting(false);\r\n    };\r\n\r\n    // Special View: Tech Inspection Tool embedded in the wizard\r\n    if (step === 'inspection') {\r\n        return (\r\n            <div className=\"h-[600px]\">\r\n                <InspectionEditor \r\n                    type=\"Pre\" // Using \"Pre\" template as base for condition report\r\n                    onSave={(report) => { setConditionReport(report); setStep(1); }} \r\n                    onCancel={() => setStep(1)} \r\n                />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border dark:border-gray-700 shadow-xl\">\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n                <h3 className=\"text-xl font-bold dark:text-white\">List Gear for Sale</h3>\r\n                <button onClick={onCancel}><X className=\"text-gray-400\"/></button>\r\n            </div>\r\n\r\n            <div className=\"space-y-5\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Brand</label>\r\n                        <input className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" value={form.brand} onChange={e => setForm({...form, brand: e.target.value})} placeholder=\"e.g. Fender\"/>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Model / Title</label>\r\n                        <input className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white\" value={form.title} onChange={e => setForm({...form, title: e.target.value})} placeholder=\"e.g. Stratocaster\"/>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Category</label>\r\n                        <select className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm\" value={form.category} onChange={e => setForm({...form, category: e.target.value})}>\r\n                            {EQUIP_CATEGORIES.map(c => <option key={c.id} value={c.id}>{c.label}</option>)}\r\n                        </select>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Condition</label>\r\n                        <select className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm\" value={form.condition} onChange={e => setForm({...form, condition: e.target.value})}>\r\n                            {CONDITIONS.map(c => <option key={c} value={c}>{c}</option>)}\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Price ($)</label>\r\n                    <input type=\"number\" className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold\" value={form.price} onChange={e => setForm({...form, price: e.target.value})}/>\r\n                    \r\n                    {/* High Value Warning */}\r\n                    {form.price && parseInt(form.price) >= HIGH_VALUE_THRESHOLD && (\r\n                        <div className=\"mt-3 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800\">\r\n                            <div className=\"flex items-start gap-3\">\r\n                                <Shield className=\"text-orange-500 shrink-0 mt-0.5\" size={20}/>\r\n                                <div>\r\n                                    <h4 className=\"font-bold text-orange-800 dark:text-orange-300 text-sm\">Safe Exchange Required</h4>\r\n                                    <p className=\"text-xs text-orange-700 dark:text-orange-400 mt-1\">\r\n                                        Items priced at ${HIGH_VALUE_THRESHOLD}+ require in-person exchange at a verified safe location (police station, bank, etc.). \r\n                                        Buyers will initiate a Safe Exchange with payment held in escrow until both parties approve.\r\n                                    </p>\r\n                                    <ul className=\"text-xs text-orange-600 dark:text-orange-400 mt-2 space-y-1\">\r\n                                        <li className=\"flex items-center gap-1\"><Info size={10}/> No shipping available for high-value items</li>\r\n                                        <li className=\"flex items-center gap-1\"><Camera size={10}/> You must upload pre-departure photos</li>\r\n                                        <li className=\"flex items-center gap-1\"><MapPin size={10}/> GPS verification at exchange location</li>\r\n                                    </ul>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Accept Offers Toggle */}\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-100 dark:border-blue-800\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <h4 className=\"font-bold text-blue-800 dark:text-blue-400 text-sm flex items-center gap-2\">\r\n                                <MessageCircle size={16} />\r\n                                Accept Offers\r\n                            </h4>\r\n                            <p className=\"text-xs text-blue-600 dark:text-blue-300 mt-1\">\r\n                                Allow buyers to negotiate on price\r\n                            </p>\r\n                        </div>\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => setForm({...form, acceptsOffers: !form.acceptsOffers})}\r\n                            className=\"p-1\"\r\n                        >\r\n                            {form.acceptsOffers ? (\r\n                                <ToggleRight size={32} className=\"text-blue-600\" />\r\n                            ) : (\r\n                                <ToggleLeft size={32} className=\"text-gray-400\" />\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n                    \r\n                    {form.acceptsOffers && form.price && (\r\n                        <div className=\"mt-3 pt-3 border-t border-blue-200 dark:border-blue-800\">\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">\r\n                                Minimum Acceptable Offer (Optional)\r\n                            </label>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <input\r\n                                    type=\"number\"\r\n                                    placeholder={`e.g., ${Math.round(parseInt(form.price) * 0.8)}`}\r\n                                    value={form.minimumOffer}\r\n                                    onChange={e => setForm({...form, minimumOffer: e.target.value})}\r\n                                    className=\"flex-1 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm\"\r\n                                />\r\n                                <span className=\"text-sm text-gray-500\">\r\n                                    {form.minimumOffer && form.price ? `(${Math.round((parseInt(form.minimumOffer) / parseInt(form.price)) * 100)}%)` : ''}\r\n                                </span>\r\n                            </div>\r\n                            <p className=\"text-[10px] text-gray-500 mt-1\">\r\n                                Offers below this will be flagged as \"Low Offer\" to buyers\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Weight & Dimensions for Shipping */}\r\n                <div className=\"grid grid-cols-4 gap-2\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Weight (lb)</label>\r\n                        <input type=\"number\" className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm\" placeholder=\"lbs\" value={form.weight} onChange={e=>setForm({...form, weight: e.target.value})} />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">L (in)</label>\r\n                        <input type=\"number\" className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm\" placeholder=\"Len\" value={form.length} onChange={e=>setForm({...form, length: e.target.value})} />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">W (in)</label>\r\n                        <input type=\"number\" className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm\" placeholder=\"Wid\" value={form.width} onChange={e=>setForm({...form, width: e.target.value})} />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">H (in)</label>\r\n                        <input type=\"number\" className=\"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm\" placeholder=\"Hgt\" value={form.height} onChange={e=>setForm({...form, height: e.target.value})} />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Condition Report Integration */}\r\n                <div className=\"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800 flex justify-between items-center\">\r\n                    <div>\r\n                        <div className=\"font-bold text-orange-800 dark:text-orange-400 text-sm mb-1\">Tech Inspection Report</div>\r\n                        <div className=\"text-xs text-orange-600 dark:text-orange-300\">\r\n                            {conditionReport \r\n                                ? <span className=\"flex items-center gap-1\"><CheckCircle size={12}/> Report Attached ({conditionReport.markers.length} points)</span> \r\n                                : \"Mark scratches, dents, or issues on a diagram to build trust.\"}\r\n                        </div>\r\n                    </div>\r\n                    <button \r\n                        onClick={() => setStep('inspection')} \r\n                        className={`text-xs font-bold px-3 py-2 rounded-lg border transition ${conditionReport ? 'bg-white text-green-600 border-green-200' : 'bg-orange-100 text-orange-700 border-orange-200 hover:bg-orange-200'}`}\r\n                    >\r\n                        {conditionReport ? \"Edit Report\" : \"Create Report\"}\r\n                    </button>\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-2 block\">Photos</label>\r\n                    <div className=\"flex gap-2\">\r\n                        {images.map((img, i) => (\r\n                            <img key={i} src={img} className=\"w-16 h-16 rounded-lg object-cover border dark:border-gray-600\"/>\r\n                        ))}\r\n                        <label className=\"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800\">\r\n                            {uploading ? <Loader2 className=\"animate-spin text-gray-400\"/> : <Plus className=\"text-gray-400\"/>}\r\n                            <input type=\"file\" className=\"hidden\" onChange={handleImageUpload} disabled={uploading}/>\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex gap-3 pt-4\">\r\n                    <button onClick={onCancel} className=\"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition\">Cancel</button>\r\n                    <button onClick={handleSubmit} disabled={submitting || uploading} className=\"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg flex items-center justify-center gap-2\">\r\n                        {submitting ? <Loader2 className=\"animate-spin\"/> : \"Post Listing\"}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// --- SUB-COMPONENT: DETAIL MODAL ---\r\nfunction ListingDetailModal({ item, onClose, currentUser, currentUserData, onSafeExchangePurchase, onStandardPurchase }) {\r\n    const [viewReport, setViewReport] = useState(false);\r\n    const [isPurchasing, setIsPurchasing] = useState(false);\r\n    const [showOfferForm, setShowOfferForm] = useState(false);\r\n    const [showCheckout, setShowCheckout] = useState(false);\r\n    const [offerAmount, setOfferAmount] = useState('');\r\n    const [offerMessage, setOfferMessage] = useState('');\r\n    const [submittingOffer, setSubmittingOffer] = useState(false);\r\n    const [existingOffers, setExistingOffers] = useState([]);\r\n    const [loadingOffers, setLoadingOffers] = useState(true);\r\n    \r\n    // Checkout form state\r\n    const [checkoutStep, setCheckoutStep] = useState(1); // 1: method, 2: details, 3: confirm\r\n    const [fulfillmentMethod, setFulfillmentMethod] = useState('shipping');\r\n    const [shippingForm, setShippingForm] = useState({\r\n        street: currentUserData?.address?.street || '',\r\n        city: currentUserData?.city || '',\r\n        state: currentUserData?.state || '',\r\n        zip: currentUserData?.zip || '',\r\n        phone: currentUserData?.phone || '',\r\n        notes: ''\r\n    });\r\n\r\n    const highValue = isHighValueItem(item.price);\r\n\r\n    // Fetch existing offers for this listing\r\n    useEffect(() => {\r\n        if (!item.id || !currentUser?.uid) {\r\n            setLoadingOffers(false);\r\n            return;\r\n        }\r\n\r\n        if (!supabase) return;\r\n        const userId = currentUser?.id || currentUser?.uid;\r\n        \r\n        const channel = supabase\r\n            .channel(`gear-offers-${item.id}`)\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'gear_offers',\r\n                filter: `listing_id=eq.${item.id}`\r\n            }, () => {\r\n                loadOffers();\r\n            })\r\n            .subscribe();\r\n\r\n        loadOffers();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n        \r\n        async function loadOffers() {\r\n            if (!supabase) return;\r\n            const userId = currentUser?.id || currentUser?.uid;\r\n            setLoadingOffers(true);\r\n            try {\r\n                const { data: offersData, error } = await supabase\r\n                    .from('gear_offers')\r\n                    .select('*')\r\n                    .eq('listing_id', item.id)\r\n                    .eq('buyer_id', userId)\r\n                    .order('created_at', { ascending: false });\r\n                \r\n                if (error) throw error;\r\n                \r\n                const offers = (offersData || []).map(o => ({\r\n                    id: o.id,\r\n                    ...o,\r\n                    listingId: o.listing_id,\r\n                    buyerId: o.buyer_id,\r\n                    sellerId: o.seller_id,\r\n                    itemTitle: o.item_title,\r\n                    itemBrand: o.item_brand,\r\n                    askingPrice: o.asking_price,\r\n                    offerAmount: o.offer_amount,\r\n                    buyerName: o.buyer_name,\r\n                    buyerPhoto: o.buyer_photo,\r\n                    sellerName: o.seller_name,\r\n                    createdAt: o.created_at ? new Date(o.created_at) : new Date(),\r\n                    expiresAt: o.expires_at\r\n                }));\r\n                setExistingOffers(offers);\r\n            } catch (error) {\r\n                console.error('Error fetching offers:', error);\r\n            }\r\n            setLoadingOffers(false);\r\n        }\r\n    }, [item.id, currentUser?.uid]);\r\n\r\n    const handlePurchase = async () => {\r\n        if (highValue) {\r\n            setIsPurchasing(true);\r\n            await onSafeExchangePurchase(item);\r\n            setIsPurchasing(false);\r\n        } else {\r\n            // Open checkout flow for standard purchase\r\n            setShowCheckout(true);\r\n            setCheckoutStep(1);\r\n        }\r\n    };\r\n\r\n    const handleCheckoutComplete = async () => {\r\n        setIsPurchasing(true);\r\n        \r\n        const shippingDetails = {\r\n            method: fulfillmentMethod,\r\n            address: fulfillmentMethod === 'shipping' ? {\r\n                street: shippingForm.street,\r\n                city: shippingForm.city,\r\n                state: shippingForm.state,\r\n                zip: shippingForm.zip\r\n            } : null,\r\n            phone: shippingForm.phone,\r\n            notes: shippingForm.notes\r\n        };\r\n        \r\n        const success = await onStandardPurchase(item, shippingDetails);\r\n        \r\n        if (success) {\r\n            setShowCheckout(false);\r\n            onClose();\r\n        }\r\n        \r\n        setIsPurchasing(false);\r\n    };\r\n\r\n    const validateShippingForm = () => {\r\n        if (fulfillmentMethod === 'shipping') {\r\n            return shippingForm.street && shippingForm.city && shippingForm.state && shippingForm.zip;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    const handleSubmitOffer = async () => {\r\n        if (!offerAmount || parseFloat(offerAmount) <= 0) {\r\n            toast.error('Please enter a valid offer amount');\r\n            return;\r\n        }\r\n\r\n        const offer = parseFloat(offerAmount);\r\n        if (offer >= item.price) {\r\n            toast.error('Offer must be less than the asking price');\r\n            return;\r\n        }\r\n\r\n        setSubmittingOffer(true);\r\n        const toastId = toast.loading('Submitting offer...');\r\n\r\n        if (!supabase) return;\r\n        const userId = currentUser?.id || currentUser?.uid;\r\n        \r\n        try {\r\n            // Create offer document\r\n            const { data: offerData, error: offerError } = await supabase\r\n                .from('gear_offers')\r\n                .insert({\r\n                    listing_id: item.id,\r\n                    item_title: item.title,\r\n                    item_brand: item.brand,\r\n                    asking_price: item.price,\r\n                    offer_amount: offer,\r\n                    message: offerMessage || null,\r\n                    buyer_id: userId,\r\n                    buyer_name: `${currentUserData.firstName} ${currentUserData.lastName}`,\r\n                    buyer_photo: currentUserData.photoURL || null,\r\n                    seller_id: item.sellerId,\r\n                    seller_name: item.sellerName,\r\n                    status: 'pending',\r\n                    created_at: new Date().toISOString(),\r\n                    expires_at: new Date(Date.now() + 48 * 60 * 60 * 1000).toISOString()\r\n                })\r\n                .select()\r\n                .single();\r\n            \r\n            if (offerError) throw offerError;\r\n\r\n            // Send notification to seller\r\n            await supabase\r\n                .from('notifications')\r\n                .insert({\r\n                    user_id: item.sellerId,\r\n                    type: 'gear_offer',\r\n                    offer_id: offerData.id,\r\n                    listing_id: item.id,\r\n                    message: `${currentUserData.firstName} made an offer of $${offer} on your ${item.title}`,\r\n                    buyer_name: `${currentUserData.firstName} ${currentUserData.lastName}`,\r\n                    item_title: item.title,\r\n                    offer_amount: offer,\r\n                    asking_price: item.price,\r\n                    read: false,\r\n                    created_at: new Date().toISOString()\r\n                });\r\n\r\n            toast.success('Offer submitted!', { id: toastId });\r\n            setShowOfferForm(false);\r\n            setOfferAmount('');\r\n            setOfferMessage('');\r\n        } catch (error) {\r\n            console.error('Failed to submit offer:', error);\r\n            toast.error('Failed to submit offer', { id: toastId });\r\n        }\r\n\r\n        setSubmittingOffer(false);\r\n    };\r\n\r\n    // Calculate offer percentage\r\n    const getOfferPercentage = (offer) => {\r\n        return Math.round((offer / item.price) * 100);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] w-full max-w-4xl h-[90vh] rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden border dark:border-gray-700\">\r\n                \r\n                {/* Left: Gallery & Visuals */}\r\n                <div className=\"md:w-1/2 bg-black relative flex flex-col\">\r\n                    <div className=\"flex-1 flex items-center justify-center p-4 relative\">\r\n                        {/* Toggle between Photo and Diagram if Report Exists */}\r\n                        {viewReport && item.conditionReport ? (\r\n                            <div className=\"w-full h-full bg-white rounded-xl overflow-hidden\">\r\n                                <InspectionSvg \r\n                                    type={item.conditionReport.gearType} \r\n                                    view=\"front\" \r\n                                    markers={item.conditionReport.markers} \r\n                                    onClick={() => {}} // Read-only\r\n                                />\r\n                                <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/80 text-white px-3 py-1 rounded-full text-xs\">\r\n                                    Inspection View\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            item.images?.[0] ? <img src={item.images[0]} className=\"max-h-full max-w-full object-contain\"/> : <Camera size={48} className=\"text-gray-600\"/>\r\n                        )}\r\n                        \r\n                        <button onClick={onClose} className=\"absolute top-4 left-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70\"><X size={20}/></button>\r\n                        \r\n                        {/* High Value Badge */}\r\n                        {highValue && (\r\n                            <div className=\"absolute top-4 right-4 bg-orange-500 text-white px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1.5 shadow-lg\">\r\n                                <Shield size={14}/> Safe Exchange Required\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                    \r\n                    {/* Visual Toggle Bar */}\r\n                    {item.conditionReport && (\r\n                        <div className=\"p-4 bg-[#1f2128] border-t border-gray-800 flex gap-2 justify-center\">\r\n                            <button onClick={() => setViewReport(false)} className={`px-4 py-2 rounded text-xs font-bold ${!viewReport ? 'bg-orange-600 text-white' : 'bg-gray-800 text-gray-400'}`}>Photos</button>\r\n                            <button onClick={() => setViewReport(true)} className={`px-4 py-2 rounded text-xs font-bold flex items-center gap-1 ${viewReport ? 'bg-orange-600 text-white' : 'bg-gray-800 text-gray-400'}`}>\r\n                                <AlertTriangle size={12}/> Condition Map\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Right: Info */}\r\n                <div className=\"md:w-1/2 p-8 overflow-y-auto bg-white dark:bg-[#2c2e36]\">\r\n                    <div className=\"mb-6\">\r\n                        <div className=\"text-sm font-bold text-gray-400 uppercase tracking-wider mb-1\">{item.brand}</div>\r\n                        <h2 className=\"text-3xl font-extrabold dark:text-white mb-2\">{item.title}</h2>\r\n                        <div className=\"flex items-center gap-3 flex-wrap\">\r\n                            <span className=\"text-xl font-bold text-green-600\">${item.price}</span>\r\n                            <span className=\"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-1 rounded text-xs font-bold\">{item.condition}</span>\r\n                            {item.acceptsOffers && (\r\n                                <span className=\"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-1 rounded text-xs font-bold flex items-center gap-1\">\r\n                                    <MessageCircle size={12}/> Open to Offers\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-6\">\r\n                        {/* High Value Notice */}\r\n                        {highValue && (\r\n                            <div className=\"bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800\">\r\n                                <div className=\"flex items-start gap-3\">\r\n                                    <div className=\"p-2 bg-orange-500 rounded-lg\">\r\n                                        <Shield className=\"text-white\" size={20}/>\r\n                                    </div>\r\n                                    <div>\r\n                                        <h4 className=\"font-bold text-orange-800 dark:text-orange-300 mb-1\">Safe Exchange Protection</h4>\r\n                                        <p className=\"text-sm text-orange-700 dark:text-orange-400 mb-3\">\r\n                                            High-value items (${HIGH_VALUE_THRESHOLD}+) require in-person exchange at a verified safe location.\r\n                                        </p>\r\n                                        <ul className=\"text-xs text-orange-600 dark:text-orange-400 space-y-1\">\r\n                                            <li className=\"flex items-center gap-1\"><Lock size={12}/> Payment held in escrow until exchange</li>\r\n                                            <li className=\"flex items-center gap-1\"><MapPin size={12}/> Meet at police station or safe zone</li>\r\n                                            <li className=\"flex items-center gap-1\"><Camera size={12}/> Photo verification required</li>\r\n                                            <li className=\"flex items-center gap-1\"><CheckCircle size={12}/> Both parties must approve</li>\r\n                                        </ul>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Seller Info with Rating */}\r\n                        <div className=\"p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border dark:border-gray-700\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                {item.sellerPhoto ? (\r\n                                    <img src={item.sellerPhoto} className=\"w-12 h-12 rounded-full bg-gray-300 object-cover\"/>\r\n                                ) : (\r\n                                    <div className=\"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-lg\">\r\n                                        {item.sellerName?.[0]}\r\n                                    </div>\r\n                                )}\r\n                                <div className=\"flex-1\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <span className=\"font-bold dark:text-white\">{item.sellerName}</span>\r\n                                        {item.sellerVerified && (\r\n                                            <BadgeCheck size={16} className=\"text-blue-500\" />\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-3 mt-1\">\r\n                                        <SellerRating \r\n                                            rating={item.sellerRating} \r\n                                            reviewCount={item.sellerSalesCount} \r\n                                            size=\"md\"\r\n                                        />\r\n                                        {item.sellerResponseTime && (\r\n                                            <span className=\"text-xs text-gray-500 flex items-center gap-1\">\r\n                                                <Clock size={12} />\r\n                                                Responds in {item.sellerResponseTime}\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* My Offers Section */}\r\n                        {existingOffers.length > 0 && (\r\n                            <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800\">\r\n                                <h4 className=\"font-bold text-blue-800 dark:text-blue-300 text-sm mb-3 flex items-center gap-2\">\r\n                                    <MessageCircle size={16} />\r\n                                    Your Offers\r\n                                </h4>\r\n                                <div className=\"space-y-2\">\r\n                                    {existingOffers.map(offer => (\r\n                                        <div \r\n                                            key={offer.id}\r\n                                            className=\"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg\"\r\n                                        >\r\n                                            <div>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <span className=\"font-bold dark:text-white\">${offer.offerAmount}</span>\r\n                                                    <span className=\"text-xs text-gray-500\">\r\n                                                        ({getOfferPercentage(offer.offerAmount)}% of asking)\r\n                                                    </span>\r\n                                                </div>\r\n                                                <div className=\"text-xs text-gray-500 mt-0.5\">\r\n                                                    {offer.createdAt.toLocaleDateString()}\r\n                                                </div>\r\n                                            </div>\r\n                                            <OfferStatusBadge status={offer.status} />\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Fulfillment Method */}\r\n                        <div className={`p-3 rounded-xl border ${highValue \r\n                            ? 'bg-orange-50 dark:bg-orange-900/10 border-orange-200 dark:border-orange-800' \r\n                            : 'bg-green-50 dark:bg-green-900/10 border-green-200 dark:border-green-800'}`}\r\n                        >\r\n                            <div className=\"flex items-center gap-2\">\r\n                                {highValue ? (\r\n                                    <>\r\n                                        <MapPin className=\"text-orange-600\" size={18}/>\r\n                                        <span className=\"font-bold text-orange-700 dark:text-orange-400\">Local Pickup Only</span>\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <Truck className=\"text-green-600\" size={18}/>\r\n                                        <span className=\"font-bold text-green-700 dark:text-green-400\">Shipping Available</span>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                                {highValue \r\n                                    ? 'You will coordinate a meetup at a verified safe exchange zone'\r\n                                    : item.location || 'Contact seller for shipping details'}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Condition Notes */}\r\n                        {item.conditionReport?.notes && (\r\n                            <div className=\"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800/50\">\r\n                                <h4 className=\"font-bold text-orange-800 dark:text-orange-400 text-sm mb-2 flex items-center gap-2\">\r\n                                    <Wrench size={16}/> Tech Notes\r\n                                </h4>\r\n                                <p className=\"text-sm text-orange-900 dark:text-orange-200 italic\">\"{item.conditionReport.notes}\"</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300\">\r\n                            <h4 className=\"font-bold dark:text-white text-sm uppercase\">Description</h4>\r\n                            <p>{item.description || \"No description provided.\"}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Make Offer Form */}\r\n                    {showOfferForm && (\r\n                        <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800\">\r\n                            <h4 className=\"font-bold text-blue-800 dark:text-blue-300 text-sm mb-3 flex items-center gap-2\">\r\n                                <MessageCircle size={16} />\r\n                                Make an Offer\r\n                            </h4>\r\n                            <div className=\"space-y-3\">\r\n                                <div>\r\n                                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Your Offer ($)</label>\r\n                                    <div className=\"relative\">\r\n                                        <DollarSign className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={16} />\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={offerAmount}\r\n                                            onChange={e => setOfferAmount(e.target.value)}\r\n                                            placeholder={`Asking: $${item.price}`}\r\n                                            className=\"w-full pl-9 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                        />\r\n                                    </div>\r\n                                    {offerAmount && (\r\n                                        <div className=\"text-xs text-gray-500 mt-1\">\r\n                                            {getOfferPercentage(parseFloat(offerAmount))}% of asking price\r\n                                            {parseFloat(offerAmount) < item.price * 0.7 && (\r\n                                                <span className=\"text-amber-600 ml-1\">(Low offer)</span>\r\n                                            )}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Message (Optional)</label>\r\n                                    <textarea\r\n                                        value={offerMessage}\r\n                                        onChange={e => setOfferMessage(e.target.value)}\r\n                                        placeholder=\"Add a message to the seller...\"\r\n                                        rows={2}\r\n                                        className=\"w-full p-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm resize-none\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"flex gap-2\">\r\n                                    <button\r\n                                        onClick={() => setShowOfferForm(false)}\r\n                                        className=\"flex-1 py-2 text-gray-600 dark:text-gray-400 font-medium hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleSubmitOffer}\r\n                                        disabled={submittingOffer || !offerAmount}\r\n                                        className=\"flex-1 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                                    >\r\n                                        {submittingOffer ? (\r\n                                            <Loader2 className=\"animate-spin\" size={16} />\r\n                                        ) : (\r\n                                            <>\r\n                                                <Send size={16} /> Submit Offer\r\n                                            </>\r\n                                        )}\r\n                                    </button>\r\n                                </div>\r\n                                <p className=\"text-[10px] text-gray-500 flex items-center gap-1\">\r\n                                    <Clock size={10} />\r\n                                    Offers expire after 48 hours if not responded to\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Checkout Flow */}\r\n                    <AnimatePresence>\r\n                        {showCheckout && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0, y: 20 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                exit={{ opacity: 0, y: -20 }}\r\n                                className=\"mt-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-5 rounded-xl border border-green-200 dark:border-green-800\"\r\n                            >\r\n                                <div className=\"flex items-center justify-between mb-4\">\r\n                                    <h4 className=\"font-bold text-green-800 dark:text-green-300 flex items-center gap-2\">\r\n                                        <ShoppingCart size={18} />\r\n                                        Checkout\r\n                                    </h4>\r\n                                    <button \r\n                                        onClick={() => setShowCheckout(false)}\r\n                                        className=\"text-gray-400 hover:text-gray-600\"\r\n                                    >\r\n                                        <X size={18} />\r\n                                    </button>\r\n                                </div>\r\n\r\n                                {/* Step Indicator */}\r\n                                <div className=\"flex items-center gap-2 mb-6\">\r\n                                    {[1, 2, 3].map((step) => (\r\n                                        <React.Fragment key={step}>\r\n                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all ${\r\n                                                checkoutStep >= step \r\n                                                    ? 'bg-green-500 text-white' \r\n                                                    : 'bg-gray-200 dark:bg-gray-700 text-gray-500'\r\n                                            }`}>\r\n                                                {checkoutStep > step ? <CheckCircle size={16} /> : step}\r\n                                            </div>\r\n                                            {step < 3 && (\r\n                                                <div className={`flex-1 h-1 rounded ${\r\n                                                    checkoutStep > step ? 'bg-green-500' : 'bg-gray-200 dark:bg-gray-700'\r\n                                                }`} />\r\n                                            )}\r\n                                        </React.Fragment>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                {/* Step 1: Fulfillment Method */}\r\n                                {checkoutStep === 1 && (\r\n                                    <div className=\"space-y-4\">\r\n                                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">How would you like to receive this item?</p>\r\n                                        \r\n                                        <div className=\"grid grid-cols-2 gap-3\">\r\n                                            <button\r\n                                                onClick={() => setFulfillmentMethod('shipping')}\r\n                                                className={`p-4 rounded-xl border-2 transition-all ${\r\n                                                    fulfillmentMethod === 'shipping'\r\n                                                        ? 'border-green-500 bg-green-50 dark:bg-green-900/20'\r\n                                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\r\n                                                }`}\r\n                                            >\r\n                                                <Truck size={24} className={fulfillmentMethod === 'shipping' ? 'text-green-600 mx-auto mb-2' : 'text-gray-400 mx-auto mb-2'} />\r\n                                                <div className=\"font-bold text-sm dark:text-white\">Ship to Me</div>\r\n                                                <div className=\"text-xs text-gray-500\">Delivered to your door</div>\r\n                                            </button>\r\n                                            \r\n                                            <button\r\n                                                onClick={() => setFulfillmentMethod('pickup')}\r\n                                                className={`p-4 rounded-xl border-2 transition-all ${\r\n                                                    fulfillmentMethod === 'pickup'\r\n                                                        ? 'border-green-500 bg-green-50 dark:bg-green-900/20'\r\n                                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\r\n                                                }`}\r\n                                            >\r\n                                                <Home size={24} className={fulfillmentMethod === 'pickup' ? 'text-green-600 mx-auto mb-2' : 'text-gray-400 mx-auto mb-2'} />\r\n                                                <div className=\"font-bold text-sm dark:text-white\">Local Pickup</div>\r\n                                                <div className=\"text-xs text-gray-500\">Meet the seller</div>\r\n                                            </button>\r\n                                        </div>\r\n\r\n                                        <button\r\n                                            onClick={() => setCheckoutStep(2)}\r\n                                            className=\"w-full py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition flex items-center justify-center gap-2\"\r\n                                        >\r\n                                            Continue <ArrowRight size={16} />\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Step 2: Shipping Details */}\r\n                                {checkoutStep === 2 && (\r\n                                    <div className=\"space-y-4\">\r\n                                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                            {fulfillmentMethod === 'shipping' ? 'Enter your shipping address' : 'Add your contact details'}\r\n                                        </p>\r\n                                        \r\n                                        {fulfillmentMethod === 'shipping' && (\r\n                                            <>\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    placeholder=\"Street Address\"\r\n                                                    value={shippingForm.street}\r\n                                                    onChange={e => setShippingForm({...shippingForm, street: e.target.value})}\r\n                                                    className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                                />\r\n                                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        placeholder=\"City\"\r\n                                                        value={shippingForm.city}\r\n                                                        onChange={e => setShippingForm({...shippingForm, city: e.target.value})}\r\n                                                        className=\"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                                    />\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        placeholder=\"State\"\r\n                                                        value={shippingForm.state}\r\n                                                        onChange={e => setShippingForm({...shippingForm, state: e.target.value})}\r\n                                                        className=\"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                                    />\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        placeholder=\"ZIP\"\r\n                                                        value={shippingForm.zip}\r\n                                                        onChange={e => setShippingForm({...shippingForm, zip: e.target.value})}\r\n                                                        className=\"p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                                    />\r\n                                                </div>\r\n                                            </>\r\n                                        )}\r\n                                        \r\n                                        <input\r\n                                            type=\"tel\"\r\n                                            placeholder=\"Phone Number\"\r\n                                            value={shippingForm.phone}\r\n                                            onChange={e => setShippingForm({...shippingForm, phone: e.target.value})}\r\n                                            className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                        />\r\n                                        \r\n                                        <textarea\r\n                                            placeholder=\"Notes for seller (optional)\"\r\n                                            value={shippingForm.notes}\r\n                                            onChange={e => setShippingForm({...shippingForm, notes: e.target.value})}\r\n                                            rows={2}\r\n                                            className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white resize-none\"\r\n                                        />\r\n\r\n                                        <div className=\"flex gap-2\">\r\n                                            <button\r\n                                                onClick={() => setCheckoutStep(1)}\r\n                                                className=\"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\r\n                                            >\r\n                                                Back\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => setCheckoutStep(3)}\r\n                                                disabled={!validateShippingForm()}\r\n                                                className=\"flex-1 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                                            >\r\n                                                Review Order <ArrowRight size={16} />\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Step 3: Confirm */}\r\n                                {checkoutStep === 3 && (() => {\r\n                                    const fees = calculateFees(item.price);\r\n                                    return (\r\n                                    <div className=\"space-y-4\">\r\n                                        <div className=\"bg-white dark:bg-gray-800 p-4 rounded-xl border dark:border-gray-700\">\r\n                                            <h5 className=\"font-bold text-sm dark:text-white mb-3\">Order Summary</h5>\r\n                                            \r\n                                            <div className=\"flex items-center gap-3 pb-3 border-b dark:border-gray-700\">\r\n                                                {item.images?.[0] && (\r\n                                                    <img src={item.images[0]} className=\"w-16 h-16 rounded-lg object-cover\" />\r\n                                                )}\r\n                                                <div className=\"flex-1\">\r\n                                                    <div className=\"font-bold dark:text-white\">{item.title}</div>\r\n                                                    <div className=\"text-xs text-gray-500\">{item.brand} ‚Ä¢ {item.condition}</div>\r\n                                                </div>\r\n                                            </div>\r\n                                            \r\n                                            <div className=\"pt-3 space-y-2 text-sm\">\r\n                                                <div className=\"flex justify-between\">\r\n                                                    <span className=\"text-gray-500\">Item Price</span>\r\n                                                    <span className=\"dark:text-white\">${fees.itemPrice.toFixed(2)}</span>\r\n                                                </div>\r\n                                                <div className=\"flex justify-between\">\r\n                                                    <span className=\"text-gray-500 flex items-center gap-1\">\r\n                                                        Service Fee \r\n                                                        <span className=\"text-[10px] text-gray-400\">(1% buyer fee)</span>\r\n                                                    </span>\r\n                                                    <span className=\"dark:text-white\">${fees.serviceFee.toFixed(2)}</span>\r\n                                                </div>\r\n                                                <div className=\"flex justify-between\">\r\n                                                    <span className=\"text-gray-500\">Fulfillment</span>\r\n                                                    <span className=\"dark:text-white capitalize\">{fulfillmentMethod}</span>\r\n                                                </div>\r\n                                                {fulfillmentMethod === 'shipping' && (\r\n                                                    <div className=\"flex justify-between\">\r\n                                                        <span className=\"text-gray-500\">Ship to</span>\r\n                                                        <span className=\"dark:text-white text-right text-xs\">\r\n                                                            {shippingForm.city}, {shippingForm.state} {shippingForm.zip}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                )}\r\n                                                <div className=\"flex justify-between pt-2 border-t dark:border-gray-700 font-bold\">\r\n                                                    <span className=\"dark:text-white\">Total</span>\r\n                                                    <span className=\"text-green-600\">${fees.buyerTotal.toFixed(2)}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2\">\r\n                                            <Shield size={14} className=\"shrink-0 mt-0.5\" />\r\n                                            <span>Your purchase is protected by SeshNx Buyer Protection. If there&apos;s an issue with your order, we&apos;ve got your back.</span>\r\n                                        </div>\r\n\r\n                                        <div className=\"flex gap-2\">\r\n                                            <button\r\n                                                onClick={() => setCheckoutStep(2)}\r\n                                                className=\"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\r\n                                            >\r\n                                                Back\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={handleCheckoutComplete}\r\n                                                disabled={isPurchasing}\r\n                                                className=\"flex-1 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-xl hover:from-green-700 hover:to-emerald-700 transition flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                                            >\r\n                                                {isPurchasing ? (\r\n                                                    <Loader2 className=\"animate-spin\" size={18} />\r\n                                                ) : (\r\n                                                    <>\r\n                                                        <CreditCard size={18} /> Place Order\r\n                                                    </>\r\n                                                )}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                    );\r\n                                })()}\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n\r\n                    {/* Purchase Buttons (hidden when checkout is open) */}\r\n                    {!showCheckout && (\r\n                        <div className=\"mt-8 pt-6 border-t dark:border-gray-700\">\r\n                            {item.sellerId === currentUser.uid ? (\r\n                                <button className=\"w-full bg-gray-100 dark:bg-gray-700 text-gray-500 font-bold py-3 rounded-xl cursor-not-allowed\">You own this listing</button>\r\n                            ) : (\r\n                                <div className=\"space-y-3\">\r\n                                    <button \r\n                                        onClick={handlePurchase}\r\n                                        disabled={isPurchasing}\r\n                                        className={`w-full font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed ${\r\n                                            highValue \r\n                                                ? 'bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white' \r\n                                                : 'bg-orange-600 hover:bg-orange-700 text-white'\r\n                                        }`}\r\n                                    >\r\n                                        {isPurchasing ? (\r\n                                            <Loader2 className=\"animate-spin\" size={20}/>\r\n                                        ) : highValue ? (\r\n                                            <>\r\n                                                <Shield size={20}/> Initiate Safe Exchange\r\n                                            </>\r\n                                        ) : (\r\n                                            <>\r\n                                                <ShoppingCart size={20}/> Buy Now - ${item.price}\r\n                                            </>\r\n                                        )}\r\n                                    </button>\r\n                                    \r\n                                    {/* Make Offer Button */}\r\n                                    {!showOfferForm && item.acceptsOffers !== false && (\r\n                                        <button\r\n                                            onClick={() => setShowOfferForm(true)}\r\n                                            className=\"w-full py-3 border-2 border-blue-500 text-blue-600 dark:text-blue-400 font-bold rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 transition flex items-center justify-center gap-2\"\r\n                                        >\r\n                                            <MessageCircle size={18} />\r\n                                            Make an Offer\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                            <p className=\"text-center text-[10px] text-gray-400 mt-3 flex items-center justify-center gap-1\">\r\n                                {highValue ? (\r\n                                    <>\r\n                                        <Lock size={10}/> Funds held in escrow ‚Ä¢ GPS verified exchange ‚Ä¢ Dual approval release\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <CheckCircle size={10}/> Purchases covered by SeshNx Buyer Protection\r\n                                    </>\r\n                                )}\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// --- SUB-COMPONENT: ORDERS VIEW ---\r\nfunction OrdersView({ orders, user, userData, onBack, onUpdateStatus, openChat }) {\r\n    const [selectedOrder, setSelectedOrder] = useState(null);\r\n    const [showShippingModal, setShowShippingModal] = useState(false);\r\n    const [trackingNumber, setTrackingNumber] = useState('');\r\n    const [trackingCarrier, setTrackingCarrier] = useState('usps');\r\n    const [activeTab, setActiveTab] = useState('all'); // 'all', 'buying', 'selling'\r\n\r\n    const carriers = [\r\n        { id: 'usps', label: 'USPS' },\r\n        { id: 'ups', label: 'UPS' },\r\n        { id: 'fedex', label: 'FedEx' },\r\n        { id: 'dhl', label: 'DHL' },\r\n        { id: 'other', label: 'Other' },\r\n    ];\r\n\r\n    const filteredOrders = orders.filter(order => {\r\n        if (activeTab === 'buying') return order.role === 'buyer';\r\n        if (activeTab === 'selling') return order.role === 'seller';\r\n        return true;\r\n    });\r\n\r\n    const handleMarkShipped = async () => {\r\n        if (!trackingNumber) {\r\n            toast.error('Please enter a tracking number');\r\n            return;\r\n        }\r\n        await onUpdateStatus(selectedOrder.id, ORDER_STATUS.SHIPPED, {\r\n            trackingNumber,\r\n            carrier: trackingCarrier\r\n        });\r\n        setShowShippingModal(false);\r\n        setTrackingNumber('');\r\n        setSelectedOrder(null);\r\n    };\r\n\r\n    const handleConfirmDelivery = async (order) => {\r\n        await onUpdateStatus(order.id, ORDER_STATUS.COMPLETED);\r\n    };\r\n\r\n    const getStatusIcon = (status) => {\r\n        const config = ORDER_STATUS_CONFIG[status];\r\n        if (config) {\r\n            const IconComponent = config.icon;\r\n            return <IconComponent size={16} />;\r\n        }\r\n        return <Clock size={16} />;\r\n    };\r\n\r\n    return (\r\n        <div className=\"animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button \r\n                        onClick={onBack}\r\n                        className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition\"\r\n                    >\r\n                        <ChevronRight className=\"rotate-180 text-gray-500\" size={20} />\r\n                    </button>\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-2\">\r\n                            <Receipt className=\"text-orange-500\" /> My Orders\r\n                        </h2>\r\n                        <p className=\"text-gray-500 dark:text-gray-400 text-sm\">\r\n                            Track your purchases and sales\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex gap-2 mb-6\">\r\n                {[\r\n                    { id: 'all', label: 'All Orders' },\r\n                    { id: 'buying', label: 'Buying' },\r\n                    { id: 'selling', label: 'Selling' },\r\n                ].map(tab => (\r\n                    <button\r\n                        key={tab.id}\r\n                        onClick={() => setActiveTab(tab.id)}\r\n                        className={`px-4 py-2 rounded-lg text-sm font-bold transition ${\r\n                            activeTab === tab.id\r\n                                ? 'bg-orange-600 text-white shadow'\r\n                                : 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700'\r\n                        }`}\r\n                    >\r\n                        {tab.label}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Orders List */}\r\n            {filteredOrders.length === 0 ? (\r\n                <div className=\"text-center py-16 bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700\">\r\n                    <BoxIcon size={48} className=\"mx-auto text-gray-300 dark:text-gray-600 mb-4\" />\r\n                    <h3 className=\"text-lg font-bold dark:text-white mb-2\">No orders yet</h3>\r\n                    <p className=\"text-gray-500 dark:text-gray-400 mb-4\">\r\n                        {activeTab === 'buying' \r\n                            ? \"You haven't purchased anything yet\" \r\n                            : activeTab === 'selling'\r\n                            ? \"You haven't received any orders yet\"\r\n                            : \"Start shopping or selling to see your orders here\"}\r\n                    </p>\r\n                    <button\r\n                        onClick={onBack}\r\n                        className=\"px-6 py-2 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700 transition\"\r\n                    >\r\n                        Browse Gear\r\n                    </button>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-4\">\r\n                    {filteredOrders.map(order => {\r\n                        const statusConfig = ORDER_STATUS_CONFIG[order.status] || ORDER_STATUS_CONFIG[ORDER_STATUS.PENDING];\r\n                        const isSeller = order.role === 'seller';\r\n                        const isBuyer = order.role === 'buyer';\r\n                        \r\n                        return (\r\n                            <motion.div\r\n                                key={order.id}\r\n                                initial={{ opacity: 0, y: 10 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition\"\r\n                            >\r\n                                <div className=\"p-5\">\r\n                                    <div className=\"flex items-start gap-4\">\r\n                                        {/* Item Image */}\r\n                                        <div className=\"w-20 h-20 rounded-lg bg-gray-100 dark:bg-gray-800 overflow-hidden shrink-0\">\r\n                                            {order.itemPhotos?.[0] ? (\r\n                                                <img src={order.itemPhotos[0]} className=\"w-full h-full object-cover\" />\r\n                                            ) : (\r\n                                                <div className=\"w-full h-full flex items-center justify-center\">\r\n                                                    <Package className=\"text-gray-400\" size={24} />\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                        \r\n                                        {/* Order Info */}\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <div className=\"flex items-start justify-between gap-3\">\r\n                                                <div>\r\n                                                    <h4 className=\"font-bold dark:text-white truncate\">{order.itemTitle}</h4>\r\n                                                    <p className=\"text-sm text-gray-500\">{order.itemBrand}</p>\r\n                                                </div>\r\n                                                <span className={`px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1.5 ${statusConfig.color}`}>\r\n                                                    {getStatusIcon(order.status)}\r\n                                                    {statusConfig.label}\r\n                                                </span>\r\n                                            </div>\r\n                                            \r\n                                            <div className=\"flex items-center gap-4 mt-3 text-sm flex-wrap\">\r\n                                                {isBuyer ? (\r\n                                                    <span className=\"font-bold text-green-600\">\r\n                                                        ${order.buyerTotal?.toFixed(2) || order.price}\r\n                                                        {order.serviceFee && (\r\n                                                            <span className=\"text-[10px] text-gray-400 font-normal ml-1\">\r\n                                                                (incl. ${order.serviceFee?.toFixed(2)} fee)\r\n                                                            </span>\r\n                                                        )}\r\n                                                    </span>\r\n                                                ) : (\r\n                                                    <span className=\"font-bold text-green-600\">\r\n                                                        ${order.sellerPayout?.toFixed(2) || order.price}\r\n                                                        {order.serviceFee && (\r\n                                                            <span className=\"text-[10px] text-gray-400 font-normal ml-1\">\r\n                                                                (after ${order.serviceFee?.toFixed(2)} fee)\r\n                                                            </span>\r\n                                                        )}\r\n                                                    </span>\r\n                                                )}\r\n                                                <span className={`px-2 py-0.5 rounded text-xs font-bold ${\r\n                                                    isBuyer \r\n                                                        ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' \r\n                                                        : 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'\r\n                                                }`}>\r\n                                                    {isBuyer ? 'Purchasing' : 'Selling'}\r\n                                                </span>\r\n                                                <span className=\"text-gray-400 text-xs\">\r\n                                                    {order.createdAt?.toDate?.().toLocaleDateString() || 'Recently'}\r\n                                                </span>\r\n                                            </div>\r\n                                            \r\n                                            {/* Fulfillment Info */}\r\n                                            <div className=\"flex items-center gap-2 mt-2 text-xs text-gray-500\">\r\n                                                {order.fulfillmentMethod === 'shipping' ? (\r\n                                                    <>\r\n                                                        <Truck size={12} />\r\n                                                        <span>Shipping to {order.shippingAddress?.city}, {order.shippingAddress?.state}</span>\r\n                                                    </>\r\n                                                ) : (\r\n                                                    <>\r\n                                                        <Home size={12} />\r\n                                                        <span>Local Pickup</span>\r\n                                                    </>\r\n                                                )}\r\n                                            </div>\r\n                                            \r\n                                            {/* Tracking Info */}\r\n                                            {order.trackingNumber && (\r\n                                                <div className=\"mt-2 p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-xs\">\r\n                                                    <span className=\"text-purple-700 dark:text-purple-400 font-bold\">\r\n                                                        Tracking: {order.trackingCarrier?.toUpperCase()} - {order.trackingNumber}\r\n                                                    </span>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                    \r\n                                    {/* Action Buttons */}\r\n                                    <div className=\"flex gap-2 mt-4 pt-4 border-t dark:border-gray-700\">\r\n                                        {/* Seller Actions */}\r\n                                        {isSeller && order.status === ORDER_STATUS.PENDING && (\r\n                                            <button\r\n                                                onClick={() => onUpdateStatus(order.id, ORDER_STATUS.CONFIRMED)}\r\n                                                className=\"flex-1 py-2 bg-blue-600 text-white text-sm font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2\"\r\n                                            >\r\n                                                <CheckCircle size={16} /> Confirm Order\r\n                                            </button>\r\n                                        )}\r\n                                        \r\n                                        {isSeller && order.status === ORDER_STATUS.CONFIRMED && order.fulfillmentMethod === 'shipping' && (\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    setSelectedOrder(order);\r\n                                                    setShowShippingModal(true);\r\n                                                }}\r\n                                                className=\"flex-1 py-2 bg-purple-600 text-white text-sm font-bold rounded-lg hover:bg-purple-700 transition flex items-center justify-center gap-2\"\r\n                                            >\r\n                                                <Truck size={16} /> Mark as Shipped\r\n                                            </button>\r\n                                        )}\r\n                                        \r\n                                        {isSeller && order.status === ORDER_STATUS.CONFIRMED && order.fulfillmentMethod === 'pickup' && (\r\n                                            <button\r\n                                                onClick={() => onUpdateStatus(order.id, ORDER_STATUS.COMPLETED)}\r\n                                                className=\"flex-1 py-2 bg-green-600 text-white text-sm font-bold rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2\"\r\n                                            >\r\n                                                <CheckCircle size={16} /> Mark as Picked Up\r\n                                            </button>\r\n                                        )}\r\n                                        \r\n                                        {/* Buyer Actions */}\r\n                                        {isBuyer && (order.status === ORDER_STATUS.SHIPPED || order.status === ORDER_STATUS.DELIVERED) && (\r\n                                            <button\r\n                                                onClick={() => handleConfirmDelivery(order)}\r\n                                                className=\"flex-1 py-2 bg-green-600 text-white text-sm font-bold rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2\"\r\n                                            >\r\n                                                <CheckCircle size={16} /> Confirm Receipt\r\n                                            </button>\r\n                                        )}\r\n                                        \r\n                                        {/* Contact Button */}\r\n                                        <button\r\n                                            onClick={() => openChat?.(isBuyer ? order.sellerId : order.buyerId)}\r\n                                            className=\"px-4 py-2 border border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 text-sm font-bold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition flex items-center gap-2\"\r\n                                        >\r\n                                            <MessageCircle size={16} /> \r\n                                            Contact {isBuyer ? 'Seller' : 'Buyer'}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </motion.div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            )}\r\n\r\n            {/* Shipping Modal */}\r\n            <AnimatePresence>\r\n                {showShippingModal && selectedOrder && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4\"\r\n                        onClick={() => setShowShippingModal(false)}\r\n                    >\r\n                        <motion.div\r\n                            initial={{ scale: 0.9, y: 20 }}\r\n                            animate={{ scale: 1, y: 0 }}\r\n                            exit={{ scale: 0.9, y: 20 }}\r\n                            onClick={e => e.stopPropagation()}\r\n                            className=\"bg-white dark:bg-[#2c2e36] rounded-2xl p-6 w-full max-w-md shadow-2xl\"\r\n                        >\r\n                            <h3 className=\"text-xl font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                                <Truck className=\"text-purple-600\" /> Add Shipping Info\r\n                            </h3>\r\n                            \r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Carrier</label>\r\n                                    <select\r\n                                        value={trackingCarrier}\r\n                                        onChange={e => setTrackingCarrier(e.target.value)}\r\n                                        className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    >\r\n                                        {carriers.map(c => (\r\n                                            <option key={c.id} value={c.id}>{c.label}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                                \r\n                                <div>\r\n                                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Tracking Number</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={trackingNumber}\r\n                                        onChange={e => setTrackingNumber(e.target.value)}\r\n                                        placeholder=\"Enter tracking number\"\r\n                                        className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    />\r\n                                </div>\r\n                                \r\n                                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300\">\r\n                                    <Info size={12} className=\"inline mr-1\" />\r\n                                    The buyer will be notified with the tracking information\r\n                                </div>\r\n                                \r\n                                <div className=\"flex gap-2\">\r\n                                    <button\r\n                                        onClick={() => setShowShippingModal(false)}\r\n                                        className=\"flex-1 py-3 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleMarkShipped}\r\n                                        className=\"flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition flex items-center justify-center gap-2\"\r\n                                    >\r\n                                        <Truck size={16} /> Confirm Shipment\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </motion.div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Search, Disc, Sliders, Download, CheckCircle, Zap, Plus, X, Upload, Loader2, Music, Flag } from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport { useMediaUpload } from '../../hooks/useMediaUpload';\r\nimport StarFieldVisualizer from '../shared/StarFieldVisualizer';\r\nimport ReportModal from '../ReportModal'; \r\n\r\nexport default function SeshFxStore({ user, userData, tokenBalance, refreshWallet }) { \r\n  const [items, setItems] = useState([]);\r\n  const [filter, setFilter] = useState('All');\r\n  const [search, setSearch] = useState('');\r\n  const [ownedItemIds, setOwnedItemIds] = useState(new Set());\r\n  \r\n  // UI State\r\n  const [showSellModal, setShowSellModal] = useState(false);\r\n  const [selectedItem, setSelectedItem] = useState(null); \r\n  const [reportTarget, setReportTarget] = useState(null); \r\n  \r\n  // 1. Fetch Market Items\r\n  useEffect(() => {\r\n      if (!user?.id && !user?.uid || !supabase) return;\r\n      const userId = user.id || user.uid;\r\n      \r\n      // Initial fetch\r\n      supabase\r\n          .from('market_items')\r\n          .select('*')\r\n          .order('created_at', { ascending: false })\r\n          .then(({ data, error }) => {\r\n              if (error) {\r\n                  console.error('Error fetching market items:', error);\r\n                  return;\r\n              }\r\n              setItems((data || []).map(item => ({\r\n                  id: item.id,\r\n                  ...item,\r\n                  timestamp: item.created_at\r\n              })));\r\n          });\r\n\r\n      // Subscribe to realtime changes\r\n      const channel = supabase\r\n          .channel('market-items')\r\n          .on(\r\n              'postgres_changes',\r\n              {\r\n                  event: '*',\r\n                  schema: 'public',\r\n                  table: 'market_items'\r\n              },\r\n              async () => {\r\n                  const { data } = await supabase\r\n                      .from('market_items')\r\n                      .select('*')\r\n                      .order('created_at', { ascending: false });\r\n                  \r\n                  if (data) {\r\n                      setItems(data.map(item => ({\r\n                          id: item.id,\r\n                          ...item,\r\n                          timestamp: item.created_at\r\n                      })));\r\n                  }\r\n              }\r\n          )\r\n          .subscribe();\r\n\r\n      return () => {\r\n          supabase.removeChannel(channel);\r\n      };\r\n  }, [user?.id, user?.uid]);\r\n\r\n  // 2. Fetch Owned Items\r\n  useEffect(() => {\r\n      if (!user?.id && !user?.uid || !supabase) return;\r\n      const userId = user.id || user.uid;\r\n      \r\n      // Initial fetch\r\n      supabase\r\n          .from('user_library')\r\n          .select('item_id')\r\n          .eq('user_id', userId)\r\n          .then(({ data, error }) => {\r\n              if (error) {\r\n                  console.error('Error fetching owned items:', error);\r\n                  return;\r\n              }\r\n              setOwnedItemIds(new Set((data || []).map(item => item.item_id)));\r\n          });\r\n\r\n      // Subscribe to realtime changes\r\n      const channel = supabase\r\n          .channel(`user-library-${userId}`)\r\n          .on(\r\n              'postgres_changes',\r\n              {\r\n                  event: '*',\r\n                  schema: 'public',\r\n                  table: 'user_library',\r\n                  filter: `user_id=eq.${userId}`\r\n              },\r\n              async () => {\r\n                  const { data } = await supabase\r\n                      .from('user_library')\r\n                      .select('item_id')\r\n                      .eq('user_id', userId);\r\n                  \r\n                  if (data) {\r\n                      setOwnedItemIds(new Set(data.map(item => item.item_id)));\r\n                  }\r\n              }\r\n          )\r\n          .subscribe();\r\n\r\n      return () => {\r\n          supabase.removeChannel(channel);\r\n      };\r\n  }, [user?.id, user?.uid]);\r\n\r\n  const handlePurchase = async (item) => {\r\n      if (tokenBalance < item.price) {\r\n          alert(\"Insufficient tokens! Please top up.\");\r\n          return;\r\n      }\r\n      \r\n      if(!window.confirm(`Purchase ${item.title} for ${item.price} Tokens?`)) return;\r\n      \r\n      if (!supabase) {\r\n          alert(\"Transaction failed. Database unavailable.\");\r\n          return;\r\n      }\r\n\r\n      const userId = user?.id || user?.uid;\r\n      \r\n      try {\r\n          // Update wallet balance\r\n          const { data: wallet, error: walletError } = await supabase\r\n              .from('wallets')\r\n              .select('balance')\r\n              .eq('user_id', userId)\r\n              .single();\r\n          \r\n          if (walletError) throw walletError;\r\n          \r\n          await supabase\r\n              .from('wallets')\r\n              .update({ balance: (wallet.balance || 0) - item.price })\r\n              .eq('user_id', userId);\r\n          \r\n          // Add to user library\r\n          await supabase\r\n              .from('user_library')\r\n              .insert({\r\n                  user_id: userId,\r\n                  item_id: item.id,\r\n                  title: item.title,\r\n                  type: item.type,\r\n                  price_paid: item.price,\r\n                  purchase_date: new Date().toISOString(),\r\n                  download_url: item.download_url || item.downloadUrl\r\n              });\r\n          \r\n          if(refreshWallet) refreshWallet();\r\n          alert(\"Purchased successfully!\");\r\n      } catch(e) { \r\n          console.error(e); \r\n          alert(\"Transaction failed.\"); \r\n      }\r\n  };\r\n\r\n  const filteredItems = items.filter(i => \r\n      (filter === 'All' || i.type === filter) && \r\n      i.title.toLowerCase().includes(search.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <div className=\"pb-32\">\r\n      {/* Filters Bar */}\r\n      <div className=\"flex flex-col md:flex-row gap-4 mb-6\">\r\n          <div className=\"flex gap-2 overflow-x-auto pb-2 md:pb-0 scrollbar-hide\">\r\n              {['All', 'Presets', 'Samples', 'Beats'].map(f => (\r\n                  <button key={f} onClick={() => setFilter(f)} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-all ${filter === f ? 'bg-brand-blue text-white' : 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300'}`}>\r\n                      {f}\r\n                  </button>\r\n              ))}\r\n          </div>\r\n          <div className=\"ml-auto flex gap-2 w-full md:w-auto\">\r\n              <div className=\"relative flex-1 md:w-64\">\r\n                  <Search className=\"absolute left-3 top-2.5 text-gray-400\" size={16}/>\r\n                  <input \r\n                    className=\"w-full pl-9 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card text-sm dark:text-white focus:outline-none\"\r\n                    placeholder=\"Search...\"\r\n                    value={search}\r\n                    onChange={e => setSearch(e.target.value)}\r\n                  />\r\n              </div>\r\n              <button onClick={() => setShowSellModal(true)} className=\"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-green-700\">\r\n                  <Upload size={16} /> Upload\r\n              </button>\r\n          </div>\r\n      </div>\r\n\r\n      {/* Grid */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n          {filteredItems.map(item => {\r\n              const isOwned = ownedItemIds.has(item.id);\r\n              return (\r\n                <div key={item.id} className=\"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition flex flex-col group\">\r\n                    <div className=\"aspect-square relative bg-gray-100 dark:bg-gray-800 flex items-center justify-center cursor-pointer\" onClick={() => setSelectedItem(item)}>\r\n                        {item.type === 'Presets' ? <Sliders size={40} className=\"text-gray-400\"/> : <Disc size={40} className=\"text-gray-400\"/>}\r\n                        {isOwned && <div className=\"absolute top-2 right-2 bg-green-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded flex items-center gap-1\"><CheckCircle size={8}/> OWNED</div>}\r\n                    </div>\r\n                    \r\n                    <div className=\"p-3 flex flex-col flex-1\">\r\n                        <div className=\"text-[10px] font-bold text-brand-blue uppercase mb-1\">{item.type}</div>\r\n                        <h4 className=\"font-bold text-sm dark:text-white truncate mb-1\" title={item.title}>{item.title}</h4>\r\n                        <div className=\"flex items-center justify-between mt-auto\">\r\n                            <span className=\"text-xs font-bold text-yellow-600 dark:text-yellow-400 flex items-center gap-1\">\r\n                                <Zap size={10} fill=\"currentColor\"/> {item.price}\r\n                            </span>\r\n                            {!isOwned && (\r\n                                <button onClick={() => handlePurchase(item)} className=\"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1 rounded text-[10px] font-bold hover:opacity-80\">\r\n                                    Buy\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n              );\r\n          })}\r\n      </div>\r\n\r\n      \r\n      {/* Modals */}\r\n      {showSellModal && <SellItemModal user={user} userData={userData} onClose={() => setShowSellModal(false)} />}\r\n      {selectedItem && (\r\n          <ItemDetailModal \r\n            item={selectedItem} \r\n            isOwned={ownedItemIds.has(selectedItem.id)} \r\n            user={user} \r\n            onClose={() => setSelectedItem(null)} \r\n            onBuy={() => handlePurchase(selectedItem)} \r\n            onDownload={() => handleDownload(selectedItem)}\r\n            onReport={() => setReportTarget({\r\n                id: selectedItem.id,\r\n                type: 'market_item',\r\n                summary: selectedItem.title\r\n            })}\r\n          />\r\n      )}\r\n      \r\n      {/* Report Modal */}\r\n      {reportTarget && (\r\n          <ReportModal \r\n              user={user} \r\n              target={reportTarget} \r\n              onClose={() => setReportTarget(null)} \r\n          />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* --- CREATOR STUDIO MODAL --- */\r\nfunction SellItemModal({ user, userData, onClose }) {\r\n    const [form, setForm] = useState({ title: '', price: '', type: 'Presets', tags: '', description: '' });\r\n    const [audioFile, setAudioFile] = useState(null);\r\n    const [status, setStatus] = useState('');\r\n    const { uploadMedia, uploading } = useMediaUpload(); // Destructure uploading\r\n\r\n    const handleSubmit = async () => {\r\n        if(!form.title || !form.price || !audioFile || !supabase) return alert(\"Title, Price, and Audio File are required.\");\r\n        \r\n        const userId = user?.id || user?.uid;\r\n        \r\n        try {\r\n            setStatus('Uploading Audio Asset...');\r\n            // Single file upload serves as both preview and product for now\r\n            // Note: uploadMedia may need to be updated to work with Supabase Storage\r\n            const downloadUrl = await uploadMedia(audioFile, `market-assets/${userId}`);\r\n\r\n            setStatus('Listing Item...');\r\n            await supabase\r\n                .from('market_items')\r\n                .insert({\r\n                    title: form.title,\r\n                    price: parseInt(form.price),\r\n                    type: form.type,\r\n                    tags: form.tags.split(',').map(t => t.trim()).filter(t => t),\r\n                    description: form.description || null,\r\n                    author: `${userData?.firstName || ''} ${userData?.lastName || ''}`.trim(),\r\n                    author_id: userId,\r\n                    download_url: downloadUrl, // This URL acts as both source and download\r\n                    created_at: new Date().toISOString()\r\n                });\r\n            \r\n            setStatus('Success!');\r\n            setTimeout(onClose, 1000);\r\n        } catch(e) { \r\n            console.error(e); \r\n            setStatus('Error listing item.');\r\n            alert(\"Failed to submit item to market. Check console.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl border dark:border-gray-700\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <div><h2 className=\"text-2xl font-bold dark:text-white\">Creator Studio</h2><p className=\"text-gray-500 text-sm\">List a new sound for sale</p></div>\r\n                    <button onClick={onClose}><X/></button>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div className=\"space-y-4\">\r\n                        <div><label className=\"text-xs font-bold text-gray-500 uppercase\">Title</label><input className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={form.title} onChange={e=>setForm({...form, title:e.target.value})} placeholder=\"e.g. Midnight Lofi\" /></div>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div><label className=\"text-xs font-bold text-gray-500 uppercase\">Type</label><select className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={form.type} onChange={e=>setForm({...form, type:e.target.value})}><option>Presets</option><option>Samples</option><option>Beats</option></select></div>\r\n                            <div><label className=\"text-xs font-bold text-gray-500 uppercase\">Price (TK)</label><input type=\"number\" className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={form.price} onChange={e=>setForm({...form, price:e.target.value})} /></div>\r\n                        </div>\r\n                        <div><label className=\"text-xs font-bold text-gray-500 uppercase\">Description</label><textarea className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" rows=\"3\" value={form.description} onChange={e=>setForm({...form, description:e.target.value})} /></div>\r\n                        <div><label className=\"text-xs font-bold text-gray-500 uppercase\">Tags (Comma Separated)</label><input className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={form.tags} onChange={e=>setForm({...form, tags:e.target.value})} placeholder=\"lofi, hiphop, boom-bap\" /></div>\r\n                    </div>\r\n                    \r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"border-2 border-dashed dark:border-gray-600 rounded-xl p-6 text-center hover:bg-gray-50 dark:hover:bg-gray-800 transition relative bg-blue-50/50 dark:bg-blue-900/10 h-full flex flex-col justify-center items-center\">\r\n                            <input type=\"file\" className=\"absolute inset-0 opacity-0 cursor-pointer\" accept=\"audio/*\" onChange={e=>setAudioFile(e.target.files[0])} />\r\n                            <Music size={48} className=\"mx-auto text-blue-500 mb-2\"/>\r\n                            <div className=\"text-lg font-bold text-blue-600 dark:text-blue-400\">{audioFile ? audioFile.name : \"Upload Audio File (Product Asset)\"}</div>\r\n                            <div className=\"text-xs text-gray-500 mt-2\">MP3/WAV (Max 50MB)</div>\r\n                            {audioFile && <div className=\"mt-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded\">Selected</div>}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"mt-8\">\r\n                    <button \r\n                        onClick={handleSubmit} \r\n                        disabled={uploading || !form.title || !form.price || !audioFile} \r\n                        className=\"w-full bg-brand-blue text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                    >\r\n                        {uploading ? <><Loader2 className=\"animate-spin\"/> {status}</> : \"List Item for Sale\"}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/* --- ITEM DETAIL PREVIEW MODAL --- */\r\nfunction ItemDetailModal({ item, isOwned, onClose, onBuy, onDownload, onReport }) {\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center z-[60] p-4\">\r\n            <div className=\"bg-white dark:bg-dark-card rounded-2xl overflow-hidden w-full max-w-4xl shadow-2xl flex flex-col md:flex-row h-[80vh] md:h-[600px]\">\r\n                {/* Left: Visuals */}\r\n                <div className=\"md:w-5/12 bg-gray-100 dark:bg-black/40 relative p-8 flex flex-col justify-center items-center text-center\">\r\n                     <div className=\"w-64 h-64 bg-gradient-to-br from-brand-blue to-purple-600 rounded-lg shadow-2xl mb-6 flex items-center justify-center text-white\">\r\n                        {item.type === 'Presets' ? <Sliders size={80}/> : <Disc size={80}/>}\r\n                     </div>\r\n                     <h2 className=\"text-2xl font-bold dark:text-white mb-2\">{item.title}</h2>\r\n                     <div className=\"text-brand-blue font-medium mb-6\">by {item.author}</div>\r\n                     \r\n                     {/* Large Preview Player with TRUNCATION */}\r\n                     {item.downloadUrl && (\r\n                         <div className=\"w-full\">\r\n                             {/* Passes isOwned check to enable/disable truncation logic in visualizer */}\r\n                             <StarFieldVisualizer audioUrl={item.downloadUrl} fileName=\"Preview Track\" previewMode={!isOwned} />\r\n                         </div>\r\n                     )}\r\n                </div>\r\n                \r\n                {/* Right: Info */}\r\n                <div className=\"md:w-7/12 p-8 overflow-y-auto flex flex-col\">\r\n                    <div className=\"flex justify-between items-start mb-6\">\r\n                        <div>\r\n                            <span className=\"bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded uppercase tracking-wide\">{item.type}</span>\r\n                            <h1 className=\"text-3xl font-extrabold dark:text-white mt-2\">{item.title}</h1>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                            <button \r\n                                onClick={onReport} \r\n                                className=\"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-gray-400 hover:text-red-500 rounded-full transition\"\r\n                                title=\"Report Violation\"\r\n                            >\r\n                                <Flag size={20}/>\r\n                            </button>\r\n                            <button onClick={onClose} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full\"><X size={20}/></button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300 mb-8\">\r\n                        <p>{item.description || \"No description provided by the creator.\"}</p>\r\n                        {!isOwned && <div className=\"mt-4 bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded text-yellow-800 dark:text-yellow-200 text-xs flex items-center gap-2\"><Info size={14}/> Audio preview is truncated to 15 seconds. Purchase to unlock full track.</div>}\r\n                    </div>\r\n\r\n                    <div className=\"mt-auto\">\r\n                        {isOwned ? (\r\n                            <button onClick={onDownload} className=\"w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-transform hover:scale-[1.02]\">\r\n                                <Download size={24}/> Download Now\r\n                            </button>\r\n                        ) : (\r\n                            <button onClick={onBuy} className=\"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 shadow-lg transition-transform hover:scale-[1.02]\">\r\n                                <span>Buy for</span>\r\n                                <span className=\"bg-yellow-400 text-black px-2 py-0.5 rounded text-sm flex items-center gap-1\"><Zap size={12} fill=\"black\"/> {item.price}</span>\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport GearExchange from './marketplace/GearExchange';\r\nimport SeshFxStore from './marketplace/SeshFxStore'; // Sample Pack Store\r\n\r\nexport default function Marketplace({ user, userData, tokenBalance }) {\r\n    const [searchParams, setSearchParams] = useSearchParams();\r\n    const initialTab = searchParams.get('tab') || 'gear';\r\n    const [subTab, setSubTab] = useState(initialTab);\r\n\r\n    // Update tab when URL params change\r\n    useEffect(() => {\r\n        const tabParam = searchParams.get('tab');\r\n        if (tabParam && (tabParam === 'gear' || tabParam === 'fx')) {\r\n            setSubTab(tabParam);\r\n        }\r\n    }, [searchParams]);\r\n\r\n    // Update URL when tab changes\r\n    const handleTabChange = (tab) => {\r\n        setSubTab(tab);\r\n        if (tab === 'gear') {\r\n            setSearchParams({});\r\n        } else {\r\n            setSearchParams({ tab });\r\n        }\r\n    };\r\n\r\n    const tabs = [\r\n        { id: 'gear', label: 'Gear Exchange' },\r\n        { id: 'fx', label: 'SeshFX Store' },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <h1 className=\"text-2xl font-bold dark:text-white\">Marketplace</h1>\r\n                <div className=\"bg-white dark:bg-gray-800 p-1 rounded-lg border dark:border-gray-700 flex gap-1\">\r\n                    {tabs.map(tab => (\r\n                        <button\r\n                            key={tab.id}\r\n                            onClick={() => handleTabChange(tab.id)}\r\n                            className={`px-4 py-2 text-sm font-bold rounded-md transition-all ${\r\n                                subTab === tab.id \r\n                                ? 'bg-brand-blue text-white shadow-md' \r\n                                : 'text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                            }`}\r\n                        >\r\n                            {tab.label}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"tab-content-wrapper\">\r\n                {subTab === 'gear' && (\r\n                    <div key=\"gear\" className=\"tab-content\">\r\n                        <GearExchange user={user} userData={userData} />\r\n                    </div>\r\n                )}\r\n                {subTab === 'fx' && (\r\n                    <div key=\"fx\" className=\"tab-content\">\r\n                        <SeshFxStore user={user} tokenBalance={tokenBalance} />\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":["DIAGRAM_TYPES","InspectionSvg","type","view","onClick","markers","renderMarkers","m","i","jsxs","jsx","commonProps","e","rect","x","y","paths","GenericBox","content","_a","InspectionEditor","initialData","onSave","onCancel","gearType","setGearType","useState","setView","setMarkers","notes","setNotes","photos","setPhotos","activeMarker","setActiveMarker","markerLabel","setMarkerLabel","uploadMedia","uploading","useMediaUpload","handleDiagramClick","newMarker","saveMarkerLabel","handlePhotoUpload","file","res","prev","AlertCircle","X","t","v","mk","Upload","p","_","idx","Save","calculateDistance","lat1","lon1","lat2","lon2","œÜ1","œÜ2","ŒîœÜ","ŒîŒª","a","useSafeZoneVerification","transactionId","userId","currentPosition","setCurrentPosition","locationError","setLocationError","isInSafeZone","setIsInSafeZone","nearestSafeZone","setNearestSafeZone","safeZones","setSafeZones","otherPartyPosition","setOtherPartyPosition","proximityToOther","setProximityToOther","isWithinProximity","setIsWithinProximity","loading","setLoading","watchId","setWatchId","lastPositionUpdate","useRef","useEffect","startWatching","useCallback","options","handleSuccess","position","latitude","longitude","accuracy","handleError","error","message","id","stopWatching","nearest","nearestDistance","inZone","zone","distance","SAFE_ZONE_RADIUS_METERS","PROXIMITY_THRESHOLD_METERS","updateOtherPartyPosition","findNearbySafeZones","types","results","response","data","place","zoneType","SAFE_ZONE_TYPES","z","b","createSafeZone","zoneData","verifyArrival","verifyProximity","PhotoVerification","mode","role","listingPhotos","sellerDeparturePhotos","itemDescription","onPhotosSubmitted","onVerificationComplete","requiredPhotoCount","activePhotoIndex","setActivePhotoIndex","comparisonMode","setComparisonMode","comparisonIndex","setComparisonIndex","verificationResult","setVerificationResult","showCamera","setShowCamera","isSubmitting","setIsSubmitting","videoRef","canvasRef","streamRef","startCamera","stream","stopCamera","track","capturePhoto","video","canvas","blob","result","handleFileUpload","removePhoto","index","handleSubmitPhotos","handleVerificationSubmit","renderCaptureMode","Fragment","Camera","ChevronLeft","ChevronRight","photo","CheckCircle","Check","renderCompareMode","HelpCircle","XCircle","SafeExchangeTransaction","user","userData","onClose","onComplete","onMessage","transaction","setTransaction","actionLoading","setActionLoading","selectedSafeZone","setSelectedSafeZone","meetupDate","setMeetupDate","meetupTime","setMeetupTime","showZonePicker","setShowZonePicker","nearbyZones","setNearbyZones","photoMode","setPhotoMode","isSeller","isBuyer","zones","updateStatus","newStatus","additionalData","scheduleMeetup","SAFE_EXCHANGE_STATUS","handleSellerDepart","handleSellerPhotosSubmitted","handleBuyerDepart","handleBuyerInspectionComplete","handleApprove","approvalKey","completeTransaction","handleCancel","handleDispute","reason","getCurrentStepIndex","Loader2","Shield","DollarSign","Package","_b","step","currentStep","isComplete","isCurrent","React","SAFE_EXCHANGE_STEPS","Lock","_c","_d","_e","_f","UserAvatar","MapPin","Calendar","Clock","Navigation","AlertTriangle","MessageCircle","CONDITIONS","ORDER_STATUS","ORDER_STATUS_CONFIG","Truck","Receipt","SERVICE_FEE_RATE","calculateFees","itemPrice","price","serviceFee","buyerTotal","sellerPayout","SellerRating","rating","reviewCount","size","s","Star","OfferStatusBadge","status","statusConfig","config","isHighValueItem","HIGH_VALUE_THRESHOLD","GearExchange","setActiveTab","openChat","listings","setListings","filter","setFilter","search","setSearch","selectedItem","setSelectedItem","activeTransaction","setActiveTransaction","userTransactions","setUserTransactions","userOrders","setUserOrders","selectedOrder","setSelectedOrder","supabase","handleSafeExchangePurchase","item","handleStandardPurchase","shippingDetails","handleUpdateOrderStatus","orderId","trackingInfo","pendingOrders","o","filteredListings","l","pendingTransactions","otherUserId","txn","CreditCard","Wrench","Search","BoxIcon","Plus","EQUIP_CATEGORIES","cat","highValue","BadgeCheck","CreateListingForm","OrdersView","ListingDetailModal","onSuccess","setStep","form","setForm","images","setImages","conditionReport","setConditionReport","submitting","setSubmitting","handleImageUpload","handleSubmit","report","c","Info","ToggleRight","ToggleLeft","img","currentUser","currentUserData","onSafeExchangePurchase","onStandardPurchase","viewReport","setViewReport","isPurchasing","setIsPurchasing","showOfferForm","setShowOfferForm","showCheckout","setShowCheckout","offerAmount","setOfferAmount","offerMessage","setOfferMessage","submittingOffer","setSubmittingOffer","existingOffers","setExistingOffers","loadingOffers","setLoadingOffers","checkoutStep","setCheckoutStep","fulfillmentMethod","setFulfillmentMethod","shippingForm","setShippingForm","handlePurchase","handleCheckoutComplete","validateShippingForm","handleSubmitOffer","toast","getOfferPercentage","offer","Send","AnimatePresence","motion","ShoppingCart","Home","ArrowRight","fees","orders","onBack","onUpdateStatus","showShippingModal","setShowShippingModal","trackingNumber","setTrackingNumber","trackingCarrier","setTrackingCarrier","activeTab","carriers","filteredOrders","order","handleMarkShipped","handleConfirmDelivery","getStatusIcon","IconComponent","tab","_g","_h","_i","_j","SeshFxStore","tokenBalance","refreshWallet","items","setItems","ownedItemIds","setOwnedItemIds","showSellModal","setShowSellModal","reportTarget","setReportTarget","filteredItems","f","isOwned","Sliders","Disc","Zap","SellItemModal","ItemDetailModal","ReportModal","audioFile","setAudioFile","setStatus","Music","onBuy","onDownload","onReport","StarFieldVisualizer","Flag","Download","Marketplace","searchParams","setSearchParams","useSearchParams","initialTab","subTab","setSubTab","tabParam","handleTabChange","tabs"],"mappings":"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"}