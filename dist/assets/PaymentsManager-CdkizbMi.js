import{r as u,j as e,c5 as T,ce as C,L as E,cf as P,n as B,a0 as D,a6 as L,cE as M,k as $,ag as R}from"./vendor-Dl7DtIXW.js";import{s as c}from"./chat-BYF7Vx2D.js";import{SUBSCRIPTION_PLAN_KEYS as U}from"./config-DGZTEYpI.js";import"./vendor-stripe-DmTewwA8.js";import"./vendor-framer-CUELlS5e.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new t.Error().stack;r&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[r]="0dcaaa84-4bdc-4489-9cc9-539c41766f14",t._sentryDebugIdIdentifier="sentry-dbid-0dcaaa84-4bdc-4489-9cc9-539c41766f14")})()}catch{}const I=()=>{const[t,r]=u.useState({tierData:null,tokenPackages:null}),[n,y]=u.useState(!0),{DEFAULT_TIER_DATA:s,FALLBACK_TOKEN_PACKAGES:m}=u.useMemo(()=>({DEFAULT_TIER_DATA:{FREE:{name:"Free",price:0,feeMultiplier:1.2,features:["1 Broadcast Request / month","Cannot list on SeshFx Market"],limits:{broadcastsPerMonth:1,sessionsPerWeek:2,canListMarket:!1,monthlyTokens:0}},BASIC:{name:"Basic",price:4.99,feeMultiplier:1.1,features:["3 Broadcast Requests / month","10 Booked Sessions / week","Can list on SeshFx Market (5 items)"],limits:{broadcastsPerMonth:3,sessionsPerWeek:10,canListMarket:!0,monthlyTokens:25}},PRO:{name:"Pro Creative",price:14.99,feeMultiplier:1.02,features:["15 Broadcast Requests / month","Unlimited Booked Sessions","Profile Search Boost"],limits:{broadcastsPerMonth:15,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}},STUDIO:{name:"Studio Business",price:29.99,feeMultiplier:1,features:["Studio Manager Component Access","Unlimited Broadcast Requests","0% Session Fees"],limits:{broadcastsPerMonth:999,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}}},FALLBACK_TOKEN_PACKAGES:[{id:"pack_small",tokens:100,price:4.99,label:"Starter Stash"},{id:"pack_medium",tokens:550,price:19.99,label:"Producer Pack",highlight:!0},{id:"pack_large",tokens:1200,price:39.99,label:"Studio Vault"}]}),[]);u.useEffect(()=>{if(!c){y(!1);return}const x=async()=>{const{data:d,error:l}=await c.from("app_config").select("config_value").eq("config_key","tier_config").single();if(l&&l.code!=="PGRST116"){console.error("Error fetching tier config:",l),r(p=>({...p,tierData:s}));return}const g=(d==null?void 0:d.config_value)||{},k=Object.keys(s).reduce((p,N)=>(p[N]={...s[N],...g[N]||{}},p),{});r(p=>({...p,tierData:k}))},b=async()=>{const{data:d,error:l}=await c.from("app_config").select("config_value").eq("config_key","token_packages").single();if(l&&l.code!=="PGRST116"){console.error("Error fetching token packages:",l),r(k=>({...k,tokenPackages:m}));return}let g=(d==null?void 0:d.config_value)||m;(!Array.isArray(g)||g.length===0)&&(g=m),r(k=>({...k,tokenPackages:g}))};Promise.all([x(),b()]).finally(()=>{y(!1)});const v=c.channel("app_config_tier").on("postgres_changes",{event:"*",schema:"public",table:"app_config",filter:"config_key=eq.tier_config"},()=>x()).subscribe(),j=c.channel("app_config_tokens").on("postgres_changes",{event:"*",schema:"public",table:"app_config",filter:"config_key=eq.token_packages"},()=>b()).subscribe();return()=>{c.removeChannel(v),c.removeChannel(j)}},[s,m]);const h=x=>{var v,j;const b=((v=t.tierData)==null?void 0:v[x])||((j=t.tierData)==null?void 0:j.FREE);return b?b.feeMultiplier:s.FREE.feeMultiplier};return{tierData:t.tierData||s,tokenPackages:t.tokenPackages||m,loading:n,getFeeMultiplier:h}},z=()=>"/api",O=async(t,r)=>{if(t<=0)throw new Error("No funds available to cash out.");if(!r)throw new Error("User not authenticated.");try{const n=await fetch(`${z()}/stripe/initiate-payout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:t,userId:r})});if(!n.ok){const s=await n.json().catch(()=>({message:"Payout failed"}));throw new Error(s.message||"Payout failed")}return await n.json()}catch(n){throw console.error("Payout failed:",n),n}};function H({user:t,userData:r}){var _;const[n,y]=u.useState("store"),[s,m]=u.useState({balance:0,escrowBalance:0,payoutBalance:0}),[h,x]=u.useState(!1),{tierData:b,tokenPackages:v,loading:j}=I(),d=(r==null?void 0:r.currentTier)||U.FREE,l=(_=r==null?void 0:r.accountTypes)==null?void 0:_.some(a=>["Talent","Producer","Engineer","Studio","Composer","Technician","Label","Agent"].includes(a));u.useEffect(()=>{if(!(t!=null&&t.id)&&!(t!=null&&t.uid)||!c)return;const a=(t==null?void 0:t.id)||(t==null?void 0:t.uid),i=async()=>{try{const{data:o,error:f}=await c.from("wallets").select("*").eq("user_id",a).single();if(f&&f.code!=="PGRST116"){console.error("Error loading wallet:",f);return}m(o?{balance:o.balance||0,escrowBalance:o.escrow_balance||0,payoutBalance:o.payout_balance||0}:{balance:0,escrowBalance:0,payoutBalance:0})}catch(o){console.error("Wallet load error:",o)}};i();const w=c.channel(`wallet-${a}`).on("postgres_changes",{event:"*",schema:"public",table:"wallets",filter:`user_id=eq.${a}`},()=>{i()}).subscribe();return()=>{c.removeChannel(w)}},[t==null?void 0:t.id,t==null?void 0:t.uid]);const g=async(a,i="payment")=>{x(!0);try{const o=await fetch("/api/stripe/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:a,mode:i,successUrl:window.location.href,cancelUrl:window.location.href})});if(!o.ok){const F=await o.json().catch(()=>({message:"Checkout failed"}));throw new Error(F.message||"Checkout failed")}const f=await o.json();if(f!=null&&f.url)window.location.assign(f.url);else throw new Error("Failed to create checkout session. Please try again or contact support.")}catch(w){console.error("Checkout Error:",w),alert(`Checkout failed: ${w.message||"Please try again."}`)}finally{x(!1)}},k=a=>{if(!a.stripePriceId)return alert("Configuration Error: This package is missing a Stripe Price ID.");g(a.stripePriceId,"payment")},p=a=>{if(!a.stripePriceId)return alert("Configuration Error: This plan is missing a Stripe Price ID.");g(a.stripePriceId,"subscription")},N=async()=>{if(l){if(s.payoutBalance<=0)return alert("No funds available for cash out.");if(window.confirm(`Cash out $${s.payoutBalance.toFixed(2)} to your connected account?`)){x(!0);try{const a=(t==null?void 0:t.id)||(t==null?void 0:t.uid);await O(s.payoutBalance,a),alert("Cash out initiated! Funds should arrive in your bank account shortly.")}catch(a){alert(a.message)}finally{x(!1)}}}},S=Object.values(b).sort((a,i)=>a.id===d?-1:i.id===d?1:a.price-i.price),A=a=>{const i=(a-1)*100;return i>0?`+${i.toFixed(0)}% Service Fee`:i===0?"0% Service Fee":`-${Math.abs(i).toFixed(0)}% Fee (Discount)`};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 pb-24",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(T,{size:32,className:"text-green-500"})," My Wallet"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage tokens, subscriptions, and earnings."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-500/10 rounded-full",children:e.jsx(C,{fill:"currentColor",className:"text-yellow-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Spending Tokens"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:[s.balance.toLocaleString()," TK"]})]})]}),l&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-full",children:e.jsx(T,{className:"text-green-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Available USD"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:["$",s.payoutBalance.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 border-b dark:border-gray-700 mb-8 overflow-x-auto",children:[e.jsx("button",{onClick:()=>y("store"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${n==="store"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Token Store"}),e.jsx("button",{onClick:()=>y("plans"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${n==="plans"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Membership Plans"}),l&&e.jsx("button",{onClick:()=>y("earnings"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${n==="earnings"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Earnings & Escrow"})]}),n==="store"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-blue to-purple-600 rounded-2xl p-8 text-white shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10 max-w-lg",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Power Up Your Creativity"}),e.jsx("p",{className:"opacity-90 mb-6",children:"Use tokens to buy beats, presets, booking requests, and more on the SeshFx Marketplace."})]}),e.jsx(C,{size:200,className:"absolute -right-10 -bottom-20 text-white opacity-10 rotate-12 pointer-events-none"})]}),j?e.jsx("div",{className:"text-center py-20",children:e.jsx(E,{className:"animate-spin text-brand-blue mx-auto",size:32})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(a=>e.jsxs("div",{className:`relative bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border transition-all duration-200 hover:-translate-y-1 hover:shadow-xl ${a.highlight?"border-yellow-500 ring-2 ring-yellow-500/20":"dark:border-gray-700"}`,children:[a.highlight&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-yellow-500 text-black text-[10px] font-extrabold px-3 py-1 rounded-full tracking-wide shadow-sm",children:"BEST VALUE"}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-widest mb-2",children:a.label}),e.jsxs("div",{className:"text-5xl font-extrabold dark:text-white flex items-center justify-center gap-1",children:[a.tokens,e.jsx("span",{className:"text-lg font-medium text-gray-400",children:"TK"})]})]}),e.jsx("button",{onClick:()=>k(a),disabled:h,className:`w-full py-3 rounded-xl font-bold flex justify-center items-center gap-2 transition-all ${a.highlight?"bg-yellow-500 text-black hover:bg-yellow-400":"bg-gray-900 dark:bg-white text-white dark:text-black hover:opacity-90"}`,children:h?e.jsx(E,{className:"animate-spin",size:18}):`Buy for $${a.price}`})]},a.id))})]}),n==="plans"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"text-center max-w-2xl mx-auto mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold dark:text-white mb-2",children:"Upgrade Your Workflow"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Unlock lower fees, unlimited bookings, and premium visibility."})]}),j?e.jsx("div",{className:"text-center py-10",children:e.jsx(E,{className:"animate-spin text-brand-blue mx-auto",size:24})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:S.map(a=>{const i=a.id===d;return e.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border flex flex-col ${i?"border-brand-blue ring-1 ring-brand-blue":"dark:border-gray-700"} shadow-sm`,children:[i&&e.jsxs("div",{className:"text-xs font-bold text-brand-blue uppercase tracking-wide mb-2 flex items-center gap-1",children:[e.jsx(P,{size:12,fill:"currentColor"})," Current Plan"]}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:a.name}),e.jsxs("div",{className:"text-3xl font-extrabold mb-6 dark:text-white",children:["$",a.price,e.jsx("span",{className:"text-sm font-normal text-gray-500",children:"/mo"})]}),e.jsxs("div",{className:"space-y-3 mb-8 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-gray-700 dark:text-gray-200",children:[e.jsx(T,{size:16,className:a.feeMultiplier<=1?"text-green-500":"text-gray-400"}),A(a.feeMultiplier)]}),a.features.map((w,o)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx(B,{size:14,className:"text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:w})]},o))]}),e.jsx("button",{onClick:()=>p(a),className:`w-full py-2.5 rounded-lg font-bold text-sm transition-colors mt-auto ${i?"bg-gray-100 dark:bg-gray-700 text-gray-400 cursor-default":"bg-brand-blue text-white hover:bg-blue-600 shadow-lg shadow-blue-500/20"}`,disabled:i||h,children:i?"Active":h?e.jsx(E,{className:"animate-spin mx-auto"}):"Upgrade"})]},a.id)})})]}),n==="earnings"&&l&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 rounded-2xl p-6 text-white shadow-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium opacity-90",children:"Total Lifetime Earnings"}),e.jsxs("div",{className:"text-4xl font-extrabold mt-1",children:["$",(s.payoutBalance+s.escrowBalance).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white/20 backdrop-blur px-4 py-2 rounded-xl",children:[e.jsx("div",{className:"text-white/70 text-xs",children:"Pending"}),e.jsxs("div",{className:"font-bold",children:["$",s.escrowBalance.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur px-4 py-2 rounded-xl",children:[e.jsx("div",{className:"text-white/70 text-xs",children:"Available"}),e.jsxs("div",{className:"font-bold",children:["$",s.payoutBalance.toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg",children:e.jsx(D,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Pending in Escrow"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Held for active gigs/sessions"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold dark:text-white mb-4",children:["$",s.escrowBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-4 mt-4 space-y-2",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"How Escrow Works"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Client books you → Funds held in escrow"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Complete the session → Mark as done"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"24 hours later → Released to Available"]})]}),e.jsxs("div",{className:"text-xs bg-orange-50 dark:bg-orange-900/10 text-orange-700 dark:text-orange-300 p-3 rounded-lg flex items-start gap-2 mt-4",children:[e.jsx(L,{size:14,className:"mt-0.5 shrink-0"})," Funds are released 24 hours after session completion."]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border border-green-500/30 shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg",children:e.jsx(T,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Ready to Cash Out"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Cleared funds - transfer anytime"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold text-green-600 dark:text-green-400 mb-2",children:["$",s.payoutBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 mb-4 text-xs",children:[e.jsxs("div",{className:"flex justify-between text-gray-600 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:"Platform Fee (1%)"}),e.jsxs("span",{className:"text-red-500",children:["-$",(s.payoutBalance*.01).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-gray-900 dark:text-white pt-1 border-t dark:border-gray-700",children:[e.jsx("span",{children:"You'll Receive"}),e.jsxs("span",{className:"text-green-600",children:["$",(s.payoutBalance*.99).toFixed(2)]})]})]}),e.jsx("button",{onClick:N,disabled:h||s.payoutBalance<=0,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-green-500/30 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:shadow-none",children:h?e.jsx(E,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:["Cash Out Now ",e.jsx(M,{size:20})]})}),e.jsx("div",{className:"text-[10px] text-center text-gray-400 mt-3",children:"Transfers via Stripe Connect to your bank in 2-3 days."})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-2xl border dark:border-gray-700",children:[e.jsxs("h4",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx($,{size:18,className:"text-brand-blue"})," Earnings Tips"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 text-purple-600 rounded-lg",children:e.jsx(P,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Complete Your Profile"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Add demos & set your rates to get booked faster"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg",children:e.jsx(C,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Check Open Gigs"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Browse broadcasts for immediate opportunities"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg",children:e.jsx(R,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Build Trust"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Great reviews = more bookings & better rates"})]})]})]})]})]})]})}export{H as default};
