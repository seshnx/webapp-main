import{r as D,bY as E,c0 as M,c1 as R,j as e,U,X as L,t as O,T as P,b_ as V,c7 as G,c as H,L as X,x as Y,b$ as g,c3 as Z,c2 as p}from"./vendor-M-mhr7Zm.js";import{s as f}from"./chat-CfZHA2ny.js";import"./vendor-framer-1_AFqeeG.js";const q=R({sessionName:p().min(3,"Session name must be at least 3 chars"),date:p().optional(),time:p().optional(),duration:Z().min(1).max(24)});function W({user:l,userData:a,cart:r,onRemoveFromCart:T,onClose:_,onComplete:$}){const[u,j]=D.useState(!1),{register:d,handleSubmit:I,watch:C,formState:{errors:c,isValid:N}}=E({resolver:M(q),defaultValues:{sessionName:a!=null&&a.lastName?`${a.lastName} Session`:"Session",duration:4,date:"",time:""},mode:"onChange"}),y=C("duration")||0,z=()=>{let s=0;const n=parseInt(y)||0,i=r.map(t=>{const o=t.rate||0,S=o*n;return s+=S,{...t,itemTotal:S,hourlyRate:o}}),m=r.length>=3,b=m?s*.1:0,h=s-b;return{subtotal:s,discountAmount:b,finalTotal:h,lineItems:i,shouldDiscount:m}},{subtotal:F,discountAmount:B,finalTotal:k,lineItems:v,shouldDiscount:w}=z(),A=async s=>{j(!0);const n=g.loading("Initializing Session...");try{let i=null;if(k>0&&f,!f)throw new Error("Supabase not initialized");const m=(l==null?void 0:l.id)||(l==null?void 0:l.uid),b=`session_${Date.now()}`,h=v.map(t=>{var o;return f.from("bookings").insert({group_id:b,session_name:s.sessionName,sender_id:m,sender_name:a&&`${a.firstName||""} ${a.lastName||""}`.trim()||"User",target_id:t.id,target_name:`${t.firstName} ${t.lastName}`,service_type:((o=t.accountTypes)==null?void 0:o[0])||"Session",date:s.date||"Flexible",time:s.time||"Flexible",duration:s.duration,offer_amount:t.itemTotal*(w?.9:1),status:"Pending",payment_intent_id:i,timestamp:new Date().toISOString(),type:"GroupSession"})});await Promise.all(h),g.success("Session Created!",{id:n}),$()}catch(i){console.error("Booking Error:",i),g.error("Failed: "+i.message,{id:n})}finally{j(!1)}},x=s=>O("w-full p-2 border rounded-lg dark:bg-black/20 dark:text-white transition-colors focus:ring-2 focus:ring-brand-blue outline-none",s?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-600");return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-in fade-in",children:e.jsxs("form",{onSubmit:I(A),className:"bg-white dark:bg-[#2c2e36] w-full max-w-2xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] rounded-t-2xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(U,{className:"text-brand-blue"})," Session Builder"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.length," Members Selected"]})]}),e.jsx("button",{type:"button",onClick:_,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(L,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Session Name"}),e.jsx("input",{...d("sessionName"),className:x(c.sessionName),placeholder:"e.g. My Album Recording"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date (Optional)"}),e.jsx("input",{type:"date",...d("date"),className:x(c.date)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time (Optional)"}),e.jsx("input",{type:"time",...d("time"),className:x(c.time)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Duration (Hours)"}),e.jsx("input",{type:"number",...d("duration",{valueAsNumber:!0}),className:x(c.duration)})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-bold dark:text-white mb-3",children:"Session Roster"}),e.jsxs("div",{className:"space-y-2",children:[r.map(s=>{var n;return e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-[#2c2e36] p-2 rounded-lg border dark:border-gray-600 shadow-sm animate-in slide-in-from-right-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold",children:s.firstName[0]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-bold dark:text-white",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(n=s.accountTypes)==null?void 0:n[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-mono",children:["$",s.rate,"/hr"]}),e.jsx("button",{type:"button",onClick:()=>T(s.id),className:"text-red-400 hover:text-red-600 transition-colors",children:e.jsx(P,{size:14})})]})]},s.id)}),r.length===0&&e.jsx("div",{className:"text-center text-xs text-gray-400 py-4 italic",children:"No members added yet."})]})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(V,{size:20})," Cost Breakdown"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-800 transition-all",children:[e.jsx("div",{className:"space-y-2 mb-4 text-sm",children:v.map(s=>e.jsxs("div",{className:"flex justify-between text-blue-900 dark:text-blue-100",children:[e.jsxs("span",{children:[s.firstName," (",s.accountTypes[0],") x ",y,"hrs"]}),e.jsxs("span",{className:"font-mono",children:["$",s.itemTotal.toFixed(2)]})]},s.id))}),e.jsxs("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-blue-800 dark:text-blue-300 font-bold",children:"Subtotal"}),e.jsxs("span",{className:"text-blue-800 dark:text-blue-300 font-bold font-mono",children:["$",F.toFixed(2)]})]}),w&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400 font-bold mt-2 animate-in slide-in-from-right-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{size:14,fill:"currentColor"})," Bundle Discount (10%)"]}),e.jsxs("span",{className:"font-mono",children:["-$",B.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-2xl font-black dark:text-white",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{className:"font-mono",children:["$",k.toFixed(2)]})]})]})]})]}),e.jsx("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] rounded-b-2xl",children:e.jsx("button",{type:"submit",disabled:u||r.length===0||!N,className:H("w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg flex items-center justify-center gap-2",u||r.length===0||!N?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"),children:u?e.jsx(X,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:20})," Confirm & Book"]})})})]})})}export{W as default};
