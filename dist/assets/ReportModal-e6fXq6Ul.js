import{r as s,j as e,Q as Z,a0 as J,a6 as ee,L,s as te,v as re,ao as se,X as ae,Z as T}from"./vendor-Dl7DtIXW.js";import{w as ne}from"./vendor-audio-CY3oQc7h.js";import{s as E}from"./chat-BYF7Vx2D.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},i=new t.Error().stack;i&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[i]="1c09281b-2185-4ad6-a4ed-859cd02b73d5",t._sentryDebugIdIdentifier="sentry-dbid-1c09281b-2185-4ad6-a4ed-859cd02b73d5")})()}catch{}const ie="/assets/Fevicon-TMLO4Pj9.png";function ue({audioUrl:t,fileName:i="Audio Track",previewMode:b=!1}){const f=s.useRef(null),h=s.useRef(null),p=s.useRef(null),y=s.useRef(null),a=s.useRef(null),x=s.useRef(null),g=s.useRef(Math.random().toString(36).substr(2,9)),o=s.useRef(null),l=s.useRef(null),c=s.useRef(null),[v,z]=s.useState(!1),[F,q]=s.useState(!1),[_,H]=s.useState(!1),[A,V]=s.useState(!1),[P,B]=s.useState(document.documentElement.classList.contains("dark")),D=s.useRef(P),j={dark:{star:"rgba(255, 255, 255, 0.5)",special:"#3D84ED",wave:"rgba(255, 255, 255, 0.3)"},light:{star:"rgba(0, 0, 0, 0.5)",special:"#2563EB",wave:"rgba(0, 0, 0, 0.2)"}},W=400,$=120,G=80,d=s.useRef({stars:[],avg:0,width:0,height:0,cx:0,cy:0});s.useEffect(()=>{const r=new MutationObserver(n=>{n.forEach(m=>{if(m.attributeName==="class"){const N=document.documentElement.classList.contains("dark");B(N),D.current=N,a.current&&a.current.setOptions({waveColor:N?j.dark.wave:j.light.wave})}})});return r.observe(document.documentElement,{attributes:!0}),()=>r.disconnect()},[]),s.useEffect(()=>{if(!p.current||!y.current)return;const r=P?j.dark:j.light;a.current=ne.create({container:y.current,waveColor:r.wave,progressColor:"#3D84ED",cursorColor:"#3D84ED",barWidth:4,barGap:3,barRadius:3,height:100,responsive:!0,normalize:!0,backend:"MediaElement",media:p.current,minPxPerSec:50,fillParent:!0,interact:!b,cursorWidth:2,barAlign:"bottom"});const n=m=>{m.detail.id!==g.current&&a.current&&a.current.isPlaying()&&a.current.pause()};return window.addEventListener("seshnx-audio-play",n),a.current.on("ready",()=>q(!0)),a.current.on("play",()=>{z(!0),window.dispatchEvent(new CustomEvent("seshnx-audio-play",{detail:{id:g.current}}))}),a.current.on("pause",()=>z(!1)),a.current.on("finish",()=>{z(!1),cancelAnimationFrame(x.current)}),()=>{window.removeEventListener("seshnx-audio-play",n),a.current&&a.current.destroy(),cancelAnimationFrame(x.current)}},[t,b]),s.useEffect(()=>{const r=()=>{if(f.current&&h.current){const{clientWidth:n,clientHeight:m}=f.current;h.current.width=n,h.current.height=m,d.current.width=n,d.current.height=m,d.current.cx=n/2,d.current.cy=m/2,K()}};return window.addEventListener("resize",r),r(),()=>{window.removeEventListener("resize",r),o.current&&o.current.state!=="closed"&&o.current.close()}},[]);const K=()=>{d.current.stars=[];for(let r=0;r<W;r++)d.current.stars.push({x:Math.random()*d.current.width-d.current.cx,y:Math.random()*d.current.height-d.current.cy,z:Math.random()*d.current.width})},U=()=>{if(!(A||_||!p.current))try{const r=window.AudioContext||window.webkitAudioContext;o.current=new r,l.current=o.current.createAnalyser(),l.current.fftSize=2048,c.current=o.current.createMediaElementSource(p.current),c.current.connect(l.current),l.current.connect(o.current.destination),V(!0)}catch(r){console.warn("Audio Context Error:",r)}},Y=async r=>{var n;r.stopPropagation(),A||U(),((n=o.current)==null?void 0:n.state)==="suspended"&&await o.current.resume(),a.current&&a.current.playPause(),v||C()},C=()=>{if(!h.current)return;const r=h.current.getContext("2d"),{width:n,height:m,cx:N,cy:I,stars:Q}=d.current;let R=0;if(l.current){const u=l.current.frequencyBinCount,w=new Uint8Array(u);l.current.getByteFrequencyData(w);let S=0;for(let k=0;k<w.length;k++)S+=w[k];R=S/w.length}d.current.avg=R,r.clearRect(0,0,n,m);const O=D.current?j.dark:j.light,X=R>G?R/10:R/30+.5;Q.forEach(u=>{u.z-=X,u.z<=0&&(u.z=n,u.x=Math.random()*n-N,u.y=Math.random()*m-I);const w=u.x/u.z*n+N,S=u.y/u.z*m+I,k=(1-u.z/n)*2.5;w>=0&&w<=n&&S>=0&&S<=m&&(r.fillStyle=R>$?O.special:O.star,r.globalAlpha=1-u.z/n,r.beginPath(),r.arc(w,S,k,0,Math.PI*2),r.fill(),r.globalAlpha=1)}),a.current&&a.current.isPlaying()&&(x.current=requestAnimationFrame(C))};return e.jsxs("div",{ref:f,className:"relative w-full h-32 rounded-xl overflow-hidden group bg-transparent transition-colors",children:[e.jsx("canvas",{ref:h,className:"w-full h-full absolute inset-0 z-0 pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 z-20 flex flex-col justify-end pointer-events-none",children:e.jsx("div",{ref:y,className:"w-full pointer-events-auto opacity-80 hover:opacity-100 transition-opacity"})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-3 z-30 flex justify-between items-start pointer-events-none",children:[e.jsxs("div",{className:"flex items-center gap-2 text-black dark:text-white/90",children:[e.jsx(Z,{size:16,className:"text-brand-blue"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[200px] shadow-sm",children:i}),b&&e.jsxs("span",{className:"text-[10px] bg-yellow-500 text-black px-2 rounded font-bold flex items-center gap-1",children:[e.jsx(J,{size:8})," PREVIEW"]})]}),_&&e.jsxs("div",{className:"bg-red-500/80 text-white text-[10px] px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(ee,{size:10})," Visuals Disabled"]})]}),e.jsx("div",{className:"absolute bottom-2 left-2 z-30 opacity-50 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.jsx("img",{src:ie,alt:"SeshNx",className:"w-5 h-5 object-contain"})}),e.jsx("div",{className:`absolute inset-0 z-40 flex items-center justify-center transition-opacity duration-300 pointer-events-none
                ${v?"opacity-0 group-hover:opacity-100 bg-white/20 dark:bg-black/20":"opacity-100 bg-white/10 dark:bg-black/10"}`,children:F?e.jsx("button",{onClick:Y,className:"w-14 h-14 bg-white/80 dark:bg-black/40 rounded-full flex items-center justify-center border border-gray-200 dark:border-white/40 text-brand-blue shadow-lg hover:scale-110 transition-transform pointer-events-auto",children:v?e.jsx(te,{fill:"currentColor",className:"ml-0.5",size:24}):e.jsx(re,{fill:"currentColor",className:"ml-1",size:24})}):e.jsx(L,{className:"animate-spin text-brand-blue",size:32})}),e.jsx("audio",{ref:p,src:t,crossOrigin:"anonymous",onError:()=>H(!0)})]})}const M=["Spam or commercial solicitation","Harassment or bullying","Hate speech","Nudity or sexual activity","Violence or dangerous organizations","Copyright / Intellectual Property Violation","Scam or fraud","Other"],oe=async({contentId:t,contentType:i,contentSummary:b,reporterId:f,reporterName:h,reason:p,description:y="",schoolId:a=null,isFacultyAction:x=!1})=>{if(!E)return{success:!1,error:"Supabase not initialized"};try{const{error:g}=await E.from("moderation_reports").insert({type:"Report",status:"Open",priority:x?"High":"Normal",target_id:t,target_type:i,target_summary:b||"No preview available",reporter_id:f,reporter_name:h,reason:p,description:y,school_id:a,created_at:new Date().toISOString()});if(g)if(g.code==="42P01"){const{error:o}=await E.from("documents").insert({collection_path:"moderation_queue",id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,data:{type:"Report",status:"Open",priority:x?"High":"Normal",targetId:t,targetType:i,targetSummary:b||"No preview available",reporterId:f,reporterName:h,reason:p,description:y,schoolId:a,timestamp:Date.now()},public_read:!1});if(o)throw o}else throw g;if(x&&(i==="post"||i==="comment")){const o=i==="post"?"posts":"comments",{error:l}=await E.from(o).update({visibility:"Hidden",moderation_status:"Flagged",flagged_by:f,flagged_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",t);if(l&&l.code==="42P01"){const c=`artifacts/seshnx-70c04/public/data/${i==="post"?"posts":"comments"}`,{error:v}=await E.from("documents").update({data:{visibility:"Hidden",moderationStatus:"Flagged",flaggedBy:f,flaggedAt:Date.now()},updated_at:new Date().toISOString()}).eq("collection_path",c).eq("id",t);if(v)throw v}else if(l)throw l}return{success:!0}}catch(g){return console.error("Reporting failed:",g),{success:!1,error:g}}};function fe({user:t,target:i,onClose:b}){const[f,h]=s.useState(M[0]),[p,y]=s.useState(""),[a,x]=s.useState(!1),[g,o]=s.useState(!1),l=async()=>{if(!(!f||!(t!=null&&t.uid))){x(!0);try{(await oe({contentId:i.id,contentType:i.type,contentSummary:i.summary,reporterId:(t==null?void 0:t.id)||(t==null?void 0:t.uid),reporterName:t.displayName||"Anonymous User",reason:f,description:p})).success?(o(!0),setTimeout(b,2e3)):alert("Failed to submit report. Please try again.")}catch(c){console.error("Submission error:",c),alert("An unexpected error occurred during submission.")}x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-lg animate-in fade-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h3",{className:"font-bold text-xl dark:text-white flex items-center gap-2 text-red-500",children:[e.jsx(se,{size:24})," Report Violation"]}),e.jsx("button",{onClick:b,className:"text-gray-500 hover:text-gray-800 dark:text-gray-400 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:e.jsx(ae,{size:20})})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:["You are reporting a violation regarding: ",e.jsx("strong",{className:"font-bold",children:i.summary})," (",i.type,")"]}),g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{size:48,className:"text-green-500 mx-auto mb-4"}),e.jsx("h4",{className:"font-bold text-lg dark:text-white",children:"Report Submitted!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Thank you for helping keep the community safe. We will review this shortly."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Reason for Report"}),e.jsx("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:f,onChange:c=>h(c.target.value),children:M.map(c=>e.jsx("option",{value:c,children:c},c))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Additional Details (Optional)"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm resize-none",rows:"3",placeholder:"Provide any further context or relevant details.",value:p,onChange:c=>y(c.target.value)})]}),e.jsx("button",{onClick:l,disabled:a,className:"w-full bg-red-600 text-white py-3 rounded-xl font-bold hover:bg-red-700 transition disabled:opacity-50 flex items-center justify-center gap-2 shadow-md",children:a?e.jsx(L,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(T,{size:18})," Submit Report"]})})]})]})})})}export{fe as R,ue as S};
