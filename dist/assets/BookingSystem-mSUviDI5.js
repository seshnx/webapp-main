import{r as i,j as e,Y as K,L as se,b1 as Ve,aY as V,d as X,ah as je,b as Ie,a0 as He,S as Me,h as _e,P as Re,X as xe,b5 as ee,bf as Q,a as We,T as ye,aQ as de,x as Ye,ae as Ze,B as Ke,bl as Qe,J as Je,bm as Xe,U as et,t as tt,c as at,n as ue,bj as Z,bn as st,bo as rt,bp as lt,bq as he,br as Le,bs as nt,s as it,u as dt}from"./vendor-C40xFgTg.js";import{q as ae,j as Ae,w as J,k as ve,L as ot,H as re,I as ge,C as H,K as ct,G as fe,E as Fe,A as qe}from"./vendor-firebase-CMJMOSQ_.js";import{d as E,g as Ee,b as G}from"./chat-CcyNTB2o.js";import{f as Ne}from"./index-TrlTd3rF.js";import{M as xt,T as ut,C as gt,a as bt,P as mt,u as ht,L as Pe,i as pt,b as ft}from"./vendor-maps-OcfH4d_h.js";import{A as jt,I as yt,G as vt}from"./edu-esCIx5ew.js";import{u as Nt}from"./useEquipmentDatabase-BFPqdJZn.js";import{A as ze,m as oe}from"./vendor-framer-0jBYu9jQ.js";import"./vendor-convex-CkYEP-FB.js";function De({initialZip:r="",onLocationChange:s,showMap:d=!1,label:x="Location"}){const[m,f]=i.useState(r),[u,g]=i.useState(""),[c,N]=i.useState(!1),[w,o]=i.useState(null);i.useEffect(()=>{r&&r!==m&&(f(r),j(r))},[r]);const j=async l=>{const a=l.replace(/\D/g,"").slice(0,5);if(f(a),a.length===5){N(!0);const n=await Ne(a);n?(g(n.cityState),o({lat:n.lat,lng:n.lng}),s({zip:a,...n})):(g("Unknown Location"),s({zip:a,valid:!1})),N(!1)}else g("")},T=()=>{if(!navigator.geolocation)return alert("Geolocation not supported");N(!0),navigator.geolocation.getCurrentPosition(async l=>{const{latitude:a,longitude:n}=l.coords;try{const b=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${n}`)).json()).address.postcode;if(b){const p=b.split("-")[0];f(p),j(p)}else o({lat:a,lng:n}),g("Current Location"),s({lat:a,lng:n,name:"Current Location",valid:!0})}catch(y){console.error(y),alert("Failed to determine location.")}N(!1)},l=>{console.warn(l),alert("Location access denied."),N(!1)})};return e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:x}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{className:"w-full pl-9 p-2.5 bg-white dark:bg-[#1f2128] border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition-all text-sm",placeholder:"Zip Code",maxLength:5,value:m,onChange:l=>j(l.target.value)}),e.jsx(K,{className:`absolute left-3 top-3 text-gray-400 ${c?"animate-pulse":""}`,size:16})]}),e.jsx("button",{onClick:T,disabled:c,className:"p-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-brand-blue transition-colors",title:"Use my location",children:c?e.jsx(se,{size:18,className:"animate-spin"}):e.jsx(Ve,{size:18})})]}),u&&e.jsxs("div",{className:"mt-1.5 text-xs font-medium text-gray-500 dark:text-gray-400 flex items-center gap-1 animate-in fade-in",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),u]})]})}let kt=Pe.icon({iconUrl:ft,shadowUrl:pt,iconSize:[25,41],iconAnchor:[12,41]});Pe.Marker.prototype.options.icon=kt;function wt({center:r,zoom:s}){const d=ht();return i.useEffect(()=>{d.setView(r,s)},[r,s,d]),null}function Oe({locations:r=[],center:s=[34.0522,-118.2437],zoom:d=10,height:x="400px",drawRadius:m=!1,radiusMiles:f=0}){const u=r.filter(c=>c.lat&&c.lng&&(!c.hideAddress||c.forceReveal)),g=f*1609.34;return e.jsx("div",{className:"rounded-xl overflow-hidden shadow-inner border dark:border-gray-700 relative z-0",style:{height:x,width:"100%"},children:e.jsxs(xt,{center:s,zoom:d,style:{height:"100%",width:"100%"},scrollWheelZoom:!1,children:[e.jsx(ut,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(wt,{center:s,zoom:d}),m&&f>0&&e.jsx(gt,{center:s,pathOptions:{fillColor:"#3D84ED",color:"#3D84ED",fillOpacity:.2},radius:g}),u.map(c=>e.jsx(bt,{position:[c.lat,c.lng],children:e.jsx(mt,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{className:"block mb-1",children:c.name}),e.jsx("span",{className:"text-xs text-gray-500",children:c.address||"Location Hidden"})]})})},c.id))]})})}function Te(r,s,d,x){const f=(d-r)*(Math.PI/180),u=(x-s)*(Math.PI/180),g=Math.sin(f/2)*Math.sin(f/2)+Math.cos(r*(Math.PI/180))*Math.cos(d*(Math.PI/180))*Math.sin(u/2)*Math.sin(u/2);return 6371*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))*.621371}function St({userData:r,sessionParams:s,setSessionParams:d,onNext:x}){var T,l;const[m,f]=i.useState(1),[u,g]=i.useState(!1),[c,N]=i.useState([]),w=a=>{a.preventDefault(),f(2),o()},o=async()=>{g(!0);try{const a=ae(Ae(E,"public_profile"),J("accountTypes","array-contains","Studio")),k=(await ve(a)).docs.map(b=>({id:b.ref.parent.parent.id,...b.data()})).filter(b=>!b.location||!s.location?!1:Te(s.location.lat,s.location.lng,b.location.lat,b.location.lng)<=s.radius).map(b=>({...b,distance:Te(s.location.lat,s.location.lng,b.location.lat,b.location.lng)})).sort((b,p)=>b.distance-p.distance);N(k)}catch(a){console.error("Studio fetch error:",a)}g(!1)},j=a=>{d(n=>({...n,venue:a})),x()};return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 shadow-sm overflow-hidden min-h-[600px]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"bg-brand-blue text-white w-8 h-8 rounded-full flex items-center justify-center text-sm",children:m}),m===1?"Session Logistics":"Select Studio"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 ml-10",children:m===1?"Define the when and where.":`Found ${c.length} studios within range.`})]}),m===1&&e.jsxs("form",{onSubmit:w,className:"p-8 space-y-6 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:[e.jsx(V,{size:14,className:"inline mr-1"})," Date"]}),e.jsx("input",{type:"date",required:!0,className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white outline-none focus:ring-2 focus:ring-brand-blue",value:s.date,onChange:a=>d({...s,date:a.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:[e.jsx(X,{size:14,className:"inline mr-1"})," Start Time"]}),e.jsx("input",{type:"time",required:!0,className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white outline-none focus:ring-2 focus:ring-brand-blue",value:s.time,onChange:a=>d({...s,time:a.target.value})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(De,{initialZip:r==null?void 0:r.zip,label:"Center Location",onLocationChange:a=>d({...s,location:a})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Max Distance"}),e.jsxs("span",{className:"text-xs font-bold text-brand-blue",children:[s.radius," miles"]})]}),e.jsx("input",{type:"range",min:"5",max:"100",step:"5",value:s.radius,onChange:a=>d({...s,radius:parseInt(a.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:[e.jsx(je,{size:14,className:"inline mr-1"})," Urgency"]}),e.jsx("div",{className:"flex gap-2",children:["Low","Normal","High"].map(a=>e.jsx("button",{type:"button",onClick:()=>d({...s,urgency:a}),className:`flex-1 py-2 rounded-lg text-sm font-bold border transition ${s.urgency===a?"bg-brand-blue text-white border-brand-blue":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:a},a))})]})]}),e.jsx("div",{className:"pt-6",children:e.jsxs("button",{type:"submit",className:"w-full bg-brand-blue text-white py-4 rounded-xl font-bold shadow-lg hover:bg-blue-600 transition flex justify-center items-center gap-2",children:["Find Studios ",e.jsx(Ie,{size:20})]})})]}),m===2&&e.jsx("div",{className:"flex flex-col h-[600px]",children:u?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[e.jsx(se,{className:"animate-spin text-brand-blue mb-4",size:40}),e.jsx("p",{className:"text-gray-500",children:"Scouting locations..."})]}):e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-1/2 overflow-y-auto p-4 space-y-3",children:[e.jsx("button",{onClick:()=>f(1),className:"text-xs text-gray-500 hover:text-brand-blue mb-2 flex items-center gap-1",children:"← Change Filters"}),e.jsxs("div",{onClick:()=>j({id:"remote",name:"Remote / TBD",address:"No physical location set"}),className:"p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer text-center",children:[e.jsx("h4",{className:"font-bold text-gray-600 dark:text-gray-300",children:"No Studio Needed / Remote"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Skip venue selection"})]}),c.map(a=>e.jsxs("div",{onClick:()=>j(a),className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 hover:border-brand-blue dark:hover:border-blue-500 cursor-pointer transition shadow-sm group",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-bold dark:text-white group-hover:text-brand-blue",children:a.name||"Studio"}),e.jsxs("span",{className:"text-xs font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-600 dark:text-gray-300",children:["$",a.rate,"/hr"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1",children:[e.jsx(K,{size:10})," ",a.distance.toFixed(1)," miles away"]}),e.jsx("div",{className:"flex gap-1 mt-2",children:(a.equipmentList||[]).slice(0,3).map(n=>e.jsx("span",{className:"text-[10px] bg-blue-50 dark:bg-blue-900/20 text-blue-600 px-1.5 py-0.5 rounded",children:n},n))})]},a.id))]}),e.jsx("div",{className:"hidden md:block w-1/2 h-full border-l dark:border-gray-700 relative",children:e.jsx(Oe,{locations:c,center:[(T=s.location)==null?void 0:T.lat,(l=s.location)==null?void 0:l.lng],height:"100%",drawRadius:!0,radiusMiles:s.radius})})]})})]})}function Be({user:r,userData:s,openPublicProfile:d,onAddToCart:x,sessionCartIds:m=[],onBook:f,mode:u="direct"}){const[g,c]=i.useState(""),[N,w]=i.useState([]),[o,j]=i.useState(!1),[T,l]=i.useState("list"),[a,n]=i.useState(!0),[y,k]=i.useState({role:"All",minRate:0,maxRate:500}),b=async()=>{j(!0);try{const p=Ae(E,Ee().publicProfileCollectionGroup),C=[];y.role!=="All"&&C.push(J("accountTypes","array-contains",y.role)),C.push(ot(50));const h=ae(p,...C);let M=(await ve(h)).docs.map(B=>{const R=B.data();return{id:R.uid||B.ref.parent.parent.id,...R}}).filter(B=>B.id!==r.uid);if(g){const B=g.toLowerCase();M=M.filter(R=>{var L,A,O;return((L=R.firstName)==null?void 0:L.toLowerCase().includes(B))||((A=R.lastName)==null?void 0:A.toLowerCase().includes(B))||((O=R.searchTerms)==null?void 0:O.includes(B))})}w(M)}catch(p){console.error("Search failed:",p)}j(!1)};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 h-full",children:[e.jsx("div",{className:`lg:col-span-3 space-y-4 ${a?"block":"hidden lg:block"}`,children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm h-fit sticky top-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(He,{size:18})," Filters"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Profile Type"}),e.jsxs("select",{className:"w-full p-2 text-sm border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:y.role,onChange:p=>k({...y,role:p.target.value}),children:[e.jsx("option",{value:"All",children:"All Profiles"}),e.jsx("option",{value:"Musician",children:"Musician"}),e.jsx("option",{value:"Producer",children:"Producer"}),e.jsx("option",{value:"Engineer",children:"Audio Engineer"})]})]}),e.jsx("button",{onClick:b,className:"w-full bg-brand-blue text-white py-2 rounded-lg text-sm font-bold hover:bg-blue-600 transition",children:"Update Results"})]})]})}),e.jsxs("div",{className:"lg:col-span-9 space-y-4",children:[e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] p-3 rounded-xl border dark:border-gray-700 flex gap-3 items-center shadow-sm",children:e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(Me,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsx("input",{className:"w-full pl-10 p-2.5 bg-gray-50 dark:bg-[#1f2128] border-transparent focus:bg-white dark:focus:bg-black focus:border-brand-blue border rounded-lg dark:text-white transition-all outline-none",placeholder:"Search talent...",value:g,onChange:p=>c(p.target.value),onKeyDown:p=>p.key==="Enter"&&b()})]})}),e.jsx("div",{className:"min-h-[400px]",children:o?e.jsx("div",{className:"text-center py-10 text-gray-500",children:"Searching..."}):N.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:N.map(p=>{var h;const C=m.includes(p.id);return e.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] p-4 rounded-xl border flex flex-col transition ${C?"border-brand-blue ring-1 ring-brand-blue bg-blue-50 dark:bg-blue-900/10":"dark:border-gray-700 hover:border-gray-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 cursor-pointer",onClick:()=>d(p.id,p.firstName),children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center font-bold",children:(h=p.firstName)==null?void 0:h[0]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold dark:text-white",children:[p.firstName," ",p.lastName]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[p.accountTypes[0]," • $",p.rate||"?","/hr"]})]})]}),u==="planner"&&e.jsx("button",{onClick:()=>!C&&x(p),disabled:C,className:`mt-auto w-full py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 ${C?"bg-green-100 text-green-700 cursor-default":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-white hover:bg-brand-blue hover:text-white transition"}`,children:C?e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:14})," Added to Session"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:14})," Add to Session"]})}),u==="direct"&&e.jsxs("button",{onClick:()=>f(p),className:"mt-auto w-full py-2 rounded-lg text-xs font-bold bg-brand-blue text-white hover:bg-blue-600 transition flex items-center justify-center gap-2",children:[e.jsx(V,{size:14})," Book Now"]})]},p.id)})}):e.jsx("div",{className:"text-center py-20 text-gray-400",children:"Try adjusting filters to find talent."})})]})]})}function Ct({user:r,userData:s,broadcast:d,onClose:x}){const[m,f]=i.useState(Math.floor(d.offerAmount/(d.duration||1))),[u,g]=i.useState(""),[c,N]=i.useState(!1),w=m*(d.duration||1),o=d.offerAmount,j=w>o,T=async()=>{if(!m||!u)return alert("Please enter a rate and a message.");if(j)return alert("Your bid exceeds the client's budget.");N(!0);try{const l={type:"Bid",broadcastId:d.id,targetId:d.senderId,targetName:d.senderName,senderId:r.uid,senderName:`${s.firstName} ${s.lastName}`,serviceType:`Bid: ${d.serviceType||"Session"}`,offerAmount:w,ratePerHour:parseInt(m),message:u,status:"Pending",date:"Flexible",timestamp:re()};await ge(H(E,`artifacts/${G}/public/data/bookings`),l),alert("Bid submitted successfully! The client has been notified."),x()}catch(l){console.error("Error submitting bid:",l),alert("Failed to submit bid.")}N(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Place Your Bid"}),e.jsx("button",{onClick:x,children:e.jsx(xe,{size:20,className:"text-gray-500 hover:text-white"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 uppercase mb-1",children:"Client's Budget"}),e.jsxs("div",{className:"text-2xl font-extrabold dark:text-white",children:["$",o," ",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["Total (",d.duration," hrs)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-500 mb-2",children:"Your Hourly Rate ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{size:16,className:"absolute left-3 top-3.5 text-gray-400"}),e.jsx("input",{type:"number",className:`w-full pl-8 p-3 border rounded-xl font-bold text-lg outline-none dark:bg-[#1f2128] dark:text-white ${j?"border-red-500 focus:ring-red-500":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"}`,value:m,onChange:l=>f(l.target.value)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Total Bid:"}),e.jsxs("span",{className:`font-bold ${j?"text-red-500":"text-green-600"}`,children:["$",w]})]}),j&&e.jsxs("div",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(je,{size:12})," Bid exceeds budget. Consider lowering your rate."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-500 mb-2",children:"Message to Client"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl text-sm dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none resize-none",rows:"3",placeholder:"Introduce yourself and your gear...",value:u,onChange:l=>g(l.target.value)})]}),e.jsx("button",{onClick:T,disabled:c||j,className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold shadow-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:shadow-none",children:c?e.jsx(se,{className:"animate-spin"}):"Submit Proposal"})]})]})})}function $e(r,s,d,x){var m=6371,f=ce(d-r),u=ce(x-s),g=Math.sin(f/2)*Math.sin(f/2)+Math.cos(ce(r))*Math.cos(ce(d))*Math.sin(u/2)*Math.sin(u/2),c=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g));return m*c*.621371}function ce(r){return r*(Math.PI/180)}function zt({user:r,userData:s,onBid:d}){const[x,m]=i.useState([]),[f,u]=i.useState([]),[g,c]=i.useState(null),[N,w]=i.useState(null),[o,j]=i.useState(50);i.useEffect(()=>{(async()=>{if(s!=null&&s.zip){const a=await Ne(s.zip);a&&w({lat:a.lat,lng:a.lng})}else navigator.geolocation&&navigator.geolocation.getCurrentPosition(a=>w({lat:a.coords.latitude,lng:a.coords.longitude}))})()},[s]),i.useEffect(()=>{const l=ae(H(E,`artifacts/${G}/public/data/bookings`),J("type","==","Broadcast"),J("status","==","Broadcasting"),ct("timestamp","desc")),a=fe(l,n=>{m(n.docs.map(y=>({id:y.id,...y.data()})))});return()=>a()},[]),i.useEffect(()=>{if(!N){u(x);return}const l=x.filter(a=>!a.location||!a.location.lat||!a.location.lng?!0:$e(N.lat,N.lng,a.location.lat,a.location.lng)<=o).map(a=>{const n=a.location?$e(N.lat,N.lng,a.location.lat,a.location.lng):null;return{...a,distance:n}}).sort((a,n)=>(a.distance||9999)-(n.distance||9999));u(l)},[x,N,o]);const T=async l=>{if(window.confirm("Cancel this broadcast? This will remove it from the board."))try{await Fe(qe(E,`artifacts/${G}/public/data/bookings`,l),{status:"Cancelled"})}catch(a){console.error(a),alert("Failed to cancel.")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-end gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Q,{className:"text-yellow-500",size:20})," Open Sessions"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Live opportunities near you."})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[e.jsx(K,{size:14,className:"ml-2 text-gray-500"}),e.jsxs("select",{className:"bg-transparent text-sm font-bold text-gray-700 dark:text-gray-300 p-1 outline-none cursor-pointer",value:o,onChange:l=>j(Number(l.target.value)),children:[e.jsx("option",{value:10,children:"Within 10 mi"}),e.jsx("option",{value:25,children:"Within 25 mi"}),e.jsx("option",{value:50,children:"Within 50 mi"}),e.jsx("option",{value:100,children:"Within 100 mi"}),e.jsx("option",{value:5e3,children:"Anywhere"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.length===0?e.jsx("div",{className:"col-span-full text-center py-12 bg-white dark:bg-[#2c2e36] rounded-xl border border-dashed dark:border-gray-700 text-gray-500",children:"No open sessions found."}):f.map(l=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all group relative overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 right-0 bg-brand-blue text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg",children:["BUDGET: $",l.offerAmount||"N/A"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 flex justify-between",children:[e.jsx("span",{children:l.serviceType}),typeof l.distance=="number"&&e.jsxs("span",{className:"text-brand-blue flex items-center gap-1",children:[e.jsx(K,{size:10})," ",l.distance.toFixed(1)," mi"]})]}),e.jsx("h4",{className:"text-lg font-bold dark:text-white truncate pr-16",children:l.targetName||"Session Request"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-300 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{size:14})," ",l.senderName]}),l.date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{size:14})," ",l.date==="Flexible"?"Flexible":new Date(l.date).toLocaleDateString()]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:l.requirements&&l.requirements.slice(0,3).map((a,n)=>e.jsx("span",{className:"text-[10px] bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-600 dark:text-gray-300 border dark:border-gray-600",children:a.value},n))}),e.jsx("div",{className:"flex gap-2",children:l.senderId===r.uid?e.jsxs("button",{onClick:()=>T(l.id),className:"w-full bg-red-100 text-red-600 py-2.5 rounded-lg font-bold text-sm hover:bg-red-200 transition flex items-center justify-center gap-2",children:[e.jsx(ye,{size:16})," Cancel"]}):e.jsxs("button",{onClick:()=>c(l),className:"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-2.5 rounded-lg font-bold text-sm hover:opacity-90 transition flex justify-center items-center gap-2",children:["View & Bid ",e.jsx(Ie,{size:16})]})})]},l.id))}),g&&e.jsx(Ct,{user:r,userData:s,broadcast:g,onClose:()=>c(null)})]})}function Tt({user:r,userData:s,onBack:d,onSuccess:x}){const{loading:m,data:f,categories:u}=Nt(),[g,c]=i.useState(2),N=[5,10,15,25,50,100,250,500],w=N[g],[o,j]=i.useState({lat:34.0522,lng:-118.2437,name:"Default"});i.useEffect(()=>{(async()=>{if(s!=null&&s.zip){const S=await Ne(s.zip);if(S){j({lat:S.lat,lng:S.lng,name:S.cityState});return}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(S=>{j({lat:S.coords.latitude,lng:S.coords.longitude,name:"Current Location"})})})()},[s]);const T=t=>{t.lat&&t.lng&&j({lat:t.lat,lng:t.lng,name:t.cityState||"Selected Location"})},[l,a]=i.useState("Musician"),[n,y]=i.useState("Play"),[k,b]=i.useState(""),[p,C]=i.useState(""),[h,q]=i.useState(""),[M,B]=i.useState(""),[R,L]=i.useState(""),[A,O]=i.useState(""),[_,be]=i.useState(""),[le,me]=i.useState("Any"),[te,ne]=i.useState("Flat Rate"),[z,F]=i.useState([{id:Date.now(),type:"General",value:""}]),I=jt.filter(t=>t!=="Technician"),W=t=>{switch(t){case"Musician":return["Play","Compose","Improvise"];case"Engineer":return["Mix","Master","Record","Edit"];case"Producer":return["Produce","Remix","Arrange"];case"Studio":return["Host Session","Rent Gear"];default:return["Work"]}},U=()=>F([...z,{id:Date.now(),type:"Gear",value:"",gearSelection:{}}]),Y=t=>{z.length!==1&&F(z.filter(S=>S.id!==t))},ke=(t,S,$)=>F(z.map(P=>P.id===t?{...P,[S]:$}:P)),ie=(t,S,$)=>{F(z.map(P=>{if(P.id!==t)return P;const D={...P.gearSelection,[S]:$};return S==="category"&&(delete D.subCategory,delete D.type,delete D.item),S==="subCategory"&&(delete D.type,delete D.item),S==="type"&&delete D.item,{...P,gearSelection:D,value:$}}))},Ge=async()=>{if(!h||!p)return alert("Please complete the request sentence.");if(l==="Musician"&&n==="Play"&&!k)return alert("Please select an instrument.");const t=z.filter($=>$.value.trim()!=="");let S=`${l} - ${n}`;k&&(S+=` ${k}`);try{await ge(H(E,`artifacts/${G}/public/data/bookings`),{senderId:r.uid,senderName:"Broadcast Request",targetId:"BROADCAST",targetName:h,role:l,action:n,instrument:k||null,genre:p,serviceType:S,date:M||"Flexible",time:R||"Flexible",offerAmount:A?parseInt(A):null,references:_,experienceLevel:le,paymentType:te,requirements:t,message:t.map($=>`[${$.type}] ${$.value}`).join(`
`),range:w,status:"Broadcasting",type:"Broadcast",location:{lat:o.lat,lng:o.lng},timestamp:re()}),alert(`Broadcast sent to ${l}s within ${w} miles!`),x()}catch($){console.error($),alert("Failed to send broadcast.")}},Ue=[{label:"Gear / Equipment",value:"Gear",icon:Ze},{label:"Technique / Skill",value:"Technique",icon:Q},{label:"Feel / Vibe",value:"Vibe",icon:Ke},{label:"Logistics",value:"Logistics",icon:X},{label:"General Note",value:"General",icon:Qe}];return e.jsxs("div",{className:"max-w-5xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-lg text-brand-blue",children:e.jsx(K,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold dark:text-white",children:"Broadcast Builder"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Reach professionals in your area."})]})]}),e.jsx("button",{onClick:d,className:"text-sm font-medium text-gray-500 hover:text-brand-blue transition",children:"Cancel & Exit"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"lg:col-span-4 space-y-5",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] p-5 rounded-2xl border dark:border-gray-700",children:[e.jsx(De,{initialZip:s==null?void 0:s.zip,onLocationChange:T,label:"Broadcast Center"}),e.jsxs("div",{className:"mt-4 flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-extrabold text-gray-400 uppercase tracking-wider",children:"Range"}),e.jsxs("span",{className:"bg-brand-blue text-white text-xs font-bold px-2 py-1 rounded-md",children:[w," Miles"]})]}),e.jsx("div",{className:"mb-5 rounded-xl overflow-hidden border dark:border-gray-600 shadow-md relative h-48",children:e.jsx(Oe,{center:[o.lat,o.lng],zoom:9,height:"100%",drawRadius:!0,radiusMiles:w})}),e.jsx("input",{type:"range",min:"0",max:N.length-1,value:g,onChange:t=>c(parseInt(t.target.value)),className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-brand-blue"})]})}),e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl border-2 border-blue-100 dark:border-gray-700 shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-brand-blue"}),e.jsx("label",{className:"text-xs font-extrabold text-brand-blue uppercase tracking-widest mb-4 block",children:"Step 1: Core Request"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-lg md:text-xl text-gray-700 dark:text-gray-200 leading-relaxed font-medium",children:[e.jsx("span",{children:"I need a"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("select",{value:l,onChange:t=>{a(t.target.value),y(W(t.target.value)[0])},className:"appearance-none bg-blue-50 dark:bg-gray-700 text-blue-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-blue-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-blue-100 dark:hover:bg-gray-600 transition",children:I.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx(de,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-blue-500 dark:text-gray-400 pointer-events-none",size:16})]}),e.jsx("span",{children:"that can"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("select",{value:n,onChange:t=>y(t.target.value),className:"appearance-none bg-purple-50 dark:bg-gray-700 text-purple-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-purple-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-purple-100 dark:hover:bg-gray-600 transition",children:W(l).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx(de,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-purple-500 dark:text-gray-400 pointer-events-none",size:16})]}),(n==="Play"||n==="Improvise")&&e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("select",{value:k,onChange:t=>b(t.target.value),className:"appearance-none bg-green-50 dark:bg-gray-700 text-green-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-green-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-green-100 dark:hover:bg-gray-600 transition",children:[e.jsx("option",{value:"",children:"(Select Instrument)"}),Object.entries(yt).map(([t,S])=>e.jsx("optgroup",{label:t,children:S.map($=>e.jsx("option",{value:$,children:$},$))},t))]}),e.jsx(de,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-green-500 dark:text-gray-400 pointer-events-none",size:16})]}),e.jsx("span",{children:"for a song in the"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("select",{value:p,onChange:t=>C(t.target.value),className:"appearance-none bg-orange-50 dark:bg-gray-700 text-orange-700 dark:text-white font-bold py-1 pl-3 pr-8 rounded-lg border-b-2 border-orange-200 dark:border-gray-600 focus:outline-none cursor-pointer hover:bg-orange-100 dark:hover:bg-gray-600 transition",children:[e.jsx("option",{value:"",children:"(Select Genre)"}),vt.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(de,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-orange-500 dark:text-gray-400 pointer-events-none",size:16})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase mb-2 block",children:"Project Title"}),e.jsx("input",{className:"w-full bg-gray-50 dark:bg-black/20 border-none rounded-lg p-3 text-gray-700 dark:text-gray-200 font-medium placeholder-gray-400 focus:ring-2 focus:ring-brand-blue",placeholder:"e.g. Summer Hit Single - Drum Tracking",value:h,onChange:t=>q(t.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-5 rounded-xl border dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Logistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Date"}),e.jsx("input",{type:"date",className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:M,onChange:t=>B(t.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Time"}),e.jsx("input",{type:"time",className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:R,onChange:t=>L(t.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Budget ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-2.5 text-green-500",size:14}),e.jsx("input",{type:"number",className:"w-full pl-8 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm font-bold",placeholder:"Flexible",value:A,onChange:t=>O(t.target.value)})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-5 rounded-xl border dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Project Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Payment Type"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:te,onChange:t=>ne(t.target.value),children:[e.jsx("option",{children:"Flat Rate"}),e.jsx("option",{children:"Hourly"}),e.jsx("option",{children:"Royalty Split"}),e.jsx("option",{children:"Trade / Barter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Experience Required"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:le,onChange:t=>me(t.target.value),children:[e.jsx("option",{children:"Any"}),e.jsx("option",{children:"Intermediate"}),e.jsx("option",{children:"Pro / Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 uppercase",children:"Reference Link"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"absolute left-3 top-2.5 text-gray-400",size:14}),e.jsx("input",{className:"w-full pl-8 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Spotify / SoundCloud...",value:_,onChange:t=>be(t.target.value)})]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsx("label",{className:"text-xs font-extrabold text-brand-blue uppercase tracking-widest",children:"Step 2: Specific Needs"}),e.jsxs("button",{onClick:U,className:"text-xs bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-white px-3 py-1.5 rounded-full font-bold flex items-center gap-1 transition",children:[e.jsx(Re,{size:14})," Add Condition"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:z.map(t=>{var S,$,P,D,we,Se,Ce;return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 bg-gray-50 dark:bg-black/20 p-3 rounded-xl border dark:border-gray-700 animate-in slide-in-from-bottom-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 min-w-[140px]",children:e.jsx("select",{className:"w-full p-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2c2e36] dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",value:t.type,onChange:v=>ke(t.id,"type",v.target.value),children:Ue.map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[t.type==="Gear"&&!m?e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsxs("select",{className:"w-full p-2 text-xs border rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:((S=t.gearSelection)==null?void 0:S.category)||"",onChange:v=>ie(t.id,"category",v.target.value),children:[e.jsx("option",{value:"",children:"Select Category..."}),u.map(v=>e.jsx("option",{value:v.id,children:v.label},v.id))]}),(($=t.gearSelection)==null?void 0:$.category)&&f[t.gearSelection.category]&&e.jsxs("select",{className:"w-full p-2 text-xs border rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:((P=t.gearSelection)==null?void 0:P.subCategory)||"",onChange:v=>ie(t.id,"subCategory",v.target.value),children:[e.jsx("option",{value:"",children:"Select Type..."}),Object.keys(f[t.gearSelection.category]).map(v=>e.jsx("option",{value:v,children:v.replace(/_/g," ")},v))]}),((D=t.gearSelection)==null?void 0:D.subCategory)&&e.jsxs("select",{className:"w-full p-2 text-xs border rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white",value:((we=t.gearSelection)==null?void 0:we.type)||"",onChange:v=>ie(t.id,"type",v.target.value),children:[e.jsx("option",{value:"",children:"Select Subtype..."}),Object.keys(f[t.gearSelection.category][t.gearSelection.subCategory]).map(v=>e.jsx("option",{value:v,children:v.replace(/_/g," ")},v))]}),((Se=t.gearSelection)==null?void 0:Se.type)&&e.jsxs("select",{className:"w-full p-2 text-sm font-bold border-l-4 border-brand-blue rounded bg-white dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white shadow-sm",value:((Ce=t.gearSelection)==null?void 0:Ce.item)||"",onChange:v=>ie(t.id,"item",v.target.value),children:[e.jsx("option",{value:"",children:"Select Specific Item..."}),f[t.gearSelection.category][t.gearSelection.subCategory][t.gearSelection.type].map(v=>e.jsx("option",{value:v,children:v},v))]})]}):e.jsx("input",{className:"w-full p-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2c2e36] dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-brand-blue",placeholder:"Describe requirement...",value:t.value,onChange:v=>ke(t.id,"value",v.target.value)}),e.jsx("button",{onClick:()=>Y(t.id),className:"text-gray-400 hover:text-red-500 px-2",children:e.jsx(ye,{size:18})})]})]},t.id)})}),e.jsx("div",{className:"h-6 w-0.5 bg-gray-200 dark:bg-gray-700 mx-auto my-2"}),e.jsxs("button",{className:"w-full bg-gradient-to-r from-brand-blue to-blue-600 text-white py-4 rounded-xl font-bold shadow-lg hover:scale-[1.01] transition-all text-lg flex items-center justify-center gap-2",onClick:Ge,children:[e.jsx(Q,{fill:"currentColor",size:20})," Broadcast Opportunity"]})]})]})]})]})}function Bt({user:r,userData:s,target:d,onClose:x}){var a;const[m,f]=i.useState(!1),[u,g]=i.useState([]),[c,N]=i.useState("me"),w=(a=s==null?void 0:s.accountTypes)==null?void 0:a.some(n=>["Label","Agent"].includes(n)),[o,j]=i.useState({date:"",time:"",duration:2,serviceType:"Session",offerAmount:d.rate?d.rate*2:100,message:""});i.useEffect(()=>{w&&(async()=>{try{const k=(await ve(H(E,Ee(r.uid).labelRoster(r.uid)))).docs.map(b=>({id:b.id,...b.data()}));g(k)}catch(y){console.error("Roster fetch error",y)}})()},[w,r.uid]);const T=n=>{const y=n.target.value,k=y===""?"":parseInt(y);j(b=>({...b,duration:k,offerAmount:k&&d.rate?d.rate*k:b.offerAmount}))},l=async()=>{if(!o.date||!o.time||!o.message)return alert("Please fill in all required fields.");if(!o.duration||o.duration<=0)return alert("Duration must be at least 1 hour.");f(!0);try{const n=new Date(`${o.date}T${o.time}`);let y={senderId:r.uid,senderName:`${s.firstName} ${s.lastName}`,onBehalfOf:null};if(c!=="me"){const k=u.find(b=>b.artistId===c);k&&(y.senderName=`${s.firstName} (for ${k.name})`,y.onBehalfOf={id:k.artistId,name:k.name,photo:k.photoURL})}await ge(H(E,`artifacts/${G}/public/data/bookings`),{...y,targetId:d.id,targetName:d.firstName?`${d.firstName} ${d.lastName}`:d.name,serviceType:o.serviceType,date:o.date,time:o.time,duration:Number(o.duration),offerAmount:Number(o.offerAmount),message:o.message,status:"Pending",timestamp:re(),bookingStart:n,type:"Direct"}),alert("Booking request sent successfully!"),x()}catch(n){console.error("Booking failed:",n),alert("Failed to send booking request.")}f(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-in fade-in zoom-in-95",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Book Session"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["with ",e.jsx("span",{className:"text-brand-blue font-bold",children:d.firstName||d.name})]})]}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition text-gray-500 dark:text-gray-400",children:e.jsx(xe,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto space-y-5",children:[w&&u.length>0&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-3 rounded-xl border border-purple-100 dark:border-purple-800",children:[e.jsxs("label",{className:"text-xs font-bold text-purple-700 dark:text-purple-300 uppercase mb-1 flex items-center gap-1",children:[e.jsx(Je,{size:12})," Booking On Behalf Of:"]}),e.jsxs("select",{className:"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-purple-800/50 dark:text-white text-sm font-bold",value:c,onChange:n=>N(n.target.value),children:[e.jsxs("option",{value:"me",children:["Myself (",s.firstName,")"]}),u.map(n=>e.jsxs("option",{value:n.artistId,children:["Artist: ",n.name]},n.artistId))]})]}),d.rate&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl border border-blue-100 dark:border-blue-800 flex items-center gap-2 text-xs text-blue-700 dark:text-blue-300",children:[e.jsx(je,{size:14}),e.jsxs("span",{children:["Standard Rate: ",e.jsxs("strong",{children:["$",d.rate,"/hr"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{type:"date",className:"w-full pl-10 p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:o.date,onChange:n=>j({...o,date:n.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Start Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{type:"time",className:"w-full pl-10 p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:o.time,onChange:n=>j({...o,time:n.target.value})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Duration (Hrs)"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm font-bold",value:o.duration,onChange:T})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Total Offer ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-2.5 text-green-500",size:16}),e.jsx("input",{type:"number",className:"w-full pl-9 p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm font-bold text-green-600",value:o.offerAmount,onChange:n=>j({...o,offerAmount:n.target.value})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Type"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm",value:o.serviceType,onChange:n=>j({...o,serviceType:n.target.value}),children:[e.jsx("option",{children:"Session"}),e.jsx("option",{children:"Lesson"}),e.jsx("option",{children:"Consultation"}),e.jsx("option",{children:"Mixing/Mastering"}),e.jsx("option",{children:"Rehearsal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Message / Requirements"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm min-h-[100px] resize-none",placeholder:"Describe what you need...",value:o.message,onChange:n=>j({...o,message:n.target.value})})]})]}),e.jsx("div",{className:"p-5 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("button",{onClick:l,disabled:m,className:"w-full bg-brand-blue text-white py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 shadow-lg disabled:opacity-50",children:m?e.jsx(se,{className:"animate-spin"}):"Send Request"})})]})})}const $t=rt({sessionName:he().min(3,"Session name must be at least 3 chars"),date:he().optional(),time:he().optional(),duration:lt().min(1).max(24)});function It({user:r,userData:s,cart:d,onRemoveFromCart:x,onClose:m,onComplete:f}){const[u,g]=i.useState(!1),{register:c,handleSubmit:N,watch:w,formState:{errors:o,isValid:j}}=Xe({resolver:st($t),defaultValues:{sessionName:`${s.lastName} Session`,duration:4,date:"",time:""},mode:"onChange"}),T=w("duration")||0,l=()=>{let h=0;const q=parseInt(T)||0,M=d.map(A=>{const O=A.rate||0,_=O*q;return h+=_,{...A,itemTotal:_,hourlyRate:O}}),B=d.length>=3,R=B?h*.1:0,L=h-R;return{subtotal:h,discountAmount:R,finalTotal:L,lineItems:M,shouldDiscount:B}},{subtotal:a,discountAmount:n,finalTotal:y,lineItems:k,shouldDiscount:b}=l(),p=async h=>{g(!0);const q=Z.loading("Initializing Session...");try{let M=null;const B=`session_${Date.now()}`,R=k.map(L=>{var A;return ge(H(E,`artifacts/${G}/public/data/bookings`),{groupId:B,sessionName:h.sessionName,senderId:r.uid,senderName:`${s.firstName} ${s.lastName}`,targetId:L.id,targetName:`${L.firstName} ${L.lastName}`,serviceType:((A=L.accountTypes)==null?void 0:A[0])||"Session",date:h.date||"Flexible",time:h.time||"Flexible",duration:h.duration,offerAmount:L.itemTotal*(b?.9:1),status:"Pending",paymentIntentId:M,timestamp:re(),type:"GroupSession"})});await Promise.all(R),Z.success("Session Created!",{id:q}),f()}catch(M){console.error("Booking Error:",M),Z.error("Failed: "+M.message,{id:q})}finally{g(!1)}},C=h=>tt("w-full p-2 border rounded-lg dark:bg-black/20 dark:text-white transition-colors focus:ring-2 focus:ring-brand-blue outline-none",h?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-600");return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-in fade-in",children:e.jsxs("form",{onSubmit:N(p),className:"bg-white dark:bg-[#2c2e36] w-full max-w-2xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] rounded-t-2xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(et,{className:"text-brand-blue"})," Session Builder"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[d.length," Members Selected"]})]}),e.jsx("button",{type:"button",onClick:m,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(xe,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Session Name"}),e.jsx("input",{...c("sessionName"),className:C(o.sessionName),placeholder:"e.g. My Album Recording"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date (Optional)"}),e.jsx("input",{type:"date",...c("date"),className:C(o.date)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time (Optional)"}),e.jsx("input",{type:"time",...c("time"),className:C(o.time)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Duration (Hours)"}),e.jsx("input",{type:"number",...c("duration",{valueAsNumber:!0}),className:C(o.duration)})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-bold dark:text-white mb-3",children:"Session Roster"}),e.jsxs("div",{className:"space-y-2",children:[d.map(h=>{var q;return e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-[#2c2e36] p-2 rounded-lg border dark:border-gray-600 shadow-sm animate-in slide-in-from-right-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold",children:h.firstName[0]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-bold dark:text-white",children:[h.firstName," ",h.lastName]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(q=h.accountTypes)==null?void 0:q[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-mono",children:["$",h.rate,"/hr"]}),e.jsx("button",{type:"button",onClick:()=>x(h.id),className:"text-red-400 hover:text-red-600 transition-colors",children:e.jsx(ye,{size:14})})]})]},h.id)}),d.length===0&&e.jsx("div",{className:"text-center text-xs text-gray-400 py-4 italic",children:"No members added yet."})]})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ee,{size:20})," Cost Breakdown"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-800 transition-all",children:[e.jsx("div",{className:"space-y-2 mb-4 text-sm",children:k.map(h=>e.jsxs("div",{className:"flex justify-between text-blue-900 dark:text-blue-100",children:[e.jsxs("span",{children:[h.firstName," (",h.accountTypes[0],") x ",T,"hrs"]}),e.jsxs("span",{className:"font-mono",children:["$",h.itemTotal.toFixed(2)]})]},h.id))}),e.jsxs("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-blue-800 dark:text-blue-300 font-bold",children:"Subtotal"}),e.jsxs("span",{className:"text-blue-800 dark:text-blue-300 font-bold font-mono",children:["$",a.toFixed(2)]})]}),b&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400 font-bold mt-2 animate-in slide-in-from-right-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Q,{size:14,fill:"currentColor"})," Bundle Discount (10%)"]}),e.jsxs("span",{className:"font-mono",children:["-$",n.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-2xl font-black dark:text-white",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{className:"font-mono",children:["$",y.toFixed(2)]})]})]})]})]}),e.jsx("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] rounded-b-2xl",children:e.jsx("button",{type:"submit",disabled:u||d.length===0||!j,className:at("w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg flex items-center justify-center gap-2",u||d.length===0||!j?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"),children:u?e.jsx(se,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:20})," Confirm & Book"]})})})]})})}const pe=[{id:"Pending",label:"Created",icon:V},{id:"Confirmed",label:"Deposit",icon:ee},{id:"En Route",label:"En Route",icon:Le},{id:"In Progress",label:"Started",icon:nt},{id:"Completed",label:"Done",icon:ue}];function Mt({booking:r,user:s,onClose:d}){var T;const[x,m]=i.useState(r.status),[f,u]=i.useState(!1),g=s.uid===r.targetId,c=s.uid===r.senderId,w=(l=>{const a=pe.findIndex(n=>n.id===l);return a===-1?0:a})(x),o=async l=>{u(!0);try{await Fe(qe(E,`artifacts/${G}/public/data/bookings`,r.id),{status:l,[`statusTimestamps.${l}`]:re()}),m(l),Z.success(`Session ${l}`)}catch(a){console.error("Update failed:",a),Z.error("Failed to update status")}u(!1)},j=w/(pe.length-1)*100;return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[90] p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-3xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:["Session Details ",e.jsxs("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded-full font-medium",children:["#",r.id.slice(-6).toUpperCase()]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["With ",c?r.targetName:r.senderName]})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(xe,{size:20})})]}),e.jsxs("div",{className:"overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"relative pt-4 pb-8 px-4",children:[e.jsx("div",{className:"absolute top-8 left-0 w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full -z-10"}),e.jsx("div",{className:"absolute top-8 left-0 h-1.5 bg-brand-blue rounded-full -z-10 transition-all duration-700 ease-in-out",style:{width:`${j}%`}}),e.jsx("div",{className:"flex justify-between",children:pe.map((l,a)=>{const n=a<=w,y=a===w;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`
                                                w-10 h-10 rounded-full flex items-center justify-center border-4 transition-all duration-500
                                                ${n?"bg-brand-blue border-white dark:border-[#2c2e36] text-white":"bg-gray-200 dark:bg-gray-700 border-white dark:border-[#2c2e36] text-gray-400"}
                                                ${y?"scale-125 shadow-lg ring-4 ring-blue-100 dark:ring-blue-900/50":""}
                                            `,children:e.jsx(l.icon,{size:y?18:16,fill:n?"currentColor":"none"})}),e.jsx("span",{className:`text-xs font-bold uppercase tracking-wider transition-colors ${n?"text-brand-blue":"text-gray-400"}`,children:l.label})]},l.id)})})]}),g&&x!=="Completed"&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-blue-800 dark:text-blue-300",children:"Update Session Status"}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Keep the client informed."})]}),e.jsxs("div",{className:"flex gap-2",children:[x==="Pending"&&e.jsx("button",{onClick:()=>o("Confirmed"),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-green-700 transition shadow-sm",children:"Accept & Confirm"}),x==="Confirmed"&&e.jsxs("button",{onClick:()=>o("En Route"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-blue-700 transition shadow-sm flex items-center gap-1",children:[e.jsx(Le,{size:14})," I'm En Route"]}),x==="En Route"&&e.jsxs("button",{onClick:()=>o("In Progress"),className:"bg-purple-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-purple-700 transition shadow-sm flex items-center gap-1",children:[e.jsx(it,{size:14})," Start Session"]}),x==="In Progress"&&e.jsxs("button",{onClick:()=>o("Completed"),className:"bg-gray-900 dark:bg-white dark:text-black text-white px-4 py-2 rounded-lg font-bold text-xs hover:opacity-90 transition shadow-sm flex items-center gap-1",children:[e.jsx(ue,{size:14})," Complete Session"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase border-b dark:border-gray-700 pb-2",children:"Logistics"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(V,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Date"}),e.jsx("div",{className:"dark:text-white font-medium",children:r.date})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(X,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Time"}),e.jsxs("div",{className:"dark:text-white font-medium",children:[r.time," (",r.duration," hrs)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(K,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Location"}),e.jsx("div",{className:"dark:text-white font-medium",children:((T=r.venue)==null?void 0:T.name)||"Remote / TBD"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase border-b dark:border-gray-700 pb-2",children:"Financials"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(ee,{size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Total Value"}),e.jsxs("div",{className:"dark:text-white font-mono font-bold text-lg",children:["$",r.offerAmount]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(dt,{size:20,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Agreement"}),e.jsx("div",{className:"text-brand-blue text-xs font-bold cursor-pointer hover:underline",children:"View Contract"})]})]})]})]}),r.message&&e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Notes"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 italic",children:['"',r.message,'"']})]})]})]})})}function Gt({user:r,userData:s,openPublicProfile:d}){var ne;const[x,m]=i.useState("search"),[f,u]=i.useState("list"),[g,c]=i.useState("outgoing"),[N,w]=i.useState([]),[o,j]=i.useState([]),[T,l]=i.useState(!0),[a,n]=i.useState("wizard"),[y,k]=i.useState(!1),[b,p]=i.useState({date:"",time:"",location:null,radius:25,urgency:"Normal",venue:null}),[C,h]=i.useState([]),[q,M]=i.useState(!1),[B,R]=i.useState(null),[L,A]=i.useState(null);i.useEffect(()=>{if(!(r!=null&&r.uid))return;l(!0);const z=ae(H(E,`artifacts/${G}/public/data/bookings`),J("senderId","==",r.uid)),F=ae(H(E,`artifacts/${G}/public/data/bookings`),J("targetId","==",r.uid)),I=fe(z,U=>{j(U.docs.map(Y=>({id:Y.id,...Y.data()}))),l(!1)}),W=fe(F,U=>{w(U.docs.map(Y=>({id:Y.id,...Y.data()}))),l(!1)});return()=>{I(),W()}},[r==null?void 0:r.uid]);const O=z=>{R(z),M(!0)},_=()=>n("talent"),be=z=>{if(C.find(F=>F.id===z.id))return Z.error("Already added.");h([...C,z]),Z.success("Added to Session")},le=z=>h(C.filter(F=>F.id!==z)),me=()=>{k(!1),n("wizard"),h([]),p({date:"",time:"",location:null,radius:25,urgency:"Normal",venue:null}),m("requests")},te=(z,F)=>z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400 border-2 border-dashed dark:border-gray-700 rounded-2xl",children:[e.jsx(V,{size:48,className:"mb-4 opacity-20"}),e.jsxs("p",{children:["No ",F==="outgoing"?"outgoing":"incoming"," bookings found."]})]}):e.jsx("div",{className:"grid gap-4",children:z.map(I=>{var W,U;return e.jsx("div",{onClick:()=>A(I),className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm hover:border-brand-blue transition group cursor-pointer",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-lg font-bold",children:F==="outgoing"?(W=I.targetName)==null?void 0:W[0]:(U=I.senderName)==null?void 0:U[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:F==="outgoing"?I.targetName:I.senderName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-xs",children:I.serviceType||"Session"}),I.date&&e.jsxs("span",{children:["• ",I.date]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide inline-block mb-1 ${I.status==="Pending"?"bg-yellow-100 text-yellow-700":I.status==="Confirmed"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:I.status}),e.jsxs("div",{className:"font-mono font-bold dark:text-white",children:["$",I.offerAmount]})]})]})},I.id)})});return e.jsxs("div",{className:"max-w-7xl mx-auto relative min-h-screen pb-20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-end mb-6 border-b dark:border-gray-700 gap-4",children:[e.jsxs("div",{className:"flex gap-6 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>m("broadcasts"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${x==="broadcasts"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Q,{size:16})," Open Jobs"]}),e.jsxs("button",{onClick:()=>m("search"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${x==="search"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Me,{size:16})," Talent Search"]})]}),e.jsxs("div",{className:"flex gap-6 w-full sm:w-auto justify-end",children:[e.jsxs("button",{onClick:()=>m("planner"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${x==="planner"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(V,{size:16})," Session Planner"]}),e.jsxs("button",{onClick:()=>m("requests"),className:`pb-4 px-2 font-bold text-sm transition border-b-2 flex items-center gap-2 ${x==="requests"?"border-brand-blue text-brand-blue dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(X,{size:16})," My Bookings"]})]})]}),e.jsxs(ze,{mode:"wait",children:[x==="broadcasts"&&e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:f==="create_broadcast"?e.jsx(Tt,{user:r,userData:s,onBack:()=>u("list"),onSuccess:()=>u("list")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>u("create_broadcast"),className:"bg-brand-blue text-white px-4 py-2 rounded-lg font-bold text-sm shadow-lg hover:bg-blue-600 transition flex items-center gap-2",children:[e.jsx(Q,{size:16})," New Broadcast"]})}),e.jsx(zt,{user:r,userData:s})]})},"broadcasts"),x==="search"&&e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(Be,{user:r,userData:s,openPublicProfile:d,onBook:O,mode:"direct"})},"search"),x==="requests"&&e.jsxs(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Booking Management"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Track your sessions and requests."})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex",children:[e.jsx("button",{onClick:()=>c("outgoing"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${g==="outgoing"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"I Booked"}),e.jsx("button",{onClick:()=>c("incoming"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${g==="incoming"?"bg-white dark:bg-[#2c2e36] text-brand-blue shadow-sm":"text-gray-500 hover:text-gray-900 dark:hover:text-gray-300"}`,children:"Booked Me"})]})]}),g==="outgoing"?te(o,"outgoing"):te(N,"incoming")]},"requests"),x==="planner"&&e.jsxs(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[a==="wizard"&&e.jsx(St,{userData:s,sessionParams:b,setSessionParams:p,onNext:_}),a==="talent"&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 mb-6 flex justify-between items-center shadow-lg sticky top-4 z-40",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(V,{size:18,className:"text-brand-blue"})," ",b.date||"Flexible Date"," @ ",((ne=b.venue)==null?void 0:ne.name)||"Remote"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[C.length," talent added"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n("wizard"),className:"text-xs font-bold text-gray-500 hover:text-gray-900 dark:hover:text-white px-3 py-2",children:"Back"}),e.jsxs("button",{onClick:()=>k(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-green-700 shadow flex items-center gap-2",children:[e.jsx(ue,{size:16})," Review Session"]})]})]}),e.jsx(Be,{user:r,userData:s,openPublicProfile:d,onAddToCart:be,sessionCartIds:C.map(z=>z.id),mode:"planner"})]})]},"planner")]}),e.jsxs(ze,{children:[q&&B&&e.jsx(Bt,{user:r,userData:s,target:B,allInstruments:[],onClose:()=>M(!1)}),y&&e.jsx(It,{user:r,userData:s,cart:[...b.venue&&b.venue.id!=="remote"?[{...b.venue,accountTypes:["Studio"]}]:[],...C],onRemoveFromCart:le,onClose:()=>k(!1),onComplete:me}),L&&e.jsx(Mt,{booking:L,user:r,onClose:()=>A(null)})]})]})}export{Gt as default};
