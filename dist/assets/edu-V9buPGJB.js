import{r as x,j as e,a1 as F,X as V,L as te,a2 as ze,a3 as G,a4 as H,v as ae,a5 as B,S as K,i as Y,y as J,a6 as Ae,a7 as ye,U as Z,Y as ie,a8 as je,K as Ne,a9 as ve,J as Re,aa as ne,T as M,ab as Pe,D as qe,ac as De,P as U,ad as $e,ae as W,af as ke,ag as Q,g as Ie,ah as Te,a0 as we,ai as Oe,z as Fe,a as Se,aj as he,E as Me,h as Ue,ak as Ge,al as Ce,am as He,F as _e,an as Be,ao as Ve,ap as We,aq as Ke,ar as pe,as as be}from"./vendor-mIyI6DiM.js";import{GLOBAL_ADMIN_ROLE as Ye,SCHOOL_PERMISSIONS as re}from"./config-VNvva2Pv.js";import{S as Je,u as Ze,a as se}from"./chat-P1NCmzAv.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="dfd1e024-7e37-447f-bf5f-32aa6a0de343",t._sentryDebugIdIdentifier="sentry-dbid-dfd1e024-7e37-447f-bf5f-32aa6a0de343")})()}catch{}const Qe="modulepreload",Xe=function(t){return"/"+t},fe={},qt=function(s,u,a){let g=Promise.resolve();if(u&&u.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));g=Promise.allSettled(u.map(p=>{if(p=Xe(p),p in fe)return;fe[p]=!0;const i=p.endsWith(".css"),r=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${r}`))return;const o=document.createElement("link");if(o.rel=i?"stylesheet":Qe,i||(o.as="script"),o.crossOrigin="",o.href=p,h&&o.setAttribute("nonce",h),document.head.appendChild(o),i)return new Promise((b,y)=>{o.addEventListener("load",b),o.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${p}`)))})}))}function l(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return g.then(d=>{for(const h of d||[])h.status==="rejected"&&l(h.reason);return s().catch(l)})},Dt=async t=>{if(!t||t.length<5)return null;try{const s=await fetch(`https://api.zippopotam.us/us/${t}`);if(!s.ok)return null;const a=(await s.json()).places[0];return{lat:parseFloat(a.latitude),lng:parseFloat(a.longitude),name:a["place name"],state:a["state abbreviation"],cityState:`${a["place name"]}, ${a["state abbreviation"]}`}}catch(s){return console.warn("Geocoding failed:",s),null}},et=async(t,s)=>{if(!t||!s)return null;try{const u=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${s}`);if(!u.ok)return null;const g=(await u.json()).address,l=g.city||g.town||g.village||g.hamlet||"Unknown Location",d=g.state||"",h=g.postcode||"";return{city:l,state:d,zip:h,displayName:`${l}, ${d} ${h}`.trim()}}catch(u){return console.warn("Reverse geocoding failed:",u),null}},tt=async(t,s={})=>{if(!t||t.trim().length<3)return[];const{countryCode:u="us",limit:a=5,addressDetails:g=!0}=s;try{const l=new URLSearchParams({q:t,format:"json",addressdetails:g?"1":"0",limit:a.toString(),countrycodes:u}),d=await fetch(`https://nominatim.openstreetmap.org/search?${l}`,{headers:{Accept:"application/json"}});return d.ok?(await d.json()).map(p=>{const i=p.address||{};return{id:p.place_id,displayName:p.display_name,shortName:st(p),lat:parseFloat(p.lat),lng:parseFloat(p.lon),type:p.type,category:p.category,address:{houseNumber:i.house_number||"",street:i.road||i.street||"",city:i.city||i.town||i.village||i.hamlet||"",state:i.state||"",stateCode:de(i.state),zip:i.postcode||"",country:i.country||"",countryCode:i.country_code||""},formattedAddress:at(i)}}):(console.warn("Address search failed:",d.status),[])}catch(l){return console.warn("Address search error:",l),[]}};function st(t){const s=t.address||{},u=[];s.house_number&&s.road?u.push(`${s.house_number} ${s.road}`):s.road&&u.push(s.road);const a=s.city||s.town||s.village||s.hamlet;a&&u.push(a);const g=de(s.state);return g&&u.push(g),u.join(", ")||t.display_name.split(",").slice(0,3).join(",")}function at(t){const s=[];t.house_number&&t.road?s.push(`${t.house_number} ${t.road}`):t.road&&s.push(t.road);const u=t.city||t.town||t.village||"",a=de(t.state),g=t.postcode||"",l=[u,a].filter(Boolean).join(", ");return l&&s.push(g?`${l} ${g}`:l),s.join(", ")}function de(t){if(!t)return"";const s={alabama:"AL",alaska:"AK",arizona:"AZ",arkansas:"AR",california:"CA",colorado:"CO",connecticut:"CT",delaware:"DE",florida:"FL",georgia:"GA",hawaii:"HI",idaho:"ID",illinois:"IL",indiana:"IN",iowa:"IA",kansas:"KS",kentucky:"KY",louisiana:"LA",maine:"ME",maryland:"MD",massachusetts:"MA",michigan:"MI",minnesota:"MN",mississippi:"MS",missouri:"MO",montana:"MT",nebraska:"NE",nevada:"NV","new hampshire":"NH","new jersey":"NJ","new mexico":"NM","new york":"NY","north carolina":"NC","north dakota":"ND",ohio:"OH",oklahoma:"OK",oregon:"OR",pennsylvania:"PA","rhode island":"RI","south carolina":"SC","south dakota":"SD",tennessee:"TN",texas:"TX",utah:"UT",vermont:"VT",virginia:"VA",washington:"WA","west virginia":"WV",wisconsin:"WI",wyoming:"WY","district of columbia":"DC"};return t.length===2?t.toUpperCase():s[t.toLowerCase()]||t}const rt={schoolId:null,schoolData:null,studentProfile:null,staffProfile:null,myPermissions:[],internshipStudio:null,isStudent:!1,isStaff:!1,checkIn:async()=>({success:!1}),checkOut:async()=>({success:!1}),loading:!1},Ee=x.createContext(rt);function X(){return x.useContext(Ee)}function $t({children:t,user:s,userData:u}){const[a,g]=x.useState(null),[l,d]=x.useState(null),[h,p]=x.useState(null),[i,r]=x.useState([]),[o,b]=x.useState(null),[y,N]=x.useState(!1),m={schoolId:u==null?void 0:u.schoolId,schoolData:a,studentProfile:l,staffProfile:h,myPermissions:i,internshipStudio:o,isStudent:!!l,isStaff:!!h,checkIn:async()=>(console.warn("School check-in not yet implemented with Neon"),{success:!1}),checkOut:async()=>(console.warn("School check-out not yet implemented with Neon"),{success:!1}),loading:y};return e.jsx(Ee.Provider,{value:m,children:t})}const it=()=>{const[t,s]=x.useState(!1),[u,a]=x.useState(null);return{uploadImage:async(l,d="profile-photos")=>{if(!l)return null;s(!0),a(null);try{let h=d.replace("_","-");(!h||h==="undefined")&&(h=Je.PROFILE_PHOTOS);const p=await Ze(l,h);return s(!1),p.url}catch(h){return console.error("Image upload failed:",h),a(h.message||"Failed to upload image"),s(!1),null}},uploading:t,error:u}};function nt(t={}){const{debounceMs:s=300,countryCode:u="us",limit:a=5}=t,[g,l]=x.useState([]),[d,h]=x.useState(!1),[p,i]=x.useState(null),r=x.useRef(null),o=x.useRef(""),b=x.useRef(0),y=x.useCallback(async w=>{const S=(w==null?void 0:w.trim())||"";if(r.current&&clearTimeout(r.current),S.length<3){l([]),h(!1),i(null);return}S!==o.current&&(h(!0),i(null),r.current=setTimeout(async()=>{const c=++b.current;o.current=S;try{const m=await tt(S,{countryCode:u,limit:a,addressDetails:!0});c===b.current&&(l(m),h(!1))}catch(m){c===b.current&&(i(m.message||"Address search failed"),l([]),h(!1))}},s))},[s,u,a]),N=x.useCallback(()=>{l([]),i(null),o.current=""},[]);return{search:y,results:g,loading:d,error:p,clearResults:N}}function dt({onSelect:t,value:s,onChange:u,placeholder:a="Start typing an address...",className:g="",label:l="Address",required:d=!1,showGeolocation:h=!0,countryCode:p="us",error:i}){const{search:r,results:o,loading:b,error:y,clearResults:N}=nt({countryCode:p,debounceMs:350,limit:6}),[w,S]=x.useState(""),[c,m]=x.useState(!1),[k,L]=x.useState(!1),j=x.useRef(null),v=x.useRef(null),C=s!==void 0?s:w;x.useEffect(()=>{function f(z){j.current&&!j.current.contains(z.target)&&m(!1)}return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]);const E=f=>{const z=f.target.value;u?u(z):S(z),z.trim().length>=3?(r(z),m(!0)):(m(!1),N())},A=f=>{const z={displayName:f.displayName,shortName:f.shortName,formattedAddress:f.formattedAddress,lat:f.lat,lng:f.lng,...f.address},D=f.formattedAddress||f.shortName||f.displayName;u?u(D):S(D),t&&t(z),m(!1),N()},R=async()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}L(!0),navigator.geolocation.getCurrentPosition(async f=>{const{latitude:z,longitude:D}=f.coords;try{const O=await et(z,D);if(O){const T=O.displayName;u?u(T):S(T),t&&t({displayName:T,formattedAddress:T,lat:z,lng:D,city:O.city,state:O.state,zip:O.zip})}}catch(O){console.error("Reverse geocode failed:",O)}L(!1)},f=>{console.warn("Geolocation error:",f),alert("Unable to get your location. Please enter address manually."),L(!1)},{enableHighAccuracy:!0,timeout:1e4})},$=()=>{var f;u?u(""):S(""),N(),m(!1),(f=v.current)==null||f.focus()},n=i||y;return e.jsxs("div",{ref:j,className:`relative ${g}`,children:[l&&e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:[l,d&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(F,{className:`absolute left-3 top-3 ${b?"text-brand-blue animate-pulse":"text-gray-400"}`,size:16}),e.jsx("input",{ref:v,type:"text",className:`
                            w-full pl-9 pr-8 p-2.5 text-sm
                            bg-white dark:bg-[#1f2128] 
                            border ${n?"border-red-400 focus:ring-red-200":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"}
                            rounded-lg focus:ring-2 outline-none 
                            dark:text-white transition-all
                        `,placeholder:a,value:C,onChange:E,onFocus:()=>{o.length>0&&m(!0)},autoComplete:"off"}),C&&!b&&e.jsx("button",{type:"button",onClick:$,className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",children:e.jsx(V,{size:16})}),b&&e.jsx(te,{className:"absolute right-3 top-3 text-brand-blue animate-spin",size:16})]}),h&&e.jsx("button",{type:"button",onClick:R,disabled:k,className:"p-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-brand-blue transition-colors disabled:opacity-50",title:"Use my current location",children:k?e.jsx(te,{size:18,className:"animate-spin"}):e.jsx(ze,{size:18})})]}),n&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i||y}),c&&o.length>0&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-72 overflow-y-auto animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsx("div",{className:"py-1",children:o.map(f=>{var z;return e.jsx("button",{type:"button",onClick:()=>A(f),className:"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(F,{size:16,className:"text-gray-400 group-hover:text-brand-blue transition-colors mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm dark:text-white group-hover:text-brand-blue transition-colors truncate",children:f.shortName||f.formattedAddress}),f.displayName!==f.shortName&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5",children:f.displayName}),((z=f.address)==null?void 0:z.zip)&&e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:["ZIP: ",f.address.zip]})]})]})},f.id)})}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-t dark:border-gray-700 text-[10px] text-gray-400 text-center",children:"Powered by OpenStreetMap"})]}),c&&b&&o.length===0&&C.length>=3&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2",children:[e.jsx(te,{className:"animate-spin",size:16}),e.jsx("span",{className:"text-sm",children:"Searching addresses..."})]}),c&&!b&&o.length===0&&C.length>=3&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 text-sm",children:"No addresses found. Try a different search."})]})}function lt(t){return!t||!t.accountTypes?!1:t.accountTypes.includes(Ye)}const ot=x.createContext();function ee(){const t=x.useContext(ot);if(!t)throw new Error("useEduAuth must be used within an EduAuthProvider");return t}function ct({user:t,userData:s}){let u;try{u=ee()}catch{u=null}const a=(u==null?void 0:u.user)||t,g=(u==null?void 0:u.userData)||s,{schoolData:l,studentProfile:d}=X(),[h,p]=x.useState(""),[i,r]=x.useState([]),[o,b]=x.useState(!1),[y,N]=x.useState([]),[w,S]=x.useState([]),[c,m]=x.useState([]),[k,L]=x.useState([]),[j,v]=x.useState(!1),C=(g==null?void 0:g.internshipCities)||[],E=g==null?void 0:g.schoolId,A=async()=>{const _=h.trim(),P=(a==null?void 0:a.id)||(a==null?void 0:a.uid);if(_&&C.length<3&&supabase)try{const q=[...C,_];await supabase.from("profiles").update({internship_cities:q}).eq("id",P),p("")}catch(q){console.error("Error adding interest:",q)}},R=async _=>{const P=(a==null?void 0:a.id)||(a==null?void 0:a.uid);if(supabase)try{const q=C.filter(I=>I!==_);await supabase.from("profiles").update({internship_cities:q}).eq("id",P)}catch(q){console.error("Error removing interest:",q)}};x.useEffect(()=>{g!=null&&g.programComplete&&$()},[g==null?void 0:g.programComplete,C]),x.useEffect(()=>{E&&(a!=null&&a.uid)&&(n(),f(),z(),D())},[E,a==null?void 0:a.uid]);const $=async()=>{if(supabase){b(!0);try{const{data:_,error:P}=await supabase.from("studios").select("*").eq("allow_internship",!0);if(P)throw P;let q=(_||[]).map(I=>({id:I.id,...I,allowInternship:I.allow_internship,zipCode:I.zip_code}));C.length>0&&(q=q.filter(I=>C.some(ge=>{var ue,me;return((ue=I.city)==null?void 0:ue.toLowerCase().includes(ge.toLowerCase()))||((me=I.zipCode)==null?void 0:me.includes(ge))}))),r(q)}catch(_){console.error("Error fetching studios:",_)}finally{b(!1)}}},n=async()=>{if(!(!supabase||!E)){v(!0);try{const{data:_,error:P}=await supabase.from("courses").select("*").eq("school_id",E).eq("status","published");if(P)throw P;N((_||[]).map(q=>({id:q.id,...q})))}catch(_){console.error("Error loading courses:",_)}v(!1)}},f=async()=>{if(!supabase||!E)return;const _=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const{data:P,error:q}=await supabase.from("enrollments").select("*").eq("school_id",E).eq("student_id",_);if(q)throw q;S((P||[]).map(I=>({id:I.id,...I,studentId:I.student_id,courseId:I.course_id,enrolledAt:I.enrolled_at})))}catch(P){console.error("Error loading enrollments:",P)}},z=async()=>{if(!(!supabase||!E))try{const{data:_,error:P}=await supabase.from("learning_paths").select("*").eq("school_id",E);if(P)throw P;m((_||[]).map(q=>({id:q.id,...q})))}catch(_){console.error("Error loading learning paths:",_)}},D=async()=>{if(!supabase||!E)return;const _=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const{data:P,error:q}=await supabase.from("badges").select("*").eq("school_id",E).eq("student_id",_);if(q)throw q;L((P||[]).map(I=>({id:I.id,...I,studentId:I.student_id})))}catch(P){console.error("Error loading badges:",P)}},O=async _=>{if(!supabase||!E)return;const P=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{await supabase.from("enrollments").insert({school_id:E,student_id:P,course_id:_,enrolled_at:new Date().toISOString(),progress:0,status:"active"}),f()}catch(q){console.error("Error enrolling:",q),alert("Failed to enroll in course.")}},T=w.map(_=>_.courseId),oe=y.filter(_=>!T.includes(_.id)),ce=y.filter(_=>T.includes(_.id)),xe=((d==null?void 0:d.hoursLogged)||0)/((l==null?void 0:l.requiredHours)||100);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2",children:l!=null&&l.logoURL?e.jsx("img",{src:l.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(G,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight mb-1",children:(l==null?void 0:l.name)||"Student Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Student Portal"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["ID: ",(g==null?void 0:g.studentId)||"N/A"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Cohort: ",(d==null?void 0:d.cohort)||"General"]})]})]}),e.jsxs("div",{className:"w-full md:w-64 bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"dark:text-gray-300",children:"Progress"}),e.jsxs("span",{className:"text-indigo-600",children:[Math.round(xe*100),"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:"h-full bg-indigo-600",style:{width:`${Math.min(100,xe*100)}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 text-right",children:[(d==null?void 0:d.hoursLogged)||0," / ",(l==null?void 0:l.requiredHours)||100," Hours"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(F,{size:20,className:"text-indigo-500"})," Internship Locations"]}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Add up to 3 target locations (City, Zip, or County) to find matched studios."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(_=>e.jsxs("span",{className:"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300 text-sm font-medium px-3 py-1 rounded-full flex items-center gap-1",children:[_,e.jsx("button",{onClick:()=>R(_),className:"ml-1 hover:text-indigo-800",children:"×"})]},_))}),C.length<3&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter City or Zip Code",value:h,onChange:_=>p(_.target.value),onKeyDown:_=>_.key==="Enter"&&A(),className:"flex-1 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none"}),e.jsx("button",{onClick:A,disabled:!h.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg font-bold disabled:opacity-50",children:"Add"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(H,{size:20,className:"text-indigo-500"}),"My Courses"]}),ce.length===0?e.jsx("p",{className:"text-gray-500",children:"You haven't enrolled in any courses yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ce.map(_=>{const P=w.find(q=>q.courseId===_.id);return e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:_.title}),e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-1 rounded",children:"Enrolled"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:_.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(ae,{size:14}),e.jsxs("span",{children:[_.lessonCount||0," lessons"]})]}),e.jsx("button",{className:"text-indigo-600 text-sm font-semibold hover:underline",children:"Continue Learning →"})]}),P&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Progress"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[P.progress||0,"%"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all",style:{width:`${P.progress||0}%`}})})]})]},_.id)})})]}),oe.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(H,{size:20,className:"text-indigo-500"}),"Available Courses"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:oe.slice(0,4).map(_=>e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsx("h3",{className:"font-bold dark:text-white mb-1",children:_.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:_.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(ae,{size:14}),e.jsxs("span",{children:[_.lessonCount||0," lessons"]})]}),e.jsx("button",{onClick:()=>O(_.id),className:"px-4 py-1.5 bg-indigo-600 text-white text-sm font-semibold rounded-lg hover:bg-indigo-700 transition",children:"Enroll"})]})]},_.id))})]}),k.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(B,{size:20,className:"text-yellow-500"}),"Earned Badges & Certificates"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:k.map(_=>{var P,q;return e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(B,{size:32,className:"mx-auto text-yellow-500 mb-2"}),e.jsx("p",{className:"text-sm font-semibold dark:text-white",children:_.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:((q=(P=_.earnedAt)==null?void 0:P.toDate)==null?void 0:q.call(P).toLocaleDateString())||"Recently"})]},_.id)})})]}),(g==null?void 0:g.programComplete)&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(K,{size:20,className:"text-indigo-500"})," Available Studios"]}),o?e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(Y,{className:"animate-spin",size:16})," Searching..."]}):i.length>0?e.jsx("div",{className:"space-y-3",children:i.map(_=>e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold dark:text-white text-lg",children:_.name}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(F,{size:12})," ",_.city,", ",_.state]})]}),e.jsx("button",{className:"text-indigo-600 font-bold text-sm hover:underline",children:"View Details"})]},_.id))}):e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(J,{size:16})," No studios found matching your criteria yet."]})]})]})}const It=Object.freeze(Object.defineProperty({__proto__:null,default:ct},Symbol.toStringTag,{value:"Module"})),xt=(t,s)=>{if(!t||!s)return 0;const u=t.toMillis?t.toMillis():new Date(t).getTime(),g=(s.toMillis?s.toMillis():new Date(s).getTime())-u;return Math.max(0,Math.floor(g/6e4))},gt=t=>{const s=Math.floor(t/60),u=Math.floor(t%60);return`${s}h ${u>0?`${u}m`:""}`};function ut({user:t,userData:s}){let u;try{u=ee()}catch{u=null}const a=(u==null?void 0:u.user)||t,g=(u==null?void 0:u.userData)||s,{schoolData:l,studentProfile:d,internshipStudio:h,checkIn:p,checkOut:i}=X(),[r,o]=x.useState(""),[b,y]=x.useState(!1),[N,w]=x.useState([]),[S,c]=x.useState([]),[m,k]=x.useState([]),L=g==null?void 0:g.schoolId;x.useEffect(()=>{L&&(a!=null&&a.id||a!=null&&a.uid)&&supabase&&(j(),v(),C())},[L,a==null?void 0:a.id,a==null?void 0:a.uid]);const j=async()=>{if(!supabase||!L)return;const R=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const{data:$,error:n}=await supabase.from("enrollments").select("*").eq("school_id",L).eq("student_id",R);if(n)throw n;w(($||[]).map(f=>({id:f.id,...f,studentId:f.student_id,courseId:f.course_id,enrolledAt:f.enrolled_at})))}catch($){console.error("Error loading enrollments:",$)}},v=async()=>{if(!supabase||!L)return;const R=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const{data:$,error:n}=await supabase.from("badges").select("*").eq("school_id",L).eq("student_id",R);if(n)throw n;c(($||[]).map(f=>({id:f.id,...f,studentId:f.student_id})))}catch($){console.error("Error loading badges:",$)}},C=async()=>{d!=null&&d.milestones&&k(d.milestones)},E=async()=>{y(!0);try{d!=null&&d.isClockedIn?(await i(r),o("")):await p((h==null?void 0:h.name)||"Remote Internship","studio")}catch(R){console.error(R)}y(!1)};if(!d)return e.jsx("div",{className:"p-8 text-center",children:"Loading student profile..."});const A=Math.min(100,(d.hoursLogged||0)/((l==null?void 0:l.requiredHours)||100)*100);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"h-20 w-20 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-1",children:l!=null&&l.logoURL?e.jsx("img",{src:l.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(G,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight mb-1",children:(l==null?void 0:l.name)||"Internship Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Active Intern"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Cohort: ",d.cohort]})]})]}),e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("div",{className:"text-3xl font-black dark:text-white text-indigo-600",children:d.hoursLogged||0}),e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider",children:"Total Hours"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-gradient-to-br from-indigo-900 to-slate-900 text-white p-8 rounded-2xl relative overflow-hidden shadow-lg border border-indigo-800/50",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-xs font-bold uppercase tracking-widest opacity-60 mb-2",children:"Assigned Studio Location"}),e.jsx("h2",{className:"text-3xl font-extrabold mb-4 tracking-tight",children:(h==null?void 0:h.name)||"Pending Assignment"}),h?e.jsxs("div",{className:"space-y-3 text-sm opacity-90",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(F,{size:18,className:"text-indigo-400"})," ",h.address||"Address not listed"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(J,{size:18,className:"text-green-400"})," Status: Active Placement"]})]}):e.jsxs("div",{className:"bg-white/10 p-4 rounded-xl flex items-start gap-3 border border-white/10",children:[e.jsx(Ae,{className:"text-yellow-400 shrink-0 mt-0.5",size:20}),e.jsx("p",{className:"text-sm leading-relaxed",children:"You haven't been assigned an internship location yet. Please contact your school coordinator to get placed."})]})]}),e.jsx("div",{className:"absolute -right-12 -bottom-12 w-64 h-64 bg-indigo-600/20 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:d.isClockedIn?"text-green-500 animate-pulse":"text-gray-400"}),d.isClockedIn?"Currently Working":"Time Clock"]}),d.isClockedIn&&e.jsx("textarea",{className:"w-full p-3 text-sm border rounded-xl mb-4 dark:bg-black/20 dark:border-gray-600 dark:text-white resize-none focus:ring-2 focus:ring-indigo-500 outline-none",rows:"4",placeholder:"Describe your tasks for this session...",value:r,onChange:R=>o(R.target.value)})]}),e.jsx("button",{onClick:E,disabled:b||!h&&!d.isClockedIn,className:`w-full py-3.5 rounded-xl font-bold text-white transition shadow-lg transform active:scale-95 ${b?"bg-gray-400":d.isClockedIn?"bg-red-500 hover:bg-red-600 shadow-red-500/30":"bg-green-600 hover:bg-green-700 shadow-green-600/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none"}`,children:b?"Processing...":d.isClockedIn?"Clock Out":"Clock In"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"dark:text-white",children:"Completion Progress"}),e.jsxs("span",{className:"text-indigo-600",children:[Math.round(A),"%"]})]}),e.jsx("div",{className:"w-full h-4 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-1000 ease-out",style:{width:`${A}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-center",children:[d.hoursLogged," / ",(l==null?void 0:l.requiredHours)||100," Hours Required"]})]}),N.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(H,{size:20,className:"text-indigo-500"}),"Course Progress"]}),e.jsx("div",{className:"space-y-3",children:N.map(R=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"font-semibold dark:text-white",children:["Course ",R.courseId]}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.progress||0,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all",style:{width:`${R.progress||0}%`}})})]},R.id))})]}),m.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(ye,{size:20,className:"text-purple-500"}),"Internship Milestones"]}),e.jsx("div",{className:"space-y-2",children:m.map((R,$)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[R.completed?e.jsx(J,{size:20,className:"text-green-500"}):e.jsx("div",{className:"w-5 h-5 border-2 border-gray-300 dark:border-gray-600 rounded-full"}),e.jsx("span",{className:R.completed?"text-gray-600 dark:text-gray-400 line-through":"dark:text-white",children:R.name})]},$))})]}),S.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(B,{size:20,className:"text-yellow-500"}),"Earned Badges"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:S.map(R=>e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(B,{size:32,className:"mx-auto text-yellow-500 mb-2"}),e.jsx("p",{className:"text-sm font-semibold dark:text-white",children:R.name})]},R.id))})]})]})}const Tt=Object.freeze(Object.defineProperty({__proto__:null,default:ut},Symbol.toStringTag,{value:"Module"})),le=(t,s="export")=>{if(!t||!t.length){console.warn("No data to export.");return}const u=new Set;t.forEach(p=>Object.keys(p).forEach(i=>u.add(i)));const a=Array.from(u),g=[];g.push(a.join(",")),t.forEach(p=>{const i=a.map(r=>{const o=p[r];return o&&typeof o=="object"?o.toMillis?`"${new Date(o.toMillis()).toLocaleString()}"`:`"${JSON.stringify(o).replace(/"/g,'""')}"`:`"${(""+(o??"")).replace(/"/g,'""')}"`});g.push(i.join(","))});const l=new Blob([g.join(`
`)],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(l),h=document.createElement("a");h.href=d,h.setAttribute("download",`${s}_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(h),h.click(),document.body.removeChild(h)};function mt({schoolId:t,schoolData:s}){const[u,a]=x.useState({students:0,interns:0,pending:0}),[g,l]=x.useState([]),[d,h]=x.useState(!0);return x.useEffect(()=>{if(!t||!supabase)return;(async()=>{h(!0);try{const{count:i,error:r}=await supabase.from("students").select("*",{count:"exact",head:!0}).eq("school_id",t);if(r)throw r;const{data:o,error:b}=await supabase.from("students").select("id, internship_studio_id").eq("school_id",t).not("internship_studio_id","is",null);if(b)throw b;const y=(o||[]).length,{data:N,error:w}=await supabase.from("internship_logs").select("id").eq("school_id",t).eq("status","pending_approval");if(w)throw w;const S=(N||[]).length;a({students:i||0,interns:y,pending:S});const{data:c,error:m}=await supabase.from("audit_logs").select("*").eq("school_id",t).order("timestamp",{ascending:!1}).limit(5);if(m)throw m;l((c||[]).map(k=>({id:k.id,...k,adminName:k.admin_name,timestamp:k.timestamp?new Date(k.timestamp):null})))}catch(i){console.error("Overview load failed:",i)}h(!1)})()},[t]),d?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Overview..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(se,{title:"Total Students",value:u.students,icon:e.jsx(Z,{className:"text-white"}),bg:"bg-gradient-to-br from-indigo-500 to-blue-600",text:"text-white"}),e.jsx(se,{title:"Active Internships",value:u.interns,icon:e.jsx(ie,{className:"text-white"}),bg:"bg-gradient-to-br from-purple-500 to-pink-600",text:"text-white"}),e.jsx(se,{title:"Pending Approvals",value:u.pending,icon:e.jsx(Y,{className:"text-white"}),bg:"bg-gradient-to-br from-yellow-500 to-orange-600",text:"text-white"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-4 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(je,{size:18,className:"text-gray-400"})," Recent Activity"]}),e.jsx("div",{className:"space-y-3",children:g.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No recent activity recorded."}):g.map(p=>{var i;return e.jsxs("div",{className:"text-xs border-b dark:border-gray-700 pb-2 last:border-0",children:[e.jsxs("div",{className:"flex justify-between font-bold dark:text-gray-200",children:[e.jsx("span",{children:p.action}),e.jsx("span",{className:"text-gray-500 font-normal",children:(i=p.timestamp)!=null&&i.toDate?p.timestamp.toDate().toLocaleTimeString():""})]}),e.jsxs("div",{className:"text-gray-500 mt-0.5",children:[p.details," ",e.jsxs("span",{className:"opacity-70",children:["— ",p.adminName]})]})]},p.id)})})]}),e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center text-center bg-white dark:bg-black/20 shadow-sm",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center shadow-lg mb-4 overflow-hidden border-4 border-white dark:border-gray-700",children:s!=null&&s.logoURL?e.jsx("img",{src:s.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(G,{size:40,className:"text-indigo-500"})}),e.jsx("h2",{className:"text-2xl font-extrabold dark:text-white mb-1",children:(s==null?void 0:s.name)||"School Name"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:(s==null?void 0:s.address)||"No Address Set"}),(s==null?void 0:s.website)&&e.jsxs("a",{href:s.website,target:"_blank",rel:"noreferrer",className:"text-xs font-bold text-indigo-600 bg-indigo-50 dark:bg-indigo-900/20 px-3 py-1.5 rounded-full hover:bg-indigo-100 transition flex items-center gap-1",children:[e.jsx(Ne,{size:12})," Visit Website"]})]})]})]})}function ht({schoolId:t,logAction:s}){const[u,a]=x.useState([]),[g,l]=x.useState([]),[d,h]=x.useState(!0),[p,i]=x.useState(""),[r,o]=x.useState(!1),[b,y]=x.useState(!1),[N,w]=x.useState(null),[S,c]=x.useState(!1),[m,k]=x.useState({firstName:"",lastName:"",email:"",studentId:"",cohort:"",status:"Enrolled"}),[L,j]=x.useState("");x.useEffect(()=>{if(!t||!supabase)return;(async()=>{h(!0);try{const{data:f,error:z}=await supabase.from("students").select("*").eq("school_id",t);if(z)throw z;a((f||[]).map(T=>({id:T.id,...T,displayName:T.display_name,studentId:T.student_id,hoursLogged:T.hours_logged||0})));const{data:D,error:O}=await supabase.from("school_partners").select("*").eq("school_id",t);if(O)throw O;l((D||[]).map(T=>({id:T.id,...T})))}catch(f){console.error("Roster load failed:",f)}h(!1)})()},[t]);const v=()=>{k({firstName:"",lastName:"",email:"",studentId:"",cohort:"",status:"Enrolled"}),c(!1),w(null),o(!0)},C=n=>{var f,z;k({firstName:((f=n.displayName)==null?void 0:f.split(" ")[0])||"",lastName:((z=n.displayName)==null?void 0:z.split(" ").slice(1).join(" "))||"",email:n.email||"",studentId:n.studentId||"",cohort:n.cohort||"",status:n.status||"Enrolled"}),c(!0),w(n),o(!0)},E=async()=>{if(!supabase||!t)return;const n=`${m.firstName} ${m.lastName}`.trim();if(!n||!m.email)return alert("Name and Email required.");try{if(S&&N){const{error:f}=await supabase.from("students").update({first_name:m.firstName,last_name:m.lastName,display_name:n,email:m.email,student_id:m.studentId||null,cohort:m.cohort||null,status:m.status}).eq("id",N.id).eq("school_id",t);if(f)throw f;a(z=>z.map(D=>D.id===N.id?{...D,...m,displayName:n}:D)),s&&await s("Edit Student",`Updated ${n}`)}else{const{data:f,error:z}=await supabase.from("students").insert({school_id:t,first_name:m.firstName,last_name:m.lastName,display_name:n,email:m.email,student_id:m.studentId||null,cohort:m.cohort||null,status:m.status,hours_logged:0,created_at:new Date().toISOString()}).select().single();if(z)throw z;a(D=>[...D,{id:f.id,...m,displayName:n,hoursLogged:0}]),s&&await s("Add Student",`Added ${n}`)}o(!1)}catch(f){console.error("Save student failed:",f),alert("Failed to save student.")}},A=async(n,f)=>{if(!(!confirm(`Remove ${f} from the roster? This does not delete their user account.`)||!supabase))try{await supabase.from("students").delete().eq("id",n).eq("school_id",t),a(z=>z.filter(D=>D.id!==n)),s&&await s("Remove Student",`Removed ${f}`)}catch(z){console.error("Delete failed:",z)}},R=async()=>{if(!(!N||!L||!supabase))try{await supabase.from("students").update({internship_studio_id:L}).eq("id",N.id).eq("school_id",t),a(n=>n.map(f=>f.id===N.id?{...f,internshipStudioId:L,internship_studio_id:L}:f)),y(!1),j(""),alert(`Assigned ${N.displayName} to studio.`),s&&await s("Assign Internship",`Assigned ${N.displayName}`)}catch(n){console.error("Assignment failed:",n)}},$=u.filter(n=>{var f,z;return((f=n.displayName)==null?void 0:f.toLowerCase().includes(p.toLowerCase()))||((z=n.studentId)==null?void 0:z.includes(p))});return d?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roster..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(K,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Search by Name or ID...",value:p,onChange:n=>i(n.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>le(u,"student_roster"),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-bold text-xs",children:"Export CSV"}),e.jsxs("button",{onClick:v,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-indigo-700",children:[e.jsx(ve,{size:16})," Add Student"]})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3",children:"ID"}),e.jsx("th",{className:"p-3",children:"Cohort"}),e.jsx("th",{className:"p-3",children:"Internship"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:$.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-6 text-center text-gray-500",children:"No students found."})}):$.map(n=>e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsx("td",{className:"p-3 font-bold dark:text-white",children:n.displayName}),e.jsx("td",{className:"p-3 text-gray-500",children:n.studentId||"--"}),e.jsx("td",{className:"p-3",children:n.cohort||"General"}),e.jsx("td",{className:"p-3 text-gray-500",children:n.internshipStudioId?e.jsxs("span",{className:"flex items-center gap-1 text-green-600 font-medium text-xs bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded w-fit",children:[e.jsx(ie,{size:12})," Assigned"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"Pending"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>{w(n),y(!0)},className:"p-1.5 bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-300 rounded hover:bg-indigo-100",title:"Assign Internship",children:e.jsx(Re,{size:14})}),e.jsx("button",{onClick:()=>C(n),className:"p-1.5 bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded hover:bg-gray-200",title:"Edit Details",children:e.jsx(ne,{size:14})}),e.jsx("button",{onClick:()=>A(n.id,n.displayName),className:"p-1.5 bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-100",title:"Remove Student",children:e.jsx(M,{size:14})})]})})]},n.id))})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:S?"Edit Student":"Add New Student"}),e.jsx("button",{onClick:()=>o(!1),children:e.jsx(V,{className:"text-gray-400 hover:text-red-500"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"First Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.firstName,onChange:n=>k({...m,firstName:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Last Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.lastName,onChange:n=>k({...m,lastName:n.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Email Address"}),e.jsx("input",{type:"email",className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.email,onChange:n=>k({...m,email:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Student ID"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.studentId,onChange:n=>k({...m,studentId:n.target.value}),placeholder:"e.g. S123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Cohort"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.cohort,onChange:n=>k({...m,cohort:n.target.value}),placeholder:"Fall 2024"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Enrollment Status"}),e.jsxs("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:m.status,onChange:n=>k({...m,status:n.target.value}),children:[e.jsx("option",{value:"Enrolled",children:"Enrolled"}),e.jsx("option",{value:"Graduated",children:"Graduated"}),e.jsx("option",{value:"Dropped",children:"Dropped"}),e.jsx("option",{value:"Leave",children:"On Leave"})]})]}),e.jsx("button",{onClick:E,className:"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 mt-2",children:S?"Update Student":"Create Student Record"})]})}),b&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-sm rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Assign Internship"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Select a partner studio for ",e.jsx("strong",{children:N.displayName}),"."]}),e.jsxs("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:L,onChange:n=>j(n.target.value),children:[e.jsx("option",{value:"",children:"Select Studio..."}),g.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(!1),className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm",children:"Cancel"}),e.jsx("button",{onClick:R,disabled:!L,className:"flex-1 bg-indigo-600 text-white py-2 rounded font-bold disabled:opacity-50",children:"Confirm"})]})]})})]})}function pt({schoolId:t}){const[s,u]=x.useState([]),[a,g]=x.useState(!0),[l,d]=x.useState("all");x.useEffect(()=>{if(!t||!supabase)return;(async()=>{g(!0);try{const{data:r,error:o}=await supabase.from("internship_logs").select("*").eq("school_id",t).order("check_in",{ascending:!1}).limit(100);if(o)throw o;const b=(r||[]).map(y=>{const N=xt(y.check_in,y.check_out);return{id:y.id,...y,checkIn:y.check_in,checkOut:y.check_out,studentId:y.student_id,studentName:y.student_name,duration:N}});u(b)}catch(r){console.error("Error fetching logs:",r)}g(!1)})()},[t]);const h=async(i,r)=>{if(!(!supabase||!t))try{const{error:o}=await supabase.from("internship_logs").update({status:r}).eq("id",i).eq("school_id",t);if(o)throw o;u(b=>b.map(y=>y.id===i?{...y,status:r}:y))}catch(o){console.error("Error updating log:",o),alert("Failed to update log status.")}},p=l==="all"?s:s.filter(i=>i.status===l);return a?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Internship Hours..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{size:16,className:"text-gray-500"}),e.jsxs("select",{className:"bg-white dark:bg-[#1f2128] border dark:border-gray-600 text-sm rounded-md p-1.5 outline-none dark:text-white",value:l,onChange:i=>d(i.target.value),children:[e.jsx("option",{value:"all",children:"All Activity"}),e.jsx("option",{value:"pending_approval",children:"Pending Approval"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"active",children:"Active (Clocked In)"})]})]}),e.jsxs("button",{onClick:()=>le(p,"internship_hours"),className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(qe,{size:14})," Export CSV"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Date"}),e.jsx("th",{className:"p-3",children:"Student"}),e.jsx("th",{className:"p-3",children:"Activity / Description"}),e.jsx("th",{className:"p-3",children:"Duration"}),e.jsx("th",{className:"p-3",children:"Status"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:"No logs found matching criteria."})}):p.map(i=>{var r,o;return e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[e.jsx("div",{className:"font-medium",children:(r=i.checkIn)!=null&&r.toDate?i.checkIn.toDate().toLocaleDateString():"N/A"}),e.jsx("div",{className:"text-[10px] text-gray-400",children:(o=i.checkIn)!=null&&o.toDate?i.checkIn.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:i.studentName}),e.jsxs("td",{className:"p-3 max-w-xs",children:[e.jsxs("span",{className:"block text-[10px] uppercase font-bold text-gray-400 mb-0.5",children:[i.type," • ",i.location]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 truncate block",title:i.description,children:i.description||e.jsx("span",{className:"italic opacity-50",children:"No description provided"})})]}),e.jsx("td",{className:"p-3 font-mono font-bold text-indigo-600 dark:text-indigo-400",children:i.checkOut?gt(i.duration):e.jsx("span",{className:"animate-pulse text-green-500",children:"Active..."})}),e.jsx("td",{className:"p-3",children:e.jsx(bt,{status:i.status})}),e.jsx("td",{className:"p-3 text-right",children:i.status==="pending_approval"&&e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx("button",{onClick:()=>h(i.id,"approved"),className:"p-1.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded hover:bg-green-200 transition",title:"Approve",children:e.jsx(J,{size:16})}),e.jsx("button",{onClick:()=>h(i.id,"rejected"),className:"p-1.5 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-200 transition",title:"Reject",children:e.jsx(De,{size:16})})]})})]},i.id)})})]})})]})}function bt({status:t}){const s={approved:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",rejected:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",pending_approval:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",active:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 animate-pulse"},u={approved:"Approved",rejected:"Rejected",pending_approval:"Pending",active:"In Progress"};return e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-[10px] uppercase font-bold tracking-wide ${s[t]||"bg-gray-100 text-gray-500"}`,children:u[t]||t})}function ft({schoolId:t,course:s,onSave:u,onCancel:a,logAction:g}){const[l,d]=x.useState({title:"",description:"",duration:"",prerequisites:[],category:""}),[h,p]=x.useState([]),[i,r]=x.useState(!1),[o,b]=x.useState(""),[y,N]=x.useState(null);x.useEffect(()=>{s&&(d({title:s.title||"",description:s.description||"",duration:s.duration||"",prerequisites:s.prerequisites||[],category:s.category||""}),w())},[s]);const w=async()=>{if(!(!(s!=null&&s.id)||!supabase))try{const{data:j,error:v}=await supabase.from("lessons").select("*").eq("course_id",s.id).order("order",{ascending:!0});if(v)throw v;const C=(j||[]).map(E=>({id:E.id,...E,courseId:E.course_id}));p(C)}catch(j){console.error("Error loading lessons:",j)}},S=async()=>{if(!l.title.trim()){alert("Course title is required.");return}if(!(!supabase||!t)){r(!0);try{const j={school_id:t,title:l.title,description:l.description||null,duration:l.duration||null,prerequisites:l.prerequisites||[],category:l.category||null,lesson_count:h.length,updated_at:new Date().toISOString()};if(s){const{error:v}=await supabase.from("courses").update(j).eq("id",s.id).eq("school_id",t);if(v)throw v;g&&g("update_course",{courseId:s.id,title:l.title})}else{j.created_at=new Date().toISOString(),j.status="draft";const{data:v,error:C}=await supabase.from("courses").insert(j).select().single();if(C)throw C;g&&g("create_course",{courseId:v.id,title:l.title})}u()}catch(j){console.error("Error saving course:",j),alert("Failed to save course.")}r(!1)}},c=()=>{o.trim()&&!l.prerequisites.includes(o.trim())&&(d(j=>({...j,prerequisites:[...j.prerequisites,o.trim()]})),b(""))},m=j=>{d(v=>({...v,prerequisites:v.prerequisites.filter(C=>C!==j)}))},k=()=>{const j={id:`temp-${Date.now()}`,title:"New Lesson",description:"",type:"video",content:"",order:h.length,duration:0};p([...h,j]),N(j.id)},L=async j=>{if(!(!confirm("Delete this lesson?")||!supabase||!(s!=null&&s.id))){if(j.startsWith("temp-")){p(h.filter(v=>v.id!==j));return}try{await supabase.from("lessons").delete().eq("id",j).eq("course_id",s.id),w()}catch(v){console.error("Error deleting lesson:",v)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:s?"Edit Course":"Create New Course"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsx("button",{onClick:S,disabled:i,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50",children:i?"Saving...":"Save Course"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Course Title *"}),e.jsx("input",{type:"text",value:l.title,onChange:j=>d({...l,title:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., Introduction to Music Production"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:l.description,onChange:j=>d({...l,description:j.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"Course description..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Duration"}),e.jsx("input",{type:"text",value:l.duration,onChange:j=>d({...l,duration:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., 8 weeks"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),e.jsx("input",{type:"text",value:l.category,onChange:j=>d({...l,category:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., Production, Engineering"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Prerequisites"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:o,onChange:j=>b(j.target.value),onKeyPress:j=>j.key==="Enter"&&c(),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"Add prerequisite..."}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.prerequisites.map((j,v)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-full text-sm",children:[j,e.jsx("button",{onClick:()=>m(j),className:"hover:text-indigo-900 dark:hover:text-indigo-100",children:e.jsx(V,{size:14})})]},v))})]})]}),s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Lessons"}),e.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:[e.jsx(U,{size:18}),"Add Lesson"]})]}),e.jsxs("div",{className:"space-y-2",children:[h.map((j,v)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx($e,{className:"text-gray-400 cursor-move",size:18}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium dark:text-white",children:j.title||"Untitled Lesson"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[j.type," • ",j.duration||0," min"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(j.id),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition",children:e.jsx(Edit2,{size:16,className:"text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>L(j.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition",children:e.jsx(M,{size:16,className:"text-red-600 dark:text-red-400"})})]})]},j.id)),h.length===0&&e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No lessons yet. Add your first lesson!"})]})]})]})}function yt({schoolId:t,logAction:s}){const[u,a]=x.useState([]),[g,l]=x.useState(!0),[d,h]=x.useState(""),[p,i]=x.useState(!1),[r,o]=x.useState(null);x.useEffect(()=>{t&&b()},[t]);const b=async()=>{if(!(!t||!supabase)){l(!0);try{const{data:c,error:m}=await supabase.from("courses").select("*").eq("school_id",t).order("created_at",{ascending:!1});if(m)throw m;const k=(c||[]).map(L=>({id:L.id,...L,createdAt:L.created_at}));a(k)}catch(c){console.error("Error loading courses:",c)}l(!1)}},y=()=>{o(null),i(!0)},N=c=>{o(c),i(!0)},w=async c=>{if(!(!confirm("Are you sure you want to delete this course? This action cannot be undone.")||!supabase))try{const{error:m}=await supabase.from("lessons").delete().eq("course_id",c);m&&console.warn("Error deleting lessons (may be handled by CASCADE):",m);const{error:k}=await supabase.from("courses").delete().eq("id",c).eq("school_id",t);if(k)throw k;s&&s("delete_course",{courseId:c}),b()}catch(m){console.error("Error deleting course:",m),alert("Failed to delete course.")}},S=u.filter(c=>{var m,k;return((m=c.title)==null?void 0:m.toLowerCase().includes(d.toLowerCase()))||((k=c.description)==null?void 0:k.toLowerCase().includes(d.toLowerCase()))});return p?e.jsx(ft,{schoolId:t,course:r,onSave:()=>{i(!1),o(null),b()},onCancel:()=>{i(!1),o(null)},logAction:s}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(H,{size:24}),"Courses"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Manage courses and learning materials"})]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition",children:[e.jsx(U,{size:18}),"New Course"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search courses...",value:d,onChange:c=>h(c.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-800 dark:text-white"})]}),g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading courses..."})]}):S.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx(H,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:d?"No courses found matching your search.":"No courses yet. Create your first course!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(c=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-1",children:c.title||"Untitled Course"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:c.description||"No description"})]}),e.jsxs("div",{className:"flex gap-2 ml-2",children:[e.jsx("button",{onClick:()=>N(c),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"Edit course",children:e.jsx(ne,{size:16,className:"text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>w(c.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete course",children:e.jsx(M,{size:16,className:"text-red-600 dark:text-red-400"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{size:14}),e.jsxs("span",{children:[c.lessonCount||0," lessons"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{size:14}),e.jsxs("span",{children:[c.enrollmentCount||0," enrolled"]})]}),c.duration&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{size:14}),e.jsx("span",{children:c.duration})]})]}),c.prerequisites&&c.prerequisites.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Prerequisites:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:c.prerequisites.map((m,k)=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs",children:m},k))})]})]},c.id))})]})}function jt({schoolId:t,logAction:s}){const[u,a]=x.useState([]),[g,l]=x.useState(!0),[d,h]=x.useState(""),[p,i]=x.useState(!1),[r,o]=x.useState(null),[b,y]=x.useState({title:"",description:"",courses:[],badges:[],skills:[],mentorshipEnabled:!1}),[N,w]=x.useState([]);x.useEffect(()=>{t&&(S(),c())},[t]);const S=async()=>{if(!(!t||!supabase)){l(!0);try{const{data:n,error:f}=await supabase.from("learning_paths").select("*").eq("school_id",t).order("created_at",{ascending:!1});if(f)throw f;const z=(n||[]).map(D=>({id:D.id,...D,createdAt:D.created_at,mentorshipEnabled:D.mentorship_enabled||!1}));a(z)}catch(n){console.error("Error loading learning paths:",n)}l(!1)}},c=async()=>{if(!(!t||!supabase))try{const{data:n,error:f}=await supabase.from("courses").select("id, title").eq("school_id",t).order("title",{ascending:!0});if(f)throw f;const z=(n||[]).map(D=>({id:D.id,title:D.title}));w(z)}catch(n){console.error("Error loading courses:",n)}},m=()=>{y({title:"",description:"",courses:[],badges:[],skills:[],mentorshipEnabled:!1}),o(null),i(!0)},k=n=>{y({title:n.title||"",description:n.description||"",courses:n.courses||[],badges:n.badges||[],skills:n.skills||[],mentorshipEnabled:n.mentorshipEnabled||!1}),o(n),i(!0)},L=async()=>{if(!b.title.trim()||!supabase||!t){b.title.trim()||alert("Path title is required.");return}l(!0);try{const n={school_id:t,title:b.title,description:b.description||null,courses:b.courses||[],badges:b.badges||[],skills:b.skills||[],mentorship_enabled:b.mentorshipEnabled||!1,updated_at:new Date().toISOString()};if(r){const{error:f}=await supabase.from("learning_paths").update(n).eq("id",r.id).eq("school_id",t);if(f)throw f;s&&s("update_learning_path",{pathId:r.id,title:b.title})}else{n.created_at=new Date().toISOString();const{data:f,error:z}=await supabase.from("learning_paths").insert(n).select().single();if(z)throw z;s&&s("create_learning_path",{pathId:f.id,title:b.title})}i(!1),o(null),S()}catch(n){console.error("Error saving learning path:",n),alert("Failed to save learning path.")}l(!1)},j=async n=>{if(!(!confirm("Are you sure you want to delete this learning path?")||!supabase))try{const{error:f}=await supabase.from("learning_paths").delete().eq("id",n).eq("school_id",t);if(f)throw f;s&&s("delete_learning_path",{pathId:n}),S()}catch(f){console.error("Error deleting learning path:",f),alert("Failed to delete learning path.")}},v=n=>{y(f=>({...f,courses:f.courses.includes(n)?f.courses.filter(z=>z!==n):[...f.courses,n]}))},C=()=>{const n=prompt("Enter badge name:");n&&!b.badges.includes(n)&&y(f=>({...f,badges:[...f.badges,n]}))},E=n=>{y(f=>({...f,badges:f.badges.filter(z=>z!==n)}))},A=()=>{const n=prompt("Enter skill name:");n&&!b.skills.includes(n)&&y(f=>({...f,skills:[...f.skills,n]}))},R=n=>{y(f=>({...f,skills:f.skills.filter(z=>z!==n)}))},$=u.filter(n=>{var f,z;return((f=n.title)==null?void 0:f.toLowerCase().includes(d.toLowerCase()))||((z=n.description)==null?void 0:z.toLowerCase().includes(d.toLowerCase()))});return p?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:r?"Edit Learning Path":"Create Learning Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{i(!1),o(null)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsx("button",{onClick:L,disabled:g,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50",children:g?"Saving...":"Save Path"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Path Title *"}),e.jsx("input",{type:"text",value:b.title,onChange:n=>y({...b,title:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., Advanced Music Production Track"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:b.description,onChange:n=>y({...b,description:n.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"Learning path description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Courses"}),e.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-3",children:[N.map(n=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:b.courses.includes(n.id),onChange:()=>v(n.id),className:"rounded"}),e.jsx("span",{className:"dark:text-white",children:n.title})]},n.id)),N.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No courses available. Create courses first."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Badges"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:b.badges.map((n,f)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded-full text-sm",children:[e.jsx(B,{size:14}),n,e.jsx("button",{onClick:()=>E(n),className:"hover:text-yellow-900 dark:hover:text-yellow-100",children:e.jsx(V,{size:14})})]},f))}),e.jsx("button",{onClick:C,className:"text-sm text-indigo-600 dark:text-indigo-400 hover:underline",children:"+ Add Badge"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:b.skills.map((n,f)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-sm",children:[e.jsx(ye,{size:14}),n,e.jsx("button",{onClick:()=>R(n),className:"hover:text-blue-900 dark:hover:text-blue-100",children:e.jsx(V,{size:14})})]},f))}),e.jsx("button",{onClick:A,className:"text-sm text-indigo-600 dark:text-indigo-400 hover:underline",children:"+ Add Skill"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"mentorship",checked:b.mentorshipEnabled,onChange:n=>y({...b,mentorshipEnabled:n.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"mentorship",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enable Mentorship Matching"})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(W,{size:24}),"Learning Paths"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Create structured learning programs with courses, badges, and mentorship"})]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition",children:[e.jsx(U,{size:18}),"New Path"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search learning paths...",value:d,onChange:n=>h(n.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-800 dark:text-white"})]}),g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading learning paths..."})]}):$.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx(W,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:d?"No paths found matching your search.":"No learning paths yet. Create your first path!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:$.map(n=>{var f;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-1",children:n.title||"Untitled Path"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:n.description||"No description"})]}),e.jsxs("div",{className:"flex gap-2 ml-2",children:[e.jsx("button",{onClick:()=>k(n),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"Edit path",children:e.jsx(ne,{size:16,className:"text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>j(n.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete path",children:e.jsx(M,{size:16,className:"text-red-600 dark:text-red-400"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(H,{size:14}),e.jsxs("span",{children:[((f=n.courses)==null?void 0:f.length)||0," courses"]})]}),n.badges&&n.badges.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(B,{size:14}),e.jsxs("span",{children:[n.badges.length," badges"]})]}),n.mentorshipEnabled&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-600 dark:text-indigo-400",children:[e.jsx(Z,{size:14}),e.jsx("span",{children:"Mentorship Enabled"})]})]})]},n.id)})})]})}function Nt({schoolId:t,logAction:s}){const[u,a]=x.useState([]),[g,l]=x.useState([]),[d,h]=x.useState(!0),[p,i]=x.useState(""),[r,o]=x.useState("");x.useEffect(()=>{if(!t||!supabase)return;(async()=>{h(!0);try{const{data:N,error:w}=await supabase.from("school_staff").select("*").eq("school_id",t);if(w)throw w;a((N||[]).map(m=>({id:m.id,...m,uid:m.user_id,roleId:m.role_id,roleName:m.role_name,addedAt:m.added_at})));const{data:S,error:c}=await supabase.from("school_roles").select("*").eq("school_id",t);if(c)throw c;l((S||[]).map(m=>({id:m.id,...m})))}catch(N){console.error("Staff load failed:",N)}h(!1)})()},[t]);const b=async()=>{if(!p||!r||!supabase||!t)return alert("Email and Role are required.");try{const{data:y,error:N}=await supabase.from("profiles").select("id, email, first_name, last_name, account_types, school_id").eq("email",p).single();if(N||!y)return alert("User not found. They must sign up for SeshNx first.");const w=y.id,S=g.find(j=>j.id===r),{data:c,error:m}=await supabase.from("school_staff").insert({school_id:t,user_id:w,email:y.email,name:`${y.first_name} ${y.last_name}`,role_id:r,role_name:(S==null?void 0:S.name)||"Unknown",added_at:new Date().toISOString()}).select().single();if(m)throw m;const k=y.account_types||[],L=k.includes("EDUStaff")?k:[...k,"EDUStaff"];await supabase.from("profiles").update({school_id:t,account_types:L}).eq("id",w),a(j=>[...j,{id:c.id,...c,uid:c.user_id,roleId:c.role_id,roleName:c.role_name,addedAt:c.added_at}]),i(""),alert(`${y.first_name} added as ${S==null?void 0:S.name}.`),s&&await s("Add Staff",`Added ${y.email} as ${S==null?void 0:S.name}`)}catch(y){console.error("Add staff error:",y),alert("Failed to add staff member. Check console.")}};return d?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Staff..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ve,{size:18,className:"text-indigo-600"})," Add New Staff Member"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ke,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"User Email Address",value:p,onChange:y=>i(y.target.value)})]}),e.jsxs("div",{className:"relative min-w-[200px]",children:[e.jsx(Q,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsxs("select",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white appearance-none",value:r,onChange:y=>o(y.target.value),children:[e.jsx("option",{value:"",children:"Select Role..."}),g.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsx("button",{onClick:b,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 transition shadow-md",children:"Add Staff"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["* The user must already have a SeshNx account. This will grant them ",e.jsx("strong",{children:"EDUStaff"})," access to this school."]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("span",{className:"font-bold text-sm dark:text-gray-200",children:"Authorized Personnel"}),e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded-full font-bold",children:[u.length," Active"]})]}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:u.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No staff members found."}):u.map(y=>e.jsxs("div",{className:"p-4 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-sm",children:y.name?y.name.charAt(0):"?"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white text-sm",children:y.name}),e.jsx("div",{className:"text-xs text-gray-500",children:y.email})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs font-bold border dark:border-gray-600",children:y.roleName})})]},y.id))})]})]})}function vt({schoolId:t,logAction:s}){const[u,a]=x.useState([]),[g,l]=x.useState(!0),[d,h]=x.useState(!1),[p,i]=x.useState({name:"",color:"#3b82f6",permissions:[]}),[r,o]=x.useState(!1);x.useEffect(()=>{if(!t||!supabase)return;(async()=>{l(!0);try{const{data:m,error:k}=await supabase.from("school_roles").select("*").eq("school_id",t);if(k)throw k;a((m||[]).map(L=>({id:L.id,...L})))}catch(m){console.error("Error loading roles:",m)}l(!1)})()},[t]);const b=async()=>{if(!(!p.name||!supabase||!t)){o(!0);try{const{data:c,error:m}=await supabase.from("school_roles").insert({school_id:t,name:p.name,color:p.color||"#3b82f6",permissions:p.permissions||[]}).select().single();if(m)throw m;a(k=>[...k,{id:c.id,...c}]),s&&await s("Create Role",`Created role: ${p.name}`),i({name:"",color:"#3b82f6",permissions:[]}),h(!1)}catch(c){console.error("Create role failed:",c),alert("Failed to create role.")}o(!1)}},y=async(c,m)=>{if(!(!confirm(`Delete role "${m}"? Staff assigned to this role will lose their permissions.`)||!supabase))try{await supabase.from("school_roles").delete().eq("id",c).eq("school_id",t),a(k=>k.filter(L=>L.id!==c)),s&&await s("Delete Role",`Deleted role: ${m}`)}catch(k){console.error("Delete role failed:",k)}},N=async(c,m)=>{if(!(!supabase||!t)){a(k=>k.map(L=>L.id===c?{...L,permissions:m}:L));try{await supabase.from("school_roles").update({permissions:m}).eq("id",c).eq("school_id",t)}catch(k){console.error("Update perms failed:",k)}}},w=c=>{i(m=>({...m,permissions:m.permissions.includes(c)?m.permissions.filter(k=>k!==c):[...m.permissions,c]}))},S=(c,m)=>{const k=c.permissions||[],L=k.includes(m)?k.filter(j=>j!==m):[...k,m];N(c.id,L)};return g?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roles..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("button",{onClick:()=>h(!0),className:"w-full py-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-500 font-bold hover:bg-gray-50 dark:hover:bg-white/5 transition flex items-center justify-center gap-2",children:[e.jsx(U,{size:20})," Create New Role"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(c=>{var m;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-start bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:c.color}}),c.name]}),e.jsxs("span",{className:"text-[10px] text-gray-400 uppercase tracking-wider font-bold",children:[((m=c.permissions)==null?void 0:m.length)||0," Permissions"]})]}),e.jsx("button",{onClick:()=>y(c.id,c.name),className:"text-gray-400 hover:text-red-500 transition p-1",title:"Delete Role",children:e.jsx(M,{size:16})})]}),e.jsx("div",{className:"p-2 flex-1 overflow-y-auto max-h-[300px] custom-scrollbar",children:e.jsx("div",{className:"space-y-0.5",children:re.map(k=>{var j;const L=(j=c.permissions)==null?void 0:j.includes(k.id);return e.jsxs("label",{className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition ${L?"bg-indigo-50 dark:bg-indigo-900/20":"hover:bg-gray-50 dark:hover:bg-white/5"}`,children:[e.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center ${L?"bg-indigo-600 border-indigo-600":"border-gray-400"}`,children:L&&e.jsx(Ie,{size:10,className:"text-white",strokeWidth:4})}),e.jsx("input",{type:"checkbox",className:"hidden",checked:L,onChange:()=>S(c,k.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-xs font-bold ${L?"text-indigo-700 dark:text-indigo-300":"text-gray-600 dark:text-gray-400"}`,children:k.label}),e.jsx("div",{className:"text-[10px] text-gray-400 leading-tight",children:k.description})]})]},k.id)})})})]},c.id)})}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-xl p-6 space-y-4 max-h-[90vh] overflow-y-auto animate-in zoom-in-95 shadow-2xl",children:[e.jsxs("h3",{className:"font-bold text-xl dark:text-white flex items-center gap-2",children:[e.jsx(Te,{className:"text-indigo-600"})," Create New Role"]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Role Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g. Academic Advisor",value:p.name,onChange:c=>i({...p,name:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Color"}),e.jsx("div",{className:"flex items-center border rounded dark:border-gray-600 p-1 dark:bg-black/20",children:e.jsx("input",{type:"color",className:"h-8 w-8 rounded cursor-pointer border-none bg-transparent",value:p.color,onChange:c=>i({...p,color:c.target.value})})})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Assign Initial Permissions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:re.map(c=>e.jsxs("label",{className:`flex items-start gap-2 p-2 border rounded cursor-pointer transition ${p.permissions.includes(c.id)?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"checkbox",className:"mt-1",checked:p.permissions.includes(c.id),onChange:()=>w(c.id)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-gray-200",children:c.label}),e.jsx("div",{className:"text-[10px] text-gray-500 leading-tight",children:c.description})]})]},c.id))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm",children:"Cancel"}),e.jsx("button",{onClick:b,disabled:r,className:"flex-1 bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700 disabled:opacity-50",children:r?"Saving...":"Create Role"})]})]})})]})}function kt({schoolId:t,logAction:s}){const[u,a]=x.useState([]),[g,l]=x.useState(!0),[d,h]=x.useState({resource:"",limit:4,unit:"hours/week",role:"Student"});x.useEffect(()=>{if(!t||!supabase)return;(async()=>{l(!0);try{const{data:o,error:b}=await supabase.from("resource_rules").select("*").eq("school_id",t);if(b)throw b;a((o||[]).map(y=>({id:y.id,...y})))}catch(o){console.error("Error loading rules:",o)}l(!1)})()},[t]);const p=async()=>{if(!d.resource||!supabase||!t){d.resource||alert("Resource name required.");return}try{const{data:r,error:o}=await supabase.from("resource_rules").insert({school_id:t,resource:d.resource,limit:d.limit,unit:d.unit,role:d.role}).select().single();if(o)throw o;a(b=>[...b,{id:r.id,...r}]),s&&await s("Add Resource Rule",`Set ${d.limit} ${d.unit} limit for ${d.resource}`),h({resource:"",limit:4,unit:"hours/week",role:"Student"})}catch(r){console.error("Add rule failed:",r)}},i=async(r,o)=>{if(!(!confirm("Delete this rule?")||!supabase||!t))try{await supabase.from("resource_rules").delete().eq("id",r).eq("school_id",t),a(b=>b.filter(y=>y.id!==r)),s&&await s("Delete Rule",`Removed rule for ${o}`)}catch(b){console.error("Delete failed:",b)}};return g?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Rules..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(we,{size:18,className:"text-indigo-600"})," Add Restriction / Quota"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Resource Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g. Studio A, SSL Room",value:d.resource,onChange:r=>h({...d,resource:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Limit"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",className:"w-20 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:d.limit,onChange:r=>h({...d,limit:r.target.value})}),e.jsxs("select",{className:"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:d.unit,onChange:r=>h({...d,unit:r.target.value}),children:[e.jsx("option",{value:"hours/week",children:"Hrs/Wk"}),e.jsx("option",{value:"hours/term",children:"Hrs/Term"}),e.jsx("option",{value:"bookings/week",children:"Bookings/Wk"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:p,className:"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2",children:[e.jsx(U,{size:18})," Add Rule"]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Applies To Role"}),e.jsxs("select",{className:"w-full md:w-1/2 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:d.role,onChange:r=>h({...d,role:r.target.value}),children:[e.jsx("option",{value:"Student",children:"All Students"}),e.jsx("option",{value:"Senior",children:"Seniors Only"}),e.jsx("option",{value:"Junior",children:"Juniors Only"}),e.jsx("option",{value:"Probation",children:"Probationary"})]})]})]}),e.jsx("div",{className:"space-y-3",children:u.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No active restrictions. Students have default access."}):u.map(r=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 flex justify-between items-center shadow-sm hover:shadow-md transition",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:r.resource}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300 mt-1",children:[e.jsxs("span",{className:"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 px-2 py-0.5 rounded text-xs font-bold border border-indigo-100 dark:border-indigo-800",children:[r.limit," ",r.unit]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{children:["Applies to: ",e.jsx("strong",{children:r.role})]})]})]}),e.jsx("button",{onClick:()=>i(r.id,r.resource),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:e.jsx(M,{size:18})})]},r.id))})]})}function wt({schoolId:t,logAction:s,user:u,userData:a}){const[g,l]=x.useState([]),[d,h]=x.useState(!0),[p,i]=x.useState(!1),[r,o]=x.useState({title:"",message:"",target:"All"});x.useEffect(()=>{if(!t||!supabase)return;(async()=>{h(!0);try{const{data:w,error:S}=await supabase.from("announcements").select("*").eq("school_id",t).order("created_at",{ascending:!1});if(S)throw S;l((w||[]).map(c=>({id:c.id,...c,schoolId:c.school_id,authorId:c.author_id,authorName:c.author_name,authorRole:c.author_role,createdAt:c.created_at})))}catch(w){console.error("Error loading announcements:",w)}h(!1)})()},[t]);const b=async()=>{if(!r.title.trim()||!r.message.trim()||!supabase){(!r.title.trim()||!r.message.trim())&&alert("Title and Message required.");return}const N=(u==null?void 0:u.id)||(u==null?void 0:u.uid);i(!0);try{const{data:w,error:S}=await supabase.from("announcements").insert({school_id:t,title:r.title,message:r.message,target:r.target,author_id:N,author_name:(a==null?void 0:a.displayName)||(a==null?void 0:a.effectiveDisplayName)||"School Admin",author_role:(a==null?void 0:a.activeProfileRole)||"Admin",created_at:new Date().toISOString()}).select().single();if(S)throw S;l(c=>[{id:w.id,...w,schoolId:w.school_id,authorId:w.author_id,authorName:w.author_name,authorRole:w.author_role,createdAt:w.created_at},...c]),s&&await s("Post Announcement",`Posted: ${r.title}`),o({title:"",message:"",target:"All"})}catch(w){console.error("Post failed:",w),alert("Failed to post announcement.")}i(!1)},y=async N=>{if(!(!confirm("Delete this announcement?")||!supabase))try{await supabase.from("announcements").delete().eq("id",N).eq("school_id",t),l(w=>w.filter(S=>S.id!==N)),s&&await s("Delete Announcement","Removed a post")}catch(w){console.error("Delete failed:",w)}};return d?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading News..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Oe,{size:18,className:"text-indigo-600"})," Post New Announcement"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"Headline / Title",value:r.title,onChange:N=>o({...r,title:N.target.value})})}),e.jsx("div",{className:"sm:w-1/4",children:e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white cursor-pointer",value:r.target,onChange:N=>o({...r,target:N.target.value}),children:[e.jsx("option",{value:"All",children:"Everyone"}),e.jsx("option",{value:"Student",children:"Students Only"}),e.jsx("option",{value:"EDUStaff",children:"Staff Only"})]})})]}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Write your message here...",value:r.message,onChange:N=>o({...r,message:N.target.value})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:b,disabled:p||!r.title,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition",children:p?"Posting...":e.jsxs(e.Fragment,{children:[e.jsx(Fe,{size:16})," Post Announcement"]})})})]})]}),e.jsx("div",{className:"space-y-4",children:g.length===0?e.jsx("div",{className:"text-center text-gray-500 py-10 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No announcements yet."}):g.map(N=>{var w;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm relative group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold dark:text-white",children:N.title}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{size:12})," ",N.authorName]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[N.target==="All"?e.jsx(Z,{size:12}):e.jsx(Q,{size:12}),N.target]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:(w=N.createdAt)!=null&&w.toDate?N.createdAt.toDate().toLocaleDateString():"Just now"})]})]}),e.jsx("button",{onClick:()=>y(N.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition opacity-0 group-hover:opacity-100",title:"Delete Post",children:e.jsx(M,{size:16})})]}),e.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed bg-gray-50 dark:bg-black/20 p-3 rounded-lg",children:N.message})]},N.id)})})]})}function St({schoolId:t,logAction:s}){const[u,a]=x.useState([]),[g,l]=x.useState(!0),[d,h]=x.useState({name:"",address:"",website:"",contactEmail:""});x.useEffect(()=>{if(!t||!supabase)return;(async()=>{l(!0);try{const{data:o,error:b}=await supabase.from("school_partners").select("*").eq("school_id",t).order("name",{ascending:!0});if(b)throw b;a((o||[]).map(y=>({id:y.id,...y})))}catch(o){console.error("Error loading partners:",o)}l(!1)})()},[t]);const p=async()=>{if(!d.name||!supabase||!t){d.name||alert("Partner Name is required.");return}try{const{data:r,error:o}=await supabase.from("school_partners").insert({school_id:t,name:d.name,address:d.address||null,website:d.website||null,contact_email:d.contactEmail||null,status:"Approved"}).select().single();if(o)throw o;a(b=>[...b,{id:r.id,...r}]),s&&await s("Add Partner",`Added studio: ${d.name}`),h({name:"",address:"",website:"",contactEmail:""})}catch(r){console.error("Add partner failed:",r),alert("Failed to add partner.")}},i=async(r,o)=>{if(!(!confirm(`Remove ${o} from approved partners?`)||!supabase||!t))try{await supabase.from("school_partners").delete().eq("id",r).eq("school_id",t),a(b=>b.filter(y=>y.id!==r)),s&&await s("Remove Partner",`Removed: ${o}`)}catch(b){console.error("Delete failed:",b)}};return g?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Partners..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ie,{size:18,className:"text-indigo-600"})," Add Approved Partner"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio / Company Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"e.g. Sound City Studios",value:d.name,onChange:r=>h({...d,name:r.target.value})})]}),e.jsx("div",{children:e.jsx(dt,{label:"Address",value:d.address,onChange:r=>h({...d,address:r}),onSelect:r=>{h({...d,address:r.formattedAddress||r.displayName})},placeholder:"123 Main St...",showGeolocation:!1})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Contact Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{size:14,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-9 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"manager@studio.com",value:d.contactEmail,onChange:r=>h({...d,contactEmail:r.target.value})})]})]})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsxs("button",{onClick:p,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center gap-2 shadow-md transition",children:[e.jsx(U,{size:18})," Add Partner"]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.length===0?e.jsx("div",{className:"col-span-full text-center py-10 text-gray-500 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No partners added yet."}):u.map(r=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition group relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg truncate pr-8",children:r.name}),e.jsx("button",{onClick:()=>i(r.id,r.name),className:"text-gray-400 hover:text-red-500 absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition",children:e.jsx(M,{size:16})})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-300",children:[r.address&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(F,{size:14,className:"mt-0.5 text-indigo-500 shrink-0"}),e.jsx("span",{className:"truncate",children:r.address})]}),r.contactEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:14,className:"text-green-500 shrink-0"}),e.jsx("a",{href:`mailto:${r.contactEmail}`,className:"hover:underline truncate",children:r.contactEmail})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t dark:border-gray-700 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase text-green-600 bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded border border-green-200 dark:border-green-800",children:"Approved"}),r.website&&e.jsx("a",{href:r.website,target:"_blank",rel:"noreferrer",className:"text-gray-400 hover:text-indigo-500",children:e.jsx(Me,{size:14})})]})]},r.id))})]})}function Ct({schoolId:t,logAction:s,graderName:u}){const[a,g]=x.useState([]),[l,d]=x.useState(!0),[h,p]=x.useState(""),[i,r]=x.useState(null),[o,b]=x.useState([]),[y,N]=x.useState(!1),[w,S]=x.useState(!1),[c,m]=x.useState({technical:5,softSkills:5,notes:""});x.useEffect(()=>{if(!t||!supabase)return;(async()=>{d(!0);try{const{data:C,error:E}=await supabase.from("students").select("id, display_name, first_name, last_name, email, status").eq("school_id",t).order("display_name",{ascending:!0});if(E)throw E;g((C||[]).map(A=>({id:A.id,displayName:A.display_name,firstName:A.first_name,lastName:A.last_name,email:A.email,status:A.status})))}catch(C){console.error("Error loading students:",C)}d(!1)})()},[t]),x.useEffect(()=>{if(!i||!supabase||!t)return;(async()=>{N(!0);try{const{data:C,error:E}=await supabase.from("evaluations").select("*").eq("school_id",t).eq("student_id",i.id).order("date",{ascending:!1});if(E)throw E;b((C||[]).map(A=>({id:A.id,...A,softSkills:A.soft_skills,date:A.date})))}catch(C){console.error("Error loading history:",C)}N(!1)})(),S(!1),m({technical:5,softSkills:5,notes:""})},[i,t]);const k=async()=>{if(!(!i||!supabase||!t))try{const{data:v,error:C}=await supabase.from("evaluations").insert({school_id:t,student_id:i.id,technical:c.technical,soft_skills:c.softSkills,notes:c.notes||null,evaluator:u||"EDUStaff",date:new Date().toISOString()}).select().single();if(C)throw C;b(E=>[{id:v.id,...v,softSkills:v.soft_skills,date:v.date},...E]),s&&await s("Grade Student",`Graded ${i.displayName}: Tech(${c.technical}) Soft(${c.softSkills})`),S(!1),alert("Evaluation submitted successfully.")}catch(v){console.error("Grading failed:",v),alert("Failed to save evaluation.")}},L=a.filter(v=>{var C,E;return((C=v.displayName)==null?void 0:C.toLowerCase().includes(h.toLowerCase()))||((E=v.studentId)==null?void 0:E.toLowerCase().includes(h.toLowerCase()))}),j=v=>v>=8?"text-green-500":v>=5?"text-yellow-500":"text-red-500";return l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roster..."}):e.jsxs("div",{className:"flex flex-col md:flex-row h-[600px] border dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-[#2c2e36] animate-in fade-in shadow-sm",children:[e.jsxs("div",{className:"w-full md:w-1/3 border-r dark:border-gray-700 flex flex-col bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Search Students...",value:h,onChange:v=>p(v.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:L.map(v=>e.jsxs("div",{onClick:()=>r(v),className:`p-3 px-4 cursor-pointer flex justify-between items-center transition border-b dark:border-gray-700/50 last:border-0
                                ${(i==null?void 0:i.id)===v.id?"bg-white dark:bg-[#2c2e36] border-l-4 border-l-indigo-600 shadow-sm":"hover:bg-gray-100 dark:hover:bg-gray-700"}
                            `,children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-bold text-sm ${(i==null?void 0:i.id)===v.id?"text-indigo-700 dark:text-white":"dark:text-gray-300"}`,children:v.displayName}),e.jsxs("div",{className:"text-xs text-gray-500",children:[v.cohort||"General"," • ",v.hoursLogged||0," hrs"]})]}),(i==null?void 0:i.id)===v.id&&e.jsx(Ue,{size:16,className:"text-indigo-500"})]},v.id))})]}),e.jsx("div",{className:"flex-1 flex flex-col relative",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-700 dark:text-indigo-300 font-bold",children:i.displayName[0]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold dark:text-white",children:i.displayName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",i.studentId||"N/A"]})]})]}),w?e.jsxs("button",{onClick:()=>S(!1),className:"text-gray-500 hover:text-gray-700 dark:hover:text-white flex items-center gap-2 text-sm font-bold",children:[e.jsx(Ge,{size:16})," View History"]}):e.jsxs("button",{onClick:()=>S(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(U,{size:16})," New Evaluation"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-white dark:bg-[#2c2e36]",children:[w&&e.jsxs("div",{className:"max-w-lg mx-auto space-y-6 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-lg border border-indigo-100 dark:border-indigo-800/50 mb-6",children:[e.jsx("h4",{className:"font-bold text-indigo-800 dark:text-indigo-300 mb-1",children:"New Assessment"}),e.jsxs("p",{className:"text-xs text-indigo-600 dark:text-indigo-400",children:["Rating performance for ",new Date().toLocaleDateString(),"."]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300",children:"Technical Proficiency"}),e.jsxs("span",{className:`font-bold ${j(c.technical)}`,children:[c.technical,"/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"1",className:"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",value:c.technical,onChange:v=>m({...c,technical:parseInt(v.target.value)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Knowledge of equipment, software, and signal flow."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300",children:"Soft Skills / Professionalism"}),e.jsxs("span",{className:`font-bold ${j(c.softSkills)}`,children:[c.softSkills,"/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"1",className:"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",value:c.softSkills,onChange:v=>m({...c,softSkills:parseInt(v.target.value)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Punctuality, attitude, communication, and client handling."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300 block mb-2",children:"Instructor Notes"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Detailed feedback...",value:c.notes,onChange:v=>m({...c,notes:v.target.value})})]}),e.jsxs("button",{onClick:k,className:"w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(Ce,{size:18})," Submit Evaluation"]})]})]}),!w&&e.jsx("div",{className:"space-y-4",children:y?e.jsx("p",{className:"text-center text-gray-500",children:"Loading history..."}):o.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed dark:border-gray-700 rounded-xl",children:[e.jsx(W,{size:32,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No evaluations recorded yet."}),e.jsx("button",{onClick:()=>S(!0),className:"text-indigo-500 font-bold text-sm mt-2 hover:underline",children:"Start first evaluation"})]}):o.map(v=>{var C;return e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-4 hover:shadow-md transition bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mb-1",children:(C=v.date)!=null&&C.toDate?v.date.toDate().toLocaleDateString():"Unknown Date"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium dark:text-gray-200",children:v.evaluator})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600",children:[e.jsx("div",{className:`font-bold ${j(v.technical)}`,children:v.technical}),e.jsx("div",{className:"text-[9px] text-gray-400 uppercase",children:"Tech"})]}),e.jsxs("div",{className:"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600",children:[e.jsx("div",{className:`font-bold ${j(v.softSkills)}`,children:v.softSkills}),e.jsx("div",{className:"text-[9px] text-gray-400 uppercase",children:"Soft"})]})]})]}),v.notes&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 border-t dark:border-gray-700 pt-3 mt-2",children:['"',v.notes,'"']})]},v.id)})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(W,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"Select a student to view history or submit grades."})]})})]})}function _t({schoolId:t,logAction:s}){const[u,a]=x.useState(""),[g,l]=x.useState(!1),d=async()=>{var o;if(!u.trim()||!supabase||!t){u.trim()||alert("Please paste CSV data first.");return}l(!0);const p=u.trim().split(`
`);let i=0,r=0;try{const b=[];for(let y of p){const N=y.split(",");if(N.length>=3){const w=N[0].trim(),S=N[1].trim(),c=N[2].trim(),m=((o=N[3])==null?void 0:o.trim())||"General",k=`${S} ${c}`;w&&S?(b.push({school_id:t,email:w,display_name:k,first_name:S,last_name:c,cohort:m,student_id:null,status:"Enrolled",hours_logged:0,created_at:new Date().toISOString()}),i++):r++}else r++}if(b.length>0){const{error:y}=await supabase.from("students").insert(b);if(y)throw y}s&&await s("Batch Import",`Imported ${i} students. (${r} skipped)`),alert(`Import complete! Added ${i} students.`),a("")}catch(b){console.error("Import failed:",b),alert("Batch import encountered an error.")}l(!1)},h=async()=>{prompt("Type 'ROLLOVER' to confirm. This will archive current internship logs for all students.")==="ROLLOVER"&&(alert("Rollover process initiated. (This is a placeholder for the Cloud Function trigger)."),await s("Term Rollover","Initiated term archival"))};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(He,{size:18,className:"text-indigo-600"})," Batch Import Students"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-4 border border-blue-100 dark:border-blue-800 text-xs text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Format:"})," ",e.jsx("code",{children:"email, first_name, last_name, cohort"}),e.jsx("br",{}),"Example: ",e.jsx("code",{children:"student@test.edu, John, Doe, Fall 2024"})]}),e.jsx("textarea",{className:"w-full h-40 p-3 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono resize-y focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"Paste CSV data here...",value:u,onChange:p=>a(p.target.value),disabled:g}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:d,disabled:g||!u,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition",children:g?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:16})," Import Students"]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Be,{size:18,className:"text-orange-500"})," Term Management"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-gray-200 mb-1",children:"End of Term Rollover"}),e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Use this tool at the end of a semester or cohort period. It will:"}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 mt-2 space-y-1 ml-1",children:[e.jsx("li",{children:"Archive all active internship logs."}),e.jsx("li",{children:'Reset "Current Hours" counters (preserving Total Lifetime Hours).'}),e.jsx("li",{children:'Mark graduating students as "Alumni" (optional).'})]})]}),e.jsx("div",{className:"w-full md:w-auto",children:e.jsxs("button",{onClick:h,className:"w-full md:w-auto bg-red-50 hover:bg-red-100 dark:bg-red-900/20 dark:hover:bg-red-900/40 text-red-600 dark:text-red-400 px-4 py-3 rounded-lg font-bold text-xs flex items-center justify-center gap-2 border border-red-200 dark:border-red-800 transition",children:[e.jsx(Ve,{size:16})," Execute Rollover"]})})]})]})]})}function Et({schoolId:t}){const[s,u]=x.useState([]),[a,g]=x.useState(!0),[l,d]=x.useState(50);x.useEffect(()=>{if(!t||!supabase)return;(async()=>{g(!0);try{const{data:i,error:r}=await supabase.from("audit_logs").select("*").eq("school_id",t).order("timestamp",{ascending:!1}).limit(l);if(r)throw r;u((i||[]).map(o=>({id:o.id,...o,adminName:o.admin_name,timestamp:o.timestamp?new Date(o.timestamp):null})))}catch(i){console.error("Error loading audit logs:",i)}g(!1)})()},[t,l]);const h=p=>p.includes("Delete")||p.includes("Remove")?"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400":p.includes("Create")||p.includes("Add")?"text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400":p.includes("Update")||p.includes("Edit")?"text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 bg-gray-100 dark:bg-gray-700 dark:text-gray-300";return a&&s.length===0?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Audit Trail..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(je,{size:16}),e.jsxs("span",{children:["Showing last ",e.jsx("strong",{children:s.length})," actions"]})]}),e.jsxs("button",{onClick:()=>le(s,"audit_logs"),className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(_e,{size:14})," Export Log"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Timestamp"}),e.jsx("th",{className:"p-3",children:"Admin / Staff"}),e.jsx("th",{className:"p-3",children:"Action Type"}),e.jsx("th",{className:"p-3",children:"Details"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-gray-500",children:"No audit history found."})}):s.map(p=>{var i;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-gray-500 whitespace-nowrap flex items-center gap-2",children:[e.jsx(Y,{size:14,className:"opacity-50"}),(i=p.timestamp)!=null&&i.toDate?p.timestamp.toDate().toLocaleString():"N/A"]}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{size:14,className:"text-indigo-500"}),p.adminName||"System"]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider ${h(p.action)}`,children:p.action})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-300 font-mono text-xs",children:p.details})]},p.id)})})]})}),s.length>=l&&e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{onClick:()=>d(p=>p+50),className:"text-xs font-bold text-indigo-600 hover:underline",children:"Load Older Logs"})})]})}function Lt({schoolId:t,initialData:s,logAction:u,refreshMeta:a}){const[g,l]=x.useState(s||{}),{uploadImage:d,uploading:h}=it();x.useEffect(()=>{s&&l(s)},[s]);const p=async()=>{if(!(!supabase||!t))try{const o={name:g.name,primary_color:g.primaryColor,website:g.website||null,contact_email:g.contactEmail||null,address:g.address||null,description:g.description||null,enabled_features:g.enabledFeatures||{},updated_at:new Date().toISOString()},{error:b}=await supabase.from("schools").update(o).eq("id",t);if(b)throw b;alert("School settings updated successfully."),a&&a(g),u&&await u("Update Settings","Updated school configuration")}catch(o){console.error("Update failed:",o),alert("Failed to update school settings.")}},i=async o=>{const b=o.target.files[0];if(!(!b||!t||!supabase))try{const y=await d(b,`schools/${t}/images/logo`);y&&(await supabase.from("schools").update({logo_url:y,updated_at:new Date().toISOString()}).eq("id",t),l(N=>({...N,logoURL:y,logo_url:y})),a&&a({...g,logoURL:y}),u&&await u("Update Logo","Uploaded new school logo"))}catch(y){console.error("Logo upload failed",y),alert("Failed to upload logo.")}},r=o=>{l(b=>({...b,[o]:!b[o]}))};return!g.name&&!s?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Settings..."}):e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("section",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"h-32 w-32 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300 dark:border-gray-600",children:[g.logoURL?e.jsx("img",{src:g.logoURL,className:"h-full w-full object-contain",alt:"Logo"}):e.jsx(G,{size:40,className:"text-gray-400"}),h&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white text-xs",children:"Uploading..."})]}),e.jsxs("label",{className:"absolute bottom-2 right-2 bg-indigo-600 p-2 rounded-full text-white cursor-pointer shadow-lg hover:bg-indigo-700 transition",children:[e.jsx(We,{size:14}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:i,disabled:h})]})]}),e.jsxs("div",{className:"flex-1 w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"School Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:g.name||"",onChange:o=>l({...g,name:o.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Primary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",className:"h-10 w-10 p-0 border-0 rounded cursor-pointer",value:g.primaryColor||"#4f46e5",onChange:o=>l({...g,primaryColor:o.target.value})}),e.jsx("input",{className:"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono",value:g.primaryColor||"",onChange:o=>l({...g,primaryColor:o.target.value})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:g.address||"",onChange:o=>l({...g,address:o.target.value})})]})]})]})]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Website"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:g.website||"",onChange:o=>l({...g,website:o.target.value}),placeholder:"https://"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Contact Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:g.contactEmail||"",onChange:o=>l({...g,contactEmail:o.target.value}),placeholder:"admin@school.edu"})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2",children:[e.jsx(W,{size:18,className:"text-indigo-600"})," Academic Structure"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Cohort Mode"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:g.cohortMode||"Semester",onChange:o=>l({...g,cohortMode:o.target.value}),children:[e.jsx("option",{value:"Semester",children:"Semester Based"}),e.jsx("option",{value:"Trimester",children:"Trimester"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Rolling",children:"Rolling"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Grading Scale"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:g.gradingScale||"1-10",onChange:o=>l({...g,gradingScale:o.target.value}),children:[e.jsx("option",{value:"1-10",children:"Numeric (1-10)"}),e.jsx("option",{value:"Pass/Fail",children:"Pass/Fail"}),e.jsx("option",{value:"Letter",children:"Letter Grades"})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2",children:[e.jsx(Ke,{size:18,className:"text-indigo-600"})," Operational Rules"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Strict Geofencing"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Require GPS location match for clock-in"})]}),e.jsx("button",{onClick:()=>r("geofencing"),children:g.geofencing?e.jsx(pe,{size:24,className:"text-indigo-600"}):e.jsx(be,{size:24,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Supervisor Approval"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Require partner studio sign-off on hours"})]}),e.jsx("button",{onClick:()=>r("requireApproval"),children:g.requireApproval?e.jsx(pe,{size:24,className:"text-indigo-600"}):e.jsx(be,{size:24,className:"text-gray-400"})})]})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:p,className:"w-full sm:w-auto bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(Ce,{size:18})," Save Configuration"]})})]})}function Le({user:t,userData:s,allowedTabs:u,staffTitle:a,currentView:g}){let l;try{l=ee()}catch{l=null}const d=(l==null?void 0:l.user)||t,h=(l==null?void 0:l.userData)||s,{schoolId:p}=X(),i=g?g.replace("edu-",""):u?u[0]:"overview",[r,o]=x.useState(p||null),[b,y]=x.useState(null),[N,w]=x.useState([]),[S,c]=x.useState(!1),[m,k]=x.useState({name:"",address:"",primaryColor:"#4f46e5"}),L=lt(h);x.useEffect(()=>{L&&supabase&&(async()=>{try{const{data:E,error:A}=await supabase.from("schools").select("*").order("name");if(A)throw A;const R=E||[];w(R),!r&&!p&&R.length>0&&o(R[0].id)}catch(E){console.error("Error fetching schools list:",E)}})()},[L,r,p]),x.useEffect(()=>{if(!r||!supabase)return;(async()=>{try{const{data:E,error:A}=await supabase.from("schools").select("*").eq("id",r).single();if(A)throw A;E&&y(E)}catch(E){console.error("Error loading school meta:",E)}})()},[r]);const j=async(C,E)=>{if(!(!r||!supabase))try{const A=(d==null?void 0:d.id)||(d==null?void 0:d.uid);await supabase.from("audit_logs").insert({school_id:r,action:C,details:E,admin_id:A,admin_name:`${(h==null?void 0:h.firstName)||""} ${(h==null?void 0:h.lastName)||""}`.trim(),created_at:new Date().toISOString()})}catch(A){console.error("Failed to log action:",A)}},v=async()=>{var C;if(!(!m.name||!supabase)){if(!L){alert("Only SeshNx Platform Administrators can create new schools. Please contact a platform administrator."),c(!1);return}try{const{data:E,error:A}=await supabase.from("schools").insert({name:m.name,address:m.address||null,primary_color:m.primaryColor||"#4f46e5",required_hours:100,created_at:new Date().toISOString()}).select().single();if(A)throw A;if(!E)throw new Error("School creation failed - no data returned");const{error:R}=await supabase.from("school_roles").insert({school_id:E.id,name:"Admin",color:"#dc2626",permissions:re.map($=>$.id)});R&&console.error("Error creating default admin role:",R),w($=>[...$,E]),o(E.id),c(!1),k({name:"",address:"",primaryColor:"#4f46e5"})}catch(E){console.error("Error creating school:",E),(C=E.message)!=null&&C.includes("permission")||E.code==="PGRST301"?alert("Permission denied. Only SeshNx Platform Administrators can create new schools."):alert("Failed to create school. Please try again.")}}};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6 relative overflow-hidden",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2 z-10",children:b!=null&&b.logoURL?e.jsx("img",{src:b.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(G,{size:40,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left z-10",children:[e.jsxs("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight flex items-center justify-center md:justify-start gap-3",children:[(b==null?void 0:b.name)||"Select School",L&&!a&&e.jsxs("div",{className:"relative group",children:[e.jsx("select",{className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",value:r||"",onChange:C=>o(C.target.value),children:N.map(C=>e.jsx("option",{value:C.id,children:C.name},C.id))}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 border-none rounded-lg text-sm font-bold p-1 px-2 flex items-center gap-1 pointer-events-none group-hover:bg-gray-200 dark:group-hover:bg-gray-600 transition",children:[e.jsx("span",{children:"Switch"})," ",e.jsx(Q,{size:10})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400 mt-1",children:[a?e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:[a," Dashboard"]}):e.jsx("span",{className:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Global Admin Mode"}),(b==null?void 0:b.address)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{size:12})," ",b.address]})]})]})]}),L&&e.jsx("div",{className:"z-10",children:e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 transition shadow-md",children:[e.jsx(U,{size:16})," New School"]})}),e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-indigo-600/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"})]}),e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 min-h-[400px] p-4",children:r?e.jsxs(e.Fragment,{children:[i==="overview"&&e.jsx(mt,{schoolId:r,schoolData:b}),i==="roster"&&e.jsx(ht,{schoolId:r,logAction:j}),i==="hours"&&e.jsx(pt,{schoolId:r}),i==="courses"&&e.jsx(yt,{schoolId:r,logAction:j}),i==="learning-paths"&&e.jsx(jt,{schoolId:r,logAction:j}),i==="instructors"&&e.jsx(Nt,{schoolId:r,logAction:j}),i==="roles"&&e.jsx(vt,{schoolId:r,logAction:j}),i==="resources"&&e.jsx(kt,{schoolId:r,logAction:j}),i==="news"&&e.jsx(wt,{schoolId:r,logAction:j,user:d,userData:h}),i==="partners"&&e.jsx(St,{schoolId:r,logAction:j}),i==="evaluations"&&e.jsx(Ct,{schoolId:r,logAction:j,graderName:h.displayName}),i==="cohorts"&&e.jsx(_t,{schoolId:r,logAction:j}),i==="audit"&&e.jsx(Et,{schoolId:r}),i==="settings"&&e.jsx(Lt,{schoolId:r,initialData:b,logAction:j,refreshMeta:C=>y(E=>({...E,...C}))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-gray-500",children:[e.jsx(G,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"Please select or create a school to manage."})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Create School"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"School Name",value:m.name,onChange:C=>k({...m,name:C.target.value})}),e.jsx("button",{onClick:v,className:"w-full bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700",children:"Create"}),e.jsx("button",{onClick:()=>c(!1),className:"w-full text-gray-500 text-sm hover:underline",children:"Cancel"})]})})]})}const Ot=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));function zt({user:t,userData:s,currentView:u}){let a;try{a=ee()}catch{a=null}const g=(a==null?void 0:a.user)||t,l=(a==null?void 0:a.userData)||s,{myPermissions:d,staffProfile:h}=X(),p={manage_roster:"roster",manage_enrollment:"cohorts",approve_hours:"hours",manage_partners:"partners",grade_students:"evaluations",post_announcements:"news",manage_resources:"resources",manage_staff:"instructors",view_audit:"audit",edit_settings:"settings"},i=d.includes("ALL")?Object.values(p):d.map(r=>p[r]).filter(Boolean);return i.length===0&&!d.includes("ALL")?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-gray-500",children:[e.jsx(we,{size:48,className:"mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-bold",children:"Access Restricted"}),e.jsx("p",{children:"You are listed as staff but have no assigned permissions."})]}):e.jsx(Le,{user:g,userData:l,allowedTabs:i,staffTitle:h==null?void 0:h.roleName,currentView:u})}const Ft=Object.freeze(Object.defineProperty({__proto__:null,default:zt},Symbol.toStringTag,{value:"Module"}));export{dt as A,It as E,$t as S,qt as _,it as a,Tt as b,Ot as c,Ft as d,Dt as f,X as u};
