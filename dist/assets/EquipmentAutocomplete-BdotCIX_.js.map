{"version":3,"file":"EquipmentAutocomplete-BdotCIX_.js","sources":["../../src/hooks/useEquipmentDatabase.js","../../src/hooks/useEquipmentSearch.js","../../src/components/shared/EquipmentAutocomplete.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { getEquipmentGrouped } from '../config/neonQueries';\r\n\r\n/**\r\n * Hook to fetch equipment database from Neon\r\n * Returns all equipment items grouped by category for use in autocomplete/search\r\n */\r\nexport const useEquipmentDatabase = () => {\r\n    const [dbData, setDbData] = useState({});\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            setLoading(true);\r\n\r\n            try {\r\n                // Fetch all verified equipment items grouped by category\r\n                const grouped = await getEquipmentGrouped();\r\n\r\n                // Transform data to match expected format\r\n                const transformed = {};\r\n                for (const [category, subcategories] of Object.entries(grouped)) {\r\n                    transformed[category] = {};\r\n                    for (const [subcategory, items] of Object.entries(subcategories)) {\r\n                        transformed[category][subcategory] = items.map(item => ({\r\n                            id: item.id,\r\n                            name: item.name,\r\n                            brand: item.brand || 'Unknown',\r\n                            model: item.model,\r\n                            category: category,\r\n                            subCategory: subcategory,\r\n                            description: item.description,\r\n                            specifications: item.specifications,\r\n                            searchTokens: [],\r\n                            original: item\r\n                        }));\r\n                    }\r\n                }\r\n\r\n                setDbData(transformed);\r\n            } catch (error) {\r\n                console.error(\"Failed to load equipment database:\", error);\r\n                setDbData({});\r\n            }\r\n\r\n            setLoading(false);\r\n        };\r\n\r\n        fetchData();\r\n    }, []);\r\n\r\n    return {\r\n        loading,\r\n        data: dbData\r\n    };\r\n};\r\n","import { useState, useMemo } from 'react';\r\nimport { useEquipmentDatabase } from './useEquipmentDatabase';\r\n\r\n/**\r\n * Hook for searching equipment database\r\n * Provides search functionality for the EquipmentAutocomplete component\r\n */\r\nexport const useEquipmentSearch = () => {\r\n    const { data: equipData, loading } = useEquipmentDatabase();\r\n    const [results, setResults] = useState([]);\r\n    \r\n    // Flatten the database into a single searchable list\r\n    const allItems = useMemo(() => {\r\n        if (loading || !equipData) return [];\r\n        let flattened = [];\r\n        \r\n        try {\r\n            // Iterate through categories\r\n            Object.keys(equipData).forEach(categoryKey => {\r\n                const categoryData = equipData[categoryKey];\r\n                if (!categoryData || typeof categoryData !== 'object') return;\r\n\r\n                // Iterate through subcategories\r\n                Object.entries(categoryData).forEach(([subcategoryKey, subcategoryItems]) => {\r\n                    if (!Array.isArray(subcategoryItems)) return;\r\n\r\n                    // Process each item in the subcategory\r\n                    subcategoryItems.forEach(item => {\r\n                        if (!item || typeof item !== 'object') return;\r\n\r\n                        // Extract data\r\n                        const brand = item.brand || 'Unknown';\r\n                        const name = item.name || item.model || 'Unknown Item';\r\n                        const subCategory = item.subCategory || subcategoryKey;\r\n                        \r\n                        // Build search string from name, brand, model, and search tokens\r\n                        const searchTokens = item.searchTokens || [];\r\n                        const searchString = [\r\n                            name,\r\n                            brand,\r\n                            item.model,\r\n                            ...searchTokens\r\n                        ].filter(Boolean).join(' ').toLowerCase();\r\n\r\n                        flattened.push({\r\n                            id: item.id,\r\n                            name: name,\r\n                            brand: brand,\r\n                            model: item.model || name,\r\n                            category: item.category || categoryKey,\r\n                            subCategory: subCategory,\r\n                            searchString: searchString,\r\n                            original: item.original || item\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n        } catch (err) {\r\n            console.warn(\"Error processing equipment data:\", err);\r\n        }\r\n\r\n        return flattened;\r\n    }, [equipData, loading]);\r\n\r\n    const searchEquipment = (searchTerm) => {\r\n        if (!searchTerm || searchTerm.trim().length < 1) {\r\n            setResults([]);\r\n            return;\r\n        }\r\n\r\n        // Split user query into individual terms\r\n        const queryTerms = searchTerm.toLowerCase().trim().split(/\\s+/).filter(term => term.length > 0);\r\n        \r\n        if (queryTerms.length === 0) {\r\n            setResults([]);\r\n            return;\r\n        }\r\n        \r\n        // Filter: Item must match ALL terms\r\n        const filteredResults = allItems.filter(item => {\r\n            // Check if all query terms are found in the search string\r\n            return queryTerms.every(term => item.searchString.includes(term));\r\n        })\r\n        .slice(0, 50); // Limit results for performance\r\n\r\n        setResults(filteredResults);\r\n    };\r\n\r\n    return { searchEquipment, results, loading };\r\n};\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { Search, X, Loader2, Disc } from 'lucide-react';\r\nimport { useEquipmentSearch } from '../../hooks/useEquipmentSearch';\r\n\r\nexport default function EquipmentAutocomplete({ \r\n    onSelect, \r\n    placeholder = \"Search for gear (e.g. U87, SSL)...\", \r\n    className = \"\",\r\n    value,      // Controlled value prop\r\n    onChange,   // Controlled change handler\r\n    multi = false // Toggle for comma-separated list behavior\r\n}) {\r\n    const { searchEquipment, results, loading } = useEquipmentSearch();\r\n    const [localQuery, setLocalQuery] = useState('');\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const wrapperRef = useRef(null);\r\n\r\n    // Determine value to display (Controlled vs Uncontrolled)\r\n    const displayValue = value !== undefined ? value : localQuery;\r\n\r\n    // Close dropdown when clicking outside\r\n    useEffect(() => {\r\n        function handleClickOutside(event) {\r\n            if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\r\n                setIsOpen(false);\r\n            }\r\n        }\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, [wrapperRef]);\r\n\r\n    const handleInputChange = (e) => {\r\n        const val = e.target.value;\r\n        \r\n        // Update State/Parent\r\n        if (onChange) onChange(val);\r\n        else setLocalQuery(val);\r\n\r\n        // Determine Search Term\r\n        // If multi, search only the text after the last comma\r\n        const searchTerm = multi ? val.split(',').pop().trim() : val;\r\n\r\n        if (searchTerm.length >= 2) {\r\n            searchEquipment(searchTerm);\r\n            setIsOpen(true);\r\n        } else {\r\n            setIsOpen(false);\r\n        }\r\n    };\r\n\r\n    const handleSelect = (item) => {\r\n        // Construct a full display name\r\n        const fullName = item.brand !== 'Various' && item.brand !== 'Unknown' \r\n            ? `${item.brand} ${item.name}` \r\n            : item.name;\r\n            \r\n        if (multi) {\r\n            // Split by comma, remove the partial term being typed\r\n            const terms = displayValue.split(',');\r\n            terms.pop(); \r\n            \r\n            // Clean up existing terms and append the new selection\r\n            const cleanTerms = terms.map(t => t.trim()).filter(Boolean);\r\n            const newValue = [...cleanTerms, fullName].join(', ') + ', ';\r\n            \r\n            if (onChange) onChange(newValue);\r\n            else setLocalQuery(newValue);\r\n        } else {\r\n            // Standard single select behavior\r\n            if (onSelect) onSelect({ ...item, fullName });\r\n            if (onChange) onChange(fullName);\r\n            else setLocalQuery(fullName); // Or clear it depending on UX, sticking to filling input here\r\n        }\r\n        \r\n        setIsOpen(false);\r\n    };\r\n\r\n    return (\r\n        <div ref={wrapperRef} className={`relative ${className}`}>\r\n            <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-3 text-gray-400\" size={16} />\r\n                <input \r\n                    className=\"w-full pl-9 pr-8 p-3 text-sm border rounded-xl bg-white dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none transition-all\"\r\n                    placeholder={placeholder}\r\n                    value={displayValue}\r\n                    onChange={handleInputChange}\r\n                    onFocus={(e) => handleInputChange(e)} // Trigger search on focus if text exists\r\n                />\r\n                {displayValue && (\r\n                    <button \r\n                        type=\"button\"\r\n                        onClick={() => { \r\n                            if(onChange) onChange(''); \r\n                            else setLocalQuery(''); \r\n                            setIsOpen(false); \r\n                        }}\r\n                        className=\"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200\"\r\n                    >\r\n                        <X size={16}/>\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {isOpen && results.length > 0 && (\r\n                <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-60 overflow-y-auto animate-in fade-in slide-in-from-top-2\">\r\n                    <div className=\"py-1\">\r\n                        {results.map((item) => (\r\n                            <button\r\n                                key={item.id}\r\n                                type=\"button\"\r\n                                onClick={() => handleSelect(item)}\r\n                                className=\"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group\"\r\n                            >\r\n                                <div className=\"font-bold text-sm dark:text-white group-hover:text-brand-blue transition-colors\">\r\n                                    {item.name}\r\n                                </div>\r\n                                <div className=\"text-xs text-gray-500 flex items-center gap-1.5 mt-0.5\">\r\n                                    <span className=\"font-medium text-gray-600 dark:text-gray-400\">{item.brand}</span>\r\n                                    <span className=\"w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600\"></span>\r\n                                    <span className=\"opacity-75\">{item.subCategory?.replace(/_/g, ' ')}</span>\r\n                                </div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n            \r\n            {isOpen && loading && (\r\n                <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2\">\r\n                    <Loader2 className=\"animate-spin\" size={16}/> Searching database...\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":["useEquipmentDatabase","dbData","setDbData","useState","loading","setLoading","useEffect","grouped","getEquipmentGrouped","transformed","category","subcategories","subcategory","items","item","error","useEquipmentSearch","equipData","results","setResults","allItems","useMemo","flattened","categoryKey","categoryData","subcategoryKey","subcategoryItems","brand","name","subCategory","searchTokens","searchString","err","searchTerm","queryTerms","term","filteredResults","EquipmentAutocomplete","onSelect","placeholder","className","value","onChange","multi","searchEquipment","localQuery","setLocalQuery","isOpen","setIsOpen","wrapperRef","useRef","displayValue","handleClickOutside","event","handleInputChange","e","val","handleSelect","fullName","terms","newValue","t","jsxs","jsx","Search","X","Loader2"],"mappings":"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"}