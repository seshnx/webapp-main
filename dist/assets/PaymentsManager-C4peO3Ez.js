import{r as d,j as e,bV as f,ci as N,L as b,c0 as C,m as B,$ as _,a5 as L,cl as M,i as $,af as D}from"./vendor-DbwibLS8.js";import{s as j}from"./chat-DLxlXx9h.js";import{SUBSCRIPTION_PLAN_KEYS as z}from"./config-yUl3KxdD.js";import"./vendor-stripe-OXK3Micb.js";import"./vendor-framer-BrJw1elJ.js";const R=()=>{const[s,o]=d.useState({tierData:null,tokenPackages:null}),[i,c]=d.useState(!0),{DEFAULT_TIER_DATA:a,FALLBACK_TOKEN_PACKAGES:x}=d.useMemo(()=>({DEFAULT_TIER_DATA:{FREE:{name:"Free",price:0,feeMultiplier:1.2,features:["1 Broadcast Request / month","Cannot list on SeshFx Market"],limits:{broadcastsPerMonth:1,sessionsPerWeek:2,canListMarket:!1,monthlyTokens:0}},BASIC:{name:"Basic",price:4.99,feeMultiplier:1.1,features:["3 Broadcast Requests / month","10 Booked Sessions / week","Can list on SeshFx Market (5 items)"],limits:{broadcastsPerMonth:3,sessionsPerWeek:10,canListMarket:!0,monthlyTokens:25}},PRO:{name:"Pro Creative",price:14.99,feeMultiplier:1.02,features:["15 Broadcast Requests / month","Unlimited Booked Sessions","Profile Search Boost"],limits:{broadcastsPerMonth:15,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}},STUDIO:{name:"Studio Business",price:29.99,feeMultiplier:1,features:["Studio Manager Component Access","Unlimited Broadcast Requests","0% Session Fees"],limits:{broadcastsPerMonth:999,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}}},FALLBACK_TOKEN_PACKAGES:[{id:"pack_small",tokens:100,price:4.99,label:"Starter Stash"},{id:"pack_medium",tokens:550,price:19.99,label:"Producer Pack",highlight:!0},{id:"pack_large",tokens:1200,price:39.99,label:"Studio Vault"}]}),[]);d.useEffect(()=>{{c(!1);return}},[a,x]);const l=m=>{var u,h;const g=((u=s.tierData)==null?void 0:u[m])||((h=s.tierData)==null?void 0:h.FREE);return g?g.feeMultiplier:a.FREE.feeMultiplier};return{tierData:s.tierData||a,tokenPackages:s.tokenPackages||x,loading:i,getFeeMultiplier:l}},I=async s=>{throw s<=0?new Error("No funds available to cash out."):new Error("Database not available.")};function G({user:s,userData:o}){var E;const[i,c]=d.useState("store"),[a,x]=d.useState({balance:0,escrowBalance:0,payoutBalance:0}),[l,m]=d.useState(!1),{tierData:g,tokenPackages:u,loading:h}=R(),y=(o==null?void 0:o.currentTier)||z.FREE,p=(E=o==null?void 0:o.accountTypes)==null?void 0:E.some(t=>["Talent","Producer","Engineer","Studio","Composer","Technician","Label","Agent"].includes(t));d.useEffect(()=>{if(!(s!=null&&s.id)&&!(s!=null&&s.uid)||!j)return;const t=(s==null?void 0:s.id)||(s==null?void 0:s.uid),r=async()=>{try{const{data:n,error:k}=await j.from("wallets").select("*").eq("user_id",t).single();if(k&&k.code!=="PGRST116"){console.error("Error loading wallet:",k);return}x(n?{balance:n.balance||0,escrowBalance:n.escrow_balance||0,payoutBalance:n.payout_balance||0}:{balance:0,escrowBalance:0,payoutBalance:0})}catch(n){console.error("Wallet load error:",n)}};r();const v=j.channel(`wallet-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"wallets",filter:`user_id=eq.${t}`},()=>{r()}).subscribe();return()=>{j.removeChannel(v)}},[s==null?void 0:s.id,s==null?void 0:s.uid]);const w=async(t,r="payment")=>{{alert("Payment system unavailable. Please refresh and try again.");return}},P=t=>{if(!t.stripePriceId)return alert("Configuration Error: This package is missing a Stripe Price ID.");w(t.stripePriceId,"payment")},T=t=>{if(!t.stripePriceId)return alert("Configuration Error: This plan is missing a Stripe Price ID.");w(t.stripePriceId,"subscription")},S=async()=>{if(p){if(a.payoutBalance<=0)return alert("No funds available for cash out.");if(window.confirm(`Cash out $${a.payoutBalance.toFixed(2)} to your connected account?`)){m(!0);try{await I(a.payoutBalance),alert("Cash out initiated! Funds should arrive in your bank account shortly.")}catch(t){alert(t.message)}finally{m(!1)}}}},F=Object.values(g).sort((t,r)=>t.id===y?-1:r.id===y?1:t.price-r.price),A=t=>{const r=(t-1)*100;return r>0?`+${r.toFixed(0)}% Service Fee`:r===0?"0% Service Fee":`-${Math.abs(r).toFixed(0)}% Fee (Discount)`};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 pb-24",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(f,{size:32,className:"text-green-500"})," My Wallet"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage tokens, subscriptions, and earnings."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-500/10 rounded-full",children:e.jsx(N,{fill:"currentColor",className:"text-yellow-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Spending Tokens"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:[a.balance.toLocaleString()," TK"]})]})]}),p&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-full",children:e.jsx(f,{className:"text-green-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Available USD"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:["$",a.payoutBalance.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 border-b dark:border-gray-700 mb-8 overflow-x-auto",children:[e.jsx("button",{onClick:()=>c("store"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${i==="store"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Token Store"}),e.jsx("button",{onClick:()=>c("plans"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${i==="plans"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Membership Plans"}),p&&e.jsx("button",{onClick:()=>c("earnings"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${i==="earnings"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Earnings & Escrow"})]}),i==="store"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-blue to-purple-600 rounded-2xl p-8 text-white shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10 max-w-lg",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Power Up Your Creativity"}),e.jsx("p",{className:"opacity-90 mb-6",children:"Use tokens to buy beats, presets, booking requests, and more on the SeshFx Marketplace."})]}),e.jsx(N,{size:200,className:"absolute -right-10 -bottom-20 text-white opacity-10 rotate-12 pointer-events-none"})]}),h?e.jsx("div",{className:"text-center py-20",children:e.jsx(b,{className:"animate-spin text-brand-blue mx-auto",size:32})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(t=>e.jsxs("div",{className:`relative bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border transition-all duration-200 hover:-translate-y-1 hover:shadow-xl ${t.highlight?"border-yellow-500 ring-2 ring-yellow-500/20":"dark:border-gray-700"}`,children:[t.highlight&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-yellow-500 text-black text-[10px] font-extrabold px-3 py-1 rounded-full tracking-wide shadow-sm",children:"BEST VALUE"}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-widest mb-2",children:t.label}),e.jsxs("div",{className:"text-5xl font-extrabold dark:text-white flex items-center justify-center gap-1",children:[t.tokens,e.jsx("span",{className:"text-lg font-medium text-gray-400",children:"TK"})]})]}),e.jsx("button",{onClick:()=>P(t),disabled:l,className:`w-full py-3 rounded-xl font-bold flex justify-center items-center gap-2 transition-all ${t.highlight?"bg-yellow-500 text-black hover:bg-yellow-400":"bg-gray-900 dark:bg-white text-white dark:text-black hover:opacity-90"}`,children:l?e.jsx(b,{className:"animate-spin",size:18}):`Buy for $${t.price}`})]},t.id))})]}),i==="plans"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"text-center max-w-2xl mx-auto mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold dark:text-white mb-2",children:"Upgrade Your Workflow"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Unlock lower fees, unlimited bookings, and premium visibility."})]}),h?e.jsx("div",{className:"text-center py-10",children:e.jsx(b,{className:"animate-spin text-brand-blue mx-auto",size:24})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:F.map(t=>{const r=t.id===y;return e.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border flex flex-col ${r?"border-brand-blue ring-1 ring-brand-blue":"dark:border-gray-700"} shadow-sm`,children:[r&&e.jsxs("div",{className:"text-xs font-bold text-brand-blue uppercase tracking-wide mb-2 flex items-center gap-1",children:[e.jsx(C,{size:12,fill:"currentColor"})," Current Plan"]}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:t.name}),e.jsxs("div",{className:"text-3xl font-extrabold mb-6 dark:text-white",children:["$",t.price,e.jsx("span",{className:"text-sm font-normal text-gray-500",children:"/mo"})]}),e.jsxs("div",{className:"space-y-3 mb-8 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-gray-700 dark:text-gray-200",children:[e.jsx(f,{size:16,className:t.feeMultiplier<=1?"text-green-500":"text-gray-400"}),A(t.feeMultiplier)]}),t.features.map((v,n)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx(B,{size:14,className:"text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:v})]},n))]}),e.jsx("button",{onClick:()=>T(t),className:`w-full py-2.5 rounded-lg font-bold text-sm transition-colors mt-auto ${r?"bg-gray-100 dark:bg-gray-700 text-gray-400 cursor-default":"bg-brand-blue text-white hover:bg-blue-600 shadow-lg shadow-blue-500/20"}`,disabled:r||l,children:r?"Active":l?e.jsx(b,{className:"animate-spin mx-auto"}):"Upgrade"})]},t.id)})})]}),i==="earnings"&&p&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 rounded-2xl p-6 text-white shadow-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium opacity-90",children:"Total Lifetime Earnings"}),e.jsxs("div",{className:"text-4xl font-extrabold mt-1",children:["$",(a.payoutBalance+a.escrowBalance).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white/20 backdrop-blur px-4 py-2 rounded-xl",children:[e.jsx("div",{className:"text-white/70 text-xs",children:"Pending"}),e.jsxs("div",{className:"font-bold",children:["$",a.escrowBalance.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur px-4 py-2 rounded-xl",children:[e.jsx("div",{className:"text-white/70 text-xs",children:"Available"}),e.jsxs("div",{className:"font-bold",children:["$",a.payoutBalance.toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg",children:e.jsx(_,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Pending in Escrow"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Held for active gigs/sessions"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold dark:text-white mb-4",children:["$",a.escrowBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-4 mt-4 space-y-2",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"How Escrow Works"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Client books you → Funds held in escrow"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Complete the session → Mark as done"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"24 hours later → Released to Available"]})]}),e.jsxs("div",{className:"text-xs bg-orange-50 dark:bg-orange-900/10 text-orange-700 dark:text-orange-300 p-3 rounded-lg flex items-start gap-2 mt-4",children:[e.jsx(L,{size:14,className:"mt-0.5 shrink-0"})," Funds are released 24 hours after session completion."]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border border-green-500/30 shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg",children:e.jsx(f,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Ready to Cash Out"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Cleared funds - transfer anytime"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold text-green-600 dark:text-green-400 mb-2",children:["$",a.payoutBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 mb-4 text-xs",children:[e.jsxs("div",{className:"flex justify-between text-gray-600 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:"Platform Fee (1%)"}),e.jsxs("span",{className:"text-red-500",children:["-$",(a.payoutBalance*.01).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-gray-900 dark:text-white pt-1 border-t dark:border-gray-700",children:[e.jsx("span",{children:"You'll Receive"}),e.jsxs("span",{className:"text-green-600",children:["$",(a.payoutBalance*.99).toFixed(2)]})]})]}),e.jsx("button",{onClick:S,disabled:l||a.payoutBalance<=0,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-green-500/30 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:shadow-none",children:l?e.jsx(b,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:["Cash Out Now ",e.jsx(M,{size:20})]})}),e.jsx("div",{className:"text-[10px] text-center text-gray-400 mt-3",children:"Transfers via Stripe Connect to your bank in 2-3 days."})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-2xl border dark:border-gray-700",children:[e.jsxs("h4",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx($,{size:18,className:"text-brand-blue"})," Earnings Tips"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 text-purple-600 rounded-lg",children:e.jsx(C,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Complete Your Profile"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Add demos & set your rates to get booked faster"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg",children:e.jsx(N,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Check Open Gigs"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Browse broadcasts for immediate opportunities"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg",children:e.jsx(D,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:"Build Trust"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Great reviews = more bookings & better rates"})]})]})]})]})]})]})}export{G as default};
