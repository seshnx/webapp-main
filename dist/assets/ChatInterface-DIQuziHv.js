import{bM as D,bL as P,r as i,f as A,j as d}from"./vendor-Dl7DtIXW.js";import{u as C,b as M,i as j,a as L,C as R,d as $,e as B,s as U}from"./chat-BYF7Vx2D.js";import{m as k,A as Q}from"./vendor-framer-CUELlS5e.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="1da3ad6d-c595-4cce-a6f9-aaf1679bc554",t._sentryDebugIdIdentifier="sentry-dbid-1da3ad6d-c595-4cce-a6f9-aaf1679bc554")})()}catch{}function Y({user:t,userData:n,openPublicProfile:S,pendingChatTarget:c,clearPendingChatTarget:h}){const x=D(),w=P(),{t:z}=C(),[r,y]=i.useState(null),[I,g]=i.useState(!1),[b,v]=i.useState({}),l=(t==null?void 0:t.id)||(t==null?void 0:t.uid);M(l),i.useEffect(()=>{if(c&&l){const e=[l,c.uid].sort().join("_");p({id:e,uid:c.uid,name:c.name,type:"direct"}),h==null||h()}},[c,l,h]);const E=j(),N=i.useMemo(()=>l&&E?{userId:l}:"skip",[l,E]),f=A(L.conversations.getConversations,N);i.useEffect(()=>{(async()=>{if(!f||!U)return;const a=f.filter(s=>s.chatType==="direct"&&s.otherUserId).map(s=>s.otherUserId).filter((s,m,_)=>_.indexOf(s)===m);if(a.length===0)return;const{data:o}=await U.from("profiles").select("id, avatar_url").in("id",a);if(o){const s={};o.forEach(m=>{s[m.id]=m.avatar_url}),v(s)}})()},[f]);const u=i.useMemo(()=>f?f.map(e=>({id:e.chatId,uid:e.otherUserId||e.chatId,name:e.chatName||"Unknown",n:e.chatName||"Unknown",photo:e.chatType==="direct"&&e.otherUserId&&b[e.otherUserId]?b[e.otherUserId]:e.chatPhoto||"",type:e.chatType||"direct",lm:e.lastMessage||"",lmt:e.lastMessageTime||0,ls:e.lastSenderId||"",uc:e.unreadCount||0})).sort((e,a)=>(a.lmt||0)-(e.lmt||0)):[],[f,b]),p=e=>{y(e),e!=null&&e.id?w(`/messages/chat/${e.id}`,{replace:!0}):w("/messages",{replace:!0})};return i.useEffect(()=>{const e=x.pathname.split("/").filter(Boolean);if(e[0]==="messages"&&e[1]==="chat"&&e[2]){const a=e[2],o=u.find(s=>s.id===a);o&&y(s=>(s==null?void 0:s.id)===a?s:{id:o.id,uid:o.uid,name:o.name,type:o.type})}else e[0]==="messages"&&(!e[1]||e[1]!=="chat")&&y(a=>a&&null)},[x.pathname,u]),i.useEffect(()=>{j()||console.warn("Convex is not available. Chat functionality is disabled.")},[]),d.jsxs("div",{className:"flex h-[calc(100vh-100px)] bg-white dark:bg-[#1f2128] rounded-2xl overflow-hidden border dark:border-gray-800 shadow-xl",children:[d.jsx(k.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`w-full md:w-80 border-r dark:border-gray-800 flex flex-col ${r?"hidden md:flex":"flex"}`,children:d.jsx(R,{user:t,userData:n,conversations:u,activeChat:r,onSelectChat:p})}),d.jsxs("div",{className:`flex-1 flex flex-col relative ${r?"flex":"hidden md:flex"}`,children:[d.jsx($,{activeChat:r,user:t,userData:n,conversations:u,onBack:()=>p(null),toggleDetails:()=>g(!I),openPublicProfile:S}),d.jsx(Q,{children:I&&r&&d.jsx(k.div,{initial:{width:0,opacity:0},animate:{width:300,opacity:1},exit:{width:0,opacity:0},className:"border-l dark:border-gray-800 bg-gray-50 dark:bg-[#23262f] overflow-hidden relative z-20",children:d.jsx(B,{activeChat:r,currentUser:n,onClose:()=>g(!1)})})})]})]})}export{Y as default};
