import{r as c,j as e,y as ae,a as re,cr as ce,cs as xe,a8 as ne,Y as ge,T as me,w as he,c6 as ue,m as pe,ct as ye,ca as fe,bW as be,O as D,X as ee,v as je,N as ve,V as we,cu as Ne,L as q,s as ke,ck as Se,cv as Ce,a2 as Ie,cw as ze,U as se,S as Fe,bL as Re}from"./vendor-DbwibLS8.js";import{U as H,s as A,u as Me}from"./chat-DLxlXx9h.js";import{S as te,R as Oe}from"./ReportModal-vPN9g311.js";import{m as w,A as G}from"./vendor-framer-BrJw1elJ.js";import{POPULAR_PLUGINS_LIST as Le}from"./config-yUl3KxdD.js";import{M as Te}from"./Inputs-duQdC0SP.js";import{F as ie,u as K}from"./FollowButton-D43sMxNY.js";import"./vendor-audio-Bu2lAtPy.js";function Ve({post:s,currentUser:r,currentUserData:t,blockedUsers:l,onCountChange:o}){const[i,n]=c.useState([]),[d,a]=c.useState(""),[x,f]=c.useState(!1);c.useEffect(()=>{},[s.id,l]);const u=async p=>{p.preventDefault();const j=(r==null?void 0:r.id)||(r==null?void 0:r.uid);!d.trim()||!j||A},b=async p=>{!window.confirm("Delete comment?")||A};return e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1f2128] border-t dark:border-gray-700 p-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-4 mb-4 max-h-80 overflow-y-auto custom-scrollbar pr-2",children:[i.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-2",children:"No comments yet. Be the first!"}),i.map(p=>e.jsxs("div",{className:"group flex gap-3 text-sm",children:[e.jsx(H,{src:p.userPhoto,name:p.displayName,size:"xs",className:"shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card border dark:border-gray-700 p-3 rounded-2xl rounded-tl-none inline-block max-w-full",children:[e.jsxs("div",{className:"flex justify-between items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-bold dark:text-white text-xs truncate",children:p.displayName}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0",children:p.timestamp?new Date(p.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Just now"})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 break-words",children:p.text})]}),e.jsxs("div",{className:"flex gap-3 mt-1 ml-2",children:[e.jsx("button",{className:"text-[10px] font-bold text-gray-500 hover:text-brand-blue transition",children:"Reply"}),p.userId===(r==null?void 0:r.uid)&&e.jsx("button",{onClick:()=>b(p.id),className:"text-[10px] font-bold text-gray-400 hover:text-red-500 transition",children:"Delete"})]})]})]},p.id))]}),e.jsxs("form",{onSubmit:u,className:"flex gap-2",children:[e.jsx(H,{src:t==null?void 0:t.photoURL,name:(t==null?void 0:t.firstName)||"You",size:"xs",className:"shrink-0 hidden sm:block"}),e.jsx("input",{className:"flex-1 bg-white dark:bg-dark-card border dark:border-gray-600 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition",placeholder:"Write a comment...",value:d,onChange:p=>a(p.target.value)}),e.jsx("button",{type:"submit",disabled:!d.trim()||x,className:"bg-brand-blue text-white p-2 rounded-full hover:bg-blue-600 disabled:opacity-50 transition shadow-sm",children:e.jsx(ae,{size:16,className:x?"animate-pulse":""})})]})]})}const Ae=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"],Ee=s=>s?s.split(/(\s+)/).map((r,t)=>r.match(/^#\w+/)?e.jsx("span",{className:"text-brand-blue font-bold cursor-pointer hover:underline",children:r},t):r.match(/^@\w+/)?e.jsx("span",{className:"text-purple-600 font-bold cursor-pointer hover:underline",children:r},t):r):null,_e={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},exit:{opacity:0,scale:.95,transition:{duration:.2}}};function $e({post:s,currentUser:r,currentUserData:t,openPublicProfile:l,onReport:o,isFollowingAuthor:i,onToggleFollow:n}){var X,Q,Z,P;const[d,a]=c.useState(!1),[x,f]=c.useState(s.commentCount||0),[u,b]=c.useState(!1),[p,j]=c.useState(!1),[M,C]=c.useState(!1),[O,V]=c.useState(!1),[m,N]=c.useState(!1),z=c.useRef(null),y=c.useRef(null),L=(r==null?void 0:r.id)||(r==null?void 0:r.uid),T=s.userId===L,F=(X=s.reactions)==null?void 0:X[L],U=s.reactions?Object.values(s.reactions).reduce((g,v)=>(g[v]=(g[v]||0)+1,g),{}):{},h=Object.values(U).reduce((g,v)=>g+v,0);c.useEffect(()=>{},[L,s.id]),c.useEffect(()=>{const g=v=>{z.current&&!z.current.contains(v.target)&&j(!1),y.current&&!y.current.contains(v.target)&&C(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]);const J=async g=>{j(!1)},W=async()=>{},E=async()=>{var v;const g=`${window.location.origin}/post/${s.id}`;if(navigator.share)try{await navigator.share({title:`Post by ${s.displayName}`,text:((v=s.text)==null?void 0:v.substring(0,100))||"Check out this post",url:g})}catch(le){le.name!=="AbortError"&&R(g)}else R(g)},R=g=>{navigator.clipboard.writeText(g),V(!0),be.success("Link copied to clipboard!"),setTimeout(()=>V(!1),2e3)},oe=async()=>{};return e.jsxs(w.div,{variants:_e,initial:"hidden",animate:"show",exit:"exit",layout:!0,className:"bg-white dark:bg-dark-card border dark:border-gray-700 rounded-xl overflow-visible shadow-sm mb-4 relative",children:[e.jsxs("div",{className:"p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden cursor-pointer shrink-0",onClick:()=>s.userId&&l(s.userId),role:"button",tabIndex:0,"aria-label":`View ${s.displayName||"user"}'s profile`,children:s.authorPhoto?e.jsx("img",{src:s.authorPhoto,className:"h-full w-full object-cover",alt:`${s.displayName||"User"}'s avatar`,onError:g=>{g.target.style.display="none"}}):e.jsx("div",{className:"h-full w-full bg-gradient-to-tr from-brand-blue to-purple-500 flex items-center justify-center text-white font-bold",children:((Z=(Q=s.displayName)==null?void 0:Q[0])==null?void 0:Z.toUpperCase())||e.jsx(re,{size:16,"aria-hidden":"true"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm hover:underline decoration-brand-blue cursor-pointer truncate",onClick:()=>s.userId&&l(s.userId),children:s.displayName||"Unknown User"}),!T&&n&&!i&&e.jsx("button",{onClick:g=>{g.stopPropagation(),n()},className:"text-xs font-bold text-brand-blue hover:text-blue-700 transition shrink-0",children:"â€¢ Follow"})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"truncate",children:s.role}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"shrink-0",children:s.timestamp||s.created_at?new Date(s.timestamp||s.created_at).toLocaleDateString():"Just now"})]})]})]}),e.jsxs("div",{className:"relative",ref:y,children:[e.jsx("button",{className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>C(!M),children:e.jsx(ce,{size:20})}),e.jsx(G,{children:M&&e.jsxs(w.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden z-50",children:[e.jsxs("button",{onClick:()=>{R(`${window.location.origin}/post/${s.id}`),C(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(xe,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Copy link"})]}),!T&&e.jsxs(e.Fragment,{children:[n&&e.jsxs("button",{onClick:()=>{n(),C(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[e.jsx(ne,{size:16,className:"text-gray-400"}),e.jsxs("span",{className:"dark:text-gray-200",children:[i?"Unfollow":"Follow"," ",(P=s.displayName)==null?void 0:P.split(" ")[0]]})]}),e.jsxs("button",{onClick:()=>{o(),C(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(ge,{size:16}),e.jsx("span",{children:"Report post"})]})]}),T&&e.jsxs("button",{onClick:()=>{oe(),C(!1)},className:"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500",children:[e.jsx(me,{size:16}),e.jsx("span",{children:"Delete post"})]})]})})]})]}),e.jsxs("div",{className:"px-4 pb-2",children:[s.text&&e.jsx("p",{className:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap text-sm leading-relaxed mb-3",children:Ee(s.text)}),s.attachments&&s.attachments.length>0&&e.jsx("div",{className:`grid gap-2 mb-3 ${s.attachments.length>1?"grid-cols-2":"grid-cols-1"}`,children:s.attachments.map((g,v)=>e.jsxs("div",{className:"rounded-lg overflow-hidden bg-transparent relative",children:[g.type==="image"&&e.jsx("img",{src:g.url,className:"w-full h-full object-cover max-h-96",alt:"content"}),g.type==="video"&&e.jsx("video",{src:g.url,controls:!0,className:"w-full h-full max-h-96 bg-black"}),g.type==="audio"&&e.jsx("div",{className:"w-full",children:e.jsx(te,{audioUrl:g.url,fileName:g.name||"Audio Track"})})]},v))}),s.audioUrl&&!s.attachments&&e.jsx("div",{className:"rounded-lg overflow-hidden bg-transparent mb-3",children:e.jsx(te,{audioUrl:s.audioUrl,fileName:s.audioName||"Track"})}),s.imageUrl&&!s.attachments&&e.jsx("img",{src:s.imageUrl,className:"rounded-lg w-full mb-3 border dark:border-gray-700",alt:"legacy content"})]}),(h>0||s.saveCount>0)&&e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:Object.entries(U).map(([g,v])=>e.jsxs(w.div,{initial:{scale:0},animate:{scale:1},className:`text-xs px-2 py-1 rounded-full border flex items-center gap-1 ${F===g?"bg-blue-50 border-blue-200 dark:bg-blue-900/30 dark:border-blue-800":"bg-gray-50 border-gray-100 dark:bg-gray-800 dark:border-gray-700"} dark:text-gray-300`,children:[e.jsx("span",{children:g}),e.jsx("span",{className:"font-bold",children:v})]},g))}),s.saveCount>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[s.saveCount," save",s.saveCount!==1?"s":""]})]}),e.jsxs("div",{className:"px-4 py-3 border-t dark:border-gray-700 flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(w.button,{whileTap:{scale:.9},onClick:()=>j(!p),className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg ${F?"text-blue-600 bg-blue-50 dark:bg-blue-900/20":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[F?e.jsx("span",{className:"text-lg",children:F}):e.jsx(he,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:F?"Reacted":"React"})]}),e.jsx(G,{children:p&&e.jsx(w.div,{ref:z,initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},className:"absolute bottom-full left-0 mb-2 bg-white dark:bg-gray-800 shadow-xl rounded-full p-2 flex gap-1 sm:gap-2 z-50 border dark:border-gray-600 origin-bottom-left",children:Ae.map(g=>e.jsx(w.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:v=>{v.stopPropagation(),J()},className:`text-xl p-1 sm:p-1.5 rounded-full ${F===g?"bg-blue-100 dark:bg-blue-900":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:g},g))})})]}),e.jsxs(w.button,{whileTap:{scale:.95},onClick:()=>a(!d),className:"flex items-center gap-1.5 sm:gap-2 text-sm font-medium text-gray-500 hover:text-brand-blue transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx(ue,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:x>0?x:"Comment"}),x>0&&e.jsx("span",{className:"sm:hidden",children:x})]}),e.jsxs(w.button,{whileTap:{scale:.95},onClick:E,className:`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 ${O?"text-green-500":"text-gray-500 hover:text-green-500"}`,children:[O?e.jsx(pe,{size:18}):e.jsx(ye,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:O?"Copied!":"Share"})]})]}),e.jsx(w.button,{whileTap:{scale:.8},onClick:W,disabled:m,className:`${u?"text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"} transition p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full disabled:opacity-50`,title:u?"Remove from saved":"Save post",children:e.jsx(fe,{size:18,fill:u?"currentColor":"none"})})]}),e.jsx(G,{children:d&&e.jsx(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx(Ve,{post:s,currentUser:r,currentUserData:t,blockedUsers:[],onCountChange:f})})})]})}function Ye({user:s,userData:r,onPost:t}){const[l,o]=c.useState(""),[i,n]=c.useState([]),[d,a]=c.useState(!1),[x,f]=c.useState([]),[u,b]=c.useState(null),[p,j]=c.useState(!1),{uploadMedia:M}=Me(),C=(m,N)=>{if(m.target.files&&m.target.files[0]){const z=m.target.files[0],y=URL.createObjectURL(z);n([...i,{file:z,type:N,previewUrl:y}])}},O=m=>{n(i.filter((N,z)=>z!==m))},V=async()=>{if(!(!l.trim()&&i.length===0)){j(!0);try{const m=await Promise.all(i.map(async y=>{const L=y.type==="video"?"postVideos":y.type==="audio"?"postAudio":"postImages",T=`artifacts/${s.uid}/${L}`,F=await M(y.file,T);return F?{...F,type:y.type}:null}));let N=null;if(u){const y=await M(u,`artifacts/${s.uid}/postPresets`);N=y==null?void 0:y.url}const z={text:l,attachments:m.filter(y=>y!==null),seshFx:d&&(x.length>0||N)?{plugins:x,presetUrl:N,presetName:u?u.name:null}:null};await t(z),o(""),n([]),a(!1),f([]),b(null)}catch(m){console.error("Error creating post:",m),alert("Failed to create post. Please try again.")}finally{j(!1)}}};return e.jsx("div",{className:"bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-gray-700 shadow-sm mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden shrink-0",children:r!=null&&r.photoURL?e.jsx("img",{src:r.photoURL,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-brand-blue"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{className:"w-full bg-transparent outline-none text-gray-900 dark:text-white placeholder-gray-500 min-h-[80px] resize-none",placeholder:"What's creating sound today? (#tags @mentions)",value:l,onChange:m=>o(m.target.value)}),i.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:i.map((m,N)=>e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black/5 border dark:border-gray-600 aspect-video group flex items-center justify-center",children:[m.type==="image"&&e.jsx("img",{src:m.previewUrl,className:"h-full w-full object-cover"}),m.type==="video"&&e.jsx("video",{src:m.previewUrl,className:"h-full w-full object-cover"}),m.type==="audio"&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-brand-blue bg-gray-100 dark:bg-gray-800 w-full h-full",children:[e.jsx(D,{size:32}),e.jsx("span",{className:"text-xs text-gray-500 mt-2 truncate max-w-[90%] px-2",children:m.file.name})]}),e.jsx("button",{onClick:()=>O(N),className:"absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-red-500",children:e.jsx(ee,{size:12})})]},N))}),d&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-3 border border-blue-100 dark:border-blue-800/50 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue uppercase",children:"SeshFx Data"}),e.jsx("button",{onClick:()=>a(!1),children:e.jsx(ee,{size:14,className:"text-gray-400 hover:text-brand-blue"})})]}),e.jsx(Te,{label:"",options:Le,initialValues:x,onChange:(m,N)=>f(N)}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(je,{size:14,className:"text-gray-400"}),e.jsx("input",{type:"file",className:"text-xs text-gray-500 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:bg-white dark:file:bg-gray-700 dark:file:text-white",onChange:m=>b(m.target.files[0])})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-brand-blue cursor-pointer transition",title:"Add Image",children:[e.jsx(ve,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:m=>C(m,"image")})]}),e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-green-500 cursor-pointer transition",title:"Add Video",children:[e.jsx(we,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:m=>C(m,"video")})]}),e.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-purple-500 cursor-pointer transition",title:"Add Audio Track",children:[e.jsx(D,{size:20}),e.jsx("input",{type:"file",className:"hidden",accept:"audio/*",onChange:m=>C(m,"audio")})]}),e.jsx("button",{onClick:()=>a(!d),className:`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition ${d?"bg-blue-50 dark:bg-blue-900/20 text-brand-blue":"text-gray-400"}`,title:"Add Plugin Data",children:e.jsx(Ne,{size:20})})]}),e.jsx("button",{onClick:V,disabled:p||!l&&i.length===0,className:"bg-brand-blue text-white px-5 py-1.5 rounded-full font-bold text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition",children:p?e.jsx(q,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:["Post ",e.jsx(ae,{size:14})]})})]})]})]})})}function k({title:s,description:r,items:t,loading:l,emptyMessage:o,onSeeMore:i,renderItem:n,gridCols:d="grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}){return l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:s}),r&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r})]}),e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(q,{className:"animate-spin text-indigo-600",size:32})})]}):!t||t.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:s}),r&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r})]}),e.jsx("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:o||"No items found."})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:s}),r&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r})]}),i&&e.jsx("button",{onClick:i,className:"text-sm text-indigo-600 dark:text-indigo-400 font-semibold hover:underline",children:"See More â†’"})]}),e.jsx("div",{className:`grid ${d} gap-4`,children:t.map((a,x)=>e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.05},children:n?n(a,x):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:JSON.stringify(a)})},a.id||x))})]})}function S({item:s,type:r,onFollow:t,onViewProfile:l,onPlay:o,isFollowing:i,currentUser:n}){const d=()=>r==="sound"?s.text||"Audio Post":s.displayName||s.name||s.title||"Unknown",a=()=>r==="sound"?s.displayName||"Unknown Artist":r==="artist"||r==="producer"?s.role||s.activeProfileRole||"User":r==="studio"?s.address||s.city||"Location not specified":r==="school"?s.address||"Location not specified":null;return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-all",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"shrink-0",children:r==="sound"?e.jsx("div",{className:"w-12 h-12 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center",children:e.jsx(D,{size:24,className:"text-indigo-600 dark:text-indigo-400"})}):e.jsx(H,{src:s.photoURL||s.logoURL,name:d(),size:"md"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold dark:text-white truncate cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition",onClick:l,children:d()}),a()&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate mt-0.5",children:a()}),r==="studio"&&s.amenities&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:s.amenities.slice(0,2).join(", ")}),r==="school"&&s.programs&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[s.programs.length," program",s.programs.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[r==="sound"&&o&&e.jsx("button",{onClick:o,className:"p-2 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition",title:"Play",children:e.jsx(ke,{size:16,fill:"currentColor"})}),(r==="artist"||r==="producer")&&t&&e.jsx(ie,{isFollowing:i,onToggle:t,size:"sm"})]})]}),(s.followerCount||s.enrollmentCount)&&e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500 dark:text-gray-400",children:[s.followerCount!==void 0&&e.jsxs("span",{children:[s.followerCount," followers"]}),s.enrollmentCount!==void 0&&e.jsxs("span",{children:[s.enrollmentCount," enrolled"]})]})]})]})})}function de(s){const r=s.reactionCount||0,t=s.commentCount||0,l=s.saveCount||0;return r*1+t*2+0*3+l*1.5}function Be(s,r="7d"){var d,a;const t=de(s);if(!s.timestamp)return t;const l=Date.now(),o=((a=(d=s.timestamp)==null?void 0:d.toMillis)==null?void 0:a.call(d))||s.timestamp||l,i=(l-o)/(1e3*60*60);let n=1;return r==="24h"?n=Math.exp(-i/24):r==="7d"?n=Math.exp(-i/168):r==="30d"&&(n=Math.exp(-i/720)),t*n}function _(s,r,t,l=10){if(!t||t.length===0)return[];const o=t.map(i=>({...i,trendingScore:Be(i,r)}));return o.sort((i,n)=>n.trendingScore-i.trendingScore),o.slice(0,l)}function $(s,r,t,l,o=[],i=10){if(!t||t.length===0)return[];const n=t.filter(a=>a.userId!==s);if(o.length>0){const a=o.map(u=>u.id||u.userId),x=n.filter(u=>a.includes(u.userId||u.id)),f=n.filter(u=>!a.includes(u.userId||u.id));return[...x,...f].slice(0,i)}const d=n.map(a=>({...a,engagementScore:de(a)}));return d.sort((a,x)=>x.engagementScore-a.engagementScore),d.slice(0,i)}function Y(s,r=10){return!s||s.length===0?[]:[...s].sort((l,o)=>{var d,a,x,f,u,b,p,j;const i=((a=(d=l.timestamp)==null?void 0:d.toMillis)==null?void 0:a.call(d))||l.timestamp||((f=(x=l.createdAt)==null?void 0:x.toMillis)==null?void 0:f.call(x))||l.createdAt||0;return(((b=(u=o.timestamp)==null?void 0:u.toMillis)==null?void 0:b.call(u))||o.timestamp||((j=(p=o.createdAt)==null?void 0:p.toMillis)==null?void 0:j.call(p))||o.createdAt||0)-i}).slice(0,r)}function B(s,r){const[t,l]=c.useState(!0),[o,i]=c.useState([]),[n,d]=c.useState([]),[a,x]=c.useState([]),[f,u]=c.useState([]),[b,p]=c.useState([]),[j,M]=c.useState([]);c.useEffect(()=>{!(s!=null&&s.id)&&!(s!=null&&s.uid)||A},[s==null?void 0:s.id,s==null?void 0:s.uid]),c.useEffect(()=>{if(!(s!=null&&s.id)&&!(s!=null&&s.uid)||!A){l(!1);return}},[s==null?void 0:s.id,s==null?void 0:s.uid]);const C=c.useMemo(()=>!r||t?{}:{sounds:{trending:_("sounds","7d",o,10),recent:Y(o,10),personalized:$(s.uid,"sounds",o,r,[],10)},artists:{trending:_("artists","7d",n,10),recent:Y(n,10),personalized:$(s.uid,"artists",n,r,[],10)},producers:{trending:_("producers","7d",a,10),recent:Y(a,10),personalized:$(s.uid,"producers",a,r,[],10)},studios:{trending:_("studios","7d",f,10),recent:Y(f,10),personalized:$(s.uid,"studios",f,r,[],10)},schools:{trending:_("schools","7d",b,10),recent:Y(b,10),personalized:$(s.uid,"schools",b,r,[],10)}},[o,n,a,f,b,r,s==null?void 0:s.uid,t]);return{loading:t,sounds:o,artists:n,producers:a,studios:f,schools:b,following:j,recommendations:C}}function Ue({user:s,userData:r,openPublicProfile:t,onFollow:l}){const{loading:o,recommendations:i}=B(s,r),n=(i==null?void 0:i.sounds)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(k,{title:"Trending Sounds",description:"Most popular audio content right now",items:n.trending||[],loading:o,emptyMessage:"No trending sounds found.",renderItem:d=>e.jsx(S,{item:d,type:"sound",onViewProfile:()=>t==null?void 0:t(d.userId),onPlay:()=>{console.log("Play sound:",d.id)}})}),e.jsx(k,{title:"New Releases",description:"Recently posted audio content",items:n.recent||[],loading:o,emptyMessage:"No new sounds found.",renderItem:d=>e.jsx(S,{item:d,type:"sound",onViewProfile:()=>t==null?void 0:t(d.userId),onPlay:()=>{console.log("Play sound:",d.id)}})}),n.personalized&&n.personalized.length>0&&e.jsx(k,{title:"Recommended for You",description:"Based on your activity",items:n.personalized||[],loading:o,emptyMessage:"No recommendations yet.",renderItem:d=>e.jsx(S,{item:d,type:"sound",onViewProfile:()=>t==null?void 0:t(d.userId),onPlay:()=>{console.log("Play sound:",d.id)}})})]})}function We({user:s,userData:r,openPublicProfile:t}){const{loading:l,recommendations:o}=B(s,r),{isFollowing:i,toggleFollow:n}=K(s==null?void 0:s.uid),d=(o==null?void 0:o.artists)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(k,{title:"Trending Artists",description:"Most popular artists right now",items:d.trending||[],loading:l,emptyMessage:"No trending artists found.",renderItem:a=>e.jsx(S,{item:a,type:"artist",onViewProfile:()=>t==null?void 0:t(a.userId||a.id),onFollow:()=>n(a.userId||a.id,a),isFollowing:i(a.userId||a.id)})}),e.jsx(k,{title:"New Artists",description:"Recently joined artists",items:d.recent||[],loading:l,emptyMessage:"No new artists found.",renderItem:a=>e.jsx(S,{item:a,type:"artist",onViewProfile:()=>t==null?void 0:t(a.userId||a.id),onFollow:()=>n(a.userId||a.id,a),isFollowing:i(a.userId||a.id)})}),d.personalized&&d.personalized.length>0&&e.jsx(k,{title:"Recommended for You",description:"Based on artists you follow",items:d.personalized||[],loading:l,emptyMessage:"No recommendations yet.",renderItem:a=>e.jsx(S,{item:a,type:"artist",onViewProfile:()=>t==null?void 0:t(a.userId||a.id),onFollow:()=>n(a.userId||a.id,a),isFollowing:i(a.userId||a.id)})})]})}function Ge({user:s,userData:r,openPublicProfile:t}){const{loading:l,recommendations:o}=B(s,r),{isFollowing:i,toggleFollow:n}=K(s==null?void 0:s.uid),d=(o==null?void 0:o.producers)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(k,{title:"Trending Producers",description:"Most popular producers right now",items:d.trending||[],loading:l,emptyMessage:"No trending producers found.",renderItem:a=>e.jsx(S,{item:a,type:"producer",onViewProfile:()=>t==null?void 0:t(a.userId||a.id),onFollow:()=>n(a.userId||a.id,a),isFollowing:i(a.userId||a.id)})}),e.jsx(k,{title:"New Producers",description:"Recently joined producers",items:d.recent||[],loading:l,emptyMessage:"No new producers found.",renderItem:a=>e.jsx(S,{item:a,type:"producer",onViewProfile:()=>t==null?void 0:t(a.userId||a.id),onFollow:()=>n(a.userId||a.id,a),isFollowing:i(a.userId||a.id)})}),d.personalized&&d.personalized.length>0&&e.jsx(k,{title:"Recommended for You",description:"Based on producers you follow",items:d.personalized||[],loading:l,emptyMessage:"No recommendations yet.",renderItem:a=>e.jsx(S,{item:a,type:"producer",onViewProfile:()=>t==null?void 0:t(a.userId||a.id),onFollow:()=>n(a.userId||a.id,a),isFollowing:i(a.userId||a.id)})})]})}function De({user:s,userData:r,openPublicProfile:t}){const{loading:l,recommendations:o}=B(s,r),i=(o==null?void 0:o.studios)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(k,{title:"Trending Studios",description:"Most popular studios right now",items:i.trending||[],loading:l,emptyMessage:"No trending studios found.",renderItem:n=>e.jsx(S,{item:n,type:"studio",onViewProfile:()=>t==null?void 0:t(n.userId||n.id)})}),e.jsx(k,{title:"New Studios",description:"Recently added studios",items:i.recent||[],loading:l,emptyMessage:"No new studios found.",renderItem:n=>e.jsx(S,{item:n,type:"studio",onViewProfile:()=>t==null?void 0:t(n.userId||n.id)})}),i.personalized&&i.personalized.length>0&&e.jsx(k,{title:"Recommended for You",description:"Based on your location and interests",items:i.personalized||[],loading:l,emptyMessage:"No recommendations yet.",renderItem:n=>e.jsx(S,{item:n,type:"studio",onViewProfile:()=>t==null?void 0:t(n.userId||n.id)})})]})}function He({user:s,userData:r}){const{loading:t,recommendations:l}=B(s,r),o=(l==null?void 0:l.schools)||{};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(k,{title:"Featured Schools",description:"Top music education programs",items:o.trending||[],loading:t,emptyMessage:"No featured schools found.",renderItem:i=>e.jsx(S,{item:i,type:"school",onViewProfile:()=>{console.log("View school:",i.id)}})}),e.jsx(k,{title:"New Schools",description:"Recently added schools",items:o.recent||[],loading:t,emptyMessage:"No new schools found.",renderItem:i=>e.jsx(S,{item:i,type:"school",onViewProfile:()=>{console.log("View school:",i.id)}})}),o.personalized&&o.personalized.length>0&&e.jsx(k,{title:"Recommended for You",description:"Based on your location and interests",items:o.personalized||[],loading:t,emptyMessage:"No recommendations yet.",renderItem:i=>e.jsx(S,{item:i,type:"school",onViewProfile:()=>{console.log("View school:",i.id)}})})]})}const Je=[{id:"sounds",label:"Sounds",icon:D},{id:"artists",label:"Artists",icon:re},{id:"producers",label:"Producers",icon:Se},{id:"studios",label:"Studios",icon:Ce},{id:"schools",label:"Schools",icon:Ie}];function qe({user:s,userData:r,openPublicProfile:t}){const[l,o]=c.useState("sounds"),i=()=>{switch(l){case"sounds":return e.jsx(Ue,{user:s,userData:r,openPublicProfile:t});case"artists":return e.jsx(We,{user:s,userData:r,openPublicProfile:t});case"producers":return e.jsx(Ge,{user:s,userData:r,openPublicProfile:t});case"studios":return e.jsx(De,{user:s,userData:r,openPublicProfile:t});case"schools":return e.jsx(He,{user:s,userData:r});default:return null}};return e.jsxs("div",{className:"max-w-6xl mx-auto pb-20",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm overflow-x-auto",children:Je.map(n=>{const d=n.icon;return e.jsxs("button",{onClick:()=>o(n.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all whitespace-nowrap ${l===n.id?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(d,{size:16}),e.jsx("span",{children:n.label})]},n.id)})}),e.jsx("div",{className:"mt-6",children:i()})]})}const I={FOR_YOU:"for_you",FOLLOWING:"following",DISCOVER:"discover"};function as({user:s,userData:r,openPublicProfile:t}){const[l,o]=c.useState([]),[i,n]=c.useState(!0),[d,a]=c.useState(null),[x,f]=c.useState(I.FOR_YOU),[u,b]=c.useState([]),[p,j]=c.useState(!1),M=(s==null?void 0:s.id)||(s==null?void 0:s.uid),{following:C,stats:O,loading:V,isFollowing:m,toggleFollow:N,getFollowingIds:z}=K(M),y=c.useMemo(()=>z(),[C]);c.useEffect(()=>{const h=(s==null?void 0:s.id)||(s==null?void 0:s.uid);x===I.FOLLOWING&&y.length===0&&h&&L()},[x,y.length,s==null?void 0:s.id,s==null?void 0:s.uid]);const L=async()=>{j(!0);try{if(!A||!(s!=null&&s.id)&&!(s!=null&&s.uid))return;const h=s.id||s.uid,{data:J,error:W}=await A.from("posts").select("user_id, display_name, author_photo, role").neq("user_id",h).order("created_at",{ascending:!1}).limit(20);if(W)throw W;const E=new Map;(J||[]).forEach(R=>{E.has(R.user_id)||E.set(R.user_id,{userId:R.user_id,displayName:R.display_name,photoURL:R.author_photo,role:R.role})}),b(Array.from(E.values()).slice(0,5))}catch(h){console.error("Error loading suggestions:",h)}j(!1)};c.useEffect(()=>{{n(!1);return}},[x,y,s==null?void 0:s.id,s==null?void 0:s.uid]);const T=async h=>{},F={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},U=({suggestedUser:h})=>e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 hover:border-brand-blue/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1 min-w-0",onClick:()=>t==null?void 0:t(h.userId),children:[e.jsx(H,{src:h.photoURL,name:h.displayName,size:"md"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate hover:text-brand-blue transition",children:h.displayName}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:h.role})]})]}),e.jsx(ie,{isFollowing:m(h.userId),onToggle:()=>N(h.userId,h),size:"sm",variant:"default"})]});return e.jsxs("div",{className:"max-w-2xl mx-auto pb-20",children:[e.jsx(Ye,{user:s,userData:r,onPost:T}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("button",{onClick:()=>f(I.FOR_YOU),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${x===I.FOR_YOU?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(ze,{size:16}),e.jsx("span",{children:"For You"})]}),e.jsxs("button",{onClick:()=>f(I.FOLLOWING),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${x===I.FOLLOWING?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(se,{size:16}),e.jsx("span",{children:"Following"}),O.followingCount>0&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${x===I.FOLLOWING?"bg-white/20":"bg-gray-200 dark:bg-gray-700"}`,children:O.followingCount})]}),e.jsxs("button",{onClick:()=>f(I.DISCOVER),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${x===I.DISCOVER?"bg-brand-blue text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(Fe,{size:16}),e.jsx("span",{children:"Discover"})]})]}),x===I.DISCOVER?e.jsx(qe,{user:s,userData:r,openPublicProfile:t}):i||V?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(q,{className:"animate-spin text-brand-blue",size:32})}):e.jsxs(e.Fragment,{children:[x===I.FOLLOWING&&y.length===0&&e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-6 border border-blue-100 dark:border-blue-800/30",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-brand-blue/10 flex items-center justify-center",children:e.jsx(ne,{size:28,className:"text-brand-blue"})}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Start following creators"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-sm mx-auto",children:"Follow artists, engineers, and studios to see their posts in your Following feed."})]}),p?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Suggested for you"}),[1,2,3].map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded-lg"})]},h))]}):u.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Suggested for you"}),u.map(h=>e.jsx(U,{suggestedUser:h},h.userId))]})]}),e.jsxs(w.div,{variants:F,initial:"hidden",animate:"show",className:"space-y-4",children:[e.jsx(G,{mode:"popLayout",children:l.map(h=>e.jsx($e,{post:h,currentUser:s,currentUserData:r,openPublicProfile:t||(()=>{}),onReport:()=>a(h),isFollowingAuthor:m(h.userId),onToggleFollow:()=>N(h.userId,{displayName:h.displayName,photoURL:h.authorPhoto,role:h.role})},h.id))}),l.length===0&&x===I.FOR_YOU&&e.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(Re,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsx("p",{children:"No posts yet. Be the first to share something!"})]}),l.length===0&&x===I.FOLLOWING&&y.length>0&&e.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 text-gray-500",children:[e.jsx(se,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsx("p",{children:"No recent posts from people you follow."}),e.jsx("button",{onClick:()=>f(I.FOR_YOU),className:"mt-3 text-brand-blue hover:underline text-sm font-medium",children:"Browse For You feed â†’"})]})]})]}),d&&e.jsx(Oe,{user:s,target:{id:d.id,type:"Post",summary:d.text?d.text.substring(0,50):"Media Post"},onClose:()=>a(null)})]})}export{as as default};
