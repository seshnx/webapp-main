import{j as e,B as oe,_ as R,T as de,r as i,i as le,c5 as ie,L as B,n as T,X as E,c6 as P,c0 as ce,cv as ge,cw as xe,cx as me,c1 as be,cy as pe,a9 as he,cz as fe,S as ue,cA as ye,ae as ke,bO as je,cB as we,bV as ve,bW as Ne}from"./vendor-Dl7DtIXW.js";import{U as F,u as Ce,s as z}from"./chat-BYF7Vx2D.js";import{L as Se,a as ze}from"./SeshNx-PNG cCropped white text-BVqTFh8v.js";import{A as Ee,m as O}from"./vendor-framer-CUELlS5e.js";import{u as Re}from"./useNotifications-ltI130DA.js";import{getDisplayRole as Le}from"./config-DGZTEYpI.js";import"./index-BNJB-XQZ.js";import"./edu-BMUxkX2v.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new t.Error().stack;r&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[r]="1287e2dd-a12a-417d-9e77-342bc8d4fb12",t._sentryDebugIdIdentifier="sentry-dbid-1287e2dd-a12a-417d-9e77-342bc8d4fb12")})()}catch{}const Ie=({type:t})=>{const r={size:14},c={follow:e.jsx(he,{...r}),like:e.jsx(pe,{...r}),comment:e.jsx(be,{...r}),mention:e.jsx(me,{...r}),reply:e.jsx(xe,{...r}),save:e.jsx(ge,{...r}),booking:e.jsx(ce,{...r}),booking_accepted:e.jsx(T,{...r}),booking_declined:e.jsx(E,{...r})},d={follow:"bg-brand-blue/10 text-brand-blue dark:bg-brand-blue/20",like:"bg-red-100 text-red-500 dark:bg-red-900/30 dark:text-red-400",comment:"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400",mention:"bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400",reply:"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400",save:"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400",booking:"bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400",booking_accepted:"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400",booking_declined:"bg-red-100 text-red-500 dark:bg-red-900/30 dark:text-red-400"};return e.jsx("div",{className:`p-1.5 rounded-full ${d[t]||"bg-gray-100 text-gray-500"}`,children:c[t]||e.jsx(R,{size:14})})},Ae=t=>{if(!t)return"";const r=t.toMillis?new Date(t.toMillis()):new Date(t),d=new Date-r,l=Math.floor(d/6e4),g=Math.floor(l/60),n=Math.floor(g/24);return l<1?"Just now":l<60?`${l}m`:g<24?`${g}h`:n<7?`${n}d`:r.toLocaleDateString()},Me=({notification:t,onMarkAsRead:r,onDelete:c,onUserClick:d,onPostClick:l,onBookingAction:g})=>{const[n,h]=i.useState(null),f=()=>{t.read||r(t.id),t.type==="follow"&&d?d(t.fromUserId):t.postId&&l&&l(t.postId)},m=async(s,b)=>{if(s.stopPropagation(),!!t.bookingId){h(b);try{await g(t.bookingId,b,t.id),P.success(b==="accept"?"Booking accepted!":"Booking declined")}catch(y){P.error("Failed to update booking"),console.error(y)}h(null)}},x=t.type==="booking"&&t.bookingId&&!t.actionTaken;return e.jsxs(O.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},className:`
                p-3 cursor-pointer border-b dark:border-gray-700 last:border-0 
                flex gap-3 items-start group transition-colors relative
                ${t.read?"hover:bg-gray-50 dark:hover:bg-gray-800":"bg-blue-50/50 dark:bg-blue-900/10 hover:bg-blue-50 dark:hover:bg-blue-900/20"}
            `,onClick:f,children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx(F,{src:t.fromUserPhoto,name:t.fromUserName,size:"sm"}),e.jsx("div",{className:"absolute -bottom-1 -right-1",children:e.jsx(Ie,{type:t.type})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("p",{className:"text-sm dark:text-gray-200 leading-snug",children:[e.jsx("span",{className:"font-bold hover:text-brand-blue transition-colors",children:t.fromUserName})," ",e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.message})]}),e.jsx("span",{className:"text-[10px] text-gray-400 whitespace-nowrap shrink-0",children:Ae(t.timestamp)})]}),t.postPreview&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1 line-clamp-1 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded",children:['"',t.postPreview,'"']}),x&&t.bookingDetails&&e.jsxs("div",{className:"mt-2 bg-amber-50 dark:bg-amber-900/20 p-2 rounded-lg text-xs space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-600 dark:text-gray-300",children:[t.bookingDetails.date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{size:10})," ",t.bookingDetails.date]}),t.bookingDetails.amount&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 font-bold",children:[e.jsx(ie,{size:10})," $",t.bookingDetails.amount]})]}),t.bookingDetails.serviceType&&e.jsx("span",{className:"inline-block bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded text-[10px]",children:t.bookingDetails.serviceType})]}),x&&e.jsxs("div",{className:"flex gap-2 mt-2",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{onClick:s=>m(s,"accept"),disabled:n,className:"flex-1 bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1.5 px-3 rounded-lg transition flex items-center justify-center gap-1 disabled:opacity-50",children:n==="accept"?e.jsx(B,{size:12,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(T,{size:12})," Accept"]})}),e.jsx("button",{onClick:s=>m(s,"decline"),disabled:n,className:"flex-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-xs font-bold py-1.5 px-3 rounded-lg transition flex items-center justify-center gap-1 disabled:opacity-50",children:n==="decline"?e.jsx(B,{size:12,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(E,{size:12})," Decline"]})})]}),!t.read&&e.jsx("div",{className:"w-2 h-2 bg-brand-blue rounded-full absolute right-3 top-1/2 -translate-y-1/2"})]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),c(t.id)},className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-all text-gray-400 hover:text-red-500 shrink-0",children:e.jsx(E,{size:14})})]})};function Ue({notifications:t,unreadCount:r,loading:c,onMarkAsRead:d,onMarkAllAsRead:l,onDeleteNotification:g,onClearAll:n,onUserClick:h,onPostClick:f,onBookingAction:m,onClose:x}){return e.jsxs("div",{className:"absolute right-0 top-full mt-3 w-80 sm:w-96 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-2xl z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"p-3 px-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm",children:"Notifications"}),r>0&&e.jsx("span",{className:"text-xs bg-brand-blue text-white px-2 py-0.5 rounded-full font-bold animate-pulse",children:r})]}),r>0&&e.jsxs("button",{onClick:l,className:"text-xs text-brand-blue hover:text-blue-700 font-medium flex items-center gap-1 transition",children:[e.jsx(oe,{size:14}),"Mark all read"]})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto custom-scrollbar",children:c?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-brand-blue border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading..."})]}):t.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-3",children:e.jsx(R,{size:24,className:"opacity-30"})}),e.jsx("p",{className:"text-sm font-medium dark:text-gray-400",children:"All caught up!"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"No new notifications"})]}):e.jsx(Ee,{mode:"popLayout",children:t.map(s=>e.jsx(Me,{notification:s,onMarkAsRead:d,onDelete:g,onUserClick:h,onPostClick:f,onBookingAction:m},s.id))})}),t.length>0&&e.jsxs("div",{className:"p-2 bg-gray-50 dark:bg-[#23262f] border-t dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("button",{onClick:n,className:"text-xs text-gray-400 hover:text-red-500 font-medium flex items-center gap-1 transition px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(de,{size:12}),"Clear all"]}),e.jsx("button",{onClick:x,className:"text-xs text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"Close"})]})]})}function $e({count:t}){return t===0?null:e.jsx(O.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-0.5 -right-0.5 min-w-[18px] h-[18px] bg-red-500 rounded-full text-[10px] text-white font-bold flex items-center justify-center border-2 border-white dark:border-dark-card",children:t>99?"99+":t})}function We({user:t,userData:r,subProfiles:c,darkMode:d,toggleTheme:l,activeTab:g,setActiveTab:n,onMenuClick:h,onRoleSwitch:f,openPublicProfile:m}){var $;const[x,s]=i.useState(!1),[b,y]=i.useState(!1),[L,N]=i.useState(!1),[q,K]=i.useState(""),k=i.useRef(null),j=i.useRef(null),I=i.useRef(null),{t:W}=Ce(),{notifications:H,unreadCount:w,loading:Q,markAsRead:G,markAllAsRead:J,deleteNotification:V,clearAll:X}=Re((t==null?void 0:t.id)||(t==null?void 0:t.uid)),p=(r==null?void 0:r.activeProfileRole)||(($=r==null?void 0:r.accountTypes)==null?void 0:$[0])||"User",Y=Le(r),C=(r==null?void 0:r.accountTypes)||[],Z=["Student","EDUStaff","Intern","EDUAdmin"],D=C.some(a=>Z.includes(a)),A=g.startsWith("edu"),M=a=>{if(!a||a==="Main"||a==="Fan"||a==="User")return(r==null?void 0:r.effectiveDisplayName)||(r==null?void 0:r.firstName)||"User";const o=c==null?void 0:c[a];return(o==null?void 0:o.displayName)||(r==null?void 0:r.effectiveDisplayName)||(r==null?void 0:r.firstName)||"User"},U=M(p),ee=()=>{n(p==="Student"?"edu-student":p==="Intern"?"edu-intern":"edu-overview")};i.useEffect(()=>{if(p){N(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{N(!0)})});const a=setTimeout(()=>N(!1),600);return()=>clearTimeout(a)}},[p]),i.useEffect(()=>{function a(o){k.current&&!k.current.contains(o.target)&&s(!1),j.current&&!j.current.contains(o.target)&&y(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[k,j]);const te=a=>{s(!1),m&&m(a)},re=a=>{s(!1),n("feed")},ae=async(a,o,S)=>{try{if(!z)throw new Error("Supabase not initialized");const{error:u}=await z.from("bookings").update({status:o==="accept"?"Confirmed":"Declined",responded_at:new Date().toISOString()}).eq("id",a);if(u)throw u;if(S&&(t!=null&&t.id||t!=null&&t.uid)){const v=(t==null?void 0:t.id)||(t==null?void 0:t.uid),{error:_}=await z.from("notifications").update({action_taken:o,read:!0,updated_at:new Date().toISOString()}).eq("id",S).eq("user_id",v);if(_)throw _}}catch(u){throw console.error("Booking action failed:",u),u}},se=a=>{f&&f(a),y(!1)},ne=a=>{a.preventDefault(),s(!1),n("feed")};return i.useEffect(()=>{const a=o=>{var v;(navigator.platform.toUpperCase().indexOf("MAC")>=0?o.metaKey:o.ctrlKey)&&o.key.toLowerCase()==="k"&&(o.preventDefault(),(v=I.current)==null||v.focus())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed top-0 bottom-0 w-full pointer-events-none z-[9999] 
          bg-gradient-to-r from-transparent via-white/30 dark:via-white/10 to-transparent
          ${L?"left-[-100%] transition-all duration-500 ease-out":"left-[100%] transition-none duration-0"}
        `}),e.jsxs("nav",{className:"h-16 bg-white dark:bg-dark-card border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 shrink-0 z-20 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-[180px]",children:[e.jsx("button",{onClick:h,className:"p-2 -ml-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 lg:hidden","aria-label":"Open navigation menu","aria-expanded":"false",children:e.jsx(fe,{size:24,"aria-hidden":"true"})}),e.jsx("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>n("dashboard"),children:e.jsx("img",{src:d?Se:ze,alt:"SeshNx Logo",className:"h-8 w-auto object-contain transition-opacity duration-300"})})]}),e.jsx("div",{className:"hidden md:flex flex-1 max-w-xl px-4",children:e.jsx("form",{onSubmit:ne,className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2 w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-full px-3 py-1.5 focus-within:ring-2 focus-within:ring-brand-blue/70",children:[e.jsx(ue,{size:16,className:"text-gray-400"}),e.jsx("input",{ref:I,value:q,onChange:a=>K(a.target.value),placeholder:W("searchPlaceholder"),className:"flex-1 bg-transparent text-sm text-gray-800 dark:text-gray-100 placeholder:text-gray-400 focus:outline-none"}),e.jsx("button",{type:"submit",className:"text-xs font-semibold text-white bg-brand-blue hover:bg-blue-600 rounded-full px-3 py-1 transition-colors",children:"Search"})]})})}),e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[D&&e.jsxs("div",{className:"hidden md:flex items-center bg-gray-100 dark:bg-gray-800 rounded-lg p-1 border dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>n("dashboard"),className:`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${A?"text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200":"bg-white dark:bg-gray-600 shadow-sm text-brand-blue dark:text-white"}`,children:[e.jsx(ye,{size:14})," Studio"]}),e.jsxs("button",{onClick:ee,className:`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${A?"bg-white dark:bg-gray-600 shadow-sm text-indigo-600 dark:text-white":"text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200"}`,children:[e.jsx(ke,{size:14})," Education"]})]}),C.length>1&&e.jsxs("div",{className:"relative hidden sm:flex items-center gap-3",ref:j,children:[e.jsxs("button",{onClick:()=>y(!b),className:"group flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs font-bold transition border border-gray-200 dark:border-gray-700",children:[e.jsx(je,{size:12,className:`text-brand-blue shrink-0 transition-transform ${L?"rotate-180 duration-500":""}`}),e.jsx("span",{children:Y}),e.jsx(we,{size:12,className:`shrink-0 transition-transform ${b?"rotate-180":""}`})]}),e.jsxs("div",{className:"flex flex-col leading-tight",children:[e.jsx("span",{className:"text-[10px] text-gray-500 font-medium",children:"Posting as"}),e.jsx("span",{className:"text-xs font-bold dark:text-white truncate max-w-[150px]",children:U})]}),b&&e.jsxs("div",{className:"absolute left-0 top-full mt-2 w-56 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-xl z-50 overflow-hidden animate-in fade-in slide-in-from-top-1 duration-200",children:[e.jsx("div",{className:"p-2 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wider pl-2",children:"Switch Profile Context"})}),e.jsx("div",{className:"p-1",children:C.map(a=>{const o=M(a);return e.jsxs("button",{onClick:()=>se(a),className:`w-full text-left px-3 py-2 rounded-lg text-sm font-medium transition flex items-center justify-between ${p===a?"bg-blue-50 dark:bg-blue-900/20 text-brand-blue":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:o}),e.jsx("span",{className:"text-[10px] opacity-70 font-normal uppercase",children:a})]}),p===a&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-blue"})]},a)})})]})]}),e.jsx("button",{onClick:l,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300","aria-label":d?"Switch to light mode":"Switch to dark mode",title:d?"Switch to light mode":"Switch to dark mode",children:d?e.jsx(ve,{size:20,"aria-hidden":"true"}):e.jsx(Ne,{size:20,"aria-hidden":"true"})}),e.jsxs("div",{className:"relative",ref:k,children:[e.jsxs("button",{className:`relative p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition ${x?"bg-gray-100 dark:bg-gray-800 text-brand-blue":""}`,onClick:()=>s(!x),"aria-label":`Notifications${w>0?` (${w} unread)`:""}`,"aria-expanded":x,children:[e.jsx(R,{size:20,"aria-hidden":"true"}),e.jsx($e,{count:w})]}),x&&e.jsx(Ue,{notifications:H,unreadCount:w,loading:Q,onMarkAsRead:G,onMarkAllAsRead:J,onDeleteNotification:V,onClearAll:X,onUserClick:te,onPostClick:re,onBookingAction:ae,onClose:()=>s(!1)})]}),e.jsx(F,{src:r==null?void 0:r.photoURL,name:U,size:"sm",className:"border-2 border-transparent hover:border-brand-blue transition",onClick:()=>n("profile")})]})]})]})}export{We as default};
