import{r as g,j as e,b as R,c1 as P,cr as E,X as z,V as B,L as _,S as A,Y as V,ce as F,cB as M,d2 as O,y as G,d3 as H,d4 as Y,G as K,al as J,aq as W}from"./vendor-Dl7DtIXW.js";import{s as c,f as D}from"./chat-BYF7Vx2D.js";import{SERVICE_CATALOGUE as T,TECH_SPECIALTIES as L,EQUIP_CATEGORIES as U}from"./config-DGZTEYpI.js";import{E as Q}from"./EquipmentAutocomplete-BcGdmRJg.js";import{M as X}from"./Inputs-BLEJ7bwJ.js";import"./vendor-framer-CUELlS5e.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new a.Error().stack;r&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[r]="2c4bade7-3ff3-45d6-9472-56fed555f03c",a._sentryDebugIdIdentifier="sentry-dbid-2c4bade7-3ff3-45d6-9472-56fed555f03c")})()}catch{}function Z({user:a}){const[r,x]=g.useState([]),[l,b]=g.useState("All");return g.useEffect(()=>{if(!c)return;c.from("service_requests").select("*").order("created_at",{ascending:!1}).limit(50).then(({data:s,error:n})=>{if(n){console.error("Error fetching service requests:",n);return}x((s||[]).map(i=>({id:i.id,...i,timestamp:i.created_at,userId:i.user_id,userName:i.user_name})))});const o=c.channel("service-requests").on("postgres_changes",{event:"*",schema:"public",table:"service_requests"},async()=>{const{data:s}=await c.from("service_requests").select("*").order("created_at",{ascending:!1}).limit(50);s&&x(s.map(n=>({id:n.id,...n,timestamp:n.created_at,userId:n.user_id,userName:n.user_name})))}).subscribe();return()=>{c.removeChannel(o)}},[]),e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2",children:[e.jsx("button",{onClick:()=>b("All"),className:`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap border transition ${l==="All"?"bg-orange-500 text-white border-orange-600":"bg-white dark:bg-dark-card border-gray-200 dark:border-gray-700 dark:text-gray-300"}`,children:"All Jobs"}),T.map(o=>e.jsx("button",{onClick:()=>b(o.label),className:`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap border transition ${l===o.label?"bg-orange-500 text-white border-orange-600":"bg-white dark:bg-dark-card border-gray-200 dark:border-gray-700 dark:text-gray-300"}`,children:o.label},o.id))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.filter(o=>l==="All"||o.category===l).map(o=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 hover:border-orange-400 transition shadow-sm group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20 px-2 py-0.5 rounded",children:o.category}),o.budget&&e.jsxs("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:["$",o.budget]})]}),e.jsx("h3",{className:"font-bold text-lg dark:text-white mb-1",children:o.topic}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-4",children:o.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 border-t dark:border-gray-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:12})," ",o.userName]}),o.userId!==((a==null?void 0:a.id)||(a==null?void 0:a.uid))&&e.jsxs("button",{className:"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1.5 rounded font-bold hover:opacity-80 flex items-center gap-1",children:[e.jsx(P,{size:12})," Message"]})]})]},o.id)),r.length===0&&e.jsx("div",{className:"col-span-full text-center py-12 text-gray-400",children:"No active requests."})]})]})}function ee({user:a,userData:r,target:x,onClose:l}){const[b,o]=g.useState(!1),[s,n]=g.useState({serviceCategory:"Repair",equipmentName:"",issueDescription:"",logistics:"Drop-off",preferredDate:"",budgetCap:""}),[i,v]=g.useState([]),{uploadMedia:d,uploading:j}=D(),m=async t=>{const p=t.target.files[0];if(!p)return;const f=await d(p,`tech_requests/${a.uid}`);f&&v(y=>[...y,f])},w=async()=>{if(!s.equipmentName||!s.issueDescription||!c){(!s.equipmentName||!s.issueDescription)&&alert("Please describe the equipment and the issue.");return}o(!0);const t=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{await c.from("bookings").insert({sender_id:t,sender_name:r&&`${r.firstName||""} ${r.lastName||""}`.trim()||"User",target_id:x.id,target_name:x.firstName?`${x.firstName} ${x.lastName}`:x.name,type:"TechRequest",service_type:s.serviceCategory,equipment:s.equipmentName,description:s.issueDescription,logistics:s.logistics,budget_cap:s.budgetCap||null,status:"Pending",date:s.preferredDate||"Flexible",message:`[${s.serviceCategory}] ${s.equipmentName}: ${s.issueDescription}`,attachments:i||[],timestamp:new Date().toISOString()}),alert("Service request sent!"),l()}catch{alert("Failed to send.")}o(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-in fade-in zoom-in-95",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(E,{size:18,className:"text-orange-500"})," Service Request"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Hiring ",e.jsxs("span",{className:"font-bold text-orange-600 dark:text-orange-400",children:[x.firstName," ",x.lastName]})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(z,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Type"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:s.serviceCategory,onChange:t=>n({...s,serviceCategory:t.target.value}),children:T.map(t=>e.jsx("option",{value:t.label,children:t.label},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Logistics"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:s.logistics,onChange:t=>n({...s,logistics:t.target.value}),children:[e.jsx("option",{value:"Drop-off",children:"I will drop it off"}),e.jsx("option",{value:"On-site",children:"Tech comes to me"}),e.jsx("option",{value:"Ship",children:"I will ship it"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Equipment"}),e.jsx(Q,{placeholder:"Search for equipment (e.g. Fender Twin Reverb, U87)...",value:s.equipmentName,onChange:t=>n({...s,equipmentName:t}),onSelect:t=>{const p=t.brand!=="Various"&&t.brand!=="Unknown"?`${t.brand} ${t.name}`:t.name;n({...s,equipmentName:p})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Issue Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px] text-sm",placeholder:"Describe symptoms...",value:s.issueDescription,onChange:t=>n({...s,issueDescription:t.target.value})})]}),e.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-brand-blue hover:text-blue-600 font-bold mb-3",children:[e.jsx(B,{size:16})," Add Video/Photo ",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,video/*",onChange:m,disabled:j})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:i.map((t,p)=>e.jsx("div",{className:"h-12 w-12 bg-black rounded border dark:border-gray-600 overflow-hidden",children:e.jsx("img",{src:t.url,className:"h-full w-full object-cover"})},p))})]})]}),e.jsx("div",{className:"p-5 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("button",{onClick:w,disabled:b||j,className:"w-full bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg",children:b?e.jsx(_,{className:"animate-spin mx-auto"}):"Submit Request"})})]})})}function ae({user:a,userData:r,openPublicProfile:x}){const[l,b]=g.useState([]),[o,s]=g.useState(!1),[n,i]=g.useState(""),[v,d]=g.useState(""),[j,m]=g.useState(null),w=async()=>{if(!c)return;s(!0);const t=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{let p=c.from("profiles").select("id, first_name, last_name, photo_url, account_types, sub_roles, skills, rate, search_terms").contains("account_types",["Technician"]).limit(20);n&&(p=p.ilike("search_terms",`%${n.toLowerCase()}%`));const{data:f,error:y}=await p;if(y)throw y;let k=(f||[]).filter(u=>u.id!==t).map(u=>({id:u.id,firstName:u.first_name,lastName:u.last_name,photoURL:u.photo_url,accountTypes:u.account_types,subRoles:u.sub_roles,skills:u.skills,rate:u.rate,searchTerms:u.search_terms}));v&&(k=k.filter(u=>u.subRoles&&u.subRoles.includes(v))),b(k)}catch(p){console.error(p)}s(!1)};return g.useEffect(()=>{w()},[v]),e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(A,{className:"absolute left-4 top-3.5 text-gray-400",size:18}),e.jsx("input",{className:"w-full pl-12 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-orange-500 dark:text-white",placeholder:"Search technicians...",value:n,onChange:t=>i(t.target.value),onKeyDown:t=>t.key==="Enter"&&w()})]}),e.jsx("div",{className:"md:w-1/3",children:e.jsxs("select",{className:"w-full p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-orange-500 dark:text-white cursor-pointer",value:v,onChange:t=>d(t.target.value),children:[e.jsx("option",{value:"",children:"All Specialties"}),L.map(t=>e.jsx("option",{value:t,children:t},t))]})})]}),o?e.jsx("div",{className:"text-center py-12",children:e.jsx(_,{className:"animate-spin mx-auto text-orange-500"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(t=>{var p,f,y;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm hover:shadow-lg transition group",children:[e.jsx("div",{className:"h-24 bg-gradient-to-r from-slate-700 to-slate-600 relative",children:e.jsx("div",{className:"absolute -bottom-8 left-6",children:e.jsx("div",{className:"h-16 w-16 rounded-full border-4 border-white dark:border-[#2c2e36] bg-gray-200 overflow-hidden",children:t.photoURL?e.jsx("img",{src:t.photoURL,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:e.jsx(R,{})})})})}),e.jsxs("div",{className:"pt-10 px-6 pb-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white text-lg",children:[t.firstName," ",t.lastName]}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 font-bold mb-2 flex items-center gap-1",children:[e.jsx(V,{size:12})," ",((p=t.subRoles)==null?void 0:p[0])||"Technician"]})]}),t.rate>0&&e.jsxs("div",{className:"text-sm font-bold dark:text-gray-300 border border-gray-200 dark:border-gray-600 px-2 py-1 rounded-lg",children:["$",t.rate,"/hr"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:(f=t.subRoles)==null?void 0:f.slice(0,3).map(k=>e.jsx("span",{className:"text-[10px] bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-200 px-2 py-0.5 rounded border border-orange-200 dark:border-orange-800",children:k},k))}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-4 h-6 overflow-hidden",children:(((y=t.skills)==null?void 0:y.split(","))||[]).slice(0,3).map((k,u)=>e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 pr-2 border-r border-gray-300 dark:border-gray-600 last:border-0",children:k.trim()},u))}),e.jsxs("div",{className:"flex gap-2 mt-auto",children:[e.jsx("button",{onClick:()=>x(t.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 rounded-lg text-xs font-bold transition",children:"Profile"}),e.jsxs("button",{onClick:()=>m(t),className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white py-2 rounded-lg text-xs font-bold transition shadow-sm flex items-center justify-center gap-1",children:[e.jsx(E,{size:14})," Request"]})]})]})]},t.id)})}),j&&e.jsx(ee,{user:a,userData:r,target:j,onClose:()=>m(null)})]})}function se({user:a,userData:r,onSuccess:x,onCancel:l}){const[b,o]=g.useState(T[0].label),[s,n]=g.useState(""),[i,v]=g.useState("Normal"),[d,j]=g.useState(""),[m,w]=g.useState(""),[t,p]=g.useState(!1),[f,y]=g.useState(null),{uploadMedia:k,uploading:u}=D(),C=async h=>{const N=h.target.files[0];if(!N)return;const q=await k(N,`service_requests/${a.uid}`);q&&y(q)},S=async()=>{if(!s||!m||!c){(!s||!m)&&alert("Please complete the request.");return}p(!0);try{const h=(a==null?void 0:a.id)||(a==null?void 0:a.uid),{error:N}=await c.from("service_requests").insert({user_id:h,user_name:r&&`${r.firstName||""} ${r.lastName||""}`.trim()||"User",topic:`${b} for ${s}`,category:b,equipment:s,urgency:i,budget:d?parseInt(d):null,description:m,status:"Open",attachment_url:(f==null?void 0:f.url)||null});if(N)throw N;alert("Tech Request Broadcasted!"),x()}catch(h){console.error(h),alert("Failed: "+(h.message||"Unknown error"))}p(!1)};return e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border border-orange-200 dark:border-gray-700 shadow-xl animate-in zoom-in-95",children:[e.jsxs("h2",{className:"text-2xl font-extrabold dark:text-white mb-6 flex items-center gap-2 text-orange-600",children:[e.jsx(F,{})," Broadcast Tech Need"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-6 bg-orange-50 dark:bg-gray-800 rounded-xl border border-orange-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-lg font-medium text-gray-700 dark:text-gray-200",children:[e.jsx("span",{children:"I need"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:b,onChange:h=>o(h.target.value),className:"appearance-none bg-white dark:bg-gray-700 border border-orange-300 dark:border-orange-700 rounded-lg py-1 pl-3 pr-8 font-bold text-orange-700 dark:text-white focus:outline-none",children:T.map(h=>e.jsx("option",{value:h.label,children:h.label},h.id))}),e.jsx(M,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-orange-500 dark:text-white pointer-events-none"})]}),e.jsx("span",{children:"for my"}),e.jsx("input",{className:"bg-transparent border-b-2 border-orange-300 dark:border-orange-700 text-center w-40 font-bold focus:outline-none focus:border-orange-500 dark:text-white",placeholder:"Equipment Name",value:s,onChange:h=>n(h.target.value)})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Urgency"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:i,onChange:h=>v(h.target.value),children:[e.jsx("option",{children:"Normal"}),e.jsx("option",{children:"High (Session Blocked)"}),e.jsx("option",{children:"Emergency (24h)"}),e.jsx("option",{children:"Flexible"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Est. Budget ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Optional",value:d,onChange:h=>j(h.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Details"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Describe the issue, specific model, symptoms...",value:m,onChange:h=>w(h.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Visual Reference"}),!f&&!u&&e.jsxs("label",{className:"flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition text-gray-500",children:[e.jsx(B,{size:20}),e.jsx("span",{className:"text-sm font-bold",children:"Upload Video or Image"}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*,image/*",onChange:C})]}),f&&e.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden border dark:border-gray-700 bg-black",children:[f.type==="video"?e.jsx("video",{src:f.url,controls:!0,className:"w-full h-48 object-contain"}):e.jsx("img",{src:f.url,className:"w-full h-48 object-contain"}),e.jsx("button",{onClick:()=>y(null),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(z,{size:14})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"Cancel"}),e.jsx("button",{onClick:S,disabled:t||u,className:"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:t?e.jsx(_,{className:"animate-spin"}):"Broadcast Now"})]})]})]})}function te({user:a,isTech:r}){const[x,l]=g.useState("feed"),[b,o]=g.useState([]),[s,n]=g.useState(!0);g.useEffect(()=>{if(!c)return;const d=c.channel("equipment-submissions").on("postgres_changes",{event:"*",schema:"public",table:"equipment_submissions",filter:"status=eq.pending"},()=>{i()}).subscribe();return i(),()=>{c.removeChannel(d)}},[a==null?void 0:a.id,a==null?void 0:a.uid]);const i=async()=>{if(c){n(!0);try{const{data:d,error:j}=await c.from("equipment_submissions").select("*").eq("status","pending").order("timestamp",{ascending:!1}).limit(20);if(j)throw j;o((d||[]).map(m=>({id:m.id,...m,submittedBy:m.submitted_by,timestamp:m.timestamp})))}catch(d){console.error("Error loading pending items:",d)}n(!1)}},v=async(d,j,m)=>{var t,p,f;if(!r||!c){r||alert("Only verified Technicians can vote on gear accuracy.");return}const w=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const y=m.votes||{},k=y[j]||[];if(k.includes(w)){alert("You've already voted on this item.");return}const u={...y,[j]:[...k,w]};await c.from("equipment_submissions").update({votes:u}).eq("id",d);const C=3,S=3,h=((t=u.yes)==null?void 0:t.length)||0,N=((p=u.fake)==null?void 0:p.length)||0,q=((f=u.duplicate)==null?void 0:f.length)||0;if(h>=C){await c.from("equipment_database").insert({name:m.model,brand:m.brand,category:m.category,sub_category:m.subCategory,specs:m.specs,verified_by:[w],added_by:m.submittedBy,added_at:new Date().toISOString()}),await c.from("equipment_submissions").update({status:"approved"}).eq("id",d);const{data:I}=await c.from("wallets").select("balance").eq("user_id",m.submittedBy).single(),{data:$}=await c.from("wallets").select("balance").eq("user_id",w).single();I&&await c.from("wallets").update({balance:(I.balance||0)+50}).eq("user_id",m.submittedBy),$&&await c.from("wallets").update({balance:($.balance||0)+5}).eq("user_id",w),alert("Consensus reached! Item approved and rewards distributed.")}else(N>=S||q>=S)&&await c.from("equipment_submissions").update({status:"rejected"}).eq("id",d)}catch(y){console.error("Voting failed:",y)}};return e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(O,{className:"text-orange-500"})," Gear Knowledge Base"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Crowdsourced equipment specs verified by pros."})]}),e.jsxs("div",{className:"flex gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>l("feed"),className:`px-4 py-2 rounded-md text-xs font-bold transition ${x==="feed"?"bg-white dark:bg-gray-600 shadow text-orange-600 dark:text-orange-400":"text-gray-500"}`,children:"The Bench (Queue)"}),e.jsx("button",{onClick:()=>l("submit"),className:`px-4 py-2 rounded-md text-xs font-bold transition ${x==="submit"?"bg-white dark:bg-gray-600 shadow text-orange-600 dark:text-orange-400":"text-gray-500"}`,children:"Submit New Gear"})]})]}),x==="feed"&&e.jsx("div",{className:"grid grid-cols-1 gap-4",children:s?e.jsx("div",{className:"p-10 text-center",children:e.jsx(_,{className:"animate-spin mx-auto"})}):b.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl",children:[e.jsx(G,{size:48,className:"mx-auto text-green-500 mb-2 opacity-50"}),e.jsx("p",{className:"text-gray-500",children:"The bench is clear. No pending submissions."})]}):b.map(d=>{var j,m,w,t,p,f,y,k,u,C,S,h,N;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-500",children:d.brand}),e.jsx("span",{className:"text-[10px] font-bold uppercase bg-blue-50 dark:bg-blue-900/20 text-blue-600 px-2 py-0.5 rounded",children:(j=d.category)==null?void 0:j.replace(/_/g," ")})]}),e.jsx("h4",{className:"text-lg font-extrabold dark:text-white mb-2",children:d.model}),e.jsx("div",{className:"bg-gray-50 dark:bg-black/20 p-3 rounded-lg text-sm text-gray-600 dark:text-gray-300 mb-2 border dark:border-gray-700",children:d.specs}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(R,{size:12})," Submitted by ",d.submitterName||"Unknown"," â€¢ 50 TK Reward Pending"]})]}),e.jsxs("div",{className:"w-full md:w-48 flex flex-col justify-center gap-2 border-l dark:border-gray-700 pl-0 md:pl-6",children:[e.jsxs("button",{onClick:()=>v(d.id,"yes",d),disabled:(w=(m=d.votes)==null?void 0:m.yes)==null?void 0:w.includes(a.uid),className:"w-full py-2 bg-green-100 dark:bg-green-900/20 hover:bg-green-200 text-green-700 dark:text-green-400 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(H,{size:14})," Yes (",((p=(t=d.votes)==null?void 0:t.yes)==null?void 0:p.length)||0,")"]}),e.jsxs("button",{onClick:()=>v(d.id,"fake",d),disabled:(y=(f=d.votes)==null?void 0:f.fake)==null?void 0:y.includes(a.uid),className:"w-full py-2 bg-red-100 dark:bg-red-900/20 hover:bg-red-200 text-red-700 dark:text-red-400 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(Y,{size:14})," Fake (",((u=(k=d.votes)==null?void 0:k.fake)==null?void 0:u.length)||0,")"]}),e.jsxs("button",{onClick:()=>v(d.id,"duplicate",d),disabled:(S=(C=d.votes)==null?void 0:C.duplicate)==null?void 0:S.includes(a.uid),className:"w-full py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 text-gray-600 dark:text-gray-300 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(K,{size:14})," Dup (",((N=(h=d.votes)==null?void 0:h.duplicate)==null?void 0:N.length)||0,")"]})]})]},d.id)})}),x==="submit"&&e.jsx(re,{user:a,userData,onSuccess:()=>l("feed")})]})}function re({user:a,userData:r,onSuccess:x}){const[l,b]=g.useState({brand:"",model:"",category:U[0].id,subCategory:"",specs:""}),[o,s]=g.useState(!1),n=async()=>{if(!l.brand||!l.model||!l.specs)return alert("All fields required.");if(!c){alert("Database unavailable.");return}s(!0);try{const i=(a==null?void 0:a.id)||(a==null?void 0:a.uid),v=r&&`${r.firstName||""} ${r.lastName||""}`.trim()||"User",{error:d}=await c.from("equipment_submissions").insert({brand:l.brand,model:l.model,category:l.category,sub_category:l.subCategory,specs:l.specs,submitted_by:i,submitter_name:v,status:"pending",timestamp:new Date().toISOString(),votes:{yes:[],fake:[],duplicate:[]}});if(d)throw d;alert("Submission Received! You'll earn 50 TK once verified."),x()}catch(i){console.error(i),alert("Submission failed: "+(i.message||"Unknown error"))}s(!1)};return e.jsxs("div",{className:"max-w-xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border border-orange-200 dark:border-gray-700 shadow-lg",children:[e.jsx("h4",{className:"font-bold text-lg dark:text-white mb-4",children:"Submit New Equipment"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsx("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:l.category,onChange:i=>b({...l,category:i.target.value}),children:U.map(i=>e.jsx("option",{value:i.id,children:i.label},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Sub-Category"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. Compressor",value:l.subCategory,onChange:i=>b({...l,subCategory:i.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. Neve",value:l.brand,onChange:i=>b({...l,brand:i.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. 1073LB",value:l.model,onChange:i=>b({...l,model:i.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Specs / Description"}),e.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm h-24",placeholder:"Brief technical specs...",value:l.specs,onChange:i=>b({...l,specs:i.target.value})})]}),e.jsx("button",{onClick:n,disabled:o,className:"w-full bg-orange-600 text-white py-2.5 rounded-lg font-bold hover:bg-orange-700 flex items-center justify-center gap-2",children:o?e.jsx(_,{className:"animate-spin"}):"Submit for Verification"})]})]})}function le({user:a}){const[r,x]=g.useState({skills:"",rate:"",serviceRadius:"",subRoles:[]}),[l,b]=g.useState(!0);g.useEffect(()=>{if(!(a!=null&&a.id)&&!(a!=null&&a.uid)||!c){b(!1);return}const s=a.id||a.uid;c.from("sub_profiles").select("*").eq("user_id",s).eq("role","Technician").single().then(({data:n,error:i})=>{i&&i.code!=="PGRST116"&&console.error("Error fetching tech profile:",i),n&&x({skills:n.skills||"",rate:n.rate||"",serviceRadius:n.service_radius||n.serviceRadius||"",subRoles:n.sub_roles||n.subRoles||[]}),b(!1)})},[a==null?void 0:a.id,a==null?void 0:a.uid]);const o=async()=>{if(!c){alert("Database unavailable.");return}try{const s=(a==null?void 0:a.id)||(a==null?void 0:a.uid),{error:n}=await c.from("sub_profiles").upsert({user_id:s,role:"Technician",skills:r.skills,rate:r.rate?parseInt(r.rate):null,service_radius:r.serviceRadius?parseInt(r.serviceRadius):null,sub_roles:r.subRoles||[],updated_at:new Date().toISOString()},{onConflict:"user_id,role"});if(n)throw n;const i=[...r.skills?r.skills.toLowerCase().split(",").map(d=>d.trim()):[],...r.subRoles?r.subRoles.map(d=>d.toLowerCase()):[]],{error:v}=await c.from("public_profiles").update({rate:parseInt(r.rate)||0,sub_roles:r.subRoles||[],search_terms:i}).eq("id",s);if(v)throw v;alert("Tech Profile Updated Successfully")}catch(s){console.error(s),alert("Update failed: "+(s.message||"Unknown error"))}};return l?e.jsx("div",{className:"p-10 text-center",children:e.jsx(_,{className:"animate-spin mx-auto"})}):e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm animate-in fade-in",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white mb-6 border-b dark:border-gray-700 pb-2",children:"Your Technician Settings"}),e.jsxs("div",{className:"space-y-5",children:[e.jsx(X,{label:"Primary Specialties",fieldKey:"subRoles",options:L,initialValues:r.subRoles,onChange:(s,n)=>x(i=>({...i,[s]:n}))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Detailed Skills (Comma Separated)"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:r.skills||"",onChange:s=>x({...r,skills:s.target.value}),placeholder:"e.g. SSL 4000 Maintenance, Tube Bias..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hourly Rate ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:r.rate||"",onChange:s=>x({...r,rate:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Radius (Miles)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:r.serviceRadius||"",onChange:s=>x({...r,serviceRadius:s.target.value})})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:o,className:"w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(J,{size:18})," Save Changes"]})})]})]})}function xe({user:a,userData:r,openPublicProfile:x}){var s;const[l,b]=g.useState("board"),o=(s=r==null?void 0:r.accountTypes)==null?void 0:s.includes("Technician");return e.jsxs("div",{className:"max-w-6xl mx-auto gap-fluid pb-20 container-fluid",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-900 to-slate-900 p-8 rounded-2xl text-white shadow-xl relative overflow-hidden flex flex-col md:flex-row justify-between items-end",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-400 font-bold uppercase tracking-widest text-xs mb-2",children:[e.jsx(E,{size:14})," SeshNx Technical"]}),e.jsx("h1",{className:"text-3xl font-extrabold mb-2",children:"Studio Tech Services"}),e.jsx("p",{className:"text-slate-300 max-w-lg",children:"Hire professionals for equipment repair, studio wiring, and acoustic calibration."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 relative z-10 mt-4 md:mt-0",children:[e.jsx("button",{onClick:()=>b("board"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${l==="board"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Job Board"}),e.jsx("button",{onClick:()=>b("directory"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${l==="directory"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Find a Tech"}),e.jsx("button",{onClick:()=>b("broadcast"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${l==="broadcast"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Post Request"}),e.jsx("button",{onClick:()=>b("database"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${l==="database"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Gear DB"}),o&&e.jsx("button",{onClick:()=>b("profile"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${l==="profile"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Tech Portal"})]}),e.jsx(W,{size:200,className:"absolute -right-10 -top-10 text-white opacity-5 rotate-12 pointer-events-none"})]}),e.jsxs("div",{className:"min-h-[400px]",children:[l==="board"&&e.jsx(Z,{user:a}),l==="directory"&&e.jsx(ae,{user:a,userData:r,openPublicProfile:x}),l==="broadcast"&&e.jsx(se,{user:a,userData:r,onSuccess:()=>b("board"),onCancel:()=>b("board")}),l==="database"&&e.jsx(te,{user:a,isTech:o}),l==="profile"&&o&&e.jsx(le,{user:a})]})]})}export{xe as default};
