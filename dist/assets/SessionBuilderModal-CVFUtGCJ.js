import{r as P,cb as _,cf as R,cg as L,j as e,U as M,X as U,t as J,T as V,cd as G,cm as H,c as X,L as Y,y as Z,ce as k,ci as q,ch as w}from"./vendor-mIyI6DiM.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="7e8eb7d8-c077-4ecd-9890-513d87d2f3ad",t._sentryDebugIdIdentifier="sentry-dbid-7e8eb7d8-c077-4ecd-9890-513d87d2f3ad")})()}catch{}const K=L({sessionName:w().min(3,"Session name must be at least 3 chars"),date:w().optional(),time:w().optional(),duration:q().min(1).max(24)});function W({user:t,userData:n,cart:l,onRemoveFromCart:C,onClose:$,onComplete:F}){const[h,v]=P.useState(!1),{register:c,handleSubmit:z,watch:E,formState:{errors:x,isValid:T}}=_({resolver:R(K),defaultValues:{sessionName:n!=null&&n.lastName?`${n.lastName} Session`:"Session",duration:4,date:"",time:""},mode:"onChange"}),S=E("duration")||0,A=()=>{let s=0;const o=parseInt(S)||0,r=l.map(f=>{const p=f.rate||0,a=p*o;return s+=a,{...f,itemTotal:a,hourlyRate:p}}),b=l.length>=3,N=b?s*.1:0,u=s-N;return{subtotal:s,discountAmount:N,finalTotal:u,lineItems:r,shouldDiscount:b}},{subtotal:D,discountAmount:B,finalTotal:g,lineItems:y,shouldDiscount:j}=A(),O=async s=>{v(!0);const o=k.loading("Initializing Session...");try{let r=null;if(g>0)try{const d=await fetch("/api/stripe/create-split-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({totalAmount:g,description:`Session: ${s.sessionName}`,transfers:y.map(i=>{var I;return{recipientId:i.id,amount:i.itemTotal*(j?.9:1),role:((I=i.accountTypes)==null?void 0:I[0])||"Creative"}})})});if(!d.ok)console.warn("Payment initialization failed, continuing without payment");else{const i=await d.json();i!=null&&i.paymentIntentId&&(r=i.paymentIntentId)}}catch(a){console.warn("Payment setup error, continuing without payment:",a)}const b=(n==null?void 0:n.id)||(t==null?void 0:t.id)||(t==null?void 0:t.uid),N=`session_${Date.now()}`,u=s.time?new Date(`2000-01-01T${s.time}`).getTime()+s.duration*60*60*1e3:null,f=u?new Date(u).toTimeString().slice(0,5):null,p=y.map(a=>{var d;return fetch("/api/studio-ops/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studioId:a.id,senderId:b,type:((d=a.accountTypes)==null?void 0:d[0])||"Session",date:s.date||"Flexible",startTime:s.time||"Flexible",endTime:f||"Flexible",offerAmount:a.itemTotal*(j?.9:1),notes:`Group Session: ${s.sessionName}`})})});await Promise.all(p),k.success("Session Created!",{id:o}),F()}catch(r){console.error("Booking Error:",r),k.error("Failed: "+r.message,{id:o})}finally{v(!1)}},m=s=>J("w-full p-2 border rounded-lg dark:bg-black/20 dark:text-white transition-colors focus:ring-2 focus:ring-brand-blue outline-none",s?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-200 dark:border-gray-600");return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-in fade-in",children:e.jsxs("form",{onSubmit:z(O),className:"bg-white dark:bg-[#2c2e36] w-full max-w-2xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] rounded-t-2xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(M,{className:"text-brand-blue"})," Session Builder"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[l.length," Members Selected"]})]}),e.jsx("button",{type:"button",onClick:$,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(U,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Session Name"}),e.jsx("input",{...c("sessionName"),className:m(x.sessionName),placeholder:"e.g. My Album Recording"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Date (Optional)"}),e.jsx("input",{type:"date",...c("date"),className:m(x.date)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Time (Optional)"}),e.jsx("input",{type:"time",...c("time"),className:m(x.time)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Duration (Hours)"}),e.jsx("input",{type:"number",...c("duration",{valueAsNumber:!0}),className:m(x.duration)})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-bold dark:text-white mb-3",children:"Session Roster"}),e.jsxs("div",{className:"space-y-2",children:[l.map(s=>{var o;return e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-[#2c2e36] p-2 rounded-lg border dark:border-gray-600 shadow-sm animate-in slide-in-from-right-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold",children:s.firstName[0]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-bold dark:text-white",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(o=s.accountTypes)==null?void 0:o[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-mono",children:["$",s.rate,"/hr"]}),e.jsx("button",{type:"button",onClick:()=>C(s.id),className:"text-red-400 hover:text-red-600 transition-colors",children:e.jsx(V,{size:14})})]})]},s.id)}),l.length===0&&e.jsx("div",{className:"text-center text-xs text-gray-400 py-4 italic",children:"No members added yet."})]})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(G,{size:20})," Cost Breakdown"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-800 transition-all",children:[e.jsx("div",{className:"space-y-2 mb-4 text-sm",children:y.map(s=>e.jsxs("div",{className:"flex justify-between text-blue-900 dark:text-blue-100",children:[e.jsxs("span",{children:[s.firstName," (",s.accountTypes[0],") x ",S,"hrs"]}),e.jsxs("span",{className:"font-mono",children:["$",s.itemTotal.toFixed(2)]})]},s.id))}),e.jsxs("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-blue-800 dark:text-blue-300 font-bold",children:"Subtotal"}),e.jsxs("span",{className:"text-blue-800 dark:text-blue-300 font-bold font-mono",children:["$",D.toFixed(2)]})]}),j&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400 font-bold mt-2 animate-in slide-in-from-right-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{size:14,fill:"currentColor"})," Bundle Discount (10%)"]}),e.jsxs("span",{className:"font-mono",children:["-$",B.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-2xl font-black dark:text-white",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{className:"font-mono",children:["$",g.toFixed(2)]})]})]})]})]}),e.jsx("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] rounded-b-2xl",children:e.jsx("button",{type:"submit",disabled:h||l.length===0||!T,className:X("w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg flex items-center justify-center gap-2",h||l.length===0||!T?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]"),children:h?e.jsx(Y,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:20})," Confirm & Book"]})})})]})})}export{W as default};
