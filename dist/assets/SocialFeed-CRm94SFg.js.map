{"version":3,"file":"SocialFeed-CRm94SFg.js","sources":["../../src/components/social/CommentSection.jsx","../../src/components/social/PostCard.jsx","../../src/components/social/CreatePostWidget.jsx","../../src/components/social/discover/DiscoverSection.jsx","../../src/components/social/discover/DiscoverCard.jsx","../../src/utils/recommendations.js","../../src/hooks/useDiscover.js","../../src/components/social/discover/SoundsDiscover.jsx","../../src/components/social/discover/ArtistsDiscover.jsx","../../src/components/social/discover/ProducersDiscover.jsx","../../src/components/social/discover/StudiosDiscover.jsx","../../src/components/social/discover/SchoolsDiscover.jsx","../../src/components/social/Discover.jsx","../../src/components/SocialFeed.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Send, Trash2, CornerDownRight } from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport { createNotification } from '../../hooks/useNotifications';\r\nimport UserAvatar from '../shared/UserAvatar';\r\n\r\nexport default function CommentSection({ post, currentUser, currentUserData, blockedUsers, onCountChange }) {\r\n    const [comments, setComments] = useState([]);\r\n    const [text, setText] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!supabase || !post.id) return;\r\n\r\n        // Initial fetch\r\n        supabase\r\n            .from('comments')\r\n            .select('*')\r\n            .eq('post_id', post.id)\r\n            .order('created_at', { ascending: true })\r\n            .then(({ data, error }) => {\r\n                if (error) {\r\n                    console.error('Comments fetch error:', error);\r\n                    return;\r\n                }\r\n                \r\n                const comments = (data || []).map(c => ({\r\n                    id: c.id,\r\n                    ...c,\r\n                    userId: c.user_id,\r\n                    displayName: c.display_name,\r\n                    userPhoto: c.user_photo,\r\n                    timestamp: c.created_at\r\n                }));\r\n                \r\n                // Client-side block filtering\r\n                const filtered = comments.filter(c => !blockedUsers?.includes(c.userId));\r\n                setComments(filtered);\r\n                onCountChange(filtered.length);\r\n            });\r\n\r\n        // Subscribe to realtime changes\r\n        const channel = supabase\r\n            .channel(`comments-${post.id}`)\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: '*',\r\n                    schema: 'public',\r\n                    table: 'comments',\r\n                    filter: `post_id=eq.${post.id}`\r\n                },\r\n                async () => {\r\n                    const { data } = await supabase\r\n                        .from('comments')\r\n                        .select('*')\r\n                        .eq('post_id', post.id)\r\n                        .order('created_at', { ascending: true });\r\n                    \r\n                    if (data) {\r\n                        const comments = data.map(c => ({\r\n                            id: c.id,\r\n                            ...c,\r\n                            userId: c.user_id,\r\n                            displayName: c.display_name,\r\n                            userPhoto: c.user_photo,\r\n                            timestamp: c.created_at\r\n                        }));\r\n                        \r\n                        const filtered = comments.filter(c => !blockedUsers?.includes(c.userId));\r\n                        setComments(filtered);\r\n                        onCountChange(filtered.length);\r\n                    }\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [post.id, blockedUsers]);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        const userId = currentUser?.id || currentUser?.uid;\r\n        if (!text.trim() || !userId || !supabase) return;\r\n        setLoading(true);\r\n        \r\n        const displayName = currentUserData?.effectiveDisplayName || \r\n            currentUserData?.firstName || \r\n            currentUser?.displayName || \r\n            'User';\r\n        \r\n        try {\r\n            // Ensure content is not empty (required by schema)\r\n            const commentContent = text.trim();\r\n            if (!commentContent) {\r\n                alert('Please enter a comment');\r\n                setLoading(false);\r\n                return;\r\n            }\r\n            \r\n            const { error } = await supabase\r\n                .from('comments')\r\n                .insert({\r\n                    post_id: post.id,\r\n                    user_id: userId,\r\n                    text: commentContent,\r\n                    content: commentContent, // Required by schema - NOT NULL\r\n                    display_name: displayName,\r\n                    author_photo: currentUserData?.photoURL || null,\r\n                    user_photo: currentUserData?.photoURL || null,\r\n                    created_at: new Date().toISOString()\r\n                });\r\n            \r\n            if (error) {\r\n                console.error('Comment insert error:', error);\r\n                alert(`Failed to post comment: ${error.message || 'Unknown error'}`);\r\n                setLoading(false);\r\n                return;\r\n            }\r\n            \r\n            // Update post comment count\r\n            // Try RPC first, fallback to direct update if RPC doesn't exist\r\n            try {\r\n                const rpcResult = supabase.rpc('increment', {\r\n                    table_name: 'posts',\r\n                    id_column: 'id',\r\n                    id_value: post.id,\r\n                    count_column: 'comment_count'\r\n                });\r\n                \r\n                // Check if rpc returns a promise-like object\r\n                if (rpcResult && typeof rpcResult.then === 'function') {\r\n                    const { error: rpcError } = await rpcResult;\r\n                    if (rpcError) {\r\n                        // RPC exists but failed, use fallback\r\n                        throw rpcError;\r\n                    }\r\n                } else {\r\n                    // RPC doesn't exist or doesn't return a promise, use fallback\r\n                    throw new Error('RPC not available');\r\n                }\r\n            } catch (rpcErr) {\r\n                // Fallback: Direct update if RPC doesn't exist or fails\r\n                // This is non-critical, so we don't throw - just log\r\n                try {\r\n                    const { error: updateError } = await supabase\r\n                        .from('posts')\r\n                        .update({ comment_count: (post.commentCount || 0) + 1 })\r\n                        .eq('id', post.id);\r\n                    \r\n                    if (updateError) {\r\n                        console.warn('Failed to update comment count:', updateError);\r\n                    }\r\n                } catch (updateErr) {\r\n                    console.warn('Comment count update failed:', updateErr);\r\n                    // Don't fail the comment submission if count update fails\r\n                }\r\n            }\r\n            \r\n            // Send notification to post author (if not commenting on own post)\r\n            if (post.userId !== userId) {\r\n                createNotification({\r\n                    targetUserId: post.userId,\r\n                    type: 'comment',\r\n                    fromUserId: userId,\r\n                    fromUserName: displayName,\r\n                    fromUserPhoto: currentUserData?.photoURL,\r\n                    postId: post.id,\r\n                    postPreview: post.text?.substring(0, 50),\r\n                    message: 'commented on your post'\r\n                });\r\n            }\r\n            \r\n            setText('');\r\n            setLoading(false);\r\n        } catch (e) { \r\n            console.error('Comment submission error:', e);\r\n            alert(`Failed to post comment: ${e.message || 'Unknown error'}`);\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (commentId) => {\r\n        if (!window.confirm(\"Delete comment?\") || !supabase) return;\r\n        try {\r\n            await supabase\r\n                .from('comments')\r\n                .delete()\r\n                .eq('id', commentId);\r\n            \r\n            // Decrement comment count\r\n            await supabase\r\n                .from('posts')\r\n                .update({ comment_count: Math.max((post.commentCount || 0) - 1, 0) })\r\n                .eq('id', post.id);\r\n        } catch (e) {\r\n            console.error('Delete comment error:', e);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-gray-50 dark:bg-[#1f2128] border-t dark:border-gray-700 p-4 animate-in slide-in-from-top-2\">\r\n            {/* Comments List */}\r\n            <div className=\"space-y-4 mb-4 max-h-80 overflow-y-auto custom-scrollbar pr-2\">\r\n                {comments.length === 0 && (\r\n                    <div className=\"text-center text-gray-400 text-xs py-2\">\r\n                        No comments yet. Be the first!\r\n                    </div>\r\n                )}\r\n                {comments.map(comment => (\r\n                    <div key={comment.id} className=\"group flex gap-3 text-sm\">\r\n                        <UserAvatar \r\n                            src={comment.userPhoto}\r\n                            name={comment.displayName}\r\n                            size=\"xs\"\r\n                            className=\"shrink-0\"\r\n                        />\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"bg-white dark:bg-dark-card border dark:border-gray-700 p-3 rounded-2xl rounded-tl-none inline-block max-w-full\">\r\n                                <div className=\"flex justify-between items-baseline gap-2 mb-1\">\r\n                                    <span className=\"font-bold dark:text-white text-xs truncate\">\r\n                                        {comment.displayName}\r\n                                    </span>\r\n                                    <span className=\"text-[10px] text-gray-400 shrink-0\">\r\n                                        {comment.timestamp \r\n                                            ? new Date(comment.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) \r\n                                            : 'Just now'}\r\n                                    </span>\r\n                                </div>\r\n                                <p className=\"text-gray-700 dark:text-gray-300 break-words\">{comment.text}</p>\r\n                            </div>\r\n                            <div className=\"flex gap-3 mt-1 ml-2\">\r\n                                <button className=\"text-[10px] font-bold text-gray-500 hover:text-brand-blue transition\">\r\n                                    Reply\r\n                                </button>\r\n                                {comment.userId === currentUser?.uid && (\r\n                                    <button \r\n                                        onClick={() => handleDelete(comment.id)} \r\n                                        className=\"text-[10px] font-bold text-gray-400 hover:text-red-500 transition\"\r\n                                    >\r\n                                        Delete\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Comment Input */}\r\n            <form onSubmit={handleSubmit} className=\"flex gap-2\">\r\n                <UserAvatar \r\n                    src={currentUserData?.photoURL}\r\n                    name={currentUserData?.firstName || 'You'}\r\n                    size=\"xs\"\r\n                    className=\"shrink-0 hidden sm:block\"\r\n                />\r\n                <input \r\n                    className=\"flex-1 bg-white dark:bg-dark-card border dark:border-gray-600 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition\"\r\n                    placeholder=\"Write a comment...\"\r\n                    value={text}\r\n                    onChange={e => setText(e.target.value)}\r\n                />\r\n                <button \r\n                    type=\"submit\" \r\n                    disabled={!text.trim() || loading} \r\n                    className=\"bg-brand-blue text-white p-2 rounded-full hover:bg-blue-600 disabled:opacity-50 transition shadow-sm\"\r\n                >\r\n                    <Send size={16} className={loading ? 'animate-pulse' : ''}/>\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useRef, useEffect } from 'react';\r\nimport { MessageCircle, Share2, MoreHorizontal, User, Bookmark, Smile, UserPlus, Link2, Flag, Trash2, Check } from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport StarFieldVisualizer from '../shared/StarFieldVisualizer';\r\nimport CommentSection from './CommentSection';\r\nimport { motion, AnimatePresence } from 'framer-motion'; \r\nimport { createNotification } from '../../hooks/useNotifications';\r\nimport FollowButton, { FollowButtonCompact } from './FollowButton';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst REACTION_SET = ['ðŸ‘', 'â¤ï¸', 'ðŸ˜‚', 'ðŸ˜®', 'ðŸ˜¢', 'ðŸ”¥'];\r\n\r\nconst renderText = (text) => {\r\n    if (!text) return null;\r\n    return text.split(/(\\s+)/).map((part, i) => {\r\n        if (part.match(/^#\\w+/)) return <span key={i} className=\"text-brand-blue font-bold cursor-pointer hover:underline\">{part}</span>;\r\n        if (part.match(/^@\\w+/)) return <span key={i} className=\"text-purple-600 font-bold cursor-pointer hover:underline\">{part}</span>;\r\n        return part;\r\n    });\r\n};\r\n\r\nconst cardVariants = {\r\n    hidden: { opacity: 0, y: 20 },\r\n    show: { opacity: 1, y: 0, transition: { type: \"spring\", stiffness: 300, damping: 24 } },\r\n    exit: { opacity: 0, scale: 0.95, transition: { duration: 0.2 } }\r\n};\r\n\r\nexport default function PostCard({ \r\n    post, \r\n    currentUser, \r\n    currentUserData,\r\n    openPublicProfile, \r\n    onReport,\r\n    isFollowingAuthor,\r\n    onToggleFollow \r\n}) {\r\n    const [showComments, setShowComments] = useState(false);\r\n    const [commentCount, setCommentCount] = useState(post.commentCount || 0); \r\n    const [isSaved, setIsSaved] = useState(false);\r\n    const [showReactionMenu, setShowReactionMenu] = useState(false);\r\n    const [showMoreMenu, setShowMoreMenu] = useState(false);\r\n    const [linkCopied, setLinkCopied] = useState(false);\r\n    const [savingPost, setSavingPost] = useState(false);\r\n    const menuRef = useRef(null);\r\n    const moreMenuRef = useRef(null);\r\n\r\n    const userId = currentUser?.id || currentUser?.uid;\r\n    const isOwnPost = post.userId === userId;\r\n    const myReaction = post.reactions?.[userId];\r\n    const reactionCounts = post.reactions ? Object.values(post.reactions).reduce((acc, emoji) => {\r\n        acc[emoji] = (acc[emoji] || 0) + 1;\r\n        return acc;\r\n    }, {}) : {};\r\n    const totalReactions = Object.values(reactionCounts).reduce((a, b) => a + b, 0);\r\n\r\n    // Check if post is saved on mount\r\n    useEffect(() => {\r\n        if (!userId || !supabase) return;\r\n        \r\n        const checkSaved = async () => {\r\n            try {\r\n                const { data, error } = await supabase\r\n                    .from('saved_posts')\r\n                    .select('id')\r\n                    .eq('user_id', userId)\r\n                    .eq('post_id', post.id)\r\n                    .maybeSingle(); // Use maybeSingle() to handle case when no record exists\r\n                \r\n                setIsSaved(!!data && !error);\r\n            } catch (e) {\r\n                console.error('Error checking saved status:', e);\r\n                setIsSaved(false); // Default to false on error\r\n            }\r\n        };\r\n        checkSaved();\r\n    }, [userId, post.id]);\r\n\r\n    // Close menus on outside click\r\n    useEffect(() => {\r\n        const handleClickOutside = (event) => {\r\n            if (menuRef.current && !menuRef.current.contains(event.target)) {\r\n                setShowReactionMenu(false);\r\n            }\r\n            if (moreMenuRef.current && !moreMenuRef.current.contains(event.target)) {\r\n                setShowMoreMenu(false);\r\n            }\r\n        };\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, []);\r\n\r\n    const handleReaction = async (emoji) => {\r\n        setShowReactionMenu(false);\r\n        if (!userId || !supabase) return;\r\n\r\n        try {\r\n            const wasReacted = !!myReaction;\r\n            const currentReactions = post.reactions || {};\r\n            \r\n            if (myReaction === emoji) {\r\n                // Remove reaction\r\n                const newReactions = { ...currentReactions };\r\n                delete newReactions[userId];\r\n                \r\n                const { error } = await supabase\r\n                    .from('posts')\r\n                    .update({\r\n                        reactions: newReactions,\r\n                        reaction_count: (post.reactionCount || 0) - 1\r\n                    })\r\n                    .eq('id', post.id);\r\n                \r\n                if (error) throw error;\r\n            } else {\r\n                // Add/change reaction\r\n                const newReactions = { ...currentReactions, [userId]: emoji };\r\n                const increment = !myReaction ? 1 : 0;\r\n                \r\n                const { error } = await supabase\r\n                    .from('posts')\r\n                    .update({\r\n                        reactions: newReactions,\r\n                        reaction_count: (post.reactionCount || 0) + increment\r\n                    })\r\n                    .eq('id', post.id);\r\n                \r\n                if (error) throw error;\r\n                \r\n                // Send notification (only for new reactions, not changes)\r\n                if (!wasReacted && !isOwnPost) {\r\n                    createNotification({\r\n                        targetUserId: post.userId,\r\n                        type: 'like',\r\n                        fromUserId: userId,\r\n                        fromUserName: currentUserData?.effectiveDisplayName || currentUserData?.firstName || 'Someone',\r\n                        fromUserPhoto: currentUserData?.photoURL,\r\n                        postId: post.id,\r\n                        postPreview: post.text?.substring(0, 50),\r\n                        message: `reacted ${emoji} to your post`\r\n                    });\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Reaction failed\", e);\r\n            toast.error(\"Couldn't add reaction\");\r\n        }\r\n    };\r\n\r\n    const handleSavePost = async () => {\r\n        if (!userId || savingPost || !supabase) return;\r\n        setSavingPost(true);\r\n\r\n        try {\r\n            if (isSaved) {\r\n                // Unsave\r\n                const { error: deleteError } = await supabase\r\n                    .from('saved_posts')\r\n                    .delete()\r\n                    .eq('user_id', userId)\r\n                    .eq('post_id', post.id);\r\n                \r\n                if (deleteError) throw deleteError;\r\n                \r\n                const { error: updateError } = await supabase\r\n                    .from('posts')\r\n                    .update({ save_count: (post.saveCount || 0) - 1 })\r\n                    .eq('id', post.id);\r\n                \r\n                if (updateError) throw updateError;\r\n                \r\n                setIsSaved(false);\r\n                toast.success('Removed from saved');\r\n            } else {\r\n                // Save\r\n                const { error: insertError } = await supabase\r\n                    .from('saved_posts')\r\n                    .insert({\r\n                        user_id: userId,\r\n                        post_id: post.id,\r\n                        author_id: post.userId,\r\n                        author_name: post.displayName,\r\n                        preview: post.text?.substring(0, 100) || 'Media post',\r\n                        saved_at: new Date().toISOString(),\r\n                        has_media: !!(post.attachments?.length || post.imageUrl || post.audioUrl)\r\n                    });\r\n                \r\n                if (insertError) throw insertError;\r\n                \r\n                const { error: updateError } = await supabase\r\n                    .from('posts')\r\n                    .update({ save_count: (post.saveCount || 0) + 1 })\r\n                    .eq('id', post.id);\r\n                \r\n                if (updateError) throw updateError;\r\n                \r\n                setIsSaved(true);\r\n                toast.success('Post saved!');\r\n\r\n                // Optionally notify author (some platforms do this)\r\n                // Uncomment if desired:\r\n                // if (!isOwnPost) {\r\n                //     createNotification({\r\n                //         targetUserId: post.userId,\r\n                //         type: 'save',\r\n                //         fromUserId: userId,\r\n                //         fromUserName: currentUserData?.effectiveDisplayName || 'Someone',\r\n                //         fromUserPhoto: currentUserData?.photoURL,\r\n                //         postId: post.id,\r\n                //         message: 'saved your post'\r\n                //     });\r\n                // }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Save failed\", e);\r\n            toast.error(\"Couldn't save post\");\r\n        }\r\n        setSavingPost(false);\r\n    };\r\n\r\n    const handleShare = async () => {\r\n        const shareUrl = `${window.location.origin}/post/${post.id}`;\r\n        \r\n        if (navigator.share) {\r\n            try {\r\n                await navigator.share({\r\n                    title: `Post by ${post.displayName}`,\r\n                    text: post.text?.substring(0, 100) || 'Check out this post',\r\n                    url: shareUrl\r\n                });\r\n            } catch (e) {\r\n                if (e.name !== 'AbortError') {\r\n                    copyLink(shareUrl);\r\n                }\r\n            }\r\n        } else {\r\n            copyLink(shareUrl);\r\n        }\r\n    };\r\n\r\n    const copyLink = (url) => {\r\n        navigator.clipboard.writeText(url);\r\n        setLinkCopied(true);\r\n        toast.success('Link copied to clipboard!');\r\n        setTimeout(() => setLinkCopied(false), 2000);\r\n    };\r\n\r\n    const handleDeletePost = async () => {\r\n        if (!isOwnPost || !supabase) return;\r\n        if (!window.confirm('Are you sure you want to delete this post?')) return;\r\n        \r\n        try {\r\n            const { error } = await supabase\r\n                .from('posts')\r\n                .delete()\r\n                .eq('id', post.id);\r\n            \r\n            if (error) throw error;\r\n            \r\n            toast.success('Post deleted');\r\n        } catch (e) {\r\n            console.error('Delete failed:', e);\r\n            toast.error(\"Couldn't delete post\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <motion.div \r\n            variants={cardVariants}\r\n            initial=\"hidden\"\r\n            animate=\"show\"\r\n            exit=\"exit\"\r\n            layout\r\n            className=\"bg-white dark:bg-dark-card border dark:border-gray-700 rounded-xl overflow-visible shadow-sm mb-4 relative\"\r\n        >\r\n            {/* Header */}\r\n            <div className=\"p-4 flex justify-between items-start\">\r\n                <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n                    <div \r\n                        className=\"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden cursor-pointer shrink-0\"\r\n                        onClick={() => post.userId && openPublicProfile(post.userId)}\r\n                        role=\"button\"\r\n                        tabIndex={0}\r\n                        aria-label={`View ${post.displayName || 'user'}'s profile`}\r\n                    >\r\n                        {post.authorPhoto ? (\r\n                            <img \r\n                                src={post.authorPhoto} \r\n                                className=\"h-full w-full object-cover\" \r\n                                alt={`${post.displayName || 'User'}'s avatar`}\r\n                                onError={(e) => { e.target.style.display = 'none'; }}\r\n                            />\r\n                        ) : (\r\n                            <div className=\"h-full w-full bg-gradient-to-tr from-brand-blue to-purple-500 flex items-center justify-center text-white font-bold\">\r\n                                {post.displayName?.[0]?.toUpperCase() || <User size={16} aria-hidden=\"true\" />}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                    <div className=\"min-w-0 flex-1\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <h4 \r\n                                className=\"font-bold dark:text-white text-sm hover:underline decoration-brand-blue cursor-pointer truncate\"\r\n                                onClick={() => post.userId && openPublicProfile(post.userId)}\r\n                            >\r\n                                {post.displayName || 'Unknown User'}\r\n                            </h4>\r\n                            {/* Follow button in header for non-own posts */}\r\n                            {!isOwnPost && onToggleFollow && !isFollowingAuthor && (\r\n                                <button\r\n                                    onClick={(e) => { e.stopPropagation(); onToggleFollow(); }}\r\n                                    className=\"text-xs font-bold text-brand-blue hover:text-blue-700 transition shrink-0\"\r\n                                >\r\n                                    â€¢ Follow\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 flex items-center gap-1\">\r\n                            <span className=\"truncate\">{post.role}</span>\r\n                            <span>â€¢</span>\r\n                            <span className=\"shrink-0\">\r\n                                {post.timestamp || post.created_at\r\n                                    ? new Date(post.timestamp || post.created_at).toLocaleDateString() \r\n                                    : 'Just now'\r\n                                }\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \r\n                {/* More menu */}\r\n                <div className=\"relative\" ref={moreMenuRef}>\r\n                    <button \r\n                        className=\"text-gray-400 hover:text-gray-600 dark:hover:text-white transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800\"\r\n                        onClick={() => setShowMoreMenu(!showMoreMenu)}\r\n                    >\r\n                        <MoreHorizontal size={20}/>\r\n                    </button>\r\n\r\n                    <AnimatePresence>\r\n                        {showMoreMenu && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0, scale: 0.95, y: -5 }}\r\n                                animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                                exit={{ opacity: 0, scale: 0.95, y: -5 }}\r\n                                className=\"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden z-50\"\r\n                            >\r\n                                <button \r\n                                    onClick={() => { copyLink(`${window.location.origin}/post/${post.id}`); setShowMoreMenu(false); }}\r\n                                    className=\"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition\"\r\n                                >\r\n                                    <Link2 size={16} className=\"text-gray-400\" />\r\n                                    <span className=\"dark:text-gray-200\">Copy link</span>\r\n                                </button>\r\n                                \r\n                                {!isOwnPost && (\r\n                                    <>\r\n                                        {onToggleFollow && (\r\n                                            <button \r\n                                                onClick={() => { onToggleFollow(); setShowMoreMenu(false); }}\r\n                                                className=\"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition\"\r\n                                            >\r\n                                                <UserPlus size={16} className=\"text-gray-400\" />\r\n                                                <span className=\"dark:text-gray-200\">\r\n                                                    {isFollowingAuthor ? 'Unfollow' : 'Follow'} {post.displayName?.split(' ')[0]}\r\n                                                </span>\r\n                                            </button>\r\n                                        )}\r\n                                        <button \r\n                                            onClick={() => { onReport(); setShowMoreMenu(false); }}\r\n                                            className=\"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500\"\r\n                                        >\r\n                                            <Flag size={16} />\r\n                                            <span>Report post</span>\r\n                                        </button>\r\n                                    </>\r\n                                )}\r\n\r\n                                {isOwnPost && (\r\n                                    <button \r\n                                        onClick={() => { handleDeletePost(); setShowMoreMenu(false); }}\r\n                                        className=\"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                        <span>Delete post</span>\r\n                                    </button>\r\n                                )}\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content Body */}\r\n            <div className=\"px-4 pb-2\">\r\n                {post.text && (\r\n                    <p className=\"text-gray-800 dark:text-gray-200 whitespace-pre-wrap text-sm leading-relaxed mb-3\">\r\n                        {renderText(post.text)}\r\n                    </p>\r\n                )}\r\n\r\n                {/* Attachments */}\r\n                {post.attachments && post.attachments.length > 0 && (\r\n                    <div className={`grid gap-2 mb-3 ${post.attachments.length > 1 ? 'grid-cols-2' : 'grid-cols-1'}`}>\r\n                        {post.attachments.map((att, i) => (\r\n                            <div key={i} className=\"rounded-lg overflow-hidden bg-transparent relative\">\r\n                                {att.type === 'image' && <img src={att.url} className=\"w-full h-full object-cover max-h-96\" alt=\"content\"/>}\r\n                                {att.type === 'video' && (\r\n                                    <video \r\n                                        src={att.url} \r\n                                        controls \r\n                                        className=\"w-full h-full max-h-96 bg-black\"\r\n                                        autoPlay={autoPlayVideos}\r\n                                        playsInline\r\n                                        muted={autoPlayVideos}\r\n                                        preload=\"metadata\"\r\n                                    />\r\n                                )} \r\n                                {att.type === 'audio' && (\r\n                                    <div className=\"w-full\">\r\n                                        <StarFieldVisualizer audioUrl={att.url} fileName={att.name || 'Audio Track'} />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n                \r\n                {/* Fallbacks for legacy posts */}\r\n                {post.audioUrl && !post.attachments && (\r\n                    <div className=\"rounded-lg overflow-hidden bg-transparent mb-3\">\r\n                        <StarFieldVisualizer audioUrl={post.audioUrl} fileName={post.audioName || 'Track'} />\r\n                    </div>\r\n                )}\r\n                {post.imageUrl && !post.attachments && <img src={post.imageUrl} className=\"rounded-lg w-full mb-3 border dark:border-gray-700\" alt=\"legacy content\"/>}\r\n            </div>\r\n\r\n            {/* Engagement Stats */}\r\n            {(totalReactions > 0 || post.saveCount > 0) && (\r\n                <div className=\"px-4 py-2 flex items-center justify-between\">\r\n                    <div className=\"flex gap-1\">\r\n                        {Object.entries(reactionCounts).map(([emoji, count]) => (\r\n                            <motion.div \r\n                                key={emoji}\r\n                                initial={{ scale: 0 }} animate={{ scale: 1 }}\r\n                                className={`text-xs px-2 py-1 rounded-full border flex items-center gap-1 ${myReaction === emoji ? 'bg-blue-50 border-blue-200 dark:bg-blue-900/30 dark:border-blue-800' : 'bg-gray-50 border-gray-100 dark:bg-gray-800 dark:border-gray-700'} dark:text-gray-300`}\r\n                            >\r\n                                <span>{emoji}</span>\r\n                                <span className=\"font-bold\">{count}</span>\r\n                            </motion.div>\r\n                        ))}\r\n                    </div>\r\n                    {post.saveCount > 0 && (\r\n                        <span className=\"text-xs text-gray-400\">\r\n                            {post.saveCount} save{post.saveCount !== 1 ? 's' : ''}\r\n                        </span>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"px-4 py-3 border-t dark:border-gray-700 flex items-center justify-between relative\">\r\n                <div className=\"flex gap-2 sm:gap-4\">\r\n                    {/* Reaction Button */}\r\n                    <div className=\"relative\">\r\n                        <motion.button \r\n                            whileTap={{ scale: 0.9 }}\r\n                            onClick={() => setShowReactionMenu(!showReactionMenu)}\r\n                            className={`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg ${myReaction ? 'text-blue-600 bg-blue-50 dark:bg-blue-900/20' : 'text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800'}`}\r\n                        >\r\n                            {myReaction ? <span className=\"text-lg\">{myReaction}</span> : <Smile size={18} />}\r\n                            <span className=\"hidden sm:inline\">{myReaction ? 'Reacted' : 'React'}</span>\r\n                        </motion.button>\r\n\r\n                        <AnimatePresence>\r\n                            {showReactionMenu && (\r\n                                <motion.div \r\n                                    ref={menuRef}\r\n                                    initial={{ opacity: 0, scale: 0.8, y: 10 }}\r\n                                    animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                                    exit={{ opacity: 0, scale: 0.8, y: 10 }}\r\n                                    className=\"absolute bottom-full left-0 mb-2 bg-white dark:bg-gray-800 shadow-xl rounded-full p-2 flex gap-1 sm:gap-2 z-50 border dark:border-gray-600 origin-bottom-left\"\r\n                                >\r\n                                    {REACTION_SET.map(emoji => (\r\n                                        <motion.button \r\n                                            key={emoji} \r\n                                            whileHover={{ scale: 1.2 }}\r\n                                            whileTap={{ scale: 0.9 }}\r\n                                            onClick={(e) => { e.stopPropagation(); handleReaction(emoji); }} \r\n                                            className={`text-xl p-1 sm:p-1.5 rounded-full ${myReaction === emoji ? 'bg-blue-100 dark:bg-blue-900' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}\r\n                                        >\r\n                                            {emoji}\r\n                                        </motion.button>\r\n                                    ))}\r\n                                </motion.div>\r\n                            )}\r\n                        </AnimatePresence>\r\n                    </div>\r\n\r\n                    {/* Comment Button */}\r\n                    <motion.button \r\n                        whileTap={{ scale: 0.95 }} \r\n                        onClick={() => setShowComments(!showComments)} \r\n                        className=\"flex items-center gap-1.5 sm:gap-2 text-sm font-medium text-gray-500 hover:text-brand-blue transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\"\r\n                    >\r\n                        <MessageCircle size={18} />\r\n                        <span className=\"hidden sm:inline\">{commentCount > 0 ? commentCount : 'Comment'}</span>\r\n                        {commentCount > 0 && <span className=\"sm:hidden\">{commentCount}</span>}\r\n                    </motion.button>\r\n                    \r\n                    {/* Share Button */}\r\n                    <motion.button \r\n                        whileTap={{ scale: 0.95 }} \r\n                        onClick={handleShare}\r\n                        className={`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 ${linkCopied ? 'text-green-500' : 'text-gray-500 hover:text-green-500'}`}\r\n                    >\r\n                        {linkCopied ? <Check size={18} /> : <Share2 size={18} />}\r\n                        <span className=\"hidden sm:inline\">{linkCopied ? 'Copied!' : 'Share'}</span>\r\n                    </motion.button>\r\n                </div>\r\n                \r\n                {/* Save Button */}\r\n                <motion.button \r\n                    whileTap={{ scale: 0.8 }} \r\n                    onClick={handleSavePost}\r\n                    disabled={savingPost}\r\n                    className={`${isSaved ? 'text-brand-blue' : 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'} transition p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full disabled:opacity-50`}\r\n                    title={isSaved ? 'Remove from saved' : 'Save post'}\r\n                >\r\n                    <Bookmark size={18} fill={isSaved ? \"currentColor\" : \"none\"}/>\r\n                </motion.button>\r\n            </div>\r\n\r\n            {/* Comments Section */}\r\n            <AnimatePresence>\r\n                {showComments && (\r\n                    <motion.div\r\n                        initial={{ height: 0, opacity: 0 }}\r\n                        animate={{ height: 'auto', opacity: 1 }}\r\n                        exit={{ height: 0, opacity: 0 }}\r\n                        className=\"overflow-hidden\"\r\n                    >\r\n                        <CommentSection \r\n                            post={post} \r\n                            currentUser={currentUser}\r\n                            currentUserData={currentUserData}\r\n                            blockedUsers={[]}\r\n                            onCountChange={setCommentCount}\r\n                        />\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </motion.div>\r\n    );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Send, Image as ImageIcon, Music, Video, X, Sliders, Paperclip, Loader2 } from 'lucide-react';\r\nimport { useMediaUpload } from '../../hooks/useMediaUpload';\r\nimport { POPULAR_PLUGINS_LIST } from '../../config/constants';\r\nimport { MultiSelect } from '../shared/Inputs';\r\n\r\nexport default function CreatePostWidget({ user, userData, onPost }) {\r\n    const [text, setText] = useState('');\r\n    const [media, setMedia] = useState([]); // Array of {file, type, previewUrl}\r\n    const [seshFxOpen, setSeshFxOpen] = useState(false);\r\n    const [pluginsUsed, setPluginsUsed] = useState([]);\r\n    const [presetFile, setPresetFile] = useState(null);\r\n    const [isPosting, setIsPosting] = useState(false);\r\n\r\n    const { uploadMedia } = useMediaUpload();\r\n\r\n    const handleFileSelect = (e, type) => {\r\n        if (e.target.files && e.target.files[0]) {\r\n            const file = e.target.files[0];\r\n            // Create preview URL\r\n            const previewUrl = URL.createObjectURL(file);\r\n            setMedia([...media, { file, type, previewUrl }]);\r\n        }\r\n    };\r\n\r\n    const removeMedia = (index) => {\r\n        setMedia(media.filter((_, i) => i !== index));\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        if (!text.trim() && media.length === 0) return;\r\n        setIsPosting(true);\r\n\r\n        try {\r\n            // Upload all media assets first\r\n            const uploadedMedia = await Promise.all(media.map(async (m) => {\r\n                const pathKey = m.type === 'video' ? 'postVideos' : (m.type === 'audio' ? 'postAudio' : 'postImages');\r\n                const path = `artifacts/${user.uid}/${pathKey}`;\r\n                \r\n                const result = await uploadMedia(m.file, path);\r\n                \r\n                // CRITICAL FIX: Ensure we enforce the type selected by the user (m.type)\r\n                // identifying mime-types automatically can sometimes fail or default to 'file'/'image'\r\n                if (result) {\r\n                    return { \r\n                        ...result, \r\n                        type: m.type // Override with explicit type (audio, video, image)\r\n                    };\r\n                }\r\n                return null;\r\n            }));\r\n\r\n            let presetUrl = null;\r\n            if (presetFile) {\r\n                 const res = await uploadMedia(presetFile, `artifacts/${user.uid}/postPresets`);\r\n                 presetUrl = res?.url;\r\n            }\r\n\r\n            const postPayload = {\r\n                text,\r\n                attachments: uploadedMedia.filter(m => m !== null), // Clean failed uploads\r\n                seshFx: (seshFxOpen && (pluginsUsed.length > 0 || presetUrl)) ? {\r\n                    plugins: pluginsUsed,\r\n                    presetUrl,\r\n                    presetName: presetFile ? presetFile.name : null\r\n                } : null\r\n            };\r\n\r\n            await onPost(postPayload);\r\n            \r\n            // Reset Form\r\n            setText('');\r\n            setMedia([]);\r\n            setSeshFxOpen(false);\r\n            setPluginsUsed([]);\r\n            setPresetFile(null);\r\n        } catch (error) {\r\n            console.error(\"Error creating post:\", error);\r\n            alert(\"Failed to create post. Please try again.\");\r\n        } finally {\r\n            setIsPosting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-gray-700 shadow-sm mb-6\">\r\n            <div className=\"flex gap-3\">\r\n                <div className=\"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden shrink-0\">\r\n                    {userData?.photoURL ? <img src={userData.photoURL} className=\"h-full w-full object-cover\"/> : <div className=\"h-full w-full bg-brand-blue\"></div>}\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                    <textarea \r\n                        className=\"w-full bg-transparent outline-none text-gray-900 dark:text-white placeholder-gray-500 min-h-[80px] resize-none\"\r\n                        placeholder=\"What's creating sound today? (#tags @mentions)\"\r\n                        value={text}\r\n                        onChange={e => setText(e.target.value)}\r\n                    />\r\n                    \r\n                    {/* Media Previews Grid */}\r\n                    {media.length > 0 && (\r\n                        <div className=\"grid grid-cols-2 gap-2 mb-3\">\r\n                            {media.map((m, i) => (\r\n                                <div key={i} className=\"relative rounded-lg overflow-hidden bg-black/5 border dark:border-gray-600 aspect-video group flex items-center justify-center\">\r\n                                    {m.type === 'image' && <img src={m.previewUrl} className=\"h-full w-full object-cover\"/>}\r\n                                    {m.type === 'video' && <video src={m.previewUrl} className=\"h-full w-full object-cover\"/>}\r\n                                    {m.type === 'audio' && (\r\n                                        <div className=\"flex flex-col items-center justify-center text-brand-blue bg-gray-100 dark:bg-gray-800 w-full h-full\">\r\n                                            <Music size={32}/>\r\n                                            <span className=\"text-xs text-gray-500 mt-2 truncate max-w-[90%] px-2\">{m.file.name}</span>\r\n                                        </div>\r\n                                    )}\r\n                                    <button onClick={() => removeMedia(i)} className=\"absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-red-500\"><X size={12}/></button>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* SeshFx Drawer */}\r\n                    {seshFxOpen && (\r\n                        <div className=\"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-3 border border-blue-100 dark:border-blue-800/50 animate-in slide-in-from-top-2\">\r\n                            <div className=\"flex justify-between items-center mb-2\">\r\n                                <span className=\"text-xs font-bold text-brand-blue uppercase\">SeshFx Data</span>\r\n                                <button onClick={()=>setSeshFxOpen(false)}><X size={14} className=\"text-gray-400 hover:text-brand-blue\"/></button>\r\n                            </div>\r\n                            <MultiSelect label=\"\" options={POPULAR_PLUGINS_LIST} initialValues={pluginsUsed} onChange={(_, val) => setPluginsUsed(val)} />\r\n                            <div className=\"mt-2 flex items-center gap-2\">\r\n                                <Paperclip size={14} className=\"text-gray-400\"/>\r\n                                <input type=\"file\" className=\"text-xs text-gray-500 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:bg-white dark:file:bg-gray-700 dark:file:text-white\" onChange={e => setPresetFile(e.target.files[0])} />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"flex justify-between items-center pt-2 border-t dark:border-gray-700\">\r\n                        <div className=\"flex gap-1\">\r\n                            <label className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-brand-blue cursor-pointer transition\" title=\"Add Image\">\r\n                                <ImageIcon size={20}/>\r\n                                <input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={e => handleFileSelect(e, 'image')}/>\r\n                            </label>\r\n                            <label className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-green-500 cursor-pointer transition\" title=\"Add Video\">\r\n                                <Video size={20}/>\r\n                                <input type=\"file\" className=\"hidden\" accept=\"video/*\" onChange={e => handleFileSelect(e, 'video')}/>\r\n                            </label>\r\n                            <label className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-purple-500 cursor-pointer transition\" title=\"Add Audio Track\">\r\n                                <Music size={20}/>\r\n                                <input type=\"file\" className=\"hidden\" accept=\"audio/*\" onChange={e => handleFileSelect(e, 'audio')}/>\r\n                            </label>\r\n                            <button onClick={()=>setSeshFxOpen(!seshFxOpen)} className={`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition ${seshFxOpen ? 'bg-blue-50 dark:bg-blue-900/20 text-brand-blue' : 'text-gray-400'}`} title=\"Add Plugin Data\">\r\n                                <Sliders size={20}/>\r\n                            </button>\r\n                        </div>\r\n                        <button \r\n                            onClick={handleSubmit} \r\n                            disabled={isPosting || (!text && media.length === 0)}\r\n                            className=\"bg-brand-blue text-white px-5 py-1.5 rounded-full font-bold text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition\"\r\n                        >\r\n                            {isPosting ? <Loader2 className=\"animate-spin\" size={16}/> : <>Post <Send size={14}/></>}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","// src/components/social/discover/DiscoverSection.jsx\r\n\r\nimport React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Loader2 } from 'lucide-react';\r\n\r\nexport default function DiscoverSection({ \r\n    title, \r\n    description, \r\n    items, \r\n    loading, \r\n    emptyMessage,\r\n    onSeeMore,\r\n    renderItem,\r\n    gridCols = \"grid-cols-1 md:grid-cols-2 lg:grid-cols-3\"\r\n}) {\r\n    if (loading) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                <div>\r\n                    <h3 className=\"text-xl font-bold dark:text-white mb-1\">{title}</h3>\r\n                    {description && (\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">{description}</p>\r\n                    )}\r\n                </div>\r\n                <div className=\"flex justify-center py-12\">\r\n                    <Loader2 className=\"animate-spin text-indigo-600\" size={32} />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!items || items.length === 0) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                <div>\r\n                    <h3 className=\"text-xl font-bold dark:text-white mb-1\">{title}</h3>\r\n                    {description && (\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">{description}</p>\r\n                    )}\r\n                </div>\r\n                <div className=\"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n                    <p className=\"text-gray-500 dark:text-gray-400\">\r\n                        {emptyMessage || 'No items found.'}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h3 className=\"text-xl font-bold dark:text-white mb-1\">{title}</h3>\r\n                    {description && (\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">{description}</p>\r\n                    )}\r\n                </div>\r\n                {onSeeMore && (\r\n                    <button\r\n                        onClick={onSeeMore}\r\n                        className=\"text-sm text-indigo-600 dark:text-indigo-400 font-semibold hover:underline\"\r\n                    >\r\n                        See More â†’\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            <div className={`grid ${gridCols} gap-4`}>\r\n                {items.map((item, idx) => (\r\n                    <motion.div\r\n                        key={item.id || idx}\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: idx * 0.05 }}\r\n                    >\r\n                        {renderItem ? renderItem(item, idx) : (\r\n                            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n                                {JSON.stringify(item)}\r\n                            </div>\r\n                        )}\r\n                    </motion.div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/DiscoverCard.jsx\r\n\r\nimport React from 'react';\r\nimport { User, Play, MapPin, Award, School, Music, Building2 } from 'lucide-react';\r\nimport UserAvatar from '../../shared/UserAvatar';\r\nimport FollowButton from '../FollowButton';\r\n\r\nexport default function DiscoverCard({ \r\n    item, \r\n    type, \r\n    onFollow, \r\n    onViewProfile, \r\n    onPlay,\r\n    isFollowing,\r\n    currentUser \r\n}) {\r\n    const getIcon = () => {\r\n        switch (type) {\r\n            case 'artist':\r\n            case 'producer':\r\n                return <User size={20} />;\r\n            case 'studio':\r\n                return <Building2 size={20} />;\r\n            case 'school':\r\n                return <School size={20} />;\r\n            case 'sound':\r\n                return <Music size={20} />;\r\n            default:\r\n                return null;\r\n        }\r\n    };\r\n\r\n    const getTitle = () => {\r\n        if (type === 'sound') {\r\n            return item.text || 'Audio Post';\r\n        }\r\n        return item.displayName || item.name || item.title || 'Unknown';\r\n    };\r\n\r\n    const getSubtitle = () => {\r\n        if (type === 'sound') {\r\n            return item.displayName || 'Unknown Artist';\r\n        }\r\n        if (type === 'artist' || type === 'producer') {\r\n            return item.role || item.activeProfileRole || 'User';\r\n        }\r\n        if (type === 'studio') {\r\n            return item.address || item.city || 'Location not specified';\r\n        }\r\n        if (type === 'school') {\r\n            return item.address || 'Location not specified';\r\n        }\r\n        return null;\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-all\">\r\n            <div className=\"flex items-start gap-3\">\r\n                {/* Avatar/Image */}\r\n                <div className=\"shrink-0\">\r\n                    {type === 'sound' ? (\r\n                        <div className=\"w-12 h-12 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center\">\r\n                            <Music size={24} className=\"text-indigo-600 dark:text-indigo-400\" />\r\n                        </div>\r\n                    ) : (\r\n                        <UserAvatar\r\n                            src={item.photoURL || item.logoURL}\r\n                            name={getTitle()}\r\n                            size=\"md\"\r\n                        />\r\n                    )}\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-start justify-between gap-2\">\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <h3 \r\n                                className=\"font-bold dark:text-white truncate cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition\"\r\n                                onClick={onViewProfile}\r\n                            >\r\n                                {getTitle()}\r\n                            </h3>\r\n                            {getSubtitle() && (\r\n                                <p className=\"text-sm text-gray-600 dark:text-gray-400 truncate mt-0.5\">\r\n                                    {getSubtitle()}\r\n                                </p>\r\n                            )}\r\n                            \r\n                            {/* Additional info */}\r\n                            {type === 'studio' && item.amenities && (\r\n                                <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\r\n                                    {item.amenities.slice(0, 2).join(', ')}\r\n                                </p>\r\n                            )}\r\n                            \r\n                            {type === 'school' && item.programs && (\r\n                                <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\r\n                                    {item.programs.length} program{item.programs.length !== 1 ? 's' : ''}\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Actions */}\r\n                        <div className=\"flex items-center gap-2 shrink-0\">\r\n                            {type === 'sound' && onPlay && (\r\n                                <button\r\n                                    onClick={onPlay}\r\n                                    className=\"p-2 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition\"\r\n                                    title=\"Play\"\r\n                                >\r\n                                    <Play size={16} fill=\"currentColor\" />\r\n                                </button>\r\n                            )}\r\n                            \r\n                            {(type === 'artist' || type === 'producer') && onFollow && (\r\n                                <FollowButton\r\n                                    isFollowing={isFollowing}\r\n                                    onToggle={onFollow}\r\n                                    size=\"sm\"\r\n                                />\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Stats */}\r\n                    {(item.followerCount || item.enrollmentCount) && (\r\n                        <div className=\"flex items-center gap-3 mt-2 text-xs text-gray-500 dark:text-gray-400\">\r\n                            {item.followerCount !== undefined && (\r\n                                <span>{item.followerCount} followers</span>\r\n                            )}\r\n                            {item.enrollmentCount !== undefined && (\r\n                                <span>{item.enrollmentCount} enrolled</span>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/utils/recommendations.js\r\n\r\n/**\r\n * Calculate similarity between two users based on:\r\n * - Followed users overlap\r\n * - Liked posts overlap\r\n * - Genre preferences\r\n * - Location proximity\r\n */\r\nexport function calculateUserSimilarity(user1, user2) {\r\n    if (!user1 || !user2) return 0;\r\n\r\n    let similarity = 0;\r\n    let factors = 0;\r\n\r\n    // Genre overlap (if available)\r\n    if (user1.genres && user2.genres) {\r\n        const genres1 = Array.isArray(user1.genres) ? user1.genres : [];\r\n        const genres2 = Array.isArray(user2.genres) ? user2.genres : [];\r\n        const commonGenres = genres1.filter(g => genres2.includes(g));\r\n        if (genres1.length > 0 || genres2.length > 0) {\r\n            similarity += (commonGenres.length / Math.max(genres1.length, genres2.length)) * 0.3;\r\n            factors += 0.3;\r\n        }\r\n    }\r\n\r\n    // Location proximity (simple string matching for now)\r\n    if (user1.zip && user2.zip) {\r\n        if (user1.zip === user2.zip) {\r\n            similarity += 0.2;\r\n        } else if (user1.zip.substring(0, 3) === user2.zip.substring(0, 3)) {\r\n            similarity += 0.1;\r\n        }\r\n        factors += 0.2;\r\n    }\r\n\r\n    // Role similarity\r\n    if (user1.activeProfileRole && user2.activeProfileRole) {\r\n        if (user1.activeProfileRole === user2.activeProfileRole) {\r\n            similarity += 0.2;\r\n        }\r\n        factors += 0.2;\r\n    }\r\n\r\n    // Account type overlap\r\n    if (user1.accountTypes && user2.accountTypes) {\r\n        const types1 = Array.isArray(user1.accountTypes) ? user1.accountTypes : [];\r\n        const types2 = Array.isArray(user2.accountTypes) ? user2.accountTypes : [];\r\n        const commonTypes = types1.filter(t => types2.includes(t));\r\n        if (types1.length > 0 || types2.length > 0) {\r\n            similarity += (commonTypes.length / Math.max(types1.length, types2.length)) * 0.3;\r\n            factors += 0.3;\r\n        }\r\n    }\r\n\r\n    // Normalize by factors used\r\n    return factors > 0 ? similarity / factors : 0;\r\n}\r\n\r\n/**\r\n * Calculate engagement score for content\r\n * Formula: (likes * 1) + (comments * 2) + (shares * 3) + (saves * 1.5)\r\n */\r\nexport function calculateEngagementScore(content) {\r\n    const likes = content.reactionCount || 0;\r\n    const comments = content.commentCount || 0;\r\n    const saves = content.saveCount || 0;\r\n    // Shares not tracked yet, but structure is ready\r\n    const shares = 0;\r\n\r\n    return (likes * 1) + (comments * 2) + (shares * 3) + (saves * 1.5);\r\n}\r\n\r\n/**\r\n * Calculate trending score with time decay\r\n * Recent activity is weighted more heavily\r\n */\r\nexport function calculateTrendingScore(content, timeRange = '7d') {\r\n    const engagementScore = calculateEngagementScore(content);\r\n    \r\n    if (!content.timestamp) return engagementScore;\r\n\r\n    const now = Date.now();\r\n    const contentTime = content.timestamp?.toMillis?.() || content.timestamp || now;\r\n    const ageInHours = (now - contentTime) / (1000 * 60 * 60);\r\n\r\n    // Time decay factor (exponential decay)\r\n    let decayFactor = 1;\r\n    if (timeRange === '24h') {\r\n        decayFactor = Math.exp(-ageInHours / 24);\r\n    } else if (timeRange === '7d') {\r\n        decayFactor = Math.exp(-ageInHours / 168); // 7 days = 168 hours\r\n    } else if (timeRange === '30d') {\r\n        decayFactor = Math.exp(-ageInHours / 720); // 30 days = 720 hours\r\n    }\r\n\r\n    return engagementScore * decayFactor;\r\n}\r\n\r\n/**\r\n * Get trending content by type\r\n * @param {string} type - Content type ('sounds', 'artists', 'producers', 'studios', 'schools')\r\n * @param {string} timeRange - Time range ('24h', '7d', '30d')\r\n * @param {Array} contentList - List of content items\r\n * @param {number} limit - Maximum number of items to return\r\n */\r\nexport function getTrendingContent(type, timeRange, contentList, limit = 10) {\r\n    if (!contentList || contentList.length === 0) return [];\r\n\r\n    // Calculate trending scores\r\n    const scored = contentList.map(item => ({\r\n        ...item,\r\n        trendingScore: calculateTrendingScore(item, timeRange)\r\n    }));\r\n\r\n    // Sort by trending score (descending)\r\n    scored.sort((a, b) => b.trendingScore - a.trendingScore);\r\n\r\n    return scored.slice(0, limit);\r\n}\r\n\r\n/**\r\n * Get personalized recommendations for a user\r\n * @param {string} userId - User ID\r\n * @param {string} type - Content type\r\n * @param {Array} allContent - All available content\r\n * @param {Object} userData - Current user's data\r\n * @param {Array} similarUsers - List of similar users\r\n * @param {number} limit - Maximum number of recommendations\r\n */\r\nexport function getPersonalizedRecommendations(userId, type, allContent, userData, similarUsers = [], limit = 10) {\r\n    if (!allContent || allContent.length === 0) return [];\r\n\r\n    // Filter out content user already follows/likes\r\n    const filtered = allContent.filter(item => {\r\n        // Skip if user is the creator\r\n        if (item.userId === userId) return false;\r\n        \r\n        // Skip if already following (would need following list)\r\n        // This is a simplified version\r\n        \r\n        return true;\r\n    });\r\n\r\n    // If we have similar users, prioritize content from them\r\n    if (similarUsers.length > 0) {\r\n        const similarUserIds = similarUsers.map(u => u.id || u.userId);\r\n        const fromSimilar = filtered.filter(item => \r\n            similarUserIds.includes(item.userId || item.id)\r\n        );\r\n        const others = filtered.filter(item => \r\n            !similarUserIds.includes(item.userId || item.id)\r\n        );\r\n        \r\n        // Combine: similar users first, then others\r\n        return [...fromSimilar, ...others].slice(0, limit);\r\n    }\r\n\r\n    // Otherwise, return by engagement score\r\n    const scored = filtered.map(item => ({\r\n        ...item,\r\n        engagementScore: calculateEngagementScore(item)\r\n    }));\r\n\r\n    scored.sort((a, b) => b.engagementScore - a.engagementScore);\r\n\r\n    return scored.slice(0, limit);\r\n}\r\n\r\n/**\r\n * Get recently created content\r\n * @param {Array} contentList - List of content items\r\n * @param {number} limit - Maximum number of items\r\n */\r\nexport function getRecentContent(contentList, limit = 10) {\r\n    if (!contentList || contentList.length === 0) return [];\r\n\r\n    // Sort by timestamp (most recent first)\r\n    const sorted = [...contentList].sort((a, b) => {\r\n        const timeA = a.timestamp?.toMillis?.() || a.timestamp || a.createdAt?.toMillis?.() || a.createdAt || 0;\r\n        const timeB = b.timestamp?.toMillis?.() || b.timestamp || b.createdAt?.toMillis?.() || b.createdAt || 0;\r\n        return timeB - timeA;\r\n    });\r\n\r\n    return sorted.slice(0, limit);\r\n}\r\n\r\n","// src/hooks/useDiscover.js\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { supabase } from '../config/supabase';\r\nimport { \r\n    getTrendingContent, \r\n    getPersonalizedRecommendations, \r\n    getRecentContent,\r\n    calculateUserSimilarity \r\n} from '../utils/recommendations';\r\n\r\nexport function useDiscover(user, userData) {\r\n    const [loading, setLoading] = useState(true);\r\n    const [sounds, setSounds] = useState([]);\r\n    const [artists, setArtists] = useState([]);\r\n    const [producers, setProducers] = useState([]);\r\n    const [studios, setStudios] = useState([]);\r\n    const [schools, setSchools] = useState([]);\r\n    const [following, setFollowing] = useState([]);\r\n\r\n    // Load following list for recommendations\r\n    useEffect(() => {\r\n        if (!user?.id && !user?.uid || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n\r\n        const loadFollowing = async () => {\r\n            try {\r\n                const { data, error } = await supabase\r\n                    .from('follows')\r\n                    .select('following_id')\r\n                    .eq('follower_id', userId);\r\n                \r\n                if (error) throw error;\r\n                setFollowing((data || []).map(f => f.following_id));\r\n            } catch (error) {\r\n                console.error('Error loading following:', error);\r\n            }\r\n        };\r\n\r\n        loadFollowing();\r\n    }, [user?.id, user?.uid]);\r\n\r\n    // Load all discover data\r\n    useEffect(() => {\r\n        if (!user?.id && !user?.uid || !supabase) {\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const loadDiscoverData = async () => {\r\n            setLoading(true);\r\n            try {\r\n                // Load sounds (posts with audio) - using documents table for now\r\n                const { data: postsData, error: postsError } = await supabase\r\n                    .from('documents')\r\n                    .select('*')\r\n                    .eq('collection_path', `artifacts/${import.meta.env.VITE_APP_ID || 'seshnx-70c04'}/public/data/posts`)\r\n                    .order('created_at', { ascending: false })\r\n                    .limit(50);\r\n                \r\n                if (!postsError && postsData) {\r\n                    const postsList = postsData\r\n                        .map(doc => ({\r\n                            id: doc.id,\r\n                            ...doc.data\r\n                        }))\r\n                        .filter(post => post.audioUrl || post.media?.some(m => m.type === 'audio'));\r\n                    setSounds(postsList);\r\n                }\r\n\r\n                // Load artists (users with Talent role)\r\n                const artistsList = await loadUsersByRole(['Talent']);\r\n                setArtists(artistsList);\r\n\r\n                // Load producers (users with Producer or Engineer role)\r\n                const producersList = await loadUsersByRole(['Producer', 'Engineer']);\r\n                setProducers(producersList);\r\n\r\n                // Load studios (users with Studio role or isStudio flag)\r\n                const studiosList = await loadStudios();\r\n                setStudios(studiosList);\r\n\r\n                // Load schools - using documents table for now\r\n                const { data: schoolsData, error: schoolsError } = await supabase\r\n                    .from('documents')\r\n                    .select('*')\r\n                    .eq('collection_path', 'schools')\r\n                    .limit(20);\r\n                \r\n                if (!schoolsError && schoolsData) {\r\n                    const schoolsList = schoolsData.map(doc => ({\r\n                        id: doc.id,\r\n                        ...doc.data\r\n                    }));\r\n                    setSchools(schoolsList);\r\n                }\r\n\r\n            } catch (error) {\r\n                console.error('Error loading discover data:', error);\r\n            }\r\n            setLoading(false);\r\n        };\r\n\r\n        loadDiscoverData();\r\n    }, [user?.id, user?.uid]);\r\n\r\n    // Helper to load users by role\r\n    const loadUsersByRole = async (roles) => {\r\n        if (!supabase) return [];\r\n        try {\r\n            // Query public_profiles table\r\n            const { data, error } = await supabase\r\n                .from('public_profiles')\r\n                .select('*')\r\n                .limit(100);\r\n            \r\n            if (error) throw error;\r\n            \r\n            return (data || [])\r\n                .filter(profile => {\r\n                    const userRoles = profile.account_types || [];\r\n                    return roles.some(role => userRoles.includes(role));\r\n                })\r\n                .map(profile => ({\r\n                    id: profile.id,\r\n                    userId: profile.id,\r\n                    ...profile\r\n                }));\r\n        } catch (error) {\r\n            console.error('Error loading users by role:', error);\r\n            return [];\r\n        }\r\n    };\r\n\r\n    // Helper to load studios\r\n    const loadStudios = async () => {\r\n        if (!supabase) return [];\r\n        try {\r\n            // Load from documents table (legacy) and public_profiles\r\n            const { data: studiosData } = await supabase\r\n                .from('documents')\r\n                .select('*')\r\n                .eq('collection_path', 'studios')\r\n                .limit(50);\r\n            \r\n            const studiosList = (studiosData || []).map(doc => ({\r\n                id: doc.id,\r\n                ...doc.data,\r\n                isStudio: true\r\n            }));\r\n\r\n            // Also check user profiles with Studio role\r\n            const studioUsers = await loadUsersByRole(['Studio']);\r\n            \r\n            return [...studiosList, ...studioUsers];\r\n        } catch (error) {\r\n            console.error('Error loading studios:', error);\r\n            return [];\r\n        }\r\n    };\r\n\r\n    // Memoized recommendations\r\n    const recommendations = useMemo(() => {\r\n        if (!userData || loading) return {};\r\n\r\n        return {\r\n            sounds: {\r\n                trending: getTrendingContent('sounds', '7d', sounds, 10),\r\n                recent: getRecentContent(sounds, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'sounds',\r\n                    sounds,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            },\r\n            artists: {\r\n                trending: getTrendingContent('artists', '7d', artists, 10),\r\n                recent: getRecentContent(artists, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'artists',\r\n                    artists,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            },\r\n            producers: {\r\n                trending: getTrendingContent('producers', '7d', producers, 10),\r\n                recent: getRecentContent(producers, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'producers',\r\n                    producers,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            },\r\n            studios: {\r\n                trending: getTrendingContent('studios', '7d', studios, 10),\r\n                recent: getRecentContent(studios, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'studios',\r\n                    studios,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            },\r\n            schools: {\r\n                trending: getTrendingContent('schools', '7d', schools, 10),\r\n                recent: getRecentContent(schools, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'schools',\r\n                    schools,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            }\r\n        };\r\n    }, [sounds, artists, producers, studios, schools, userData, user?.uid, loading]);\r\n\r\n    return {\r\n        loading,\r\n        sounds,\r\n        artists,\r\n        producers,\r\n        studios,\r\n        schools,\r\n        following,\r\n        recommendations\r\n    };\r\n}\r\n\r\n","// src/components/social/discover/SoundsDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\n\r\nexport default function SoundsDiscover({ user, userData, openPublicProfile, onFollow }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n\r\n    const sounds = recommendations?.sounds || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Trending Sounds\"\r\n                description=\"Most popular audio content right now\"\r\n                items={sounds.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No trending sounds found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"sound\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId)}\r\n                        onPlay={() => {\r\n                            // Handle play - would integrate with audio player\r\n                            console.log('Play sound:', item.id);\r\n                        }}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Releases\"\r\n                description=\"Recently posted audio content\"\r\n                items={sounds.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new sounds found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"sound\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId)}\r\n                        onPlay={() => {\r\n                            console.log('Play sound:', item.id);\r\n                        }}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {sounds.personalized && sounds.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on your activity\"\r\n                    items={sounds.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"sound\"\r\n                            onViewProfile={() => openPublicProfile?.(item.userId)}\r\n                            onPlay={() => {\r\n                                console.log('Play sound:', item.id);\r\n                            }}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/ArtistsDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\nimport { useFollowSystem } from '../../../hooks/useFollowSystem';\r\n\r\nexport default function ArtistsDiscover({ user, userData, openPublicProfile }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n    const { isFollowing, toggleFollow } = useFollowSystem(user?.uid, userData);\r\n\r\n    const artists = recommendations?.artists || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Trending Artists\"\r\n                description=\"Most popular artists right now\"\r\n                items={artists.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No trending artists found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"artist\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                        isFollowing={isFollowing(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Artists\"\r\n                description=\"Recently joined artists\"\r\n                items={artists.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new artists found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"artist\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                        isFollowing={isFollowing(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {artists.personalized && artists.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on artists you follow\"\r\n                    items={artists.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"artist\"\r\n                            onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                            onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                            isFollowing={isFollowing(item.userId || item.id)}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/ProducersDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\nimport { useFollowSystem } from '../../../hooks/useFollowSystem';\r\n\r\nexport default function ProducersDiscover({ user, userData, openPublicProfile }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n    const { isFollowing, toggleFollow } = useFollowSystem(user?.uid, userData);\r\n\r\n    const producers = recommendations?.producers || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Trending Producers\"\r\n                description=\"Most popular producers right now\"\r\n                items={producers.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No trending producers found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"producer\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                        isFollowing={isFollowing(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Producers\"\r\n                description=\"Recently joined producers\"\r\n                items={producers.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new producers found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"producer\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                        isFollowing={isFollowing(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {producers.personalized && producers.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on producers you follow\"\r\n                    items={producers.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"producer\"\r\n                            onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                            onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                            isFollowing={isFollowing(item.userId || item.id)}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/StudiosDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\n\r\nexport default function StudiosDiscover({ user, userData, openPublicProfile }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n\r\n    const studios = recommendations?.studios || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Trending Studios\"\r\n                description=\"Most popular studios right now\"\r\n                items={studios.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No trending studios found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"studio\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Studios\"\r\n                description=\"Recently added studios\"\r\n                items={studios.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new studios found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"studio\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {studios.personalized && studios.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on your location and interests\"\r\n                    items={studios.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"studio\"\r\n                            onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/SchoolsDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\n\r\nexport default function SchoolsDiscover({ user, userData }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n\r\n    const schools = recommendations?.schools || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Featured Schools\"\r\n                description=\"Top music education programs\"\r\n                items={schools.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No featured schools found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"school\"\r\n                        onViewProfile={() => {\r\n                            // Navigate to school or show details\r\n                            console.log('View school:', item.id);\r\n                        }}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Schools\"\r\n                description=\"Recently added schools\"\r\n                items={schools.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new schools found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"school\"\r\n                        onViewProfile={() => {\r\n                            console.log('View school:', item.id);\r\n                        }}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {schools.personalized && schools.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on your location and interests\"\r\n                    items={schools.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"school\"\r\n                            onViewProfile={() => {\r\n                                console.log('View school:', item.id);\r\n                            }}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/Discover.jsx\r\n\r\nimport React, { useState } from 'react';\r\nimport { Music, User, Headphones, Building2, School } from 'lucide-react';\r\nimport SoundsDiscover from './discover/SoundsDiscover';\r\nimport ArtistsDiscover from './discover/ArtistsDiscover';\r\nimport ProducersDiscover from './discover/ProducersDiscover';\r\nimport StudiosDiscover from './discover/StudiosDiscover';\r\nimport SchoolsDiscover from './discover/SchoolsDiscover';\r\n\r\nconst DISCOVER_TABS = [\r\n    { id: 'sounds', label: 'Sounds', icon: Music },\r\n    { id: 'artists', label: 'Artists', icon: User },\r\n    { id: 'producers', label: 'Producers', icon: Headphones },\r\n    { id: 'studios', label: 'Studios', icon: Building2 },\r\n    { id: 'schools', label: 'Schools', icon: School },\r\n];\r\n\r\nexport default function Discover({ user, userData, openPublicProfile }) {\r\n    const [activeTab, setActiveTab] = useState('sounds');\r\n\r\n    const renderContent = () => {\r\n        switch (activeTab) {\r\n            case 'sounds':\r\n                return (\r\n                    <SoundsDiscover \r\n                        user={user} \r\n                        userData={userData} \r\n                        openPublicProfile={openPublicProfile}\r\n                    />\r\n                );\r\n            case 'artists':\r\n                return (\r\n                    <ArtistsDiscover \r\n                        user={user} \r\n                        userData={userData} \r\n                        openPublicProfile={openPublicProfile}\r\n                    />\r\n                );\r\n            case 'producers':\r\n                return (\r\n                    <ProducersDiscover \r\n                        user={user} \r\n                        userData={userData} \r\n                        openPublicProfile={openPublicProfile}\r\n                    />\r\n                );\r\n            case 'studios':\r\n                return (\r\n                    <StudiosDiscover \r\n                        user={user} \r\n                        userData={userData} \r\n                        openPublicProfile={openPublicProfile}\r\n                    />\r\n                );\r\n            case 'schools':\r\n                return (\r\n                    <SchoolsDiscover \r\n                        user={user} \r\n                        userData={userData}\r\n                    />\r\n                );\r\n            default:\r\n                return null;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto pb-20\">\r\n            {/* Tab Navigation */}\r\n            <div className=\"flex items-center gap-2 mb-6 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm overflow-x-auto\">\r\n                {DISCOVER_TABS.map(tab => {\r\n                    const Icon = tab.icon;\r\n                    return (\r\n                        <button\r\n                            key={tab.id}\r\n                            onClick={() => setActiveTab(tab.id)}\r\n                            className={`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all whitespace-nowrap ${\r\n                                activeTab === tab.id\r\n                                    ? 'bg-brand-blue text-white shadow-md'\r\n                                    : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                            }`}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span>{tab.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"mt-6\">\r\n                {renderContent()}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useEffect, useMemo } from 'react';\r\nimport { supabase } from '../config/supabase';\r\nimport { Loader2, RefreshCw, Users, Compass, UserPlus, Search } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nimport PostCard from './social/PostCard';\r\nimport CreatePostWidget from './social/CreatePostWidget';\r\nimport ReportModal from './ReportModal';\r\nimport Discover from './social/Discover';\r\nimport { useFollowSystem } from '../hooks/useFollowSystem';\r\nimport FollowButton from './social/FollowButton';\r\nimport UserAvatar from './shared/UserAvatar';\r\n\r\n// Feed mode tabs\r\nconst FEED_MODES = {\r\n    FOR_YOU: 'for_you',\r\n    FOLLOWING: 'following',\r\n    DISCOVER: 'discover'\r\n};\r\n\r\nexport default function SocialFeed({ user, userData, openPublicProfile }) {\r\n    const [posts, setPosts] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [reportTarget, setReportTarget] = useState(null);\r\n    const [feedMode, setFeedMode] = useState(FEED_MODES.FOR_YOU);\r\n    const [suggestedUsers, setSuggestedUsers] = useState([]);\r\n    const [loadingSuggestions, setLoadingSuggestions] = useState(false);\r\n    \r\n    // Get feed algorithm from settings\r\n    const feedAlgorithm = userData?.settings?.social?.feedAlgorithm || 'recommended';\r\n    const autoPlayVideos = userData?.settings?.social?.autoPlayVideos !== false;\r\n    const showSuggestedAccounts = userData?.settings?.social?.showSuggestedAccounts !== false;\r\n\r\n    // Use the follow system hook\r\n    const userId = user?.id || user?.uid;\r\n    const { \r\n        following, \r\n        stats, \r\n        loading: followLoading, \r\n        isFollowing, \r\n        toggleFollow,\r\n        getFollowingIds \r\n    } = useFollowSystem(userId, userData);\r\n\r\n    // Memoize following IDs for feed filtering\r\n    const followingIds = useMemo(() => getFollowingIds(), [following]);\r\n\r\n    // Load suggested users when on Following tab with no follows\r\n    useEffect(() => {\r\n        const userId = user?.id || user?.uid;\r\n        if (feedMode === FEED_MODES.FOLLOWING && followingIds.length === 0 && userId) {\r\n            loadSuggestedUsers();\r\n        }\r\n    }, [feedMode, followingIds.length, user?.id, user?.uid]);\r\n\r\n    const loadSuggestedUsers = async () => {\r\n        setLoadingSuggestions(true);\r\n        try {\r\n            if (!supabase || !user?.id && !user?.uid) return;\r\n            \r\n            const userId = user.id || user.uid;\r\n            \r\n            // Get recent posters as suggestions (excluding current user)\r\n            const { data: posts, error } = await supabase\r\n                .from('posts')\r\n                .select('user_id, display_name, author_photo, role')\r\n                .neq('user_id', userId)\r\n                .order('created_at', { ascending: false })\r\n                .limit(20);\r\n            \r\n            if (error) throw error;\r\n            \r\n            // Extract unique users from posts\r\n            const usersMap = new Map();\r\n            (posts || []).forEach(post => {\r\n                if (!usersMap.has(post.user_id)) {\r\n                    usersMap.set(post.user_id, {\r\n                        userId: post.user_id,\r\n                        displayName: post.display_name,\r\n                        photoURL: post.author_photo,\r\n                        role: post.role\r\n                    });\r\n                }\r\n            });\r\n            \r\n            setSuggestedUsers(Array.from(usersMap.values()).slice(0, 5));\r\n        } catch (error) {\r\n            console.error('Error loading suggestions:', error);\r\n        }\r\n        setLoadingSuggestions(false);\r\n    };\r\n\r\n    // Skeleton loader for feed\r\n    const renderSkeleton = () => {\r\n        const skeletonItems = Array.from({ length: 3 });\r\n        return (\r\n            <div className=\"space-y-4 p-fluid\">\r\n                <div className=\"bg-white dark:bg-[#1f2128] rounded-2xl border border-gray-200 dark:border-gray-700 p-4 animate-pulse\">\r\n                    <div className=\"h-10 bg-gray-200 dark:bg-gray-700 rounded-xl w-48 mb-3\"></div>\r\n                    <div className=\"h-14 bg-gray-100 dark:bg-gray-800 rounded-xl w-full mb-2\"></div>\r\n                </div>\r\n                {skeletonItems.map((_, idx) => (\r\n                    <div key={idx} className=\"bg-white dark:bg-[#1f2128] rounded-2xl border border-gray-200 dark:border-gray-700 p-4 animate-pulse space-y-3\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700\"></div>\r\n                            <div className=\"flex-1\">\r\n                                <div className=\"h-3.5 w-32 bg-gray-200 dark:bg-gray-700 rounded-full mb-2\"></div>\r\n                                <div className=\"h-3 w-20 bg-gray-100 dark:bg-gray-800 rounded-full\"></div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"h-3 w-5/6 bg-gray-100 dark:bg-gray-800 rounded-full\"></div>\r\n                        <div className=\"h-3 w-2/3 bg-gray-100 dark:bg-gray-800 rounded-full\"></div>\r\n                        <div className=\"h-48 bg-gray-100 dark:bg-gray-800 rounded-xl\"></div>\r\n                        <div className=\"flex gap-3\">\r\n                            <div className=\"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded-full\"></div>\r\n                            <div className=\"h-3 w-12 bg-gray-200 dark:bg-gray-700 rounded-full\"></div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    // Render loading skeletons while feed loads\r\n    if (loading) {\r\n        return renderSkeleton();\r\n    }\r\n\r\n    // Main feed listener\r\n    useEffect(() => {\r\n        if (!supabase) {\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        \r\n        let query = supabase\r\n            .from('posts')\r\n            .select('*')\r\n            .order('created_at', { ascending: false });\r\n        \r\n        // Set limit based on feed mode\r\n        const limitCount = (feedMode === FEED_MODES.FOLLOWING && followingIds.length > 0) ? 50 : 20;\r\n        query = query.limit(limitCount);\r\n\r\n        // Initial fetch\r\n        query.then(({ data: posts, error }) => {\r\n            if (error) {\r\n                console.error(\"Feed error:\", error);\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            let newPosts = (posts || []).map(post => ({\r\n                id: post.id,\r\n                ...post,\r\n                userId: post.user_id,\r\n                displayName: post.display_name,\r\n                authorPhoto: post.author_photo,\r\n                timestamp: post.created_at,\r\n                commentCount: post.comment_count || 0,\r\n                reactionCount: post.reaction_count || 0,\r\n                saveCount: post.save_count || 0\r\n            }));\r\n            \r\n            // Apply feed algorithm based on settings (only for \"For You\" feed)\r\n            if (feedMode === FEED_MODES.FOR_YOU) {\r\n                if (feedAlgorithm === 'following') {\r\n                    // Show only following posts\r\n                    if (followingIds.length > 0) {\r\n                        newPosts = newPosts.filter(p => followingIds.includes(p.userId));\r\n                    } else {\r\n                        newPosts = [];\r\n                    }\r\n                } else if (feedAlgorithm === 'chronological') {\r\n                    // Already sorted by created_at desc, no changes needed\r\n                } else {\r\n                    // Recommended algorithm (default) - prioritize posts with more engagement\r\n                    newPosts.sort((a, b) => {\r\n                        const aScore = (a.reactionCount || 0) * 2 + (a.commentCount || 0) * 3 + (a.saveCount || 0);\r\n                        const bScore = (b.reactionCount || 0) * 2 + (b.commentCount || 0) * 3 + (b.saveCount || 0);\r\n                        return bScore - aScore;\r\n                    });\r\n                }\r\n            }\r\n            \r\n            // Client-side filtering for Following feed\r\n            if (feedMode === FEED_MODES.FOLLOWING && followingIds.length > 0) {\r\n                const userId = user?.id || user?.uid;\r\n                newPosts = newPosts.filter(post => \r\n                    followingIds.includes(post.userId) || post.userId === userId\r\n                );\r\n            }\r\n            \r\n            setPosts(newPosts);\r\n            setLoading(false);\r\n        });\r\n\r\n        // Subscribe to realtime changes\r\n        const channel = supabase\r\n            .channel('posts-feed')\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: '*',\r\n                    schema: 'public',\r\n                    table: 'posts'\r\n                },\r\n                async () => {\r\n                    // Refetch on changes\r\n                    const { data: posts, error } = await supabase\r\n                        .from('posts')\r\n                        .select('*')\r\n                        .order('created_at', { ascending: false })\r\n                        .limit(limitCount);\r\n                    \r\n                    if (!error && posts) {\r\n                        let newPosts = posts.map(post => ({\r\n                            id: post.id,\r\n                            ...post,\r\n                            userId: post.user_id,\r\n                            displayName: post.display_name,\r\n                            authorPhoto: post.author_photo,\r\n                            timestamp: post.created_at,\r\n                            commentCount: post.comment_count || 0,\r\n                            reactionCount: post.reaction_count || 0,\r\n                            saveCount: post.save_count || 0\r\n                        }));\r\n                        \r\n                        if (feedMode === FEED_MODES.FOLLOWING && followingIds.length > 0) {\r\n                            const userId = user?.id || user?.uid;\r\n                            newPosts = newPosts.filter(post => \r\n                                followingIds.includes(post.userId) || post.userId === userId\r\n                            );\r\n                        }\r\n                        \r\n                        setPosts(newPosts);\r\n                    }\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [feedMode, followingIds, user?.id, user?.uid]);\r\n\r\n    const handlePost = async (postPayload) => {\r\n        if (!user || !supabase) return;\r\n        try {\r\n            const userId = user.id || user.uid;\r\n            const { error } = await supabase\r\n                .from('posts')\r\n                .insert({\r\n                    user_id: userId,\r\n                    display_name: userData?.effectiveDisplayName || `${userData?.firstName || 'User'} ${userData?.lastName || ''}`.trim(),\r\n                    author_photo: userData?.photoURL || null,\r\n                    role: userData?.activeProfileRole || 'User',\r\n                    text: postPayload.text || null,\r\n                    content: postPayload.text || null, // Also set content for compatibility\r\n                    media_urls: postPayload.mediaUrls || [],\r\n                    media_type: postPayload.mediaType || null,\r\n                    created_at: new Date().toISOString(),\r\n                    reactions: {},\r\n                    reaction_count: 0,\r\n                    comment_count: 0,\r\n                    save_count: 0,\r\n                    visibility: 'public' // Must be lowercase to match CHECK constraint\r\n                });\r\n            \r\n            if (error) throw error;\r\n        } catch (e) {\r\n            console.error(\"Failed to post:\", e);\r\n            alert(\"Could not post update. Please try again.\");\r\n        }\r\n    };\r\n\r\n    const containerVariants = {\r\n        hidden: { opacity: 0 },\r\n        show: {\r\n            opacity: 1,\r\n            transition: { staggerChildren: 0.08 }\r\n        }\r\n    };\r\n\r\n    // Suggested user card component\r\n    const SuggestedUserCard = ({ suggestedUser }) => (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 hover:border-brand-blue/30 transition-all\"\r\n        >\r\n            <div \r\n                className=\"flex items-center gap-3 cursor-pointer flex-1 min-w-0\"\r\n                onClick={() => openPublicProfile?.(suggestedUser.userId)}\r\n            >\r\n                <UserAvatar \r\n                    src={suggestedUser.photoURL}\r\n                    name={suggestedUser.displayName}\r\n                    size=\"md\"\r\n                />\r\n                <div className=\"min-w-0\">\r\n                    <h4 className=\"font-bold text-sm dark:text-white truncate hover:text-brand-blue transition\">\r\n                        {suggestedUser.displayName}\r\n                    </h4>\r\n                    <p className=\"text-xs text-gray-500 truncate\">{suggestedUser.role}</p>\r\n                </div>\r\n            </div>\r\n            <FollowButton\r\n                isFollowing={isFollowing(suggestedUser.userId)}\r\n                onToggle={() => toggleFollow(suggestedUser.userId, suggestedUser)}\r\n                size=\"sm\"\r\n                variant=\"default\"\r\n            />\r\n        </motion.div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto pb-20\">\r\n            {/* Create Post Widget */}\r\n            <CreatePostWidget \r\n                user={user} \r\n                userData={userData} \r\n                onPost={handlePost} \r\n            />\r\n\r\n            {/* Feed Mode Toggle */}\r\n            <div className=\"flex items-center gap-2 mb-4 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <button\r\n                    onClick={() => setFeedMode(FEED_MODES.FOR_YOU)}\r\n                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${\r\n                        feedMode === FEED_MODES.FOR_YOU\r\n                            ? 'bg-brand-blue text-white shadow-md'\r\n                            : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                    }`}\r\n                >\r\n                    <Compass size={16} />\r\n                    <span>For You</span>\r\n                </button>\r\n                <button\r\n                    onClick={() => setFeedMode(FEED_MODES.FOLLOWING)}\r\n                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${\r\n                        feedMode === FEED_MODES.FOLLOWING\r\n                            ? 'bg-brand-blue text-white shadow-md'\r\n                            : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                    }`}\r\n                >\r\n                    <Users size={16} />\r\n                    <span>Following</span>\r\n                    {stats.followingCount > 0 && (\r\n                        <span className={`text-xs px-1.5 py-0.5 rounded-full ${\r\n                            feedMode === FEED_MODES.FOLLOWING\r\n                                ? 'bg-white/20'\r\n                                : 'bg-gray-200 dark:bg-gray-700'\r\n                        }`}>\r\n                            {stats.followingCount}\r\n                        </span>\r\n                    )}\r\n                </button>\r\n                <button\r\n                    onClick={() => setFeedMode(FEED_MODES.DISCOVER)}\r\n                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${\r\n                        feedMode === FEED_MODES.DISCOVER\r\n                            ? 'bg-brand-blue text-white shadow-md'\r\n                            : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                    }`}\r\n                >\r\n                    <Search size={16} />\r\n                    <span>Discover</span>\r\n                </button>\r\n            </div>\r\n\r\n            {/* Feed Content */}\r\n            {feedMode === FEED_MODES.DISCOVER ? (\r\n                <Discover \r\n                    user={user} \r\n                    userData={userData} \r\n                    openPublicProfile={openPublicProfile}\r\n                />\r\n            ) : loading || followLoading ? (\r\n                <div className=\"flex justify-center py-10\">\r\n                    <Loader2 className=\"animate-spin text-brand-blue\" size={32} />\r\n                </div>\r\n            ) : (\r\n                <>\r\n                    {/* Following tab empty state with suggestions */}\r\n                    {feedMode === FEED_MODES.FOLLOWING && followingIds.length === 0 && (\r\n                        <motion.div \r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            className=\"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-6 border border-blue-100 dark:border-blue-800/30\"\r\n                        >\r\n                            <div className=\"text-center mb-6\">\r\n                                <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-brand-blue/10 flex items-center justify-center\">\r\n                                    <UserPlus size={28} className=\"text-brand-blue\" />\r\n                                </div>\r\n                                <h3 className=\"text-lg font-bold dark:text-white mb-2\">\r\n                                    Start following creators\r\n                                </h3>\r\n                                <p className=\"text-sm text-gray-600 dark:text-gray-400 max-w-sm mx-auto\">\r\n                                    Follow artists, engineers, and studios to see their posts in your Following feed.\r\n                                </p>\r\n                            </div>\r\n\r\n                            {/* Suggested users - only show if setting is enabled */}\r\n                            {showSuggestedAccounts && (\r\n                                <>\r\n                                    {loadingSuggestions ? (\r\n                                        <div className=\"space-y-2\">\r\n                                            <h4 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3\">\r\n                                                Suggested for you\r\n                                            </h4>\r\n                                            {[1, 2, 3].map(i => (\r\n                                                <div key={i} className=\"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 animate-pulse\">\r\n                                                    <div className=\"flex items-center gap-3 flex-1\">\r\n                                                        <div className=\"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700\" />\r\n                                                        <div className=\"flex-1 space-y-2\">\r\n                                                            <div className=\"h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded\" />\r\n                                                            <div className=\"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded\" />\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className=\"h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded-lg\" />\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    ) : suggestedUsers.length > 0 && (\r\n                                        <div className=\"space-y-2\">\r\n                                            <h4 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3\">\r\n                                                Suggested for you\r\n                                            </h4>\r\n                                            {suggestedUsers.map(suggestedUser => (\r\n                                                <SuggestedUserCard \r\n                                                    key={suggestedUser.userId} \r\n                                                    suggestedUser={suggestedUser} \r\n                                                />\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                </>\r\n                            )}\r\n                        </motion.div>\r\n                    )}\r\n\r\n                    {/* Posts */}\r\n                    <motion.div \r\n                        variants={containerVariants}\r\n                        initial=\"hidden\"\r\n                        animate=\"show\"\r\n                        className=\"space-y-4\"\r\n                    >\r\n                        <AnimatePresence mode='popLayout'>\r\n                            {posts.map(post => (\r\n                                <PostCard \r\n                                    key={post.id} \r\n                                    post={post} \r\n                                    currentUser={user}\r\n                                    currentUserData={userData}\r\n                                    openPublicProfile={openPublicProfile || (() => {})}\r\n                                    onReport={() => setReportTarget(post)}\r\n                                    isFollowingAuthor={isFollowing(post.userId)}\r\n                                    onToggleFollow={() => toggleFollow(post.userId, {\r\n                                        displayName: post.displayName,\r\n                                        photoURL: post.authorPhoto,\r\n                                        role: post.role\r\n                                    })}\r\n                                    autoPlayVideos={autoPlayVideos}\r\n                                />\r\n                            ))}\r\n                        </AnimatePresence>\r\n                        \r\n                        {posts.length === 0 && feedMode === FEED_MODES.FOR_YOU && (\r\n                            <motion.div \r\n                                initial={{ opacity: 0 }} \r\n                                animate={{ opacity: 1 }}\r\n                                className=\"text-center py-10 text-gray-500\"\r\n                            >\r\n                                <RefreshCw className=\"mx-auto mb-2 opacity-50\" size={32}/>\r\n                                <p>No posts yet. Be the first to share something!</p>\r\n                            </motion.div>\r\n                        )}\r\n\r\n                        {posts.length === 0 && feedMode === FEED_MODES.FOLLOWING && followingIds.length > 0 && (\r\n                            <motion.div \r\n                                initial={{ opacity: 0 }} \r\n                                animate={{ opacity: 1 }}\r\n                                className=\"text-center py-10 text-gray-500\"\r\n                            >\r\n                                <Users className=\"mx-auto mb-2 opacity-50\" size={32}/>\r\n                                <p>No recent posts from people you follow.</p>\r\n                                <button \r\n                                    onClick={() => setFeedMode(FEED_MODES.FOR_YOU)}\r\n                                    className=\"mt-3 text-brand-blue hover:underline text-sm font-medium\"\r\n                                >\r\n                                    Browse For You feed â†’\r\n                                </button>\r\n                            </motion.div>\r\n                        )}\r\n                    </motion.div>\r\n                </>\r\n            )}\r\n\r\n            {/* Report Modal */}\r\n            {reportTarget && (\r\n                <ReportModal \r\n                    user={user}\r\n                    target={{\r\n                        id: reportTarget.id,\r\n                        type: 'Post',\r\n                        summary: reportTarget.text ? reportTarget.text.substring(0, 50) : 'Media Post'\r\n                    }}\r\n                    onClose={() => setReportTarget(null)} \r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":["CommentSection","post","currentUser","currentUserData","blockedUsers","onCountChange","comments","setComments","useState","text","setText","loading","setLoading","useEffect","handleSubmit","e","userId","supabase","handleDelete","commentId","jsxs","jsx","comment","UserAvatar","Send","REACTION_SET","renderText","part","i","cardVariants","PostCard","openPublicProfile","onReport","isFollowingAuthor","onToggleFollow","showComments","setShowComments","commentCount","setCommentCount","isSaved","setIsSaved","showReactionMenu","setShowReactionMenu","showMoreMenu","setShowMoreMenu","linkCopied","setLinkCopied","savingPost","setSavingPost","menuRef","useRef","moreMenuRef","isOwnPost","myReaction","_a","reactionCounts","acc","emoji","totalReactions","a","handleClickOutside","event","handleReaction","handleSavePost","handleShare","shareUrl","copyLink","url","toast","handleDeletePost","motion","User","MoreHorizontal","AnimatePresence","Link2","Fragment","UserPlus","_d","Flag","Trash2","att","StarFieldVisualizer","count","Smile","MessageCircle","Check","Share2","Bookmark","CreatePostWidget","user","userData","onPost","media","setMedia","seshFxOpen","setSeshFxOpen","pluginsUsed","setPluginsUsed","presetFile","setPresetFile","isPosting","setIsPosting","uploadMedia","useMediaUpload","handleFileSelect","type","file","previewUrl","removeMedia","index","_","uploadedMedia","m","pathKey","path","result","presetUrl","res","postPayload","error","Music","X","MultiSelect","POPULAR_PLUGINS_LIST","val","Paperclip","ImageIcon","Video","Sliders","Loader2","DiscoverSection","title","description","items","emptyMessage","onSeeMore","renderItem","gridCols","item","idx","DiscoverCard","onFollow","onViewProfile","onPlay","isFollowing","getTitle","getSubtitle","Play","FollowButton","calculateEngagementScore","content","likes","saves","calculateTrendingScore","timeRange","engagementScore","now","contentTime","_b","ageInHours","decayFactor","getTrendingContent","contentList","limit","scored","b","getPersonalizedRecommendations","allContent","similarUsers","filtered","similarUserIds","fromSimilar","others","getRecentContent","timeA","_c","_f","_e","_h","_g","useDiscover","sounds","setSounds","artists","setArtists","producers","setProducers","studios","setStudios","schools","setSchools","following","setFollowing","recommendations","useMemo","SoundsDiscover","ArtistsDiscover","toggleFollow","useFollowSystem","ProducersDiscover","StudiosDiscover","SchoolsDiscover","DISCOVER_TABS","Headphones","Building2","School","Discover","activeTab","setActiveTab","renderContent","tab","Icon","FEED_MODES","SocialFeed","posts","setPosts","reportTarget","setReportTarget","feedMode","setFeedMode","suggestedUsers","setSuggestedUsers","loadingSuggestions","setLoadingSuggestions","autoPlayVideos","showSuggestedAccounts","stats","followLoading","getFollowingIds","followingIds","loadSuggestedUsers","usersMap","renderSkeleton","skeletonItems","handlePost","containerVariants","SuggestedUserCard","suggestedUser","Compass","Users","Search","RefreshCw","ReportModal"],"mappings":"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"}