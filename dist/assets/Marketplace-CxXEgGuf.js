import{r as x,j as e,X as A,H as se,b as re,L as P,z as ae,ah as H,aa as B,n as E,y as le,G as de,P as W,bn as _,B as Y,$ as ie,T as ne,a9 as oe,aX as K,S as X,ad as Z,Y as ce,ac as xe,b5 as ge,aT as J,b9 as Q,K as be,D as he}from"./vendor-DTDDt3fP.js";import{H as L,E as ee,A as V,I as F,C as I,q,K as O,w as ue,G as $,M as me,V as pe}from"./vendor-firebase-C38qHjbM.js";import{d as v,g as w,u as U}from"./chat-BCnoKXi-.js";import{D as M,R as fe,c as je,E as G}from"./edu-Bzk_yg6o.js";import{R as ye,S as ke}from"./ReportModal-DUITMmQ7.js";import{A as we,m as ve}from"./vendor-framer-CzAUfL-F.js";import"./vendor-convex-DiXsReyd.js";import"./vendor-audio-Bu2lAtPy.js";const Ne=({data:t,setData:o})=>e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-4",children:"Release Essentials"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Title"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.title,onChange:i=>o({...t,title:i.target.value}),placeholder:"e.g. Dark Side of the Moon"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Artist"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.primaryArtist,onChange:i=>o({...t,primaryArtist:i.target.value}),placeholder:"e.g. Pink Floyd"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Type"}),e.jsx("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.type,onChange:i=>o({...t,type:i.target.value}),children:fe.map(i=>e.jsx("option",{value:i.id,children:i.label},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Primary Genre"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.genre,onChange:i=>o({...t,genre:i.target.value}),children:[e.jsx("option",{value:"",children:"Select Genre..."}),je.map(i=>e.jsx("option",{value:i,children:i},i))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Release Date"}),e.jsx("input",{type:"date",className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.releaseDate,onChange:i=>o({...t,releaseDate:i.target.value})}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Standard: 2 weeks out. Express: 48hrs."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Label Name"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:t.labelName,onChange:i=>o({...t,labelName:i.target.value}),placeholder:"Optional (Default: Independent)"})]})]})]}),Ce=({data:t,setData:o,user:i})=>{const{uploadMedia:l,uploading:h}=U(),[a,r]=x.useState(t.artworkUrl||null),[u,p]=x.useState(""),g=async d=>{const j=d.target.files[0];if(!j)return;const s=new Image;s.src=URL.createObjectURL(j),s.onload=async()=>{if(s.width<3e3||s.height<3e3){p("Error: Image must be at least 3000 x 3000 pixels.");return}s.width!==s.height?p("Warning: Image should be a perfect square (1:1 ratio)."):p("");const n=await l(j,`distribution/${i.uid}/artwork`);n!=null&&n.url&&(r(n.url),o({...t,artworkUrl:n.url}))}};return e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 animate-in slide-in-from-right-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Cover Art"}),e.jsx("p",{className:"text-sm text-gray-500",children:"3000 x 3000 px • JPG or PNG • No Blurry Text"})]}),e.jsxs("div",{className:"relative group w-64 h-64 bg-gray-100 dark:bg-[#1f2128] rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center overflow-hidden",children:[a?e.jsx("img",{src:a,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"text-gray-400 flex flex-col items-center",children:[e.jsx(ae,{size:48,className:"mb-2"}),e.jsx("span",{className:"text-xs font-bold",children:"Click to Upload"})]}),e.jsxs("label",{className:"absolute inset-0 cursor-pointer bg-black/0 hover:bg-black/20 transition flex items-center justify-center",children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/png, image/jpeg",onChange:g,disabled:h}),h&&e.jsx(P,{className:"animate-spin text-white",size:32})]})]}),u&&e.jsxs("div",{className:"text-red-500 text-sm font-bold flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[e.jsx(H,{size:16})," ",u]})]})},Se=({data:t,setData:o,user:i})=>{var p,g;const{uploadMedia:l,uploading:h}=U(),a=async d=>{if(!d.name.toLowerCase().endsWith(".wav")){alert("Only .WAV files are accepted for distribution.");return}const j={id:Date.now(),title:d.name.replace(".wav",""),fileUrl:"",status:"uploading",isExplicit:!1,isInstrumental:!1},s=[...t.tracks||[],j];o({...t,tracks:s});try{const n=await l(d,`distribution/${i.uid}/audio_vault`);if(n!=null&&n.url){const c=s.map(y=>y.id===j.id?{...y,fileUrl:n.url,status:"ready",duration:0}:y);o({...t,tracks:c})}}catch(n){console.error("Track upload failed",n),alert("Upload failed.")}},r=d=>{o({...t,tracks:t.tracks.filter(j=>j.id!==d)})},u=(d,j,s)=>{o({...t,tracks:t.tracks.map(n=>n.id===d?{...n,[j]:s}:n)})};return e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Upload Audio"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Stereo WAV files only (16-bit / 44.1kHz minimum)"})]}),e.jsxs("label",{className:"bg-brand-blue hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs cursor-pointer flex items-center gap-2 transition",children:[e.jsx(B,{size:14})," Add Track",e.jsx("input",{type:"file",className:"hidden",accept:".wav",onChange:d=>a(d.target.files[0]),disabled:h})]})]}),e.jsxs("div",{className:"space-y-3",children:[((p=t.tracks)==null?void 0:p.length)===0&&e.jsx("div",{className:"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400",children:"No tracks added yet."}),(g=t.tracks)==null?void 0:g.map((d,j)=>e.jsxs("div",{className:"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded text-gray-500 font-mono text-xs",children:["#",j+1]}),e.jsx("div",{className:"font-bold dark:text-white text-sm",children:d.status==="uploading"?e.jsxs("span",{className:"flex items-center gap-2 text-brand-blue",children:[e.jsx(P,{className:"animate-spin",size:14})," Uploading..."]}):d.title})]}),e.jsx("button",{onClick:()=>r(d.id),className:"text-gray-400 hover:text-red-500",children:e.jsx(A,{size:16})})]}),d.status==="ready"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("input",{className:"col-span-2 p-2 text-xs border rounded bg-transparent dark:border-gray-600 dark:text-white",placeholder:"Track Title",value:d.title,onChange:s=>u(d.id,"title",s.target.value)}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.isExplicit,onChange:s=>u(d.id,"isExplicit",s.target.checked)})," Explicit"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.isInstrumental,onChange:s=>u(d.id,"isInstrumental",s.target.checked)})," Instrumental"]})]})]},d.id))]})]})},Ae=({data:t,setData:o})=>{var h;const i=a=>{const r=t.stores||[],u=r.includes(a)?r.filter(p=>p!==a):[...r,a];o({...t,stores:u})},l=()=>{var a;((a=t.stores)==null?void 0:a.length)===M.length?o({...t,stores:[]}):o({...t,stores:M.map(r=>r.id)})};return e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Select Stores"}),e.jsx("button",{onClick:l,className:"text-xs font-bold text-brand-blue hover:underline",children:((h=t.stores)==null?void 0:h.length)===M.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:M.map(a=>{var u;const r=(u=t.stores)==null?void 0:u.includes(a.id);return e.jsxs("div",{onClick:()=>i(a.id),className:`p-3 rounded-xl border flex items-center gap-3 cursor-pointer transition-all ${r?"bg-blue-50 border-brand-blue dark:bg-blue-900/20":"bg-white dark:bg-[#1f2128] dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${r?"bg-brand-blue border-brand-blue":"border-gray-400"}`,children:r&&e.jsx(E,{size:12,className:"text-white"})}),e.jsx("span",{className:`text-sm font-bold ${r?"text-brand-blue dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:a.name})]},a.id)})}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/10 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800 text-sm text-yellow-800 dark:text-yellow-200 flex items-start gap-3",children:[e.jsx(le,{size:18,className:"mt-0.5 shrink-0"}),e.jsx("p",{children:"Deliveries usually take 2-5 days for Spotify/Apple, and up to 2 weeks for other stores. Please plan your release date accordingly."})]})]})};function ze({user:t,userData:o,initialData:i,onCancel:l,onSuccess:h}){const[a,r]=x.useState(1),[u,p]=x.useState(!1),[g,d]=x.useState(i||{title:"",primaryArtist:`${o.firstName} ${o.lastName}`,type:"single",genre:"",releaseDate:"",labelName:"",artworkUrl:"",tracks:[],stores:M.map(n=>n.id),status:"Draft"}),j=()=>a===1?g.title&&g.primaryArtist&&g.genre&&g.releaseDate:a===2?!!g.artworkUrl:a===3?g.tracks.length>0&&g.tracks.every(n=>n.status==="ready"):a===4?g.stores.length>0:!0,s=async()=>{p(!0);try{const n={...g,uploaderId:t.uid,updatedAt:L(),status:"Processing"};i!=null&&i.id?await ee(V(v,w(t.uid).distributionReleases,i.id),n):await F(I(v,w(t.uid).distributionReleases),{...n,createdAt:L()}),alert("Release submitted successfully! It is now in the review queue."),h()}catch(n){console.error("Submission error:",n),alert("Failed to submit release.")}p(!1)};return e.jsxs("div",{className:"max-w-4xl mx-auto bg-white dark:bg-[#2c2e36] rounded-2xl shadow-xl overflow-hidden border dark:border-gray-700 min-h-[600px] flex flex-col",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#23262f] p-6 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-extrabold dark:text-white",children:"New Release"}),e.jsxs("p",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mt-1",children:["Step ",a," of 4"]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white",children:e.jsx(A,{})})]}),e.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700 w-full",children:e.jsx("div",{className:"h-full bg-brand-blue transition-all duration-300",style:{width:`${a/4*100}%`}})}),e.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[a===1&&e.jsx(Ne,{data:g,setData:d}),a===2&&e.jsx(Ce,{data:g,setData:d,user:t}),a===3&&e.jsx(Se,{data:g,setData:d,user:t}),a===4&&e.jsx(Ae,{data:g,setData:d})]}),e.jsxs("div",{className:"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center",children:[a>1?e.jsxs("button",{onClick:()=>r(a-1),className:"flex items-center gap-2 text-gray-500 font-bold hover:text-gray-800 dark:hover:text-white transition",children:[e.jsx(se,{size:18})," Back"]}):e.jsx("div",{}),a<4?e.jsxs("button",{onClick:()=>r(a+1),disabled:!j(),className:"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-600 transition",children:["Next Step ",e.jsx(re,{size:18})]}):e.jsx("button",{onClick:s,disabled:u||!j(),className:"bg-green-600 text-white px-8 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 hover:bg-green-700 transition shadow-lg",children:u?e.jsx(P,{className:"animate-spin"}):"Submit Release"})]})]})}function Re({user:t,userData:o}){const[i,l]=x.useState("list"),[h,a]=x.useState([]),[r,u]=x.useState(!0),[p,g]=x.useState(null);x.useEffect(()=>{if(!(t!=null&&t.uid))return;const s=q(I(v,w(t.uid).distributionReleases),ue("uploaderId","==",t.uid),O("updatedAt","desc")),n=$(s,c=>{a(c.docs.map(y=>({id:y.id,...y.data()}))),u(!1)});return()=>n()},[t==null?void 0:t.uid]);const d=async(s,n)=>{if(confirm(`Are you sure you want to delete "${n}"? This cannot be undone if already distributed.`))try{await me(V(v,w(t.uid).distributionReleases,s))}catch(c){console.error(c),alert("Failed to delete release.")}},j=s=>{if(s.status!=="Draft"&&s.status!=="Action Needed")return alert("Cannot edit a release that is currently processing or live. Contact support for takedowns.");g(s),l("create")};return i==="create"?e.jsx(ze,{user:t,userData:o,initialData:p,onCancel:()=>{l("list"),g(null)},onSuccess:()=>{l("list"),g(null)}}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(de,{className:"text-brand-blue"})," Distribution Portal"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your catalog across Spotify, Apple Music, and 150+ stores."})]}),e.jsxs("button",{onClick:()=>l("create"),className:"bg-brand-blue text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 shadow-lg hover:shadow-blue-500/20",children:[e.jsx(W,{size:20})," New Release"]})]}),e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 overflow-hidden min-h-[400px]",children:r?e.jsx("div",{className:"p-12 text-center text-gray-500",children:"Loading catalog..."}):h.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4",children:e.jsx(_,{size:48,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"No Releases Yet"}),e.jsx("p",{className:"text-gray-500 max-w-sm mt-2 mb-6",children:"Start your journey by uploading your first single, EP, or album to the world."}),e.jsx("button",{onClick:()=>l("create"),className:"text-brand-blue font-bold hover:underline",children:"Create First Release"})]}):e.jsx("div",{className:"divide-y dark:divide-gray-700",children:h.map(s=>{var n;return e.jsxs("div",{className:"p-5 hover:bg-gray-50 dark:hover:bg-white/5 transition flex flex-col md:flex-row md:items-center justify-between gap-4 group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 bg-gray-200 dark:bg-black rounded-lg shadow-sm overflow-hidden shrink-0 border dark:border-gray-700",children:s.artworkUrl?e.jsx("img",{src:s.artworkUrl,alt:"Art",className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:e.jsx(Y,{size:20})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide border ${s.status==="Live"?"bg-green-100 text-green-700 border-green-200":s.status==="Processing"?"bg-blue-100 text-blue-700 border-blue-200":s.status==="Action Needed"?"bg-red-100 text-red-700 border-red-200":"bg-gray-100 text-gray-600 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600"}`,children:s.status}),e.jsx("span",{className:"text-xs text-gray-400 uppercase font-bold",children:s.type})]}),e.jsx("h4",{className:"font-bold text-lg dark:text-white leading-tight",children:s.title||"Untitled Release"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.primaryArtist," • ",((n=s.tracks)==null?void 0:n.length)||0," Tracks"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pl-4 md:pl-0 border-l md:border-l-0 dark:border-gray-700",children:[e.jsxs("div",{className:"text-right hidden md:block mr-4",children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase font-bold",children:"Release Date"}),e.jsx("div",{className:"text-sm font-medium dark:text-gray-200",children:s.releaseDate?new Date(s.releaseDate).toLocaleDateString():"TBD"})]}),e.jsx("button",{onClick:()=>j(s),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit / View Details",children:e.jsx(ie,{size:18})}),(s.status==="Draft"||s.status==="Action Needed")&&e.jsx("button",{onClick:()=>d(s.id,s.title),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete Release",children:e.jsx(ne,{size:18})})]})]},s.id)})})})]})}const Ie=[{id:"guitar_electric",label:"Electric Guitar"},{id:"guitar_acoustic",label:"Acoustic Guitar"},{id:"amp_head",label:"Amplifier Head"},{id:"amp_combo",label:"Combo Amp"},{id:"keyboard",label:"Keyboard/Synth"},{id:"rack_unit",label:"Rack Gear (1U/2U)"},{id:"pedal",label:"Pedal/Stompbox"}],te=({type:t,view:o,onClick:i,markers:l=[]})=>{var g;const h=()=>l.map((d,j)=>e.jsxs("g",{transform:`translate(${d.x}, ${d.y})`,children:[e.jsx("circle",{r:"6",fill:"#ef4444",stroke:"white",strokeWidth:"2",className:"drop-shadow-md"}),e.jsx("text",{y:"-10",textAnchor:"middle",fill:"#ef4444",fontSize:"10",fontWeight:"bold",children:j+1})]},j)),a={width:"100%",height:"400",viewBox:"0 0 300 400",className:"w-full h-full cursor-crosshair touch-none select-none",onClick:d=>{const j=d.target.getBoundingClientRect(),s=(d.clientX-j.left)*(300/j.width),n=(d.clientY-j.top)*(400/j.height);i(s,n)}},r={guitar_electric:{front:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsx("path",{d:"M150,20 C140,20 135,25 135,40 L135,100 C110,110 90,140 90,170 C90,190 100,200 110,210 C100,220 90,240 90,270 C90,330 110,360 150,360 C190,360 210,330 210,270 C210,240 200,220 190,210 C200,200 210,190 210,170 C210,140 190,110 165,100 L165,40 C165,25 160,20 150,20 Z",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2",strokeDasharray:"5,5"})},amp_combo:{front:e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#e5e7eb",stroke:"#374151",strokeWidth:"2"}),back:e.jsxs("g",{children:[e.jsx("rect",{x:"50",y:"50",width:"200",height:"250",rx:"5",fill:"#d1d5db",stroke:"#374151",strokeWidth:"2"}),e.jsx("rect",{x:"70",y:"200",width:"160",height:"80",fill:"#9ca3af",opacity:"0.5"})]})}},u=()=>e.jsx("rect",{x:"50",y:"50",width:"200",height:"300",rx:"10",fill:"#f3f4f6",stroke:"#9ca3af",strokeWidth:"2",strokeDasharray:"4"}),p=((g=r[t])==null?void 0:g[o])||e.jsx(u,{});return e.jsxs("svg",{...a,children:[p,h()]})};function Pe({initialData:t,onSave:o,onCancel:i,type:l}){const[h,a]=x.useState((t==null?void 0:t.gearType)||"guitar_electric"),[r,u]=x.useState("front"),[p,g]=x.useState((t==null?void 0:t.markers)||[]),[d,j]=x.useState((t==null?void 0:t.notes)||""),[s,n]=x.useState((t==null?void 0:t.photos)||[]),[c,y]=x.useState(null),[S,N]=x.useState(""),{uploadMedia:f,uploading:z}=U(),b=(m,C)=>{const R={x:m,y:C,view:r,id:Date.now(),label:""};g([...p,R]),y(R),N("")},k=()=>{c&&(g(p.map(m=>m.id===c.id?{...m,label:S}:m)),y(null))},T=async m=>{const C=m.target.files[0];if(!C)return;const R=await f(C,`inspections/${Date.now()}`);R&&n(D=>[...D,R])};return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden flex flex-col h-[80vh]",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("h3",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx(H,{className:l==="Pre"?"text-orange-500":"text-green-500",size:20})," ",l,"-Inspection Report"]}),e.jsx("button",{onClick:i,children:e.jsx(A,{className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-black/40 relative flex flex-col items-center justify-center p-4",children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[e.jsx("select",{className:"p-2 rounded-lg border dark:border-gray-600 bg-white dark:bg-[#1f2128] text-sm font-bold dark:text-white shadow-sm",value:h,onChange:m=>a(m.target.value),children:Ie.map(m=>e.jsx("option",{value:m.id,children:m.label},m.id))}),e.jsx("div",{className:"flex bg-white dark:bg-[#1f2128] rounded-lg border dark:border-gray-600 p-1 shadow-sm",children:["front","back","sides"].map(m=>e.jsx("button",{onClick:()=>u(m),className:`px-3 py-1 text-xs font-bold rounded-md capitalize ${r===m?"bg-brand-blue text-white":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:m},m))})]}),e.jsxs("div",{className:"w-full max-w-md h-full aspect-[3/4] bg-white dark:bg-[#1f2128] rounded-xl shadow-inner border dark:border-gray-700 relative",children:[e.jsx(te,{type:h,view:r,markers:p.filter(m=>m.view===r),onClick:b}),c&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 bg-white dark:bg-[#2c2e36] p-4 rounded-xl shadow-2xl border border-brand-blue z-20 animate-in zoom-in-95",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 mb-2",children:"Identify Issue"}),e.jsx("input",{autoFocus:!0,className:"w-full p-2 border rounded mb-2 text-sm dark:bg-black/20 dark:text-white",placeholder:"e.g. Scratch",value:S,onChange:m=>N(m.target.value),onKeyDown:m=>m.key==="Enter"&&k()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{g(p.filter(m=>m.id!==c.id)),y(null)},className:"flex-1 bg-red-100 text-red-600 py-1 rounded text-xs font-bold",children:"Delete"}),e.jsx("button",{onClick:k,className:"flex-1 bg-brand-blue text-white py-1 rounded text-xs font-bold",children:"Save"})]})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Damage Log"}),e.jsx("div",{className:"space-y-2",children:p.map((m,C)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-black/20 rounded border dark:border-gray-700",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-red-500 text-white flex items-center justify-center text-xs font-bold shrink-0",children:C+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-bold dark:text-white",children:m.label||"Unlabeled"}),e.jsxs("div",{className:"text-[10px] text-gray-500 uppercase",children:[m.view," View"]})]}),e.jsx("button",{onClick:()=>g(p.filter(R=>R.id!==m.id)),children:e.jsx(A,{size:14,className:"text-gray-400 hover:text-red-500"})})]},C))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Notes"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg text-sm dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Overall condition...",value:d,onChange:m=>j(m.target.value)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Evidence Photos"}),e.jsxs("label",{className:"cursor-pointer text-brand-blue hover:text-blue-600",children:[e.jsx(B,{size:16}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:T,disabled:z})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:s.map((m,C)=>e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden border dark:border-gray-600 relative group",children:[e.jsx("img",{src:m.url,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>n(s.filter((R,D)=>D!==C)),className:"absolute top-1 right-1 bg-red-500 text-white p-0.5 rounded opacity-0 group-hover:opacity-100 transition",children:e.jsx(A,{size:12})})]},C))})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:()=>o({gearType:h,markers:p,notes:d,photos:s,timestamp:new Date().toISOString()}),className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(oe,{size:18})," Finalize Report"]})})]})]})]})}const Te=["Mint","Excellent","Good","Fair","Non-Functioning"];function Me({user:t,userData:o,setActiveTab:i}){const[l,h]=x.useState("browse"),[a,r]=x.useState([]),[u,p]=x.useState("All"),[g,d]=x.useState(""),[j,s]=x.useState(null);x.useEffect(()=>{const c=q(I(v,w(t.uid).gearListings),O("timestamp","desc")),y=$(c,S=>{r(S.docs.map(N=>({id:N.id,...N.data()})))});return()=>y()},[t.uid]);const n=a.filter(c=>(u==="All"||c.category===u)&&(c.title.toLowerCase().includes(g.toLowerCase())||c.brand.toLowerCase().includes(g.toLowerCase())));return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 animate-in fade-in",children:[l==="browse"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(K,{className:"text-orange-500"})," Gear Exchange"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Buy and sell verified studio equipment."})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(X,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2c2e36] text-sm dark:text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Search gear...",value:g,onChange:c=>d(c.target.value)})]}),e.jsxs("button",{onClick:()=>h("create"),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 shadow-lg transition",children:[e.jsx(W,{size:16})," Sell Gear"]})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2",children:[e.jsx("button",{onClick:()=>p("All"),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${u==="All"?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:"All Gear"}),G.map(c=>e.jsx("button",{onClick:()=>p(c.id),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition ${u===c.id?"bg-white dark:bg-white text-black shadow":"bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:c.label},c.id))]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:n.map(c=>{var y;return e.jsxs("div",{onClick:()=>s(c),className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-xl transition cursor-pointer group flex flex-col",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 dark:bg-black/40 relative flex items-center justify-center overflow-hidden",children:[(y=c.images)!=null&&y[0]?e.jsx("img",{src:c.images[0],className:"w-full h-full object-cover group-hover:scale-105 transition duration-500"}):e.jsx(Z,{size:32,className:"text-gray-400"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur-md",children:["$",c.price]}),c.conditionReport&&e.jsxs("div",{className:"absolute bottom-2 left-2 bg-green-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(E,{size:10})," Inspected"]})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-400 uppercase mb-1",children:c.brand}),e.jsx("h4",{className:"font-bold dark:text-white text-sm mb-1 line-clamp-1",children:c.title}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:[c.condition," Condition"]}),e.jsx("div",{className:"mt-auto pt-3 border-t dark:border-gray-700 flex justify-between items-center text-xs text-gray-400",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{size:10})," ",c.location||"Shipped"]})})]})]},c.id)})})]}),l==="create"&&e.jsx(Le,{user:t,userData:o,onCancel:()=>h("browse"),onSuccess:()=>h("browse")}),j&&e.jsx(Ee,{item:j,onClose:()=>s(null),currentUser:t})]})}function Le({user:t,userData:o,onCancel:i,onSuccess:l}){const[h,a]=x.useState(1),[r,u]=x.useState({title:"",brand:"",category:G[0].id,condition:"Good",price:"",description:"",location:o.city||"",weight:"",length:"",width:"",height:""}),[p,g]=x.useState([]),[d,j]=x.useState(null),[s,n]=x.useState(!1),{uploadMedia:c,uploading:y}=U(),S=async f=>{const z=f.target.files[0];if(!z)return;const b=await c(z,`gear/${t.uid}`);b!=null&&b.url&&g([...p,b.url])},N=async()=>{if(!r.title||!r.price)return alert("Title and Price required.");n(!0);try{await F(I(v,w(t.uid).gearListings),{...r,price:parseInt(r.price),images:p,conditionReport:d,sellerId:t.uid,sellerName:`${o.firstName} ${o.lastName}`,sellerPhoto:o.photoURL||null,timestamp:L(),status:"Active"}),alert("Listing posted!"),l()}catch(f){console.error(f),alert("Failed to post listing.")}n(!1)};return h==="inspection"?e.jsx("div",{className:"h-[600px]",children:e.jsx(Pe,{type:"Pre",onSave:f=>{j(f),a(1)},onCancel:()=>a(1)})}):e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border dark:border-gray-700 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"List Gear for Sale"}),e.jsx("button",{onClick:i,children:e.jsx(A,{className:"text-gray-400"})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:r.brand,onChange:f=>u({...r,brand:f.target.value}),placeholder:"e.g. Fender"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model / Title"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:r.title,onChange:f=>u({...r,title:f.target.value}),placeholder:"e.g. Stratocaster"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:r.category,onChange:f=>u({...r,category:f.target.value}),children:G.map(f=>e.jsx("option",{value:f.id,children:f.label},f.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Condition"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:r.condition,onChange:f=>u({...r,condition:f.target.value}),children:Te.map(f=>e.jsx("option",{value:f,children:f},f))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Price ($)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",value:r.price,onChange:f=>u({...r,price:f.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Weight (lb)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"lbs",value:r.weight,onChange:f=>u({...r,weight:f.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"L (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Len",value:r.length,onChange:f=>u({...r,length:f.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"W (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Wid",value:r.width,onChange:f=>u({...r,width:f.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"H (in)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"Hgt",value:r.height,onChange:f=>u({...r,height:f.target.value})})]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-1",children:"Tech Inspection Report"}),e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-300",children:d?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(E,{size:12})," Report Attached (",d.markers.length," points)"]}):"Mark scratches, dents, or issues on a diagram to build trust."})]}),e.jsx("button",{onClick:()=>a("inspection"),className:`text-xs font-bold px-3 py-2 rounded-lg border transition ${d?"bg-white text-green-600 border-green-200":"bg-orange-100 text-orange-700 border-orange-200 hover:bg-orange-200"}`,children:d?"Edit Report":"Create Report"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Photos"}),e.jsxs("div",{className:"flex gap-2",children:[p.map((f,z)=>e.jsx("img",{src:f,className:"w-16 h-16 rounded-lg object-cover border dark:border-gray-600"},z)),e.jsxs("label",{className:"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",children:[y?e.jsx(P,{className:"animate-spin text-gray-400"}):e.jsx(W,{className:"text-gray-400"}),e.jsx("input",{type:"file",className:"hidden",onChange:S,disabled:y})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:i,className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"Cancel"}),e.jsx("button",{onClick:N,disabled:s||y,className:"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg flex items-center justify-center gap-2",children:s?e.jsx(P,{className:"animate-spin"}):"Post Listing"})]})]})]})}function Ee({item:t,onClose:o,currentUser:i}){var a,r;const[l,h]=x.useState(!1);return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-4xl h-[90vh] rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden border dark:border-gray-700",children:[e.jsxs("div",{className:"md:w-1/2 bg-black relative flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 relative",children:[l&&t.conditionReport?e.jsxs("div",{className:"w-full h-full bg-white rounded-xl overflow-hidden",children:[e.jsx(te,{type:t.conditionReport.gearType,view:"front",markers:t.conditionReport.markers,onClick:()=>{}}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/80 text-white px-3 py-1 rounded-full text-xs",children:"Inspection View"})]}):(a=t.images)!=null&&a[0]?e.jsx("img",{src:t.images[0],className:"max-h-full max-w-full object-contain"}):e.jsx(Z,{size:48,className:"text-gray-600"}),e.jsx("button",{onClick:o,className:"absolute top-4 left-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70",children:e.jsx(A,{size:20})})]}),t.conditionReport&&e.jsxs("div",{className:"p-4 bg-[#1f2128] border-t border-gray-800 flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>h(!1),className:`px-4 py-2 rounded text-xs font-bold ${l?"bg-gray-800 text-gray-400":"bg-orange-600 text-white"}`,children:"Photos"}),e.jsxs("button",{onClick:()=>h(!0),className:`px-4 py-2 rounded text-xs font-bold flex items-center gap-1 ${l?"bg-orange-600 text-white":"bg-gray-800 text-gray-400"}`,children:[e.jsx(xe,{size:12})," Condition Map"]})]})]}),e.jsxs("div",{className:"md:w-1/2 p-8 overflow-y-auto bg-white dark:bg-[#2c2e36]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-bold text-gray-400 uppercase tracking-wider mb-1",children:t.brand}),e.jsx("h2",{className:"text-3xl font-extrabold dark:text-white mb-2",children:t.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["$",t.price]}),e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-1 rounded text-xs font-bold",children:t.condition})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border dark:border-gray-700",children:[e.jsx("img",{src:t.sellerPhoto,className:"w-10 h-10 rounded-full bg-gray-300"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Seller"}),e.jsx("div",{className:"font-bold dark:text-white text-sm",children:t.sellerName})]})]}),((r=t.conditionReport)==null?void 0:r.notes)&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-800/50",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-400 text-sm mb-2 flex items-center gap-2",children:[e.jsx(K,{size:16})," Tech Notes"]}),e.jsxs("p",{className:"text-sm text-orange-900 dark:text-orange-200 italic",children:['"',t.conditionReport.notes,'"']})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("h4",{className:"font-bold dark:text-white text-sm uppercase",children:"Description"}),e.jsx("p",{children:t.description||"No description provided."})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t dark:border-gray-700",children:[t.sellerId===i.uid?e.jsx("button",{className:"w-full bg-gray-100 dark:bg-gray-700 text-gray-500 font-bold py-3 rounded-xl cursor-not-allowed",children:"You own this listing"}):e.jsxs("button",{className:"w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition transform hover:scale-[1.02]",children:[e.jsx(ge,{size:20})," Buy Now"]}),e.jsxs("p",{className:"text-center text-[10px] text-gray-400 mt-3 flex items-center justify-center gap-1",children:[e.jsx(E,{size:10})," Purchases covered by SeshNx Buyer Protection"]})]})]})]})})}function Ue({user:t,userData:o,tokenBalance:i,refreshWallet:l}){const[h,a]=x.useState([]),[r,u]=x.useState("All"),[p,g]=x.useState(""),[d,j]=x.useState(new Set),[s,n]=x.useState(!1),[c,y]=x.useState(null),[S,N]=x.useState(null);x.useEffect(()=>{if(!(t!=null&&t.uid))return;const b=q(I(v,w(t.uid).marketplaceItems),O("timestamp","desc")),k=$(b,T=>{a(T.docs.map(m=>({id:m.id,...m.data()})))});return()=>k()},[t.uid]),x.useEffect(()=>{if(!(t!=null&&t.uid))return;const b=I(v,w(t.uid).userLibrary),k=$(b,T=>{j(new Set(T.docs.map(m=>m.data().itemId)))});return()=>k()},[t==null?void 0:t.uid]);const f=async b=>{if(i<b.price){alert("Insufficient tokens! Please top up.");return}if(window.confirm(`Purchase ${b.title} for ${b.price} Tokens?`))try{const k=V(v,w(t.uid).userWallet);await ee(k,{balance:pe(-b.price)}),await F(I(v,w(t.uid).userLibrary),{itemId:b.id,title:b.title,type:b.type,pricePaid:b.price,purchaseDate:L(),downloadUrl:b.downloadUrl}),l&&l(),alert("Purchased successfully!")}catch(k){console.error(k),alert("Transaction failed.")}},z=h.filter(b=>(r==="All"||b.type===r)&&b.title.toLowerCase().includes(p.toLowerCase()));return e.jsxs("div",{className:"pb-32",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 md:pb-0 scrollbar-hide",children:["All","Presets","Samples","Beats"].map(b=>e.jsx("button",{onClick:()=>u(b),className:`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-all ${r===b?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300"}`,children:b},b))}),e.jsxs("div",{className:"ml-auto flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(X,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card text-sm dark:text-white focus:outline-none",placeholder:"Search...",value:p,onChange:b=>g(b.target.value)})]}),e.jsxs("button",{onClick:()=>n(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-green-700",children:[e.jsx(B,{size:16})," Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:z.map(b=>{const k=d.has(b.id);return e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 overflow-hidden hover:shadow-lg transition flex flex-col group",children:[e.jsxs("div",{className:"aspect-square relative bg-gray-100 dark:bg-gray-800 flex items-center justify-center cursor-pointer",onClick:()=>y(b),children:[b.type==="Presets"?e.jsx(J,{size:40,className:"text-gray-400"}):e.jsx(_,{size:40,className:"text-gray-400"}),k&&e.jsxs("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded flex items-center gap-1",children:[e.jsx(E,{size:8})," OWNED"]})]}),e.jsxs("div",{className:"p-3 flex flex-col flex-1",children:[e.jsx("div",{className:"text-[10px] font-bold text-brand-blue uppercase mb-1",children:b.type}),e.jsx("h4",{className:"font-bold text-sm dark:text-white truncate mb-1",title:b.title,children:b.title}),e.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[e.jsxs("span",{className:"text-xs font-bold text-yellow-600 dark:text-yellow-400 flex items-center gap-1",children:[e.jsx(Q,{size:10,fill:"currentColor"})," ",b.price]}),!k&&e.jsx("button",{onClick:()=>f(b),className:"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1 rounded text-[10px] font-bold hover:opacity-80",children:"Buy"})]})]})]},b.id)})}),s&&e.jsx($e,{user:t,userData:o,onClose:()=>n(!1)}),c&&e.jsx(Fe,{item:c,isOwned:d.has(c.id),user:t,onClose:()=>y(null),onBuy:()=>f(c),onDownload:()=>handleDownload(c),onReport:()=>N({id:c.id,type:"market_item",summary:c.title})}),S&&e.jsx(ye,{user:t,target:S,onClose:()=>N(null)})]})}function $e({user:t,userData:o,onClose:i}){const[l,h]=x.useState({title:"",price:"",type:"Presets",tags:"",description:""}),[a,r]=x.useState(null),[u,p]=x.useState(""),{uploadMedia:g,uploading:d}=U(),j=async()=>{if(!l.title||!l.price||!a)return alert("Title, Price, and Audio File are required.");try{p("Uploading Audio Asset...");const s=await g(a,w(t.uid).marketAssets);p("Listing Item..."),await F(I(v,w(t.uid).marketplaceItems),{...l,price:parseInt(l.price),tags:l.tags.split(",").map(n=>n.trim()).filter(n=>n),author:`${o.firstName} ${o.lastName}`,authorId:t.uid,downloadUrl:s,timestamp:L()}),p("Success!"),setTimeout(i,1e3)}catch(s){console.error(s),p("Error listing item."),alert("Failed to submit item to market. Check console.")}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Creator Studio"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"List a new sound for sale"})]}),e.jsx("button",{onClick:i,children:e.jsx(A,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Title"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:l.title,onChange:s=>h({...l,title:s.target.value}),placeholder:"e.g. Midnight Lofi"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Type"}),e.jsxs("select",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:l.type,onChange:s=>h({...l,type:s.target.value}),children:[e.jsx("option",{children:"Presets"}),e.jsx("option",{children:"Samples"}),e.jsx("option",{children:"Beats"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Price (TK)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:l.price,onChange:s=>h({...l,price:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",rows:"3",value:l.description,onChange:s=>h({...l,description:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Tags (Comma Separated)"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white",value:l.tags,onChange:s=>h({...l,tags:s.target.value}),placeholder:"lofi, hiphop, boom-bap"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-2 border-dashed dark:border-gray-600 rounded-xl p-6 text-center hover:bg-gray-50 dark:hover:bg-gray-800 transition relative bg-blue-50/50 dark:bg-blue-900/10 h-full flex flex-col justify-center items-center",children:[e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"audio/*",onChange:s=>r(s.target.files[0])}),e.jsx(Y,{size:48,className:"mx-auto text-blue-500 mb-2"}),e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:a?a.name:"Upload Audio File (Product Asset)"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"MP3/WAV (Max 50MB)"}),a&&e.jsx("div",{className:"mt-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Selected"})]})})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:j,disabled:d||!l.title||!l.price||!a,className:"w-full bg-brand-blue text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50",children:d?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"animate-spin"})," ",u]}):"List Item for Sale"})})]})})}function Fe({item:t,isOwned:o,onClose:i,onBuy:l,onDownload:h,onReport:a}){return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-2xl overflow-hidden w-full max-w-4xl shadow-2xl flex flex-col md:flex-row h-[80vh] md:h-[600px]",children:[e.jsxs("div",{className:"md:w-5/12 bg-gray-100 dark:bg-black/40 relative p-8 flex flex-col justify-center items-center text-center",children:[e.jsx("div",{className:"w-64 h-64 bg-gradient-to-br from-brand-blue to-purple-600 rounded-lg shadow-2xl mb-6 flex items-center justify-center text-white",children:t.type==="Presets"?e.jsx(J,{size:80}):e.jsx(_,{size:80})}),e.jsx("h2",{className:"text-2xl font-bold dark:text-white mb-2",children:t.title}),e.jsxs("div",{className:"text-brand-blue font-medium mb-6",children:["by ",t.author]}),t.downloadUrl&&e.jsx("div",{className:"w-full",children:e.jsx(ke,{audioUrl:t.downloadUrl,fileName:"Preview Track",previewMode:!o})})]}),e.jsxs("div",{className:"md:w-7/12 p-8 overflow-y-auto flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded uppercase tracking-wide",children:t.type}),e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white mt-2",children:t.title})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:a,className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-gray-400 hover:text-red-500 rounded-full transition",title:"Report Violation",children:e.jsx(be,{size:20})}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(A,{size:20})})]})]}),e.jsxs("div",{className:"prose dark:prose-invert text-sm text-gray-600 dark:text-gray-300 mb-8",children:[e.jsx("p",{children:t.description||"No description provided by the creator."}),!o&&e.jsxs("div",{className:"mt-4 bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded text-yellow-800 dark:text-yellow-200 text-xs flex items-center gap-2",children:[e.jsx(Info,{size:14})," Audio preview is truncated to 15 seconds. Purchase to unlock full track."]})]}),e.jsx("div",{className:"mt-auto",children:o?e.jsxs("button",{onClick:h,className:"w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx(he,{size:24})," Download Now"]}):e.jsxs("button",{onClick:l,className:"w-full bg-gray-900 dark:bg-white dark:text-black text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 shadow-lg transition-transform hover:scale-[1.02]",children:[e.jsx("span",{children:"Buy for"}),e.jsxs("span",{className:"bg-yellow-400 text-black px-2 py-0.5 rounded text-sm flex items-center gap-1",children:[e.jsx(Q,{size:12,fill:"black"})," ",t.price]})]})})]})]})})}function He({user:t,userData:o,tokenBalance:i}){const[l,h]=x.useState("distribution"),a=[{id:"distribution",label:"Music Distribution"},{id:"gear",label:"Gear Exchange"},{id:"fx",label:"SeshFX Store"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:"Marketplace"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-1 rounded-lg border dark:border-gray-700 flex gap-1",children:a.map(r=>e.jsx("button",{onClick:()=>h(r.id),className:`px-4 py-2 text-sm font-bold rounded-md transition-all ${l===r.id?"bg-brand-blue text-white shadow-md":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:r.label},r.id))})]}),e.jsx(we,{mode:"wait",children:e.jsxs(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[l==="distribution"&&e.jsx(Re,{user:t,userData:o}),l==="gear"&&e.jsx(Me,{user:t}),l==="fx"&&e.jsx(Ue,{user:t,tokenBalance:i})]},l)})]})}export{He as default};
