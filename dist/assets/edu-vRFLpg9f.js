const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/eduRoleAssignment-BmV0j_XD.js","assets/chat-CiC8hCyi.js","assets/vendor-BQZCuluI.js","assets/vendor-framer-DGSPH0U8.js"])))=>i.map(i=>d[i]);
import{r as o,j as e,a0 as J,X as oe,L as ge,a1 as ot,a2 as se,a3 as ae,s as ve,a4 as re,S as ne,h as de,x as he,U as pe,W as Se,a5 as Ve,J as We,a6 as Ye,H as dt,a7 as Ce,T as K,a8 as ct,D as ut,a9 as gt,P as X,aa as xt,ab as Je,ac as ie,ad as Ke,ae as be,m as mt,af as ht,$ as Xe,ag as pt,y as bt,a as Ze,ah as Ue,E as yt,g as ft,ai as jt,aj as Qe,ak as kt,F as et,al as Nt,am as vt,an as wt,ao as St,ap as Fe,aq as Oe,ar as Ct,as as Et,A as At}from"./vendor-BQZCuluI.js";import{g as Q,d as I,a as N,b as xe,o as tt,q as M,c as _,w as q,e as z,u as B,s as H,f as G,h as Ee,i as Be,j as me,k as st,l as Lt,S as je,m as Rt,n as V,p as Ae,r as Y,t as Pt,v as ke,x as _t,G as Tt,y as $t}from"./chat-CiC8hCyi.js";import{m as It}from"./vendor-framer-DGSPH0U8.js";const As=["Talent","Engineer","Producer","Composer","Studio","Technician","Fan","Student","EDUStaff","EDUAdmin","Intern","Label","Agent","GAdmin"],zt=["Singer","Singer-Songwriter","Lyricist","Rapper","Guitarist","Bassist","Drummer","Keyboardist","Pianist","Violinist","Cellist","Saxophonist","Trumpeter","DJ","Beatmaker","Multi-Instrumentalist","Session Musician","Vocalist","Backup Singer","Band"],Dt=["Soprano","Mezzo-Soprano","Alto","Countertenor","Tenor","Baritone","Bass","Not Applicable"],Mt=["Pop","R&B/Soul","Rock","Jazz","Classical/Opera","Musical Theatre","Gospel","Country","Hip Hop/Rap","Electronic/EDM","Folk/Acoustic","Metal/Screaming","Reggae","Latin","World Music"],Ut=["Beginner (0-2 years)","Intermediate (2-5 years)","Advanced (5-10 years)","Professional (10+ years)","Session Veteran (20+ years)"],Ft=["Club/Dance","Hip Hop","House","Techno","Drum & Bass","Dubstep","Trance","EDM/Festival","Open Format","Wedding/Corporate","Turntablism/Scratch","Radio"],Ot=["Hip Hop/Trap","Pop","R&B","Electronic/EDM","Rock/Alternative","Country","Jazz","Classical/Orchestral","Film/TV Scoring","Lo-Fi/Ambient","Latin/Reggaeton","Gospel/Christian"],Bt=["Tracking/Recording","Mixing","Mastering","Live Sound/FOH","Monitor Engineering","Broadcast/Podcast","Dolby Atmos/Spatial","Restoration/Forensic","Sound Design","ADR/Dialogue"],Ls={general:["Session","Lesson","Consultation","Rehearsal","Collaboration"],talent:["Vocal Recording","Feature Verse","Background Vocals","Vocal Topline","Live Performance","Session Work","Demo Recording"],instrumentalist:["Session Recording","Live Gig","Tour Support","Recording Session","Overdubs","Arrangement"],dj:["Club Set","Private Event","Festival Set","Radio Mix","Corporate Event","Wedding"],production:["Beat Production","Full Production","Co-Production","Remix","Arrangement","Sound Design","Composition"],engineering:["Mixing","Mastering","Tracking","Editing","Tuning/Comping","Stem Mixing","Atmos Mix"],studio:["Studio Rental","Equipment Rental","Recording Session","Mixing Session","Rehearsal Space"],composer:["Original Score","Arrangement","Orchestration","Library Music","Jingle/Commercial","Songwriting"]},Ge=["Singer","Singer-Songwriter","Vocalist","Backup Singer","Rapper"],ce=["Guitarist","Bassist","Drummer","Keyboardist","Pianist","Violinist","Cellist","Saxophonist","Trumpeter","Multi-Instrumentalist","Session Musician"],Ne=["DJ","Beatmaker"],Rs=t=>{var i;if(!t)return"User";const s=t.activeProfileRole||((i=t.accountTypes)==null?void 0:i[0]);return s==="Talent"&&t.talentSubRole?t.talentSubRole:s||"User"},Ps={FREE:"FREE"},_s=["Xfer Serum","NI Massive","Sylenth1","FabFilter Pro-Q 3","Valhalla VintageVerb","RC-20 Retro Color","Omnisphere","Kontakt","Auto-Tune","Soundtoys Decapitator","Waves CLA-2A","SerumFX","Vital","Diva"],Ts=[{id:"single",label:"Single",maxTracks:1},{id:"ep",label:"EP",maxTracks:6},{id:"album",label:"Album",maxTracks:100}],$s=[{id:"spotify",name:"Spotify",icon:"spotify"},{id:"apple",name:"Apple Music",icon:"apple"},{id:"tiktok",name:"TikTok / Resso",icon:"music"},{id:"instagram",name:"Instagram & Facebook",icon:"instagram"},{id:"youtube",name:"YouTube Music",icon:"youtube"},{id:"amazon",name:"Amazon Music",icon:"shopping-cart"},{id:"tidal",name:"Tidal",icon:"music"},{id:"deezer",name:"Deezer",icon:"music"},{id:"soundcloud",name:"SoundCloud",icon:"cloud"}],Is=["Alternative","Blues","Children's Music","Christian & Gospel","Classical","Comedy","Country","Dance","Electronic","Fitness & Workout","Folk","Hip Hop/Rap","Holiday","Indie Pop","Instrumental","Jazz","K-Pop","Latin","Metal","New Age","Pop","R&B/Soul","Reggae","Rock","Singer/Songwriter","Soundtrack","Spoken Word","World"],we=[{id:"manage_roster",label:"Manage Roster",description:"Add, remove, or edit student details."},{id:"manage_enrollment",label:"Admissions",description:"Process applications and handle intake."},{id:"approve_hours",label:"Approve Hours",description:"Verify and approve internship time logs."},{id:"manage_partners",label:"Manage Partners",description:"Add or edit approved internship studios."},{id:"grade_students",label:"Grading",description:"Submit technical and soft-skill evaluations."},{id:"post_announcements",label:"Announcements",description:"Post news to the student dashboard."},{id:"manage_resources",label:"Resource Rules",description:"Set quotas and booking restrictions."},{id:"manage_staff",label:"Manage Staff",description:"Add new instructors and assign roles."},{id:"view_audit",label:"View Audit Logs",description:"See history of administrative actions."},{id:"edit_settings",label:"School Settings",description:"Change school name, address, and branding."}],at=["EDUAdmin","EDUStaff","Student","Intern"],Gt=["EDUAdmin","EDUStaff","Intern","Student"],rt="GAdmin",He={Vocals:["Soprano","Tenor","Baritone","Bass","Falsetto","Rapping","Beatboxing","Growling"],Guitars:["Electric Guitar","Acoustic Guitar","Bass Guitar","Classical/Nylon","12-String Acoustic","Upright Bass"],Percussion:["Drum Kit","Electronic Drums","Congas","Bongos","Djembe","Cajon","Timbales","Tabla","Marimba","Vibraphone"],Keys:["Grand Piano","Upright Piano","Electric Piano","Clavinet","Hammond Organ","Pipe Organ","Synthesizer","MIDI Controller","Accordion"],Strings:["Violin","Viola","Cello","Double Bass","Harp","Banjo","Mandolin","Ukulele","Sitar","Oud"],Wind:["Flute","Clarinet","Oboe","Bassoon","Saxophone","Trumpet","Trombone","French Horn","Tuba","Harmonica","Didgeridoo","Bagpipes"]},ue=["Rock","Alternative","Indie","Metal","Punk","Pop","Electronic","House","Techno","Dubstep","Hip Hop","Rap","Trap","R&B","Soul","Funk","Jazz","Blues","Country","Folk","Americana","Bluegrass","Classical","Reggae","Latin","World","Experimental"],Ht=["Wi-Fi","Kitchen","Lounge","Private Parking","Shower","Sleep/Lodging","Accessibility Ramps","Video Feed","Loading Dock","Isolation Booth","Live Room","Grand Piano","Tape Machine"],te=[{key:"useRealName",label:"Use Primary Name?",type:"checkbox",isToggle:!0},{key:"profileName",label:"Profile/Stage Name",type:"text"}],zs={Talent:[{key:"talentSubRole",label:"What best describes you?",type:"select",options:["",...zt],isSubRole:!0},{key:"profileName",label:"Artist / Stage Name",type:"text"},{key:"bio",label:"Biography",type:"textarea"},{key:"vocalRange",label:"Vocal Range",type:"select",options:["",...Dt],showFor:Ge},{key:"vocalStyles",label:"Vocal Styles",type:"multi_select",data:Mt,showFor:Ge},{key:"demoReelUrl",label:"Demo Reel / Sample Link",type:"text",placeholder:"YouTube, SoundCloud, or Spotify link"},{key:"primaryInstrument",label:"Primary Instrument",type:"text",showFor:ce},{key:"playingExperience",label:"Playing Experience",type:"select",options:["",...Ut],showFor:ce},{key:"canReadMusic",label:"Sight Reading Ability",type:"select",options:["","None","Lead Sheets/Charts","Standard Notation","Expert/Classically Trained"],showFor:ce},{key:"ownGear",label:"Own Professional Gear?",type:"select",options:["","Yes - Full Rig","Yes - Basic Setup","No - Need Backline"],showFor:ce},{key:"djStyles",label:"DJ Styles",type:"multi_select",data:Ft,showFor:Ne},{key:"djSetup",label:"DJ Setup",type:"select",options:["","CDJs/XDJs","Turntables","Controller","Hybrid","All of the Above"],showFor:Ne},{key:"canProvidePa",label:"Can Provide PA/Sound?",type:"select",options:["","Yes - Full System","Yes - Basic Setup","No"],showFor:Ne},{key:"instruments",label:"Instruments & Skills",type:"nested_select",data:He},{key:"genres",label:"Primary Genres",type:"multi_select",data:ue},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Available for Work","Busy - Limited Availability","Not Available","On Tour"]},{key:"rates",label:"Booking/Feature Rate ($)",type:"number"},{key:"sessionRate",label:"Session Rate ($/hr)",type:"number"},{key:"dayRate",label:"Day Rate ($)",type:"number"},{key:"travelDist",label:"Max Travel (mi)",type:"number"},{key:"gearHighlights",label:"Key Gear (Instruments, Amps, etc.)",type:"textarea"},{key:"readingSkill",label:"Sight Reading",type:"select",options:["None","Charts/Lead Sheets","Standard Notation","Expert"]},{key:"remoteWork",label:"Remote Recording Capable?",type:"select",options:["Yes","No"]},{key:"website",label:"Official Website",type:"text"},{key:"label",label:"Record Label (Optional)",type:"text"},{key:"touring",label:"Currently Touring?",type:"select",options:["Yes","No"]}],Label:[{key:"profileName",label:"Label Name",type:"text"},{key:"bio",label:"Label Description / Mission",type:"textarea"},{key:"genres",label:"Focus Genres",type:"multi_select",data:ue},{key:"website",label:"Website",type:"text"},{key:"acceptingDemos",label:"Accepting Demos?",type:"select",options:["Yes","No"]}],Agent:[...te,{key:"agencyName",label:"Agency Name",type:"text"},{key:"rosterSize",label:"Roster Size",type:"number"},{key:"territory",label:"Territory Focus",type:"text"}],Fan:[{key:"bio",label:"About Me",type:"textarea"},{key:"genres",label:"Favorite Genres",type:"multi_select",data:ue},{key:"lookingFor",label:"Interested In",type:"multi_select",data:["Discovering Music","Booking Talent","Learning"]}],Studio:[...te,{key:"profileName",label:"Studio Name",type:"text"},{key:"bio",label:"Description",type:"textarea"},{key:"address",label:"Address",type:"text"},{key:"hours",label:"Hours of Operation",type:"text"},{key:"dimensions",label:"Live Room Dimensions",type:"text"},{key:"parking",label:"Parking Situation",type:"text"},{key:"amenities",label:"Amenities",type:"multi_select",data:Ht},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Open - Accepting Bookings","Limited Availability","Fully Booked","Closed for Maintenance"]},{key:"hourlyRate",label:"Hourly Rate ($)",type:"number"},{key:"dayRate",label:"Day Rate ($)",type:"number"},{key:"virtualTourUrl",label:"Virtual Tour Link",type:"text",placeholder:"YouTube or 360° tour URL"},{key:"gearList",label:"Equipment List URL",type:"text"}],Engineer:[...te,{key:"bio",label:"Bio",type:"textarea"},{key:"skills",label:"Specialties",type:"multi_select",data:Bt},{key:"daw",label:"DAWs",type:"multi_select",data:["Pro Tools","Logic Pro","Ableton","FL Studio","Cubase","Reaper","Studio One","Luna"]},{key:"outboard",label:"Favorite Outboard Gear",type:"textarea"},{key:"credits",label:"Selected Credits",type:"textarea"},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Available for Work","Busy - Limited Availability","Not Available","On Location"]},{key:"hourlyRate",label:"Hourly Rate ($)",type:"number"},{key:"projectRate",label:"Per-Song/Project Rate ($)",type:"number"},{key:"sampleWorkUrl",label:"Sample Work / Reel Link",type:"text",placeholder:"SoundCloud, YouTube, or portfolio URL"},{key:"remoteWork",label:"Remote Mixing Available?",type:"select",options:["Yes","No"]},{key:"hasStudio",label:"Has Own Studio?",type:"select",options:["Yes - Commercial","Yes - Home Studio","No - Freelance Only"]}],Producer:[...te,{key:"bio",label:"Bio",type:"textarea"},{key:"genres",label:"Genres",type:"multi_select",data:ue},{key:"productionStyles",label:"Production Styles",type:"multi_select",data:Ot},{key:"daw",label:"Primary DAW",type:"select",options:["Pro Tools","Logic Pro","Ableton","FL Studio","Cubase","Studio One","Reason","Bitwig"]},{key:"credits",label:"Discography / Credits",type:"textarea"},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Available for Work","Busy - Limited Availability","Not Available","In Studio"]},{key:"beatLeasePrice",label:"Beat Lease Price ($)",type:"number"},{key:"exclusivePrice",label:"Exclusive Beat Price ($)",type:"number"},{key:"customBeatPrice",label:"Custom Production Rate ($)",type:"number"},{key:"sampleWorkUrl",label:"Beat Catalog / Portfolio Link",type:"text",placeholder:"BeatStars, YouTube, or website URL"},{key:"acceptsCollabs",label:"Open to Collaborations?",type:"select",options:["Yes","Paid Only","No"]}],Composer:[...te,{key:"bio",label:"Bio",type:"textarea"},{key:"compType",label:"Type",type:"multi_select",options:["Film/TV","Game Audio","Pop/Songwriting","Classical/Orchestral","Library Music","Jingles"]},{key:"instruments",label:"Primary Instruments",type:"nested_select",data:He},{key:"libraries",label:"Key Sample Libraries",type:"textarea"},{key:"credits",label:"Credits",type:"textarea"},{key:"availabilityStatus",label:"Current Availability",type:"select",options:["","Available for Work","Busy - Limited Availability","Not Available","On Project"]},{key:"projectRate",label:"Project Rate ($/minute of music)",type:"number"},{key:"reelUrl",label:"Demo Reel / Portfolio Link",type:"text",placeholder:"Vimeo, YouTube, or portfolio URL"},{key:"canOrchestrate",label:"Orchestration Services?",type:"select",options:["Yes","No"]},{key:"turnaroundTime",label:"Typical Turnaround",type:"select",options:["24-48 hours","3-5 days","1-2 weeks","Project Dependent"]}],Technician:[...te,{key:"bio",label:"Bio",type:"textarea"},{key:"skills",label:"Skills",type:"textarea"}]},Ds=[{id:"repair",label:"Equipment Repair"},{id:"wiring",label:"Studio Wiring/Install"},{id:"acoustics",label:"Acoustic Calibration"},{id:"computer",label:"DAW/Computer Support"},{id:"mods",label:"Custom Mods"}],Ms=["Luthier (Guitar/Bass)","Drum Tech","Amp Tech (Tube)","Amp Tech (Solid State)","Studio Electrician","Acoustician","Piano Tuner/Tech","Synth/Keyboard Tech","Computer/IT Systems","Soldering/Cabling","Console Maintenance","Live Sound Tech"],Us=[{id:"audio_interfaces",label:"Audio Interfaces"},{id:"microphones",label:"Microphones"},{id:"preamps",label:"Preamps & Channel Strips"},{id:"mixing_consoles",label:"Mixing Consoles & Mixers"},{id:"monitors",label:"Studio Monitors & Speakers"},{id:"headphones",label:"Headphones & IEMs"},{id:"outboard_processing",label:"Outboard Gear (Compressors, EQs)"},{id:"effects_processors",label:"Effects Processors & Reverbs"},{id:"converters",label:"AD/DA Converters & Clocks"},{id:"electric_guitars",label:"Electric Guitars"},{id:"acoustic_guitars",label:"Acoustic Guitars"},{id:"bass_guitars",label:"Bass Guitars"},{id:"guitar_amps",label:"Guitar & Bass Amplifiers"},{id:"guitar_effects",label:"Guitar Pedals & Effects"},{id:"guitar_accessories",label:"Guitar Accessories (Cases, Straps, Strings)"},{id:"synthesizers",label:"Synthesizers"},{id:"keyboards",label:"Keyboards & Workstations"},{id:"midi_controllers",label:"MIDI Controllers"},{id:"pianos",label:"Pianos (Digital & Acoustic)"},{id:"organs",label:"Organs"},{id:"drum_kits",label:"Drum Kits (Acoustic)"},{id:"electronic_drums",label:"Electronic Drums & Pads"},{id:"cymbals",label:"Cymbals"},{id:"percussion",label:"Percussion & Hand Drums"},{id:"drum_machines",label:"Drum Machines & Samplers"},{id:"string_instruments",label:"String Instruments (Violin, Cello, etc.)"},{id:"wind_instruments",label:"Wind & Brass Instruments"},{id:"world_instruments",label:"World & Ethnic Instruments"},{id:"pa_speakers",label:"PA Speakers & Subwoofers"},{id:"power_amps",label:"Power Amplifiers"},{id:"live_mixers",label:"Live Sound Mixers"},{id:"wireless_systems",label:"Wireless Microphone Systems"},{id:"in_ear_monitors",label:"In-Ear Monitor Systems"},{id:"stage_gear",label:"Stage Gear (DI Boxes, Snakes, Stands)"},{id:"turntables",label:"Turntables & DJ Decks"},{id:"dj_controllers",label:"DJ Controllers"},{id:"dj_mixers",label:"DJ Mixers"},{id:"cdj_media_players",label:"CDJs & Media Players"},{id:"recorders",label:"Recorders (Field, Multitrack)"},{id:"tape_machines",label:"Tape Machines & Reel-to-Reel"},{id:"studio_furniture",label:"Studio Furniture & Desks"},{id:"acoustic_treatment",label:"Acoustic Treatment & Panels"},{id:"isolation",label:"Isolation Booths & Shields"},{id:"cables",label:"Cables & Connectors"},{id:"patchbays",label:"Patchbays & Routing"},{id:"stage_lighting",label:"Stage Lighting"},{id:"video_gear",label:"Video & Streaming Gear"},{id:"computers",label:"Computers & Laptops (Music Production)"},{id:"software_licenses",label:"Software & Plugin Licenses"},{id:"storage_drives",label:"Storage & Hard Drives"},{id:"stands_mounts",label:"Stands & Mounts"},{id:"cases_bags",label:"Cases, Bags & Road Cases"},{id:"power_conditioning",label:"Power Conditioners & UPS"},{id:"parts_components",label:"Parts & Components"},{id:"vintage_gear",label:"Vintage & Collectible Gear"},{id:"other",label:"Other"}],Fs=500,Os={INTENT_CREATED:"intent_created",HOLD_PLACED:"hold_placed",SELLER_NOTIFIED:"seller_notified",MEETUP_SCHEDULED:"meetup_scheduled",SELLER_EN_ROUTE:"seller_en_route",BUYER_EN_ROUTE:"buyer_en_route",AT_SAFE_ZONE:"at_safe_zone",SELLER_PHOTOS_UPLOADED:"seller_photos_uploaded",BUYER_INSPECTING:"buyer_inspecting",BUYER_PHOTOS_UPLOADED:"buyer_photos_uploaded",PENDING_DUAL_APPROVAL:"pending_dual_approval",SELLER_APPROVED:"seller_approved",BUYER_APPROVED:"buyer_approved",COMPLETED:"completed",DISPUTED:"disputed",CANCELLED:"cancelled"},Bs=[{key:"intent",label:"Purchase Intent",description:"Buyer initiates purchase"},{key:"hold",label:"Payment Hold",description:"Card hold placed in escrow"},{key:"schedule",label:"Schedule Meetup",description:"Coordinate exchange date/location"},{key:"seller_depart",label:"Seller Departs",description:"Seller uploads pre-departure photos"},{key:"arrive",label:"Safe Zone Arrival",description:"Both parties arrive at safe location"},{key:"inspect",label:"Buyer Inspection",description:"Buyer verifies item condition"},{key:"approve",label:"Dual Approval",description:"Both parties confirm exchange"},{key:"complete",label:"Complete",description:"Funds released to seller"}],Gs=100,Hs=50,qs=[{id:"police_station",label:"Police Station",icon:"shield",priority:1},{id:"fire_station",label:"Fire Station",icon:"flame",priority:2},{id:"bank",label:"Bank Lobby",icon:"landmark",priority:3},{id:"post_office",label:"Post Office",icon:"mail",priority:4},{id:"city_hall",label:"City Hall / Gov Building",icon:"building",priority:5},{id:"library",label:"Public Library",icon:"book",priority:6},{id:"mall_security",label:"Mall Security Office",icon:"store",priority:7}],it=o.createContext();function ye(){return o.useContext(it)}function Vs({children:t,user:s,userData:i}){var y;const[h,c]=o.useState(null),[a,l]=o.useState(null),[g,m]=o.useState(null),[r,n]=o.useState([]),[u,p]=o.useState(null),[b,f]=o.useState(!0);o.useEffect(()=>{if(!s||!(i!=null&&i.schoolId)){f(!1);return}Q(I(N,"schools",i.schoolId)).then(C=>{C.exists()&&c(C.data())}).catch(C=>console.error("Error fetching school data:",C)),(async()=>{var C,j,w,A;try{if((C=i.accountTypes)!=null&&C.includes("Student")||(j=i.accountTypes)!=null&&j.includes("Intern")){const R=xe(s.uid).studentRecord(i.schoolId,s.uid);tt(I(N,R),async $=>{if($.exists()){const T=$.data();if(l(T),T.internshipStudioId){const U=await Q(I(N,`schools/${i.schoolId}/partners/${T.internshipStudioId}`));if(U.exists())p(U.data());else{const d=await Q(I(N,"studios",T.internshipStudioId));d.exists()&&p(d.data())}}}})}if((w=i.accountTypes)!=null&&w.includes("EDUStaff")||(A=i.accountTypes)!=null&&A.includes("EDUAdmin")){const R=M(_(N,`schools/${i.schoolId}/staff`),q("uid","==",s.uid)),$=await z(R);if(!$.empty){const T=$.docs[0].data();if(m(T),T.roleId){const U=await Q(I(N,`schools/${i.schoolId}/roles/${T.roleId}`));U.exists()&&n(U.data().permissions||[])}else i.accountTypes.includes("EDUAdmin")&&n(["ALL"])}}}catch(R){console.error("Error setting up school context:",R)}finally{f(!1)}})()},[s,i]);const v=async(E,C="remote")=>{if(!(!a||!i.schoolId))try{const j=_(N,`schools/${i.schoolId}/internship_logs`),w=await G(j,{studentId:s.uid,studentName:i.displayName||"Unknown",checkIn:H(),checkOut:null,location:E||"Unknown",type:C,status:"active",description:""}),A=xe(s.uid).studentRecord(i.schoolId,s.uid);await B(I(N,A),{activeSessionId:w.id,isClockedIn:!0})}catch(j){throw console.error("Check-in failed:",j),j}},S=async E=>{if(!(!(a!=null&&a.activeSessionId)||!i.schoolId))try{const C=`schools/${i.schoolId}/internship_logs/${a.activeSessionId}`;await B(I(N,C),{checkOut:H(),status:"pending_approval",description:E||"No description"});const j=xe(s.uid).studentRecord(i.schoolId,s.uid);await B(I(N,j),{activeSessionId:null,isClockedIn:!1})}catch(C){throw console.error("Check-out failed:",C),C}},x={schoolId:i==null?void 0:i.schoolId,schoolData:h,studentProfile:a,staffProfile:g,myPermissions:r,internshipStudio:u,isStudent:!!a,isStaff:!!g||((y=i==null?void 0:i.accountTypes)==null?void 0:y.includes("EDUAdmin")),checkIn:v,checkOut:S,loading:b};return e.jsx(it.Provider,{value:x,children:t})}const Ws=async t=>{if(!t||t.length<5)return null;try{const s=await fetch(`https://api.zippopotam.us/us/${t}`);if(!s.ok)return null;const h=(await s.json()).places[0];return{lat:parseFloat(h.latitude),lng:parseFloat(h.longitude),name:h["place name"],state:h["state abbreviation"],cityState:`${h["place name"]}, ${h["state abbreviation"]}`}}catch(s){return console.warn("Geocoding failed:",s),null}},qt=async(t,s)=>{if(!t||!s)return null;try{const i=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${s}`);if(!i.ok)return null;const c=(await i.json()).address,a=c.city||c.town||c.village||c.hamlet||"Unknown Location",l=c.state||"",g=c.postcode||"";return{city:a,state:l,zip:g,displayName:`${a}, ${l} ${g}`.trim()}}catch(i){return console.warn("Reverse geocoding failed:",i),null}},Vt=async(t,s={})=>{if(!t||t.trim().length<3)return[];const{countryCode:i="us",limit:h=5,addressDetails:c=!0}=s;try{const a=new URLSearchParams({q:t,format:"json",addressdetails:c?"1":"0",limit:h.toString(),countrycodes:i}),l=await fetch(`https://nominatim.openstreetmap.org/search?${a}`,{headers:{Accept:"application/json"}});return l.ok?(await l.json()).map(m=>{const r=m.address||{};return{id:m.place_id,displayName:m.display_name,shortName:Wt(m),lat:parseFloat(m.lat),lng:parseFloat(m.lon),type:m.type,category:m.category,address:{houseNumber:r.house_number||"",street:r.road||r.street||"",city:r.city||r.town||r.village||r.hamlet||"",state:r.state||"",stateCode:Le(r.state),zip:r.postcode||"",country:r.country||"",countryCode:r.country_code||""},formattedAddress:Yt(r)}}):(console.warn("Address search failed:",l.status),[])}catch(a){return console.warn("Address search error:",a),[]}};function Wt(t){const s=t.address||{},i=[];s.house_number&&s.road?i.push(`${s.house_number} ${s.road}`):s.road&&i.push(s.road);const h=s.city||s.town||s.village||s.hamlet;h&&i.push(h);const c=Le(s.state);return c&&i.push(c),i.join(", ")||t.display_name.split(",").slice(0,3).join(",")}function Yt(t){const s=[];t.house_number&&t.road?s.push(`${t.house_number} ${t.road}`):t.road&&s.push(t.road);const i=t.city||t.town||t.village||"",h=Le(t.state),c=t.postcode||"",a=[i,h].filter(Boolean).join(", ");return a&&s.push(c?`${a} ${c}`:a),s.join(", ")}function Le(t){if(!t)return"";const s={alabama:"AL",alaska:"AK",arizona:"AZ",arkansas:"AR",california:"CA",colorado:"CO",connecticut:"CT",delaware:"DE",florida:"FL",georgia:"GA",hawaii:"HI",idaho:"ID",illinois:"IL",indiana:"IN",iowa:"IA",kansas:"KS",kentucky:"KY",louisiana:"LA",maine:"ME",maryland:"MD",massachusetts:"MA",michigan:"MI",minnesota:"MN",mississippi:"MS",missouri:"MO",montana:"MT",nebraska:"NE",nevada:"NV","new hampshire":"NH","new jersey":"NJ","new mexico":"NM","new york":"NY","north carolina":"NC","north dakota":"ND",ohio:"OH",oklahoma:"OK",oregon:"OR",pennsylvania:"PA","rhode island":"RI","south carolina":"SC","south dakota":"SD",tennessee:"TN",texas:"TX",utah:"UT",vermont:"VT",virginia:"VA",washington:"WA","west virginia":"WV",wisconsin:"WI",wyoming:"WY","district of columbia":"DC"};return t.length===2?t.toUpperCase():s[t.toLowerCase()]||t}function Re(){throw new Error("Supabase is not configured (missing VITE_SUPABASE_URL / VITE_SUPABASE_ANON_KEY).")}const Pe="public";function Jt(t,s){return{bucket:t==null?void 0:t.bucket,path:String(s)}}async function nt(t,s){Re();const i=t.bucket||Pe,h=t.path,{data:c,error:a}=await Ee.storage.from(i).upload(h,s,{upsert:!0});if(a)throw a;return{ref:t,metadata:c}}function Ys(t,s){return{snapshot:{ref:t},on:(h,c,a,l)=>{nt(t,s).then(()=>l==null?void 0:l()).catch(()=>l==null?void 0:l())}}}async function Kt(t){Re();const s=t.bucket||Pe,{data:i}=Ee.storage.from(s).getPublicUrl(t.path);return i.publicUrl}async function Js(t){Re();const s=t.bucket||Pe,{error:i}=await Ee.storage.from(s).remove([t.path]);if(i)throw i}const Xt=()=>{const[t,s]=o.useState(!1),[i,h]=o.useState(null);return{uploadImage:async(a,l)=>{if(!a)return null;if(!Be)return h("Firebase Storage is not configured. Please set VITE_FIREBASE_STORAGE_BUCKET in your environment variables."),console.error("Firebase Storage is not available. storageBucket is missing from Firebase config."),null;s(!0),h(null);try{const m=`${Date.now()}_${a.name}`,r=`${l}/${m}`,n=Jt(Be,r),u=await nt(n,a),p=await Kt(u.ref);return s(!1),p}catch(g){return console.error("Upload failed:",g),h(g),s(!1),null}},uploading:t,error:i}};function Zt(t={}){const{debounceMs:s=300,countryCode:i="us",limit:h=5}=t,[c,a]=o.useState([]),[l,g]=o.useState(!1),[m,r]=o.useState(null),n=o.useRef(null),u=o.useRef(""),p=o.useRef(0),b=o.useCallback(async v=>{const S=(v==null?void 0:v.trim())||"";if(n.current&&clearTimeout(n.current),S.length<3){a([]),g(!1),r(null);return}S!==u.current&&(g(!0),r(null),n.current=setTimeout(async()=>{const x=++p.current;u.current=S;try{const y=await Vt(S,{countryCode:i,limit:h,addressDetails:!0});x===p.current&&(a(y),g(!1))}catch(y){x===p.current&&(r(y.message||"Address search failed"),a([]),g(!1))}},s))},[s,i,h]),f=o.useCallback(()=>{a([]),r(null),u.current=""},[]);return{search:b,results:c,loading:l,error:m,clearResults:f}}function Qt({onSelect:t,value:s,onChange:i,placeholder:h="Start typing an address...",className:c="",label:a="Address",required:l=!1,showGeolocation:g=!0,countryCode:m="us",error:r}){const{search:n,results:u,loading:p,error:b,clearResults:f}=Zt({countryCode:m,debounceMs:350,limit:6}),[v,S]=o.useState(""),[x,y]=o.useState(!1),[E,C]=o.useState(!1),j=o.useRef(null),w=o.useRef(null),A=s!==void 0?s:v;o.useEffect(()=>{function k(P){j.current&&!j.current.contains(P.target)&&y(!1)}return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[]);const R=k=>{const P=k.target.value;i?i(P):S(P),P.trim().length>=3?(n(P),y(!0)):(y(!1),f())},$=k=>{const P={displayName:k.displayName,shortName:k.shortName,formattedAddress:k.formattedAddress,lat:k.lat,lng:k.lng,...k.address},F=k.formattedAddress||k.shortName||k.displayName;i?i(F):S(F),t&&t(P),y(!1),f()},T=async()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}C(!0),navigator.geolocation.getCurrentPosition(async k=>{const{latitude:P,longitude:F}=k.coords;try{const W=await qt(P,F);if(W){const Z=W.displayName;i?i(Z):S(Z),t&&t({displayName:Z,formattedAddress:Z,lat:P,lng:F,city:W.city,state:W.state,zip:W.zip})}}catch(W){console.error("Reverse geocode failed:",W)}C(!1)},k=>{console.warn("Geolocation error:",k),alert("Unable to get your location. Please enter address manually."),C(!1)},{enableHighAccuracy:!0,timeout:1e4})},U=()=>{var k;i?i(""):S(""),f(),y(!1),(k=w.current)==null||k.focus()},d=r||b;return e.jsxs("div",{ref:j,className:`relative ${c}`,children:[a&&e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:[a,l&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(J,{className:`absolute left-3 top-3 ${p?"text-brand-blue animate-pulse":"text-gray-400"}`,size:16}),e.jsx("input",{ref:w,type:"text",className:`
                            w-full pl-9 pr-8 p-2.5 text-sm
                            bg-white dark:bg-[#1f2128] 
                            border ${d?"border-red-400 focus:ring-red-200":"border-gray-200 dark:border-gray-600 focus:ring-brand-blue"}
                            rounded-lg focus:ring-2 outline-none 
                            dark:text-white transition-all
                        `,placeholder:h,value:A,onChange:R,onFocus:()=>{u.length>0&&y(!0)},autoComplete:"off"}),A&&!p&&e.jsx("button",{type:"button",onClick:U,className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",children:e.jsx(oe,{size:16})}),p&&e.jsx(ge,{className:"absolute right-3 top-3 text-brand-blue animate-spin",size:16})]}),g&&e.jsx("button",{type:"button",onClick:T,disabled:E,className:"p-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-brand-blue transition-colors disabled:opacity-50",title:"Use my current location",children:E?e.jsx(ge,{size:18,className:"animate-spin"}):e.jsx(ot,{size:18})})]}),d&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r||b}),x&&u.length>0&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-72 overflow-y-auto animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsx("div",{className:"py-1",children:u.map(k=>{var P;return e.jsx("button",{type:"button",onClick:()=>$(k),className:"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(J,{size:16,className:"text-gray-400 group-hover:text-brand-blue transition-colors mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm dark:text-white group-hover:text-brand-blue transition-colors truncate",children:k.shortName||k.formattedAddress}),k.displayName!==k.shortName&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5",children:k.displayName}),((P=k.address)==null?void 0:P.zip)&&e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:["ZIP: ",k.address.zip]})]})]})},k.id)})}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-t dark:border-gray-700 text-[10px] text-gray-400 text-center",children:"Powered by OpenStreetMap"})]}),x&&p&&u.length===0&&A.length>=3&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2",children:[e.jsx(ge,{className:"animate-spin",size:16}),e.jsx("span",{className:"text-sm",children:"Searching addresses..."})]}),x&&!p&&u.length===0&&A.length>=3&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 text-sm",children:"No addresses found. Try a different search."})]})}const es="modulepreload",ts=function(t){return"/"+t},qe={},ss=function(s,i,h){let c=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),g=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));c=Promise.allSettled(i.map(m=>{if(m=ts(m),m in qe)return;qe[m]=!0;const r=m.endsWith(".css"),n=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${n}`))return;const u=document.createElement("link");if(u.rel=r?"stylesheet":es,r||(u.as="script"),u.crossOrigin="",u.href=m,g&&u.setAttribute("nonce",g),document.head.appendChild(u),r)return new Promise((p,b)=>{u.addEventListener("load",p),u.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(l){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=l,window.dispatchEvent(g),!g.defaultPrevented)throw l}return c.then(l=>{for(const g of l||[])g.status==="rejected"&&a(g.reason);return s().catch(a)})};function ee(t){return!t||!t.accountTypes?!1:t.accountTypes.some(s=>at.includes(s))}function as(t){if(!ee(t))return null;const s=t.accountTypes.filter(i=>at.includes(i));for(const i of Gt)if(s.includes(i))return i;return s[0]||null}async function rs(t,s,i=null){var m;if(!t)return!1;if((m=t.accountTypes)!=null&&m.includes(rt))return!0;if(i!==null&&Array.isArray(i))return i.includes(s);if(!ee(t))return!1;const{isStudentInSchool:h,isInternInSchool:c,isStaffInSchool:a,isAdminInSchool:l}=await ss(async()=>{const{isStudentInSchool:r,isInternInSchool:n,isStaffInSchool:u,isAdminInSchool:p}=await import("./eduRoleAssignment-BmV0j_XD.js");return{isStudentInSchool:r,isInternInSchool:n,isStaffInSchool:u,isAdminInSchool:p}},__vite__mapDeps([0,1,2,3])),g=t.accountTypes||[];return g.includes("Student")&&await h(t.uid||t.id,s)||g.includes("Intern")&&await c(t.uid||t.id,s)||g.includes("EDUStaff")&&await a(t.uid||t.id,s)||g.includes("EDUAdmin")&&await l(t.uid||t.id,s)?!0:t.schoolId===s}function is(t){return!t||!t.accountTypes?!1:t.accountTypes.includes(rt)}const lt=o.createContext();function fe(){const t=o.useContext(lt);if(!t)throw new Error("useEduAuth must be used within an EduAuthProvider");return t}function Ks({children:t,user:s,userData:i}){const[h,c]=o.useState(null),[a,l]=o.useState(null),[g,m]=o.useState(!1),[r,n]=o.useState(!0);o.useEffect(()=>{if(!s){c(null),l(null),m(!1),n(!1);return}if(!i||!ee(i)){c(null),l(null),m(!1),n(!1);return}c(s);const p=I(N,`artifacts/${me}/users/${s.uid}/profiles/main`),b=tt(p,f=>{if(f.exists()){const v=f.data();l(v),m(ee(v))}else l(null),m(!1);n(!1)},f=>{console.error("Error listening to EDU user data:",f),l(null),m(!1),n(!1)});return()=>b()},[s,i]);const u={user:h,userData:a,isAuthenticated:!!h&&g,hasEduAccess:g,eduRole:a?as(a):null,canAccessSchool:async p=>a?await rs(a,p):!1,loading:r};return e.jsx(lt.Provider,{value:u,children:t})}function Xs({user:t,userData:s}){let i;try{i=fe()}catch{i=null}const h=(i==null?void 0:i.user)||t,c=(i==null?void 0:i.userData)||s,{schoolData:a,studentProfile:l}=ye(),[g,m]=o.useState(""),[r,n]=o.useState([]),[u,p]=o.useState(!1),[b,f]=o.useState([]),[v,S]=o.useState([]),[x,y]=o.useState([]),[E,C]=o.useState([]),[j,w]=o.useState(!1),A=(c==null?void 0:c.internshipCities)||[],R=c==null?void 0:c.schoolId,$=async()=>{const L=g.trim();if(L&&A.length<3)try{await B(I(N,"users",h.uid),{internshipCities:st(L)}),m("")}catch(D){console.error("Error adding interest:",D)}},T=async L=>{try{await B(I(N,"users",h.uid),{internshipCities:Lt(L)})}catch(D){console.error("Error removing interest:",D)}};o.useEffect(()=>{c!=null&&c.programComplete&&U()},[c==null?void 0:c.programComplete,A]),o.useEffect(()=>{R&&(h!=null&&h.uid)&&(d(),k(),P(),F())},[R,h==null?void 0:h.uid]);const U=async()=>{p(!0);try{const L=M(_(N,"studios"),q("allowInternship","==",!0));let O=(await z(L)).docs.map(le=>({id:le.id,...le.data()}));A.length>0&&(O=O.filter(le=>A.some(ze=>{var De,Me;return((De=le.city)==null?void 0:De.toLowerCase().includes(ze.toLowerCase()))||((Me=le.zipCode)==null?void 0:Me.includes(ze))}))),n(O)}catch(L){console.error("Error fetching studios:",L)}finally{p(!1)}},d=async()=>{w(!0);try{const L=M(_(N,`schools/${R}/courses`),q("status","==","published")),D=await z(L);f(D.docs.map(O=>({id:O.id,...O.data()})))}catch(L){console.error("Error loading courses:",L)}w(!1)},k=async()=>{try{const L=M(_(N,`schools/${R}/enrollments`),q("studentId","==",h.uid)),D=await z(L);S(D.docs.map(O=>({id:O.id,...O.data()})))}catch(L){console.error("Error loading enrollments:",L)}},P=async()=>{try{const L=M(_(N,`schools/${R}/learning_paths`)),D=await z(L);y(D.docs.map(O=>({id:O.id,...O.data()})))}catch(L){console.error("Error loading learning paths:",L)}},F=async()=>{try{const L=M(_(N,`schools/${R}/badges`),q("studentId","==",h.uid)),D=await z(L);C(D.docs.map(O=>({id:O.id,...O.data()})))}catch(L){console.error("Error loading badges:",L)}},W=async L=>{try{await G(_(N,`schools/${R}/enrollments`),{studentId:h.uid,courseId:L,enrolledAt:H(),progress:0,status:"active"}),k()}catch(D){console.error("Error enrolling:",D),alert("Failed to enroll in course.")}},Z=v.map(L=>L.courseId),Te=b.filter(L=>!Z.includes(L.id)),$e=b.filter(L=>Z.includes(L.id)),Ie=((l==null?void 0:l.hoursLogged)||0)/((a==null?void 0:a.requiredHours)||100);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2",children:a!=null&&a.logoURL?e.jsx("img",{src:a.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(se,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight mb-1",children:(a==null?void 0:a.name)||"Student Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Student Portal"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["ID: ",(c==null?void 0:c.studentId)||"N/A"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Cohort: ",(l==null?void 0:l.cohort)||"General"]})]})]}),e.jsxs("div",{className:"w-full md:w-64 bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"dark:text-gray-300",children:"Progress"}),e.jsxs("span",{className:"text-indigo-600",children:[Math.round(Ie*100),"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:"h-full bg-indigo-600",style:{width:`${Math.min(100,Ie*100)}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 text-right",children:[(l==null?void 0:l.hoursLogged)||0," / ",(a==null?void 0:a.requiredHours)||100," Hours"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(J,{size:20,className:"text-indigo-500"})," Internship Locations"]}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Add up to 3 target locations (City, Zip, or County) to find matched studios."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:A.map(L=>e.jsxs("span",{className:"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300 text-sm font-medium px-3 py-1 rounded-full flex items-center gap-1",children:[L,e.jsx("button",{onClick:()=>T(L),className:"ml-1 hover:text-indigo-800",children:"×"})]},L))}),A.length<3&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter City or Zip Code",value:g,onChange:L=>m(L.target.value),onKeyDown:L=>L.key==="Enter"&&$(),className:"flex-1 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none"}),e.jsx("button",{onClick:$,disabled:!g.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg font-bold disabled:opacity-50",children:"Add"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(ae,{size:20,className:"text-indigo-500"}),"My Courses"]}),$e.length===0?e.jsx("p",{className:"text-gray-500",children:"You haven't enrolled in any courses yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:$e.map(L=>{const D=v.find(O=>O.courseId===L.id);return e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-bold dark:text-white",children:L.title}),e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-1 rounded",children:"Enrolled"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:L.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(ve,{size:14}),e.jsxs("span",{children:[L.lessonCount||0," lessons"]})]}),e.jsx("button",{className:"text-indigo-600 text-sm font-semibold hover:underline",children:"Continue Learning →"})]}),D&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Progress"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[D.progress||0,"%"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all",style:{width:`${D.progress||0}%`}})})]})]},L.id)})})]}),Te.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(ae,{size:20,className:"text-indigo-500"}),"Available Courses"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Te.slice(0,4).map(L=>e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsx("h3",{className:"font-bold dark:text-white mb-1",children:L.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:L.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(ve,{size:14}),e.jsxs("span",{children:[L.lessonCount||0," lessons"]})]}),e.jsx("button",{onClick:()=>W(L.id),className:"px-4 py-1.5 bg-indigo-600 text-white text-sm font-semibold rounded-lg hover:bg-indigo-700 transition",children:"Enroll"})]})]},L.id))})]}),E.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(re,{size:20,className:"text-yellow-500"}),"Earned Badges & Certificates"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:E.map(L=>{var D,O;return e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(re,{size:32,className:"mx-auto text-yellow-500 mb-2"}),e.jsx("p",{className:"text-sm font-semibold dark:text-white",children:L.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:((O=(D=L.earnedAt)==null?void 0:D.toDate)==null?void 0:O.call(D).toLocaleDateString())||"Recently"})]},L.id)})})]}),(c==null?void 0:c.programComplete)&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(ne,{size:20,className:"text-indigo-500"})," Available Studios"]}),u?e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(de,{className:"animate-spin",size:16})," Searching..."]}):r.length>0?e.jsx("div",{className:"space-y-3",children:r.map(L=>e.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold dark:text-white text-lg",children:L.name}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(J,{size:12})," ",L.city,", ",L.state]})]}),e.jsx("button",{className:"text-indigo-600 font-bold text-sm hover:underline",children:"View Details"})]},L.id))}):e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(he,{size:16})," No studios found matching your criteria yet."]})]})]})}const _e=(t,s="export")=>{if(!t||!t.length){console.warn("No data to export.");return}const i=new Set;t.forEach(m=>Object.keys(m).forEach(r=>i.add(r)));const h=Array.from(i),c=[];c.push(h.join(",")),t.forEach(m=>{const r=h.map(n=>{const u=m[n];return u&&typeof u=="object"?u.toMillis?`"${new Date(u.toMillis()).toLocaleString()}"`:`"${JSON.stringify(u).replace(/"/g,'""')}"`:`"${(""+(u??"")).replace(/"/g,'""')}"`});c.push(r.join(","))});const a=new Blob([c.join(`
`)],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),g=document.createElement("a");g.href=l,g.setAttribute("download",`${s}_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(g),g.click(),document.body.removeChild(g)};function ns({schoolId:t,schoolData:s}){const[i,h]=o.useState({students:0,interns:0,pending:0}),[c,a]=o.useState([]),[l,g]=o.useState(!0);return o.useEffect(()=>{t&&(async()=>{g(!0);try{const r=await Rt(_(N,`schools/${t}/students`)),u=(await z(_(N,`schools/${t}/students`))).docs.filter(v=>v.data().internshipStudioId).length,b=(await z(_(N,`schools/${t}/internship_logs`))).docs.filter(v=>v.data().status==="pending_approval").length;h({students:r.data().count,interns:u,pending:b});const f=await z(M(_(N,`schools/${t}/audit_logs`),V("timestamp","desc"),Ae(5)));a(f.docs.map(v=>({id:v.id,...v.data()})))}catch(r){console.error("Overview load failed:",r)}g(!1)})()},[t]),l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Overview..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(je,{title:"Total Students",value:i.students,icon:e.jsx(pe,{className:"text-white"}),bg:"bg-gradient-to-br from-indigo-500 to-blue-600",text:"text-white"}),e.jsx(je,{title:"Active Internships",value:i.interns,icon:e.jsx(Se,{className:"text-white"}),bg:"bg-gradient-to-br from-purple-500 to-pink-600",text:"text-white"}),e.jsx(je,{title:"Pending Approvals",value:i.pending,icon:e.jsx(de,{className:"text-white"}),bg:"bg-gradient-to-br from-yellow-500 to-orange-600",text:"text-white"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-4 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ve,{size:18,className:"text-gray-400"})," Recent Activity"]}),e.jsx("div",{className:"space-y-3",children:c.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No recent activity recorded."}):c.map(m=>{var r;return e.jsxs("div",{className:"text-xs border-b dark:border-gray-700 pb-2 last:border-0",children:[e.jsxs("div",{className:"flex justify-between font-bold dark:text-gray-200",children:[e.jsx("span",{children:m.action}),e.jsx("span",{className:"text-gray-500 font-normal",children:(r=m.timestamp)!=null&&r.toDate?m.timestamp.toDate().toLocaleTimeString():""})]}),e.jsxs("div",{className:"text-gray-500 mt-0.5",children:[m.details," ",e.jsxs("span",{className:"opacity-70",children:["— ",m.adminName]})]})]},m.id)})})]}),e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center text-center bg-white dark:bg-black/20 shadow-sm",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center shadow-lg mb-4 overflow-hidden border-4 border-white dark:border-gray-700",children:s!=null&&s.logoURL?e.jsx("img",{src:s.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(se,{size:40,className:"text-indigo-500"})}),e.jsx("h2",{className:"text-2xl font-extrabold dark:text-white mb-1",children:(s==null?void 0:s.name)||"School Name"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:(s==null?void 0:s.address)||"No Address Set"}),(s==null?void 0:s.website)&&e.jsxs("a",{href:s.website,target:"_blank",rel:"noreferrer",className:"text-xs font-bold text-indigo-600 bg-indigo-50 dark:bg-indigo-900/20 px-3 py-1.5 rounded-full hover:bg-indigo-100 transition flex items-center gap-1",children:[e.jsx(We,{size:12})," Visit Website"]})]})]})]})}function ls({schoolId:t,logAction:s}){const[i,h]=o.useState([]),[c,a]=o.useState([]),[l,g]=o.useState(!0),[m,r]=o.useState(""),[n,u]=o.useState(!1),[p,b]=o.useState(!1),[f,v]=o.useState(null),[S,x]=o.useState(!1),[y,E]=o.useState({firstName:"",lastName:"",email:"",studentId:"",cohort:"",status:"Enrolled"}),[C,j]=o.useState("");o.useEffect(()=>{(async()=>{g(!0);try{const k=await z(_(N,`schools/${t}/students`));h(k.docs.map(F=>({id:F.id,...F.data()})));const P=await z(_(N,`schools/${t}/partners`));a(P.docs.map(F=>({id:F.id,...F.data()})))}catch(k){console.error("Roster load failed:",k)}g(!1)})()},[t]);const w=()=>{E({firstName:"",lastName:"",email:"",studentId:"",cohort:"",status:"Enrolled"}),x(!1),v(null),u(!0)},A=d=>{var k,P;E({firstName:((k=d.displayName)==null?void 0:k.split(" ")[0])||"",lastName:((P=d.displayName)==null?void 0:P.split(" ").slice(1).join(" "))||"",email:d.email||"",studentId:d.studentId||"",cohort:d.cohort||"",status:d.status||"Enrolled"}),x(!0),v(d),u(!0)},R=async()=>{const d=`${y.firstName} ${y.lastName}`.trim();if(!d||!y.email)return alert("Name and Email required.");try{if(S&&f)await B(I(N,`schools/${t}/students/${f.id}`),{...y,displayName:d}),h(k=>k.map(P=>P.id===f.id?{...P,...y,displayName:d}:P)),await s("Edit Student",`Updated ${d}`);else{const k=await G(_(N,`schools/${t}/students`),{...y,displayName:d,hoursLogged:0,createdAt:H()});h(P=>[...P,{id:k.id,...y,displayName:d,hoursLogged:0}]),await s("Add Student",`Added ${d}`)}u(!1)}catch(k){console.error("Save student failed:",k),alert("Failed to save student.")}},$=async(d,k)=>{if(confirm(`Remove ${k} from the roster? This does not delete their user account.`))try{await Y(I(N,`schools/${t}/students/${d}`)),h(P=>P.filter(F=>F.id!==d)),await s("Remove Student",`Removed ${k}`)}catch(P){console.error("Delete failed:",P)}},T=async()=>{if(!(!f||!C))try{await B(I(N,`schools/${t}/students/${f.id}`),{internshipStudioId:C}),h(d=>d.map(k=>k.id===f.id?{...k,internshipStudioId:C}:k)),b(!1),j(""),alert(`Assigned ${f.displayName} to studio.`),await s("Assign Internship",`Assigned ${f.displayName}`)}catch(d){console.error("Assignment failed:",d)}},U=i.filter(d=>{var k,P;return((k=d.displayName)==null?void 0:k.toLowerCase().includes(m.toLowerCase()))||((P=d.studentId)==null?void 0:P.includes(m))});return l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roster..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ne,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Search by Name or ID...",value:m,onChange:d=>r(d.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_e(i,"student_roster"),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-bold text-xs",children:"Export CSV"}),e.jsxs("button",{onClick:w,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-indigo-700",children:[e.jsx(Ye,{size:16})," Add Student"]})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3",children:"ID"}),e.jsx("th",{className:"p-3",children:"Cohort"}),e.jsx("th",{className:"p-3",children:"Internship"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:U.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-6 text-center text-gray-500",children:"No students found."})}):U.map(d=>e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsx("td",{className:"p-3 font-bold dark:text-white",children:d.displayName}),e.jsx("td",{className:"p-3 text-gray-500",children:d.studentId||"--"}),e.jsx("td",{className:"p-3",children:d.cohort||"General"}),e.jsx("td",{className:"p-3 text-gray-500",children:d.internshipStudioId?e.jsxs("span",{className:"flex items-center gap-1 text-green-600 font-medium text-xs bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded w-fit",children:[e.jsx(Se,{size:12})," Assigned"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"Pending"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>{v(d),b(!0)},className:"p-1.5 bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-300 rounded hover:bg-indigo-100",title:"Assign Internship",children:e.jsx(dt,{size:14})}),e.jsx("button",{onClick:()=>A(d),className:"p-1.5 bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded hover:bg-gray-200",title:"Edit Details",children:e.jsx(Ce,{size:14})}),e.jsx("button",{onClick:()=>$(d.id,d.displayName),className:"p-1.5 bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-100",title:"Remove Student",children:e.jsx(K,{size:14})})]})})]},d.id))})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:S?"Edit Student":"Add New Student"}),e.jsx("button",{onClick:()=>u(!1),children:e.jsx(oe,{className:"text-gray-400 hover:text-red-500"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"First Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:y.firstName,onChange:d=>E({...y,firstName:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Last Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:y.lastName,onChange:d=>E({...y,lastName:d.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Email Address"}),e.jsx("input",{type:"email",className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:y.email,onChange:d=>E({...y,email:d.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Student ID"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:y.studentId,onChange:d=>E({...y,studentId:d.target.value}),placeholder:"e.g. S123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Cohort"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:y.cohort,onChange:d=>E({...y,cohort:d.target.value}),placeholder:"Fall 2024"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Enrollment Status"}),e.jsxs("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:y.status,onChange:d=>E({...y,status:d.target.value}),children:[e.jsx("option",{value:"Enrolled",children:"Enrolled"}),e.jsx("option",{value:"Graduated",children:"Graduated"}),e.jsx("option",{value:"Dropped",children:"Dropped"}),e.jsx("option",{value:"Leave",children:"On Leave"})]})]}),e.jsx("button",{onClick:R,className:"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 mt-2",children:S?"Update Student":"Create Student Record"})]})}),p&&f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-sm rounded-xl p-6 space-y-4 animate-in zoom-in-95 shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Assign Internship"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Select a partner studio for ",e.jsx("strong",{children:f.displayName}),"."]}),e.jsxs("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",value:C,onChange:d=>j(d.target.value),children:[e.jsx("option",{value:"",children:"Select Studio..."}),c.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm",children:"Cancel"}),e.jsx("button",{onClick:T,disabled:!C,className:"flex-1 bg-indigo-600 text-white py-2 rounded font-bold disabled:opacity-50",children:"Confirm"})]})]})})]})}const os=(t,s)=>{if(!t||!s)return 0;const i=t.toMillis?t.toMillis():new Date(t).getTime(),c=(s.toMillis?s.toMillis():new Date(s).getTime())-i;return Math.max(0,Math.floor(c/6e4))},ds=t=>{const s=Math.floor(t/60),i=Math.floor(t%60);return`${s}h ${i>0?`${i}m`:""}`};function cs({schoolId:t}){const[s,i]=o.useState([]),[h,c]=o.useState(!0),[a,l]=o.useState("all");o.useEffect(()=>{t&&(async()=>{c(!0);try{let n=M(_(N,`schools/${t}/internship_logs`),V("checkIn","desc"),Ae(100));const p=(await z(n)).docs.map(b=>{const f=b.data(),v=os(f.checkIn,f.checkOut);return{id:b.id,...f,duration:v}});i(p)}catch(n){console.error("Error fetching logs:",n)}c(!1)})()},[t]);const g=async(r,n)=>{try{await B(I(N,`schools/${t}/internship_logs/${r}`),{status:n}),i(u=>u.map(p=>p.id===r?{...p,status:n}:p))}catch(u){console.error("Error updating log:",u),alert("Failed to update log status.")}},m=a==="all"?s:s.filter(r=>r.status===a);return h?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Internship Hours..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{size:16,className:"text-gray-500"}),e.jsxs("select",{className:"bg-white dark:bg-[#1f2128] border dark:border-gray-600 text-sm rounded-md p-1.5 outline-none dark:text-white",value:a,onChange:r=>l(r.target.value),children:[e.jsx("option",{value:"all",children:"All Activity"}),e.jsx("option",{value:"pending_approval",children:"Pending Approval"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"active",children:"Active (Clocked In)"})]})]}),e.jsxs("button",{onClick:()=>_e(m,"internship_hours"),className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(ut,{size:14})," Export CSV"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Date"}),e.jsx("th",{className:"p-3",children:"Student"}),e.jsx("th",{className:"p-3",children:"Activity / Description"}),e.jsx("th",{className:"p-3",children:"Duration"}),e.jsx("th",{className:"p-3",children:"Status"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:"No logs found matching criteria."})}):m.map(r=>{var n,u;return e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[e.jsx("div",{className:"font-medium",children:(n=r.checkIn)!=null&&n.toDate?r.checkIn.toDate().toLocaleDateString():"N/A"}),e.jsx("div",{className:"text-[10px] text-gray-400",children:(u=r.checkIn)!=null&&u.toDate?r.checkIn.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:r.studentName}),e.jsxs("td",{className:"p-3 max-w-xs",children:[e.jsxs("span",{className:"block text-[10px] uppercase font-bold text-gray-400 mb-0.5",children:[r.type," • ",r.location]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 truncate block",title:r.description,children:r.description||e.jsx("span",{className:"italic opacity-50",children:"No description provided"})})]}),e.jsx("td",{className:"p-3 font-mono font-bold text-indigo-600 dark:text-indigo-400",children:r.checkOut?ds(r.duration):e.jsx("span",{className:"animate-pulse text-green-500",children:"Active..."})}),e.jsx("td",{className:"p-3",children:e.jsx(us,{status:r.status})}),e.jsx("td",{className:"p-3 text-right",children:r.status==="pending_approval"&&e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx("button",{onClick:()=>g(r.id,"approved"),className:"p-1.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded hover:bg-green-200 transition",title:"Approve",children:e.jsx(he,{size:16})}),e.jsx("button",{onClick:()=>g(r.id,"rejected"),className:"p-1.5 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-200 transition",title:"Reject",children:e.jsx(gt,{size:16})})]})})]},r.id)})})]})})]})}function us({status:t}){const s={approved:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",rejected:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",pending_approval:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",active:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 animate-pulse"},i={approved:"Approved",rejected:"Rejected",pending_approval:"Pending",active:"In Progress"};return e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-[10px] uppercase font-bold tracking-wide ${s[t]||"bg-gray-100 text-gray-500"}`,children:i[t]||t})}function gs({schoolId:t,course:s,onSave:i,onCancel:h,logAction:c}){const[a,l]=o.useState({title:"",description:"",duration:"",prerequisites:[],category:""}),[g,m]=o.useState([]),[r,n]=o.useState(!1),[u,p]=o.useState(""),[b,f]=o.useState(null);o.useEffect(()=>{s&&(l({title:s.title||"",description:s.description||"",duration:s.duration||"",prerequisites:s.prerequisites||[],category:s.category||""}),v())},[s]);const v=async()=>{if(s!=null&&s.id)try{const j=M(_(N,`schools/${t}/courses/${s.id}/lessons`),V("order","asc")),A=(await z(j)).docs.map(R=>({id:R.id,...R.data()}));m(A)}catch(j){console.error("Error loading lessons:",j)}},S=async()=>{if(!a.title.trim()){alert("Course title is required.");return}n(!0);try{const j={...a,updatedAt:H(),lessonCount:g.length};if(s)await B(I(N,`schools/${t}/courses/${s.id}`),j),c&&c("update_course",{courseId:s.id,title:a.title});else{j.createdAt=H();const w=await G(_(N,`schools/${t}/courses`),j);c&&c("create_course",{courseId:w.id,title:a.title})}i()}catch(j){console.error("Error saving course:",j),alert("Failed to save course.")}n(!1)},x=()=>{u.trim()&&!a.prerequisites.includes(u.trim())&&(l(j=>({...j,prerequisites:[...j.prerequisites,u.trim()]})),p(""))},y=j=>{l(w=>({...w,prerequisites:w.prerequisites.filter(A=>A!==j)}))},E=()=>{const j={id:`temp-${Date.now()}`,title:"New Lesson",description:"",type:"video",content:"",order:g.length,duration:0};m([...g,j]),f(j.id)},C=async j=>{if(confirm("Delete this lesson?")){if(j.startsWith("temp-")){m(g.filter(w=>w.id!==j));return}try{await Y(I(N,`schools/${t}/courses/${s.id}/lessons/${j}`)),v()}catch(w){console.error("Error deleting lesson:",w)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:s?"Edit Course":"Create New Course"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsx("button",{onClick:S,disabled:r,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50",children:r?"Saving...":"Save Course"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Course Title *"}),e.jsx("input",{type:"text",value:a.title,onChange:j=>l({...a,title:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., Introduction to Music Production"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:j=>l({...a,description:j.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"Course description..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Duration"}),e.jsx("input",{type:"text",value:a.duration,onChange:j=>l({...a,duration:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., 8 weeks"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),e.jsx("input",{type:"text",value:a.category,onChange:j=>l({...a,category:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., Production, Engineering"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Prerequisites"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:u,onChange:j=>p(j.target.value),onKeyPress:j=>j.key==="Enter"&&x(),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"Add prerequisite..."}),e.jsx("button",{onClick:x,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.prerequisites.map((j,w)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-full text-sm",children:[j,e.jsx("button",{onClick:()=>y(j),className:"hover:text-indigo-900 dark:hover:text-indigo-100",children:e.jsx(oe,{size:14})})]},w))})]})]}),s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white",children:"Lessons"}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:[e.jsx(X,{size:18}),"Add Lesson"]})]}),e.jsxs("div",{className:"space-y-2",children:[g.map((j,w)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx(xt,{className:"text-gray-400 cursor-move",size:18}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium dark:text-white",children:j.title||"Untitled Lesson"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[j.type," • ",j.duration||0," min"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(j.id),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition",children:e.jsx(Edit2,{size:16,className:"text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>C(j.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition",children:e.jsx(K,{size:16,className:"text-red-600 dark:text-red-400"})})]})]},j.id)),g.length===0&&e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No lessons yet. Add your first lesson!"})]})]})]})}function xs({schoolId:t,logAction:s}){const[i,h]=o.useState([]),[c,a]=o.useState(!0),[l,g]=o.useState(""),[m,r]=o.useState(!1),[n,u]=o.useState(null);o.useEffect(()=>{t&&p()},[t]);const p=async()=>{a(!0);try{const x=M(_(N,`schools/${t}/courses`),V("createdAt","desc")),E=(await z(x)).docs.map(C=>({id:C.id,...C.data()}));h(E)}catch(x){console.error("Error loading courses:",x)}a(!1)},b=()=>{u(null),r(!0)},f=x=>{u(x),r(!0)},v=async x=>{if(confirm("Are you sure you want to delete this course? This action cannot be undone."))try{const y=_(N,`schools/${t}/courses/${x}/lessons`),C=(await z(y)).docs.map(j=>Y(j.ref));await Promise.all(C),await Y(I(N,`schools/${t}/courses/${x}`)),s&&s("delete_course",{courseId:x}),p()}catch(y){console.error("Error deleting course:",y),alert("Failed to delete course.")}},S=i.filter(x=>{var y,E;return((y=x.title)==null?void 0:y.toLowerCase().includes(l.toLowerCase()))||((E=x.description)==null?void 0:E.toLowerCase().includes(l.toLowerCase()))});return m?e.jsx(gs,{schoolId:t,course:n,onSave:()=>{r(!1),u(null),p()},onCancel:()=>{r(!1),u(null)},logAction:s}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(ae,{size:24}),"Courses"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Manage courses and learning materials"})]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition",children:[e.jsx(X,{size:18}),"New Course"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search courses...",value:l,onChange:x=>g(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-800 dark:text-white"})]}),c?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading courses..."})]}):S.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx(ae,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:l?"No courses found matching your search.":"No courses yet. Create your first course!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(x=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-1",children:x.title||"Untitled Course"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:x.description||"No description"})]}),e.jsxs("div",{className:"flex gap-2 ml-2",children:[e.jsx("button",{onClick:()=>f(x),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"Edit course",children:e.jsx(Ce,{size:16,className:"text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>v(x.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete course",children:e.jsx(K,{size:16,className:"text-red-600 dark:text-red-400"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{size:14}),e.jsxs("span",{children:[x.lessonCount||0," lessons"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{size:14}),e.jsxs("span",{children:[x.enrollmentCount||0," enrolled"]})]}),x.duration&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{size:14}),e.jsx("span",{children:x.duration})]})]}),x.prerequisites&&x.prerequisites.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Prerequisites:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.prerequisites.map((y,E)=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs",children:y},E))})]})]},x.id))})]})}function ms({schoolId:t,logAction:s}){const[i,h]=o.useState([]),[c,a]=o.useState(!0),[l,g]=o.useState(""),[m,r]=o.useState(!1),[n,u]=o.useState(null),[p,b]=o.useState({title:"",description:"",courses:[],badges:[],skills:[],mentorshipEnabled:!1}),[f,v]=o.useState([]);o.useEffect(()=>{t&&(S(),x())},[t]);const S=async()=>{a(!0);try{const d=M(_(N,`schools/${t}/learning_paths`),V("createdAt","desc")),P=(await z(d)).docs.map(F=>({id:F.id,...F.data()}));h(P)}catch(d){console.error("Error loading learning paths:",d)}a(!1)},x=async()=>{try{const d=M(_(N,`schools/${t}/courses`),V("title","asc")),P=(await z(d)).docs.map(F=>({id:F.id,title:F.data().title}));v(P)}catch(d){console.error("Error loading courses:",d)}},y=()=>{b({title:"",description:"",courses:[],badges:[],skills:[],mentorshipEnabled:!1}),u(null),r(!0)},E=d=>{b({title:d.title||"",description:d.description||"",courses:d.courses||[],badges:d.badges||[],skills:d.skills||[],mentorshipEnabled:d.mentorshipEnabled||!1}),u(d),r(!0)},C=async()=>{if(!p.title.trim()){alert("Path title is required.");return}a(!0);try{const d={...p,updatedAt:H()};if(n)await B(I(N,`schools/${t}/learning_paths/${n.id}`),d),s&&s("update_learning_path",{pathId:n.id,title:p.title});else{d.createdAt=H();const k=await G(_(N,`schools/${t}/learning_paths`),d);s&&s("create_learning_path",{pathId:k.id,title:p.title})}r(!1),u(null),S()}catch(d){console.error("Error saving learning path:",d),alert("Failed to save learning path.")}a(!1)},j=async d=>{if(confirm("Are you sure you want to delete this learning path?"))try{await Y(I(N,`schools/${t}/learning_paths/${d}`)),s&&s("delete_learning_path",{pathId:d}),S()}catch(k){console.error("Error deleting learning path:",k),alert("Failed to delete learning path.")}},w=d=>{b(k=>({...k,courses:k.courses.includes(d)?k.courses.filter(P=>P!==d):[...k.courses,d]}))},A=()=>{const d=prompt("Enter badge name:");d&&!p.badges.includes(d)&&b(k=>({...k,badges:[...k.badges,d]}))},R=d=>{b(k=>({...k,badges:k.badges.filter(P=>P!==d)}))},$=()=>{const d=prompt("Enter skill name:");d&&!p.skills.includes(d)&&b(k=>({...k,skills:[...k.skills,d]}))},T=d=>{b(k=>({...k,skills:k.skills.filter(P=>P!==d)}))},U=i.filter(d=>{var k,P;return((k=d.title)==null?void 0:k.toLowerCase().includes(l.toLowerCase()))||((P=d.description)==null?void 0:P.toLowerCase().includes(l.toLowerCase()))});return m?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:n?"Edit Learning Path":"Create Learning Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(!1),u(null)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsx("button",{onClick:C,disabled:c,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50",children:c?"Saving...":"Save Path"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Path Title *"}),e.jsx("input",{type:"text",value:p.title,onChange:d=>b({...p,title:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"e.g., Advanced Music Production Track"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:p.description,onChange:d=>b({...p,description:d.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-700 dark:text-white",placeholder:"Learning path description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Courses"}),e.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-3",children:[f.map(d=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:p.courses.includes(d.id),onChange:()=>w(d.id),className:"rounded"}),e.jsx("span",{className:"dark:text-white",children:d.title})]},d.id)),f.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No courses available. Create courses first."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Badges"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:p.badges.map((d,k)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded-full text-sm",children:[e.jsx(re,{size:14}),d,e.jsx("button",{onClick:()=>R(d),className:"hover:text-yellow-900 dark:hover:text-yellow-100",children:e.jsx(oe,{size:14})})]},k))}),e.jsx("button",{onClick:A,className:"text-sm text-indigo-600 dark:text-indigo-400 hover:underline",children:"+ Add Badge"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:p.skills.map((d,k)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-sm",children:[e.jsx(Je,{size:14}),d,e.jsx("button",{onClick:()=>T(d),className:"hover:text-blue-900 dark:hover:text-blue-100",children:e.jsx(oe,{size:14})})]},k))}),e.jsx("button",{onClick:$,className:"text-sm text-indigo-600 dark:text-indigo-400 hover:underline",children:"+ Add Skill"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"mentorship",checked:p.mentorshipEnabled,onChange:d=>b({...p,mentorshipEnabled:d.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"mentorship",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enable Mentorship Matching"})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(ie,{size:24}),"Learning Paths"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Create structured learning programs with courses, badges, and mentorship"})]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition",children:[e.jsx(X,{size:18}),"New Path"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search learning paths...",value:l,onChange:d=>g(d.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:bg-gray-800 dark:text-white"})]}),c?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading learning paths..."})]}):U.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx(ie,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:l?"No paths found matching your search.":"No learning paths yet. Create your first path!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:U.map(d=>{var k;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-1",children:d.title||"Untitled Path"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:d.description||"No description"})]}),e.jsxs("div",{className:"flex gap-2 ml-2",children:[e.jsx("button",{onClick:()=>E(d),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",title:"Edit path",children:e.jsx(Ce,{size:16,className:"text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>j(d.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete path",children:e.jsx(K,{size:16,className:"text-red-600 dark:text-red-400"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(ae,{size:14}),e.jsxs("span",{children:[((k=d.courses)==null?void 0:k.length)||0," courses"]})]}),d.badges&&d.badges.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(re,{size:14}),e.jsxs("span",{children:[d.badges.length," badges"]})]}),d.mentorshipEnabled&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-600 dark:text-indigo-400",children:[e.jsx(pe,{size:14}),e.jsx("span",{children:"Mentorship Enabled"})]})]})]},d.id)})})]})}function hs({schoolId:t,logAction:s}){const[i,h]=o.useState([]),[c,a]=o.useState([]),[l,g]=o.useState(!0),[m,r]=o.useState(""),[n,u]=o.useState("");o.useEffect(()=>{(async()=>{g(!0);try{const f=await z(_(N,`schools/${t}/staff`));h(f.docs.map(S=>({id:S.id,...S.data()})));const v=await z(_(N,`schools/${t}/roles`));a(v.docs.map(S=>({id:S.id,...S.data()})))}catch(f){console.error("Staff load failed:",f)}g(!1)})()},[t]);const p=async()=>{if(!m||!n)return alert("Email and Role are required.");try{const b=M(Pt(N,"public_profile"),q("email","==",m)),f=await z(b);if(f.empty)return alert("User not found. They must sign up for SeshNx first.");const v=f.docs[0],S=v.data(),x=v.ref.parent.parent.id,y=c.find(j=>j.id===n),E={uid:x,email:S.email,name:`${S.firstName} ${S.lastName}`,roleId:n,roleName:(y==null?void 0:y.name)||"Unknown",addedAt:H()};await G(_(N,`schools/${t}/staff`),E);const C=xe(x).userProfile;await B(I(N,C),{schoolId:t,accountTypes:st("EDUStaff")}),h(j=>[...j,E]),r(""),alert(`${S.firstName} added as ${y==null?void 0:y.name}.`),await s("Add Staff",`Added ${S.email} as ${y==null?void 0:y.name}`)}catch(b){console.error("Add staff error:",b),alert("Failed to add staff member. Check console.")}};return l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Staff..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ye,{size:18,className:"text-indigo-600"})," Add New Staff Member"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ke,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"User Email Address",value:m,onChange:b=>r(b.target.value)})]}),e.jsxs("div",{className:"relative min-w-[200px]",children:[e.jsx(be,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsxs("select",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white appearance-none",value:n,onChange:b=>u(b.target.value),children:[e.jsx("option",{value:"",children:"Select Role..."}),c.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]})]}),e.jsx("button",{onClick:p,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 transition shadow-md",children:"Add Staff"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["* The user must already have a SeshNx account. This will grant them ",e.jsx("strong",{children:"EDUStaff"})," access to this school."]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("span",{className:"font-bold text-sm dark:text-gray-200",children:"Authorized Personnel"}),e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded-full font-bold",children:[i.length," Active"]})]}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:i.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No staff members found."}):i.map(b=>e.jsxs("div",{className:"p-4 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-sm",children:b.name?b.name.charAt(0):"?"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold dark:text-white text-sm",children:b.name}),e.jsx("div",{className:"text-xs text-gray-500",children:b.email})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs font-bold border dark:border-gray-600",children:b.roleName})})]},b.id))})]})]})}function ps({schoolId:t,logAction:s}){const[i,h]=o.useState([]),[c,a]=o.useState(!0),[l,g]=o.useState(!1),[m,r]=o.useState({name:"",color:"#3b82f6",permissions:[]}),[n,u]=o.useState(!1);o.useEffect(()=>{t&&(async()=>{a(!0);try{const y=await z(_(N,`schools/${t}/roles`));h(y.docs.map(E=>({id:E.id,...E.data()})))}catch(y){console.error("Error loading roles:",y)}a(!1)})()},[t]);const p=async()=>{if(m.name){u(!0);try{const x=await G(_(N,`schools/${t}/roles`),m);h(y=>[...y,{id:x.id,...m}]),await s("Create Role",`Created role: ${m.name}`),r({name:"",color:"#3b82f6",permissions:[]}),g(!1)}catch(x){console.error("Create role failed:",x),alert("Failed to create role.")}u(!1)}},b=async(x,y)=>{if(confirm(`Delete role "${y}"? Staff assigned to this role will lose their permissions.`))try{await Y(I(N,`schools/${t}/roles/${x}`)),h(E=>E.filter(C=>C.id!==x)),await s("Delete Role",`Deleted role: ${y}`)}catch(E){console.error("Delete role failed:",E)}},f=async(x,y)=>{h(E=>E.map(C=>C.id===x?{...C,permissions:y}:C));try{await B(I(N,`schools/${t}/roles/${x}`),{permissions:y})}catch(E){console.error("Update perms failed:",E)}},v=x=>{r(y=>({...y,permissions:y.permissions.includes(x)?y.permissions.filter(E=>E!==x):[...y.permissions,x]}))},S=(x,y)=>{const E=x.permissions||[],C=E.includes(y)?E.filter(j=>j!==y):[...E,y];f(x.id,C)};return c?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roles..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("button",{onClick:()=>g(!0),className:"w-full py-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-500 font-bold hover:bg-gray-50 dark:hover:bg-white/5 transition flex items-center justify-center gap-2",children:[e.jsx(X,{size:20})," Create New Role"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(x=>{var y;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-start bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:x.color}}),x.name]}),e.jsxs("span",{className:"text-[10px] text-gray-400 uppercase tracking-wider font-bold",children:[((y=x.permissions)==null?void 0:y.length)||0," Permissions"]})]}),e.jsx("button",{onClick:()=>b(x.id,x.name),className:"text-gray-400 hover:text-red-500 transition p-1",title:"Delete Role",children:e.jsx(K,{size:16})})]}),e.jsx("div",{className:"p-2 flex-1 overflow-y-auto max-h-[300px] custom-scrollbar",children:e.jsx("div",{className:"space-y-0.5",children:we.map(E=>{var j;const C=(j=x.permissions)==null?void 0:j.includes(E.id);return e.jsxs("label",{className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition ${C?"bg-indigo-50 dark:bg-indigo-900/20":"hover:bg-gray-50 dark:hover:bg-white/5"}`,children:[e.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center ${C?"bg-indigo-600 border-indigo-600":"border-gray-400"}`,children:C&&e.jsx(mt,{size:10,className:"text-white",strokeWidth:4})}),e.jsx("input",{type:"checkbox",className:"hidden",checked:C,onChange:()=>S(x,E.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-xs font-bold ${C?"text-indigo-700 dark:text-indigo-300":"text-gray-600 dark:text-gray-400"}`,children:E.label}),e.jsx("div",{className:"text-[10px] text-gray-400 leading-tight",children:E.description})]})]},E.id)})})})]},x.id)})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-xl p-6 space-y-4 max-h-[90vh] overflow-y-auto animate-in zoom-in-95 shadow-2xl",children:[e.jsxs("h3",{className:"font-bold text-xl dark:text-white flex items-center gap-2",children:[e.jsx(ht,{className:"text-indigo-600"})," Create New Role"]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Role Name"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g. Academic Advisor",value:m.name,onChange:x=>r({...m,name:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Color"}),e.jsx("div",{className:"flex items-center border rounded dark:border-gray-600 p-1 dark:bg-black/20",children:e.jsx("input",{type:"color",className:"h-8 w-8 rounded cursor-pointer border-none bg-transparent",value:m.color,onChange:x=>r({...m,color:x.target.value})})})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-3 block",children:"Assign Initial Permissions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:we.map(x=>e.jsxs("label",{className:`flex items-start gap-2 p-2 border rounded cursor-pointer transition ${m.permissions.includes(x.id)?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"checkbox",className:"mt-1",checked:m.permissions.includes(x.id),onChange:()=>v(x.id)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold dark:text-gray-200",children:x.label}),e.jsx("div",{className:"text-[10px] text-gray-500 leading-tight",children:x.description})]})]},x.id))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>g(!1),className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 rounded font-bold text-sm",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:n,className:"flex-1 bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700 disabled:opacity-50",children:n?"Saving...":"Create Role"})]})]})})]})}function bs({schoolId:t,logAction:s}){const[i,h]=o.useState([]),[c,a]=o.useState(!0),[l,g]=o.useState({resource:"",limit:4,unit:"hours/week",role:"Student"});o.useEffect(()=>{t&&(async()=>{a(!0);try{const u=await z(_(N,`schools/${t}/rules`));h(u.docs.map(p=>({id:p.id,...p.data()})))}catch(u){console.error("Error loading rules:",u)}a(!1)})()},[t]);const m=async()=>{if(!l.resource)return alert("Resource name required.");try{const u={id:(await G(_(N,`schools/${t}/rules`),l)).id,...l};h(p=>[...p,u]),await s("Add Resource Rule",`Set ${l.limit} ${l.unit} limit for ${l.resource}`),g({resource:"",limit:4,unit:"hours/week",role:"Student"})}catch(n){console.error("Add rule failed:",n)}},r=async(n,u)=>{if(confirm("Delete this rule?"))try{await Y(I(N,`schools/${t}/rules/${n}`)),h(p=>p.filter(b=>b.id!==n)),await s("Delete Rule",`Removed rule for ${u}`)}catch(p){console.error("Delete failed:",p)}};return c?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Rules..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Xe,{size:18,className:"text-indigo-600"})," Add Restriction / Quota"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Resource Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g. Studio A, SSL Room",value:l.resource,onChange:n=>g({...l,resource:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Limit"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",className:"w-20 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:l.limit,onChange:n=>g({...l,limit:n.target.value})}),e.jsxs("select",{className:"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:l.unit,onChange:n=>g({...l,unit:n.target.value}),children:[e.jsx("option",{value:"hours/week",children:"Hrs/Wk"}),e.jsx("option",{value:"hours/term",children:"Hrs/Term"}),e.jsx("option",{value:"bookings/week",children:"Bookings/Wk"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:m,className:"w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2",children:[e.jsx(X,{size:18})," Add Rule"]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Applies To Role"}),e.jsxs("select",{className:"w-full md:w-1/2 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:l.role,onChange:n=>g({...l,role:n.target.value}),children:[e.jsx("option",{value:"Student",children:"All Students"}),e.jsx("option",{value:"Senior",children:"Seniors Only"}),e.jsx("option",{value:"Junior",children:"Juniors Only"}),e.jsx("option",{value:"Probation",children:"Probationary"})]})]})]}),e.jsx("div",{className:"space-y-3",children:i.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No active restrictions. Students have default access."}):i.map(n=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 flex justify-between items-center shadow-sm hover:shadow-md transition",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg",children:n.resource}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300 mt-1",children:[e.jsxs("span",{className:"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 px-2 py-0.5 rounded text-xs font-bold border border-indigo-100 dark:border-indigo-800",children:[n.limit," ",n.unit]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{children:["Applies to: ",e.jsx("strong",{children:n.role})]})]})]}),e.jsx("button",{onClick:()=>r(n.id,n.resource),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:e.jsx(K,{size:18})})]},n.id))})]})}function ys({schoolId:t,logAction:s,user:i,userData:h}){const[c,a]=o.useState([]),[l,g]=o.useState(!0),[m,r]=o.useState(!1),[n,u]=o.useState({title:"",message:"",target:"All"});o.useEffect(()=>{t&&(async()=>{g(!0);try{const v=M(_(N,`schools/${t}/announcements`),V("createdAt","desc")),S=await z(v);a(S.docs.map(x=>({id:x.id,...x.data()})))}catch(v){console.error("Error loading announcements:",v)}g(!1)})()},[t]);const p=async()=>{if(!n.title.trim()||!n.message.trim())return alert("Title and Message required.");r(!0);try{const f={...n,schoolId:t,authorId:i.uid,authorName:h.displayName||"School Admin",authorRole:h.activeProfileRole||"Admin",createdAt:H()},v=await G(_(N,`schools/${t}/announcements`),f);a(S=>[{id:v.id,...f,createdAt:new Date},...S]),await s("Post Announcement",`Posted: ${n.title}`),u({title:"",message:"",target:"All"})}catch(f){console.error("Post failed:",f),alert("Failed to post announcement.")}r(!1)},b=async f=>{if(confirm("Delete this announcement?"))try{await Y(I(N,`schools/${t}/announcements/${f}`)),a(v=>v.filter(S=>S.id!==f)),await s("Delete Announcement","Removed a post")}catch(v){console.error("Delete failed:",v)}};return l?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading News..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(pt,{size:18,className:"text-indigo-600"})," Post New Announcement"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"Headline / Title",value:n.title,onChange:f=>u({...n,title:f.target.value})})}),e.jsx("div",{className:"sm:w-1/4",children:e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white cursor-pointer",value:n.target,onChange:f=>u({...n,target:f.target.value}),children:[e.jsx("option",{value:"All",children:"Everyone"}),e.jsx("option",{value:"Student",children:"Students Only"}),e.jsx("option",{value:"EDUStaff",children:"Staff Only"})]})})]}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Write your message here...",value:n.message,onChange:f=>u({...n,message:f.target.value})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:p,disabled:m||!n.title,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition",children:m?"Posting...":e.jsxs(e.Fragment,{children:[e.jsx(bt,{size:16})," Post Announcement"]})})})]})]}),e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsx("div",{className:"text-center text-gray-500 py-10 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No announcements yet."}):c.map(f=>{var v;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm relative group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold dark:text-white",children:f.title}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ze,{size:12})," ",f.authorName]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[f.target==="All"?e.jsx(pe,{size:12}):e.jsx(be,{size:12}),f.target]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:(v=f.createdAt)!=null&&v.toDate?f.createdAt.toDate().toLocaleDateString():"Just now"})]})]}),e.jsx("button",{onClick:()=>b(f.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition opacity-0 group-hover:opacity-100",title:"Delete Post",children:e.jsx(K,{size:16})})]}),e.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed bg-gray-50 dark:bg-black/20 p-3 rounded-lg",children:f.message})]},f.id)})})]})}function fs({schoolId:t,logAction:s}){const[i,h]=o.useState([]),[c,a]=o.useState(!0),[l,g]=o.useState({name:"",address:"",website:"",contactEmail:""});o.useEffect(()=>{t&&(async()=>{a(!0);try{const u=M(_(N,`schools/${t}/partners`),V("name")),p=await z(u);h(p.docs.map(b=>({id:b.id,...b.data()})))}catch(u){console.error("Error loading partners:",u)}a(!1)})()},[t]);const m=async()=>{if(!l.name)return alert("Partner Name is required.");try{const n={...l,status:"Approved"},u=await G(_(N,`schools/${t}/partners`),n);h(p=>[...p,{id:u.id,...n}]),await s("Add Partner",`Added studio: ${l.name}`),g({name:"",address:"",website:"",contactEmail:""})}catch(n){console.error("Add partner failed:",n),alert("Failed to add partner.")}},r=async(n,u)=>{if(confirm(`Remove ${u} from approved partners?`))try{await Y(I(N,`schools/${t}/partners/${n}`)),h(p=>p.filter(b=>b.id!==n)),await s("Remove Partner",`Removed: ${u}`)}catch(p){console.error("Delete failed:",p)}};return c?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Partners..."}):e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Se,{size:18,className:"text-indigo-600"})," Add Approved Partner"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Studio / Company Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-bold",placeholder:"e.g. Sound City Studios",value:l.name,onChange:n=>g({...l,name:n.target.value})})]}),e.jsx("div",{children:e.jsx(Qt,{label:"Address",value:l.address,onChange:n=>g({...l,address:n}),onSelect:n=>{g({...l,address:n.formattedAddress||n.displayName})},placeholder:"123 Main St...",showGeolocation:!1})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Contact Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{size:14,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-9 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"manager@studio.com",value:l.contactEmail,onChange:n=>g({...l,contactEmail:n.target.value})})]})]})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsxs("button",{onClick:m,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 flex items-center gap-2 shadow-md transition",children:[e.jsx(X,{size:18})," Add Partner"]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.length===0?e.jsx("div",{className:"col-span-full text-center py-10 text-gray-500 border-2 border-dashed dark:border-gray-700 rounded-xl",children:"No partners added yet."}):i.map(n=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition group relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-bold dark:text-white text-lg truncate pr-8",children:n.name}),e.jsx("button",{onClick:()=>r(n.id,n.name),className:"text-gray-400 hover:text-red-500 absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition",children:e.jsx(K,{size:16})})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-300",children:[n.address&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(J,{size:14,className:"mt-0.5 text-indigo-500 shrink-0"}),e.jsx("span",{className:"truncate",children:n.address})]}),n.contactEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{size:14,className:"text-green-500 shrink-0"}),e.jsx("a",{href:`mailto:${n.contactEmail}`,className:"hover:underline truncate",children:n.contactEmail})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t dark:border-gray-700 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase text-green-600 bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded border border-green-200 dark:border-green-800",children:"Approved"}),n.website&&e.jsx("a",{href:n.website,target:"_blank",rel:"noreferrer",className:"text-gray-400 hover:text-indigo-500",children:e.jsx(yt,{size:14})})]})]},n.id))})]})}function js({schoolId:t,logAction:s,graderName:i}){const[h,c]=o.useState([]),[a,l]=o.useState(!0),[g,m]=o.useState(""),[r,n]=o.useState(null),[u,p]=o.useState([]),[b,f]=o.useState(!1),[v,S]=o.useState(!1),[x,y]=o.useState({technical:5,softSkills:5,notes:""});o.useEffect(()=>{t&&(async()=>{l(!0);try{const A=M(_(N,`schools/${t}/students`),V("displayName")),R=await z(A);c(R.docs.map($=>({id:$.id,...$.data()})))}catch(A){console.error("Error loading students:",A)}l(!1)})()},[t]),o.useEffect(()=>{if(!r)return;(async()=>{f(!0);try{const A=M(_(N,`schools/${t}/students/${r.id}/evaluations`),V("date","desc")),R=await z(A);p(R.docs.map($=>({id:$.id,...$.data()})))}catch(A){console.error("Error loading history:",A)}f(!1)})(),S(!1),y({technical:5,softSkills:5,notes:""})},[r,t]);const E=async()=>{if(r)try{const w={...x,evaluator:i||"EDUStaff",date:H()},A=await G(_(N,`schools/${t}/students/${r.id}/evaluations`),w);p(R=>[{id:A.id,...w,date:new Date},...R]),await s("Grade Student",`Graded ${r.displayName}: Tech(${x.technical}) Soft(${x.softSkills})`),S(!1),alert("Evaluation submitted successfully.")}catch(w){console.error("Grading failed:",w),alert("Failed to save evaluation.")}},C=h.filter(w=>{var A,R;return((A=w.displayName)==null?void 0:A.toLowerCase().includes(g.toLowerCase()))||((R=w.studentId)==null?void 0:R.toLowerCase().includes(g.toLowerCase()))}),j=w=>w>=8?"text-green-500":w>=5?"text-yellow-500":"text-red-500";return a?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Roster..."}):e.jsxs("div",{className:"flex flex-col md:flex-row h-[600px] border dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-[#2c2e36] animate-in fade-in shadow-sm",children:[e.jsxs("div",{className:"w-full md:w-1/3 border-r dark:border-gray-700 flex flex-col bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{className:"w-full pl-9 p-2 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Search Students...",value:g,onChange:w=>m(w.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:C.map(w=>e.jsxs("div",{onClick:()=>n(w),className:`p-3 px-4 cursor-pointer flex justify-between items-center transition border-b dark:border-gray-700/50 last:border-0
                                ${(r==null?void 0:r.id)===w.id?"bg-white dark:bg-[#2c2e36] border-l-4 border-l-indigo-600 shadow-sm":"hover:bg-gray-100 dark:hover:bg-gray-700"}
                            `,children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-bold text-sm ${(r==null?void 0:r.id)===w.id?"text-indigo-700 dark:text-white":"dark:text-gray-300"}`,children:w.displayName}),e.jsxs("div",{className:"text-xs text-gray-500",children:[w.cohort||"General"," • ",w.hoursLogged||0," hrs"]})]}),(r==null?void 0:r.id)===w.id&&e.jsx(ft,{size:16,className:"text-indigo-500"})]},w.id))})]}),e.jsx("div",{className:"flex-1 flex flex-col relative",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-700 dark:text-indigo-300 font-bold",children:r.displayName[0]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold dark:text-white",children:r.displayName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",r.studentId||"N/A"]})]})]}),v?e.jsxs("button",{onClick:()=>S(!1),className:"text-gray-500 hover:text-gray-700 dark:hover:text-white flex items-center gap-2 text-sm font-bold",children:[e.jsx(jt,{size:16})," View History"]}):e.jsxs("button",{onClick:()=>S(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(X,{size:16})," New Evaluation"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-white dark:bg-[#2c2e36]",children:[v&&e.jsxs("div",{className:"max-w-lg mx-auto space-y-6 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-lg border border-indigo-100 dark:border-indigo-800/50 mb-6",children:[e.jsx("h4",{className:"font-bold text-indigo-800 dark:text-indigo-300 mb-1",children:"New Assessment"}),e.jsxs("p",{className:"text-xs text-indigo-600 dark:text-indigo-400",children:["Rating performance for ",new Date().toLocaleDateString(),"."]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300",children:"Technical Proficiency"}),e.jsxs("span",{className:`font-bold ${j(x.technical)}`,children:[x.technical,"/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"1",className:"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",value:x.technical,onChange:w=>y({...x,technical:parseInt(w.target.value)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Knowledge of equipment, software, and signal flow."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300",children:"Soft Skills / Professionalism"}),e.jsxs("span",{className:`font-bold ${j(x.softSkills)}`,children:[x.softSkills,"/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"1",className:"w-full accent-indigo-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",value:x.softSkills,onChange:w=>y({...x,softSkills:parseInt(w.target.value)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Punctuality, attitude, communication, and client handling."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-bold text-sm dark:text-gray-300 block mb-2",children:"Instructor Notes"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Detailed feedback...",value:x.notes,onChange:w=>y({...x,notes:w.target.value})})]}),e.jsxs("button",{onClick:E,className:"w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(Qe,{size:18})," Submit Evaluation"]})]})]}),!v&&e.jsx("div",{className:"space-y-4",children:b?e.jsx("p",{className:"text-center text-gray-500",children:"Loading history..."}):u.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed dark:border-gray-700 rounded-xl",children:[e.jsx(ie,{size:32,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No evaluations recorded yet."}),e.jsx("button",{onClick:()=>S(!0),className:"text-indigo-500 font-bold text-sm mt-2 hover:underline",children:"Start first evaluation"})]}):u.map(w=>{var A;return e.jsxs("div",{className:"border dark:border-gray-700 rounded-xl p-4 hover:shadow-md transition bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mb-1",children:(A=w.date)!=null&&A.toDate?w.date.toDate().toLocaleDateString():"Unknown Date"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium dark:text-gray-200",children:w.evaluator})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600",children:[e.jsx("div",{className:`font-bold ${j(w.technical)}`,children:w.technical}),e.jsx("div",{className:"text-[9px] text-gray-400 uppercase",children:"Tech"})]}),e.jsxs("div",{className:"text-center px-3 py-1 bg-white dark:bg-black/20 rounded border dark:border-gray-600",children:[e.jsx("div",{className:`font-bold ${j(w.softSkills)}`,children:w.softSkills}),e.jsx("div",{className:"text-[9px] text-gray-400 uppercase",children:"Soft"})]})]})]}),w.notes&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 border-t dark:border-gray-700 pt-3 mt-2",children:['"',w.notes,'"']})]},w.id)})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(ie,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"Select a student to view history or submit grades."})]})})]})}function ks({schoolId:t,logAction:s}){const[i,h]=o.useState(""),[c,a]=o.useState(!1),l=async()=>{var u;if(!i.trim())return alert("Please paste CSV data first.");a(!0);const m=i.trim().split(`
`);let r=0,n=0;try{for(let p of m){const b=p.split(",");if(b.length>=3){const f=b[0].trim(),v=b[1].trim(),S=b[2].trim(),x=((u=b[3])==null?void 0:u.trim())||"General",y=`${v} ${S}`;f&&v?(await G(_(N,`schools/${t}/students`),{email:f,displayName:y,firstName:v,lastName:S,cohort:x,studentId:"",status:"Enrolled",hoursLogged:0,createdAt:H()}),r++):n++}else n++}await s("Batch Import",`Imported ${r} students. (${n} skipped)`),alert(`Import complete! Added ${r} students.`),h("")}catch(p){console.error("Import failed:",p),alert("Batch import encountered an error.")}a(!1)},g=async()=>{prompt("Type 'ROLLOVER' to confirm. This will archive current internship logs for all students.")==="ROLLOVER"&&(alert("Rollover process initiated. (This is a placeholder for the Cloud Function trigger)."),await s("Term Rollover","Initiated term archival"))};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(kt,{size:18,className:"text-indigo-600"})," Batch Import Students"]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-4 border border-blue-100 dark:border-blue-800 text-xs text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Format:"})," ",e.jsx("code",{children:"email, first_name, last_name, cohort"}),e.jsx("br",{}),"Example: ",e.jsx("code",{children:"student@test.edu, John, Doe, Fall 2024"})]}),e.jsx("textarea",{className:"w-full h-40 p-3 text-sm border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono resize-y focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"Paste CSV data here...",value:i,onChange:m=>h(m.target.value),disabled:c}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:l,disabled:c||!i,className:"bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition",children:c?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(et,{size:16})," Import Students"]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Nt,{size:18,className:"text-orange-500"})," Term Management"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-sm dark:text-gray-200 mb-1",children:"End of Term Rollover"}),e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Use this tool at the end of a semester or cohort period. It will:"}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 mt-2 space-y-1 ml-1",children:[e.jsx("li",{children:"Archive all active internship logs."}),e.jsx("li",{children:'Reset "Current Hours" counters (preserving Total Lifetime Hours).'}),e.jsx("li",{children:'Mark graduating students as "Alumni" (optional).'})]})]}),e.jsx("div",{className:"w-full md:w-auto",children:e.jsxs("button",{onClick:g,className:"w-full md:w-auto bg-red-50 hover:bg-red-100 dark:bg-red-900/20 dark:hover:bg-red-900/40 text-red-600 dark:text-red-400 px-4 py-3 rounded-lg font-bold text-xs flex items-center justify-center gap-2 border border-red-200 dark:border-red-800 transition",children:[e.jsx(vt,{size:16})," Execute Rollover"]})})]})]})]})}function Ns({schoolId:t}){const[s,i]=o.useState([]),[h,c]=o.useState(!0),[a,l]=o.useState(50);o.useEffect(()=>{t&&(async()=>{c(!0);try{const r=M(_(N,`schools/${t}/audit_logs`),V("timestamp","desc"),Ae(a)),n=await z(r);i(n.docs.map(u=>({id:u.id,...u.data()})))}catch(r){console.error("Error loading audit logs:",r)}c(!1)})()},[t,a]);const g=m=>m.includes("Delete")||m.includes("Remove")?"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400":m.includes("Create")||m.includes("Add")?"text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400":m.includes("Update")||m.includes("Edit")?"text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 bg-gray-100 dark:bg-gray-700 dark:text-gray-300";return h&&s.length===0?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Audit Trail..."}):e.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(Ve,{size:16}),e.jsxs("span",{children:["Showing last ",e.jsx("strong",{children:s.length})," actions"]})]}),e.jsxs("button",{onClick:()=>_e(s,"audit_logs"),className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1f2128] border dark:border-gray-600 rounded-md text-xs font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(et,{size:14})," Export Log"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Timestamp"}),e.jsx("th",{className:"p-3",children:"Admin / Staff"}),e.jsx("th",{className:"p-3",children:"Action Type"}),e.jsx("th",{className:"p-3",children:"Details"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-gray-700",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-gray-500",children:"No audit history found."})}):s.map(m=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-gray-500 whitespace-nowrap flex items-center gap-2",children:[e.jsx(de,{size:14,className:"opacity-50"}),(r=m.timestamp)!=null&&r.toDate?m.timestamp.toDate().toLocaleString():"N/A"]}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{size:14,className:"text-indigo-500"}),m.adminName||"System"]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider ${g(m.action)}`,children:m.action})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-300 font-mono text-xs",children:m.details})]},m.id)})})]})}),s.length>=a&&e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{onClick:()=>l(m=>m+50),className:"text-xs font-bold text-indigo-600 hover:underline",children:"Load Older Logs"})})]})}function vs({schoolId:t,initialData:s,logAction:i,refreshMeta:h}){const[c,a]=o.useState(s||{}),{uploadImage:l,uploading:g}=Xt();o.useEffect(()=>{s&&a(s)},[s]);const m=async()=>{try{await B(I(N,"schools",t),c),alert("School settings updated successfully."),h&&h(c),await i("Update Settings","Updated school configuration")}catch(u){console.error("Update failed:",u),alert("Failed to update school settings.")}},r=async u=>{const p=u.target.files[0];if(!(!p||!t))try{const b=await l(p,`schools/${t}/images/logo`);b&&(await B(I(N,"schools",t),{logoURL:b}),a(f=>({...f,logoURL:b})),h&&h({...c,logoURL:b}),await i("Update Logo","Uploaded new school logo"))}catch(b){console.error("Logo upload failed",b),alert("Failed to upload logo.")}},n=u=>{a(p=>({...p,[u]:!p[u]}))};return!c.name&&!s?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading Settings..."}):e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("section",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"h-32 w-32 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300 dark:border-gray-600",children:[c.logoURL?e.jsx("img",{src:c.logoURL,className:"h-full w-full object-contain",alt:"Logo"}):e.jsx(se,{size:40,className:"text-gray-400"}),g&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white text-xs",children:"Uploading..."})]}),e.jsxs("label",{className:"absolute bottom-2 right-2 bg-indigo-600 p-2 rounded-full text-white cursor-pointer shadow-lg hover:bg-indigo-700 transition",children:[e.jsx(wt,{size:14}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:r,disabled:g})]})]}),e.jsxs("div",{className:"flex-1 w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"School Name"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:c.name||"",onChange:u=>a({...c,name:u.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Primary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",className:"h-10 w-10 p-0 border-0 rounded cursor-pointer",value:c.primaryColor||"#4f46e5",onChange:u=>a({...c,primaryColor:u.target.value})}),e.jsx("input",{className:"flex-1 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white font-mono",value:c.primaryColor||"",onChange:u=>a({...c,primaryColor:u.target.value})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:c.address||"",onChange:u=>a({...c,address:u.target.value})})]})]})]})]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Website"}),e.jsxs("div",{className:"relative",children:[e.jsx(We,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:c.website||"",onChange:u=>a({...c,website:u.target.value}),placeholder:"https://"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Contact Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:c.contactEmail||"",onChange:u=>a({...c,contactEmail:u.target.value}),placeholder:"admin@school.edu"})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2",children:[e.jsx(ie,{size:18,className:"text-indigo-600"})," Academic Structure"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Cohort Mode"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:c.cohortMode||"Semester",onChange:u=>a({...c,cohortMode:u.target.value}),children:[e.jsx("option",{value:"Semester",children:"Semester Based"}),e.jsx("option",{value:"Trimester",children:"Trimester"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Rolling",children:"Rolling"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Grading Scale"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:c.gradingScale||"1-10",onChange:u=>a({...c,gradingScale:u.target.value}),children:[e.jsx("option",{value:"1-10",children:"Numeric (1-10)"}),e.jsx("option",{value:"Pass/Fail",children:"Pass/Fail"}),e.jsx("option",{value:"Letter",children:"Letter Grades"})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white border-b dark:border-gray-700 pb-2 mb-4 flex items-center gap-2",children:[e.jsx(St,{size:18,className:"text-indigo-600"})," Operational Rules"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Strict Geofencing"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Require GPS location match for clock-in"})]}),e.jsx("button",{onClick:()=>n("geofencing"),children:c.geofencing?e.jsx(Fe,{size:24,className:"text-indigo-600"}):e.jsx(Oe,{size:24,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm dark:text-white",children:"Supervisor Approval"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Require partner studio sign-off on hours"})]}),e.jsx("button",{onClick:()=>n("requireApproval"),children:c.requireApproval?e.jsx(Fe,{size:24,className:"text-indigo-600"}):e.jsx(Oe,{size:24,className:"text-gray-400"})})]})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:e.jsxs("button",{onClick:m,className:"w-full sm:w-auto bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-indigo-700 flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(Qe,{size:18})," Save Configuration"]})})]})}function ws({user:t,userData:s,allowedTabs:i,staffTitle:h,currentView:c}){let a;try{a=fe()}catch{a=null}const l=(a==null?void 0:a.user)||t,g=(a==null?void 0:a.userData)||s,{schoolId:m}=ye(),r=c?c.replace("edu-",""):i?i[0]:"overview",[n,u]=o.useState(m||null),[p,b]=o.useState(null),[f,v]=o.useState([]),[S,x]=o.useState(!1),[y,E]=o.useState({name:"",address:"",primaryColor:"#4f46e5"}),C=is(g);o.useEffect(()=>{C&&(async()=>{try{const $=(await z(_(N,"schools"))).docs.map(T=>({id:T.id,...T.data()}));v($),!n&&!m&&$.length>0&&u($[0].id)}catch(R){console.error("Error fetching schools list:",R)}})()},[C,n]),o.useEffect(()=>{if(!n)return;(async()=>{try{const R=M(_(N,"schools"),q("__name__","==",n)),$=await z(R);$.empty||b($.docs[0].data())}catch(R){console.error("Error loading school meta:",R)}})()},[n]);const j=async(A,R)=>{if(n)try{await G(_(N,`schools/${n}/audit_logs`),{action:A,details:R,adminId:l.uid,adminName:`${g.firstName} ${g.lastName}`,timestamp:H()})}catch($){console.error("Failed to log action:",$)}},w=async()=>{if(y.name){if(!C){alert("Only SeshNx Platform Administrators can create new schools. Please contact a platform administrator."),x(!1);return}try{const A=await G(_(N,"schools"),{...y,createdAt:H(),requiredHours:100});await G(_(N,`schools/${A.id}/roles`),{name:"Admin",color:"#dc2626",permissions:we.map(R=>R.id)}),v(R=>[...R,{id:A.id,...y}]),u(A.id),x(!1),E({name:"",address:"",primaryColor:"#4f46e5"})}catch(A){console.error("Error creating school:",A),A.code==="permission-denied"?alert("Permission denied. Only SeshNx Platform Administrators can create new schools."):alert("Failed to create school. Please try again.")}}};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6 relative overflow-hidden",children:[e.jsx("div",{className:"h-24 w-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-2 z-10",children:p!=null&&p.logoURL?e.jsx("img",{src:p.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(se,{size:40,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left z-10",children:[e.jsxs("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight flex items-center justify-center md:justify-start gap-3",children:[(p==null?void 0:p.name)||"Select School",C&&!h&&e.jsxs("div",{className:"relative group",children:[e.jsx("select",{className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",value:n||"",onChange:A=>u(A.target.value),children:f.map(A=>e.jsx("option",{value:A.id,children:A.name},A.id))}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 border-none rounded-lg text-sm font-bold p-1 px-2 flex items-center gap-1 pointer-events-none group-hover:bg-gray-200 dark:group-hover:bg-gray-600 transition",children:[e.jsx("span",{children:"Switch"})," ",e.jsx(be,{size:10})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400 mt-1",children:[h?e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:[h," Dashboard"]}):e.jsx("span",{className:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Global Admin Mode"}),(p==null?void 0:p.address)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{size:12})," ",p.address]})]})]})]}),C&&e.jsx("div",{className:"z-10",children:e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 transition shadow-md",children:[e.jsx(X,{size:16})," New School"]})}),e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-indigo-600/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"})]}),e.jsx("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 min-h-[400px] p-4",children:n?e.jsxs(e.Fragment,{children:[r==="overview"&&e.jsx(ns,{schoolId:n,schoolData:p}),r==="roster"&&e.jsx(ls,{schoolId:n,logAction:j}),r==="hours"&&e.jsx(cs,{schoolId:n}),r==="courses"&&e.jsx(xs,{schoolId:n,logAction:j}),r==="learning-paths"&&e.jsx(ms,{schoolId:n,logAction:j}),r==="instructors"&&e.jsx(hs,{schoolId:n,logAction:j}),r==="roles"&&e.jsx(ps,{schoolId:n,logAction:j}),r==="resources"&&e.jsx(bs,{schoolId:n,logAction:j}),r==="news"&&e.jsx(ys,{schoolId:n,logAction:j,user:l,userData:g}),r==="partners"&&e.jsx(fs,{schoolId:n,logAction:j}),r==="evaluations"&&e.jsx(js,{schoolId:n,logAction:j,graderName:g.displayName}),r==="cohorts"&&e.jsx(ks,{schoolId:n,logAction:j}),r==="audit"&&e.jsx(Ns,{schoolId:n}),r==="settings"&&e.jsx(vs,{schoolId:n,initialData:p,logAction:j,refreshMeta:A=>b(R=>({...R,...A}))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-gray-500",children:[e.jsx(se,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"Please select or create a school to manage."})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-md rounded-xl p-6 space-y-4 animate-in zoom-in-95",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Create School"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"School Name",value:y.name,onChange:A=>E({...y,name:A.target.value})}),e.jsx("button",{onClick:w,className:"w-full bg-indigo-600 text-white py-2 rounded font-bold hover:bg-indigo-700",children:"Create"}),e.jsx("button",{onClick:()=>x(!1),className:"w-full text-gray-500 text-sm hover:underline",children:"Cancel"})]})})]})}function Zs({user:t,userData:s,currentView:i}){let h;try{h=fe()}catch{h=null}const c=(h==null?void 0:h.user)||t,a=(h==null?void 0:h.userData)||s,{myPermissions:l,staffProfile:g}=ye(),m={manage_roster:"roster",manage_enrollment:"cohorts",approve_hours:"hours",manage_partners:"partners",grade_students:"evaluations",post_announcements:"news",manage_resources:"resources",manage_staff:"instructors",view_audit:"audit",edit_settings:"settings"},r=l.includes("ALL")?Object.values(m):l.map(n=>m[n]).filter(Boolean);return r.length===0&&!l.includes("ALL")?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-gray-500",children:[e.jsx(Xe,{size:48,className:"mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-bold",children:"Access Restricted"}),e.jsx("p",{children:"You are listed as staff but have no assigned permissions."})]}):e.jsx(ws,{user:c,userData:a,allowedTabs:r,staffTitle:g==null?void 0:g.roleName,currentView:i})}function Qs({user:t,userData:s}){let i;try{i=fe()}catch{i=null}const h=(i==null?void 0:i.user)||t,c=(i==null?void 0:i.userData)||s,{schoolData:a,studentProfile:l,internshipStudio:g,checkIn:m,checkOut:r}=ye(),[n,u]=o.useState(""),[p,b]=o.useState(!1),[f,v]=o.useState([]),[S,x]=o.useState([]),[y,E]=o.useState([]),C=c==null?void 0:c.schoolId;o.useEffect(()=>{C&&(h!=null&&h.uid)&&(j(),w(),A())},[C,h==null?void 0:h.uid]);const j=async()=>{try{const T=M(_(N,`schools/${C}/enrollments`),q("studentId","==",h.uid)),U=await z(T);v(U.docs.map(d=>({id:d.id,...d.data()})))}catch(T){console.error("Error loading enrollments:",T)}},w=async()=>{try{const T=M(_(N,`schools/${C}/badges`),q("studentId","==",h.uid)),U=await z(T);x(U.docs.map(d=>({id:d.id,...d.data()})))}catch(T){console.error("Error loading badges:",T)}},A=async()=>{l!=null&&l.milestones&&E(l.milestones)},R=async()=>{b(!0);try{l!=null&&l.isClockedIn?(await r(n),u("")):await m((g==null?void 0:g.name)||"Remote Internship","studio")}catch(T){console.error(T)}b(!1)};if(!l)return e.jsx("div",{className:"p-8 text-center",children:"Loading student profile..."});const $=Math.min(100,(l.hoursLogged||0)/((a==null?void 0:a.requiredHours)||100)*100);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"h-20 w-20 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-gray-200 dark:border-gray-600 shrink-0 p-1",children:a!=null&&a.logoURL?e.jsx("img",{src:a.logoURL,className:"h-full w-full object-contain",alt:"School Logo"}):e.jsx(se,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-extrabold dark:text-white tracking-tight mb-1",children:(a==null?void 0:a.name)||"Internship Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 text-sm font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide",children:"Active Intern"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Cohort: ",l.cohort]})]})]}),e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("div",{className:"text-3xl font-black dark:text-white text-indigo-600",children:l.hoursLogged||0}),e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider",children:"Total Hours"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-gradient-to-br from-indigo-900 to-slate-900 text-white p-8 rounded-2xl relative overflow-hidden shadow-lg border border-indigo-800/50",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-xs font-bold uppercase tracking-widest opacity-60 mb-2",children:"Assigned Studio Location"}),e.jsx("h2",{className:"text-3xl font-extrabold mb-4 tracking-tight",children:(g==null?void 0:g.name)||"Pending Assignment"}),g?e.jsxs("div",{className:"space-y-3 text-sm opacity-90",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(J,{size:18,className:"text-indigo-400"})," ",g.address||"Address not listed"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(he,{size:18,className:"text-green-400"})," Status: Active Placement"]})]}):e.jsxs("div",{className:"bg-white/10 p-4 rounded-xl flex items-start gap-3 border border-white/10",children:[e.jsx(Ct,{className:"text-yellow-400 shrink-0 mt-0.5",size:20}),e.jsx("p",{className:"text-sm leading-relaxed",children:"You haven't been assigned an internship location yet. Please contact your school coordinator to get placed."})]})]}),e.jsx("div",{className:"absolute -right-12 -bottom-12 w-64 h-64 bg-indigo-600/20 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(de,{className:l.isClockedIn?"text-green-500 animate-pulse":"text-gray-400"}),l.isClockedIn?"Currently Working":"Time Clock"]}),l.isClockedIn&&e.jsx("textarea",{className:"w-full p-3 text-sm border rounded-xl mb-4 dark:bg-black/20 dark:border-gray-600 dark:text-white resize-none focus:ring-2 focus:ring-indigo-500 outline-none",rows:"4",placeholder:"Describe your tasks for this session...",value:n,onChange:T=>u(T.target.value)})]}),e.jsx("button",{onClick:R,disabled:p||!g&&!l.isClockedIn,className:`w-full py-3.5 rounded-xl font-bold text-white transition shadow-lg transform active:scale-95 ${p?"bg-gray-400":l.isClockedIn?"bg-red-500 hover:bg-red-600 shadow-red-500/30":"bg-green-600 hover:bg-green-700 shadow-green-600/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none"}`,children:p?"Processing...":l.isClockedIn?"Clock Out":"Clock In"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"dark:text-white",children:"Completion Progress"}),e.jsxs("span",{className:"text-indigo-600",children:[Math.round($),"%"]})]}),e.jsx("div",{className:"w-full h-4 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-1000 ease-out",style:{width:`${$}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-center",children:[l.hoursLogged," / ",(a==null?void 0:a.requiredHours)||100," Hours Required"]})]}),f.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(ae,{size:20,className:"text-indigo-500"}),"Course Progress"]}),e.jsx("div",{className:"space-y-3",children:f.map(T=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"font-semibold dark:text-white",children:["Course ",T.courseId]}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[T.progress||0,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all",style:{width:`${T.progress||0}%`}})})]},T.id))})]}),y.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Je,{size:20,className:"text-purple-500"}),"Internship Milestones"]}),e.jsx("div",{className:"space-y-2",children:y.map((T,U)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[T.completed?e.jsx(he,{size:20,className:"text-green-500"}):e.jsx("div",{className:"w-5 h-5 border-2 border-gray-300 dark:border-gray-600 rounded-full"}),e.jsx("span",{className:T.completed?"text-gray-600 dark:text-gray-400 line-through":"dark:text-white",children:T.name})]},U))})]}),S.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(re,{size:20,className:"text-yellow-500"}),"Earned Badges"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:S.map(T=>e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(re,{size:32,className:"mx-auto text-yellow-500 mb-2"}),e.jsx("p",{className:"text-sm font-semibold dark:text-white",children:T.name})]},T.id))})]})]})}function ea({user:t,onComplete:s,onSkip:i}){const[h,c]=o.useState(""),[a,l]=o.useState([]),[g,m]=o.useState(null),[r,n]=o.useState(""),[u,p]=o.useState(""),[b,f]=o.useState(!1),v=async x=>{if(x.length<3){l([]);return}const y=M(_(N,"schools"),q("name",">=",x),q("name","<=",x+"")),E=await z(y);l(E.docs.map(C=>({id:C.id,...C.data()})))},S=async()=>{if(!g||!r){p("Please select a school and enter your ID.");return}p(""),f(!0);try{await B(I(N,"users",t.uid),{schoolId:g.id,studentId:r,accountTypes:["user","student"]}),s()}catch(x){console.error("Enrollment error:",x),p("Enrollment failed. Please try again.")}finally{f(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Student Enrollment"}),e.jsx("p",{className:"text-gray-500",children:"Search for your school and enter your student ID to link your account."}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search for your school...",value:h,onChange:x=>{c(x.target.value),v(x.target.value)},className:"w-full pl-10 p-2 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white"}),e.jsx(ne,{className:"absolute left-3 top-3 text-gray-400",size:16})]}),h.length>0&&a.length>0&&e.jsx("div",{className:"border rounded-lg max-h-40 overflow-y-auto dark:border-gray-700 bg-white dark:bg-gray-800",children:a.map(x=>e.jsxs("div",{className:`p-3 cursor-pointer hover:bg-indigo-50 dark:hover:bg-gray-700/50 ${(g==null?void 0:g.id)===x.id?"bg-indigo-100 dark:bg-indigo-900/50":""}`,onClick:()=>{m(x),c(x.name),l([])},children:[e.jsx("div",{className:"font-medium dark:text-white",children:x.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[x.city,", ",x.state]})]},x.id))}),g&&e.jsxs("div",{className:"space-y-4 pt-4 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("p",{className:"text-sm font-bold dark:text-white",children:["Selected: ",e.jsx("span",{className:"text-indigo-600",children:g.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Student ID Number"}),e.jsx("input",{type:"text",value:r,onChange:x=>n(x.target.value),className:"w-full p-2 border rounded-lg mt-1 dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"e.g., SESH00123"})]}),u&&e.jsx("p",{className:"text-red-500 text-sm",children:u}),e.jsx("button",{onClick:S,disabled:b||!r,className:"w-full bg-indigo-600 text-white p-2 rounded-lg font-bold hover:bg-indigo-700 transition disabled:opacity-50",children:b?"Verifying...":"Link Student Account"})]}),e.jsx("button",{onClick:i,className:"w-full text-sm text-gray-500 hover:text-indigo-600 mt-2",children:"Skip enrollment for now"})]})}function ta(){const[t,s]=o.useState(""),[i,h]=o.useState(""),[c,a]=o.useState(""),[l,g]=o.useState(!1),m=Et(),r="#4f46e5",n="SeshNx EDU";o.useEffect(()=>{const b=ke.onAuthStateChanged(async f=>{if(f)try{const v=await Q(I(N,`artifacts/${me}/users/${f.uid}/profiles/main`));if(v.exists()){const S=v.data();if(ee(S)){m("/edu");return}}}catch(v){console.error("Error checking EDU access:",v)}});return()=>b()},[m]);const u=async b=>{if(b.preventDefault(),!t||!i){a("Please fill in all fields.");return}g(!0),a("");try{const v=(await _t(ke,t,i)).user,S=await Q(I(N,`artifacts/${me}/users/${v.uid}/profiles/main`));if(!S.exists()){a("User profile not found. Please complete your profile setup first."),g(!1);return}const x=S.data();if(!ee(x)){a("You do not have EDU access. Please contact your administrator."),g(!1);return}m("/edu")}catch(f){console.error("Login error:",f),f.code==="auth/user-not-found"||f.code==="auth/wrong-password"?a("Invalid email or password."):f.code==="auth/invalid-email"?a("Invalid email address."):a("Login failed. Please try again."),g(!1)}},p=async()=>{a(""),g(!0);try{const b=new Tt;b.setCustomParameters({prompt:"select_account"});const v=(await $t(ke,b)).user,S=await Q(I(N,`artifacts/${me}/users/${v.uid}/profiles/main`));if(!S.exists()){a("User profile not found. Please complete your profile setup first."),g(!1);return}const x=S.data();if(!ee(x)){a("You do not have EDU access. Please contact your administrator."),g(!1);return}m("/edu")}catch(b){console.error("Google login error:",b),b.code==="auth/popup-closed-by-user"?a("Login cancelled."):a("Google login failed. Please try again."),g(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-4",children:e.jsx(It.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-2xl shadow-xl p-8 border dark:border-gray-700",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center",style:{backgroundColor:`${r}20`},children:e.jsx(ie,{size:32,style:{color:r}})}),e.jsxs("h1",{className:"text-2xl font-bold dark:text-white mb-2",children:[n," Login"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Sign in to access your EDU dashboard"})]}),c&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm",children:c}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:t,onChange:b=>s(b.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-offset-0 focus:outline-none dark:bg-gray-800 dark:text-white",style:{focusRingColor:r},placeholder:"your@email.com",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:i,onChange:b=>h(b.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-offset-0 focus:outline-none dark:bg-gray-800 dark:text-white",style:{focusRingColor:r},placeholder:"••••••••",disabled:l})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full py-2.5 rounded-lg font-semibold text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:r},children:l?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"animate-spin",size:18}),e.jsx("span",{children:"Signing in..."})]}):"Sign In"})]}),e.jsxs("div",{className:"my-6 flex items-center",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"px-4 text-sm text-gray-500 dark:text-gray-400",children:"or"}),e.jsx("div",{className:"flex-1 border-t border-gray-300 dark:border-gray-600"})]}),e.jsxs("button",{onClick:p,disabled:l,className:"w-full py-2.5 rounded-lg font-semibold border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{onClick:()=>m("/"),className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 flex items-center justify-center gap-2 mx-auto",children:[e.jsx(At,{size:16}),"Back to Main App"]})})]})})})}export{As as A,ta as B,Ks as C,Ne as D,Bt as E,ea as F,ue as G,Fs as H,ce as I,ee as J,Xs as K,Qs as L,Zs as M,ws as N,Vs as O,zs as P,Ts as R,Ls as S,Ms as T,Ge as V,Xt as a,_s as b,Dt as c,Mt as d,Ft as e,Ws as f,Rs as g,Ot as h,He as i,Hs as j,qs as k,Gs as l,Os as m,Bs as n,Us as o,Ys as p,Kt as q,Jt as r,Js as s,Qt as t,ye as u,Ht as v,Ds as w,Ps as x,$s as y,Is as z};
