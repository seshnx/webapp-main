{"version":3,"file":"useVercelUpload-DnObj6TS.js","sources":["../../src/hooks/useVercelUpload.js"],"sourcesContent":["/**\r\n * Vercel Blob Upload Hook\r\n *\r\n * This hook provides a drop-in replacement for useMediaUpload,\r\n * using Vercel Blob instead of Supabase Storage.\r\n *\r\n * @example\r\n * import { useVercelUpload } from '@/hooks/useVercelUpload';\r\n *\r\n * function MediaUpload() {\r\n *   const { uploadMedia, uploading, error } = useVercelUpload();\r\n *\r\n *   const handleUpload = async (file) => {\r\n *     const result = await uploadMedia(file, 'post-media');\r\n *     if (result) {\r\n *       console.log('Uploaded:', result.url);\r\n *     }\r\n *   };\r\n *\r\n *   return <input type=\"file\" onChange={(e) => handleUpload(e.target.files[0])} />;\r\n * }\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport { uploadFile, STORAGE_FOLDERS, isImageFile, isVideoFile, validateFileSize } from '../config/vercel-blob';\r\n\r\n/**\r\n * Vercel Blob Upload Hook\r\n *\r\n * Drop-in replacement for useMediaUpload that uses Vercel Blob instead of Supabase Storage.\r\n *\r\n * @param {string} defaultFolder - Default folder for uploads (e.g., 'post-media', 'profile-photos')\r\n * @returns {object} Upload functions and state\r\n */\r\nexport const useVercelUpload = (defaultFolder = 'general') => {\r\n  const [uploading, setUploading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [progress, setProgress] = useState(0);\r\n\r\n  /**\r\n   * Uploads media file to Vercel Blob Storage.\r\n   *\r\n   * @param {File} file - The file to upload\r\n   * @param {string} uploadPath - The folder/path for storage (optional, uses defaultFolder if not provided)\r\n   * @param {object} options - Additional upload options\r\n   * @returns {Promise<object|null>} Object containing media URL and metadata\r\n   *\r\n   * @example\r\n   * const result = await uploadMedia(file);\r\n   * console.log(result.url); // https://blob.../post-media/file.jpg\r\n   */\r\n  const uploadMedia = async (file, uploadPath = null, options = {}) => {\r\n    if (!file) return null;\r\n\r\n    // Validate file size (default 10MB max)\r\n    const maxSizeMB = options.maxSizeMB || 10;\r\n    if (!validateFileSize(file, maxSizeMB)) {\r\n      const errorMsg = `File size exceeds ${maxSizeMB}MB limit`;\r\n      setError(errorMsg);\r\n      console.error(errorMsg);\r\n      return null;\r\n    }\r\n\r\n    // Validate file type if specified\r\n    if (options.allowedTypes && !options.allowedTypes.includes(file.type)) {\r\n      const errorMsg = `File type not allowed. Allowed types: ${options.allowedTypes.join(', ')}`;\r\n      setError(errorMsg);\r\n      console.error(errorMsg);\r\n      return null;\r\n    }\r\n\r\n    setUploading(true);\r\n    setError(null);\r\n    setProgress(0);\r\n\r\n    try {\r\n      // Determine media type\r\n      let mediaType = 'file';\r\n      if (file.type.startsWith('video/')) {\r\n        mediaType = 'video';\r\n      } else if (file.type.startsWith('audio/')) {\r\n        mediaType = 'audio';\r\n      } else if (file.type.startsWith('image/')) {\r\n        mediaType = 'image';\r\n      }\r\n\r\n      // Sanitize filename\r\n      const timestamp = Date.now();\r\n      const sanitizedName = file.name.replace(/[^a-zA-Z0-9._-]/g, '_');\r\n\r\n      // Add random suffix for uniqueness\r\n      const randomSuffix = Math.random().toString(36).substring(2, 8);\r\n      const customFileName = `${timestamp}_${randomSuffix}_${sanitizedName}`;\r\n\r\n      // Use provided uploadPath or default to defaultFolder\r\n      const targetFolder = uploadPath || defaultFolder;\r\n\r\n      // Upload to Vercel Blob\r\n      setProgress(20); // Uploading started\r\n\r\n      const blob = await uploadFile(file, targetFolder, {\r\n        customFileName,\r\n      });\r\n\r\n      setProgress(100); // Upload complete\r\n\r\n      const result = {\r\n        url: blob.url,\r\n        previewUrl: blob.url, // Same as URL for Vercel Blob\r\n        storageRef: blob.pathname, // Path in blob storage\r\n        type: mediaType,\r\n        name: file.name,\r\n        size: file.size,\r\n        mimeType: file.type,\r\n        contentType: blob.contentType,\r\n        uploadedAt: blob.uploadedAt,\r\n        downloadUrl: blob.downloadUrl,\r\n      };\r\n\r\n      setUploading(false);\r\n      setProgress(0);\r\n\r\n      return result;\r\n    } catch (err) {\r\n      console.error('Upload failed:', err);\r\n      setError(err.message || 'An unknown error occurred during upload.');\r\n      setUploading(false);\r\n      setProgress(0);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Upload multiple files\r\n   *\r\n   * @param {FileList|File[]} files - Files to upload\r\n   * @param {string} uploadPath - The folder/path for storage (optional, uses defaultFolder if not provided)\r\n   * @param {object} options - Additional upload options\r\n   * @returns {Promise<object[]>} Array of upload results\r\n   *\r\n   * @example\r\n   * const results = await uploadMultiple(fileList);\r\n   * console.log(`Uploaded ${results.length} files`);\r\n   */\r\n  const uploadMultiple = async (files, uploadPath = null, options = {}) => {\r\n    if (!files || files.length === 0) return [];\r\n\r\n    setUploading(true);\r\n    setError(null);\r\n    setProgress(0);\r\n\r\n    try {\r\n      const fileArray = Array.from(files);\r\n      const results = [];\r\n      const totalFiles = fileArray.length;\r\n\r\n      const targetFolder = uploadPath || defaultFolder;\r\n\r\n      for (let i = 0; i < fileArray.length; i++) {\r\n        setProgress(Math.round(((i + 1) / totalFiles) * 100));\r\n        const result = await uploadMedia(fileArray[i], targetFolder, options);\r\n        if (result) {\r\n          results.push(result);\r\n        }\r\n      }\r\n\r\n      setProgress(100);\r\n      setUploading(false);\r\n      return results;\r\n    } catch (err) {\r\n      console.error('Batch upload failed:', err);\r\n      setError(err.message || 'Batch upload failed');\r\n      setUploading(false);\r\n      setProgress(0);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  return {\r\n    uploadMedia,\r\n    uploadMultiple,\r\n    uploading,\r\n    error,\r\n    progress,\r\n\r\n    // Helper methods\r\n    isUploading: uploading,\r\n    hasError: !!error,\r\n    clearError: () => setError(null),\r\n  };\r\n};\r\n\r\n/**\r\n * Image-specific upload hook\r\n *\r\n * Convenience hook for uploading images with built-in validation.\r\n *\r\n * @example\r\n * function ProfilePhotoUpload() {\r\n *   const { uploadImage, uploading, error } = useVercelImageUpload();\r\n *\r\n *   const handleUpload = async (file) => {\r\n *     const result = await uploadImage(file, 'profile-photos');\r\n *     if (result) {\r\n *       console.log('Photo uploaded:', result.url);\r\n *     }\r\n *   };\r\n *\r\n *   return <input type=\"file\" accept=\"image/*\" onChange={...} />;\r\n * }\r\n */\r\nexport const useVercelImageUpload = (options = {}) => {\r\n  const { uploadMedia, uploading, error } = useVercelUpload();\r\n\r\n  /**\r\n   * Upload an image file\r\n   *\r\n   * @param {File} file - Image file to upload\r\n   * @param {string} folder - Storage folder (default: 'profile-photos')\r\n   * @returns {Promise<object|null>} Upload result\r\n   */\r\n  const uploadImage = async (file, folder = STORAGE_FOLDERS.PROFILE_PHOTOS) => {\r\n    if (!file) return null;\r\n\r\n    // Validate it's an image\r\n    if (!isImageFile(file)) {\r\n      console.error('File is not an image');\r\n      return null;\r\n    }\r\n\r\n    // Default image options\r\n    const imageOptions = {\r\n      maxSizeMB: 5, // 5MB default for images\r\n      allowedTypes: ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],\r\n      ...options,\r\n    };\r\n\r\n    return await uploadMedia(file, folder, imageOptions);\r\n  };\r\n\r\n  return {\r\n    uploadImage,\r\n    uploading,\r\n    error,\r\n    isUploading: uploading,\r\n    hasError: !!error,\r\n  };\r\n};\r\n\r\n/**\r\n * Video-specific upload hook\r\n *\r\n * Convenience hook for uploading videos with built-in validation.\r\n *\r\n * @example\r\n * function VideoUpload() {\r\n *   const { uploadVideo, uploading, error } = useVercelVideoUpload();\r\n *\r\n *   const handleUpload = async (file) => {\r\n *     const result = await uploadVideo(file, 'post-media');\r\n *     if (result) {\r\n *       console.log('Video uploaded:', result.url);\r\n *     }\r\n *   };\r\n *\r\n *   return <input type=\"file\" accept=\"video/*\" onChange={...} />;\r\n * }\r\n */\r\nexport const useVercelVideoUpload = (options = {}) => {\r\n  const { uploadMedia, uploading, error } = useVercelUpload();\r\n\r\n  /**\r\n   * Upload a video file\r\n   *\r\n   * @param {File} file - Video file to upload\r\n   * @param {string} folder - Storage folder (default: 'post-media')\r\n   * @returns {Promise<object|null>} Upload result\r\n   */\r\n  const uploadVideo = async (file, folder = STORAGE_FOLDERS.POST_MEDIA) => {\r\n    if (!file) return null;\r\n\r\n    // Validate it's a video\r\n    if (!isVideoFile(file)) {\r\n      console.error('File is not a video');\r\n      return null;\r\n    }\r\n\r\n    // Default video options\r\n    const videoOptions = {\r\n      maxSizeMB: 50, // 50MB default for videos\r\n      allowedTypes: ['video/mp4', 'video/webm', 'video/quicktime'],\r\n      ...options,\r\n    };\r\n\r\n    return await uploadMedia(file, folder, videoOptions);\r\n  };\r\n\r\n  return {\r\n    uploadVideo,\r\n    uploading,\r\n    error,\r\n    isUploading: uploading,\r\n    hasError: !!error,\r\n  };\r\n};\r\n\r\n/**\r\n * Document-specific upload hook\r\n *\r\n * Convenience hook for uploading documents with built-in validation.\r\n *\r\n * @example\r\n * function DocumentUpload() {\r\n *   const { uploadDocument, uploading, error } = useVercelDocumentUpload();\r\n *\r\n *   const handleUpload = async (file) => {\r\n *     const result = await uploadDocument(file, 'documents');\r\n *     if (result) {\r\n *       console.log('Document uploaded:', result.url);\r\n *     }\r\n *   };\r\n *\r\n *   return <input type=\"file\" accept=\".pdf,.doc,.docx\" onChange={...} />;\r\n * }\r\n */\r\nexport const useVercelDocumentUpload = (options = {}) => {\r\n  const { uploadMedia, uploading, error } = useVercelUpload();\r\n\r\n  /**\r\n   * Upload a document file\r\n   *\r\n   * @param {File} file - Document file to upload\r\n   * @param {string} folder - Storage folder (default: 'documents')\r\n   * @returns {Promise<object|null>} Upload result\r\n   */\r\n  const uploadDocument = async (file, folder = STORAGE_FOLDERS.DOCUMENTS) => {\r\n    if (!file) return null;\r\n\r\n    // Default document options\r\n    const documentOptions = {\r\n      maxSizeMB: 10, // 10MB default for documents\r\n      allowedTypes: [\r\n        'application/pdf',\r\n        'application/msword',\r\n        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n        'text/plain',\r\n      ],\r\n      ...options,\r\n    };\r\n\r\n    return await uploadMedia(file, folder, documentOptions);\r\n  };\r\n\r\n  return {\r\n    uploadDocument,\r\n    uploading,\r\n    error,\r\n    isUploading: uploading,\r\n    hasError: !!error,\r\n  };\r\n};\r\n\r\n/**\r\n * Batch upload hook for multiple files\r\n *\r\n * Optimized for uploading multiple files at once.\r\n *\r\n * @example\r\n * function MultiFileUpload() {\r\n *   const { uploadBatch, uploading, progress } = useVercelBatchUpload();\r\n *\r\n *   const handleUpload = async (files) => {\r\n *     const results = await uploadBatch(files, 'post-media');\r\n *     console.log(`Uploaded ${results.length} files`);\r\n *   };\r\n *\r\n *   return <input type=\"file\" multiple onChange={...} />;\r\n * }\r\n */\r\nexport const useVercelBatchUpload = () => {\r\n  const { uploadMultiple, uploading, error, progress } = useVercelUpload();\r\n\r\n  /**\r\n   * Upload multiple files\r\n   *\r\n   * @param {FileList|File[]} files - Files to upload\r\n   * @param {string} folder - Storage folder\r\n   * @param {object} options - Upload options\r\n   * @returns {Promise<object[]>} Array of upload results\r\n   */\r\n  const uploadBatch = async (files, folder = STORAGE_FOLDERS.POST_MEDIA, options = {}) => {\r\n    return await uploadMultiple(files, folder, options);\r\n  };\r\n\r\n  return {\r\n    uploadBatch,\r\n    uploading,\r\n    error,\r\n    progress,\r\n    isUploading: uploading,\r\n    hasError: !!error,\r\n  };\r\n};\r\n\r\n/**\r\n * Hook with upload preview capability\r\n *\r\n * Shows preview of images before upload completes.\r\n *\r\n * @example\r\n * function ImageUploadWithPreview() {\r\n *   const { uploadWithPreview, preview, uploading } = useVercelUploadWithPreview();\r\n *\r\n *   return (\r\n *     <div>\r\n *       {preview && <img src={preview} alt=\"Preview\" />}\r\n *       <input\r\n *         type=\"file\"\r\n *         accept=\"image/*\"\r\n *         onChange={(e) => uploadWithPreview(e.target.files[0])}\r\n *         disabled={uploading}\r\n *       />\r\n *     </div>\r\n *   );\r\n * }\r\n */\r\nexport const useVercelUploadWithPreview = () => {\r\n  const [preview, setPreview] = useState(null);\r\n  const { uploadMedia, uploading, error } = useVercelUpload();\r\n\r\n  /**\r\n   * Upload file with local preview\r\n   *\r\n   * @param {File} file - File to upload\r\n   * @param {string} folder - Storage folder\r\n   * @returns {Promise<object|null>} Upload result\r\n   */\r\n  const uploadWithPreview = async (file, folder = STORAGE_FOLDERS.POST_MEDIA) => {\r\n    if (!file) return null;\r\n\r\n    // Create local preview for images\r\n    if (isImageFile(file)) {\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setPreview(reader.result);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n\r\n    // Upload the file\r\n    const result = await uploadMedia(file, folder);\r\n\r\n    // Update preview with uploaded URL\r\n    if (result) {\r\n      setPreview(result.url);\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n  /**\r\n   * Clear the preview\r\n   */\r\n  const clearPreview = () => {\r\n    setPreview(null);\r\n  };\r\n\r\n  return {\r\n    uploadWithPreview,\r\n    preview,\r\n    uploading,\r\n    error,\r\n    clearPreview,\r\n    isUploading: uploading,\r\n    hasError: !!error,\r\n  };\r\n};\r\n\r\nexport default useVercelUpload;\r\n"],"names":["useVercelUpload","defaultFolder","uploading","setUploading","useState","error","setError","progress","setProgress","uploadMedia","file","uploadPath","options","maxSizeMB","validateFileSize","errorMsg","mediaType","timestamp","sanitizedName","randomSuffix","customFileName","targetFolder","blob","uploadFile","result","err","files","fileArray","results","totalFiles","i","useVercelImageUpload","folder","STORAGE_FOLDERS","isImageFile","imageOptions"],"mappings":"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"}