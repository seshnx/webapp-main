import{C as Ze,r as n,t as Pe,c as Re,j as e,U as de,a as Oe,b as et,d as tt,u as W,e as le,f as Ae,T as pe,P as ke,A as Ue,X as q,L as ie,g as Ve,S as je,h as $e,i as st,k as rt,V as we,l as Be,m as ye,n as at,o as He,p as We,q as Qe,s as qe,M as Ie,F as ue,v as nt,I as lt,w as it,x as ot,y as ct,R as dt,E as ut,z as Fe,D as Te,B as xt,G as Me,H as mt,J as ft,K as ht,N as Ee,O as ze,Q as gt,W as Ce,Y as Le,Z as bt,_ as pt,$ as yt}from"./vendor-DbwibLS8.js";import{m as G,A as re}from"./vendor-framer-BrJw1elJ.js";const Ye=null,jt=void 0,wt="https://placeholder.convex.cloud",Jt=new Ze(wt),Q=()=>!!jt,Nt=t=>{var r,a;if(!t)return"";const s=t.trim().split(" ").filter(Boolean);return s.length>=2?(s[0][0]+s[1][0]).toUpperCase():s.length===1&&s[0].length>=2?s[0].substring(0,2).toUpperCase():((a=(r=s[0])==null?void 0:r[0])==null?void 0:a.toUpperCase())||""},vt=t=>{if(!t)return"from-brand-blue to-purple-600";const s=["from-brand-blue to-purple-600","from-emerald-500 to-teal-600","from-orange-500 to-red-600","from-pink-500 to-rose-600","from-indigo-500 to-blue-600","from-amber-500 to-orange-600","from-cyan-500 to-blue-600","from-violet-500 to-purple-600"],r=t.split("").reduce((a,i)=>a+i.charCodeAt(0),0);return s[r%s.length]};function oe({src:t,name:s,size:r="md",className:a,onClick:i,status:l,isGroup:j=!1,square:g=!1}){const[y,f]=n.useState(!1),k=Pe(Re("relative overflow-hidden flex items-center justify-center shrink-0 bg-gray-200 dark:bg-gray-700 border border-transparent transition-all select-none",g?"rounded-xl":"rounded-full",{xs:"h-6 w-6 text-[10px]",sm:"h-8 w-8 text-xs",md:"h-10 w-10 text-sm",lg:"h-12 w-12 text-base",xl:"h-14 w-14 text-lg","2xl":"h-24 w-24 text-2xl","3xl":"h-32 w-32 text-4xl"}[r],i&&"cursor-pointer hover:opacity-90",a)),c=!t||y,m=Nt(s),x=vt(s);return e.jsxs("div",{className:k,onClick:i,role:i?"button":void 0,tabIndex:i?0:void 0,"aria-label":s?`${s}'s avatar`:"User avatar",children:[c?e.jsx("div",{className:`h-full w-full flex items-center justify-center bg-gradient-to-br ${x} text-white font-bold`,children:j?e.jsx(de,{className:"w-1/2 h-1/2","aria-hidden":"true"}):m?e.jsx("span",{"aria-hidden":"true",children:m}):e.jsx(Oe,{className:"w-1/2 h-1/2","aria-hidden":"true"})}):e.jsx("img",{src:t,alt:s||"Avatar",className:"h-full w-full object-cover",onError:()=>f(!0),loading:"lazy"}),l&&e.jsx("span",{className:Re("absolute bottom-0 right-0 rounded-full border-2 border-white dark:border-gray-900",l==="online"?"bg-green-500":"bg-gray-400",r==="xs"||r==="sm"?"h-2 w-2":"h-3.5 w-3.5"),"aria-label":l==="online"?"Online":"Offline"})]})}const _=et;tt();const kt="http://localhost:3000",St=()=>{const[t,s]=n.useState(!1),[r,a]=n.useState(null);return{uploadMedia:async(l,j="general")=>{if(!l)return null;s(!0),a(null);try{const g=new FormData;g.append("mediaFile",l),g.append("uploadType",j);const y=await fetch(`${kt}/api/v1/upload-asset`,{method:"POST",body:g});if(!y.ok){const w=await y.json();throw new Error(w.message||`Upload failed with status ${y.status}`)}const f=await y.json();return s(!1),{url:f.url,previewUrl:f.previewUrl,storageRef:f.storageRef,type:l.type.startsWith("video/")?"video":l.type.startsWith("audio/")?"audio":"image",name:l.name}}catch(g){return console.error("Upload failed:",g),a(g.message||"An unknown error occurred during upload."),s(!1),null}},uploading:t,error:r}};function Kt(t){const s=n.useRef(!1),r=W(_.presence.updatePresence);n.useEffect(()=>{if(!t||!Q())return;r({userId:t,online:!0,lastSeen:Date.now()}).then(()=>{s.current=!0}).catch(i=>{console.error("Presence online error:",i)});const a=setInterval(()=>{s.current&&r({userId:t,online:!0,lastSeen:Date.now()}).catch(console.error)},3e4);return()=>{clearInterval(a),s.current&&(r({userId:t,online:!1,lastSeen:Date.now()}).catch(console.error),s.current=!1)}},[t])}function Je(t){const s=Q(),r=n.useMemo(()=>t&&s?{userId:t}:"skip",[t,s]),a=le(_.presence.getPresence,r);return a?{online:a.online===!0,lastSeen:a.lastSeen,loading:!1}:{online:!1,lastSeen:null,loading:!Q()}}function Rt(t){if(!t)return"Never";const s=t,a=Date.now()-s,i=Math.floor(a/6e4),l=Math.floor(i/60),j=Math.floor(l/24);return i<1?"Just now":i<60?`${i}m ago`:l<24?`${l}h ago`:j<7?`${j}d ago`:new Date(s).toLocaleDateString()}function Ke({online:t,lastSeen:s,showText:r=!1,size:a="sm"}){const i={xs:"w-1.5 h-1.5",sm:"w-2 h-2",md:"w-2.5 h-2.5"},l={xs:"text-[10px]",sm:"text-xs",md:"text-sm"};return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:`${i[a]} ${t?"fill-green-500 text-green-500":"fill-gray-400 text-gray-400"}`}),t&&e.jsx("div",{className:"absolute inset-0 animate-ping",children:e.jsx(Ae,{className:`${i[a]} fill-green-500 opacity-75`})})]}),r&&e.jsx("span",{className:`${l[a]} ${t?"text-green-500":"text-gray-400"} font-medium`,children:t?"Online":Rt(s)})]})}function Mt({conversation:t,activeChat:s,currentUserId:r,onSelect:a,onDelete:i}){const l=t.type==="direct"?t.uid||(t.id.includes("_")?t.id.split("_").find(y=>y!==r):null):null,{online:j,lastSeen:g}=Je(l||"");return e.jsxs("div",{onClick:()=>a(t),className:`group relative flex gap-3 p-4 cursor-pointer transition border-b dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-white/5 ${(s==null?void 0:s.id)===t.id?"bg-blue-50 dark:bg-blue-900/10 border-l-4 border-l-brand-blue":""}`,children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx(oe,{src:t.photo,name:t.n,size:"lg",isGroup:t.type==="group"}),t.type==="direct"&&l&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5",children:e.jsx(Ke,{online:j,lastSeen:g,size:"xs"})}),t.uc>0&&e.jsx("div",{className:"absolute -top-1 -right-1 h-5 w-5 bg-brand-blue text-white text-[10px] font-bold flex items-center justify-center rounded-full border-2 border-white dark:border-[#2c2e36]",children:t.uc>99?"99+":t.uc})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h4",{className:`text-sm truncate ${t.uc>0?"font-extrabold text-gray-900 dark:text-white":"font-bold text-gray-700 dark:text-gray-300"}`,children:t.n}),e.jsx("span",{className:"text-[10px] text-gray-400 shrink-0 ml-2",children:t.lmt?new Date(t.lmt).toLocaleDateString():""})]}),e.jsxs("p",{className:`text-xs truncate ${t.uc>0?"text-gray-800 dark:text-gray-200 font-medium":"text-gray-500"}`,children:[t.ls===r?"You: ":"",t.lm]})]}),e.jsx("button",{onClick:y=>{y.stopPropagation(),i==null||i(t.id)},className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white dark:bg-gray-800 shadow-md rounded-full text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all z-10",children:e.jsx(pe,{size:16})})]})}function Xt({user:t,conversations:s=[],activeChat:r,onSelectChat:a}){const[i,l]=n.useState(!1),[j,g]=n.useState(!1),[y,f]=n.useState("direct"),[w,k]=n.useState(!1),[c,m]=n.useState(""),[x,d]=n.useState([]),[v,h]=n.useState(""),[o,R]=n.useState([]),A=W(_.conversations.createGroupChat),I=W(_.conversations.deleteConversation),L=async N=>{h(N),N.trim().length>1&&Ye||R([])},D=N=>{const z=(t==null?void 0:t.id)||(t==null?void 0:t.uid);if(y==="direct"){const E=[z,N.id].sort().join("_");a({id:E,uid:N.id,name:`${N.firstName} ${N.lastName}`,type:"direct"}),V()}else y==="add_member"&&(x.find(E=>E.id===N.id)||d(E=>[...E,N]),V())},V=()=>{l(!1),h(""),R([])},T=()=>{m(""),d([]),g(!0)},P=()=>{f("add_member"),l(!0)},U=async()=>{if(!c||x.length===0)return alert("Name and members required.");if(!Q()){alert("Chat functionality is not available. Convex is not configured.");return}k(!0);try{const N=(t==null?void 0:t.id)||(t==null?void 0:t.uid),z=x.map(J=>J.id),{chatId:E}=await A({creatorId:N,chatName:c,memberIds:z});g(!1),a({id:E,name:c,type:"group"})}catch(N){console.error("Group creation failed",N),alert("Group creation failed: "+N.message)}finally{k(!1)}},te=async(N,z)=>{if(window.confirm("Delete this conversation?")){if(!Q()){alert("Chat functionality is not available. Convex is not configured.");return}try{const E=(t==null?void 0:t.id)||(t==null?void 0:t.uid);await I({userId:E,chatId:z}),(r==null?void 0:r.id)===z&&a(null)}catch(E){console.error(E)}}};return e.jsxs("div",{className:"flex flex-col h-full relative overflow-hidden bg-white dark:bg-[#1f2128]",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsx("h2",{className:"font-extrabold text-lg dark:text-white tracking-tight",children:"Messages"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:T,className:"p-2 bg-white dark:bg-gray-700 rounded-full shadow-sm hover:text-brand-blue transition",title:"New Group",children:e.jsx(de,{size:18})}),e.jsx("button",{onClick:()=>{f("direct"),l(!0)},className:"p-2 bg-white dark:bg-gray-700 rounded-full shadow-sm hover:text-brand-blue transition",title:"New Chat",children:e.jsx(ke,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:s.map(N=>e.jsx(Mt,{conversation:N,activeChat:r,currentUserId:(t==null?void 0:t.id)||(t==null?void 0:t.uid),onSelect:a,onDelete:z=>{window.confirm("Delete this conversation?")&&te({},z)}},N.id))}),j&&e.jsxs("div",{className:"absolute inset-0 bg-white dark:bg-[#1f2128] z-20 flex flex-col animate-in slide-in-from-right-10 duration-200",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center gap-3 bg-gray-50 dark:bg-[#23262f]",children:[e.jsx("button",{onClick:()=>g(!1),className:"hover:bg-gray-200 dark:hover:bg-gray-700 p-1 rounded-full",children:e.jsx(Ue,{size:20})}),e.jsx("h3",{className:"font-bold dark:text-white",children:"New Group"})]}),e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"1. Group Name"}),e.jsx("input",{className:"w-full p-3 border rounded-xl dark:bg-black/20 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none",placeholder:"Enter group name...",value:c,onChange:N=>m(N.target.value),autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["2. Members (",x.length,")"]}),e.jsxs("button",{onClick:P,className:"text-xs font-bold text-brand-blue flex items-center gap-1 hover:underline",children:[e.jsx(ke,{size:14})," Add Member"]})]}),e.jsx("div",{className:"space-y-2",children:x.length===0?e.jsx("div",{className:"text-center py-8 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400 text-sm",children:"No members selected"}):x.map(N=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-white/5 rounded-lg border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{src:N.photoURL,name:N.firstName,size:"sm"}),e.jsxs("span",{className:"text-sm font-bold dark:text-white",children:[N.firstName," ",N.lastName]})]}),e.jsx("button",{onClick:()=>d(z=>z.filter(E=>E.id!==N.id)),className:"text-gray-400 hover:text-red-500",children:e.jsx(q,{size:16})})]},N.id))})]})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:U,disabled:!c||x.length===0||w,className:"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-lg flex justify-center items-center gap-2",children:w?e.jsx(ie,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:["Create Group ",e.jsx(Ve,{size:18})]})})})]}),i&&e.jsxs("div",{className:"absolute inset-0 bg-white dark:bg-[#1f2128] z-30 flex flex-col animate-in fade-in duration-200",children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700 flex items-center gap-2 bg-white dark:bg-[#1f2128]",children:[e.jsx(je,{size:18,className:"text-gray-400 ml-2"}),e.jsx("input",{autoFocus:!0,className:"flex-1 p-2 bg-transparent outline-none dark:text-white placeholder-gray-400",placeholder:"Search...",value:v,onChange:N=>L(N.target.value)}),e.jsx("button",{onClick:V,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",children:e.jsx(q,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[o.length===0&&v.length>1&&e.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No users found."}),o.map(N=>{const z=y==="add_member"&&x.find(E=>E.id===N.id);return e.jsxs("div",{onClick:()=>D(N),className:`flex items-center gap-3 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl cursor-pointer transition mb-1 ${z?"opacity-50 pointer-events-none":""}`,children:[e.jsx(oe,{src:N.photoURL,name:N.firstName,size:"md"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-bold dark:text-white",children:[N.firstName," ",N.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:N.role||"User"})]}),y==="add_member"&&e.jsx(ke,{size:18,className:"text-brand-blue"})]},N.id)})]})]})]})}const ge={Recent:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥","ðŸŽ‰","ðŸ‘"],Smileys:["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ¤£","ðŸ˜‚","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Š","ðŸ˜‡","ðŸ¥°","ðŸ˜","ðŸ¤©","ðŸ˜˜","ðŸ˜—","ðŸ˜š","ðŸ˜™","ðŸ˜‹","ðŸ˜›","ðŸ˜œ","ðŸ¤ª","ðŸ˜","ðŸ¤‘","ðŸ¤—","ðŸ¤­","ðŸ¤«","ðŸ¤”","ðŸ¤","ðŸ¤¨","ðŸ˜","ðŸ˜‘","ðŸ˜¶","ðŸ˜","ðŸ˜’","ðŸ™„","ðŸ˜¬","ðŸ¤¥","ðŸ˜Œ","ðŸ˜”","ðŸ˜ª","ðŸ¤¤","ðŸ˜´","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤¢","ðŸ¤®"],Gestures:["ðŸ‘‹","ðŸ¤š","ðŸ–ï¸","âœ‹","ðŸ––","ðŸ‘Œ","ðŸ¤Œ","ðŸ¤","âœŒï¸","ðŸ¤ž","ðŸ¤Ÿ","ðŸ¤˜","ðŸ¤™","ðŸ‘ˆ","ðŸ‘‰","ðŸ‘†","ðŸ–•","ðŸ‘‡","â˜ï¸","ðŸ‘","ðŸ‘Ž","âœŠ","ðŸ‘Š","ðŸ¤›","ðŸ¤œ","ðŸ‘","ðŸ™Œ","ðŸ‘","ðŸ¤²","ðŸ¤","ðŸ™"],Hearts:["â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’”","â¤ï¸â€ðŸ”¥","â¤ï¸â€ðŸ©¹","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’Ÿ"],Objects:["ðŸ’Ž","ðŸ””","ðŸ”•","ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸ“»","ðŸŽ·","ðŸŽº","ðŸŽ¸","ðŸŽ¹","ðŸŽ®","ðŸ•¹ï¸","ðŸŽ¯","ðŸŽ²","ðŸŽ³","ðŸŽ´","ðŸƒ","ðŸ€„","ðŸŽ°","ðŸ“±","ðŸ“ž","â˜Žï¸","ðŸ“Ÿ","ðŸ“ ","ðŸ’»","ðŸ–¥ï¸","ðŸ–¨ï¸","âŒ¨ï¸","ðŸ–±ï¸","ðŸ–²ï¸","ðŸ•¹ï¸","ðŸ—œï¸","ðŸ’¾","ðŸ’¿","ðŸ“€"],Flags:["ðŸ³ï¸","ðŸ´","ðŸ","ðŸš©","ðŸ³ï¸â€ðŸŒˆ","ðŸ³ï¸â€âš§ï¸","ðŸ‡ºðŸ‡¸","ðŸ‡¬ðŸ‡§","ðŸ‡¨ðŸ‡¦","ðŸ‡¦ðŸ‡º","ðŸ‡«ðŸ‡·","ðŸ‡©ðŸ‡ª","ðŸ‡®ðŸ‡¹","ðŸ‡ªðŸ‡¸","ðŸ‡¯ðŸ‡µ","ðŸ‡°ðŸ‡·","ðŸ‡¨ðŸ‡³","ðŸ‡®ðŸ‡³","ðŸ‡§ðŸ‡·","ðŸ‡²ðŸ‡½"],Music:["ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸ“»","ðŸŽ·","ðŸŽº","ðŸŽ¸","ðŸŽ¹","ðŸ¥","ðŸª˜","ðŸŽ»","ðŸŽª","ðŸŽ­","ðŸŽ¨","ðŸŽ¬","ðŸŽ¤","ðŸŽ§","ðŸŽ¼","ðŸŽ¹"],Reactions:["ðŸ‘","ðŸ‘Ž","â¤ï¸","ðŸ”¥","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ‘","ðŸ™Œ","ðŸ¤","ðŸ¤—","ðŸ¤”","ðŸ¤¦","ðŸ¤·","ðŸ™","ðŸ‘€","ðŸ’ª","ðŸ¤˜","âœŒï¸","ðŸ¤ž"]},zt=Object.values(ge).flat();function $t({onSelect:t,onClose:s,position:r="bottom"}){const[a,i]=n.useState("Recent"),[l,j]=n.useState(""),[g,y]=n.useState(()=>{const c=localStorage.getItem("recentEmojis");return c?JSON.parse(c):ge.Recent}),f=n.useMemo(()=>l.trim()?zt.filter(c=>c.includes(l)||l.includes(c)):a==="Recent"?g:ge[a]||[],[l,a,g]),w=c=>{const m=[c,...g.filter(x=>x!==c)].slice(0,8);y(m),localStorage.setItem("recentEmojis",JSON.stringify(m)),t(c),s&&s()},k=Object.keys(ge);return e.jsxs(G.div,{initial:{opacity:0,scale:.95,y:r==="bottom"?-10:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},className:`
                absolute ${r==="bottom"?"bottom-full mb-2":"top-full mt-2"} 
                left-0
                w-[340px] bg-white dark:bg-gray-800 
                rounded-2xl shadow-2xl border dark:border-gray-700
                z-50 overflow-hidden
            `,children:[e.jsxs("div",{className:"p-3 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(je,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search emojis...",value:l,onChange:c=>j(c.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white"}),l&&e.jsx("button",{onClick:()=>j(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(q,{size:16})})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide",children:k.map(c=>e.jsxs("button",{onClick:()=>i(c),className:`
                                px-3 py-1.5 rounded-lg text-xs font-semibold whitespace-nowrap transition
                                ${a===c?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}
                            `,children:[c==="Recent"?e.jsx($e,{size:12,className:"inline mr-1"}):null,c]},c))})]}),e.jsx("div",{className:"h-[280px] overflow-y-auto custom-scrollbar p-3",children:f.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"text-sm",children:"No emojis found"})}):e.jsx("div",{className:"grid grid-cols-8 gap-1",children:f.map((c,m)=>e.jsx(G.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:()=>w(c),className:"w-10 h-10 flex items-center justify-center text-xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:c},`${c}-${m}`))})})]})}const Ge="demo_key",_e="https://api.giphy.com/v1/gifs";function Tt({onSelect:t,onClose:s,position:r="bottom"}){const[a,i]=n.useState(""),[l,j]=n.useState([]),[g,y]=n.useState([]),[f,w]=n.useState(!1),[k,c]=n.useState("trending"),m=n.useRef(null);n.useEffect(()=>{x()},[]),n.useEffect(()=>(a.trim()?(c("search"),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{d(a)},500)):(c("trending"),j([])),()=>{m.current&&clearTimeout(m.current)}),[a]);const x=async()=>{w(!0);try{const R=await(await fetch(`${_e}/trending?api_key=${Ge}&limit=24&rating=g`)).json();R.data&&y(R.data)}catch(o){console.error("Giphy trending error:",o)}w(!1)},d=async o=>{if(o.trim()){w(!0);try{const A=await(await fetch(`${_e}/search?api_key=${Ge}&q=${encodeURIComponent(o)}&limit=24&rating=g`)).json();A.data&&j(A.data)}catch(R){console.error("Giphy search error:",R)}w(!1)}},v=o=>{t==null||t({url:o.images.fixed_height.url||o.images.original.url,previewUrl:o.images.preview_gif.url||o.images.fixed_height_small.url,width:o.images.fixed_height.width,height:o.images.fixed_height.height,title:o.title||"GIF"}),s&&s()},h=k==="trending"?g:l;return e.jsxs(G.div,{initial:{opacity:0,scale:.95,y:r==="bottom"?-10:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},className:`
                absolute ${r==="bottom"?"bottom-full mb-2":"top-full mt-2"} 
                left-0
                w-[380px] bg-white dark:bg-gray-800 
                rounded-2xl shadow-2xl border dark:border-gray-700
                z-50 overflow-hidden
            `,children:[e.jsx("div",{className:"p-3 border-b dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search GIFs...",value:a,onChange:o=>i(o.target.value),className:"w-full pl-9 pr-10 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white"}),a&&e.jsx("button",{onClick:()=>i(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(q,{size:16})})]})}),e.jsx("div",{className:"h-[320px] overflow-y-auto custom-scrollbar p-3",children:f?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx(ie,{className:"animate-spin text-brand-blue mb-2",size:24}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading GIFs..."})]}):h.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(st,{size:32,className:"mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:k==="search"?"No GIFs found. Try a different search.":"Loading trending GIFs..."})]}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:h.map(o=>e.jsxs(G.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>v(o),className:"relative aspect-square rounded-lg overflow-hidden cursor-pointer bg-gray-100 dark:bg-gray-700 group",children:[e.jsx("img",{src:o.images.fixed_height_small.url||o.images.preview_gif.url,alt:o.title,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"})]},o.id))})}),e.jsx("div",{className:"p-2 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-center",children:e.jsxs("p",{className:"text-[10px] text-gray-400",children:["Powered by ",e.jsx("span",{className:"font-bold",children:"GIPHY"})]})})]})}function At({onRecorded:t,onClose:s,maxDuration:r=60}){const[a,i]=n.useState(!1),[l,j]=n.useState(null),[g,y]=n.useState(0),[f,w]=n.useState(null),[k,c]=n.useState(null),m=n.useRef(null),x=n.useRef(null),d=n.useRef(null),v=n.useRef([]),h=n.useRef(null);n.useEffect(()=>(o(),()=>{R()}),[]);const o=async()=>{try{const T=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!0});x.current=T,m.current&&(m.current.srcObject=T),w(!0),c(null)}catch(T){console.error("Permission error:",T),w(!1),c("Camera/microphone access denied")}},R=()=>{x.current&&(x.current.getTracks().forEach(T=>T.stop()),x.current=null),h.current&&clearInterval(h.current)},A=async()=>{if(!x.current){await o();return}try{v.current=[];const T={mimeType:"video/webm;codecs=vp9,opus",videoBitsPerSecond:25e5};d.current=new MediaRecorder(x.current,T),d.current.ondataavailable=P=>{P.data.size>0&&v.current.push(P.data)},d.current.onstop=()=>{const P=new Blob(v.current,{type:"video/webm"});j(P),i(!1),y(0),h.current&&clearInterval(h.current)},d.current.start(),i(!0),y(0),h.current=setInterval(()=>{y(P=>{const U=P+1;return U>=r&&I(),U})},1e3)}catch(T){console.error("Recording error:",T),c("Failed to start recording")}},I=()=>{d.current&&a&&d.current.stop()},L=()=>{j(null),y(0),i(!1)},D=()=>{if(l){const T=new File([l],`video_${Date.now()}.webm`,{type:"video/webm"});t==null||t(T),R(),s==null||s()}},V=T=>{const P=Math.floor(T/60),U=T%60;return`${P}:${U.toString().padStart(2,"0")}`};return!f&&f!==null?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsx(G.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-[#2c2e36] rounded-2xl p-6 max-w-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx(rt,{size:48,className:"text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold dark:text-white mb-2",children:"Camera Access Required"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Please allow camera and microphone access to record video messages."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-200 transition",children:"Cancel"}),e.jsx("button",{onClick:o,className:"flex-1 px-4 py-2 bg-brand-blue text-white rounded-lg text-sm font-semibold hover:bg-blue-600 transition",children:"Allow Access"})]})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-[80]",children:e.jsxs(G.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative w-full max-w-2xl aspect-video bg-black rounded-2xl overflow-hidden",children:[e.jsx("video",{ref:m,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),a&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-bold",children:V(g)})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent",children:e.jsx("div",{className:"flex items-center justify-center gap-4",children:l?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:L,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(q,{size:24})}),e.jsx("button",{onClick:D,className:"p-4 bg-green-500 hover:bg-green-600 rounded-full text-white transition shadow-lg",children:e.jsx(ye,{size:28})}),e.jsx("div",{className:"w-12"})," "]}):e.jsx(e.Fragment,{children:a?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:L,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(q,{size:24})}),e.jsx("button",{onClick:I,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full text-white transition shadow-lg animate-pulse",children:e.jsx(Be,{size:28})}),e.jsx("div",{className:"w-12"})," "]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full text-white transition",children:e.jsx(q,{size:24})}),e.jsx("button",{onClick:A,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full text-white transition shadow-lg",children:e.jsx(we,{size:28})}),e.jsx("div",{className:"w-12"})," "]})})})}),k&&e.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-4 py-2 rounded-lg text-sm",children:k})]})})}function It(t,s,r){const a=n.useRef(null),i=n.useRef(!1),l=Q(),j=n.useMemo(()=>t&&l?{chatId:t}:"skip",[t,l]),g=le(_.presence.getTypingIndicators,j),y=W(_.presence.updateTypingIndicator),f=W(_.presence.clearTypingIndicator),w=n.useMemo(()=>g?g.filter(m=>m.userId!==s&&m.isTyping).map(m=>({id:m.userId,name:m.userName})):[],[g,s]),k=n.useCallback(()=>{!t||!s||!l||(i.current||(i.current=!0,y({chatId:t,userId:s,userName:r,isTyping:!0}).catch(console.error)),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{i.current&&(i.current=!1,f({chatId:t,userId:s}).catch(console.error))},3e3))},[t,s,r,l,y,f]),c=n.useCallback(()=>{!t||!s||!l||(a.current&&clearTimeout(a.current),i.current&&(i.current=!1,f({chatId:t,userId:s}).catch(console.error)))},[t,s,l,f]);return n.useEffect(()=>()=>{a.current&&clearTimeout(a.current),t&&s&&i.current&&l&&f({chatId:t,userId:s}).catch(console.error)},[t,s,l,f]),{typingUsers:w,setTyping:k,clearTyping:c}}function Ft(t){return!t||t.length===0?"":t.length===1?`${t[0].name} is typing...`:t.length===2?`${t[0].name} and ${t[1].name} are typing...`:`${t[0].name} and ${t.length-1} others are typing...`}function Et({activeChatId:t,uid:s,onSend:r,replyingTo:a,editingMessage:i,onCancelReply:l,onCancelEdit:j,typingUsers:g=[],onTyping:y,onStopTyping:f}){const[w,k]=n.useState(""),[c,m]=n.useState(null),[x,d]=n.useState(!1),[v,h]=n.useState(0),[o,R]=n.useState(!1),[A,I]=n.useState(!1),[L,D]=n.useState(!1),[V,T]=n.useState(!1),[P,U]=n.useState(!1),te=n.useRef(null),N=n.useRef(null),z=n.useRef(null),E=n.useRef([]),J=n.useRef(null),K=n.useRef(null),H=n.useRef(null),Y=n.useRef(null),{uploadMedia:O,uploading:X}=St();n.useEffect(()=>{var u;i&&(k(i.b||""),(u=N.current)==null||u.focus())},[i]),n.useEffect(()=>{var u;a&&((u=N.current)==null||u.focus())},[a]),n.useEffect(()=>{const u=p=>{J.current&&!J.current.contains(p.target)&&I(!1),K.current&&!K.current.contains(p.target)&&D(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const se=async u=>{try{const S=await(await fetch(u.url)).blob(),M=new File([S],`gif_${Date.now()}.gif`,{type:"image/gif"}),C=await O(M,`chat_media/${t}`);if(C){const Z={url:C.url,type:"image",name:u.title||"GIF",gif:!0};r("",Z)}}catch(p){console.error("GIF upload error:",p),alert("Failed to send GIF")}D(!1)},F=async u=>{try{const p=await O(u,`chat_media/${t}`);if(p){const S={url:p.url,type:"video",name:u.name};r("",S)}}catch(p){console.error("Video upload error:",p),alert("Failed to send video")}T(!1)},B=u=>{k(u.target.value),y&&u.target.value.trim()&&y()},ae=u=>{const p=N.current;if(p){const S=p.selectionStart,M=p.selectionEnd,C=w.substring(0,S)+u+w.substring(M);k(C),setTimeout(()=>{p.selectionStart=p.selectionEnd=S+u.length,p.focus()},0)}else k(S=>S+u)},ee=async()=>{try{const u=await navigator.mediaDevices.getUserMedia({audio:!0});z.current=new MediaRecorder(u),E.current=[],h(0),z.current.ondataavailable=p=>E.current.push(p.data),z.current.onstop=()=>{const p=new Blob(E.current,{type:"audio/webm"}),S=new File([p],`voice_note_${Date.now()}.webm`,{type:"audio/webm"});m({file:S,type:"audio",previewUrl:URL.createObjectURL(p),duration:v}),u.getTracks().forEach(M=>M.stop()),H.current&&clearInterval(H.current)},z.current.start(),d(!0),H.current=setInterval(()=>{h(p=>p+1)},1e3)}catch{alert("Microphone access denied. Please allow microphone permissions.")}},ne=()=>{z.current&&x&&(z.current.stop(),d(!1),H.current&&clearInterval(H.current))},xe=()=>{var u;z.current&&x&&(z.current.stop(),E.current=[],d(!1),h(0),H.current&&clearInterval(H.current),(u=z.current.stream)==null||u.getTracks().forEach(p=>p.stop()))},me=u=>{const p=Math.floor(u/60),S=u%60;return`${p}:${S.toString().padStart(2,"0")}`},Ne=()=>{!Y.current||!(c!=null&&c.previewUrl)||(P?(Y.current.pause(),U(!1)):(Y.current.play(),U(!0)))};n.useEffect(()=>()=>{H.current&&clearInterval(H.current),z.current&&x&&z.current.stop()},[]);const ce=u=>{u.preventDefault(),u.stopPropagation(),u.type==="dragenter"||u.type==="dragover"?R(!0):R(!1)},ve=u=>{u.preventDefault(),u.stopPropagation(),R(!1),u.dataTransfer.files&&u.dataTransfer.files[0]&&fe(u.dataTransfer.files[0])},fe=u=>{const p=u.type.startsWith("image/")?"image":u.type.startsWith("video/")?"video":u.type.startsWith("audio/")?"audio":"file";m({file:u,type:p,previewUrl:URL.createObjectURL(u)})},he=async u=>{if(u.preventDefault(),!w.trim()&&!c||X)return;let p=null;if(c){const S=await O(c.file,`chat_media/${t}`);S&&(p={url:S.url,type:S.type,name:S.name,duration:c.duration})}r(w,p),k(""),m(null),U(!1),f&&f()},b=()=>{i?(k(""),j==null||j()):l==null||l()},$=()=>{var u,p;return i?((u=i.b)==null?void 0:u.substring(0,50))||"Message":a?((p=a.b)==null?void 0:p.substring(0,50))||"Media":""};return e.jsxs("div",{className:`p-3 bg-white dark:bg-[#2c2e36] border-t dark:border-gray-700 shrink-0 transition-colors ${o?"bg-blue-50 dark:bg-blue-900/20 border-blue-400":""}`,onDragEnter:ce,onDragLeave:ce,onDragOver:ce,onDrop:ve,children:[e.jsx(re,{children:g.length>0&&e.jsxs(G.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-2 px-2 flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-brand-blue rounded-full animate-bounce"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-brand-blue rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-brand-blue rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:Ft(g)})]})}),e.jsx(re,{children:x&&e.jsx(G.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium text-red-700 dark:text-red-400",children:"Recording..."}),e.jsx("span",{className:"font-mono text-red-600 dark:text-red-300 text-sm",children:me(v)})]}),e.jsx("div",{className:"flex items-center gap-0.5 mx-4",children:[...Array(20)].map((u,p)=>e.jsx(G.div,{className:"w-1 bg-red-400 rounded-full",animate:{height:[8,Math.random()*20+8,8]},transition:{duration:.5,repeat:1/0,delay:p*.05}},p))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:xe,className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/40 rounded-full transition",title:"Cancel recording",children:e.jsx(pe,{size:18})}),e.jsx("button",{type:"button",onClick:ne,className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition",title:"Stop recording",children:e.jsx(at,{size:16,fill:"white"})})]})]})})}),e.jsx(re,{children:(a||i)&&e.jsxs(G.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-between items-center bg-gray-100 dark:bg-gray-800 p-2.5 px-4 rounded-xl border-l-4 border-brand-blue mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[i?e.jsx(He,{size:16,className:"text-brand-blue shrink-0"}):e.jsx(We,{size:16,className:"text-brand-blue shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-xs font-bold text-brand-blue block",children:i?"Editing Message":`Replying to ${(a==null?void 0:a.n)||"User"}`}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate block",children:$()})]})]}),e.jsx("button",{onClick:b,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(q,{size:16,className:"text-gray-400 hover:text-red-500"})})]})}),e.jsx(re,{children:c&&e.jsxs(G.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"flex items-center gap-3 p-3 bg-gray-100 dark:bg-gray-800 rounded-xl mb-2 border dark:border-gray-700",children:[c.type==="image"?e.jsx("img",{src:c.previewUrl,className:"h-14 w-14 object-cover rounded-lg"}):c.type==="video"?e.jsx("video",{src:c.previewUrl,className:"h-14 w-14 object-cover rounded-lg"}):c.type==="audio"?e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{type:"button",onClick:Ne,className:"h-12 w-12 bg-purple-500 text-white flex items-center justify-center rounded-full hover:bg-purple-600 transition shrink-0",children:P?e.jsx(Qe,{size:20}):e.jsx(qe,{size:20,className:"ml-0.5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{size:14,className:"text-purple-500"}),e.jsx("span",{className:"text-sm font-bold dark:text-white",children:"Voice Message"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex items-center gap-0.5 flex-1",children:[...Array(30)].map((u,p)=>e.jsx("div",{className:"w-1 bg-purple-300 dark:bg-purple-700 rounded-full",style:{height:`${Math.random()*12+4}px`}},p))}),e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:c.duration?me(c.duration):"0:00"})]})]}),e.jsx("audio",{ref:Y,src:c.previewUrl,onEnded:()=>U(!1),className:"hidden"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-14 w-14 bg-gray-200 dark:bg-gray-700 text-gray-500 flex items-center justify-center rounded-lg",children:e.jsx(ue,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-bold dark:text-white truncate",children:c.file.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(c.file.size/1024).toFixed(1)," KB"]})]})]}),e.jsx("button",{onClick:()=>{m(null),U(!1)},className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition shrink-0",children:e.jsx(q,{size:18,className:"text-gray-400 hover:text-red-500"})})]})}),e.jsxs("form",{onSubmit:he,className:"flex items-end gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",ref:te,className:"hidden",accept:"image/*,audio/*,video/*,.pdf,.doc,.docx,.txt,.zip",onChange:u=>fe(u.target.files[0])}),e.jsx("button",{type:"button",onClick:()=>{var u;return(u=te.current)==null?void 0:u.click()},className:"p-2.5 text-gray-500 hover:text-brand-blue hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition shrink-0",title:"Attach file",children:e.jsx(nt,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-1 border-r dark:border-gray-700 pr-2",children:[e.jsx("button",{type:"button",onClick:()=>{T(!0),I(!1),D(!1)},className:"p-2 text-gray-500 hover:text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition",title:"Record video",children:e.jsx(we,{size:18})}),e.jsxs("button",{type:"button",onClick:()=>{D(!L),I(!1)},className:"p-2 text-gray-500 hover:text-purple-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition relative",title:"GIF",ref:K,children:[e.jsx(lt,{size:18}),L&&e.jsx(Tt,{onSelect:se,onClose:()=>D(!1),position:"bottom"})]})]}),e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-[#1f2128] rounded-2xl border dark:border-gray-700 focus-within:ring-2 focus-within:ring-brand-blue transition-all flex items-end relative",children:[e.jsx("textarea",{ref:N,className:"w-full bg-transparent p-3 max-h-32 min-h-[44px] text-sm resize-none outline-none dark:text-white custom-scrollbar pr-20",placeholder:i?"Update message...":o?"Drop files here...":"Type a message...",value:w,onChange:B,onKeyDown:u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),he(u))},rows:1}),e.jsxs("div",{className:"absolute right-2 bottom-1.5 flex items-center gap-1",children:[e.jsxs("div",{className:"relative",ref:J,children:[e.jsx("button",{type:"button",onClick:()=>{I(!A),D(!1)},className:`p-1.5 rounded-full transition ${A?"bg-brand-blue/20 text-brand-blue":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,title:"Emoji",children:e.jsx(it,{size:18})}),e.jsx(re,{children:A&&e.jsx($t,{onSelect:ae,onClose:()=>I(!1),position:"bottom"})})]}),e.jsx("button",{type:"button",onClick:x?ne:ee,className:`p-1.5 rounded-full transition ${x?"bg-red-500 text-white animate-pulse":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,children:x?e.jsx(Be,{size:18}):e.jsx(Ie,{size:18})})]})]}),e.jsx("button",{type:"submit",disabled:!w.trim()&&!c||X,className:`p-2.5 text-white rounded-full shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all shrink-0 ${i?"bg-green-600 hover:bg-green-700":"bg-brand-blue hover:bg-blue-600"}`,children:X?e.jsx(ie,{size:20,className:"animate-spin"}):i?e.jsx(ot,{size:20}):e.jsx(ct,{size:20})})]}),V&&e.jsx(At,{onRecorded:F,onClose:()=>T(!1),maxDuration:60})]})}function Ct(...t){return Pe(Re(t))}const be=dt.forwardRef(({className:t,variant:s="default",size:r="default",...a},i)=>{const l={default:"bg-blue-600 text-white hover:bg-blue-700 shadow-sm",destructive:"bg-red-500 text-white hover:bg-red-600 shadow-sm",outline:"border border-gray-200 bg-transparent hover:bg-gray-100 text-gray-900",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200",ghost:"hover:bg-gray-100 hover:text-gray-900 text-gray-600",link:"text-blue-600 underline-offset-4 hover:underline"},j={default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"};return e.jsx("button",{ref:i,className:Ct("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:pointer-events-none disabled:opacity-50",l[s],j[r],t),...a})});be.displayName="Button";function Lt({url:t,isOpen:s,onClose:r,previewData:a}){if(!s||!t)return null;const i=new URL(t).pathname;let l="Content";i.startsWith("/profile/")?l="User Profile":i.startsWith("/session/")?l="Session Details":i.startsWith("/studio/")&&(l="Studio Listing");const j=(a==null?void 0:a.title)||`${l} Preview`;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black bg-opacity-70 backdrop-blur-sm",onClick:r,children:e.jsxs("div",{className:"bg-gray-900 rounded-xl shadow-2xl w-full max-w-2xl h-3/4 max-h-[800px] flex flex-col transform transition-all duration-300 scale-100 opacity-100",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-800 rounded-t-xl sticky top-0",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate max-w-[80%]",children:j}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:e.jsx(be,{variant:"ghost",size:"icon",className:"text-blue-400 hover:text-blue-300",children:e.jsx(ut,{className:"w-5 h-5"})})}),e.jsx(be,{onClick:r,variant:"ghost",size:"icon",className:"text-white hover:bg-gray-700",children:e.jsx(q,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-y-auto custom-scrollbar text-gray-400 flex flex-col items-center justify-center text-center",children:[e.jsx("p",{className:"mb-4 text-lg font-medium text-white",children:"Embedded Content Simulation"}),e.jsx("p",{className:"mb-2",children:"This is where the actual SeshNx content (e.g., profile card, session details) would be rendered, based on the URL:"}),e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline break-all p-2 bg-gray-700 rounded-lg text-sm",children:t}),e.jsx("p",{className:"mt-4 text-sm",children:'In a real implementation, you would use a dedicated component (e.g., `ProfileCard id="..."`) here instead of an iframe to display the content securely and natively.'})]}),e.jsx("div",{className:"p-3 border-t border-gray-700 bg-gray-800 rounded-b-xl flex justify-end",children:e.jsx(be,{onClick:r,variant:"secondary",children:"Done"})})]})})}function Gt({status:t="sent",size:s=12,className:r=""}){const a={sending:{icon:$e,color:"text-gray-400",animate:!0},sent:{icon:ye,color:"text-gray-400",animate:!1},delivered:{icon:Fe,color:"text-gray-400",animate:!1},read:{icon:Fe,color:"text-brand-blue",animate:!1}},i=a[t]||a.sent,l=i.icon;return e.jsx(G.div,{animate:i.animate?{rotate:[0,360]}:{},transition:i.animate?{duration:2,repeat:1/0,ease:"linear"}:{},className:`inline-flex items-center ${i.color} ${r}`,children:e.jsx(l,{size:s,className:t==="read"?"fill-current":""})})}function _t({audioUrl:t,color:s="brand-blue",height:r=40}){const a=n.useRef(null),i=n.useRef(null),l=n.useRef(null),j=n.useRef(null),g=n.useRef(null),[y,f]=n.useState(!1);n.useEffect(()=>{if(!t||!a.current)return;const c=a.current,m=c.getContext("2d"),x=new Audio(t);i.current=x,c.width=c.offsetWidth,c.height=r;const d=new(window.AudioContext||window.webkitAudioContext),v=d.createAnalyser(),h=d.createMediaElementSource(x);v.fftSize=256,h.connect(v),v.connect(d.destination),j.current=d,g.current=v;const o=v.frequencyBinCount,R=new Uint8Array(o),A=()=>{if(x.paused){w(m,c.width,c.height);return}l.current=requestAnimationFrame(A),v.getByteFrequencyData(R),m.clearRect(0,0,c.width,c.height);const I=c.width/o*2;let L=0;for(let D=0;D<o;D++){const V=R[D]/255*c.height,T=m.createLinearGradient(0,0,0,c.height);T.addColorStop(0,"#3b82f6"),T.addColorStop(1,"#8b5cf6"),m.fillStyle=T,m.fillRect(L,c.height-V,I-1,V),L+=I}};return x.addEventListener("play",()=>{f(!0),A()}),x.addEventListener("pause",()=>{f(!1),l.current&&cancelAnimationFrame(l.current),w(m,c.width,c.height)}),x.addEventListener("ended",()=>{f(!1),l.current&&cancelAnimationFrame(l.current),w(m,c.width,c.height)}),w(m,c.width,c.height),()=>{var I;l.current&&cancelAnimationFrame(l.current),x.pause(),(I=j.current)==null||I.close()}},[t,r,y]);const w=(c,m,x)=>{c.clearRect(0,0,m,x),c.fillStyle="#3b82f6";const d=50,v=m/d,h=2;for(let o=0;o<d;o++){const R=Math.random()*x*.3+x*.1,A=o*v;c.fillRect(A,x-R,v-h,R)}},k=()=>{i.current&&(y?i.current.pause():i.current.play())};return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:k,className:"w-10 h-10 flex items-center justify-center bg-brand-blue text-white rounded-full hover:bg-blue-600 transition shrink-0",children:y?e.jsx(Qe,{size:16}):e.jsx(qe,{size:16,className:"ml-0.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("canvas",{ref:a,className:"w-full rounded",style:{height:`${r}px`}}),e.jsx("audio",{ref:i,src:t})]})]})}const Dt=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"];function Pt({message:t,isCurrentUser:s,previousMessage:r,currentUserId:a,chatId:i,linkPreviewData:l,messageStatus:j="sent",onReaction:g,onReply:y,onEdit:f,onDelete:w,onForward:k,onSeshNxLinkClick:c,onUserClick:m}){var se;const[x,d]=n.useState(!1),[v,h]=n.useState(!1),[o,R]=n.useState(!1),A=n.useRef(null),I=n.useRef(null),L=!r||r.s!==t.s,D=r&&new Date(t.t).toDateString()===new Date(r.t).toDateString(),V=t.t||Date.now(),T=(r==null?void 0:r.t)||0,P=r&&V-T>3e5,U=!D||!r,te=L||P,N=!s&&L,z=new Date(t.t||Date.now());n.useEffect(()=>{const F=B=>{A.current&&!A.current.contains(B.target)&&(d(!1),h(!1))};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[]);const E=()=>{navigator.clipboard.writeText(t.b||""),R(!0),setTimeout(()=>R(!1),2e3),d(!1)},J=F=>{g==null||g(t.id,F),h(!1),d(!1)},K=t.reactions?Object.entries(t.reactions).reduce((F,[B,ae])=>{const ee=typeof ae=="object"?Object.keys(ae).length:0;return ee>0&&(F[B]=ee),F},{}):{},H=Object.keys(K).length>0,Y=t.reactions?(se=Object.entries(t.reactions).find(([F,B])=>typeof B=="object"&&B[a]))==null?void 0:se[0]:null,O=s?"bg-brand-blue text-white rounded-br-sm":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-sm";if(t.deleted||t.deletedForAll)return e.jsx("div",{className:`flex ${s?"justify-end":"justify-start"} ${L?"mt-3":"mt-0.5"}`,children:e.jsx("div",{className:"px-4 py-2 rounded-2xl bg-gray-100 dark:bg-gray-800 text-gray-400 italic text-sm",children:"ðŸš« This message was deleted"})});if(t.deletedFor&&t.deletedFor[a])return null;const X=()=>{var B;if(!l)return null;const F=(B=l.url)==null?void 0:B.includes("app.seshnx.com");return e.jsx("div",{className:"mt-2 block border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden bg-white dark:bg-gray-800 max-w-[280px]",children:F?e.jsxs("button",{onClick:()=>c==null?void 0:c(l),className:"w-full text-left",children:[l.image&&e.jsx("div",{className:"h-28 w-full bg-cover bg-center",style:{backgroundImage:`url(${l.image})`}}),e.jsxs("div",{className:"p-2",children:[e.jsxs("p",{className:"font-semibold text-xs text-brand-blue truncate flex items-center",children:[e.jsx(mt,{className:"w-3 h-3 mr-1"}),l.title||"SeshNx Link"]}),l.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 line-clamp-2",children:l.description})]})]}):e.jsxs("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",children:[l.image&&e.jsx("div",{className:"h-28 w-full bg-cover bg-center",style:{backgroundImage:`url(${l.image})`}}),e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"font-semibold text-xs text-brand-blue truncate",children:l.title||l.url}),l.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 line-clamp-2",children:l.description}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-1 flex items-center",children:[e.jsx(ft,{className:"w-2.5 h-2.5 mr-1"}),new URL(l.url).hostname]})]})]})})};return e.jsxs(e.Fragment,{children:[U&&e.jsx("div",{className:"text-center my-4",children:e.jsx("span",{className:"text-[10px] text-gray-400 dark:text-gray-500 font-bold uppercase tracking-wider bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full",children:z.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("div",{className:`group flex items-end gap-2 ${s?"flex-row-reverse":"flex-row"} ${L?"mt-3":"mt-0.5"}`,ref:I,children:[!s&&e.jsx("div",{className:"w-8 shrink-0",children:N&&e.jsx(oe,{src:t.photo,name:t.n,size:"xs",className:"cursor-pointer",onClick:()=>m==null?void 0:m(t.s)})}),e.jsxs("div",{className:`relative max-w-[75%] ${s?"items-end":"items-start"}`,children:[!s&&L&&t.n&&e.jsx("p",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 mb-1 ml-1",children:t.n}),t.replyTo&&e.jsxs("div",{className:`mb-1 px-3 py-1.5 rounded-lg text-xs border-l-2 border-brand-blue ${s?"bg-blue-400/30 text-blue-100":"bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300"}`,children:[e.jsx("p",{className:"font-bold text-[10px] mb-0.5",children:t.replyTo.sender}),e.jsx("p",{className:"truncate opacity-80",children:t.replyTo.text})]}),e.jsxs("div",{className:`relative px-3 py-2 rounded-2xl shadow-sm ${O} cursor-pointer transition-all hover:shadow-md`,onClick:()=>d(!x),children:[t.media&&e.jsxs("div",{className:"mb-2",children:[t.media.type==="image"&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[t.media.gif&&e.jsx("span",{className:"absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full font-bold",children:"GIF"}),e.jsx("img",{src:t.media.url,alt:"Shared",className:"max-w-full h-auto rounded-lg max-h-60 object-cover"})]}),t.media.type==="video"&&e.jsx("video",{controls:!0,src:t.media.url,className:"max-w-full h-auto rounded-lg max-h-60"}),t.media.type==="audio"&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 max-w-[280px]",children:e.jsx(_t,{audioUrl:t.media.url,height:50})}),t.media.type==="file"&&e.jsxs("a",{href:t.media.url,target:"_blank",rel:"noopener noreferrer",download:t.media.name,className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center shrink-0",children:e.jsx(ue,{size:20,className:"text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold dark:text-white truncate",children:t.media.name||"File"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click to download"})]}),e.jsx(Te,{size:18,className:"text-gray-400 group-hover:text-brand-blue transition shrink-0"})]})]}),t.b&&e.jsx("p",{className:"text-sm break-words whitespace-pre-wrap leading-relaxed",children:t.b}),t.b&&X(),t.edited&&e.jsx("span",{className:`text-[9px] ${s?"text-blue-200":"text-gray-400"} ml-1`,children:"(edited)"})]}),H&&e.jsx("div",{className:`flex flex-wrap gap-1 mt-1 ${s?"justify-end":"justify-start"}`,children:Object.entries(K).map(([F,B])=>e.jsxs(G.button,{initial:{scale:0},animate:{scale:1},onClick:()=>J(F),className:`flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-xs border transition-all ${Y===F?"bg-brand-blue/20 border-brand-blue text-brand-blue":"bg-gray-100 dark:bg-gray-700 border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{children:F}),e.jsx("span",{className:"text-[10px] font-bold",children:B})]},F))}),te&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 ${s?"justify-end":"justify-start"}`,children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:z.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}),s&&e.jsx(Gt,{status:j,size:10,className:"ml-0.5"})]}),e.jsx(re,{children:x&&e.jsxs(G.div,{ref:A,initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},className:`absolute z-50 ${s?"right-0":"left-0"} bottom-full mb-2 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden min-w-[180px]`,children:[e.jsx("div",{className:"flex justify-center gap-1 p-2 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:Dt.map(F=>e.jsx(G.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:()=>J(F),className:`text-lg p-1 rounded-full transition ${Y===F?"bg-brand-blue/20":"hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:F},F))}),e.jsxs("div",{className:"p-1",children:[e.jsxs("button",{onClick:()=>{y==null||y(t),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(We,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Reply"})]}),e.jsxs("button",{onClick:E,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(xt,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:o?"Copied!":"Copy"})]}),e.jsxs("button",{onClick:()=>{k==null||k(t),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(Me,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Forward"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{f==null||f(t),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:[e.jsx(He,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"dark:text-gray-200",children:"Edit"})]}),e.jsxs("button",{onClick:()=>{w==null||w(t,"everyone"),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition text-red-500",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"Delete for Everyone"})]})]}),e.jsxs("button",{onClick:()=>{w==null||w(t,"me"),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition text-gray-500",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"Delete for Me"})]})]})]})})]}),s&&e.jsx("div",{className:"w-8 shrink-0"})]})]})}function Ot({message:t,conversations:s,currentUserId:r,onForward:a,onClose:i}){const[l,j]=n.useState(""),[g,y]=n.useState([]),[f,w]=n.useState(!1),k=l.trim()?s.filter(d=>{var v;return(v=d.n)==null?void 0:v.toLowerCase().includes(l.toLowerCase())}):s,c=d=>{y(v=>v.includes(d)?v.filter(h=>h!==d):[...v,d])},m=async()=>{if(g.length!==0){w(!0);try{await a(t,g),i()}catch(d){console.error("Forward error:",d),alert("Failed to forward message")}w(!1)}},x=()=>{var d;return t.media?t.media.type==="image"?"ðŸ“· Image":t.media.type==="video"?"ðŸŽ¥ Video":t.media.type==="audio"?"ðŸŽµ Audio":"ðŸ“Ž File":((d=t.b)==null?void 0:d.substring(0,100))||"Message"};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:e.jsxs(G.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"text-brand-blue",size:20}),e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Forward Message"})]}),e.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(q,{size:20})})]}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-800 border-b dark:border-gray-700 shrink-0",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Forwarding:"}),e.jsx("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:e.jsx("p",{className:"text-sm dark:text-gray-200 line-clamp-2",children:x()})})]}),e.jsx("div",{className:"px-4 py-3 border-b dark:border-gray-700 shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:l,onChange:d=>j(d.target.value),className:"w-full pl-9 pr-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-blue dark:text-white transition"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:k.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No conversations found"})}):k.map(d=>{const v=g.includes(d.id);return e.jsxs(G.div,{whileTap:{scale:.98},onClick:()=>c(d.id),className:`
                                        flex items-center gap-3 p-4 cursor-pointer transition
                                        border-b dark:border-gray-700/50
                                        ${v?"bg-brand-blue/10 dark:bg-brand-blue/20":"hover:bg-gray-50 dark:hover:bg-gray-800"}
                                    `,children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{src:d.photo,name:d.n,size:"md",isGroup:d.type==="group"}),v&&e.jsx(G.div,{initial:{scale:0},animate:{scale:1},className:"absolute -bottom-1 -right-1 w-5 h-5 bg-brand-blue rounded-full flex items-center justify-center",children:e.jsx(ye,{size:12,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm dark:text-white truncate",children:d.n}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:d.type==="group"?"Group":"Direct message"})]}),e.jsx("div",{className:`
                                        w-5 h-5 rounded-full border-2 transition
                                        ${v?"border-brand-blue bg-brand-blue":"border-gray-300 dark:border-gray-600"}
                                    `,children:v&&e.jsx(ye,{size:12,className:"text-white m-auto"})})]},d.id)})}),e.jsxs("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[g.length," conversation",g.length!==1?"s":""," selected"]}),g.length>0&&e.jsx("button",{onClick:()=>y([]),className:"text-xs text-brand-blue hover:underline",children:"Clear all"})]}),e.jsx("button",{onClick:m,disabled:g.length===0||f,className:"w-full bg-brand-blue text-white py-3 rounded-xl font-bold hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"animate-spin",size:18}),"Forwarding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:18}),"Forward"]})})]})]})})}function Ut(t,s){var m;const r=n.useMemo(()=>Q(),[]),a=n.useMemo(()=>t&&s&&r?{chatId:t}:"skip",[t,s,r]),i=le(_.readReceipts.getReadReceipts,a),l=W(_.readReceipts.markAsRead),j=W(_.readReceipts.markMultipleAsRead),g=n.useMemo(()=>{if(!i)return{};const x={};return i.forEach(d=>{x[d.userId]?d.readAt>x[d.userId].readAt&&(x[d.userId]={lastReadMessageId:d.messageId,readAt:d.readAt}):x[d.userId]={lastReadMessageId:d.messageId,readAt:d.readAt}}),x},[i]),y=((m=g[s])==null?void 0:m.lastReadMessageId)||null,f=n.useCallback(async x=>{if(!(!t||!s||!x||!Q()||!l||!j))try{const d=Array.isArray(x)?x:[x];d.length===1?await l({chatId:t,messageId:d[0],userId:s}):await j({chatId:t,messageIds:d,userId:s})}catch(d){console.error("Mark as read error:",d)}},[t,s,l,j]),w=n.useCallback((x,d,v=null)=>{if(!x||!d)return!1;const h=g[d];if(!h||!h.lastReadMessageId)return!1;const o=h.lastReadMessageId;if(o===x)return!0;if(v&&Array.isArray(v)){const R=v.find(I=>I.id===x),A=v.find(I=>I.id===o);if(R&&A&&R.t&&A.t)return R.t<=A.t}return o>=x},[g]),k=n.useCallback(x=>{var d;return((d=g[x])==null?void 0:d.lastReadMessageId)||null},[g]),c=n.useCallback(x=>y===x||y&&y>=x,[y]);return{readReceipts:g,myLastRead:y,markAsRead:f,isMessageRead:w,getLastReadMessage:k,hasCurrentUserRead:c}}const De=new Map,Vt=5*60*1e3;async function Bt(t){const s=t.match(/(https?:\/\/[^\s]+)/);if(!s)return null;const r=s[0],a=De.get(r);if(a&&Date.now()-a.timestamp<Vt)return a.data;const i=await Ht(r);return De.set(r,{data:i,timestamp:Date.now()}),i}async function Ht(t){try{const r=await fetch(t,{method:"HEAD",mode:"no-cors"})}catch{}const s={url:t,title:null,description:null,image:null,siteName:null};try{const r=new URL(t),a=r.hostname.toLowerCase();if(a.includes("youtube.com")||a.includes("youtu.be")){let i=null;a.includes("youtu.be")?i=r.pathname.slice(1):i=r.searchParams.get("v"),s.siteName="YouTube",s.title="YouTube Video",s.description="Watch this video on YouTube",i&&(s.image=`https://img.youtube.com/vi/${i}/mqdefault.jpg`)}else if(a.includes("spotify.com"))s.siteName="Spotify",s.title="Spotify Content",s.description="Listen on Spotify",s.image="https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_RGB_Green.png";else if(a.includes("soundcloud.com"))s.siteName="SoundCloud",s.title="SoundCloud Track",s.description="Listen on SoundCloud",s.image="https://soundcloud.com/press/assets/press-kit/soundcloud-logo.png";else if(a.includes("github.com")){const i=r.pathname.split("/").filter(l=>l);s.siteName="GitHub",s.title=i.length>=2?`${i[0]}/${i[1]}`:"GitHub Repository",s.description="View on GitHub",i.length>=2&&(s.image=`https://opengraph.githubassets.com/1/${i[0]}/${i[1]}`)}else if(a.includes("twitter.com")||a.includes("x.com"))s.siteName="X (Twitter)",s.title="Tweet",s.description="View on X";else if(a.includes("instagram.com"))s.siteName="Instagram",s.title="Instagram Post",s.description="View on Instagram";else if(a.includes("app.seshnx.com")||a.includes("seshnx.com"))s.siteName="SeshNx",s.title="SeshNx Link",s.description="View on SeshNx platform",s.image="https://app.seshnx.com/pwa-512x512.png";else if(a.includes("linkedin.com"))s.siteName="LinkedIn",s.title="LinkedIn Post",s.description="View on LinkedIn";else if(a.includes("music.apple.com"))s.siteName="Apple Music",s.title="Apple Music",s.description="Listen on Apple Music";else if(a.includes("tiktok.com"))s.siteName="TikTok",s.title="TikTok Video",s.description="Watch on TikTok";else if(a.includes("vimeo.com"))s.siteName="Vimeo",s.title="Vimeo Video",s.description="Watch on Vimeo";else if(a.includes("bandcamp.com")){const i=a.split(".")[0];s.siteName="Bandcamp",s.title=i!=="bandcamp"?`${i} on Bandcamp`:"Bandcamp",s.description="Listen on Bandcamp"}else s.siteName=a.replace("www.",""),s.title=a.replace("www.",""),s.description=`Visit ${a}`;return s}catch(r){return console.warn("Link preview parsing error:",r),{url:t,title:t,description:null,image:null}}}function Zt({user:t,userData:s,activeChat:r,conversations:a,onBack:i,toggleDetails:l,openPublicProfile:j}){const[g,y]=n.useState({}),[f,w]=n.useState({isOpen:!1,url:"",previewData:null}),[k,c]=n.useState(null),[m,x]=n.useState(null),[d,v]=n.useState(null),h=n.useRef(null),o=r==null?void 0:r.id,R=(r==null?void 0:r.name)||(r==null?void 0:r.n)||"Unknown User",A=n.useMemo(()=>(r==null?void 0:r.type)==="group"?null:r!=null&&r.uid?r.uid:o&&o.includes("_")?o.split("_").find($=>$!==(t==null?void 0:t.uid)):null,[r,o,t==null?void 0:t.uid]),{online:I,lastSeen:L,loading:D}=Je(A),{markAsRead:V,hasCurrentUserRead:T,isMessageRead:P}=Ut(o,t==null?void 0:t.uid),{typingUsers:U,setTyping:te,clearTyping:N}=It(o,t==null?void 0:t.uid,(s==null?void 0:s.firstName)||"User"),z=Q(),E=n.useMemo(()=>o&&z?{chatId:o,limit:100}:"skip",[o,z]),J=n.useMemo(()=>o&&z&&(r==null?void 0:r.type)==="group"?{chatId:o}:"skip",[o,z,r==null?void 0:r.type]),K=le(_.conversations.getChatMembers,J),H=n.useMemo(()=>K?K.map(b=>b.userId):[],[K]),Y=le(_.messages.getMessages,E),O=n.useMemo(()=>Y?Y.map(b=>({id:b._id,b:b.content||"",s:b.senderId,n:b.senderName,photo:b.senderPhoto||"",t:b.timestamp,edited:b.edited||!1,editedAt:b.editedAt,deleted:b.deleted||!1,deletedForAll:b.deletedForAll||!1,media:b.media,replyTo:b.replyTo,reactions:b.reactions||{}})):[],[Y]),X=W(_.messages.sendMessage),se=W(_.messages.editMessage),F=W(_.messages.deleteMessage),B=W(_.messages.addReaction),ae=W(_.messages.removeReaction),ee=W(_.conversations.updateConversation),ne=W(_.conversations.updateUnreadCount);n.useEffect(()=>{h.current&&O.length>0&&h.current.scrollIntoView({behavior:"smooth"})},[O]);const xe=n.useRef(0);n.useEffect(()=>{if(o&&(t!=null&&t.uid)&&O.length>0){const b=O.map(u=>u.id),$=b.length;$!==xe.current&&(xe.current=$,V(b))}},[o,t==null?void 0:t.uid,O.length,V]),n.useEffect(()=>{O.forEach(b=>{if(b.b){const $=b.b.match(/(https?:\/\/[^\s]+)/);if($){const u=$[0];g[b.id]||Bt(u).then(p=>y(S=>({...S,[b.id]:p}))).catch(p=>console.error(p))}}})},[O]);const me=async(b,$)=>{var u,p;if(!(!o||!(t!=null&&t.uid)||!Q()))try{const S=O.find(C=>C.id===b);if(!S)return;((p=(u=S.reactions)==null?void 0:u[$])==null?void 0:p.includes(t.uid))?await ae({messageId:b,userId:t.uid,emoji:$}):await B({messageId:b,userId:t.uid,emoji:$})}catch(S){console.error("Reaction error:",S)}},Ne=async(b,$)=>{if(!Q()||!X||!ee){alert("Chat functionality is not available. Convex is not configured.");return}const u=b.b||"",p=b.media||null;for(const S of $)try{await X({chatId:S,senderId:t.uid,senderName:s.firstName||"User",senderPhoto:s.photoURL||void 0,content:`ç«Šï½ª Forwarded: ${u}`,media:p||void 0});const M=a==null?void 0:a.find(Z=>Z.id===S),C=u||(p?`Forwarded ${p.type}`:"Forwarded message");await ee({userId:t.uid,chatId:S,lastMessage:`ç«Šï½ª ${C}`,lastMessageTime:Date.now(),lastSenderId:t.uid,chatName:(M==null?void 0:M.name)||(M==null?void 0:M.n),chatPhoto:(M==null?void 0:M.photo)||"",chatType:(M==null?void 0:M.type)||"direct",otherUserId:M==null?void 0:M.uid})}catch(M){console.error("Forward error for chat:",S,M)}},ce=async(b,$)=>{var p;if(!o||!(b!=null&&b.trim())&&!$||!Q()||!X||!se||!ee||!ne)return;let u=b?b.trim():"";if(u.length===0&&$&&(u=$.type==="image"?"ðŸ“· Image":$.type==="video"?"ðŸŽ¥ Video":$.type==="audio"?"ðŸŽµ Audio":"ðŸ“Ž File"),m)try{await se({messageId:m.id,content:u,senderId:t.uid}),x(null);return}catch(S){console.error("Edit error:",S);return}try{await X({chatId:o,senderId:t.uid,senderName:s.firstName||"User",senderPhoto:s.photoURL||void 0,content:u||void 0,media:$||void 0,replyTo:k?{messageId:k.id,text:((p=k.b)==null?void 0:p.substring(0,100))||"Media",sender:k.n||"User"}:void 0});const S=u||($?`Sent ${$.type}`:"Message");let M=[],C=r.uid;!C&&r.type!=="group"&&o&&o.includes("_")&&(C=o.split("_").find(Xe=>Xe!==t.uid)),r.type==="group"?M=H.length>0?[...new Set([t.uid,...H])]:[t.uid]:C?M=[t.uid,C]:M=[t.uid];for(const Z of M)await ee({userId:Z,chatId:o,lastMessage:S,lastMessageTime:Date.now(),lastSenderId:t.uid,chatName:r.type==="group"?R:r.name||r.n,chatPhoto:r.photo||"",chatType:r.type||"direct",otherUserId:r.type==="direct"?Z===t.uid?C:t.uid:void 0}),Z===t.uid?await ne({userId:Z,chatId:o,setTo:0}):await ne({userId:Z,chatId:o,increment:1});c(null)}catch(S){console.error("Send message error:",S)}},ve=async(b,$=!1)=>{if(!(!o||!(t!=null&&t.uid)||!Q()||!F))try{await F({messageId:b,senderId:t.uid,forEveryone:$})}catch(u){console.error("Delete error:",u)}},fe=n.useMemo(()=>{var b;return e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-800 bg-white dark:bg-[#1f2128]",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("button",{onClick:i,className:"md:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 cursor-pointer",onClick:()=>j==null?void 0:j(A?{uid:A}:null),children:[e.jsx(oe,{src:(r==null?void 0:r.photo)||((b=r==null?void 0:r.n)==null?void 0:b.photo)||"",name:R,size:"md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:R}),(r==null?void 0:r.type)!=="group"&&e.jsx(Ke,{online:I,lastSeen:L,loading:D})]}),(r==null?void 0:r.type)!=="group"&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:I?"Online":L?`Last seen ${he(L)}`:"Offline"})]})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(ht,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})},[r,R,I,L,D,A,i,l,j]),he=b=>{if(!b)return"Never";const $=b,p=Date.now()-$,S=Math.floor(p/6e4),M=Math.floor(S/60),C=Math.floor(M/24);return S<1?"Just now":S<60?`${S}m ago`:M<24?`${M}h ago`:C<7?`${C}d ago`:new Date($).toLocaleDateString()};return!r||!o?e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#1f2128] items-center justify-center text-gray-400",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(de,{size:64,className:"text-gray-200 dark:text-gray-700 mb-2"})}),e.jsx("p",{children:"Select a conversation to start chatting"})]}):e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#1f2128]",children:[fe,e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide",children:[O.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{children:"No messages yet. Start the conversation!"})}):O.map((b,$)=>{const u=$>0?O[$-1]:null,p=b.s===(t==null?void 0:t.uid),S=P(b.id),M=T(b.id);return e.jsx(Pt,{message:b,isCurrentUser:p,previousMessage:u,currentUserId:t==null?void 0:t.uid,chatId:o,linkPreviewData:g[b.id],messageStatus:S?"read":M?"delivered":"sent",onReaction:C=>me(b.id,C),onReply:()=>c(b),onEdit:()=>x(b),onDelete:C=>ve(b.id,C),onForward:()=>v(b),onSeshNxLinkClick:C=>w({isOpen:!0,url:C,previewData:null}),onUserClick:()=>j==null?void 0:j({uid:b.s})},b.id)}),e.jsx("div",{ref:h})]}),e.jsx(Et,{activeChatId:o,uid:t==null?void 0:t.uid,onSend:ce,replyingTo:k,editingMessage:m,onCancelReply:()=>c(null),onCancelEdit:()=>x(null),typingUsers:U,onTyping:te,onStopTyping:N}),d&&e.jsx(Ot,{message:d,conversations:a,onClose:()=>v(null),onForward:Ne}),f.isOpen&&e.jsx(Lt,{url:f.url,previewData:f.previewData,onClose:()=>w({isOpen:!1,url:"",previewData:null})})]})}function Se({title:t,value:s,icon:r,sub:a,bg:i="bg-white dark:bg-[#2c2e36]",text:l="text-gray-900 dark:text-white"}){return e.jsxs("div",{className:`${i} p-5 rounded-xl border border-gray-100 dark:border-gray-700 shadow-sm flex flex-col justify-between h-28`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-medium ${l==="text-white"?"text-blue-100":"text-gray-500"}`,children:t}),e.jsx("div",{className:`text-2xl font-extrabold ${l}`,children:s})]}),e.jsx("div",{className:"opacity-80",children:r})]}),a&&e.jsx("div",{className:"text-xs mt-auto opacity-75",children:a})]})}function Wt({chatId:t,onClose:s,onMediaSelect:r}){const[a,i]=n.useState([]),[l,j]=n.useState(!0),[g,y]=n.useState(null),[f,w]=n.useState("all"),k=Q(),c=t&&k?{chatId:t,limit:500}:"skip",m=le(_.messages.getMediaMessages,c);n.useEffect(()=>{if(!t||!k){i([]),j(!1);return}if(!m)return;const h=(m||[]).filter(o=>o.media&&!o.deleted&&!o.deletedForAll).map(o=>({id:o._id,...o.media||{},messageId:o._id,timestamp:o.timestamp,sender:o.senderName})).sort((o,R)=>(o.timestamp||0)-(R.timestamp||0));i(h),j(!1)},[t,k,m]);const x=f==="all"?a:a.filter(h=>f==="images"?h.type==="image":f==="videos"?h.type==="video":f==="audio"?h.type==="audio":f==="files"?h.type==="file":!0),d=h=>{y(h),r&&r(h)},v=h=>{const o=document.createElement("a");o.href=h.url,o.download=h.name||"download",o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)};return e.jsxs("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[80] p-4",children:[e.jsxs(G.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-[#2c2e36] rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between shrink-0",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Media Gallery"}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition",children:e.jsx(q,{size:20})})]}),e.jsx("div",{className:"p-3 border-b dark:border-gray-700 flex gap-2 overflow-x-auto scrollbar-hide shrink-0",children:[{key:"all",label:"All",icon:null},{key:"images",label:"Images",icon:Ee},{key:"videos",label:"Videos",icon:we},{key:"audio",label:"Audio",icon:ze},{key:"files",label:"Files",icon:ue}].map(h=>e.jsxs("button",{onClick:()=>w(h.key),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold whitespace-nowrap transition ${f===h.key?"bg-brand-blue text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200"}`,children:[h.icon&&e.jsx(h.icon,{size:16}),h.label,e.jsxs("span",{className:"text-xs opacity-70",children:["(",x.filter(o=>h.key==="all"||o.type===h.key).length,")"]})]},h.key))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4",children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-blue border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading media..."})]}):x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(Ee,{size:48,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No media found"})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3",children:x.map(h=>e.jsxs(G.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d(h),className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 cursor-pointer group",children:[h.type==="image"?e.jsx("img",{src:h.url,alt:"Media",className:"w-full h-full object-cover"}):h.type==="video"?e.jsx("video",{src:h.url,className:"w-full h-full object-cover"}):h.type==="audio"?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-purple-100 dark:bg-purple-900/30",children:e.jsx(ze,{size:32,className:"text-purple-600 dark:text-purple-400"})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-100 dark:bg-blue-900/30",children:e.jsx(ue,{size:32,className:"text-blue-600 dark:text-blue-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition flex items-center justify-center",children:e.jsx(Te,{size:20,className:"text-white opacity-0 group-hover:opacity-100 transition"})})]},h.id))})})]}),e.jsx(re,{children:g&&e.jsx(Qt,{media:g,onClose:()=>y(null),onDownload:v})})]})}function Qt({media:t,onClose:s,onDownload:r}){const[a,i]=n.useState([]),[l,j]=n.useState(0);n.useEffect(()=>{i([t]),j(0)},[t]);const g=()=>{l<a.length-1&&j(l+1)},y=()=>{l>0&&j(l-1)},f=a[l]||t;return e.jsx(G.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/95 z-[90] flex items-center justify-center",onClick:s,children:e.jsxs("div",{className:"relative max-w-7xl max-h-[90vh] w-full h-full flex items-center justify-center p-4",onClick:w=>w.stopPropagation(),children:[e.jsx("button",{onClick:s,className:"absolute top-4 right-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/70 transition z-10",children:e.jsx(q,{size:24})}),f.type==="image"&&e.jsx("img",{src:f.url,alt:"Media",className:"max-w-full max-h-full object-contain rounded-lg"}),f.type==="video"&&e.jsx("video",{src:f.url,controls:!0,className:"max-w-full max-h-full rounded-lg",autoPlay:!0}),f.type==="audio"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md",children:[e.jsx("div",{className:"w-32 h-32 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(ze,{size:48,className:"text-purple-600 dark:text-purple-400"})}),e.jsx("audio",{src:f.url,controls:!0,className:"w-full",autoPlay:!0}),e.jsx("p",{className:"text-center mt-4 text-sm text-gray-500",children:f.name})]}),f.type==="file"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md text-center",children:[e.jsx(ue,{size:64,className:"text-blue-600 dark:text-blue-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-bold dark:text-white mb-2",children:f.name}),e.jsx("a",{href:f.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block mt-4 px-6 py-2 bg-brand-blue text-white rounded-lg hover:bg-blue-600 transition",children:"Open File"})]}),a.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:y,disabled:l===0,className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 transition",children:e.jsx(gt,{size:24})}),e.jsx("button",{onClick:g,disabled:l===a.length-1,className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 transition",children:e.jsx(Ve,{size:24})})]}),e.jsx("button",{onClick:()=>r(f),className:"absolute bottom-4 left-1/2 -translate-x-1/2 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 transition",children:e.jsx(Te,{size:20})})]})})}function es({activeChat:t,onClose:s,currentUser:r}){const[a,i]=n.useState([]),[l,j]=n.useState({sessions:0,rating:0,responseTime:"N/A"}),[g,y]=n.useState(!0),[f,w]=n.useState(!1),[k,c]=n.useState(!1),m=t.type==="group",x=t.uid,d=t.name||t.n||"Unknown";n.useEffect(()=>{const o=async()=>{y(!0);try{i([])}catch(R){console.error("Failed to load details:",R)}y(!1)};t!=null&&t.id&&o()},[t.id,x,m,(r==null?void 0:r.id)||(r==null?void 0:r.uid)]);const v=async()=>{},h=()=>{alert("Please use the report option on their profile page for full moderation tools.")};return e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full md:w-80 bg-gray-800 shadow-xl z-20 flex flex-col transition-transform duration-300 ease-in-out border-l border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Details"}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-full transition duration-150","aria-label":"Close details",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 flex flex-col items-center border-b border-gray-700 bg-gray-800",children:[e.jsxs("div",{className:"relative w-24 h-24 rounded-full overflow-hidden mb-4 bg-gray-700 flex items-center justify-center shadow-lg border-4 border-gray-600",children:[e.jsx("img",{src:t.photo,className:"w-full h-full object-cover",onError:o=>o.target.src="",alt:d}),!t.photo&&(m?e.jsx(de,{className:"w-10 h-10 text-gray-500"}):e.jsx(Oe,{className:"w-10 h-10 text-gray-500"}))]}),e.jsx("h4",{className:"text-xl font-bold text-white text-center leading-tight",children:d}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2 flex items-center px-3 py-1 bg-gray-700 rounded-full",children:[m?e.jsx(de,{className:"w-3 h-3 mr-1"}):e.jsx(Ce,{className:"w-3 h-3 mr-1"}),m?"Group Chat":t.role||"Creative"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[!m&&e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3 tracking-wider",children:"Performance"}),g?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(ie,{className:"animate-spin text-brand-blue"})}):e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(Se,{title:"Sessions",value:l.sessions,icon:Ce,color:"text-blue-400"}),e.jsx(Se,{title:"Rating",value:l.rating,icon:Le,color:"text-yellow-400"}),e.jsx(Se,{title:"Reply Time",value:l.responseTime,icon:$e,color:"text-green-400"})]})]}),e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Shared Media"}),e.jsx("button",{onClick:()=>c(!0),className:"text-xs text-brand-blue hover:underline font-medium",children:"View All"})]}),a.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-2",children:a.slice(0,6).map((o,R)=>e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-700 cursor-pointer hover:opacity-80 transition",children:[o.type==="image"&&e.jsx("img",{src:o.url,className:"w-full h-full object-cover",alt:"Media"}),o.type==="video"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(we,{size:20,className:"text-gray-400"})})]},R))}):e.jsx("p",{className:"text-xs text-gray-500 text-center py-4",children:"No shared media yet"})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition",children:[e.jsx(bt,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{children:"Mute Notifications"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition",children:[e.jsx(pt,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{children:"Media Gallery"})]}),!m&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:v,disabled:f,className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-red-400 hover:bg-red-900/20 hover:text-red-300 rounded-lg transition disabled:opacity-50",children:[f?e.jsx(ie,{className:"w-4 h-4 animate-spin"}):e.jsx(yt,{className:"w-4 h-4"}),e.jsx("span",{children:"Block User"})]}),e.jsxs("button",{onClick:h,className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-red-400 hover:bg-red-900/20 hover:text-red-300 rounded-lg transition",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{children:"Report User"})]})]})]})]}),k&&e.jsx(Wt,{chatId:t.id,onClose:()=>c(!1)})]})}export{Xt as C,Se as S,oe as U,_ as a,Kt as b,Jt as c,Zt as d,es as e,Q as i,Ye as s,St as u};
