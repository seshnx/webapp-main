{"version":3,"mappings":"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","names":["StudioOverview","userData","stats","onNavigate","currentDate","setCurrentDate","useState","studioName","rooms","amenities","totalCapacity","sum","r","avgRate","quickStats","jsx","Home","Users","DollarSign","Star","pendingBookings","jsxs","MapPin","stat","i","AlertCircle","Calendar","CheckCircle","room","amenity","ChevronLeft","ChevronRight","MiniCalendar","_a","booking","bookings","year","month","today","firstDay","daysInMonth","days","getDayBookings","day","b","bookingDate","isToday","dayNames","dayBookings","hasBookings","hasConfirmed","hasPending","Panorama360Viewer","imageUrl","onClose","title","viewerRef","useRef","containerRef","isFullscreen","setIsFullscreen","React","useEffect","__vitePreload","n","pannellumModule","viewer","error","e","toggleFullscreen","handleFullscreenChange","Minimize2","Maximize2","X","FloorplanTools","activeTool","setActiveTool","onUndo","onRedo","canUndo","canRedo","onZoomIn","onZoomOut","onFitToView","onExportSVG","onExportPNG","onExportPDF","showGrid","toggleGrid","measurementUnit","setMeasurementUnit","scale","setScale","onBackgroundImageUpload","onAddRoomTemplate","tools","Move","Square","Box","DoorOpen","RectangleHorizontal","Ruler","Type","Circle","Triangle","RotateCw","t","tool","Icon","ZoomIn","ZoomOut","Grid","FileText","ImageIcon","calculateDistance","x1","y1","x2","y2","calculateArea","width","height","area","calculatePerimeter","perimeter","snapToGrid","x","y","gridSize","snapToObject","objects","threshold","snapped","minDist","obj","objX","objY","_b","objW","_c","objH","_d","point","dist","formatMeasurement","pixels","unit","value","exportSVG","svgElement","svgString","svgBlob","url","exportPNG","canvas","ctx","img","resolve","reject","blob","generateId","prefix","FloorplanPropertyPanel","selectedItem","onUpdate","isRoom","isStructure","isWall","isDoor","isWindow","isFurniture","layout","handleUpdate","updates","FloorplanContextMenu","onAction","canCopy","canPaste","canCut","canDelete","canRotate","canFlip","isLocked","menuItems","Copy","Clipboard","Scissors","Trash2","FlipHorizontal","FlipVertical","Unlock","Lock","BringToFront","SendToBack","Fragment","item","index","FloorplanLayerPanel","layers","onLayerToggle","onLayerLock","layerList","Layers","layer","layerData","Eye","EyeOff","DoorComponent","door","isSelected","onClick","onMouseDown","rotation","subType","direction","centerX","centerY","arcRadius","WindowComponent","window","FurnitureComponent","furniture","useUndoRedo","initialState","maxHistory","state","setState","historyRef","historyIndexRef","setStateWithHistory","useCallback","newState","undo","redo","clearHistory","SNAP_GRID","getDistanceToLineSegment","px","py","A","B","C","D","dot","len_sq","param","xx","yy","dx","dy","FloorplanEditor","propWalls","propStructures","onRoomClick","onLayoutChange","onWallsChange","onStructuresChange","svgRef","isDragging","setIsDragging","isResizing","setIsResizing","cursorOffset","setCursorOffset","isPanning","setIsPanning","panOffset","setPanOffset","activeRoomId","setActiveRoomId","activeStructureId","setActiveStructureId","activeWallId","setActiveWallId","activeDoorId","setActiveDoorId","activeWindowId","setActiveWindowId","activeFurnitureId","setActiveFurnitureId","selectedItems","setSelectedItems","draggingWallHandle","setDraggingWallHandle","viewing360Room","setViewing360Room","contextMenu","setContextMenu","showPropertyPanel","setShowPropertyPanel","walls","setWalls","structures","setStructures","doors","setDoors","windows","setWindows","setFurniture","textLabels","setTextLabels","measurements","setMeasurements","backgroundImage","setBackgroundImage","clipboard","setClipboard","customShapes","setCustomShapes","setLayers","roomTemplates","setRoomTemplates","wallStartPoint","setWallStartPoint","measureStartPoint","setMeasureStartPoint","currentMeasurement","setCurrentMeasurement","zoom","setZoom","viewBox","setViewBox","setShowGrid","setGridSize","snapToObjects","setSnapToObjects","floorplanState","setHistoryState","getCoords","applyZoom","rect","clientX","clientY","allObjects","w","commitWalls","newWalls","saveToHistory","commitStructures","newStructures","commitDoors","newDoors","commitWindows","newWindows","commitFurniture","newFurniture","handleDelete","newStructs","s","d","f","handleCopy","handlePaste","offset","newStruct","newWall","handleCut","handleKeyDown","handleZoomIn","handleZoomOut","handleFitToView","startDragRoom","startResizeRoom","startPan","stopPan","addStructure","startDragStructure","struct","startResizeStructure","startDragWallHandle","wallId","selectWall","handleMouseMove","previewWall","prev","newPos","newLayout","minSize","distance","deltaX","deltaY","stopInteraction","handleCanvasClick","newMeasurement","newDoor","newWindow","newLabel","newCircle","toast","handleExportSVG","a","handleExportPNG","handleExportPDF","handleBackgroundImageUpload","file","reader","event","setTool","addRoom","template","baseRoom","newRoom","WallSegment","wall","isPreview","LayoutShape","data","name","rate","label","isActive","checkCornerLocked","cx","cy","tlSharp","trSharp","brSharp","blSharp","pathD","getSelectedItem","handlePropertyUpdate","updated","handleLayerToggle","layerKey","handleLayerLock","handleContextMenuAction","action","currentRotation","BoxSelect","Zap","rm","_e","_f","_g","_h","shape","p","_i","measure","_j","_k","StudioRooms","user","useLanguage","setRooms","editingRoom","setEditingRoom","isAdding","setIsAdding","saving","setSaving","expandedRoom","setExpandedRoom","viewMode","setViewMode","emptyRoom","handleSave","updatedRooms","updatedWalls","updatedStructures","supabase","toastId","userId","handleLayoutChange","roomId","handleWallsChange","handleStructuresChange","handleRoomClick","roomIndex","handleEditRoom","handleAddRoom","handleSaveRoom","handleDeleteRoom","_","handleDuplicateRoom","roomToCopy","handleCancelEdit","ROOM_AMENITIES","roomsWithLayout","LayoutGrid","List","Map","Plus","RoomEditor","Mic","Edit2","ChevronUp","ChevronDown","setRoom","onSave","onCancel","isNew","roomAmenities","uploadImage","uploading","useImageUpload","show360Viewer","setShow360Viewer","fileInputRef","handleAmenityToggle","current","handle360ImageUpload","path","handleRemove360Image","RoomEquipmentManager","equipment","Loader2","Upload","Save","onChange","setSelectedItem","quantity","setQuantity","handleAddEquipment","newEquipment","handleRemoveEquipment","handleUpdateQuantity","newQuantity","EquipmentAutocomplete","StudioGallery","photos","setPhotos","uploadProgress","setUploadProgress","selectedPhoto","setSelectedPhoto","draggingIndex","setDraggingIndex","uploadMedia","useMediaUpload","savePhotos","updatedPhotos","handleUpload","files","maxPhotos","newPhotos","timestamp","result","photoIndex","photo","handleSetCover","handleDragStart","handleDragOver","reorderedPhotos","draggedPhoto","handleDragEnd","handleFileDrop","coverPhoto","Image","DAYS_OF_WEEK","DEFAULT_HOURS","StudioAvailability","hours","setHours","blackoutDates","setBlackoutDates","newBlackout","setNewBlackout","showAddBlackout","setShowAddBlackout","updateDayHours","dayId","field","toggleDayClosed","copyToAllWeekdays","sourceHours","weekdays","newHours","addBlackoutDate","blackout","removeBlackoutDate","id","formatTime","time","h","m","hour","ampm","totalWeeklyHours","total","dayHours","openH","openM","closeH","closeM","openMinutes","closeMinutes","Clock","Sun","Moon","StudioPolicies","policies","setPolicies","_l","_m","_n","_o","_p","_q","_r","_s","_t","_u","expandedSection","setExpandedSection","updatePolicy","key","CANCELLATION_POLICIES","Section","children","isExpanded","AlertTriangle","policy","Shield","notifyBookingStatusChange","newStatus","targetUserId","studioUserId","notification","err","apiUrl","emailSubject","emailHtml","emailError","pushError","checkBookingConflicts","conflictingBookings","conflicts","cb","cbDate","parseBookingDate","bookingStart","bookingEnd","cbStart","cbEnd","validateStatusTransition","currentStatus","allowedStatuses","dateValue","parsed","trackBookingHistory","bookingId","oldStatus","changedBy","notes","historyEntry","calculateCancellationFee","cancellationPolicy","now","hoursUntilBooking","amount","fee","feePercentage","refund","scheduleBookingReminder","reminderHours","reminders","reminderTime","RecurringBookingModal","onSuccess","recurrenceType","setRecurrenceType","interval","setInterval","daysOfWeek","setDaysOfWeek","endDate","setEndDate","maxOccurrences","setMaxOccurrences","loading","setLoading","handleDayToggle","handleSubmit","nextOccurrence","currentDay","nextDay","daysToAdd","recurrencePattern","recurringBooking","Repeat","MultiRoomBookingModal","selectedRooms","setSelectedRooms","roomTimeSlots","setRoomTimeSlots","start","end","initialSlots","handleRoomToggle","handleTimeChange","roomBookings","slot","startTime","endTime","UnifiedCalendar","onDateChange","blockedDates","onDateClick","onBookingClick","view","onViewChange","showControls","className","localDate","setLocalDate","localView","setLocalView","displayDate","displayView","handleDateChange","newDate","handleViewChange","newView","navigateDate","goToToday","getWeekStart","date","diff","getWeekDates","weekStart","week","getDayBlocks","blockDate","formatDateRange","v","MonthView","WeekView","DayView","Ban","dayDate","isPast","dayBlocks","isBlocked","weekDates","timeSlots","dayIndex","hourIndex","slotStart","slotEnd","slotBookings","bookingTime","block","bi","bookingsByHour","useMemo","grouped","timeSlot","blockStart","blockEnd","StudioBookings","onNavigateToChat","setBookings","setBlockedDates","filter","setFilter","searchTerm","setSearchTerm","selectedBooking","setSelectedBooking","updating","setUpdating","calendarView","setCalendarView","showBlockModal","setShowBlockModal","selectedDate","setSelectedDate","blockReason","setBlockReason","blockTimeSlot","setBlockTimeSlot","customStartTime","setCustomStartTime","customEndTime","setCustomEndTime","showRecurringModal","setShowRecurringModal","showMultiRoomModal","setShowMultiRoomModal","selectedBookingForRecurring","setSelectedBookingForRecurring","selectedBookingForRooms","setSelectedBookingForRooms","channel","loadBookings","bookingsData","bookingsList","parsedDate","loadBlockedDates","blockedData","blockedList","handleUpdateStatus","currentBooking","fetchError","validation","conflictCheck","conflictNames","c","statusTimestampFields","updateData","timestampField","captureResponse","errorData","paymentError","policyData","feeCalculation","refundAmount","refundResponse","message","refundError","handleBlockDate","handleUnblockDate","blockedId","openBlockModal","filteredBookings","bookingStatus","filterStatus","matchesFilter","matchesSearch","groupedBookings","groups","dateKey","pendingCount","todayBookings","upcomingRevenue","RefreshCw","Search","status","dateBookings","statusConfig","Check","MessageSquare","User","mapCategoryToId","dbCategory","categoryLower","categoryMap","matched","EQUIP_CATEGORIES","cat","StudioEquipment","setEquipment","categoryFilter","setCategoryFilter","showAddModal","setShowAddModal","editingItem","setEditingItem","updatedEquipment","handleAddItem","newItem","itemWithId","handleUpdateItem","updatedItem","handleDeleteItem","itemId","filteredEquipment","matchesCategory","groupedEquipment","categories","totalItems","totalValue","getCategoryIcon","category","Speaker","Monitor","Server","Package","getCategoryLabel","categoryId","items","CategoryIcon","EquipmentModal","formData","setFormData","handleAutocompleteSelect","selected","mappedCategory","settingsSchema","z.object","z.string","z.number","z.literal","z.array","z.boolean","StudioSettings","register","control","watch","setValue","errors","isDirty","useForm","zodResolver","watchedAmenities","watchHideAddress","toggleAmenity","onSubmit","inputClass","Settings","Controller","AddressAutocomplete","addressData","Mail","Wifi","AMENITIES_DATA","TABS","StudioManager","activeTab","setActiveTab","setStats","localUserData","setLocalUserData","pending","recent","revenue","handleNavigate","tabId","renderContent","commonProps","activeTabInfo","Briefcase","tab","hasBadge","Step1Metadata","setData","RELEASE_TYPES","DDEX_GENRES","g","Step2Artwork","preview","setPreview","validationMsg","setValidationMsg","handleFile","res","Step3Tracks","addTrack","newTrack","updatedTracks","finalTracks","removeTrack","updateTrackMeta","val","track","idx","Step4Stores","toggleStore","storeId","toggleAll","DISTRIBUTION_STORES","store","Info","ReleaseBuilder","initialData","step","setStep","submitting","setSubmitting","isStepValid","handleFinalSubmit","payload","DistributionManager","setView","releases","setReleases","editingRelease","setEditingRelease","loadReleases","releasesData","releaseId","handleEdit","release","Globe","Disc","Music","LabelOverviewCard","formatCurrency","formatNumber","Activity","StudioOverviewCard","DistributionOverviewCard","Play","BusinessOverview","metrics","setMetrics","isStudio","isLabel","isArtist","hasDistribution","results","labelData","getLabelMetrics","studioData","getStudioMetrics","distData","getDistributionMetrics","quickActions","Settings2","BusinessCenter","tabs","LabelDashboard","IconComponent"],"ignoreList":[],"sources":["../../src/components/studio/StudioOverview.jsx","../../src/components/studio/Panorama360Viewer.jsx","../../src/components/studio/FloorplanTools.jsx","../../src/utils/floorplanUtils.js","../../src/components/studio/FloorplanPropertyPanel.jsx","../../src/components/studio/FloorplanContextMenu.jsx","../../src/components/studio/FloorplanLayerPanel.jsx","../../src/components/studio/DoorComponent.jsx","../../src/components/studio/WindowComponent.jsx","../../src/components/studio/FurnitureComponent.jsx","../../src/hooks/useUndoRedo.js","../../src/components/studio/FloorplanEditor.jsx","../../src/components/studio/StudioRooms.jsx","../../src/components/studio/StudioGallery.jsx","../../src/components/studio/StudioAvailability.jsx","../../src/components/studio/StudioPolicies.jsx","../../src/utils/bookingNotifications.js","../../src/utils/bookingReminders.js","../../src/components/studio/RecurringBookingModal.jsx","../../src/components/studio/MultiRoomBookingModal.jsx","../../src/components/shared/UnifiedCalendar.jsx","../../src/components/studio/StudioBookings.jsx","../../src/components/studio/StudioEquipment.jsx","../../src/components/studio/StudioSettings.jsx","../../src/components/StudioManager.jsx","../../src/components/distribution/ReleaseBuilder.jsx","../../src/components/marketplace/DistributionManager.jsx","../../src/components/business/LabelOverviewCard.jsx","../../src/components/business/StudioOverviewCard.jsx","../../src/components/business/DistributionOverviewCard.jsx","../../src/components/business/BusinessOverview.jsx","../../src/components/BusinessCenter.jsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { \r\n    Home, MapPin, DollarSign, Users, Calendar, \r\n    AlertCircle, CheckCircle, Star, ChevronLeft, ChevronRight\r\n} from 'lucide-react';\r\n\r\n/**\r\n * StudioOverview - Dashboard view for studio stats and quick actions\r\n */\r\nexport default function StudioOverview({ userData, stats, onNavigate }) {\r\n    const [currentDate, setCurrentDate] = useState(new Date());\r\n    const studioName = userData?.studioName || userData?.profileName || 'My Studio';\r\n    const rooms = userData?.rooms || [];\r\n    const amenities = userData?.amenities || [];\r\n    \r\n    // Calculate stats\r\n    const totalCapacity = rooms.reduce((sum, r) => sum + (r.capacity || 0), 0);\r\n    const avgRate = rooms.length > 0 \r\n        ? Math.round(rooms.reduce((sum, r) => sum + (r.rate || 0), 0) / rooms.length) \r\n        : 0;\r\n\r\n    const quickStats = [\r\n        { \r\n            label: 'Active Rooms', \r\n            value: rooms.length, \r\n            icon: <Home size={20} />, \r\n            color: 'blue',\r\n            onClick: () => onNavigate('rooms')\r\n        },\r\n        { \r\n            label: 'Total Capacity', \r\n            value: `${totalCapacity} ppl`, \r\n            icon: <Users size={20} />, \r\n            color: 'green' \r\n        },\r\n        { \r\n            label: 'Avg. Rate', \r\n            value: `$${avgRate}/hr`, \r\n            icon: <DollarSign size={20} />, \r\n            color: 'purple' \r\n        },\r\n        { \r\n            label: 'Amenities', \r\n            value: amenities.length, \r\n            icon: <Star size={20} />, \r\n            color: 'amber' \r\n        },\r\n    ];\r\n\r\n    const pendingBookings = stats?.pendingBookings || 0;\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Studio Header */}\r\n            <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-8 text-white relative overflow-hidden\">\r\n                <div className=\"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10\"></div>\r\n                <div className=\"relative z-10\">\r\n                    <div className=\"flex items-center gap-3 mb-2\">\r\n                        <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm\">\r\n                            <Home size={24} />\r\n                        </div>\r\n                        <div>\r\n                            <h1 className=\"text-2xl font-bold\">{studioName}</h1>\r\n                            <p className=\"text-blue-100 text-sm flex items-center gap-1\">\r\n                                <MapPin size={14} />\r\n                                {userData?.city && userData?.state \r\n                                    ? `${userData.city}, ${userData.state}` \r\n                                    : 'Location not set'}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                    {userData?.studioDescription && (\r\n                        <p className=\"text-blue-100 text-sm mt-4 max-w-2xl line-clamp-2\">\r\n                            {userData.studioDescription}\r\n                        </p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Quick Stats */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                {quickStats.map((stat, i) => (\r\n                    <button\r\n                        key={i}\r\n                        onClick={stat.onClick}\r\n                        className={`bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm text-left transition-all ${stat.onClick ? 'hover:shadow-md hover:border-brand-blue cursor-pointer' : ''}`}\r\n                    >\r\n                        <div className={`w-10 h-10 rounded-lg bg-${stat.color}-100 dark:bg-${stat.color}-900/20 flex items-center justify-center text-${stat.color}-600 dark:text-${stat.color}-400 mb-3`}>\r\n                            {stat.icon}\r\n                        </div>\r\n                        <div className=\"text-2xl font-bold dark:text-white\">{stat.value}</div>\r\n                        <div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase font-medium tracking-wide\">\r\n                            {stat.label}\r\n                        </div>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Alerts & Actions */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                {/* Pending Actions */}\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                    <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]\">\r\n                        <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                            <AlertCircle size={18} className=\"text-amber-500\" />\r\n                            Pending Actions\r\n                        </h3>\r\n                    </div>\r\n                    <div className=\"p-4 space-y-3\">\r\n                        {pendingBookings > 0 ? (\r\n                            <button \r\n                                onClick={() => onNavigate('bookings')}\r\n                                className=\"w-full flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30 transition\"\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <Calendar className=\"text-amber-600\" size={18} />\r\n                                    <span className=\"text-sm font-medium dark:text-amber-300\">\r\n                                        {pendingBookings} Pending Booking{pendingBookings > 1 ? 's' : ''}\r\n                                    </span>\r\n                                </div>\r\n                                <span className=\"text-xs text-amber-600 font-bold\">Review </span>\r\n                            </button>\r\n                        ) : (\r\n                            <div className=\"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\">\r\n                                <CheckCircle className=\"text-green-600\" size={18} />\r\n                                <span className=\"text-sm text-green-700 dark:text-green-300\">All caught up!</span>\r\n                            </div>\r\n                        )}\r\n\r\n                        {!userData?.studioDescription && (\r\n                            <button \r\n                                onClick={() => onNavigate('settings')}\r\n                                className=\"w-full flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition\"\r\n                            >\r\n                                <span className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">Add studio description</span>\r\n                                <span className=\"text-xs text-blue-600 font-bold\">Setup </span>\r\n                            </button>\r\n                        )}\r\n\r\n                        {rooms.length === 0 && (\r\n                            <button \r\n                                onClick={() => onNavigate('rooms')}\r\n                                className=\"w-full flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition\"\r\n                            >\r\n                                <span className=\"text-sm font-medium text-purple-700 dark:text-purple-300\">Add your first room</span>\r\n                                <span className=\"text-xs text-purple-600 font-bold\">Add </span>\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Room Summary */}\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                    <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center\">\r\n                        <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                            <Home size={18} className=\"text-brand-blue\" />\r\n                            Rooms\r\n                        </h3>\r\n                        <button \r\n                            onClick={() => onNavigate('rooms')}\r\n                            className=\"text-xs text-brand-blue font-bold hover:underline\"\r\n                        >\r\n                            Manage \r\n                        </button>\r\n                    </div>\r\n                    <div className=\"p-4\">\r\n                        {rooms.length === 0 ? (\r\n                            <div className=\"text-center py-6 text-gray-500\">\r\n                                <Home size={32} className=\"mx-auto mb-2 opacity-30\" />\r\n                                <p className=\"text-sm\">No rooms configured yet</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-2\">\r\n                                {rooms.slice(0, 4).map((room, i) => (\r\n                                    <div \r\n                                        key={i}\r\n                                        className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg\"\r\n                                    >\r\n                                        <div>\r\n                                            <div className=\"font-medium dark:text-white text-sm\">{room.name}</div>\r\n                                            <div className=\"text-xs text-gray-500\">\r\n                                                {room.capacity} people  {room.equipment ? room.equipment.split(',').length : 0} gear items\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"text-right\">\r\n                                            <div className=\"font-bold text-green-600 dark:text-green-400\">${room.rate}/hr</div>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                                {rooms.length > 4 && (\r\n                                    <p className=\"text-xs text-center text-gray-400 pt-2\">\r\n                                        +{rooms.length - 4} more rooms\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Amenities Preview */}\r\n            {amenities.length > 0 && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-5\">\r\n                    <h3 className=\"font-bold dark:text-white mb-3 flex items-center gap-2\">\r\n                        <Star size={18} className=\"text-amber-500\" />\r\n                        Studio Amenities\r\n                    </h3>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                        {amenities.map((amenity, i) => (\r\n                            <span \r\n                                key={i}\r\n                                className=\"px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium\"\r\n                            >\r\n                                {amenity}\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Calendar Preview */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Calendar size={18} className=\"text-brand-blue\" />\r\n                        Booking Calendar\r\n                    </h3>\r\n                    <button \r\n                        onClick={() => onNavigate('bookings')}\r\n                        className=\"text-xs text-brand-blue font-bold hover:underline\"\r\n                    >\r\n                        View All \r\n                    </button>\r\n                </div>\r\n                <div className=\"p-4\">\r\n                    {/* Month Navigation */}\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <button \r\n                            onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1))}\r\n                            className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                        >\r\n                            <ChevronLeft size={18} className=\"text-gray-500\" />\r\n                        </button>\r\n                        <span className=\"font-bold dark:text-white\">\r\n                            {currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}\r\n                        </span>\r\n                        <button \r\n                            onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1))}\r\n                            className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                        >\r\n                            <ChevronRight size={18} className=\"text-gray-500\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Calendar Grid */}\r\n                    <MiniCalendar \r\n                        currentDate={currentDate} \r\n                        bookings={stats?.recentBookings || []} \r\n                        onNavigate={onNavigate}\r\n                    />\r\n\r\n                    {/* Upcoming Bookings */}\r\n                    {stats?.recentBookings?.length > 0 && (\r\n                        <div className=\"mt-4 pt-4 border-t dark:border-gray-700\">\r\n                            <div className=\"text-xs font-bold text-gray-500 uppercase mb-2\">Upcoming Sessions</div>\r\n                            <div className=\"space-y-2\">\r\n                                {stats.recentBookings.slice(0, 3).map((booking, i) => (\r\n                                    <div \r\n                                        key={i}\r\n                                        className=\"flex items-center justify-between p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg text-sm\"\r\n                                    >\r\n                                        <div>\r\n                                            <span className=\"font-medium dark:text-white\">{booking.clientName || 'Client'}</span>\r\n                                            <span className=\"text-gray-500 ml-2\">\r\n                                                {new Date(booking.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n                                            </span>\r\n                                        </div>\r\n                                        <span className={`text-xs px-2 py-0.5 rounded-full ${\r\n                                            booking.status === 'confirmed' \r\n                                                ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400' \r\n                                                : 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400'\r\n                                        }`}>\r\n                                            {booking.status || 'pending'}\r\n                                        </span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// Mini Calendar Component\r\nfunction MiniCalendar({ currentDate, bookings, onNavigate }) {\r\n    const year = currentDate.getFullYear();\r\n    const month = currentDate.getMonth();\r\n    const today = new Date();\r\n    \r\n    // Get first day of month and number of days\r\n    const firstDay = new Date(year, month, 1).getDay();\r\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\r\n    \r\n    // Create calendar days array\r\n    const days = [];\r\n    for (let i = 0; i < firstDay; i++) {\r\n        days.push(null);\r\n    }\r\n    for (let i = 1; i <= daysInMonth; i++) {\r\n        days.push(i);\r\n    }\r\n    \r\n    // Check if a day has bookings\r\n    const getDayBookings = (day) => {\r\n        if (!day) return [];\r\n        const dayDate = new Date(year, month, day);\r\n        return bookings.filter(b => {\r\n            const bookingDate = new Date(b.date);\r\n            return bookingDate.getDate() === day && \r\n                   bookingDate.getMonth() === month && \r\n                   bookingDate.getFullYear() === year;\r\n        });\r\n    };\r\n    \r\n    const isToday = (day) => {\r\n        return day === today.getDate() && \r\n               month === today.getMonth() && \r\n               year === today.getFullYear();\r\n    };\r\n    \r\n    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\n    \r\n    return (\r\n        <div>\r\n            {/* Day Headers */}\r\n            <div className=\"grid grid-cols-7 gap-1 mb-2\">\r\n                {dayNames.map(day => (\r\n                    <div key={day} className=\"text-center text-xs font-bold text-gray-400 py-1\">\r\n                        {day}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            \r\n            {/* Calendar Days */}\r\n            <div className=\"grid grid-cols-7 gap-1\">\r\n                {days.map((day, i) => {\r\n                    const dayBookings = getDayBookings(day);\r\n                    const hasBookings = dayBookings.length > 0;\r\n                    const hasConfirmed = dayBookings.some(b => b.status === 'confirmed');\r\n                    const hasPending = dayBookings.some(b => b.status === 'pending');\r\n                    \r\n                    return (\r\n                        <button\r\n                            key={i}\r\n                            onClick={() => day && hasBookings && onNavigate('bookings')}\r\n                            disabled={!day}\r\n                            className={`aspect-square flex flex-col items-center justify-center rounded-lg text-sm relative transition ${\r\n                                !day ? '' :\r\n                                isToday(day) ? 'bg-brand-blue text-white font-bold' :\r\n                                hasBookings ? 'bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 cursor-pointer' :\r\n                                'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                            }`}\r\n                        >\r\n                            {day}\r\n                            {hasBookings && !isToday(day) && (\r\n                                <div className=\"flex gap-0.5 mt-0.5\">\r\n                                    {hasConfirmed && <span className=\"w-1.5 h-1.5 bg-green-500 rounded-full\"></span>}\r\n                                    {hasPending && <span className=\"w-1.5 h-1.5 bg-amber-500 rounded-full\"></span>}\r\n                                </div>\r\n                            )}\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n            \r\n            {/* Legend */}\r\n            <div className=\"flex items-center gap-4 mt-3 text-xs text-gray-500\">\r\n                <div className=\"flex items-center gap-1\">\r\n                    <span className=\"w-2 h-2 bg-green-500 rounded-full\"></span>\r\n                    Confirmed\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                    <span className=\"w-2 h-2 bg-amber-500 rounded-full\"></span>\r\n                    Pending\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useEffect, useRef } from 'react';\r\nimport { X, Maximize2, Minimize2 } from 'lucide-react';\r\n\r\n/**\r\n * Panorama360Viewer - 360-degree image viewer component using Pannellum\r\n * Supports both equirectangular and cubemap formats\r\n */\r\nexport default function Panorama360Viewer({ imageUrl, onClose, title = '360 View' }) {\r\n    const viewerRef = useRef(null);\r\n    const containerRef = useRef(null);\r\n    const [isFullscreen, setIsFullscreen] = React.useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!imageUrl || !containerRef.current) return;\r\n\r\n        // Dynamically import pannellum\r\n        Promise.all([\r\n            import('pannellum'),\r\n            import('pannellum/build/pannellum.css')\r\n        ]).then(([pannellumModule]) => {\r\n            // Pannellum exports as default\r\n            const pannellum = pannellumModule.default || pannellumModule;\r\n            \r\n            // Initialize Pannellum viewer\r\n            const viewer = pannellum.viewer(containerRef.current, {\r\n                type: 'equirectangular',\r\n                panorama: imageUrl,\r\n                autoLoad: true,\r\n                autoRotate: 0,\r\n                compass: true,\r\n                showControls: true,\r\n                keyboardZoom: true,\r\n                mouseZoom: true,\r\n                hfov: 100,\r\n                minHfov: 50,\r\n                maxHfov: 120,\r\n            });\r\n\r\n            viewerRef.current = viewer;\r\n        }).catch((error) => {\r\n            console.error('Failed to load pannellum:', error);\r\n        });\r\n\r\n        return () => {\r\n            if (viewerRef.current) {\r\n                try {\r\n                    viewerRef.current.destroy();\r\n                } catch (e) {\r\n                    console.error('Error destroying viewer:', e);\r\n                }\r\n            }\r\n        };\r\n    }, [imageUrl]);\r\n\r\n    const toggleFullscreen = () => {\r\n        if (!containerRef.current) return;\r\n\r\n        if (!isFullscreen) {\r\n            if (containerRef.current.requestFullscreen) {\r\n                containerRef.current.requestFullscreen();\r\n            } else if (containerRef.current.webkitRequestFullscreen) {\r\n                containerRef.current.webkitRequestFullscreen();\r\n            } else if (containerRef.current.mozRequestFullScreen) {\r\n                containerRef.current.mozRequestFullScreen();\r\n            } else if (containerRef.current.msRequestFullscreen) {\r\n                containerRef.current.msRequestFullscreen();\r\n            }\r\n        } else {\r\n            if (document.exitFullscreen) {\r\n                document.exitFullscreen();\r\n            } else if (document.webkitExitFullscreen) {\r\n                document.webkitExitFullscreen();\r\n            } else if (document.mozCancelFullScreen) {\r\n                document.mozCancelFullScreen();\r\n            } else if (document.msExitFullscreen) {\r\n                document.msExitFullscreen();\r\n            }\r\n        }\r\n        setIsFullscreen(!isFullscreen);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const handleFullscreenChange = () => {\r\n            setIsFullscreen(!!document.fullscreenElement);\r\n        };\r\n\r\n        document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n        document.addEventListener('mozfullscreenchange', handleFullscreenChange);\r\n        document.addEventListener('MSFullscreenChange', handleFullscreenChange);\r\n\r\n        return () => {\r\n            document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n            document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n            document.removeEventListener('mozfullscreenchange', handleFullscreenChange);\r\n            document.removeEventListener('MSFullscreenChange', handleFullscreenChange);\r\n        };\r\n    }, []);\r\n\r\n    if (!imageUrl) {\r\n        return (\r\n            <div className=\"w-full h-64 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center\">\r\n                <p className=\"text-gray-500 dark:text-gray-400\">No 360 image available</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"relative w-full rounded-lg overflow-hidden border dark:border-gray-700 bg-black\">\r\n            {/* Header Controls */}\r\n            <div className=\"absolute top-0 left-0 right-0 z-10 bg-gradient-to-b from-black/70 to-transparent p-3 flex justify-between items-center\">\r\n                <h3 className=\"text-white font-semibold text-sm\">{title}</h3>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button\r\n                        onClick={toggleFullscreen}\r\n                        className=\"p-2 bg-black/50 hover:bg-black/70 rounded-lg text-white transition\"\r\n                        title={isFullscreen ? 'Exit Fullscreen' : 'Fullscreen'}\r\n                    >\r\n                        {isFullscreen ? <Minimize2 size={18} /> : <Maximize2 size={18} />}\r\n                    </button>\r\n                    {onClose && (\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-2 bg-black/50 hover:bg-black/70 rounded-lg text-white transition\"\r\n                            title=\"Close\"\r\n                        >\r\n                            <X size={18} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Pannellum Container */}\r\n            <div\r\n                ref={containerRef}\r\n                className=\"w-full h-96\"\r\n                style={{ minHeight: '400px' }}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport {\r\n    Move, Square, Circle, Triangle, Type, Ruler, DoorOpen, RectangleHorizontal,\r\n    Box, RotateCw, FlipHorizontal, FlipVertical, ZoomIn, ZoomOut,\r\n    Maximize2, Download, FileText, Image as ImageIcon, Layers,\r\n    Grid, Lock, Unlock, AlignLeft, AlignCenter, AlignRight\r\n} from 'lucide-react';\r\n\r\n/**\r\n * FloorplanTools - Toolbar component for floor plan editor\r\n */\r\nexport default function FloorplanTools({\r\n    activeTool,\r\n    setActiveTool,\r\n    onUndo,\r\n    onRedo,\r\n    canUndo,\r\n    canRedo,\r\n    onZoomIn,\r\n    onZoomOut,\r\n    onFitToView,\r\n    onExportSVG,\r\n    onExportPNG,\r\n    onExportPDF,\r\n    showGrid,\r\n    toggleGrid,\r\n    measurementUnit,\r\n    setMeasurementUnit,\r\n    scale,\r\n    setScale,\r\n    onBackgroundImageUpload,\r\n    onAddRoomTemplate\r\n}) {\r\n    const tools = [\r\n        { id: 'select', icon: Move, label: 'Select', group: 'basic' },\r\n        { id: 'wall', icon: Square, label: 'Wall', group: 'basic' },\r\n        { id: 'room', icon: Square, label: 'Room', group: 'basic' },\r\n        { id: 'structure', icon: Box, label: 'Area', group: 'basic' },\r\n        { id: 'door', icon: DoorOpen, label: 'Door', group: 'elements' },\r\n        { id: 'window', icon: RectangleHorizontal, label: 'Window', group: 'elements' },\r\n        { id: 'furniture', icon: Box, label: 'Furniture', group: 'elements' },\r\n        { id: 'measure', icon: Ruler, label: 'Measure', group: 'tools' },\r\n        { id: 'text', icon: Type, label: 'Text', group: 'tools' },\r\n        { id: 'circle', icon: Circle, label: 'Circle', group: 'shapes' },\r\n        { id: 'polygon', icon: Triangle, label: 'Polygon', group: 'shapes' },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"flex flex-col gap-2 p-2 bg-white dark:bg-[#2c2e36] border-r dark:border-gray-700\">\r\n            {/* Undo/Redo */}\r\n            <div className=\"flex gap-1 pb-2 border-b dark:border-gray-700\">\r\n                <button\r\n                    onClick={onUndo}\r\n                    disabled={!canUndo}\r\n                    className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50\"\r\n                    title=\"Undo (Ctrl+Z)\"\r\n                >\r\n                    <RotateCw size={18} className=\"rotate-180\" />\r\n                </button>\r\n                <button\r\n                    onClick={onRedo}\r\n                    disabled={!canRedo}\r\n                    className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50\"\r\n                    title=\"Redo (Ctrl+Shift+Z)\"\r\n                >\r\n                    <RotateCw size={18} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Basic Tools */}\r\n            <div className=\"space-y-1\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Basic</div>\r\n                {tools.filter(t => t.group === 'basic').map(tool => {\r\n                    const Icon = tool.icon;\r\n                    return (\r\n                        <button\r\n                            key={tool.id}\r\n                            onClick={() => setActiveTool(tool.id)}\r\n                            className={`w-full p-2 rounded flex items-center gap-2 text-sm transition ${\r\n                                activeTool === tool.id\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                            }`}\r\n                            title={tool.label}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"text-xs\">{tool.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n                {/* Room Templates */}\r\n                <div className=\"pt-2 border-t dark:border-gray-700\">\r\n                    <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Templates</div>\r\n                    <div className=\"space-y-1\">\r\n                        <button\r\n                            onClick={() => {\r\n                                // Add room from template\r\n                                if (onAddRoomTemplate) {\r\n                                    onAddRoomTemplate({ name: 'Control Room', width: 200, height: 150, color: '#3B82F6' });\r\n                                }\r\n                            }}\r\n                            className=\"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                        >\r\n                            Control Room\r\n                        </button>\r\n                        <button\r\n                            onClick={() => {\r\n                                if (onAddRoomTemplate) {\r\n                                    onAddRoomTemplate({ name: 'Live Room', width: 300, height: 250, color: '#10B981' });\r\n                                }\r\n                            }}\r\n                            className=\"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                        >\r\n                            Live Room\r\n                        </button>\r\n                        <button\r\n                            onClick={() => {\r\n                                if (onAddRoomTemplate) {\r\n                                    onAddRoomTemplate({ name: 'Isolation Booth', width: 120, height: 120, color: '#F59E0B' });\r\n                                }\r\n                            }}\r\n                            className=\"w-full p-1.5 text-xs rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                        >\r\n                            Isolation Booth\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Elements */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Elements</div>\r\n                {tools.filter(t => t.group === 'elements').map(tool => {\r\n                    const Icon = tool.icon;\r\n                    return (\r\n                        <button\r\n                            key={tool.id}\r\n                            onClick={() => setActiveTool(tool.id)}\r\n                            className={`w-full p-2 rounded flex items-center gap-2 text-sm transition ${\r\n                                activeTool === tool.id\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                            }`}\r\n                            title={tool.label}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"text-xs\">{tool.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Tools */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Tools</div>\r\n                {tools.filter(t => t.group === 'tools').map(tool => {\r\n                    const Icon = tool.icon;\r\n                    return (\r\n                        <button\r\n                            key={tool.id}\r\n                            onClick={() => setActiveTool(tool.id)}\r\n                            className={`w-full p-2 rounded flex items-center gap-2 text-sm transition ${\r\n                                activeTool === tool.id\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                            }`}\r\n                            title={tool.label}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"text-xs\">{tool.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Shapes */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Shapes</div>\r\n                {tools.filter(t => t.group === 'shapes').map(tool => {\r\n                    const Icon = tool.icon;\r\n                    return (\r\n                        <button\r\n                            key={tool.id}\r\n                            onClick={() => setActiveTool(tool.id)}\r\n                            className={`w-full p-2 rounded flex items-center gap-2 text-sm transition ${\r\n                                activeTool === tool.id\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                            }`}\r\n                            title={tool.label}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"text-xs\">{tool.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Zoom Controls */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">View</div>\r\n                <button\r\n                    onClick={onZoomIn}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                    title=\"Zoom In\"\r\n                >\r\n                    <ZoomIn size={16} />\r\n                </button>\r\n                <button\r\n                    onClick={onZoomOut}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                    title=\"Zoom Out\"\r\n                >\r\n                    <ZoomOut size={16} />\r\n                </button>\r\n                <button\r\n                    onClick={onFitToView}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300\"\r\n                    title=\"Fit to View\"\r\n                >\r\n                    <Maximize2 size={16} />\r\n                </button>\r\n                <button\r\n                    onClick={toggleGrid}\r\n                    className={`w-full p-2 rounded flex items-center gap-2 text-sm ${\r\n                        showGrid\r\n                            ? 'bg-brand-blue text-white'\r\n                            : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                    }`}\r\n                    title=\"Toggle Grid\"\r\n                >\r\n                    <Grid size={16} />\r\n                    <span className=\"text-xs\">Grid</span>\r\n                </button>\r\n            </div>\r\n\r\n            {/* Export */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Export</div>\r\n                <button\r\n                    onClick={onExportSVG}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2\"\r\n                    title=\"Export SVG\"\r\n                >\r\n                    <FileText size={16} />\r\n                    <span className=\"text-xs\">SVG</span>\r\n                </button>\r\n                <button\r\n                    onClick={onExportPNG}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2\"\r\n                    title=\"Export PNG\"\r\n                >\r\n                    <ImageIcon size={16} />\r\n                    <span className=\"text-xs\">PNG</span>\r\n                </button>\r\n                <button\r\n                    onClick={onExportPDF}\r\n                    className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2\"\r\n                    title=\"Export PDF\"\r\n                >\r\n                    <FileText size={16} />\r\n                    <span className=\"text-xs\">PDF</span>\r\n                </button>\r\n            </div>\r\n\r\n            {/* Background Image */}\r\n            <div className=\"space-y-1 pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1\">Background</div>\r\n                <label className=\"w-full p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2 cursor-pointer\">\r\n                    <ImageIcon size={16} />\r\n                    <span className=\"text-xs\">Import Image</span>\r\n                    <input\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        onChange={(e) => {\r\n                            const file = e.target.files?.[0];\r\n                            if (file) {\r\n                                // This will be handled by parent\r\n                                if (onBackgroundImageUpload) {\r\n                                    onBackgroundImageUpload(e);\r\n                                }\r\n                            }\r\n                        }}\r\n                        className=\"hidden\"\r\n                    />\r\n                </label>\r\n            </div>\r\n\r\n            {/* Scale Settings */}\r\n            <div className=\"pt-2 border-t dark:border-gray-700\">\r\n                <div className=\"text-xs font-bold text-gray-500 uppercase px-2 py-1 mb-2\">Scale</div>\r\n                <select\r\n                    value={scale}\r\n                    onChange={(e) => setScale(Number(e.target.value))}\r\n                    className=\"w-full p-1.5 text-xs rounded border dark:border-gray-600 dark:bg-[#1f2128] dark:text-white\"\r\n                >\r\n                    <option value={10}>1px = 1ft</option>\r\n                    <option value={20}>1px = 0.5ft</option>\r\n                    <option value={5}>1px = 2ft</option>\r\n                </select>\r\n                <select\r\n                    value={measurementUnit}\r\n                    onChange={(e) => setMeasurementUnit(e.target.value)}\r\n                    className=\"w-full p-1.5 text-xs rounded border dark:border-gray-600 dark:bg-[#1f2128] dark:text-white mt-2\"\r\n                >\r\n                    <option value=\"ft\">Feet</option>\r\n                    <option value=\"m\">Meters</option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","/**\r\n * Floorplan utility functions for calculations and geometry\r\n */\r\n\r\n// Calculate distance between two points\r\nexport const calculateDistance = (x1, y1, x2, y2) => {\r\n    return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\r\n};\r\n\r\n// Calculate area of a rectangle\r\nexport const calculateArea = (width, height, scale = 1) => {\r\n    const area = (width * height) / (scale * scale);\r\n    return {\r\n        sqft: area,\r\n        sqm: area * 0.092903,\r\n        display: `${area.toFixed(1)} sq ft (${(area * 0.092903).toFixed(1)} m)`\r\n    };\r\n};\r\n\r\n// Calculate perimeter\r\nexport const calculatePerimeter = (width, height, scale = 1) => {\r\n    const perimeter = (2 * (width + height)) / scale;\r\n    return {\r\n        feet: perimeter,\r\n        meters: perimeter * 0.3048,\r\n        display: `${perimeter.toFixed(1)} ft (${(perimeter * 0.3048).toFixed(1)} m)`\r\n    };\r\n};\r\n\r\n// Convert pixels to real-world units\r\nexport const pixelsToFeet = (pixels, scale = 1) => {\r\n    return pixels / scale;\r\n};\r\n\r\n// Convert real-world units to pixels\r\nexport const feetToPixels = (feet, scale = 1) => {\r\n    return feet * scale;\r\n};\r\n\r\n// Check if point is inside rectangle\r\nexport const pointInRect = (px, py, rx, ry, rw, rh) => {\r\n    return px >= rx && px <= rx + rw && py >= ry && py <= ry + rh;\r\n};\r\n\r\n// Check if two rectangles overlap\r\nexport const rectsOverlap = (r1, r2) => {\r\n    return !(r1.x + r1.width < r2.x || r2.x + r2.width < r1.x ||\r\n             r1.y + r1.height < r2.y || r2.y + r2.height < r1.y);\r\n};\r\n\r\n// Get rectangle center\r\nexport const getRectCenter = (x, y, width, height) => {\r\n    return {\r\n        x: x + width / 2,\r\n        y: y + height / 2\r\n    };\r\n};\r\n\r\n// Rotate point around center\r\nexport const rotatePoint = (px, py, cx, cy, angle) => {\r\n    const rad = (angle * Math.PI) / 180;\r\n    const cos = Math.cos(rad);\r\n    const sin = Math.sin(rad);\r\n    const dx = px - cx;\r\n    const dy = py - cy;\r\n    return {\r\n        x: cx + dx * cos - dy * sin,\r\n        y: cy + dx * sin + dy * cos\r\n    };\r\n};\r\n\r\n// Get bounding box of rotated rectangle\r\nexport const getRotatedBounds = (x, y, width, height, angle) => {\r\n    const corners = [\r\n        { x: x, y: y },\r\n        { x: x + width, y: y },\r\n        { x: x + width, y: y + height },\r\n        { x: x, y: y + height }\r\n    ];\r\n    \r\n    const center = getRectCenter(x, y, width, height);\r\n    const rotated = corners.map(c => rotatePoint(c.x, c.y, center.x, center.y, angle));\r\n    \r\n    const xs = rotated.map(p => p.x);\r\n    const ys = rotated.map(p => p.y);\r\n    \r\n    return {\r\n        x: Math.min(...xs),\r\n        y: Math.min(...ys),\r\n        width: Math.max(...xs) - Math.min(...xs),\r\n        height: Math.max(...ys) - Math.min(...ys)\r\n    };\r\n};\r\n\r\n// Snap point to grid\r\nexport const snapToGrid = (x, y, gridSize) => {\r\n    return {\r\n        x: Math.round(x / gridSize) * gridSize,\r\n        y: Math.round(y / gridSize) * gridSize\r\n    };\r\n};\r\n\r\n// Snap to nearest object\r\nexport const snapToObject = (x, y, objects, threshold = 10) => {\r\n    let snapped = { x, y };\r\n    let minDist = threshold;\r\n    \r\n    objects.forEach(obj => {\r\n        const objX = obj.layout?.x || obj.x || 0;\r\n        const objY = obj.layout?.y || obj.y || 0;\r\n        const objW = obj.layout?.width || obj.width || 0;\r\n        const objH = obj.layout?.height || obj.height || 0;\r\n        \r\n        // Check corners and edges\r\n        const points = [\r\n            { x: objX, y: objY }, // top-left\r\n            { x: objX + objW, y: objY }, // top-right\r\n            { x: objX + objW, y: objY + objH }, // bottom-right\r\n            { x: objX, y: objY + objH }, // bottom-left\r\n            { x: objX + objW / 2, y: objY }, // top-center\r\n            { x: objX + objW, y: objY + objH / 2 }, // right-center\r\n            { x: objX + objW / 2, y: objY + objH }, // bottom-center\r\n            { x: objX, y: objY + objH / 2 }, // left-center\r\n        ];\r\n        \r\n        points.forEach(point => {\r\n            const dist = calculateDistance(x, y, point.x, point.y);\r\n            if (dist < minDist) {\r\n                minDist = dist;\r\n                snapped = point;\r\n            }\r\n        });\r\n    });\r\n    \r\n    return snapped;\r\n};\r\n\r\n// Format measurement for display\r\nexport const formatMeasurement = (pixels, scale = 1, unit = 'ft') => {\r\n    const value = pixels / scale;\r\n    if (unit === 'ft') {\r\n        return `${value.toFixed(1)} ft`;\r\n    } else if (unit === 'm') {\r\n        return `${(value * 0.3048).toFixed(2)} m`;\r\n    }\r\n    return `${value.toFixed(1)}`;\r\n};\r\n\r\n// Export SVG to string\r\nexport const exportSVG = (svgElement, width, height) => {\r\n    const serializer = new XMLSerializer();\r\n    const svgString = serializer.serializeToString(svgElement);\r\n    \r\n    const svgBlob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });\r\n    const url = URL.createObjectURL(svgBlob);\r\n    \r\n    return { svgString, url, blob: svgBlob };\r\n};\r\n\r\n// Export to PNG\r\nexport const exportPNG = async (svgElement, width, height, scale = 2) => {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = width * scale;\r\n    canvas.height = height * scale;\r\n    const ctx = canvas.getContext('2d');\r\n    \r\n    const svgString = new XMLSerializer().serializeToString(svgElement);\r\n    const img = new Image();\r\n    const svgBlob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });\r\n    const url = URL.createObjectURL(svgBlob);\r\n    \r\n    return new Promise((resolve, reject) => {\r\n        img.onload = () => {\r\n            ctx.fillStyle = 'white';\r\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\r\n            canvas.toBlob((blob) => {\r\n                URL.revokeObjectURL(url);\r\n                resolve(blob);\r\n            }, 'image/png');\r\n        };\r\n        img.onerror = reject;\r\n        img.src = url;\r\n    });\r\n};\r\n\r\n// Generate room ID\r\nexport const generateId = (prefix = 'item') => {\r\n    return `${prefix}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n};\r\n\r\n","import React from 'react';\r\nimport { X, RotateCw, FlipHorizontal, FlipVertical } from 'lucide-react';\r\nimport { calculateArea, calculatePerimeter, formatMeasurement } from '../../utils/floorplanUtils';\r\n\r\n/**\r\n * PropertyPanel - Displays and edits properties of selected objects\r\n */\r\nexport default function FloorplanPropertyPanel({\r\n    selectedItem,\r\n    onClose,\r\n    onUpdate,\r\n    scale = 10,\r\n    unit = 'ft'\r\n}) {\r\n    if (!selectedItem) return null;\r\n\r\n    const isRoom = selectedItem.layout && selectedItem.name;\r\n    const isStructure = selectedItem.layout && selectedItem.label;\r\n    const isWall = selectedItem.x1 !== undefined;\r\n    const isDoor = selectedItem.type === 'door';\r\n    const isWindow = selectedItem.type === 'window';\r\n    const isFurniture = selectedItem.type === 'furniture';\r\n\r\n    const layout = selectedItem.layout || {};\r\n    const area = layout.width && layout.height ? calculateArea(layout.width, layout.height, scale) : null;\r\n    const perimeter = layout.width && layout.height ? calculatePerimeter(layout.width, layout.height, scale) : null;\r\n\r\n    const handleUpdate = (updates) => {\r\n        onUpdate({ ...selectedItem, ...updates });\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-64 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 p-4 overflow-y-auto\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n                <h3 className=\"font-bold text-sm dark:text-white\">Properties</h3>\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\r\n                >\r\n                    <X size={16} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Room Properties */}\r\n            {isRoom && (\r\n                <div className=\"space-y-3\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Name</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={selectedItem.name || ''}\r\n                            onChange={(e) => handleUpdate({ name: e.target.value })}\r\n                            className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Position</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.x || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, x: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                placeholder=\"X\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.y || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, y: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                placeholder=\"Y\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Size</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <div>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={Math.round(layout.width || 0)}\r\n                                    onChange={(e) => handleUpdate({ layout: { ...layout, width: Number(e.target.value) } })}\r\n                                    className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                    placeholder=\"Width\"\r\n                                />\r\n                                <span className=\"text-xs text-gray-500\">{formatMeasurement(layout.width || 0, scale, unit)}</span>\r\n                            </div>\r\n                            <div>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={Math.round(layout.height || 0)}\r\n                                    onChange={(e) => handleUpdate({ layout: { ...layout, height: Number(e.target.value) } })}\r\n                                    className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                    placeholder=\"Height\"\r\n                                />\r\n                                <span className=\"text-xs text-gray-500\">{formatMeasurement(layout.height || 0, scale, unit)}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    {area && (\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Area</label>\r\n                            <div className=\"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm\">\r\n                                {area.display}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    {perimeter && (\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Perimeter</label>\r\n                            <div className=\"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm\">\r\n                                {perimeter.display}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Color</label>\r\n                        <input\r\n                            type=\"color\"\r\n                            value={layout.color || '#3B82F6'}\r\n                            onChange={(e) => handleUpdate({ layout: { ...layout, color: e.target.value } })}\r\n                            className=\"w-full h-10 border rounded cursor-pointer\"\r\n                        />\r\n                    </div>\r\n                    {selectedItem.rotation !== undefined && (\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Rotation</label>\r\n                            <div className=\"flex gap-2\">\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={selectedItem.rotation || 0}\r\n                                    onChange={(e) => handleUpdate({ rotation: Number(e.target.value) })}\r\n                                    className=\"flex-1 p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                    min=\"0\"\r\n                                    max=\"360\"\r\n                                />\r\n                                <button\r\n                                    onClick={() => handleUpdate({ rotation: ((selectedItem.rotation || 0) + 90) % 360 })}\r\n                                    className=\"p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-700\"\r\n                                    title=\"Rotate 90\"\r\n                                >\r\n                                    <RotateCw size={16} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Structure Properties */}\r\n            {isStructure && (\r\n                <div className=\"space-y-3\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Label</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={selectedItem.label || ''}\r\n                            onChange={(e) => handleUpdate({ label: e.target.value })}\r\n                            className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Position</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.x || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, x: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.y || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, y: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Size</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.width || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, width: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(layout.height || 0)}\r\n                                onChange={(e) => handleUpdate({ layout: { ...layout, height: Number(e.target.value) } })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Wall Properties */}\r\n            {isWall && (\r\n                <div className=\"space-y-3\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Start Point</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.x1 || 0)}\r\n                                onChange={(e) => handleUpdate({ x1: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.y1 || 0)}\r\n                                onChange={(e) => handleUpdate({ y1: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">End Point</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.x2 || 0)}\r\n                                onChange={(e) => handleUpdate({ x2: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.y2 || 0)}\r\n                                onChange={(e) => handleUpdate({ y2: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Length</label>\r\n                        <div className=\"p-2 bg-gray-50 dark:bg-[#1f2128] rounded text-sm\">\r\n                            {formatMeasurement(\r\n                                Math.sqrt(Math.pow((selectedItem.x2 || 0) - (selectedItem.x1 || 0), 2) + \r\n                                         Math.pow((selectedItem.y2 || 0) - (selectedItem.y1 || 0), 2)),\r\n                                scale,\r\n                                unit\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Thickness</label>\r\n                        <input\r\n                            type=\"number\"\r\n                            value={selectedItem.strokeWidth || 5}\r\n                            onChange={(e) => handleUpdate({ strokeWidth: Number(e.target.value) })}\r\n                            className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            min=\"1\"\r\n                            max=\"20\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Color</label>\r\n                        <input\r\n                            type=\"color\"\r\n                            value={selectedItem.stroke || '#52525B'}\r\n                            onChange={(e) => handleUpdate({ stroke: e.target.value })}\r\n                            className=\"w-full h-10 border rounded cursor-pointer\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Door/Window/Furniture Properties */}\r\n            {(isDoor || isWindow || isFurniture) && (\r\n                <div className=\"space-y-3\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Type</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={selectedItem.subType || ''}\r\n                            onChange={(e) => handleUpdate({ subType: e.target.value })}\r\n                            className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            placeholder={isDoor ? 'Single, Double, Sliding...' : isWindow ? 'Standard, Bay...' : 'Chair, Table...'}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Position</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.x || 0)}\r\n                                onChange={(e) => handleUpdate({ x: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                            <input\r\n                                type=\"number\"\r\n                                value={Math.round(selectedItem.y || 0)}\r\n                                onChange={(e) => handleUpdate({ y: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    {selectedItem.rotation !== undefined && (\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Rotation</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={selectedItem.rotation || 0}\r\n                                onChange={(e) => handleUpdate({ rotation: Number(e.target.value) })}\r\n                                className=\"w-full p-2 border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                min=\"0\"\r\n                                max=\"360\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport { Copy, Clipboard, Scissors, Trash2, RotateCw, FlipHorizontal, FlipVertical, Lock, Unlock, BringToFront, SendToBack } from 'lucide-react';\r\n\r\n/**\r\n * ContextMenu - Right-click context menu for floor plan objects\r\n */\r\nexport default function FloorplanContextMenu({ x, y, onClose, onAction, canCopy, canPaste, canCut, canDelete, canRotate, canFlip, isLocked }) {\r\n    if (!x || !y) return null;\r\n\r\n    const menuItems = [\r\n        { id: 'copy', label: 'Copy', icon: Copy, disabled: !canCopy, shortcut: 'Ctrl+C' },\r\n        { id: 'paste', label: 'Paste', icon: Clipboard, disabled: !canPaste, shortcut: 'Ctrl+V' },\r\n        { id: 'cut', label: 'Cut', icon: Scissors, disabled: !canCut, shortcut: 'Ctrl+X' },\r\n        { id: 'separator1' },\r\n        { id: 'delete', label: 'Delete', icon: Trash2, disabled: !canDelete, shortcut: 'Del' },\r\n        { id: 'separator2' },\r\n        { id: 'rotate', label: 'Rotate 90', icon: RotateCw, disabled: !canRotate },\r\n        { id: 'flipH', label: 'Flip Horizontal', icon: FlipHorizontal, disabled: !canFlip },\r\n        { id: 'flipV', label: 'Flip Vertical', icon: FlipVertical, disabled: !canFlip },\r\n        { id: 'separator3' },\r\n        { id: 'lock', label: isLocked ? 'Unlock' : 'Lock', icon: isLocked ? Unlock : Lock },\r\n        { id: 'separator4' },\r\n        { id: 'bringToFront', label: 'Bring to Front', icon: BringToFront },\r\n        { id: 'sendToBack', label: 'Send to Back', icon: SendToBack },\r\n    ];\r\n\r\n    return (\r\n        <>\r\n            <div\r\n                className=\"fixed inset-0 z-50\"\r\n                onClick={onClose}\r\n            />\r\n            <div\r\n                className=\"fixed z-50 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-lg shadow-lg py-1 min-w-[180px]\"\r\n                style={{ left: `${x}px`, top: `${y}px` }}\r\n            >\r\n                {menuItems.map((item, index) => {\r\n                    if (item.id.startsWith('separator')) {\r\n                        return <div key={index} className=\"border-t dark:border-gray-700 my-1\" />;\r\n                    }\r\n\r\n                    const Icon = item.icon;\r\n                    return (\r\n                        <button\r\n                            key={item.id}\r\n                            onClick={() => {\r\n                                onAction(item.id);\r\n                                onClose();\r\n                            }}\r\n                            disabled={item.disabled}\r\n                            className=\"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 dark:text-white\"\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span className=\"flex-1\">{item.label}</span>\r\n                            {item.shortcut && (\r\n                                <span className=\"text-xs text-gray-500\">{item.shortcut}</span>\r\n                            )}\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport { Eye, EyeOff, Lock, Unlock, Layers } from 'lucide-react';\r\n\r\n/**\r\n * FloorplanLayerPanel - Layer visibility and lock management\r\n */\r\nexport default function FloorplanLayerPanel({ layers, onLayerToggle, onLayerLock }) {\r\n    const layerList = [\r\n        { key: 'structures', label: 'Structures', icon: Layers },\r\n        { key: 'rooms', label: 'Rooms', icon: Layers },\r\n        { key: 'walls', label: 'Walls', icon: Layers },\r\n        { key: 'doors', label: 'Doors', icon: Layers },\r\n        { key: 'windows', label: 'Windows', icon: Layers },\r\n        { key: 'furniture', label: 'Furniture', icon: Layers },\r\n        { key: 'text', label: 'Text Labels', icon: Layers },\r\n        { key: 'measurements', label: 'Measurements', icon: Layers },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"w-48 bg-white dark:bg-[#2c2e36] border-l dark:border-gray-700 p-3\">\r\n            <h3 className=\"font-bold text-sm dark:text-white mb-3 flex items-center gap-2\">\r\n                <Layers size={16} />\r\n                Layers\r\n            </h3>\r\n            <div className=\"space-y-1\">\r\n                {layerList.map(layer => {\r\n                    const layerData = layers[layer.key] || { visible: true, locked: false };\r\n                    const Icon = layer.icon;\r\n                    return (\r\n                        <div\r\n                            key={layer.key}\r\n                            className=\"flex items-center justify-between p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\r\n                        >\r\n                            <div className=\"flex items-center gap-2 flex-1\">\r\n                                <button\r\n                                    onClick={() => onLayerToggle(layer.key)}\r\n                                    className=\"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300\"\r\n                                >\r\n                                    {layerData.visible ? <Eye size={16} /> : <EyeOff size={16} />}\r\n                                </button>\r\n                                <span className=\"text-xs dark:text-white\">{layer.label}</span>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => onLayerLock(layer.key)}\r\n                                className=\"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300\"\r\n                            >\r\n                                {layerData.locked ? <Lock size={14} /> : <Unlock size={14} />}\r\n                            </button>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport { DoorOpen } from 'lucide-react';\r\nimport { rotatePoint } from '../../utils/floorplanUtils';\r\n\r\n/**\r\n * DoorComponent - Renders a door on the floor plan\r\n */\r\nexport default function DoorComponent({ door, isSelected, onClick, onMouseDown }) {\r\n    const { x, y, width = 30, height = 60, rotation = 0, subType = 'single', direction = 'left' } = door;\r\n    \r\n    const centerX = x + width / 2;\r\n    const centerY = y + height / 2;\r\n\r\n    // Door arc path (swinging door)\r\n    const arcRadius = width;\r\n    const arcStart = direction === 'left' ? 180 : 0;\r\n    const arcEnd = direction === 'left' ? 90 : 270;\r\n\r\n    // Rotate points if needed\r\n    const getRotatedPoint = (px, py) => {\r\n        if (rotation === 0) return { x: px, y: py };\r\n        return rotatePoint(px, py, centerX, centerY, rotation);\r\n    };\r\n\r\n    const topLeft = getRotatedPoint(x, y);\r\n    const topRight = getRotatedPoint(x + width, y);\r\n    const bottomLeft = getRotatedPoint(x, y + height);\r\n    const bottomRight = getRotatedPoint(x + width, y + height);\r\n\r\n    return (\r\n        <g\r\n            onClick={onClick}\r\n            onMouseDown={onMouseDown}\r\n            cursor=\"pointer\"\r\n            style={{ filter: isSelected ? 'drop-shadow(0 0 3px #3D84ED)' : 'none' }}\r\n        >\r\n            {/* Door frame */}\r\n            <rect\r\n                x={x}\r\n                y={y}\r\n                width={width}\r\n                height={height}\r\n                fill=\"none\"\r\n                stroke={isSelected ? '#3D84ED' : '#8B5CF6'}\r\n                strokeWidth={isSelected ? 3 : 2}\r\n                rx={2}\r\n            />\r\n            \r\n            {/* Door panel */}\r\n            <rect\r\n                x={x + 2}\r\n                y={y + 2}\r\n                width={width - 4}\r\n                height={height - 4}\r\n                fill=\"#F3F4F6\"\r\n                stroke=\"#8B5CF6\"\r\n                strokeWidth={1}\r\n            />\r\n            \r\n            {/* Door swing arc */}\r\n            <path\r\n                d={`M ${centerX} ${centerY} A ${arcRadius} ${arcRadius} 0 0 1 ${direction === 'left' ? x : x + width} ${y}`}\r\n                fill=\"none\"\r\n                stroke=\"#8B5CF6\"\r\n                strokeWidth={1}\r\n                strokeDasharray=\"3,3\"\r\n                opacity=\"0.5\"\r\n            />\r\n            \r\n            {/* Door handle */}\r\n            <circle\r\n                cx={direction === 'left' ? x + width - 8 : x + 8}\r\n                cy={y + height / 2}\r\n                r={3}\r\n                fill=\"#8B5CF6\"\r\n            />\r\n            \r\n            {/* Selection indicator */}\r\n            {isSelected && (\r\n                <rect\r\n                    x={x - 4}\r\n                    y={y - 4}\r\n                    width={width + 8}\r\n                    height={height + 8}\r\n                    fill=\"none\"\r\n                    stroke=\"#3D84ED\"\r\n                    strokeWidth={2}\r\n                    strokeDasharray=\"5,5\"\r\n                />\r\n            )}\r\n        </g>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\n\r\n/**\r\n * WindowComponent - Renders a window on the floor plan\r\n */\r\nexport default function WindowComponent({ window, isSelected, onClick, onMouseDown }) {\r\n    const { x, y, width = 40, height = 60, rotation = 0, subType = 'standard' } = window;\r\n    \r\n    return (\r\n        <g\r\n            onClick={onClick}\r\n            onMouseDown={onMouseDown}\r\n            cursor=\"pointer\"\r\n            style={{ filter: isSelected ? 'drop-shadow(0 0 3px #3D84ED)' : 'none' }}\r\n        >\r\n            {/* Window frame */}\r\n            <rect\r\n                x={x}\r\n                y={y}\r\n                width={width}\r\n                height={height}\r\n                fill=\"#E0F2FE\"\r\n                stroke={isSelected ? '#3D84ED' : '#0EA5E9'}\r\n                strokeWidth={isSelected ? 3 : 2}\r\n                rx={2}\r\n                opacity=\"0.7\"\r\n            />\r\n            \r\n            {/* Window panes */}\r\n            <line\r\n                x1={x + width / 2}\r\n                y1={y}\r\n                x2={x + width / 2}\r\n                y2={y + height}\r\n                stroke=\"#0EA5E9\"\r\n                strokeWidth={1}\r\n            />\r\n            <line\r\n                x1={x}\r\n                y1={y + height / 2}\r\n                x2={x + width}\r\n                y2={y + height / 2}\r\n                stroke=\"#0EA5E9\"\r\n                strokeWidth={1}\r\n            />\r\n            \r\n            {/* Selection indicator */}\r\n            {isSelected && (\r\n                <rect\r\n                    x={x - 4}\r\n                    y={y - 4}\r\n                    width={width + 8}\r\n                    height={height + 8}\r\n                    fill=\"none\"\r\n                    stroke=\"#3D84ED\"\r\n                    strokeWidth={2}\r\n                    strokeDasharray=\"5,5\"\r\n                />\r\n            )}\r\n        </g>\r\n    );\r\n}\r\n\r\n","import React from 'react';\r\nimport { Box, RectangleHorizontal, Square, Circle } from 'lucide-react';\r\n\r\n/**\r\n * FurnitureComponent - Renders furniture on the floor plan\r\n */\r\nexport default function FurnitureComponent({ furniture, isSelected, onClick, onMouseDown }) {\r\n    const { x, y, width = 40, height = 40, rotation = 0, subType = 'box' } = furniture;\r\n    \r\n    const icons = {\r\n        box: Box,\r\n        sofa: RectangleHorizontal,\r\n        chair: Square,\r\n        table: Circle,\r\n        bed: RectangleHorizontal,\r\n    };\r\n    \r\n    const Icon = icons[subType] || Box;\r\n    const centerX = x + width / 2;\r\n    const centerY = y + height / 2;\r\n\r\n    return (\r\n        <g\r\n            onClick={onClick}\r\n            onMouseDown={onMouseDown}\r\n            cursor=\"pointer\"\r\n            transform={`translate(${centerX}, ${centerY}) rotate(${rotation}) translate(${-centerX}, ${-centerY})`}\r\n            style={{ filter: isSelected ? 'drop-shadow(0 0 3px #3D84ED)' : 'none' }}\r\n        >\r\n            {/* Furniture shape */}\r\n            <rect\r\n                x={x}\r\n                y={y}\r\n                width={width}\r\n                height={height}\r\n                fill=\"#FEF3C7\"\r\n                stroke={isSelected ? '#3D84ED' : '#F59E0B'}\r\n                strokeWidth={isSelected ? 3 : 2}\r\n                rx={4}\r\n            />\r\n            \r\n            {/* Icon */}\r\n            <foreignObject x={x + width / 2 - 12} y={y + height / 2 - 12} width={24} height={24}>\r\n                <div className=\"flex items-center justify-center w-full h-full\">\r\n                    <Icon size={20} className=\"text-amber-600\" />\r\n                </div>\r\n            </foreignObject>\r\n            \r\n            {/* Selection indicator */}\r\n            {isSelected && (\r\n                <rect\r\n                    x={x - 4}\r\n                    y={y - 4}\r\n                    width={width + 8}\r\n                    height={height + 8}\r\n                    fill=\"none\"\r\n                    stroke=\"#3D84ED\"\r\n                    strokeWidth={2}\r\n                    strokeDasharray=\"5,5\"\r\n                />\r\n            )}\r\n        </g>\r\n    );\r\n}\r\n\r\n","import { useState, useCallback, useRef } from 'react';\r\n\r\n/**\r\n * Custom hook for undo/redo functionality\r\n * @param {*} initialState - Initial state value\r\n * @param {number} maxHistory - Maximum number of history entries (default: 50)\r\n * @returns {Object} - { state, setState, undo, redo, canUndo, canRedo, clearHistory }\r\n */\r\nexport function useUndoRedo(initialState, maxHistory = 50) {\r\n    const [state, setState] = useState(initialState);\r\n    const historyRef = useRef([initialState]);\r\n    const historyIndexRef = useRef(0);\r\n\r\n    const setStateWithHistory = useCallback((newState) => {\r\n        // If we're not at the end of history, remove future states\r\n        if (historyIndexRef.current < historyRef.current.length - 1) {\r\n            historyRef.current = historyRef.current.slice(0, historyIndexRef.current + 1);\r\n        }\r\n\r\n        // Add new state to history\r\n        historyRef.current.push(newState);\r\n\r\n        // Limit history size\r\n        if (historyRef.current.length > maxHistory) {\r\n            historyRef.current.shift();\r\n        } else {\r\n            historyIndexRef.current++;\r\n        }\r\n\r\n        setState(newState);\r\n    }, [maxHistory]);\r\n\r\n    const undo = useCallback(() => {\r\n        if (historyIndexRef.current > 0) {\r\n            historyIndexRef.current--;\r\n            setState(historyRef.current[historyIndexRef.current]);\r\n        }\r\n    }, []);\r\n\r\n    const redo = useCallback(() => {\r\n        if (historyIndexRef.current < historyRef.current.length - 1) {\r\n            historyIndexRef.current++;\r\n            setState(historyRef.current[historyIndexRef.current]);\r\n        }\r\n    }, []);\r\n\r\n    const canUndo = historyIndexRef.current > 0;\r\n    const canRedo = historyIndexRef.current < historyRef.current.length - 1;\r\n\r\n    const clearHistory = useCallback(() => {\r\n        historyRef.current = [state];\r\n        historyIndexRef.current = 0;\r\n    }, [state]);\r\n\r\n    return {\r\n        state,\r\n        setState: setStateWithHistory,\r\n        undo,\r\n        redo,\r\n        canUndo,\r\n        canRedo,\r\n        clearHistory\r\n    };\r\n}\r\n\r\n","import React, { useState, useRef, useCallback, useEffect } from 'react';\nimport { Edit, Move, Trash2, Plus, CornerUpLeft, CornerDownRight, Zap, BoxSelect, GripHorizontal, Copy, Clipboard, Scissors, Image as ImageIcon, RotateCw, FlipHorizontal, FlipVertical, ZoomIn, ZoomOut, Maximize2, Ruler, Type, Circle, Triangle } from 'lucide-react';\nimport Panorama360Viewer from './Panorama360Viewer';\nimport FloorplanTools from './FloorplanTools';\nimport FloorplanPropertyPanel from './FloorplanPropertyPanel';\nimport FloorplanContextMenu from './FloorplanContextMenu';\nimport FloorplanLayerPanel from './FloorplanLayerPanel';\nimport DoorComponent from './DoorComponent';\nimport WindowComponent from './WindowComponent';\nimport FurnitureComponent from './FurnitureComponent';\nimport { useUndoRedo } from '../../hooks/useUndoRedo';\nimport { calculateDistance, calculateArea, calculatePerimeter, formatMeasurement, exportSVG, exportPNG, snapToGrid, snapToObject, generateId } from '../../utils/floorplanUtils';\nimport toast from 'react-hot-toast';\n\nconst SNAP_GRID = 10; // Snap movement to 10px grid\n\n// --- GEOMETRY HELPERS ---\n\n// Calculate distance from point (px,py) to line segment (x1,y1)-(x2,y2)\nconst getDistanceToLineSegment = (px, py, x1, y1, x2, y2) => {\n    const A = px - x1;\n    const B = py - y1;\n    const C = x2 - x1;\n    const D = y2 - y1;\n  \n    const dot = A * C + B * D;\n    const len_sq = C * C + D * D;\n    let param = -1;\n    \n    if (len_sq !== 0) param = dot / len_sq;\n  \n    let xx, yy;\n  \n    if (param < 0) {\n      xx = x1;\n      yy = y1;\n    } else if (param > 1) {\n      xx = x2;\n      yy = y2;\n    } else {\n      xx = x1 + param * C;\n      yy = y1 + param * D;\n    }\n  \n    const dx = px - xx;\n    const dy = py - yy;\n    return Math.sqrt(dx * dx + dy * dy);\n};\n\n/**\n * FloorplanEditor component for editing studio room layout via interactive SVG.\n */\nexport default function FloorplanEditor({ rooms, walls: propWalls, structures: propStructures, onRoomClick, onLayoutChange, onWallsChange, onStructuresChange }) {\n    const svgRef = useRef(null);\n    const containerRef = useRef(null);\n    \n    // --- INTERACTION STATE ---\n    const [isDragging, setIsDragging] = useState(false);\n    const [isResizing, setIsResizing] = useState(false); // 'br', 'bl', 'tr', 'tl', 't', 'r', 'b', 'l'\n    const [cursorOffset, setCursorOffset] = useState({ x: 0, y: 0 });\n    const [isPanning, setIsPanning] = useState(false);\n    const [panOffset, setPanOffset] = useState({ x: 0, y: 0 });\n\n    // Selection State\n    const [activeRoomId, setActiveRoomId] = useState(null);\n    const [activeStructureId, setActiveStructureId] = useState(null);\n    const [activeWallId, setActiveWallId] = useState(null);\n    const [activeDoorId, setActiveDoorId] = useState(null);\n    const [activeWindowId, setActiveWindowId] = useState(null);\n    const [activeFurnitureId, setActiveFurnitureId] = useState(null);\n    const [selectedItems, setSelectedItems] = useState(new Set()); // Multi-select\n    const [draggingWallHandle, setDraggingWallHandle] = useState(null);\n    const [viewing360Room, setViewing360Room] = useState(null);\n    const [contextMenu, setContextMenu] = useState(null); // { x, y }\n    const [showPropertyPanel, setShowPropertyPanel] = useState(false);\n    \n    // --- DATA STATE ---\n    const [walls, setWalls] = useState(propWalls || []); \n    const [structures, setStructures] = useState(propStructures || []); \n    const [doors, setDoors] = useState([]);\n    const [windows, setWindows] = useState([]);\n    const [furniture, setFurniture] = useState([]);\n    const [textLabels, setTextLabels] = useState([]);\n    const [measurements, setMeasurements] = useState([]);\n    const [backgroundImage, setBackgroundImage] = useState(null);\n    const [clipboard, setClipboard] = useState(null); \n    const [customShapes, setCustomShapes] = useState([]); // circles, polygons, etc.\n    const [layers, setLayers] = useState({\n        structures: { visible: true, locked: false },\n        rooms: { visible: true, locked: false },\n        walls: { visible: true, locked: false },\n        doors: { visible: true, locked: false },\n        windows: { visible: true, locked: false },\n        furniture: { visible: true, locked: false },\n        text: { visible: true, locked: false },\n        measurements: { visible: true, locked: false }\n    });\n    const [roomTemplates, setRoomTemplates] = useState([\n        { name: 'Control Room', width: 200, height: 150, color: '#3B82F6' },\n        { name: 'Live Room', width: 300, height: 250, color: '#10B981' },\n        { name: 'Isolation Booth', width: 120, height: 120, color: '#F59E0B' },\n        { name: 'Lounge', width: 250, height: 200, color: '#8B5CF6' }\n    ]);\n    \n    // --- TOOLS STATE ---\n    const [activeTool, setActiveTool] = useState('select');\n    const [wallStartPoint, setWallStartPoint] = useState(null);\n    const [measureStartPoint, setMeasureStartPoint] = useState(null);\n    const [currentMeasurement, setCurrentMeasurement] = useState(null);\n    \n    // --- VIEW STATE ---\n    const [zoom, setZoom] = useState(1);\n    const [viewBox, setViewBox] = useState({ x: 0, y: 0, width: 800, height: 600 });\n    const [showGrid, setShowGrid] = useState(true);\n    const [gridSize, setGridSize] = useState(SNAP_GRID);\n    const [scale, setScale] = useState(10); // pixels per foot\n    const [measurementUnit, setMeasurementUnit] = useState('ft');\n    const [snapToObjects, setSnapToObjects] = useState(true);\n    \n    // --- UNDO/REDO ---\n    const floorplanState = {\n        walls,\n        structures,\n        doors,\n        windows,\n        furniture,\n        textLabels\n    };\n    const { state: historyState, setState: setHistoryState, undo, redo, canUndo, canRedo } = useUndoRedo(floorplanState);\n\n    const width = 800;\n    const height = 600;\n\n    // Sync props to state when they change externally (e.g. initial load)\n    useEffect(() => { setWalls(propWalls || []); }, [propWalls]);\n    useEffect(() => { setStructures(propStructures || []); }, [propStructures]);\n\n    // Utility function to get position relative to the SVG container\n    const getCoords = (e, applyZoom = true) => {\n        if (!svgRef.current) return { x: 0, y: 0 };\n        \n        const rect = svgRef.current.getBoundingClientRect();\n        let clientX = e.clientX;\n        let clientY = e.clientY;\n\n        if (e.touches && e.touches.length > 0) {\n            clientX = e.touches[0].clientX;\n            clientY = e.touches[0].clientY;\n        }\n\n        let x = (clientX - rect.left) / (applyZoom ? zoom : 1) - panOffset.x;\n        let y = (clientY - rect.top) / (applyZoom ? zoom : 1) - panOffset.y;\n        \n        // Snap to grid\n        const snapped = snapToGrid(x, y, gridSize);\n        \n        // Snap to objects if enabled\n        if (snapToObjects && activeTool === 'select') {\n            const allObjects = [...rooms, ...structures, ...walls.map(w => ({ x: w.x1, y: w.y1, width: w.x2 - w.x1, height: w.y2 - w.y1 }))];\n            return snapToObject(snapped.x, snapped.y, allObjects, 10);\n        }\n        \n        return snapped;\n    };\n\n    // --- PERSISTENCE HELPERS ---\n    const commitWalls = (newWalls, saveToHistory = true) => {\n        setWalls(newWalls);\n        onWallsChange(newWalls);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, walls: newWalls });\n        }\n    };\n\n    const commitStructures = (newStructures, saveToHistory = true) => {\n        setStructures(newStructures);\n        onStructuresChange(newStructures);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, structures: newStructures });\n        }\n    };\n\n    const commitDoors = (newDoors, saveToHistory = true) => {\n        setDoors(newDoors);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, doors: newDoors });\n        }\n    };\n\n    const commitWindows = (newWindows, saveToHistory = true) => {\n        setWindows(newWindows);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, windows: newWindows });\n        }\n    };\n\n    const commitFurniture = (newFurniture, saveToHistory = true) => {\n        setFurniture(newFurniture);\n        if (saveToHistory) {\n            setHistoryState({ ...floorplanState, furniture: newFurniture });\n        }\n    };\n\n    // --- CLIPBOARD & EDITING ACTIONS ---\n\n    const handleDelete = useCallback(() => {\n        if (activeStructureId) {\n            const newStructs = structures.filter(s => s.id !== activeStructureId);\n            commitStructures(newStructs);\n            setActiveStructureId(null);\n            setShowPropertyPanel(false);\n        } else if (activeWallId) {\n            const newWalls = walls.filter(w => w.id !== activeWallId);\n            commitWalls(newWalls);\n            setActiveWallId(null);\n            setShowPropertyPanel(false);\n        } else if (activeDoorId) {\n            const newDoors = doors.filter(d => d.id !== activeDoorId);\n            commitDoors(newDoors);\n            setActiveDoorId(null);\n            setShowPropertyPanel(false);\n        } else if (activeWindowId) {\n            const newWindows = windows.filter(w => w.id !== activeWindowId);\n            commitWindows(newWindows);\n            setActiveWindowId(null);\n            setShowPropertyPanel(false);\n        } else if (activeFurnitureId) {\n            const newFurniture = furniture.filter(f => f.id !== activeFurnitureId);\n            commitFurniture(newFurniture);\n            setActiveFurnitureId(null);\n            setShowPropertyPanel(false);\n        } else if (activeRoomId) {\n            // Room deletion handled by parent\n            setActiveRoomId(null);\n            setShowPropertyPanel(false);\n        }\n    }, [activeStructureId, activeWallId, activeDoorId, activeWindowId, activeFurnitureId, activeRoomId, structures, walls, doors, windows, furniture]);\n\n    const handleCopy = useCallback(() => {\n        if (activeStructureId) {\n            const item = structures.find(s => s.id === activeStructureId);\n            if (item) setClipboard({ type: 'structure', data: item });\n        } else if (activeWallId) {\n            const item = walls.find(w => w.id === activeWallId);\n            if (item) setClipboard({ type: 'wall', data: item });\n        }\n    }, [activeStructureId, activeWallId, structures, walls]);\n\n    const handlePaste = useCallback(() => {\n        if (!clipboard) return;\n\n        const offset = 20; // Visual offset for pasted item\n\n        if (clipboard.type === 'structure') {\n            const newStruct = {\n                ...clipboard.data,\n                id: `struct_${Date.now()}`,\n                layout: {\n                    ...clipboard.data.layout,\n                    x: clipboard.data.layout.x + offset,\n                    y: clipboard.data.layout.y + offset\n                }\n            };\n            commitStructures([...structures, newStruct]);\n            setActiveStructureId(newStruct.id);\n        } else if (clipboard.type === 'wall') {\n            const newWall = {\n                ...clipboard.data,\n                id: `wall_${Date.now()}`,\n                x1: clipboard.data.x1 + offset,\n                y1: clipboard.data.y1 + offset,\n                x2: clipboard.data.x2 + offset,\n                y2: clipboard.data.y2 + offset\n            };\n            commitWalls([...walls, newWall]);\n            setActiveWallId(newWall.id);\n        }\n    }, [clipboard, structures, walls]);\n\n    const handleCut = useCallback(() => {\n        handleCopy();\n        handleDelete();\n    }, [handleCopy, handleDelete]);\n\n    // Keyboard Shortcuts Listener\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            // Undo/Redo\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n                e.preventDefault();\n                undo();\n                return;\n            }\n            if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {\n                e.preventDefault();\n                redo();\n                return;\n            }\n            \n            // Delete\n            if (e.key === 'Delete' || e.key === 'Backspace') {\n                handleDelete();\n            }\n            // Copy (Ctrl+C / Cmd+C)\n            if ((e.ctrlKey || e.metaKey) && e.key === 'c') {\n                e.preventDefault();\n                handleCopy();\n            }\n            // Paste (Ctrl+V / Cmd+V)\n            if ((e.ctrlKey || e.metaKey) && e.key === 'v') {\n                e.preventDefault();\n                handlePaste();\n            }\n            // Cut (Ctrl+X / Cmd+X)\n            if ((e.ctrlKey || e.metaKey) && e.key === 'x') {\n                e.preventDefault();\n                handleCut();\n            }\n            // Zoom\n            if ((e.ctrlKey || e.metaKey) && e.key === '=') {\n                e.preventDefault();\n                handleZoomIn();\n            }\n            if ((e.ctrlKey || e.metaKey) && e.key === '-') {\n                e.preventDefault();\n                handleZoomOut();\n            }\n            if ((e.ctrlKey || e.metaKey) && e.key === '0') {\n                e.preventDefault();\n                handleFitToView();\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [handleDelete, handleCopy, handlePaste, handleCut, undo, redo]);\n\n\n    // --- ROOM HANDLERS ---\n    \n    const startDragRoom = useCallback((e, room) => {\n        if (activeTool !== 'select') return;\n        e.preventDefault();\n        e.stopPropagation();\n        \n        const { x, y } = getCoords(e);\n        \n        setActiveRoomId(room.id);\n        setActiveStructureId(null);\n        setActiveWallId(null);\n        setIsDragging(true);\n        setIsResizing(false);\n        setCursorOffset({\n            x: x - room.layout.x,\n            y: y - room.layout.y,\n        });\n    }, [activeTool]);\n\n    const startResizeRoom = useCallback((e, room, direction) => {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        setActiveRoomId(room.id);\n        setActiveStructureId(null);\n        setActiveWallId(null);\n        setActiveDoorId(null);\n        setActiveWindowId(null);\n        setActiveFurnitureId(null);\n        setIsDragging(false);\n        setIsResizing(direction);\n    }, []);\n\n    const startPan = useCallback((e) => {\n        if (activeTool === 'select' && (e.button === 1 || e.ctrlKey || e.metaKey || e.space)) {\n            e.preventDefault();\n            setIsPanning({ startX: e.clientX, startY: e.clientY });\n        }\n    }, [activeTool]);\n\n    const stopPan = useCallback(() => {\n        setIsPanning(false);\n    }, []);\n\n    // --- STRUCTURE HANDLERS (Visual Only Rooms) ---\n\n    const addStructure = () => {\n        const newStruct = {\n            id: `struct_${Date.now()}`,\n            label: 'Lobby / Area',\n            layout: { x: 100, y: 100, width: 150, height: 100, color: '#94a3b8' } // Slate 400\n        };\n        commitStructures([...structures, newStruct]);\n        setActiveTool('select'); // Reset tool\n    };\n\n    const startDragStructure = useCallback((e, struct) => {\n        if (activeTool !== 'select') return;\n        e.preventDefault();\n        e.stopPropagation();\n        \n        const { x, y } = getCoords(e);\n        \n        setActiveStructureId(struct.id);\n        setActiveRoomId(null); // Deselect rooms\n        setActiveWallId(null);\n        setIsDragging(true);\n        setIsResizing(false);\n        setCursorOffset({\n            x: x - struct.layout.x,\n            y: y - struct.layout.y,\n        });\n    }, [activeTool]);\n\n    const startResizeStructure = useCallback((e, struct, direction) => {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        setActiveStructureId(struct.id);\n        setActiveRoomId(null);\n        setActiveWallId(null);\n        setIsDragging(false);\n        setIsResizing(direction);\n    }, []);\n\n    // --- WALL HANDLERS ---\n\n    const startDragWallHandle = useCallback((e, wallId, point) => {\n        if (activeTool !== 'select') return;\n        e.preventDefault();\n        e.stopPropagation();\n        setDraggingWallHandle({ id: wallId, point });\n        setActiveRoomId(null);\n        setActiveStructureId(null);\n        setActiveWallId(wallId);\n    }, [activeTool]);\n\n    const selectWall = (e, wallId) => {\n        if (activeTool !== 'select') return;\n        e.stopPropagation();\n        setActiveWallId(wallId);\n        setActiveRoomId(null);\n        setActiveStructureId(null);\n    };\n\n    // --- GLOBAL MOVE HANDLER ---\n\n    const handleMouseMove = useCallback((e) => {\n        if (!svgRef.current) return;\n        const { x, y } = getCoords(e); // Snapped coords\n        \n        // 1. WALL DRAWING PREVIEW\n        if (activeTool === 'wall' && wallStartPoint) {\n            const previewWall = { \n                id: 'preview', \n                x1: wallStartPoint.x, y1: wallStartPoint.y, \n                x2: x, y2: y \n            };\n            // Just local state for preview, don't commit\n            setWalls(prev => [...prev.filter(w => w.id !== 'preview'), previewWall]);\n            return;\n        }\n\n        // 2. WALL EDITING (Moving Endpoints)\n        if (draggingWallHandle) {\n            // Update local state while dragging for smoothness\n            setWalls(prev => prev.map(w => {\n                if (w.id !== draggingWallHandle.id) return w;\n                return draggingWallHandle.point === 'start' \n                    ? { ...w, x1: x, y1: y } \n                    : { ...w, x2: x, y2: y };\n            }));\n            return;\n        }\n\n        // 3. DRAGGING (Room, Structure, Door, Window, Furniture)\n        if (isDragging) {\n            const newPos = { x: x - cursorOffset.x, y: y - cursorOffset.y };\n            \n            if (activeRoomId) {\n                const room = rooms.find(r => r.id === activeRoomId);\n                if (room) onLayoutChange(activeRoomId, { ...room.layout, ...newPos });\n            } else if (activeStructureId) {\n                setStructures(prev => prev.map(s => s.id === activeStructureId ? { ...s, layout: { ...s.layout, ...newPos } } : s));\n            } else if (activeDoorId) {\n                setDoors(prev => prev.map(d => d.id === activeDoorId ? { ...d, x: newPos.x, y: newPos.y } : d));\n            } else if (activeWindowId) {\n                setWindows(prev => prev.map(w => w.id === activeWindowId ? { ...w, x: newPos.x, y: newPos.y } : w));\n            } else if (activeFurnitureId) {\n                setFurniture(prev => prev.map(f => f.id === activeFurnitureId ? { ...f, x: newPos.x, y: newPos.y } : f));\n            }\n        }\n        \n        // 4. RESIZING (Room or Structure) - Multi-handle support\n        if (isResizing) {\n            if (activeRoomId) {\n                const room = rooms.find(r => r.id === activeRoomId);\n                if (room) {\n                    let newLayout = { ...room.layout };\n                    const minSize = SNAP_GRID;\n                    \n                    if (isResizing === 'br') {\n                        newLayout.width = Math.max(minSize, x - room.layout.x);\n                        newLayout.height = Math.max(minSize, y - room.layout.y);\n                    } else if (isResizing === 'bl') {\n                        newLayout.width = Math.max(minSize, room.layout.x + room.layout.width - x);\n                        newLayout.height = Math.max(minSize, y - room.layout.y);\n                        newLayout.x = Math.min(x, room.layout.x + room.layout.width - minSize);\n                    } else if (isResizing === 'tr') {\n                        newLayout.width = Math.max(minSize, x - room.layout.x);\n                        newLayout.height = Math.max(minSize, room.layout.y + room.layout.height - y);\n                        newLayout.y = Math.min(y, room.layout.y + room.layout.height - minSize);\n                    } else if (isResizing === 'tl') {\n                        newLayout.width = Math.max(minSize, room.layout.x + room.layout.width - x);\n                        newLayout.height = Math.max(minSize, room.layout.y + room.layout.height - y);\n                        newLayout.x = Math.min(x, room.layout.x + room.layout.width - minSize);\n                        newLayout.y = Math.min(y, room.layout.y + room.layout.height - minSize);\n                    } else if (isResizing === 't') {\n                        newLayout.height = Math.max(minSize, room.layout.y + room.layout.height - y);\n                        newLayout.y = Math.min(y, room.layout.y + room.layout.height - minSize);\n                    } else if (isResizing === 'r') {\n                        newLayout.width = Math.max(minSize, x - room.layout.x);\n                    } else if (isResizing === 'b') {\n                        newLayout.height = Math.max(minSize, y - room.layout.y);\n                    } else if (isResizing === 'l') {\n                        newLayout.width = Math.max(minSize, room.layout.x + room.layout.width - x);\n                        newLayout.x = Math.min(x, room.layout.x + room.layout.width - minSize);\n                    }\n                    \n                    onLayoutChange(activeRoomId, newLayout);\n                }\n            } else if (activeStructureId) {\n                const struct = structures.find(s => s.id === activeStructureId);\n                if (struct) {\n                    let newLayout = { ...struct.layout };\n                    const minSize = SNAP_GRID;\n                    \n                    if (isResizing === 'br') {\n                        newLayout.width = Math.max(minSize, x - struct.layout.x);\n                        newLayout.height = Math.max(minSize, y - struct.layout.y);\n                    } else if (isResizing === 'bl') {\n                        newLayout.width = Math.max(minSize, struct.layout.x + struct.layout.width - x);\n                        newLayout.height = Math.max(minSize, y - struct.layout.y);\n                        newLayout.x = Math.min(x, struct.layout.x + struct.layout.width - minSize);\n                    } else if (isResizing === 'tr') {\n                        newLayout.width = Math.max(minSize, x - struct.layout.x);\n                        newLayout.height = Math.max(minSize, struct.layout.y + struct.layout.height - y);\n                        newLayout.y = Math.min(y, struct.layout.y + struct.layout.height - minSize);\n                    } else if (isResizing === 'tl') {\n                        newLayout.width = Math.max(minSize, struct.layout.x + struct.layout.width - x);\n                        newLayout.height = Math.max(minSize, struct.layout.y + struct.layout.height - y);\n                        newLayout.x = Math.min(x, struct.layout.x + struct.layout.width - minSize);\n                        newLayout.y = Math.min(y, struct.layout.y + struct.layout.height - minSize);\n                    } else if (isResizing === 't') {\n                        newLayout.height = Math.max(minSize, struct.layout.y + struct.layout.height - y);\n                        newLayout.y = Math.min(y, struct.layout.y + struct.layout.height - minSize);\n                    } else if (isResizing === 'r') {\n                        newLayout.width = Math.max(minSize, x - struct.layout.x);\n                    } else if (isResizing === 'b') {\n                        newLayout.height = Math.max(minSize, y - struct.layout.y);\n                    } else if (isResizing === 'l') {\n                        newLayout.width = Math.max(minSize, struct.layout.x + struct.layout.width - x);\n                        newLayout.x = Math.min(x, struct.layout.x + struct.layout.width - minSize);\n                    }\n                    \n                    setStructures(prev => prev.map(s => s.id === activeStructureId ? { ...s, layout: newLayout } : s));\n                }\n            }\n        }\n\n        // 5. MEASUREMENT TOOL\n        if (activeTool === 'measure' && measureStartPoint) {\n            const distance = calculateDistance(measureStartPoint.x, measureStartPoint.y, x, y);\n            setCurrentMeasurement({\n                x1: measureStartPoint.x,\n                y1: measureStartPoint.y,\n                x2: x,\n                y2: y,\n                distance: formatMeasurement(distance, scale, measurementUnit)\n            });\n        }\n\n        // 6. PAN\n        if (isPanning && (e.buttons === 1 || e.touches)) {\n            const deltaX = e.movementX || (e.touches ? e.touches[0].clientX - (isPanning.startX || 0) : 0);\n            const deltaY = e.movementY || (e.touches ? e.touches[0].clientY - (isPanning.startY || 0) : 0);\n            setPanOffset(prev => ({\n                x: prev.x + deltaX / zoom,\n                y: prev.y + deltaY / zoom\n            }));\n            if (e.touches) {\n                setIsPanning({ ...isPanning, startX: e.touches[0].clientX, startY: e.touches[0].clientY });\n            }\n        }\n        \n    }, [activeRoomId, activeStructureId, isDragging, isResizing, draggingWallHandle, cursorOffset, rooms, onLayoutChange, activeTool, wallStartPoint]);\n\n    const stopInteraction = useCallback(() => {\n        // Commit changes on mouse up\n        if (isDragging || isResizing) {\n            if (activeStructureId) {\n                onStructuresChange(structures); \n                setHistoryState({ ...floorplanState, structures });\n            } else if (activeDoorId) {\n                commitDoors(doors);\n            } else if (activeWindowId) {\n                commitWindows(windows);\n            } else if (activeFurnitureId) {\n                commitFurniture(furniture);\n            }\n        }\n        if (draggingWallHandle) {\n            onWallsChange(walls);\n            setHistoryState({ ...floorplanState, walls });\n        }\n\n        setIsDragging(false);\n        setIsResizing(false);\n        setDraggingWallHandle(null);\n    }, [isDragging, isResizing, draggingWallHandle, activeStructureId, activeDoorId, activeWindowId, activeFurnitureId, structures, walls, doors, windows, furniture, onStructuresChange, onWallsChange, floorplanState, setHistoryState]);\n    \n    // --- CANVAS CLICK HANDLER ---\n    const handleCanvasClick = useCallback((e) => {\n        if (isDragging || isResizing || isPanning) return;\n        \n        const { x, y } = getCoords(e);\n\n        // WALL TOOL\n        if (activeTool === 'wall') {\n            e.stopPropagation();\n        if (!wallStartPoint) {\n            setWallStartPoint({ x, y });\n        } else {\n            const newWall = {\n                    id: generateId('wall'),\n                x1: wallStartPoint.x, y1: wallStartPoint.y,\n                x2: x, y2: y,\n                stroke: '#52525B', strokeWidth: 5\n            };\n                commitWalls([...walls.filter(w => w.id !== 'preview'), newWall]);\n                setWallStartPoint(null);\n            }\n            return;\n        }\n\n        // MEASUREMENT TOOL\n        if (activeTool === 'measure') {\n            e.stopPropagation();\n            if (!measureStartPoint) {\n                setMeasureStartPoint({ x, y });\n            } else {\n                const distance = calculateDistance(measureStartPoint.x, measureStartPoint.y, x, y);\n                const newMeasurement = {\n                    id: generateId('measure'),\n                    x1: measureStartPoint.x,\n                    y1: measureStartPoint.y,\n                    x2: x,\n                    y2: y,\n                    distance: formatMeasurement(distance, scale, measurementUnit)\n                };\n                setMeasurements(prev => [...prev, newMeasurement]);\n                setMeasureStartPoint(null);\n                setCurrentMeasurement(null);\n            }\n            return;\n        }\n\n        // DOOR TOOL\n        if (activeTool === 'door') {\n            e.stopPropagation();\n            const newDoor = {\n                id: generateId('door'),\n                type: 'door',\n                x: x - 15,\n                y: y - 30,\n                width: 30,\n                height: 60,\n                subType: 'single',\n                direction: 'left'\n            };\n            commitDoors([...doors, newDoor]);\n            setActiveDoorId(newDoor.id);\n            return;\n        }\n\n        // WINDOW TOOL\n        if (activeTool === 'window') {\n            e.stopPropagation();\n            const newWindow = {\n                id: generateId('window'),\n                type: 'window',\n                x: x - 20,\n                y: y - 30,\n                width: 40,\n                height: 60,\n                subType: 'standard'\n            };\n            commitWindows([...windows, newWindow]);\n            setActiveWindowId(newWindow.id);\n            return;\n        }\n\n        // FURNITURE TOOL\n        if (activeTool === 'furniture') {\n            e.stopPropagation();\n            const newFurniture = {\n                id: generateId('furniture'),\n                type: 'furniture',\n                x: x - 20,\n                y: y - 20,\n                width: 40,\n                height: 40,\n                subType: 'box',\n                rotation: 0\n            };\n            commitFurniture([...furniture, newFurniture]);\n            setActiveFurnitureId(newFurniture.id);\n            return;\n        }\n\n        // TEXT TOOL\n        if (activeTool === 'text') {\n            e.stopPropagation();\n            const newLabel = {\n                id: generateId('text'),\n                type: 'text',\n                x: x,\n                y: y,\n                text: 'Label',\n                fontSize: 14,\n                color: '#000000'\n            };\n            setTextLabels(prev => [...prev, newLabel]);\n            return;\n        }\n\n        // CIRCLE TOOL\n        if (activeTool === 'circle') {\n            e.stopPropagation();\n            const newCircle = {\n                id: generateId('circle'),\n                type: 'circle',\n                cx: x,\n                cy: y,\n                r: 30,\n                fill: '#3B82F6',\n                stroke: '#1E40AF',\n                strokeWidth: 2\n            };\n            setCustomShapes(prev => [...prev, newCircle]);\n            return;\n        }\n\n        // POLYGON TOOL (simplified - click to add points, double-click to finish)\n        if (activeTool === 'polygon') {\n            e.stopPropagation();\n            // Polygon creation would need state to track points\n            toast.info('Polygon tool: Click points, double-click to finish');\n            return;\n        }\n\n        // Deselect if clicking empty space\n        if (activeTool === 'select') {\n            if (!e.ctrlKey && !e.metaKey) {\n                setActiveRoomId(null);\n                setActiveStructureId(null);\n                setActiveWallId(null);\n                setActiveDoorId(null);\n                setActiveWindowId(null);\n                setActiveFurnitureId(null);\n                setSelectedItems(new Set());\n                setShowPropertyPanel(false);\n            }\n        }\n    }, [activeTool, wallStartPoint, measureStartPoint, isDragging, isResizing, isPanning, walls, doors, windows, furniture, scale, measurementUnit]);\n\n    // --- ZOOM HANDLERS ---\n    const handleZoomIn = () => {\n        setZoom(prev => Math.min(prev * 1.2, 5));\n    };\n\n    const handleZoomOut = () => {\n        setZoom(prev => Math.max(prev / 1.2, 0.1));\n    };\n\n    const handleFitToView = () => {\n        setZoom(1);\n        setPanOffset({ x: 0, y: 0 });\n    };\n\n    // --- EXPORT HANDLERS ---\n    const handleExportSVG = () => {\n        if (!svgRef.current) return;\n        const { svgString, blob } = exportSVG(svgRef.current, width, height);\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'floorplan.svg';\n        a.click();\n        URL.revokeObjectURL(url);\n        toast.success('Floor plan exported as SVG');\n    };\n\n    const handleExportPNG = async () => {\n        if (!svgRef.current) return;\n        try {\n            const blob = await exportPNG(svgRef.current, width, height, 2);\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'floorplan.png';\n            a.click();\n            URL.revokeObjectURL(url);\n            toast.success('Floor plan exported as PNG');\n        } catch (error) {\n            console.error('Export failed:', error);\n            toast.error('Failed to export PNG');\n        }\n    };\n\n    const handleExportPDF = async () => {\n        // PDF export requires jsPDF library - placeholder for now\n        toast.error('PDF export coming soon');\n    };\n\n    // --- BACKGROUND IMAGE IMPORT ---\n    const handleBackgroundImageUpload = (e) => {\n        const file = e.target.files?.[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = (event) => {\n            setBackgroundImage(event.target.result);\n            toast.success('Background image loaded');\n        };\n        reader.readAsDataURL(file);\n    };\n\n    // --- TEXT LABEL HANDLERS ---\n    const handleTextLabelUpdate = (labelId, updates) => {\n        setTextLabels(prev => prev.map(l => l.id === labelId ? { ...l, ...updates } : l));\n    };\n\n    // --- CUSTOM SHAPES ---\n    const addCircle = (x, y) => {\n        const newCircle = {\n            id: generateId('circle'),\n            type: 'circle',\n            cx: x,\n            cy: y,\n            r: 30,\n            fill: '#3B82F6',\n            stroke: '#1E40AF',\n            strokeWidth: 2\n        };\n        // Add to a shapes array (would need to be added to state)\n        toast.success('Circle added');\n    };\n\n    const addPolygon = (points) => {\n        const newPolygon = {\n            id: generateId('polygon'),\n            type: 'polygon',\n            points: points,\n            fill: '#3B82F6',\n            stroke: '#1E40AF',\n            strokeWidth: 2\n        };\n        // Add to shapes array\n        toast.success('Polygon added');\n    };\n\n    // --- TOOLBAR HANDLERS ---\n    const setTool = (tool) => {\n        setActiveTool(tool);\n        setWallStartPoint(null);\n        setMeasureStartPoint(null);\n        setCurrentMeasurement(null);\n        if (tool === 'structure') addStructure();\n        else if (tool === 'room') addRoom();\n        else if (tool === 'door') {\n            // Door placement will be handled on click\n        } else if (tool === 'window') {\n            // Window placement will be handled on click\n        } else if (tool === 'furniture') {\n            // Furniture placement will be handled on click\n        } else {\n            setWalls(prev => prev.filter(w => w.id !== 'preview')); // Clean preview\n        }\n    };\n\n    const addRoom = (template = null) => {\n        const baseRoom = template || {\n            name: `Room ${rooms.length + 1}`,\n            width: 150,\n            height: 120,\n            color: '#3B82F6'\n        };\n        \n        const newRoom = {\n            id: generateId('room'),\n            name: baseRoom.name,\n            layout: { \n                x: 100, \n                y: 100, \n                width: baseRoom.width, \n                height: baseRoom.height, \n                color: baseRoom.color \n            }\n        };\n        const updatedRooms = [...rooms, newRoom];\n        onLayoutChange(newRoom.id, newRoom.layout);\n        setHistoryState({ ...floorplanState });\n    };\n\n    // Collision detection\n    const checkCollision = (newItem, existingItems) => {\n        return existingItems.some(item => {\n            const itemRect = item.layout || { x: item.x, y: item.y, width: item.width, height: item.height };\n            const newRect = newItem.layout || { x: newItem.x, y: newItem.y, width: newItem.width, height: newItem.height };\n            \n            return !(newRect.x + newRect.width < itemRect.x ||\n                     itemRect.x + itemRect.width < newRect.x ||\n                     newRect.y + newRect.height < itemRect.y ||\n                     itemRect.y + itemRect.height < newRect.y);\n        });\n    };\n\n    // Auto-align helper\n    const autoAlign = (item, allItems, threshold = 10) => {\n        const itemRect = item.layout || { x: item.x, y: item.y, width: item.width, height: item.height };\n        let aligned = { ...itemRect };\n\n        allItems.forEach(other => {\n            if (other.id === item.id) return;\n            const otherRect = other.layout || { x: other.x, y: other.y, width: other.width, height: other.height };\n\n            // Align to top\n            if (Math.abs(itemRect.y - otherRect.y) < threshold) {\n                aligned.y = otherRect.y;\n            }\n            // Align to bottom\n            if (Math.abs((itemRect.y + itemRect.height) - (otherRect.y + otherRect.height)) < threshold) {\n                aligned.y = (otherRect.y + otherRect.height) - itemRect.height;\n            }\n            // Align to left\n            if (Math.abs(itemRect.x - otherRect.x) < threshold) {\n                aligned.x = otherRect.x;\n            }\n            // Align to right\n            if (Math.abs((itemRect.x + itemRect.width) - (otherRect.x + otherRect.width)) < threshold) {\n                aligned.x = (otherRect.x + otherRect.width) - itemRect.width;\n            }\n        });\n\n        return aligned;\n    };\n    \n    // Attach global listeners\n    useEffect(() => {\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', stopInteraction);\n        document.addEventListener('touchmove', handleMouseMove);\n        document.addEventListener('touchend', stopInteraction);\n        \n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', stopInteraction);\n            document.removeEventListener('touchmove', handleMouseMove);\n            document.removeEventListener('touchend', stopInteraction);\n        };\n    }, [handleMouseMove, stopInteraction]);\n\n    // --- RENDER SUB-COMPONENTS ---\n    \n    const WallSegment = ({ wall }) => {\n        const isPreview = wall.id === 'preview';\n        const isSelected = activeWallId === wall.id;\n        return (\n            <g onClick={(e) => selectWall(e, wall.id)} cursor=\"pointer\">\n                {/* Invisible hit area for easier selection */}\n                <line\n                    x1={wall.x1} y1={wall.y1} x2={wall.x2} y2={wall.y2}\n                    stroke=\"transparent\"\n                    strokeWidth=\"15\"\n                />\n                <line\n                    x1={wall.x1} y1={wall.y1} x2={wall.x2} y2={wall.y2}\n                    stroke={isPreview ? '#ef4444' : (isSelected ? '#3D84ED' : wall.stroke)}\n                    strokeWidth={wall.strokeWidth}\n                    strokeLinecap=\"round\"\n                    opacity={isPreview ? 0.7 : 1}\n                />\n                {!isPreview && (\n                    <>\n                        {/* Start Handle */}\n                        <circle \n                            cx={wall.x1} cy={wall.y1} r={6} \n                            fill=\"white\" stroke=\"#52525B\" strokeWidth=\"2\" \n                            className=\"cursor-move hover:fill-brand-blue\"\n                            onMouseDown={(e) => startDragWallHandle(e, wall.id, 'start')}\n                        />\n                        {/* End Handle */}\n                        <circle \n                            cx={wall.x2} cy={wall.y2} r={6} \n                            fill=\"white\" stroke=\"#52525B\" strokeWidth=\"2\" \n                            className=\"cursor-move hover:fill-brand-blue\"\n                            onMouseDown={(e) => startDragWallHandle(e, wall.id, 'end')}\n                        />\n                    </>\n                )}\n            </g>\n        );\n    };\n\n    // Generic Shape Renderer (Used for Rooms and Structures)\n    const LayoutShape = ({ data, isStructure = false, onClick }) => {\n        const { layout, name, rate, label } = data;\n        const isActive = isStructure ? activeStructureId === data.id : activeRoomId === data.id;\n        \n        // Calculate area for display\n        const area = layout.width && layout.height ? calculateArea(layout.width, layout.height, scale) : null;\n        \n        // Determine rounding based on wall locking\n        const checkCornerLocked = (cx, cy) => {\n            const THRESHOLD = 12; \n            return walls.some(w => getDistanceToLineSegment(cx, cy, w.x1, w.y1, w.x2, w.y2) < THRESHOLD);\n        };\n\n        const tlSharp = checkCornerLocked(layout.x, layout.y);\n        const trSharp = checkCornerLocked(layout.x + layout.width, layout.y);\n        const brSharp = checkCornerLocked(layout.x + layout.width, layout.y + layout.height);\n        const blSharp = checkCornerLocked(layout.x, layout.y + layout.height);\n\n        const r = 8; \n        const pathD = [\n            `M ${layout.x + (tlSharp?0:r)} ${layout.y}`,\n            `L ${layout.x + layout.width - (trSharp?0:r)} ${layout.y}`,\n            `Q ${layout.x + layout.width} ${layout.y} ${layout.x + layout.width} ${layout.y + (trSharp?0:r)}`,\n            `L ${layout.x + layout.width} ${layout.y + layout.height - (brSharp?0:r)}`,\n            `Q ${layout.x + layout.width} ${layout.y + layout.height} ${layout.x + layout.width - (brSharp?0:r)} ${layout.y + layout.height}`,\n            `L ${layout.x + (blSharp?0:r)} ${layout.y + layout.height}`,\n            `Q ${layout.x} ${layout.y + layout.height} ${layout.x} ${layout.y + layout.height - (blSharp?0:r)}`,\n            `L ${layout.x} ${layout.y + (tlSharp?0:r)}`,\n            `Q ${layout.x} ${layout.y} ${layout.x + (tlSharp?0:r)} ${layout.y}`,\n            `Z`\n        ].join(' ');\n\n        return (\n            <g \n                onClick={(e) => { \n                    e.stopPropagation(); \n                    onClick(data, e); \n                }} \n                cursor=\"pointer\" \n                style={{ filter: isActive ? `drop-shadow(0 0 5px ${layout.color})` : 'none' }}\n                pointerEvents={activeTool !== 'select' ? 'none' : 'auto'}\n            >\n                <path \n                    d={pathD}\n                    fill={layout.color} \n                    opacity={isStructure ? \"0.5\" : \"0.8\"} \n                    stroke={layout.color}\n                    strokeWidth=\"4\"\n                    strokeDasharray={isStructure ? \"5,5\" : \"0\"}\n                    onMouseDown={(e) => isStructure ? startDragStructure(e, data) : startDragRoom(e, data)}\n                    onTouchStart={(e) => isStructure ? startDragStructure(e, data) : startDragRoom(e, data)}\n                    style={{ cursor: isResizing ? 'default' : 'grab' }}\n                />\n                \n                <text \n                    x={layout.x + layout.width / 2}\n                    y={layout.y + layout.height / 2}\n                    fill=\"white\"\n                    textAnchor=\"middle\"\n                    dominantBaseline=\"middle\"\n                    style={{ pointerEvents: 'none', userSelect: 'none' }}\n                >\n                    <tspan x={layout.x + layout.width / 2} dy=\"-0.5em\" fontWeight=\"bold\" fontSize=\"14\">\n                        {isStructure ? (label || 'Area') : name}\n                    </tspan>\n                    {!isStructure && rate && (\n                        <tspan x={layout.x + layout.width / 2} dy=\"1.2em\" fontSize=\"12\">\n                            ${rate}/hr\n                        </tspan>\n                    )}\n                    {area && (\n                        <tspan x={layout.x + layout.width / 2} dy=\"1.2em\" fontSize=\"10\" opacity=\"0.8\">\n                            {area.sqft.toFixed(0)} sq ft\n                        </tspan>\n                    )}\n                </text>\n                \n                {/* 360 Image Indicator */}\n                {!isStructure && data.panorama360Url && (\n                    <g transform={`translate(${layout.x + layout.width - 20}, ${layout.y + 5})`}>\n                        <circle cx=\"0\" cy=\"0\" r=\"8\" fill=\"#10B981\" opacity=\"0.9\" />\n                        <text x=\"0\" y=\"3\" fontSize=\"8\" fill=\"white\" textAnchor=\"middle\" style={{ pointerEvents: 'none' }}>360</text>\n                    </g>\n                )}\n                \n                {/* Multi-handle Resize Handles */}\n                {isActive && (\n                    <>\n                        {/* Corner Handles */}\n                        <rect x={layout.x - 5} y={layout.y - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"nwse-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'tl') : startResizeRoom(e, data, 'tl')} />\n                        <rect x={layout.x + layout.width - 5} y={layout.y - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"nesw-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'tr') : startResizeRoom(e, data, 'tr')} />\n                        <rect x={layout.x + layout.width - 5} y={layout.y + layout.height - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"nwse-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'br') : startResizeRoom(e, data, 'br')} />\n                        <rect x={layout.x - 5} y={layout.y + layout.height - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"nesw-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'bl') : startResizeRoom(e, data, 'bl')} />\n                        \n                        {/* Edge Handles */}\n                        <rect x={layout.x + layout.width / 2 - 5} y={layout.y - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"ns-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 't') : startResizeRoom(e, data, 't')} />\n                        <rect x={layout.x + layout.width - 5} y={layout.y + layout.height / 2 - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"ew-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'r') : startResizeRoom(e, data, 'r')} />\n                        <rect x={layout.x + layout.width / 2 - 5} y={layout.y + layout.height - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"ns-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'b') : startResizeRoom(e, data, 'b')} />\n                        <rect x={layout.x - 5} y={layout.y + layout.height / 2 - 5} width=\"10\" height=\"10\" fill=\"white\" stroke=\"#3D84ED\" strokeWidth=\"2\" cursor=\"ew-resize\" onMouseDown={(e) => isStructure ? startResizeStructure(e, data, 'l') : startResizeRoom(e, data, 'l')} />\n                    </>\n                )}\n            </g>\n        );\n    };\n\n    // Get selected item for property panel\n    const getSelectedItem = () => {\n        if (activeRoomId) return rooms.find(r => r.id === activeRoomId);\n        if (activeStructureId) return structures.find(s => s.id === activeStructureId);\n        if (activeWallId) return walls.find(w => w.id === activeWallId);\n        if (activeDoorId) return doors.find(d => d.id === activeDoorId);\n        if (activeWindowId) return windows.find(w => w.id === activeWindowId);\n        if (activeFurnitureId) return furniture.find(f => f.id === activeFurnitureId);\n        return null;\n    };\n\n    const handlePropertyUpdate = (updates) => {\n        const item = getSelectedItem();\n        if (!item) return;\n\n        if (activeRoomId) {\n            const updated = { ...item, ...updates };\n            onLayoutChange(activeRoomId, updated.layout || item.layout);\n        } else if (activeStructureId) {\n            commitStructures(structures.map(s => s.id === activeStructureId ? { ...s, ...updates } : s));\n        } else if (activeWallId) {\n            commitWalls(walls.map(w => w.id === activeWallId ? { ...w, ...updates } : w));\n        } else if (activeDoorId) {\n            commitDoors(doors.map(d => d.id === activeDoorId ? { ...d, ...updates } : d));\n        } else if (activeWindowId) {\n            commitWindows(windows.map(w => w.id === activeWindowId ? { ...w, ...updates } : w));\n        } else if (activeFurnitureId) {\n            commitFurniture(furniture.map(f => f.id === activeFurnitureId ? { ...f, ...updates } : f));\n        }\n    };\n\n    const handleLayerToggle = (layerKey) => {\n        setLayers(prev => ({\n            ...prev,\n            [layerKey]: { ...prev[layerKey], visible: !prev[layerKey]?.visible }\n        }));\n    };\n\n    const handleLayerLock = (layerKey) => {\n        setLayers(prev => ({\n            ...prev,\n            [layerKey]: { ...prev[layerKey], locked: !prev[layerKey]?.locked }\n        }));\n    };\n\n    const handleContextMenuAction = (action) => {\n        const item = getSelectedItem();\n        if (!item) return;\n\n        switch (action) {\n            case 'copy':\n                handleCopy();\n                break;\n            case 'paste':\n                handlePaste();\n                break;\n            case 'cut':\n                handleCut();\n                break;\n            case 'delete':\n                handleDelete();\n                break;\n            case 'rotate':\n                if (item.layout || item.x !== undefined) {\n                    const currentRotation = item.rotation || 0;\n                    handlePropertyUpdate({ rotation: (currentRotation + 90) % 360 });\n                }\n                break;\n            case 'flipH':\n                // Flip horizontal logic\n                break;\n            case 'flipV':\n                // Flip vertical logic\n                break;\n            default:\n                break;\n        }\n    };\n\n    return (\n        <div className=\"flex h-[650px]\">\n            {/* Tools Sidebar */}\n            <FloorplanTools\n                activeTool={activeTool}\n                setActiveTool={setTool}\n                onUndo={undo}\n                onRedo={redo}\n                canUndo={canUndo}\n                canRedo={canRedo}\n                onZoomIn={handleZoomIn}\n                onZoomOut={handleZoomOut}\n                onFitToView={handleFitToView}\n                onExportSVG={handleExportSVG}\n                onExportPNG={handleExportPNG}\n                onExportPDF={handleExportPDF}\n                showGrid={showGrid}\n                toggleGrid={() => setShowGrid(!showGrid)}\n                measurementUnit={measurementUnit}\n                setMeasurementUnit={setMeasurementUnit}\n                scale={scale}\n                setScale={setScale}\n                onBackgroundImageUpload={handleBackgroundImageUpload}\n                onAddRoomTemplate={(template) => addRoom(template)}\n            />\n\n            <div className=\"flex flex-col flex-1\">\n            {/* Control Bar */}\n            <div className='p-3 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-[#2c2e36] rounded-t-xl'>\n                <div className='flex gap-4 text-sm text-gray-500 font-medium'>\n                        <button onClick={handleCopy} disabled={!activeStructureId && !activeWallId && !activeDoorId && !activeWindowId && !activeFurnitureId} className='hover:text-brand-blue disabled:opacity-50 flex items-center gap-1'><Copy size={14}/> Copy</button>\n                    <button onClick={handlePaste} disabled={!clipboard} className='hover:text-brand-blue disabled:opacity-50 flex items-center gap-1'><Clipboard size={14}/> Paste</button>\n                        <button onClick={handleCut} disabled={!activeStructureId && !activeWallId && !activeDoorId && !activeWindowId && !activeFurnitureId} className='hover:text-brand-blue disabled:opacity-50 flex items-center gap-1'><Scissors size={14}/> Cut</button>\n                        <button onClick={handleDelete} disabled={!activeStructureId && !activeWallId && !activeDoorId && !activeWindowId && !activeFurnitureId} className='hover:text-red-500 disabled:opacity-50 flex items-center gap-1'><Trash2 size={14}/> Delete</button>\n                </div>\n                \n                    <div className=\"flex gap-2 items-center\">\n                        <span className=\"text-xs text-gray-500\">Zoom: {(zoom * 100).toFixed(0)}%</span>\n                    <button \n                        className={`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${activeTool === 'structure' ? 'bg-purple-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200'}`}\n                        onClick={() => setTool('structure')}\n                    >\n                            <BoxSelect size={16}/> Add Area\n                    </button>\n                    <button \n                        className={`px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-2 transition ${activeTool === 'wall' ? 'bg-red-500 text-white shadow-lg' : 'bg-brand-blue text-white hover:bg-blue-600'}`}\n                        onClick={() => setTool(activeTool === 'wall' ? 'select' : 'wall')}\n                    >\n                            <Zap size={16}/> {activeTool === 'wall' ? (wallStartPoint ? 'Finish' : 'Wall') : 'Add Wall'}\n                    </button>\n                </div>\n            </div>\n            \n            {/* SVG Canvas */}\n            <div \n                    ref={containerRef}\n                    className=\"flex-1 overflow-hidden bg-gray-50 dark:bg-[#1f2128] rounded-b-xl border-x border-b dark:border-gray-700 relative\"\n                    style={{ cursor: activeTool === 'wall' || activeTool === 'measure' ? 'crosshair' : isPanning ? 'grabbing' : 'default' }}\n                    tabIndex={0}\n                    onMouseDown={startPan}\n                    onMouseUp={stopPan}\n                    onMouseLeave={stopPan}\n                    onContextMenu={(e) => {\n                        e.preventDefault();\n                        const item = getSelectedItem();\n                        if (item) {\n                            setContextMenu({ x: e.clientX, y: e.clientY });\n                        }\n                }}\n            >\n                <svg \n                    ref={svgRef}\n                    width={width} height={height} \n                    className=\"w-full h-full shadow-inner focus:outline-none\"\n                    viewBox={`${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`}\n                    style={{ transform: `scale(${zoom})`, transformOrigin: 'top left' }}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={(e) => { stopInteraction(); stopPan(); }}\n                    onTouchMove={handleMouseMove}\n                    onTouchEnd={(e) => { stopInteraction(); stopPan(); }}\n                    onClick={handleCanvasClick}\n                >\n                    {/* Background Image */}\n                    {backgroundImage && (\n                        <image\n                            href={backgroundImage}\n                            x={0}\n                            y={0}\n                            width={width}\n                            height={height}\n                            opacity=\"0.3\"\n                        />\n                    )}\n\n                    {/* Grid */}\n                    {showGrid && (\n                        <>\n                            <pattern id=\"smallGrid\" width={gridSize} height={gridSize} patternUnits=\"userSpaceOnUse\">\n                                <path d={`M ${gridSize} 0 L 0 0 0 ${gridSize}`} fill=\"none\" stroke=\"#e5e7eb\" strokeWidth=\"0.5\"/>\n                    </pattern>\n                    <rect width=\"100%\" height=\"100%\" fill=\"url(#smallGrid)\" />\n                        </>\n                    )}\n                    \n                    {/* Layer 1: Structures (Lobbies) */}\n                    {layers.structures?.visible !== false && structures.map((struct) => (\n                        <LayoutShape \n                            key={struct.id} \n                            data={struct} \n                            isStructure={true} \n                            onClick={(s) => {\n                                setActiveStructureId(s.id);\n                                setShowPropertyPanel(true);\n                                setActiveRoomId(null);\n                                setActiveWallId(null);\n                                setActiveDoorId(null);\n                                setActiveWindowId(null);\n                                setActiveFurnitureId(null);\n                            }} \n                        />\n                    ))}\n\n                    {/* Layer 2: Functional Rooms */}\n                    {layers.rooms?.visible !== false && rooms.map((room) => (\n                        <LayoutShape \n                            key={room.id} \n                            data={room} \n                            onClick={(r) => {\n                                if (r.panorama360Url && (e?.ctrlKey || e?.metaKey)) {\n                                    setViewing360Room(r);\n                                } else {\n                                    setActiveRoomId(r.id);\n                                    setShowPropertyPanel(true);\n                                    setActiveStructureId(null);\n                                    setActiveWallId(null);\n                                    setActiveDoorId(null);\n                                    setActiveWindowId(null);\n                                    setActiveFurnitureId(null);\n                                    onRoomClick(rooms.findIndex(rm => rm.id === r.id));\n                                }\n                            }} \n                        />\n                    ))}\n                    \n                    {/* Layer 3: Walls */}\n                    {layers.walls?.visible !== false && walls.map((wall) => (\n                        <WallSegment key={wall.id} wall={wall} />\n                    ))}\n\n                    {/* Layer 4: Doors */}\n                    {layers.doors?.visible !== false && doors.map((door) => (\n                        <DoorComponent\n                            key={door.id}\n                            door={door}\n                            isSelected={activeDoorId === door.id}\n                            onClick={() => {\n                                setActiveDoorId(door.id);\n                                setShowPropertyPanel(true);\n                                setActiveRoomId(null);\n                                setActiveStructureId(null);\n                                setActiveWallId(null);\n                                setActiveWindowId(null);\n                                setActiveFurnitureId(null);\n                            }}\n                            onMouseDown={(e) => {\n                                if (activeTool === 'select') {\n                                    e.preventDefault();\n                                    setActiveDoorId(door.id);\n                                    setIsDragging(true);\n                                    const { x, y } = getCoords(e);\n                                    setCursorOffset({ x: x - door.x, y: y - door.y });\n                                }\n                            }}\n                        />\n                    ))}\n\n                    {/* Layer 5: Windows */}\n                    {layers.windows?.visible !== false && windows.map((window) => (\n                        <WindowComponent\n                            key={window.id}\n                            window={window}\n                            isSelected={activeWindowId === window.id}\n                            onClick={() => {\n                                setActiveWindowId(window.id);\n                                setShowPropertyPanel(true);\n                                setActiveRoomId(null);\n                                setActiveStructureId(null);\n                                setActiveWallId(null);\n                                setActiveDoorId(null);\n                                setActiveFurnitureId(null);\n                            }}\n                            onMouseDown={(e) => {\n                                if (activeTool === 'select') {\n                                    e.preventDefault();\n                                    setActiveWindowId(window.id);\n                                    setIsDragging(true);\n                                    const { x, y } = getCoords(e);\n                                    setCursorOffset({ x: x - window.x, y: y - window.y });\n                                }\n                            }}\n                        />\n                    ))}\n\n                    {/* Layer 6: Furniture */}\n                    {layers.furniture?.visible !== false && furniture.map((item) => (\n                        <FurnitureComponent\n                            key={item.id}\n                            furniture={item}\n                            isSelected={activeFurnitureId === item.id}\n                            onClick={() => {\n                                setActiveFurnitureId(item.id);\n                                setShowPropertyPanel(true);\n                                setActiveRoomId(null);\n                                setActiveStructureId(null);\n                                setActiveWallId(null);\n                                setActiveDoorId(null);\n                                setActiveWindowId(null);\n                            }}\n                            onMouseDown={(e) => {\n                                if (activeTool === 'select') {\n                                    e.preventDefault();\n                                    setActiveFurnitureId(item.id);\n                                    setIsDragging(true);\n                                    const { x, y } = getCoords(e);\n                                    setCursorOffset({ x: x - item.x, y: y - item.y });\n                                }\n                            }}\n                        />\n                    ))}\n\n                    {/* Layer 7: Text Labels */}\n                    {layers.text?.visible !== false && textLabels.map((label) => (\n                        <g key={label.id}>\n                            <text\n                                x={label.x}\n                                y={label.y}\n                                fontSize={label.fontSize || 14}\n                                fill={label.color || \"#000\"}\n                                fontWeight={label.bold ? \"bold\" : \"normal\"}\n                                className=\"cursor-pointer\"\n                                onClick={() => {\n                                    // Edit text label - could open property panel\n                                }}\n                            >\n                                {label.text}\n                            </text>\n                            {label.selected && (\n                                <rect\n                                    x={label.x - 5}\n                                    y={label.y - label.fontSize - 5}\n                                    width={label.text.length * (label.fontSize * 0.6) + 10}\n                                    height={label.fontSize + 10}\n                                    fill=\"none\"\n                                    stroke=\"#3D84ED\"\n                                    strokeWidth={2}\n                                    strokeDasharray=\"5,5\"\n                                />\n                            )}\n                        </g>\n                    ))}\n\n                    {/* Layer 8: Custom Shapes */}\n                    {layers.shapes?.visible !== false && customShapes.map((shape) => {\n                        if (shape.type === 'circle') {\n                            return (\n                                <circle\n                                    key={shape.id}\n                                    cx={shape.cx}\n                                    cy={shape.cy}\n                                    r={shape.r}\n                                    fill={shape.fill}\n                                    stroke={shape.stroke}\n                                    strokeWidth={shape.strokeWidth}\n                                    className=\"cursor-pointer\"\n                                    onClick={() => {\n                                        // Select shape\n                                    }}\n                                />\n                            );\n                        } else if (shape.type === 'polygon') {\n                            return (\n                                <polygon\n                                    key={shape.id}\n                                    points={shape.points.map(p => `${p.x},${p.y}`).join(' ')}\n                                    fill={shape.fill}\n                                    stroke={shape.stroke}\n                                    strokeWidth={shape.strokeWidth}\n                                    className=\"cursor-pointer\"\n                                />\n                            );\n                        }\n                        return null;\n                    })}\n\n                    {/* Layer 9: Measurements */}\n                    {layers.measurements?.visible !== false && measurements.map((measure) => (\n                        <g key={measure.id}>\n                            <line\n                                x1={measure.x1}\n                                y1={measure.y1}\n                                x2={measure.x2}\n                                y2={measure.y2}\n                                stroke=\"#3D84ED\"\n                                strokeWidth={2}\n                                strokeDasharray=\"5,5\"\n                            />\n                            <circle cx={measure.x1} cy={measure.y1} r={4} fill=\"#3D84ED\" />\n                            <circle cx={measure.x2} cy={measure.y2} r={4} fill=\"#3D84ED\" />\n                            <text\n                                x={(measure.x1 + measure.x2) / 2}\n                                y={(measure.y1 + measure.y2) / 2 - 5}\n                                fontSize=\"12\"\n                                fill=\"#3D84ED\"\n                                textAnchor=\"middle\"\n                                className=\"pointer-events-none\"\n                            >\n                                {measure.distance}\n                            </text>\n                        </g>\n                    ))}\n\n                    {/* Current Measurement Preview */}\n                    {currentMeasurement && (\n                        <g>\n                            <line\n                                x1={currentMeasurement.x1}\n                                y1={currentMeasurement.y1}\n                                x2={currentMeasurement.x2}\n                                y2={currentMeasurement.y2}\n                                stroke=\"#3D84ED\"\n                                strokeWidth={2}\n                                strokeDasharray=\"5,5\"\n                            />\n                            <circle cx={currentMeasurement.x1} cy={currentMeasurement.y1} r={4} fill=\"#3D84ED\" />\n                            <circle cx={currentMeasurement.x2} cy={currentMeasurement.y2} r={4} fill=\"#3D84ED\" />\n                            <text\n                                x={(currentMeasurement.x1 + currentMeasurement.x2) / 2}\n                                y={(currentMeasurement.y1 + currentMeasurement.y2) / 2 - 5}\n                                fontSize=\"12\"\n                                fill=\"#3D84ED\"\n                                textAnchor=\"middle\"\n                                className=\"pointer-events-none\"\n                            >\n                                {currentMeasurement.distance}\n                            </text>\n                        </g>\n                    )}\n\n                    {/* Info Overlay */}\n                    <g className=\"pointer-events-none\">\n                        <text x=\"10\" y=\"20\" fontSize=\"10\" fill=\"#9CA3AF\">Grid: {gridSize}px | {walls.length} Walls | {rooms.length} Rooms</text>\n                        <text x=\"10\" y=\"35\" fontSize=\"10\" fill=\"#9CA3AF\">Ctrl+Click room with 360 icon to view | Space+Drag to pan</text>\n                        {activeRoomId && (() => {\n                            const room = rooms.find(r => r.id === activeRoomId);\n                            if (room && room.layout) {\n                                const area = calculateArea(room.layout.width, room.layout.height, scale);\n                                return (\n                                    <text x=\"10\" y=\"50\" fontSize=\"10\" fill=\"#9CA3AF\">\n                                        Area: {area.display}\n                                    </text>\n                                );\n                            }\n                            return null;\n                        })()}\n                    </g>\n                </svg>\n                </div>\n                \n                {/* 360 Viewer Modal */}\n                {viewing360Room && (\n                    <div className=\"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-4\">\n                        <div className=\"w-full max-w-4xl\">\n                            <Panorama360Viewer \n                                imageUrl={viewing360Room.panorama360Url}\n                                title={viewing360Room.name || 'Room View'}\n                                onClose={() => setViewing360Room(null)}\n                            />\n                        </div>\n                    </div>\n                )}\n                \n                {/* Context Menu */}\n                {contextMenu && (\n                    <FloorplanContextMenu\n                        x={contextMenu.x}\n                        y={contextMenu.y}\n                        onClose={() => setContextMenu(null)}\n                        onAction={handleContextMenuAction}\n                        canCopy={!!getSelectedItem()}\n                        canPaste={!!clipboard}\n                        canCut={!!getSelectedItem()}\n                        canDelete={!!getSelectedItem()}\n                        canRotate={!!getSelectedItem()?.layout}\n                        canFlip={!!getSelectedItem()?.layout}\n                        isLocked={false}\n                    />\n                )}\n\n                {/* Property Panel */}\n                {showPropertyPanel && getSelectedItem() && (\n                    <FloorplanPropertyPanel\n                        selectedItem={getSelectedItem()}\n                        onClose={() => setShowPropertyPanel(false)}\n                        onUpdate={handlePropertyUpdate}\n                        scale={scale}\n                        unit={measurementUnit}\n                    />\n                )}\n\n                {/* Layer Panel */}\n                <FloorplanLayerPanel\n                    layers={layers}\n                    onLayerToggle={handleLayerToggle}\n                    onLayerLock={handleLayerLock}\n                />\n            </div>\n        </div>\n    );\n}\n","import React, { useState, useRef } from 'react';\r\nimport { \r\n    Plus, Edit2, Trash2, Users, DollarSign, Mic, \r\n    LayoutGrid, Save, Loader2, ChevronDown, ChevronUp,\r\n    Copy, Map, List\r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport toast from 'react-hot-toast';\r\nimport { useLanguage } from '../../contexts/LanguageContext';\r\nimport EquipmentAutocomplete from '../shared/EquipmentAutocomplete';\r\nimport FloorplanEditor from './FloorplanEditor';\r\nimport Panorama360Viewer from './Panorama360Viewer';\r\nimport { useImageUpload } from '../../hooks/useImageUpload';\r\nimport { Image as ImageIcon, Upload, X } from 'lucide-react';\r\n\r\n/**\r\n * StudioRooms - Complete room management interface\r\n */\r\nexport default function StudioRooms({ user, userData, onUpdate }) {\r\n    const { t } = useLanguage();\r\n    const [rooms, setRooms] = useState(userData?.rooms || []);\r\n    const [walls, setWalls] = useState(userData?.floorplanWalls || []);\r\n    const [structures, setStructures] = useState(userData?.floorplanStructures || []);\r\n    const [editingRoom, setEditingRoom] = useState(null);\r\n    const [isAdding, setIsAdding] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n    const [expandedRoom, setExpandedRoom] = useState(null);\r\n    const [viewMode, setViewMode] = useState('list'); // 'list' or 'floorplan'\r\n\r\n    const emptyRoom = {\r\n        name: '',\r\n        description: '',\r\n        rate: 50,\r\n        capacity: 4,\r\n        equipment: [], // Array of {name, brand, model, quantity}\r\n        amenities: [],\r\n        minBookingHours: 1,\r\n        active: true,\r\n        color: '#3B82F6',\r\n        panorama360Url: null // 360-degree image URL\r\n    };\r\n\r\n    const handleSave = async (updatedRooms, updatedWalls = walls, updatedStructures = structures) => {\r\n        if (!supabase) return;\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving rooms...');\r\n        const userId = user?.id || user?.uid;\r\n        \r\n        try {\r\n            await supabase\r\n                .from('profiles')\r\n                .update({ \r\n                    rooms: updatedRooms,\r\n                    floorplan_walls: updatedWalls,\r\n                    floorplan_structures: updatedStructures,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', userId);\r\n            \r\n            setRooms(updatedRooms);\r\n            setWalls(updatedWalls);\r\n            setStructures(updatedStructures);\r\n            toast.success('Rooms saved!', { id: toastId });\r\n            if (onUpdate) onUpdate({ rooms: updatedRooms, floorplanWalls: updatedWalls, floorplanStructures: updatedStructures });\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save', { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    // Floorplan handlers\r\n    const handleLayoutChange = (roomId, newLayout) => {\r\n        const updatedRooms = rooms.map(r => \r\n            r.id === roomId ? { ...r, layout: newLayout } : r\r\n        );\r\n        setRooms(updatedRooms);\r\n    };\r\n\r\n    const handleWallsChange = async (newWalls) => {\r\n        if (!supabase) return;\r\n        setWalls(newWalls);\r\n        const userId = user?.id || user?.uid;\r\n        // Auto-save walls\r\n        try {\r\n            await supabase\r\n                .from('profiles')\r\n                .update({ floorplan_walls: newWalls, updated_at: new Date().toISOString() })\r\n                .eq('id', userId);\r\n        } catch (error) {\r\n            console.error('Error saving walls:', error);\r\n        }\r\n    };\r\n\r\n    const handleStructuresChange = async (newStructures) => {\r\n        if (!supabase) return;\r\n        setStructures(newStructures);\r\n        const userId = user?.id || user?.uid;\r\n        // Auto-save structures\r\n        try {\r\n            await supabase\r\n                .from('profiles')\r\n                .update({ floorplan_structures: newStructures, updated_at: new Date().toISOString() })\r\n                .eq('id', userId);\r\n        } catch (error) {\r\n            console.error('Error saving structures:', error);\r\n        }\r\n    };\r\n\r\n    const handleRoomClick = (roomIndex) => {\r\n        if (roomIndex >= 0 && roomIndex < rooms.length) {\r\n            handleEditRoom(roomIndex);\r\n        }\r\n    };\r\n\r\n    const handleAddRoom = () => {\r\n        setEditingRoom({ ...emptyRoom, name: `Room ${rooms.length + 1}` });\r\n        setIsAdding(true);\r\n    };\r\n\r\n    const handleEditRoom = (index) => {\r\n        setEditingRoom({ ...rooms[index] });\r\n        setIsAdding(false);\r\n        setExpandedRoom(index);\r\n    };\r\n\r\n    const handleSaveRoom = async () => {\r\n        if (!editingRoom.name.trim()) {\r\n            toast.error('Room name is required');\r\n            return;\r\n        }\r\n\r\n        let updatedRooms;\r\n        if (isAdding) {\r\n            updatedRooms = [...rooms, editingRoom];\r\n        } else {\r\n            updatedRooms = rooms.map((r, i) => i === expandedRoom ? editingRoom : r);\r\n        }\r\n\r\n        await handleSave(updatedRooms);\r\n        setEditingRoom(null);\r\n        setIsAdding(false);\r\n        setExpandedRoom(null);\r\n    };\r\n\r\n    const handleDeleteRoom = async (index) => {\r\n        if (!confirm(`Delete \"${rooms[index].name}\"? This cannot be undone.`)) return;\r\n        \r\n        const updatedRooms = rooms.filter((_, i) => i !== index);\r\n        await handleSave(updatedRooms);\r\n    };\r\n\r\n    const handleDuplicateRoom = async (index) => {\r\n        const roomToCopy = { ...rooms[index], name: `${rooms[index].name} (Copy)` };\r\n        const updatedRooms = [...rooms, roomToCopy];\r\n        await handleSave(updatedRooms);\r\n    };\r\n\r\n    const handleCancelEdit = () => {\r\n        setEditingRoom(null);\r\n        setIsAdding(false);\r\n        setExpandedRoom(null);\r\n    };\r\n\r\n    const ROOM_AMENITIES = [\r\n        'Isolation Booth', 'Live Room', 'Control Room', 'Lounge Area',\r\n        'Private Bathroom', 'Natural Light', 'Blackout Curtains', \r\n        'Video Feed', 'Climate Control', 'Sound Lock'\r\n    ];\r\n\r\n    // Prepare rooms with layout for floorplan\r\n    const roomsWithLayout = rooms.map((room, index) => ({\r\n        ...room,\r\n        id: room.id || `room_${index}`,\r\n        layout: room.layout || {\r\n            x: 50 + (index % 3) * 200,\r\n            y: 50 + Math.floor(index / 3) * 150,\r\n            width: 180,\r\n            height: 120,\r\n            color: room.color || '#3B82F6'\r\n        }\r\n    }));\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <LayoutGrid className=\"text-brand-blue\" size={24} />\r\n                        Room Management\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Configure your studio rooms, rates, and equipment\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    {/* View Toggle */}\r\n                    <div className=\"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1\">\r\n                        <button\r\n                            onClick={() => setViewMode('list')}\r\n                            className={`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${\r\n                                viewMode === 'list' \r\n                                    ? 'bg-white dark:bg-gray-700 shadow text-brand-blue' \r\n                                    : 'text-gray-600 dark:text-gray-400'\r\n                            }`}\r\n                        >\r\n                            <List size={16} /> List\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setViewMode('floorplan')}\r\n                            className={`px-3 py-1.5 rounded-md text-sm font-medium transition flex items-center gap-1.5 ${\r\n                                viewMode === 'floorplan' \r\n                                    ? 'bg-white dark:bg-gray-700 shadow text-brand-blue' \r\n                                    : 'text-gray-600 dark:text-gray-400'\r\n                            }`}\r\n                        >\r\n                            <Map size={16} /> Floorplan\r\n                        </button>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleAddRoom}\r\n                        disabled={isAdding || editingRoom}\r\n                        className=\"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                    >\r\n                        <Plus size={18} /> Add Room\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Add New Room Form */}\r\n            {isAdding && editingRoom && (\r\n                                    <RoomEditor\r\n                                        room={editingRoom}\r\n                                        setRoom={setEditingRoom}\r\n                                        onSave={handleSaveRoom}\r\n                                        onCancel={handleCancelEdit}\r\n                                        saving={saving}\r\n                                        isNew={true}\r\n                                        roomAmenities={ROOM_AMENITIES}\r\n                                        user={user}\r\n                                    />\r\n            )}\r\n\r\n            {/* Floorplan View */}\r\n            {viewMode === 'floorplan' && !isAdding && (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                    <FloorplanEditor\r\n                        rooms={roomsWithLayout}\r\n                        walls={walls}\r\n                        structures={structures}\r\n                        onRoomClick={handleRoomClick}\r\n                        onLayoutChange={handleLayoutChange}\r\n                        onWallsChange={handleWallsChange}\r\n                        onStructuresChange={handleStructuresChange}\r\n                    />\r\n                    <div className=\"p-3 bg-gray-50 dark:bg-[#23262f] border-t dark:border-gray-700 text-xs text-gray-500\">\r\n                        <strong>Tips:</strong> Click a room to edit  Drag to reposition  Use corner handles to resize  Add walls to define boundaries\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Room List */}\r\n            {viewMode === 'list' && (\r\n            <div className=\"space-y-4\">\r\n                {rooms.length === 0 && !isAdding ? (\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center\">\r\n                        <LayoutGrid size={48} className=\"mx-auto mb-4 text-gray-300 dark:text-gray-600\" />\r\n                        <h3 className=\"text-lg font-bold dark:text-white mb-2\">No Rooms Yet</h3>\r\n                        <p className=\"text-gray-500 dark:text-gray-400 mb-4 max-w-sm mx-auto\">\r\n                            Add your first room to start accepting bookings\r\n                        </p>\r\n                        <button\r\n                            onClick={handleAddRoom}\r\n                            className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition\"\r\n                        >\r\n                            Add Your First Room\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    rooms.map((room, index) => (\r\n                        <div key={index} className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm\">\r\n                            {/* Room Header */}\r\n                            <div \r\n                                className=\"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-[#23262f] transition\"\r\n                                onClick={() => setExpandedRoom(expandedRoom === index ? null : index)}\r\n                            >\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div \r\n                                        className=\"w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg\"\r\n                                        style={{ backgroundColor: room.color || '#3B82F6' }}\r\n                                    >\r\n                                        {room.name.charAt(0)}\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <h3 className=\"font-bold dark:text-white\">{room.name}</h3>\r\n                                            {room.active === false && (\r\n                                                <span className=\"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-0.5 rounded\">\r\n                                                    Inactive\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                                            <span className=\"flex items-center gap-1\">\r\n                                                <DollarSign size={14} />\r\n                                                ${room.rate}/hr\r\n                                            </span>\r\n                                            <span className=\"flex items-center gap-1\">\r\n                                                <Users size={14} />\r\n                                                {room.capacity} people\r\n                                            </span>\r\n                                            {room.equipment && (\r\n                                                <span className=\"flex items-center gap-1\">\r\n                                                    <Mic size={14} />\r\n                                                    {Array.isArray(room.equipment) \r\n                                                        ? room.equipment.reduce((sum, item) => sum + (item.quantity || 1), 0)\r\n                                                        : room.equipment.split(',').length} items\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); handleDuplicateRoom(index); }}\r\n                                        className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                        title=\"Duplicate\"\r\n                                    >\r\n                                        <Copy size={16} />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); handleEditRoom(index); }}\r\n                                        className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                        title=\"Edit\"\r\n                                    >\r\n                                        <Edit2 size={16} />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); handleDeleteRoom(index); }}\r\n                                        className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                        title=\"Delete\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                    {expandedRoom === index ? <ChevronUp size={20} /> : <ChevronDown size={20} />}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Expanded Edit Form */}\r\n                            {expandedRoom === index && editingRoom && (\r\n                                <div className=\"border-t dark:border-gray-700\">\r\n                                    <RoomEditor\r\n                                        room={editingRoom}\r\n                                        setRoom={setEditingRoom}\r\n                                        onSave={handleSaveRoom}\r\n                                        onCancel={handleCancelEdit}\r\n                                        saving={saving}\r\n                                        isNew={false}\r\n                                        roomAmenities={ROOM_AMENITIES}\r\n                                        user={user}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Collapsed Preview */}\r\n                            {expandedRoom === index && !editingRoom && (\r\n                                <div className=\"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#1f2128]\">\r\n                                    {room.description && (\r\n                                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3\">{room.description}</p>\r\n                                    )}\r\n                                    {room.equipment && (\r\n                                        <div className=\"flex flex-wrap gap-2\">\r\n                                            {Array.isArray(room.equipment) \r\n                                                ? room.equipment.map((item, i) => (\r\n                                                    <span key={i} className=\"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded\">\r\n                                                        {item.brand && `${item.brand} `}{item.name || item.model}\r\n                                                        {(item.quantity && item.quantity > 1) && ` (${item.quantity})`}\r\n                                                    </span>\r\n                                                ))\r\n                                                : room.equipment.split(',').map((item, i) => (\r\n                                                    <span key={i} className=\"text-xs bg-white dark:bg-gray-800 border dark:border-gray-700 px-2 py-1 rounded\">\r\n                                                        {item.trim()}\r\n                                                    </span>\r\n                                                ))\r\n                                            }\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * RoomEditor - Form for editing room details\r\n */\r\nfunction RoomEditor({ room, setRoom, onSave, onCancel, saving, isNew, roomAmenities, user }) {\r\n    const { uploadImage, uploading } = useImageUpload();\r\n    const [show360Viewer, setShow360Viewer] = useState(false);\r\n    const fileInputRef = useRef(null);\r\n\r\n    const handleAmenityToggle = (amenity) => {\r\n        const current = room.amenities || [];\r\n        if (current.includes(amenity)) {\r\n            setRoom({ ...room, amenities: current.filter(a => a !== amenity) });\r\n        } else {\r\n            setRoom({ ...room, amenities: [...current, amenity] });\r\n        }\r\n    };\r\n\r\n    const handle360ImageUpload = async (e) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        // Validate file type (equirectangular 360 images)\r\n        const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n        if (!validTypes.includes(file.type)) {\r\n            toast.error('Please upload a JPEG or PNG image');\r\n            return;\r\n        }\r\n\r\n        // Validate file size (max 20MB for 360 images)\r\n        if (file.size > 20 * 1024 * 1024) {\r\n            toast.error('Image size must be less than 20MB');\r\n            return;\r\n        }\r\n\r\n        const userId = user?.id || user?.uid || 'temp';\r\n        const path = `studio-rooms/${userId}/360-images`;\r\n        \r\n        const toastId = toast.loading('Uploading 360 image...');\r\n        \r\n        try {\r\n            const url = await uploadImage(file, path);\r\n            if (url) {\r\n                setRoom({ ...room, panorama360Url: url });\r\n                toast.success('360 image uploaded successfully!', { id: toastId });\r\n            } else {\r\n                toast.error('Upload failed', { id: toastId });\r\n            }\r\n        } catch (error) {\r\n            console.error('360 image upload error:', error);\r\n            toast.error('Failed to upload image', { id: toastId });\r\n        }\r\n    };\r\n\r\n    const handleRemove360Image = () => {\r\n        setRoom({ ...room, panorama360Url: null });\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-6 bg-gray-50 dark:bg-[#1f2128] space-y-5\">\r\n            {isNew && (\r\n                <h3 className=\"font-bold dark:text-white text-lg mb-4\">Add New Room</h3>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Room Name *</label>\r\n                    <input\r\n                        className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                        value={room.name}\r\n                        onChange={e => setRoom({ ...room, name: e.target.value })}\r\n                        placeholder=\"e.g. Studio A\"\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Room Color</label>\r\n                    <div className=\"flex gap-2\">\r\n                        <input\r\n                            type=\"color\"\r\n                            className=\"w-12 h-12 rounded-lg border dark:border-gray-600 cursor-pointer\"\r\n                            value={room.color || '#3B82F6'}\r\n                            onChange={e => setRoom({ ...room, color: e.target.value })}\r\n                        />\r\n                        <input\r\n                            className=\"flex-1 p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white\"\r\n                            value={room.color || '#3B82F6'}\r\n                            onChange={e => setRoom({ ...room, color: e.target.value })}\r\n                            placeholder=\"#3B82F6\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Description</label>\r\n                <textarea\r\n                    className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                    rows={2}\r\n                    value={room.description || ''}\r\n                    onChange={e => setRoom({ ...room, description: e.target.value })}\r\n                    placeholder=\"Describe this room, its vibe, and what makes it special...\"\r\n                />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Hourly Rate ($)</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                        value={room.rate}\r\n                        onChange={e => setRoom({ ...room, rate: parseInt(e.target.value) || 0 })}\r\n                        min={0}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Capacity</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                        value={room.capacity}\r\n                        onChange={e => setRoom({ ...room, capacity: parseInt(e.target.value) || 1 })}\r\n                        min={1}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Min Hours</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none\"\r\n                        value={room.minBookingHours || 1}\r\n                        onChange={e => setRoom({ ...room, minBookingHours: parseInt(e.target.value) || 1 })}\r\n                        min={1}\r\n                    />\r\n                </div>\r\n                <div className=\"flex items-end\">\r\n                    <label className=\"flex items-center gap-2 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl cursor-pointer w-full\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            className=\"w-4 h-4 text-brand-blue\"\r\n                            checked={room.active !== false}\r\n                            onChange={e => setRoom({ ...room, active: e.target.checked })}\r\n                        />\r\n                        <span className=\"text-sm font-medium dark:text-white\">Active</span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Equipment</label>\r\n                <RoomEquipmentManager\r\n                    equipment={Array.isArray(room.equipment) ? room.equipment : (room.equipment ? room.equipment.split(',').map(item => ({\r\n                        name: item.trim(),\r\n                        brand: '',\r\n                        model: '',\r\n                        quantity: 1\r\n                    })) : [])}\r\n                    onChange={(equipment) => setRoom({ ...room, equipment })}\r\n                />\r\n            </div>\r\n\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-2 block\">Room Features</label>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    {roomAmenities.map(amenity => (\r\n                        <button\r\n                            key={amenity}\r\n                            type=\"button\"\r\n                            onClick={() => handleAmenityToggle(amenity)}\r\n                            className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all border ${\r\n                                (room.amenities || []).includes(amenity)\r\n                                    ? 'bg-brand-blue text-white border-brand-blue'\r\n                                    : 'bg-white dark:bg-[#2c2e36] text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-brand-blue'\r\n                            }`}\r\n                        >\r\n                            {amenity}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* 360 Image Section */}\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-2 block\">360 Panorama Image</label>\r\n                <div className=\"space-y-3\">\r\n                    {room.panorama360Url ? (\r\n                        <div className=\"relative\">\r\n                            <Panorama360Viewer \r\n                                imageUrl={room.panorama360Url} \r\n                                title={room.name || 'Room View'}\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleRemove360Image}\r\n                                className=\"absolute top-3 right-3 p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg shadow-lg transition z-20\"\r\n                                title=\"Remove 360 image\"\r\n                            >\r\n                                <X size={18} />\r\n                            </button>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"border-2 border-dashed dark:border-gray-600 rounded-xl p-8 text-center bg-white dark:bg-[#2c2e36]\">\r\n                            <ImageIcon size={48} className=\"mx-auto mb-3 text-gray-400\" />\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\r\n                                Upload a 360 equirectangular panorama image\r\n                            </p>\r\n                            <input\r\n                                ref={fileInputRef}\r\n                                type=\"file\"\r\n                                accept=\"image/jpeg,image/jpg,image/png\"\r\n                                onChange={handle360ImageUpload}\r\n                                className=\"hidden\"\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                disabled={uploading}\r\n                                className=\"px-4 py-2 bg-brand-blue text-white rounded-lg font-medium hover:bg-blue-600 transition flex items-center gap-2 mx-auto disabled:opacity-50\"\r\n                            >\r\n                                {uploading ? (\r\n                                    <>\r\n                                        <Loader2 className=\"animate-spin\" size={18} />\r\n                                        Uploading...\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <Upload size={18} />\r\n                                        Upload 360 Image\r\n                                    </>\r\n                                )}\r\n                            </button>\r\n                            <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-2\">\r\n                                Supports JPEG/PNG  Max 20MB  Equirectangular format recommended\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex justify-end gap-3 pt-4 border-t dark:border-gray-700\">\r\n                <button\r\n                    onClick={onCancel}\r\n                    className=\"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl font-medium transition\"\r\n                >\r\n                    Cancel\r\n                </button>\r\n                <button\r\n                    onClick={onSave}\r\n                    disabled={saving}\r\n                    className=\"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                    {isNew ? 'Add Room' : 'Save Changes'}\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * RoomEquipmentManager - Component for managing room equipment with quantity\r\n */\r\nfunction RoomEquipmentManager({ equipment, onChange }) {\r\n    const [selectedItem, setSelectedItem] = useState(null);\r\n    const [quantity, setQuantity] = useState(1);\r\n\r\n    const handleAddEquipment = (item) => {\r\n        if (!item || !item.name) return;\r\n        \r\n        const newEquipment = {\r\n            name: item.name,\r\n            brand: item.brand || '',\r\n            model: item.model || item.name,\r\n            quantity: quantity || 1\r\n        };\r\n        \r\n        onChange([...(equipment || []), newEquipment]);\r\n        setSelectedItem(null);\r\n        setQuantity(1);\r\n    };\r\n\r\n    const handleRemoveEquipment = (index) => {\r\n        const updated = equipment.filter((_, i) => i !== index);\r\n        onChange(updated);\r\n    };\r\n\r\n    const handleUpdateQuantity = (index, newQuantity) => {\r\n        const updated = equipment.map((item, i) => \r\n            i === index ? { ...item, quantity: Math.max(1, parseInt(newQuantity) || 1) } : item\r\n        );\r\n        onChange(updated);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-3\">\r\n            <div className=\"flex gap-2\">\r\n                <div className=\"flex-1\">\r\n                    <EquipmentAutocomplete\r\n                        onSelect={(item) => {\r\n                            setSelectedItem(item);\r\n                            setQuantity(1);\r\n                        }}\r\n                        placeholder=\"Search and add equipment...\"\r\n                    />\r\n                </div>\r\n                {selectedItem && (\r\n                    <>\r\n                        <input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            value={quantity}\r\n                            onChange={(e) => setQuantity(parseInt(e.target.value) || 1)}\r\n                            className=\"w-20 p-2 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white text-sm\"\r\n                            placeholder=\"Qty\"\r\n                        />\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => handleAddEquipment(selectedItem)}\r\n                            className=\"px-4 py-2 bg-brand-blue text-white rounded-xl font-medium hover:bg-blue-600 transition flex items-center gap-1\"\r\n                        >\r\n                            <Plus size={16} /> Add\r\n                        </button>\r\n                    </>\r\n                )}\r\n            </div>\r\n            \r\n            {equipment && equipment.length > 0 && (\r\n                <div className=\"space-y-2\">\r\n                    {equipment.map((item, index) => (\r\n                        <div key={index} className=\"flex items-center gap-2 p-2 bg-gray-50 dark:bg-[#1f2128] rounded-lg border dark:border-gray-700\">\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <div className=\"font-medium text-sm dark:text-white\">\r\n                                    {item.brand && <span className=\"text-gray-500\">{item.brand} </span>}\r\n                                    {item.name || item.model}\r\n                                </div>\r\n                            </div>\r\n                            <input\r\n                                type=\"number\"\r\n                                min=\"1\"\r\n                                value={item.quantity || 1}\r\n                                onChange={(e) => handleUpdateQuantity(index, e.target.value)}\r\n                                className=\"w-16 p-1.5 border rounded-lg dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white text-sm text-center\"\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => handleRemoveEquipment(index)}\r\n                                className=\"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                            >\r\n                                <X size={16} />\r\n                            </button>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import { useState, useCallback } from 'react';\r\nimport { \r\n    Image, Upload, Trash2, Star, \r\n    Loader2, X, Plus, Eye, Move\r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport { useMediaUpload } from '../../hooks/useMediaUpload';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * StudioGallery - Photo gallery management for studio\r\n */\r\nexport default function StudioGallery({ user, userData, onUpdate }) {\r\n    const [photos, setPhotos] = useState(userData?.studioPhotos || []);\r\n    const [uploadProgress, setUploadProgress] = useState(0);\r\n    const [selectedPhoto, setSelectedPhoto] = useState(null);\r\n    const [draggingIndex, setDraggingIndex] = useState(null);\r\n    const { uploadMedia, uploading } = useMediaUpload();\r\n    const userId = user?.id || user?.uid;\r\n\r\n    const savePhotos = useCallback(async (updatedPhotos) => {\r\n        if (!supabase) return false;\r\n        try {\r\n            await supabase\r\n                .from('profiles')\r\n                .update({ \r\n                    studio_photos: updatedPhotos,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', userId);\r\n            \r\n            setPhotos(updatedPhotos);\r\n            if (onUpdate) onUpdate({ studioPhotos: updatedPhotos });\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save photos');\r\n            return false;\r\n        }\r\n    }, [userId, onUpdate]);\r\n\r\n    const handleUpload = useCallback(async (files) => {\r\n        if (!files || files.length === 0) return;\r\n        \r\n        const maxPhotos = 12;\r\n        if (photos.length >= maxPhotos) {\r\n            toast.error(`Maximum ${maxPhotos} photos allowed`);\r\n            return;\r\n        }\r\n\r\n        const toastId = toast.loading('Uploading photos...');\r\n        \r\n        const newPhotos = [];\r\n        \r\n        for (const file of Array.from(files).slice(0, maxPhotos - photos.length)) {\r\n            // Validate file\r\n            if (!file.type.startsWith('image/')) {\r\n                toast.error(`${file.name} is not an image`);\r\n                continue;\r\n            }\r\n            if (file.size > 5 * 1024 * 1024) {\r\n                toast.error(`${file.name} is too large (max 5MB)`);\r\n                continue;\r\n            }\r\n\r\n            try {\r\n                const timestamp = Date.now();\r\n                const result = await uploadMedia(file, `studio/gallery/${userId}`);\r\n                \r\n                if (result?.url) {\r\n                    newPhotos.push({\r\n                        id: timestamp.toString(),\r\n                        url: result.url,\r\n                        path: result.storageRef || `studio/gallery/${userId}/${timestamp}_${file.name}`,\r\n                        filename: file.name,\r\n                        caption: '',\r\n                        isCover: photos.length === 0 && newPhotos.length === 0, // First photo is cover\r\n                        uploadedAt: new Date().toISOString()\r\n                    });\r\n                }\r\n            } catch (error) {\r\n                console.error('Upload error:', error);\r\n                toast.error(`Failed to upload ${file.name}`);\r\n            }\r\n        }\r\n\r\n        if (newPhotos.length > 0) {\r\n            const success = await savePhotos([...photos, ...newPhotos]);\r\n            if (success) {\r\n                toast.success(`${newPhotos.length} photo(s) uploaded!`, { id: toastId });\r\n            }\r\n        } else {\r\n            toast.dismiss(toastId);\r\n        }\r\n        \r\n        setUploadProgress(0);\r\n    }, [photos, userId, savePhotos, uploadMedia]);\r\n\r\n    const handleDelete = async (photoIndex) => {\r\n        const photo = photos[photoIndex];\r\n        if (!confirm('Delete this photo?')) return;\r\n        \r\n        const toastId = toast.loading('Deleting...');\r\n        \r\n        try {\r\n            // Note: File deletion from MinIO storage should be handled by backend API\r\n            // For now, we just remove it from the database\r\n            \r\n            // Update photos array\r\n            let updatedPhotos = photos.filter((_, i) => i !== photoIndex);\r\n            \r\n            // If we deleted the cover photo, make the first remaining photo the cover\r\n            if (photo.isCover && updatedPhotos.length > 0) {\r\n                updatedPhotos = updatedPhotos.map((p, i) => ({ ...p, isCover: i === 0 }));\r\n            }\r\n            \r\n            await savePhotos(updatedPhotos);\r\n            toast.success('Photo deleted', { id: toastId });\r\n        } catch (error) {\r\n            console.error('Delete error:', error);\r\n            toast.error('Failed to delete photo', { id: toastId });\r\n        }\r\n    };\r\n\r\n    const handleSetCover = async (photoIndex) => {\r\n        const updatedPhotos = photos.map((p, i) => ({ ...p, isCover: i === photoIndex }));\r\n        await savePhotos(updatedPhotos);\r\n        toast.success('Cover photo updated');\r\n    };\r\n\r\n    // Caption editing can be added as a future enhancement\r\n    // const handleUpdateCaption = async (photoIndex, caption) => { ... }\r\n\r\n    const handleDragStart = (index) => {\r\n        setDraggingIndex(index);\r\n    };\r\n\r\n    const handleDragOver = (e, index) => {\r\n        e.preventDefault();\r\n        if (draggingIndex === null || draggingIndex === index) return;\r\n        \r\n        const reorderedPhotos = [...photos];\r\n        const [draggedPhoto] = reorderedPhotos.splice(draggingIndex, 1);\r\n        reorderedPhotos.splice(index, 0, draggedPhoto);\r\n        \r\n        setPhotos(reorderedPhotos);\r\n        setDraggingIndex(index);\r\n    };\r\n\r\n    const handleDragEnd = async () => {\r\n        if (draggingIndex !== null) {\r\n            await savePhotos(photos);\r\n            setDraggingIndex(null);\r\n        }\r\n    };\r\n\r\n    const handleFileDrop = (e) => {\r\n        e.preventDefault();\r\n        const files = e.dataTransfer?.files;\r\n        if (files) handleUpload(files);\r\n    };\r\n\r\n    const coverPhoto = photos.find(p => p.isCover) || photos[0];\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Image className=\"text-brand-blue\" size={24} />\r\n                        Photo Gallery\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Showcase your studio with up to 12 photos\r\n                    </p>\r\n                </div>\r\n                <span className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                    {photos.length}/12 photos\r\n                </span>\r\n            </div>\r\n\r\n            {/* Cover Photo Preview */}\r\n            {coverPhoto && (\r\n                <div className=\"relative rounded-xl overflow-hidden aspect-video bg-gray-100 dark:bg-gray-800 group\">\r\n                    <img\r\n                        src={coverPhoto.url}\r\n                        alt=\"Cover\"\r\n                        className=\"w-full h-full object-cover\"\r\n                    />\r\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                        <div className=\"absolute bottom-4 left-4 text-white\">\r\n                            <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n                                <Star size={16} className=\"fill-yellow-400 text-yellow-400\" />\r\n                                Cover Photo\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Upload Area */}\r\n            <div\r\n                className={`border-2 border-dashed rounded-xl p-8 text-center transition-all ${\r\n                    uploading \r\n                        ? 'border-brand-blue bg-blue-50 dark:bg-blue-900/20' \r\n                        : 'border-gray-200 dark:border-gray-700 hover:border-brand-blue hover:bg-blue-50/50 dark:hover:bg-blue-900/10'\r\n                }`}\r\n                onDrop={handleFileDrop}\r\n                onDragOver={(e) => e.preventDefault()}\r\n            >\r\n                {uploading ? (\r\n                    <div className=\"space-y-3\">\r\n                        <Loader2 className=\"mx-auto animate-spin text-brand-blue\" size={40} />\r\n                        <div className=\"w-full max-w-xs mx-auto bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                            <div \r\n                                className=\"bg-brand-blue h-2 rounded-full transition-all duration-300\"\r\n                                style={{ width: `${uploadProgress}%` }}\r\n                            />\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500\">Uploading... {Math.round(uploadProgress)}%</p>\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        <Upload className=\"mx-auto text-gray-400 mb-3\" size={40} />\r\n                        <p className=\"text-gray-600 dark:text-gray-400 mb-2\">\r\n                            Drag & drop images here, or\r\n                        </p>\r\n                        <label className=\"cursor-pointer\">\r\n                            <span className=\"text-brand-blue font-bold hover:underline\">browse files</span>\r\n                            <input\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                multiple\r\n                                className=\"hidden\"\r\n                                onChange={(e) => handleUpload(e.target.files)}\r\n                                disabled={uploading}\r\n                            />\r\n                        </label>\r\n                        <p className=\"text-xs text-gray-400 mt-2\">\r\n                            JPG, PNG or WebP. Max 5MB per file.\r\n                        </p>\r\n                    </>\r\n                )}\r\n            </div>\r\n\r\n            {/* Photo Grid */}\r\n            {photos.length > 0 && (\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n                    {photos.map((photo, index) => (\r\n                        <div\r\n                            key={photo.id}\r\n                            draggable\r\n                            onDragStart={() => handleDragStart(index)}\r\n                            onDragOver={(e) => handleDragOver(e, index)}\r\n                            onDragEnd={handleDragEnd}\r\n                            className={`relative aspect-square rounded-xl overflow-hidden group bg-gray-100 dark:bg-gray-800 cursor-move ${\r\n                                draggingIndex === index ? 'opacity-50 ring-2 ring-brand-blue' : ''\r\n                            }`}\r\n                        >\r\n                            <img\r\n                                src={photo.url}\r\n                                alt={photo.caption || `Studio photo ${index + 1}`}\r\n                                className=\"w-full h-full object-cover\"\r\n                            />\r\n                            \r\n                            {/* Cover badge */}\r\n                            {photo.isCover && (\r\n                                <div className=\"absolute top-2 left-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-lg flex items-center gap-1\">\r\n                                    <Star size={12} className=\"fill-white\" /> Cover\r\n                                </div>\r\n                            )}\r\n                            \r\n                            {/* Hover overlay */}\r\n                            <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2\">\r\n                                <button\r\n                                    onClick={() => setSelectedPhoto(photo)}\r\n                                    className=\"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition\"\r\n                                    title=\"View\"\r\n                                >\r\n                                    <Eye size={18} />\r\n                                </button>\r\n                                {!photo.isCover && (\r\n                                    <button\r\n                                        onClick={() => handleSetCover(index)}\r\n                                        className=\"p-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition\"\r\n                                        title=\"Set as cover\"\r\n                                    >\r\n                                        <Star size={18} />\r\n                                    </button>\r\n                                )}\r\n                                <button\r\n                                    onClick={() => handleDelete(index)}\r\n                                    className=\"p-2 bg-red-500/80 hover:bg-red-500 rounded-lg text-white transition\"\r\n                                    title=\"Delete\"\r\n                                >\r\n                                    <Trash2 size={18} />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Drag handle */}\r\n                            <div className=\"absolute top-2 right-2 p-1 bg-black/40 rounded text-white opacity-0 group-hover:opacity-100 transition\">\r\n                                <Move size={14} />\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n\r\n                    {/* Add more button */}\r\n                    {photos.length < 12 && (\r\n                        <label className=\"aspect-square rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700 hover:border-brand-blue transition cursor-pointer flex flex-col items-center justify-center text-gray-400 hover:text-brand-blue\">\r\n                            <Plus size={32} />\r\n                            <span className=\"text-xs mt-1\">Add Photo</span>\r\n                            <input\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                multiple\r\n                                className=\"hidden\"\r\n                                onChange={(e) => handleUpload(e.target.files)}\r\n                                disabled={uploading}\r\n                            />\r\n                        </label>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Empty state */}\r\n            {photos.length === 0 && !uploading && (\r\n                <div className=\"text-center py-8 text-gray-400\">\r\n                    <Image size={48} className=\"mx-auto mb-3 opacity-30\" />\r\n                    <p>No photos uploaded yet</p>\r\n                    <p className=\"text-sm\">Add photos to attract more clients</p>\r\n                </div>\r\n            )}\r\n\r\n            {/* Photo Lightbox */}\r\n            {selectedPhoto && (\r\n                <div \r\n                    className=\"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4\"\r\n                    onClick={() => setSelectedPhoto(null)}\r\n                >\r\n                    <button \r\n                        className=\"absolute top-4 right-4 text-white hover:text-gray-300 transition\"\r\n                        onClick={() => setSelectedPhoto(null)}\r\n                    >\r\n                        <X size={32} />\r\n                    </button>\r\n                    <img\r\n                        src={selectedPhoto.url}\r\n                        alt={selectedPhoto.caption || 'Studio photo'}\r\n                        className=\"max-w-full max-h-[90vh] object-contain rounded-lg\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                    />\r\n                    {selectedPhoto.caption && (\r\n                        <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black/70 text-white px-6 py-3 rounded-xl\">\r\n                            {selectedPhoto.caption}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import { useState } from 'react';\r\nimport { \r\n    Clock, Calendar, Save, Loader2, Plus, Trash2, \r\n    Moon, Sun, AlertCircle, X, Copy\r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst DAYS_OF_WEEK = [\r\n    { id: 'sunday', label: 'Sunday', short: 'Sun' },\r\n    { id: 'monday', label: 'Monday', short: 'Mon' },\r\n    { id: 'tuesday', label: 'Tuesday', short: 'Tue' },\r\n    { id: 'wednesday', label: 'Wednesday', short: 'Wed' },\r\n    { id: 'thursday', label: 'Thursday', short: 'Thu' },\r\n    { id: 'friday', label: 'Friday', short: 'Fri' },\r\n    { id: 'saturday', label: 'Saturday', short: 'Sat' },\r\n];\r\n\r\nconst DEFAULT_HOURS = {\r\n    sunday: { closed: true, open: '10:00', close: '18:00' },\r\n    monday: { closed: false, open: '09:00', close: '22:00' },\r\n    tuesday: { closed: false, open: '09:00', close: '22:00' },\r\n    wednesday: { closed: false, open: '09:00', close: '22:00' },\r\n    thursday: { closed: false, open: '09:00', close: '22:00' },\r\n    friday: { closed: false, open: '09:00', close: '23:00' },\r\n    saturday: { closed: false, open: '10:00', close: '23:00' },\r\n};\r\n\r\n/**\r\n * StudioAvailability - Operating hours and blackout dates management\r\n */\r\nexport default function StudioAvailability({ user, userData, onUpdate }) {\r\n    const [hours, setHours] = useState(userData?.operatingHours || DEFAULT_HOURS);\r\n    const [blackoutDates, setBlackoutDates] = useState(userData?.blackoutDates || []);\r\n    const [saving, setSaving] = useState(false);\r\n    const [newBlackout, setNewBlackout] = useState({ start: '', end: '', reason: '' });\r\n    const [showAddBlackout, setShowAddBlackout] = useState(false);\r\n\r\n    const handleSave = async () => {\r\n        if (!supabase) return;\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving availability...');\r\n        const userId = user?.id || user?.uid;\r\n        \r\n        try {\r\n            await supabase\r\n                .from('profiles')\r\n                .update({ \r\n                    operating_hours: hours,\r\n                    blackout_dates: blackoutDates,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', userId);\r\n            \r\n            toast.success('Availability saved!', { id: toastId });\r\n            if (onUpdate) onUpdate({ operatingHours: hours, blackoutDates });\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save', { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const updateDayHours = (dayId, field, value) => {\r\n        setHours(prev => ({\r\n            ...prev,\r\n            [dayId]: { ...prev[dayId], [field]: value }\r\n        }));\r\n    };\r\n\r\n    const toggleDayClosed = (dayId) => {\r\n        setHours(prev => ({\r\n            ...prev,\r\n            [dayId]: { ...prev[dayId], closed: !prev[dayId]?.closed }\r\n        }));\r\n    };\r\n\r\n    const copyToAllWeekdays = (dayId) => {\r\n        const sourceHours = hours[dayId];\r\n        const weekdays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];\r\n        \r\n        setHours(prev => {\r\n            const newHours = { ...prev };\r\n            weekdays.forEach(day => {\r\n                newHours[day] = { ...sourceHours };\r\n            });\r\n            return newHours;\r\n        });\r\n        toast.success('Copied to all weekdays');\r\n    };\r\n\r\n    const addBlackoutDate = () => {\r\n        if (!newBlackout.start) {\r\n            toast.error('Start date is required');\r\n            return;\r\n        }\r\n        \r\n        const blackout = {\r\n            id: Date.now().toString(),\r\n            start: newBlackout.start,\r\n            end: newBlackout.end || newBlackout.start,\r\n            reason: newBlackout.reason || 'Blocked'\r\n        };\r\n        \r\n        setBlackoutDates([...blackoutDates, blackout]);\r\n        setNewBlackout({ start: '', end: '', reason: '' });\r\n        setShowAddBlackout(false);\r\n    };\r\n\r\n    const removeBlackoutDate = (id) => {\r\n        setBlackoutDates(blackoutDates.filter(b => b.id !== id));\r\n    };\r\n\r\n    const formatTime = (time) => {\r\n        if (!time) return '';\r\n        const [h, m] = time.split(':');\r\n        const hour = parseInt(h);\r\n        const ampm = hour >= 12 ? 'PM' : 'AM';\r\n        const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;\r\n        return `${displayHour}:${m} ${ampm}`;\r\n    };\r\n\r\n    // Calculate total weekly hours\r\n    const totalWeeklyHours = DAYS_OF_WEEK.reduce((total, day) => {\r\n        const dayHours = hours[day.id];\r\n        if (dayHours?.closed) return total;\r\n        \r\n        const [openH, openM] = (dayHours?.open || '09:00').split(':').map(Number);\r\n        const [closeH, closeM] = (dayHours?.close || '17:00').split(':').map(Number);\r\n        const openMinutes = openH * 60 + openM;\r\n        const closeMinutes = closeH * 60 + closeM;\r\n        \r\n        return total + Math.max(0, (closeMinutes - openMinutes) / 60);\r\n    }, 0);\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Clock className=\"text-brand-blue\" size={24} />\r\n                        Availability & Hours\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Set your operating hours and manage blackout dates\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={handleSave}\r\n                    disabled={saving}\r\n                    className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                    Save Changes\r\n                </button>\r\n            </div>\r\n\r\n            {/* Weekly Summary */}\r\n            <div className=\"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h3 className=\"text-lg font-bold mb-1\">Weekly Availability</h3>\r\n                        <p className=\"text-indigo-100\">\r\n                            {DAYS_OF_WEEK.filter(d => !hours[d.id]?.closed).length} days open  {Math.round(totalWeeklyHours)} hours/week\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                        <div className=\"text-4xl font-bold\">{Math.round(totalWeeklyHours)}</div>\r\n                        <div className=\"text-sm text-indigo-100\">hours</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Operating Hours */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Sun size={18} className=\"text-amber-500\" />\r\n                        Operating Hours\r\n                    </h3>\r\n                </div>\r\n                <div className=\"divide-y dark:divide-gray-700\">\r\n                    {DAYS_OF_WEEK.map(day => {\r\n                        const dayHours = hours[day.id] || { closed: false, open: '09:00', close: '17:00' };\r\n                        \r\n                        return (\r\n                            <div \r\n                                key={day.id}\r\n                                className={`p-4 flex items-center gap-4 ${dayHours.closed ? 'bg-gray-50 dark:bg-[#1f2128]' : ''}`}\r\n                            >\r\n                                <div className=\"w-28\">\r\n                                    <span className={`font-medium ${dayHours.closed ? 'text-gray-400' : 'dark:text-white'}`}>\r\n                                        {day.label}\r\n                                    </span>\r\n                                </div>\r\n                                \r\n                                <button\r\n                                    onClick={() => toggleDayClosed(day.id)}\r\n                                    className={`px-3 py-1.5 rounded-lg text-sm font-medium transition ${\r\n                                        dayHours.closed \r\n                                            ? 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400' \r\n                                            : 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                                    }`}\r\n                                >\r\n                                    {dayHours.closed ? 'Closed' : 'Open'}\r\n                                </button>\r\n\r\n                                {!dayHours.closed && (\r\n                                    <>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <input\r\n                                                type=\"time\"\r\n                                                value={dayHours.open || '09:00'}\r\n                                                onChange={(e) => updateDayHours(day.id, 'open', e.target.value)}\r\n                                                className=\"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                            />\r\n                                            <span className=\"text-gray-400\">to</span>\r\n                                            <input\r\n                                                type=\"time\"\r\n                                                value={dayHours.close || '17:00'}\r\n                                                onChange={(e) => updateDayHours(day.id, 'close', e.target.value)}\r\n                                                className=\"p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                            />\r\n                                        </div>\r\n                                        \r\n                                        <span className=\"text-sm text-gray-400 hidden md:inline\">\r\n                                            {formatTime(dayHours.open)}  {formatTime(dayHours.close)}\r\n                                        </span>\r\n                                        \r\n                                        <button\r\n                                            onClick={() => copyToAllWeekdays(day.id)}\r\n                                            className=\"ml-auto p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                            title=\"Copy to all weekdays\"\r\n                                        >\r\n                                            <Copy size={16} />\r\n                                        </button>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Blackout Dates */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Moon size={18} className=\"text-indigo-500\" />\r\n                        Blackout Dates\r\n                    </h3>\r\n                    <button\r\n                        onClick={() => setShowAddBlackout(!showAddBlackout)}\r\n                        className=\"text-sm bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition flex items-center gap-1\"\r\n                    >\r\n                        <Plus size={16} /> Add Blackout\r\n                    </button>\r\n                </div>\r\n                \r\n                {/* Add Blackout Form */}\r\n                {showAddBlackout && (\r\n                    <div className=\"p-4 bg-indigo-50 dark:bg-indigo-900/20 border-b dark:border-gray-700\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Start Date *</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={newBlackout.start}\r\n                                    onChange={(e) => setNewBlackout({ ...newBlackout, start: e.target.value })}\r\n                                    className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">End Date</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={newBlackout.end}\r\n                                    onChange={(e) => setNewBlackout({ ...newBlackout, end: e.target.value })}\r\n                                    className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    min={newBlackout.start}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Reason</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={newBlackout.reason}\r\n                                    onChange={(e) => setNewBlackout({ ...newBlackout, reason: e.target.value })}\r\n                                    placeholder=\"e.g. Holiday, Maintenance\"\r\n                                    className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"flex items-end gap-2\">\r\n                                <button\r\n                                    onClick={addBlackoutDate}\r\n                                    className=\"flex-1 p-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition\"\r\n                                >\r\n                                    Add\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setShowAddBlackout(false)}\r\n                                    className=\"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                                >\r\n                                    <X size={20} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Blackout List */}\r\n                <div className=\"p-4\">\r\n                    {blackoutDates.length === 0 ? (\r\n                        <div className=\"text-center py-8 text-gray-400\">\r\n                            <Moon size={32} className=\"mx-auto mb-2 opacity-30\" />\r\n                            <p className=\"text-sm\">No blackout dates scheduled</p>\r\n                            <p className=\"text-xs\">Add dates when your studio is unavailable</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-2\">\r\n                            {blackoutDates.sort((a, b) => new Date(a.start) - new Date(b.start)).map(blackout => (\r\n                                <div \r\n                                    key={blackout.id}\r\n                                    className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"w-10 h-10 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg flex items-center justify-center\">\r\n                                            <Calendar className=\"text-indigo-600 dark:text-indigo-400\" size={18} />\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"font-medium dark:text-white text-sm\">\r\n                                                {new Date(blackout.start).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}\r\n                                                {blackout.end !== blackout.start && (\r\n                                                    <>  {new Date(blackout.end).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</>\r\n                                                )}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-gray-500\">{blackout.reason}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => removeBlackoutDate(blackout.id)}\r\n                                        className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tips */}\r\n            <div className=\"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4\">\r\n                <div className=\"flex gap-3\">\r\n                    <AlertCircle className=\"text-amber-600 flex-shrink-0\" size={20} />\r\n                    <div className=\"text-sm\">\r\n                        <p className=\"font-bold text-amber-800 dark:text-amber-300 mb-1\">Availability Tips</p>\r\n                        <ul className=\"text-amber-700 dark:text-amber-400 space-y-1\">\r\n                            <li> Operating hours determine when clients can book sessions</li>\r\n                            <li> Use blackout dates for holidays, maintenance, or personal time</li>\r\n                            <li> Individual room availability can be set in the Rooms section</li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import { useState } from 'react';\r\nimport { \r\n    FileText, Save, Loader2, DollarSign, Clock, AlertTriangle,\r\n    Shield, ChevronDown, ChevronUp\r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * StudioPolicies - Booking rules, pricing policies, and house rules\r\n */\r\nexport default function StudioPolicies({ user, userData, onUpdate }) {\r\n    const [policies, setPolicies] = useState({\r\n        // Booking Rules\r\n        minBookingHours: userData?.policies?.minBookingHours ?? 2,\r\n        maxBookingHours: userData?.policies?.maxBookingHours ?? 12,\r\n        advanceBookingDays: userData?.policies?.advanceBookingDays ?? 14,\r\n        minAdvanceHours: userData?.policies?.minAdvanceHours ?? 24,\r\n        autoApprove: userData?.policies?.autoApprove ?? false,\r\n        \r\n        // Cancellation Policy\r\n        cancellationPolicy: userData?.policies?.cancellationPolicy ?? 'moderate',\r\n        cancellationNoticeHours: userData?.policies?.cancellationNoticeHours ?? 48,\r\n        refundPercentage: userData?.policies?.refundPercentage ?? 50,\r\n        \r\n        // Pricing\r\n        depositRequired: userData?.policies?.depositRequired ?? true,\r\n        depositPercentage: userData?.policies?.depositPercentage ?? 25,\r\n        peakHourMultiplier: userData?.policies?.peakHourMultiplier ?? 1.0,\r\n        peakHoursStart: userData?.policies?.peakHoursStart ?? '',\r\n        peakHoursEnd: userData?.policies?.peakHoursEnd ?? '',\r\n        weekendMultiplier: userData?.policies?.weekendMultiplier ?? 1.0,\r\n        \r\n        // House Rules\r\n        houseRules: userData?.policies?.houseRules ?? '',\r\n        whatToExpect: userData?.policies?.whatToExpect ?? '',\r\n        whatToBring: userData?.policies?.whatToBring ?? '',\r\n        parkingInstructions: userData?.policies?.parkingInstructions ?? '',\r\n        \r\n        // Safety & Legal\r\n        requiresWaiver: userData?.policies?.requiresWaiver ?? false,\r\n        waiverText: userData?.policies?.waiverText ?? '',\r\n        ageRequirement: userData?.policies?.ageRequirement ?? 18,\r\n    });\r\n\r\n    const [saving, setSaving] = useState(false);\r\n    const [expandedSection, setExpandedSection] = useState('booking');\r\n\r\n    const handleSave = async () => {\r\n        if (!supabase) return;\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving policies...');\r\n        const userId = user?.id || user?.uid;\r\n        \r\n        try {\r\n            await supabase\r\n                .from('profiles')\r\n                .update({ \r\n                    policies: policies,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', userId);\r\n            \r\n            toast.success('Policies saved!', { id: toastId });\r\n            if (onUpdate) onUpdate({ policies });\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save', { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const updatePolicy = (key, value) => {\r\n        setPolicies(prev => ({ ...prev, [key]: value }));\r\n    };\r\n\r\n    const CANCELLATION_POLICIES = [\r\n        { id: 'flexible', label: 'Flexible', description: 'Full refund up to 24 hours before session', color: 'green' },\r\n        { id: 'moderate', label: 'Moderate', description: '50% refund up to 48 hours before session', color: 'amber' },\r\n        { id: 'strict', label: 'Strict', description: 'No refunds within 7 days of session', color: 'red' },\r\n        { id: 'custom', label: 'Custom', description: 'Set your own cancellation terms', color: 'blue' },\r\n    ];\r\n\r\n    const Section = ({ id, title, icon: Icon, children }) => {\r\n        const isExpanded = expandedSection === id;\r\n        return (\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                <button\r\n                    onClick={() => setExpandedSection(isExpanded ? null : id)}\r\n                    className=\"w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-[#23262f] transition\"\r\n                >\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 bg-brand-blue/10 rounded-lg flex items-center justify-center\">\r\n                            <Icon className=\"text-brand-blue\" size={20} />\r\n                        </div>\r\n                        <h3 className=\"font-bold dark:text-white\">{title}</h3>\r\n                    </div>\r\n                    {isExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}\r\n                </button>\r\n                {isExpanded && (\r\n                    <div className=\"p-4 pt-0 border-t dark:border-gray-700\">\r\n                        {children}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <FileText className=\"text-brand-blue\" size={24} />\r\n                        Policies & Rules\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Set booking rules, cancellation policies, and house rules\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={handleSave}\r\n                    disabled={saving}\r\n                    className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                    Save Changes\r\n                </button>\r\n            </div>\r\n\r\n            {/* Booking Rules */}\r\n            <Section id=\"booking\" title=\"Booking Rules\" icon={Clock}>\r\n                <div className=\"space-y-6 pt-4\">\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Min Hours</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.minBookingHours}\r\n                                onChange={(e) => updatePolicy('minBookingHours', parseInt(e.target.value) || 1)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={1}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Max Hours</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.maxBookingHours}\r\n                                onChange={(e) => updatePolicy('maxBookingHours', parseInt(e.target.value) || 12)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={1}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Book Ahead (Days)</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.advanceBookingDays}\r\n                                onChange={(e) => updatePolicy('advanceBookingDays', parseInt(e.target.value) || 7)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={1}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Min Notice (Hrs)</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.minAdvanceHours}\r\n                                onChange={(e) => updatePolicy('minAdvanceHours', parseInt(e.target.value) || 0)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={0}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl flex items-center justify-between\">\r\n                        <div>\r\n                            <div className=\"font-medium dark:text-white\">Auto-Approve Bookings</div>\r\n                            <div className=\"text-sm text-gray-500\">Automatically confirm bookings without manual approval</div>\r\n                        </div>\r\n                        <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                checked={policies.autoApprove}\r\n                                onChange={(e) => updatePolicy('autoApprove', e.target.checked)}\r\n                                className=\"sr-only peer\"\r\n                            />\r\n                            <div className=\"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-brand-blue\"></div>\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n            </Section>\r\n\r\n            {/* Cancellation Policy */}\r\n            <Section id=\"cancellation\" title=\"Cancellation Policy\" icon={AlertTriangle}>\r\n                <div className=\"space-y-4 pt-4\">\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                        {CANCELLATION_POLICIES.map(policy => (\r\n                            <button\r\n                                key={policy.id}\r\n                                onClick={() => updatePolicy('cancellationPolicy', policy.id)}\r\n                                className={`p-4 rounded-xl border-2 text-left transition ${\r\n                                    policies.cancellationPolicy === policy.id\r\n                                        ? `border-${policy.color}-500 bg-${policy.color}-50 dark:bg-${policy.color}-900/20`\r\n                                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\r\n                                }`}\r\n                            >\r\n                                <div className={`font-bold mb-1 ${policies.cancellationPolicy === policy.id ? `text-${policy.color}-700 dark:text-${policy.color}-400` : 'dark:text-white'}`}>\r\n                                    {policy.label}\r\n                                </div>\r\n                                <div className=\"text-xs text-gray-500\">{policy.description}</div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {policies.cancellationPolicy === 'custom' && (\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Notice Required (Hours)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={policies.cancellationNoticeHours}\r\n                                    onChange={(e) => updatePolicy('cancellationNoticeHours', parseInt(e.target.value) || 24)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    min={0}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Refund Percentage</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={policies.refundPercentage}\r\n                                    onChange={(e) => updatePolicy('refundPercentage', parseInt(e.target.value) || 0)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    min={0}\r\n                                    max={100}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </Section>\r\n\r\n            {/* Pricing */}\r\n            <Section id=\"pricing\" title=\"Pricing & Deposits\" icon={DollarSign}>\r\n                <div className=\"space-y-6 pt-4\">\r\n                    {/* Deposit */}\r\n                    <div className=\"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <div>\r\n                                <div className=\"font-medium dark:text-white\">Require Deposit</div>\r\n                                <div className=\"text-sm text-gray-500\">Collect partial payment when booking</div>\r\n                            </div>\r\n                            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={policies.depositRequired}\r\n                                    onChange={(e) => updatePolicy('depositRequired', e.target.checked)}\r\n                                    className=\"sr-only peer\"\r\n                                />\r\n                                <div className=\"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue\"></div>\r\n                            </label>\r\n                        </div>\r\n                        {policies.depositRequired && (\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Deposit Percentage</label>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <input\r\n                                        type=\"range\"\r\n                                        value={policies.depositPercentage}\r\n                                        onChange={(e) => updatePolicy('depositPercentage', parseInt(e.target.value))}\r\n                                        className=\"flex-1\"\r\n                                        min={10}\r\n                                        max={100}\r\n                                        step={5}\r\n                                    />\r\n                                    <span className=\"font-bold text-brand-blue w-14 text-right\">{policies.depositPercentage}%</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Peak Pricing */}\r\n                    <div>\r\n                        <div className=\"font-medium dark:text-white mb-3\">Peak Hour Pricing</div>\r\n                        <div className=\"grid grid-cols-3 gap-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Peak Start</label>\r\n                                <input\r\n                                    type=\"time\"\r\n                                    value={policies.peakHoursStart}\r\n                                    onChange={(e) => updatePolicy('peakHoursStart', e.target.value)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Peak End</label>\r\n                                <input\r\n                                    type=\"time\"\r\n                                    value={policies.peakHoursEnd}\r\n                                    onChange={(e) => updatePolicy('peakHoursEnd', e.target.value)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Rate Multiplier</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={policies.peakHourMultiplier}\r\n                                    onChange={(e) => updatePolicy('peakHourMultiplier', parseFloat(e.target.value) || 1)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    min={1}\r\n                                    max={3}\r\n                                    step={0.1}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Weekend Pricing */}\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Weekend Rate Multiplier</label>\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <input\r\n                                type=\"range\"\r\n                                value={policies.weekendMultiplier}\r\n                                onChange={(e) => updatePolicy('weekendMultiplier', parseFloat(e.target.value))}\r\n                                className=\"flex-1\"\r\n                                min={1}\r\n                                max={2}\r\n                                step={0.1}\r\n                            />\r\n                            <span className=\"font-bold dark:text-white w-16 text-right\">{policies.weekendMultiplier}x</span>\r\n                        </div>\r\n                        {policies.weekendMultiplier > 1 && (\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                                Saturday & Sunday bookings will be {Math.round((policies.weekendMultiplier - 1) * 100)}% more\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </Section>\r\n\r\n            {/* House Rules */}\r\n            <Section id=\"rules\" title=\"House Rules & Info\" icon={FileText}>\r\n                <div className=\"space-y-4 pt-4\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Studio Rules</label>\r\n                        <textarea\r\n                            value={policies.houseRules}\r\n                            onChange={(e) => updatePolicy('houseRules', e.target.value)}\r\n                            className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                            rows={4}\r\n                            placeholder=\" No smoking inside the studio&#10; Please arrive 10 minutes early&#10; Clean up after your session\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">What to Expect</label>\r\n                        <textarea\r\n                            value={policies.whatToExpect}\r\n                            onChange={(e) => updatePolicy('whatToExpect', e.target.value)}\r\n                            className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                            rows={3}\r\n                            placeholder=\"Describe what clients can expect when they arrive...\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">What to Bring</label>\r\n                            <textarea\r\n                                value={policies.whatToBring}\r\n                                onChange={(e) => updatePolicy('whatToBring', e.target.value)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                rows={3}\r\n                                placeholder=\" Instrument cables&#10; Lyrics/charts&#10; Reference tracks\"\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Parking Instructions</label>\r\n                            <textarea\r\n                                value={policies.parkingInstructions}\r\n                                onChange={(e) => updatePolicy('parkingInstructions', e.target.value)}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                rows={3}\r\n                                placeholder=\"Describe parking situation and directions...\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </Section>\r\n\r\n            {/* Legal */}\r\n            <Section id=\"legal\" title=\"Legal & Safety\" icon={Shield}>\r\n                <div className=\"space-y-4 pt-4\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Minimum Age Requirement</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={policies.ageRequirement}\r\n                                onChange={(e) => updatePolicy('ageRequirement', parseInt(e.target.value) || 0)}\r\n                                className=\"w-32 p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                min={0}\r\n                            />\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500 mt-6\">\r\n                            {policies.ageRequirement > 0 \r\n                                ? `Clients must be ${policies.ageRequirement}+ to book`\r\n                                : 'No age restriction'}\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-gray-50 dark:bg-[#1f2128] p-4 rounded-xl\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <div>\r\n                                <div className=\"font-medium dark:text-white\">Require Liability Waiver</div>\r\n                                <div className=\"text-sm text-gray-500\">Clients must sign a waiver before booking</div>\r\n                            </div>\r\n                            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={policies.requiresWaiver}\r\n                                    onChange={(e) => updatePolicy('requiresWaiver', e.target.checked)}\r\n                                    className=\"sr-only peer\"\r\n                                />\r\n                                <div className=\"w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue\"></div>\r\n                            </label>\r\n                        </div>\r\n                        {policies.requiresWaiver && (\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Waiver Text</label>\r\n                                <textarea\r\n                                    value={policies.waiverText}\r\n                                    onChange={(e) => updatePolicy('waiverText', e.target.value)}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#2c2e36] dark:border-gray-600 dark:text-white font-mono text-sm\"\r\n                                    rows={6}\r\n                                    placeholder=\"Enter your liability waiver text...\"\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </Section>\r\n        </div>\r\n    );\r\n}\r\n","import { supabase } from '../config/supabase';\r\n\r\n/**\r\n * Send notification to user about booking status change\r\n * This can be extended to send emails, push notifications, etc.\r\n */\r\nexport const notifyBookingStatusChange = async (booking, newStatus, userId) => {\r\n    if (!supabase) return;\r\n\r\n    try {\r\n        // Create notification record in database\r\n        // Uses the notifications table schema from sql/social_feed_module.sql\r\n        const targetUserId = booking.sender_id || booking.client_id;\r\n        const studioUserId = booking.studio_owner_id || booking.target_id;\r\n        \r\n        if (!targetUserId) {\r\n            console.warn('Cannot send notification: no target user ID');\r\n            return;\r\n        }\r\n\r\n        const notification = {\r\n            user_id: targetUserId,\r\n            type: 'booking', // Matches schema CHECK constraint\r\n            actor_id: studioUserId,\r\n            actor_name: booking.target_name || booking.studio_name || 'Studio',\r\n            target_type: 'booking',\r\n            target_id: booking.id,\r\n            title: `Booking ${newStatus}`,\r\n            body: `Your booking with ${booking.target_name || 'the studio'} has been ${newStatus.toLowerCase()}.`,\r\n            link: `/bookings/${booking.id}`,\r\n            read: false,\r\n            action_taken: newStatus.toLowerCase(), // 'confirmed', 'cancelled', 'completed'\r\n            created_at: new Date().toISOString()\r\n        };\r\n\r\n        // Try to insert notification (will fail gracefully if table doesn't exist)\r\n        try {\r\n            const { error } = await supabase\r\n                .from('notifications')\r\n                .insert(notification);\r\n            \r\n            if (error) {\r\n                // Log but don't throw - notifications are non-critical\r\n                console.log('Notification insert error (non-critical):', error.message);\r\n            }\r\n        } catch (err) {\r\n            // Notifications table may not exist yet - that's okay\r\n            console.log('Notifications table not available:', err.message);\r\n        }\r\n\r\n        // Send email notification\r\n        try {\r\n            const apiUrl = import.meta.env.DEV ? 'http://localhost:3000/api' : '/api';\r\n            const emailSubject = `Booking ${newStatus} - ${booking.target_name || 'Studio'}`;\r\n            const emailHtml = `\r\n                <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\r\n                    <h2>Booking ${newStatus}</h2>\r\n                    <p>Your booking with <strong>${booking.target_name || 'the studio'}</strong> has been ${newStatus.toLowerCase()}.</p>\r\n                    ${booking.date && booking.date !== 'Flexible' ? `<p><strong>Date:</strong> ${new Date(booking.date).toLocaleDateString()}</p>` : ''}\r\n                    ${booking.offer_amount ? `<p><strong>Amount:</strong> $${booking.offer_amount}</p>` : ''}\r\n                    <p><a href=\"${window.location.origin}/bookings/${booking.id}\" style=\"background: #3B82F6; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block;\">View Booking</a></p>\r\n                </div>\r\n            `;\r\n            \r\n            // Get user email from database\r\n            const { data: userData } = await supabase\r\n                .from('users')\r\n                .select('email')\r\n                .eq('id', targetUserId)\r\n                .single();\r\n\r\n            if (userData?.email) {\r\n                await fetch(`${apiUrl}/notifications/send-email`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                        to: userData.email,\r\n                        subject: emailSubject,\r\n                        html: emailHtml,\r\n                        text: `Your booking with ${booking.target_name || 'the studio'} has been ${newStatus.toLowerCase()}.`\r\n                    })\r\n                }).catch(err => console.log('Email send error (non-critical):', err));\r\n            }\r\n        } catch (emailError) {\r\n            console.log('Email notification error (non-critical):', emailError);\r\n        }\r\n\r\n        // Send push notification\r\n        try {\r\n            const apiUrl = import.meta.env.DEV ? 'http://localhost:3000/api' : '/api';\r\n            await fetch(`${apiUrl}/notifications/send-push`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    userId: targetUserId,\r\n                    title: `Booking ${newStatus}`,\r\n                    body: `Your booking with ${booking.target_name || 'the studio'} has been ${newStatus.toLowerCase()}.`,\r\n                    data: {\r\n                        bookingId: booking.id,\r\n                        status: newStatus,\r\n                        url: `/bookings/${booking.id}`\r\n                    }\r\n                })\r\n            }).catch(err => console.log('Push notification error (non-critical):', err));\r\n        } catch (pushError) {\r\n            console.log('Push notification error (non-critical):', pushError);\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error('Error sending notification:', error);\r\n        // Don't throw - notifications are non-critical\r\n    }\r\n};\r\n\r\n/**\r\n * Check for booking conflicts before confirming\r\n */\r\nexport const checkBookingConflicts = async (booking, userId) => {\r\n    if (!supabase) return { hasConflict: false, conflicts: [] };\r\n\r\n    try {\r\n        // Only check if booking has a valid date\r\n        if (!booking.date || booking.date === 'Flexible') {\r\n            return { hasConflict: false, conflicts: [] };\r\n        }\r\n\r\n        const bookingDate = new Date(booking.date);\r\n        if (isNaN(bookingDate.getTime())) {\r\n            return { hasConflict: false, conflicts: [] };\r\n        }\r\n\r\n        // Check for other confirmed bookings at the same time\r\n        const { data: conflictingBookings, error } = await supabase\r\n            .from('bookings')\r\n            .select('id, status, date, time, duration, sender_name')\r\n            .or(`studio_owner_id.eq.${userId},target_id.eq.${userId}`)\r\n            .eq('status', 'Confirmed')\r\n            .neq('id', booking.id);\r\n\r\n        if (error) {\r\n            console.error('Error checking conflicts:', error);\r\n            return { hasConflict: false, conflicts: [] };\r\n        }\r\n\r\n        // Advanced conflict detection: Check for date AND time overlaps\r\n        const conflicts = (conflictingBookings || []).filter(cb => {\r\n            const cbDate = parseBookingDate(cb.date);\r\n            if (!cbDate) return false;\r\n            \r\n            // Check if same date\r\n            if (cbDate.toDateString() !== bookingDate.toDateString()) {\r\n                return false;\r\n            }\r\n\r\n            // If both have time information, check for time overlap\r\n            if (booking.booking_start && cb.booking_start && booking.duration && cb.duration) {\r\n                const bookingStart = new Date(booking.booking_start);\r\n                const bookingEnd = new Date(bookingStart.getTime() + (booking.duration * 60 * 60 * 1000));\r\n                const cbStart = new Date(cb.booking_start);\r\n                const cbEnd = new Date(cbStart.getTime() + (cb.duration * 60 * 60 * 1000));\r\n\r\n                // Check for time overlap\r\n                return !(bookingEnd <= cbStart || bookingStart >= cbEnd);\r\n            }\r\n\r\n            // If no time info, just check date (conservative approach)\r\n            return true;\r\n        });\r\n\r\n        return {\r\n            hasConflict: conflicts.length > 0,\r\n            conflicts\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error('Error checking conflicts:', error);\r\n        return { hasConflict: false, conflicts: [] };\r\n    }\r\n};\r\n\r\n/**\r\n * Validate booking status transition\r\n */\r\nexport const validateStatusTransition = (currentStatus, newStatus) => {\r\n    const validTransitions = {\r\n        Pending: ['Confirmed', 'Cancelled'],\r\n        Confirmed: ['Completed', 'Cancelled'],\r\n        Completed: [], // Terminal state\r\n        Cancelled: [] // Terminal state\r\n    };\r\n\r\n    const allowedStatuses = validTransitions[currentStatus] || [];\r\n    return {\r\n        isValid: allowedStatuses.includes(newStatus),\r\n        allowedStatuses\r\n    };\r\n};\r\n\r\n/**\r\n * Parse booking date safely\r\n */\r\nconst parseBookingDate = (dateValue) => {\r\n    if (!dateValue || dateValue === 'Flexible') return null;\r\n    try {\r\n        const parsed = new Date(dateValue);\r\n        return isNaN(parsed.getTime()) ? null : parsed;\r\n    } catch {\r\n        return null;\r\n    }\r\n};\r\n\r\n/**\r\n * Track booking history/audit log\r\n */\r\nexport const trackBookingHistory = async (bookingId, oldStatus, newStatus, changedBy, notes = '') => {\r\n    if (!supabase) return;\r\n\r\n    try {\r\n        // Insert into booking_history table (create if doesn't exist)\r\n        const historyEntry = {\r\n            booking_id: bookingId,\r\n            old_status: oldStatus,\r\n            new_status: newStatus,\r\n            changed_by: changedBy,\r\n            notes,\r\n            created_at: new Date().toISOString()\r\n        };\r\n\r\n        const { error } = await supabase\r\n            .from('booking_history')\r\n            .insert(historyEntry);\r\n\r\n        if (error) {\r\n            // Table might not exist - that's okay, log it\r\n            console.log('Booking history table not available:', error.message);\r\n        }\r\n    } catch (error) {\r\n        console.log('Booking history tracking error (non-critical):', error.message);\r\n    }\r\n};\r\n\r\n/**\r\n * Calculate cancellation fee based on policy\r\n */\r\nexport const calculateCancellationFee = (booking, cancellationPolicy) => {\r\n    if (!cancellationPolicy) return { fee: 0, refund: booking.offer_amount || 0 };\r\n\r\n    const now = new Date();\r\n    const bookingDate = parseBookingDate(booking.date);\r\n    if (!bookingDate) {\r\n        // Can't calculate without date\r\n        return { fee: 0, refund: booking.offer_amount || 0 };\r\n    }\r\n\r\n    const hoursUntilBooking = (bookingDate.getTime() - now.getTime()) / (1000 * 60 * 60);\r\n    const amount = booking.offer_amount || 0;\r\n\r\n    let fee = 0;\r\n    let feePercentage = 0;\r\n\r\n    // Default policy if none specified\r\n    const policy = cancellationPolicy || {\r\n        freeCancellationHours: 48,\r\n        feeStructure: {\r\n            '48+': 0,      // Free if cancelled 48+ hours before\r\n            '24-48': 0.25, // 25% fee if 24-48 hours before\r\n            '12-24': 0.5,  // 50% fee if 12-24 hours before\r\n            '0-12': 0.75,  // 75% fee if 0-12 hours before\r\n            'past': 1.0    // 100% fee if past booking time\r\n        }\r\n    };\r\n\r\n    if (hoursUntilBooking < 0) {\r\n        feePercentage = policy.feeStructure.past || 1.0;\r\n    } else if (hoursUntilBooking < 12) {\r\n        feePercentage = policy.feeStructure['0-12'] || 0.75;\r\n    } else if (hoursUntilBooking < 24) {\r\n        feePercentage = policy.feeStructure['12-24'] || 0.5;\r\n    } else if (hoursUntilBooking < 48) {\r\n        feePercentage = policy.feeStructure['24-48'] || 0.25;\r\n    } else {\r\n        feePercentage = policy.feeStructure['48+'] || 0;\r\n    }\r\n\r\n    fee = amount * feePercentage;\r\n    const refund = amount - fee;\r\n\r\n    return {\r\n        fee: Math.round(fee * 100) / 100,\r\n        refund: Math.round(refund * 100) / 100,\r\n        feePercentage,\r\n        hoursUntilBooking: Math.round(hoursUntilBooking * 10) / 10\r\n    };\r\n};\r\n\r\n/**\r\n * Check if booking can be cancelled (based on policy)\r\n */\r\nexport const canCancelBooking = (booking, cancellationPolicy) => {\r\n    if (!booking.date || booking.date === 'Flexible') {\r\n        return { canCancel: true, reason: '' };\r\n    }\r\n\r\n    const bookingDate = parseBookingDate(booking.date);\r\n    if (!bookingDate) {\r\n        return { canCancel: true, reason: '' };\r\n    }\r\n\r\n    const now = new Date();\r\n    const hoursUntilBooking = (bookingDate.getTime() - now.getTime()) / (1000 * 60 * 60);\r\n\r\n    // If booking is in the past, can't cancel\r\n    if (hoursUntilBooking < 0) {\r\n        return { canCancel: false, reason: 'Booking time has already passed' };\r\n    }\r\n\r\n    // Check policy restrictions\r\n    const policy = cancellationPolicy || {};\r\n    if (policy.noCancellationAfterHours && hoursUntilBooking < policy.noCancellationAfterHours) {\r\n        return { \r\n            canCancel: false, \r\n            reason: `Cancellations not allowed within ${policy.noCancellationAfterHours} hours of booking` \r\n        };\r\n    }\r\n\r\n    return { canCancel: true, reason: '' };\r\n};\r\n\r\n","import { supabase } from '../config/supabase';\r\n\r\n/**\r\n * Schedule automated booking reminders\r\n */\r\nexport const scheduleBookingReminder = async (booking, reminderHours = [24, 2]) => {\r\n    if (!supabase) return;\r\n\r\n    try {\r\n        const bookingDate = new Date(booking.date);\r\n        if (isNaN(bookingDate.getTime()) || booking.date === 'Flexible') {\r\n            return; // Can't schedule reminders for flexible dates\r\n        }\r\n\r\n        const reminders = reminderHours.map(hours => {\r\n            const reminderTime = new Date(bookingDate.getTime() - (hours * 60 * 60 * 1000));\r\n            return {\r\n                booking_id: booking.id,\r\n                user_id: booking.sender_id,\r\n                reminder_type: hours >= 24 ? 'day_before' : 'hours_before',\r\n                reminder_hours: hours,\r\n                scheduled_for: reminderTime.toISOString(),\r\n                sent: false,\r\n                created_at: new Date().toISOString()\r\n            };\r\n        });\r\n\r\n        // Insert reminders into booking_reminders table\r\n        const { error } = await supabase\r\n            .from('booking_reminders')\r\n            .insert(reminders);\r\n\r\n        if (error) {\r\n            console.log('Reminder scheduling error (non-critical):', error.message);\r\n        }\r\n    } catch (error) {\r\n        console.log('Reminder scheduling error (non-critical):', error.message);\r\n    }\r\n};\r\n\r\n/**\r\n * Send booking reminder\r\n */\r\nexport const sendBookingReminder = async (reminder) => {\r\n    if (!supabase) return;\r\n\r\n    try {\r\n        // Get booking details\r\n        const { data: booking, error: bookingError } = await supabase\r\n            .from('bookings')\r\n            .select('*')\r\n            .eq('id', reminder.booking_id)\r\n            .single();\r\n\r\n        if (bookingError || !booking) {\r\n            console.log('Booking not found for reminder');\r\n            return;\r\n        }\r\n\r\n        // Only send if booking is still confirmed\r\n        if (booking.status !== 'Confirmed') {\r\n            // Mark reminder as cancelled\r\n            await supabase\r\n                .from('booking_reminders')\r\n                .update({ sent: true, cancelled: true })\r\n                .eq('id', reminder.id);\r\n            return;\r\n        }\r\n\r\n        // Send notification\r\n        const apiUrl = import.meta.env.DEV ? 'http://localhost:3000/api' : '/api';\r\n        \r\n        // Email reminder\r\n        const { data: userData } = await supabase\r\n            .from('users')\r\n            .select('email')\r\n            .eq('id', reminder.user_id)\r\n            .single();\r\n\r\n        if (userData?.email) {\r\n            const hoursText = reminder.reminder_hours >= 24 \r\n                ? `${Math.floor(reminder.reminder_hours / 24)} day(s)`\r\n                : `${reminder.reminder_hours} hour(s)`;\r\n            \r\n            await fetch(`${apiUrl}/notifications/send-email`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    to: userData.email,\r\n                    subject: `Reminder: Booking in ${hoursText}`,\r\n                    html: `\r\n                        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\r\n                            <h2>Booking Reminder</h2>\r\n                            <p>This is a reminder that you have a booking with <strong>${booking.target_name || 'the studio'}</strong> in ${hoursText}.</p>\r\n                            <p><strong>Date:</strong> ${new Date(booking.date).toLocaleDateString()}</p>\r\n                            ${booking.time ? `<p><strong>Time:</strong> ${booking.time}</p>` : ''}\r\n                            <p><a href=\"${window.location.origin}/bookings/${booking.id}\">View Booking Details</a></p>\r\n                        </div>\r\n                    `\r\n                })\r\n            }).catch(err => console.log('Reminder email error:', err));\r\n        }\r\n\r\n        // Push notification\r\n        await fetch(`${apiUrl}/notifications/send-push`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                userId: reminder.user_id,\r\n                title: 'Booking Reminder',\r\n                body: `Your booking with ${booking.target_name || 'the studio'} is in ${reminder.reminder_hours >= 24 ? Math.floor(reminder.reminder_hours / 24) + ' day(s)' : reminder.reminder_hours + ' hour(s)'}`,\r\n                data: {\r\n                    bookingId: booking.id,\r\n                    type: 'reminder',\r\n                    url: `/bookings/${booking.id}`\r\n                }\r\n            })\r\n        }).catch(err => console.log('Reminder push error:', err));\r\n\r\n        // Mark reminder as sent\r\n        await supabase\r\n            .from('booking_reminders')\r\n            .update({ sent: true, sent_at: new Date().toISOString() })\r\n            .eq('id', reminder.id);\r\n\r\n    } catch (error) {\r\n        console.error('Send reminder error:', error);\r\n    }\r\n};\r\n\r\n","import React, { useState } from 'react';\r\nimport { Calendar, Repeat, X, Save } from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * RecurringBookingModal - Create recurring bookings\r\n */\r\nexport default function RecurringBookingModal({ booking, onClose, onSuccess }) {\r\n    const [recurrenceType, setRecurrenceType] = useState('weekly');\r\n    const [interval, setInterval] = useState(1); // Every X weeks/days/months\r\n    const [daysOfWeek, setDaysOfWeek] = useState([]); // For weekly: [1,3,5] = Mon, Wed, Fri\r\n    const [endDate, setEndDate] = useState('');\r\n    const [maxOccurrences, setMaxOccurrences] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleDayToggle = (day) => {\r\n        setDaysOfWeek(prev => \r\n            prev.includes(day) \r\n                ? prev.filter(d => d !== day)\r\n                : [...prev, day].sort()\r\n        );\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!booking || !supabase) return;\r\n\r\n        setLoading(true);\r\n        const toastId = toast.loading('Creating recurring bookings...');\r\n\r\n        try {\r\n            const bookingDate = new Date(booking.date);\r\n            if (isNaN(bookingDate.getTime())) {\r\n                throw new Error('Invalid booking date');\r\n            }\r\n\r\n            // Calculate next occurrence\r\n            let nextOccurrence = new Date(bookingDate);\r\n            if (recurrenceType === 'weekly' && daysOfWeek.length > 0) {\r\n                // Find next matching day of week\r\n                const currentDay = bookingDate.getDay();\r\n                const nextDay = daysOfWeek.find(d => d > currentDay) || daysOfWeek[0];\r\n                const daysToAdd = nextDay - currentDay + (nextDay < currentDay ? 7 : 0);\r\n                nextOccurrence = new Date(bookingDate.getTime() + (daysToAdd * 24 * 60 * 60 * 1000));\r\n            } else if (recurrenceType === 'daily') {\r\n                nextOccurrence = new Date(bookingDate.getTime() + (interval * 24 * 60 * 60 * 1000));\r\n            } else if (recurrenceType === 'monthly') {\r\n                nextOccurrence = new Date(bookingDate);\r\n                nextOccurrence.setMonth(nextOccurrence.getMonth() + interval);\r\n            }\r\n\r\n            const recurrencePattern = {\r\n                type: recurrenceType,\r\n                interval,\r\n                daysOfWeek: recurrenceType === 'weekly' ? daysOfWeek : null,\r\n            };\r\n\r\n            // Create recurring booking record\r\n            const { data: recurringBooking, error } = await supabase\r\n                .from('recurring_bookings')\r\n                .insert({\r\n                    parent_booking_id: booking.id,\r\n                    studio_id: booking.studio_owner_id || booking.target_id,\r\n                    sender_id: booking.sender_id,\r\n                    recurrence_type: recurrenceType,\r\n                    recurrence_pattern: recurrencePattern,\r\n                    start_date: bookingDate.toISOString().split('T')[0],\r\n                    end_date: endDate || null,\r\n                    next_occurrence: nextOccurrence.toISOString().split('T')[0],\r\n                    max_occurrences: maxOccurrences ? parseInt(maxOccurrences) : null,\r\n                    is_active: true\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n\r\n            toast.success('Recurring booking created!', { id: toastId });\r\n            onSuccess?.();\r\n            onClose();\r\n        } catch (error) {\r\n            console.error('Error creating recurring booking:', error);\r\n            toast.error('Failed to create recurring booking: ' + error.message, { id: toastId });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-md w-full\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Repeat size={18} className=\"text-brand-blue\" />\r\n                        Create Recurring Booking\r\n                    </h3>\r\n                    <button onClick={onClose}>\r\n                        <X size={20} className=\"text-gray-500\" />\r\n                    </button>\r\n                </div>\r\n                <form onSubmit={handleSubmit} className=\"p-4 space-y-4\">\r\n                    {/* Recurrence Type */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">Repeat</label>\r\n                        <select\r\n                            value={recurrenceType}\r\n                            onChange={(e) => setRecurrenceType(e.target.value)}\r\n                            className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                        >\r\n                            <option value=\"daily\">Daily</option>\r\n                            <option value=\"weekly\">Weekly</option>\r\n                            <option value=\"monthly\">Monthly</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    {/* Interval */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">\r\n                            Every {recurrenceType === 'daily' ? 'X days' : recurrenceType === 'weekly' ? 'X weeks' : 'X months'}\r\n                        </label>\r\n                        <input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            value={interval}\r\n                            onChange={(e) => setInterval(parseInt(e.target.value) || 1)}\r\n                            className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Days of Week (for weekly) */}\r\n                    {recurrenceType === 'weekly' && (\r\n                        <div>\r\n                            <label className=\"text-sm font-bold dark:text-white mb-2 block\">Days of Week</label>\r\n                            <div className=\"grid grid-cols-7 gap-2\">\r\n                                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day, index) => (\r\n                                    <button\r\n                                        key={index}\r\n                                        type=\"button\"\r\n                                        onClick={() => handleDayToggle(index)}\r\n                                        className={`p-2 rounded-lg text-sm font-medium transition ${\r\n                                            daysOfWeek.includes(index)\r\n                                                ? 'bg-brand-blue text-white'\r\n                                                : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                        }`}\r\n                                    >\r\n                                        {day}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* End Date */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">End Date (optional)</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            value={endDate}\r\n                            onChange={(e) => setEndDate(e.target.value)}\r\n                            className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Max Occurrences */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">Max Occurrences (optional)</label>\r\n                        <input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            value={maxOccurrences}\r\n                            onChange={(e) => setMaxOccurrences(e.target.value)}\r\n                            placeholder=\"Unlimited if empty\"\r\n                            className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex gap-3 pt-2\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading || (recurrenceType === 'weekly' && daysOfWeek.length === 0)}\r\n                            className=\"flex-1 py-2.5 bg-brand-blue text-white rounded-lg font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                        >\r\n                            <Save size={16} />\r\n                            Create Recurring\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Home, Plus, X, Save } from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * MultiRoomBookingModal - Assign booking to multiple rooms\r\n */\r\nexport default function MultiRoomBookingModal({ booking, rooms, onClose, onSuccess }) {\r\n    const [selectedRooms, setSelectedRooms] = useState([]);\r\n    const [roomTimeSlots, setRoomTimeSlots] = useState({}); // { roomId: { start, end } }\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // Initialize with booking's time if available\r\n        if (booking?.booking_start && booking?.duration) {\r\n            const start = new Date(booking.booking_start);\r\n            const end = new Date(start.getTime() + (booking.duration * 60 * 60 * 1000));\r\n            \r\n            const initialSlots = {};\r\n            selectedRooms.forEach(roomId => {\r\n                initialSlots[roomId] = {\r\n                    start: start.toISOString().slice(0, 16), // YYYY-MM-DDTHH:mm format\r\n                    end: end.toISOString().slice(0, 16)\r\n                };\r\n            });\r\n            setRoomTimeSlots(initialSlots);\r\n        }\r\n    }, [selectedRooms, booking]);\r\n\r\n    const handleRoomToggle = (roomId) => {\r\n        setSelectedRooms(prev => \r\n            prev.includes(roomId)\r\n                ? prev.filter(id => id !== roomId)\r\n                : [...prev, roomId]\r\n        );\r\n    };\r\n\r\n    const handleTimeChange = (roomId, field, value) => {\r\n        setRoomTimeSlots(prev => ({\r\n            ...prev,\r\n            [roomId]: {\r\n                ...prev[roomId],\r\n                [field]: value\r\n            }\r\n        }));\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!booking || selectedRooms.length === 0 || !supabase) return;\r\n\r\n        setLoading(true);\r\n        const toastId = toast.loading('Assigning rooms...');\r\n\r\n        try {\r\n            // Create room booking records\r\n            const roomBookings = selectedRooms.map(roomId => {\r\n                const slot = roomTimeSlots[roomId];\r\n                const startTime = slot?.start ? new Date(slot.start) : new Date(booking.booking_start || booking.date);\r\n                const endTime = slot?.end ? new Date(slot.end) : new Date(startTime.getTime() + (booking.duration * 60 * 60 * 1000));\r\n\r\n                const room = rooms.find(r => r.id === roomId);\r\n                return {\r\n                    booking_id: booking.id,\r\n                    room_id: roomId,\r\n                    room_name: room?.name || `Room ${roomId}`,\r\n                    start_time: startTime.toISOString(),\r\n                    end_time: endTime.toISOString()\r\n                };\r\n            });\r\n\r\n            const { error } = await supabase\r\n                .from('room_bookings')\r\n                .insert(roomBookings);\r\n\r\n            if (error) throw error;\r\n\r\n            toast.success(`${selectedRooms.length} room(s) assigned!`, { id: toastId });\r\n            onSuccess?.();\r\n            onClose();\r\n        } catch (error) {\r\n            console.error('Error assigning rooms:', error);\r\n            toast.error('Failed to assign rooms: ' + error.message, { id: toastId });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                        <Home size={18} className=\"text-brand-blue\" />\r\n                        Assign Rooms\r\n                    </h3>\r\n                    <button onClick={onClose}>\r\n                        <X size={20} className=\"text-gray-500\" />\r\n                    </button>\r\n                </div>\r\n                <form onSubmit={handleSubmit} className=\"p-4 space-y-4\">\r\n                    {/* Room Selection */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold dark:text-white mb-2 block\">Select Rooms</label>\r\n                        <div className=\"space-y-2 max-h-48 overflow-y-auto\">\r\n                            {rooms.map(room => (\r\n                                <div\r\n                                    key={room.id}\r\n                                    className={`p-3 border rounded-lg cursor-pointer transition ${\r\n                                        selectedRooms.includes(room.id)\r\n                                            ? 'border-brand-blue bg-blue-50 dark:bg-blue-900/20'\r\n                                            : 'border-gray-200 dark:border-gray-600 hover:border-gray-300'\r\n                                    }`}\r\n                                    onClick={() => handleRoomToggle(room.id)}\r\n                                >\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div>\r\n                                            <div className=\"font-medium dark:text-white\">{room.name}</div>\r\n                                            <div className=\"text-xs text-gray-500\">\r\n                                                ${room.rate}/hr  {room.capacity} people\r\n                                            </div>\r\n                                        </div>\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={selectedRooms.includes(room.id)}\r\n                                            onChange={() => handleRoomToggle(room.id)}\r\n                                            className=\"w-4 h-4 text-brand-blue\"\r\n                                        />\r\n                                    </div>\r\n                                    \r\n                                    {/* Time Slot (if selected) */}\r\n                                    {selectedRooms.includes(room.id) && (\r\n                                        <div className=\"mt-3 pt-3 border-t dark:border-gray-600 grid grid-cols-2 gap-2\">\r\n                                            <div>\r\n                                                <label className=\"text-xs text-gray-500 mb-1 block\">Start</label>\r\n                                                <input\r\n                                                    type=\"datetime-local\"\r\n                                                    value={roomTimeSlots[room.id]?.start || ''}\r\n                                                    onChange={(e) => handleTimeChange(room.id, 'start', e.target.value)}\r\n                                                    className=\"w-full p-1.5 text-sm border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"text-xs text-gray-500 mb-1 block\">End</label>\r\n                                                <input\r\n                                                    type=\"datetime-local\"\r\n                                                    value={roomTimeSlots[room.id]?.end || ''}\r\n                                                    onChange={(e) => handleTimeChange(room.id, 'end', e.target.value)}\r\n                                                    className=\"w-full p-1.5 text-sm border rounded dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex gap-3 pt-2\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading || selectedRooms.length === 0}\r\n                            className=\"flex-1 py-2.5 bg-brand-blue text-white rounded-lg font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                        >\r\n                            <Save size={16} />\r\n                            Assign {selectedRooms.length > 0 ? `(${selectedRooms.length})` : ''}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useMemo } from 'react';\r\nimport { \r\n    ChevronLeft, ChevronRight, Calendar as CalendarIcon,\r\n    Ban, Clock, MapPin\r\n} from 'lucide-react';\r\n\r\n/**\r\n * UnifiedCalendar - A single calendar component with day/week/month views\r\n * Based on Studio Manager calendar design\r\n * \r\n * @param {Object} props\r\n * @param {Date} props.currentDate - Current date to display\r\n * @param {Function} props.onDateChange - Callback when date changes\r\n * @param {Array} props.bookings - Array of booking objects with date, status, etc.\r\n * @param {Array} props.blockedDates - Array of blocked date objects\r\n * @param {Function} props.onDateClick - Callback when a date is clicked\r\n * @param {Function} props.onBookingClick - Callback when a booking is clicked\r\n * @param {string} props.view - 'month' | 'week' | 'day'\r\n * @param {Function} props.onViewChange - Callback when view changes\r\n * @param {boolean} props.showControls - Show view toggle and navigation (default: true)\r\n * @param {string} props.className - Additional CSS classes\r\n */\r\nexport default function UnifiedCalendar({\r\n    currentDate = new Date(),\r\n    onDateChange,\r\n    bookings = [],\r\n    blockedDates = [],\r\n    onDateClick,\r\n    onBookingClick,\r\n    view = 'month',\r\n    onViewChange,\r\n    showControls = true,\r\n    className = ''\r\n}) {\r\n    const [localDate, setLocalDate] = useState(currentDate);\r\n    const [localView, setLocalView] = useState(view);\r\n\r\n    // Use local state if no controlled props\r\n    const displayDate = currentDate || localDate;\r\n    const displayView = view || localView;\r\n\r\n    const handleDateChange = (newDate) => {\r\n        setLocalDate(newDate);\r\n        if (onDateChange) onDateChange(newDate);\r\n    };\r\n\r\n    const handleViewChange = (newView) => {\r\n        setLocalView(newView);\r\n        if (onViewChange) onViewChange(newView);\r\n    };\r\n\r\n    // Navigation\r\n    const navigateDate = (direction) => {\r\n        const newDate = new Date(displayDate);\r\n        \r\n        if (displayView === 'month') {\r\n            newDate.setMonth(newDate.getMonth() + direction);\r\n        } else if (displayView === 'week') {\r\n            newDate.setDate(newDate.getDate() + (direction * 7));\r\n        } else if (displayView === 'day') {\r\n            newDate.setDate(newDate.getDate() + direction);\r\n        }\r\n        \r\n        handleDateChange(newDate);\r\n    };\r\n\r\n    const goToToday = () => {\r\n        handleDateChange(new Date());\r\n    };\r\n\r\n    // Get week start (Sunday)\r\n    const getWeekStart = (date) => {\r\n        const d = new Date(date);\r\n        const day = d.getDay();\r\n        const diff = d.getDate() - day;\r\n        return new Date(d.setDate(diff));\r\n    };\r\n\r\n    // Get week dates\r\n    const getWeekDates = (date) => {\r\n        const weekStart = getWeekStart(date);\r\n        const week = [];\r\n        for (let i = 0; i < 7; i++) {\r\n            const day = new Date(weekStart);\r\n            day.setDate(weekStart.getDate() + i);\r\n            week.push(day);\r\n        }\r\n        return week;\r\n    };\r\n\r\n    // Get bookings for a specific date\r\n    const getDayBookings = (date) => {\r\n        if (!date) return [];\r\n        return bookings.filter(b => {\r\n            if (!b.date) return false;\r\n            const bookingDate = b.date instanceof Date ? b.date : new Date(b.date);\r\n            if (isNaN(bookingDate.getTime())) return false;\r\n            return bookingDate.toDateString() === date.toDateString();\r\n        });\r\n    };\r\n\r\n    // Get blocks for a specific date\r\n    const getDayBlocks = (date) => {\r\n        if (!date) return [];\r\n        return blockedDates.filter(b => {\r\n            if (!b.date) return false;\r\n            const blockDate = b.date instanceof Date ? b.date : new Date(b.date);\r\n            if (isNaN(blockDate.getTime())) return false;\r\n            return blockDate.toDateString() === date.toDateString();\r\n        });\r\n    };\r\n\r\n    // Format date for display\r\n    const formatDateRange = () => {\r\n        if (displayView === 'month') {\r\n            return displayDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });\r\n        } else if (displayView === 'week') {\r\n            const week = getWeekDates(displayDate);\r\n            const start = week[0];\r\n            const end = week[6];\r\n            if (start.getMonth() === end.getMonth()) {\r\n                return `${start.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })} - ${end.toLocaleDateString('en-US', { day: 'numeric', year: 'numeric' })}`;\r\n            } else {\r\n                return `${start.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${end.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;\r\n            }\r\n        } else {\r\n            return displayDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={`bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden ${className}`}>\r\n            {/* Header Controls */}\r\n            {showControls && (\r\n                <div className=\"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        {/* View Toggle */}\r\n                        <div className=\"flex bg-gray-200 dark:bg-gray-700 rounded-lg p-1\">\r\n                            {['month', 'week', 'day'].map(v => (\r\n                                <button\r\n                                    key={v}\r\n                                    onClick={() => handleViewChange(v)}\r\n                                    className={`px-3 py-1.5 rounded-md text-sm font-medium transition capitalize ${\r\n                                        displayView === v\r\n                                            ? 'bg-white dark:bg-gray-600 shadow text-brand-blue dark:text-white'\r\n                                            : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'\r\n                                    }`}\r\n                                >\r\n                                    {v}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Date Navigation */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                                onClick={() => navigateDate(-1)}\r\n                                className=\"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition\"\r\n                            >\r\n                                <ChevronLeft size={20} className=\"text-gray-600 dark:text-gray-300\" />\r\n                            </button>\r\n                            <button\r\n                                onClick={goToToday}\r\n                                className=\"px-3 py-1.5 text-sm font-medium text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                            >\r\n                                Today\r\n                            </button>\r\n                            <button\r\n                                onClick={() => navigateDate(1)}\r\n                                className=\"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition\"\r\n                            >\r\n                                <ChevronRight size={20} className=\"text-gray-600 dark:text-gray-300\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Date Range Display */}\r\n                    <div className=\"text-center\">\r\n                        <h3 className=\"font-bold dark:text-white text-lg\">\r\n                            {formatDateRange()}\r\n                        </h3>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Calendar Content */}\r\n            <div className=\"p-4\">\r\n                {displayView === 'month' && (\r\n                    <MonthView\r\n                        date={displayDate}\r\n                        bookings={bookings}\r\n                        blockedDates={blockedDates}\r\n                        onDateClick={onDateClick}\r\n                        onBookingClick={onBookingClick}\r\n                        getDayBookings={getDayBookings}\r\n                        getDayBlocks={getDayBlocks}\r\n                    />\r\n                )}\r\n\r\n                {displayView === 'week' && (\r\n                    <WeekView\r\n                        date={displayDate}\r\n                        bookings={bookings}\r\n                        blockedDates={blockedDates}\r\n                        onDateClick={onDateClick}\r\n                        onBookingClick={onBookingClick}\r\n                        getDayBookings={getDayBookings}\r\n                        getDayBlocks={getDayBlocks}\r\n                        getWeekDates={getWeekDates}\r\n                    />\r\n                )}\r\n\r\n                {displayView === 'day' && (\r\n                    <DayView\r\n                        date={displayDate}\r\n                        bookings={bookings}\r\n                        blockedDates={blockedDates}\r\n                        onDateClick={onDateClick}\r\n                        onBookingClick={onBookingClick}\r\n                        getDayBookings={getDayBookings}\r\n                        getDayBlocks={getDayBlocks}\r\n                    />\r\n                )}\r\n            </div>\r\n\r\n            {/* Legend */}\r\n            <div className=\"px-4 pb-4\">\r\n                <div className=\"flex flex-wrap items-center gap-4 pt-4 border-t dark:border-gray-700 text-xs text-gray-500\">\r\n                    <div className=\"flex items-center gap-1\">\r\n                        <span className=\"w-2 h-2 bg-green-500 rounded-full\"></span>\r\n                        Confirmed\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                        <span className=\"w-2 h-2 bg-amber-500 rounded-full\"></span>\r\n                        Pending\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                        <Ban size={12} className=\"text-red-500\" />\r\n                        Blocked\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Month View Component\r\n */\r\nfunction MonthView({ date, bookings, blockedDates, onDateClick, onBookingClick, getDayBookings, getDayBlocks }) {\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const today = new Date();\r\n    const firstDay = new Date(year, month, 1).getDay();\r\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\r\n    \r\n    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\n    \r\n    const days = [];\r\n    for (let i = 0; i < firstDay; i++) {\r\n        days.push(null);\r\n    }\r\n    for (let day = 1; day <= daysInMonth; day++) {\r\n        days.push(day);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {/* Day Headers */}\r\n            <div className=\"grid grid-cols-7 gap-2 mb-2\">\r\n                {dayNames.map(day => (\r\n                    <div key={day} className=\"text-center text-sm font-bold text-gray-500 py-2\">\r\n                        {day}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            \r\n            {/* Calendar Grid */}\r\n            <div className=\"grid grid-cols-7 gap-2\">\r\n                {days.map((day, i) => {\r\n                    if (day === null) {\r\n                        return <div key={`empty-${i}`} className=\"aspect-square\"></div>;\r\n                    }\r\n\r\n                    const dayDate = new Date(year, month, day);\r\n                    const isPast = dayDate < new Date(today.getFullYear(), today.getMonth(), today.getDate());\r\n                    const isToday = dayDate.toDateString() === today.toDateString();\r\n                    const dayBookings = getDayBookings(dayDate);\r\n                    const dayBlocks = getDayBlocks(dayDate);\r\n                    \r\n                    const hasConfirmed = dayBookings.some(b => (b.status || '').toLowerCase() === 'confirmed');\r\n                    const hasPending = dayBookings.some(b => (b.status || '').toLowerCase() === 'pending');\r\n                    const isBlocked = dayBlocks.length > 0;\r\n\r\n                    return (\r\n                        <button\r\n                            key={day}\r\n                            onClick={() => {\r\n                                if (!isPast && onDateClick) onDateClick(dayDate);\r\n                                if (dayBookings.length > 0 && onBookingClick) {\r\n                                    onBookingClick(dayBookings[0], dayDate);\r\n                                }\r\n                            }}\r\n                            disabled={isPast}\r\n                            className={`aspect-square p-1 rounded-xl flex flex-col items-center justify-center relative transition ${\r\n                                isPast ? 'opacity-40 cursor-not-allowed' :\r\n                                isBlocked ? 'bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 hover:bg-red-200 dark:hover:bg-red-900/40' :\r\n                                isToday ? 'bg-brand-blue text-white' :\r\n                                hasConfirmed || hasPending ? 'bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30' :\r\n                                'hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                            }`}\r\n                        >\r\n                            <span className={`text-sm font-medium ${\r\n                                isToday ? 'text-white' : \r\n                                isBlocked ? 'text-red-700 dark:text-red-400' :\r\n                                'dark:text-white'\r\n                            }`}>\r\n                                {day}\r\n                            </span>\r\n                            \r\n                            {/* Indicators */}\r\n                            <div className=\"flex gap-0.5 mt-0.5\">\r\n                                {hasConfirmed && <span className=\"w-1.5 h-1.5 bg-green-500 rounded-full\"></span>}\r\n                                {hasPending && <span className=\"w-1.5 h-1.5 bg-amber-500 rounded-full\"></span>}\r\n                                {isBlocked && <Ban size={10} className=\"text-red-600 dark:text-red-400\" />}\r\n                            </div>\r\n                            \r\n                            {/* Booking count badge */}\r\n                            {dayBookings.length > 0 && !isToday && (\r\n                                <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-brand-blue text-white text-[10px] rounded-full flex items-center justify-center font-bold\">\r\n                                    {dayBookings.length}\r\n                                </span>\r\n                            )}\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\n/**\r\n * Week View Component\r\n */\r\nfunction WeekView({ date, bookings, blockedDates, onDateClick, onBookingClick, getDayBookings, getDayBlocks, getWeekDates }) {\r\n    const weekDates = getWeekDates(date);\r\n    const today = new Date();\r\n    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\n    \r\n    // Time slots for the day (6 AM to 11 PM)\r\n    const timeSlots = [];\r\n    for (let hour = 6; hour <= 23; hour++) {\r\n        timeSlots.push(hour);\r\n    }\r\n\r\n    return (\r\n        <div className=\"overflow-x-auto\">\r\n            <div className=\"min-w-[800px]\">\r\n                {/* Day Headers */}\r\n                <div className=\"grid grid-cols-8 gap-2 mb-2 border-b dark:border-gray-700 pb-2\">\r\n                    <div className=\"text-sm font-bold text-gray-500\">Time</div>\r\n                    {weekDates.map((dayDate, i) => {\r\n                        const isToday = dayDate.toDateString() === today.toDateString();\r\n                        return (\r\n                            <div key={i} className=\"text-center\">\r\n                                <div className={`text-xs font-medium text-gray-400 mb-1 ${isToday ? 'text-brand-blue' : ''}`}>\r\n                                    {dayNames[dayDate.getDay()]}\r\n                                </div>\r\n                                <div className={`text-sm font-bold ${isToday ? 'text-brand-blue' : 'dark:text-white'}`}>\r\n                                    {dayDate.getDate()}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {/* Time Grid */}\r\n                <div className=\"grid grid-cols-8 gap-2\">\r\n                    {/* Time Column */}\r\n                    <div className=\"space-y-1\">\r\n                        {timeSlots.map(hour => (\r\n                            <div key={hour} className=\"h-16 flex items-start pt-1 text-xs text-gray-400\">\r\n                                {hour.toString().padStart(2, '0')}:00\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Day Columns */}\r\n                    {weekDates.map((dayDate, dayIndex) => {\r\n                        const dayBookings = getDayBookings(dayDate);\r\n                        const dayBlocks = getDayBlocks(dayDate);\r\n                        const isToday = dayDate.toDateString() === today.toDateString();\r\n\r\n                        return (\r\n                            <div key={dayIndex} className=\"relative\">\r\n                                {timeSlots.map((hour, hourIndex) => {\r\n                                    const slotStart = new Date(dayDate);\r\n                                    slotStart.setHours(hour, 0, 0, 0);\r\n                                    const slotEnd = new Date(dayDate);\r\n                                    slotEnd.setHours(hour + 1, 0, 0, 0);\r\n\r\n                                    // Find bookings in this time slot\r\n                                    const slotBookings = dayBookings.filter(b => {\r\n                                        if (!b.startTime) return false;\r\n                                        const bookingTime = new Date(`${dayDate.toDateString()} ${b.startTime}`);\r\n                                        return bookingTime >= slotStart && bookingTime < slotEnd;\r\n                                    });\r\n\r\n                                    // Check if this slot is blocked\r\n                                    const isBlocked = dayBlocks.some(block => {\r\n                                        const timeSlot = block.time_slot || block.timeSlot;\r\n                                        if (timeSlot === 'full') return true;\r\n                                        // Add more logic for time slot matching if needed\r\n                                        return false;\r\n                                    });\r\n\r\n                                    return (\r\n                                        <div\r\n                                            key={hourIndex}\r\n                                            onClick={() => onDateClick && onDateClick(slotStart)}\r\n                                            className={`h-16 border-b dark:border-gray-700 cursor-pointer transition ${\r\n                                                isToday ? 'bg-blue-50 dark:bg-blue-900/10' :\r\n                                                'hover:bg-gray-50 dark:hover:bg-gray-800'\r\n                                            } ${isBlocked ? 'bg-red-50 dark:bg-red-900/20' : ''}`}\r\n                                        >\r\n                                            {slotBookings.map((booking, bi) => (\r\n                                                <div\r\n                                                    key={bi}\r\n                                                    onClick={(e) => {\r\n                                                        e.stopPropagation();\r\n                                                        if (onBookingClick) onBookingClick(booking, dayDate);\r\n                                                    }}\r\n                                                    className={`text-xs p-1 m-0.5 rounded cursor-pointer ${\r\n                                                        (booking.status || '').toLowerCase() === 'confirmed'\r\n                                                            ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                                                            : 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400'\r\n                                                    }`}\r\n                                                >\r\n                                                    {booking.startTime || ''} {booking.clientName || 'Booking'}\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Day View Component\r\n */\r\nfunction DayView({ date, bookings, blockedDates, onDateClick, onBookingClick, getDayBookings, getDayBlocks }) {\r\n    const today = new Date();\r\n    const isToday = date.toDateString() === today.toDateString();\r\n    \r\n    const dayBookings = getDayBookings(date);\r\n    const dayBlocks = getDayBlocks(date);\r\n    \r\n    // Time slots for the day (6 AM to 11 PM)\r\n    const timeSlots = [];\r\n    for (let hour = 6; hour <= 23; hour++) {\r\n        timeSlots.push(hour);\r\n    }\r\n\r\n    // Group bookings by hour\r\n    const bookingsByHour = useMemo(() => {\r\n        const grouped = {};\r\n        dayBookings.forEach(booking => {\r\n            if (!booking.startTime) return;\r\n            const hour = parseInt(booking.startTime.split(':')[0]);\r\n            if (!grouped[hour]) grouped[hour] = [];\r\n            grouped[hour].push(booking);\r\n        });\r\n        return grouped;\r\n    }, [dayBookings]);\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* Day Header */}\r\n            <div className={`p-4 rounded-lg border-2 ${\r\n                isToday \r\n                    ? 'bg-brand-blue text-white border-brand-blue' \r\n                    : 'bg-gray-50 dark:bg-[#1f2128] border-gray-200 dark:border-gray-700'\r\n            }`}>\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h3 className=\"font-bold text-lg\">\r\n                            {date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}\r\n                        </h3>\r\n                        <p className={`text-sm mt-1 ${isToday ? 'text-blue-100' : 'text-gray-500'}`}>\r\n                            {dayBookings.length} booking{dayBookings.length !== 1 ? 's' : ''}\r\n                            {dayBlocks.length > 0 && `  ${dayBlocks.length} blocked slot${dayBlocks.length !== 1 ? 's' : ''}`}\r\n                        </p>\r\n                    </div>\r\n                    {dayBlocks.length > 0 && (\r\n                        <div className=\"flex items-center gap-2 text-red-600 dark:text-red-400\">\r\n                            <Ban size={20} />\r\n                            <span className=\"font-medium\">Blocked</span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Time Schedule */}\r\n            <div className=\"grid grid-cols-12 gap-2\">\r\n                {/* Time Column */}\r\n                <div className=\"col-span-2 space-y-1\">\r\n                    {timeSlots.map(hour => (\r\n                        <div key={hour} className=\"h-20 flex items-start pt-2 text-sm text-gray-500 font-medium\">\r\n                            {hour.toString().padStart(2, '0')}:00\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Schedule Column */}\r\n                <div className=\"col-span-10 relative\">\r\n                    {timeSlots.map((hour, hourIndex) => {\r\n                        const slotStart = new Date(date);\r\n                        slotStart.setHours(hour, 0, 0, 0);\r\n                        const slotEnd = new Date(date);\r\n                        slotEnd.setHours(hour + 1, 0, 0, 0);\r\n\r\n                        const slotBookings = bookingsByHour[hour] || [];\r\n                        const isBlocked = dayBlocks.some(block => {\r\n                            const timeSlot = block.time_slot || block.timeSlot;\r\n                            const startTime = block.start_time || block.startTime;\r\n                            const endTime = block.end_time || block.endTime;\r\n                            \r\n                            if (timeSlot === 'full') return true;\r\n                            // Check if this hour falls within blocked time slot\r\n                            if (timeSlot === 'custom' && startTime && endTime) {\r\n                                const blockStart = parseInt(startTime.split(':')[0]);\r\n                                const blockEnd = parseInt(endTime.split(':')[0]);\r\n                                return hour >= blockStart && hour < blockEnd;\r\n                            }\r\n                            return false;\r\n                        });\r\n\r\n                        return (\r\n                            <div\r\n                                key={hourIndex}\r\n                                onClick={() => onDateClick && onDateClick(slotStart)}\r\n                                className={`h-20 border-b dark:border-gray-700 cursor-pointer transition relative ${\r\n                                    isToday ? 'bg-blue-50 dark:bg-blue-900/10' :\r\n                                    'hover:bg-gray-50 dark:hover:bg-gray-800'\r\n                                } ${isBlocked ? 'bg-red-50 dark:bg-red-900/20' : ''}`}\r\n                            >\r\n                                {slotBookings.map((booking, bi) => (\r\n                                    <div\r\n                                        key={bi}\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            if (onBookingClick) onBookingClick(booking, date);\r\n                                        }}\r\n                                        className={`absolute left-1 right-1 p-2 rounded-lg cursor-pointer shadow-sm ${\r\n                                            (booking.status || '').toLowerCase() === 'confirmed'\r\n                                                ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-300 dark:border-green-700'\r\n                                                : 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 border border-amber-300 dark:border-amber-700'\r\n                                        }`}\r\n                                        style={{\r\n                                            top: `${((parseInt((booking.startTime || '00:00').split(':')[1]) || 0) / 60) * 100}%`,\r\n                                            height: `${((booking.duration || 1) / 60) * 100}%`\r\n                                        }}\r\n                                    >\r\n                                        <div className=\"font-medium text-sm\">\r\n                                            {booking.startTime || ''} {booking.clientName || 'Booking'}\r\n                                        </div>\r\n                                        {booking.roomName && (\r\n                                            <div className=\"text-xs opacity-75 flex items-center gap-1 mt-0.5\">\r\n                                                <MapPin size={10} />\r\n                                                {booking.roomName}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Bookings List (Alternative View) */}\r\n            {dayBookings.length > 0 && (\r\n                <div className=\"mt-4 pt-4 border-t dark:border-gray-700\">\r\n                    <h4 className=\"font-bold text-sm dark:text-white mb-3\">All Bookings</h4>\r\n                    <div className=\"space-y-2\">\r\n                        {dayBookings.map(booking => (\r\n                            <div\r\n                                key={booking.id}\r\n                                onClick={() => onBookingClick && onBookingClick(booking, date)}\r\n                                className={`p-3 rounded-lg cursor-pointer transition ${\r\n                                    (booking.status || '').toLowerCase() === 'confirmed'\r\n                                        ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800'\r\n                                        : 'bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800'\r\n                                }`}\r\n                            >\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div>\r\n                                        <div className=\"font-medium dark:text-white\">\r\n                                            {booking.startTime || 'TBD'} - {booking.clientName || 'Unknown'}\r\n                                        </div>\r\n                                        {booking.roomName && (\r\n                                            <div className=\"text-xs text-gray-500 mt-0.5 flex items-center gap-1\">\r\n                                                <MapPin size={10} />\r\n                                                {booking.roomName}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                    <span className={`text-xs px-2 py-1 rounded font-medium ${\r\n                                        (booking.status || '').toLowerCase() === 'confirmed'\r\n                                            ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                                            : 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400'\r\n                                    }`}>\r\n                                        {booking.status || 'Pending'}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","import { useState, useEffect } from 'react';\r\nimport { \r\n    Calendar, User, Check, X, MessageSquare, \r\n    Search, RefreshCw, ChevronLeft, ChevronRight,\r\n    CheckCircle, XCircle, Clock3, Eye, Ban, Trash2\r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport toast from 'react-hot-toast';\r\nimport { \r\n    notifyBookingStatusChange, \r\n    checkBookingConflicts, \r\n    validateStatusTransition,\r\n    trackBookingHistory,\r\n    calculateCancellationFee,\r\n    canCancelBooking\r\n} from '../../utils/bookingNotifications';\r\nimport { scheduleBookingReminder } from '../../utils/bookingReminders';\r\nimport RecurringBookingModal from './RecurringBookingModal';\r\nimport MultiRoomBookingModal from './MultiRoomBookingModal';\r\nimport UnifiedCalendar from '../shared/UnifiedCalendar';\r\n\r\nconst STATUS_CONFIG = {\r\n    pending: { \r\n        label: 'Pending', \r\n        color: 'amber', \r\n        icon: Clock3,\r\n        bgClass: 'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400'\r\n    },\r\n    confirmed: { \r\n        label: 'Confirmed', \r\n        color: 'green', \r\n        icon: CheckCircle,\r\n        bgClass: 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n    },\r\n    cancelled: { \r\n        label: 'Cancelled', \r\n        color: 'red', \r\n        icon: XCircle,\r\n        bgClass: 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400'\r\n    },\r\n    completed: { \r\n        label: 'Completed', \r\n        color: 'blue', \r\n        icon: Check,\r\n        bgClass: 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\r\n    },\r\n};\r\n\r\n/**\r\n * StudioBookings - Manage incoming bookings for the studio\r\n */\r\nexport default function StudioBookings({ user, onNavigateToChat }) {\r\n    const [bookings, setBookings] = useState([]);\r\n    const [blockedDates, setBlockedDates] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filter, setFilter] = useState('all');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedBooking, setSelectedBooking] = useState(null);\r\n    const [updating, setUpdating] = useState(null);\r\n    const [viewMode, setViewMode] = useState('list'); // 'list' or 'calendar'\r\n    const [calendarView, setCalendarView] = useState('month'); // 'month', 'week', 'day'\r\n    const [currentDate, setCurrentDate] = useState(new Date());\r\n    const [showBlockModal, setShowBlockModal] = useState(false);\r\n    const [selectedDate, setSelectedDate] = useState(null);\r\n    const [blockReason, setBlockReason] = useState('');\r\n    const [blockTimeSlot, setBlockTimeSlot] = useState('full'); // 'full', 'morning', 'afternoon', 'evening', 'custom'\r\n    const [customStartTime, setCustomStartTime] = useState('09:00');\r\n    const [customEndTime, setCustomEndTime] = useState('17:00');\r\n    const [showRecurringModal, setShowRecurringModal] = useState(false);\r\n    const [showMultiRoomModal, setShowMultiRoomModal] = useState(false);\r\n    const [selectedBookingForRecurring, setSelectedBookingForRecurring] = useState(null);\r\n    const [selectedBookingForRooms, setSelectedBookingForRooms] = useState(null);\r\n\r\n    // Fetch bookings from Supabase\r\n    useEffect(() => {\r\n        if (!user?.id && !user?.uid || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n\r\n        const channel = supabase\r\n            .channel('studio-bookings')\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'bookings',\r\n                filter: `studio_owner_id=eq.${userId}`\r\n            }, () => {\r\n                loadBookings();\r\n            })\r\n            .subscribe();\r\n\r\n        loadBookings();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [user?.id, user?.uid]);\r\n\r\n    // Helper function to safely parse booking dates\r\n    const parseBookingDate = (dateValue) => {\r\n        if (!dateValue || dateValue === 'Flexible') return null;\r\n        try {\r\n            const parsed = new Date(dateValue);\r\n            return isNaN(parsed.getTime()) ? null : parsed;\r\n        } catch {\r\n            return null;\r\n        }\r\n    };\r\n\r\n    const loadBookings = async () => {\r\n        if (!supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        setLoading(true);\r\n        try {\r\n            // Fix: Check both studio_owner_id AND target_id to catch all studio bookings\r\n            const { data: bookingsData, error } = await supabase\r\n                .from('bookings')\r\n                .select('*')\r\n                .or(`studio_owner_id.eq.${userId},target_id.eq.${userId}`)\r\n                .order('created_at', { ascending: false });\r\n            \r\n            if (error) throw error;\r\n            \r\n            const bookingsList = (bookingsData || []).map(b => {\r\n                const parsedDate = parseBookingDate(b.date);\r\n                return {\r\n                    id: b.id,\r\n                    ...b,\r\n                    studioOwnerId: b.studio_owner_id,\r\n                    clientId: b.sender_id || b.client_id, // Fix: Use sender_id as fallback\r\n                    clientName: b.sender_name || b.client_name, // Fix: Use sender_name as fallback\r\n                    date: parsedDate || new Date(),\r\n                    createdAt: b.created_at ? new Date(b.created_at) : new Date(),\r\n                    // Ensure status is properly formatted\r\n                    status: b.status || 'Pending'\r\n                };\r\n            });\r\n            setBookings(bookingsList);\r\n        } catch (error) {\r\n            console.error('Error fetching bookings:', error);\r\n            toast.error('Failed to load bookings');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Fetch blocked dates\r\n    useEffect(() => {\r\n        if (!user?.id && !user?.uid || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n\r\n        const channel = supabase\r\n            .channel('blocked-dates')\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'blocked_dates',\r\n                filter: `studio_owner_id=eq.${userId}`\r\n            }, () => {\r\n                loadBlockedDates();\r\n            })\r\n            .subscribe();\r\n\r\n        loadBlockedDates();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [user?.id, user?.uid]);\r\n\r\n    const loadBlockedDates = async () => {\r\n        if (!supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const { data: blockedData, error } = await supabase\r\n                .from('blocked_dates')\r\n                .select('*')\r\n                .eq('studio_owner_id', userId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            const blockedList = (blockedData || []).map(b => ({\r\n                id: b.id,\r\n                ...b,\r\n                studioOwnerId: b.studio_owner_id,\r\n                date: b.date ? new Date(b.date) : new Date()\r\n            }));\r\n            // Sort client-side\r\n            blockedList.sort((a, b) => new Date(a.date) - new Date(b.date));\r\n            setBlockedDates(blockedList);\r\n        } catch (error) {\r\n            console.error('Error fetching blocked dates:', error);\r\n            toast.error('Failed to load blocked dates');\r\n            setBlockedDates([]);\r\n        }\r\n    };\r\n\r\n    const handleUpdateStatus = async (bookingId, newStatus) => {\r\n        if (!supabase) return;\r\n        setUpdating(bookingId);\r\n        const toastId = toast.loading(`Updating booking...`);\r\n        \r\n        try {\r\n            // Get current booking to validate transition\r\n            const { data: currentBooking, error: fetchError } = await supabase\r\n                .from('bookings')\r\n                .select('*')\r\n                .eq('id', bookingId)\r\n                .single();\r\n\r\n            if (fetchError) throw fetchError;\r\n            if (!currentBooking) throw new Error('Booking not found');\r\n\r\n            const currentStatus = currentBooking.status || 'Pending';\r\n            \r\n            // Validate status transition using utility function\r\n            const validation = validateStatusTransition(currentStatus, newStatus);\r\n            if (!validation.isValid) {\r\n                throw new Error(\r\n                    `Invalid status transition: ${currentStatus}  ${newStatus}. ` +\r\n                    `Allowed transitions: ${validation.allowedStatuses.join(', ') || 'none'}`\r\n                );\r\n            }\r\n            \r\n            // Check for booking conflicts before confirming\r\n            if (newStatus === 'Confirmed') {\r\n                const userId = user?.id || user?.uid;\r\n                const conflictCheck = await checkBookingConflicts({ ...currentBooking, id: bookingId }, userId);\r\n                \r\n                if (conflictCheck.hasConflict) {\r\n                    const conflictNames = conflictCheck.conflicts.map(c => c.sender_name || 'Unknown').join(', ');\r\n                    throw new Error(\r\n                        `Time slot conflict detected. Conflicting bookings: ${conflictNames}. ` +\r\n                        `Please check calendar before confirming.`\r\n                    );\r\n                }\r\n            }\r\n\r\n            const now = new Date().toISOString();\r\n            \r\n            // Fix: Use validated status timestamp fields instead of dynamic property\r\n            const statusTimestampFields = {\r\n                Confirmed: 'confirmed_at',\r\n                Cancelled: 'cancelled_at',\r\n                Completed: 'completed_at',\r\n                Pending: 'pending_at'\r\n            };\r\n\r\n            const updateData = {\r\n                status: newStatus,\r\n                updated_at: now\r\n            };\r\n\r\n            // Only add timestamp field if it exists in our mapping\r\n            const timestampField = statusTimestampFields[newStatus];\r\n            if (timestampField) {\r\n                updateData[timestampField] = now;\r\n            }\r\n\r\n            // Handle payment processing for confirmed bookings\r\n            if (newStatus === 'Confirmed' && currentBooking.payment_intent_id) {\r\n                try {\r\n                    const apiUrl = import.meta.env.DEV ? 'http://localhost:3000/api' : '/api';\r\n                    const captureResponse = await fetch(`${apiUrl}/stripe/capture-payment`, {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({\r\n                            paymentIntentId: currentBooking.payment_intent_id\r\n                        })\r\n                    });\r\n\r\n                    if (!captureResponse.ok) {\r\n                        const errorData = await captureResponse.json().catch(() => ({}));\r\n                        console.warn('Payment capture failed:', errorData);\r\n                        // Continue with booking confirmation even if payment capture fails\r\n                        // Payment may have already been captured or will be handled by webhook\r\n                    }\r\n                } catch (paymentError) {\r\n                    console.error('Payment capture error:', paymentError);\r\n                    // Continue with booking confirmation\r\n                }\r\n            }\r\n\r\n            // Handle refunds for cancelled confirmed bookings with cancellation policy\r\n            if ((newStatus === 'Cancelled' || newStatus === 'cancelled') && (currentStatus === 'Confirmed' || currentStatus === 'confirmed') && currentBooking.payment_intent_id) {\r\n                try {\r\n                    // Get cancellation policy (from studio settings or default)\r\n                    const { data: policyData } = await supabase\r\n                        .from('cancellation_policies')\r\n                        .select('*')\r\n                        .eq('studio_id', user?.id || user?.uid)\r\n                        .eq('is_default', true)\r\n                        .single();\r\n\r\n                    const cancellationPolicy = policyData || null;\r\n                    const feeCalculation = calculateCancellationFee(currentBooking, cancellationPolicy);\r\n\r\n                    const apiUrl = import.meta.env.DEV ? 'http://localhost:3000/api' : '/api';\r\n                    \r\n                    // Refund amount (after fee deduction)\r\n                    const refundAmount = feeCalculation.refund;\r\n                    \r\n                    const refundResponse = await fetch(`${apiUrl}/stripe/refund-payment`, {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({\r\n                            paymentIntentId: currentBooking.payment_intent_id,\r\n                            amount: refundAmount, // Partial refund if fee applies\r\n                            reason: 'requested_by_customer'\r\n                        })\r\n                    });\r\n\r\n                    if (!refundResponse.ok) {\r\n                        const errorData = await refundResponse.json().catch(() => ({}));\r\n                        console.warn('Refund failed:', errorData);\r\n                        toast.error(\r\n                            feeCalculation.fee > 0 \r\n                                ? `Booking cancelled. Cancellation fee: $${feeCalculation.fee.toFixed(2)}. Refund failed - please contact support.`\r\n                                : 'Booking cancelled but refund failed. Please contact support.',\r\n                            { id: toastId }\r\n                        );\r\n                    } else {\r\n                        const message = feeCalculation.fee > 0\r\n                            ? `Booking cancelled. Cancellation fee: $${feeCalculation.fee.toFixed(2)}. Refunded: $${refundAmount.toFixed(2)}`\r\n                            : `Booking cancelled and refund processed`;\r\n                        toast.success(message, { id: toastId });\r\n                    }\r\n                } catch (refundError) {\r\n                    console.error('Refund error:', refundError);\r\n                    toast.error('Booking cancelled but refund failed. Please contact support.', { id: toastId });\r\n                }\r\n            }\r\n\r\n            // Track booking history before update\r\n            await trackBookingHistory(\r\n                bookingId,\r\n                currentStatus,\r\n                newStatus,\r\n                user?.id || user?.uid,\r\n                `Status changed from ${currentStatus} to ${newStatus}`\r\n            );\r\n\r\n            // Update booking status\r\n            const { error } = await supabase\r\n                .from('bookings')\r\n                .update(updateData)\r\n                .eq('id', bookingId);\r\n            \r\n            if (error) throw error;\r\n\r\n            // Send notification to client\r\n            await notifyBookingStatusChange(currentBooking, newStatus, user?.id || user?.uid);\r\n\r\n            // Schedule reminders for confirmed bookings\r\n            if (newStatus === 'Confirmed' || newStatus === 'confirmed') {\r\n                await scheduleBookingReminder({ ...currentBooking, status: newStatus }, [24, 2]);\r\n            }\r\n\r\n            // Only show success if we haven't already shown an error\r\n            if (newStatus !== 'Cancelled' || currentStatus !== 'Confirmed') {\r\n                toast.success(`Booking ${newStatus}!`, { id: toastId });\r\n            }\r\n\r\n            // Reload bookings to reflect changes\r\n            await loadBookings();\r\n        } catch (error) {\r\n            console.error('Update failed:', error);\r\n            toast.error(error.message || 'Failed to update booking', { id: toastId });\r\n        } finally {\r\n            setUpdating(null);\r\n        }\r\n    };\r\n\r\n    // Handle blocking a date (off-platform booking)\r\n    const handleBlockDate = async () => {\r\n        if (!selectedDate || (!user?.id && !user?.uid) || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        \r\n        const toastId = toast.loading('Blocking time slot...');\r\n        \r\n        try {\r\n            const { error } = await supabase\r\n                .from('blocked_dates')\r\n                .insert({\r\n                    studio_owner_id: userId,\r\n                    date: selectedDate.toISOString(),\r\n                    reason: blockReason || 'Off-platform booking',\r\n                    time_slot: blockTimeSlot,\r\n                    start_time: blockTimeSlot === 'custom' ? customStartTime : null,\r\n                    end_time: blockTimeSlot === 'custom' ? customEndTime : null,\r\n                    created_at: new Date().toISOString()\r\n                });\r\n            \r\n            if (error) throw error;\r\n            \r\n            toast.success('Time slot blocked!', { id: toastId });\r\n            setShowBlockModal(false);\r\n            setBlockReason('');\r\n            setBlockTimeSlot('full');\r\n            setSelectedDate(null);\r\n            // Reload blocked dates to reflect changes\r\n            await loadBlockedDates();\r\n        } catch (error) {\r\n            console.error('Error blocking date:', error);\r\n            toast.error(error.message || 'Failed to block time slot. Please try again.', { id: toastId });\r\n        }\r\n    };\r\n\r\n    // Handle unblocking a date\r\n    const handleUnblockDate = async (blockedId) => {\r\n        if (!supabase) return;\r\n        const toastId = toast.loading('Removing block...');\r\n        \r\n        try {\r\n            await supabase\r\n                .from('blocked_dates')\r\n                .delete()\r\n                .eq('id', blockedId);\r\n            \r\n            toast.success('Block removed!', { id: toastId });\r\n        } catch (error) {\r\n            console.error('Error unblocking date:', error);\r\n            toast.error('Failed to remove block', { id: toastId });\r\n        }\r\n    };\r\n\r\n    // Open block modal for a specific date\r\n    const openBlockModal = (date) => {\r\n        setSelectedDate(date);\r\n        setShowBlockModal(true);\r\n    };\r\n\r\n    // Filter and search bookings\r\n    const filteredBookings = bookings.filter(booking => {\r\n        const bookingStatus = (booking.status || '').toLowerCase();\r\n        const filterStatus = filter.toLowerCase();\r\n        const matchesFilter = filter === 'all' || bookingStatus === filterStatus;\r\n        const matchesSearch = !searchTerm || \r\n            booking.clientName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            booking.roomName?.toLowerCase().includes(searchTerm.toLowerCase());\r\n        return matchesFilter && matchesSearch;\r\n    });\r\n\r\n    // Group bookings by date\r\n    const groupedBookings = filteredBookings.reduce((groups, booking) => {\r\n        if (!booking.date) return groups; // Skip bookings without valid dates\r\n        const dateKey = booking.date.toDateString();\r\n        if (!groups[dateKey]) groups[dateKey] = [];\r\n        groups[dateKey].push(booking);\r\n        return groups;\r\n    }, {});\r\n\r\n    // Stats\r\n    const pendingCount = bookings.filter(b => (b.status || '').toLowerCase() === 'pending').length;\r\n    const todayBookings = bookings.filter(b => {\r\n        if (!b.date) return false;\r\n        const today = new Date().toDateString();\r\n        return b.date.toDateString() === today && (b.status || '').toLowerCase() === 'confirmed';\r\n    }).length;\r\n    const upcomingRevenue = bookings\r\n        .filter(b => {\r\n            if (!b.date) return false;\r\n            return (b.status || '').toLowerCase() === 'confirmed' && b.date >= new Date();\r\n        })\r\n        .reduce((sum, b) => sum + (b.totalPrice || b.offer_amount || 0), 0);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <RefreshCw className=\"animate-spin text-brand-blue\" size={32} />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Calendar className=\"text-brand-blue\" size={24} />\r\n                        Booking Management\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        {bookings.length} total bookings  {blockedDates.length} blocked slots\r\n                    </p>\r\n                </div>\r\n                \r\n                {/* View Mode Toggle */}\r\n                <div className=\"flex items-center gap-2\">\r\n                    <div className=\"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex\">\r\n                        <button\r\n                            onClick={() => setViewMode('list')}\r\n                            className={`px-3 py-1.5 text-sm font-medium rounded-md transition ${\r\n                                viewMode === 'list' \r\n                                    ? 'bg-white dark:bg-gray-700 text-brand-blue shadow-sm' \r\n                                    : 'text-gray-500'\r\n                            }`}\r\n                        >\r\n                            List\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setViewMode('calendar')}\r\n                            className={`px-3 py-1.5 text-sm font-medium rounded-md transition ${\r\n                                viewMode === 'calendar' \r\n                                    ? 'bg-white dark:bg-gray-700 text-brand-blue shadow-sm' \r\n                                    : 'text-gray-500'\r\n                            }`}\r\n                        >\r\n                            Calendar\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats Cards */}\r\n            <div className=\"grid grid-cols-3 gap-4\">\r\n                <div className=\"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl border border-amber-200 dark:border-amber-800\">\r\n                    <div className=\"text-2xl font-bold text-amber-600 dark:text-amber-400\">{pendingCount}</div>\r\n                    <div className=\"text-sm text-amber-700 dark:text-amber-300\">Pending Approval</div>\r\n                </div>\r\n                <div className=\"bg-green-50 dark:bg-green-900/20 p-4 rounded-xl border border-green-200 dark:border-green-800\">\r\n                    <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{todayBookings}</div>\r\n                    <div className=\"text-sm text-green-700 dark:text-green-300\">Today&apos;s Sessions</div>\r\n                </div>\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800\">\r\n                    <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">${upcomingRevenue.toLocaleString()}</div>\r\n                    <div className=\"text-sm text-blue-700 dark:text-blue-300\">Upcoming Revenue</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                <div className=\"relative flex-1\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        placeholder=\"Search by client or room...\"\r\n                        className=\"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                    />\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    {['all', 'pending', 'confirmed', 'completed', 'cancelled'].map(status => (\r\n                        <button\r\n                            key={status}\r\n                            onClick={() => setFilter(status)}\r\n                            className={`px-4 py-2 rounded-lg font-medium text-sm transition ${\r\n                                filter === status\r\n                                    ? 'bg-brand-blue text-white'\r\n                                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                            }`}\r\n                        >\r\n                            {status.charAt(0).toUpperCase() + status.slice(1)}\r\n                            {status === 'pending' && pendingCount > 0 && (\r\n                                <span className=\"ml-1.5 bg-amber-500 text-white text-xs px-1.5 py-0.5 rounded-full\">\r\n                                    {pendingCount}\r\n                                </span>\r\n                            )}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Calendar View */}\r\n            {viewMode === 'calendar' && (\r\n                <div className=\"space-y-4\">\r\n                    <UnifiedCalendar\r\n                        currentDate={currentDate}\r\n                        onDateChange={setCurrentDate}\r\n                        view={calendarView}\r\n                        onViewChange={setCalendarView}\r\n                        bookings={bookings}\r\n                        blockedDates={blockedDates}\r\n                        onDateClick={(date) => {\r\n                            const today = new Date();\r\n                            const isPast = date < new Date(today.getFullYear(), today.getMonth(), today.getDate());\r\n                            if (!isPast) {\r\n                                openBlockModal(date);\r\n                            }\r\n                        }}\r\n                        onBookingClick={(booking, date) => {\r\n                            setSelectedBooking(booking);\r\n                        }}\r\n                        showControls={true}\r\n                    />\r\n                    \r\n                    {/* Blocked Dates List */}\r\n                    {blockedDates.length > 0 && (\r\n                        <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-4\">\r\n                            <h4 className=\"font-bold text-sm dark:text-white mb-3 flex items-center gap-2\">\r\n                                <Ban size={14} className=\"text-red-500\" />\r\n                                Blocked Time Slots\r\n                            </h4>\r\n                            <div className=\"space-y-2 max-h-48 overflow-y-auto\">\r\n                                {blockedDates.map(block => (\r\n                                    <div \r\n                                        key={block.id}\r\n                                        className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-[#1f2128] rounded-lg border dark:border-gray-700\"\r\n                                    >\r\n                                        <div>\r\n                                            <div className=\"font-medium dark:text-white text-sm\">\r\n                                                {new Date(block.date).toLocaleDateString('en-US', { \r\n                                                    weekday: 'short', \r\n                                                    month: 'short', \r\n                                                    day: 'numeric' \r\n                                                })}\r\n                                                {block.time_slot && block.time_slot !== 'full' && (\r\n                                                    <span className=\"ml-2 text-xs text-gray-500\">\r\n                                                        ({block.time_slot === 'custom' \r\n                                                            ? `${block.start_time || ''} - ${block.end_time || ''}` \r\n                                                            : block.time_slot})\r\n                                                    </span>\r\n                                                )}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-gray-500\">{block.reason}</div>\r\n                                        </div>\r\n                                        <button\r\n                                            onClick={() => handleUnblockDate(block.id)}\r\n                                            className=\"p-1.5 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition\"\r\n                                            title=\"Remove block\"\r\n                                        >\r\n                                            <Trash2 size={16} />\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Bookings List */}\r\n            {viewMode === 'list' && (\r\n                <>\r\n                {filteredBookings.length === 0 ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center\">\r\n                    <Calendar size={48} className=\"mx-auto mb-4 text-gray-300 dark:text-gray-600\" />\r\n                    <h3 className=\"text-lg font-bold dark:text-white mb-2\">No Bookings Found</h3>\r\n                    <p className=\"text-gray-500 dark:text-gray-400\">\r\n                        {filter !== 'all' ? `No ${filter} bookings` : 'Bookings will appear here when clients book your studio'}\r\n                    </p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-6\">\r\n                    {Object.entries(groupedBookings).map(([dateKey, dateBookings]) => (\r\n                        <div key={dateKey}>\r\n                            <h3 className=\"text-sm font-bold text-gray-500 uppercase mb-3 flex items-center gap-2\">\r\n                                <Calendar size={14} />\r\n                                {new Date(dateKey).toLocaleDateString('en-US', { \r\n                                    weekday: 'long', \r\n                                    month: 'long', \r\n                                    day: 'numeric' \r\n                                })}\r\n                                <span className=\"text-gray-400\">({dateBookings.length})</span>\r\n                            </h3>\r\n                            <div className=\"space-y-3\">\r\n                                {dateBookings.map(booking => {\r\n                                    const statusConfig = getStatusConfig(booking.status);\r\n                                    \r\n                                    return (\r\n                                        <div \r\n                                            key={booking.id}\r\n                                            className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\"\r\n                                        >\r\n                                            <div className=\"p-4 flex items-center gap-4\">\r\n                                                {/* Time */}\r\n                                                <div className=\"text-center min-w-[70px]\">\r\n                                                    <div className=\"text-lg font-bold dark:text-white\">\r\n                                                        {booking.startTime}\r\n                                                    </div>\r\n                                                    <div className=\"text-xs text-gray-500\">\r\n                                                        {booking.duration}h\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                {/* Details */}\r\n                                                <div className=\"flex-1 min-w-0\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <span className=\"font-bold dark:text-white truncate\">\r\n                                                            {booking.clientName || 'Unknown Client'}\r\n                                                        </span>\r\n                                                        <span className={`text-xs px-2 py-0.5 rounded-full ${statusConfig.bgClass}`}>\r\n                                                            {statusConfig.label}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <div className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                                                        {booking.roomName || 'Main Room'}  ${booking.totalPrice || 0}\r\n                                                    </div>\r\n                                                    {booking.notes && (\r\n                                                        <div className=\"text-xs text-gray-400 mt-1 truncate\">\r\n                                                            Note: {booking.notes}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n\r\n                                                {/* Actions */}\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    {(booking.status || '').toLowerCase() === 'pending' && (\r\n                                                        <>\r\n                                                            <button\r\n                                                                onClick={() => handleUpdateStatus(booking.id, 'Confirmed')}\r\n                                                                disabled={updating === booking.id}\r\n                                                                className=\"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition\"\r\n                                                                title=\"Approve\"\r\n                                                            >\r\n                                                                <Check size={18} />\r\n                                                            </button>\r\n                                                            <button\r\n                                                                onClick={() => handleUpdateStatus(booking.id, 'Cancelled')}\r\n                                                                disabled={updating === booking.id}\r\n                                                                className=\"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition\"\r\n                                                                title=\"Decline\"\r\n                                                            >\r\n                                                                <X size={18} />\r\n                                                            </button>\r\n                                                        </>\r\n                                                    )}\r\n                                                    {(booking.status || '').toLowerCase() === 'confirmed' && (\r\n                                                        <button\r\n                                                            onClick={() => handleUpdateStatus(booking.id, 'Completed')}\r\n                                                            disabled={updating === booking.id}\r\n                                                            className=\"px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium\"\r\n                                                        >\r\n                                                            Mark Complete\r\n                                                        </button>\r\n                                                    )}\r\n                                                    {booking.clientId && onNavigateToChat && (\r\n                                                        <button\r\n                                                            onClick={() => onNavigateToChat(booking.clientId)}\r\n                                                            className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                                            title=\"Message Client\"\r\n                                                        >\r\n                                                            <MessageSquare size={18} />\r\n                                                        </button>\r\n                                                    )}\r\n                                                    <button\r\n                                                        onClick={() => setSelectedBooking(booking)}\r\n                                                        className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                                                        title=\"View Details\"\r\n                                                    >\r\n                                                        <Eye size={18} />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n                </>\r\n            )}\r\n\r\n            {/* Block Date Modal */}\r\n            {showBlockModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-md w-full\">\r\n                        <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                            <h3 className=\"font-bold dark:text-white flex items-center gap-2\">\r\n                                <Ban size={18} className=\"text-red-500\" />\r\n                                Block Time Slot\r\n                            </h3>\r\n                            <button onClick={() => {\r\n                                setShowBlockModal(false);\r\n                                setSelectedDate(null);\r\n                                setBlockReason('');\r\n                            }}>\r\n                                <X size={20} className=\"text-gray-500\" />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"p-4 space-y-4\">\r\n                            {/* Selected Date */}\r\n                            <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg text-center\">\r\n                                <div className=\"text-sm text-gray-500 uppercase font-bold mb-1\">Selected Date</div>\r\n                                <div className=\"text-lg font-bold dark:text-white\">\r\n                                    {selectedDate?.toLocaleDateString('en-US', { \r\n                                        weekday: 'long', \r\n                                        month: 'long', \r\n                                        day: 'numeric',\r\n                                        year: 'numeric'\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Time Slot Selection */}\r\n                            <div>\r\n                                <label className=\"text-sm font-bold dark:text-white mb-2 block\">Time Slot</label>\r\n                                <div className=\"grid grid-cols-2 gap-2\">\r\n                                    {[\r\n                                        { id: 'full', label: 'Full Day' },\r\n                                        { id: 'morning', label: 'Morning (6AM-12PM)' },\r\n                                        { id: 'afternoon', label: 'Afternoon (12PM-6PM)' },\r\n                                        { id: 'evening', label: 'Evening (6PM-12AM)' },\r\n                                    ].map(slot => (\r\n                                        <button\r\n                                            key={slot.id}\r\n                                            onClick={() => setBlockTimeSlot(slot.id)}\r\n                                            className={`p-2 text-sm rounded-lg border transition ${\r\n                                                blockTimeSlot === slot.id\r\n                                                    ? 'bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400'\r\n                                                    : 'border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300'\r\n                                            }`}\r\n                                        >\r\n                                            {slot.label}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => setBlockTimeSlot('custom')}\r\n                                    className={`w-full mt-2 p-2 text-sm rounded-lg border transition ${\r\n                                        blockTimeSlot === 'custom'\r\n                                            ? 'bg-red-100 dark:bg-red-900/30 border-red-300 dark:border-red-700 text-red-700 dark:text-red-400'\r\n                                            : 'border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-300'\r\n                                    }`}\r\n                                >\r\n                                    Custom Time Range\r\n                                </button>\r\n\r\n                                {blockTimeSlot === 'custom' && (\r\n                                    <div className=\"flex gap-2 mt-2\">\r\n                                        <div className=\"flex-1\">\r\n                                            <label className=\"text-xs text-gray-500 mb-1 block\">Start</label>\r\n                                            <input\r\n                                                type=\"time\"\r\n                                                value={customStartTime}\r\n                                                onChange={(e) => setCustomStartTime(e.target.value)}\r\n                                                className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"flex-1\">\r\n                                            <label className=\"text-xs text-gray-500 mb-1 block\">End</label>\r\n                                            <input\r\n                                                type=\"time\"\r\n                                                value={customEndTime}\r\n                                                onChange={(e) => setCustomEndTime(e.target.value)}\r\n                                                className=\"w-full p-2 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white text-sm\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Reason */}\r\n                            <div>\r\n                                <label className=\"text-sm font-bold dark:text-white mb-2 block\">Reason (optional)</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={blockReason}\r\n                                    onChange={(e) => setBlockReason(e.target.value)}\r\n                                    placeholder=\"e.g., Private session, Maintenance, Personal...\"\r\n                                    className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Actions */}\r\n                            <div className=\"flex gap-3 pt-2\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        setShowBlockModal(false);\r\n                                        setSelectedDate(null);\r\n                                        setBlockReason('');\r\n                                    }}\r\n                                    className=\"flex-1 py-2.5 border dark:border-gray-600 rounded-lg font-bold dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleBlockDate}\r\n                                    className=\"flex-1 py-2.5 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition flex items-center justify-center gap-2\"\r\n                                >\r\n                                    <Ban size={16} />\r\n                                    Block Time\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Booking Detail Modal */}\r\n            {selectedBooking && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\r\n                        <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                            <h3 className=\"font-bold dark:text-white\">Booking Details</h3>\r\n                            <button onClick={() => setSelectedBooking(null)}>\r\n                                <X size={20} className=\"text-gray-500\" />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"p-4 space-y-4\">\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className=\"w-12 h-12 bg-brand-blue/10 rounded-full flex items-center justify-center\">\r\n                                    <User className=\"text-brand-blue\" size={24} />\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"font-bold dark:text-white\">{selectedBooking.clientName}</div>\r\n                                    <div className=\"text-sm text-gray-500\">{selectedBooking.clientEmail}</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-gray-500 uppercase font-bold mb-1\">Date</div>\r\n                                    <div className=\"dark:text-white\">\r\n                                        {selectedBooking.date.toLocaleDateString('en-US', { \r\n                                            weekday: 'short', \r\n                                            month: 'short', \r\n                                            day: 'numeric' \r\n                                        })}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-gray-500 uppercase font-bold mb-1\">Time</div>\r\n                                    <div className=\"dark:text-white\">\r\n                                        {selectedBooking.startTime} ({selectedBooking.duration}h)\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-gray-500 uppercase font-bold mb-1\">Room</div>\r\n                                    <div className=\"dark:text-white\">{selectedBooking.roomName}</div>\r\n                                </div>\r\n                                <div className=\"bg-gray-50 dark:bg-[#1f2128] p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-gray-500 uppercase font-bold mb-1\">Total</div>\r\n                                    <div className=\"dark:text-white font-bold text-green-600\">\r\n                                        ${selectedBooking.totalPrice || selectedBooking.offer_amount || 0}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {selectedBooking.notes && (\r\n                                <div className=\"bg-amber-50 dark:bg-amber-900/20 p-3 rounded-lg\">\r\n                                    <div className=\"text-xs text-amber-600 uppercase font-bold mb-1\">Client Notes</div>\r\n                                    <div className=\"text-amber-800 dark:text-amber-300 text-sm\">{selectedBooking.notes}</div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Action Buttons */}\r\n                            <div className=\"flex gap-2 pt-2 border-t dark:border-gray-700\">\r\n                                {((selectedBooking.status || '').toLowerCase() === 'confirmed') && (\r\n                                    <>\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                setSelectedBookingForRecurring(selectedBooking);\r\n                                                setShowRecurringModal(true);\r\n                                            }}\r\n                                            className=\"flex-1 py-2 px-3 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-900/50 transition text-sm font-medium flex items-center justify-center gap-2\"\r\n                                        >\r\n                                            <Repeat size={14} />\r\n                                            Make Recurring\r\n                                        </button>\r\n                                        {userData?.rooms && userData.rooms.length > 0 && (\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    setSelectedBookingForRooms(selectedBooking);\r\n                                                    setShowMultiRoomModal(true);\r\n                                                }}\r\n                                                className=\"flex-1 py-2 px-3 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition text-sm font-medium flex items-center justify-center gap-2\"\r\n                                            >\r\n                                                <Home size={14} />\r\n                                                Assign Rooms\r\n                                            </button>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"text-xs text-gray-400 pt-2\">\r\n                                Booked {selectedBooking.createdAt && selectedBooking.createdAt instanceof Date\r\n                                    ? selectedBooking.createdAt.toLocaleDateString()\r\n                                    : new Date(selectedBooking.created_at || selectedBooking.timestamp || Date.now()).toLocaleDateString()}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Recurring Booking Modal */}\r\n            {showRecurringModal && selectedBookingForRecurring && (\r\n                <RecurringBookingModal\r\n                    booking={selectedBookingForRecurring}\r\n                    onClose={() => {\r\n                        setShowRecurringModal(false);\r\n                        setSelectedBookingForRecurring(null);\r\n                    }}\r\n                    onSuccess={() => {\r\n                        loadBookings();\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            {/* Multi-Room Booking Modal */}\r\n            {showMultiRoomModal && selectedBookingForRooms && (\r\n                <MultiRoomBookingModal\r\n                    booking={selectedBookingForRooms}\r\n                    rooms={userData?.rooms || []}\r\n                    onClose={() => {\r\n                        setShowMultiRoomModal(false);\r\n                        setSelectedBookingForRooms(null);\r\n                    }}\r\n                    onSuccess={() => {\r\n                        loadBookings();\r\n                    }}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import { useState } from 'react';\r\nimport { \r\n    Mic, Speaker, Monitor, Server, Plus, Search, \r\n    Trash2, Edit2, Save, Loader2, X, \r\n    Package\r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport toast from 'react-hot-toast';\r\nimport EquipmentAutocomplete from '../shared/EquipmentAutocomplete';\r\nimport { EQUIP_CATEGORIES } from '../../config/constants';\r\n\r\n/**\r\n * Map database category names to EQUIP_CATEGORIES IDs\r\n */\r\nfunction mapCategoryToId(dbCategory) {\r\n    if (!dbCategory) return 'other';\r\n    \r\n    const categoryLower = dbCategory.toLowerCase().trim();\r\n    \r\n    // Direct mappings from database category names to EQUIP_CATEGORIES IDs\r\n    const categoryMap = {\r\n        // Recording & Production\r\n        'microphones': 'microphones',\r\n        'microphones & transducers': 'microphones',\r\n        'audio interfaces': 'audio_interfaces',\r\n        'preamps': 'preamps',\r\n        'preamps & channel strips': 'preamps',\r\n        'mixing consoles': 'mixing_consoles',\r\n        'mixers & consoles': 'mixing_consoles',\r\n        'mixing consoles & mixers': 'mixing_consoles',\r\n        'studio monitors': 'monitors',\r\n        'monitors': 'monitors',\r\n        'headphones': 'headphones',\r\n        'outboard gear': 'outboard_processing',\r\n        'outboard processing': 'outboard_processing',\r\n        'effects processors': 'effects_processors',\r\n        'converters': 'converters',\r\n        'ad/da converters': 'converters',\r\n        'recording devices': 'recorders',\r\n        'recorders': 'recorders',\r\n        \r\n        // Instruments\r\n        'electric guitars': 'electric_guitars',\r\n        'acoustic guitars': 'acoustic_guitars',\r\n        'bass guitars': 'bass_guitars',\r\n        'guitar amps': 'guitar_amps',\r\n        'guitar & bass amplifiers': 'guitar_amps',\r\n        'guitar effects': 'guitar_effects',\r\n        'guitar pedals': 'guitar_effects',\r\n        'synthesizers': 'synthesizers',\r\n        'keyboards': 'keyboards',\r\n        'midi controllers': 'midi_controllers',\r\n        'pianos': 'pianos',\r\n        'drum kits': 'drum_kits',\r\n        'electronic drums': 'electronic_drums',\r\n        'drum machines': 'drum_machines',\r\n        'string instruments': 'string_instruments',\r\n        'wind instruments': 'wind_instruments',\r\n        \r\n        // Live Sound\r\n        'pa speakers': 'pa_speakers',\r\n        'power amps': 'power_amps',\r\n        'live mixers': 'live_mixers',\r\n        'wireless systems': 'wireless_systems',\r\n        'in ear monitors': 'in_ear_monitors',\r\n        'stage gear': 'stage_gear',\r\n        \r\n        // DJ\r\n        'turntables': 'turntables',\r\n        'dj controllers': 'dj_controllers',\r\n        'dj mixers': 'dj_mixers',\r\n        \r\n        // Other\r\n        'cables': 'cables',\r\n        'patchbays': 'patchbays',\r\n        'acoustic treatment': 'acoustic_treatment',\r\n        'studio furniture': 'studio_furniture',\r\n        'computers': 'computers',\r\n        'software licenses': 'software_licenses',\r\n        'storage drives': 'storage_drives',\r\n        'stands & mounts': 'stands_mounts',\r\n        'cases & bags': 'cases_bags',\r\n        'vintage gear': 'vintage_gear'\r\n    };\r\n    \r\n    // Try exact match first\r\n    if (categoryMap[categoryLower]) {\r\n        return categoryMap[categoryLower];\r\n    }\r\n    \r\n    // Try partial matches\r\n    for (const [key, value] of Object.entries(categoryMap)) {\r\n        if (categoryLower.includes(key) || key.includes(categoryLower)) {\r\n            return value;\r\n        }\r\n    }\r\n    \r\n    // Try to find by label match in EQUIP_CATEGORIES\r\n    const matched = EQUIP_CATEGORIES.find(cat => \r\n        cat.label.toLowerCase() === categoryLower ||\r\n        cat.label.toLowerCase().includes(categoryLower) ||\r\n        categoryLower.includes(cat.label.toLowerCase())\r\n    );\r\n    \r\n    if (matched) {\r\n        return matched.id;\r\n    }\r\n    \r\n    // Default to 'other' if no match found\r\n    return 'other';\r\n}\r\n\r\n/**\r\n * StudioEquipment - Full equipment inventory management\r\n */\r\nexport default function StudioEquipment({ user, userData, onUpdate }) {\r\n    const [equipment, setEquipment] = useState(userData?.studioEquipment || []);\r\n    const [saving, setSaving] = useState(false);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [categoryFilter, setCategoryFilter] = useState('all');\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [editingItem, setEditingItem] = useState(null);\r\n\r\n    const handleSave = async (updatedEquipment) => {\r\n        if (!supabase) return;\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving equipment...');\r\n        const userId = user?.id || user?.uid;\r\n        \r\n        try {\r\n            await supabase\r\n                .from('profiles')\r\n                .update({ \r\n                    studio_equipment: updatedEquipment,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', userId);\r\n            \r\n            setEquipment(updatedEquipment);\r\n            toast.success('Equipment saved!', { id: toastId });\r\n            if (onUpdate) onUpdate({ studioEquipment: updatedEquipment });\r\n        } catch (error) {\r\n            console.error('Save failed:', error);\r\n            toast.error('Failed to save', { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleAddItem = async (newItem) => {\r\n        const itemWithId = {\r\n            ...newItem,\r\n            id: Date.now().toString(),\r\n            addedAt: new Date().toISOString()\r\n        };\r\n        await handleSave([...equipment, itemWithId]);\r\n        setShowAddModal(false);\r\n    };\r\n\r\n    const handleUpdateItem = async (updatedItem) => {\r\n        const updatedEquipment = equipment.map(item => \r\n            item.id === updatedItem.id ? updatedItem : item\r\n        );\r\n        await handleSave(updatedEquipment);\r\n        setEditingItem(null);\r\n    };\r\n\r\n    const handleDeleteItem = async (itemId) => {\r\n        if (!confirm('Remove this item from inventory?')) return;\r\n        const updatedEquipment = equipment.filter(item => item.id !== itemId);\r\n        await handleSave(updatedEquipment);\r\n    };\r\n\r\n    // Filter equipment\r\n    const filteredEquipment = equipment.filter(item => {\r\n        const matchesSearch = !searchTerm || \r\n            item.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            item.brand?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            item.model?.toLowerCase().includes(searchTerm.toLowerCase());\r\n        const matchesCategory = categoryFilter === 'all' || item.category === categoryFilter;\r\n        return matchesSearch && matchesCategory;\r\n    });\r\n\r\n    // Group by category\r\n    const groupedEquipment = filteredEquipment.reduce((groups, item) => {\r\n        const cat = item.category || 'Other';\r\n        if (!groups[cat]) groups[cat] = [];\r\n        groups[cat].push(item);\r\n        return groups;\r\n    }, {});\r\n\r\n    // Get unique categories\r\n    const categories = [...new Set(equipment.map(item => item.category).filter(Boolean))];\r\n\r\n    // Stats\r\n    const totalItems = equipment.length;\r\n    const totalValue = equipment.reduce((sum, item) => sum + (parseFloat(item.value) || 0), 0);\r\n\r\n    const getCategoryIcon = (category) => {\r\n        const iconMap = {\r\n            'microphones_and_input_transducers': Mic,\r\n            'monitoring_and_playback': Speaker,\r\n            'mixing_consoles_and_control': Monitor,\r\n            'outboard_signal_processing': Server,\r\n            'computer_audio_and_interfaces': Server,\r\n        };\r\n        return iconMap[category] || Package;\r\n    };\r\n\r\n    const getCategoryLabel = (categoryId) => {\r\n        const cat = EQUIP_CATEGORIES.find(c => c.id === categoryId);\r\n        return cat?.label || categoryId;\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Package className=\"text-brand-blue\" size={24} />\r\n                        Equipment Inventory\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Manage your studio gear and equipment\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={() => setShowAddModal(true)}\r\n                    className=\"bg-brand-blue text-white px-4 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2\"\r\n                >\r\n                    <Plus size={18} /> Add Equipment\r\n                </button>\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                    <div className=\"text-2xl font-bold dark:text-white\">{totalItems}</div>\r\n                    <div className=\"text-sm text-gray-500\">Total Items</div>\r\n                </div>\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                    <div className=\"text-2xl font-bold text-green-600\">${totalValue.toLocaleString()}</div>\r\n                    <div className=\"text-sm text-gray-500\">Est. Value</div>\r\n                </div>\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                    <div className=\"text-2xl font-bold dark:text-white\">{categories.length}</div>\r\n                    <div className=\"text-sm text-gray-500\">Categories</div>\r\n                </div>\r\n                <div className=\"bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                    <div className=\"text-2xl font-bold text-brand-blue\">\r\n                        {equipment.filter(e => e.featured).length}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-500\">Featured Items</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-col md:flex-row gap-4 bg-white dark:bg-[#2c2e36] p-4 rounded-xl border dark:border-gray-700\">\r\n                <div className=\"relative flex-1\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        placeholder=\"Search equipment...\"\r\n                        className=\"w-full pl-10 pr-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                    />\r\n                </div>\r\n                <select\r\n                    value={categoryFilter}\r\n                    onChange={(e) => setCategoryFilter(e.target.value)}\r\n                    className=\"px-4 py-2.5 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                >\r\n                    <option value=\"all\">All Categories</option>\r\n                    {EQUIP_CATEGORIES.map(cat => (\r\n                        <option key={cat.id} value={cat.id}>{cat.label}</option>\r\n                    ))}\r\n                </select>\r\n            </div>\r\n\r\n            {/* Equipment List */}\r\n            {filteredEquipment.length === 0 ? (\r\n                <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border-2 border-dashed dark:border-gray-700 p-12 text-center\">\r\n                    <Package size={48} className=\"mx-auto mb-4 text-gray-300 dark:text-gray-600\" />\r\n                    <h3 className=\"text-lg font-bold dark:text-white mb-2\">No Equipment Found</h3>\r\n                    <p className=\"text-gray-500 dark:text-gray-400 mb-4\">\r\n                        {searchTerm || categoryFilter !== 'all' \r\n                            ? 'Try adjusting your filters'\r\n                            : 'Add your studio equipment to showcase your gear'}\r\n                    </p>\r\n                    <button\r\n                        onClick={() => setShowAddModal(true)}\r\n                        className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition\"\r\n                    >\r\n                        Add Your First Item\r\n                    </button>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-6\">\r\n                    {Object.entries(groupedEquipment).map(([category, items]) => {\r\n                        const CategoryIcon = getCategoryIcon(category);\r\n                        return (\r\n                            <div key={category} className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden\">\r\n                                <div className=\"p-4 bg-gray-50 dark:bg-[#23262f] border-b dark:border-gray-700 flex items-center gap-3\">\r\n                                    <CategoryIcon className=\"text-brand-blue\" size={20} />\r\n                                    <h3 className=\"font-bold dark:text-white\">{getCategoryLabel(category)}</h3>\r\n                                    <span className=\"text-sm text-gray-500\">({items.length})</span>\r\n                                </div>\r\n                                <div className=\"divide-y dark:divide-gray-700\">\r\n                                    {items.map(item => (\r\n                                        <div \r\n                                            key={item.id}\r\n                                            className=\"p-4 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-[#23262f] transition\"\r\n                                        >\r\n                                            {/* Item Info */}\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <span className=\"font-bold dark:text-white\">\r\n                                                        {item.brand && <span className=\"text-gray-500 font-medium\">{item.brand}</span>} {item.name || item.model}\r\n                                                    </span>\r\n                                                    {(item.quantity && item.quantity > 1) && (\r\n                                                        <span className=\"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 px-2 py-0.5 rounded font-medium\">\r\n                                                            Qty: {item.quantity}\r\n                                                        </span>\r\n                                                    )}\r\n                                                    {item.featured && (\r\n                                                        <span className=\"text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 px-2 py-0.5 rounded\">\r\n                                                            Featured\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                                <div className=\"text-sm text-gray-500 dark:text-gray-400 mt-0.5\">\r\n                                                    {item.model && item.name !== item.model && <span>{item.model}</span>}\r\n                                                    {item.serial && <span className=\"ml-2\">S/N: {item.serial}</span>}\r\n                                                </div>\r\n                                                {item.notes && (\r\n                                                    <div className=\"text-xs text-gray-400 mt-1\">{item.notes}</div>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {/* Value */}\r\n                                            {item.value && (\r\n                                                <div className=\"text-right\">\r\n                                                    <div className=\"text-sm font-bold text-green-600 dark:text-green-400\">\r\n                                                        ${parseFloat(item.value).toLocaleString()}\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n\r\n                                            {/* Actions */}\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <button\r\n                                                    onClick={() => setEditingItem(item)}\r\n                                                    className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                                >\r\n                                                    <Edit2 size={16} />\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => handleDeleteItem(item.id)}\r\n                                                    className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                                >\r\n                                                    <Trash2 size={16} />\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            )}\r\n\r\n            {/* Add/Edit Modal */}\r\n            {(showAddModal || editingItem) && (\r\n                <EquipmentModal\r\n                    item={editingItem}\r\n                    onSave={editingItem ? handleUpdateItem : handleAddItem}\r\n                    onClose={() => { setShowAddModal(false); setEditingItem(null); }}\r\n                    saving={saving}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Equipment Add/Edit Modal\r\n */\r\nfunction EquipmentModal({ item, onSave, onClose, saving }) {\r\n    const [formData, setFormData] = useState(item || {\r\n        name: '',\r\n        brand: '',\r\n        model: '',\r\n        category: '',\r\n        serial: '',\r\n        value: '',\r\n        notes: '',\r\n        featured: false,\r\n        quantity: 1\r\n    });\r\n\r\n    const handleSubmit = () => {\r\n        if (!formData.name && !formData.model) {\r\n            toast.error('Name or model is required');\r\n            return;\r\n        }\r\n        onSave(formData);\r\n    };\r\n\r\n    const handleAutocompleteSelect = (selected) => {\r\n        // Map database category to EQUIP_CATEGORIES ID\r\n        const mappedCategory = mapCategoryToId(selected.category);\r\n        \r\n        setFormData(prev => ({\r\n            ...prev,\r\n            name: selected.name || prev.name,\r\n            brand: selected.brand || prev.brand,\r\n            model: selected.model || prev.model,\r\n            category: mappedCategory // Use mapped category ID\r\n        }));\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto animate-in zoom-in-95\">\r\n                <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                    <h3 className=\"font-bold dark:text-white\">\r\n                        {item ? 'Edit Equipment' : 'Add Equipment'}\r\n                    </h3>\r\n                    <button onClick={onClose}>\r\n                        <X size={20} className=\"text-gray-500\" />\r\n                    </button>\r\n                </div>\r\n                <div className=\"p-4 space-y-4\">\r\n                    {/* Primary: Equipment Search */}\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">\r\n                            Search Equipment Database\r\n                            <span className=\"text-gray-400 font-normal ml-2\">(Recommended)</span>\r\n                        </label>\r\n                        <EquipmentAutocomplete\r\n                            onSelect={handleAutocompleteSelect}\r\n                            placeholder=\"Search for equipment (e.g. U87, SSL, Fender Twin)...\"\r\n                            className=\"w-full\"\r\n                        />\r\n                        <p className=\"text-xs text-gray-400 mt-1\">\r\n                            Start typing to search from verified equipment database\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"border-t dark:border-gray-700 pt-4 space-y-4\">\r\n                        <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3\">\r\n                            <p className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2\">\r\n                                Or enter manually:\r\n                            </p>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Brand</label>\r\n                                <input\r\n                                    value={formData.brand}\r\n                                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"e.g. Neumann\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Model *</label>\r\n                                <input\r\n                                    value={formData.model || formData.name}\r\n                                    onChange={(e) => setFormData({ ...formData, model: e.target.value, name: e.target.value })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"e.g. U87\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Category</label>\r\n                            <select\r\n                                value={formData.category}\r\n                                onChange={(e) => setFormData({ ...formData, category: e.target.value })}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                            >\r\n                                <option value=\"\">Select category...</option>\r\n                                {EQUIP_CATEGORIES.map(cat => (\r\n                                    <option key={cat.id} value={cat.id}>{cat.label}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-3 gap-4\">\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Quantity</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    min=\"1\"\r\n                                    value={formData.quantity || 1}\r\n                                    onChange={(e) => setFormData({ ...formData, quantity: parseInt(e.target.value) || 1 })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"1\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Serial Number</label>\r\n                                <input\r\n                                    value={formData.serial}\r\n                                    onChange={(e) => setFormData({ ...formData, serial: e.target.value })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"Optional\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Value ($)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.value}\r\n                                    onChange={(e) => setFormData({ ...formData, value: e.target.value })}\r\n                                    className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                    placeholder=\"Estimated value\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Notes</label>\r\n                            <textarea\r\n                                value={formData.notes}\r\n                                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                                className=\"w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\"\r\n                                rows={2}\r\n                                placeholder=\"Additional details...\"\r\n                            />\r\n                        </div>\r\n\r\n                        <label className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-[#1f2128] rounded-xl cursor-pointer\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                checked={formData.featured}\r\n                                onChange={(e) => setFormData({ ...formData, featured: e.target.checked })}\r\n                                className=\"w-4 h-4 text-brand-blue rounded\"\r\n                            />\r\n                            <div>\r\n                                <div className=\"font-medium dark:text-white text-sm\">Featured Equipment</div>\r\n                                <div className=\"text-xs text-gray-500\">Highlight this item on your studio profile</div>\r\n                            </div>\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n                <div className=\"p-4 border-t dark:border-gray-700 flex justify-end gap-3\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-5 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl font-medium\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button\r\n                        onClick={handleSubmit}\r\n                        disabled={saving}\r\n                        className=\"px-6 py-2.5 bg-brand-blue text-white rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 disabled:opacity-50\"\r\n                    >\r\n                        {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                        {item ? 'Update' : 'Add Item'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import { useState } from 'react';\r\nimport { \r\n    Settings, Save, Loader2, Home, MapPin, Mail,\r\n    Wifi, Shield, EyeOff\r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport { useForm, Controller } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport * as z from 'zod';\r\nimport toast from 'react-hot-toast';\r\nimport AddressAutocomplete from '../shared/AddressAutocomplete';\r\nimport { AMENITIES_DATA } from '../../config/constants';\r\n\r\nconst settingsSchema = z.object({\r\n    studioName: z.string().min(3, \"Studio name is required\"),\r\n    address: z.string().min(5, \"Address is required\"),\r\n    city: z.string().optional(),\r\n    state: z.string().optional(),\r\n    zip: z.string().optional(),\r\n    lat: z.number().optional(),\r\n    lng: z.number().optional(),\r\n    studioDescription: z.string().max(1000).optional(),\r\n    email: z.string().email().optional().or(z.literal('')),\r\n    phoneCell: z.string().optional(),\r\n    phoneLand: z.string().optional(),\r\n    website: z.string().url().optional().or(z.literal('')),\r\n    hours: z.string().optional(),\r\n    amenities: z.array(z.string()).optional(),\r\n    hideAddress: z.boolean().optional(),\r\n});\r\n\r\n/**\r\n * StudioSettings - Basic studio information and contact settings\r\n */\r\nexport default function StudioSettings({ user, userData, onUpdate }) {\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    const {\r\n        register,\r\n        control,\r\n        handleSubmit,\r\n        watch,\r\n        setValue,\r\n        formState: { errors, isDirty }\r\n    } = useForm({\r\n        resolver: zodResolver(settingsSchema),\r\n        defaultValues: {\r\n            studioName: userData?.studioName || userData?.profileName || '',\r\n            address: userData?.address || '',\r\n            city: userData?.city || '',\r\n            state: userData?.state || '',\r\n            zip: userData?.zip || '',\r\n            lat: userData?.lat,\r\n            lng: userData?.lng,\r\n            studioDescription: userData?.studioDescription || '',\r\n            email: userData?.email || '',\r\n            phoneCell: userData?.phoneCell || '',\r\n            phoneLand: userData?.phoneLand || '',\r\n            website: userData?.website || '',\r\n            hours: userData?.hours || '',\r\n            amenities: userData?.amenities || [],\r\n            hideAddress: userData?.hideAddress || false,\r\n        }\r\n    });\r\n\r\n    const watchedAmenities = watch(\"amenities\");\r\n    const watchHideAddress = watch(\"hideAddress\");\r\n\r\n    const toggleAmenity = (amenity) => {\r\n        const current = watchedAmenities || [];\r\n        if (current.includes(amenity)) {\r\n            setValue('amenities', current.filter(a => a !== amenity), { shouldDirty: true });\r\n        } else {\r\n            setValue('amenities', [...current, amenity], { shouldDirty: true });\r\n        }\r\n    };\r\n\r\n    const onSubmit = async (data) => {\r\n        if (!supabase) return;\r\n        setSaving(true);\r\n        const toastId = toast.loading('Saving settings...');\r\n\r\n        try {\r\n            const userId = user?.id || user?.uid;\r\n            await supabase\r\n                .from('profiles')\r\n                .update({\r\n                    studio_name: data.studioName,\r\n                    profile_name: data.studioName,\r\n                    address: data.address,\r\n                    city: data.city,\r\n                    state: data.state,\r\n                    zip: data.zip,\r\n                    lat: data.lat,\r\n                    lng: data.lng,\r\n                    studio_description: data.studioDescription,\r\n                    email: data.email,\r\n                    phone_cell: data.phoneCell,\r\n                    phone_land: data.phoneLand,\r\n                    website: data.website,\r\n                    hours: data.hours,\r\n                    amenities: data.amenities,\r\n                    hide_address: data.hideAddress,\r\n                    is_studio: true,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', userId);\r\n            \r\n            if (error) throw error;\r\n            \r\n            toast.success(\"Settings saved!\", { id: toastId });\r\n            if (onUpdate) onUpdate(data);\r\n        } catch (error) {\r\n            console.error(\"Save failed\", error);\r\n            toast.error(\"Failed to save settings.\", { id: toastId });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const inputClass = (error) => `w-full p-3 border rounded-xl dark:bg-[#1f2128] dark:border-gray-600 dark:text-white transition-all focus:ring-2 focus:ring-brand-blue outline-none ${error ? 'border-red-500 bg-red-50 dark:bg-red-900/10' : 'border-gray-200'}`;\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Settings className=\"text-brand-blue\" size={24} />\r\n                        Studio Settings\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Basic information and contact details\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={saving || !isDirty}\r\n                    className={`px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 transition ${\r\n                        saving || !isDirty\r\n                            ? 'bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed'\r\n                            : 'bg-brand-blue text-white hover:bg-blue-600'\r\n                    }`}\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                    Save Changes\r\n                </button>\r\n            </div>\r\n\r\n            {/* Basic Info */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Home size={18} className=\"text-brand-blue\" />\r\n                    General Information\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"md:col-span-2\">\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Studio Name *</label>\r\n                        <input {...register(\"studioName\")} className={inputClass(errors.studioName)} placeholder=\"Your Studio Name\" />\r\n                        {errors.studioName && <p className=\"text-red-500 text-xs mt-1\">{errors.studioName.message}</p>}\r\n                    </div>\r\n                    <div className=\"md:col-span-2\">\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Description</label>\r\n                        <textarea \r\n                            {...register(\"studioDescription\")} \r\n                            rows={3} \r\n                            className={inputClass(errors.studioDescription)} \r\n                            placeholder=\"Describe your studio, the vibe, and what makes it special...\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Location */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <MapPin size={18} className=\"text-brand-blue\" />\r\n                    Location\r\n                </h3>\r\n                \r\n                {/* Privacy Toggle */}\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800 mb-4\">\r\n                    <label className=\"flex items-start gap-3 cursor-pointer\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            {...register(\"hideAddress\")}\r\n                            className=\"w-5 h-5 mt-0.5 text-brand-blue rounded\"\r\n                        />\r\n                        <div>\r\n                            <div className=\"font-bold text-gray-700 dark:text-gray-200 flex items-center gap-2\">\r\n                                <Shield size={16} className=\"text-brand-blue\" />\r\n                                Private Home Studio Mode\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                                Your exact address will be hidden from the public map. It will only be revealed after you approve a booking request.\r\n                            </p>\r\n                        </div>\r\n                    </label>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                    <Controller\r\n                        control={control}\r\n                        name=\"address\"\r\n                        render={({ field: { onChange, value } }) => (\r\n                            <AddressAutocomplete\r\n                                label=\"Street Address\"\r\n                                value={value || ''}\r\n                                onChange={onChange}\r\n                                onSelect={(addressData) => {\r\n                                    if (addressData.lat) setValue('lat', addressData.lat);\r\n                                    if (addressData.lng) setValue('lng', addressData.lng);\r\n                                    if (addressData.city) setValue('city', addressData.city, { shouldDirty: true });\r\n                                    if (addressData.state) setValue('state', addressData.state, { shouldDirty: true });\r\n                                    if (addressData.zip) setValue('zip', addressData.zip, { shouldDirty: true });\r\n                                }}\r\n                                placeholder=\"Start typing your address...\"\r\n                                error={errors.address?.message}\r\n                                required\r\n                            />\r\n                        )}\r\n                    />\r\n                    <div className=\"grid grid-cols-3 gap-4\">\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">City</label>\r\n                            <input {...register(\"city\")} className={inputClass()} placeholder=\"City\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">State</label>\r\n                            <input {...register(\"state\")} className={inputClass()} placeholder=\"State\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">ZIP</label>\r\n                            <input {...register(\"zip\")} className={inputClass()} placeholder=\"ZIP Code\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {watchHideAddress && (\r\n                    <div className=\"mt-4 flex items-center gap-2 text-sm text-amber-600 dark:text-amber-400\">\r\n                        <EyeOff size={16} />\r\n                        <span>Address will be hidden until booking approval</span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Contact */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Mail size={18} className=\"text-brand-blue\" />\r\n                    Contact Information\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Email</label>\r\n                        <input {...register(\"email\")} type=\"email\" className={inputClass(errors.email)} placeholder=\"studio@email.com\" />\r\n                        {errors.email && <p className=\"text-red-500 text-xs mt-1\">{errors.email.message}</p>}\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Website</label>\r\n                        <input {...register(\"website\")} className={inputClass(errors.website)} placeholder=\"https://yourstudio.com\" />\r\n                        {errors.website && <p className=\"text-red-500 text-xs mt-1\">{errors.website.message}</p>}\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Cell Phone</label>\r\n                        <input {...register(\"phoneCell\")} className={inputClass()} placeholder=\"(555) 123-4567\" />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Landline</label>\r\n                        <input {...register(\"phoneLand\")} className={inputClass()} placeholder=\"(555) 123-4567\" />\r\n                    </div>\r\n                    <div className=\"md:col-span-2\">\r\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Hours of Operation</label>\r\n                        <input {...register(\"hours\")} className={inputClass()} placeholder=\"e.g. Mon-Fri 9AM-10PM, Sat-Sun 10AM-8PM\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Amenities */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700\">\r\n                <h3 className=\"font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n                    <Wifi size={18} className=\"text-brand-blue\" />\r\n                    Amenities\r\n                </h3>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    {AMENITIES_DATA.map(amenity => (\r\n                        <button\r\n                            key={amenity}\r\n                            type=\"button\"\r\n                            onClick={() => toggleAmenity(amenity)}\r\n                            className={`px-3 py-2 rounded-lg text-sm font-medium transition-all border ${\r\n                                watchedAmenities?.includes(amenity)\r\n                                    ? \"bg-brand-blue text-white border-brand-blue shadow-md\"\r\n                                    : \"bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700\"\r\n                            }`}\r\n                        >\r\n                            {amenity}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Save Button (Bottom) */}\r\n            <div className=\"flex justify-end\">\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={saving || !isDirty}\r\n                    className={`px-8 py-3 rounded-xl font-bold text-lg flex items-center gap-2 transition shadow-lg ${\r\n                        saving || !isDirty\r\n                            ? 'bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed'\r\n                            : 'bg-brand-blue text-white hover:bg-blue-600 hover:scale-[1.01]'\r\n                    }`}\r\n                >\r\n                    {saving ? <Loader2 className=\"animate-spin\" size={20} /> : <Save size={20} />}\r\n                    Save Settings\r\n                </button>\r\n            </div>\r\n        </form>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { \r\n    Home, LayoutGrid, Image, Clock, FileText, Calendar, \r\n    Package, Settings, ChevronRight, Briefcase\r\n} from 'lucide-react';\r\nimport { supabase } from '../config/supabase';\r\n\r\n// Import sub-components\r\nimport StudioOverview from './studio/StudioOverview';\r\nimport StudioRooms from './studio/StudioRooms';\r\nimport StudioGallery from './studio/StudioGallery';\r\nimport StudioAvailability from './studio/StudioAvailability';\r\nimport StudioPolicies from './studio/StudioPolicies';\r\nimport StudioBookings from './studio/StudioBookings';\r\nimport StudioEquipment from './studio/StudioEquipment';\r\nimport StudioSettings from './studio/StudioSettings';\r\n\r\nconst TABS = [\r\n    { id: 'overview', label: 'Overview', icon: Home, description: 'Dashboard & quick stats' },\r\n    { id: 'rooms', label: 'Rooms', icon: LayoutGrid, description: 'Manage studio rooms' },\r\n    { id: 'equipment', label: 'Equipment', icon: Package, description: 'Equipment inventory' },\r\n    { id: 'gallery', label: 'Gallery', icon: Image, description: 'Photo gallery' },\r\n    { id: 'availability', label: 'Hours', icon: Clock, description: 'Operating hours' },\r\n    { id: 'policies', label: 'Policies', icon: FileText, description: 'Rules & pricing' },\r\n    { id: 'bookings', label: 'Bookings', icon: Calendar, description: 'Manage bookings' },\r\n    { id: 'settings', label: 'Settings', icon: Settings, description: 'Studio info' },\r\n];\r\n\r\n/**\r\n * StudioManager - Complete studio management interface with tabbed navigation\r\n */\r\nexport default function StudioManager({ user, userData }) {\r\n    const [activeTab, setActiveTab] = useState('overview');\r\n    const [stats, setStats] = useState({\r\n        pendingBookings: 0,\r\n        recentBookings: [],\r\n        totalRevenue: 0\r\n    });\r\n    const [localUserData, setLocalUserData] = useState(userData);\r\n\r\n    // Fetch booking stats\r\n    useEffect(() => {\r\n        const fetchStats = async () => {\r\n            if (!user?.id && !user?.uid || !supabase) return;\r\n            const userId = user.id || user.uid;\r\n            \r\n            try {\r\n                // Fetch bookings where user is the target OR studio_owner_id (studio owner receiving bookings)\r\n                const { data: bookings, error } = await supabase\r\n                    .from('bookings')\r\n                    .select('*')\r\n                    .or(`target_id.eq.${userId},studio_owner_id.eq.${userId}`)\r\n                    .order('date', { ascending: true });\r\n\r\n                if (error) throw error;\r\n\r\n                const pending = bookings.filter(b => b.status === 'Pending').length;\r\n                const recent = bookings\r\n                    .filter(b => {\r\n                        const bookingDate = new Date(b.date);\r\n                        return bookingDate >= new Date();\r\n                    })\r\n                    .sort((a, b) => new Date(a.date) - new Date(b.date))\r\n                    .slice(0, 5);\r\n                const revenue = bookings\r\n                    .filter(b => b.status === 'Completed')\r\n                    .reduce((sum, b) => sum + (b.offer_amount || 0), 0);\r\n\r\n                setStats({\r\n                    pendingBookings: pending,\r\n                    recentBookings: recent,\r\n                    totalRevenue: revenue\r\n                });\r\n            } catch (error) {\r\n                console.error('Error fetching stats:', error);\r\n            }\r\n        };\r\n\r\n        fetchStats();\r\n    }, [user?.id, user?.uid]);\r\n\r\n    // Handle updates from child components\r\n    const handleUpdate = (updates) => {\r\n        setLocalUserData(prev => ({ ...prev, ...updates }));\r\n    };\r\n\r\n    // Handle navigation from overview\r\n    const handleNavigate = (tabId) => {\r\n        setActiveTab(tabId);\r\n    };\r\n\r\n    const renderContent = () => {\r\n        const commonProps = {\r\n            user,\r\n            userData: localUserData,\r\n            onUpdate: handleUpdate\r\n        };\r\n\r\n        switch (activeTab) {\r\n            case 'overview':\r\n                return <StudioOverview {...commonProps} stats={stats} onNavigate={handleNavigate} />;\r\n            case 'rooms':\r\n                return <StudioRooms {...commonProps} />;\r\n            case 'equipment':\r\n                return <StudioEquipment {...commonProps} />;\r\n            case 'gallery':\r\n                return <StudioGallery {...commonProps} />;\r\n            case 'availability':\r\n                return <StudioAvailability {...commonProps} />;\r\n            case 'policies':\r\n                return <StudioPolicies {...commonProps} />;\r\n            case 'bookings':\r\n                return <StudioBookings {...commonProps} userData={localUserData} />;\r\n            case 'settings':\r\n                return <StudioSettings {...commonProps} />;\r\n            default:\r\n                return <StudioOverview {...commonProps} stats={stats} onNavigate={handleNavigate} />;\r\n        }\r\n    };\r\n\r\n    const activeTabInfo = TABS.find(t => t.id === activeTab);\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto pb-20\">\r\n            {/* Header */}\r\n            <div className=\"mb-6\">\r\n                <div className=\"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2\">\r\n                    <Briefcase size={14} />\r\n                    <span>Business Center</span>\r\n                    <ChevronRight size={14} />\r\n                    <span className=\"text-gray-700 dark:text-gray-200\">Studio Manager</span>\r\n                </div>\r\n                <h1 className=\"text-3xl font-bold dark:text-white flex items-center gap-3\">\r\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white\">\r\n                        <Home size={24} />\r\n                    </div>\r\n                    {localUserData?.studioName || localUserData?.profileName || 'Studio Manager'}\r\n                </h1>\r\n            </div>\r\n\r\n            {/* Tab Navigation */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 mb-6 overflow-hidden\">\r\n                <div className=\"flex overflow-x-auto scrollbar-hide\">\r\n                    {TABS.map((tab) => {\r\n                        const Icon = tab.icon;\r\n                        const isActive = activeTab === tab.id;\r\n                        const hasBadge = tab.id === 'bookings' && stats.pendingBookings > 0;\r\n                        \r\n                        return (\r\n                            <button\r\n                                key={tab.id}\r\n                                onClick={() => setActiveTab(tab.id)}\r\n                                className={`flex items-center gap-2 px-5 py-4 text-sm font-medium whitespace-nowrap transition-all border-b-2 relative ${\r\n                                    isActive\r\n                                        ? 'border-brand-blue text-brand-blue bg-blue-50 dark:bg-blue-900/20'\r\n                                        : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800'\r\n                                }`}\r\n                            >\r\n                                <Icon size={18} />\r\n                                {tab.label}\r\n                                {hasBadge && (\r\n                                    <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold\">\r\n                                        {stats.pendingBookings}\r\n                                    </span>\r\n                                )}\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tab Description (Mobile) */}\r\n            <div className=\"md:hidden mb-4 px-1\">\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                    {activeTabInfo?.description}\r\n                </p>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"min-h-[50vh]\">\r\n                {renderContent()}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport { \r\n    ChevronRight, ChevronLeft, Upload, Music, Image as ImageIcon, \r\n    CheckCircle, AlertCircle, Loader2, Info, X, Calendar \r\n} from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport { useMediaUpload } from '../../hooks/useMediaUpload';\r\nimport { DDEX_GENRES, DISTRIBUTION_STORES, RELEASE_TYPES } from '../../config/constants';\r\n\r\n// --- SUB-COMPONENTS FOR STEPS ---\r\n\r\nconst Step1Metadata = ({ data, setData }) => (\r\n    <div className=\"space-y-4 animate-in slide-in-from-right-4\">\r\n        <h3 className=\"text-lg font-bold dark:text-white mb-4\">Release Essentials</h3>\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Release Title</label>\r\n                <input className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.title} onChange={e => setData({...data, title: e.target.value})} placeholder=\"e.g. Dark Side of the Moon\"/>\r\n            </div>\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Primary Artist</label>\r\n                <input className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.primaryArtist} onChange={e => setData({...data, primaryArtist: e.target.value})} placeholder=\"e.g. Pink Floyd\"/>\r\n            </div>\r\n        </div>\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Release Type</label>\r\n                <select className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.type} onChange={e => setData({...data, type: e.target.value})}>\r\n                    {RELEASE_TYPES.map(t => <option key={t.id} value={t.id}>{t.label}</option>)}\r\n                </select>\r\n            </div>\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Primary Genre</label>\r\n                <select className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.genre} onChange={e => setData({...data, genre: e.target.value})}>\r\n                    <option value=\"\">Select Genre...</option>\r\n                    {DDEX_GENRES.map(g => <option key={g} value={g}>{g}</option>)}\r\n                </select>\r\n            </div>\r\n        </div>\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Release Date</label>\r\n                <input type=\"date\" className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.releaseDate} onChange={e => setData({...data, releaseDate: e.target.value})} />\r\n                <p className=\"text-[10px] text-gray-400 mt-1\">Standard: 2 weeks out. Express: 48hrs.</p>\r\n            </div>\r\n            <div>\r\n                <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Label Name</label>\r\n                <input className=\"w-full p-3 border rounded-lg dark:bg-[#1f2128] dark:border-gray-600 dark:text-white\" value={data.labelName} onChange={e => setData({...data, labelName: e.target.value})} placeholder=\"Optional (Default: Independent)\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst Step2Artwork = ({ data, setData, user }) => {\r\n    const { uploadMedia: uploadImage, uploading } = useMediaUpload(); \r\n    const [preview, setPreview] = useState(data.artworkUrl || null);\r\n    const [validationMsg, setValidationMsg] = useState('');\r\n\r\n    const handleFile = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        // Client-side Validation (3000px check)\r\n        const img = new Image();\r\n        img.src = URL.createObjectURL(file);\r\n        img.onload = async () => {\r\n            if (img.width < 3000 || img.height < 3000) {\r\n                setValidationMsg(\"Error: Image must be at least 3000 x 3000 pixels.\");\r\n                return;\r\n            }\r\n            if (img.width !== img.height) {\r\n                setValidationMsg(\"Warning: Image should be a perfect square (1:1 ratio).\");\r\n            } else {\r\n                setValidationMsg(\"\");\r\n            }\r\n\r\n            // Proceed to upload\r\n            const res = await uploadImage(file, `distribution/${user.uid}/artwork`);\r\n            if (res?.url) {\r\n                setPreview(res.url);\r\n                setData({ ...data, artworkUrl: res.url });\r\n            }\r\n        };\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center justify-center space-y-6 animate-in slide-in-from-right-4\">\r\n            <div className=\"text-center space-y-2\">\r\n                <h3 className=\"text-lg font-bold dark:text-white\">Upload Cover Art</h3>\r\n                <p className=\"text-sm text-gray-500\">3000 x 3000 px  JPG or PNG  No Blurry Text</p>\r\n            </div>\r\n\r\n            <div className=\"relative group w-64 h-64 bg-gray-100 dark:bg-[#1f2128] rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center overflow-hidden\">\r\n                {preview ? (\r\n                    <img src={preview} className=\"w-full h-full object-cover\" />\r\n                ) : (\r\n                    <div className=\"text-gray-400 flex flex-col items-center\">\r\n                        <ImageIcon size={48} className=\"mb-2\"/>\r\n                        <span className=\"text-xs font-bold\">Click to Upload</span>\r\n                    </div>\r\n                )}\r\n                \r\n                <label className=\"absolute inset-0 cursor-pointer bg-black/0 hover:bg-black/20 transition flex items-center justify-center\">\r\n                    <input type=\"file\" className=\"hidden\" accept=\"image/png, image/jpeg\" onChange={handleFile} disabled={uploading}/>\r\n                    {uploading && <Loader2 className=\"animate-spin text-white\" size={32}/>}\r\n                </label>\r\n            </div>\r\n\r\n            {validationMsg && (\r\n                <div className=\"text-red-500 text-sm font-bold flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg\">\r\n                    <AlertCircle size={16}/> {validationMsg}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst Step3Tracks = ({ data, setData, user }) => {\r\n    const { uploadMedia, uploading } = useMediaUpload();\r\n    \r\n    const addTrack = async (file) => {\r\n        if (!file.name.toLowerCase().endsWith('.wav')) {\r\n            alert(\"Only .WAV files are accepted for distribution.\");\r\n            return;\r\n        }\r\n\r\n        const newTrack = {\r\n            id: Date.now(),\r\n            title: file.name.replace('.wav', ''),\r\n            fileUrl: '', // Will be filled after upload\r\n            status: 'uploading',\r\n            isExplicit: false,\r\n            isInstrumental: false\r\n        };\r\n\r\n        // Optimistic UI\r\n        const updatedTracks = [...(data.tracks || []), newTrack];\r\n        setData({ ...data, tracks: updatedTracks });\r\n\r\n        // Start Upload\r\n        try {\r\n            // Upload to a private \"Vault\" path\r\n            const res = await uploadMedia(file, `distribution/${user.uid}/audio_vault`);\r\n            if (res?.url) {\r\n                const finalTracks = updatedTracks.map(t => \r\n                    t.id === newTrack.id ? { ...t, fileUrl: res.url, status: 'ready', duration: 0 } : t\r\n                );\r\n                setData({ ...data, tracks: finalTracks });\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Track upload failed\", e);\r\n            alert(\"Upload failed.\");\r\n        }\r\n    };\r\n\r\n    const removeTrack = (id) => {\r\n        setData({ ...data, tracks: data.tracks.filter(t => t.id !== id) });\r\n    };\r\n\r\n    const updateTrackMeta = (id, field, val) => {\r\n        setData({\r\n            ...data,\r\n            tracks: data.tracks.map(t => t.id === id ? { ...t, [field]: val } : t)\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in slide-in-from-right-4\">\r\n            <div className=\"flex justify-between items-end\">\r\n                <div>\r\n                    <h3 className=\"text-lg font-bold dark:text-white\">Upload Audio</h3>\r\n                    <p className=\"text-sm text-gray-500\">Stereo WAV files only (16-bit / 44.1kHz minimum)</p>\r\n                </div>\r\n                <label className=\"bg-brand-blue hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs cursor-pointer flex items-center gap-2 transition\">\r\n                    <Upload size={14}/> Add Track\r\n                    <input type=\"file\" className=\"hidden\" accept=\".wav\" onChange={e => addTrack(e.target.files[0])} disabled={uploading}/>\r\n                </label>\r\n            </div>\r\n\r\n            <div className=\"space-y-3\">\r\n                {data.tracks?.length === 0 && (\r\n                    <div className=\"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl text-gray-400\">\r\n                        No tracks added yet.\r\n                    </div>\r\n                )}\r\n                \r\n                {data.tracks?.map((track, idx) => (\r\n                    <div key={track.id} className=\"bg-white dark:bg-[#1f2128] p-4 rounded-xl border dark:border-gray-700 flex flex-col gap-3\">\r\n                        <div className=\"flex justify-between items-center\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"bg-gray-100 dark:bg-gray-800 p-2 rounded text-gray-500 font-mono text-xs\">\r\n                                    #{idx + 1}\r\n                                </div>\r\n                                <div className=\"font-bold dark:text-white text-sm\">\r\n                                    {track.status === 'uploading' ? <span className=\"flex items-center gap-2 text-brand-blue\"><Loader2 className=\"animate-spin\" size={14}/> Uploading...</span> : track.title}\r\n                                </div>\r\n                            </div>\r\n                            <button onClick={() => removeTrack(track.id)} className=\"text-gray-400 hover:text-red-500\"><X size={16}/></button>\r\n                        </div>\r\n                        \r\n                        {track.status === 'ready' && (\r\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                                <input \r\n                                    className=\"col-span-2 p-2 text-xs border rounded bg-transparent dark:border-gray-600 dark:text-white\" \r\n                                    placeholder=\"Track Title\" \r\n                                    value={track.title} \r\n                                    onChange={e => updateTrackMeta(track.id, 'title', e.target.value)}\r\n                                />\r\n                                <label className=\"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer\">\r\n                                    <input type=\"checkbox\" checked={track.isExplicit} onChange={e => updateTrackMeta(track.id, 'isExplicit', e.target.checked)}/> Explicit\r\n                                </label>\r\n                                <label className=\"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer\">\r\n                                    <input type=\"checkbox\" checked={track.isInstrumental} onChange={e => updateTrackMeta(track.id, 'isInstrumental', e.target.checked)}/> Instrumental\r\n                                </label>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst Step4Stores = ({ data, setData }) => {\r\n    const toggleStore = (storeId) => {\r\n        const current = data.stores || [];\r\n        const updated = current.includes(storeId) \r\n            ? current.filter(s => s !== storeId) \r\n            : [...current, storeId];\r\n        setData({ ...data, stores: updated });\r\n    };\r\n\r\n    const toggleAll = () => {\r\n        if (data.stores?.length === DISTRIBUTION_STORES.length) setData({ ...data, stores: [] });\r\n        else setData({ ...data, stores: DISTRIBUTION_STORES.map(s => s.id) });\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in slide-in-from-right-4\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <h3 className=\"text-lg font-bold dark:text-white\">Select Stores</h3>\r\n                <button onClick={toggleAll} className=\"text-xs font-bold text-brand-blue hover:underline\">\r\n                    {data.stores?.length === DISTRIBUTION_STORES.length ? 'Deselect All' : 'Select All'}\r\n                </button>\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\r\n                {DISTRIBUTION_STORES.map(store => {\r\n                    const isSelected = data.stores?.includes(store.id);\r\n                    return (\r\n                        <div \r\n                            key={store.id} \r\n                            onClick={() => toggleStore(store.id)}\r\n                            className={`p-3 rounded-xl border flex items-center gap-3 cursor-pointer transition-all ${isSelected ? 'bg-blue-50 border-brand-blue dark:bg-blue-900/20' : 'bg-white dark:bg-[#1f2128] dark:border-gray-700 hover:border-gray-300'}`}\r\n                        >\r\n                            <div className={`w-5 h-5 rounded-full border flex items-center justify-center ${isSelected ? 'bg-brand-blue border-brand-blue' : 'border-gray-400'}`}>\r\n                                {isSelected && <CheckCircle size={12} className=\"text-white\"/>}\r\n                            </div>\r\n                            <span className={`text-sm font-bold ${isSelected ? 'text-brand-blue dark:text-white' : 'text-gray-600 dark:text-gray-400'}`}>{store.name}</span>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n            \r\n            <div className=\"bg-yellow-50 dark:bg-yellow-900/10 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800 text-sm text-yellow-800 dark:text-yellow-200 flex items-start gap-3\">\r\n                <Info size={18} className=\"mt-0.5 shrink-0\"/>\r\n                <p>Deliveries usually take 2-5 days for Spotify/Apple, and up to 2 weeks for other stores. Please plan your release date accordingly.</p>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- MAIN WIZARD COMPONENT ---\r\n\r\nexport default function ReleaseBuilder({ user, userData, initialData, onCancel, onSuccess }) {\r\n    const [step, setStep] = useState(1);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    \r\n    // Initial State Template\r\n    const [formData, setFormData] = useState(initialData || {\r\n        title: '',\r\n        primaryArtist: userData ? `${userData.firstName || ''} ${userData.lastName || ''}`.trim() || 'Artist' : 'Artist', // Default to user\r\n        type: 'single',\r\n        genre: '',\r\n        releaseDate: '',\r\n        labelName: '',\r\n        artworkUrl: '',\r\n        tracks: [],\r\n        stores: DISTRIBUTION_STORES.map(s => s.id), // Default all selected\r\n        status: 'Draft'\r\n    });\r\n\r\n    const isStepValid = () => {\r\n        if (step === 1) return formData.title && formData.primaryArtist && formData.genre && formData.releaseDate;\r\n        if (step === 2) return !!formData.artworkUrl;\r\n        if (step === 3) return formData.tracks.length > 0 && formData.tracks.every(t => t.status === 'ready');\r\n        if (step === 4) return formData.stores.length > 0;\r\n        return true;\r\n    };\r\n\r\n    const handleFinalSubmit = async () => {\r\n        if (!supabase) return;\r\n        setSubmitting(true);\r\n        const userId = user?.id || user?.uid;\r\n        try {\r\n            const payload = {\r\n                uploader_id: userId,\r\n                title: formData.title,\r\n                primary_artist: formData.primaryArtist,\r\n                type: formData.type,\r\n                genre: formData.genre,\r\n                release_date: formData.releaseDate,\r\n                label_name: formData.labelName || null,\r\n                artwork_url: formData.artworkUrl || null,\r\n                tracks: formData.tracks || [],\r\n                updated_at: new Date().toISOString(),\r\n                status: 'Processing' // Move to processing queue\r\n            };\r\n\r\n            if (initialData?.id) {\r\n                // Update existing\r\n                await supabase\r\n                    .from('distribution_releases')\r\n                    .update(payload)\r\n                    .eq('id', initialData.id)\r\n                    .eq('uploader_id', userId);\r\n            } else {\r\n                // Create new\r\n                await supabase\r\n                    .from('distribution_releases')\r\n                    .insert({\r\n                        ...payload,\r\n                        created_at: new Date().toISOString()\r\n                    });\r\n            }\r\n            \r\n            alert(\"Release submitted successfully! It is now in the review queue.\");\r\n            onSuccess();\r\n        } catch (e) {\r\n            console.error(\"Submission error:\", e);\r\n            alert(\"Failed to submit release.\");\r\n        }\r\n        setSubmitting(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-4xl mx-auto bg-white dark:bg-[#2c2e36] rounded-2xl shadow-xl overflow-hidden border dark:border-gray-700 min-h-[600px] flex flex-col\">\r\n            {/* Header */}\r\n            <div className=\"bg-gray-50 dark:bg-[#23262f] p-6 border-b dark:border-gray-700 flex justify-between items-center\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-extrabold dark:text-white\">New Release</h2>\r\n                    <p className=\"text-xs text-gray-500 uppercase font-bold tracking-wider mt-1\">Step {step} of 4</p>\r\n                </div>\r\n                <button onClick={onCancel} className=\"text-gray-400 hover:text-gray-600 dark:hover:text-white\"><X/></button>\r\n            </div>\r\n\r\n            {/* Progress Bar */}\r\n            <div className=\"h-1 bg-gray-200 dark:bg-gray-700 w-full\">\r\n                <div className=\"h-full bg-brand-blue transition-all duration-300\" style={{ width: `${(step / 4) * 100}%` }}></div>\r\n            </div>\r\n\r\n            {/* Body */}\r\n            <div className=\"flex-1 p-8 overflow-y-auto\">\r\n                {step === 1 && <Step1Metadata data={formData} setData={setFormData} />}\r\n                {step === 2 && <Step2Artwork data={formData} setData={setFormData} user={user} />}\r\n                {step === 3 && <Step3Tracks data={formData} setData={setFormData} user={user} />}\r\n                {step === 4 && <Step4Stores data={formData} setData={setFormData} />}\r\n            </div>\r\n\r\n            {/* Footer Controls */}\r\n            <div className=\"p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f] flex justify-between items-center\">\r\n                {step > 1 ? (\r\n                    <button onClick={() => setStep(step - 1)} className=\"flex items-center gap-2 text-gray-500 font-bold hover:text-gray-800 dark:hover:text-white transition\">\r\n                        <ChevronLeft size={18}/> Back\r\n                    </button>\r\n                ) : <div></div>}\r\n\r\n                {step < 4 ? (\r\n                    <button \r\n                        onClick={() => setStep(step + 1)} \r\n                        disabled={!isStepValid()}\r\n                        className=\"bg-brand-blue text-white px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-600 transition\"\r\n                    >\r\n                        Next Step <ChevronRight size={18}/>\r\n                    </button>\r\n                ) : (\r\n                    <button \r\n                        onClick={handleFinalSubmit} \r\n                        disabled={submitting || !isStepValid()}\r\n                        className=\"bg-green-600 text-white px-8 py-2.5 rounded-xl font-bold flex items-center gap-2 disabled:opacity-50 hover:bg-green-700 transition shadow-lg\"\r\n                    >\r\n                        {submitting ? <Loader2 className=\"animate-spin\"/> : \"Submit Release\"}\r\n                    </button>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Plus, Disc, Globe, AlertCircle, CheckCircle, Clock, Edit2, Trash2, X, Music } from 'lucide-react';\r\nimport { supabase } from '../../config/supabase';\r\nimport ReleaseBuilder from '../distribution/ReleaseBuilder';\r\n\r\nexport default function DistributionManager({ user, userData }) {\r\n    const [view, setView] = useState('list'); // 'list' or 'create'\r\n    const [releases, setReleases] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [editingRelease, setEditingRelease] = useState(null);\r\n\r\n    // Fetch User's Releases\r\n    useEffect(() => {\r\n        if (!user?.id && !user?.uid || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        \r\n        // Query releases where the current user is the primary artist/uploader\r\n        const channel = supabase\r\n            .channel('distribution-releases')\r\n            .on('postgres_changes', {\r\n                event: '*',\r\n                schema: 'public',\r\n                table: 'distribution_releases',\r\n                filter: `uploader_id=eq.${userId}`\r\n            }, (payload) => {\r\n                loadReleases();\r\n            })\r\n            .subscribe();\r\n\r\n        loadReleases();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [user?.id, user?.uid]);\r\n\r\n    const loadReleases = async () => {\r\n        if (!supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n        setLoading(true);\r\n        try {\r\n            const { data: releasesData, error } = await supabase\r\n                .from('distribution_releases')\r\n                .select('*')\r\n                .eq('uploader_id', userId)\r\n                .order('updated_at', { ascending: false });\r\n            \r\n            if (error) throw error;\r\n            \r\n            setReleases((releasesData || []).map(r => ({\r\n                id: r.id,\r\n                ...r,\r\n                uploaderId: r.uploader_id,\r\n                updatedAt: r.updated_at,\r\n                createdAt: r.created_at\r\n            })));\r\n        } catch (error) {\r\n            console.error('Error loading releases:', error);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleDelete = async (releaseId, title) => {\r\n        if (!confirm(`Are you sure you want to delete \"${title}\"? This cannot be undone if already distributed.`) || !supabase) return;\r\n        try {\r\n            await supabase\r\n                .from('distribution_releases')\r\n                .delete()\r\n                .eq('id', releaseId);\r\n        } catch (e) {\r\n            console.error(e);\r\n            alert(\"Failed to delete release.\");\r\n        }\r\n    };\r\n\r\n    const handleEdit = (release) => {\r\n        if (release.status !== 'Draft' && release.status !== 'Action Needed') {\r\n            return alert(\"Cannot edit a release that is currently processing or live. Contact support for takedowns.\");\r\n        }\r\n        setEditingRelease(release);\r\n        setView('create');\r\n    };\r\n\r\n    // --- RENDER ---\r\n\r\n    if (view === 'create') {\r\n        return (\r\n            <ReleaseBuilder \r\n                user={user} \r\n                userData={userData} \r\n                initialData={editingRelease}\r\n                onCancel={() => { setView('list'); setEditingRelease(null); }} \r\n                onSuccess={() => { setView('list'); setEditingRelease(null); }}\r\n            />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto space-y-6 animate-in fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-end gap-4 bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold dark:text-white flex items-center gap-2\">\r\n                        <Globe className=\"text-brand-blue\" /> Distribution Portal\r\n                    </h2>\r\n                    <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Manage your catalog across Spotify, Apple Music, and 150+ stores.\r\n                    </p>\r\n                </div>\r\n                <button \r\n                    onClick={() => setView('create')} \r\n                    className=\"bg-brand-blue text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition flex items-center gap-2 shadow-lg hover:shadow-blue-500/20\"\r\n                >\r\n                    <Plus size={20} /> New Release\r\n                </button>\r\n            </div>\r\n\r\n            {/* Release List */}\r\n            <div className=\"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 overflow-hidden min-h-[400px]\">\r\n                {loading ? (\r\n                    <div className=\"p-12 text-center text-gray-500\">Loading catalog...</div>\r\n                ) : releases.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 text-center\">\r\n                        <div className=\"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4\">\r\n                            <Disc size={48} className=\"text-gray-400\" />\r\n                        </div>\r\n                        <h3 className=\"text-lg font-bold dark:text-white\">No Releases Yet</h3>\r\n                        <p className=\"text-gray-500 max-w-sm mt-2 mb-6\">Start your journey by uploading your first single, EP, or album to the world.</p>\r\n                        <button onClick={() => setView('create')} className=\"text-brand-blue font-bold hover:underline\">\r\n                            Create First Release\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y dark:divide-gray-700\">\r\n                        {releases.map(release => (\r\n                            <div key={release.id} className=\"p-5 hover:bg-gray-50 dark:hover:bg-white/5 transition flex flex-col md:flex-row md:items-center justify-between gap-4 group\">\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    {/* Artwork Thumbnail */}\r\n                                    <div className=\"h-16 w-16 bg-gray-200 dark:bg-black rounded-lg shadow-sm overflow-hidden shrink-0 border dark:border-gray-700\">\r\n                                        {release.artworkUrl ? (\r\n                                            <img src={release.artworkUrl} alt=\"Art\" className=\"h-full w-full object-cover\" />\r\n                                        ) : (\r\n                                            <div className=\"h-full w-full flex items-center justify-center text-gray-400\"><Music size={20}/></div>\r\n                                        )}\r\n                                    </div>\r\n                                    \r\n                                    {/* Meta */}\r\n                                    <div>\r\n                                        <div className=\"flex items-center gap-2 mb-1\">\r\n                                            <span className={`text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide border ${\r\n                                                release.status === 'Live' ? 'bg-green-100 text-green-700 border-green-200' :\r\n                                                release.status === 'Processing' ? 'bg-blue-100 text-blue-700 border-blue-200' :\r\n                                                release.status === 'Action Needed' ? 'bg-red-100 text-red-700 border-red-200' :\r\n                                                'bg-gray-100 text-gray-600 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600'\r\n                                            }`}>\r\n                                                {release.status}\r\n                                            </span>\r\n                                            <span className=\"text-xs text-gray-400 uppercase font-bold\">{release.type}</span>\r\n                                        </div>\r\n                                        <h4 className=\"font-bold text-lg dark:text-white leading-tight\">{release.title || 'Untitled Release'}</h4>\r\n                                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                                            {release.primaryArtist}  {release.tracks?.length || 0} Tracks\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Actions */}\r\n                                <div className=\"flex items-center gap-4 pl-4 md:pl-0 border-l md:border-l-0 dark:border-gray-700\">\r\n                                    <div className=\"text-right hidden md:block mr-4\">\r\n                                        <div className=\"text-xs text-gray-400 uppercase font-bold\">Release Date</div>\r\n                                        <div className=\"text-sm font-medium dark:text-gray-200\">\r\n                                            {release.releaseDate ? new Date(release.releaseDate).toLocaleDateString() : 'TBD'}\r\n                                        </div>\r\n                                    </div>\r\n                                    \r\n                                    <button \r\n                                        onClick={() => handleEdit(release)}\r\n                                        className=\"p-2 text-gray-400 hover:text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                        title=\"Edit / View Details\"\r\n                                    >\r\n                                        <Edit2 size={18}/>\r\n                                    </button>\r\n                                    \r\n                                    {(release.status === 'Draft' || release.status === 'Action Needed') && (\r\n                                        <button \r\n                                            onClick={() => handleDelete(release.id, release.title)}\r\n                                            className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                                            title=\"Delete Release\"\r\n                                        >\r\n                                            <Trash2 size={18}/>\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React from 'react';\r\nimport { Users, Disc, DollarSign, Activity, ChevronRight } from 'lucide-react';\r\n\r\n/**\r\n * LabelOverviewCard - Displays label metrics in the Business Overview\r\n *\r\n * Shows:\r\n * - Total Artists\r\n * - Active Releases\r\n * - Total Revenue\r\n * - Total Streams\r\n */\r\nexport default function LabelOverviewCard({ data, onNavigate }) {\r\n  const formatCurrency = (value) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD',\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 0,\r\n    }).format(value || 0);\r\n  };\r\n\r\n  const formatNumber = (value) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      notation: 'compact',\r\n      maximumFractionDigits: 1,\r\n    }).format(value || 0);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-xl font-bold dark:text-white\">Label Overview</h2>\r\n        <button\r\n          onClick={() => onNavigate && onNavigate('roster')}\r\n          className=\"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1\"\r\n        >\r\n          View Details <ChevronRight size={16} />\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 mb-2\">\r\n            <Users className=\"text-blue-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.total_artists || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Artists</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 mb-2\">\r\n            <Disc className=\"text-purple-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.active_releases || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Releases</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2\">\r\n            <DollarSign className=\"text-green-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{formatCurrency(data?.total_revenue)}</div>\r\n          <div className=\"text-xs text-gray-500\">Revenue</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-orange-50 dark:bg-orange-900/20 mb-2\">\r\n            <Activity className=\"text-orange-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{formatNumber(data?.total_streams)}</div>\r\n          <div className=\"text-xs text-gray-500\">Streams</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Home, Calendar, CheckCircle, ChevronRight } from 'lucide-react';\r\n\r\n/**\r\n * StudioOverviewCard - Displays studio metrics in the Business Overview\r\n *\r\n * Shows:\r\n * - Total Rooms\r\n * - Pending Bookings\r\n * - Completed Bookings\r\n */\r\nexport default function StudioOverviewCard({ data, onNavigate }) {\r\n  return (\r\n    <div className=\"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-xl font-bold dark:text-white\">Studio Overview</h2>\r\n        <button\r\n          onClick={() => onNavigate && onNavigate('studio')}\r\n          className=\"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1\"\r\n        >\r\n          View Details <ChevronRight size={16} />\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-3 gap-4\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 mb-2\">\r\n            <Home className=\"text-blue-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.total_rooms || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Rooms</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-yellow-50 dark:bg-yellow-900/20 mb-2\">\r\n            <Calendar className=\"text-yellow-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.pending_bookings || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Pending</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2\">\r\n            <CheckCircle className=\"text-green-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.completed_bookings || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Completed</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Disc, Play, FileText, ChevronRight } from 'lucide-react';\r\n\r\n/**\r\n * DistributionOverviewCard - Displays distribution metrics in the Business Overview\r\n *\r\n * Shows:\r\n * - Total Releases\r\n * - Live Releases\r\n * - Draft Releases\r\n */\r\nexport default function DistributionOverviewCard({ data, onNavigate }) {\r\n  return (\r\n    <div className=\"bg-white dark:bg-[#2c2e36] rounded-2xl border dark:border-gray-700 p-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-xl font-bold dark:text-white\">Distribution Overview</h2>\r\n        <button\r\n          onClick={() => onNavigate && onNavigate('distribution')}\r\n          className=\"text-brand-blue hover:text-blue-600 text-sm flex items-center gap-1\"\r\n        >\r\n          View Details <ChevronRight size={16} />\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-3 gap-4\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 mb-2\">\r\n            <Disc className=\"text-purple-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.total_releases || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Total</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-green-50 dark:bg-green-900/20 mb-2\">\r\n            <Play className=\"text-green-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.live_releases || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Live</div>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-flex p-3 rounded-xl bg-gray-50 dark:bg-gray-900/20 mb-2\">\r\n            <FileText className=\"text-gray-600\" size={24} />\r\n          </div>\r\n          <div className=\"text-2xl font-bold dark:text-white\">{data?.draft_releases || 0}</div>\r\n          <div className=\"text-xs text-gray-500\">Drafts</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { getLabelMetrics, getStudioMetrics, getDistributionMetrics } from '../../config/neonQueries';\r\nimport LabelOverviewCard from './LabelOverviewCard';\r\nimport StudioOverviewCard from './StudioOverviewCard';\r\nimport DistributionOverviewCard from './DistributionOverviewCard';\r\nimport { Briefcase, Settings2 } from 'lucide-react';\r\n\r\n/**\r\n * BusinessOverview - Enhanced overview with real-time metrics for each business type\r\n *\r\n * Displays sectioned metrics for:\r\n * - Label operations (artists, releases, revenue, streams)\r\n * - Studio operations (rooms, bookings)\r\n * - Distribution (releases)\r\n */\r\nexport default function BusinessOverview({ user, userData, setActiveTab }) {\r\n  const [metrics, setMetrics] = useState({});\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Determine which features the user has access to\r\n  const isStudio = userData?.accountTypes?.includes('Studio');\r\n  const isLabel = userData?.accountTypes?.some(t => ['Label', 'Agent'].includes(t));\r\n  const isArtist = userData?.accountTypes?.some(t => ['Talent', 'Producer', 'Engineer'].includes(t));\r\n  const hasDistribution = isStudio || isLabel || isArtist;\r\n\r\n  useEffect(() => {\r\n    const fetchMetrics = async () => {\r\n      const userId = user?.id || user?.uid;\r\n      if (!userId) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      const results = {};\r\n\r\n      try {\r\n        // Fetch metrics based on account types\r\n        if (isLabel) {\r\n          const labelData = await getLabelMetrics(userId);\r\n          results.label = labelData?.[0] || {};\r\n        }\r\n\r\n        if (isStudio) {\r\n          const studioData = await getStudioMetrics(userId);\r\n          results.studio = studioData?.[0] || {};\r\n        }\r\n\r\n        if (hasDistribution) {\r\n          const distData = await getDistributionMetrics(userId);\r\n          results.distribution = distData?.[0] || {};\r\n        }\r\n\r\n        setMetrics(results);\r\n      } catch (error) {\r\n        console.error('Error fetching business metrics:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchMetrics();\r\n  }, [user?.id, user?.uid, isLabel, isStudio, hasDistribution]);\r\n\r\n  // Quick actions based on roles\r\n  const quickActions = [\r\n    {\r\n      id: 'studio',\r\n      title: 'Studio Settings',\r\n      description: 'Configure your studio rooms, rates, and amenities',\r\n      icon: 'Home',\r\n      color: 'blue',\r\n      show: isStudio\r\n    },\r\n    {\r\n      id: 'distribution',\r\n      title: 'New Release',\r\n      description: 'Distribute your music to 150+ streaming platforms',\r\n      icon: 'Globe',\r\n      color: 'green',\r\n      show: hasDistribution\r\n    },\r\n    {\r\n      id: 'roster',\r\n      title: 'Manage Roster',\r\n      description: 'Sign artists and manage your label roster',\r\n      icon: 'Users',\r\n      color: 'purple',\r\n      show: isLabel\r\n    },\r\n  ].filter(a => a.show);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center p-12\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 animate-in fade-in\">\r\n      {/* Welcome Header */}\r\n      <div className=\"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-8 text-white relative overflow-hidden\">\r\n        <div className=\"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10\"></div>\r\n        <div className=\"relative z-10\">\r\n          <h1 className=\"text-3xl font-bold mb-2\">Business Center</h1>\r\n          <p className=\"text-indigo-100 max-w-xl\">\r\n            Manage your studio operations, distribute music, and grow your roster  all in one place.\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Sectioned Metrics */}\r\n      {isLabel && (\r\n        <LabelOverviewCard data={metrics.label} onNavigate={setActiveTab} />\r\n      )}\r\n\r\n      {isStudio && (\r\n        <StudioOverviewCard data={metrics.studio} onNavigate={setActiveTab} />\r\n      )}\r\n\r\n      {hasDistribution && (\r\n        <DistributionOverviewCard data={metrics.distribution} onNavigate={setActiveTab} />\r\n      )}\r\n\r\n      {/* Quick Actions */}\r\n      {quickActions.length > 0 && (\r\n        <div>\r\n          <h2 className=\"text-lg font-bold dark:text-white mb-4 flex items-center gap-2\">\r\n            <Settings2 size={20} className=\"text-gray-400\" />\r\n            Quick Actions\r\n          </h2>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            {quickActions.map(action => (\r\n              <button\r\n                key={action.id}\r\n                onClick={() => setActiveTab(action.id)}\r\n                className=\"bg-white dark:bg-[#2c2e36] p-6 rounded-xl border dark:border-gray-700 shadow-sm hover:shadow-md transition-all text-left group hover:border-brand-blue dark:hover:border-brand-blue\"\r\n              >\r\n                <h3 className=\"font-bold dark:text-white mb-1 flex items-center gap-2\">\r\n                  {action.title}\r\n                </h3>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                  {action.description}\r\n                </p>\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* No Business Features Message */}\r\n      {quickActions.length === 0 && !isLabel && !isStudio && !hasDistribution && (\r\n        <div className=\"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-12 text-center\">\r\n          <div className=\"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n            <Briefcase size={32} className=\"text-gray-400\" />\r\n          </div>\r\n          <h3 className=\"text-xl font-bold dark:text-white mb-2\">No Business Features Enabled</h3>\r\n          <p className=\"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6\">\r\n            Upgrade your account to access studio management, music distribution, and label features.\r\n          </p>\r\n          <p className=\"text-sm text-gray-400\">\r\n            Update your profile to add \"Studio\", \"Talent\", \"Label\", or \"Agent\" account types.\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport {\r\n    Briefcase, Home, Globe, Users, ChevronRight,\r\n    Building2, Music2, BarChart3, Settings2\r\n} from 'lucide-react';\r\n\r\n// Import business components\r\nimport StudioManager from './StudioManager';\r\nimport LabelDashboard from './labels/LabelDashboard';\r\nimport DistributionManager from './marketplace/DistributionManager';\r\nimport BusinessOverview from './business/BusinessOverview';\r\n\r\n/**\r\n * BusinessCenter - Consolidated hub for all business-related features\r\n *\r\n * Tabs:\r\n * 1. Overview - Real-time metrics for each business type\r\n * 2. Studio Operations - Manage studio settings, rooms, amenities\r\n * 3. Distribution - Music distribution to streaming platforms\r\n * 4. Label/Roster - Manage artist roster (for labels/agents)\r\n */\r\nexport default function BusinessCenter({ user, userData }) {\r\n    const [activeTab, setActiveTab] = useState('overview');\r\n\r\n    // Determine which features the user has access to\r\n    const isStudio = userData?.accountTypes?.includes('Studio');\r\n    const isLabel = userData?.accountTypes?.some(t => ['Label', 'Agent'].includes(t));\r\n    const isArtist = userData?.accountTypes?.some(t => ['Talent', 'Producer', 'Engineer'].includes(t));\r\n\r\n    // Everyone with business features gets distribution access\r\n    const hasDistribution = isStudio || isLabel || isArtist;\r\n\r\n    // Build available tabs based on user roles\r\n    const tabs = [\r\n        {\r\n            id: 'overview',\r\n            label: 'Overview',\r\n            icon: Briefcase,\r\n            iconSize: 18,\r\n            available: true\r\n        },\r\n        {\r\n            id: 'studio',\r\n            label: 'Studio Ops',\r\n            icon: Home,\r\n            iconSize: 18,\r\n            available: isStudio,\r\n            description: 'Manage rooms, rates & amenities'\r\n        },\r\n        {\r\n            id: 'distribution',\r\n            label: 'Distribution',\r\n            icon: Globe,\r\n            iconSize: 18,\r\n            available: hasDistribution,\r\n            description: 'Release music to streaming platforms'\r\n        },\r\n        {\r\n            id: 'roster',\r\n            label: 'Label Manager',\r\n            icon: Users,\r\n            iconSize: 18,\r\n            available: isLabel,\r\n            description: 'Manage your signed artists'\r\n        },\r\n    ].filter(tab => tab.available);\r\n\r\n    // Render content based on active tab\r\n    const renderContent = () => {\r\n        switch (activeTab) {\r\n            case 'studio':\r\n                return <StudioManager user={user} userData={userData} />;\r\n            case 'distribution':\r\n                return <DistributionManager user={user} userData={userData} />;\r\n            case 'roster':\r\n                return <LabelDashboard user={user} userData={userData} />;\r\n            case 'overview':\r\n            default:\r\n                return <BusinessOverview user={user} userData={userData} setActiveTab={setActiveTab} />;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto pb-20\">\r\n            {/* Tab Navigation */}\r\n            <div className=\"mb-6 bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 p-1.5 flex flex-wrap gap-1 shadow-sm sticky top-0 z-10\">\r\n                {tabs.map(tab => {\r\n                    const IconComponent = tab.icon;\r\n                    return (\r\n                        <button\r\n                            key={tab.id}\r\n                            onClick={() => setActiveTab(tab.id)}\r\n                            className={`\r\n                                flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all\r\n                                ${activeTab === tab.id\r\n                                    ? 'bg-brand-blue text-white shadow-md'\r\n                                    : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                                }\r\n                            `}\r\n                        >\r\n                            <IconComponent size={tab.iconSize} />\r\n                            <span className=\"hidden sm:inline\">{tab.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Content Area */}\r\n            {renderContent()}\r\n        </div>\r\n    );\r\n}\r\n"],"file":"assets/BusinessCenter-Df4ByBkP.js"}