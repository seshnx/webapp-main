{"version":3,"file":"FollowButton-aMBc263g.js","sources":["../../src/hooks/useFollowSystem.js","../../src/components/social/FollowButton.jsx"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { supabase } from '../config/supabase';\r\n\r\n/**\r\n * Hook for managing the social follow system (Supabase Version)\r\n * @param {string} currentUserId - The authenticated user's ID\r\n */\r\nexport function useFollowSystem(currentUserId) {\r\n    const [following, setFollowing] = useState([]); // List of profiles current user follows\r\n    const [followers, setFollowers] = useState([]); // List of profiles following current user\r\n    const [stats, setStats] = useState({ followersCount: 0, followingCount: 0 });\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Fetch Helper: Get detailed profiles for a list of IDs\r\n    const fetchProfiles = async (userIds) => {\r\n        if (!userIds || userIds.length === 0) return [];\r\n        const { data, error } = await supabase\r\n            .from('profiles')\r\n            .select('id, first_name, last_name, avatar_url, active_role')\r\n            .in('id', userIds);\r\n        \r\n        if (error) {\r\n            console.error(\"Error fetching profiles:\", error);\r\n            return [];\r\n        }\r\n        \r\n        return data.map(p => ({\r\n            odId: p.id, // Keeping odId for compatibility with existing components\r\n            displayName: `${p.first_name || ''} ${p.last_name || ''}`.trim(),\r\n            photoURL: p.avatar_url,\r\n            role: p.active_role\r\n        }));\r\n    };\r\n\r\n    const loadData = useCallback(async () => {\r\n        if (!currentUserId || !supabase) return;\r\n\r\n        try {\r\n            // 1. Get IDs of who I follow\r\n            const { data: followingData } = await supabase\r\n                .from('follows')\r\n                .select('following_id')\r\n                .eq('follower_id', currentUserId);\r\n            \r\n            const followingIds = followingData?.map(f => f.following_id) || [];\r\n            const followingProfiles = await fetchProfiles(followingIds);\r\n            setFollowing(followingProfiles);\r\n\r\n            // 2. Get IDs of who follows me\r\n            const { data: followersData } = await supabase\r\n                .from('follows')\r\n                .select('follower_id')\r\n                .eq('following_id', currentUserId);\r\n            \r\n            const followerIds = followersData?.map(f => f.follower_id) || [];\r\n            const followerProfiles = await fetchProfiles(followerIds);\r\n            setFollowers(followerProfiles);\r\n\r\n            // 3. Stats\r\n            setStats({\r\n                followingCount: followingIds.length,\r\n                followersCount: followerIds.length\r\n            });\r\n            \r\n            setLoading(false);\r\n        } catch (err) {\r\n            console.error(\"Error loading follow data:\", err);\r\n            setLoading(false);\r\n        }\r\n    }, [currentUserId]);\r\n\r\n    // Initial Load & Realtime Subscription\r\n    useEffect(() => {\r\n        loadData();\r\n\r\n        if (!currentUserId || !supabase) return;\r\n\r\n        // Subscribe to changes in the 'follows' table that involve this user\r\n        const channel = supabase\r\n            .channel('public:follows')\r\n            .on('postgres_changes', { \r\n                event: '*', \r\n                schema: 'public', \r\n                table: 'follows',\r\n                filter: `follower_id=eq.${currentUserId}` \r\n            }, () => loadData())\r\n            .on('postgres_changes', { \r\n                event: '*', \r\n                schema: 'public', \r\n                table: 'follows',\r\n                filter: `following_id=eq.${currentUserId}` \r\n            }, () => loadData())\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [currentUserId, loadData]);\r\n\r\n    const isFollowing = useCallback((targetUserId) => {\r\n        return following.some(f => f.odId === targetUserId);\r\n    }, [following]);\r\n\r\n    const followUser = useCallback(async (targetUserId) => {\r\n        if (!currentUserId || !targetUserId || currentUserId === targetUserId) return;\r\n        \r\n        const { error } = await supabase\r\n            .from('follows')\r\n            .insert([{ follower_id: currentUserId, following_id: targetUserId }]);\r\n\r\n        if (error) {\r\n            console.error('Follow error:', error);\r\n            return { success: false, error };\r\n        }\r\n        \r\n        // Optimistic update\r\n        loadData();\r\n        return { success: true };\r\n    }, [currentUserId, loadData]);\r\n\r\n    const unfollowUser = useCallback(async (targetUserId) => {\r\n        if (!currentUserId || !targetUserId) return;\r\n\r\n        const { error } = await supabase\r\n            .from('follows')\r\n            .delete()\r\n            .match({ follower_id: currentUserId, following_id: targetUserId });\r\n\r\n        if (error) {\r\n            console.error('Unfollow error:', error);\r\n            return { success: false, error };\r\n        }\r\n\r\n        // Optimistic update\r\n        loadData();\r\n        return { success: true };\r\n    }, [currentUserId, loadData]);\r\n\r\n    const toggleFollow = useCallback(async (targetUserId) => {\r\n        if (isFollowing(targetUserId)) {\r\n            return unfollowUser(targetUserId);\r\n        } else {\r\n            return followUser(targetUserId);\r\n        }\r\n    }, [isFollowing, followUser, unfollowUser]);\r\n\r\n    const getFollowingIds = useCallback(() => {\r\n        return following.map(f => f.odId);\r\n    }, [following]);\r\n\r\n    return {\r\n        following,\r\n        followers,\r\n        stats,\r\n        loading,\r\n        isFollowing,\r\n        followUser,\r\n        unfollowUser,\r\n        toggleFollow,\r\n        getFollowingIds\r\n    };\r\n}\r\n\r\n/**\r\n * Hook for fetching social stats for a specific user (read-only)\r\n */\r\nexport function useUserSocialStats(userId) {\r\n    const [stats, setStats] = useState({ followersCount: 0, followingCount: 0 });\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!userId || !supabase) {\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const fetchStats = async () => {\r\n            const { count: followers } = await supabase\r\n                .from('follows')\r\n                .select('*', { count: 'exact', head: true })\r\n                .eq('following_id', userId);\r\n\r\n            const { count: following } = await supabase\r\n                .from('follows')\r\n                .select('*', { count: 'exact', head: true })\r\n                .eq('follower_id', userId);\r\n\r\n            setStats({\r\n                followersCount: followers || 0,\r\n                followingCount: following || 0\r\n            });\r\n            setLoading(false);\r\n        };\r\n\r\n        fetchStats();\r\n    }, [userId]);\r\n\r\n    return { stats, loading };\r\n}\r\n","import React, { useState } from 'react';\r\nimport { UserPlus, UserMinus, Loader2, UserCheck } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\n/**\r\n * Reusable Follow/Unfollow button component\r\n * @param {boolean} isFollowing - Whether current user follows target\r\n * @param {function} onToggle - Callback to toggle follow state\r\n * @param {string} size - 'sm' | 'md' | 'lg'\r\n * @param {string} variant - 'default' | 'outline' | 'minimal'\r\n * @param {boolean} disabled - Disable button (e.g., if viewing own profile)\r\n */\r\nexport default function FollowButton({ \r\n    isFollowing, \r\n    onToggle, \r\n    size = 'md', \r\n    variant = 'default',\r\n    disabled = false,\r\n    showIcon = true,\r\n    className = ''\r\n}) {\r\n    const [loading, setLoading] = useState(false);\r\n    const [isHovering, setIsHovering] = useState(false);\r\n\r\n    const handleClick = async (e) => {\r\n        e.stopPropagation();\r\n        if (disabled || loading) return;\r\n        \r\n        setLoading(true);\r\n        try {\r\n            await onToggle();\r\n        } catch (error) {\r\n            console.error('Follow toggle error:', error);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    // Size variants\r\n    const sizeClasses = {\r\n        sm: 'px-3 py-1 text-xs',\r\n        md: 'px-4 py-1.5 text-sm',\r\n        lg: 'px-6 py-2 text-base'\r\n    };\r\n\r\n    const iconSizes = {\r\n        sm: 12,\r\n        md: 14,\r\n        lg: 16\r\n    };\r\n\r\n    // Style variants\r\n    const getVariantClasses = () => {\r\n        if (isFollowing) {\r\n            // Following state - show unfollow on hover\r\n            if (variant === 'outline' || variant === 'minimal') {\r\n                return isHovering\r\n                    ? 'border-red-300 text-red-500 hover:bg-red-50 dark:border-red-800 dark:hover:bg-red-900/20'\r\n                    : 'border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300';\r\n            }\r\n            return isHovering\r\n                ? 'bg-red-500 text-white hover:bg-red-600'\r\n                : 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200';\r\n        } else {\r\n            // Not following - show follow\r\n            if (variant === 'outline') {\r\n                return 'border-brand-blue text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20';\r\n            }\r\n            if (variant === 'minimal') {\r\n                return 'text-brand-blue hover:bg-blue-50 dark:hover:bg-blue-900/20';\r\n            }\r\n            return 'bg-brand-blue text-white hover:bg-blue-600';\r\n        }\r\n    };\r\n\r\n    const baseClasses = `\r\n        font-semibold rounded-full transition-all duration-200 \r\n        flex items-center justify-center gap-1.5\r\n        disabled:opacity-50 disabled:cursor-not-allowed\r\n        ${variant === 'outline' ? 'border-2 bg-transparent' : ''}\r\n        ${variant === 'minimal' ? 'bg-transparent' : ''}\r\n        ${sizeClasses[size]}\r\n        ${getVariantClasses()}\r\n        ${className}\r\n    `;\r\n\r\n    const getIcon = () => {\r\n        if (loading) return <Loader2 className=\"animate-spin\" size={iconSizes[size]} />;\r\n        if (isFollowing) {\r\n            return isHovering \r\n                ? <UserMinus size={iconSizes[size]} />\r\n                : <UserCheck size={iconSizes[size]} />;\r\n        }\r\n        return <UserPlus size={iconSizes[size]} />;\r\n    };\r\n\r\n    const getText = () => {\r\n        if (isFollowing) {\r\n            return isHovering ? 'Unfollow' : 'Following';\r\n        }\r\n        return 'Follow';\r\n    };\r\n\r\n    return (\r\n        <motion.button\r\n            whileHover={{ scale: disabled ? 1 : 1.02 }}\r\n            whileTap={{ scale: disabled ? 1 : 0.98 }}\r\n            className={baseClasses}\r\n            onClick={handleClick}\r\n            onMouseEnter={() => setIsHovering(true)}\r\n            onMouseLeave={() => setIsHovering(false)}\r\n            disabled={disabled || loading}\r\n        >\r\n            <AnimatePresence mode=\"wait\">\r\n                <motion.span\r\n                    key={`${isFollowing}-${isHovering}`}\r\n                    initial={{ opacity: 0, y: -5 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    exit={{ opacity: 0, y: 5 }}\r\n                    transition={{ duration: 0.15 }}\r\n                    className=\"flex items-center gap-1.5\"\r\n                >\r\n                    {showIcon && getIcon()}\r\n                    <span>{getText()}</span>\r\n                </motion.span>\r\n            </AnimatePresence>\r\n        </motion.button>\r\n    );\r\n}\r\n\r\n/**\r\n * Compact follow button for use in lists/cards\r\n */\r\nexport function FollowButtonCompact({ isFollowing, onToggle, disabled }) {\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleClick = async (e) => {\r\n        e.stopPropagation();\r\n        if (disabled || loading) return;\r\n        setLoading(true);\r\n        try {\r\n            await onToggle();\r\n        } catch (error) {\r\n            console.error('Follow toggle error:', error);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    return (\r\n        <motion.button\r\n            whileTap={{ scale: 0.9 }}\r\n            onClick={handleClick}\r\n            disabled={disabled || loading}\r\n            className={`\r\n                p-2 rounded-full transition-all\r\n                ${isFollowing \r\n                    ? 'bg-gray-100 text-gray-600 hover:bg-red-50 hover:text-red-500 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-red-900/20' \r\n                    : 'bg-brand-blue text-white hover:bg-blue-600'\r\n                }\r\n                disabled:opacity-50\r\n            `}\r\n            title={isFollowing ? 'Unfollow' : 'Follow'}\r\n        >\r\n            {loading ? (\r\n                <Loader2 className=\"animate-spin\" size={16} />\r\n            ) : isFollowing ? (\r\n                <UserCheck size={16} />\r\n            ) : (\r\n                <UserPlus size={16} />\r\n            )}\r\n        </motion.button>\r\n    );\r\n}\r\n\r\n"],"names":["useFollowSystem","currentUserId","following","setFollowing","useState","followers","setFollowers","stats","setStats","loading","setLoading","loadData","useCallback","useEffect","isFollowing","targetUserId","f","followUser","error","supabase","unfollowUser","toggleFollow","getFollowingIds","useUserSocialStats","userId","FollowButton","onToggle","size","variant","disabled","showIcon","className","isHovering","setIsHovering","handleClick","e","sizeClasses","iconSizes","getVariantClasses","baseClasses","getIcon","jsx","Loader2","UserMinus","UserCheck","UserPlus","getText","motion","AnimatePresence","jsxs"],"mappings":"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"}