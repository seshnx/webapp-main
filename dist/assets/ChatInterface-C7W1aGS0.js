import{bI as N,bH as S,r as s,e as C,j as i}from"./vendor-DgLHK7fS.js";import{b as A,i as v,a as E,C as U,d as M,e as D}from"./chat-B_DYfz3i.js";import{m as w,A as $}from"./vendor-framer-Bk6jyNS8.js";function z({user:a,userData:m,openPublicProfile:j,pendingChatTarget:o,clearPendingChatTarget:d}){const h=N(),p=S(),[t,f]=s.useState(null),[b,y]=s.useState(!1);A(a==null?void 0:a.uid),s.useEffect(()=>{if(o&&(a!=null&&a.uid)){const e=[a.uid,o.uid].sort().join("_");x({id:e,uid:o.uid,name:o.name,type:"direct"}),d==null||d()}},[o,a==null?void 0:a.uid,d]);const u=v(),k=s.useMemo(()=>a!=null&&a.uid&&u?{userId:a.uid}:"skip",[a==null?void 0:a.uid,u]),r=C(E.conversations.getConversations,k),n=s.useMemo(()=>r?r.map(e=>({id:e.chatId,uid:e.otherUserId||e.chatId,name:e.chatName||"Unknown",n:e.chatName||"Unknown",photo:e.chatPhoto||"",type:e.chatType||"direct",lm:e.lastMessage||"",lmt:e.lastMessageTime||0,ls:e.lastSenderId||"",uc:e.unreadCount||0})).sort((e,c)=>(c.lmt||0)-(e.lmt||0)):[],[r]);s.useEffect(()=>{const e=h.pathname.split("/").filter(Boolean);if(e[0]==="messages"&&e[1]==="chat"&&e[2]){const c=e[2],l=n.find(I=>I.id===c);l&&(!t||t.id!==c)&&f({id:l.id,uid:l.uid,name:l.name,type:l.type})}else e[0]==="messages"&&(!e[1]||e[1]!=="chat")&&t&&f(null)},[h.pathname,n]);const x=e=>{f(e),e!=null&&e.id?p(`/messages/chat/${e.id}`,{replace:!0}):p("/messages",{replace:!0})};return s.useEffect(()=>{v()||console.warn("Convex is not available. Chat functionality is disabled.")},[]),i.jsxs("div",{className:"flex h-[calc(100vh-100px)] bg-white dark:bg-[#1f2128] rounded-2xl overflow-hidden border dark:border-gray-800 shadow-xl",children:[i.jsx(w.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`w-full md:w-80 border-r dark:border-gray-800 flex flex-col ${t?"hidden md:flex":"flex"}`,children:i.jsx(U,{user:a,userData:m,conversations:n,activeChat:t,onSelectChat:x})}),i.jsxs("div",{className:`flex-1 flex flex-col relative ${t?"flex":"hidden md:flex"}`,children:[i.jsx(M,{activeChat:t,user:a,userData:m,conversations:n,onBack:()=>x(null),toggleDetails:()=>y(!b),openPublicProfile:j}),i.jsx($,{children:b&&t&&i.jsx(w.div,{initial:{width:0,opacity:0},animate:{width:300,opacity:1},exit:{width:0,opacity:0},className:"border-l dark:border-gray-800 bg-gray-50 dark:bg-[#23262f] overflow-hidden relative z-20",children:i.jsx(D,{activeChat:t,currentUser:m,onClose:()=>y(!1)})})})]})]})}export{z as default};
