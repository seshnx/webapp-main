import{r as b,j as n,S as N,X as S,L as q}from"./vendor-Dl7DtIXW.js";import{s as v}from"./chat-BYF7Vx2D.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},d=new t.Error().stack;d&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[d]="5c9178a8-0210-42b9-81fb-6b4baeaf31d4",t._sentryDebugIdIdentifier="sentry-dbid-5c9178a8-0210-42b9-81fb-6b4baeaf31d4")})()}catch{}const D=()=>{const[t,d]=b.useState({}),[h,f]=b.useState(!0);return b.useEffect(()=>{(async()=>{if(!v){f(!1);return}f(!0);try{const{data:y,error:u}=await v.from("equipment_database").select("*").eq("verified",!0).order("category").order("subcategory").order("brand").order("name");if(u)throw u;const a={};(y||[]).forEach(e=>{const o=e.category||"Other",l=e.subcategory||"General";a[o]||(a[o]={}),a[o][l]||(a[o][l]=[]),a[o][l].push({id:e.id,name:e.name||e.model,brand:e.brand||"Unknown",model:e.model,category:o,subCategory:l,description:e.description,specifications:e.specifications,searchTokens:e.search_tokens||[],original:e})}),d(a)}catch(y){console.error("Failed to load equipment database:",y),d({})}f(!1)})()},[]),{loading:h,data:t}},L=()=>{const{data:t,loading:d}=D(),[h,f]=b.useState([]),i=b.useMemo(()=>{if(d||!t)return[];let u=[];try{Object.keys(t).forEach(a=>{const e=t[a];!e||typeof e!="object"||Object.entries(e).forEach(([o,l])=>{Array.isArray(l)&&l.forEach(s=>{if(!s||typeof s!="object")return;const g=s.brand||"Unknown",p=s.name||s.model||"Unknown Item",x=s.subCategory||o,w=s.searchTokens||[],k=[p,g,s.model,...w].filter(Boolean).join(" ").toLowerCase();u.push({id:s.id,name:p,brand:g,model:s.model||p,category:s.category||a,subCategory:x,searchString:k,original:s.original||s})})})})}catch(a){console.warn("Error processing equipment data:",a)}return u},[t,d]);return{searchEquipment:u=>{if(!u||u.trim().length<1){f([]);return}const a=u.toLowerCase().trim().split(/\s+/).filter(o=>o.length>0);if(a.length===0){f([]);return}const e=i.filter(o=>a.every(l=>o.searchString.includes(l))).slice(0,50);f(e)},results:h,loading:d}};function R({onSelect:t,placeholder:d="Search for gear (e.g. U87, SSL)...",className:h="",value:f,onChange:i,multi:y=!1}){const{searchEquipment:u,results:a,loading:e}=L(),[o,l]=b.useState(""),[s,g]=b.useState(!1),p=b.useRef(null),x=f!==void 0?f:o;b.useEffect(()=>{function r(c){p.current&&!p.current.contains(c.target)&&g(!1)}return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[p]);const w=r=>{const c=r.target.value;i?i(c):l(c);const m=y?c.split(",").pop().trim():c;m.length>=2?(u(m),g(!0)):g(!1)},k=r=>{const c=r.brand!=="Various"&&r.brand!=="Unknown"?`${r.brand} ${r.name}`:r.name;if(y){const m=x.split(",");m.pop();const j=[...m.map(E=>E.trim()).filter(Boolean),c].join(", ")+", ";i?i(j):l(j)}else t&&t({...r,fullName:c}),i?i(c):l(c);g(!1)};return n.jsxs("div",{ref:p,className:`relative ${h}`,children:[n.jsxs("div",{className:"relative",children:[n.jsx(N,{className:"absolute left-3 top-3 text-gray-400",size:16}),n.jsx("input",{className:"w-full pl-9 pr-8 p-3 text-sm border rounded-xl bg-white dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none transition-all",placeholder:d,value:x,onChange:w,onFocus:r=>w(r)}),x&&n.jsx("button",{type:"button",onClick:()=>{i?i(""):l(""),g(!1)},className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:n.jsx(S,{size:16})})]}),s&&a.length>0&&n.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-60 overflow-y-auto animate-in fade-in slide-in-from-top-2",children:n.jsx("div",{className:"py-1",children:a.map(r=>{var c;return n.jsxs("button",{type:"button",onClick:()=>k(r),className:"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group",children:[n.jsx("div",{className:"font-bold text-sm dark:text-white group-hover:text-brand-blue transition-colors",children:r.name}),n.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1.5 mt-0.5",children:[n.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:r.brand}),n.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600"}),n.jsx("span",{className:"opacity-75",children:(c=r.subCategory)==null?void 0:c.replace(/_/g," ")})]})]},r.id)})})}),s&&e&&n.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2",children:[n.jsx(q,{className:"animate-spin",size:16})," Searching database..."]})]})}export{R as E};
