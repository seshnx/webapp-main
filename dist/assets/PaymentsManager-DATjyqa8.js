import{r as m,j as e,b5 as j,b9 as C,L as v,b2 as M,h as _,Q as L,ah as D,b8 as R}from"./vendor-DTDDt3fP.js";import{A as w,G as N}from"./vendor-firebase-C38qHjbM.js";import{b as P,d as E,g as $}from"./chat-BCnoKXi-.js";import{f as I}from"./edu-Bzk_yg6o.js";import"./vendor-stripe-OXK3Micb.js";import"./vendor-convex-DiXsReyd.js";import"./vendor-framer-CzAUfL-F.js";const z=()=>{const[r,n]=m.useState({tierData:null,tokenPackages:null}),[d,y]=m.useState(!0),{DEFAULT_TIER_DATA:a,FALLBACK_TOKEN_PACKAGES:b}=m.useMemo(()=>({DEFAULT_TIER_DATA:{FREE:{name:"Free",price:0,feeMultiplier:1.2,features:["1 Broadcast Request / month","Cannot list on SeshFx Market"],limits:{broadcastsPerMonth:1,sessionsPerWeek:2,canListMarket:!1,monthlyTokens:0}},BASIC:{name:"Basic",price:4.99,feeMultiplier:1.1,features:["3 Broadcast Requests / month","10 Booked Sessions / week","Can list on SeshFx Market (5 items)"],limits:{broadcastsPerMonth:3,sessionsPerWeek:10,canListMarket:!0,monthlyTokens:25}},PRO:{name:"Pro Creative",price:14.99,feeMultiplier:1.02,features:["15 Broadcast Requests / month","Unlimited Booked Sessions","Profile Search Boost"],limits:{broadcastsPerMonth:15,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}},STUDIO:{name:"Studio Business",price:29.99,feeMultiplier:1,features:["Studio Manager Component Access","Unlimited Broadcast Requests","0% Session Fees"],limits:{broadcastsPerMonth:999,sessionsPerWeek:999,canListMarket:!0,monthlyTokens:100}}},FALLBACK_TOKEN_PACKAGES:[{id:"pack_small",tokens:100,price:4.99,label:"Starter Stash"},{id:"pack_medium",tokens:550,price:19.99,label:"Producer Pack",highlight:!0},{id:"pack_large",tokens:1200,price:39.99,label:"Studio Vault"}]}),[]);m.useEffect(()=>{const o=w(E,"artifacts",P,"public","config","subscriptions","tier_config"),g=N(o,l=>{let i=l.exists()?l.data():{};const p=Object.keys(a).reduce((f,k)=>(f[k]={...a[k],...i[k]},f),{});n(f=>({...f,tierData:p}))}),h=w(E,"artifacts",P,"public","config","subscriptions","token_packages"),u=N(h,l=>{let i=l.exists()?Object.values(l.data()):b;(!Array.isArray(i)||i.length===0)&&(i=b),n(p=>({...p,tokenPackages:i}))});return y(!1),()=>{g(),u()}},[a,b]);const c=o=>{var h,u;const g=((h=r.tierData)==null?void 0:h[o])||((u=r.tierData)==null?void 0:u.FREE);return g?g.feeMultiplier:a.FREE.feeMultiplier};return{tierData:r.tierData||a,tokenPackages:r.tokenPackages||b,loading:d,getFeeMultiplier:c}},K=async r=>{throw r<=0?new Error("No funds available to cash out."):new Error("Payout functionality is temporarily unavailable. Firebase Functions service is not configured.")};function Q({user:r,userData:n}){var A;const[d,y]=m.useState("store"),[a,b]=m.useState({balance:0,escrowBalance:0,payoutBalance:0}),[c,o]=m.useState(!1),{tierData:g,tokenPackages:h,loading:u}=z(),l=(n==null?void 0:n.currentTier)||I.FREE,i=(A=n==null?void 0:n.accountTypes)==null?void 0:A.some(t=>["Artist","Musician","Producer","Engineer","Studio","Composer","Technician","Label","Agent"].includes(t));m.useEffect(()=>{if(!(r!=null&&r.uid))return;const t=N(w(E,$(r.uid).userWallet),s=>{if(s.exists()){const x=s.data();b({balance:x.balance||0,escrowBalance:x.escrowBalance||0,payoutBalance:x.payoutBalance||0})}});return()=>t()},[r.uid]);const p=async(t,s="payment")=>{o(!0);try{throw new Error("Checkout functionality is temporarily unavailable. Firebase Functions service is not configured.")}catch(x){console.error("Checkout Error:",x),alert(`Checkout failed: ${x.message}`)}finally{o(!1)}},f=t=>{if(!t.stripePriceId)return alert("Configuration Error: This package is missing a Stripe Price ID.");p(t.stripePriceId,"payment")},k=t=>{if(!t.stripePriceId)return alert("Configuration Error: This plan is missing a Stripe Price ID.");p(t.stripePriceId,"subscription")},T=async()=>{if(i){if(a.payoutBalance<=0)return alert("No funds available for cash out.");if(window.confirm(`Cash out $${a.payoutBalance.toFixed(2)} to your connected account?`)){o(!0);try{await K(a.payoutBalance),alert("Cash out initiated! Funds should arrive in your bank account shortly.")}catch(t){alert(t.message)}finally{o(!1)}}}},F=Object.values(g).sort((t,s)=>t.id===l?-1:s.id===l?1:t.price-s.price),S=t=>{const s=(t-1)*100;return s>0?`+${s.toFixed(0)}% Service Fee`:s===0?"0% Service Fee":`-${Math.abs(s).toFixed(0)}% Fee (Discount)`};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 pb-24",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-extrabold dark:text-white flex items-center gap-2",children:[e.jsx(j,{size:32,className:"text-green-500"})," My Wallet"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage tokens, subscriptions, and earnings."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-500/10 rounded-full",children:e.jsx(C,{fill:"currentColor",className:"text-yellow-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Spending Tokens"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:[a.balance.toLocaleString()," TK"]})]})]}),i&&e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] px-5 py-3 rounded-2xl border dark:border-gray-700 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-full",children:e.jsx(j,{className:"text-green-500",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide",children:"Available USD"}),e.jsxs("div",{className:"font-mono font-extrabold text-xl dark:text-white leading-none",children:["$",a.payoutBalance.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 border-b dark:border-gray-700 mb-8 overflow-x-auto",children:[e.jsx("button",{onClick:()=>y("store"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${d==="store"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Token Store"}),e.jsx("button",{onClick:()=>y("plans"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${d==="plans"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Membership Plans"}),i&&e.jsx("button",{onClick:()=>y("earnings"),className:`pb-3 px-4 text-sm font-bold border-b-2 transition whitespace-nowrap ${d==="earnings"?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Earnings & Escrow"})]}),d==="store"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-blue to-purple-600 rounded-2xl p-8 text-white shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10 max-w-lg",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Power Up Your Creativity"}),e.jsx("p",{className:"opacity-90 mb-6",children:"Use tokens to buy beats, presets, booking requests, and more on the SeshFx Marketplace."})]}),e.jsx(C,{size:200,className:"absolute -right-10 -bottom-20 text-white opacity-10 rotate-12 pointer-events-none"})]}),u?e.jsx("div",{className:"text-center py-20",children:e.jsx(v,{className:"animate-spin text-brand-blue mx-auto",size:32})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(t=>e.jsxs("div",{className:`relative bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border transition-all duration-200 hover:-translate-y-1 hover:shadow-xl ${t.highlight?"border-yellow-500 ring-2 ring-yellow-500/20":"dark:border-gray-700"}`,children:[t.highlight&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-yellow-500 text-black text-[10px] font-extrabold px-3 py-1 rounded-full tracking-wide shadow-sm",children:"BEST VALUE"}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-widest mb-2",children:t.label}),e.jsxs("div",{className:"text-5xl font-extrabold dark:text-white flex items-center justify-center gap-1",children:[t.tokens,e.jsx("span",{className:"text-lg font-medium text-gray-400",children:"TK"})]})]}),e.jsx("button",{onClick:()=>f(t),disabled:c,className:`w-full py-3 rounded-xl font-bold flex justify-center items-center gap-2 transition-all ${t.highlight?"bg-yellow-500 text-black hover:bg-yellow-400":"bg-gray-900 dark:bg-white text-white dark:text-black hover:opacity-90"}`,children:c?e.jsx(v,{className:"animate-spin",size:18}):`Buy for $${t.price}`})]},t.id))})]}),d==="plans"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"text-center max-w-2xl mx-auto mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold dark:text-white mb-2",children:"Upgrade Your Workflow"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Unlock lower fees, unlimited bookings, and premium visibility."})]}),u?e.jsx("div",{className:"text-center py-10",children:e.jsx(v,{className:"animate-spin text-brand-blue mx-auto",size:24})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:F.map(t=>{const s=t.id===l;return e.jsxs("div",{className:`bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border flex flex-col ${s?"border-brand-blue ring-1 ring-brand-blue":"dark:border-gray-700"} shadow-sm`,children:[s&&e.jsxs("div",{className:"text-xs font-bold text-brand-blue uppercase tracking-wide mb-2 flex items-center gap-1",children:[e.jsx(M,{size:12,fill:"currentColor"})," Current Plan"]}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-1",children:t.name}),e.jsxs("div",{className:"text-3xl font-extrabold mb-6 dark:text-white",children:["$",t.price,e.jsx("span",{className:"text-sm font-normal text-gray-500",children:"/mo"})]}),e.jsxs("div",{className:"space-y-3 mb-8 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-gray-700 dark:text-gray-200",children:[e.jsx(j,{size:16,className:t.feeMultiplier<=1?"text-green-500":"text-gray-400"}),S(t.feeMultiplier)]}),t.features.map((x,B)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx(_,{size:14,className:"text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:x})]},B))]}),e.jsx("button",{onClick:()=>k(t),className:`w-full py-2.5 rounded-lg font-bold text-sm transition-colors mt-auto ${s?"bg-gray-100 dark:bg-gray-700 text-gray-400 cursor-default":"bg-brand-blue text-white hover:bg-blue-600 shadow-lg shadow-blue-500/20"}`,disabled:s||c,children:s?"Active":c?e.jsx(v,{className:"animate-spin mx-auto"}):"Upgrade"})]},t.id)})})]}),d==="earnings"&&i&&e.jsx("div",{className:"space-y-6 animate-in fade-in duration-300",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg",children:e.jsx(L,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Escrow Balance"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Funds held for active sessions"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold dark:text-white mb-4",children:["$",a.escrowBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("div",{className:"text-xs bg-orange-50 dark:bg-orange-900/10 text-orange-700 dark:text-orange-300 p-3 rounded-lg flex items-start gap-2",children:[e.jsx(D,{size:14,className:"mt-0.5 shrink-0"}),' Funds are released to "Available" 24 hours after a session is successfully completed.']})]}),e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border border-green-500/30 shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg",children:e.jsx(j,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white",children:"Available for Payout"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Cleared funds ready to transfer"})]})]}),e.jsxs("div",{className:"text-4xl font-extrabold text-green-600 dark:text-green-400 mb-6",children:["$",a.payoutBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx("button",{onClick:T,disabled:c||a.payoutBalance<=0,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-green-500/30 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:shadow-none",children:c?e.jsx(v,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:["Cash Out Now ",e.jsx(R,{size:20})]})}),e.jsx("div",{className:"text-[10px] text-center text-gray-400 mt-3",children:"Transfers handled securely via Stripe Connect."})]})]})})]})}export{Q as default};
