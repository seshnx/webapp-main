import{r as c,j as e,a as R,c9 as B,cA as E,X as $,V as D,L as C,S as P,Y as L,cm as V,cL as A,dc as F,y as M,dd as O,de as H,G,al as Y,bN as K,bM as J,aq as Q}from"./vendor-mIyI6DiM.js";import{SERVICE_CATALOGUE as T,TECH_SPECIALTIES as U,EQUIP_CATEGORIES as q}from"./config-VNvva2Pv.js";import{j as z}from"./chat-P1NCmzAv.js";import{E as W}from"./EquipmentAutocomplete-BdotCIX_.js";import{M as X,N as Z,O as ee,P as I,Q as ae,R as te,S as se,a as re}from"./index-BCKV8ync.js";import{M as le}from"./Inputs-DvD9MlMc.js";import"./vendor-framer-_HoVf1_M.js";import"./edu-V9buPGJB.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"local"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},i=new a.Error().stack;i&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[i]="23cd60ee-2a96-427c-87ba-ac43ace33c32",a._sentryDebugIdIdentifier="sentry-dbid-23cd60ee-2a96-427c-87ba-ac43ace33c32")})()}catch{}function de({user:a}){const[i,b]=c.useState([]),[n,g]=c.useState("All");return c.useEffect(()=>{if(!supabase)return;supabase.from("service_requests").select("*").order("created_at",{ascending:!1}).limit(50).then(({data:t,error:r})=>{if(r){console.error("Error fetching service requests:",r);return}b((t||[]).map(d=>({id:d.id,...d,timestamp:d.created_at,userId:d.user_id,userName:d.user_name})))});const o=supabase.channel("service-requests").on("postgres_changes",{event:"*",schema:"public",table:"service_requests"},async()=>{const{data:t}=await supabase.from("service_requests").select("*").order("created_at",{ascending:!1}).limit(50);t&&b(t.map(r=>({id:r.id,...r,timestamp:r.created_at,userId:r.user_id,userName:r.user_name})))}).subscribe();return()=>{supabase.removeChannel(o)}},[]),e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide mb-2",children:[e.jsx("button",{onClick:()=>g("All"),className:`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap border transition ${n==="All"?"bg-orange-500 text-white border-orange-600":"bg-white dark:bg-dark-card border-gray-200 dark:border-gray-700 dark:text-gray-300"}`,children:"All Jobs"}),T.map(o=>e.jsx("button",{onClick:()=>g(o.label),className:`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap border transition ${n===o.label?"bg-orange-500 text-white border-orange-600":"bg-white dark:bg-dark-card border-gray-200 dark:border-gray-700 dark:text-gray-300"}`,children:o.label},o.id))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.filter(o=>n==="All"||o.category===n).map(o=>e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 hover:border-orange-400 transition shadow-sm group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20 px-2 py-0.5 rounded",children:o.category}),o.budget&&e.jsxs("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:["$",o.budget]})]}),e.jsx("h3",{className:"font-bold text-lg dark:text-white mb-1",children:o.topic}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-4",children:o.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 border-t dark:border-gray-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:12})," ",o.userName]}),o.userId!==((a==null?void 0:a.id)||(a==null?void 0:a.uid))&&e.jsxs("button",{className:"bg-gray-900 dark:bg-white dark:text-black text-white px-3 py-1.5 rounded font-bold hover:opacity-80 flex items-center gap-1",children:[e.jsx(B,{size:12})," Message"]})]})]},o.id)),i.length===0&&e.jsx("div",{className:"col-span-full text-center py-12 text-gray-400",children:"No active requests."})]})]})}function ie({user:a,userData:i,target:b,onClose:n}){const[g,o]=c.useState(!1),[t,r]=c.useState({serviceCategory:"Repair",equipmentName:"",issueDescription:"",logistics:"Drop-off",preferredDate:"",budgetCap:""}),[d,f]=c.useState([]),{uploadMedia:l,uploading:m}=z(),j=async s=>{const u=s.target.files[0];if(!u)return;const p=await l(u,`tech_requests/${a.uid}`);p&&f(y=>[...y,p])},v=async()=>{if(!t.equipmentName||!t.issueDescription||!supabase){(!t.equipmentName||!t.issueDescription)&&alert("Please describe the equipment and the issue.");return}o(!0);const s=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{await supabase.from("bookings").insert({sender_id:s,sender_name:i&&`${i.firstName||""} ${i.lastName||""}`.trim()||"User",target_id:b.id,target_name:b.firstName?`${b.firstName} ${b.lastName}`:b.name,type:"TechRequest",service_type:t.serviceCategory,equipment:t.equipmentName,description:t.issueDescription,logistics:t.logistics,budget_cap:t.budgetCap||null,status:"Pending",date:t.preferredDate||"Flexible",message:`[${t.serviceCategory}] ${t.equipmentName}: ${t.issueDescription}`,attachments:d||[],timestamp:new Date().toISOString()}),alert("Service request sent!"),n()}catch{alert("Failed to send.")}o(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-in fade-in zoom-in-95",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(E,{size:18,className:"text-orange-500"})," Service Request"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Hiring ",e.jsxs("span",{className:"font-bold text-orange-600 dark:text-orange-400",children:[b.firstName," ",b.lastName]})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx($,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Type"}),e.jsx("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:t.serviceCategory,onChange:s=>r({...t,serviceCategory:s.target.value}),children:T.map(s=>e.jsx("option",{value:s.label,children:s.label},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Logistics"}),e.jsxs("select",{className:"w-full p-2.5 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:t.logistics,onChange:s=>r({...t,logistics:s.target.value}),children:[e.jsx("option",{value:"Drop-off",children:"I will drop it off"}),e.jsx("option",{value:"On-site",children:"Tech comes to me"}),e.jsx("option",{value:"Ship",children:"I will ship it"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Equipment"}),e.jsx(W,{placeholder:"Search for equipment (e.g. Fender Twin Reverb, U87)...",value:t.equipmentName,onChange:s=>r({...t,equipmentName:s}),onSelect:s=>{const u=s.brand!=="Various"&&s.brand!=="Unknown"?`${s.brand} ${s.name}`:s.name;r({...t,equipmentName:u})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Issue Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px] text-sm",placeholder:"Describe symptoms...",value:t.issueDescription,onChange:s=>r({...t,issueDescription:s.target.value})})]}),e.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-brand-blue hover:text-blue-600 font-bold mb-3",children:[e.jsx(D,{size:16})," Add Video/Photo ",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,video/*",onChange:j,disabled:m})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:d.map((s,u)=>e.jsx("div",{className:"h-12 w-12 bg-black rounded border dark:border-gray-600 overflow-hidden",children:e.jsx("img",{src:s.url,className:"h-full w-full object-cover"})},u))})]})]}),e.jsx("div",{className:"p-5 border-t dark:border-gray-700 bg-gray-50 dark:bg-[#23262f]",children:e.jsx("button",{onClick:v,disabled:g||m,className:"w-full bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition shadow-lg",children:g?e.jsx(C,{className:"animate-spin mx-auto"}):"Submit Request"})})]})})}function ne({user:a,userData:i,openPublicProfile:b}){const[n,g]=c.useState([]),[o,t]=c.useState(!1),[r,d]=c.useState(""),[f,l]=c.useState(""),[m,j]=c.useState(null),v=async()=>{if(!supabase)return;t(!0);const s=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{let u=supabase.from("profiles").select("id, first_name, last_name, photo_url, account_types, sub_roles, skills, rate, search_terms").contains("account_types",["Technician"]).limit(20);r&&(u=u.ilike("search_terms",`%${r.toLowerCase()}%`));const{data:p,error:y}=await u;if(y)throw y;let k=(p||[]).filter(x=>x.id!==s).map(x=>({id:x.id,firstName:x.first_name,lastName:x.last_name,photoURL:x.photo_url,accountTypes:x.account_types,subRoles:x.sub_roles,skills:x.skills,rate:x.rate,searchTerms:x.search_terms}));f&&(k=k.filter(x=>x.subRoles&&x.subRoles.includes(f))),g(k)}catch(u){console.error(u)}t(!1)};return c.useEffect(()=>{v()},[f]),e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{className:"absolute left-4 top-3.5 text-gray-400",size:18}),e.jsx("input",{className:"w-full pl-12 p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-orange-500 dark:text-white",placeholder:"Search technicians...",value:r,onChange:s=>d(s.target.value),onKeyDown:s=>s.key==="Enter"&&v()})]}),e.jsx("div",{className:"md:w-1/3",children:e.jsxs("select",{className:"w-full p-3 bg-white dark:bg-[#2c2e36] border dark:border-gray-700 rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-orange-500 dark:text-white cursor-pointer",value:f,onChange:s=>l(s.target.value),children:[e.jsx("option",{value:"",children:"All Specialties"}),U.map(s=>e.jsx("option",{value:s,children:s},s))]})})]}),o?e.jsx("div",{className:"text-center py-12",children:e.jsx(C,{className:"animate-spin mx-auto text-orange-500"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(s=>{var u,p,y;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] rounded-xl border dark:border-gray-700 overflow-hidden shadow-sm hover:shadow-lg transition group",children:[e.jsx("div",{className:"h-24 bg-gradient-to-r from-slate-700 to-slate-600 relative",children:e.jsx("div",{className:"absolute -bottom-8 left-6",children:e.jsx("div",{className:"h-16 w-16 rounded-full border-4 border-white dark:border-[#2c2e36] bg-gray-200 overflow-hidden",children:s.photoURL?e.jsx("img",{src:s.photoURL,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:e.jsx(R,{})})})})}),e.jsxs("div",{className:"pt-10 px-6 pb-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold dark:text-white text-lg",children:[s.firstName," ",s.lastName]}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 font-bold mb-2 flex items-center gap-1",children:[e.jsx(L,{size:12})," ",((u=s.subRoles)==null?void 0:u[0])||"Technician"]})]}),s.rate>0&&e.jsxs("div",{className:"text-sm font-bold dark:text-gray-300 border border-gray-200 dark:border-gray-600 px-2 py-1 rounded-lg",children:["$",s.rate,"/hr"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:(p=s.subRoles)==null?void 0:p.slice(0,3).map(k=>e.jsx("span",{className:"text-[10px] bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-200 px-2 py-0.5 rounded border border-orange-200 dark:border-orange-800",children:k},k))}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-4 h-6 overflow-hidden",children:(((y=s.skills)==null?void 0:y.split(","))||[]).slice(0,3).map((k,x)=>e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 pr-2 border-r border-gray-300 dark:border-gray-600 last:border-0",children:k.trim()},x))}),e.jsxs("div",{className:"flex gap-2 mt-auto",children:[e.jsx("button",{onClick:()=>b(s.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 rounded-lg text-xs font-bold transition",children:"Profile"}),e.jsxs("button",{onClick:()=>j(s),className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white py-2 rounded-lg text-xs font-bold transition shadow-sm flex items-center justify-center gap-1",children:[e.jsx(E,{size:14})," Request"]})]})]})]},s.id)})}),m&&e.jsx(ie,{user:a,userData:i,target:m,onClose:()=>j(null)})]})}function oe({user:a,userData:i,onSuccess:b,onCancel:n}){const[g,o]=c.useState(T[0].label),[t,r]=c.useState(""),[d,f]=c.useState("Normal"),[l,m]=c.useState(""),[j,v]=c.useState(""),[s,u]=c.useState(!1),[p,y]=c.useState(null),{uploadMedia:k,uploading:x}=z(),S=async h=>{const N=h.target.files[0];if(!N)return;const _=await k(N,`service_requests/${a.uid}`);_&&y(_)},w=async()=>{if(!t||!j||!supabase){(!t||!j)&&alert("Please complete the request.");return}u(!0);try{const h=(a==null?void 0:a.id)||(a==null?void 0:a.uid),{error:N}=await supabase.from("service_requests").insert({user_id:h,user_name:i&&`${i.firstName||""} ${i.lastName||""}`.trim()||"User",topic:`${g} for ${t}`,category:g,equipment:t,urgency:d,budget:l?parseInt(l):null,description:j,status:"Open",attachment_url:(p==null?void 0:p.url)||null});if(N)throw N;alert("Tech Request Broadcasted!"),b()}catch(h){console.error(h),alert("Failed: "+(h.message||"Unknown error"))}u(!1)};return e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-8 rounded-2xl border border-orange-200 dark:border-gray-700 shadow-xl animate-in zoom-in-95",children:[e.jsxs("h2",{className:"text-2xl font-extrabold dark:text-white mb-6 flex items-center gap-2 text-orange-600",children:[e.jsx(V,{})," Broadcast Tech Need"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-6 bg-orange-50 dark:bg-gray-800 rounded-xl border border-orange-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-lg font-medium text-gray-700 dark:text-gray-200",children:[e.jsx("span",{children:"I need"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:g,onChange:h=>o(h.target.value),className:"appearance-none bg-white dark:bg-gray-700 border border-orange-300 dark:border-orange-700 rounded-lg py-1 pl-3 pr-8 font-bold text-orange-700 dark:text-white focus:outline-none",children:T.map(h=>e.jsx("option",{value:h.label,children:h.label},h.id))}),e.jsx(A,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-orange-500 dark:text-white pointer-events-none"})]}),e.jsx("span",{children:"for my"}),e.jsx("input",{className:"bg-transparent border-b-2 border-orange-300 dark:border-orange-700 text-center w-40 font-bold focus:outline-none focus:border-orange-500 dark:text-white",placeholder:"Equipment Name",value:t,onChange:h=>r(h.target.value)})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Urgency"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:d,onChange:h=>f(h.target.value),children:[e.jsx("option",{children:"Normal"}),e.jsx("option",{children:"High (Session Blocked)"}),e.jsx("option",{children:"Emergency (24h)"}),e.jsx("option",{children:"Flexible"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Est. Budget ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",placeholder:"Optional",value:l,onChange:h=>m(h.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Details"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white min-h-[100px]",placeholder:"Describe the issue, specific model, symptoms...",value:j,onChange:h=>v(h.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Visual Reference"}),!p&&!x&&e.jsxs("label",{className:"flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition text-gray-500",children:[e.jsx(D,{size:20}),e.jsx("span",{className:"text-sm font-bold",children:"Upload Video or Image"}),e.jsx("input",{type:"file",className:"hidden",accept:"video/*,image/*",onChange:S})]}),p&&e.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden border dark:border-gray-700 bg-black",children:[p.type==="video"?e.jsx("video",{src:p.url,controls:!0,className:"w-full h-48 object-contain"}):e.jsx("img",{src:p.url,className:"w-full h-48 object-contain"}),e.jsx("button",{onClick:()=>y(null),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx($,{size:14})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:n,className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:s||x,className:"flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition flex items-center justify-center gap-2 disabled:opacity-50",children:s?e.jsx(C,{className:"animate-spin"}):"Broadcast Now"})]})]})]})}function ce({user:a,isTech:i}){const[b,n]=c.useState("feed"),[g,o]=c.useState([]),[t,r]=c.useState(!0);c.useEffect(()=>{d();const l=setInterval(d,3e4);return()=>clearInterval(l)},[a==null?void 0:a.id,a==null?void 0:a.uid]);const d=async()=>{r(!0);try{const l=await X(20);o(l.map(m=>({id:m.id,...m,submittedBy:m.submitted_by,timestamp:m.timestamp})))}catch(l){console.error("Error loading pending items:",l)}r(!1)},f=async(l,m,j)=>{var s,u,p;if(!i){alert("Only verified Technicians can vote on gear accuracy.");return}const v=(a==null?void 0:a.id)||(a==null?void 0:a.uid);try{const y=j.votes||{},k=y[m]||[];if(k.includes(v)){alert("You've already voted on this item.");return}const x={...y,[m]:[...k,v]};await Z(l,x);const S=3,w=3,h=((s=x.yes)==null?void 0:s.length)||0,N=((u=x.fake)==null?void 0:u.length)||0,_=((p=x.duplicate)==null?void 0:p.length)||0;h>=S?(await ee(l,v),await I(j.submittedBy,50),await I(v,5),alert("Consensus reached! Item approved and rewards distributed."),d()):(N>=w||_>=w)&&(await ae(l),alert("Submission rejected."),d())}catch(y){console.error("Voting failed:",y),alert("Voting failed: "+y.message)}};return e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(F,{className:"text-orange-500"})," Gear Knowledge Base"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Crowdsourced equipment specs verified by pros."})]}),e.jsxs("div",{className:"flex gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>n("feed"),className:`px-4 py-2 rounded-md text-xs font-bold transition ${b==="feed"?"bg-white dark:bg-gray-600 shadow text-orange-600 dark:text-orange-400":"text-gray-500"}`,children:"The Bench (Queue)"}),e.jsx("button",{onClick:()=>n("submit"),className:`px-4 py-2 rounded-md text-xs font-bold transition ${b==="submit"?"bg-white dark:bg-gray-600 shadow text-orange-600 dark:text-orange-400":"text-gray-500"}`,children:"Submit New Gear"})]})]}),b==="feed"&&e.jsx("div",{className:"grid grid-cols-1 gap-4",children:t?e.jsx("div",{className:"p-10 text-center",children:e.jsx(C,{className:"animate-spin mx-auto"})}):g.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed dark:border-gray-700 rounded-xl",children:[e.jsx(M,{size:48,className:"mx-auto text-green-500 mb-2 opacity-50"}),e.jsx("p",{className:"text-gray-500",children:"The bench is clear. No pending submissions."})]}):g.map(l=>{var m,j,v,s,u,p,y,k,x,S,w,h,N;return e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] p-5 rounded-xl border dark:border-gray-700 shadow-sm flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-500",children:l.brand}),e.jsx("span",{className:"text-[10px] font-bold uppercase bg-blue-50 dark:bg-blue-900/20 text-blue-600 px-2 py-0.5 rounded",children:(m=l.category)==null?void 0:m.replace(/_/g," ")})]}),e.jsx("h4",{className:"text-lg font-extrabold dark:text-white mb-2",children:l.model}),e.jsx("div",{className:"bg-gray-50 dark:bg-black/20 p-3 rounded-lg text-sm text-gray-600 dark:text-gray-300 mb-2 border dark:border-gray-700",children:l.specs}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(R,{size:12})," Submitted by ",l.submitterName||"Unknown"," â€¢ 50 TK Reward Pending"]})]}),e.jsxs("div",{className:"w-full md:w-48 flex flex-col justify-center gap-2 border-l dark:border-gray-700 pl-0 md:pl-6",children:[e.jsxs("button",{onClick:()=>f(l.id,"yes",l),disabled:(v=(j=l.votes)==null?void 0:j.yes)==null?void 0:v.includes(a.uid),className:"w-full py-2 bg-green-100 dark:bg-green-900/20 hover:bg-green-200 text-green-700 dark:text-green-400 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(O,{size:14})," Yes (",((u=(s=l.votes)==null?void 0:s.yes)==null?void 0:u.length)||0,")"]}),e.jsxs("button",{onClick:()=>f(l.id,"fake",l),disabled:(y=(p=l.votes)==null?void 0:p.fake)==null?void 0:y.includes(a.uid),className:"w-full py-2 bg-red-100 dark:bg-red-900/20 hover:bg-red-200 text-red-700 dark:text-red-400 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(H,{size:14})," Fake (",((x=(k=l.votes)==null?void 0:k.fake)==null?void 0:x.length)||0,")"]}),e.jsxs("button",{onClick:()=>f(l.id,"duplicate",l),disabled:(w=(S=l.votes)==null?void 0:S.duplicate)==null?void 0:w.includes(a.uid),className:"w-full py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 text-gray-600 dark:text-gray-300 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition disabled:opacity-50",children:[e.jsx(G,{size:14})," Dup (",((N=(h=l.votes)==null?void 0:h.duplicate)==null?void 0:N.length)||0,")"]})]})]},l.id)})}),b==="submit"&&e.jsx(be,{user:a,userData,onSuccess:()=>n("feed")})]})}function be({user:a,userData:i,onSuccess:b}){const[n,g]=c.useState({brand:"",model:"",category:q[0].id,subCategory:"",specs:""}),[o,t]=c.useState(!1),r=async()=>{if(!n.brand||!n.model||!n.specs)return alert("All fields required.");t(!0);try{const d=(a==null?void 0:a.id)||(a==null?void 0:a.uid),f=i&&`${i.firstName||""} ${i.lastName||""}`.trim()||"User";await te({brand:n.brand,model:n.model,category:n.category,subcategory:n.subCategory,specs:n.specs,submittedBy:d,submitterName:f,status:"pending",votes:{yes:[],fake:[],duplicate:[]}}),alert("Submission Received! You'll earn 50 TK once verified."),b()}catch(d){console.error(d),alert("Submission failed: "+(d.message||"Unknown error"))}t(!1)};return e.jsxs("div",{className:"max-w-xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border border-orange-200 dark:border-gray-700 shadow-lg",children:[e.jsx("h4",{className:"font-bold text-lg dark:text-white mb-4",children:"Submit New Equipment"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Category"}),e.jsx("select",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",value:n.category,onChange:d=>g({...n,category:d.target.value}),children:q.map(d=>e.jsx("option",{value:d.id,children:d.label},d.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Sub-Category"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. Compressor",value:n.subCategory,onChange:d=>g({...n,subCategory:d.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Brand"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. Neve",value:n.brand,onChange:d=>g({...n,brand:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Model"}),e.jsx("input",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm",placeholder:"e.g. 1073LB",value:n.model,onChange:d=>g({...n,model:d.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Specs / Description"}),e.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-black/20 dark:border-gray-600 dark:text-white text-sm h-24",placeholder:"Brief technical specs...",value:n.specs,onChange:d=>g({...n,specs:d.target.value})})]}),e.jsx("button",{onClick:r,disabled:o,className:"w-full bg-orange-600 text-white py-2.5 rounded-lg font-bold hover:bg-orange-700 flex items-center justify-center gap-2",children:o?e.jsx(C,{className:"animate-spin"}):"Submit for Verification"})]})]})}function xe({user:a}){const[i,b]=c.useState({skills:"",rate:"",serviceRadius:"",subRoles:[]}),[n,g]=c.useState(!0);c.useEffect(()=>{if(!(a!=null&&a.id)&&!(a!=null&&a.uid)){g(!1);return}const t=a.id||a.uid;se(t,"Technician").then(r=>{var d,f,l,m,j,v;r&&b({skills:((d=r.data)==null?void 0:d.skills)||"",rate:((f=r.data)==null?void 0:f.rate)||"",serviceRadius:((l=r.data)==null?void 0:l.service_radius)||((m=r.data)==null?void 0:m.serviceRadius)||"",subRoles:((j=r.data)==null?void 0:j.sub_roles)||((v=r.data)==null?void 0:v.subRoles)||[]}),g(!1)}).catch(r=>{console.error("Error fetching tech profile:",r),g(!1)})},[a==null?void 0:a.id,a==null?void 0:a.uid]);const o=async()=>{if(!(a!=null&&a.id)&&!(a!=null&&a.uid)){alert("User ID not available.");return}try{const t=a.id||a.uid,r={skills:i.skills,rate:i.rate?parseInt(i.rate):null,service_radius:i.serviceRadius?parseInt(i.serviceRadius):null,sub_roles:i.subRoles||[]};await re(t,"Technician",r),alert("Tech Profile Updated Successfully")}catch(t){console.error(t),alert("Update failed: "+(t.message||"Unknown error"))}};return n?e.jsx("div",{className:"p-10 text-center",children:e.jsx(C,{className:"animate-spin mx-auto"})}):e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-[#2c2e36] p-6 rounded-2xl border dark:border-gray-700 shadow-sm animate-in fade-in",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white mb-6 border-b dark:border-gray-700 pb-2",children:"Your Technician Settings"}),e.jsxs("div",{className:"space-y-5",children:[e.jsx(le,{label:"Primary Specialties",fieldKey:"subRoles",options:U,initialValues:i.subRoles,onChange:(t,r)=>b(d=>({...d,[t]:r}))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Detailed Skills (Comma Separated)"}),e.jsx("input",{className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:i.skills||"",onChange:t=>b({...i,skills:t.target.value}),placeholder:"e.g. SSL 4000 Maintenance, Tube Bias..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Hourly Rate ($)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:i.rate||"",onChange:t=>b({...i,rate:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase mb-1 block",children:"Service Radius (Miles)"}),e.jsx("input",{type:"number",className:"w-full p-3 border rounded-lg dark:bg-black/20 dark:border-gray-600 dark:text-white",value:i.serviceRadius||"",onChange:t=>b({...i,serviceRadius:t.target.value})})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:o,className:"w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(Y,{size:18})," Save Changes"]})})]})]})}function ve({user:a,userData:i,openPublicProfile:b}){var f;const n=K(),g=J(),o=l=>{const m=l.split("/").filter(Boolean);return m[0]==="tech"&&m[1]?m[1]:"board"},[t,r]=c.useState(()=>o(n.pathname)),d=(f=i==null?void 0:i.accountTypes)==null?void 0:f.includes("Technician");return c.useEffect(()=>{const l=`/tech/${t}`;n.pathname!==l&&g(l,{replace:!0})},[t]),c.useEffect(()=>{const l=o(n.pathname);l!==t&&r(l)},[n.pathname]),e.jsxs("div",{className:"max-w-6xl mx-auto gap-fluid pb-20 container-fluid",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-900 to-slate-900 p-8 rounded-2xl text-white shadow-xl relative overflow-hidden flex flex-col md:flex-row justify-between items-end",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-400 font-bold uppercase tracking-widest text-xs mb-2",children:[e.jsx(E,{size:14})," SeshNx Technical"]}),e.jsx("h1",{className:"text-3xl font-extrabold mb-2",children:"Studio Tech Services"}),e.jsx("p",{className:"text-slate-300 max-w-lg",children:"Hire professionals for equipment repair, studio wiring, and acoustic calibration."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 relative z-10 mt-4 md:mt-0",children:[e.jsx("button",{onClick:()=>r("board"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${t==="board"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Job Board"}),e.jsx("button",{onClick:()=>r("directory"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${t==="directory"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Find a Tech"}),e.jsx("button",{onClick:()=>r("broadcast"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${t==="broadcast"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Post Request"}),e.jsx("button",{onClick:()=>r("database"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${t==="database"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Gear DB"}),d&&e.jsx("button",{onClick:()=>r("profile"),className:`px-4 py-2 rounded-lg font-bold text-sm transition ${t==="profile"?"bg-orange-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:"Tech Portal"})]}),e.jsx(Q,{size:200,className:"absolute -right-10 -top-10 text-white opacity-5 rotate-12 pointer-events-none"})]}),e.jsxs("div",{className:"min-h-[400px]",children:[t==="board"&&e.jsx(de,{user:a}),t==="directory"&&e.jsx(ne,{user:a,userData:i,openPublicProfile:b}),t==="broadcast"&&e.jsx(oe,{user:a,userData:i,onSuccess:()=>r("board"),onCancel:()=>r("board")}),t==="database"&&e.jsx(ce,{user:a,isTech:d}),t==="profile"&&d&&e.jsx(xe,{user:a})]})]})}export{ve as default};
