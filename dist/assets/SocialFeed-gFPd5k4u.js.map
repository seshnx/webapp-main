{"version":3,"file":"SocialFeed-gFPd5k4u.js","sources":["../../src/components/social/CommentSection.jsx","../../src/components/social/PostCard.jsx","../../src/components/social/CreatePostWidget.jsx","../../src/components/social/discover/DiscoverSection.jsx","../../src/components/social/discover/DiscoverCard.jsx","../../src/utils/recommendations.js","../../src/hooks/useDiscover.js","../../src/components/social/discover/SoundsDiscover.jsx","../../src/components/social/discover/ArtistsDiscover.jsx","../../src/components/social/discover/ProducersDiscover.jsx","../../src/components/social/discover/StudiosDiscover.jsx","../../src/components/social/discover/SchoolsDiscover.jsx","../../src/components/social/Discover.jsx","../../src/components/SocialFeed.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Send, Trash2, CornerDownRight } from 'lucide-react';\r\nimport { getComments, createComment, deleteComment, updatePostCommentCount } from '../../config/neonQueries';\r\nimport { createNotification } from '../../hooks/useNotifications';\r\nimport UserAvatar from '../shared/UserAvatar';\r\n\r\nexport default function CommentSection({ post, currentUser, currentUserData, blockedUsers, onCountChange }) {\r\n    const [comments, setComments] = useState([]);\r\n    const [text, setText] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!post.id) return;\r\n\r\n        // Initial fetch\r\n        loadComments();\r\n\r\n        // Set up polling to replace real-time subscription (every 30 seconds)\r\n        const interval = setInterval(loadComments, 30000);\r\n\r\n        return () => {\r\n            clearInterval(interval);\r\n        };\r\n    }, [post.id, blockedUsers]);\r\n\r\n    const loadComments = async () => {\r\n        try {\r\n            const data = await getComments(post.id);\r\n\r\n            if (data) {\r\n                // Client-side block filtering\r\n                const filtered = data.filter(c => !blockedUsers?.includes(c.user_id));\r\n                setComments(filtered);\r\n                onCountChange(filtered.length);\r\n            }\r\n        } catch (error) {\r\n            console.error('Comments fetch error:', error);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        const userId = currentUser?.id || currentUser?.uid;\r\n        if (!text.trim() || !userId) return;\r\n        setLoading(true);\r\n\r\n        const displayName = currentUserData?.effectiveDisplayName ||\r\n            currentUserData?.firstName ||\r\n            currentUser?.displayName ||\r\n            'User';\r\n\r\n        try {\r\n            // Ensure content is not empty (required by schema)\r\n            const commentContent = text.trim();\r\n            if (!commentContent) {\r\n                alert('Please enter a comment');\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            // Create comment using Neon\r\n            await createComment({\r\n                post_id: post.id,\r\n                user_id: userId,\r\n                content: commentContent,\r\n            });\r\n\r\n            // Update post comment count\r\n            await updatePostCommentCount(post.id, 1);\r\n\r\n            // Reload comments to show the new one\r\n            await loadComments();\r\n\r\n            // Send notification to post author (if not commenting on own post)\r\n            if (post.userId !== userId) {\r\n                createNotification({\r\n                    targetUserId: post.userId,\r\n                    type: 'comment',\r\n                    fromUserId: userId,\r\n                    fromUserName: displayName,\r\n                    fromUserPhoto: currentUserData?.photoURL,\r\n                    postId: post.id,\r\n                    postPreview: post.text?.substring(0, 50),\r\n                    message: 'commented on your post'\r\n                });\r\n            }\r\n\r\n            setText('');\r\n            setLoading(false);\r\n        } catch (e) {\r\n            console.error('Comment submission error:', e);\r\n            alert(`Failed to post comment: ${e.message || 'Unknown error'}`);\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (commentId) => {\r\n        if (!window.confirm(\"Delete comment?\")) return;\r\n        try {\r\n            await deleteComment(commentId);\r\n            await updatePostCommentCount(post.id, -1);\r\n            await loadComments();\r\n        } catch (e) {\r\n            console.error('Delete comment error:', e);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-gray-50 dark:bg-[#1f2128] border-t dark:border-gray-700 p-4 animate-in slide-in-from-top-2\">\r\n            {/* Comments List */}\r\n            <div className=\"space-y-4 mb-4 max-h-80 overflow-y-auto custom-scrollbar pr-2\">\r\n                {comments.length === 0 && (\r\n                    <div className=\"text-center text-gray-400 text-xs py-2\">\r\n                        No comments yet. Be the first!\r\n                    </div>\r\n                )}\r\n                {comments.map(comment => (\r\n                    <div key={comment.id} className=\"group flex gap-3 text-sm\">\r\n                        <UserAvatar \r\n                            src={comment.userPhoto}\r\n                            name={comment.displayName}\r\n                            size=\"xs\"\r\n                            className=\"shrink-0\"\r\n                        />\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"bg-white dark:bg-dark-card border dark:border-gray-700 p-3 rounded-2xl rounded-tl-none inline-block max-w-full\">\r\n                                <div className=\"flex justify-between items-baseline gap-2 mb-1\">\r\n                                    <span className=\"font-bold dark:text-white text-xs truncate\">\r\n                                        {comment.displayName}\r\n                                    </span>\r\n                                    <span className=\"text-[10px] text-gray-400 shrink-0\">\r\n                                        {comment.timestamp \r\n                                            ? new Date(comment.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) \r\n                                            : 'Just now'}\r\n                                    </span>\r\n                                </div>\r\n                                <p className=\"text-gray-700 dark:text-gray-300 break-words\">{comment.text}</p>\r\n                            </div>\r\n                            <div className=\"flex gap-3 mt-1 ml-2\">\r\n                                <button className=\"text-[10px] font-bold text-gray-500 hover:text-brand-blue transition\">\r\n                                    Reply\r\n                                </button>\r\n                                {comment.userId === currentUser?.uid && (\r\n                                    <button \r\n                                        onClick={() => handleDelete(comment.id)} \r\n                                        className=\"text-[10px] font-bold text-gray-400 hover:text-red-500 transition\"\r\n                                    >\r\n                                        Delete\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Comment Input */}\r\n            <form onSubmit={handleSubmit} className=\"flex gap-2\">\r\n                <UserAvatar \r\n                    src={currentUserData?.photoURL}\r\n                    name={currentUserData?.firstName || 'You'}\r\n                    size=\"xs\"\r\n                    className=\"shrink-0 hidden sm:block\"\r\n                />\r\n                <input \r\n                    className=\"flex-1 bg-white dark:bg-dark-card border dark:border-gray-600 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-brand-blue outline-none dark:text-white transition\"\r\n                    placeholder=\"Write a comment...\"\r\n                    value={text}\r\n                    onChange={e => setText(e.target.value)}\r\n                />\r\n                <button \r\n                    type=\"submit\" \r\n                    disabled={!text.trim() || loading} \r\n                    className=\"bg-brand-blue text-white p-2 rounded-full hover:bg-blue-600 disabled:opacity-50 transition shadow-sm\"\r\n                >\r\n                    <Send size={16} className={loading ? 'animate-pulse' : ''}/>\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useRef, useEffect } from 'react';\r\nimport { MessageCircle, Share2, MoreHorizontal, User, Bookmark, Smile, UserPlus, Link2, Flag, Trash2, Check } from 'lucide-react';\r\nimport { updatePost, deletePost, checkIsSaved, savePost, unsavePost, updatePostSaveCount } from '../../config/neonQueries';\r\nimport StarFieldVisualizer from '../shared/StarFieldVisualizer';\r\nimport CommentSection from './CommentSection';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { createNotification } from '../../hooks/useNotifications';\r\nimport FollowButton, { FollowButtonCompact } from './FollowButton';\r\nimport toast from 'react-hot-toast';\r\nimport UserAvatar from '../shared/UserAvatar';\r\n\r\nconst REACTION_SET = ['ðŸ‘', 'â¤ï¸', 'ðŸ˜‚', 'ðŸ˜®', 'ðŸ˜¢', 'ðŸ”¥'];\r\n\r\nconst renderText = (text) => {\r\n    if (!text) return null;\r\n    return text.split(/(\\s+)/).map((part, i) => {\r\n        if (part.match(/^#\\w+/)) return <span key={i} className=\"text-brand-blue font-bold cursor-pointer hover:underline\">{part}</span>;\r\n        if (part.match(/^@\\w+/)) return <span key={i} className=\"text-purple-600 font-bold cursor-pointer hover:underline\">{part}</span>;\r\n        return part;\r\n    });\r\n};\r\n\r\nconst cardVariants = {\r\n    hidden: { opacity: 0, y: 20 },\r\n    show: { opacity: 1, y: 0, transition: { type: \"spring\", stiffness: 300, damping: 24 } },\r\n    exit: { opacity: 0, scale: 0.95, transition: { duration: 0.2 } }\r\n};\r\n\r\nexport default function PostCard({\r\n    post,\r\n    currentUser,\r\n    currentUserData,\r\n    openPublicProfile,\r\n    onReport,\r\n    onDelete,\r\n    isFollowingAuthor,\r\n    onToggleFollow,\r\n    autoPlayVideos = false\r\n}) {\r\n    const [showComments, setShowComments] = useState(false);\r\n    const [commentCount, setCommentCount] = useState(post.commentCount || 0);\r\n    const [isSaved, setIsSaved] = useState(false);\r\n    const [showReactionMenu, setShowReactionMenu] = useState(false);\r\n    const [showMoreMenu, setShowMoreMenu] = useState(false);\r\n    const [linkCopied, setLinkCopied] = useState(false);\r\n    const [savingPost, setSavingPost] = useState(false);\r\n    const menuRef = useRef(null);\r\n    const moreMenuRef = useRef(null);\r\n\r\n    const userId = currentUser?.id || currentUser?.uid;\r\n    const isOwnPost = post.userId === userId;\r\n    const myReaction = post.reactions?.[userId];\r\n    const reactionCounts = post.reactions ? Object.values(post.reactions).reduce((acc, emoji) => {\r\n        acc[emoji] = (acc[emoji] || 0) + 1;\r\n        return acc;\r\n    }, {}) : {};\r\n    const totalReactions = Object.values(reactionCounts).reduce((a, b) => a + b, 0);\r\n\r\n    // Check if post is saved on mount\r\n    useEffect(() => {\r\n        if (!userId) return;\r\n\r\n        const checkSaved = async () => {\r\n            try {\r\n                const isSaved = await checkIsSaved(userId, post.id);\r\n                setIsSaved(isSaved);\r\n            } catch (e) {\r\n                console.error('Error checking saved status:', e);\r\n                setIsSaved(false); // Default to false on error\r\n            }\r\n        };\r\n        checkSaved();\r\n    }, [userId, post.id]);\r\n\r\n    // Close menus on outside click\r\n    useEffect(() => {\r\n        const handleClickOutside = (event) => {\r\n            if (menuRef.current && !menuRef.current.contains(event.target)) {\r\n                setShowReactionMenu(false);\r\n            }\r\n            if (moreMenuRef.current && !moreMenuRef.current.contains(event.target)) {\r\n                setShowMoreMenu(false);\r\n            }\r\n        };\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, []);\r\n\r\n    const handleReaction = async (emoji) => {\r\n        setShowReactionMenu(false);\r\n        if (!userId) return;\r\n\r\n        try {\r\n            const wasReacted = !!myReaction;\r\n            const currentReactions = post.reactions || {};\r\n\r\n            if (myReaction === emoji) {\r\n                // Remove reaction\r\n                const newReactions = { ...currentReactions };\r\n                delete newReactions[userId];\r\n\r\n                await updatePost(post.id, {\r\n                    reactions: newReactions,\r\n                    reaction_count: Math.max((post.reactionCount || 0) - 1, 0)\r\n                });\r\n            } else {\r\n                // Add/change reaction\r\n                const newReactions = { ...currentReactions, [userId]: emoji };\r\n                const increment = !myReaction ? 1 : 0;\r\n\r\n                await updatePost(post.id, {\r\n                    reactions: newReactions,\r\n                    reaction_count: (post.reactionCount || 0) + increment\r\n                });\r\n\r\n                // Send notification (only for new reactions, not changes)\r\n                if (!wasReacted && !isOwnPost) {\r\n                    createNotification({\r\n                        targetUserId: post.userId,\r\n                        type: 'like',\r\n                        fromUserId: userId,\r\n                        fromUserName: currentUserData?.effectiveDisplayName || currentUserData?.firstName || 'Someone',\r\n                        fromUserPhoto: currentUserData?.photoURL,\r\n                        postId: post.id,\r\n                        postPreview: post.text?.substring(0, 50),\r\n                        message: `reacted ${emoji} to your post`\r\n                    });\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Reaction failed\", e);\r\n            toast.error(\"Couldn't add reaction\");\r\n        }\r\n    };\r\n\r\n    const handleSavePost = async () => {\r\n        if (!userId || savingPost) return;\r\n        setSavingPost(true);\r\n\r\n        try {\r\n            if (isSaved) {\r\n                // Unsave\r\n                await unsavePost(userId, post.id);\r\n                await updatePostSaveCount(post.id, -1);\r\n\r\n                setIsSaved(false);\r\n                toast.success('Removed from saved');\r\n            } else {\r\n                // Save\r\n                await savePost(userId, post.id, {\r\n                    author_id: post.userId,\r\n                    author_name: post.displayName,\r\n                    preview: post.text?.substring(0, 100) || 'Media post',\r\n                    has_media: !!(post.attachments?.length || post.imageUrl || post.audioUrl)\r\n                });\r\n                await updatePostSaveCount(post.id, 1);\r\n\r\n                setIsSaved(true);\r\n                toast.success('Post saved!');\r\n\r\n                // Optionally notify author (some platforms do this)\r\n                // Uncomment if desired:\r\n                // if (!isOwnPost) {\r\n                //     createNotification({\r\n                //         targetUserId: post.userId,\r\n                //         type: 'save',\r\n                //         fromUserId: userId,\r\n                //         fromUserName: currentUserData?.effectiveDisplayName || 'Someone',\r\n                //         fromUserPhoto: currentUserData?.photoURL,\r\n                //         postId: post.id,\r\n                //         message: 'saved your post'\r\n                //     });\r\n                // }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Save failed\", e);\r\n            toast.error(\"Couldn't save post\");\r\n        }\r\n        setSavingPost(false);\r\n    };\r\n\r\n    const handleShare = async () => {\r\n        const shareUrl = `${window.location.origin}/post/${post.id}`;\r\n\r\n        if (navigator.share) {\r\n            try {\r\n                await navigator.share({\r\n                    title: `Post by ${post.displayName}`,\r\n                    text: post.text?.substring(0, 100) || 'Check out this post',\r\n                    url: shareUrl\r\n                });\r\n            } catch (e) {\r\n                if (e.name !== 'AbortError') {\r\n                    copyLink(shareUrl);\r\n                }\r\n            }\r\n        } else {\r\n            copyLink(shareUrl);\r\n        }\r\n    };\r\n\r\n    const copyLink = (url) => {\r\n        navigator.clipboard.writeText(url);\r\n        setLinkCopied(true);\r\n        toast.success('Link copied to clipboard!');\r\n        setTimeout(() => setLinkCopied(false), 2000);\r\n    };\r\n\r\n    const handleDeletePost = async () => {\r\n        if (!isOwnPost) return;\r\n        if (!window.confirm('Are you sure you want to delete this post?')) return;\r\n\r\n        try {\r\n            const success = await deletePost(post.id);\r\n\r\n            if (!success) {\r\n                toast.error(\"Couldn't delete post - permission denied\");\r\n                return;\r\n            }\r\n\r\n            toast.success('Post deleted');\r\n            // Notify parent to remove post from UI\r\n            if (onDelete) onDelete(post.id);\r\n        } catch (e) {\r\n            console.error('Delete failed:', e);\r\n            toast.error(\"Couldn't delete post\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <motion.div\r\n            variants={cardVariants}\r\n            initial=\"hidden\"\r\n            animate=\"show\"\r\n            exit=\"exit\"\r\n            layout\r\n            className=\"bg-white dark:bg-dark-card border dark:border-gray-700 rounded-xl overflow-visible shadow-sm mb-4 relative\"\r\n        >\r\n            {/* Header */}\r\n            <div className=\"p-4 flex justify-between items-start\">\r\n                <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n                    <div\r\n                        className=\"cursor-pointer shrink-0\"\r\n                        onClick={() => post.userId && openPublicProfile(post.userId)}\r\n                        role=\"button\"\r\n                        tabIndex={0}\r\n                        aria-label={`View ${post.displayName || 'user'}'s profile`}\r\n                    >\r\n                        <UserAvatar\r\n                            src={post.authorPhoto}\r\n                            name={post.displayName}\r\n                            size=\"md\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"min-w-0 flex-1\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <h4\r\n                                className=\"font-bold dark:text-white text-sm hover:underline decoration-brand-blue cursor-pointer truncate\"\r\n                                onClick={() => post.userId && openPublicProfile(post.userId)}\r\n                            >\r\n                                {post.displayName || 'Unknown User'}\r\n                            </h4>\r\n                            {/* Follow button in header for non-own posts */}\r\n                            {!isOwnPost && onToggleFollow && !isFollowingAuthor && (\r\n                                <button\r\n                                    onClick={(e) => { e.stopPropagation(); onToggleFollow(); }}\r\n                                    className=\"text-xs font-bold text-brand-blue hover:text-blue-700 transition shrink-0\"\r\n                                >\r\n                                    â€¢ Follow\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 flex items-center gap-1\">\r\n                            <span className=\"truncate\">{post.role}</span>\r\n                            <span>â€¢</span>\r\n                            <span className=\"shrink-0\">\r\n                                {post.timestamp || post.created_at\r\n                                    ? new Date(post.timestamp || post.created_at).toLocaleDateString()\r\n                                    : 'Just now'\r\n                                }\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* More menu */}\r\n                <div className=\"relative\" ref={moreMenuRef}>\r\n                    <button\r\n                        className=\"text-gray-400 hover:text-gray-600 dark:hover:text-white transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800\"\r\n                        onClick={() => setShowMoreMenu(!showMoreMenu)}\r\n                    >\r\n                        <MoreHorizontal size={20} />\r\n                    </button>\r\n\r\n                    <AnimatePresence>\r\n                        {showMoreMenu && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0, scale: 0.95, y: -5 }}\r\n                                animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                                exit={{ opacity: 0, scale: 0.95, y: -5 }}\r\n                                className=\"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 overflow-hidden z-50\"\r\n                            >\r\n                                <button\r\n                                    onClick={() => { copyLink(`${window.location.origin}/post/${post.id}`); setShowMoreMenu(false); }}\r\n                                    className=\"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition\"\r\n                                >\r\n                                    <Link2 size={16} className=\"text-gray-400\" />\r\n                                    <span className=\"dark:text-gray-200\">Copy link</span>\r\n                                </button>\r\n\r\n                                {!isOwnPost && (\r\n                                    <>\r\n                                        {onToggleFollow && (\r\n                                            <button\r\n                                                onClick={() => { onToggleFollow(); setShowMoreMenu(false); }}\r\n                                                className=\"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition\"\r\n                                            >\r\n                                                <UserPlus size={16} className=\"text-gray-400\" />\r\n                                                <span className=\"dark:text-gray-200\">\r\n                                                    {isFollowingAuthor ? 'Unfollow' : 'Follow'} {post.displayName?.split(' ')[0]}\r\n                                                </span>\r\n                                            </button>\r\n                                        )}\r\n                                        <button\r\n                                            onClick={() => { onReport(); setShowMoreMenu(false); }}\r\n                                            className=\"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500\"\r\n                                        >\r\n                                            <Flag size={16} />\r\n                                            <span>Report post</span>\r\n                                        </button>\r\n                                    </>\r\n                                )}\r\n\r\n                                {isOwnPost && (\r\n                                    <button\r\n                                        onClick={() => { handleDeletePost(); setShowMoreMenu(false); }}\r\n                                        className=\"w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-red-500\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                        <span>Delete post</span>\r\n                                    </button>\r\n                                )}\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content Body */}\r\n            <div className=\"px-4 pb-2\">\r\n                {post.text && (\r\n                    <p className=\"text-gray-800 dark:text-gray-200 whitespace-pre-wrap text-sm leading-relaxed mb-3\">\r\n                        {renderText(post.text)}\r\n                    </p>\r\n                )}\r\n\r\n                {/* Attachments */}\r\n                {post.attachments && post.attachments.length > 0 && (\r\n                    <div className={`grid gap-2 mb-3 ${post.attachments.length > 1 ? 'grid-cols-2' : 'grid-cols-1'}`}>\r\n                        {post.attachments.map((att, i) => (\r\n                            <div key={i} className=\"rounded-lg overflow-hidden bg-transparent relative\">\r\n                                {att.type === 'image' && <img src={att.url} className=\"w-full h-full object-cover max-h-96\" alt=\"content\" />}\r\n                                {att.type === 'video' && (\r\n                                    <video\r\n                                        src={att.url}\r\n                                        controls\r\n                                        className=\"w-full h-full max-h-96 bg-black\"\r\n                                        autoPlay={autoPlayVideos}\r\n                                        playsInline\r\n                                        muted={autoPlayVideos}\r\n                                        preload=\"metadata\"\r\n                                    />\r\n                                )}\r\n                                {att.type === 'audio' && (\r\n                                    <div className=\"w-full\">\r\n                                        <StarFieldVisualizer audioUrl={att.url} fileName={att.name || 'Audio Track'} />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Fallbacks for legacy posts */}\r\n                {post.audioUrl && !post.attachments && (\r\n                    <div className=\"rounded-lg overflow-hidden bg-transparent mb-3\">\r\n                        <StarFieldVisualizer audioUrl={post.audioUrl} fileName={post.audioName || 'Track'} />\r\n                    </div>\r\n                )}\r\n                {post.imageUrl && !post.attachments && <img src={post.imageUrl} className=\"rounded-lg w-full mb-3 border dark:border-gray-700\" alt=\"legacy content\" />}\r\n            </div>\r\n\r\n            {/* Engagement Stats */}\r\n            {(totalReactions > 0 || post.saveCount > 0) && (\r\n                <div className=\"px-4 py-2 flex items-center justify-between\">\r\n                    <div className=\"flex gap-1\">\r\n                        {Object.entries(reactionCounts).map(([emoji, count]) => (\r\n                            <motion.div\r\n                                key={emoji}\r\n                                initial={{ scale: 0 }} animate={{ scale: 1 }}\r\n                                className={`text-xs px-2 py-1 rounded-full border flex items-center gap-1 ${myReaction === emoji ? 'bg-blue-50 border-blue-200 dark:bg-blue-900/30 dark:border-blue-800' : 'bg-gray-50 border-gray-100 dark:bg-gray-800 dark:border-gray-700'} dark:text-gray-300`}\r\n                            >\r\n                                <span>{emoji}</span>\r\n                                <span className=\"font-bold\">{count}</span>\r\n                            </motion.div>\r\n                        ))}\r\n                    </div>\r\n                    {post.saveCount > 0 && (\r\n                        <span className=\"text-xs text-gray-400\">\r\n                            {post.saveCount} save{post.saveCount !== 1 ? 's' : ''}\r\n                        </span>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"px-4 py-3 border-t dark:border-gray-700 flex items-center justify-between relative\">\r\n                <div className=\"flex gap-2 sm:gap-4\">\r\n                    {/* Reaction Button */}\r\n                    <div className=\"relative\">\r\n                        <motion.button\r\n                            whileTap={{ scale: 0.9 }}\r\n                            onClick={() => setShowReactionMenu(!showReactionMenu)}\r\n                            className={`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg ${myReaction ? 'text-blue-600 bg-blue-50 dark:bg-blue-900/20' : 'text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800'}`}\r\n                        >\r\n                            {myReaction ? <span className=\"text-lg\">{myReaction}</span> : <Smile size={18} />}\r\n                            <span className=\"hidden sm:inline\">{myReaction ? 'Reacted' : 'React'}</span>\r\n                        </motion.button>\r\n\r\n                        <AnimatePresence>\r\n                            {showReactionMenu && (\r\n                                <motion.div\r\n                                    ref={menuRef}\r\n                                    initial={{ opacity: 0, scale: 0.8, y: 10 }}\r\n                                    animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                                    exit={{ opacity: 0, scale: 0.8, y: 10 }}\r\n                                    className=\"absolute bottom-full left-0 mb-2 bg-white dark:bg-gray-800 shadow-xl rounded-full p-2 flex gap-1 sm:gap-2 z-50 border dark:border-gray-600 origin-bottom-left\"\r\n                                >\r\n                                    {REACTION_SET.map(emoji => (\r\n                                        <motion.button\r\n                                            key={emoji}\r\n                                            whileHover={{ scale: 1.2 }}\r\n                                            whileTap={{ scale: 0.9 }}\r\n                                            onClick={(e) => { e.stopPropagation(); handleReaction(emoji); }}\r\n                                            className={`text-xl p-1 sm:p-1.5 rounded-full ${myReaction === emoji ? 'bg-blue-100 dark:bg-blue-900' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}\r\n                                        >\r\n                                            {emoji}\r\n                                        </motion.button>\r\n                                    ))}\r\n                                </motion.div>\r\n                            )}\r\n                        </AnimatePresence>\r\n                    </div>\r\n\r\n                    {/* Comment Button */}\r\n                    <motion.button\r\n                        whileTap={{ scale: 0.95 }}\r\n                        onClick={() => setShowComments(!showComments)}\r\n                        className=\"flex items-center gap-1.5 sm:gap-2 text-sm font-medium text-gray-500 hover:text-brand-blue transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\"\r\n                    >\r\n                        <MessageCircle size={18} />\r\n                        <span className=\"hidden sm:inline\">{commentCount > 0 ? commentCount : 'Comment'}</span>\r\n                        {commentCount > 0 && <span className=\"sm:hidden\">{commentCount}</span>}\r\n                    </motion.button>\r\n\r\n                    {/* Share Button */}\r\n                    <motion.button\r\n                        whileTap={{ scale: 0.95 }}\r\n                        onClick={handleShare}\r\n                        className={`flex items-center gap-1.5 sm:gap-2 text-sm font-medium transition px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 ${linkCopied ? 'text-green-500' : 'text-gray-500 hover:text-green-500'}`}\r\n                    >\r\n                        {linkCopied ? <Check size={18} /> : <Share2 size={18} />}\r\n                        <span className=\"hidden sm:inline\">{linkCopied ? 'Copied!' : 'Share'}</span>\r\n                    </motion.button>\r\n                </div>\r\n\r\n                {/* Save Button */}\r\n                <motion.button\r\n                    whileTap={{ scale: 0.8 }}\r\n                    onClick={handleSavePost}\r\n                    disabled={savingPost}\r\n                    className={`${isSaved ? 'text-brand-blue' : 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'} transition p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full disabled:opacity-50`}\r\n                    title={isSaved ? 'Remove from saved' : 'Save post'}\r\n                >\r\n                    <Bookmark size={18} fill={isSaved ? \"currentColor\" : \"none\"} />\r\n                </motion.button>\r\n            </div>\r\n\r\n            {/* Comments Section */}\r\n            <AnimatePresence>\r\n                {showComments && (\r\n                    <motion.div\r\n                        initial={{ height: 0, opacity: 0 }}\r\n                        animate={{ height: 'auto', opacity: 1 }}\r\n                        exit={{ height: 0, opacity: 0 }}\r\n                        className=\"overflow-hidden\"\r\n                    >\r\n                        <CommentSection\r\n                            post={post}\r\n                            currentUser={currentUser}\r\n                            currentUserData={currentUserData}\r\n                            blockedUsers={[]}\r\n                            onCountChange={setCommentCount}\r\n                        />\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </motion.div>\r\n    );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Send, Image as ImageIcon, Music, Video, X, Sliders, Paperclip, Loader2 } from 'lucide-react';\r\nimport { useVercelUpload } from '../../hooks/useVercelUpload';\r\nimport { POPULAR_PLUGINS_LIST } from '../../config/constants';\r\nimport { MultiSelect } from '../shared/Inputs';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nexport default function CreatePostWidget({ user, userData, onPost }) {\r\n    const [text, setText] = useState('');\r\n    const [media, setMedia] = useState([]); // Array of {file, type, previewUrl}\r\n    const [seshFxOpen, setSeshFxOpen] = useState(false);\r\n    const [pluginsUsed, setPluginsUsed] = useState([]);\r\n    const [presetFile, setPresetFile] = useState(null);\r\n    const [isPosting, setIsPosting] = useState(false);\r\n    const [uploadProgress, setUploadProgress] = useState({ current: 0, total: 0, percent: 0 });\r\n\r\n    const { uploadMedia } = useVercelUpload('post-media');\r\n\r\n    const handleFileSelect = (e, type) => {\r\n        if (e.target.files && e.target.files[0]) {\r\n            const file = e.target.files[0];\r\n            // Create preview URL\r\n            const previewUrl = URL.createObjectURL(file);\r\n            setMedia([...media, { file, type, previewUrl }]);\r\n        }\r\n    };\r\n\r\n    const removeMedia = (index) => {\r\n        setMedia(media.filter((_, i) => i !== index));\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        if (!text.trim() && media.length === 0) return;\r\n        setIsPosting(true);\r\n\r\n        try {\r\n            // Calculate total uploads needed\r\n            const totalUploads = media.length + (presetFile ? 1 : 0);\r\n            let completedUploads = 0;\r\n\r\n            // Update progress helper\r\n            const updateProgress = () => {\r\n                completedUploads++;\r\n                setUploadProgress({\r\n                    current: completedUploads,\r\n                    total: totalUploads,\r\n                    percent: Math.round((completedUploads / totalUploads) * 100)\r\n                });\r\n            };\r\n\r\n            // Reset progress\r\n            setUploadProgress({ current: 0, total: totalUploads, percent: 0 });\r\n\r\n            // Upload all media assets one by one to track progress\r\n            const uploadedMedia = [];\r\n            for (const m of media) {\r\n                // Vercel Blob automatically handles storage organization\r\n                const result = await uploadMedia(m.file);\r\n\r\n                // CRITICAL FIX: Ensure we enforce the type selected by the user (m.type)\r\n                if (result) {\r\n                    uploadedMedia.push({\r\n                        url: result.url, // Vercel Blob returns { url } object\r\n                        type: m.type // Override with explicit type (audio, video, image)\r\n                    });\r\n                }\r\n                updateProgress();\r\n            }\r\n\r\n            let presetUrl = null;\r\n            if (presetFile) {\r\n                const res = await uploadMedia(presetFile);\r\n                presetUrl = res?.url;\r\n                updateProgress();\r\n            }\r\n\r\n            const postPayload = {\r\n                text,\r\n                attachments: uploadedMedia.filter(m => m !== null), // Clean failed uploads\r\n                seshFx: (seshFxOpen && (pluginsUsed.length > 0 || presetUrl)) ? {\r\n                    plugins: pluginsUsed,\r\n                    presetUrl,\r\n                    presetName: presetFile ? presetFile.name : null\r\n                } : null\r\n            };\r\n\r\n            await onPost(postPayload);\r\n\r\n            // Reset Form\r\n            setText('');\r\n            setMedia([]);\r\n            setSeshFxOpen(false);\r\n            setPluginsUsed([]);\r\n            setPresetFile(null);\r\n            setUploadProgress({ current: 0, total: 0, percent: 0 });\r\n        } catch (error) {\r\n            console.error(\"Error creating post:\", error);\r\n            alert(\"Failed to create post. Please try again.\");\r\n        } finally {\r\n            setIsPosting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-gray-700 shadow-sm mb-6\">\r\n            {/* Upload Progress Overlay */}\r\n            <AnimatePresence>\r\n                {isPosting && uploadProgress.total > 0 && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, height: 0 }}\r\n                        animate={{ opacity: 1, height: 'auto' }}\r\n                        exit={{ opacity: 0, height: 0 }}\r\n                        className=\"mb-4 overflow-hidden\"\r\n                    >\r\n                        <div className=\"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-4 border border-blue-100 dark:border-blue-800/50\">\r\n                            <div className=\"flex items-center gap-3 mb-3\">\r\n                                <div className=\"relative\">\r\n                                    <Loader2 className=\"animate-spin text-brand-blue\" size={24} />\r\n                                </div>\r\n                                <div>\r\n                                    <h4 className=\"font-bold text-gray-900 dark:text-white\">\r\n                                        Getting Post Ready...\r\n                                    </h4>\r\n                                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                                        Uploading {uploadProgress.current} of {uploadProgress.total} files\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Progress Bar */}\r\n                            <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 overflow-hidden\">\r\n                                <motion.div\r\n                                    className=\"h-full bg-gradient-to-r from-brand-blue to-purple-500 rounded-full\"\r\n                                    initial={{ width: 0 }}\r\n                                    animate={{ width: `${uploadProgress.percent}%` }}\r\n                                    transition={{ duration: 0.3, ease: 'easeOut' }}\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Percentage */}\r\n                            <div className=\"flex justify-end mt-1\">\r\n                                <span className=\"text-xs font-semibold text-brand-blue\">\r\n                                    {uploadProgress.percent}%\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            <div className=\"flex gap-3\">\r\n                <div className=\"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden shrink-0\">\r\n                    {userData?.photoURL ? <img src={userData.photoURL} className=\"h-full w-full object-cover\" /> : <div className=\"h-full w-full bg-brand-blue\"></div>}\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                    <textarea\r\n                        className=\"w-full bg-transparent outline-none text-gray-900 dark:text-white placeholder-gray-500 min-h-[80px] resize-none\"\r\n                        placeholder=\"What's creating sound today? (#tags @mentions)\"\r\n                        value={text}\r\n                        onChange={e => setText(e.target.value)}\r\n                        disabled={isPosting}\r\n                    />\r\n\r\n                    {/* Media Previews Grid */}\r\n                    {media.length > 0 && (\r\n                        <div className=\"grid grid-cols-2 gap-2 mb-3\">\r\n                            {media.map((m, i) => (\r\n                                <div key={i} className=\"relative rounded-lg overflow-hidden bg-black/5 border dark:border-gray-600 aspect-video group flex items-center justify-center\">\r\n                                    {m.type === 'image' && <img src={m.previewUrl} className=\"h-full w-full object-cover\" />}\r\n                                    {m.type === 'video' && <video src={m.previewUrl} className=\"h-full w-full object-cover\" />}\r\n                                    {m.type === 'audio' && (\r\n                                        <div className=\"flex flex-col items-center justify-center text-brand-blue bg-gray-100 dark:bg-gray-800 w-full h-full\">\r\n                                            <Music size={32} />\r\n                                            <span className=\"text-xs text-gray-500 mt-2 truncate max-w-[90%] px-2\">{m.file.name}</span>\r\n                                        </div>\r\n                                    )}\r\n                                    {!isPosting && (\r\n                                        <button onClick={() => removeMedia(i)} className=\"absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-red-500\"><X size={12} /></button>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* SeshFx Drawer */}\r\n                    {seshFxOpen && (\r\n                        <div className=\"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-3 border border-blue-100 dark:border-blue-800/50 animate-in slide-in-from-top-2\">\r\n                            <div className=\"flex justify-between items-center mb-2\">\r\n                                <span className=\"text-xs font-bold text-brand-blue uppercase\">SeshFx Data</span>\r\n                                <button onClick={() => setSeshFxOpen(false)}><X size={14} className=\"text-gray-400 hover:text-brand-blue\" /></button>\r\n                            </div>\r\n                            <MultiSelect label=\"\" options={POPULAR_PLUGINS_LIST} initialValues={pluginsUsed} onChange={(_, val) => setPluginsUsed(val)} />\r\n                            <div className=\"mt-2 flex items-center gap-2\">\r\n                                <Paperclip size={14} className=\"text-gray-400\" />\r\n                                <input type=\"file\" className=\"text-xs text-gray-500 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:bg-white dark:file:bg-gray-700 dark:file:text-white\" onChange={e => setPresetFile(e.target.files[0])} />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"flex justify-between items-center pt-2 border-t dark:border-gray-700\">\r\n                        <div className=\"flex gap-1\">\r\n                            <label className={`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-brand-blue cursor-pointer transition ${isPosting ? 'opacity-50 pointer-events-none' : ''}`} title=\"Add Image\">\r\n                                <ImageIcon size={20} />\r\n                                <input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={e => handleFileSelect(e, 'image')} disabled={isPosting} />\r\n                            </label>\r\n                            <label className={`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-green-500 cursor-pointer transition ${isPosting ? 'opacity-50 pointer-events-none' : ''}`} title=\"Add Video\">\r\n                                <Video size={20} />\r\n                                <input type=\"file\" className=\"hidden\" accept=\"video/*\" onChange={e => handleFileSelect(e, 'video')} disabled={isPosting} />\r\n                            </label>\r\n                            <label className={`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-purple-500 cursor-pointer transition ${isPosting ? 'opacity-50 pointer-events-none' : ''}`} title=\"Add Audio Track\">\r\n                                <Music size={20} />\r\n                                <input type=\"file\" className=\"hidden\" accept=\"audio/*\" onChange={e => handleFileSelect(e, 'audio')} disabled={isPosting} />\r\n                            </label>\r\n                            <button onClick={() => setSeshFxOpen(!seshFxOpen)} disabled={isPosting} className={`p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition ${seshFxOpen ? 'bg-blue-50 dark:bg-blue-900/20 text-brand-blue' : 'text-gray-400'} ${isPosting ? 'opacity-50' : ''}`} title=\"Add Plugin Data\">\r\n                                <Sliders size={20} />\r\n                            </button>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleSubmit}\r\n                            disabled={isPosting || (!text && media.length === 0)}\r\n                            className=\"bg-brand-blue text-white px-5 py-1.5 rounded-full font-bold text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition\"\r\n                        >\r\n                            {isPosting ? <Loader2 className=\"animate-spin\" size={16} /> : <><span>Post</span> <Send size={14} /></>}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","// src/components/social/discover/DiscoverSection.jsx\r\n\r\nimport React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Loader2 } from 'lucide-react';\r\n\r\nexport default function DiscoverSection({ \r\n    title, \r\n    description, \r\n    items, \r\n    loading, \r\n    emptyMessage,\r\n    onSeeMore,\r\n    renderItem,\r\n    gridCols = \"grid-cols-1 md:grid-cols-2 lg:grid-cols-3\"\r\n}) {\r\n    if (loading) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                <div>\r\n                    <h3 className=\"text-xl font-bold dark:text-white mb-1\">{title}</h3>\r\n                    {description && (\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">{description}</p>\r\n                    )}\r\n                </div>\r\n                <div className=\"flex justify-center py-12\">\r\n                    <Loader2 className=\"animate-spin text-indigo-600\" size={32} />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!items || items.length === 0) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                <div>\r\n                    <h3 className=\"text-xl font-bold dark:text-white mb-1\">{title}</h3>\r\n                    {description && (\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">{description}</p>\r\n                    )}\r\n                </div>\r\n                <div className=\"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n                    <p className=\"text-gray-500 dark:text-gray-400\">\r\n                        {emptyMessage || 'No items found.'}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h3 className=\"text-xl font-bold dark:text-white mb-1\">{title}</h3>\r\n                    {description && (\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">{description}</p>\r\n                    )}\r\n                </div>\r\n                {onSeeMore && (\r\n                    <button\r\n                        onClick={onSeeMore}\r\n                        className=\"text-sm text-indigo-600 dark:text-indigo-400 font-semibold hover:underline\"\r\n                    >\r\n                        See More â†’\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            <div className={`grid ${gridCols} gap-4`}>\r\n                {items.map((item, idx) => (\r\n                    <motion.div\r\n                        key={item.id || idx}\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: idx * 0.05 }}\r\n                    >\r\n                        {renderItem ? renderItem(item, idx) : (\r\n                            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n                                {JSON.stringify(item)}\r\n                            </div>\r\n                        )}\r\n                    </motion.div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/DiscoverCard.jsx\r\n\r\nimport React from 'react';\r\nimport { User, Play, MapPin, Award, School, Music, Building2 } from 'lucide-react';\r\nimport UserAvatar from '../../shared/UserAvatar';\r\nimport FollowButton from '../FollowButton';\r\n\r\nexport default function DiscoverCard({ \r\n    item, \r\n    type, \r\n    onFollow, \r\n    onViewProfile, \r\n    onPlay,\r\n    isFollowing,\r\n    currentUser \r\n}) {\r\n    const getIcon = () => {\r\n        switch (type) {\r\n            case 'artist':\r\n            case 'producer':\r\n                return <User size={20} />;\r\n            case 'studio':\r\n                return <Building2 size={20} />;\r\n            case 'school':\r\n                return <School size={20} />;\r\n            case 'sound':\r\n                return <Music size={20} />;\r\n            default:\r\n                return null;\r\n        }\r\n    };\r\n\r\n    const getTitle = () => {\r\n        if (type === 'sound') {\r\n            return item.text || 'Audio Post';\r\n        }\r\n        return item.displayName || item.name || item.title || 'Unknown';\r\n    };\r\n\r\n    const getSubtitle = () => {\r\n        if (type === 'sound') {\r\n            return item.displayName || 'Unknown Artist';\r\n        }\r\n        if (type === 'artist' || type === 'producer') {\r\n            return item.role || item.activeProfileRole || 'User';\r\n        }\r\n        if (type === 'studio') {\r\n            return item.address || item.city || 'Location not specified';\r\n        }\r\n        if (type === 'school') {\r\n            return item.address || 'Location not specified';\r\n        }\r\n        return null;\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-all\">\r\n            <div className=\"flex items-start gap-3\">\r\n                {/* Avatar/Image */}\r\n                <div className=\"shrink-0\">\r\n                    {type === 'sound' ? (\r\n                        <div className=\"w-12 h-12 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center\">\r\n                            <Music size={24} className=\"text-indigo-600 dark:text-indigo-400\" />\r\n                        </div>\r\n                    ) : (\r\n                        <UserAvatar\r\n                            src={item.photoURL || item.logoURL}\r\n                            name={getTitle()}\r\n                            size=\"md\"\r\n                        />\r\n                    )}\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-start justify-between gap-2\">\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <h3 \r\n                                className=\"font-bold dark:text-white truncate cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition\"\r\n                                onClick={onViewProfile}\r\n                            >\r\n                                {getTitle()}\r\n                            </h3>\r\n                            {getSubtitle() && (\r\n                                <p className=\"text-sm text-gray-600 dark:text-gray-400 truncate mt-0.5\">\r\n                                    {getSubtitle()}\r\n                                </p>\r\n                            )}\r\n                            \r\n                            {/* Additional info */}\r\n                            {type === 'studio' && item.amenities && (\r\n                                <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\r\n                                    {item.amenities.slice(0, 2).join(', ')}\r\n                                </p>\r\n                            )}\r\n                            \r\n                            {type === 'school' && item.programs && (\r\n                                <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\r\n                                    {item.programs.length} program{item.programs.length !== 1 ? 's' : ''}\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Actions */}\r\n                        <div className=\"flex items-center gap-2 shrink-0\">\r\n                            {type === 'sound' && onPlay && (\r\n                                <button\r\n                                    onClick={onPlay}\r\n                                    className=\"p-2 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition\"\r\n                                    title=\"Play\"\r\n                                >\r\n                                    <Play size={16} fill=\"currentColor\" />\r\n                                </button>\r\n                            )}\r\n                            \r\n                            {(type === 'artist' || type === 'producer') && onFollow && (\r\n                                <FollowButton\r\n                                    isFollowing={isFollowing}\r\n                                    onToggle={onFollow}\r\n                                    size=\"sm\"\r\n                                />\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Stats */}\r\n                    {(item.followerCount || item.enrollmentCount) && (\r\n                        <div className=\"flex items-center gap-3 mt-2 text-xs text-gray-500 dark:text-gray-400\">\r\n                            {item.followerCount !== undefined && (\r\n                                <span>{item.followerCount} followers</span>\r\n                            )}\r\n                            {item.enrollmentCount !== undefined && (\r\n                                <span>{item.enrollmentCount} enrolled</span>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/utils/recommendations.js\r\n\r\n/**\r\n * Calculate similarity between two users based on:\r\n * - Followed users overlap\r\n * - Liked posts overlap\r\n * - Genre preferences\r\n * - Location proximity\r\n */\r\nexport function calculateUserSimilarity(user1, user2) {\r\n    if (!user1 || !user2) return 0;\r\n\r\n    let similarity = 0;\r\n    let factors = 0;\r\n\r\n    // Genre overlap (if available)\r\n    if (user1.genres && user2.genres) {\r\n        const genres1 = Array.isArray(user1.genres) ? user1.genres : [];\r\n        const genres2 = Array.isArray(user2.genres) ? user2.genres : [];\r\n        const commonGenres = genres1.filter(g => genres2.includes(g));\r\n        if (genres1.length > 0 || genres2.length > 0) {\r\n            similarity += (commonGenres.length / Math.max(genres1.length, genres2.length)) * 0.3;\r\n            factors += 0.3;\r\n        }\r\n    }\r\n\r\n    // Location proximity (simple string matching for now)\r\n    if (user1.zip && user2.zip) {\r\n        if (user1.zip === user2.zip) {\r\n            similarity += 0.2;\r\n        } else if (user1.zip.substring(0, 3) === user2.zip.substring(0, 3)) {\r\n            similarity += 0.1;\r\n        }\r\n        factors += 0.2;\r\n    }\r\n\r\n    // Role similarity\r\n    if (user1.activeProfileRole && user2.activeProfileRole) {\r\n        if (user1.activeProfileRole === user2.activeProfileRole) {\r\n            similarity += 0.2;\r\n        }\r\n        factors += 0.2;\r\n    }\r\n\r\n    // Account type overlap\r\n    if (user1.accountTypes && user2.accountTypes) {\r\n        const types1 = Array.isArray(user1.accountTypes) ? user1.accountTypes : [];\r\n        const types2 = Array.isArray(user2.accountTypes) ? user2.accountTypes : [];\r\n        const commonTypes = types1.filter(t => types2.includes(t));\r\n        if (types1.length > 0 || types2.length > 0) {\r\n            similarity += (commonTypes.length / Math.max(types1.length, types2.length)) * 0.3;\r\n            factors += 0.3;\r\n        }\r\n    }\r\n\r\n    // Normalize by factors used\r\n    return factors > 0 ? similarity / factors : 0;\r\n}\r\n\r\n/**\r\n * Calculate engagement score for content\r\n * Formula: (likes * 1) + (comments * 2) + (shares * 3) + (saves * 1.5)\r\n */\r\nexport function calculateEngagementScore(content) {\r\n    const likes = content.reactionCount || 0;\r\n    const comments = content.commentCount || 0;\r\n    const saves = content.saveCount || 0;\r\n    // Shares not tracked yet, but structure is ready\r\n    const shares = 0;\r\n\r\n    return (likes * 1) + (comments * 2) + (shares * 3) + (saves * 1.5);\r\n}\r\n\r\n/**\r\n * Calculate trending score with time decay\r\n * Recent activity is weighted more heavily\r\n */\r\nexport function calculateTrendingScore(content, timeRange = '7d') {\r\n    const engagementScore = calculateEngagementScore(content);\r\n    \r\n    if (!content.timestamp) return engagementScore;\r\n\r\n    const now = Date.now();\r\n    const contentTime = content.timestamp?.toMillis?.() || content.timestamp || now;\r\n    const ageInHours = (now - contentTime) / (1000 * 60 * 60);\r\n\r\n    // Time decay factor (exponential decay)\r\n    let decayFactor = 1;\r\n    if (timeRange === '24h') {\r\n        decayFactor = Math.exp(-ageInHours / 24);\r\n    } else if (timeRange === '7d') {\r\n        decayFactor = Math.exp(-ageInHours / 168); // 7 days = 168 hours\r\n    } else if (timeRange === '30d') {\r\n        decayFactor = Math.exp(-ageInHours / 720); // 30 days = 720 hours\r\n    }\r\n\r\n    return engagementScore * decayFactor;\r\n}\r\n\r\n/**\r\n * Get trending content by type\r\n * @param {string} type - Content type ('sounds', 'artists', 'producers', 'studios', 'schools')\r\n * @param {string} timeRange - Time range ('24h', '7d', '30d')\r\n * @param {Array} contentList - List of content items\r\n * @param {number} limit - Maximum number of items to return\r\n */\r\nexport function getTrendingContent(type, timeRange, contentList, limit = 10) {\r\n    if (!contentList || contentList.length === 0) return [];\r\n\r\n    // Calculate trending scores\r\n    const scored = contentList.map(item => ({\r\n        ...item,\r\n        trendingScore: calculateTrendingScore(item, timeRange)\r\n    }));\r\n\r\n    // Sort by trending score (descending)\r\n    scored.sort((a, b) => b.trendingScore - a.trendingScore);\r\n\r\n    return scored.slice(0, limit);\r\n}\r\n\r\n/**\r\n * Get personalized recommendations for a user\r\n * @param {string} userId - User ID\r\n * @param {string} type - Content type\r\n * @param {Array} allContent - All available content\r\n * @param {Object} userData - Current user's data\r\n * @param {Array} similarUsers - List of similar users\r\n * @param {number} limit - Maximum number of recommendations\r\n */\r\nexport function getPersonalizedRecommendations(userId, type, allContent, userData, similarUsers = [], limit = 10) {\r\n    if (!allContent || allContent.length === 0) return [];\r\n\r\n    // Filter out content user already follows/likes\r\n    const filtered = allContent.filter(item => {\r\n        // Skip if user is the creator\r\n        if (item.userId === userId) return false;\r\n        \r\n        // Skip if already following (would need following list)\r\n        // This is a simplified version\r\n        \r\n        return true;\r\n    });\r\n\r\n    // If we have similar users, prioritize content from them\r\n    if (similarUsers.length > 0) {\r\n        const similarUserIds = similarUsers.map(u => u.id || u.userId);\r\n        const fromSimilar = filtered.filter(item => \r\n            similarUserIds.includes(item.userId || item.id)\r\n        );\r\n        const others = filtered.filter(item => \r\n            !similarUserIds.includes(item.userId || item.id)\r\n        );\r\n        \r\n        // Combine: similar users first, then others\r\n        return [...fromSimilar, ...others].slice(0, limit);\r\n    }\r\n\r\n    // Otherwise, return by engagement score\r\n    const scored = filtered.map(item => ({\r\n        ...item,\r\n        engagementScore: calculateEngagementScore(item)\r\n    }));\r\n\r\n    scored.sort((a, b) => b.engagementScore - a.engagementScore);\r\n\r\n    return scored.slice(0, limit);\r\n}\r\n\r\n/**\r\n * Get recently created content\r\n * @param {Array} contentList - List of content items\r\n * @param {number} limit - Maximum number of items\r\n */\r\nexport function getRecentContent(contentList, limit = 10) {\r\n    if (!contentList || contentList.length === 0) return [];\r\n\r\n    // Sort by timestamp (most recent first)\r\n    const sorted = [...contentList].sort((a, b) => {\r\n        const timeA = a.timestamp?.toMillis?.() || a.timestamp || a.createdAt?.toMillis?.() || a.createdAt || 0;\r\n        const timeB = b.timestamp?.toMillis?.() || b.timestamp || b.createdAt?.toMillis?.() || b.createdAt || 0;\r\n        return timeB - timeA;\r\n    });\r\n\r\n    return sorted.slice(0, limit);\r\n}\r\n\r\n","// src/hooks/useDiscover.js\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { supabase } from '../config/supabase';\r\nimport { \r\n    getTrendingContent, \r\n    getPersonalizedRecommendations, \r\n    getRecentContent,\r\n    calculateUserSimilarity \r\n} from '../utils/recommendations';\r\n\r\nexport function useDiscover(user, userData) {\r\n    const [loading, setLoading] = useState(true);\r\n    const [sounds, setSounds] = useState([]);\r\n    const [artists, setArtists] = useState([]);\r\n    const [producers, setProducers] = useState([]);\r\n    const [studios, setStudios] = useState([]);\r\n    const [schools, setSchools] = useState([]);\r\n    const [following, setFollowing] = useState([]);\r\n\r\n    // Load following list for recommendations\r\n    useEffect(() => {\r\n        if (!user?.id && !user?.uid || !supabase) return;\r\n        const userId = user?.id || user?.uid;\r\n\r\n        const loadFollowing = async () => {\r\n            try {\r\n                const { data, error } = await supabase\r\n                    .from('follows')\r\n                    .select('following_id')\r\n                    .eq('follower_id', userId);\r\n                \r\n                if (error) throw error;\r\n                setFollowing((data || []).map(f => f.following_id));\r\n            } catch (error) {\r\n                console.error('Error loading following:', error);\r\n            }\r\n        };\r\n\r\n        loadFollowing();\r\n    }, [user?.id, user?.uid]);\r\n\r\n    // Load all discover data\r\n    useEffect(() => {\r\n        if (!user?.id && !user?.uid || !supabase) {\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const loadDiscoverData = async () => {\r\n            setLoading(true);\r\n            try {\r\n                // Load sounds (posts with audio) - using documents table for now\r\n                const { data: postsData, error: postsError } = await supabase\r\n                    .from('documents')\r\n                    .select('*')\r\n                    .eq('collection_path', `artifacts/${import.meta.env.VITE_APP_ID || 'seshnx-70c04'}/public/data/posts`)\r\n                    .order('created_at', { ascending: false })\r\n                    .limit(50);\r\n                \r\n                if (!postsError && postsData) {\r\n                    const postsList = postsData\r\n                        .map(doc => ({\r\n                            id: doc.id,\r\n                            ...doc.data\r\n                        }))\r\n                        .filter(post => post.audioUrl || post.media?.some(m => m.type === 'audio'));\r\n                    setSounds(postsList);\r\n                }\r\n\r\n                // Load artists (users with Talent role)\r\n                const artistsList = await loadUsersByRole(['Talent']);\r\n                setArtists(artistsList);\r\n\r\n                // Load producers (users with Producer or Engineer role)\r\n                const producersList = await loadUsersByRole(['Producer', 'Engineer']);\r\n                setProducers(producersList);\r\n\r\n                // Load studios (users with Studio role or isStudio flag)\r\n                const studiosList = await loadStudios();\r\n                setStudios(studiosList);\r\n\r\n                // Load schools - using documents table for now\r\n                const { data: schoolsData, error: schoolsError } = await supabase\r\n                    .from('documents')\r\n                    .select('*')\r\n                    .eq('collection_path', 'schools')\r\n                    .limit(20);\r\n                \r\n                if (!schoolsError && schoolsData) {\r\n                    const schoolsList = schoolsData.map(doc => ({\r\n                        id: doc.id,\r\n                        ...doc.data\r\n                    }));\r\n                    setSchools(schoolsList);\r\n                }\r\n\r\n            } catch (error) {\r\n                console.error('Error loading discover data:', error);\r\n            }\r\n            setLoading(false);\r\n        };\r\n\r\n        loadDiscoverData();\r\n    }, [user?.id, user?.uid]);\r\n\r\n    // Helper to load users by role\r\n    const loadUsersByRole = async (roles) => {\r\n        if (!supabase) return [];\r\n        try {\r\n            // Query public_profiles table\r\n            const { data, error } = await supabase\r\n                .from('public_profiles')\r\n                .select('*')\r\n                .limit(100);\r\n            \r\n            if (error) throw error;\r\n            \r\n            return (data || [])\r\n                .filter(profile => {\r\n                    const userRoles = profile.account_types || [];\r\n                    return roles.some(role => userRoles.includes(role));\r\n                })\r\n                .map(profile => ({\r\n                    id: profile.id,\r\n                    userId: profile.id,\r\n                    ...profile\r\n                }));\r\n        } catch (error) {\r\n            console.error('Error loading users by role:', error);\r\n            return [];\r\n        }\r\n    };\r\n\r\n    // Helper to load studios\r\n    const loadStudios = async () => {\r\n        if (!supabase) return [];\r\n        try {\r\n            // Load from documents table (legacy) and public_profiles\r\n            const { data: studiosData } = await supabase\r\n                .from('documents')\r\n                .select('*')\r\n                .eq('collection_path', 'studios')\r\n                .limit(50);\r\n            \r\n            const studiosList = (studiosData || []).map(doc => ({\r\n                id: doc.id,\r\n                ...doc.data,\r\n                isStudio: true\r\n            }));\r\n\r\n            // Also check user profiles with Studio role\r\n            const studioUsers = await loadUsersByRole(['Studio']);\r\n            \r\n            return [...studiosList, ...studioUsers];\r\n        } catch (error) {\r\n            console.error('Error loading studios:', error);\r\n            return [];\r\n        }\r\n    };\r\n\r\n    // Memoized recommendations\r\n    const recommendations = useMemo(() => {\r\n        if (!userData || loading) return {};\r\n\r\n        return {\r\n            sounds: {\r\n                trending: getTrendingContent('sounds', '7d', sounds, 10),\r\n                recent: getRecentContent(sounds, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'sounds',\r\n                    sounds,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            },\r\n            artists: {\r\n                trending: getTrendingContent('artists', '7d', artists, 10),\r\n                recent: getRecentContent(artists, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'artists',\r\n                    artists,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            },\r\n            producers: {\r\n                trending: getTrendingContent('producers', '7d', producers, 10),\r\n                recent: getRecentContent(producers, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'producers',\r\n                    producers,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            },\r\n            studios: {\r\n                trending: getTrendingContent('studios', '7d', studios, 10),\r\n                recent: getRecentContent(studios, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'studios',\r\n                    studios,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            },\r\n            schools: {\r\n                trending: getTrendingContent('schools', '7d', schools, 10),\r\n                recent: getRecentContent(schools, 10),\r\n                personalized: getPersonalizedRecommendations(\r\n                    user.uid,\r\n                    'schools',\r\n                    schools,\r\n                    userData,\r\n                    [],\r\n                    10\r\n                )\r\n            }\r\n        };\r\n    }, [sounds, artists, producers, studios, schools, userData, user?.uid, loading]);\r\n\r\n    return {\r\n        loading,\r\n        sounds,\r\n        artists,\r\n        producers,\r\n        studios,\r\n        schools,\r\n        following,\r\n        recommendations\r\n    };\r\n}\r\n\r\n","// src/components/social/discover/SoundsDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\n\r\nexport default function SoundsDiscover({ user, userData, openPublicProfile, onFollow }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n\r\n    const sounds = recommendations?.sounds || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Trending Sounds\"\r\n                description=\"Most popular audio content right now\"\r\n                items={sounds.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No trending sounds found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"sound\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId)}\r\n                        onPlay={() => {\r\n                            // Handle play - would integrate with audio player\r\n                            console.log('Play sound:', item.id);\r\n                        }}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Releases\"\r\n                description=\"Recently posted audio content\"\r\n                items={sounds.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new sounds found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"sound\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId)}\r\n                        onPlay={() => {\r\n                            console.log('Play sound:', item.id);\r\n                        }}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {sounds.personalized && sounds.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on your activity\"\r\n                    items={sounds.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"sound\"\r\n                            onViewProfile={() => openPublicProfile?.(item.userId)}\r\n                            onPlay={() => {\r\n                                console.log('Play sound:', item.id);\r\n                            }}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/ArtistsDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\nimport { useFollowSystem } from '../../../hooks/useFollowSystem';\r\n\r\nexport default function ArtistsDiscover({ user, userData, openPublicProfile }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n    const { isFollowing, toggleFollow } = useFollowSystem(user?.uid, userData);\r\n\r\n    const artists = recommendations?.artists || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Trending Artists\"\r\n                description=\"Most popular artists right now\"\r\n                items={artists.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No trending artists found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"artist\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                        isFollowing={isFollowing(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Artists\"\r\n                description=\"Recently joined artists\"\r\n                items={artists.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new artists found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"artist\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                        isFollowing={isFollowing(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {artists.personalized && artists.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on artists you follow\"\r\n                    items={artists.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"artist\"\r\n                            onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                            onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                            isFollowing={isFollowing(item.userId || item.id)}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/ProducersDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\nimport { useFollowSystem } from '../../../hooks/useFollowSystem';\r\n\r\nexport default function ProducersDiscover({ user, userData, openPublicProfile }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n    const { isFollowing, toggleFollow } = useFollowSystem(user?.uid, userData);\r\n\r\n    const producers = recommendations?.producers || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Trending Producers\"\r\n                description=\"Most popular producers right now\"\r\n                items={producers.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No trending producers found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"producer\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                        isFollowing={isFollowing(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Producers\"\r\n                description=\"Recently joined producers\"\r\n                items={producers.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new producers found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"producer\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                        isFollowing={isFollowing(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {producers.personalized && producers.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on producers you follow\"\r\n                    items={producers.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"producer\"\r\n                            onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                            onFollow={() => toggleFollow(item.userId || item.id, item)}\r\n                            isFollowing={isFollowing(item.userId || item.id)}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/StudiosDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\n\r\nexport default function StudiosDiscover({ user, userData, openPublicProfile }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n\r\n    const studios = recommendations?.studios || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Trending Studios\"\r\n                description=\"Most popular studios right now\"\r\n                items={studios.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No trending studios found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"studio\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Studios\"\r\n                description=\"Recently added studios\"\r\n                items={studios.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new studios found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"studio\"\r\n                        onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {studios.personalized && studios.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on your location and interests\"\r\n                    items={studios.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"studio\"\r\n                            onViewProfile={() => openPublicProfile?.(item.userId || item.id)}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/discover/SchoolsDiscover.jsx\r\n\r\nimport React from 'react';\r\nimport DiscoverSection from './DiscoverSection';\r\nimport DiscoverCard from './DiscoverCard';\r\nimport { useDiscover } from '../../../hooks/useDiscover';\r\n\r\nexport default function SchoolsDiscover({ user, userData }) {\r\n    const { loading, recommendations } = useDiscover(user, userData);\r\n\r\n    const schools = recommendations?.schools || {};\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <DiscoverSection\r\n                title=\"Featured Schools\"\r\n                description=\"Top music education programs\"\r\n                items={schools.trending || []}\r\n                loading={loading}\r\n                emptyMessage=\"No featured schools found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"school\"\r\n                        onViewProfile={() => {\r\n                            // Navigate to school or show details\r\n                            console.log('View school:', item.id);\r\n                        }}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            <DiscoverSection\r\n                title=\"New Schools\"\r\n                description=\"Recently added schools\"\r\n                items={schools.recent || []}\r\n                loading={loading}\r\n                emptyMessage=\"No new schools found.\"\r\n                renderItem={(item) => (\r\n                    <DiscoverCard\r\n                        item={item}\r\n                        type=\"school\"\r\n                        onViewProfile={() => {\r\n                            console.log('View school:', item.id);\r\n                        }}\r\n                    />\r\n                )}\r\n            />\r\n\r\n            {schools.personalized && schools.personalized.length > 0 && (\r\n                <DiscoverSection\r\n                    title=\"Recommended for You\"\r\n                    description=\"Based on your location and interests\"\r\n                    items={schools.personalized || []}\r\n                    loading={loading}\r\n                    emptyMessage=\"No recommendations yet.\"\r\n                    renderItem={(item) => (\r\n                        <DiscoverCard\r\n                            item={item}\r\n                            type=\"school\"\r\n                            onViewProfile={() => {\r\n                                console.log('View school:', item.id);\r\n                            }}\r\n                        />\r\n                    )}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","// src/components/social/Discover.jsx\r\n\r\nimport React, { useState } from 'react';\r\nimport { Music, User, Headphones, Building2, School } from 'lucide-react';\r\nimport SoundsDiscover from './discover/SoundsDiscover';\r\nimport ArtistsDiscover from './discover/ArtistsDiscover';\r\nimport ProducersDiscover from './discover/ProducersDiscover';\r\nimport StudiosDiscover from './discover/StudiosDiscover';\r\nimport SchoolsDiscover from './discover/SchoolsDiscover';\r\n\r\nconst DISCOVER_TABS = [\r\n    { id: 'sounds', label: 'Sounds', icon: Music },\r\n    { id: 'artists', label: 'Artists', icon: User },\r\n    { id: 'producers', label: 'Producers', icon: Headphones },\r\n    { id: 'studios', label: 'Studios', icon: Building2 },\r\n    { id: 'schools', label: 'Schools', icon: School },\r\n];\r\n\r\nexport default function Discover({ user, userData, openPublicProfile }) {\r\n    const [activeTab, setActiveTab] = useState('sounds');\r\n\r\n    const renderContent = () => {\r\n        switch (activeTab) {\r\n            case 'sounds':\r\n                return (\r\n                    <SoundsDiscover \r\n                        user={user} \r\n                        userData={userData} \r\n                        openPublicProfile={openPublicProfile}\r\n                    />\r\n                );\r\n            case 'artists':\r\n                return (\r\n                    <ArtistsDiscover \r\n                        user={user} \r\n                        userData={userData} \r\n                        openPublicProfile={openPublicProfile}\r\n                    />\r\n                );\r\n            case 'producers':\r\n                return (\r\n                    <ProducersDiscover \r\n                        user={user} \r\n                        userData={userData} \r\n                        openPublicProfile={openPublicProfile}\r\n                    />\r\n                );\r\n            case 'studios':\r\n                return (\r\n                    <StudiosDiscover \r\n                        user={user} \r\n                        userData={userData} \r\n                        openPublicProfile={openPublicProfile}\r\n                    />\r\n                );\r\n            case 'schools':\r\n                return (\r\n                    <SchoolsDiscover \r\n                        user={user} \r\n                        userData={userData}\r\n                    />\r\n                );\r\n            default:\r\n                return null;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto pb-20\">\r\n            {/* Tab Navigation */}\r\n            <div className=\"flex items-center gap-2 mb-6 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm overflow-x-auto\">\r\n                {DISCOVER_TABS.map(tab => {\r\n                    const Icon = tab.icon;\r\n                    return (\r\n                        <button\r\n                            key={tab.id}\r\n                            onClick={() => setActiveTab(tab.id)}\r\n                            className={`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all whitespace-nowrap ${\r\n                                activeTab === tab.id\r\n                                    ? 'bg-brand-blue text-white shadow-md'\r\n                                    : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                            }`}\r\n                        >\r\n                            <Icon size={16} />\r\n                            <span>{tab.label}</span>\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"mt-6\">\r\n                {renderContent()}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, { useState, useEffect, useMemo } from 'react';\r\nimport { Loader2, RefreshCw, Users, Compass, UserPlus, Search } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { getPosts, createPost, getProfilesByIds } from '../config/neonQueries';\r\n\r\nimport PostCard from './social/PostCard';\r\nimport CreatePostWidget from './social/CreatePostWidget';\r\nimport ReportModal from './ReportModal';\r\nimport Discover from './social/Discover';\r\nimport { useFollowSystem } from '../hooks/useFollowSystem';\r\nimport FollowButton from './social/FollowButton';\r\nimport UserAvatar from './shared/UserAvatar';\r\nimport { useLanguage } from '../contexts/LanguageContext';\r\n\r\n// Feed mode tabs\r\nconst FEED_MODES = {\r\n    FOR_YOU: 'for_you',\r\n    FOLLOWING: 'following',\r\n    DISCOVER: 'discover'\r\n};\r\n\r\nexport default function SocialFeed({ user, userData, openPublicProfile }) {\r\n    const [posts, setPosts] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [reportTarget, setReportTarget] = useState(null);\r\n    const [feedMode, setFeedMode] = useState(FEED_MODES.FOR_YOU);\r\n    const [suggestedUsers, setSuggestedUsers] = useState([]);\r\n    const [loadingSuggestions, setLoadingSuggestions] = useState(false);\r\n    const [hasNewPosts, setHasNewPosts] = useState(false);\r\n\r\n    // Get feed algorithm from settings\r\n    const { t } = useLanguage();\r\n    const feedAlgorithm = userData?.settings?.social?.feedAlgorithm || 'recommended';\r\n    const autoPlayVideos = userData?.settings?.social?.autoPlayVideos !== false;\r\n    const showSuggestedAccounts = userData?.settings?.social?.showSuggestedAccounts !== false;\r\n\r\n    // Use the follow system hook\r\n    const userId = user?.id || user?.uid;\r\n    const {\r\n        following,\r\n        stats,\r\n        loading: followLoading,\r\n        isFollowing,\r\n        toggleFollow,\r\n        getFollowingIds\r\n    } = useFollowSystem(userId, userData);\r\n\r\n    // Memoize following IDs for feed filtering\r\n    const followingIds = useMemo(() => getFollowingIds(), [following]);\r\n\r\n    // Load suggested users when on Following tab with no follows\r\n    useEffect(() => {\r\n        const userId = user?.id || user?.uid;\r\n        if (feedMode === FEED_MODES.FOLLOWING && followingIds.length === 0 && userId) {\r\n            loadSuggestedUsers();\r\n        }\r\n    }, [feedMode, followingIds.length, user?.id, user?.uid]);\r\n\r\n    const loadSuggestedUsers = async () => {\r\n        setLoadingSuggestions(true);\r\n        try {\r\n            if (!user?.id && !user?.uid) return;\r\n\r\n            const userId = user.id || user.uid;\r\n\r\n            // Get recent posts as suggestions (excluding current user)\r\n            const posts = await getPosts({ limit: 20 });\r\n\r\n            // Filter out current user's posts\r\n            const otherUsersPosts = posts.filter(p => p.user_id !== userId);\r\n\r\n            // Extract unique user IDs from posts\r\n            const uniqueUserIds = [...new Set(otherUsersPosts.map(p => p.user_id))];\r\n\r\n            // Fetch profiles for these users\r\n            let profilePhotos = {};\r\n            if (uniqueUserIds.length > 0) {\r\n                const profiles = await getProfilesByIds(uniqueUserIds);\r\n                profiles.forEach(p => {\r\n                    profilePhotos[p.user_id] = p.avatar_url || p.photo_url;\r\n                });\r\n            }\r\n\r\n            // Build unique users map with fresh photos\r\n            const usersMap = new Map();\r\n            otherUsersPosts.forEach(post => {\r\n                if (!usersMap.has(post.user_id)) {\r\n                    usersMap.set(post.user_id, {\r\n                        userId: post.user_id,\r\n                        displayName: post.display_name,\r\n                        photoURL: profilePhotos[post.user_id] || null,\r\n                        role: post.role\r\n                    });\r\n                }\r\n            });\r\n\r\n            setSuggestedUsers(Array.from(usersMap.values()).slice(0, 5));\r\n        } catch (error) {\r\n            console.error('Error loading suggestions:', error);\r\n        }\r\n        setLoadingSuggestions(false);\r\n    };\r\n\r\n    // Skeleton loader for feed\r\n    const renderSkeleton = () => {\r\n        const skeletonItems = Array.from({ length: 3 });\r\n        return (\r\n            <div className=\"space-y-4 p-fluid\">\r\n                <div className=\"bg-white dark:bg-[#1f2128] rounded-2xl border border-gray-200 dark:border-gray-700 p-4 animate-pulse\">\r\n                    <div className=\"h-10 bg-gray-200 dark:bg-gray-700 rounded-xl w-48 mb-3\"></div>\r\n                    <div className=\"h-14 bg-gray-100 dark:bg-gray-800 rounded-xl w-full mb-2\"></div>\r\n                </div>\r\n                {skeletonItems.map((_, idx) => (\r\n                    <div key={idx} className=\"bg-white dark:bg-[#1f2128] rounded-2xl border border-gray-200 dark:border-gray-700 p-4 animate-pulse space-y-3\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700\"></div>\r\n                            <div className=\"flex-1\">\r\n                                <div className=\"h-3.5 w-32 bg-gray-200 dark:bg-gray-700 rounded-full mb-2\"></div>\r\n                                <div className=\"h-3 w-20 bg-gray-100 dark:bg-gray-800 rounded-full\"></div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"h-3 w-5/6 bg-gray-100 dark:bg-gray-800 rounded-full\"></div>\r\n                        <div className=\"h-3 w-2/3 bg-gray-100 dark:bg-gray-800 rounded-full\"></div>\r\n                        <div className=\"h-48 bg-gray-100 dark:bg-gray-800 rounded-xl\"></div>\r\n                        <div className=\"flex gap-3\">\r\n                            <div className=\"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded-full\"></div>\r\n                            <div className=\"h-3 w-12 bg-gray-200 dark:bg-gray-700 rounded-full\"></div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    // Main feed loader\r\n    useEffect(() => {\r\n        setLoading(true);\r\n\r\n        const loadFeed = async () => {\r\n            try {\r\n                // Set limit based on feed mode\r\n                const limitCount = (feedMode === FEED_MODES.FOLLOWING && followingIds.length > 0) ? 50 : 20;\r\n\r\n                // Fetch posts from Neon\r\n                const posts = await getPosts({ limit: limitCount });\r\n\r\n                let newPosts = posts.map(post => ({\r\n                    id: post.id,\r\n                    ...post,\r\n                    userId: post.user_id,\r\n                    displayName: post.display_name,\r\n                    authorPhoto: post.author_photo,\r\n                    timestamp: post.created_at,\r\n                    commentCount: post.comment_count || 0,\r\n                    reactionCount: post.reaction_count || 0,\r\n                    saveCount: post.save_count || 0\r\n                }));\r\n\r\n                // Apply feed algorithm based on settings (only for \"For You\" feed)\r\n                if (feedMode === FEED_MODES.FOR_YOU) {\r\n                    if (feedAlgorithm === 'following') {\r\n                        // Show only following posts\r\n                        if (followingIds.length > 0) {\r\n                            newPosts = newPosts.filter(p => followingIds.includes(p.userId));\r\n                        } else {\r\n                            newPosts = [];\r\n                        }\r\n                    } else if (feedAlgorithm === 'chronological') {\r\n                        // Already sorted by created_at desc, no changes needed\r\n                    } else {\r\n                        // Recommended algorithm (default) - prioritize posts with more engagement\r\n                        newPosts.sort((a, b) => {\r\n                            const aScore = (a.reactionCount || 0) * 2 + (a.commentCount || 0) * 3 + (a.saveCount || 0);\r\n                            const bScore = (b.reactionCount || 0) * 2 + (b.commentCount || 0) * 3 + (b.saveCount || 0);\r\n                            return bScore - aScore;\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // Client-side filtering for Following feed\r\n                if (feedMode === FEED_MODES.FOLLOWING && followingIds.length > 0) {\r\n                    const userId = user?.id || user?.uid;\r\n                    newPosts = newPosts.filter(post =>\r\n                        followingIds.includes(post.userId) || post.userId === userId\r\n                    );\r\n                }\r\n\r\n                setPosts(newPosts);\r\n                setLoading(false);\r\n            } catch (error) {\r\n                console.error(\"Feed error:\", error);\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        loadFeed();\r\n\r\n        // Set up polling to check for new posts (every 30 seconds)\r\n        const pollInterval = setInterval(async () => {\r\n            try {\r\n                const posts = await getPosts({ limit: 10 });\r\n                const currentUserId = user?.id || user?.uid;\r\n\r\n                // Check if there are new posts from other users\r\n                const newPostsFromOthers = posts.some(p => {\r\n                    const isNew = !posts.find(existingPost => existingPost.id === p.id);\r\n                    const isFromOther = p.user_id !== currentUserId;\r\n\r\n                    if (feedMode === FEED_MODES.FOLLOWING && followingIds.length > 0) {\r\n                        return isNew && isFromOther && followingIds.includes(p.user_id);\r\n                    } else if (feedMode === FEED_MODES.FOR_YOU) {\r\n                        return isNew && isFromOther;\r\n                    }\r\n                    return false;\r\n                });\r\n\r\n                if (newPostsFromOthers) {\r\n                    setHasNewPosts(true);\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Polling error:\", error);\r\n            }\r\n        }, 30000);\r\n\r\n        return () => {\r\n            clearInterval(pollInterval);\r\n        };\r\n    }, [feedMode, followingIds, feedAlgorithm, user?.id, user?.uid]);\r\n\r\n    const handlePost = async (postPayload) => {\r\n        if (!user) return;\r\n        try {\r\n            const userId = user.id || user.uid;\r\n\r\n            // Process attachments from postPayload\r\n            const attachments = postPayload.attachments || [];\r\n\r\n            await createPost({\r\n                user_id: userId,\r\n                display_name: userData?.effectiveDisplayName || `${userData?.firstName || 'User'} ${userData?.lastName || ''}`.trim(),\r\n                author_photo: userData?.photoURL || null,\r\n                role: userData?.activeProfileRole || 'User',\r\n                text: postPayload.text || null,\r\n                content: postPayload.text || null, // Also set content for compatibility\r\n                attachments: attachments,\r\n                media_urls: attachments.map(a => a.url), // For backward compatibility\r\n                media_type: attachments.length > 0 ? attachments[0].type : null,\r\n                seshfx: postPayload.seshFx || null,\r\n                reactions: {},\r\n                reaction_count: 0,\r\n                comment_count: 0,\r\n                save_count: 0,\r\n                visibility: 'public'\r\n            });\r\n        } catch (e) {\r\n            console.error(\"Failed to post:\", e);\r\n            alert(\"Could not post update. Please try again.\");\r\n        }\r\n    };\r\n\r\n    const containerVariants = {\r\n        hidden: { opacity: 0 },\r\n        show: {\r\n            opacity: 1,\r\n            transition: { staggerChildren: 0.08 }\r\n        }\r\n    };\r\n\r\n    // Suggested user card component\r\n    const SuggestedUserCard = ({ suggestedUser }) => (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 hover:border-brand-blue/30 transition-all\"\r\n        >\r\n            <div\r\n                className=\"flex items-center gap-3 cursor-pointer flex-1 min-w-0\"\r\n                onClick={() => openPublicProfile?.(suggestedUser.userId)}\r\n            >\r\n                <UserAvatar\r\n                    src={suggestedUser.photoURL}\r\n                    name={suggestedUser.displayName}\r\n                    size=\"md\"\r\n                />\r\n                <div className=\"min-w-0\">\r\n                    <h4 className=\"font-bold text-sm dark:text-white truncate hover:text-brand-blue transition\">\r\n                        {suggestedUser.displayName}\r\n                    </h4>\r\n                    <p className=\"text-xs text-gray-500 truncate\">{suggestedUser.role}</p>\r\n                </div>\r\n            </div>\r\n            <FollowButton\r\n                isFollowing={isFollowing(suggestedUser.userId)}\r\n                onToggle={() => toggleFollow(suggestedUser.userId, suggestedUser)}\r\n                size=\"sm\"\r\n                variant=\"default\"\r\n            />\r\n        </motion.div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto pb-20\">\r\n            {/* Create Post Widget */}\r\n            <CreatePostWidget\r\n                user={user}\r\n                userData={userData}\r\n                onPost={handlePost}\r\n            />\r\n\r\n            {/* Feed Mode Toggle */}\r\n            <div className=\"flex items-center gap-2 mb-4 bg-white dark:bg-dark-card p-1.5 rounded-xl border dark:border-gray-700 shadow-sm\">\r\n                <button\r\n                    onClick={() => setFeedMode(FEED_MODES.FOR_YOU)}\r\n                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${feedMode === FEED_MODES.FOR_YOU\r\n                        ? 'bg-brand-blue text-white shadow-md'\r\n                        : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                        }`}\r\n                >\r\n                    <Compass size={16} />\r\n                    <span>{t('forYou')}</span>\r\n                </button>\r\n                <button\r\n                    onClick={() => setFeedMode(FEED_MODES.FOLLOWING)}\r\n                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${feedMode === FEED_MODES.FOLLOWING\r\n                        ? 'bg-brand-blue text-white shadow-md'\r\n                        : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                        }`}\r\n                >\r\n                    <Users size={16} />\r\n                    <span>{t('following')}</span>\r\n                    {stats.followingCount > 0 && (\r\n                        <span className={`text-xs px-1.5 py-0.5 rounded-full ${feedMode === FEED_MODES.FOLLOWING\r\n                            ? 'bg-white/20'\r\n                            : 'bg-gray-200 dark:bg-gray-700'\r\n                            }`}>\r\n                            {stats.followingCount}\r\n                        </span>\r\n                    )}\r\n                </button>\r\n                <button\r\n                    onClick={() => setFeedMode(FEED_MODES.DISCOVER)}\r\n                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all ${feedMode === FEED_MODES.DISCOVER\r\n                        ? 'bg-brand-blue text-white shadow-md'\r\n                        : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'\r\n                        }`}\r\n                >\r\n                    <Search size={16} />\r\n                    <span>{t('discover')}</span>\r\n                </button>\r\n            </div>\r\n\r\n            {/* New Posts Banner */}\r\n            <AnimatePresence>\r\n                {hasNewPosts && feedMode !== FEED_MODES.DISCOVER && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: -20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: -20 }}\r\n                        className=\"mb-4\"\r\n                    >\r\n                        <button\r\n                            onClick={() => window.location.reload()}\r\n                            className=\"w-full flex items-center justify-center gap-2 py-3 px-4 bg-gradient-to-r from-brand-blue to-blue-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all\"\r\n                        >\r\n                            <RefreshCw size={18} />\r\n                            <span>There Are New Posts.</span>\r\n                            <span className=\"underline underline-offset-2\">Refresh?</span>\r\n                        </button>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Feed Content */}\r\n            {feedMode === FEED_MODES.DISCOVER ? (\r\n                <Discover\r\n                    user={user}\r\n                    userData={userData}\r\n                    openPublicProfile={openPublicProfile}\r\n                />\r\n            ) : loading || followLoading ? (\r\n                renderSkeleton()\r\n            ) : (\r\n                <>\r\n                    {/* Following tab empty state with suggestions */}\r\n                    {feedMode === FEED_MODES.FOLLOWING && followingIds.length === 0 && (\r\n                        <motion.div\r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            className=\"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-6 border border-blue-100 dark:border-blue-800/30\"\r\n                        >\r\n                            <div className=\"text-center mb-6\">\r\n                                <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-brand-blue/10 flex items-center justify-center\">\r\n                                    <UserPlus size={28} className=\"text-brand-blue\" />\r\n                                </div>\r\n                                <h3 className=\"text-lg font-bold dark:text-white mb-2\">\r\n                                    Start following creators\r\n                                </h3>\r\n                                <p className=\"text-sm text-gray-600 dark:text-gray-400 max-w-sm mx-auto\">\r\n                                    Follow artists, engineers, and studios to see their posts in your Following feed.\r\n                                </p>\r\n                            </div>\r\n\r\n                            {/* Suggested users - only show if setting is enabled */}\r\n                            {showSuggestedAccounts && (\r\n                                <>\r\n                                    {loadingSuggestions ? (\r\n                                        <div className=\"space-y-2\">\r\n                                            <h4 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3\">\r\n                                                Suggested for you\r\n                                            </h4>\r\n                                            {[1, 2, 3].map(i => (\r\n                                                <div key={i} className=\"flex items-center justify-between p-3 bg-white dark:bg-dark-card rounded-xl border dark:border-gray-700 animate-pulse\">\r\n                                                    <div className=\"flex items-center gap-3 flex-1\">\r\n                                                        <div className=\"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700\" />\r\n                                                        <div className=\"flex-1 space-y-2\">\r\n                                                            <div className=\"h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded\" />\r\n                                                            <div className=\"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded\" />\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className=\"h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded-lg\" />\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    ) : suggestedUsers.length > 0 && (\r\n                                        <div className=\"space-y-2\">\r\n                                            <h4 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3\">\r\n                                                Suggested for you\r\n                                            </h4>\r\n                                            {suggestedUsers.map(suggestedUser => (\r\n                                                <SuggestedUserCard\r\n                                                    key={suggestedUser.userId}\r\n                                                    suggestedUser={suggestedUser}\r\n                                                />\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                </>\r\n                            )}\r\n                        </motion.div>\r\n                    )}\r\n\r\n                    {/* Posts */}\r\n                    <motion.div\r\n                        variants={containerVariants}\r\n                        initial=\"hidden\"\r\n                        animate=\"show\"\r\n                        className=\"space-y-4\"\r\n                    >\r\n                        <AnimatePresence mode='popLayout'>\r\n                            {posts.map(post => (\r\n                                <PostCard\r\n                                    key={post.id}\r\n                                    post={post}\r\n                                    currentUser={user}\r\n                                    currentUserData={userData}\r\n                                    openPublicProfile={openPublicProfile || (() => { })}\r\n                                    onReport={() => setReportTarget(post)}\r\n                                    onDelete={(postId) => setPosts(prev => prev.filter(p => p.id !== postId))}\r\n                                    isFollowingAuthor={isFollowing(post.userId)}\r\n                                    onToggleFollow={() => toggleFollow(post.userId, {\r\n                                        displayName: post.displayName,\r\n                                        photoURL: post.authorPhoto,\r\n                                        role: post.role\r\n                                    })}\r\n                                    autoPlayVideos={autoPlayVideos}\r\n                                />\r\n                            ))}\r\n                        </AnimatePresence>\r\n\r\n                        {posts.length === 0 && feedMode === FEED_MODES.FOR_YOU && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0 }}\r\n                                animate={{ opacity: 1 }}\r\n                                className=\"text-center py-10 text-gray-500\"\r\n                            >\r\n                                <RefreshCw className=\"mx-auto mb-2 opacity-50\" size={32} />\r\n                                <p>{t('noPosts')}. {t('beFirst')}</p>\r\n                            </motion.div>\r\n                        )}\r\n\r\n                        {posts.length === 0 && feedMode === FEED_MODES.FOLLOWING && followingIds.length > 0 && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0 }}\r\n                                animate={{ opacity: 1 }}\r\n                                className=\"text-center py-10 text-gray-500\"\r\n                            >\r\n                                <Users className=\"mx-auto mb-2 opacity-50\" size={32} />\r\n                                <p>{t('noPostsFollowing')}.</p>\r\n                                <button\r\n                                    onClick={() => setFeedMode(FEED_MODES.FOR_YOU)}\r\n                                    className=\"mt-3 text-brand-blue hover:underline text-sm font-medium\"\r\n                                >\r\n                                    {t('browseForYou')}\r\n                                </button>\r\n                            </motion.div>\r\n                        )}\r\n                    </motion.div>\r\n                </>\r\n            )}\r\n\r\n            {/* Report Modal */}\r\n            {reportTarget && (\r\n                <ReportModal\r\n                    user={user}\r\n                    target={{\r\n                        id: reportTarget.id,\r\n                        type: 'Post',\r\n                        summary: reportTarget.text ? reportTarget.text.substring(0, 50) : 'Media Post'\r\n                    }}\r\n                    onClose={() => setReportTarget(null)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":["CommentSection","post","currentUser","currentUserData","blockedUsers","onCountChange","comments","setComments","useState","text","setText","loading","setLoading","useEffect","loadComments","interval","data","getComments","filtered","c","error","handleSubmit","e","userId","displayName","commentContent","createComment","updatePostCommentCount","createNotification","_a","handleDelete","commentId","deleteComment","jsxs","jsx","comment","UserAvatar","Send","REACTION_SET","renderText","part","i","cardVariants","PostCard","openPublicProfile","onReport","onDelete","isFollowingAuthor","onToggleFollow","autoPlayVideos","showComments","setShowComments","commentCount","setCommentCount","isSaved","setIsSaved","showReactionMenu","setShowReactionMenu","showMoreMenu","setShowMoreMenu","linkCopied","setLinkCopied","savingPost","setSavingPost","menuRef","useRef","moreMenuRef","isOwnPost","myReaction","reactionCounts","acc","emoji","totalReactions","a","checkIsSaved","handleClickOutside","event","handleReaction","wasReacted","currentReactions","newReactions","updatePost","increment","toast","handleSavePost","unsavePost","updatePostSaveCount","savePost","_b","handleShare","shareUrl","copyLink","url","handleDeletePost","deletePost","motion","MoreHorizontal","AnimatePresence","Link2","Fragment","UserPlus","Flag","Trash2","att","StarFieldVisualizer","count","Smile","MessageCircle","Check","Share2","Bookmark","CreatePostWidget","user","userData","onPost","media","setMedia","seshFxOpen","setSeshFxOpen","pluginsUsed","setPluginsUsed","presetFile","setPresetFile","isPosting","setIsPosting","uploadProgress","setUploadProgress","uploadMedia","useVercelUpload","handleFileSelect","type","file","previewUrl","removeMedia","index","_","totalUploads","completedUploads","updateProgress","uploadedMedia","m","result","presetUrl","res","postPayload","Loader2","Music","X","MultiSelect","POPULAR_PLUGINS_LIST","val","Paperclip","ImageIcon","Video","Sliders","DiscoverSection","title","description","items","emptyMessage","onSeeMore","renderItem","gridCols","item","idx","DiscoverCard","onFollow","onViewProfile","onPlay","isFollowing","getTitle","getSubtitle","Play","FollowButton","calculateEngagementScore","content","likes","saves","calculateTrendingScore","timeRange","engagementScore","now","contentTime","ageInHours","decayFactor","getTrendingContent","contentList","limit","scored","b","getPersonalizedRecommendations","allContent","similarUsers","similarUserIds","u","fromSimilar","others","getRecentContent","timeA","_d","_c","_f","_e","_h","_g","useDiscover","sounds","setSounds","artists","setArtists","producers","setProducers","studios","setStudios","schools","setSchools","following","setFollowing","supabase","f","postsData","postsError","postsList","doc","artistsList","loadUsersByRole","producersList","studiosList","loadStudios","schoolsData","schoolsError","schoolsList","roles","profile","userRoles","role","studiosData","studioUsers","recommendations","useMemo","SoundsDiscover","ArtistsDiscover","toggleFollow","useFollowSystem","ProducersDiscover","StudiosDiscover","SchoolsDiscover","DISCOVER_TABS","User","Headphones","Building2","School","Discover","activeTab","setActiveTab","renderContent","tab","Icon","FEED_MODES","SocialFeed","posts","setPosts","reportTarget","setReportTarget","feedMode","setFeedMode","suggestedUsers","setSuggestedUsers","loadingSuggestions","setLoadingSuggestions","hasNewPosts","setHasNewPosts","t","useLanguage","feedAlgorithm","showSuggestedAccounts","stats","followLoading","getFollowingIds","followingIds","loadSuggestedUsers","otherUsersPosts","getPosts","p","uniqueUserIds","profilePhotos","getProfilesByIds","usersMap","renderSkeleton","skeletonItems","limitCount","newPosts","aScore","pollInterval","currentUserId","isNew","existingPost","isFromOther","handlePost","attachments","createPost","containerVariants","SuggestedUserCard","suggestedUser","Compass","Users","Search","RefreshCw","postId","prev","ReportModal"],"mappings":"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"}