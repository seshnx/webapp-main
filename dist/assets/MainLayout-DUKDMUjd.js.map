{"version":3,"mappings":"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","names":["retryLazyLoad","importFn","retries","delay","lazy","resolve","reject","attempt","attemptNumber","promise","module","error","Sidebar","__vitePreload","Navbar","PublicProfileModal","Dashboard","SocialFeed","ChatInterface","BookingSystem","Marketplace","TechServices","PaymentsManager","ProfileManager","BusinessCenter","LegalDocs","EduStudentDashboard","EduInternDashboard","EduStaffDashboard","EduAdminDashboard","LoadingFallback","jsx","Loader2","MainLayout","user","userData","loading","darkMode","toggleTheme","handleLogout","navigate","useNavigate","location","useLocation","getTabFromPath","path","activeTab","setActiveTab","useState","sidebarOpen","setSidebarOpen","subProfiles","setSubProfiles","tokenBalance","setTokenBalance","viewingProfile","setViewingProfile","pendingChatTarget","setPendingChatTarget","isInitializingRef","useRef","fromPathnameRef","prevPathnameRef","isNavigatingRef","useEffect","newTab","prevTab","route","supabase","data","profiles","profile","err","handleRoleSwitch","newRole","openPublicProfile","useCallback","uid","name","clearPendingChatTarget","renderContent","jsxs","ErrorBoundary","Suspense","SchoolProvider"],"ignoreList":[],"sources":["../../src/components/MainLayout.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback, Suspense, lazy } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { SchoolProvider } from '../contexts/SchoolContext';\nimport { supabase } from '../config/supabase';\nimport { Loader2 } from 'lucide-react';\nimport ErrorBoundary from './shared/ErrorBoundary';\n\n// Retry wrapper for lazy loading to handle initialization errors\nconst retryLazyLoad = (importFn, retries = 3, delay = 100) => {\n  return lazy(() => {\n    return new Promise((resolve, reject) => {\n      const attempt = (attemptNumber) => {\n        // Wrap in try-catch to handle synchronous errors\n        try {\n          const promise = importFn();\n          // If it's already a promise, handle it\n          if (promise && typeof promise.then === 'function') {\n            promise\n              .then((module) => {\n                // Ensure we get the default export\n                resolve(module.default ? module : { default: module });\n              })\n              .catch((error) => {\n                if (attemptNumber < retries) {\n                  console.warn(`Lazy load failed, retrying... (${attemptNumber + 1}/${retries})`, error);\n                  setTimeout(() => attempt(attemptNumber + 1), delay * (attemptNumber + 1));\n                } else {\n                  console.error('Lazy load failed after retries:', error);\n                  reject(error);\n                }\n              });\n          } else {\n            resolve(promise);\n          }\n        } catch (error) {\n          // Handle synchronous errors (like circular dependencies)\n          if (attemptNumber < retries) {\n            console.warn(`Lazy load sync error, retrying... (${attemptNumber + 1}/${retries})`, error);\n            setTimeout(() => attempt(attemptNumber + 1), delay * (attemptNumber + 1));\n          } else {\n            console.error('Lazy load failed after retries (sync error):', error);\n            reject(error);\n          }\n        }\n      };\n      attempt(0);\n    });\n  });\n};\n\n// Lazy load ALL components to prevent initialization errors with retry mechanism\nconst Sidebar = retryLazyLoad(() => import('./Sidebar'));\nconst Navbar = retryLazyLoad(() => import('./Navbar'));\nconst PublicProfileModal = retryLazyLoad(() => import('./PublicProfileModal'));\nconst Dashboard = retryLazyLoad(() => import('./Dashboard'));\nconst SocialFeed = retryLazyLoad(() => import('./SocialFeed'));\nconst ChatInterface = retryLazyLoad(() => import('./ChatInterface'));\nconst BookingSystem = retryLazyLoad(() => import('./BookingSystem'));\nconst Marketplace = retryLazyLoad(() => import('./Marketplace'));\nconst TechServices = retryLazyLoad(() => import('./TechServices'));\nconst PaymentsManager = retryLazyLoad(() => import('./PaymentsManager'));\nconst ProfileManager = retryLazyLoad(() => import('./ProfileManager'));\nconst BusinessCenter = retryLazyLoad(() => import('./BusinessCenter'));\nconst LegalDocs = retryLazyLoad(() => import('./LegalDocs'));\nconst EduStudentDashboard = retryLazyLoad(() => import('./EDU/EduStudentDashboard'));\nconst EduInternDashboard = retryLazyLoad(() => import('./EDU/EduInternDashboard'));\nconst EduStaffDashboard = retryLazyLoad(() => import('./EDU/EduStaffDashboard'));\nconst EduAdminDashboard = retryLazyLoad(() => import('./EDU/EduAdminDashboard'));\n\n// Shared loading fallback component\nconst LoadingFallback = () => (\n  <div className=\"flex items-center justify-center p-4\">\n    <Loader2 className=\"animate-spin text-brand-blue\" size={24} />\n  </div>\n);\n\nexport default function MainLayout({ \n  user, \n  userData, \n  loading, \n  darkMode, \n  toggleTheme, \n  handleLogout \n}) {\n  // CRITICAL: Call hooks first before using them in state initializers\n  const navigate = useNavigate();\n  const location = useLocation();\n  \n  // Helper function to get tab from pathname\n  const getTabFromPath = (path) => {\n    if (path === '/') return 'dashboard';\n    if (path === '/feed' || path === '/social') return 'feed';\n    if (path === '/messages' || path === '/chat') return 'messages';\n    if (path === '/bookings') return 'bookings';\n    if (path === '/marketplace') return 'marketplace';\n    if (path === '/tech') return 'tech';\n    if (path === '/payments' || path === '/billing') return 'payments';\n    if (path === '/profile') return 'profile';\n    if (path === '/business-center') return 'business-center';\n    if (path === '/legal') return 'legal';\n    if (path === '/studio-ops') return 'studio-ops';\n    if (path.startsWith('/edu-')) return path.substring(1);\n    return 'dashboard'; // default\n  };\n\n  // Initialize activeTab from current pathname (now location is available)\n  const [activeTab, setActiveTab] = useState(() => getTabFromPath(location.pathname));\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const [subProfiles, setSubProfiles] = useState({});\n  const [tokenBalance, setTokenBalance] = useState(0);\n  const [viewingProfile, setViewingProfile] = useState(null);\n  const [pendingChatTarget, setPendingChatTarget] = useState(null);\n  \n  // Track if we're initializing to prevent navigation loops\n  const isInitializingRef = useRef(true);\n  // Track if activeTab change came from pathname (to prevent navigation loop)\n  const fromPathnameRef = useRef(false);\n  // Track previous pathname to detect actual changes\n  const prevPathnameRef = useRef(location.pathname);\n  // Track if user is currently navigating (to prevent pathname sync from overriding)\n  const isNavigatingRef = useRef(false);\n\n  // Sync activeTab with route (pathname is source of truth)\n  useEffect(() => {\n    const path = location.pathname;\n    \n    // Only sync if pathname actually changed (not just a re-render)\n    if (prevPathnameRef.current === path) {\n      // Still mark initialization as complete even if pathname didn't change\n      if (isInitializingRef.current) {\n        isInitializingRef.current = false;\n      }\n      return;\n    }\n    \n    prevPathnameRef.current = path;\n    const newTab = getTabFromPath(path);\n    \n    // If we were navigating, this is the completion of that navigation\n    // Reset the flag and update activeTab\n    if (isNavigatingRef.current) {\n      isNavigatingRef.current = false;\n    }\n    \n    // Always update from pathname (pathname is source of truth)\n    // Use functional update to compare against latest state\n    setActiveTab(prevTab => {\n      if (prevTab !== newTab) {\n        fromPathnameRef.current = true; // Mark that this change came from pathname\n        return newTab;\n      }\n      return prevTab; // No change needed\n    });\n    \n    // Mark initialization as complete after first sync\n    if (isInitializingRef.current) {\n      isInitializingRef.current = false;\n    }\n  }, [location.pathname]); // Only depend on pathname\n\n  // Update URL when tab changes (only if user-initiated, not from pathname sync)\n  useEffect(() => {\n    // Skip navigation during initialization\n    if (isInitializingRef.current) {\n      return;\n    }\n    \n    // Skip navigation if the change came from pathname sync\n    if (fromPathnameRef.current) {\n      fromPathnameRef.current = false; // Reset flag\n      return;\n    }\n    \n    const tabRoutes = {\n      'dashboard': '/',\n      'feed': '/feed',\n      'messages': '/messages',\n      'bookings': '/bookings',\n      'marketplace': '/marketplace',\n      'tech': '/tech',\n      'payments': '/payments',\n      'profile': '/profile',\n      'business-center': '/business-center',\n      'legal': '/legal',\n      'edu-student': '/edu-student',\n      'edu-intern': '/edu-intern',\n      'edu-overview': '/edu-overview',\n      'edu-admin': '/edu-admin',\n      'studio-ops': '/studio-ops',\n    };\n\n    const route = tabRoutes[activeTab];\n    // Only navigate if route exists and pathname doesn't match\n    if (route && location.pathname !== route) {\n      isNavigatingRef.current = true; // Mark that we're navigating\n      navigate(route, { replace: true });\n    }\n  }, [activeTab, navigate, location.pathname]);\n\n  // Load sub-profiles\n  useEffect(() => {\n    if (!user?.id || !supabase) return;\n\n    const loadSubProfiles = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('sub_profiles')\n          .select('*')\n          .eq('user_id', user.id);\n\n        if (error) {\n          console.warn('Error loading sub-profiles:', error);\n          return;\n        }\n\n        const profiles = {};\n        data?.forEach(profile => {\n          profiles[profile.role] = profile;\n        });\n        setSubProfiles(profiles);\n      } catch (err) {\n        console.error('Failed to load sub-profiles:', err);\n      }\n    };\n\n    loadSubProfiles();\n  }, [user?.id]);\n\n  // Load token balance\n  useEffect(() => {\n    if (!user?.id || !supabase) return;\n\n    const loadBalance = async () => {\n      try {\n        const { data } = await supabase\n          .from('wallets')\n          .select('balance')\n          .eq('user_id', user.id)\n          .maybeSingle();\n\n        if (data) {\n          setTokenBalance(data.balance || 0);\n        }\n      } catch (err) {\n        console.warn('Failed to load token balance:', err);\n      }\n    };\n\n    loadBalance();\n  }, [user?.id]);\n\n  const handleRoleSwitch = async (newRole) => {\n    if (!user || !supabase) return;\n    \n    // Optimistic update\n    const updatedUserData = { ...userData, activeProfileRole: newRole };\n    \n    try {\n      await supabase\n        .from('profiles')\n        .update({ active_role: newRole, updated_at: new Date().toISOString() })\n        .eq('id', user.id);\n    } catch (e) {\n      console.error(\"Role switch failed:\", e);\n    }\n  };\n\n  const openPublicProfile = useCallback((uid, name) => {\n    setViewingProfile({ uid, name });\n  }, []);\n\n  const clearPendingChatTarget = useCallback(() => {\n    setPendingChatTarget(null);\n  }, []);\n\n\n  // Determine which content to render based on activeTab\n  // Using a function instead of useMemo to avoid hook initialization issues\n  const renderContent = () => {\n    // Guard: Return loading if userData is not ready\n    if (!userData || !userData.id) {\n      return (\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue mx-auto mb-4\"></div>\n            <p className=\"text-gray-600 dark:text-gray-400\">Loading...</p>\n          </div>\n        </div>\n      );\n    }\n\n    const LoadingFallback = () => (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <Loader2 className=\"animate-spin text-brand-blue\" size={32} />\n      </div>\n    );\n\n    switch (activeTab) {\n      case 'dashboard':\n        return (\n          <ErrorBoundary name=\"Dashboard\">\n            <Suspense \n              fallback={<LoadingFallback />}\n              // Add error boundary inside Suspense to catch initialization errors\n            >\n              <ErrorBoundary name=\"Dashboard-Inner\">\n                <Dashboard\n                  user={user}\n                  userData={userData}\n                  setActiveTab={setActiveTab}\n                  bookingCount={0}\n                  subProfiles={subProfiles}\n                  tokenBalance={tokenBalance}\n                />\n              </ErrorBoundary>\n            </Suspense>\n          </ErrorBoundary>\n        );\n\n      case 'feed':\n      case 'social':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <SocialFeed\n              user={user}\n              userData={userData}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'messages':\n      case 'chat':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <ChatInterface\n              user={user}\n              userData={userData}\n              openPublicProfile={openPublicProfile}\n              pendingChatTarget={pendingChatTarget}\n              clearPendingChatTarget={clearPendingChatTarget}\n            />\n          </Suspense>\n        );\n\n      case 'bookings':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <BookingSystem\n              user={user}\n              userData={userData}\n              subProfiles={subProfiles}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'marketplace':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <Marketplace\n              user={user}\n              userData={userData}\n              tokenBalance={tokenBalance}\n            />\n          </Suspense>\n        );\n\n      case 'tech':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <TechServices\n              user={user}\n              userData={userData}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'payments':\n      case 'billing':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <PaymentsManager\n              user={user}\n              userData={userData}\n              tokenBalance={tokenBalance}\n            />\n          </Suspense>\n        );\n\n      case 'profile':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <ProfileManager\n              user={user}\n              userData={userData}\n              subProfiles={subProfiles}\n              handleLogout={handleLogout}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'business-center':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <BusinessCenter\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'legal':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <LegalDocs />\n          </Suspense>\n        );\n\n      case 'edu-student':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduStudentDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'edu-intern':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduInternDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'edu-overview':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduStaffDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'edu-admin':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduAdminDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'studio-ops':\n        // Studio operations are handled within BusinessCenter\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <BusinessCenter\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      default:\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <Dashboard\n              user={user}\n              userData={userData}\n              setActiveTab={setActiveTab}\n              bookingCount={0}\n              subProfiles={subProfiles}\n              tokenBalance={tokenBalance}\n            />\n          </Suspense>\n        );\n    }\n  };\n\n  return (\n    <SchoolProvider user={user} userData={userData}>\n      <div className=\"flex h-screen overflow-hidden bg-gray-50 dark:bg-[#1a1d21]\">\n        {/* Sidebar */}\n        <Suspense fallback={<LoadingFallback />}>\n          <Sidebar\n            userData={userData}\n            activeTab={activeTab}\n            setActiveTab={setActiveTab}\n            sidebarOpen={sidebarOpen}\n            setSidebarOpen={setSidebarOpen}\n            handleLogout={handleLogout}\n          />\n        </Suspense>\n\n      {/* Main Content Area */}\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* Navbar */}\n        <Suspense fallback={<LoadingFallback />}>\n          <Navbar\n            user={user}\n            userData={userData}\n            subProfiles={subProfiles}\n            darkMode={darkMode}\n            toggleTheme={toggleTheme}\n            activeTab={activeTab}\n            setActiveTab={setActiveTab}\n            onMenuClick={() => setSidebarOpen(!sidebarOpen)}\n            onRoleSwitch={handleRoleSwitch}\n            openPublicProfile={openPublicProfile}\n          />\n        </Suspense>\n\n        {/* Content */}\n        <main className=\"flex-1 overflow-y-auto\">\n          {renderContent()}\n        </main>\n      </div>\n\n        {/* Public Profile Modal */}\n        {viewingProfile && (\n          <Suspense fallback={null}>\n            <PublicProfileModal\n            userId={viewingProfile.uid}\n            currentUser={user}\n            currentUserData={userData}\n            onClose={() => setViewingProfile(null)}\n            onMessage={(uid, name) => {\n              setPendingChatTarget({ uid, name });\n              setActiveTab('messages');\n              setViewingProfile(null);\n            }}\n          />\n          </Suspense>\n        )}\n      </div>\n    </SchoolProvider>\n  );\n}\n\n"],"file":"assets/MainLayout-DUKDMUjd.js"}