const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Sidebar-BBeHOhCA.js","assets/vendor-DpIp-Nyk.js","assets/chat-DJYVPNtG.js","assets/vendor-framer-RaTCtWVJ.js","assets/edu-B_3o1btY.js","assets/config-yUl3KxdD.js","assets/Navbar-_GdkC0z3.js","assets/SeshNx-PNG cCropped white text-CY2zM0R9.js","assets/useNotifications-H53GdNL7.js","assets/PublicProfileModal-0mJZTLbw.js","assets/FollowButton-vfxmQ6FJ.js","assets/Dashboard-ve3979oy.js","assets/SocialFeed-CjHQigpQ.js","assets/ReportModal-DLA-99g4.js","assets/vendor-audio-Bu2lAtPy.js","assets/Inputs-Cwzw3mWK.js","assets/ChatInterface-CpwFMc5T.js","assets/BookingSystem-BXBXlFNz.js","assets/vendor-calendar-jWNMVoeo.js","assets/vendor-calendar-DxzzN9QP.css","assets/Marketplace-AYgPMQ8I.js","assets/TechServices-C5lqtz0z.js","assets/PaymentsManager-BWTKyK2d.js","assets/vendor-stripe-OXK3Micb.js","assets/ProfileManager-Df8yA26y.js","assets/SettingsTab-DQKFXYgu.js","assets/EquipmentAutocomplete-C6-Y5LB0.js","assets/useEquipmentDatabase-CUrlwig-.js","assets/BusinessCenter-C_YfLkDO.js","assets/LegalDocs-CFhN0KXN.js"])))=>i.map(i=>d[i]);
import{S as q,_ as l}from"./edu-B_3o1btY.js";import{r as n,j as e,bT as H,bU as G,bV as J,bW as K,a as Q,bH as X,bI as Y,L as C}from"./vendor-DpIp-Nyk.js";import{s as k}from"./chat-DJYVPNtG.js";import{E as O}from"./index-Dcw_xHzP.js";import"./config-yUl3KxdD.js";import"./vendor-framer-RaTCtWVJ.js";function Z({activeTab:a,setActiveTab:r}){const[p,x]=n.useState(!1);if(n.useEffect(()=>{const i=()=>{x(window.innerWidth<1024)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),!p)return null;const m=[{id:"dashboard",icon:H,label:"Home"},{id:"feed",icon:G,label:"Feed"},{id:"bookings",icon:J,label:"Bookings"},{id:"messages",icon:K,label:"Messages"},{id:"profile",icon:Q,label:"Profile"}];return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-[#1f2128] border-t border-gray-200 dark:border-gray-700 z-50 safe-area-bottom shadow-lg","aria-label":"Bottom navigation",style:{paddingBottom:"max(0.5rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"flex justify-around items-center h-16 px-2",children:m.map(i=>{const d=i.icon,o=a===i.id;return e.jsxs("button",{onClick:()=>r(i.id),className:`flex flex-col items-center justify-center gap-1 flex-1 h-full transition-colors ${o?"text-brand-blue dark:text-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,"aria-label":i.label,"aria-current":o?"page":void 0,children:[e.jsx(d,{size:22,strokeWidth:o?2.5:2}),e.jsx("span",{className:"text-xs font-medium",children:i.label}),o&&e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-8 h-1 bg-brand-blue dark:bg-blue-400 rounded-b-full"})]},i.id)})})})}const c=(a,r=3,p=100)=>n.lazy(()=>new Promise((x,m)=>{const i=d=>{try{const o=a();o&&typeof o.then=="function"?o.then(u=>{x(u.default?u:{default:u})}).catch(u=>{d<r?(console.warn(`Lazy load failed, retrying... (${d+1}/${r})`,u),setTimeout(()=>i(d+1),p*(d+1))):(console.error("Lazy load failed after retries:",u),m(u))}):x(o)}catch(o){d<r?(console.warn(`Lazy load sync error, retrying... (${d+1}/${r})`,o),setTimeout(()=>i(d+1),p*(d+1))):(console.error("Lazy load failed after retries (sync error):",o),m(o))}};i(0)})),ee=c(()=>l(()=>import("./Sidebar-BBeHOhCA.js"),__vite__mapDeps([0,1,2,3,4,5]))),se=c(()=>l(()=>import("./Navbar-_GdkC0z3.js"),__vite__mapDeps([6,1,2,3,7,8,5]))),ae=c(()=>l(()=>import("./PublicProfileModal-0mJZTLbw.js"),__vite__mapDeps([9,1,2,3,4,5,10]))),V=c(()=>l(()=>import("./Dashboard-ve3979oy.js"),__vite__mapDeps([11,4,1,2,3,5,8]))),ne=c(()=>l(()=>import("./SocialFeed-CjHQigpQ.js"),__vite__mapDeps([12,1,2,3,13,14,5,15,10]))),re=c(()=>l(()=>import("./ChatInterface-CpwFMc5T.js"),__vite__mapDeps([16,1,2,3]))),te=c(()=>l(()=>import("./BookingSystem-BXBXlFNz.js"),__vite__mapDeps([17,4,1,2,3,5,18,19]))),oe=c(()=>l(()=>import("./Marketplace-AYgPMQ8I.js"),__vite__mapDeps([20,1,2,3,5,13,14]))),ie=c(()=>l(()=>import("./TechServices-C5lqtz0z.js"),__vite__mapDeps([21,1,5,2,3,15]))),le=c(()=>l(()=>import("./PaymentsManager-BWTKyK2d.js"),__vite__mapDeps([22,1,2,3,5,23]))),ce=c(()=>l(()=>import("./ProfileManager-Df8yA26y.js"),__vite__mapDeps([24,1,2,3,4,5,25,15,26,27]))),M=c(()=>l(()=>import("./BusinessCenter-C_YfLkDO.js"),__vite__mapDeps([28,1,2,3,26,27,5,4]))),de=c(()=>l(()=>import("./LegalDocs-CFhN0KXN.js"),__vite__mapDeps([29,1]))),ue=c(()=>l(()=>import("./edu-B_3o1btY.js").then(a=>a.E),__vite__mapDeps([4,1,2,3,5]))),fe=c(()=>l(()=>import("./edu-B_3o1btY.js").then(a=>a.b),__vite__mapDeps([4,1,2,3,5]))),be=c(()=>l(()=>import("./edu-B_3o1btY.js").then(a=>a.d),__vite__mapDeps([4,1,2,3,5]))),xe=c(()=>l(()=>import("./edu-B_3o1btY.js").then(a=>a.c),__vite__mapDeps([4,1,2,3,5]))),N=()=>e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx(C,{className:"animate-spin text-brand-blue",size:24})});function ke({user:a,userData:r,loading:p,darkMode:x,toggleTheme:m,handleLogout:i}){const d=X(),o=Y(),u=s=>s==="/"?"dashboard":s==="/feed"||s==="/social"?"feed":s==="/messages"||s==="/chat"?"messages":s==="/bookings"?"bookings":s==="/marketplace"?"marketplace":s==="/tech"?"tech":s==="/payments"||s==="/billing"?"payments":s==="/profile"?"profile":s==="/business-center"?"business-center":s==="/legal"?"legal":s==="/studio-ops"?"studio-ops":s.startsWith("/edu-")?s.substring(1):"dashboard",E={dashboard:["Dashboard"],feed:["Dashboard","Social"],messages:["Dashboard","Messages"],bookings:["Dashboard","Bookings"],marketplace:["Dashboard","Marketplace"],tech:["Dashboard","Tech Services"],payments:["Dashboard","Billing"],profile:["Dashboard","Profile"],"business-center":["Dashboard","Business Center"],legal:["Dashboard","Legal"],"edu-student":["Dashboard","Education","Student"],"edu-intern":["Dashboard","Education","Intern"],"edu-overview":["Dashboard","Education","Overview"],"edu-admin":["Dashboard","Education","Admin"],"studio-ops":["Dashboard","Studio Ops"]}[f]||["Dashboard"],[f,b]=n.useState(()=>u(o.pathname)),[w,L]=n.useState(!1),[g,B]=n.useState({}),[v,z]=n.useState(0),[R,y]=n.useState(null),[F,T]=n.useState(null),_=n.useRef(!0),S=n.useRef(!1),I=n.useRef(o.pathname),P=n.useRef(!1);n.useEffect(()=>{const s=o.pathname;if(I.current===s){_.current&&(_.current=!1);return}I.current=s;const t=u(s);P.current&&(P.current=!1),b(j=>j!==t?(S.current=!0,t):j),_.current&&(_.current=!1)},[o.pathname]),n.useEffect(()=>{if(_.current)return;if(S.current){S.current=!1;return}const t={dashboard:"/",feed:"/feed",messages:"/messages",bookings:"/bookings",marketplace:"/marketplace",tech:"/tech",payments:"/payments",profile:"/profile","business-center":"/business-center",legal:"/legal","edu-student":"/edu-student","edu-intern":"/edu-intern","edu-overview":"/edu-overview","edu-admin":"/edu-admin","studio-ops":"/studio-ops"}[f];t&&o.pathname!==t&&(P.current=!0,d(t,{replace:!0}))},[f,d,o.pathname]),n.useEffect(()=>{if(!(a!=null&&a.id)||!k)return;(async()=>{try{const{data:t,error:j}=await k.from("sub_profiles").select("*").eq("user_id",a.id);if(j){console.warn("Error loading sub-profiles:",j);return}const D={};t==null||t.forEach(A=>{D[A.role]=A}),B(D)}catch(t){console.error("Failed to load sub-profiles:",t)}})()},[a==null?void 0:a.id]),n.useEffect(()=>{if(!(a!=null&&a.id)||!k)return;(async()=>{try{const{data:t}=await k.from("wallets").select("balance").eq("user_id",a.id).maybeSingle();t&&z(t.balance||0)}catch(t){console.warn("Failed to load token balance:",t)}})()},[a==null?void 0:a.id]);const $=async s=>{},h=n.useCallback((s,t)=>{y({uid:s,name:t})},[]),U=n.useCallback(()=>{T(null)},[]),W=()=>{if(!r||!r.id)return e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading..."})]})});const s=()=>e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(C,{className:"animate-spin text-brand-blue",size:32})});switch(f){case"dashboard":return e.jsx(O,{name:"Dashboard",children:e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(O,{name:"Dashboard-Inner",children:e.jsx(V,{user:a,userData:r,setActiveTab:b,bookingCount:0,subProfiles:g,tokenBalance:v})})})});case"feed":case"social":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(ne,{user:a,userData:r,openPublicProfile:h})});case"messages":case"chat":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(re,{user:a,userData:r,openPublicProfile:h,pendingChatTarget:F,clearPendingChatTarget:U})});case"bookings":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(te,{user:a,userData:r,subProfiles:g,openPublicProfile:h})});case"marketplace":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(oe,{user:a,userData:r,tokenBalance:v})});case"tech":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(ie,{user:a,userData:r,openPublicProfile:h})});case"payments":case"billing":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(le,{user:a,userData:r,tokenBalance:v})});case"profile":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(ce,{user:a,userData:r,subProfiles:g,handleLogout:i,openPublicProfile:h})});case"business-center":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(M,{user:a,userData:r})});case"legal":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(de,{})});case"edu-student":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(ue,{user:a,userData:r})});case"edu-intern":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(fe,{user:a,userData:r})});case"edu-overview":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(be,{user:a,userData:r})});case"edu-admin":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(xe,{user:a,userData:r})});case"studio-ops":return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(M,{user:a,userData:r})});default:return e.jsx(n.Suspense,{fallback:e.jsx(s,{}),children:e.jsx(V,{user:a,userData:r,setActiveTab:b,bookingCount:0,subProfiles:g,tokenBalance:v})})}};return e.jsx(q,{user:a,userData:r,children:e.jsxs("div",{className:"flex h-screen overflow-hidden bg-gray-50 dark:bg-[#1a1d21]",children:[e.jsx(n.Suspense,{fallback:e.jsx(N,{}),children:e.jsx(ee,{userData:r,activeTab:f,setActiveTab:b,sidebarOpen:w,setSidebarOpen:L,handleLogout:i})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(n.Suspense,{fallback:e.jsx(N,{}),children:e.jsx(se,{user:a,userData:r,subProfiles:g,darkMode:x,toggleTheme:m,activeTab:f,setActiveTab:b,onMenuClick:()=>L(!w),onRoleSwitch:$,openPublicProfile:h})}),e.jsxs("main",{className:"flex-1 overflow-y-auto pb-16 lg:pb-0 px-fluid pt-4",children:[e.jsx("nav",{className:"mb-3 text-sm text-gray-500 dark:text-gray-400","aria-label":"Breadcrumb",children:e.jsx("ol",{className:"flex items-center gap-2 flex-wrap",children:E.map((s,t)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:t===E.length-1?"font-semibold text-gray-700 dark:text-gray-200":"",children:s}),t<E.length-1&&e.jsx("span",{className:"text-gray-400",children:"/"})]},s))})}),W()]})]}),e.jsx(Z,{activeTab:f,setActiveTab:b}),R&&e.jsx(n.Suspense,{fallback:null,children:e.jsx(ae,{userId:R.uid,currentUser:a,currentUserData:r,onClose:()=>y(null),onMessage:(s,t)=>{T({uid:s,name:t}),b("messages"),y(null)}})})]})})}export{ke as default};
