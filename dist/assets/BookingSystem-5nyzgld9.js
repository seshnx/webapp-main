import{r as i,j as e,cx as V,cy as O,cz as W,cA as H,X as K,c4 as N,bU as _,cB as E,cn as G,x as T,s as X,h as A,a0 as Y,F as J,L as Q,aa as Z}from"./vendor-Ds9T-nZn.js";import{s as v,U as ee}from"./chat-CYdsjRjG.js";import{C as te,d as ae}from"./vendor-calendar-DU_j1Rhm.js";import"./vendor-framer-B02WB5ws.js";const se={"en-US":O},re=ae({format:V,startOfWeek:H,getDay:W,locales:se});function de({events:a,onSelectSlot:o,onSelectEvent:y}){const d=i.useMemo(()=>a.map(n=>({id:n.id,title:n.targetName||"Session",start:n.date?new Date(n.date):new Date,end:n.date?new Date(new Date(n.date).getTime()+n.duration*60*60*1e3):new Date,resource:n})),[a]);return e.jsx("div",{className:"h-[600px] bg-white dark:bg-dark-card rounded-xl p-4 text-gray-800 dark:text-gray-200",children:e.jsx(te,{localizer:re,events:d,startAccessor:"start",endAccessor:"end",style:{height:"100%"},selectable:!0,onSelectSlot:o,onSelectEvent:y,views:["month","week","day"],defaultView:"week",eventPropGetter:n=>({className:"bg-brand-blue text-white rounded-md border-none text-xs"})})})}const S=[{id:"Pending",label:"Created",icon:N},{id:"Confirmed",label:"Deposit",icon:_},{id:"En Route",label:"En Route",icon:E},{id:"In Progress",label:"Started",icon:G},{id:"Completed",label:"Done",icon:T}];function ne({booking:a,user:o,onClose:y}){var p;const[d,n]=i.useState(a.status),[w,B]=i.useState(!1),k=o.uid===a.targetId,j=o.uid===a.senderId,b=(x=>{const m=S.findIndex(c=>c.id===x);return m===-1?0:m})(d),l=async x=>{},C=b/(S.length-1)*100;return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[90] p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#2c2e36] w-full max-w-3xl rounded-2xl shadow-2xl border dark:border-gray-700 flex flex-col max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-[#23262f]",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold dark:text-white flex items-center gap-2",children:["Session Details ",e.jsxs("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded-full font-medium",children:["#",a.id.slice(-6).toUpperCase()]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["With ",j?a.targetName:a.senderName]})]}),e.jsx("button",{onClick:y,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(K,{size:20})})]}),e.jsxs("div",{className:"overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"relative pt-4 pb-8 px-4",children:[e.jsx("div",{className:"absolute top-8 left-0 w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full -z-10"}),e.jsx("div",{className:"absolute top-8 left-0 h-1.5 bg-brand-blue rounded-full -z-10 transition-all duration-700 ease-in-out",style:{width:`${C}%`}}),e.jsx("div",{className:"flex justify-between",children:S.map((x,m)=>{const c=m<=b,f=m===b;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`
                                                w-10 h-10 rounded-full flex items-center justify-center border-4 transition-all duration-500
                                                ${c?"bg-brand-blue border-white dark:border-[#2c2e36] text-white":"bg-gray-200 dark:bg-gray-700 border-white dark:border-[#2c2e36] text-gray-400"}
                                                ${f?"scale-125 shadow-lg ring-4 ring-blue-100 dark:ring-blue-900/50":""}
                                            `,children:e.jsx(x.icon,{size:f?18:16,fill:c?"currentColor":"none"})}),e.jsx("span",{className:`text-xs font-bold uppercase tracking-wider transition-colors ${c?"text-brand-blue":"text-gray-400"}`,children:x.label})]},x.id)})})]}),k&&d!=="Completed"&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-blue-800 dark:text-blue-300",children:"Update Session Status"}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Keep the client informed."})]}),e.jsxs("div",{className:"flex gap-2",children:[d==="Pending"&&e.jsx("button",{onClick:()=>l(),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-green-700 transition shadow-sm",children:"Accept & Confirm"}),d==="Confirmed"&&e.jsxs("button",{onClick:()=>l(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-blue-700 transition shadow-sm flex items-center gap-1",children:[e.jsx(E,{size:14})," I'm En Route"]}),d==="En Route"&&e.jsxs("button",{onClick:()=>l(),className:"bg-purple-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-purple-700 transition shadow-sm flex items-center gap-1",children:[e.jsx(X,{size:14})," Start Session"]}),d==="In Progress"&&e.jsxs("button",{onClick:()=>l(),className:"bg-gray-900 dark:bg-white dark:text-black text-white px-4 py-2 rounded-lg font-bold text-xs hover:opacity-90 transition shadow-sm flex items-center gap-1",children:[e.jsx(T,{size:14})," Complete Session"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase border-b dark:border-gray-700 pb-2",children:"Logistics"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(N,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Date"}),e.jsx("div",{className:"dark:text-white font-medium",children:a.date})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(A,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Time"}),e.jsxs("div",{className:"dark:text-white font-medium",children:[a.time," (",a.duration," hrs)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(Y,{size:20,className:"text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Location"}),e.jsx("div",{className:"dark:text-white font-medium",children:((p=a.venue)==null?void 0:p.name)||"Remote / TBD"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase border-b dark:border-gray-700 pb-2",children:"Financials"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(_,{size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Total Value"}),e.jsxs("div",{className:"dark:text-white font-mono font-bold text-lg",children:["$",a.offerAmount]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg",children:e.jsx(J,{size:20,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Agreement"}),e.jsx("div",{className:"text-brand-blue text-xs font-bold cursor-pointer hover:underline",children:"View Contract"})]})]})]})]}),a.message&&e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 p-4 rounded-xl border dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Notes"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 italic",children:['"',a.message,'"']})]})]})]})})}function xe({user:a,userData:o,subProfiles:y}){var D;const[d,n]=i.useState("my-bookings"),[w,B]=i.useState([]),[k,j]=i.useState(!0),[h,b]=i.useState(null),[l,C]=i.useState("all"),[p,x]=i.useState("all"),m=(D=o==null?void 0:o.accountTypes)==null?void 0:D.includes("Studio");i.useEffect(()=>{if(!(a!=null&&a.id)&&!(a!=null&&a.uid))return;const t=async()=>{j(!0);try{const r=(a==null?void 0:a.id)||(a==null?void 0:a.uid),{data:u,error:g}=await v.from("bookings").select("*").eq("sender_id",r).order("date",{ascending:!1}),{data:I,error:P}=await v.from("bookings").select("*").eq("target_id",r).order("date",{ascending:!1});if(g)throw g;if(P)throw P;const U=[...u||[],...I||[]],q=Array.from(new Map(U.map($=>[$.id,$])).values());B(q)}catch(r){console.error("Error loading bookings:",r)}finally{j(!1)}};t();const s=v.channel("bookings-changes").on("postgres_changes",{event:"*",schema:"public",table:"bookings"},()=>{t()}).subscribe();return()=>{s.unsubscribe()}},[a==null?void 0:a.id,a==null?void 0:a.uid]);const c=w.filter(t=>{if(l!=="all"&&(l==="pending"&&t.status!=="Pending"||l==="confirmed"&&t.status!=="Confirmed"||l==="completed"&&t.status!=="Completed"||l==="cancelled"&&t.status!=="Cancelled"))return!1;if(p!=="all"){const s=(a==null?void 0:a.id)||(a==null?void 0:a.uid);if(p==="sent"&&t.sender_id!==s||p==="received"&&t.target_id!==s)return!1}return!0}),f=m?w.filter(t=>{const s=(a==null?void 0:a.id)||(a==null?void 0:a.uid);return t.target_id===s||t.sender_id===s}):[],F=t=>{if(!t||t==="Flexible")return"Flexible";try{return new Date(t).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}catch{return t}},M=t=>{if(!t||t==="Flexible")return"Flexible";try{const[s,r]=t.split(":"),u=parseInt(s),g=u>=12?"PM":"AM";return`${u%12||12}:${r} ${g}`}catch{return t}},R=t=>{switch(t){case"Pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400";case"Confirmed":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case"Completed":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400";case"Cancelled":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";case"Declined":return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"}},z=async(t,s)=>{try{const{error:r}=await v.from("bookings").update({status:s==="accept"?"Confirmed":s==="decline"?"Declined":booking.status,responded_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",t);if(r)throw r}catch(r){console.error("Error updating booking:",r),alert("Failed to update booking")}},L=c.map(t=>({id:t.id,title:t.target_name||t.sender_name||"Session",start:t.date&&t.date!=="Flexible"?new Date(`${t.date}T${t.time||"12:00"}`):new Date,end:t.date&&t.date!=="Flexible"&&t.duration?new Date(new Date(`${t.date}T${t.time||"12:00"}`).getTime()+t.duration*60*60*1e3):new Date,resource:t}));return k?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Q,{className:"animate-spin text-brand-blue",size:32})}):e.jsxs("div",{className:"h-full flex flex-col p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:"Bookings"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage your sessions and bookings"})]})}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>n("my-bookings"),className:`px-4 py-2 font-medium text-sm transition-colors ${d==="my-bookings"?"border-b-2 border-brand-blue text-brand-blue":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"My Bookings"}),e.jsx("button",{onClick:()=>n("calendar"),className:`px-4 py-2 font-medium text-sm transition-colors ${d==="calendar"?"border-b-2 border-brand-blue text-brand-blue":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Calendar View"})]}),m&&d==="my-bookings"&&e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/10 border border-indigo-200 dark:border-indigo-800 rounded-lg p-4",children:[e.jsx("h2",{className:"text-lg font-bold text-indigo-900 dark:text-indigo-300 mb-3",children:"Studio Bookings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-indigo-800 dark:text-indigo-400 mb-2",children:["Booked Me (",f.filter(t=>t.target_id===((a==null?void 0:a.id)||(a==null?void 0:a.uid))).length,")"]}),e.jsx("p",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:"Bookings where clients booked your studio"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-indigo-800 dark:text-indigo-400 mb-2",children:["We Booked (",f.filter(t=>t.sender_id===((a==null?void 0:a.id)||(a==null?void 0:a.uid))).length,")"]}),e.jsx("p",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:"Bookings your studio made for other services"})]})]})]}),d==="my-bookings"&&e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"flex gap-4 mb-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:16,className:"text-gray-500"}),e.jsxs("select",{value:l,onChange:t=>C(t.target.value),className:"px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("select",{value:p,onChange:t=>x(t.target.value),className:"px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:"all",children:"All Bookings"}),e.jsx("option",{value:"sent",children:"I Booked"}),e.jsx("option",{value:"received",children:"Booked Me"})]})]}),c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"mx-auto text-gray-400 mb-4",size:48}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No bookings found"})]}):e.jsx("div",{className:"space-y-3",children:c.map(t=>{const s=(a==null?void 0:a.id)||(a==null?void 0:a.uid),r=t.sender_id===s,u=t.target_id===s;return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>b(t),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ee,{src:null,name:r?t.target_name:t.sender_name,size:"sm"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold dark:text-white",children:r?t.target_name:t.sender_name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r?"You booked":"Booked you"," â€¢ ",t.service_type]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{size:14}),F(t.date)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{size:14}),M(t.time)," (",t.duration,"h)"]}),t.offer_amount&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{size:14}),"$",t.offer_amount]})]}),t.message&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2 line-clamp-2",children:t.message})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${R(t.status)}`,children:t.status}),u&&t.status==="Pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),z(t.id,"accept")},className:"px-3 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600",children:"Accept"}),e.jsx("button",{onClick:g=>{g.stopPropagation(),z(t.id,"decline")},className:"px-3 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600",children:"Decline"})]})]})]})},t.id)})})]}),d==="calendar"&&e.jsx("div",{className:"flex-1",children:e.jsx(de,{events:L,onSelectEvent:t=>b(t.resource),onSelectSlot:t=>{console.log("New booking slot:",t)}})}),h&&e.jsx(ne,{booking:{...h,targetId:h.target_id,senderId:h.sender_id,targetName:h.target_name,senderName:h.sender_name},user:{...a,uid:(a==null?void 0:a.id)||(a==null?void 0:a.uid)},onClose:()=>b(null)})]})}export{xe as default};
