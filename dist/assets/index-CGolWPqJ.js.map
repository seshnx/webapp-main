{"version":3,"mappings":"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","names":["AuthWizardBackground","onImagesLoaded","images","setImages","useState","currentImageIndex","setCurrentImageIndex","imagesReady","setImagesReady","panDirection","setPanDirection","intervalRef","useRef","useEffect","directions","randomDirection","displayDuration","prev","img","currentImage","zoomLevel","maxPanPercent","getTransform","x","y","translateX","translateY","startTransform","endTransform","animationName","jsxs","Fragment","jsx","LogoDark","LogoWhite","LegalDocs","lazy","__vitePreload","HIDDEN_ROLES","publicRoles","ACCOUNT_TYPES","role","RecenterAutomatically","lat","lng","map","useMap","ZipUserMap","zip","mapState","setMapState","timer","location","fetchZipLocation","MapContainer","TileLayer","Circle","AuthWizard","darkMode","toggleTheme","user","onSuccess","isNewUser","mode","setMode","step","setStep","isLoading","setIsLoading","error","setError","resetSent","setResetSent","backgroundImagesLoaded","setBackgroundImagesLoaded","locating","setLocating","showLegalOverlay","setShowLegalOverlay","contentRef","cardHeight","setCardHeight","form","setForm","passwordValidations","setPasswordValidations","names","_a","_b","p","isPasswordValid","resizeObserver","h","handleLogin","loginError","supabase","err","handleGoogleLogin","handleSignup","userId","data","upError","finalRoles","displayName","profileError","s","handleForgotPassword","handleUseLocation","pos","Requirement","met","text","Check","Sun","Moon","LogoLight","AlertCircle","e","Loader2","MapPin","Crosshair","newRoles","r","TALENT_SUBROLES","subRole","X","Suspense","DebugReport","SettingsTab","ProtectedRoute","children","loading","Navigate","AppRoutes","userData","handleLogout","Routes","Route","newSettings","newRole","Sentry","sentryLoadAttempted","initSentry","logError","errorInfo","context","errorData","sentry","storedErrors","ErrorBoundary","React","props","__publicField","currentPath","errorText","_c","loggedError","phrases","AlertTriangle","Copy","RefreshCw","retryLazyLoad","importFn","retries","delay","resolve","reject","attempt","attemptNumber","promise","module","Sidebar","Navbar","PublicProfileModal","Dashboard","SocialFeed","ChatInterface","BookingSystem","Marketplace","TechServices","PaymentsManager","ProfileManager","BusinessCenter","EduStudentDashboard","n","EduInternDashboard","EduStaffDashboard","EduAdminDashboard","LoadingFallback","MainLayout","getTabFromPath","path","activeTab","setActiveTab","sidebarOpen","setSidebarOpen","subProfiles","setSubProfiles","tokenBalance","setTokenBalance","viewingProfile","setViewingProfile","pendingChatTarget","setPendingChatTarget","navigate","useNavigate","useLocation","isInitializingRef","fromPathnameRef","prevPathnameRef","isNavigatingRef","newTab","prevTab","route","handleRoleSwitch","openPublicProfile","useCallback","uid","name","clearPendingChatTarget","renderContent","SchoolProvider","App","setUser","setUserData","setLoading","initialSessionHandledRef","setDarkMode","isFromSignup","isAuthenticated","hasUserData","isOnLoginPage","isTestLoginPage","Toaster","AppWrapper","ReactDOM","ConvexProvider","convex","BrowserRouter","removeLoader","loader"],"ignoreList":[],"sources":["../../src/components/AuthWizardBackground.jsx","../../src/assets/SeshNx-PNG cCropped.png","../../src/assets/SeshNx-PNG cCropped white text.png","../../src/components/AuthWizard.jsx","../../src/routes/AppRoutes.jsx","../../src/utils/errorReporting.js","../../src/components/shared/ErrorBoundary.jsx","../../src/components/MainLayout.jsx","../../src/App.jsx","../../src/main.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\n\r\nexport default function AuthWizardBackground({ onImagesLoaded }) {\r\n  const [images, setImages] = useState([]);\r\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\r\n  const [imagesReady, setImagesReady] = useState(false);\r\n  const [panDirection, setPanDirection] = useState({ x: 0, y: 0, startX: 0, startY: 0 });\r\n  const intervalRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    // Static curated images to replace Firestore dependency\r\n    const staticImages = [\r\n      { id: '1', url: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1920&q=80', order: 0 },\r\n      { id: '2', url: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=1920&q=80', order: 1 },\r\n      { id: '3', url: 'https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=1920&q=80', order: 2 },\r\n      { id: '4', url: 'https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?w=1920&q=80', order: 3 },\r\n    ];\r\n    setImages(staticImages);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (images.length === 0) return;\r\n    const directions = [\r\n      { startX: 0, startY: 0, endX: 100, endY: 0 }, // Left to Right\r\n      { startX: 100, startY: 0, endX: 0, endY: 0 }, // Right to Left\r\n      { startX: 0, startY: 0, endX: 0, endY: 100 }, // Top to Bottom\r\n      { startX: 0, startY: 100, endX: 0, endY: 0 }, // Bottom to Top\r\n    ];\r\n    const randomDirection = directions[Math.floor(Math.random() * directions.length)];\r\n    setPanDirection(randomDirection);\r\n  }, [currentImageIndex, images.length]);\r\n\r\n  useEffect(() => {\r\n    if (images.length === 0) return;\r\n    const displayDuration = 30000;\r\n    intervalRef.current = setInterval(() => {\r\n      setCurrentImageIndex((prev) => (prev + 1) % images.length);\r\n    }, displayDuration);\r\n    return () => clearInterval(intervalRef.current);\r\n  }, [images.length]);\r\n\r\n  useEffect(() => {\r\n    if (images.length > 0 && !imagesReady) {\r\n      const img = new Image();\r\n      img.onload = () => { setImagesReady(true); if (onImagesLoaded) onImagesLoaded(true); };\r\n      img.onerror = () => { setImagesReady(true); if (onImagesLoaded) onImagesLoaded(true); };\r\n      img.src = images[0].url;\r\n    }\r\n  }, [images, imagesReady, onImagesLoaded]);\r\n\r\n  if (images.length === 0) return null;\r\n\r\n  const currentImage = images[currentImageIndex];\r\n  const zoomLevel = 1.8;\r\n  const maxPanPercent = 30;\r\n  \r\n  const getTransform = (x, y) => {\r\n    const translateX = x === 0 ? '0%' : x === 100 ? `-${maxPanPercent}%` : `-${maxPanPercent / 2}%`;\r\n    const translateY = y === 0 ? '0%' : y === 100 ? `-${maxPanPercent}%` : `-${maxPanPercent / 2}%`;\r\n    return `scale(${zoomLevel}) translate(${translateX}, ${translateY})`;\r\n  };\r\n\r\n  const startTransform = getTransform(panDirection.startX, panDirection.startY);\r\n  const endTransform = getTransform(panDirection.endX, panDirection.endY);\r\n  const animationName = `pan-${panDirection.startX}-${panDirection.startY}-${panDirection.endX}-${panDirection.endY}`;\r\n\r\n  return (\r\n    <>\r\n      <style>{`\r\n        @keyframes ${animationName} {\r\n          0% { transform: ${startTransform}; }\r\n          100% { transform: ${endTransform}; }\r\n        }\r\n      `}</style>\r\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none\" style={{ zIndex: -1 }}>\r\n        <div key={currentImage.id} className=\"absolute inset-0\">\r\n          <div\r\n            className=\"absolute inset-0\"\r\n            style={{\r\n              backgroundImage: `url(${currentImage.url})`,\r\n              backgroundSize: 'cover',\r\n              backgroundPosition: 'center',\r\n              animation: `${animationName} 30s linear forwards`,\r\n              willChange: 'transform',\r\n            }}\r\n          />\r\n          <div className=\"absolute inset-0 bg-black/40\" />\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","export default \"__VITE_ASSET__D7fcApm9__\"","export default \"__VITE_ASSET__DWWkR5gm__\"","import React, { useState, useEffect, useRef, lazy, Suspense } from 'react';\r\nimport { supabase } from '../config/supabase';\r\nimport { Loader2, AlertCircle, Check, Sun, Moon, MapPin, Crosshair, X } from 'lucide-react';\r\nimport { MapContainer, TileLayer, Circle, useMap } from 'react-leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport { ACCOUNT_TYPES, TALENT_SUBROLES } from '../config/constants';\r\nimport { fetchZipLocation } from '../utils/geocode';\r\nimport AuthWizardBackground from './AuthWizardBackground';\r\n\r\n// Lazy load LegalDocs to match MainLayout's dynamic import pattern\r\n// This prevents mixed static/dynamic import bundling issues\r\nconst LegalDocs = lazy(() => import('./LegalDocs'));\r\n\r\n// Assets\r\nimport LogoLight from '../assets/SeshNx-PNG cCropped.png';\r\nimport LogoWhite from '../assets/SeshNx-PNG cCropped white text.png';\r\n\r\nconst HIDDEN_ROLES = ['Student', 'EDUStaff', 'Intern', 'EDUAdmin', 'GAdmin'];\r\nconst publicRoles = ACCOUNT_TYPES.filter(role => !HIDDEN_ROLES.includes(role));\r\n\r\n// Map Components\r\nfunction RecenterAutomatically({ lat, lng }) {\r\n  const map = useMap();\r\n  useEffect(() => { map.setView([lat, lng], 11); }, [lat, lng, map]);\r\n  return null;\r\n}\r\n\r\nfunction ZipUserMap({ zip }) {\r\n  const [mapState, setMapState] = useState({\r\n    center: [34.0522, -118.2437],\r\n    locationName: '',\r\n    isValid: false,\r\n    loading: false\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (!zip || zip.length < 5) return;\r\n    const loadData = async () => {\r\n      setMapState(prev => ({ ...prev, loading: true }));\r\n      try {\r\n        const location = await fetchZipLocation(zip);\r\n        if (location) {\r\n          setMapState({\r\n            center: [location.lat, location.lng],\r\n            locationName: location.cityState,\r\n            isValid: true,\r\n            loading: false\r\n          });\r\n        } else {\r\n          setMapState(prev => ({ ...prev, loading: false }));\r\n        }\r\n      } catch (e) {\r\n        setMapState(prev => ({ ...prev, loading: false }));\r\n      }\r\n    };\r\n    const timer = setTimeout(loadData, 800);\r\n    return () => clearTimeout(timer);\r\n  }, [zip]);\r\n\r\n  return (\r\n    <div className=\"w-full h-36 rounded-xl overflow-hidden relative border dark:border-gray-600 shadow-inner bg-gray-100 dark:bg-[#1f2128]\">\r\n      <MapContainer center={mapState.center} zoom={11} scrollWheelZoom={false} zoomControl={false} className=\"h-full w-full\" style={{ background: 'transparent' }}>\r\n        <TileLayer url=\"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png\" attribution='&copy; CARTO' />\r\n        <RecenterAutomatically lat={mapState.center[0]} lng={mapState.center[1]} />\r\n        {mapState.isValid && (\r\n          <Circle center={mapState.center} radius={4000} pathOptions={{ color: '#0066ff', fillColor: '#0066ff', fillOpacity: 0.15, stroke: false }} />\r\n        )}\r\n      </MapContainer>\r\n      {mapState.isValid && (\r\n        <div className=\"absolute bottom-3 right-3 bg-white/95 dark:bg-black/85 backdrop-blur-md p-2 rounded-lg shadow-lg z-[400] text-xs font-bold border dark:border-gray-700 dark:text-white\">\r\n          {mapState.locationName}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function AuthWizard({ darkMode, toggleTheme, user, onSuccess, isNewUser }) {\r\n  const [mode, setMode] = useState('login'); \r\n  const [step, setStep] = useState(1);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [resetSent, setResetSent] = useState(false);\r\n  const [backgroundImagesLoaded, setBackgroundImagesLoaded] = useState(false);\r\n  const [locating, setLocating] = useState(false);\r\n  const [showLegalOverlay, setShowLegalOverlay] = useState(false);\r\n  const contentRef = useRef(null);\r\n  const [cardHeight, setCardHeight] = useState('auto');\r\n\r\n  const [form, setForm] = useState({\r\n    email: '',\r\n    password: '',\r\n    firstName: '',\r\n    lastName: '',\r\n    zip: '',\r\n    roles: [],\r\n    talentSubRole: ''\r\n  });\r\n\r\n  const [passwordValidations, setPasswordValidations] = useState({\r\n    hasUpper: false,\r\n    hasLower: false,\r\n    hasNumber: false,\r\n    isLength: false\r\n  });\r\n\r\n  // Initialization Logic\r\n  useEffect(() => {\r\n    if (isNewUser && user && user.id) {\r\n      setMode('onboarding');\r\n      setStep(1);\r\n      const fullName = user?.user_metadata?.full_name || user?.user_metadata?.name || '';\r\n      const names = fullName.split(' ');\r\n      setForm(prev => ({\r\n        ...prev,\r\n        email: user?.email || '',\r\n        firstName: names[0] || '',\r\n        lastName: names.slice(1).join(' ') || ''\r\n      }));\r\n    } else if (!user || !user.id) {\r\n      setMode('login');\r\n      setStep(1);\r\n    }\r\n  }, [user, isNewUser]);\r\n\r\n  useEffect(() => {\r\n    const p = form.password;\r\n    setPasswordValidations({\r\n      hasUpper: /[A-Z]/.test(p),\r\n      hasLower: /[a-z]/.test(p),\r\n      hasNumber: /[0-9]/.test(p),\r\n      isLength: p.length >= 6\r\n    });\r\n  }, [form.password]);\r\n\r\n  const isPasswordValid = Object.values(passwordValidations).every(Boolean);\r\n\r\n  useEffect(() => {\r\n    if (!contentRef.current) return;\r\n    const resizeObserver = new ResizeObserver(() => {\r\n      if (contentRef.current) {\r\n        const h = contentRef.current.scrollHeight + 80;\r\n        if (h > 200) setCardHeight(`${h}px`);\r\n      }\r\n    });\r\n    resizeObserver.observe(contentRef.current);\r\n    return () => resizeObserver.disconnect();\r\n  }, [step, mode, error, resetSent, form.zip, form.roles]);\r\n\r\n  useEffect(() => { setError(''); }, [step]);\r\n\r\n  // === HANDLERS ===\r\n\r\n  const handleLogin = async () => {\r\n    if (!form.email || !form.password) {\r\n      setError(\"Please fill in all fields.\");\r\n      return;\r\n    }\r\n    \r\n    setIsLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const { error: loginError } = await supabase.auth.signInWithPassword({\r\n        email: form.email.trim(),\r\n        password: form.password\r\n      });\r\n\r\n      if (loginError) {\r\n        if (loginError.message?.includes('Invalid login credentials')) {\r\n          setError(\"Invalid email or password.\");\r\n        } else {\r\n          setError(loginError.message);\r\n        }\r\n        setIsLoading(false); // Stop spinning on error\r\n      } else {\r\n        // Success! Keep spinning briefly while redirect happens\r\n        console.log(\"Login success, redirecting...\");\r\n        // Safety timeout in case App.jsx doesn't catch it immediately\r\n        setTimeout(() => {\r\n            if (window.location.pathname === '/login') {\r\n                 window.location.href = '/'; \r\n            }\r\n        }, 1500);\r\n      }\r\n    } catch (err) {\r\n      console.error('Login exception:', err);\r\n      setError(\"Connection error. Please try again.\");\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleGoogleLogin = async () => {\r\n    setIsLoading(true);\r\n    setError('');\r\n    try {\r\n      const { error } = await supabase.auth.signInWithOAuth({\r\n        provider: 'google',\r\n        options: {\r\n          queryParams: { access_type: 'offline', prompt: 'consent' },\r\n          redirectTo: `${window.location.origin}?intent=signup`\r\n        }\r\n      });\r\n      if (error) throw error;\r\n    } catch (err) {\r\n      console.error(err);\r\n      setError(\"Failed to initialize Google login.\");\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSignup = async () => {\r\n    if (mode === 'signup' && !isPasswordValid) return setError(\"Password too weak.\");\r\n    if (form.roles.length === 0) return setError(\"Please select a role.\");\r\n\r\n    setIsLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      let userId = user?.id;\r\n\r\n      // 1. Create Auth User (if not already exists from OAuth)\r\n      if (!userId) {\r\n        const { data, error: upError } = await supabase.auth.signUp({\r\n          email: form.email.trim(),\r\n          password: form.password,\r\n          options: {\r\n            data: { first_name: form.firstName, last_name: form.lastName }\r\n          }\r\n        });\r\n\r\n        if (upError) {\r\n          setIsLoading(false);\r\n          return setError(upError.message);\r\n        }\r\n\r\n        if (data?.user && !data.session) {\r\n          setIsLoading(false);\r\n          setMode('login');\r\n          alert('Check your email to confirm your account!');\r\n          return;\r\n        }\r\n        userId = data.user.id;\r\n      }\r\n\r\n      // 2. Create Profile\r\n      const finalRoles = form.roles.length > 0 ? form.roles : ['Fan'];\r\n      const displayName = `${form.firstName} ${form.lastName}`;\r\n\r\n      const { error: profileError } = await supabase\r\n        .from('profiles')\r\n        .upsert({\r\n            id: userId,\r\n            email: form.email.trim(),\r\n            first_name: form.firstName,\r\n            last_name: form.lastName,\r\n            zip_code: form.zip,\r\n            account_types: finalRoles,\r\n            active_role: finalRoles[0],\r\n            preferred_role: finalRoles[0], // Fallback role when user has multiple roles\r\n            effective_display_name: displayName,\r\n            search_terms: [form.firstName, form.lastName, displayName].map(s => s?.toLowerCase()).filter(Boolean),\r\n            updated_at: new Date().toISOString()\r\n        }, { onConflict: 'id' });\r\n\r\n      if (profileError) {\r\n          console.error(\"Profile creation error:\", profileError);\r\n          // Don't block signup on profile error, try to proceed\r\n      }\r\n\r\n      // 3. Initialize Wallet\r\n      await supabase.from('wallets').upsert({ user_id: userId, balance: 0 }, { onConflict: 'user_id' });\r\n\r\n      // 4. Success\r\n      if (onSuccess) onSuccess();\r\n      window.location.href = '/';\r\n\r\n    } catch (err) {\r\n      console.error(err);\r\n      setError(\"Signup failed. Please try again.\");\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleForgotPassword = async () => {\r\n    if (!form.email) return setError(\"Enter your email.\");\r\n    setIsLoading(true);\r\n    const { error } = await supabase.auth.resetPasswordForEmail(form.email, { redirectTo: window.location.origin });\r\n    setIsLoading(false);\r\n    if (error) setError(error.message);\r\n    else setResetSent(true);\r\n  };\r\n\r\n  // Location Helper\r\n  const handleUseLocation = () => {\r\n    if (!navigator.geolocation) return setError(\"Geolocation not supported.\");\r\n    setLocating(true);\r\n    navigator.geolocation.getCurrentPosition(\r\n      async (pos) => {\r\n        try {\r\n          const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`);\r\n          const data = await res.json();\r\n          if (data.address?.postcode) {\r\n            setForm(prev => ({ ...prev, zip: data.address.postcode.split('-')[0] }));\r\n          } else {\r\n            setError(\"Zip code not found.\");\r\n          }\r\n        } catch (e) { setError(\"Location lookup failed.\"); }\r\n        setLocating(false);\r\n      },\r\n      () => { setError(\"Location permission denied.\"); setLocating(false); }\r\n    );\r\n  };\r\n\r\n  const Requirement = ({ met, text }) => (\r\n    <div className={`flex items-center gap-1.5 text-xs ${met ? 'text-green-600' : 'text-gray-400'}`}>\r\n      {met ? <Check size={12} /> : <div className=\"w-3 h-3 border rounded-full\" />}\r\n      {text}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden\">\r\n      <div style={{ position: 'fixed', inset: 0, zIndex: 0 }}>\r\n        <AuthWizardBackground onImagesLoaded={setBackgroundImagesLoaded} />\r\n      </div>\r\n      <div\r\n        className=\"absolute inset-0 bg-gray-100 dark:bg-black transition-opacity duration-1000\"\r\n        style={{ opacity: backgroundImagesLoaded ? 0 : 1, pointerEvents: 'none' }}\r\n      />\r\n\r\n      <div className=\"absolute top-6 right-6 z-20\">\r\n        <button onClick={toggleTheme} className=\"p-3 rounded-full bg-white/80 dark:bg-black/50 backdrop-blur-md border dark:border-gray-700\">\r\n          {darkMode ? <Sun size={20} /> : <Moon size={20} />}\r\n        </button>\r\n      </div>\r\n\r\n      <div\r\n        className=\"bg-white/95 dark:bg-[#1a1d21]/95 dark:border dark:border-gray-700 rounded-3xl shadow-2xl w-full max-w-md relative overflow-hidden transition-[height] duration-500 z-10 backdrop-blur-md\"\r\n        style={{ height: cardHeight, minHeight: '500px' }}\r\n      >\r\n        <div ref={contentRef} className=\"pt-12 px-8 pb-8\">\r\n          <div className=\"relative w-full h-48 mb-6 flex justify-center shrink-0\">\r\n            <div className={`absolute transition-all duration-500 ${mode === 'signup' || mode === 'onboarding' ? 'top-0 scale-90' : 'top-8 scale-100'}`}>\r\n              <img src={darkMode ? LogoWhite : LogoLight} alt=\"SeshNx\" className=\"w-96 h-40 object-contain drop-shadow-md\" />\r\n            </div>\r\n            <div className=\"absolute bottom-2 w-full text-center\">\r\n                <p className=\"text-sm font-bold text-gray-500 uppercase tracking-wider\">\r\n                    {mode === 'signup' ? \"Create Account\" : mode === 'forgot' ? \"Recovery\" : mode === 'onboarding' ? \"Finalize Setup\" : \"\"}\r\n                </p>\r\n            </div>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"bg-red-50 text-red-600 p-3 rounded-xl text-sm flex items-center gap-2 mb-4\">\r\n              <AlertCircle size={16} /> {error}\r\n            </div>\r\n          )}\r\n\r\n          {resetSent && (\r\n            <div className=\"bg-green-50 text-green-600 p-3 rounded-xl text-sm flex items-center gap-2 mb-4\">\r\n              <Check size={16} /> Check your email.\r\n            </div>\r\n          )}\r\n\r\n          {/* LOGIN MODE */}\r\n          {mode === 'login' && (\r\n            <div className=\"space-y-4\">\r\n              <input\r\n                className=\"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border dark:border-gray-600 rounded-xl dark:text-white\"\r\n                placeholder=\"Email\"\r\n                value={form.email}\r\n                onChange={(e) => setForm(prev => ({ ...prev, email: e.target.value }))}\r\n              />\r\n              <input\r\n                className=\"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border dark:border-gray-600 rounded-xl dark:text-white\"\r\n                type=\"password\"\r\n                placeholder=\"Password\"\r\n                value={form.password}\r\n                onChange={(e) => setForm(prev => ({ ...prev, password: e.target.value }))}\r\n                onKeyDown={(e) => e.key === 'Enter' && handleLogin()}\r\n              />\r\n              <div className=\"flex justify-end\">\r\n                <button onClick={() => setMode('forgot')} className=\"text-xs text-gray-500 hover:text-brand-blue\">\r\n                  Forgot Password?\r\n                </button>\r\n              </div>\r\n              <button\r\n                className=\"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold hover:bg-blue-600 disabled:opacity-50\"\r\n                onClick={handleLogin}\r\n                disabled={isLoading}\r\n              >\r\n                {isLoading ? <Loader2 className=\"animate-spin mx-auto\" size={20} /> : 'Sign In'}\r\n              </button>\r\n              <button\r\n                onClick={handleGoogleLogin}\r\n                disabled={isLoading}\r\n                className=\"w-full border dark:border-gray-600 py-3.5 rounded-xl font-bold dark:text-white hover:bg-gray-50 dark:hover:bg-gray-800\"\r\n              >\r\n                Continue with Google\r\n              </button>\r\n              <p className=\"text-center text-sm text-gray-500 cursor-pointer hover:text-brand-blue pt-2\" onClick={() => setMode('signup')}>\r\n                New here? Create Account\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {/* SIGNUP / ONBOARDING MODE */}\r\n          {(mode === 'signup' || mode === 'onboarding') && (\r\n            <div>\r\n              {step === 1 && (\r\n                <div className=\"space-y-4\">\r\n                  {mode === 'signup' ? (\r\n                    <>\r\n                      <input\r\n                        className=\"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border dark:border-gray-600 rounded-xl dark:text-white\"\r\n                        placeholder=\"Email\"\r\n                        type=\"email\"\r\n                        value={form.email}\r\n                        onChange={(e) => setForm(prev => ({ ...prev, email: e.target.value }))}\r\n                      />\r\n                      <input\r\n                        className=\"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border dark:border-gray-600 rounded-xl dark:text-white\"\r\n                        type=\"password\"\r\n                        placeholder=\"Create Password\"\r\n                        value={form.password}\r\n                        onChange={(e) => setForm(prev => ({ ...prev, password: e.target.value }))}\r\n                      />\r\n                      <div className=\"grid grid-cols-2 gap-2 pl-1\">\r\n                        <Requirement met={passwordValidations.hasUpper} text=\"Uppercase\" />\r\n                        <Requirement met={passwordValidations.isLength} text=\"6+ Chars\" />\r\n                        <Requirement met={passwordValidations.hasLower} text=\"Lowercase\" />\r\n                        <Requirement met={passwordValidations.hasNumber} text=\"Number\" />\r\n                      </div>\r\n                      <button\r\n                        className=\"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold disabled:opacity-50\"\r\n                        onClick={() => { if (isPasswordValid && form.email) setStep(2); }}\r\n                        disabled={!isPasswordValid || !form.email}\r\n                      >\r\n                        Continue\r\n                      </button>\r\n                      <p className=\"text-center text-sm text-gray-500 cursor-pointer pt-2\" onClick={() => setMode('login')}>\r\n                        Have an account? Log In\r\n                      </p>\r\n                    </>\r\n                  ) : (\r\n                    <div className=\"text-center space-y-4\">\r\n                      <h3 className=\"text-2xl font-bold dark:text-white\">Welcome!</h3>\r\n                      <button className=\"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold\" onClick={() => setStep(2)}>\r\n                        Let's Go\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {step === 2 && (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex gap-3\">\r\n                    <input\r\n                      className=\"w-1/2 p-3.5 bg-gray-50 dark:bg-[#1f2128] border dark:border-gray-600 rounded-xl dark:text-white\"\r\n                      placeholder=\"First Name\"\r\n                      value={form.firstName}\r\n                      onChange={(e) => setForm(prev => ({ ...prev, firstName: e.target.value }))}\r\n                    />\r\n                    <input\r\n                      className=\"w-1/2 p-3.5 bg-gray-50 dark:bg-[#1f2128] border dark:border-gray-600 rounded-xl dark:text-white\"\r\n                      placeholder=\"Last Name\"\r\n                      value={form.lastName}\r\n                      onChange={(e) => setForm(prev => ({ ...prev, lastName: e.target.value }))}\r\n                    />\r\n                  </div>\r\n                  <div className=\"relative flex gap-2\">\r\n                    <div className=\"relative flex-1\">\r\n                      <input\r\n                        className=\"w-full p-3.5 pl-10 bg-gray-50 dark:bg-[#1f2128] border dark:border-gray-600 rounded-xl dark:text-white\"\r\n                        placeholder=\"Zip Code\"\r\n                        maxLength={5}\r\n                        value={form.zip}\r\n                        onChange={(e) => setForm(prev => ({ ...prev, zip: e.target.value.replace(/\\D/g, '') }))}\r\n                      />\r\n                      <MapPin className=\"absolute left-3 top-3.5 text-gray-400\" size={18} />\r\n                    </div>\r\n                    <button onClick={handleUseLocation} className=\"p-3.5 border dark:border-gray-600 rounded-xl text-brand-blue\" disabled={locating}>\r\n                      {locating ? <Loader2 className=\"animate-spin\" size={18} /> : <Crosshair size={18} />}\r\n                    </button>\r\n                  </div>\r\n                  <ZipUserMap zip={form.zip} />\r\n                  <div className=\"flex justify-between pt-2\">\r\n                    <button className=\"text-gray-500\" onClick={() => setStep(1)}>Back</button>\r\n                    <button\r\n                      className=\"bg-black dark:bg-white dark:text-black text-white px-6 py-2.5 rounded-xl font-bold disabled:opacity-50\"\r\n                      onClick={() => { if (form.firstName && form.zip) setStep(3); }}\r\n                      disabled={!form.firstName || !form.zip}\r\n                    >\r\n                      Next\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {step === 3 && (\r\n                <div className=\"space-y-5\">\r\n                  <div className=\"grid grid-cols-2 gap-2.5\">\r\n                    {publicRoles.map(role => (\r\n                      <div\r\n                        key={role}\r\n                        onClick={() => {\r\n                          const newRoles = form.roles.includes(role) ? form.roles.filter(r => r !== role) : [...form.roles, role];\r\n                          setForm(prev => ({ ...prev, roles: newRoles }));\r\n                        }}\r\n                        className={`p-3 border-2 rounded-xl cursor-pointer text-center font-bold text-sm transition ${\r\n                          form.roles.includes(role)\r\n                            ? 'border-brand-blue bg-blue-50 text-brand-blue dark:bg-blue-900/20 dark:border-blue-500'\r\n                            : 'border-gray-100 dark:border-gray-700 hover:border-gray-300'\r\n                        }`}\r\n                      >\r\n                        {role}\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                  {form.roles.includes('Talent') && (\r\n                    <select\r\n                      className=\"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border dark:border-gray-600 rounded-xl dark:text-white\"\r\n                      value={form.talentSubRole}\r\n                      onChange={(e) => setForm(prev => ({ ...prev, talentSubRole: e.target.value }))}\r\n                    >\r\n                      <option value=\"\">Select Talent Type (Optional)</option>\r\n                      {TALENT_SUBROLES.map(subRole => (<option key={subRole} value={subRole}>{subRole}</option>))}\r\n                    </select>\r\n                  )}\r\n                  <button\r\n                    className=\"w-full bg-green-600 text-white py-3.5 rounded-xl font-bold disabled:opacity-50\"\r\n                    onClick={handleSignup}\r\n                    disabled={isLoading || form.roles.length === 0}\r\n                  >\r\n                    {isLoading ? <Loader2 className=\"animate-spin mx-auto\" size={20} /> : \"Complete Setup\"}\r\n                  </button>\r\n                  <button className=\"w-full text-gray-400 text-xs\" onClick={() => setStep(2)}>Back</button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {mode === 'forgot' && (\r\n            <div className=\"space-y-4\">\r\n              <input\r\n                className=\"w-full p-3.5 bg-gray-50 dark:bg-[#1f2128] border dark:border-gray-600 rounded-xl dark:text-white\"\r\n                placeholder=\"Email\"\r\n                type=\"email\"\r\n                value={form.email}\r\n                onChange={(e) => setForm(prev => ({ ...prev, email: e.target.value }))}\r\n              />\r\n              <button\r\n                className=\"w-full bg-brand-blue text-white py-3.5 rounded-xl font-bold disabled:opacity-50\"\r\n                onClick={handleForgotPassword}\r\n                disabled={isLoading || resetSent}\r\n              >\r\n                {resetSent ? 'Sent!' : isLoading ? <Loader2 className=\"animate-spin mx-auto\" size={20} /> : 'Send Link'}\r\n              </button>\r\n              <button className=\"w-full text-gray-500 text-sm\" onClick={() => setMode('login')}>Back</button>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"mt-6 pt-4 border-t dark:border-gray-700 text-center\">\r\n            <button onClick={() => setShowLegalOverlay(true)} className=\"text-xs text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\">\r\n              Terms of Service  Privacy Policy\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {showLegalOverlay && (\r\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\r\n          <div className=\"bg-white dark:bg-[#1a1d21] rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\r\n            <div className=\"p-4 border-b dark:border-gray-700 flex justify-between items-center\">\r\n              <h2 className=\"text-xl font-bold dark:text-white\">Legal Documents</h2>\r\n              <button onClick={() => setShowLegalOverlay(false)} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg\">\r\n                <X size={20} />\r\n              </button>\r\n            </div>\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              <Suspense fallback={<div className=\"flex items-center justify-center p-8\"><Loader2 className=\"animate-spin\" size={24} /></div>}>\r\n                <LegalDocs isEmbedded={true} />\r\n              </Suspense>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { lazy, Suspense } from 'react';\r\nimport { Routes, Route, Navigate } from 'react-router-dom';\r\nimport { supabase } from '../config/supabase';\r\nimport { Loader2 } from 'lucide-react';\r\n\r\n// Lazy load components to avoid circular dependencies\r\n// Note: Dashboard is handled by MainLayout, not needed here\r\nconst DebugReport = lazy(() => import('../components/DebugReport'));\r\nconst ProfileManager = lazy(() => import('../components/ProfileManager'));\r\nconst SettingsTab = lazy(() => import('../components/SettingsTab'));\r\n\r\n/**\r\n * Protected Route Wrapper\r\n * \r\n * Protects routes and redirects to login if user is not authenticated\r\n */\r\nfunction ProtectedRoute({ children, user, loading }) {\r\n  // Show loading while checking auth\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <Loader2 className=\"animate-spin text-brand-blue\" size={32} />\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Check if user is authenticated\r\n  if (!user) {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n  \r\n  return children;\r\n}\r\n\r\n/**\r\n * AppRoutes - Full routing with all modules\r\n * MainLayout handles most routes, but Settings and Debug Report use direct routes\r\n */\r\nexport default function AppRoutes({ user, userData, loading, darkMode, toggleTheme, handleLogout }) {\r\n  return (\r\n    <Routes>\r\n      {/* MainLayout handles these routes internally via activeTab */}\r\n      {/* Dashboard and all main modules are handled by MainLayout */}\r\n      <Route path=\"/\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/feed\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/messages\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/bookings\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/marketplace\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/tech\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/payments\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/profile\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/business-center\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/legal\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/edu-student\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/edu-intern\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/edu-overview\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/edu-admin\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      <Route path=\"/studio-ops\" element={<ProtectedRoute user={user} loading={loading}><div /></ProtectedRoute>} />\r\n      \r\n      {/* Debug Report Route - Test login destination */}\r\n      <Route \r\n        path=\"/debug-report\" \r\n        element={\r\n          <ProtectedRoute user={user} loading={loading}>\r\n            <Suspense fallback={<div className=\"flex items-center justify-center min-h-screen\"><Loader2 className=\"animate-spin text-brand-blue\" size={32} /></div>}>\r\n              <DebugReport \r\n                user={user} \r\n                userData={userData}\r\n              />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } \r\n      />\r\n      \r\n      {/* Settings Route - Uses direct route */}\r\n      <Route \r\n        path=\"/settings\" \r\n        element={\r\n          <ProtectedRoute user={user} loading={loading}>\r\n            <Suspense fallback={<div className=\"flex items-center justify-center min-h-screen\"><Loader2 className=\"animate-spin text-brand-blue\" size={32} /></div>}>\r\n              <SettingsTab \r\n              user={user} \r\n              userData={userData}\r\n              onUpdate={async (newSettings) => {\r\n                // Save settings to database\r\n                if (user?.id && supabase) {\r\n                  try {\r\n                    const { error } = await supabase\r\n                      .from('profiles')\r\n                      .update({ \r\n                        settings: newSettings, \r\n                        updated_at: new Date().toISOString() \r\n                      })\r\n                      .eq('id', user.id);\r\n                    \r\n                    if (error) {\r\n                      console.error('Settings save failed:', error);\r\n                    }\r\n                  } catch (err) {\r\n                    console.error('Settings save error:', err);\r\n                  }\r\n                }\r\n              }}\r\n              onRoleSwitch={async (newRole) => {\r\n                // Role switch - update active role in database\r\n                if (user?.id && supabase) {\r\n                  try {\r\n                    await supabase\r\n                      .from('profiles')\r\n                      .update({ \r\n                        active_role: newRole, \r\n                        updated_at: new Date().toISOString() \r\n                      })\r\n                      .eq('id', user.id);\r\n                    console.log('Role switched to:', newRole);\r\n                  } catch (err) {\r\n                    console.error('Role switch failed:', err);\r\n                  }\r\n                }\r\n              }}\r\n            />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } \r\n      />\r\n      \r\n      {/* Redirect dashboard aliases */}\r\n      <Route path=\"/dashboard\" element={<Navigate to=\"/\" replace />} />\r\n      <Route path=\"/home\" element={<Navigate to=\"/\" replace />} />\r\n      <Route path=\"/social\" element={<Navigate to=\"/feed\" replace />} />\r\n      <Route path=\"/chat\" element={<Navigate to=\"/messages\" replace />} />\r\n      <Route path=\"/billing\" element={<Navigate to=\"/payments\" replace />} />\r\n      \r\n      {/* Fallback - redirect to dashboard */}\r\n      <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\r\n    </Routes>\r\n  );\r\n}\r\n\r\n","/**\r\n * Error Reporting Utility\r\n * \r\n * Centralized error logging and reporting service.\r\n * Supports:\r\n * - Sentry (optional, requires @sentry/react package and VITE_SENTRY_DSN)\r\n * - Local storage for debugging\r\n * - Console logging in development\r\n */\r\n\r\n// Lazy load Sentry to avoid bundling if not used\r\nlet Sentry = null;\r\nlet sentryLoadAttempted = false;\r\n\r\n/**\r\n * Initialize Sentry if available\r\n * @returns {Promise<Object|null>} Sentry module or null if not available\r\n */\r\nconst initSentry = async () => {\r\n  // Return cached result\r\n  if (Sentry !== null) return Sentry;\r\n  if (sentryLoadAttempted) return null;\r\n  \r\n  const dsn = import.meta.env.VITE_SENTRY_DSN;\r\n  if (!dsn) {\r\n    sentryLoadAttempted = true;\r\n    Sentry = false;\r\n    return null;\r\n  }\r\n\r\n  sentryLoadAttempted = true;\r\n\r\n  try {\r\n    // Dynamic import - will fail gracefully if package not installed\r\n    const sentryModule = await import('@sentry/react');\r\n    \r\n    // Real Sentry - proceed with initialization\r\n    Sentry = sentryModule;\r\n    const { init, BrowserTracing, Replay } = sentryModule;\r\n    \r\n    // Check if already initialized\r\n    const hub = sentryModule.getCurrentHub?.();\r\n    if (!hub?.getClient?.()) {\r\n      init({\r\n        dsn,\r\n        environment: import.meta.env.MODE || 'development',\r\n        tracesSampleRate: import.meta.env.PROD ? 0.1 : 1.0,\r\n        replaysSessionSampleRate: import.meta.env.PROD ? 0.1 : 1.0,\r\n        replaysOnErrorSampleRate: 1.0,\r\n        integrations: [\r\n          new BrowserTracing(),\r\n          new Replay(),\r\n        ],\r\n      });\r\n    }\r\n    \r\n    return Sentry;\r\n  } catch (e) {\r\n    // Package not installed or other error - silently fail\r\n    if (import.meta.env.DEV) {\r\n      console.debug('Sentry not available:', e.message);\r\n    }\r\n    Sentry = false;\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Log an error with context\r\n * @param {Error} error - The error object\r\n * @param {Object} errorInfo - Additional error information\r\n * @param {Object} context - Additional context (user, component, etc.)\r\n */\r\nexport const logError = (error, errorInfo = {}, context = {}) => {\r\n  const errorData = {\r\n    message: error?.message || 'Unknown error',\r\n    stack: error?.stack,\r\n    name: error?.name,\r\n    timestamp: new Date().toISOString(),\r\n    userAgent: navigator.userAgent,\r\n    url: window.location.href,\r\n    ...errorInfo,\r\n    context,\r\n  };\r\n\r\n  // Log to console in development\r\n  if (import.meta.env.DEV) {\r\n    console.error(' Error Reported:', errorData);\r\n  }\r\n\r\n  // Send to Sentry if available (async, non-blocking)\r\n  initSentry().then(sentry => {\r\n    if (sentry && sentry.captureException) {\r\n      sentry.captureException(error, {\r\n        extra: errorData,\r\n        tags: {\r\n          component: context.component || 'Unknown',\r\n          errorBoundary: context.errorBoundary || 'None',\r\n        },\r\n        contexts: {\r\n          custom: context,\r\n        },\r\n      });\r\n    }\r\n  }).catch(() => {\r\n    // Ignore Sentry errors\r\n  });\r\n\r\n  // Store errors locally for debugging (limited to last 10)\r\n  try {\r\n    const storedErrors = JSON.parse(localStorage.getItem('seshnx_errors') || '[]');\r\n    storedErrors.unshift(errorData);\r\n    storedErrors.splice(10); // Keep only last 10 errors\r\n    localStorage.setItem('seshnx_errors', JSON.stringify(storedErrors));\r\n  } catch (e) {\r\n    // Ignore localStorage errors\r\n  }\r\n\r\n  return errorData;\r\n};\r\n\r\n/**\r\n * Report a non-error event (warnings, info)\r\n * @param {string} message - The message to report\r\n * @param {string} level - 'warning' | 'info' | 'error'\r\n * @param {Object} context - Additional context\r\n */\r\nexport const reportEvent = (message, level = 'info', context = {}) => {\r\n  const eventData = {\r\n    message,\r\n    level,\r\n    timestamp: new Date().toISOString(),\r\n    url: window.location.href,\r\n    context,\r\n  };\r\n\r\n  if (import.meta.env.DEV) {\r\n    console[level === 'error' ? 'error' : level === 'warning' ? 'warn' : 'log'](\r\n      ` Event [${level}]:`,\r\n      eventData\r\n    );\r\n  }\r\n\r\n  // Send to Sentry if available (async, non-blocking)\r\n  initSentry().then(sentry => {\r\n    if (sentry && sentry.captureMessage) {\r\n      sentry.captureMessage(message, {\r\n        level: level === 'error' ? 'error' : level === 'warning' ? 'warning' : 'info',\r\n        extra: eventData,\r\n      });\r\n    }\r\n  }).catch(() => {\r\n    // Ignore Sentry errors\r\n  });\r\n\r\n  return eventData;\r\n};\r\n\r\n/**\r\n * Get stored errors (for debugging)\r\n * @returns {Array} Array of stored errors\r\n */\r\nexport const getStoredErrors = () => {\r\n  try {\r\n    return JSON.parse(localStorage.getItem('seshnx_errors') || '[]');\r\n  } catch (e) {\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * Clear stored errors\r\n */\r\nexport const clearStoredErrors = () => {\r\n  try {\r\n    localStorage.removeItem('seshnx_errors');\r\n  } catch (e) {\r\n    // Ignore\r\n  }\r\n};\r\n\r\n","import React from 'react';\nimport { AlertTriangle, RefreshCw, Home, Copy, Check } from 'lucide-react';\nimport { logError } from '../../utils/errorReporting';\n\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { \n      hasError: false, \n      error: null,\n      errorInfo: null,\n      meme: \"Unexpected signal chain failure.\",\n      errorId: null,\n      copied: false\n    };\n  }\n\n  static getDerivedStateFromError(error) {\n    // Update state so the next render will show the fallback UI.\n    return { \n      hasError: true, \n      error,\n      errorId: `ERR-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n    };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    // Log error with full context\n    const context = {\n      componentStack: errorInfo.componentStack,\n      errorBoundary: this.props.name || 'Default',\n      props: this.props.context || {},\n    };\n\n    const loggedError = logError(error, errorInfo, context);\n    \n    // Store error info for display\n    this.setState({ \n      errorInfo: {\n        ...errorInfo,\n        errorId: this.state.errorId || loggedError.timestamp,\n      }\n    });\n  }\n\n  componentDidMount() {\n    // Pre-load a random error meme\n    const phrases = [\n      \"CoreAudio Overload detected.\",\n      \"The plugin crashed the session.\",\n      \"Buffer underrun exception.\",\n      \"Who deleted the master fader?\",\n      \"Sample rate mismatch: Reality is 44.1k, we are 48k.\",\n      \"The drummer kicked the power cable.\",\n      \"Ilok license not found.\",\n      \"Fatal Error: Not enough headroom.\",\n      \"The mix bus is clipping... hard.\",\n      \"Phantom power failure.\"\n    ];\n    this.setState({ meme: phrases[Math.floor(Math.random() * phrases.length)] });\n  }\n\n  handleReset = () => {\n    this.setState({ \n      hasError: false, \n      error: null, \n      errorInfo: null,\n      errorId: null,\n      copied: false\n    });\n    // Optional: Redirect to home/dashboard if recovery isn't possible\n    if (this.props.onReset) {\n      this.props.onReset();\n    } else {\n      // Try to reset to a safe state\n      const currentPath = window.location.pathname;\n      if (currentPath !== '/' && currentPath !== '/dashboard') {\n        window.location.href = '/?tab=dashboard';\n      } else {\n        window.location.reload();\n      }\n    }\n  };\n\n  handleCopyError = async () => {\n    const errorText = `\nError ID: ${this.state.errorId}\nMessage: ${this.state.error?.message || 'Unknown error'}\nStack: ${this.state.error?.stack || 'No stack trace'}\nComponent Stack: ${this.state.errorInfo?.componentStack || 'No component stack'}\nURL: ${window.location.href}\nUser Agent: ${navigator.userAgent}\nTimestamp: ${new Date().toISOString()}\n    `.trim();\n\n    try {\n      await navigator.clipboard.writeText(errorText);\n      this.setState({ copied: true });\n      setTimeout(() => this.setState({ copied: false }), 2000);\n    } catch (err) {\n      console.error('Failed to copy error:', err);\n    }\n  };\n\n  render() {\n    if (this.state.hasError) {\n      // You can render any custom fallback UI\n      return (\n        <div className=\"min-h-screen bg-[#1f2128] flex flex-col items-center justify-center p-4 text-center text-white font-sans\">\n          <div className=\"bg-[#2c2e36] border border-red-500/30 p-8 rounded-2xl shadow-2xl max-w-lg w-full relative overflow-hidden\">\n            \n            {/* Background Glow */}\n            <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-32 h-32 bg-red-500/20 blur-[50px] rounded-full pointer-events-none\"></div>\n\n            <div className=\"relative z-10 flex flex-col items-center\">\n              <div className=\"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mb-6 text-red-500\">\n                <AlertTriangle size={32} strokeWidth={2} />\n              </div>\n\n              <h1 className=\"text-3xl font-bold mb-2\">Session Crashed</h1>\n              \n              <p className=\"text-xl text-[#3D84ED] font-medium mb-6 italic\">\n                \"{this.state.meme}\"\n              </p>\n\n              <div className=\"bg-[#1f2128] p-4 rounded-lg w-full mb-6 text-left border border-gray-700\">\n                <div className=\"flex justify-between items-center mb-2\">\n                  <p className=\"text-xs text-gray-500 uppercase font-bold tracking-wider\">Error Details</p>\n                  <button\n                    onClick={this.handleCopyError}\n                    className=\"text-xs text-gray-400 hover:text-white flex items-center gap-1 transition-colors\"\n                    title=\"Copy error details\"\n                  >\n                    {this.state.copied ? (\n                      <>\n                        <Check size={12} />\n                        Copied!\n                      </>\n                    ) : (\n                      <>\n                        <Copy size={12} />\n                        Copy\n                      </>\n                    )}\n                  </button>\n                </div>\n                <div className=\"space-y-2\">\n                  {this.state.errorId && (\n                    <div>\n                      <span className=\"text-xs text-gray-500\">Error ID: </span>\n                      <code className=\"text-xs text-blue-400 font-mono\">{this.state.errorId}</code>\n                    </div>\n                  )}\n                  <code className=\"text-sm text-red-400 font-mono break-words block\">\n                    {this.state.error?.message || 'Unknown error occurred'}\n                  </code>\n                  {this.state.error?.stack && (\n                    <details className=\"mt-2\">\n                      <summary className=\"text-xs text-gray-500 cursor-pointer hover:text-gray-400\">\n                        Stack Trace\n                      </summary>\n                      <pre className=\"text-xs text-gray-400 font-mono mt-2 overflow-auto max-h-32\">\n                        {this.state.error.stack}\n                      </pre>\n                    </details>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex gap-4 w-full\">\n                <button \n                  onClick={() => window.history.back()}\n                  className=\"flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2\"\n                >\n                  Go Back\n                </button>\n                <button \n                  onClick={this.handleReset}\n                  className=\"flex-1 bg-[#3D84ED] hover:bg-blue-600 text-white py-3 px-4 rounded-xl font-bold transition-all shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2\"\n                >\n                  <RefreshCw size={18} />\n                  Reload App\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children; \n  }\n}\n\nexport default ErrorBoundary;\n","import React, { useState, useEffect, useRef, useCallback, Suspense, lazy } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { SchoolProvider } from '../contexts/SchoolContext';\nimport { supabase } from '../config/supabase';\nimport { Loader2 } from 'lucide-react';\nimport ErrorBoundary from './shared/ErrorBoundary';\n\n// Retry wrapper for lazy loading to handle initialization errors\nconst retryLazyLoad = (importFn, retries = 3, delay = 100) => {\n  return lazy(() => {\n    return new Promise((resolve, reject) => {\n      const attempt = (attemptNumber) => {\n        // Wrap in try-catch to handle synchronous errors\n        try {\n          const promise = importFn();\n          // If it's already a promise, handle it\n          if (promise && typeof promise.then === 'function') {\n            promise\n              .then((module) => {\n                // Ensure we get the default export\n                resolve(module.default ? module : { default: module });\n              })\n              .catch((error) => {\n                if (attemptNumber < retries) {\n                  console.warn(`Lazy load failed, retrying... (${attemptNumber + 1}/${retries})`, error);\n                  setTimeout(() => attempt(attemptNumber + 1), delay * (attemptNumber + 1));\n                } else {\n                  console.error('Lazy load failed after retries:', error);\n                  reject(error);\n                }\n              });\n          } else {\n            resolve(promise);\n          }\n        } catch (error) {\n          // Handle synchronous errors (like circular dependencies)\n          if (attemptNumber < retries) {\n            console.warn(`Lazy load sync error, retrying... (${attemptNumber + 1}/${retries})`, error);\n            setTimeout(() => attempt(attemptNumber + 1), delay * (attemptNumber + 1));\n          } else {\n            console.error('Lazy load failed after retries (sync error):', error);\n            reject(error);\n          }\n        }\n      };\n      attempt(0);\n    });\n  });\n};\n\n// Lazy load ALL components to prevent initialization errors with retry mechanism\nconst Sidebar = retryLazyLoad(() => import('./Sidebar'));\nconst Navbar = retryLazyLoad(() => import('./Navbar'));\nconst PublicProfileModal = retryLazyLoad(() => import('./PublicProfileModal'));\nconst Dashboard = retryLazyLoad(() => import('./Dashboard'));\nconst SocialFeed = retryLazyLoad(() => import('./SocialFeed'));\nconst ChatInterface = retryLazyLoad(() => import('./ChatInterface'));\nconst BookingSystem = retryLazyLoad(() => import('./BookingSystem'));\nconst Marketplace = retryLazyLoad(() => import('./Marketplace'));\nconst TechServices = retryLazyLoad(() => import('./TechServices'));\nconst PaymentsManager = retryLazyLoad(() => import('./PaymentsManager'));\nconst ProfileManager = retryLazyLoad(() => import('./ProfileManager'));\nconst BusinessCenter = retryLazyLoad(() => import('./BusinessCenter'));\nconst LegalDocs = retryLazyLoad(() => import('./LegalDocs'));\nconst EduStudentDashboard = retryLazyLoad(() => import('./EDU/EduStudentDashboard'));\nconst EduInternDashboard = retryLazyLoad(() => import('./EDU/EduInternDashboard'));\nconst EduStaffDashboard = retryLazyLoad(() => import('./EDU/EduStaffDashboard'));\nconst EduAdminDashboard = retryLazyLoad(() => import('./EDU/EduAdminDashboard'));\n\n// Shared loading fallback component\nconst LoadingFallback = () => (\n  <div className=\"flex items-center justify-center p-4\">\n    <Loader2 className=\"animate-spin text-brand-blue\" size={24} />\n  </div>\n);\n\nexport default function MainLayout({ \n  user, \n  userData, \n  loading, \n  darkMode, \n  toggleTheme, \n  handleLogout \n}) {\n  // Helper function to get tab from pathname\n  const getTabFromPath = (path) => {\n    if (path === '/') return 'dashboard';\n    if (path === '/feed' || path === '/social') return 'feed';\n    if (path === '/messages' || path === '/chat') return 'messages';\n    if (path === '/bookings') return 'bookings';\n    if (path === '/marketplace') return 'marketplace';\n    if (path === '/tech') return 'tech';\n    if (path === '/payments' || path === '/billing') return 'payments';\n    if (path === '/profile') return 'profile';\n    if (path === '/business-center') return 'business-center';\n    if (path === '/legal') return 'legal';\n    if (path === '/studio-ops') return 'studio-ops';\n    if (path.startsWith('/edu-')) return path.substring(1);\n    return 'dashboard'; // default\n  };\n\n  // Initialize activeTab from current pathname\n  const [activeTab, setActiveTab] = useState(() => getTabFromPath(location.pathname));\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const [subProfiles, setSubProfiles] = useState({});\n  const [tokenBalance, setTokenBalance] = useState(0);\n  const [viewingProfile, setViewingProfile] = useState(null);\n  const [pendingChatTarget, setPendingChatTarget] = useState(null);\n  const navigate = useNavigate();\n  const location = useLocation();\n  \n  // Track if we're initializing to prevent navigation loops\n  const isInitializingRef = useRef(true);\n  // Track if activeTab change came from pathname (to prevent navigation loop)\n  const fromPathnameRef = useRef(false);\n  // Track previous pathname to detect actual changes\n  const prevPathnameRef = useRef(location.pathname);\n  // Track if user is currently navigating (to prevent pathname sync from overriding)\n  const isNavigatingRef = useRef(false);\n\n  // Sync activeTab with route (pathname is source of truth)\n  useEffect(() => {\n    const path = location.pathname;\n    \n    // Only sync if pathname actually changed (not just a re-render)\n    if (prevPathnameRef.current === path) {\n      // Still mark initialization as complete even if pathname didn't change\n      if (isInitializingRef.current) {\n        isInitializingRef.current = false;\n      }\n      return;\n    }\n    \n    prevPathnameRef.current = path;\n    const newTab = getTabFromPath(path);\n    \n    // If we were navigating, this is the completion of that navigation\n    // Reset the flag and update activeTab\n    if (isNavigatingRef.current) {\n      isNavigatingRef.current = false;\n    }\n    \n    // Always update from pathname (pathname is source of truth)\n    // Use functional update to compare against latest state\n    setActiveTab(prevTab => {\n      if (prevTab !== newTab) {\n        fromPathnameRef.current = true; // Mark that this change came from pathname\n        return newTab;\n      }\n      return prevTab; // No change needed\n    });\n    \n    // Mark initialization as complete after first sync\n    if (isInitializingRef.current) {\n      isInitializingRef.current = false;\n    }\n  }, [location.pathname]); // Only depend on pathname\n\n  // Update URL when tab changes (only if user-initiated, not from pathname sync)\n  useEffect(() => {\n    // Skip navigation during initialization\n    if (isInitializingRef.current) {\n      return;\n    }\n    \n    // Skip navigation if the change came from pathname sync\n    if (fromPathnameRef.current) {\n      fromPathnameRef.current = false; // Reset flag\n      return;\n    }\n    \n    const tabRoutes = {\n      'dashboard': '/',\n      'feed': '/feed',\n      'messages': '/messages',\n      'bookings': '/bookings',\n      'marketplace': '/marketplace',\n      'tech': '/tech',\n      'payments': '/payments',\n      'profile': '/profile',\n      'business-center': '/business-center',\n      'legal': '/legal',\n      'edu-student': '/edu-student',\n      'edu-intern': '/edu-intern',\n      'edu-overview': '/edu-overview',\n      'edu-admin': '/edu-admin',\n      'studio-ops': '/studio-ops',\n    };\n\n    const route = tabRoutes[activeTab];\n    // Only navigate if route exists and pathname doesn't match\n    if (route && location.pathname !== route) {\n      isNavigatingRef.current = true; // Mark that we're navigating\n      navigate(route, { replace: true });\n    }\n  }, [activeTab, navigate, location.pathname]);\n\n  // Load sub-profiles\n  useEffect(() => {\n    if (!user?.id || !supabase) return;\n\n    const loadSubProfiles = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('sub_profiles')\n          .select('*')\n          .eq('user_id', user.id);\n\n        if (error) {\n          console.warn('Error loading sub-profiles:', error);\n          return;\n        }\n\n        const profiles = {};\n        data?.forEach(profile => {\n          profiles[profile.role] = profile;\n        });\n        setSubProfiles(profiles);\n      } catch (err) {\n        console.error('Failed to load sub-profiles:', err);\n      }\n    };\n\n    loadSubProfiles();\n  }, [user?.id]);\n\n  // Load token balance\n  useEffect(() => {\n    if (!user?.id || !supabase) return;\n\n    const loadBalance = async () => {\n      try {\n        const { data } = await supabase\n          .from('wallets')\n          .select('balance')\n          .eq('user_id', user.id)\n          .maybeSingle();\n\n        if (data) {\n          setTokenBalance(data.balance || 0);\n        }\n      } catch (err) {\n        console.warn('Failed to load token balance:', err);\n      }\n    };\n\n    loadBalance();\n  }, [user?.id]);\n\n  const handleRoleSwitch = async (newRole) => {\n    if (!user || !supabase) return;\n    \n    // Optimistic update\n    const updatedUserData = { ...userData, activeProfileRole: newRole };\n    \n    try {\n      await supabase\n        .from('profiles')\n        .update({ active_role: newRole, updated_at: new Date().toISOString() })\n        .eq('id', user.id);\n    } catch (e) {\n      console.error(\"Role switch failed:\", e);\n    }\n  };\n\n  const openPublicProfile = useCallback((uid, name) => {\n    setViewingProfile({ uid, name });\n  }, []);\n\n  const clearPendingChatTarget = useCallback(() => {\n    setPendingChatTarget(null);\n  }, []);\n\n\n  // Determine which content to render based on activeTab\n  // Using a function instead of useMemo to avoid hook initialization issues\n  const renderContent = () => {\n    // Guard: Return loading if userData is not ready\n    if (!userData || !userData.id) {\n      return (\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue mx-auto mb-4\"></div>\n            <p className=\"text-gray-600 dark:text-gray-400\">Loading...</p>\n          </div>\n        </div>\n      );\n    }\n\n    const LoadingFallback = () => (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <Loader2 className=\"animate-spin text-brand-blue\" size={32} />\n      </div>\n    );\n\n    switch (activeTab) {\n      case 'dashboard':\n        return (\n          <ErrorBoundary name=\"Dashboard\">\n            <Suspense \n              fallback={<LoadingFallback />}\n              // Add error boundary inside Suspense to catch initialization errors\n            >\n              <ErrorBoundary name=\"Dashboard-Inner\">\n                <Dashboard\n                  user={user}\n                  userData={userData}\n                  setActiveTab={setActiveTab}\n                  bookingCount={0}\n                  subProfiles={subProfiles}\n                  tokenBalance={tokenBalance}\n                />\n              </ErrorBoundary>\n            </Suspense>\n          </ErrorBoundary>\n        );\n\n      case 'feed':\n      case 'social':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <SocialFeed\n              user={user}\n              userData={userData}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'messages':\n      case 'chat':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <ChatInterface\n              user={user}\n              userData={userData}\n              openPublicProfile={openPublicProfile}\n              pendingChatTarget={pendingChatTarget}\n              clearPendingChatTarget={clearPendingChatTarget}\n            />\n          </Suspense>\n        );\n\n      case 'bookings':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <BookingSystem\n              user={user}\n              userData={userData}\n              subProfiles={subProfiles}\n            />\n          </Suspense>\n        );\n\n      case 'marketplace':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <Marketplace\n              user={user}\n              userData={userData}\n              tokenBalance={tokenBalance}\n            />\n          </Suspense>\n        );\n\n      case 'tech':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <TechServices\n              user={user}\n              userData={userData}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'payments':\n      case 'billing':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <PaymentsManager\n              user={user}\n              userData={userData}\n              tokenBalance={tokenBalance}\n            />\n          </Suspense>\n        );\n\n      case 'profile':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <ProfileManager\n              user={user}\n              userData={userData}\n              subProfiles={subProfiles}\n              handleLogout={handleLogout}\n              openPublicProfile={openPublicProfile}\n            />\n          </Suspense>\n        );\n\n      case 'business-center':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <BusinessCenter\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'legal':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <LegalDocs />\n          </Suspense>\n        );\n\n      case 'edu-student':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduStudentDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'edu-intern':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduInternDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'edu-overview':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduStaffDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'edu-admin':\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <EduAdminDashboard\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      case 'studio-ops':\n        // Studio operations are handled within BusinessCenter\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <BusinessCenter\n              user={user}\n              userData={userData}\n            />\n          </Suspense>\n        );\n\n      default:\n        return (\n          <Suspense fallback={<LoadingFallback />}>\n            <Dashboard\n              user={user}\n              userData={userData}\n              setActiveTab={setActiveTab}\n              bookingCount={0}\n              subProfiles={subProfiles}\n              tokenBalance={tokenBalance}\n            />\n          </Suspense>\n        );\n    }\n  };\n\n  return (\n    <SchoolProvider user={user} userData={userData}>\n      <div className=\"flex h-screen overflow-hidden bg-gray-50 dark:bg-[#1a1d21]\">\n        {/* Sidebar */}\n        <Suspense fallback={<LoadingFallback />}>\n          <Sidebar\n            userData={userData}\n            activeTab={activeTab}\n            setActiveTab={setActiveTab}\n            sidebarOpen={sidebarOpen}\n            setSidebarOpen={setSidebarOpen}\n            handleLogout={handleLogout}\n          />\n        </Suspense>\n\n      {/* Main Content Area */}\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* Navbar */}\n        <Suspense fallback={<LoadingFallback />}>\n          <Navbar\n            user={user}\n            userData={userData}\n            subProfiles={subProfiles}\n            darkMode={darkMode}\n            toggleTheme={toggleTheme}\n            activeTab={activeTab}\n            setActiveTab={setActiveTab}\n            onMenuClick={() => setSidebarOpen(!sidebarOpen)}\n            onRoleSwitch={handleRoleSwitch}\n            openPublicProfile={openPublicProfile}\n          />\n        </Suspense>\n\n        {/* Content */}\n        <main className=\"flex-1 overflow-y-auto\">\n          {renderContent()}\n        </main>\n      </div>\n\n        {/* Public Profile Modal */}\n        {viewingProfile && (\n          <Suspense fallback={null}>\n            <PublicProfileModal\n            userId={viewingProfile.uid}\n            currentUser={user}\n            currentUserData={userData}\n            onClose={() => setViewingProfile(null)}\n            onMessage={(uid, name) => {\n              setPendingChatTarget({ uid, name });\n              setActiveTab('messages');\n              setViewingProfile(null);\n            }}\n          />\n          </Suspense>\n        )}\n      </div>\n    </SchoolProvider>\n  );\n}\n\n","import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { supabase } from './config/supabase'; \r\nimport { Loader2 } from 'lucide-react';\r\nimport { Toaster } from 'react-hot-toast';\r\n\r\n// Core components\r\nimport AuthWizard from './components/AuthWizard';\r\nimport AppRoutes from './routes/AppRoutes';\r\nimport MainLayout from './components/MainLayout';\r\n\r\nexport default function App() {\r\n  const [user, setUser] = useState(null);\r\n  const [userData, setUserData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  // Track if initial session has been handled to prevent duplicate loading clears\r\n  const initialSessionHandledRef = useRef(false);\r\n  \r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  // Dark Mode\r\n  const [darkMode, setDarkMode] = useState(() => {\r\n    if (typeof window !== 'undefined') {\r\n        return localStorage.getItem('theme') === 'dark' ||\r\n            (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);\r\n    }\r\n    return false;\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (darkMode) {\r\n        document.documentElement.classList.add('dark');\r\n        localStorage.setItem('theme', 'dark');\r\n    } else {\r\n        document.documentElement.classList.remove('dark');\r\n        localStorage.setItem('theme', 'light');\r\n    }\r\n  }, [darkMode]);\r\n\r\n  const toggleTheme = () => setDarkMode(!darkMode);\r\n\r\n  // --- SUPABASE AUTH & DATA LISTENER ---\r\n  useEffect(() => {\r\n    // Reset the ref on each mount\r\n    initialSessionHandledRef.current = false;\r\n    \r\n    if (!supabase) {\r\n        setLoading(false);\r\n        return;\r\n    }\r\n\r\n    // Track loading state to prevent duplicate calls\r\n    const loadingUsers = new Set();\r\n\r\n    /**\r\n     * ROBUST USER DATA LOADER\r\n     * This function is designed to never throw an uncaught error.\r\n     * It will always set userData to *something*, preventing the \"null account\" crash.\r\n     */\r\n    const loadUserData = async (userId, sessionUser = null) => {\r\n        // 1. Sanity Check\r\n        if (!userId) {\r\n            // Don't set to null - if we have a user, we should always have userData\r\n            // Only set to null if we truly have no user\r\n            return;\r\n        }\r\n\r\n        // 2. Prevent duplicate calls for the same user\r\n        if (loadingUsers.has(userId)) {\r\n            console.log('User data already loading for:', userId);\r\n            return;\r\n        }\r\n        loadingUsers.add(userId);\r\n\r\n        let authUser = sessionUser || user; // Use provided sessionUser or current user state\r\n        \r\n        try {\r\n            // 2. Safe Auth Retrieval (only if we don't have user data)\r\n            // Use session user if provided, otherwise fetch (but prefer current user state)\r\n            if (!authUser) {\r\n                const { data: authData } = await supabase.auth.getUser();\r\n                authUser = authData?.user || null;\r\n            }\r\n            \r\n            // 3. Fetch Profile (Safely)\r\n            // .maybeSingle() returns null instead of throwing an error if 0 rows are found\r\n            const { data: profile, error: profileError } = await supabase\r\n                .from('profiles')\r\n                .select('*')\r\n                .eq('id', userId)\r\n                .maybeSingle();\r\n            \r\n            if (profileError) {\r\n                console.warn(\"Minor warning fetching profile:\", profileError.message);\r\n            }\r\n\r\n            // 4. Construct Fallback/Default Data\r\n            // We use the most reliable source available for each field\r\n            const currentEmail = profile?.email || authUser?.email || user?.email || '';\r\n            const metadata = authUser?.user_metadata || {};\r\n            \r\n            const currentFirstName = \r\n                profile?.first_name || \r\n                metadata.first_name || \r\n                metadata.given_name || \r\n                'User';\r\n                \r\n            const currentLastName = \r\n                profile?.last_name || \r\n                metadata.last_name || \r\n                metadata.family_name || \r\n                '';\r\n\r\n            // Base object that guarantees the app can render\r\n            let finalUserData = {\r\n                id: userId,\r\n                firstName: currentFirstName,\r\n                lastName: currentLastName,\r\n                email: currentEmail,\r\n                accountTypes: ['Fan'], // Safe default\r\n                activeProfileRole: 'Fan',\r\n                photoURL: profile?.avatar_url || metadata.avatar_url || metadata.picture || null,\r\n                settings: profile?.settings || {},\r\n                effectiveDisplayName: profile?.effective_display_name || currentFirstName\r\n            };\r\n\r\n            // 5. Merge Real Profile Data (if it exists)\r\n            if (profile) {\r\n                const accountTypes = profile.account_types && profile.account_types.length > 0 \r\n                    ? profile.account_types \r\n                    : ['Fan'];\r\n                \r\n                finalUserData = {\r\n                    ...finalUserData,\r\n                    ...profile, // Overwrite defaults with DB data\r\n                    accountTypes,\r\n                    activeProfileRole: profile.active_role || accountTypes[0],\r\n                };\r\n            } else {\r\n                // Profile doesn't exist - create it from auth data\r\n                console.log('Profile not found, creating from auth data');\r\n                \r\n                const firstName = authUser?.user_metadata?.first_name || authUser?.user_metadata?.given_name || '';\r\n                const lastName = authUser?.user_metadata?.last_name || authUser?.user_metadata?.family_name || '';\r\n                const email = authUser?.email || '';\r\n                \r\n                // Calculate effective display name\r\n                const effectiveName = firstName && lastName \r\n                    ? `${firstName} ${lastName}`\r\n                    : firstName || lastName || email?.split('@')[0] || 'User';\r\n                \r\n                // Try to create profile using upsert (handles race conditions)\r\n                // Only create if profile truly doesn't exist (AuthWizard should have created it)\r\n                const { error: createError } = await supabase\r\n                    .from('profiles')\r\n                    .upsert({\r\n                        id: userId,\r\n                        email: email,\r\n                        first_name: firstName,\r\n                        last_name: lastName,\r\n                        avatar_url: authUser?.user_metadata?.avatar_url || authUser?.user_metadata?.picture || null,\r\n                        account_types: ['Fan'],\r\n                        active_role: 'Fan',\r\n                        preferred_role: 'Fan', // Fallback role when user has multiple roles\r\n                        effective_display_name: effectiveName,\r\n                        search_terms: [\r\n                            firstName?.toLowerCase(),\r\n                            lastName?.toLowerCase(),\r\n                            effectiveName.toLowerCase()\r\n                        ].filter(Boolean),\r\n                        settings: {},\r\n                        updated_at: new Date().toISOString()\r\n                    }, { onConflict: 'id' });\r\n                \r\n                if (createError) {\r\n                    console.error(\"Error creating/updating profile:\", createError);\r\n                } else {\r\n                    console.log('Profile created/updated successfully');\r\n                }\r\n                \r\n                // Update finalUserData with the created profile data\r\n                finalUserData = {\r\n                    ...finalUserData,\r\n                    firstName: firstName || 'User',\r\n                    lastName: lastName || '',\r\n                    email: email,\r\n                    effectiveDisplayName: effectiveName\r\n                };\r\n            }\r\n\r\n            // 6. Set State (The most important part)\r\n            setUserData(finalUserData);\r\n\r\n            // Wallet fetching removed for minimal setup\r\n        } catch (err) {\r\n            console.error(\"CRITICAL: Error loading user data:\", err);\r\n            // FAILSAFE: Always set userData to prevent null state\r\n            // This ensures the app never renders with null userData when user exists\r\n            setUserData({\r\n                id: userId,\r\n                firstName: authUser?.user_metadata?.first_name || authUser?.user_metadata?.given_name || 'User',\r\n                lastName: authUser?.user_metadata?.last_name || authUser?.user_metadata?.family_name || '',\r\n                email: authUser?.email || '',\r\n                accountTypes: ['Fan'],\r\n                activeProfileRole: 'Fan',\r\n                effectiveDisplayName: authUser?.user_metadata?.first_name || authUser?.user_metadata?.given_name || 'User',\r\n                photoURL: authUser?.user_metadata?.avatar_url || authUser?.user_metadata?.picture || null,\r\n                settings: {}\r\n            });\r\n        } finally {\r\n            // Remove from loading set when done\r\n            loadingUsers.delete(userId);\r\n        }\r\n    };\r\n\r\n    // 1. Get initial session\r\n    const loadInitialSession = async () => {\r\n        try {\r\n            const { data: { session }, error } = await supabase.auth.getSession();\r\n            \r\n            if (error) {\r\n                console.error(\"Error getting session:\", error);\r\n                // If error is related to storage, it's likely Tracking Prevention\r\n                if (error.message?.includes('storage') || error.message?.includes('localStorage')) {\r\n                    console.warn(\"Storage access blocked - session cannot be persisted\");\r\n                }\r\n                setUser(null);\r\n                setUserData(null);\r\n                // Only clear loading if we haven't already\r\n                if (!initialSessionHandledRef.current) {\r\n                    setLoading(false);\r\n                    initialSessionHandledRef.current = true;\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Validate session exists and has a valid user\r\n            const currentUser = session?.user ?? null;\r\n            \r\n            if (currentUser && currentUser.id) {\r\n                console.log('Session restored:', currentUser.id);\r\n                setUser(currentUser);\r\n                \r\n                // Create minimal userData immediately from session user (prevents blocking)\r\n                const metadata = currentUser.user_metadata || {};\r\n                const minimalUserData = {\r\n                    id: currentUser.id,\r\n                    firstName: metadata.first_name || metadata.given_name || 'User',\r\n                    lastName: metadata.last_name || metadata.family_name || '',\r\n                    email: currentUser.email || '',\r\n                    accountTypes: ['Fan'],\r\n                    activeProfileRole: 'Fan',\r\n                    photoURL: metadata.avatar_url || metadata.picture || null,\r\n                    settings: {},\r\n                    effectiveDisplayName: metadata.first_name || metadata.given_name || 'User'\r\n                };\r\n                setUserData(minimalUserData);\r\n                \r\n                // Clear loading immediately to show UI\r\n                if (!initialSessionHandledRef.current) {\r\n                    setLoading(false);\r\n                    initialSessionHandledRef.current = true;\r\n                }\r\n                \r\n                // Load full user data in background (will update userData when complete)\r\n                loadUserData(currentUser.id, currentUser).catch(err => {\r\n                    console.error(\"User data load failed:\", err);\r\n                });\r\n            } else {\r\n                setUser(null);\r\n                setUserData(null);\r\n                // No user - clear loading immediately\r\n                if (!initialSessionHandledRef.current) {\r\n                    setLoading(false);\r\n                    initialSessionHandledRef.current = true;\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Session check failed:\", err);\r\n            setUser(null);\r\n            setUserData(null);\r\n            if (!initialSessionHandledRef.current) {\r\n                setLoading(false);\r\n                initialSessionHandledRef.current = true;\r\n            }\r\n        }\r\n    };\r\n    \r\n    // Start loading session\r\n    loadInitialSession();\r\n\r\n    // 2. Listen for auth changes\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n        console.log('Auth event:', event);\r\n        const currentUser = session?.user ?? null;\r\n        \r\n        // Handle INITIAL_SESSION event - this fires on page load\r\n        // loadInitialSession already handled this, so just sync state if needed\r\n        if (event === 'INITIAL_SESSION') {\r\n            if (currentUser && currentUser.id) {\r\n                setUser(currentUser);\r\n                // Load userData in background if we don't have it yet\r\n                if (!userData) {\r\n                    loadUserData(currentUser.id).catch(err => {\r\n                        console.error(\"Background user data load failed:\", err);\r\n                    });\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (currentUser) {\r\n            setUser(currentUser);\r\n            // Refresh data on sign-in or token refresh\r\n            if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {\r\n                loadUserData(currentUser.id).catch(err => {\r\n                    console.error(\"Background user data load failed:\", err);\r\n                });\r\n            }\r\n        } else if (event === 'SIGNED_OUT') {\r\n            setUser(null);\r\n            setUserData(null);\r\n            // Navigate to login on sign out\r\n            navigate('/login', { replace: true });\r\n        }\r\n        \r\n        // Clear loading for other events (but INITIAL_SESSION is handled above)\r\n        if (event !== 'INITIAL_SESSION') {\r\n            setLoading(false);\r\n        }\r\n    });\r\n\r\n    // 3. Safety timeout - reduced to 1.5 seconds (just in case)\r\n    const timeoutId = setTimeout(() => {\r\n        if (loading) {\r\n            console.warn(\"Force clearing loading state after timeout\");\r\n            setLoading(false);\r\n            initialSessionHandledRef.current = true;\r\n        }\r\n    }, 1500);\r\n\r\n    return () => {\r\n        subscription.unsubscribe();\r\n        clearTimeout(timeoutId);\r\n    };\r\n  }, []); // Empty dependency array = runs once on mount\r\n\r\n  const handleLogout = useCallback(async () => {\r\n      try {\r\n          // Clear state immediately for responsive UI\r\n          setUser(null);\r\n          setUserData(null);\r\n          \r\n          // Sign out from Supabase\r\n          if (supabase) {\r\n              const { error } = await supabase.auth.signOut();\r\n              if (error) {\r\n                  console.error(\"Logout error:\", error);\r\n              }\r\n          }\r\n          \r\n          // Navigate to login - auth state change will also trigger, but this ensures immediate redirect\r\n          navigate('/login', { replace: true });\r\n      } catch (err) {\r\n          console.error(\"Logout error:\", err);\r\n          // Even if signOut fails, clear state and redirect\r\n          setUser(null);\r\n          setUserData(null);\r\n          navigate('/login', { replace: true });\r\n      }\r\n  }, [navigate]);\r\n\r\n  // Show loading spinner while we're checking session or loading userData\r\n  // This prevents flashing between AuthWizard and MainLayout\r\n  if (loading) {\r\n    return (\r\n      <div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]\">\r\n        <Loader2 className=\"animate-spin text-brand-blue\" size={48} />\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Check if coming from OAuth signup flow\r\n  const isFromSignup = new URLSearchParams(window.location.search).get('intent') === 'signup';\r\n  \r\n  // === AUTHENTICATION GUARD ===\r\n  const isAuthenticated = user && user.id;\r\n  const hasUserData = userData && userData.id;\r\n  const isOnLoginPage = location.pathname === '/login';\r\n  const isTestLoginPage = location.pathname === '/test-login';\r\n  \r\n  // CRITICAL: If no user is loaded, always show AuthWizard\r\n  // This ensures the app never renders with null user\r\n  if (!isAuthenticated && !isOnLoginPage && !isTestLoginPage) {\r\n    return <AuthWizard darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/')} isNewUser={false} />;\r\n  }\r\n  \r\n  // CRITICAL: If user exists but no userData, show loading (not AuthWizard)\r\n  // This prevents flashing - we wait for userData before showing UI\r\n  if (isAuthenticated && !hasUserData && !isOnLoginPage && !isTestLoginPage) {\r\n    // UserData is still loading - show loading spinner instead of AuthWizard\r\n    // This prevents the flash between AuthWizard and MainLayout\r\n    return (\r\n      <div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-[#1a1d21]\">\r\n        <Loader2 className=\"animate-spin text-brand-blue\" size={48} />\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Handle test login page (always show login, route to debug report)\r\n  if (isTestLoginPage) {\r\n    if (isAuthenticated && hasUserData) {\r\n      // Already logged in - redirect to debug report\r\n      navigate('/debug-report', { replace: true });\r\n      return null;\r\n    }\r\n    // Show login form - route to debug report on success\r\n    return <AuthWizard darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/debug-report')} isNewUser={false} />;\r\n  }\r\n  \r\n  // Handle login page\r\n  if (isOnLoginPage) {\r\n    if (isAuthenticated && hasUserData) {\r\n      // Already logged in - redirect to dashboard\r\n      navigate('/', { replace: true });\r\n      return null;\r\n    }\r\n    // Show login form - normal flow\r\n    return <AuthWizard darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/')} isNewUser={false} />;\r\n  }\r\n  \r\n  // Handle OAuth onboarding\r\n  if (isAuthenticated && !hasUserData && isFromSignup) {\r\n    return <AuthWizard user={user} isNewUser={true} darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/debug-report')} />;\r\n  }\r\n  \r\n  // Require authentication for all other routes\r\n  if (!isAuthenticated || !hasUserData) {\r\n    // This should be caught above, but double-check\r\n    return <AuthWizard darkMode={darkMode} toggleTheme={toggleTheme} onSuccess={() => navigate('/')} isNewUser={false} />;\r\n  }\r\n\r\n  // Render app with full layout (Sidebar + Navbar + Content)\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 dark:bg-[#1a1d21]\">\r\n      <Toaster position=\"bottom-right\" toastOptions={{ style: { background: '#333', color: '#fff' } }} />\r\n      \r\n      {/* Check if we're on a special route that needs different layout */}\r\n      {location.pathname === '/settings' || location.pathname === '/debug-report' ? (\r\n        // Settings and Debug Report use simple layout\r\n        <main className=\"p-6\">\r\n          <AppRoutes\r\n            user={user}\r\n            userData={userData}\r\n            loading={loading}\r\n            darkMode={darkMode}\r\n            toggleTheme={toggleTheme}\r\n            handleLogout={handleLogout}\r\n          />\r\n        </main>\r\n      ) : (\r\n        // All other routes use MainLayout with Sidebar + Navbar\r\n        <MainLayout\r\n          user={user}\r\n          userData={userData}\r\n          loading={loading}\r\n          darkMode={darkMode}\r\n          toggleTheme={toggleTheme}\r\n          handleLogout={handleLogout}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport { BrowserRouter } from 'react-router-dom'\r\nimport { ConvexProvider } from \"convex/react\"\r\nimport * as Sentry from '@sentry/react'\r\nimport App from './App.jsx'\r\nimport { convex } from './config/convex'\r\nimport ErrorBoundary from './components/shared/ErrorBoundary'\r\nimport './index.css'\r\n\r\n// Initialize Sentry if DSN is provided\r\nconst sentryDsn = import.meta.env.VITE_SENTRY_DSN\r\nif (sentryDsn) {\r\n  Sentry.init({\r\n    dsn: sentryDsn,\r\n    environment: import.meta.env.MODE || 'development',\r\n    integrations: [\r\n      Sentry.browserTracingIntegration(),\r\n      Sentry.replayIntegration({\r\n        maskAllText: false,\r\n        blockAllMedia: false,\r\n      }),\r\n    ],\r\n    // Performance Monitoring\r\n    tracesSampleRate: import.meta.env.PROD ? 0.1 : 1.0,\r\n    // Session Replay\r\n    replaysSessionSampleRate: import.meta.env.PROD ? 0.1 : 1.0,\r\n    replaysOnErrorSampleRate: 1.0,\r\n    // Filter out common non-critical errors\r\n    beforeSend(event, hint) {\r\n      // Filter out localStorage errors (tracking prevention)\r\n      if (event.exception?.values?.[0]?.value?.includes('localStorage') ||\r\n          event.exception?.values?.[0]?.value?.includes('QuotaExceededError')) {\r\n        return null; // Don't send these errors\r\n      }\r\n      return event;\r\n    },\r\n  });\r\n  \r\n  if (import.meta.env.DEV) {\r\n    console.log(' Sentry initialized for error monitoring');\r\n  }\r\n}\r\n\r\n// Development: Enhanced error logging\r\nif (import.meta.env.DEV) {\r\n  const originalError = console.error;\r\n  console.error = (...args) => {\r\n    const errorMessage = args[0]?.toString() || '';\r\n    if (errorMessage.includes('Rendered more hooks') || errorMessage.includes('301')) {\r\n      console.group(' React Hook Error #301');\r\n      console.error('Component rendered with different hook count than previous render.');\r\n      console.error('Check component stack above for the problematic component.');\r\n      console.groupEnd();\r\n    }\r\n    originalError.apply(console, args);\r\n  };\r\n}\r\n\r\n// App wrapper with error boundaries\r\nconst AppWrapper = ({ children }) => {\r\n  if (sentryDsn) {\r\n    return (\r\n      <Sentry.ErrorBoundary \r\n        fallback={({ error, resetError }) => (\r\n          <div className=\"flex items-center justify-center min-h-screen bg-gray-50 dark:bg-[#1a1d21]\">\r\n            <div className=\"text-center p-8\">\r\n              <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-4\">Something went wrong</h1>\r\n              <p className=\"text-gray-600 dark:text-gray-400 mb-6\">{error?.message || 'An unexpected error occurred'}</p>\r\n              <button\r\n                onClick={resetError}\r\n                className=\"px-4 py-2 bg-brand-blue text-white rounded-lg hover:bg-blue-600 transition-colors\"\r\n              >\r\n                Try again\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      >\r\n        {children}\r\n      </Sentry.ErrorBoundary>\r\n    );\r\n  }\r\n  return <>{children}</>;\r\n};\r\n\r\nReactDOM.createRoot(document.getElementById('root')).render(\r\n  <AppWrapper>\r\n    <ErrorBoundary name=\"Root\">\r\n      <ConvexProvider client={convex}>\r\n        <BrowserRouter>\r\n          <App />\r\n        </BrowserRouter>\r\n      </ConvexProvider>\r\n    </ErrorBoundary>\r\n  </AppWrapper>\r\n)\r\n\r\nconst removeLoader = () => {\r\n  const loader = document.getElementById('loading-fallback');\r\n  if (loader) {\r\n    loader.classList.add('fade-out');\r\n    setTimeout(() => {\r\n      if (loader && loader.parentNode) {\r\n        loader.parentNode.removeChild(loader);\r\n      }\r\n      document.body.style.overflow = 'auto';\r\n    }, 400);\r\n  }\r\n};\r\n\r\nsetTimeout(removeLoader, 600);\r\n"],"file":"assets/index-CGolWPqJ.js"}