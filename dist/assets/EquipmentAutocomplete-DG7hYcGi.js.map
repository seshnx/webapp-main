{"version":3,"file":"EquipmentAutocomplete-DG7hYcGi.js","sources":["../../src/hooks/useEquipmentDatabase.js","../../src/hooks/useEquipmentSearch.js","../../src/components/shared/EquipmentAutocomplete.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { supabase } from '../config/supabase';\r\n\r\n// Main categories matching your Firestore layout\r\nconst COLLECTIONS = [\r\n    { id: 'computer_audio_and_interfaces', label: 'Computer Audio & Interfaces' },\r\n    { id: 'microphones_and_input_transducers', label: 'Microphones' },\r\n    { id: 'mixing_consoles_and_control', label: 'Mixing Consoles' },\r\n    { id: 'monitoring_and_playback', label: 'Monitoring & Playback' },\r\n    { id: 'outboard_signal_processing', label: 'Outboard Gear' }\r\n];\r\n\r\nexport const useEquipmentDatabase = () => {\r\n    const [dbData, setDbData] = useState({});\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            if (!supabase) {\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            setLoading(true);\r\n            const newData = {};\r\n\r\n            try {\r\n                // Fetch all equipment items grouped by category\r\n                const { data, error } = await supabase\r\n                    .from('equipment_items')\r\n                    .select('*')\r\n                    .order('category_id')\r\n                    .order('subcategory_id');\r\n\r\n                if (error) throw error;\r\n\r\n                // Group by category and subcategory to match original structure\r\n                COLLECTIONS.forEach(col => {\r\n                    const categoryItems = (data || []).filter(item => item.category_id === col.id);\r\n                    \r\n                    const colItems = {};\r\n                    categoryItems.forEach(item => {\r\n                        const subcatId = item.subcategory_id || 'default';\r\n                        if (!colItems[subcatId]) {\r\n                            colItems[subcatId] = { Types: [] };\r\n                        }\r\n                        // Store item data in the expected format\r\n                        colItems[subcatId].Types.push({\r\n                            ...item.data,\r\n                            id: item.id,\r\n                            name: item.name,\r\n                            manufacturer: item.manufacturer,\r\n                            model: item.model\r\n                        });\r\n                    });\r\n                    \r\n                    newData[col.id] = colItems;\r\n                });\r\n                \r\n                setDbData(newData);\r\n            } catch (error) {\r\n                console.error(\"Failed to load equipment database:\", error);\r\n            }\r\n            setLoading(false);\r\n        };\r\n\r\n        fetchData();\r\n    }, []);\r\n\r\n    return { \r\n        loading, \r\n        data: dbData,\r\n        categories: COLLECTIONS\r\n    };\r\n};\r\n","import { useState, useMemo } from 'react';\r\nimport { useEquipmentDatabase } from './useEquipmentDatabase';\r\n\r\nexport const useEquipmentSearch = () => {\r\n    const { data: equipData, loading } = useEquipmentDatabase();\r\n    const [results, setResults] = useState([]);\r\n    \r\n    // Flatten the database into a single searchable list\r\n    const allItems = useMemo(() => {\r\n        if (loading || !equipData) return [];\r\n        let flattened = [];\r\n        \r\n        try {\r\n            // 1. Iterate Categories (e.g., \"microphones_and_input_transducers\")\r\n            Object.keys(equipData).forEach(categoryKey => {\r\n                const categoryDocs = equipData[categoryKey];\r\n                if (!categoryDocs) return;\r\n\r\n                // 2. Iterate Documents (e.g., \"shure_sm57\")\r\n                // In your structure, each value here is the full Item Object\r\n                Object.entries(categoryDocs).forEach(([docId, item]) => {\r\n                    if (!item || typeof item !== 'object') return;\r\n\r\n                    // 3. Extract Metadata\r\n                    // Prefer root fields, fallback to searchTokens logic\r\n                    const brand = item.brand || (item.searchTokens && item.searchTokens[0]) || 'Unknown';\r\n                    const name = item.name || (item.searchTokens && item.searchTokens[1]) || 'Unknown Item';\r\n                    \r\n                    // 4. Build Powerful Search String\r\n                    // Combine explicit name/brand with your robust searchTokens array into one giant string\r\n                    const tokens = item.searchTokens || [];\r\n                    const searchString = [\r\n                        name,\r\n                        brand,\r\n                        ...tokens\r\n                    ].join(' ').toLowerCase();\r\n\r\n                    flattened.push({\r\n                        id: docId,\r\n                        name: name,\r\n                        brand: brand,\r\n                        category: item.category || categoryKey,\r\n                        subCategory: item.subCategory || 'General',\r\n                        // Store the search string for filtering\r\n                        searchString: searchString,\r\n                        // Keep original data just in case\r\n                        original: item\r\n                    });\r\n                });\r\n            });\r\n        } catch (err) {\r\n            console.warn(\"Error processing equipment data:\", err);\r\n        }\r\n\r\n        return flattened;\r\n    }, [equipData, loading]);\r\n\r\n    const searchEquipment = (searchTerm) => {\r\n        if (!searchTerm || searchTerm.trim().length < 1) {\r\n            setResults([]);\r\n            return;\r\n        }\r\n\r\n        // 1. Split user query into individual terms (e.g. \"SSL Origin\" -> [\"ssl\", \"origin\"])\r\n        const queryTerms = searchTerm.toLowerCase().trim().split(/\\s+/);\r\n        \r\n        // 2. Filter: Item must match ALL terms\r\n        const filteredResults = allItems.filter(item => {\r\n            // \"Every\" term in the query must be found somewhere in the item's search string\r\n            return queryTerms.every(term => item.searchString.includes(term));\r\n        }).slice(0, 50); // Limit results for performance\r\n\r\n        setResults(filteredResults);\r\n    };\r\n\r\n    return { searchEquipment, results, loading };\r\n};\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { Search, X, Loader2, Disc } from 'lucide-react';\r\nimport { useEquipmentSearch } from '../../hooks/useEquipmentSearch';\r\n\r\nexport default function EquipmentAutocomplete({ \r\n    onSelect, \r\n    placeholder = \"Search for gear (e.g. U87, SSL)...\", \r\n    className = \"\",\r\n    value,      // Controlled value prop\r\n    onChange,   // Controlled change handler\r\n    multi = false // Toggle for comma-separated list behavior\r\n}) {\r\n    const { searchEquipment, results, loading } = useEquipmentSearch();\r\n    const [localQuery, setLocalQuery] = useState('');\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const wrapperRef = useRef(null);\r\n\r\n    // Determine value to display (Controlled vs Uncontrolled)\r\n    const displayValue = value !== undefined ? value : localQuery;\r\n\r\n    // Close dropdown when clicking outside\r\n    useEffect(() => {\r\n        function handleClickOutside(event) {\r\n            if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\r\n                setIsOpen(false);\r\n            }\r\n        }\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, [wrapperRef]);\r\n\r\n    const handleInputChange = (e) => {\r\n        const val = e.target.value;\r\n        \r\n        // Update State/Parent\r\n        if (onChange) onChange(val);\r\n        else setLocalQuery(val);\r\n\r\n        // Determine Search Term\r\n        // If multi, search only the text after the last comma\r\n        const searchTerm = multi ? val.split(',').pop().trim() : val;\r\n\r\n        if (searchTerm.length >= 2) {\r\n            searchEquipment(searchTerm);\r\n            setIsOpen(true);\r\n        } else {\r\n            setIsOpen(false);\r\n        }\r\n    };\r\n\r\n    const handleSelect = (item) => {\r\n        // Construct a full display name\r\n        const fullName = item.brand !== 'Various' && item.brand !== 'Unknown' \r\n            ? `${item.brand} ${item.name}` \r\n            : item.name;\r\n            \r\n        if (multi) {\r\n            // Split by comma, remove the partial term being typed\r\n            const terms = displayValue.split(',');\r\n            terms.pop(); \r\n            \r\n            // Clean up existing terms and append the new selection\r\n            const cleanTerms = terms.map(t => t.trim()).filter(Boolean);\r\n            const newValue = [...cleanTerms, fullName].join(', ') + ', ';\r\n            \r\n            if (onChange) onChange(newValue);\r\n            else setLocalQuery(newValue);\r\n        } else {\r\n            // Standard single select behavior\r\n            if (onSelect) onSelect({ ...item, fullName });\r\n            if (onChange) onChange(fullName);\r\n            else setLocalQuery(fullName); // Or clear it depending on UX, sticking to filling input here\r\n        }\r\n        \r\n        setIsOpen(false);\r\n    };\r\n\r\n    return (\r\n        <div ref={wrapperRef} className={`relative ${className}`}>\r\n            <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-3 text-gray-400\" size={16} />\r\n                <input \r\n                    className=\"w-full pl-9 pr-8 p-3 text-sm border rounded-xl bg-white dark:bg-[#1f2128] dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-brand-blue outline-none transition-all\"\r\n                    placeholder={placeholder}\r\n                    value={displayValue}\r\n                    onChange={handleInputChange}\r\n                    onFocus={(e) => handleInputChange(e)} // Trigger search on focus if text exists\r\n                />\r\n                {displayValue && (\r\n                    <button \r\n                        type=\"button\"\r\n                        onClick={() => { \r\n                            if(onChange) onChange(''); \r\n                            else setLocalQuery(''); \r\n                            setIsOpen(false); \r\n                        }}\r\n                        className=\"absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200\"\r\n                    >\r\n                        <X size={16}/>\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {isOpen && results.length > 0 && (\r\n                <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl max-h-60 overflow-y-auto animate-in fade-in slide-in-from-top-2\">\r\n                    <div className=\"py-1\">\r\n                        {results.map((item) => (\r\n                            <button\r\n                                key={item.id}\r\n                                type=\"button\"\r\n                                onClick={() => handleSelect(item)}\r\n                                className=\"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b dark:border-gray-700/50 last:border-0 group\"\r\n                            >\r\n                                <div className=\"font-bold text-sm dark:text-white group-hover:text-brand-blue transition-colors\">\r\n                                    {item.name}\r\n                                </div>\r\n                                <div className=\"text-xs text-gray-500 flex items-center gap-1.5 mt-0.5\">\r\n                                    <span className=\"font-medium text-gray-600 dark:text-gray-400\">{item.brand}</span>\r\n                                    <span className=\"w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600\"></span>\r\n                                    <span className=\"opacity-75\">{item.subCategory?.replace(/_/g, ' ')}</span>\r\n                                </div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n            \r\n            {isOpen && loading && (\r\n                <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-[#2c2e36] border dark:border-gray-600 rounded-xl shadow-xl p-4 text-center text-gray-500 flex items-center justify-center gap-2\">\r\n                    <Loader2 className=\"animate-spin\" size={16}/> Searching database...\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":["COLLECTIONS","useEquipmentDatabase","dbData","setDbData","useState","loading","setLoading","useEffect","useEquipmentSearch","equipData","results","setResults","allItems","useMemo","flattened","categoryKey","categoryDocs","docId","item","brand","name","tokens","searchString","err","searchTerm","queryTerms","filteredResults","term","EquipmentAutocomplete","onSelect","placeholder","className","value","onChange","multi","searchEquipment","localQuery","setLocalQuery","isOpen","setIsOpen","wrapperRef","useRef","displayValue","handleClickOutside","event","handleInputChange","e","val","handleSelect","fullName","terms","newValue","t","jsxs","jsx","Search","X","Loader2"],"mappings":"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"}